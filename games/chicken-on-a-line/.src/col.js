var Body_INFINITE_MASS=-1,Body_EPS=1e-5;function Body(t){this.state=t,this.id=t.nextBodyId++,this.origin=new Vector(0,0),this.angle=0,this.dimension=new Vector(.1,.1),this.mass=1,this.velocity=new Vector(0,0),this.angularVelocity=0,this.gravity=0,this.target=new Vector(0,0),this.targetSet=!1,this.thrust=2,this.targetAngle=0,this.targetAngelSet=!1,this.angleThrust=.02,this.eyesDir=new Vector(1,-3),this.cx=[0,0,0,0],this.cy=[0,0,0,0]}function FixedBody(t){Body.call(this,t),this.setMass(Body_INFINITE_MASS)}function Body_collide(t,i,n,e){var o=new Collision(t);return Body_collideAllCorners(o,i,n,e),o.collisionPoints.length<2&&Body_collideAllCorners(o,n,i,e),0===o.collisionPoints.length?null:o}function Body_collideAllCorners(t,i,n,e){for(var o=0;o<4;o++)n.collideSingleCorner(t,i,o,e)}function Button(t,i){this.game=t,this.text=i,this.origin=new Vector(0,0),this.dimension=new Vector(.38,.11),this.isDown=!1}function Collision(t){this.state=t,this.collisionPoints=[]}function Collision_mergeCollisions(t){if(t.length<=1)return t;var e=new UnionFind;t.forEach(function(t){var i=t.collisionPoints[0];e.union(i.collidingEntity.id,i.impactedEntity.id)});var o=[];t.forEach(function(t){var i=t.collisionPoints[0],n=e.find(i.collidingEntity.id);void 0===o[n]?o[n]=t:o[n].merge(t)});var i=[];return o.forEach(function(t){i.push(t)}),i}function CollisionPoint(t,i,n,e,o,s,r){this.collidingEntity=t,this.impactedEntity=i,this.normal_x=n,this.normal_y=e,this.contactPoint_x=o,this.contactPoint_y=s,this.separation=r,this.accumulatedImpulse=0,this.nv1=new Vector(0,0),this.nw1=0,this.nv2=new Vector(0,0),this.nw2=0}FixedBody.prototype=Object.create(Body.prototype),FixedBody.prototype.constructor=FixedBody,Body.prototype.finalize=function(){return this.inertia=(this.dimension.x*this.dimension.x+this.dimension.y*this.dimension.y)*this.mass/12,this.calculateCorners(),this},Body.prototype.setOrigin=function(t,i){return this.origin.x=t,this.origin.y=i,this},Body.prototype.setAngle=function(t){return this.angle=t,this},Body.prototype.setDimension=function(t,i){return this.dimension.x=t,this.dimension.y=i,this},Body.prototype.setMass=function(t){return this.mass=t,this},Body.prototype.setGravity=function(t){return this.gravity=t,this},Body.prototype.setVelocity=function(t,i){return this.velocity.x=t,this.velocity.y=i,this},Body.prototype.setAngularVelocity=function(t){return this.angularVelocity=t,this},Body.prototype.setTarget=function(t,i){return this.target.x=t,this.target.y=i,this.targetSet=!0,this},Body.prototype.setTargetAngle=function(t){return this.targetAngle=t,this.targetAngelSet=!0,this},Body.prototype.applyForces=function(t){if(this.targetSet){var i=this.target.x-this.origin.x,n=this.target.y-this.origin.y,e=Vector_length(i,n);0<e&&(i*=this.thrust/e,n*=this.thrust/e,this.velocity.x+=i*t*this.invertedMass(),this.velocity.y+=n*t*this.invertedMass())}if(this.targetAngelSet){var o=this.targetAngle-this.angle;0!=o&&(o=this.angleThrust*Math.sign(o),this.angularVelocity+=o*t*this.invertedInertia())}this.velocity.y+=-this.gravity*t,this.velocity.scale(Math.max(0,1-t*LATERAL_FRICTION)),this.angularVelocity*=Math.max(0,1-t*ROTATIONAL_FRICTION)},Body.prototype.advance=function(t){this.origin.x+=this.velocity.x*t,this.origin.y+=this.velocity.y*t,this.angle+=this.angularVelocity*t,this.angle>Math.Pi?this.angle-=2*Math.Pi:this.angle<-Math.Pi&&(this.angle+=2*Math.Pi),this.calculateCorners()},Body.prototype.calculateCorners=function(){var t=Math.sin(this.angle),i=Math.cos(this.angle),n=-t,e=i;this.cx[0]=this.origin.x+i*this.dimension.x*.5+n*this.dimension.y*.5,this.cy[0]=this.origin.y+t*this.dimension.x*.5+e*this.dimension.y*.5,this.cx[1]=this.origin.x-i*this.dimension.x*.5+n*this.dimension.y*.5,this.cy[1]=this.origin.y-t*this.dimension.x*.5+e*this.dimension.y*.5,this.cx[2]=this.origin.x-i*this.dimension.x*.5-n*this.dimension.y*.5,this.cy[2]=this.origin.y-t*this.dimension.x*.5-e*this.dimension.y*.5,this.cx[3]=this.origin.x+i*this.dimension.x*.5-n*this.dimension.y*.5,this.cy[3]=this.origin.y+t*this.dimension.x*.5-e*this.dimension.y*.5},Body.prototype.invertedMass=function(){return this.isFixedBody()?0:1/this.mass},Body.prototype.invertedInertia=function(){return this.isFixedBody()||0===this.inertia?0:1/this.inertia},Body.prototype.isFixedBody=function(){return this.mass===Body_INFINITE_MASS},Body.prototype.addVelocity=function(t){this.velocity.add(t)},Body.prototype.addAngularVelocity=function(t){this.angularVelocity+=t},Body.prototype.collideSingleCorner=function(t,i,n,e){var o=i.cx[n],s=i.cy[n],r=o-this.origin.x,c=s-this.origin.y,a=Math.cos(-this.angle),h=Math.sin(-this.angle),l=r*h+c*a;r=r*a-c*h,c=l;var y=.5*this.dimension.x,d=.5*this.dimension.y;if(-y-Body_EPS<=r&&r<=y+Body_EPS&&-d-Body_EPS<=c&&c<=d+Body_EPS){var u=i.velocity,g=i.angularVelocity,m=this.velocity,x=this.angularVelocity,f=o-i.origin.x,p=s-i.origin.y,T=o-this.origin.x,v=-g*p,S=g*f;v-=-x*(s-this.origin.y),S-=x*T,v-=m.x,S-=m.y;var w=(v+=u.x)*e,_=(S+=u.y)*e,A=Math.cos(-this.angle),E=Math.sin(-this.angle),C=w*E+_*A;w=w*A-_*E;var B,M,V=d-c,I=V,N=0,R=0;if(V<-(_=C)&&(N=1),(V=y+r)<w&&(N|=2),V<I&&(I=V,R=1),(V=d+c)<_&&(N|=4),V<I&&(I=V,R=2),(V=y-r)<-w&&(N|=8),V<I&&(I=V,R=3),0<N){for(var F=0,O=M=B=0;O<4;O++)if(0<(N&1<<O)){var P=3===(H=O)?0:H+1,D=this.cx[H]-this.cx[P],G=D*=b=1/Vector_length(D,L=this.cy[H]-this.cy[P]);B+=D=-(L*=b),M+=L=G,F++}if(1<F){var k=Vector_length(B,M);B/=k,M/=k}}else{var H,L,b;P=3===(H=R)?0:H+1,D=this.cx[H]-this.cx[P],G=D*=b=1/Vector_length(D,L=this.cy[H]-this.cy[P]);B=D=-(L*=b),M=L=G}var W=new CollisionPoint(i,this,B,M,o,s,I);t.collisionPoints.push(W)}},Button.prototype.clicked=function(t){var i=t.x;return i>=this.origin.x-this.dimension.x/2&&i<=this.origin.x+this.dimension.x/2&&t.y>=this.origin.y-this.dimension.y/2&&t.y<=this.origin.y+this.dimension.y/2},Button.prototype.down=function(t){var i=t.x;this.isDown=i>=this.origin.x-this.dimension.x/2&&i<=this.origin.x+this.dimension.x/2&&t.y>=this.origin.y-this.dimension.y/2&&t.y<=this.origin.y+this.dimension.y/2},Button.prototype.up=function(t){this.isDown=!1},Collision.prototype.merge=function(t){this.collisionPoints.addAll(t.collisionPoints)},Collision.prototype.apply=function(){var t=this.collisionPoints.length,i=[],n=[],e=0,o=0,s=Number.MAX_VALUE;do{0<o&&(s=o);for(var r=o=0;r<t;r++){var c=this.collisionPoints[r],a=c.collidingEntity.velocity,h=c.collidingEntity.angularVelocity,l=c.impactedEntity.velocity,y=c.impactedEntity.angularVelocity,d=c.collidingEntity.origin,u=c.contactPoint_x-d.x,g=c.contactPoint_y-d.y,m=c.impactedEntity.origin,x=c.contactPoint_x-m.x,f=c.contactPoint_y-m.y,p=c.getNormalMass(),T=-h*g,v=h*u;T-=-y*f,v-=y*x,T-=l.x,v-=l.y,T+=a.x,v+=a.y,0===e&&(i[r]=T*RESTITUTION,n[r]=v*RESTITUTION);var S=-(Vector_dot(i[r],n[r],c.normal_x,c.normal_y)+Vector_dot(T,v,c.normal_x,c.normal_y))*p,w=c.accumulatedImpulse;c.accumulatedImpulse=Math.max(c.accumulatedImpulse+S,0),S=c.accumulatedImpulse-w,o+=Math.abs(S);var _=c.normal_x*S,A=c.normal_y*S,E=c.collidingEntity.invertedMass(),C=_*E,B=A*E,M=c.collidingEntity.invertedInertia()*Vector_cross(u,g,_,A),V=c.impactedEntity.invertedMass(),I=_*V,N=A*V;I=-I,N=-N;var R=-c.impactedEntity.invertedInertia()*Vector_cross(x,f,_,A);c.addTempVelocities(C,B,M,I,N,R)}for(var F=0;F<t;F++)this.collisionPoints[F].applyTempVelocities();e++}while(1<t&&.001<o&&e<50&&o<=s)},CollisionPoint.prototype.getNormalMass=function(){var t=this.collidingEntity.origin,i=t.x-this.contactPoint_x,n=t.y-this.contactPoint_y,e=this.impactedEntity.origin,o=e.x-this.contactPoint_x,s=e.y-this.contactPoint_y,r=Vector_cross(i,n,this.normal_x,this.normal_y);r*=r;var c=Vector_cross(o,s,this.normal_x,this.normal_y);return c*=c,1/(this.collidingEntity.invertedMass()+this.impactedEntity.invertedMass()+r*this.collidingEntity.invertedInertia()+c*this.impactedEntity.invertedInertia())},CollisionPoint.prototype.addTempVelocities=function(t,i,n,e,o,s){this.nv1.x+=t,this.nv1.y+=i,this.nw1+=n,this.nv2.x+=e,this.nv2.y+=o,this.nw2+=s},CollisionPoint.prototype.applyTempVelocities=function(){this.collidingEntity.addVelocity(this.nv1),this.collidingEntity.addAngularVelocity(this.nw1),this.impactedEntity.addVelocity(this.nv2),this.impactedEntity.addAngularVelocity(this.nw2),this.nv1.clear(),this.nw1=0,this.nv2.clear(),this.nw2=0};var CANVAS_WIDTH=1,CANVAS_HEIGHT=1,TRANSFORM_X=0,TRANSFORM_Y=0,WIN_SCORE=2e3,RESTITUTION=.5,LATERAL_FRICTION=1.5,ROTATIONAL_FRICTION=7.5,GRAVITY=1.2,FONT="px Verdena, sans-serif",FONT_COLOR="#5f4808",FONT_ALIGN_CENTER="center",FONT_ALIGN_LEFT="left",FONT_ALIGN_RIGHT="right",BACKGROUND="#C2D1DD",OUTSIDE_BACKGROUND="#577B99",CHICKEN_WHITE="#fcf9de",COLORS=["#FD0006","#FD6367","#FD393E","#C30005","#990004","#FF7F00","#FFB163","#FF9B39","#C56200","#9B4D00","#00B64F","#4EC883","#2ABA69","#008C3D","#006E30","#FFC500","#FFDB63","#FFD239","#C59800","#9B7700"],LIGHT_COLORS=["#FDA7A9","#FEDCDD","#FEC3C4","#EA7F81","#CD5558","#FFD3A8","#FFEEDD","#FFE1C4","#ECB680","#CF9256","#7DBD99","#C5E4D2","#A1D2B6","#5BA97D","#3D9363","#FFEBA8","#FFF7DD","#FFF1C4","#ECD380","#CFB356"],currentScreen=null;function createGame(){var t=document.getElementById("c"),i=t.getContext("2d");resizeCanvas(t);var n=new State;return n.init(),{canvas:t,context:i,state:n,isRunning:!1,lastRunTimeStr:0,roundScore:0,score:0,multiplier:1,highScore:0}}function runGame(e){e.isRunning=!0;var o=10,s=0,r=0,c=0;window.requestAnimationFrame(function t(i){0===s&&(s=i),0===r&&(r=i);for(var n=i-r+c;o<n;)e.state.advance(o/1e3),n-=o;r=i,c=n,drawGame(e,!0,!1),e.state.chicken.origin.y<-.5&&endGame(e),e.isRunning&&window.requestAnimationFrame(t)})}function endGame(t){if(t.isRunning=!1,Number(t.state.runTimeStr)>Number(t.lastRunTimeStr)){t.roundScore=Math.round(10*t.multiplier*t.state.runTimeStr),t.score+=t.roundScore;var i=t.score>WIN_SCORE;if(i)(n=t.score>t.highScore)&&(t.highScore=t.score),currentScreen=new GameOverScreen(t,n,i);else currentScreen=new EndOfRoundScreen(t)}else{var n;(n=t.score>t.highScore)&&(t.highScore=t.score),currentScreen=new GameOverScreen(t,n,i)}currentScreen.draw()}function drawGame(i,t,n){i.context.resetTransform(),i.context.fillStyle=OUTSIDE_BACKGROUND,i.context.fillRect(0,0,i.canvas.width,i.canvas.height),setDrawTransform(i),i.context.fillStyle=BACKGROUND,i.context.fillRect(-CANVAS_WIDTH/2,-CANVAS_HEIGHT/2,CANVAS_WIDTH,CANVAS_HEIGHT);var e=n?LIGHT_COLORS:COLORS;t&&(drawLine(i,i.state.landingPoint,i.state.handle,e),i.state.bugs.forEach(function(t){drawBug(i,t,e)}),drawTextAlign(i,"score "+i.score,-.48,.445,.05,FONT_ALIGN_LEFT),drawTextAlign(i,"high score "+i.highScore,-.48,.405,.03,FONT_ALIGN_LEFT),drawTextAlign(i,"beat "+i.lastRunTimeStr+"s",.48,.445,.05,FONT_ALIGN_RIGHT),drawTextAlign(i,"multiplier "+i.multiplier+"x",.48,.405,.03,FONT_ALIGN_RIGHT),drawText(i,i.state.runTimeStr+"s",0,.26,.1),drawChicken(i,i.state.chicken,e)),i.context.fillStyle=OUTSIDE_BACKGROUND,i.context.fillRect(-1,-CANVAS_HEIGHT/2,2,-1),i.context.fillRect(-1,CANVAS_HEIGHT/2,2,1),i.context.fillRect(-CANVAS_WIDTH/2,-1,-1,2),i.context.fillRect(CANVAS_WIDTH/2,-1,1,2)}function drawLine(t,i,n,e){var o=t.context,s=new Vector(0,0),r=new Vector(i.cx[1],i.cy[1]),c=new Vector(i.cx[0],i.cy[0]),a=new Vector(s.x,s.y).subtract(r),h=a.length(),l=Math.asin(.01/h);a.normalize().rotate(l).scale(Math.sqrt(h*h-1e-4)).add(r);var y=new Vector(s.x,s.y).subtract(c),d=y.length(),u=Math.asin(.01/d);y.normalize().rotate(-u).scale(Math.sqrt(d*d-1e-4)).add(c);var g=(p=new Vector(n.x,n.y).subtract(r)).length(),m=Math.asin(.1/g);p.normalize().rotate(-m).scale(Math.sqrt(g*g-.1*.1)).add(r);var x=(T=new Vector(n.x,n.y).subtract(c)).length(),f=Math.asin(.1/x);T.normalize().rotate(f).scale(Math.sqrt(x*x-.1*.1)).add(c);var p;r=new Vector(i.cx[1],i.cy[1]),g=(p=new Vector(n.x,n.y).subtract(r)).length(),m=Math.asin(.1/g);p.normalize().rotate(-m).scale(Math.sqrt(g*g-.1*.1)).add(r);var T;c=new Vector(i.cx[0],i.cy[0]),x=(T=new Vector(n.x,n.y).subtract(c)).length(),f=Math.asin(.1/x);if(T.normalize().rotate(f).scale(Math.sqrt(x*x-.1*.1)).add(c),T.x<p.x){var v=T;T=p,p=v}if(y.x<a.x){v=y;y=a,a=v}o.fillStyle=CHICKEN_WHITE,o.beginPath(),o.arc(s.x,s.y,.01,0,2*Math.PI,!1),o.fill(),o.fillStyle=CHICKEN_WHITE,o.beginPath(),o.moveTo(a.x,a.y),o.lineTo(i.cx[1],i.cy[1]),o.lineTo(i.cx[0],i.cy[0]),o.lineTo(y.x,y.y),o.closePath(),o.fill(),o.fillStyle=LIGHT_COLORS[7],o.beginPath(),o.moveTo(i.cx[1],i.cy[1]),o.lineTo(p.x,p.y),o.lineTo(T.x,T.y),o.lineTo(i.cx[0],i.cy[0]),o.closePath(),o.fill(),o.fillStyle=CHICKEN_WHITE,o.beginPath(),o.arc(n.x,n.y,.1,0,2*Math.PI,!1),o.fill()}function drawBug(t,i,n){var e=t.context;e.fillStyle=n[2],e.beginPath(),e.moveTo(i.cx[0],i.cy[0]),e.lineTo(i.cx[1],i.cy[1]),e.lineTo(i.cx[2],i.cy[2]),e.lineTo(i.cx[3],i.cy[3]),e.closePath(),e.fill();var o=i.cx[0]+.5*(i.cx[1]-i.cx[0]),s=i.cy[0]+.5*(i.cy[1]-i.cy[0]),r=i.cx[2]+.5*(i.cx[3]-i.cx[2]),c=i.cy[2]+.5*(i.cy[3]-i.cy[2]);e.fillStyle=n[1],e.beginPath(),e.moveTo(o,s),e.lineTo(i.cx[1],i.cy[1]),e.lineTo(i.cx[2],i.cy[2]),e.lineTo(r,c),e.closePath(),e.fill();var a=.7*(o-i.origin.x),h=.7*(s-i.origin.y),l=i.origin.x+a,y=i.origin.y+h,d=i.cx[1]+.5*(i.cx[2]-i.cx[1]),u=i.cy[1]+.5*(i.cy[2]-i.cy[1]),g=i.cx[3]+.5*(i.cx[0]-i.cx[3]),m=i.cy[3]+.5*(i.cy[0]-i.cy[3]);e.fillStyle=n[3],e.beginPath(),e.moveTo(i.cx[0],i.cy[0]),e.lineTo(g+a,m+h),e.lineTo(d+a,u+h),e.lineTo(i.cx[1],i.cy[1]),e.closePath(),e.fill(),e.beginPath(),e.arc(l,y,i.dimension.x/2,i.angle-Math.PI,i.angle,!1),e.fill();var x=i.origin.x+.5*(i.cx[1]-i.origin.x),f=i.origin.y+.5*(i.cy[1]-i.origin.y),p=i.origin.x+.5*(i.cx[0]-i.origin.x),T=i.origin.y+.5*(i.cy[0]-i.origin.y),v=x+.14*(p-x),S=f+.14*(T-f),w=p+.14*(x-p),_=T+.14*(f-T);drawEyeWhite(t,i,v,S,.22*i.dimension.x),drawEyeWhite(t,i,w,_,.22*i.dimension.x),drawEyeRest(t,i,v,S,.22*i.dimension.x),drawEyeRest(t,i,w,_,.22*i.dimension.x)}function drawChicken(t,i,n){var e=t.context;e.fillStyle=n[6],e.beginPath(),e.moveTo(i.cx[0],i.cy[0]),e.lineTo(i.cx[1],i.cy[1]),e.lineTo(i.cx[2],i.cy[2]),e.lineTo(i.cx[3],i.cy[3]),e.closePath(),e.fill();var o=i.cx[0]+.5*(i.cx[3]-i.cx[0]),s=i.cy[0]+.5*(i.cy[3]-i.cy[0]),r=i.cx[1]+.5*(i.cx[2]-i.cx[1]),c=i.cy[1]+.5*(i.cy[2]-i.cy[1]),a=i.cx[2]+.5*(i.cx[3]-i.cx[2]),h=i.cy[2]+.5*(i.cy[3]-i.cy[2]);e.fillStyle=n[5],e.beginPath(),e.moveTo(o,s),e.lineTo(r,c),e.lineTo(a,h),e.closePath(),e.fill(),e.fillStyle=n[8],e.beginPath(),e.moveTo(o,s),e.lineTo(i.origin.x,i.origin.y),e.lineTo(a,h),e.closePath(),e.fill();var l=i.cx[0]+.5*(i.cx[1]-i.cx[0]),y=i.cy[0]+.5*(i.cy[1]-i.cy[0]),d=i.origin.x+1.4*(l-i.origin.x),u=i.origin.y+1.4*(y-i.origin.y);e.fillStyle=n[1],e.beginPath(),e.moveTo(i.cx[0],i.cy[0]),e.lineTo(i.cx[1],i.cy[1]),e.lineTo(d,u),e.closePath(),e.fill();var g=i.origin.x+.5*(i.cx[1]-i.origin.x),m=i.origin.y+.5*(i.cy[1]-i.origin.y),x=i.origin.x+.5*(i.cx[0]-i.origin.x),f=i.origin.y+.5*(i.cy[0]-i.origin.y),p=g+.14*(x-g),T=m+.14*(f-m),v=x+.14*(g-x),S=f+.14*(m-f);drawEyeWhite(t,i,p,T,.2*i.dimension.x),drawEyeWhite(t,i,v,S,.2*i.dimension.x),drawEyeRest(t,i,p,T,.2*i.dimension.x),drawEyeRest(t,i,v,S,.2*i.dimension.x)}function drawEyeWhite(t,i,n,e,o){var s=t.context,r=o;s.fillStyle=CHICKEN_WHITE,s.beginPath(),s.arc(n,e,r,0,2*Math.PI,!1),s.fill()}function drawEyeRest(t,i,n,e,o){var s=t.context,r=o;i.cx[2],i.cx[3],i.cx[2],i.cy[2],i.cy[3],i.cy[2];s.fillStyle=FONT_COLOR;var c=.6*r,a=new Vector(i.eyesDir.x,i.eyesDir.y);a.normalize().scale(.2*o),n+=a.x,e+=a.y,s.beginPath(),s.arc(n,e,c,0,2*Math.PI,!1),s.fill(),s.fillStyle=CHICKEN_WHITE;var h=.2*r;n+=.2*o,e+=.2*o,s.beginPath(),s.arc(n,e,h,0,2*Math.PI,!1),s.fill()}function drawButton(t,i){var n=i.origin.x-i.dimension.x/2,e=i.origin.y+i.dimension.y/2,o=i.isDown?.02:0;t.context.fillStyle=COLORS[8],t.context.beginPath(),t.context.moveTo(n,e),t.context.lineTo(n+i.dimension.x,e),t.context.lineTo(n+i.dimension.x,e-i.dimension.y),t.context.lineTo(n,e-i.dimension.y),t.context.closePath(),t.context.fill(),n+=o,e-=o,t.context.fillStyle=COLORS[9],t.context.beginPath(),t.context.moveTo(n,e),t.context.lineTo(n+i.dimension.x-.02,e),t.context.lineTo(n+i.dimension.x-.02,e-i.dimension.y),t.context.lineTo(n,e-i.dimension.y),t.context.closePath(),t.context.fill(),drawTextAlign_c(t,i.text,i.origin.x+o,i.origin.y-.22*i.dimension.y-o,.67*i.dimension.y,FONT_ALIGN_CENTER,CHICKEN_WHITE)}function drawText(t,i,n,e,o){drawTextAlign(t,i,n,e,o,FONT_ALIGN_CENTER)}function drawTextAlign(t,i,n,e,o,s){drawTextAlign_c(t,i,n,e,o,s,FONT_COLOR)}function drawTextAlign_c(t,i,n,e,o,s,r){t.context.setTransform(CANVAS_WIDTH/1.1,0,0,CANVAS_HEIGHT,t.canvas.width/2,t.canvas.height/2);var c=TRANSFORM_Y*o;t.context.fillStyle=r,t.context.font=c+FONT,t.context.textAlign=s,t.context.fillText(i,n*TRANSFORM_Y*1.1,-e*TRANSFORM_Y),setDrawTransform(t)}function setDrawTransform(t){t.context.setTransform(TRANSFORM_X,0,0,-TRANSFORM_Y,t.canvas.width/2,t.canvas.height/2)}function x(t,i){return(i-t.canvas.width/2)/TRANSFORM_X}function y(t,i){return-(i-t.canvas.height/2)/TRANSFORM_Y}function toClickVector(t,i){var n=t.canvas.getBoundingClientRect();return new Vector(x(t,i.clientX-n.left),y(t,i.clientY-n.top))}function resizeCanvas(t){var i=window.innerWidth,n=window.innerHeight;t.width!==i&&(t.width=i,t.height=n),TRANSFORM_Y=t.width>t.height?(TRANSFORM_X=t.height/CANVAS_HEIGHT*CANVAS_WIDTH,t.height):(TRANSFORM_X=t.width,t.width/CANVAS_WIDTH*CANVAS_HEIGHT)}function resizeCanvasInGame(t){resizeCanvas(t.canvas),t.isRunning||currentScreen.draw()}function SplashScreen(t){this.game=t,this.startButton=new Button(this.game,"Start"),this.startButton.origin.y=-.25}function GamePlayScreen(t){this.game=t,this.before=0}function EndOfRoundScreen(t){this.dy=.15,this.game=t,this.newMultiplier=this.game.multiplier+1,this.resetButton=new Button(this.game,"1x Reset"),this.resetButton.origin.x=-.22,this.resetButton.origin.y=-.25,this.riskButton=new Button(this.game,this.newMultiplier+"x Risk"),this.riskButton.origin.x=.22,this.riskButton.origin.y=-.25}function GameOverScreen(t,i,n){this.dy=.15,this.game=t,this.headline=n?"Chicken Dinner!":"Game Over",this.subline=i?"new highscore ":"final score ",this.startButton=new Button(this.game,"Start"),this.startButton.origin.y=-.25}function restartGame(t){var i=new State;return i.init(),t.state=i,runGame(t),new GamePlayScreen(t)}function State(){this.chicken=null,this.landingPoint=null,this.handle=null,this.startTimeMs=0,this.runTimeSecs=0,this.lastJumpTimeMs=0,this.nextBugTimeSecs=Math.random()+1.5,this.runTimeStr="0.0",this.bugs=[],this.nextBodyId=0}function outOfBounds(t){var i=t.dimension.x,n=t.dimension.y;return t.origin.x+i<-CANVAS_WIDTH/2||t.origin.x-i>CANVAS_WIDTH/2||t.origin.y+n<-CANVAS_HEIGHT/2}function UnionFindNode(t){this.id=t,this.rank=0,this.parent=this}function UnionFind(){this.nodes=[]}function Vector(t,i){this.x=t,this.y=i}function Vector_cross(t,i,n,e){return t*e-i*n}function Vector_dot(t,i,n,e){return t*n+i*e}function Vector_length(t,i){return Math.sqrt(t*t+i*i)}window.onload=function(){var n=createGame();currentScreen=new SplashScreen(n),window.addEventListener("resize",function(t){resizeCanvasInGame(n)}),n.canvas.addEventListener("click",function(t){currentScreen=currentScreen.onClick(toClickVector(n,t)),n.isRunning||currentScreen.draw()}),n.canvas.addEventListener("mousedown",function(t){currentScreen.onMouseDown(toClickVector(n,t)),n.isRunning||currentScreen.draw()}),n.canvas.addEventListener("touchstart",function(t){var i=t.touches[0];currentScreen.onMouseDown(toClickVector(n,i)),n.isRunning||currentScreen.draw()}),n.canvas.addEventListener("mouseup",function(t){currentScreen.onMouseUp(toClickVector(n,t)),n.isRunning||currentScreen.draw()}),n.canvas.addEventListener("touchend",function(t){var i=t.touches[0];currentScreen.onMouseUp(toClickVector(n,i)),n.isRunning||currentScreen.draw()}),n.canvas.addEventListener("mousemove",function(t){currentScreen.onMouseMove(toClickVector(n,t))}),n.canvas.addEventListener("touchmove",function(t){t.preventDefault();var i=t.touches[0];currentScreen.onMouseMove(toClickVector(n,i))}),currentScreen.draw()},SplashScreen.prototype.draw=function(){var t=new Body(this).setOrigin(-.3,.15).setDimension(.2,.2).setAngle(.6*Math.random()-.3).finalize();drawGame(this.game,!1,!1),drawChicken(this.game,t,COLORS),drawTextAlign(this.game,"Chicken",-.14,.16,.13,FONT_ALIGN_LEFT),drawTextAlign(this.game,"On A Line",-.14,.05,.13,FONT_ALIGN_LEFT),drawText(this.game,"swipe to balance, click to jump, "+WIN_SCORE+" points to win",0,-.14,.035),drawButton(this.game,this.startButton)},SplashScreen.prototype.onClick=function(t){return this.startButton.clicked(t)?(runGame(this.game),new GamePlayScreen(this.game)):this},SplashScreen.prototype.onMouseDown=function(t){this.startButton.down(t)},SplashScreen.prototype.onMouseUp=function(t){this.startButton.up(t)},SplashScreen.prototype.onMouseMove=function(t){},GamePlayScreen.prototype.draw=function(){drawGame(this.game,!0,!1)},GamePlayScreen.prototype.onClick=function(t){return this},GamePlayScreen.prototype.onMouseMove=function(t){return-.25<t.y&&(t.y=-.25),this.game.state.handle.set(t),this},GamePlayScreen.prototype.onMouseDown=function(t){this.before=Date.now()},GamePlayScreen.prototype.onMouseUp=function(t){var i=(Date.now()-this.before)/1e3;this.game.state.jump(i)},EndOfRoundScreen.prototype.draw=function(){drawGame(this.game,!0,!0),drawText(this.game,"Good Round",0,this.dy-.08,.14),drawText(this.game,"round's score "+this.game.roundScore,0,this.dy-.15,.05),drawButton(this.game,this.resetButton),drawButton(this.game,this.riskButton),drawText(this.game,"Beat "+this.game.state.runTimeStr+"s or game over",.22,-.34,.03)},EndOfRoundScreen.prototype.onClick=function(t){return this.resetButton.clicked(t)?(this.game.multiplier=1,this.game.lastRunTimeStr="0.0",restartGame(this.game)):this.riskButton.clicked(t)?(this.game.multiplier=this.game.multiplier+1,this.game.lastRunTimeStr=this.game.state.runTimeStr,restartGame(this.game)):this},EndOfRoundScreen.prototype.onMouseDown=function(t){this.resetButton.down(t),this.riskButton.down(t)},EndOfRoundScreen.prototype.onMouseUp=function(t){this.resetButton.up(t),this.riskButton.up(t)},EndOfRoundScreen.prototype.onMouseMove=function(t){},GameOverScreen.prototype.draw=function(){drawGame(this.game,!0,!0),drawText(this.game,this.headline,0,this.dy-.08,.14),drawText(this.game,this.subline+this.game.score,0,this.dy-.15,.05),drawButton(this.game,this.startButton)},GameOverScreen.prototype.onClick=function(t){return this.startButton.clicked(t)?(this.game.lastRunTimeStr="0.0",this.game.roundScore=0,this.game.score=0,this.game.multiplier=1,restartGame(this.game)):this},GameOverScreen.prototype.onMouseDown=function(t){this.startButton.down(t)},GameOverScreen.prototype.onMouseUp=function(t){this.startButton.up(t)},GameOverScreen.prototype.onMouseMove=function(t){},State.prototype.init=function(){this.chicken=new Body(this).setOrigin(.004*Math.random()-.002,.55).setDimension(.15,.15).setMass(1).setGravity(GRAVITY).finalize(),this.landingPoint=new Body(this).setOrigin(0,-.1).setDimension(.07,.03).setMass(2).setTargetAngle(0).finalize(),this.handle=new Vector(0,-.3),this.startTimeMs=Date.now()},State.prototype.jump=function(t){var i=1.6*this.chicken.origin.distanceFrom(this.landingPoint.origin),n=Date.now();if(i<this.chicken.dimension.y+this.landingPoint.dimension.y&&200<n-this.lastJumpTimeMs){var e=6*Math.min(.3,Math.max(.2,t));this.chicken.velocity.y+=e,this.lastJumpTimeMs=n}},State.prototype.addBug=function(){var t=Math.random()<.5?-.55:.55,i=.4*Math.random()-.2,n=new Vector(t,i),e=new Vector(this.chicken.origin.x,this.chicken.origin.y).subtract(n).normalize().scale(.4),o=new Body(this).setOrigin(t,i).setDimension(.1,.1).setMass(.5).setVelocity(e.x,e.y).setAngularVelocity(4*Math.random()+2).setGravity(GRAVITY/4).finalize();this.bugs.push(o),this.nextBugTimeSecs=this.runTimeSecs+(Math.random()+1.5)},State.prototype.advance=function(i){var t=new Vector(this.handle.x,this.handle.y).scale(.25);this.landingPoint.setTarget(t.x,t.y);var n=this.collide(i);this.chicken.applyForces(i),this.landingPoint.applyForces(i),n.forEach(function(t){t.apply()}),this.chicken.advance(i),this.landingPoint.advance(i),this.bugs.forEach(function(t){t.advance(i)}),this.nextBugTimeSecs<this.runTimeSecs&&this.addBug(),this.bugs=this.bugs.filter(function(t){return!outOfBounds(t)}),this.chicken.eyesDir.set(this.handle).subtract(this.chicken.origin);var e=this.chicken;this.bugs.forEach(function(t){t.eyesDir.set(e.origin)}),this.runTimeSecs+=i,this.runTimeStr=this.runTimeSecs.toFixed(1)},State.prototype.collide=function(i){var n=[],e=Body_collide(this,this.chicken,this.landingPoint,i);null!==e&&n.push(e);var o=this,s=this.chicken;return this.bugs.forEach(function(t){null!==(e=Body_collide(o,s,t,i))&&n.push(e)}),Collision_mergeCollisions(n)},UnionFind.prototype.findNode=function(t){if(void 0===this.nodes[t])return this.nodes[t]=new UnionFindNode(t),this.nodes[t];for(var i=this.nodes[t];i.id!==i.parent.id;)i=i.parent;return i},UnionFind.prototype.find=function(t){return this.findNode(t).id},UnionFind.prototype.union=function(t,i){var n=this.findNode(t),e=this.findNode(i);n.id!==e.id&&(n.rank<e.rank?n.parent=e:n.rank>e.rank?e.parent=n:(e.parent=n).rank++)},Array.prototype.addAll=function(t){for(var i=t.length,n=0;n<i;n++)this.push(t[n])},Vector.prototype.set=function(t){return this.x=t.x,this.y=t.y,this},Vector.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},Vector.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},Vector.prototype.scale=function(t){return this.x*=t,this.y*=t,this},Vector.prototype.rotate=function(t){var i=Math.cos(t),n=Math.sin(t),e=this.x*i-this.y*n,o=this.x*n+this.y*i;return this.x=e,this.y=o,this},Vector.prototype.normalize=function(){var t=this.length();return 0<t&&1!==t&&this.scale(1/t),this},Vector.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Vector.prototype.clear=function(){this.x=0,this.y=0},Vector.prototype.toString=function(){return this.x+", "+this.y},Vector.prototype.distanceFrom=function(t){return Vector_length(this.x-t.x,this.y-t.y)};