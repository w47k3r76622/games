var x=Object.defineProperty;var R=(b,t,i)=>t in b?x(b,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):b[t]=i;var o=(b,t,i)=>R(b,typeof t!="symbol"?t+"":t,i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&e(n)}).observe(document,{childList:!0,subtree:!0});function i(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function e(s){if(s.ep)return;s.ep=!0;const a=i(s);fetch(s.href,a)}})();class V{constructor(t,i,e){o(this,"entity");o(this,"app");o(this,"game");o(this,"isMove",!0);o(this,"speed",4);o(this,"startPos",new pc.Vec3);o(this,"endPos",new pc.Vec3);o(this,"pos",new pc.Vec3);o(this,"dir",new pc.Vec3);o(this,"vel",new pc.Vec3);o(this,"pauseTimer",0);this.entity=t,this.app=i,this.game=e,this.startPos.copy(t.getPosition()),this.dir.copy(pc.Vec3.DOWN),this.entity.tags.has("enemy_x")&&this.dir.copy(pc.Vec3.RIGHT),this.entity.tags.has("enemy_z")&&this.dir.copy(pc.Vec3.BACK);let s=new pc.Ray(t.getPosition(),this.dir),a=new pc.Vec3;e.level.rayCast(s,a)&&(this.dir.mulScalar(.5),a.sub(this.dir),this.endPos.copy(a))}update(t){if(this.pauseTimer>0){this.pauseTimer-=t;return}if(this.pos=this.entity.getPosition(),this.moveVecTowards(this.pos,this.endPos,t*this.speed),this.entity.setPosition(this.pos),this.pos.equals(this.endPos)){let i=this.startPos;this.startPos=this.endPos,this.endPos=i,this.pauseTimer=.3}}move(t,i){}moveVecTowards(t,i,e){let s=i.x-t.x,a=i.y-t.y,n=i.z-t.z,d=s*s+a*a+n*n;if(d==0||e>=0&&d<=e*e){t.copy(i);return}let r=Math.sqrt(d);t.x+=s/r*e,t.y+=a/r*e,t.z+=n/r*e}}var v=console.log;class k{constructor(t,i){o(this,"app");o(this,"g");o(this,"player");o(this,"levelEntity");o(this,"blockList");o(this,"aabbList",[]);o(this,"coinList",[]);o(this,"trapList",[]);o(this,"blockMat");o(this,"blockMatA");o(this,"playerMat");o(this,"coinMat");o(this,"enemyMat");o(this,"enemyMat2");o(this,"trapMat");o(this,"blackMat");o(this,"point",new pc.Vec3);o(this,"blockTexture");o(this,"vrTexture");o(this,"resetBtnTexture");o(this,"titleTexture");o(this,"batchGroupBlocks");o(this,"batchGroupCoins");o(this,"batchGroupTraps");o(this,"shortName",{Block:"b",Enemy1:"e1",Enemy2:"e2",Enemy3:"e3",Player:"p",Coin:"c",Trap:"t",b:"Block",e1:"Enemy1",e2:"Enemy2",e3:"Enemy3",p:"Player",c:"Coin",t:"Trap"});o(this,"levelsAsset",{Level1:"p,-6.5,8,-7.5:e1,7.5,8,0.5:e1,-5.5,8,7.5:e1,-7.5,8,-4.5:e3,-7.5,4,-1.5:c,-6.5,1,-7.5:c,0.5,5,-7.5:c,-3.5,5,-7.5:c,3.5,1,-7.5:c,2.5,8,-7.5:c,0.5,8,-7.5:c,7.5,8,-6.5:c,7.5,8,-3.5:c,7.5,8,2.5:c,7.5,6,-2.5:c,4.5,8,7.5:c,0.5,5,7.5:c,-6.5,8,7.5:c,-1.5,1,7.5:c,-6.5,1,7.5:c,0.5,3,7.5:c,6.5,1,7.5:c,-7.5,1,4.5:c,-7.5,5,4.5:c,-7.5,6,-1.5:c,-7.5,7,5:c,-7.5,5,-6.5:c,-7.5,1,-6.5:c,-7.5,6,-3.5:c,-7.5,2,-1.5:c,7.5,8,6.5:c,7.5,1,6.5:c,7.5,1,-0.5:c,7.5,3,2.5:c,6.5,8,-7.5:c,-0.5,1,-7.5:b,-7.5,0,-7.5:b,-7.5,1,-7.5:b,7.5,1,-8.5:b,7.5,2,-8.5:b,7.5,3,-8.5:b,7.5,0,-8.5:b,8.5,1,-7.5:b,8.5,2,-7.5:b,8.5,0,-7.5:b,-7.5,2,-7.5:b,-7.5,3,-7.5:b,7.5,3,-7.5:b,-7.5,4,-7.5:b,-7.5,7,-7.5:b,7.5,4,-7.5:b,7.5,7,-7.5:b,-7.5,5,-7.5:b,-7.5,8,-7.5:b,7.5,5,-7.5:b,7.5,8,-7.5:b,7.5,0,-7.5:b,0.5,0,-7.5:b,7.5,6,-7.5:b,7.5,9,-7.5:b,-7.5,6,-7.5:b,-7.5,9,-7.5:b,0.5,9,-7.5:b,-0.5,9,-7.5:b,-0.5,0,-7.5:b,-1.5,9,-7.5:b,6.5,9,-7.5:b,-1.5,0,-7.5:b,6.5,0,-7.5:b,-3.5,9,-7.5:b,4.5,9,-7.5:b,-3.5,0,-7.5:b,4.5,0,-7.5:b,4.5,1,-7.5:b,4.5,2,-7.5:b,4.5,3,-7.5:b,-4.5,9,-7.5:b,3.5,9,-7.5:b,1.5,8,-7.5:b,1.5,7,-7.5:b,1.5,6,-7.5:b,1.5,5,-7.5:b,1.5,4,-7.5:b,0.5,4,-7.5:b,-0.5,4,-7.5:b,-1.5,4,-7.5:b,-1.5,1,-7.5:b,-2.5,4,-7.5:b,-3.5,4,-7.5:b,-2.5,7,-7.5:b,-2.5,8,-7.5:b,-4.5,0,-7.5:b,3.5,0,-7.5:b,-5.5,9,-7.5:b,2.5,9,-7.5:b,-5.5,0,-7.5:b,2.5,0,-7.5:b,-6.5,9,-7.5:b,1.5,9,-7.5:b,-6.5,0,-7.5:b,1.5,0,-7.5:b,-2.5,9,-7.5:b,5.5,9,-7.5:b,-2.5,0,-7.5:b,5.5,0,-7.5:b,7.5,0,-6.5:b,7.5,0,-1.5:b,7.5,0,-1.5:b,7.5,0,3.5:b,7.5,2,3.5:b,7.5,1,0.5:b,7.5,2,0.5:b,7.5,3,0.5:b,7.5,2,4.5:b,7.5,4,3.5:b,7.5,0,-5.5:b,7.5,0,-0.5:b,7.5,0,4.5:b,7.5,0,-4.5:b,7.5,0,0.5:b,7.5,0,5.5:b,7.5,0,-3.5:b,7.5,0,1.5:b,7.5,0,6.5:b,7.5,0,-2.5:b,7.5,0,2.5:b,7.5,9,-6.5:b,7.5,9,-1.5:b,7.5,9,3.5:b,7.5,8,3.5:b,7.5,7,3.5:b,7.5,6,3.5:b,7.5,9,-5.5:b,7.5,9,-0.5:b,7.5,9,4.5:b,7.5,9,-4.5:b,7.5,9,0.5:b,7.5,9,5.5:b,7.5,9,-3.5:b,7.5,9,1.5:b,7.5,9,6.5:b,7.5,9,-2.5:b,7.5,8,-2.5:b,7.5,7.02117395401001,-2.5:b,7.5,4,1.5:b,7.5,4,0.5:b,7.5,4,-0.5:b,7.5,4,-1.5:b,7.5,3,-5.5:b,7.5,3,-4.5:b,7.5,3,-3.5:b,7.5,3,-6.5:b,7.5,1,7.5:b,7.5,4,2.5:b,7.5,9,2.5:b,-7.5,0,-6.5:b,-7.5,0,-1.5:b,-7.5,0,3.5:b,-7.5,0,-5.5:b,-7.5,0,-0.5:b,-7.5,0,4.5:b,-7.5,0,-4.5:b,-7.5,0,0.5:b,-7.5,0,5.5:b,-7.5,0,-3.5:b,-7.5,0,1.5:b,-7.5,0,6.5:b,-7.5,0,-2.5:b,-7.5,0,2.5:b,-7.5,9,-6.5:b,-7.5,9,-1.5:b,-7.5,9,3.5:b,-7.5,9,-5.5:b,-7.5,9,-0.5:b,-7.5,9,4.5:b,-7.5,9,-4.5:b,-7.5,9,0.5:b,-7.5,9,5.5:b,-7.5,9,-3.5:b,-7.5,9,1.5:b,-7.5,8,-2.5:b,-7.5,7,-2.5:b,-7.5,6,-2.5:b,-7.5,5,-2.5:b,-7.5,4,-2.5:b,-7.5,4,-3.5:b,-7.5,4,-4.5:b,-7.5,1,-1.5:b,-7.5,1,-4.5:b,-7.5,4,2.5:b,-7.5,3,2.5:b,-7.5,5,2.5:b,-7.5,6,2.5:b,-7.5,6,3.5:b,-7.5,6,4.5:b,-7.5,9,6.5:b,-7.5,9,-2.5:b,-7.5,9,2.5:b,-7.5,0,7.5:b,-7.5,1,7.5:b,8.5,5,8.5:b,8.5,4,8.5:b,8.5,3,8.5:b,8.5,4,7.5:b,8.5,3,7.5:b,8.5,2,7.5:b,7.5,4,8.5:b,7.5,3,8.5:b,7.5,2,8.5:b,8.5,5,7.5:b,7.5,5,8.5:b,-7.5,2,7.5:b,7.5,2,7.5:b,-7.5,3,7.5:b,-7.5,5,7.5:b,-6.5,3,7.5:b,-5.5,3,7.5:b,3.5,3,7.5:b,3.5,2,7.5:b,3.5,4,7.5:b,3.5,5,7.5:b,4.5,5,7.5:b,-7.5,7,7.5:b,7.5,7,7.5:b,-8.5,5,7.5:b,-8.5,4,7.5:b,-8.5,3,7.5:b,-7.5,4,8.5:b,-7.5,3,8.5:b,-7.5,5,8.5:b,-7.5,8,7.5:b,7.5,5,7.5:b,7.5,3,7.5:b,7.5,5,6.5:b,7.5,8,7.5:b,7.5,0,7.5:b,0.5,0,7.5:b,7.5,6,7.5:b,7.5,9,7.5:b,-7.5,6,7.5:b,-7.5,6,6.5:b,-7.5,6,5.5:b,-7.5,9,7.5:b,0.5,9,7.5:b,-0.5,9,7.5:b,-0.5,0,7.5:b,-1.5,9,7.5:b,6.5,9,7.5:b,-1.5,0,7.5:b,6.5,0,7.5:b,-3.5,9,7.5:b,4.5,9,7.5:b,-3.5,0,7.5:b,4.5,0,7.5:b,-4.5,9,7.5:b,3.5,9,7.5:b,-4.5,0,7.5:b,3.5,0,7.5:b,-5.5,9,7.5:b,2.5,9,7.5:b,-5.5,0,7.5:b,2.5,0,7.5:b,-6.5,9,7.5:b,1.5,9,7.5:b,0.5,8,7.5:b,0.5,7,7.5:b,0.5,4,7.5:b,-0.5,4,7.5:b,-0.5,3,7.5:b,-0.5,1,7.5:b,-0.5,2,7.5:b,1.5,2,7.5:b,2.5,2,7.5:b,1.5,4,7.5:b,-6.5,0,7.5:b,1.5,0,7.5:b,-2.5,9,7.5:b,5.5,9,7.5:b,-2.5,0,7.5:b,5.5,0,7.5:e2,2.5,5,-7.5:e2,1.5,7,7.5:e2,-4.5,3,7.5:t,7.5,4,-5,0,0,0:t,7.5,5,-0.5,0,0,0:t,7.5,5,1.5,0,0,0:t,3,1,7.5,0,0,0:t,-7.5,7,2.5,0,0,0:t,-0.5,5,-7.5,0,0,0:",Level2:"p,-5.5,6,-7.5:e1,7.5,8,-5:e1,-7.5,7,0:e3,-7.5,2,3.5:e3,7.5,2,-1.5:c,-2.5,1,-7.5:c,6.5,8,-7.5:c,1.5,8,-7.5:c,-1.5,8,-7.5:c,-6.5,8,-7.5:c,-7.5,8,-6.5:c,-7.5,8,1:c,-7.5,4,-1.5:c,-7.5,1,-6.5:c,-7.5,1,-3.5:c,-7.5,3,3.5:c,-7.5,4,1.5:c,-7.5,8,6.5:c,-6.5,8,7.5:c,-3.5,8,7.5:c,1.5,4,7.5:c,3.5,5,7.5:c,5,1,7.5:c,6.5,8,7.5:c,7.5,8,6.5:c,7.5,6,3.5:c,7.5,8,3.5:c,7.5,1,6.5:c,7.5,1,2.5:c,7.5,8,-3.5:c,7.5,3,-1.5:c,7.5,5,-6.5:c,-6.5,1,7.5:c,-1.5,8,7.5:c,6.5,5,-7.5:c,4.5,1,-7.5:b,-7.5,0,-7.5:b,-7.5,1,-7.5:b,7.5,1,-8.5:b,7.5,0,-8.5:b,8.5,1,-7.5:b,8.5,0,-7.5:b,-7.5,2,-7.5:b,7.5,2,-7.5:b,-7.5,3,-7.5:b,7.5,3,-7.5:b,-7.5,4,-7.5:b,-7.5,7,-7.5:b,7.5,4,-7.5:b,7.5,7,-7.5:b,-7.5,5,-7.5:b,-7.5,8,-7.5:b,7.5,5,-7.5:b,7.5,4,-6.5:b,6.5,4,-7.5:b,5.5,4,-7.5:b,7.5,8,-7.5:b,7.5,0,-7.5:b,0.5,0,-7.5:b,7.5,6,-7.5:b,7.5,9,-7.5:b,-7.5,6,-7.5:b,-7.5,9,-7.5:b,0.5,9,-7.5:b,-0.5,9,-7.5:b,-0.5,8,-7.5:b,-0.5,6,-7.5:b,-6.5,6,-7.5:b,0.5,6,-7.5:b,1.5,6,-7.5:b,1.5,5,-7.5:b,1.5,4,-7.5:b,1.5,3,-7.5:b,0.5,3,-7.5:b,-0.5,3,-7.5:b,-1.5,3,-7.5:b,-0.5,5,-7.5:b,-1.5,5,-7.5:b,-1.5,4,-7.5:b,-0.5,0,-7.5:b,-1.5,9,-7.5:b,6.5,9,-7.5:b,-1.5,0,-7.5:b,6.5,0,-7.5:b,-3.5,9,-7.5:b,4.5,9,-7.5:b,-3.5,0,-7.5:b,4.5,0,-7.5:b,-4.5,9,-7.5:b,3.5,9,-7.5:b,-4.5,0,-7.5:b,3.5,0,-7.5:b,-5.5,9,-7.5:b,2.5,9,-7.5:b,-5.5,0,-7.5:b,2.5,0,-7.5:b,-6.5,9,-7.5:b,1.5,9,-7.5:b,-6.5,0,-7.5:b,1.5,0,-7.5:b,1.5,1,-7.5:b,-2.5,9,-7.5:b,5.5,9,-7.5:b,-2.5,0,-7.5:b,5.5,0,-7.5:b,7.5,0,-6.5:b,7.5,0,-1.5:b,7.5,0,-1.5:b,7.5,0,3.5:b,7.5,1,3.5:b,7.5,2,3.5:b,7.5,3,3.5:b,7.5,4,3.5:b,7.5,0,-5.5:b,7.5,0,-0.5:b,7.5,0,4.5:b,7.5,0,-4.5:b,7.5,0,0.5:b,7.5,0,5.5:b,7.5,0,-3.5:b,7.5,0,1.5:b,7.5,0,6.5:b,7.5,0,-2.5:b,7.5,0,2.5:b,7.5,9,-6.5:b,7.5,9,-1.5:b,7.5,9,3.5:b,7.5,8,2.5:b,7.5,5,3.5:b,7.5,5,4.5:b,7.5,9,-5.5:b,7.5,9,-0.5:b,7.5,9,4.5:b,7.5,9,-4.5:b,7.5,9,0.5:b,7.5,9,5.5:b,7.5,9,-3.5:b,7.5,9,1.5:b,7.5,9,6.5:b,7.5,9,-2.5:b,7.5,8,-2.5:b,7.5,7,-2.5:b,7.5,4,-2.5:b,7.5,3,-2.5:b,7.5,2,-2.5:b,7.5,1,-2.5:b,7.5,4,-1.5:b,7.5,4,-0.5:b,7.5,5,-0.5:b,7.5,9,2.5:b,-7.5,0,-6.5:b,-7.5,0,-1.5:b,-7.5,0,3.5:b,-7.5,0,-5.5:b,-7.5,0,-0.5:b,-7.5,0,4.5:b,-7.5,0,-4.5:b,-7.5,0,0.5:b,-7.5,0,5.5:b,-7.5,0,-3.5:b,-7.5,0,1.5:b,-7.5,0,6.5:b,-7.5,0,-2.5:b,-7.5,0,2.5:b,-7.5,9,-6.5:b,-7.5,9,-1.5:b,-7.5,9,3.5:b,-7.5,9,-5.5:b,-7.5,9,-0.5:b,-7.5,8,0:b,-7.5,9,4.5:b,-7.5,9,-4.5:b,-7.5,9,0.5:b,-7.5,9,5.5:b,-7.5,9,-3.5:b,-7.5,9,1.5:b,-7.5,3,2.5:b,-7.5,2,2.5:b,-7.5,1,2.5:b,-7.5,1,-2.5:b,-7.5,2,-2.5:b,-7.5,3,-2.5:b,-7.5,3,-1.5:b,-7.5,3,-0.5:b,-7.5,3,0.5:b,-7.5,3,1.5:b,-7.5,9,6.5:b,-7.5,9,-2.5:b,-7.5,9,2.5:b,-7.5,0,7.5:b,-7.5,1,7.5:b,8.5,4,8.5:b,8.5,5,8.5:b,8.5,3,8.5:b,8.5,2,8.5:b,8.5,3,7.5:b,8.5,2,7.5:b,7.5,3,8.5:b,7.5,2,8.5:b,8.5,4,7.5:b,8.5,5,7.5:b,7.5,4,8.5:b,7.5,5,8.5:b,-7.5,2,7.5:b,7.5,1,7.5:b,6.5,1,7.5:b,6.5,2,7.5:b,-7.5,3,7.5:b,7.5,2,7.5:b,-7.5,4,7.5:b,-1.5,1,7.5:b,-2.5,1,7.5:b,-7.5,7,7.5:b,7.5,7,7.5:b,-8.5,5,7.5:b,-7.5,5,8.5:b,-7.5,6,8.5:b,-7.5,4,8.5:b,-7.5,8,7.5:b,7.5,5,7.5:b,7.5,8,7.5:b,7.5,0,7.5:b,0.5,0,7.5:b,7.5,6,7.5:b,7.5,9,7.5:b,-7.5,6,7.5:b,-8.5,6,7.5:b,-8.5,4,7.5:b,-7.5,9,7.5:b,0.5,9,7.5:b,-0.5,9,7.5:b,-0.5,0,7.5:b,-1.5,9,7.5:b,-2.5,8,7.5:b,-2.5,7,7.5:b,-2.5,6,7.5:b,-2.5,5,7.5:b,-2.5,4,7.5:b,-3.5,4,7.5:b,6.5,9,7.5:b,-1.5,0,7.5:b,6.5,0,7.5:b,-3.5,9,7.5:b,4.5,9,7.5:b,-3.5,0,7.5:b,4.5,0,7.5:b,-4.5,9,7.5:b,3.5,9,7.5:b,-4.5,0,7.5:b,3.5,0,7.5:b,-5.5,9,7.5:b,2.5,9,7.5:b,2.5,8,7.5:b,2.5,7,7.5:b,2.5,6,7.5:b,2.5,5,7.5:b,2.5,4,7.5:b,3.5,4,7.5:b,-5.5,0,7.5:b,2.5,0,7.5:b,-6.5,9,7.5:b,1.5,9,7.5:b,-6.5,0,7.5:b,1.5,0,7.5:b,-2.5,9,7.5:b,5.5,9,7.5:b,-2.5,0,7.5:b,5.5,0,7.5:e2,-1.5,4,7.5:e2,-6.5,6,7.5:e2,3.5,6.5,7.5:e2,-6.5,4,-7.5:e2,2.5,4,-7.5:t,1.5,2,-7.5,0,0,0:t,3.5,1,7.5,0,0,0:t,-7.5,8,-5,180,0,0:t,7.5,4.5,2.5,-89.99999999999999,0,0:",Level3:"p,-6.5,8,-7.5:e1,1.5,8,-7.5:e1,-4.5,4,7.5:e1,7.5,8,0:e1,7.5,8,5.5:e2,-6.5,7,7.5:e2,1.5,4,7.5:e3,-7.5,1,-1.5:e3,-7.5,8,-0.5:t,-1.5,1,-7.5,0,0,0:t,-2.5,8,7.5,180,0,0:t,7.5,1,-4.5,0,0,0:t,-7.5,5,-6.5,89.99999999999999,0,0:t,-0.5,2,7.5,0,0,89.99999999999999:c,-2.5,5,-7.5:c,-6.5,6,7.5:c,-6.5,8,7.5:c,0.5,8,7.5:c,-0.5,5,-7.5:c,4.5,3,-7.5:c,4.5,1,-7.5:c,-0.5,8,-7.5:c,4.5,8,-7.5:c,-6.5,7,-7.5:c,6.5,5,7.5:c,0.5,5,7.5:c,6.5,8,7.5:c,7.5,1.5,2.5:c,7.5,5,-2.5:c,7.5,5,3.5:c,7.5,5,-6.5:c,7.5,8,-6.5:c,7.5,5,6.5:c,7.5,8,6.5:c,-7.5,4,2.5:c,-7.5,1,-3.5:c,-7.5,1,2.5:c,-7.5,1,-1.5:c,-7.5,1,-6.5:c,-7.5,8,-2.5:c,-7.5,8,-6:c,-7.5,7,6.5:c,7.5,1,4.5:c,1.5,1,7.5:c,-6.5,1,7.5:b,-7.5,0,-7.5:b,-7.5,1,-7.5:b,7.5,1,-8.5:b,7.5,2,-8.5:b,7.5,0,-8.5:b,8.5,1,-7.5:b,8.5,0,-7.5:b,-7.5,2,-7.5:b,8.5,2,-7.5:b,8.5,3,-7.5:b,7.5,3,-8.5:b,-7.5,3,-7.5:b,7.5,3,-7.5:b,-7.5,4,-7.5:b,-7.5,7,-7.5:b,7.5,4,-7.5:b,7.5,7,-7.5:b,-7.5,5,-7.5:b,-7.5,8,-7.5:b,7.5,5,-7.5:b,7.5,8,-7.5:b,7.5,0,-7.5:b,0.5,0,-7.5:b,7.5,6,-7.5:b,7.5,9,-7.5:b,-7.5,6,-7.5:b,-7.5,9,-7.5:b,0.5,9,-7.5:b,-0.5,9,-7.5:b,-0.5,0,-7.5:b,-1.5,9,-7.5:b,6.5,9,-7.5:b,-1.5,0,-7.5:b,6.5,0,-7.5:b,-3.5,9,-7.5:b,4.5,9,-7.5:b,-3.5,0,-7.5:b,4.5,0,-7.5:b,-4.5,9,-7.5:b,3.5,9,-7.5:b,-4.5,0,-7.5:b,3.5,0,-7.5:b,-5.5,9,-7.5:b,2.5,9,-7.5:b,-5.5,0,-7.5:b,2.5,0,-7.5:b,3.5,1,-7.5:b,3.5,2,-7.5:b,3.5,3,-7.5:b,3.5,4,-7.5:b,4.5,4,-7.5:b,4.5,5,-7.5:b,4.5,6,-7.5:b,-6.5,9,-7.5:b,1.5,9,-7.5:b,-6.5,0,-7.5:b,1.5,0,-7.5:b,-2.5,9,-7.5:b,-1.5,8,-7.5:b,-1.5,7,-7.5:b,-1.5,6,-7.5:b,-1.5,5,-7.5:b,-1.5,4,-7.5:b,-0.5,4,-7.5:b,-2.5,4,-7.5:b,5.5,9,-7.5:b,-2.5,0,-7.5:b,5.5,0,-7.5:b,7.5,0,-6.5:b,7.5,0,-1.5:b,7.5,0,-1.5:b,7.5,0,3.5:b,7.5,1,3.5:b,7.5,2,3.5:b,7.5,3,3.5:b,7.5,4,3.5:b,7.5,0,-5.5:b,7.5,0,-0.5:b,7.5,0,4.5:b,7.5,0,-4.5:b,7.5,0,0.5:b,7.5,0,5.5:b,7.5,0,-3.5:b,7.5,0,1.5:b,7.5,0,6.5:b,7.5,0,-2.5:b,7.5,0,2.5:b,7.5,9,-6.5:b,7.5,9,-1.5:b,7.5,9,3.5:b,7.5,8,3.5:b,7.5,7,3.5:b,7.5,9,-5.5:b,7.5,9,-0.5:b,7.5,9,4.5:b,7.5,9,-4.5:b,7.5,9,0.5:b,7.5,9,5.5:b,7.5,9,-3.5:b,7.5,9,1.5:b,7.5,9,6.5:b,7.5,9,-2.5:b,7.5,8,-2.5:b,7.5,7,-2.5:b,7.5,4,-2.5:b,7.5,4,-3.5:b,7.5,4,-4.5:b,7.5,4,-5.5:b,7.5,4,-6.5:b,7.5,4,6.5:b,7.5,4,-1.5:b,7.5,9,2.5:b,-7.5,0,-6.5:b,-7.5,0,-1.5:b,-7.5,0,3.5:b,-7.5,0,-5.5:b,-7.5,0,-0.5:b,-7.5,0,4.5:b,-7.5,0,-4.5:b,-7.5,0,0.5:b,-7.5,0,5.5:b,-7.5,0,-3.5:b,-7.5,0,1.5:b,-7.5,0,6.5:b,-7.5,0,-2.5:b,-7.5,0,2.5:b,-7.5,9,-6.5:b,-7.5,9,-1.5:b,-7.5,9,3.5:b,-7.5,9,-5.5:b,-7.5,9,-0.5:b,-7.5,9,4.5:b,-7.5,9,-4.5:b,-7.5,9,0.5:b,-7.5,9,5.5:b,-7.5,9,-3.5:b,-7.5,9,1.5:b,-7.5,8,-1.5:b,-7.5,1,-2.5:b,-7.5,4,1.5:b,-7.5,5,1.5:b,-7.5,9,6.5:b,-7.5,9,-2.5:b,-7.5,9,2.5:b,-7.5,0,7.5:b,-7.5,1,7.5:b,8.5,1,8.5:b,8.5,0,8.5:b,8.5,0,7.5:b,7.5,0,8.5:b,8.5,1,7.5:b,7.5,1,8.5:b,-7.5,2,7.5:b,7.5,2,8.5:b,7.5,3,8.5:b,8.5,2,8.5:b,8.5,2,7.5:b,8.5,3,7.5:b,-8.5,3,7.5:b,-8.5,2,7.5:b,7.5,3,7.5:b,-7.5,5,7.5:b,-6.5,5,7.5:b,-5.5,5,7.5:b,-4.5,5,7.5:b,0.5,3,7.5:b,0.5,1,7.5:b,0.5,2,7.5:b,0.5,4,7.5:b,6.5,4,7.5:b,-7.5,7,7.5:b,7.5,4,7.5:b,7.5,7,7.5:b,-8.5,4,7.5:b,-8.5,5,7.5:b,-7.5,4,8.5:b,-7.5,5,8.5:b,-7.5,3,8.5:b,-7.5,2,8.5:b,-7.5,8,7.5:b,7.5,5,7.5:b,7.5,8,7.5:b,7.5,0,7.5:b,0.5,0,7.5:b,7.5,6,7.5:b,7.5,9,7.5:b,-7.5,6,7.5:b,-7.5,6,6.5:b,-7.5,6,5.5:b,-7.5,9,7.5:b,0.5,9,7.5:b,-0.5,9,7.5:b,-0.5,0,7.5:b,-1.5,9,7.5:b,6.5,9,7.5:b,-1.5,0,7.5:b,6.5,0,7.5:b,-3.5,9,7.5:b,4.5,9,7.5:b,-3.5,0,7.5:b,4.5,0,7.5:b,-4.5,9,7.5:b,3.5,9,7.5:b,-4.5,0,7.5:b,3.5,0,7.5:b,-5.5,9,7.5:b,2.5,9,7.5:b,-5.5,0,7.5:b,2.5,0,7.5:b,-6.5,9,7.5:b,1.5,9,7.5:b,-6.5,0,7.5:b,1.5,0,7.5:b,-2.5,9,7.5:b,5.5,9,7.5:b,-2.5,0,7.5:b,5.5,0,7.5:",Level4:"p,-6.5,8,-7.5:e1,7.5,8,0.5:e3,-7.5,1,-6.5:c,0,1,-7.5:b,-7.5,0,-7.5:b,-7.5,1,-7.5:b,7.5,1,-7.5:b,-7.5,2,-7.5:b,7.5,2,-7.5:b,-7.5,3,-7.5:b,7.5,3,-7.5:b,-7.5,4,-7.5:b,-7.5,7,-7.5:b,7.5,4,-7.5:b,7.5,7,-7.5:b,-7.5,5,-7.5:b,-7.5,8,-7.5:b,7.5,5,-7.5:b,7.5,8,-7.5:b,7.5,0,-7.5:b,0.5,0,-7.5:b,7.5,6,-7.5:b,7.5,9,-7.5:b,-7.5,6,-7.5:b,-7.5,9,-7.5:b,0.5,9,-7.5:b,-1.5,6,-7.5:b,-1.5,5,-7.5:b,-0.5,5,-7.5:b,0.5,4,-7.5:b,1.5,4,-7.5:b,3.5,4,-7.5:b,1.5,3,-7.5:b,3.5,3,-7.5:b,1.5,2,-7.5:b,3.5,2,-7.5:b,1.5,5,-7.5:b,3.5,5,-7.5:b,1.5,6,-7.5:b,3.5,6,-7.5:b,4.5,6,-7.5:b,5.5,5.5,-7.5:b,5.5,5,-7.5:b,5.5,4,-7.5:b,5.5,3,-7.5:b,4.5,2,-7.5:b,-1.5,4,-7.5:b,-1.5,3,-7.5:b,-1.5,2,-7.5:b,-0.5,9,-7.5:b,-0.5,0,-7.5:b,-1.5,9,-7.5:b,6.5,9,-7.5:b,-1.5,0,-7.5:b,6.5,0,-7.5:b,-3.5,9,-7.5:b,-5.5,6,-7.5:b,-5.5,5,-7.5:b,-5.5,4,-7.5:b,-5.5,3,-7.5:b,-5.5,2,-7.5:b,-4.5,4,-7.5:b,-4.5,2,-7.5:b,-3.5,2,-7.5:b,-4.5,6,-7.5:b,-3.5,6,-7.5:b,4.5,9,-7.5:b,-3.5,0,-7.5:b,4.5,0,-7.5:b,-4.5,9,-7.5:b,3.5,9,-7.5:b,-4.5,0,-7.5:b,3.5,0,-7.5:b,-5.5,9,-7.5:b,2.5,9,-7.5:b,-5.5,0,-7.5:b,2.5,0,-7.5:b,-6.5,9,-7.5:b,1.5,9,-7.5:b,-6.5,0,-7.5:b,1.5,0,-7.5:b,-2.5,9,-7.5:b,5.5,9,-7.5:b,-2.5,0,-7.5:b,5.5,0,-7.5:b,7.5,0,-6.5:b,7.5,0,-1.5:b,7.5,0,-1.5:b,7.5,0,3.5:b,7.5,0,-5.5:b,7.5,0,-0.5:b,7.5,0,4.5:b,7.5,0,-4.5:b,7.5,0,0.5:b,7.5,0,5.5:b,7.5,0,-3.5:b,7.5,0,1.5:b,7.5,0,6.5:b,7.5,0,-2.5:b,7.5,0,2.5:b,7.5,9,-6.5:b,7.5,9,-1.5:b,7.5,9,3.5:b,7.5,9,-5.5:b,7.5,9,-0.5:b,7.5,9,4.5:b,7.5,9,-4.5:b,7.5,9,0.5:b,7.5,9,5.5:b,7.5,9,-3.5:b,7.5,9,1.5:b,7.5,9,6.5:b,7.5,9,-2.5:b,7.5,9,2.5:b,-7.5,0,-6.5:b,-7.5,0,-1.5:b,-7.5,0,3.5:b,-7.5,0,-5.5:b,-7.5,0,-0.5:b,-7.5,0,4.5:b,-7.5,0,-4.5:b,-7.5,0,0.5:b,-7.5,0,5.5:b,-7.5,0,-3.5:b,-7.5,0,1.5:b,-7.5,0,6.5:b,-7.5,0,-2.5:b,-7.5,0,2.5:b,-7.5,9,-6.5:b,-7.5,9,-1.5:b,-7.5,9,3.5:b,-7.5,9,-5.5:b,-7.5,9,-0.5:b,-7.5,9,4.5:b,-7.5,9,-4.5:b,-7.5,9,0.5:b,-7.5,9,5.5:b,-7.5,9,-3.5:b,-7.5,9,1.5:b,-7.5,9,6.5:b,-7.5,9,-2.5:b,-7.5,9,2.5:b,-7.5,0,7.5:b,-7.5,1,7.5:b,7.5,1,7.5:b,-7.5,2,7.5:b,7.5,2,7.5:b,-7.5,3,7.5:b,7.5,3,7.5:b,-7.5,4,7.5:b,-7.5,7,7.5:b,7.5,4,7.5:b,7.5,7,7.5:b,-7.5,5,7.5:b,-7.5,8,7.5:b,7.5,5,7.5:b,7.5,8,7.5:b,7.5,0,7.5:b,0.5,0,7.5:b,7.5,6,7.5:b,7.5,9,7.5:b,-7.5,6,7.5:b,-7.5,9,7.5:b,0.5,9,7.5:b,-0.5,9,7.5:b,-0.5,0,7.5:b,-1.5,9,7.5:b,6.5,9,7.5:b,-1.5,0,7.5:b,6.5,0,7.5:b,-3.5,9,7.5:b,4.5,9,7.5:b,-3.5,0,7.5:b,4.5,0,7.5:b,-4.5,9,7.5:b,3.5,9,7.5:b,-4.5,0,7.5:b,3.5,0,7.5:b,-5.5,9,7.5:b,2.5,9,7.5:b,-5.5,0,7.5:b,2.5,0,7.5:b,-6.5,9,7.5:b,1.5,9,7.5:b,-6.5,0,7.5:b,1.5,0,7.5:b,-2.5,9,7.5:b,5.5,9,7.5:b,-2.5,0,7.5:b,5.5,0,7.5:"});this.app=t,this.g=i,this.blockList=this.app.root.findByTag("block"),this.createAABBList(),this.createTextures(),this.blockMat=new pc.StandardMaterial,this.blockMat.diffuse.set(1,1,1),this.blockMat.diffuseTint=!0,this.blockMat.update(),this.blockMatA=new pc.StandardMaterial,this.blockMatA.diffuse.fromString("#ffc400"),this.blockMatA.diffuseTint=!0,this.blockMatA.update(),this.playerMat=new pc.StandardMaterial,this.playerMat.diffuse.fromString("#f0b71b"),this.playerMat.emissive.fromString("#f0b71b"),this.playerMat.emissiveIntensity=.4,this.playerMat.update(),this.coinMat=new pc.StandardMaterial,this.coinMat.diffuse.set(1,1,.3),this.coinMat.emissive.set(1,1,.3),this.coinMat.update(),this.enemyMat=new pc.StandardMaterial,this.enemyMat.diffuse.set(1,.2,.2),this.enemyMat.update(),this.enemyMat2=new pc.StandardMaterial,this.enemyMat2.diffuse.set(.7,.1,.1),this.enemyMat2.update(),this.trapMat=new pc.StandardMaterial,this.trapMat.diffuse.set(.3,.1,.1),this.trapMat.update(),this.blackMat=new pc.StandardMaterial,this.blackMat.diffuse.fromString("#000000"),this.blackMat.update(),this.batchGroupBlocks=this.app.batcher.addGroup("Blocks",!1,100),this.batchGroupCoins=this.app.batcher.addGroup("Coins",!1,100),this.batchGroupTraps=this.app.batcher.addGroup("Spikes",!0,100)}loadLevelJson(t){v("load level",t),localStorage.setItem("mibjs13k_jump",t);let i=this.app.root.findByName("Level");i&&i.destroy();let e=this.levelsAsset["Level"+t],s=["#ffffff","#ffffff","#72c296","#59a79c","#c485b4","#b865b1","#ece475","#e0d56d","#81dd6a","#5dc46e"];this.blockMat.diffuse.fromString(s[t*2]),this.blockMat.update(),this.blockMatA.diffuse.fromString(s[t*2+1]),this.blockMatA.update();let a=new pc.Entity;a.name="Level",this.app.root.addChild(a),this.levelEntity=a;let n=e.split(":");for(let h of n){if(h=="")continue;let l=h.split(",");if(this.shortName.hasOwnProperty(l[0])){let c=this.createUnit(this.shortName[l[0]],l[0]);if(a.addChild(c),c.setPosition(l[1],l[2],l[3]),l[0]==="t"&&c.setEulerAngles(l[4],l[5],l[6]),c.tags.has("enemy")&&(c.getPosition().z===7.5&&c.setEulerAngles(0,180,0),c.getPosition().x===7.5&&c.setEulerAngles(0,-90,0),c.getPosition().x===-7.5&&c.setEulerAngles(0,90,0)),c.tags.has("block")){let u=c.getPosition().y,T=c.getPosition().x,A=c.getPosition().z,m=!0;(T-.5)%2==0&&(m=!1),(A-.5)%2==0&&(m=!m),u%2==0&&(m=!m),m&&(c.render.material=this.blockMatA)}}else v("no shortName",l[0])}this.blockList=a.find(h=>h.name=="Block"),this.aabbList=[];for(let h of this.blockList){let l=new pc.BoundingBox;l.center.copy(h.getPosition()),l.halfExtents.set(.5,.5,.5),this.aabbList.push(l)}this.g.player.entity=a.findByName("Player"),this.g.player.reset(),this.g.player.orient(!0),this.g.enemyList=[];let d=this.app.root.findByTag("enemy");for(let h of d)this.g.enemyList.push(new V(h,this.app,this.g));this.coinList=this.levelEntity.findByTag("coin"),this.trapList=this.levelEntity.findByTag("trap"),this.g.control.showArrows(),this.app.scene.skyboxIntensity=.5,this.g.light.light.intensity=.5,this.g.light2.light.intensity=.5;let r=new pc.BasicMaterial;r.diffuse=new pc.Color(.6,.6,.3),r.update(),this.g.partsList.forEach(h=>h.enabled=!1),this.g.levelRestartTimer=-1,v("coins",this.coinList.length),v("traps",this.trapList.length),v("enemies",this.g.enemyList.length)}nextLevel(){this.g.lvl++,this.g.lvl>this.g.nLvl&&(this.g.lvl=1),this.loadLevelJson(this.g.lvl)}createUnit(t,i){let e=new pc.Entity;if(e.name=t,t==="Player"){e.tags.add("player");let s=new pc.Entity;e.addChild(s);let a=new pc.Entity;s.addChild(a),a.addComponent("render",{type:"box",castShadows:!1}),a.render.material=this.playerMat,a.setLocalScale(.5,.5,.8),a.setLocalPosition(0,0,.1),a=new pc.Entity,s.addChild(a),a.addComponent("render",{type:"box",castShadows:!1}),a.render.material=this.playerMat,a.setLocalScale(.1,.1,.3),a.setLocalPosition(.15,0,-.3),a=new pc.Entity,s.addChild(a),a.addComponent("render",{type:"box",castShadows:!1}),a.render.material=this.playerMat,a.setLocalScale(.1,.1,.3),a.setLocalPosition(-.15,0,-.3),a=new pc.Entity,s.addChild(a),a.addComponent("render",{type:"box",castShadows:!1}),a.render.material=this.blackMat,a.setLocalScale(.1,.1,.1),a.setLocalPosition(.13,.25,-.1),a=new pc.Entity,s.addChild(a),a.addComponent("render",{type:"box",castShadows:!1}),a.render.material=this.blackMat,a.setLocalScale(.1,.1,.1),a.setLocalPosition(-.13,.25,-.1)}if(i=="e1"||i=="e2"||i=="e3"){e.tags.add("enemy"),i=="e2"&&e.tags.add("enemy_x"),i=="e3"&&e.tags.add("enemy_z");let s=new pc.Entity;s.addComponent("render",{type:"box",castShadows:!1}),s.render.material=this.enemyMat,s.setLocalScale(.8,.8,.5),e.addChild(s),s=new pc.Entity,s.addComponent("render",{type:"box",castShadows:!1,material:this.blackMat}),s.setLocalScale(.13,.13,.13),s.setLocalPosition(-.2,.1,.3),e.addChild(s),s=new pc.Entity,s.addComponent("render",{type:"box",castShadows:!1,material:this.blackMat}),s.setLocalScale(.13,.13,.13),s.setLocalPosition(.2,.1,.3),e.addChild(s),s=new pc.Entity,s.addComponent("render",{type:"cone",castShadows:!1}),s.render.material=this.enemyMat2,s.setLocalScale(.2,.2,.2),s.setLocalPosition(0,.5,0),e.addChild(s),s=new pc.Entity,s.addComponent("render",{type:"cone",castShadows:!1}),s.render.material=this.enemyMat2,s.setLocalScale(.2,.2,.2),s.setLocalPosition(0,-.5,0),s.setEulerAngles(0,0,180),e.addChild(s),s=new pc.Entity,s.addComponent("render",{type:"cone",castShadows:!1}),s.render.material=this.enemyMat2,s.setLocalScale(.2,.2,.2),s.setLocalPosition(-.5,0,0),s.setEulerAngles(0,0,90),e.addChild(s),s=new pc.Entity,s.addComponent("render",{type:"cone",castShadows:!1}),s.render.material=this.enemyMat2,s.setLocalScale(.2,.2,.2),s.setLocalPosition(.5,0,0),s.setEulerAngles(0,0,-90),e.addChild(s)}if(t==="Block"&&(e.tags.add("block"),e.addComponent("render",{type:"box",isStatic:!0,batchGroupId:this.batchGroupBlocks.id}),e.render.material=this.blockMat),t==="Coin"&&(e.setLocalScale(.2,.2,.2),e.tags.add("coin"),e.addComponent("render",{type:"box",castShadows:!1,batchGroupId:this.batchGroupCoins.id}),e.render.material=this.coinMat,e.render.isStatic=!0),t==="Trap"){e.setLocalScale(1,1,1),e.tags.add("trap");let s=new pc.Entity;e.addChild(s);let a=.3,n=[[a,-.2,a],[-a,-.2,-a],[a,-.2,-a],[-a,-.2,a]];for(let d=0;d<4;d++){let r=new pc.Entity;s.addChild(r),r.setLocalScale(.2,.8,.2),r.setLocalPosition(new pc.Vec3(n[d])),r.addComponent("render",{type:"cone",castShadows:!1,batchGroupId:this.batchGroupTraps.id}),r.render.material=this.trapMat}}return e}createAABBList(){for(let t of this.blockList){let i=new pc.BoundingBox;i.center.copy(t.getPosition()),i.halfExtents.set(.5,.5,.5),this.aabbList.push(i)}}rayCast(t,i){let e=!1,s=new pc.Vec3(100,100,100);for(let a of this.aabbList)a.intersectsRay(t,this.point)&&(e=!0,t.origin.distance(this.point)<t.origin.distance(s)&&s.copy(this.point));return e?(i.copy(s),!0):!1}rayCastOne(t,i){return i.intersectsRay(t,this.point)||this.point.set(0,0,0),this.point}createTextures(){let t=document.createElement("canvas");t.width=100,t.height=100;let i=t.getContext("2d"),e=new pc.Texture(this.app.graphicsDevice,{minFilter:pc.FILTER_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE});e.setSource(t),this.blockTexture=e,t=document.createElement("canvas"),t.width=120,t.height=60,i=t.getContext("2d"),i.fillStyle="#e9b91e",i.fillRect(0,0,120,60),i.fillStyle="#8d6d52",i.beginPath(),i.arc(30,30,12,0,2*Math.PI),i.fill(),i.arc(90,30,12,0,2*Math.PI),i.fill(),i.moveTo(45,60),i.lineTo(60,45),i.lineTo(75,60),i.fill(),i.closePath,e=new pc.Texture(this.app.graphicsDevice,{minFilter:pc.FILTER_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE}),e.setSource(t),this.vrTexture=e,t=document.createElement("canvas"),t.width=100,t.height=100,i=t.getContext("2d"),i.fillStyle="#e0ad3d",i.fillRect(0,0,100,100),i.strokeStyle="#644c18",i.lineWidth=10,i.moveTo(75,75),i.lineTo(25,75),i.lineTo(25,25),i.lineTo(75,25),i.lineTo(75,55),i.stroke(),i.lineWidth=5,i.moveTo(60,45),i.lineTo(75,55),i.lineTo(90,45),i.stroke(),e=new pc.Texture(this.app.graphicsDevice,{minFilter:pc.FILTER_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE}),e.setSource(t),this.resetBtnTexture=e,t=document.createElement("canvas"),t.width=300,t.height=300,i=t.getContext("2d"),i.fillStyle="#644f66",i.fillRect(0,0,300,300),i.textAlign="center",i.fillStyle="#aee4d4",i.font="40px arial",i.fillText("BITTY JUMP",150,50),e=new pc.Texture(this.app.graphicsDevice,{minFilter:pc.FILTER_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE}),e.setSource(t),this.titleTexture=e}}class _{constructor(t,i,e){o(this,"entity");o(this,"body");o(this,"app");o(this,"g");o(this,"isMove",!1);o(this,"speed",15);o(this,"playerMoveDir",new pc.Vec3(-1,0,0));o(this,"camDir",new pc.Vec3(0,0,1));o(this,"endPos",new pc.Vec3);o(this,"playerPos",new pc.Vec3);o(this,"stopTimer",0);o(this,"scale1",pc.Vec3.o);o(this,"isActive",!0);o(this,"isUndead",!1);this.entity=t,this.app=i,this.g=e}update(t){if(this.stopTimer>0){let i=this.body.getLocalScale();this.moveVecTowards(i,pc.Vec3.ONE,t*2),this.body.setLocalScale(i);let e=this.body.getLocalPosition();this.moveVecTowards(e,pc.Vec3.ZERO,t*.7),this.body.setLocalPosition(e)}this.isMove&&this.isActive&&(this.playerPos=this.entity.getPosition(),this.moveVecTowards(this.playerPos,this.endPos,this.speed*t),this.entity.setPosition(this.playerPos),this.playerPos.equals(this.endPos)&&(this.isMove=!1,this.g.control.showArrows(),this.orient(!0)))}move(t,i){this.playerMoveDir.copy(t),this.endPos.copy(i),this.isMove=!0,this.orient()}moveVecTowards(t,i,e){let s=i.x-t.x,a=i.y-t.y,n=i.z-t.z,d=s*s+a*a+n*n;if(d==0||e>=0&&d<=e*e){t.copy(i);return}let r=Math.sqrt(d);t.x+=s/r*e,t.y+=a/r*e,t.z+=n/r*e}hide(){this.isMove=!1,this.isActive=!1,this.entity.enabled=!1,this.g.control.hideArrows()}reset(){this.isMove=!1,this.isActive=!0,this.playerMoveDir.set(-1,0,0),this.body=this.entity.children[0]}orient(t=!1){let i=this.entity.getPosition(),e=this.playerMoveDir;e.x!=0&&i.z<0&&this.camDir.set(0,0,1),e.x!=0&&i.z>0&&this.camDir.set(0,0,-1),e.z!=0&&i.x<0&&this.camDir.set(1,0,0),e.z!=0&&i.x>0&&this.camDir.set(-1,0,0);let s=i.clone();t?s.sub(e):s.add(e),this.entity.lookAt(s,this.camDir),t?(this.body.setLocalScale(1.2,1.2,.8),this.body.setLocalPosition(0,0,.1),this.stopTimer=.5):this.body.setLocalScale(.8,.8,1.4)}}var M=console.log;const w=class w{constructor(t,i){o(this,"app");o(this,"game");this.game=i,this.app=t,this.buttonVr=this.app.root.findByName("Button VR2"),this.cameraEntity=this.app.root.findByName("Camera"),this.app.xr.start(this.cameraEntity.camera,pc.XRTYPE_VR,pc.XRSPACE_LOCALFLOOR),this.buttonVr.button.active=this.app.xr.supported&&this.app.xr.isAvailable(pc.XRTYPE_VR),this.buttonVr.element.on("click",function(e){e.stopPropagation(),M("--",this.app.xr.isAvailable(pc.XRTYPE_VR)),this.app.xr.isAvailable(pc.XRTYPE_VR)&&(window.DeviceOrientationEvent&&window.DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((function(s){M("response"),s=="granted"&&window.addEventListener("deviceorientation",(function(a){w.controllerRayList=[],this.cameraEntity.camera.startXr(pc.XRTYPE_VR,pc.XRSPACE_LOCAL)}).bind(this))}).bind(this)).catch(console.error):(M("start vr"),w.controllerRayList=[],this.app.xr.start(this.cameraEntity.camera,pc.XRTYPE_VR,pc.XRSPACE_LOCAL)))},this),this.app.keyboard.on("keydown",function(e){e.key===pc.KEY_ESCAPE&&this.app.xr.end()},this),this.app.xr.on("start",function(){console.log("xr start"),this.buttonVr.enabled=!1},this),this.app.xr.on("end",function(){this.buttonVr.enabled=!0,E.dot.enabled=!0},this),this.app.xr.on("available",function(){this.buttonVr.button.active=this.app.xr.supported&&this.app.xr.isAvailable(pc.XRTYPE_VR)},this)}};o(w,"controllerRayList",[]);let f=w;var B=console.log;class I{constructor(t,i){o(this,"app");o(this,"g");o(this,"cameraEntity");o(this,"hitPosition",new pc.Vec3);o(this,"ray",new pc.Ray);o(this,"arrowList",[]);o(this,"activeArrow");o(this,"arrowBase");o(this,"buttonList",[]);o(this,"activeBtn");o(this,"arrowMat");o(this,"debugColor",new pc.Color(1,1,1,.2));o(this,"debugColorActive",new pc.Color(1,1,1,1));o(this,"rndID",Math.random());this.app=t,this.g=i,this.cameraEntity=this.app.root.findByName("Camera");let e=new pc.Entity;t.root.addChild(e),this.arrowList.push(new g(new pc.Vec3(1,0,0),e)),this.arrowList.push(new g(new pc.Vec3(-1,0,0),e)),this.arrowList.push(new g(new pc.Vec3(0,1,0),e)),this.arrowList.push(new g(new pc.Vec3(0,-1,0),e)),this.arrowList.push(new g(new pc.Vec3(0,0,1),e)),this.arrowList.push(new g(new pc.Vec3(0,0,-1),e)),this.arrowBase=e;let s=new pc.Entity("BtnRestart");s.tags.add("vrButton");let a=new pc.StandardMaterial;a.diffuseMap=this.g.level.resetBtnTexture,s.addComponent("render",{type:"plane",material:a,castShadows:!1}),this.app.root.addChild(s),s.setPosition(0,-.35,-5),this.createButtons(),a=new pc.StandardMaterial,a.diffuseMap=this.g.level.titleTexture,a.alphaTest=0,a.opacity=.5;let n=new pc.Entity("Title");n.addComponent("render",{type:"plane",material:a,castShadows:!1}),this.app.root.addChild(n),n.setPosition(0,-.45,-4.6),n.setLocalScale(4,0,4)}update(t){let i=null,e=null;this.ray.origin.copy(this.cameraEntity.getPosition()),this.ray.direction.copy(this.cameraEntity.forward),this.app.xr.active&&f.controllerRayList.length>0&&this.ray.copy(f.controllerRayList[0]);for(let s of this.arrowList)if(s.isVisible&&(s.isActive=!1,s.aabb.intersectsRay(this.ray))){i||(i=s);let a=i.aabb.center.distance(this.cameraEntity.getPosition());s.aabb.center.distance(this.cameraEntity.getPosition())<a&&(i=s)}i&&(i.isActive=!0),this.activeArrow=i;for(let s of this.buttonList)s.isActive=!1,s.aabb.intersectsRay(this.ray)&&(e=s);e&&(e.isActive=!0),this.activeBtn=e;for(let s of this.arrowList)s.repos(this.g.player.entity.getPosition()),s.isVisible&&(s.isActive?(s.mat.opacity=1,s.mat.emissiveIntensity=1,s.mat.update()):(s.mat.opacity=.3,s.mat.emissiveIntensity=0,s.mat.update()));for(let s of this.buttonList)s.isActive?s.entity.setLocalScale(1.1,1.1,1.1):s.entity.setLocalScale(1,1,1)}showArrows(){this.arrowBase.setPosition(this.g.player.entity.getPosition()),this.arrowList.forEach(t=>{let i=this.g.player.entity.getPosition(),e=new pc.Ray(i,t.dir),s=new pc.Vec3;this.g.level.rayCast(e,s)?s.sub(i):s=e.direction,s.length()>.5?t.isVisible=!0:t.isVisible=!1,Math.abs(i.x)<7.5&&t.dir.z!=0&&(t.isVisible=!1),Math.abs(i.z)<7.5&&t.dir.x!=0&&(t.isVisible=!1)},this)}hideArrows(){this.arrowList.forEach(t=>{t.isVisible=!1})}onMouseClick(t){if(this.activeArrow&&!this.g.player.isMove){let i=new pc.Vec3().copy(this.activeArrow.dir),e=new pc.Ray(this.g.player.entity.getPosition(),i),s=new pc.Vec3,a=i.clone();this.g.level.rayCast(e,s)?(a.mulScalar(.5),s.sub(a)):(s.copy(this.g.player.entity.getPosition()),a.mulScalar(50),s.add(a)),this.g.player.move(i,s),this.hideArrows()}this.activeBtn&&this.activeBtn.entity.name=="BtnRestart"&&this.g.level.loadLevelJson(this.g.lvl)}onMouseMove(t){}createButtons(){this.buttonList=[];let t=this.app.root.findByTag("vrButton");for(let i of t)this.buttonList.push(new D(i))}rayCastButtons(t){for(let i of this.buttonList)i.aabb.intersectsRay(t)&&B("button hit")}}var g=class{constructor(b,t){o(this,"dir",new pc.Vec3);o(this,"_isVisible",!0);o(this,"isActive",!1);o(this,"aabb",new pc.BoundingBox);o(this,"entity",null);o(this,"mat",null);let i=this.aabb;i.halfExtents.set(.8,.8,.8),this.dir.copy(b),b.x!=0&&(i.halfExtents.x=2),b.y!=0&&(i.halfExtents.y=2),b.z!=0&&(i.halfExtents.z=2);let e=new pc.Entity;e.addComponent("render",{type:"cone"}),t.addChild(e);let s=new pc.Vec3;s.set(b.z*90,0,b.y<0?180:-b.x*90),e.rotate(s),b.mulScalar(1.2),e.setLocalPosition(b),e.setLocalScale(.5,1,.5),this.entity=e;let a=new pc.StandardMaterial;a.diffuse.set(0,.5,0),a.emissive.set(.4,1,.4),a.emissiveIntensity=0,a.update(),e.render.material=a,e.render.castShadows=!1,e.render.receiveShadows=!1,a.opacity=.3,a.blendType=pc.BLEND_NORMAL,a.update(),this.mat=a}set isVisible(b){this._isVisible=b,this.entity.enabled=b}get isVisible(){return this._isVisible}repos(b){let t=new pc.Vec3;t.copy(this.dir),t.mulScalar(2.5),b.add(t),this.aabb.center.copy(b)}},D=class{constructor(t){o(this,"isActive",!1);o(this,"aabb",new pc.BoundingBox);o(this,"entity");this.entity=t,this.aabb.copy(t.render.meshInstances[0].aabb)}},L=console.log;const S=class S{constructor(t,i){o(this,"lvl",1);o(this,"nLvl",4);o(this,"levelRestartTimer",-1);o(this,"nextLevelTimer",-1);o(this,"trapTimer",.1);o(this,"trapActive",!0);o(this,"app");o(this,"entity");o(this,"player");o(this,"camera");o(this,"level");o(this,"control");o(this,"enemyList",[]);o(this,"partsList",[]);o(this,"controllerList",[]);o(this,"blockList");o(this,"aabbList",[]);o(this,"endPos",new pc.Vec3);o(this,"eulers",new pc.Vec3);o(this,"light");o(this,"light2");o(this,"isMouseControl",!0);o(this,"eulers",new pc.Vec3);o(this,"lookSpeed",.1);o(this,"rndID",Math.round(Math.random()*1e3));let e=localStorage.getItem("mibjs13k_jump");L("----",e),e?(this.lvl=e,L("****")):(L("**"),localStorage.setItem("mibjs13k_jump",this.lvl)),L("--init");const s=pc.Application.getApplication().graphicsDevice;s.maxPixelRatio=Math.min(window.devicePixelRatio,2),this.app=t,this.entity=i,this.createLights();let a=new pc.Entity("Camera Offset");this.app.root.addChild(a),a.setPosition(0,5,0),this.camera=new pc.Entity("Camera"),this.camera.addComponent("camera"),a.addChild(this.camera),this.camera.camera.fov=75,this.player=new _(null,this.app,this),this.level=new k(this.app,this),this.control=new I(t,this),this.level.loadLevelJson(this.lvl),this.control.createButtons();let n=new pc.Entity;n.addComponent("render",{type:"plane"}),n.setLocalScale(15,0,15),n.setPosition(0,-.5,0),this.app.root.addChild(n);let d=new pc.StandardMaterial;d.diffuse.fromString("#644f66"),n.render.material=d;for(let c=0;c<15;c++){let u=new pc.Entity;u.addComponent("render",{type:"box",material:this.level.playerMat}),this.app.root.addChild(u),u.enabled=!1,this.partsList.push(u)}const r=new pc.Entity;r.addComponent("screen",{referenceResolution:new pc.Vec2(1280,720),scaleBlend:.5,scaleMode:pc.SCALEMODE_BLEND,screenSpace:!0}),t.root.addChild(r);const h=new pc.Entity("Button VR2");h.addComponent("button",{active:!0,hoverTint:new pc.Color().fromString("#f3b96e"),inactiveTint:[1,1,1,0],imageEntity:h}),h.addComponent("element",{anchor:[1,0,1,0],height:60,pivot:[1,0],type:pc.ELEMENTTYPE_IMAGE,width:120,useInput:!0,color:new pc.Color().fromString("#ffffff"),opacity:.5}),r.addChild(h),h.setLocalPosition(-10,10,0),h.element.texture=this.level.vrTexture,h.element.on("click",function(c){L("click")});let l=new pc.Entity("Dot");l.addComponent("element",{anchor:[.5,.5,.5,.5],height:5,pivot:[.5,.5],type:pc.ELEMENTTYPE_IMAGE,width:5,color:[1,1,1],opacity:.7}),r.addChild(l),S.dot=l,this.createSky()}update(t){this.levelRestartTimer<0&&this.nextLevelTimer<0&&(this.app.scene.skyboxIntensity<1&&(this.app.scene.skyboxIntensity+=t),this.light.light.intensity<1&&(this.light.light.intensity+=t),this.light2.light.intensity<1&&(this.light2.light.intensity+=t),this.app.scene.ambientLight.intensity<1&&(this.app.scene.ambientLight.intensity+=t)),this.control.update(t),this.player.update(t),new pc.Color(1,1,1);for(let e of this.level.aabbList);this.camera.setLocalEulerAngles(this.eulers.x,this.eulers.y,0),this.player.entity.getPosition().lengthSq()>1e3&&this.level.loadLevelJson(lvl),this.levelRestartTimer>0&&(this.levelRestartTimer-=t,this.partsList.forEach(function(e){let s=e.getPosition();s.add(e.dir),e.setPosition(s);let a=e.getLocalScale();a.mulScalar(.95),e.setLocalScale(a)}),this.app.scene.skyboxIntensity-=t/2,this.light.light.intensity-=t/2,this.levelRestartTimer<=0&&this.level.loadLevelJson(this.lvl)),this.nextLevelTimer>0&&(this.app.scene.skyboxIntensity-=t/2,this.light.light.intensity-=t/2,this.nextLevelTimer-=t,this.nextLevelTimer<=0&&this.level.nextLevel()),this.trapTimer+=t,this.trapTimer>=2&&(this.trapTimer=0,this.trapActive=!this.trapActive);for(let e of this.enemyList)e.update(t),this.player.isActive&&!this.player.isUndead&&this.player.entity.getPosition().distance(e.entity.getPosition())<1&&(this.levelRestartTimer=1,this.player.hide(),this.partsEmit());for(let e of this.level.trapList)this.trapTimer==0&&(this.trapActive?e.children[0].setLocalPosition(0,0,0):e.children[0].setLocalPosition(0,-.5,0)),this.trapActive&&this.player.isActive&&!this.player.isUndead&&this.player.entity.getPosition().distance(e.getPosition())<1&&(this.levelRestartTimer=1,this.player.hide(),this.partsEmit());let i=0;for(let e of this.level.coinList)this.player.entity.getPosition().distance(e.getPosition())<1&&(e.enabled=!1),e.enabled||i++;i==this.level.coinList.length&&this.nextLevelTimer<0&&(this.nextLevelTimer=1)}swap(t){}onMouseClick(t){if(t.buttons[2]){this.app.mouse.disablePointerLock();return}this.app.xr.active||pc.Mouse.isPointerLocked()&&this.control.onMouseClick(t)}onMouseUp(t){this.app.xr.active||pc.Mouse.isPointerLocked()||setTimeout(function(i){i.app.mouse.enablePointerLock()},10,this)}onMouseMove(t){this.app.xr.active||pc.Mouse.isPointerLocked()&&(this.eulers.y-=this.lookSpeed*t.dx,this.eulers.x-=this.lookSpeed*t.dy)}onVrAction(t){this.control.onMouseClick(t)}partsEmit(){let t=new pc.Vec3;for(const i of this.partsList){t.copy(this.player.entity.getPosition());let e=this.player.playerMoveDir.clone();e.mulScalar(.5),t.add(e),e.x=1-Math.random()*2,e.y=1-Math.random()*2,e.z=1-Math.random()*2,e.normalize(),e.mulScalar(.5),t.add(e),i.setPosition(t),i.setLocalScale(.3,.3,.3),e.normalize(),e.mulScalar(.05),i.dir=e,i.enabled=!0}}createLights(){let t=new pc.Entity("Light");this.light=t.addComponent("light",{type:"directional",shadowUpdateMode:pc.SHADOWUPDATE_THISFRAME,shadowType:pc.SHADOW_PCF3,shadowResolution:2024,isStatic:!0,castShadows:!1,shadowBias:.3,vsmBias:.01,vsmBlurMode:1,normalOffsetBias:.05,shadowIntensity:.4,color:new pc.Color().fromString("#ffffff")}),this.app.root.addChild(t),t.setEulerAngles(-30,150,0),new pc.Color;let i=new pc.Entity("Light");this.light2=i.addComponent("light",{type:"directional",isStatic:!0,castShadows:!1,color:new pc.Color().fromString("#6388cc"),intensity:1}),this.app.root.addChild(i),i.setEulerAngles(-90,-80,0)}createSky(){const t=document.createElement("canvas");t.width=100,t.height=100;let i=t.getContext("2d");const e=i.createLinearGradient(0,0,0,100);e.addColorStop(.2,"#5eb4df"),e.addColorStop(.6,"#ccdee9"),e.addColorStop(.8,"#662dc2"),i.fillStyle=e,i.fillRect(0,0,100,100);const s=new pc.Texture(this.app.graphicsDevice,{minFilter:pc.FILTER_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE});s.setSource(t);var a=new pc.Texture(this.app.graphicsDevice,{cubemap:!0,width:1024,height:1024}),n=new pc.Texture(this.app.graphicsDevice,{width:1024,height:1024});pc.reprojectTexture(s,a,{}),this.app.scene.skybox=a,this.app.scene.ambientLight.fromString("#5b5e51"),pc.EnvLighting.generateAtlas(a,{target:n})}};o(S,"dot");let E=S;var P=console.log;class O{constructor(t,i,e){o(this,"entity",null);o(this,"app",null);o(this,"list");this.list=e,this.entity=t,this.app=i,P("controller init"),this.vecA=new pc.Vec3,this.color=new pc.Color(1,1,1),this.color2=new pc.Color(.2,.8,.8),this.hoverEntity=null,this.model=this.entity.children[0],this.n=f.controllerRayList.length,f.controllerRayList.push(new pc.Ray),this.selectDeleayTimer=0}setInputSource(t){P(t),this.inputSource=t,this.inputSource.once("remove",this.onRemove,this)}onRemove(){P("remove"),this.entity.destroy();const t=this.list.indexOf(this);t>-1&&this.list.splice(t,1)}update(t){if(f.controllerRayList[this.n].origin.copy(this.inputSource.getOrigin()),f.controllerRayList[this.n].direction.copy(this.inputSource.getDirection()),this.selectDeleayTimer>0&&this.selectDeleayTimer--,this.inputSource.selecting&&this.selectDeleayTimer==0){this.color.set(0,1,0);let i=new pc.Ray(this.inputSource.getOrigin(),this.inputSource.getDirection());this.app.fire("vr_action",i),this.selectDeleayTimer=20}else this.color.set(1,1,1);this.inputSource.grip?(E.dot.enabled=!1,this.model.enabled=!0,this.entity.setPosition(this.inputSource.getPosition()),this.entity.setRotation(this.inputSource.getRotation()),this.vecA.copy(this.inputSource.getDirection()),this.vecA.scale(1e3).add(this.inputSource.getOrigin()),this.app.renderLine(this.inputSource.getOrigin(),this.vecA,this.color)):this.model.enabled=!1}}class N{constructor(t){o(this,"controllerList",[]);this.app=t,this.cameraParent=this.app.root.findByName("Camera Offset"),this.app.xr.input.on("add",this.onAdd,this)}onAdd(t){console.log("add controller");let i=new pc.Entity;this.cameraParent.addChild(i);let e=new pc.Entity;e.addComponent("render",{type:"box"}),e.setLocalScale(.06,.06,.06),e.setEulerAngles(-40,0,0),i.addChild(e);let s=new O(i,this.app,this.controllerList);s.setInputSource(t),this.controllerList.push(s)}}let z=console.log;const C=document.getElementById("application"),p=new pc.Application(C,{elementInput:new pc.ElementInput(C)});p.setCanvasResolution(pc.RESOLUTION_AUTO);p.setCanvasFillMode(pc.FILLMODE_FILL_WINDOW);p.start();z(p.batcher);var y=new E(p);p.mouse=new pc.Mouse(document.body);p.keyboard=new pc.Keyboard(document.body);p.mouse.disableContextMenu();p.mouse.on(pc.EVENT_MOUSEMOVE,y.onMouseMove,y);p.mouse.on(pc.EVENT_MOUSEDOWN,y.onMouseClick,y);p.mouse.on(pc.EVENT_MOUSEUP,y.onMouseUp,y);p.on("vr_action",y.onVrAction,y);new f(p,y);var F=new N(p);p.on("update",G);window.addEventListener("resize",()=>p.resizeCanvas());function G(b){y.update(b);for(let t of F.controllerList)t&&p.xr.active&&t.update();p.keyboard.wasPressed(pc.KEY_R)&&y.level.loadLevelJson(y.lvl)}
