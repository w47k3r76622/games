<title>Lost Vision</title><link rel=icon href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQAAAABbAUdZAAAAMklEQVR4AWMgFrAxNhgwsDEcSEAhHhwAEglwIrEBSBjCCWMGICENJ6QYGNj/8EEIYgEAaHYNLtdNbMkAAAAASUVORK5CYII="><body bgcolor=0 style=margin:0;overflow:hidden><canvas id=_ style="position:fixed;top:50%;left:50%;transform-origin:0 0;image-rendering:pixelated;image-rendering:crisp-edges"></canvas><script>!function(t){var e={};function o(i){if(e[i])return e[i].exports;var l=e[i]={i:i,l:!1,exports:{}};return t[i].call(l.exports,l,l.exports,o),l.l=!0,l.exports}o.m=t,o.c=e,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var l in t)o.d(i,l,function(e){return t[e]}.bind(null,l));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=0)}([function(t,e,o){"use strict";o.r(e);var i=(t,e,o,i,l=!1)=>({x:t,y:e,oldX:t,oldY:e,renderX:t,renderY:e,velocityX:0,velocityY:0,width:o,height:i,hidden:l,collected:!1});const l=(t,e)=>{if(t.x+t.width>=e.x&&t.x<=e.x+e.width&&t.y+t.height>=e.y&&t.y<=e.y+e.height){const o=e.y+e.height-t.y,i=t.y+t.height-e.y,l=e.x+e.width-t.x,n=t.x+t.width-e.x,r=Math.min(i,o,l,n);return{bottom:i==r,right:n==r,left:l==r,top:o==r}}return null},n=(t,e)=>[Math.round(t/16),Math.round(e/16)],r=()=>{const t=[];for(let e=0;e<35;e++){const e=[];for(let t=0;t<65;t++)e.push[0];t.push(e)}return t},c=(t,e)=>({type:t,coords:e});var s=(t,e,o)=>({origin:t,tilesToCheck:[],tilesToDraw:[],level:e,tmpMap:r(),firstRun:!0,opacity:1,runs:0,noLimit:o});const a=(t,[e,o])=>{const n=[[e-1,o],[e-1,o+1],[e,o+1],[e+1,o+1],[e+1,o],[e+1,o-1],[e,o-1],[e-1,o-1]];for(const e of n){const o=E(t,e);if(-1!=o){if([0,3,2].includes(o)&&t.tilesToCheck.push(e),3==o){const o=i(16*e[1],16*e[0]+32,16,16);for(const e of t.level.coins)l(o,e)&&(e.hidden=!1)}t.tilesToDraw.push(c(o,e))}}},E=(t,[e,o])=>{try{const i=t.level.map[e][o];return 2==t.tmpMap[e][o]?-1:(t.tmpMap[e][o]=2,i)}catch(t){return-1}},A=[...Array(33),29,,,,,,12,,,,"ᇄ",3,"ႄ",1,1118480,"縿",31,"庽","嚿","炟","皷","纷","䈟","线","皿",17,,,"⥊",,"䊼",,"㹏","纮","縱","縮","纵","纐","񴚦","粟","䟱","丿",1020241,"簡",33059359,1024159,"縿","纜","񼙯","繍","皷","䏰","簿",25363672,32541759,18157905,"惸",18470705,,,,,"С"],d=(t,e,o,i,l,n="#d3d3d3")=>{const r=t.globalCompositeOperation;t.globalCompositeOperation="lighter",[...e].reduce((e,r)=>{const c=l/5,s=A[r.charCodeAt()]||"",a=(((t=>t>0)(s)?s:s.codePointAt())||0).toString(2),E=Math.ceil(a.length/5),d=e+c;return((t,e)=>t.match(RegExp(`.{${e}}`,"g")))(a.padStart(5*E,0),5).map((e,l)=>[...e].map((e,r)=>{t.fillStyle=+e?n:"transparent",t.fc(o+d+l*c,i+r*c,c,c)})),e+(E+1)*c},0),t.globalCompositeOperation=r},O=`1${"0".repeat(62)}1`,y=[{startPosition:{x:100,y:200},tiles:[O,O,O,O,O,O,O,O,O,O,O,O,O,O,O,"1000000000000000000000000000000000000000000000000000000000000031","1111111111100001111111111111111111111111111111111000011111111111",O,O,O,O,O,O,"1000000000000000000000000000000000000000000000000002000000000001","1000000000000000000000000000000000000000000000000111100000000001",O,O,O,O,O,O,O,O,O]},{startPosition:{x:100,y:200},tiles:[O,O,O,O,O,O,O,O,O,O,"1000000000000000000000000000000000000000000000000000003000000001","1000000000001111000000111100000011110000001111000000111100000001",O,O,O,"1000111100000000000000000000000000000000000000000000000000000001",O,O,"1000000000000000000000000000000000000000000000000000000000000201","1000000000011111111111111111111111111111111111111111111111111111",O,O,O,O,O,O,O,O,O,O,O,O,O,O]},{startPosition:{x:100,y:200},tiles:[O,O,O,O,O,O,O,O,O,"1300000000000000000000000000000000000000000000000020000000000001","1111111111111110000011111111110000000000000000111111000000000001",O,"1000000000000000000000000000000000011111100000000000000000000001",O,O,"1000000000000000000000000111111000000000000000000000000000000001",O,O,"1000000000000011111100000000000000000000000000000000000000000001",O,O,"1000111111000000000000000000000000000000000000000000000000000001",O,O,O,O,O,O,O,O,O,O,O,O]}],u=(t,e)=>{const o=y[t],l=(t=>{const e=[];for(const o of t.tiles)e.push(o.split("").map(t=>Number(t)));return e})(o),n=[],r=[];let c=null;return l.forEach((t,o)=>{t.forEach((t,l)=>{1==t&&n.push(i(16*l,32+16*o,16,16)),2==t&&(c=i(16*l,32+16*o,16,16)),e||3!=t||r.push(i(16*l+4,32+16*o+4,8,8,!0))})}),{boxes:n,coins:r,flag:c,map:l,startPosition:o.startPosition}};const f=t=>{window.requestAnimationFrame(f);let e=t/1e3-Q;for(e>.25&&(e=.25),Q=t/1e3,P+=e;P>=x;)h(),P-=x;p(P/x),R()},h=()=>{switch(++w,$){case 0:T(1),!j.e&&b.e&&($=F?2:1,F=0);break;case 1:T(1),!j.e&&b.e&&(V=u(G,1==(M=F)),C.x=V.startPosition.x,C.y=V.startPosition.y,$=3);break;case 2:!j.e&&b.e&&(F=0,$=0);break;case 3:w%120==0&&D++,g(),w%2==0&&U&&((t=>{if(t.firstRun)a(t,t.origin),t.firstRun=!1;else if(t.noLimit&&t.tilesToCheck[0]||t.runs<8){const e=[...t.tilesToCheck];t.tilesToCheck=[];for(const o of e)a(t,o);t.runs++}else t.opacity>0&&(t.opacity-=.025)})(U),U.opacity<=0&&(U=null));break;case 4:b.e&&(G=0,k=[],N(),$=0)}j=Object.assign({},b)},T=t=>{!j.u&&b.u&&F--,!j.d&&b.d&&F++,F>t&&(F=0),F<0&&(F=1)},g=()=>{if(C.oldX=C.x,C.oldY=C.y,C.x+=C.velocityX,C.y+=C.velocityY,C.y>576){if(C.velocityX=C.velocityY=0,C.x=V.startPosition.x,C.y=V.startPosition.y,1==M){const[t,e]=n(C.x,C.y);U=s([e-2,t],V,1==M)}else U=null;return}const t=(b.r||0)-(b.l||0);C.velocityX+=.4*t,C.velocityX=Math.min(Math.max(C.velocityX,-2),2),C.velocityX*=.85,C.velocityX=C.velocityX>=-.05&&C.velocityX<=.05?0:C.velocityX,!j.u&&b.u&&0==C.velocityY&&(C.velocityY=-5.5),C.velocityY<20&&(C.velocityY+=.2);for(const t of V.boxes){const e=l(C,t);(null==e?void 0:e.bottom)&&C.y+C.height<t.y+C.velocityY&&(C.y=t.y-C.height,C.velocityY=0),(null==e?void 0:e.left)&&C.x+C.velocityX<t.x+t.width+C.velocityX&&(C.x=t.x+t.width,C.velocityX=0),(null==e?void 0:e.right)&&C.x+C.width+C.velocityX>t.x+C.velocityX&&(C.x=t.x-C.width,C.velocityX=0)}for(const t of V.coins)!t.collected&&l(C,t)&&(t.collected=!0);if(V.flag&&l(C,V.flag)){if(k.push({seconds:D,coinsCollected:V.coins.filter(t=>t.collected).length}),G+1>=y.length)return G=0,N(),void($=4);G++,N(),D=0,w=0,V=u(G,1==M),C.x=V.startPosition.x,C.y=V.startPosition.y}if(0==M&&!j._&&b._||1==M&&!B){const[t,e]=n(C.x,C.y);U=s([e-2,t],V,1==M)}B||(B=!0)},R=()=>{const t=innerWidth,e=innerHeight,o=devicePixelRatio||1;if(Y!=t||W!=e||X!=o){Y=t,W=e;const i=1024*(X=o),l=576*X;_.width=v.width=i,_.height=v.height=l;const n=Y/i,r=W/l,c=Math.min(n,r);_.style.transform=`scale(${c}) translate(-50%,-50%)`,m.imageSmoothingEnabled=!1,I.imageSmoothingEnabled=c<1,m.scale(X,X)}switch(m.fillStyle="#121212",m.fc(0,0,1024,576),$){case 0:d(m,"LOST VISION",130,180,80),S(400,309,F,[G>0?"CONTINUE GAME":"START GAME","HOW TO PLAY"]),d(m,"CREATED BY RUUD SCHROEN",30,532,14),d(m,"JS13K 2020",884,532,14);break;case 1:d(m,"SELECT GAME MODE",80,60,30),S(85,140,F,["EXPLORER","MEMORIZER"]),F>0?(d(m,"YOU GET A SINGLE ECHO AT THE START OF THE",425,140,16),d(m,"LEVEL WHICH WILL TEMPORARILY REVEAL THE",425,170,16),d(m,"ENTIRE LEVEL. AFTER THIS, YOU WILL NEED",425,200,16),d(m,"TO NAVIGATE THE LEVEL FROM MEMORY.",425,230,16),d(m,"IF YOU DIE, YOU WILL GET A NEW ECHO.",425,280,16),d(m,"THERE ARE NO COINS IN THIS GAME MODE.",425,330,16)):(d(m,"YOU CAN PERFORM AN ECHO AT WILL, WHICH",425,140,16),d(m,"WILL TEMPORARILY REVEAL THE SPACE AROUND",425,170,16),d(m,"YOU.",425,200,16));break;case 2:d(m,"HOW TO PLAY",80,60,30),d(m,"YOU HAVE LOST YOUR SIGHT, BUT GAINED THE POWER OF ECHOLOCATING.",80,140,16),d(m,"WHEN YOU START, YOU WILL NOT BE ABLE TO SEE THE PATH YOU NEED TO TAKE.",80,190,16),d(m,"BY PRESSING",80,220,16),d(m,"SPACE",226,220,16,"#6ab04c"),d(m,"YOU CAN TEMPORARILY REVEAL THE SPACE AROUND YOU.",296,220,16),d(m,"WHEN YOU KNOW WHERE TO GO, USE THE",80,270,16),d(m,"WASD, ZQSD OR ARROW KEYS",502,270,16,"#6ab04c"),d(m,"TO MOVE",808,270,16),d(m,"AND JUMP AROUND. YOU NEED TO REACH THE",80,300,16),m.da(H,540,300),d(m,"TO ADVANCE TO THE NEXT LEVEL.",562,300,16),d(m,"THERE ARE ALSO HIDDEN COINS TO BE FOUND, WHICH YOU CAN REVEAL",80,350,16),d(m,"WITH YOUR ECHO.",80,380,16),d(m,"PRESS ENTER TO RETURN TO THE MAIN MENU",80,430,16,"#6ab04c");break;case 3:{if(U){m.fillStyle=`rgba(225,225,225,${U.opacity})`,m.ba();for(const t of U.tilesToDraw)1==t.type&&m.rc(16*t.coords[1],32+16*t.coords[0],16,16);m.fill(),m.fillStyle=`rgba(31,31,31,${U.opacity})`,m.ba();for(const t of U.tilesToDraw)[0,2,3].includes(t.type)&&m.rc(16*t.coords[1],32+16*t.coords[0],16,16);m.fill()}const t=new Date(1e3*D).toISOString().substr(11,8);d(m,`TIME: ${t}`,8,8,14),d(m,`LEVEL: ${G+1}`,200,8,14),0==M&&d(m,`COINS: ${V.coins.filter(t=>t.collected).length}/${V.coins.length}}`,350,8,14),V.flag&&m.da(H,V.flag.x,V.flag.y);for(const t of V.coins)t.hidden||t.collected||m.da(L,t.x,t.y);m.fillStyle=m.strokeStyle="#d3d3d3",m.ba(),m.mv(0,32),m.ln(1024,32),m.rc(C.x,C.y,C.width,C.height),m.sr(),m.fill();break}case 4:{d(m,"CONGRATULATIONS!",80,60,30),d(m,"YOU HAVE FINISHED THE GAME!",80,140,16);const t=k.reduce((t,e)=>t+e.coinsCollected,0);0==M&&d(m,`YOU HAVE COLLECTED ${t} COINS!`,80,170,16),d(m,"PRESS ENTER TO RETURN TO THE MAIN MENU",80,230,16,"#6ab04c")}}I.da(v,0,0,1024*X,576*X)},S=(t,e,o,i)=>{m.fillStyle=m.strokeStyle="#d3d3d3",i.forEach((i,l)=>{m.sR(t,e+45*l,20,20),l==o&&m.fc(t+3,e+45*l+3,14,14),d(m,i,t+30,e+45*l+1,18)})},p=t=>{C.renderX=(C.x-C.oldX)*t+C.oldX,C.renderY=(C.y-C.oldY)*t+C.oldY},N=()=>{localStorage.setItem("lostvision",JSON.stringify({currentLevel:G,levelScores:k}))},v=document.createElement("canvas"),m=v.getContext("2d",{alpha:!1}),I=_.getContext("2d",{alpha:!1}),x=.01,b={},C=i(100,100,16,16),L=new Image;L.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAIAQMAAAD+wSzIAAAABlBMVEVHcEz/5AAboIZUAAAAAXRSTlMAQObYZgAAABJJREFUCNdjsGGoY/gPhXUMNgArkAVxUP6UmAAAAABJRU5ErkJggg==";const H=new Image;H.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAABnRSTlMARwBwAEyv7uYjAAAALUlEQVR4AWOo9QKhy0QD0jS4F/hANRCpGqGBSNU0tAGhh9xQAmolEg0ODaMaADMKfZao1oucAAAAAElFTkSuQmCC";let U,Y,M,P=0,w=0,D=0,X=0,W=0,G=0,V=null,k=[],B=!1,F=0,j={},Q=0,$=0;for(const t in I)I[t[0]+(t[6]||t[2])]=I[t],m[t[0]+(t[6]||t[2])]=m[t];onkeydown=onkeyup=t=>b["lurdlRdTl*urEu*_e**s"[(t.which+3)%20]]=Number(t.type[3]<"u"),(()=>{const t=localStorage.getItem("lostvision");if(t)try{const e=JSON.parse(t);k=e.levelScores,G=e.currentLevel}catch(t){return}})(),window.requestAnimationFrame(f)}]);</script></body>