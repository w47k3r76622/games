let{init:init,getContext:getContext,initPointer:initPointer,track:track,initKeys:initKeys,keyPressed:keyPressed,load:load,setImagePath:setImagePath,imageAssets:imageAssets,Sprite:Sprite,GameLoop:GameLoop}=kontra,{canvas:canvas,context:context}=init();initPointer(),initKeys();let dpi=window.devicePixelRatio;canvas.setAttribute("width",getComputedStyle(canvas).getPropertyValue("width").slice(0,-2)*dpi),canvas.setAttribute("height",getComputedStyle(canvas).getPropertyValue("height").slice(0,-2)*dpi);let ctx=getContext();ctx.webkitImageSmoothingEnabled=!1,ctx.mozImageSmoothingEnabled=!1,ctx.imageSmoothingEnabled=!1;let COLOR_SAFE="#5cb85c",COLOR_WARNING="#f0ad4e",COLOR_DANGER="#d9534f",HALF_WIDTH=canvas.width/2,HALF_HEIGHT=canvas.height/2,HALF_TRACK_WIDTH=canvas.height/30,AIRCRAFT_SIZE=canvas.height/10,FLY_SPEED=canvas.width/960,HINT_HOMEPAGE1="Click on an airplane to control.",HINT_HOMEPAGE2="Use A / D or arrow keys left / right to adjust the direction.",HINT_HOMEPAGE3="Enter the runway with a suitable angle for landing.",HINT_HOMEPAGE4="Press ENTER to start.",HINT_START="HINT: Avoid crash! Avoid signal lost!",HINT_RAINBOW="A Rainbow Airplane! Get it landed to score more.",MSG_CRASH="Crashed! GAME OVER!!!",MSG_LOST="Too many losts! YOU ARE FIRED!!!",HINT_SCORE="You scored ",HINT_AGAIN="Press ENTER to play again.";var fire,state=0,lostColor=COLOR_SAFE,interval=360,aircrafts=[],slctedAcft=null,message=!1,gameOverMsg="",rainbowMsg=0,score=0,lost=0,crashed=!1,tCount=0,hintCounter=0,rainbowHintCounter=0;function collidesWith(t){let e=this.x-t.x,a=this.y-t.y;return Math.sqrt(e*e+a*a)<.9*AIRCRAFT_SIZE}setImagePath("img"),load("title.png","unselected.png","selected.png","rainbow.png","sea.png","tower.png","back.png","fire.png").then(function(){let t=Sprite({x:0,y:HALF_HEIGHT,anchor:{x:1,y:.5},dx:5,width:AIRCRAFT_SIZE,height:AIRCRAFT_SIZE,image:imageAssets.unselected});function e(){ctx.drawImage(imageAssets.sea,0,0,.3*canvas.width,canvas.height)}function a(){for(head=.3*canvas.width,ctx.lineWidth=10,ctx.strokeStyle="#ffffff",ctx.beginPath(),ctx.moveTo(head,HALF_HEIGHT-HALF_TRACK_WIDTH),ctx.lineTo(canvas.width,HALF_HEIGHT-HALF_TRACK_WIDTH),ctx.stroke(),ctx.beginPath(),ctx.moveTo(head,HALF_HEIGHT+HALF_TRACK_WIDTH),ctx.lineTo(canvas.width,HALF_HEIGHT+HALF_TRACK_WIDTH),ctx.stroke(),head+=2*HALF_TRACK_WIDTH;head<canvas.width;)ctx.beginPath(),ctx.moveTo(head,HALF_HEIGHT),head+=60,ctx.lineTo(head,HALF_HEIGHT),head+=60,ctx.stroke()}function i(){let t=imageAssets.tower;towerW=15*t.width,towerH=15*t.height,towerX=.75*canvas.width,towerY=.8*(HALF_HEIGHT-HALF_TRACK_WIDTH-towerH),ctx.drawImage(t,towerX,towerY,towerW,towerH)}function o(t,e){ctx.font="40px arial",ctx.fillStyle="#ffffff",ctx.textAlign="center",ctx.fillText(t,canvas.width/2,e)}let n=Sprite({x:.3*canvas.width+HALF_TRACK_WIDTH,y:HALF_HEIGHT,alpha:1,flashoff:!0,update:function(){this.alpha<0&&(this.alpha=0,this.flashoff=!1),this.alpha>1&&(this.alpha=1,this.flashoff=!0),this.flashoff?this.alpha-=.02:this.alpha+=.02},render:function(){ctx.beginPath(),ctx.rect(this.x-HALF_TRACK_WIDTH,HALF_HEIGHT-HALF_TRACK_WIDTH,2*HALF_TRACK_WIDTH,2*HALF_TRACK_WIDTH),ctx.fillStyle="rgba(255,255,255,"+this.alpha+")",ctx.fill()},readyLanding:function(t){let e=this.x-t.x,a=this.y-t.y;return Math.sqrt(e*e+a*a)<HALF_TRACK_WIDTH&&t.rotation<Math.PI/4&&t.rotation>-Math.PI/4}}),s=Sprite({x:.3*canvas.width+4*HALF_TRACK_WIDTH,y:HALF_HEIGHT,anchor:{x:0,y:.5},width:3.6*HALF_TRACK_WIDTH,height:1.2*HALF_TRACK_WIDTH,dx:0,ddx:.1,image:imageAssets.back});function r(){let t=function(){var t,e,a;let i=Math.floor(4*Math.random()),o=Math.floor(2*Math.random());switch(i){case 0:a=Math.random()*Math.PI/6+Math.PI/6,0==o?(t=0,e=Math.floor(Math.random()*HALF_HEIGHT)):(e=0,t=Math.floor(Math.random()*HALF_WIDTH));break;case 1:a=Math.random()*Math.PI/6+2*Math.PI/3,0==o?(t=canvas.width,e=Math.floor(Math.random()*HALF_HEIGHT)):(e=0,t=Math.floor(Math.random()*HALF_WIDTH)+HALF_WIDTH);break;case 2:a=-(Math.random()*Math.PI/6+Math.PI/6),0==o?(t=0,e=Math.floor(Math.random()*HALF_HEIGHT)+HALF_HEIGHT):(e=canvas.height,t=Math.floor(Math.random()*HALF_WIDTH));break;case 3:a=-(Math.random()*Math.PI/6+2*Math.PI/3),0==o?(t=canvas.width,e=Math.floor(Math.random()*HALF_HEIGHT)+HALF_HEIGHT):(e=canvas.height,t=Math.floor(Math.random()*HALF_WIDTH)+HALF_WIDTH);break;default:X=0,e=HALF_HEIGHT,a=0}return[t,e,a]}(),e=t[0],a=t[1],i=t[2],o=Sprite({x:e,y:a,anchor:{x:.5,y:.5},width:AIRCRAFT_SIZE,height:AIRCRAFT_SIZE,rotation:i,rainbow:!1,landed:!1,selected:!1,scored:!1,image:imageAssets.unselected,collidesWith:collidesWith,onDown:function(){this.landed||this.selected||(null!=slctedAcft&&(aircrafts[slctedAcft].selected=!1,aircrafts[slctedAcft].image=imageAssets.unselected),this.selected=!0,this.rainbow?(this.image=imageAssets.rainbow,rainbowMsg+=1):this.image=imageAssets.selected)}});Math.random()<.1&&(o.rainbow=!0),track(o),aircrafts.push(o)}function c(){aircrafts.forEach(function(t,e){t.update(),t.rotation>Math.PI&&(t.rotation=-(2*Math.PI-t.rotation)),t.rotation<-Math.PI&&(t.rotation=2*Math.PI+t.rotation),t.rainbow?(t.dx=Math.cos(t.rotation)*FLY_SPEED*2,t.dy=Math.sin(t.rotation)*FLY_SPEED*2):(t.dx=Math.cos(t.rotation)*FLY_SPEED,t.dy=Math.sin(t.rotation)*FLY_SPEED),t.selected&&(slctedAcft=e,(keyPressed("left")||keyPressed("a"))&&(t.rainbow?t.rotation-=.04:t.rotation-=.02),(keyPressed("right")||keyPressed("d"))&&(t.rainbow?t.rotation+=.04:t.rotation+=.02)),n.readyLanding(t)&&(message=!0,t.landed=!0,t.selected&&(slctedAcft=null,t.selected=!1,t.image=imageAssets.unselected)),t.landed&&(!function(t){t.width>AIRCRAFT_SIZE/2&&(t.width*=.997,t.height*=.997);t.rotation>.01?t.rotation-=.01:t.rotation<-.01?t.rotation+=.01:t.rotation=0;t.y>HALF_HEIGHT+1?t.y-=1:t.y<HALF_HEIGHT-1?t.y+=1:t.y=HALF_HEIGHT}(t),t.scored||(t.rainbow?score+=3:score+=1,t.scored=!0)),t.x>=-AIRCRAFT_SIZE/2&&t.x<=canvas.width+AIRCRAFT_SIZE/2&&t.y>=-AIRCRAFT_SIZE/2&&t.y<=canvas.height+AIRCRAFT_SIZE/2||(t.selected&&(slctedAcft=null),t.scored||((lost+=1)>1&&lost<4?lostColor=COLOR_WARNING:lost>=4&&(lostColor=COLOR_DANGER),lost>=5&&(gameOverMsg=MSG_LOST,state=2)),aircrafts.splice(e,1))})}r(),GameLoop({update:function(){0==state?(t.update(),t.x>canvas.width+t.width&&(t.x=0)):1==state&&((tCount+=1)>=interval&&(r(),tCount=0),interval>240&&(interval-=.05),c(),n.update(),message&&(s.update(),s.x>canvas.width&&(message=!1)))},render:function(){0==state?(keyPressed("enter")&&(state+=1),function(){let t=imageAssets.title;titleX=HALF_WIDTH-10*t.width,titleY=HALF_HEIGHT-10*t.height-AIRCRAFT_SIZE-20,ctx.drawImage(t,titleX,titleY,20*t.width,20*t.height),ctx.font="60px arial",ctx.fillStyle="#ffffff",ctx.textAlign="center",ctx.fillText(HINT_HOMEPAGE1,HALF_WIDTH,HALF_HEIGHT+AIRCRAFT_SIZE+20),ctx.fillText(HINT_HOMEPAGE2,HALF_WIDTH,HALF_HEIGHT+AIRCRAFT_SIZE+120),ctx.fillText(HINT_HOMEPAGE3,HALF_WIDTH,HALF_HEIGHT+AIRCRAFT_SIZE+220),ctx.fillText(HINT_HOMEPAGE4,HALF_WIDTH,HALF_HEIGHT+AIRCRAFT_SIZE+320)}(),t.render()):2==state?(keyPressed("enter")&&(state=1,lostColor=COLOR_SAFE,interval=360,aircrafts=[],slctedAcft=null,message=!1,rainbowMsg=0,crashed=!1,score=0,lost=0,tCount=0,r()),e(),a(),i(),crashed&&function(t){let e=imageAssets.fire;ctx.drawImage(e,t[0]-AIRCRAFT_SIZE/2,t[1]-AIRCRAFT_SIZE/2,AIRCRAFT_SIZE,AIRCRAFT_SIZE),ctx.drawImage(e,t[2]-AIRCRAFT_SIZE/2,t[3]-AIRCRAFT_SIZE/2,AIRCRAFT_SIZE,AIRCRAFT_SIZE)}(fire),function(t){ctx.font="80px arial",ctx.fillStyle="#ffffff",ctx.textAlign="center",ctx.fillText(t,canvas.width/2,160),ctx.fillText(HINT_SCORE+score,canvas.width/2,320),ctx.fillText(HINT_AGAIN,canvas.width/2,480)}(gameOverMsg)):(a(),i(),e(),n.render(),message&&s.render(),aircrafts.forEach(function(t,e){aircrafts.forEach(function(a,i){e==i||t.landed||a.landed||!a.collidesWith(t)||(fire=[t.x,t.y,a.x,a.y],gameOverMsg=MSG_CRASH,crashed=!0,state=2)}),t.render()}),hintCounter<480&&(o(HINT_START,60),hintCounter+=1),1==rainbowMsg&&(rainbowHintCounter<480?(o(HINT_RAINBOW,120),rainbowHintCounter+=1):rainbowMsg+=1),ctx.font="60px arial",ctx.fillStyle="#ffffff",ctx.textAlign="right",ctx.fillText("Score: "+score,canvas.width-20,80),ctx.fillStyle=lostColor,ctx.textAlign="right",ctx.fillText("Lost: "+lost,canvas.width-20,160))}}).start()}).catch(function(t){console.log(t)});