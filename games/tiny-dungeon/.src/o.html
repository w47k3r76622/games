<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8" /> <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" /> <title>Tiny Dungeon</title> <style> html, body{ background-color:#333;color:#fff;font-family:helvetica, arial, sans-serif;margin:0;padding:0;font-size:12pt;}#c, .social{ position:absolute;left:0;right:0;top:0;bottom:0;margin:auto;background:black;}.social{ width:320px;height:480px;display:none;background:none;}a{ position:absolute;display:block;height:60px;text-indent:-9999px;}a.tweet{ top:236px;left:8px;width:148px;}a.share{ top:236px;left:164px;width:148px;}a.again{ top:304px;left:8px;width:304px;}</style> </head> <body style=""> <canvas id="c" width="320" height="480"></canvas> <div class="social"> <a href="#" class="tweet" target="_blank">Tweet</a> <a href="#" class="share" target="_blank">Share</a> <a href="#" class="again">Play Again</a> </div> <script>(function(){void 0===Date.now&&(Date.now=function(){return(new Date).valueOf()});var a=a||function(){var a=[];return{REVISION:"14",getAll:function(){return a},removeAll:function(){a=[]},add:function(b){a.push(b)},remove:function(b){b=a.indexOf(b),-1!==b&&a.splice(b,1)},update:function(b){if(0===a.length)return!1;var c=0;for(b=void 0!==b?b:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();c<a.length;)a[c].update(b)?c++:a.splice(c,1);return!0}}}();a.Tween=function(b){var c={},d={},e={},f=1e3,g=0,h=!1,i=!1,j=0,k=null,l=a.Easing.Linear.None,m=a.Interpolation.Linear,n=[],o=null,p=!1,q=null,r=null,s=null,t;for(t in b)c[t]=parseFloat(b[t],10);this.to=function(a,b){return void 0!==b&&(f=b),d=a,this},this.start=function(f){a.add(this),i=!0,p=!1,k=void 0!==f?f:"undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),k+=j;for(var g in d){if(d[g]instanceof Array){if(0===d[g].length)continue;d[g]=[b[g]].concat(d[g])}c[g]=b[g],0==c[g]instanceof Array&&(c[g]*=1),e[g]=c[g]||0}return this},this.stop=function(){return i?(a.remove(this),i=!1,null!==s&&s.call(b),this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var a=0,b=n.length;a<b;a++)n[a].stop()},this.delay=function(a){return j=a,this},this.repeat=function(a){return g=a,this},this.yoyo=function(a){return h=a,this},this.easing=function(a){return l=a,this},this.interpolation=function(a){return m=a,this},this.chain=function(){return n=arguments,this},this.onStart=function(a){return o=a,this},this.onUpdate=function(a){return q=a,this},this.onComplete=function(a){return r=a,this},this.onStop=function(a){return s=a,this},this.update=function(a){var i;if(a<k)return!0;!1===p&&(null!==o&&o.call(b),p=!0);var s=(a-k)/f,s=1<s?1:s,t=l(s);for(i in d){var u=c[i]||0,v=d[i];v instanceof Array?b[i]=m(v,t):("string"==typeof v&&(v=u+parseFloat(v,10)),"number"==typeof v&&(b[i]=u+(v-u)*t))}null!==q&&q.call(b,t);if(1==s){if(0<g){isFinite(g)&&g--;for(i in e)"string"==typeof d[i]&&(e[i]+=parseFloat(d[i],10)),h&&(s=e[i],e[i]=d[i],d[i]=s),c[i]=e[i];return k=a+j,!0}null!==r&&r.call(b),i=0;for(s=n.length;i<s;i++)n[i].start(a);return!1}return!0}},a.Easing={Linear:{None:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return 1>(a*=2)?.5*a*a:-0.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a:.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a:-0.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*a*a},Out:function(a){return--a*a*a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 1-Math.cos(a*Math.PI/2)},Out:function(a){return Math.sin(a*Math.PI/2)},InOut:function(a){return.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:1>(a*=2)?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)}},Circular:{In:function(a){return 1-Math.sqrt(1-a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return 1>(a*=2)?-0.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(a){var b,c=.1;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=.1):b=.4*Math.asin(1/c)/(2*Math.PI),-(c*Math.pow(2,10*(a-=1))*Math.sin(2*(a-b)*Math.PI/.4)))},Out:function(a){var b,c=.1;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=.1):b=.4*Math.asin(1/c)/(2*Math.PI),c*Math.pow(2,-10*a)*Math.sin(2*(a-b)*Math.PI/.4)+1)},InOut:function(a){var b,c=.1;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=.1):b=.4*Math.asin(1/c)/(2*Math.PI),1>(a*=2)?-0.5*c*Math.pow(2,10*(a-=1))*Math.sin(2*(a-b)*Math.PI/.4):c*Math.pow(2,-10*(a-=1))*Math.sin(2*(a-b)*Math.PI/.4)*.5+1)}},Back:{In:function(a){return a*a*(2.70158*a-1.70158)},Out:function(a){return--a*a*(2.70158*a+1.70158)+1},InOut:function(a){return 1>(a*=2)?.5*a*a*(3.5949095*a-2.5949095):.5*((a-=2)*a*(3.5949095*a+2.5949095)+2)}},Bounce:{In:function(b){return 1-a.Easing.Bounce.Out(1-b)},Out:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},InOut:function(b){return.5>b?.5*a.Easing.Bounce.In(2*b):.5*a.Easing.Bounce.Out(2*b-1)+.5}}},a.Interpolation={Linear:function(b,c){var d=b.length-1,e=d*c,f=Math.floor(e),g=a.Interpolation.Utils.Linear;return 0>c?g(b[0],b[1],e):1<c?g(b[d],b[d-1],d-e):g(b[f],b[f+1>d?d:f+1],e-f)},Bezier:function(b,c){var d=0,e=b.length-1,f=Math.pow,g=a.Interpolation.Utils.Bernstein,h;for(h=0;h<=e;h++)d+=f(1-c,e-h)*f(c,h)*b[h]*g(e,h);return d},CatmullRom:function(b,c){var d=b.length-1,e=d*c,f=Math.floor(e),g=a.Interpolation.Utils.CatmullRom;return b[0]===b[d]?(0>c&&(f=Math.floor(e=d*(1+c))),g(b[(f-1+d)%d],b[f],b[(f+1)%d],b[(f+2)%d],e-f)):0>c?b[0]-(g(b[0],b[0],b[1],b[1],-e)-b[0]):1<c?b[d]-(g(b[d],b[d],b[d-1],b[d-1],e-d)-b[d]):g(b[f?f-1:0],b[f],b[d<f+1?d:f+1],b[d<f+2?d:f+2],e-f)},Utils:{Linear:function(a,b,c){return(b-a)*c+a},Bernstein:function(b,c){var d=a.Interpolation.Utils.Factorial;return d(b)/d(c)/d(b-c)},Factorial:function(){var a=[1];return function(b){var c=1,d;if(a[b])return a[b];for(d=b;1<d;d--)c*=d;return a[b]=c}}(),CatmullRom:function(a,b,c,d,e){a=.5*(c-a),d=.5*(d-b);var f=e*e;return(2*b-2*c+a+d)*e*f+(-3*b+3*c-2*a-d)*f+a*e+b}}};var b="font t_earth t_water t_air t_fire p_mage p_staff e_lasher e_imp e_frostgiant bg".split(" "),c="title",d=null,e=!1,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v=document.querySelector("#c"),w=v.getContext("2d");f=function(){var a=b,c=a.length,d={},e=0;return{lImg:function(a){return img=new Image,img.src="img/"+a+".png",img.onload=function(){e++,c===e&&(b=d,g=!0)},img},lImgs:function(b){for(b=0;b<c;b++)d[a[b]]=this.lImg(a[b])},lAssets:function(){var a,b;this.lImgs(),a=function(){g?(b=new CustomEvent("imgsL"),document.dispatchEvent(b)):setTimeout(a,100)},setTimeout(a,100)},r:function(a,b){return Math.random()*(b-a+1)|0+a}}}(),h=function(){var a=document.createElement("canvas").getContext("2d"),c=[];return{init:function(){var d,e,f;d=b.font;var g=d.width,h=d.height,i,j=0;a.canvas.width=g,a.canvas.height=h,a.drawImage(d,0,0,g,h),i=a.getImageData(0,0,g,h).data;for(d=0;d<i.length;d+=4)e=d/4%g|0,f=d/4/g|0,f===h-1&&!i[d+3]&&(c.push({x:j,y:0,w:e-j,h:h-2}),j=e+1,d+=4)},getData:function(b){var d,e=b.length,f=[];for(d=0;d<e;d++)f.push(c[b.charCodeAt(d)-32]);return{buffer:a.canvas,word:f}}}}(),i=function(){return{init:function(){w.imageSmoothingEnabled=!1,w.oImageSmoothingEnabled=!1,w.mozImageSmoothingEnabled=!1,w.webkitImageSmoothingEnabled=!1,w.globalCompositeOperation="source-over"},drawText:function(a){var b=h.getData(a.text),c=0;b.word.forEach(function(d,e){w.drawImage(b.buffer,d.x,d.y,d.w,d.h,a.x+c,a.y,d.w,d.h),c+=d.w})},fillRect:function(a){w.fillStyle=a.c,w.fillRect(a.x,a.y,a.w,a.h)}}}(),j=function(){function c(a){this.type=d.r(0,3),this.colour=g[this.type],this.spell=e[this.type],this.image=b["t_"+this.spell],this.size=12,this.spacing=1,a&&(this.x=a.x,this.y=a.y,this.sP={x:a.x*(this.size+this.spacing),y:a.y*(this.size+this.spacing)},this.newPos={},a.sY&&this.nP({x:a.x,y:a.y,sY:a.sY}))}var d=f,e=["earth","water","air","fire"],g=["green","blue","magenta","red"],h=(w.globalCompositeOperation="screen","screen"===w.globalCompositeOperation);return c.prototype.update=function(a){},c.prototype.render=function(){this.selected?h?(w.drawImage(this.image,this.sP.x,this.sP.y,this.size,this.size),w.globalCompositeOperation="screen",w.drawImage(this.image,this.sP.x,this.sP.y,this.size,this.size),w.globalCompositeOperation="source-over"):w.drawImage(this.image,this.sP.x,this.sP.y,this.size,this.size):h?w.drawImage(this.image,this.sP.x,this.sP.y,this.size,this.size):(w.globalAlpha=.75,w.drawImage(this.image,this.sP.x,this.sP.y,this.size,this.size),w.globalAlpha=1)},c.prototype.nP=function(b){this.x=b.x,this.y=b.y,b.sY&&(this.sP.y+=b.sY*(this.size+this.spacing)),this.newPos={x:b.x*(this.size+this.spacing),y:b.y*(this.size+this.spacing)},(new a.Tween(this.sP)).to(this.newPos,100).start()},c}(),k=function(){var a=new j,b=a.size+a.spacing,c=[];return{x:2,y:53,size:5,numTiles:0,isAnimated:!1,animatedTiles:[],create:function(){var a,b,c=[];for(a=0;a<this.size;a++)for(c[a]=[],b=0;b<this.size;b++)c[a][b]=new j({x:a,y:b}),this.numTiles+=1;return c},cTA:function(a){c[a.x][a.y]=new j(a),this.numTiles+=1},gTAC:function(a){return this.cellInBounds(a)?c[a.x][a.y]:null},gTASP:function(a){return a.x=(a.x-v.offsetLeft)/4,a.y=(a.y-v.offsetTop)/4,this.posInBounds(a)?(a.x-=this.x,a.x/=b,a.y-=this.y,a.y/=b,this.gTAC({x:a.x|0,y:a.y|0})):null},moveTileTo:function(a,b){c[a.x][a.y]=null,c[b.x][b.y]=a,a.nP(b)},removeTileAt:function(a){c[a.x][a.y]=null,this.numTiles-=1},cellInBounds:function(a){return 0<=a.x&&a.x<this.size&&0<=a.y&&a.y<this.size},posInBounds:function(a){return a.x>=this.x&&a.x<this.x+this.size*b&&a.y>=this.y&&a.y<this.y+this.size*b},validMove:function(a,b){return(b.x===a.x-1||b.x===a.x+1)&&b.y===a.y||(b.y===a.y-1||b.y===a.y+1)&&b.x===a.x},gFP:function(a){var b;do b=a,a={x:b.x,y:b.y+1};while(this.cellInBounds(a)&&!this.gTAC(a));return b},rMT:function(){var a,b,c,d,e,f=[];for(a=0;a<this.size;a++)for(f[a]=0,b=this.size-1;0<=b;b--)c={x:a,y:b},(d=this.gTAC(c))?(e=this.gFP(c),this.moveTileTo(d,e)):f[a]+=1;for(a=0;a<this.size;a++)for(b=0;b<this.size;b++)c={x:a,y:b},(d=this.gTAC(c))||this.cTA({x:a,y:b,sY:-f[a]})},init:function(){c=this.create()},update:function(a){var b;for(a=0;a<this.size;a++)for(b=0;b<this.size;b++)c[a][b]instanceof j&&c[a][b].update()},render:function(){var a,d;w.save(),w.scale(4,4),w.translate(this.x,this.y),w.beginPath(),w.rect(0,0,this.size*b,this.size*b),w.clip(),w.closePath();for(a=0;a<this.size;a++)for(d=0;d<this.size;d++)c[a][d]instanceof j&&c[a][d].render();w.restore()}}}(),l=function(){function a(){this.x=68,this.y=53,this.size={x:10,y:64},this.mT=60,this.sT=null,this.time=0,this.tick=this.size.y/this.mT}return a.prototype.init=function(){this.sT=+(new Date)},a.prototype.update=function(a){this.sT&&(this.time+=a),this.tP&&this.time>this.tP.end&&(this.tP=null)},a.prototype.render=function(){w.save(),w.scale(4,4),w.translate(this.x,this.y),i.fillRect({c:"#ccc",x:0,y:0,w:this.size.x,h:this.size.y}),i.fillRect({c:"black",x:1,y:1,w:this.size.x-2,h:this.size.y-2}),this.tP&&(i.fillRect({c:"#267AF6",x:1,y:1+(this.tP.from+this.tP.to|0)*this.tick,w:this.size.x-2,h:this.size.y-2-(this.time|0)*this.tick}),i.fillRect({c:"red",x:1,y:1+(this.tP.from|0)*this.tick,w:this.size.x-2,h:(this.tP.to|0)*this.tick})),i.fillRect({c:"#267AF6",x:1,y:1+(this.time|0)*this.tick,w:this.size.x-2,h:this.size.y-2-(this.time|0)*this.tick}),w.restore()},a.prototype.add=function(a,b){0<this.time-a?this.time-=a:this.time=0,b("+"+a+" SECS")},a.prototype.remove=function(a,b){this.tP={from:this.time+a+.8,to:a,end:this.time},this.time+=a,b("-"+a+" SECS")},a.prototype.pause=function(a){(this.paused=a)?this.pausedAt=+(new Date):this.sT+=+(new Date)-this.pausedAt},a}(),m=function(){function a(){this.level=0,this.highestCrit={amount:0,e:""},this.mostDamageTaken={amount:0,e:""},this.totalTimeSurvived=this.totalEnemiesKilled=this.damageTakenOverall=this.longestSpellChain=0}return a.prototype.update=function(a,b){this.hasOwnProperty(a)&&("number"==typeof b&&b>this[a]?this[a]=b:"object"==typeof b&&b.amount>this[a].amount&&(this[a]=b))},a}(),n=function(){function c(){this.step=.25,this.stepTimer=0,this.mage=b.p_mage,this.mx=38,this.my=11,this.mw=this.mage.width,this.mh=this.mage.height,this.staff=b.p_staff,this.sx=44,this.sy=16,this.sw=this.staff.width,this.sh=this.staff.height,this.rotate=0,this.stats=new d,this.level=1}var d=m,g=f.r;return c.prototype.update=function(a){this.stepTimer+=a;if(this.stepTimer>=2*this.step||e)this.stepTimer=0},c.prototype.render=function(){e?0!==this.rotate?(w.save(),w.translate(0,this.h),w.rotate(this.rotate*Math.PI/180),w.drawImage(this.staff,this.sx+this.rotate,this.sy-this.rotate+(this.stepTimer>=this.step?1:0),this.sw,this.sh),w.restore()):w.drawImage(this.staff,this.sx,this.sy+(this.stepTimer>=this.step?1:0),this.sw,this.sh):w.drawImage(this.mage,this.mx,this.my+(this.stepTimer>=this.step?1:0),this.mw,this.mh)},c.prototype.hit=function(a){var b=g(0,100)<a.critChance?1:.5;return{crit:1<=b,damage:b*a.strength|0}},c.prototype.cast=function(){var b=this,c=(new a.Tween({r:0})).to({r:-10},200).easing(a.Easing.Quintic.In).onUpdate(function(){b.rotate=this.r}),d=(new a.Tween({r:-10})).to({r:0},500).easing(a.Easing.Quadratic.Out).onUpdate(function(){b.rotate=this.r});c.chain(d).start()},c}(),o=function(){function b(b){var c=this;this.x=b.x,this.y=b.y,this.dY=6*b.dY,this.alpha=1,this.text=b.text,this.lifeSpan=1.2,this.dead=!1,(new a.Tween({y:this.y,alpha:this.alpha})).to({y:this.y+this.dY,alpha:0},1e3*c.lifeSpan).easing(a.Easing.Exponential.In).onUpdate(function(){c.y=this.y,c.alpha=this.alpha}).onComplete(function(){c.dead=!0}).start()}return b.prototype.render=function(){w.globalAlpha=this.alpha,i.drawText({text:this.text,x:this.x,y:this.y}),w.globalAlpha=1},b}(),p=function(){function a(a){this.y=this.x=0,this.z=c(300,450),this.fov=60,this.step=.25,this.stepTimer=0,this.type=c(0,d.length-1),this.name=d[this.type].name,this.spell=d[this.type].spell,this.weakTo=d[this.type].weakTo,this.level=a.level,this.health=this.baseHealth=10+4*this.level,this.strength=2*this.level,this.critChance=this.level+10,this.image=b["e_"+this.name],this.w=this.image.width,this.h=this.image.height,this.dead=!1}var c=f.r,d=[{name:"lasher",spell:"earth",weakTo:"air"},{name:"imp",spell:"fire",weakTo:"water"},{name:"frostgiant",spell:"water",weakTo:"fire"}];return a.prototype.drawHealthMeter=function(){w.fillStyle="white",w.fillRect(2,2,20,4),w.fillStyle="black",w.fillRect(3,3,18,2),w.fillStyle="red",w.fillRect(3,3,this.health/this.baseHealth*18,2)},a.prototype.hit=function(a,b){var c=1,d=0,e=" HP";a.spell===this.spell?(c=0,e=" HP *IMMUNE*"):a.spell===this.weakTo&&(c=2,e=" HP *CRIT!*"),d=c*a.strength,this.health-=d,b(2===c,d,"-"+d+e)},a.prototype.update=function(a,b){this.stepTimer+=b,this.stepTimer>this.step&&(this.z-=a*b,this.stepTimer=0),this.attacking?(this.attackFor-=b,0>this.attackFor&&(this.attacking=!1)):this.lAt+=b,0>=this.health&&(this.dead=!0)},a.prototype.render=function(a,b){var c=this.fov/(this.fov+this.z),d=this.x*c+a/2,f=this.y*c+b/2;200<this.z||this.dead||(w.globalAlpha=1-this.z/200,w.drawImage(this.image,d-this.w*c/2,f-(this.attacking?2:0)-this.h*c/2,this.w*c,this.h*c),w.globalAlpha=1,e&&(this.drawHealthMeter(),w.fillStyle="white",w.fillRect(a/2-15,b-9,30,7),w.fillStyle="black",w.fillRect(a/2-14,b-8,28,5)))},a}(),q=function(a){var c=f.r;return{x:2,y:3,w:76,h:48,stats:null,p:null,e:null,texts:[],init:function(){this.pos=0,this.vel=1e3,this.p=this.stats=null,this.sP(),this.e=null,this.sE(),this.bg=b.bg},sP:function(){this.p=new n},sE:function(){var a=new p({level:this.p.level});if(this.e&&this.e.type===a.type)return this.sE();this.e=a},hP:function(){var a=this,b=this.p.hit({strength:this.e.strength,critChance:this.e.critChance});d.remove(b.damage,function(c){b.crit&&a.texts.push(new o({x:118,y:78,dY:1,text:"*CRIT!*"})),a.texts.push(new o({x:118,y:88,dY:1,text:c})),a.p.stats.update("mostDamageTaken",{amount:b.damage,e:a.e.name}),a.p.stats.update("damageTakenOverall",a.p.stats.damageTakenOverall+b.damage)}),this.e.lAt=0,this.e.attacking=!0,this.e.attackFor=.5},hE:function(a,b,d){var e=this;this.e.hit({spell:b.spell,strength:d},function(a,b,d){e.texts.push(new o({x:9,y:20,dY:1,text:d})),a?(e.p.stats.update("highestCrit",{amount:b,e:e.e.name}),e.hP()):c(0,2)||e.hP()})},castSpell:function(a){this.p.cast(),this.p.stats.update("longestSpellChain",a)},gainTime:function(a){var b=this;d.add(a,function(a){b.texts.push(new o({x:118,y:88,dY:1,text:a}))})},update:function(a){this.checkTimer()||(this.vel=e?0:1e3,this.pos+=this.vel,this.p.update(a),5>this.e.z&&(e=!0),this.e.dead?(this.sE(),this.p.level+=1.4,this.p.stats.update("totalEnemiesKilled",this.p.stats.totalEnemiesKilled+1),e=!1):(e&&8<this.e.lAt&&this.hP(),this.e.update(this.vel,a)))},render:function(){var a;w.save(),w.scale(4,4),w.translate(this.x,this.y),i.fillRect({c:"gray",x:0,y:0,w:this.w,h:this.h}),w.beginPath(),w.rect(1,1,this.w-2,this.h-2),w.clip(),w.closePath(),w.drawImage(this.bg,0,0),this.e.render(this.w,this.h),this.p.render(),w.restore(),w.save(),w.scale(2,2);for(a=0;a<this.texts.length;a++)this.texts[a].render();e&&i.drawText({text:this.e.name.toUpperCase(),x:2*(this.x+this.w/2)-this.e.name.length/2*4.3,y:2*(this.y+this.h-7)}),w.restore()},checkTimer:function(){if(d.time>=d.mT)return this.p.stats.update("totalTimeSurvived",(+(new Date)-d.sT)/1e3|0),this.stats=this.p.stats,event=new CustomEvent("gameEnd"),a.dispatchEvent(event),this.p=null,!0}}}(document),r=function(){var a="ontouchstart"in window;return{title:function(){w.save(),w.scale(4,4),i.drawText({text:"Tiny Dungeon",x:13.5,y:42}),i.drawText({text:(a?"Tap":"Click")+" To Start",x:a?14:12.5,y:66}),w.restore()},game:function(){q.render(),k.render(),d.render()},social:function(){var a=q.stats;w.save(),w.scale(4,4),i.drawText({text:"You survived",x:13.5,y:12}),i.drawText({text:"for "+a.totalTimeSurvived+" seconds",x:12-2*(""+a.totalTimeSurvived).length,y:22}),i.drawText({text:"in the",x:28,y:32}),i.drawText({text:"Tiny Dungeon",x:13.5,y:42}),w.fillStyle="#00B0ED",w.fillRect(2,59,37,15),i.drawText({text:"Tweet",x:8.5,y:64}),w.fillStyle="#3B5998",w.fillRect(41,59,37,15),i.drawText({text:"Share",x:48,y:64}),w.fillStyle="green",w.fillRect(2,76,76,15),i.drawText({text:"Play Again",x:18,y:81}),i.drawText({text:" Enemies killed: "+a.totalEnemiesKilled+" Longest spell chain: "+a.longestSpellChain+" Highest critical strike: "+a.highestCrit.amount+" on "+a.highestCrit.e+" Most damage taken: "+a.mostDamageTaken.amount+" from "+a.mostDamageTaken.e+" Damage taken overall: "+a.damageTakenOverall,x:80-this.statsX,y:103}),this.statsX+=.3,800<this.statsX&&(this.statsX=0),w.restore()},statsX:0}}(),s=function(){function a(){this.frame=this.frame.bind(this),this.lastTime=0,this.cb=function(){},this.start=function(a){this.cb=a,requestAnimationFrame(this.frame)}}return a.prototype.frame=function(a){var b=(a-this.lastTime)/1e3;this.lastTime=a,.2>b&&this.cb(b),requestAnimationFrame(this.frame)},new a}(),t=function(b,f){return{currentTile:{},chain:[],first:function(a){(a=k.gTASP(a))&&(a=k.gTAC(a),a&&(a.selected=!0,this.chain.push(a),this.currentTile=a))},next:function(a){var b=k.gTASP(a),c,d;b&&(b=k.gTAC(b),b&&b!==this.currentTile&&b.type===this.currentTile.type&&k.validMove(this.currentTile,b)&&(c=this.chain.filter(function(a){return b===a}),c.length&&(d=this.chain.indexOf(c[0]),c=this.chain.splice(d,this.chain.length-d),c.forEach(function(a){a.selected=!1})),b.selected=!0,this.chain.push(b),this.currentTile=b))},last:function(){1<this.chain.length?(this.chain.forEach(function(a){k.removeTileAt({x:a.x,y:a.y})}),q.castSpell(this.chain.length),e?q.hE({x:k.x,y:k.y},this.currentTile,this.chain.length):q.gainTime(this.chain.length/2),k.rMT()):this.chain[0]&&(this.chain[0].selected=!1),this.chain=[]},init:function(){var a;h.init(),i.init(),a=new CustomEvent("gameReady"),f.dispatchEvent(a)},ready:function(){s.start(function(b){w.clearRect(0,0,320,480),q.p&&(q.update(b),k.update(b),d.update(b),a.update()),r[c]()})},start:function(){c="game",document.querySelector(".social").style.display="none",d=new l,d.init(),e=!1,k.init(),q.init()},pause:function(a){"game"===c&&d.pause(a)},end:function(){var a="I survived for "+q.stats.totalTimeSurvived+" seconds in the Tiny Dungeon http://js13kgames.com/entries/tiny-dungeon/";c="social",r.statsX=0,document.querySelector(".tweet").href="https://twitter.com/intent/tweet?text="+encodeURIComponent(a)+"&hashtags=js13k","_blank",document.querySelector(".share").href="http://www.facebook.com/sharer.php?s=100&p[title]=Tiny+Dungeon+js13k+Game&p[url]="+encodeURIComponent("http://js13kgames.com/entries/tiny-dungeon/")+"&p[summary]="+encodeURIComponent(a+" #js13k"),"_blank",document.querySelector(".social").style.display="block"}}}(window,document),u=function(a,b){var c={},d={init:function(){this.bind("start",t.start),this.bind("pause",t.pause),this.bind("first",t.first),this.bind("next",t.next),this.bind("last",t.last)},bind:function(a,b){c[a]||(c[a]=[]),c[a].push(b)},trigger:function(a,b){var d=c[a],e=Array.prototype.slice.call(arguments,1),f,g;if(d)for(f=d.length,g=0;g<f;g++)d[g].apply(t,e)}};return d.init(),d}(),function(a,b){function d(a,b){var c,d;if(g&&a.touches){if(a.touches.length>b)return;c=a[b?"touches":"changedTouches"][0].clientX,d=a[b?"touches":"changedTouches"][0].clientY}else c=a.clientX,d=a.clientY;return{x:c,y:d}}var e=!1,g="ontouchstart"in window,h={init:function(){var a=this;this.bind(b,"DOMContentLoaded",f.lAssets.call(f)),this.bind(b,"imgsL",t.init),this.bind(b,"gameReady",t.ready),this.bind(b,"gameEnd",t.end),this.bind(b,"mousedown touchstart",function(a){var b=d(a,1);"title"===c?u.trigger("start"):"game"===c&&(u.trigger("first",{x:b.x,y:b.y}),e=!0,a.preventDefault())}),this.bind(b,"mousemove touchmove",function(a){var b=d(a,1);"game"===c&&(e&&u.trigger("next",{x:b.x,y:b.y}),a.preventDefault())}),this.bind(b,"mouseup touchend",function(a){var b=d(a,0);"game"===c&&(u.trigger("last",{x:b.x,y:b.y}),e=!1,a.preventDefault())}),this.bind(document.querySelector(".again"),"mousedown touchstart",function(a){u.trigger("start"),a.preventDefault()}),function(){["webkit","moz","ms",""].forEach(function(c,d){c+"Hidden"in b&&a.bind(b,c+"visibilitychange",function(a){u.trigger("pause",!!b[c+"Hidden"])})})}()},bind:function(a,b,c){"string"==typeof a&&(a=document.querySelector(a)),0<=b.indexOf(" ")?b=b.split(" "):b=[b],b.forEach(function(b){a.addEventListener(b,c,!1)})}};return h.init(),h}(window,document)})() </script> </body> </html>