function Player(){this.y=this.x=this.targetY=-70,this.width=80,this.height=45;var t=!1,e=new Image;e.onload=function(){t=!0},e.src="ship.png",this.update=function(t,e){t>0&&(this.x=t-this.width/2),(this.y>this.targetY||e&&this.y>-this.height)&&(this.y-=10),this.y<-this.height&&!e&&(this.y=650)},this.draw=function(i){t&&i.drawImage(e,this.x,this.y,this.width,this.height)}}function Star(){this.s=random(5,20),this.o=random(1,10),this.v=1==random(1,2)?5:3,this.x=random(0,800),this.y=random(0,500),this.update=function(t){this.y=this.y>t?0:this.y+=this.v},this.draw=function(t){t.fillStyle="rgba(255,255,255,"+this.o/10+")",t.font=this.s+"px Arial",t.fillText(".",this.x,this.y)}}function Target(){this.element,this.x=this.y=0,this.height=this.width=50,this.v=4,this.update=function(t,e){this.y+=this.v;for(var i=t.bullets.length-1;i>=0;i--)if(collision(t.bullets[i],this))return t.bullets.splice(i,1),t.hitBullet(this,!1),!1;if(e)return t.bullets.splice(i,1),t.hitBullet(this,!0),!1;var s=collision(t.player,this);return this.y>t.height||s?(t.hit(this,s),!1):!0},this.draw=function(t){drawTarget(t,this.x,this.y,this.element)}}function Bullet(){this.width=15,this.height=10,this.x=this.y=0,this.update=function(){return this.y-=10,this.y>-this.height},this.draw=function(t){grd=t.createLinearGradient(0+this.x,5+this.y,10+this.x,5+this.y),grd.addColorStop(0,"rgba(0, 0, 0, 0)"),grd.addColorStop(.4,"rgba(191, 0, 0, 1)"),grd.addColorStop(.5,"rgba(252, 75, 75, 1)"),grd.addColorStop(.6,"rgba(191, 0, 0, 1)"),grd.addColorStop(.993,"rgba(0, 0, 0, 0)"),t.fillStyle=grd,t.fillRect(this.x,this.y,10,15)}}function Particle(t,e,i,s){function a(t,e,i,s,a){var r=e/2,n=s+r,o=a+r;t.beginPath(),t.arc(n,o,r,0,2*Math.PI,!1),t.fillStyle=i,t.fill()}this.width=t,this.x=e,this.y=i,this.vx=this.vy=0,this.scaleSpeed=1,this.colour=s,this.update=function(){return this.width-=.5*this.scaleSpeed,this.width<=0&&(this.width=0),this.x+=.5*this.vx,this.y+=.5*this.vy,this.width>0},this.draw=function(t){a(t,this.width,s,this.x,this.y)}}function Game(t,e){function i(t,e){for(var i=["#434343","#555656",t.element.colour],s=10;s>=0;s--)e.push(new Particle(random(5,20),t.x+random(-10,20),t.y+random(-10,20),i[random(0,2)]));play([3,,.6173,.1288,.2868,.06,,4e-4,.3461,-.1752,-.7647,.6851,,-.8441,-.699,.3373,-.0888,-.066,.1246,-.0443,.7543,.3621,.5783,.56])}function s(t){var e=new Date,i=e.today()+" "+e.timeNow(),s=getScores();s.push({date:i,score:t}),s=s.sort(function(t,e){return e.score-t.score}),s.splice(5),docCookies.setItem("a",JSON.stringify(s))}function a(t,e,i,s){t.textAlign="left",t.fillStyle="white",t.font="14px Lucida Console",t.fillText(e,i,s)}function r(){return Game.Elements[random(0,3)]}this.score,this.state,this.width=t,this.height=e,this.particles=[],this.aim=[],this.stars=[],this.bullets=[],this.targets=[],this.collected=[],this.hitBullet=function(t,e){e||(this.aim[0].id===t.element.id?this.score=Math.max(0,this.score-=200):this.score+=10),i(t,this.particles)},this.hit=function(t,e){e&&this.aim[0].id===t.element.id?(this.collected.push(this.aim.splice(0,1)),this.score+=300,play([2,,.0185,.5998,.3794,.5324,,,,,,,,,,,,,1,,,,,.76])):(i(t,this.particles),this.state=Game.States.End,s(this.score),play([0,,.3336,,.1194,.4606,,.144,,,,,,.5074,,,,,.4956,,,.0734,,.5])),0==this.aim.length&&this.levelUpBegin()},this.getScores=function(){return getScores()},getScores=function(){var t=docCookies.getItem("a");return null!=t?JSON.parse(t):[]},this.levelUpBegin=function(){if(this.state=Game.States.LevelUp,this.level++,this.collected){var t=this.collected.length-1;this.level%2==0&&t++;for(var e=t;e>=0;e--)this.aim.push(r())}this.collected=[],play([2,.14,.312,1e-4,.182,.5,,-.0016,.0317,,-.3134,.7661,.4703,.392,-.9496,-.8203,-.0139,-.8661,.7935,.1313,.0255,.2263,.0828,.28])},this.levelUpEnd=function(){this.levelReset(),play([3,.576,.1084,.1409,.648,.978,,4e-4,-.0108,-.4425,-.9875,-.0481,.5919,.2656,-.1962,.3111,.7334,-.1735,.9901,-.0484,.3699,.0024,,.4639])},this.drawScore=function(t){game.state!=Game.States.LevelUp&&(a(t,"Score "+this.score,this.width-100,20),a(t,"Mission "+this.level,20,20))},this.levelReset=function(){this.collected=[],this.state=Game.States.Playing,this.player.y=650,play([2,.14,.312,1e-4,.182,.5,,-.0016,.0317,,-.3134,.7661,.4703,.392,-.9496,-.8203,-.0139,-.8661,.7935,.1313,.0255,.2263,.0828,.28])},this.pause=function(){this.state==Game.States.Playing&&(this.state=Game.States.Pause,play([2,.14,.312,1e-4,.182,.5,,-.0016,.0317,,-.3134,.7661,.4703,.392,-.9496,-.8203,-.0139,-.8661,.7935,.1313,.0255,.2263,.0828,.28]))},this.start=function(){this.level=0,this.score=0,this.player=new Player,this.player.targetY=this.height-this.player.height-10,this.collected=[],this.aim=[],this.aim.push(r()),this.levelUpBegin()},this.addBullet=function(){var t=new Bullet;t.x=this.player.x+this.player.width/2-5,t.y=this.player.y,this.bullets.push(t),play([2,7e-4,.2614,.505,.2718,.5629,,-.3972,-.1386,,,.4762,,.2066,.0639,,-.0038,.0012,.9999,-.0062,.6467,.1699,.4125,.282])},this.addTarget=function(t){if(!(this.targets.length>0&&this.targets[0].y<=50||60!=t&&30!=t)){var e=new Target;e.element=r(),e.x=random(0,this.width-Target.width),e.y=-Target.height,this.targets.push(e)}},this.stars=[];for(var n=100;n>=0;n--)this.stars.push(new Star);this.state=Game.States.New}function random(t,e){return Math.floor(Math.random()*(e-t+1))+t}function getMousePos(t,e){var i=t.getBoundingClientRect();return{x:e.clientX-i.left,y:e.clientY-i.top}}function collision(t,e){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.height+t.y>e.y}function play(t){var e=new Audio;e.src=jsfxr(t),e.play()}function SfxrParams(){this.setSettings=function(t){for(var e=0;24>e;e++)this[String.fromCharCode(97+e)]=t[e]||0;this.c<.01&&(this.c=.01);var i=this.b+this.c+this.e;if(.18>i){var s=.18/i;this.b*=s,this.c*=s,this.e*=s}}}function SfxrSynth(){this._params=new SfxrParams;var t,e,i,s,a,r,n,o,h,l,c,u;this.reset=function(){var t=this._params;s=100/(t.f*t.f+.001),a=100/(t.g*t.g+.001),r=1-t.h*t.h*t.h*.01,n=-t.i*t.i*t.i*1e-6,t.a||(c=.5-t.n/2,u=5e-5*-t.o),o=1+t.l*t.l*(t.l>0?-.9:10),h=0,l=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.totalReset=function(){this.reset();var s=this._params;return t=s.b*s.b*1e5,e=s.c*s.c*1e5,i=s.e*s.e*1e5+12,3*((t+e+i)/3|0)},this.synthWave=function(d,g){var f=this._params,m=1!=f.s||f.v,p=f.v*f.v*.1,y=1+3e-4*f.w,v=f.s*f.s*f.s*.1,w=1+1e-4*f.t,S=1!=f.s,x=f.x*f.x,b=f.g,G=f.q||f.r,C=f.r*f.r*f.r*.2,k=f.q*f.q*(f.q<0?-1020:1020),P=f.p?((1-f.p)*(1-f.p)*2e4|0)+32:0,T=f.d,U=f.j/2,E=f.k*f.k*.01,I=f.a,M=t,R=1/t,L=1/e,A=1/i,B=5/(1+f.u*f.u*20)*(.01+v);B>.8&&(B=.8),B=1-B;for(var D,N,W,$,J,q,Y=!1,F=0,O=0,_=0,j=0,H=0,X=0,z=0,K=0,Q=0,V=0,Z=new Array(1024),te=new Array(32),ee=Z.length;ee--;)Z[ee]=0;for(var ee=te.length;ee--;)te[ee]=2*Math.random()-1;for(var ee=0;g>ee;ee++){if(Y)return ee;if(P&&++Q>=P&&(Q=0,this.reset()),l&&++h>=l&&(l=0,s*=o),r+=n,s*=r,s>a&&(s=a,b>0&&(Y=!0)),N=s,U>0&&(V+=E,N*=1+Math.sin(V)*U),N|=0,8>N&&(N=8),I||(c+=u,0>c?c=0:c>.5&&(c=.5)),++O>M)switch(O=0,++F){case 1:M=e;break;case 2:M=i}switch(F){case 0:_=O*R;break;case 1:_=1+2*(1-O*L)*T;break;case 2:_=1-O*A;break;case 3:_=0,Y=!0}G&&(k+=C,W=0|k,0>W?W=-W:W>1023&&(W=1023)),m&&y&&(p*=y,1e-5>p?p=1e-5:p>.1&&(p=.1)),q=0;for(var ie=8;ie--;){if(z++,z>=N&&(z%=N,3==I))for(var se=te.length;se--;)te[se]=2*Math.random()-1;switch(I){case 0:J=c>z/N?.5:-.5;break;case 1:J=1-z/N*2;break;case 2:$=z/N,$=6.28318531*($>.5?$-1:$),J=1.27323954*$+.405284735*$*$*(0>$?1:-1),J=.225*((0>J?-1:1)*J*J-J)+J;break;case 3:J=te[Math.abs(32*z/N|0)]}m&&(D=X,v*=w,0>v?v=0:v>.1&&(v=.1),S?(H+=(J-X)*v,H*=B):(X=J,H=0),X+=H,j+=X-D,j*=1-p,J=j),G&&(Z[K%1024]=J,J+=Z[(K-W+1024)%1024],K++),q+=J}q*=.125*_*x,d[ee]=q>=1?32767:-1>=q?-32768:32767*q|0}return g}}function ElementWar(){function t(){requestAnimationFrame(t,m.canvas),Date.now()>=f&&(e(),i(),p=60==p?0:p+=1,f=Date.now()+16.66)}function e(){var t=g.state==Game.States.LevelUp;if(g.state!=Game.States.Pause&&g.state!=Game.States.End){for(var e=g.stars.length-1;e>=0;e--)g.stars[e].update(v);(g.state==Game.States.Playing||t)&&(g.state==Game.States.Playing&&g.addTarget(p),g.player.update(m.mousePos.x,t),g.bullets=g.bullets.filter(function(t){return t.update()}),g.targets=g.targets.filter(function(e){return e.update(g,t)}),g.particles=g.particles.filter(function(t){return t.update()}))}}function i(){var t=m.canvas.ctx;switch(t.clearRect(0,0,y,v),s(t),g.state!=Game.States.New&&u(t),g.state){case Game.States.New:a(t);break;case Game.States.LevelUp:h(t);break;case Game.States.Pause:l(t);break;case Game.States.End:c(t)}}function s(t){grd=t.createLinearGradient(40,0,274,300),grd.addColorStop(0,"rgba(142, 178, 170, 0.2)"),grd.addColorStop(1,"rgba(255, 255, 255, 0.0)"),t.fillStyle=grd,t.fillRect(0,0,y,v);for(var e=g.stars.length-1;e>=0;e--)g.stars[e].draw(t)}function a(t){r(t,"Element War",v/2-25,90),t.font="16px Lucida Console",t.fillText("Click anywhere to start",y/2,v/2+70)}function r(t,e,i,s){t.textAlign="center",t.fillStyle="white";var a=t.createLinearGradient(0,300,700,200);a.addColorStop(0,"rgba(143, 165, 179, 1)"),a.addColorStop(1,"rgba(255, 255, 255, 0)"),t.strokeStyle=a,t.font=s+"px Century Gothic",t.lineWidth=3,t.strokeText(e,y/2,i),t.fillText(e,y/2,i)}function n(t,e,i){t.fillStyle="white",t.font="14px Lucida Console",t.fillText(e,y/2,i)}function o(t,e,i){t.beginPath(),t.fillStyle="rgba(30, 76, 100, 0.7)",t.strokeStyle="#8fa5b3",t.lineWidth=1,t.rect((y-e)/2,(v-i)/2,e,i),t.fill(),t.stroke()}function h(t){o(t,600,400),r(t,"Mission "+g.level,200,60);for(var e=y/2-g.aim.length/2*65,i=0;i<g.aim.length;i++)drawTarget(t,e+65*i,260,g.aim[i]);n(t,"Remember and collect the elements in order",400),n(t,"Destroy all other elements before they pass you.",425)}function l(t){o(t,400,150),r(t,"Mission Paused",290,45),n(t,"Press to continue playing!",330)}function c(t){o(t,400,350),r(t,"Game Over!",190,45),n(t,"Top Scores",250);for(var e=g.getScores(),i=0;4>i;i++){var s=e[i];s?n(t,i+1+".		"+s.date+"			"+s.score,300+40*i):n(t,i+1+".		-------------------------  ",300+40*i)}}function u(t){for(var e=g.targets.length-1;e>=0;e--)g.targets[e].draw(t);for(var e=g.bullets.length-1;e>=0;e--)g.bullets[e].draw(t);for(var e=g.particles.length-1;e>=0;e--)g.particles[e].draw(t);g.drawScore(t),g.player.draw(t)}function d(){m.canvas.addEventListener("mousedown",function(){g.state==Game.States.Playing?g.addBullet():g.state==Game.States.LevelUp?g.levelUpEnd():g.state==Game.States.Pause?g.state=Game.States.Playing:g.start()},!1),m.canvas.addEventListener("mouseout",function(){g.pause()},!1),m.mousePos={x:0,y:0},m.canvas.addEventListener("mousemove",function(t){var e=getMousePos(m.canvas,t);m.mousePos=e},!1)}var g,f,m={},p=0,y=800,v=600;this.start=function(){f=Date.now(),m.canvas=document.getElementById("game"),m.canvas.ctx=m.canvas.getContext("2d"),g=new Game(y,v),d(),t()}}Target.ElementSprite=new Image,Target.width=50,Target.height=50,drawTarget=function(t,e,i,s){grd=t.createRadialGradient(25+e,25+i,10,25+e,25+i,25),grd.addColorStop(0,"black"),grd.addColorStop(.3,s.colour),grd.addColorStop(1,"rgba(145, 141, 146, 0)"),t.fillStyle=grd,t.fillRect(e,i,Target.width,Target.height),""==Target.ElementSprite.src&&(Target.ElementSprite.src="elements.png"),t.drawImage(Target.ElementSprite,20*s.id,0,20,20,e+15,i+15,20,20)},Game.States={New:0,Playing:1,LevelUp:2,End:3,Pause:4},Game.Elements=[{id:0,colour:"rgba(57,66,255,1)"},{id:1,colour:"rgba(255,255,255,1)"},{id:2,colour:"rgba(246,7,46,1)"},{id:3,colour:"rgba(57,255,20,1)"}];var docCookies={getItem:function(t){return decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(t,e,i,s,a,r){if(!t||/^(?:expires|max\-age|path|domain|secure)$/i.test(t))return!1;var n="";if(i)switch(i.constructor){case Number:n=1/0===i?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+i;break;case String:n="; expires="+i;break;case Date:n="; expires="+i.toUTCString()}return document.cookie=encodeURIComponent(t)+"="+encodeURIComponent(e)+n+(a?"; domain="+a:"")+(s?"; path="+s:"")+(r?"; secure":""),!0},removeItem:function(t,e,i){return t&&this.hasItem(t)?(document.cookie=encodeURIComponent(t)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(i?"; domain="+i:"")+(e?"; path="+e:""),!0):!1},hasItem:function(t){return new RegExp("(?:^|;\\s*)"+encodeURIComponent(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},keys:function(){for(var t=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),e=0;e<t.length;e++)t[e]=decodeURIComponent(t[e]);return t}};Date.prototype.today=function(){var t=["January","February","March","April","May","June","July","August","September","October","November","December"];return(this.getDate()<10?"0":"")+this.getDate()+" "+t[this.getMonth()]+" "+this.getFullYear()},Date.prototype.timeNow=function(){return(this.getHours()<10?"0":"")+this.getHours()+":"+(this.getMinutes()<10?"0":"")+this.getMinutes()};var synth=new SfxrSynth;window.jsfxr=function(t){synth._params.setSettings(t);var e=synth.totalReset(),i=new Uint8Array(4*((e+1)/2|0)+44),s=2*synth.synthWave(new Uint16Array(i.buffer,44),e),a=new Uint32Array(i.buffer,0,44);a[0]=1179011410,a[1]=s+36,a[2]=1163280727,a[3]=544501094,a[4]=16,a[5]=65537,a[6]=44100,a[7]=88200,a[8]=1048578,a[9]=1635017060,a[10]=s,s+=44;for(var r=0,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o="data:audio/wav;base64,";s>r;r+=3){var h=i[r]<<16|i[r+1]<<8|i[r+2];o+=n[h>>18]+n[h>>12&63]+n[h>>6&63]+n[63&h]}return o};var game=new ElementWar;game.start();