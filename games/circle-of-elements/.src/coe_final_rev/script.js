var sources={blanc:"src/blanc.png",fire:"src/fire.png",water:"src/water.png",earth:"src/earth.png",wind:"src/wind.png",background:"src/background.png"};var images={};var display={};var possible=false;var score=0;var highscore=0;var lastMove;var lastMoveTxt="";var lastElement="";function start(){document.getElementById("highscore").innerHTML="Highscore: "+highscore;score=0;imageLoader()}
function move(dir){switch(dir){case 0:lastMoveTxt="left";for(var i=0;i<=8;i++)if(i%3!=0&&display[i]!=images.blanc){var win=match(i,i-1);if(possible){if(win)display[i-1]=display[i];display[i]=images.blanc}}break;case 1:lastMoveTxt="right";for(var i=8;i>=0;i--)if((i-2)%3!=0&&display[i]!=images.blanc){var win=match(i,i+1);if(possible){if(win)display[i+1]=display[i];display[i]=images.blanc}}break;case 2:lastMoveTxt="up";for(var i=0;i<=8;i++)if(i>2&&display[i]!=images.blanc){var win=match(i,i-3);if(possible){if(win)display[i-
3]=display[i];display[i]=images.blanc}}break;case 3:lastMoveTxt="down";for(var i=8;i>=0;i--)if(i<6&&display[i]!=images.blanc){var win=match(i,i+3);if(possible){if(win)display[i+3]=display[i];display[i]=images.blanc}}break}if(checkWin())prepare();else setScore()}
function imageLoader(){var itemsToLoad=0;var loadedItems=0;for(var i in sources)itemsToLoad++;for(var i in sources){images[i]=new Image;images[i].onload=function(){if(++loadedItems>=itemsToLoad){for(var j=1;j<=8;j+=2)display[j]=images.blanc;display[0]=images.fire;display[2]=images.water;display[4]=images.blanc;display[6]=images.earth;display[8]=images.wind;prepare()}};images[i].src=sources[i]}}
function prepare(){var next=Math.floor(Math.random()*4)+1;var nextImg;switch(next){case 1:nextImg=images.fire;break;case 2:nextImg=images.earth;break;case 3:nextImg=images.water;break;case 4:nextImg=images.wind;break}var freespace=0;for(var i=0;i<=8;i++)if(display[i]==images.blanc)freespace++;if(freespace>0){do var nextPos=Math.floor(Math.random()*9);while(display[nextPos]!=images.blanc);display[nextPos]=nextImg;updateCanvas()}else{lastElement="free space";setScore()}}
function match(choice1,choice2){var win=false;if(display[choice1]==images.blanc){possible=false;return}else if(display[choice2]==images.blanc)win=true;else if(display[choice1]==display[choice2]){possible=false;return}else if(display[choice1]==images.fire)if(display[choice2]==images.earth){win=true;score+=1}else if(display[choice2]==images.wind)win=false;else{possible=false;return}else if(display[choice1]==images.water)if(display[choice2]==images.wind){win=true;score+=1}else if(display[choice2]==images.earth)win=
false;else{possible=false;return}else if(display[choice1]==images.wind)if(display[choice2]==images.fire){win=true;score+=1}else if(display[choice2]==images.water)win=false;else{possible=false;return}else if(display[choice1]==images.earth)if(display[choice2]==images.water){win=true;score+=1}else if(display[choice2]==images.fire)win=false;else{possible=false;return}possible=true;return win}
function updateCanvas(){document.getElementById("score").innerHTML="Score: "+score;var game=document.getElementById("game");var ctx=game.getContext("2d");ctx.clearRect(0,0,game.width,game.height);ctx.drawImage(images.background,0,0);ctx.drawImage(display[0],50,50);ctx.drawImage(display[1],200,50);ctx.drawImage(display[2],350,50);ctx.drawImage(display[3],50,200);ctx.drawImage(display[4],200,200);ctx.drawImage(display[5],350,200);ctx.drawImage(display[6],50,350);ctx.drawImage(display[7],200,350);ctx.drawImage(display[8],
350,350)}function checkWin(){for(var i=0;i<=8;i++){if(display[i]==images.fire)var fireCheck=true;if(display[i]==images.water)var waterCheck=true;if(display[i]==images.wind)var windCheck=true;if(display[i]==images.earth)var earthCheck=true}if(!(fireCheck&&waterCheck&&windCheck&&earthCheck)){if(!fireCheck)lastElement="fire";else if(!waterCheck)lastElement="water";else if(!earthCheck)lastElement="earth";else if(!windCheck)lastElement="wind";return false}else return true}
function setScore(){if(score>highscore){highscoreTxt="Congratulations! You beat the highscore!";highscore=score}else highscoreTxt="Highscore: "+highscore;changeUI(6)}
function changeUI(id){var ui;switch(id){case 0:ui="<div style=' padding: 200px;'><p style='border: 1px solid black;' onclick='changeUI(1)'>Play</p><p style='border: 1px solid black; margin-top: 30px;' onclick='changeUI(2)'>Instructions</p><p style='border: 1px solid black; margin-top: 30px;' onclick='changeUI(5)'>About</p></div>";break;case 1:ui="<p><span id='score' width='250px'>Score: 0</span> | <span id='highscore' width='250px'>Highscore: "+highscore+"</span></p><canvas id='game' width='500' height='500'style='border:1px solid #000000;'></canvas><table id='buttons'><tr><td onclick='move(0)'>Left</td><td onclick='move(1)'>Right</td><td onclick='move(2)'>Up</td><td onclick='move(3)'>Down</td></tr></table><p><br/><b>Hint:</b> Fire > Earth > Water > Wind > Fire<br/><br/></p>";
document.getElementById("content").innerHTML=ui;start();break;case 2:ui="<div style='padding-top: 200px;'><p><b>Rules/Instructions</b><br><br>Goal<br><br>1. Keep at least one of each kind of element in the game<br>2. You get one score point for each battle you win (see rules below)</p><p style='margin-top: 30px;' onclick='changeUI(3)'><a>Next: How to play</a></p><p style='margin-top: 30px;' onclick='changeUI(0)'><a>Back</a></p></div>";break;case 3:ui="<div style='padding-top: 200px;'><p><b>Rules/Instructions</b><br><br>How to play:<br><br> 1. Click one of the buttons. All elements will now move by one step in this direction<br>2. The furthest elements in the respective direction will start. If an element cannot move any further because there is a wall or another element which cannot be batteled (see rules below) it will stop and be caught up by the next one behind it<br>3. After each move, a new element will spawn at a random position</p><p style='margin-top: 30px;' onclick='changeUI(2)'><a>Previous: Goal</a></p><p style='margin-top: 30px;' onclick='changeUI(4)'><a>Next: Rules</a></p><p style='margin-top: 30px;' onclick='changeUI(0)'><a>Back</a></p></div>";
break;case 4:ui="<div style='padding-top: 200px;'><p><b>Rules/Instructions</b><br>Rules<br><br>1. Fire burns Earth<br>2. Earth fills in Water<br>3. Water gets even stronger through Wind<br>4. Wind blows out Fire<br>5. Same elements; Fire and Water; Earth and Wind cannot fight against each other!<br>6. You only get score points when the attacking element (the moving one) wins the fight over the defending element (the one caught up)!</p><p style='margin-top: 30px;' onclick='changeUI(3)'><a>Previous: How to play</a></p><p style='margin-top: 30px;' onclick='changeUI(0)'><a>Back</a></p></div>";
break;case 5:ui="<div style='padding-top: 200px;'><p>Developed by Stefan Blamberg<br><br>This is my first game written in pure JavaScript without an engine.<br>Circle of Elements was created for the js13kGames Competition, which goal it is to create a game smaller than 13 kb.<br><br>The game works a bit like TicTacToe and is quiet puzzling.</p><p style='margin-top: 30px;' onclick='changeUI(0)'><a>Back</a></p></div>";break;case 6:ui="<div style='padding-top: 200px;'><p>Game over!<br><br>Your Score: "+
score+"<br><br>"+highscoreTxt+"</p><p style='margin-top: 30px;' onclick='changeUI(7)'><a>See your mistake</a></p><p style='margin-top: 30px;' onclick='changeUI(1)'><a>Play again!</a></p><p style='margin-top: 30px;' onclick='changeUI(0)'><a>Menu</a></p></div>";break;case 7:ui="<p><span id='score' width='250px'>Score: 0</span> | <span id='highscore' width='250px'>Highscore: "+highscore+"</span></p><canvas id='game' width='500' height='500'style='border:1px solid #000000;'></canvas><p>You lost the last <b>"+
lastElement+"</b> element by moving <b>"+lastMoveTxt+"</b>!</p><p style='margin-top: 30px;' onclick='changeUI(6)'><a>Back</a></p>";document.getElementById("content").innerHTML=ui;updateCanvas();return;break}document.getElementById("content").innerHTML=ui};
