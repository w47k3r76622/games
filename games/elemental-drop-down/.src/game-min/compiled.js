(function(){function a(a){if(c[a])return c[a];var g=new Image;g.onload=function(){c[a]=g;b()&&d.forEach(function(a){a()})};c[a]=!1;g.src=a}function b(){var a=!0,b;for(b in c)c.hasOwnProperty(b)&&!c[b]&&(a=!1);return a}var c={},d=[];window.resources={load:function(b){b instanceof Array?b.forEach(function(b){a(b)}):a(b)},get:function(a){return c[a]},onReady:function(a){d.push(a)},isReady:b}})();(function(){function a(a,d){var e=a.keyCode;switch(e){case 32:e="SPACE";break;case 37:e="LEFT";break;case 38:e="UP";break;case 39:e="RIGHT";break;case 40:e="DOWN";break;default:e=String.fromCharCode(e)}b[e]=d}var b={};document.addEventListener("keydown",function(b){a(b,!0)});document.addEventListener("keyup",function(b){a(b,!1)});window.addEventListener("blur",function(){b={}});window.input={isDown:function(a){return b[a.toUpperCase()]}}})();(function(){function a(a,c,d,e,g,k,n){this.pos=c;this.size=d;this.speed="number"===typeof e?e:0;this.frames=g;this._index=0;this.url=a;this.dir=k||"horizontal";this.once=n}a.prototype={update:function(a){this._index+=this.speed*a},render:function(a){var c;if(0<this.speed){var d=this.frames.length,e=Math.floor(this._index);c=this.frames[e%d];if(this.once&&e>=d){this.done=!0;return}}else c=0;d=this.pos[0];e=this.pos[1];"vertical"==this.dir?e+=c*this.size[1]:d+=c*this.size[0];a.drawImage(resources.get(this.url),
d,e,this.size[0],this.size[1],0,0,this.size[0],this.size[1])}};window.Sprite=a})();function SfxrParams(){this.setSettings=function(a){for(var b=0;24>b;b++)this[String.fromCharCode(97+b)]=a[b]||0;.01>this.c&&(this.c=.01);a=this.b+this.c+this.e;.18>a&&(a=.18/a,this.b*=a,this.c*=a,this.e*=a)}}
function SfxrSynth(){this._params=new SfxrParams;var a,b,c,d,e,g,k,n,B,C,p,L;this.reset=function(){var a=this._params;d=100/(a.f*a.f+.001);e=100/(a.g*a.g+.001);g=1-a.h*a.h*a.h*.01;k=-a.i*a.i*a.i*1E-6;a.a||(p=.5-a.n/2,L=5E-5*-a.o);n=1+a.l*a.l*(0<a.l?-.9:10);B=0;C=1==a.m?0:(1-a.m)*(1-a.m)*2E4+32};this.totalReset=function(){this.reset();var d=this._params;a=d.b*d.b*1E5;b=d.c*d.c*1E5;c=d.e*d.e*1E5+12;return 3*((a+b+c)/3|0)};this.synthWave=function(U,M){var f=this._params,N=1!=f.s||f.v,t=f.v*f.v*.1,O=
1+3E-4*f.w,q=f.s*f.s*f.s*.1,V=1+1E-4*f.t,W=1!=f.s,X=f.x*f.x,Y=f.g,P=f.q||f.r,Z=f.r*f.r*f.r*.2,F=f.q*f.q*(0>f.q?-1020:1020),Q=f.p?((1-f.p)*(1-f.p)*2E4|0)+32:0,$=f.d,R=f.j/2,aa=f.k*f.k*.01,G=f.a,H=a,ba=1/a,ca=1/b,da=1/c,f=5/(1+f.u*f.u*20)*(.01+q);.8<f&&(f=.8);for(var f=1-f,I=!1,S=0,x=0,y=0,D=0,v=0,z,w=0,l,r=0,u,J=0,h,T=0,s,K=0,E=Array(1024),A=Array(32),m=E.length;m--;)E[m]=0;for(m=A.length;m--;)A[m]=2*Math.random()-1;for(m=0;m<M;m++){if(I)return m;Q&&++T>=Q&&(T=0,this.reset());C&&++B>=C&&(C=0,d*=n);
g+=k;d*=g;d>e&&(d=e,0<Y&&(I=!0));l=d;0<R&&(K+=aa,l*=1+Math.sin(K)*R);l|=0;8>l&&(l=8);G||(p+=L,0>p?p=0:.5<p&&(p=.5));if(++x>H)switch(x=0,++S){case 1:H=b;break;case 2:H=c}switch(S){case 0:y=x*ba;break;case 1:y=1+2*(1-x*ca)*$;break;case 2:y=1-x*da;break;case 3:y=0,I=!0}P&&(F+=Z,u=F|0,0>u?u=-u:1023<u&&(u=1023));N&&O&&(t*=O,1E-5>t?t=1E-5:.1<t&&(t=.1));s=0;for(var ea=8;ea--;){r++;if(r>=l&&(r%=l,3==G))for(z=A.length;z--;)A[z]=2*Math.random()-1;switch(G){case 0:h=r/l<p?.5:-.5;break;case 1:h=1-r/l*2;break;
case 2:h=r/l;h=6.28318531*(.5<h?h-1:h);h=1.27323954*h+.405284735*h*h*(0>h?1:-1);h=.225*((0>h?-1:1)*h*h-h)+h;break;case 3:h=A[Math.abs(32*r/l|0)]}N&&(z=w,q*=V,0>q?q=0:.1<q&&(q=.1),W?(v+=(h-w)*q,v*=f):(w=h,v=0),w+=v,D+=w-z,h=D*=1-t);P&&(E[J%1024]=h,h+=E[(J-u+1024)%1024],J++);s+=h}s=.125*s*y*X;U[m]=1<=s?32767:-1>=s?-32768:32767*s|0}return M}}var synth=new SfxrSynth;
window.jsfxr=function(a){synth._params.setSettings(a);var b=synth.totalReset();a=new Uint8Array(4*((b+1)/2|0)+44);var b=2*synth.synthWave(new Uint16Array(a.buffer,44),b),c=new Uint32Array(a.buffer,0,44);c[0]=1179011410;c[1]=b+36;c[2]=1163280727;c[3]=544501094;c[4]=16;c[5]=65537;c[6]=44100;c[7]=88200;c[8]=1048578;c[9]=1635017060;c[10]=b;for(var b=b+44,c=0,d="data:audio/wav;base64,";c<b;c+=3)var e=a[c]<<16|a[c+1]<<8|a[c+2],d=d+("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e>>18]+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e>>12&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e>>6&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e&63]);return d};var requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}(),canvas=document.createElement("canvas"),ctx=canvas.getContext("2d");canvas.width=480;canvas.height=320;document.body.appendChild(canvas);var lastTime;function main(){var a=Date.now();update((a-lastTime)/1E3);render();lastTime=a;requestAnimFrame(main)}
function gbid(a){return document.getElementById(a)}
function init(){bgPattern=ctx.createPattern(resources.get(skyImg),"repeat");gbid("play-again").addEventListener("click",function(){reset()});gbid("go").addEventListener("click",function(){gbid("title").style.display="none";gbid("title-overlay").style.display="none";window.scrollTo(0,1)});canvas.addEventListener("touchstart",onTouchDown,!1);canvas.addEventListener("touchmove",onMouseMove,!0);canvas.addEventListener("touchend",onTouchUp,!1);document.body.addEventListener("touchcancel",onTouchUp,!1);
leftButton={pos:[.14*canvas.width,.8*canvas.height],sprite:new Sprite(leftImg,[0,0],[50,50],1,[0])};rightButton={pos:[.35*canvas.width,.8*canvas.height],sprite:new Sprite(rightImg,[0,0],[50,50],1,[0])};jumpButton={pos:[.8*canvas.width,.8*canvas.height],sprite:new Sprite(upImg,[0,0],[50,50],1,[0])};buttonsList=[jumpButton,rightButton,leftButton];reset();lastTime=Date.now();main()}
var playerImg="player.gif",terrainImg="terrain_mid.gif",fireImg="fireSheet.gif",windImg="windSheet.gif",waterImg="waterDrop.gif",skyImg="skyGradient.png",rightImg="right.gif",leftImg="left.gif",upImg="up.gif";resources.load([playerImg,terrainImg,fireImg,windImg,waterImg,skyImg,rightImg,leftImg,upImg]);resources.onReady(init);function mySprite(a,b,c,d,e,g,k,n,B){return{pos:[a,b],sprite:new Sprite(c,[d,e],[g,k],n,B)}}
var player={pos:[20,20],sprite:new Sprite(playerImg,[0,0],[15,30],10,[1])},walkLeftFrames=[0,1],walkRightFrames=[2,3],explosions=[],groundBlocks=[],fire=[],air=[],water=[],waterProjectiles=[],lastFire=Date.now(),gameTime=0,isGameOver,bgPattern,score=0,bestScore=0,scoreEl=gbid("score"),playerSpeed=0,playerAccel=90,maxSpeed=240,scrollSpeed=90,gravity=34,jumpPower=520,playerDY=0,MAX_FALL_SPEED=450,WIND=75,WIND_GRAVITY=26,hasWindPower=!1,leftPressed=!1,rightPressed=!1,jumpPressed=!1,jumpReleased=!0,groundCollisionFlag=
!1,playerHitCeilingFlag=!1,playerIsGroundedFlag=!1,playerDir=1,wasGrounded=!1,leftButton=null,rightButton=null,jumpButton=null,buttonsList=null,jumpButtonPressed=!1,rightButtonPressed=!1,leftButtonPressed=!1,hasMoved=!1,mouseDown=!1,touchDown=!1,mouseX=0,mouseY=0,screenTouches=null;
function update(a){gameTime+=a;wasGrounded=playerIsGroundedFlag;playerIsGroundedFlag=playerHitCeilingFlag=!1;handleInput(a);updateEntities(a);hasMoved?(scrollEs(groundBlocks,a),scrollEs(fire,a),scrollEs(air,a),scrollEs(water,a),scrollEs([player],a),Math.floor(gameTime/2.5)>Math.floor((gameTime-a)/2.5)&&addFloor(canvas.height+100)):gameTime-=a;checkCollisions();playerHitCeilingFlag&&playerIsGroundedFlag&&!isGameOver&&(gameOver(),fireSound());isGameOver?input.isDown("SPACE")&&reset():(score=Math.floor(gameTime),
scoreEl.innerHTML=score)}
function addFloor(a){for(var b=Math.ceil(canvas.width/20),c=Math.floor(Math.random()*b)-2,d=Math.floor(Math.random()*b)-2,e=a,g=0;g<b;g++){a+=Math.floor(20*Math.random()-10);10<Math.abs(e-a)&&(e=a);var k;k=g-c;0<k&&4>k||(k=g-d,0<k&&4>k||.02>Math.random()||(groundBlocks.push(makeGround(20*g,e)),.17>Math.random()&&(k=2*Math.random()+2,air.push({pos:[20*g+.6*canvas.width,e-20*k],sprite:new Sprite(windImg,[0,0],[20,20],10,randShift([0,1,2,1]))})),Math.random()<1-Math.pow(.993,gameTime)?fire.push({pos:[20*
g+10-7.5,e-15],sprite:new Sprite(fireImg,[0,0],[15,15],10,shuffle([0,1,2,3]))}):(groundBlocks.push(makeGround(20*g,e-20)),.02>Math.random()&&water.push({pos:[20*g,e-40],sprite:new Sprite(waterImg,[0,0],[20,20],1,[0])}))))}}function shuffle(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a}function randShift(a){for(var b=Math.floor(Math.random()*a.length),c=0;c<b;c++){var d=a[0];a.splice(0,1);a.push(d)}return a}
function makeGround(a,b){return{pos:[a,b],sprite:new Sprite(terrainImg,[0,0],[20,20],1,[0])}}
function handleInput(a){jumpButtonPressed=rightButtonPressed=leftButtonPressed=!1;updateMouseInput(screenTouches);leftPressed=input.isDown("LEFT")||input.isDown("a")||leftButtonPressed;rightPressed=input.isDown("RIGHT")||input.isDown("d")||rightButtonPressed;(jumpPressed=input.isDown("SPACE")||input.isDown("UP")||input.isDown("w")||jumpButtonPressed)||(jumpReleased=!0);(hasMoved=(a=hasMoved)||leftPressed||rightPressed||jumpPressed)&&!a&&(gbid("title").style.display="none",gbid("title-overlay").style.display=
"none",window.scrollTo(0,1))}
function updateEntities(a){player.sprite.update(a);var b=player.pos[0],c=player.pos[1],d=gravity;hasWindPower&&(d=WIND_GRAVITY);playerDY+=d;hasWindPower?playerDY>WIND&&(playerDY=WIND):playerDY>MAX_FALL_SPEED&&(playerDY=MAX_FALL_SPEED);c+=playerDY*a;d=0;leftPressed&&(d=-1);rightPressed&&(d=1);playerDir=d;playerSpeed+=d*playerAccel;playerSpeed*=.7;Math.abs(playerSpeed)>maxSpeed&&(playerSpeed=d*maxSpeed);b+=playerSpeed*a;d=player.pos[0];player.pos[0]=b;null!=collideEntities(player,groundBlocks)&&(player.pos[0]=
d);groundCollisionFlag=!1;c-=player.pos[1];d=sign(c);c=Math.abs(c);for(b=0;b<c;b++)if(player.pos[1]+=d,null!=collideEntities(player,groundBlocks)){playerDY=0;player.pos[1]-=d;break}groundCollisionFlag&&(hasWindPower=!1,playerIsGroundedFlag=!0);!wasGrounded&&playerIsGroundedFlag&&hitGroundSound();jumpPressed&&jumpReleased&&groundCollisionFlag&&(playerDY=-jumpPower,jumpReleased=!1,jumpSound());c=pingpong(Math.sin(gameTime),3)-1.5;for(b=0;b<air.length;b++)d=air[b],d.pos[0]+=c,-20>d.pos[0]&&(d.pos[0]=
canvas.width+20);for(b=0;b<waterProjectiles.length;b++)c=waterProjectiles[b],d=distance(c.pos,c.target),5>d?(waterProjectiles.splice(b,1),b--):(d=500*a/d,c.pos[0]=lerp(c.pos[0],c.target[0],d),c.pos[1]=lerp(c.pos[1],c.target[1],d));for(b=0;b<fire.length;b++)fire[b].sprite.update(a);for(b=0;b<air.length;b++)air[b].sprite.update(a)}function distance(a,b){var c=a[0]-b[0],d=a[1]-b[1];return Math.sqrt(c*c+d*d)}function lerp(a,b,c){return a+(b-a)*c}
function pingpong(a,b){for(var c=2*b;a>c;)a-=c;a>b&&(a=c-a);return a}function sign(a){return 0<a?1:0>a?-1:0}function scrollEs(a,b){for(var c=a.length-1;0<=c;c--){var d=a[c];d.pos[1]-=Math.floor(b*scrollSpeed);d.pos[1]<-d.sprite.size[1]&&a.splice(c,1)}}function collides(a,b,c,d,e,g,k,n){a=!(c<=e||a>k||d<=g||b>n);!a||b<n||(groundCollisionFlag=!0);return a}function boxCollides(a,b,c,d){return collides(a[0],a[1],a[0]+b[0],a[1]+b[1],c[0],c[1],c[0]+d[0],c[1]+d[1])}
function checkCollisions(){checkPlayerBounds();hasWindPower||playerIsGroundedFlag||null==collideEntities(player,air)||(hasWindPower=!0,windSound());var a=collideEntities(player,water);if(null!=a&&0<fire.length){for(var b=0;b<fire.length;b++)waterProjectiles.push({pos:[a.pos[0],a.pos[1]],sprite:new Sprite(waterImg,[0,0],[20,20],1,[0]),target:[fire[b].pos[0],fire[b].pos[1]]});fire=[];waterSound()}isGameOver||null==collideEntities(player,fire)||(gameOver(),fireSound())}
function collideEntities(a,b){for(var c=b.length,d=0;d<c;d++){var e=b[d];if(boxCollides(e.pos,e.sprite.size,a.pos,a.sprite.size))return e}return null}
function checkPlayerBounds(){0>player.pos[0]?player.pos[0]=0:player.pos[0]>canvas.width-player.sprite.size[0]&&(player.pos[0]=canvas.width-player.sprite.size[0]);0>player.pos[1]?(player.pos[1]=0,playerHitCeilingFlag=!0,0>playerDY&&(playerDY=0)):player.pos[1]>canvas.height-player.sprite.size[1]&&(player.pos[1]=canvas.height-player.sprite.size[1]-1,isGameOver||(gameOver(),fireSound()))}
function render(){ctx.fillStyle=bgPattern;ctx.fillRect(0,0,canvas.width,canvas.height);renderEs(groundBlocks);renderEs(fire);renderEs(air);renderEs(water);renderEs(waterProjectiles);isGameOver||(0<playerDir?player.sprite.frames=walkLeftFrames:0>playerDir?player.sprite.frames=walkRightFrames:player.sprite.frames==walkLeftFrames?player.sprite.frames=[1]:player.sprite.frames==walkRightFrames&&(player.sprite.frames=[2]),renderEs([player]));renderEs(buttonsList)}
function renderEs(a){for(var b=0;b<a.length;b++){var c=a[b];ctx.save();ctx.translate(c.pos[0],c.pos[1]);c.sprite.render(ctx);ctx.restore()}}function gameOver(){gbid("game-over").style.display="block";gbid("game-over-overlay").style.display="block";score>bestScore&&(bestScore=score);gbid("end-score").innerHTML="Final Score: "+score;gbid("best-score").innerHTML="Best Score: "+bestScore;isGameOver=!0}
function reset(){window.scrollTo(0,1);gbid("game-over").style.display="none";gbid("game-over-overlay").style.display="none";gbid("title").style.display="block";gbid("title-overlay").style.display="block";isGameOver=!1;score=gameTime=0;player.pos=[20,20];groundBlocks=[];fire=[];air=[];water=[];hasWindPower=!1;groundBlocks.push(makeGround(player.pos[0],player.pos[1]+80));addFloor(.75*canvas.height);addFloor(1.2*canvas.height);hasMoved=!1}
function onMouseMove(a){mouseX=a.pageX;mouseY=a.pageY;screenTouches=a.touches}function onTouchDown(a){onMouseMove(a)}function onTouchUp(a){onMouseMove(a)}function updateMouseInput(a){if(null!=a)for(var b=0;b<a.length;b++){var c=nearestButton(a[b].pageX,a[b].pageY,buttonsList);c==jumpButton?jumpButtonPressed=!0:c==rightButton?rightButtonPressed=!0:c==leftButton&&(leftButtonPressed=!0)}}
function nearestButton(a,b,c){a-=canvas.offsetLeft;a/=1.5;b/=1.5;for(var d=999999,e=null,g=0;g<c.length;g++){var k=distSquared(a,b,c[g].pos[0],c[g].pos[1]);k<d&&(d=k,e=c[g])}return e}function distSquared(a,b,c,d){a-=c;b-=d;return a*a+b*b}var soundsHashtable={};function playSound(a,b){if(null!=soundsHashtable[a])soundsHashtable[a].play();else{var c=jsfxr(b),d=new Audio;d.src=c;d.play();soundsHashtable[a]=d}}
function fireSound(){playSound("fire",[3,,.3801,.6534,.2899,.2148,,-.0684,,,,.3938,.8769,,,.7486,,,1,,,,,.34])}function hitGroundSound(){playSound("hitGround",[1,,.0308,,.2874,.502,,-.6323,,,,,,,,,,,1,,,,,.34])}function jumpSound(){playSound("jump",[0,,.2733,,.1748,.3053,,.2171,,,,,,.2731,,,,,.6673,,,,,.5])}function waterSound(){playSound("water",[2,.0017,.36,.4096,.09,.36,,.3799,-.46,,,-.46,,,-.0954,.61,,.176,.619,.4429,.7347,.453,2E-4,.23])}
function windSound(){playSound("wind",[3,.1899,.46,.1199,.2224,.624,,,-.043,,.2215,.0572,.8233,.0504,.1193,,.0533,-.1569,.9984,.0244,,.1093,1E-4,.25])};
