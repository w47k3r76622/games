window.$={};$.es="";$.elements=["Water","Ground","Fire","Wind"];$.PI2=Math.PI*2;window.onload=function(){$.Game()};$.get=function(a){return document.getElementById(a)};$.intersect=function(c,d){return(Math.abs(c.x-d.x)<(c.width+d.width)/2)&&(Math.abs(c.y-d.y)<(c.height+d.height)/2)};$.intersectWithArray=function(b,c){var a=0;for(var d=0;d<c.length;d++){if($.intersect(b,c[d])){a={e:c[d],i:d};break}}return a};$.ImageFactory=(function(){var b="resources/img/",d=".png",c={};function a(e){var f=null;if(!c[e+d]){f=new Image();f.src=b+e+d;c[e+d]=f}else{f=c[e+d]}return f}return{getImg:a}}());$.Sprite=(function(){function a(b,c){var d=$.ImageFactory.getImg(b);return{image:d,pos:c}}return{getSprite:a}}());$.SoundsFactory=(function(){var b="resources/sounds/",e=".wav",c={};function a(f,g){var h=null;if(!c[f+e]){h=new Audio(b+f+e);c[f+e]=h}else{h=c[f+e]}if(g){h.loop=true}h.play()}function d(f){var g=c[f+e];if(g){g.pause();g.currentTime=0}}return{play:a,stop:d}}());$.KEY_CODES={UP:38,DOWN:40,LEFT:37,RIGHT:39,R:114,r:82,ENTER:13};$.KeyEventListener=function(c){var d=[];function f(){e()}function e(){c.element.addEventListener("keyup",g,false);c.element.addEventListener("keydown",b,false)}function b(h){d[h.keyCode]=1;if(h.keyCode===$.KEY_CODES.r||h.keyCode===$.KEY_CODES.R){c.restart()}if(h.keyCode===$.KEY_CODES.ENTER){c.start()}}function g(h){d[h.keyCode]=0}function a(){return d}f();return{getKeys:a}};$.MouseEventListener=function(c){function b(){h()}function h(){c.element.addEventListener("mousemove",d,false);c.element.addEventListener("mousedown",g,false);document.addEventListener("contextmenu",e,false)}function d(k){var i=f(k),j=a(k);c.onMouseMove(i,j)}function g(k){var i=f(k),j=a(k);c.onClick(i,j,k.button)}function e(i){i.preventDefault()}function f(i){return i.clientX-c.element.offsetLeft}function a(i){return i.clientY-c.element.offsetTop}b()};$.Shape=(function(){function a(){}a.prototype.speed=1;a.prototype.x=10;a.prototype.y=10;a.prototype.width=32;a.prototype.height=32;a.prototype.vy=0;a.prototype.vx=0;a.prototype.id="";a.prototype.calculateAngle=function(b,c){return Math.atan2(c-this.y,b-this.x)*180/Math.PI};a.prototype.calculateDirection=function(b){var c=this.calculateAngle(b.target.x,b.target.y),d=c*Math.PI/180;this.vx=Math.cos(d)*this.speed;this.vy=Math.sin(d)*this.speed};a.prototype.generateId=function(){var b="",c,d;for(d=0;d<32;d++){if(d==8||d==12||d==16||d==20){b=b+"-"}c=Math.floor(Math.random()*16).toString(16).toUpperCase();b=b+c}return b};return a})();$.ProgressBar=(function(b){function a(c,d){this.width=c;this.height=d;this.x=0;this.y=0}a.prototype=Object.create(b.prototype);return a})($.Shape);$.Bg=(function(b){function a(c,d){this.x=0;this.y=0;this.width=c;this.height=d;this.offset_y=25;this.offset_x=55;this.spd=1}a.prototype=Object.create(b.prototype);a.prototype.move=function(c){if(c[$.KEY_CODES.UP]){if(this.y>0){this.y-=this.spd}}if(c[$.KEY_CODES.DOWN]){if(this.y<this.offset_y){this.y+=this.spd}}};a.prototype.getImage=function(){return $.ImageFactory.getImg("bg")};return a})($.Shape);$.Particle=(function(b){var a=10;function c(e,d){this.x=e;this.y=d;this.radius=1;this.vx=(-this.radius*(a/2))+Math.random()*a;this.vy=Math.random()*a}c.prototype=Object.create(b.prototype);c.prototype.move=function(){this.x+=this.vx;this.y+=this.vy;this.radius=Math.max(this.radius-0.05,0)};return c})($.Shape);$.Explosion=(function(a){function b(){this.x=0;this.y=0;this.particles=[];this.length=40;this.isExploting=0}b.prototype.explote=function(){if(this.isExploting){for(var c=0;c<this.length;c++){this.particles.push(new $.Particle(this.x,this.y))}}};b.prototype.create=function(c,d){this.x=c;this.y=d;this.color="#DF8C0C";this.isExploting=1};return b})($.Shape);$.Element=function(){return{getRandomElement:function(){var a=Math.floor(Math.random()*($.elements.length)),b=$.elements[a];return this.types[b]},types:{Water:{name:"Water",color:"#0180CA",sprite:$.Sprite.getSprite("sprite_elements",{x:40,y:0})},Fire:{name:"Fire",color:"#CA0F01",sprite:$.Sprite.getSprite("sprite_elements",{x:0,y:0})},Ground:{name:"Ground",color:"#655619",sprite:$.Sprite.getSprite("sprite_elements",{x:20,y:0})},Wind:{name:"Wind",color:"#00FF00",sprite:$.Sprite.getSprite("sprite_elements",{x:60,y:0})}},getWinner:function(b,a){return{Water:a.element.name==="Fire"?b:null,Fire:a.element.name==="Ground"?b:null,Ground:a.element.name==="Wind"?b:null,Wind:a.element.name==="Water"?b:null}[b.element.name]}}};$.Cursor=(function(a){function b(){this.color="#614126"}b.prototype=Object.create(a.prototype);b.prototype.move=function(c){this.x=c.x;this.y=c.y};b.prototype.getImage=function(){return $.ImageFactory.getImg("pointer")};return b})($.Shape);$.Bullet=(function(c){var a=null;function b(d){a=d;this.speed=50;this.x=a.origin.x;this.y=a.origin.y;this.size=4;this.element=$.es;this.color=this.element.color;this.calculateDirection(a)}b.prototype=Object.create(c.prototype);b.prototype.move=function(){this.x+=this.vx;this.y+=this.vy};return b})($.Shape);$.EnergyBar=(function(b){function a(c){this.x=c.x;this.y=c.y-(this.height*4);this.width=(c.health)*10;this.height=5;this.strokeColor="black";this.fillColor="red"}a.prototype=Object.create(b.prototype);a.prototype.move=function(c){this.x=c.x;this.y=c.y-(this.height*4)};return a})($.Shape);$.Hero=(function(a){function b(d,c){this.x=d/2;this.y=c/2;this.health=5;this.bullets=[];this.spd=5;this.angle=0;this.frame=1;this.underFire=0;this.cH=c;this.cW=d;this.energybar=new $.EnergyBar(this)}b.prototype=Object.create(a.prototype);b.prototype.shot=function(d){this.frame=0;var c=new $.Bullet({origin:{x:this.x+(this.width/2),y:this.y+(this.height/2)},target:{x:d.x,y:d.y}});if(this.bullets.length===0){this.underFire=1;this.bullets.push(c)}};b.prototype.getSprite=function(){return $.Sprite.getSprite("sprites",{x:!this.frame?0:(this.width*this.frame),y:0})};b.prototype.move=function(d,c){if(d[$.KEY_CODES.UP]){if((this.y-this.height/2)>0){this.y-=this.spd;if(!this.underFire){this.updateFrame()}}}if(d[$.KEY_CODES.DOWN]){if(this.y<(this.cH-this.height/2)){this.y+=this.spd;if(!this.underFire){this.updateFrame()}}}if(d[$.KEY_CODES.RIGHT]){if(this.x<(this.cW-this.width/2)){this.x+=this.spd;if(!this.underFire){this.updateFrame()}}}if(d[$.KEY_CODES.LEFT]){if((this.x-this.width/2)>0){this.x-=this.spd;if(!this.underFire){this.updateFrame()}}}if(!d[$.KEY_CODES.UP]&&!d[$.KEY_CODES.DOWN]&&!d[$.KEY_CODES.LEFT]&&!d[$.KEY_CODES.RIGHT]){if(!this.underFire){this.frame=1}}else{c(d)}this.energybar.move(this)};b.prototype.isAlive=function(){return this.health>0};b.prototype.updateFrame=function(){this.frame=this.frame<=2?this.frame+1:1};return b})($.Shape);$.Enemy=(function(b){function a(c){this.vectors=c;this.x=this.vectors.origin.x;this.y=this.vectors.origin.y;this.element=new $.Element().getRandomElement();this.sprite=this.element.sprite;this.health=1;this.speed=1;this.maxHealth=5;this.calculateDirection(this.vectors);this.id=this.generateId();this.isInCollision=0;this.energybar=new $.EnergyBar(this);this.width=20;this.height=20}a.prototype=Object.create(b.prototype);a.prototype.move=function(c){if(this.isInCollision&&c){this.vx=-this.vx;this.vy=-this.vy}this.x+=this.vx;this.y+=this.vy;this.energybar.move(this)};a.prototype.hurt=function(){this.health-=1};a.prototype.powerup=function(c){if(this.health<this.maxHealth){this.health+=1;this.speed+=0.1;return true}return false};a.prototype.isAlive=function(){return this.health>1};return a})($.Shape);$.Game=function(){var X=$.get("canvas"),j=$.get("progresscanvas"),I=$.get("current"),F=$.get("nameElement"),s=$.get("score"),V=$.get("time"),b=$.get("txtlevel"),p=$.get("txtenemies"),v=0,h,R,Q,o,w=60,m,B,H,y,K=1,c=[],W,l,u=0,a=0,ab=0.05,x=0,A,ae=1,g=5,r=0,e;function z(){X.width=1200;X.height=400;ac();Q=X.getContext("2d");o=j.getContext("2d");D();I.className=$.elements[x];F.innerHTML=$.elements[x];$.es=R[$.elements[x]];N()}function ac(){m=new $.Cursor();B=new $.Hero(X.width,X.height);h=new $.Explosion();A=new $.Element();H=new $.Bg(55,25);y=new $.ProgressBar(j.width,j.height);R=A.types;s.innerHTML="Score = 0";V.innerHTML="Seconds : "+ae;b.innerHTML="Level : "+K;p.innerHTML="Enemies : "+S();aa()}function N(){T();ad();if(a){if(!u){n();U();t();E();Q.drawImage(m.getImage(),m.x,m.y);h.explote();q();h.isExploting=0}else{G()}}else{Q.font="30px Arial";Q.strokeText("Press Enter to start",(X.width+250)/3,X.height/2)}setTimeout(N,w)}function n(){var af=W.getKeys();B.move(af,function(ag){H.move(ag);M()});if($.intersectWithArray(B,c)){if(B.isAlive()){B.health-=0.1}else{u=1}}$.HeroDrawable(B).draw(Q);$.EnergyBarDrawable(B.energybar).draw(Q,B.health)}function T(){$.BgDrawable(H).draw(Q,X.width,X.height)}function ad(){$.ProgressBarDrawable(y).draw(o,S(),r)}function G(){c=[];B.bullets=[];ab=0.05;K=1;r=0;clearInterval(e);ae=1;v=0;Q.font="30px Arial";Q.strokeText("Press R to try again",(X.width+250)/3,X.height/2)}function U(){var ah,af;for(var ag=0;ag<c.length;ag++){af=$.EnergyBarDrawable(c[ag].energybar);$.EnemyDrawable(c[ag]).draw(Q);if(i(c[ag])){c[ag].isInCollision=0;Y(c[ag])}ah=k(c[ag]);if(c[ag]){c[ag].move()}if(c[ag]){af.draw(Q,c[ag].health>=c[ag].maxHealth?c[ag].maxHealth:c[ag].health,true)}}}function aa(){var ag=S(),af=0;while(af<ag){var ah=P();if(ah.speed<=B.speed){ah.speed+=ab}c.push(ah);af++}}function P(){var af=C();while($.intersect(af,B)||$.intersectWithArray(af,c)){af=C()}return af}function C(){var ag={x:Math.floor(Math.random()*(X.width)),y:Math.floor(Math.random()*(X.height-X.height/4))},af=new $.Enemy({origin:ag,target:{x:B.x+(B.width/2),y:B.y+(B.height/2)}});return af}function t(){Q.beginPath();if(B.bullets.length===0){B.underFire=0}for(var ah=0;ah<B.bullets.length;ah++){var af=$.intersectWithArray(B.bullets[ah],c),ai=af.e;if(!ai){$.BulletDrawable(B.bullets[ah]).draw(Q)}else{var ag=A.getWinner(B.bullets[ah],ai);if(ag){if(ai.isAlive()){ai.hurt();$.SoundsFactory.play("hurt")}else{c.splice(af.i,1);h.create(ai.x,ai.y);s.innerHTML="Score = "+(++v*100);$.SoundsFactory.play("explote");r++;Z()}}else{if(B.bullets[ah].element.name===ai.element.name){ai.powerup();$.SoundsFactory.play("powerup")}}B.bullets.splice(ah,1)}}Q.fill()}function k(ag){var af=0;for(var ah=0;ah<c.length;ah++){if(ag.id!=c[ah].id&&($.intersect(ag,c[ah]))){if(ag.element.name===c[ah].element.name){if(ag.powerup()|c[ah].powerup()){$.SoundsFactory.play("powerup")}}else{ag.isInCollision=1;return c[ah]}break}}return af}function q(){$.ExplosionDrawable(h).draw(Q)}function E(){for(var af=0;af<B.bullets.length;af++){if(i(B.bullets[af])){B.bullets.splice(af,1)}}}function i(af){return((af.x>(X.width-af.width/2)||(af.x-af.width/2)<0)||(af.y>(X.height-af.height/2)||(af.y-af.height/2)<0))}function D(){W=new $.KeyEventListener({element:document,restart:d,start:f});l=new $.MouseEventListener({element:X,onMouseMove:J,onClick:O})}function d(){if(u){u=0;ac()}}function f(){if(!a&&!u){a=1;L()}}function J(af,ag){if(a){m.move({x:af,y:ag});B.angle=B.calculateAngle(af,ag);M()}}function O(af,ag,ah){var ai;if(a){if(ah){if(++x==$.elements.length){x=0}ai=$.elements[x];$.es=R[ai];I.className=ai;F.innerHTML=ai;return false}if(!u){B.shot({x:af,y:ag})}}}function M(){for(var af=0;af<c.length;af++){Y(c[af])}}function Y(af){if(!af.isInCollision){af.calculateDirection({target:{x:B.x,y:B.y}})}}function L(){if(a){e=setInterval(function(){++ae;V.innerHTML="Seconds : "+ae;if((ae%g)===0){ab+=0.05}},1000)}}function S(){return K*3-1}function Z(){var af=S();if(r===af){K++;c=[];r=0;aa();b.innerHTML="Level : "+K;p.innerHTML="Enemies : "+S()}}z()};$.HeroDrawable=function(c){var b;function d(){b=c}function a(e){var f=b.getSprite();e.save();e.translate(b.x,b.y);e.rotate(b.angle*Math.PI/180);e.drawImage(f.image,f.pos.x,f.pos.y,b.width,b.height,-(b.width/2),-(b.height/2),b.width,b.height);e.restore()}d();return{draw:a}};$.ExplosionDrawable=function(d){var a;function c(){a=d}function b(g){for(var f=0;f<a.particles.length;f++){var e=a.particles[f];g.beginPath();g.fillStyle=a.color;if(e.radius>0){g.arc(e.x,e.y,e.radius,0,$.PI2,false)}g.fill();e.move()}}c();return{draw:b}};$.BulletDrawable=function(c){var a;function e(){a=c}function d(b){a.move();b.fillStyle=a.color;b.arc(a.x,a.y,a.size,0,$.PI2,true);b.closePath()}e();return{draw:d}};$.EnergyBarDrawable=function(c){var d;function e(){d=c}function a(f,b,g){f.beginPath();f.strokeStyle=d.strokeColor;f.rect(d.x,d.y,g?(b||1)*10:d.width,d.height);f.stroke();f.closePath();f.beginPath();f.fillStyle=d.fillColor;f.fillRect(d.x,d.y,(b||1)*10,d.height);f.closePath()}e();return{draw:a}};$.EnemyDrawable=function(c){var d;function b(){d=c}function a(e){e.drawImage(d.sprite.image,d.sprite.pos.x,d.sprite.pos.y,d.width,d.height,d.x,d.y,d.width,d.height)}b();return{draw:a}};$.BgDrawable=function(a){var c;function d(){c=a}function b(e,k,j){var f=c.getImage(),g=0,i=0;for(;g<k;g+=c.width){for(;i<j;i+=c.height){e.drawImage(f,(g+c.x)-55,i+c.y)}}for(g=0;g<k;g+=c.width){for(i=0;i<j;i+=c.height){e.drawImage(f,g+c.x,i+c.y)}}for(g=0;g<k;g+=c.width){for(i=0;i<j;i+=c.height){e.drawImage(f,g+c.x,(i+c.y)-25)}}}d();return{draw:b}};$.ProgressBarDrawable=function(d){var a;function c(){a=d}function b(f,h,e){f.fillStyle="#F16745";f.fillRect(a.x,a.y,a.width,a.height);var g=(e*a.height)/h;f.fillStyle="#7BC8A4";f.fillRect(a.x,a.width/2,a.width,-g)}c();return{draw:b}};