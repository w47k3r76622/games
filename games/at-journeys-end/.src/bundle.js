!function(){"use strict";function n(n,t){return{x:n,y:t}}function t(n,t){return{r:n,a:t}}function e(n){return r(n.x,n.y,n.z)}function r(n,t,e){return void 0===e&&(e=0),{x:n,y:t,z:e}}function a(n,t,e){return{l:n,w:t,h:e}}function i(n,t){return{l:n,w:t}}function o(n,t,e){return void 0===e&&(e=0),Math.sqrt(n*n+t*t+e*e)}function c(n){return Math.sqrt(n.x*n.x+n.y*n.y)}function u(n){return f(i(n.x,n.y))}function l(n,t){return f(i(t.x-n.x,t.y-n.y))}function f(n){return t(o(n.l,n.w),Math.atan2(n.w,n.l))}function s(n){return r(n.r*Math.cos(n.a),n.r*Math.sin(n.a),0)}function y(n,t){return r(n.x+t.x,n.y+t.y,n.z+t.z)}function h(t,e){return n(t.x-e.x,t.y-e.y)}function m(t,e){return n(t.x+e.x,t.y+e.y)}function p(n){n.lib.globalCompositeOperation="source-over"}function x(t){function e(e){var l=t.cameraXYZ.z/(t.cameraXYZ.z-Math.min(e.z,u)),f=t.cameraXYZ.x+(e.x-t.cameraXYZ.x)*l,s=t.cameraXYZ.y+(e.y-t.cameraXYZ.y)*l,y=f-t.cameraXYZ.x,h=s-t.cameraXYZ.y,m=Math.atan2(h,y)-t.cameraAngle+3*Math.PI/2,p=o(y,h)*c;return n(r+a+p*Math.cos(m),r+i+p*Math.sin(m))}var r=0,a=t.canvasLW.l/2-r,i=.65*t.canvasLW.w-r,c=o(a,i)/t.worldViewRadius,u=.99*t.cameraXYZ.z;return{xyz:e,xyzs:function(n){return n.map(e)}}}function v(n){p(n),n.lib.font="18px Arial",n.lib.textAlign="left"}function d(n,t,e,r,a){var i=a.canvasLW.l/4-75,o=a.canvasLW.w/2-75;a.lib.fillStyle="rgba(200,200,200,"+(e<13?e-r:16-e)+")",a.lib.fillText(n,i,o+t)}function M(n,t,e){e.forEach(function(e){e.center.x+=n,e.center.y+=t})}function b(n,t){M(un=400,ln=102.5,t)}function w(n,t){if(gn){v(n),d("At journey's end,",-40,Yn,2,n),d("A meager cost;",0,Yn,3,n),d("A rite attend",40,Yn,5,n),d("To guide the lost.",80,Yn,6,n);var e=10-(Yn+=1/60)/2.5,r=Math.pow(e,2)+e/4,a=r-ln;t.forEach(function(n){return n.center.y+=a}),n.playerXY.x=un,n.playerXY.y=r-.5,n.cameraXYZ.y=r+Math.pow(Math.max(Math.min(e-2,50),0),2),ln=r,e<=0&&(gn=!1)}}function g(n,t){Yn=0,M(un=332,ln=-490,t)}function T(n,t){if(Tn){v(n),d("Look for me by moonlight;",-40,Yn,4,n),d("Watch for me by moonlight;",0,Yn,6,n),d("I'll come to thee by moonlight,",40,Yn,8,n),d("Though hell should bar the way.",80,Yn,10,n),d("       -- Alfred Noyes, The Highwayman",120,Yn,13,n);var e=(Yn+=1/60)/2.5,r=332-(Math.pow(e,2)+e/4),a=r-un;t.forEach(function(n){return n.center.x+=a}),n.playerXY.x=r-.5,n.playerXY.y=ln,e>1&&(n.cameraXYZ.x=r+Math.pow(Math.max(Math.min(e-2,50),0),2)),un=r,e>25&&(Tn=!1)}}function Y(n){M(999,0,n)}function X(n){for(var t=0,e=n.outputBuffer.getChannelData(0),r=0;r<Sn;r++){var a=2*Math.random()-1;e[r]=(t+.02*a)/1.02,t=e[r]}}function A(n,t,e){var r=new AudioContext,a=r.createGain();a.gain.value=Xn,a.connect(r.destination);var i=r.listener;i.setPosition(n.x,n.y,0);var o=e.map(function(n){var t=r.createPanner();return t.setPosition(n.x,n.y,0),t}),c=new kn(r,a,t,Wn,"bandpass",500),u=new Vn(r,a,"bandpass",666),l=new Vn(r,a,"lowpass",180),f=new Vn(r,a,"highpass",1500);return{context:r,totalGain:a,listener:i,lakePanners:o,organ:c,step:u,flame:l,wind:f}}function C(n,t,e){n.listener.setPosition(t.x,t.y,0),n.listener.setOrientation(e.x,e.y,0,0,1,0)}function P(n){function t(){var r=e[9];(e=e.map(function(n){return Math.random()>.6?Cn*Math.random():0}))[0]=r||e[0],n.wind.gain.gain.setValueCurveAtTime(e,n.context.currentTime,30),setTimeout(t,31e3)}var e=new Float32Array(10);t(),n.wind.processor.onaudioprocess=X}function z(n){n.step.filter.frequency.value=1500+1e3*Math.random();var t=n.context.currentTime+.05,e=t+.05+.1*Math.random(),r=e+.05+.1*Math.random();n.step.gain.gain.linearRampToValueAtTime(In+Math.random()*In,t),n.step.gain.gain.linearRampToValueAtTime(.001,e),n.step.gain.gain.setValueAtTime(0,r),n.step.processor.onaudioprocess=X}function I(n){n.flame.gain.gain.setValueAtTime(.01,n.context.currentTime),n.flame.gain.gain.exponentialRampToValueAtTime(Pn,n.context.currentTime+.4),n.flame.gain.gain.exponentialRampToValueAtTime(.01,n.context.currentTime+.6),n.flame.gain.gain.setValueAtTime(0,n.context.currentTime+.6),n.flame.processor.onaudioprocess=X}function S(n){function t(){e.forEach(function(t){var e=n.context.currentTime,r=.2+.2*Math.random();for(t.gain.linearRampToValueAtTime(zn,e);r<9.5;)t.gain.linearRampToValueAtTime(zn+(.2*Math.random()-.1),e+r),r+=.2+.2*Math.random()}),setTimeout(t,1e4)}var e=n.lakePanners.map(function(t){t.connect(n.totalGain);var e=n.context.createBiquadFilter();e.type="bandpass",e.frequency.value=400,e.connect(t);var r=n.context.createGain();r.connect(e);var a=n.context.createScriptProcessor(Sn,1,1);return a.onaudioprocess=X,a.connect(r),r});t()}function W(n,t){var e=t[0],r=(t[1],t[2]),a=t[3],i=n.context.createOscillator();i.frequency.value=0,i.setPeriodicWave(Rn(n.context)),i.connect(n.organ.filter);var o=n.context.currentTime+r,c=n.context.currentTime+a;i.frequency.setValueAtTime(e,o),n.organ.gain.gain.setValueAtTime(0,o),n.organ.gain.gain.linearRampToValueAtTime(An,o+.01),n.organ.gain.gain.linearRampToValueAtTime(.001,c+2),i.start(o),i.stop(c)}function Z(n,t,e,r){return e.split(",").map(function(e,a){return[qn[e],a,n,n+r*t]})}function E(n,t,e,r,a){var i=60/e,o=(n.context.currentTime,0),c=[];t.forEach(function(n){var t=n[0],e=n[1],r=Z(o,i,t,a/e);c=c.concat(r),o+=a/e*i}),c.forEach(function(t){return W(n,t)})}function R(n){E(n,[["C#1,C#2,C#3",1],["C#1,C#2,C#3",4],["C1,C2,C3",1],["C#1,C#2,C#3",1],["C#1,C#2,C#3",4],["C1,C2,C3",1],["C#1,C#2,C#3",1],["C#1,C#2,C#3",4],["D#1,D#2,D#3",1],["C#1,C#2,C#3",4],["D#1,D#2,D#3",4],["C1,C2,C3",4],["C#1,C#2,C#3",4],["A#0,A#1,A#2",1]],120,4,4),setTimeout(function(){return R(n)},2e4)}function V(){for(var n=1;n<5;n++){var t=.5*n*Math.PI/4;Fn.push(t),Fn.push(-t)}}function k(n,t,e){return r(n.x+Math.cos(t)*e,n.y+Math.sin(t)*e)}function L(n,t,e,r,a,i,o,c){var u=Fn.map(function(r){return k(n,t+r,e*Math.cos(.8*r))});return o.forEach(function(n){for(var t=u.length-1;t>=0;t--)n.collidesWith(u[t],r,a,i,c)&&u.splice(t,1)}),u.length?u[0]:n}function q(n,t){var e={};return n.forEach(function(n){var a=r(30*Math.floor(n.center.x/30)+15,30*Math.floor(n.center.y/30)+15),i=a.x+","+a.y,o=e[i]||F(a,30);e[i]=o,o.add(n,t)}),Object.keys(e).map(function(n){return e[n]})}function F(n,t){var e=[],a=t/2,i=o(a,a),u=r(n.x-a+.1,n.y-a+.1),l=r(n.x+a-.1,n.y+a-.1),f=function(n,t){return n.x>=u.x-a&&n.x<=l.x+a&&n.y>=u.y-a&&n.y<=l.y+a};return{center:n,maxSize:t,preventsTreeAt:function(n,t){return e.some(function(e){return e.preventsTreeAt(n,t)})},collidesWith:function(n,t,r,a,i){return f(n)&&e.some(function(e){return e.collidesWith(n,t,r,a,i)})},contains:function(n,t){return f(n)&&e.some(function(e){return e.contains(n,t)})},draw:function(t){c(h(t.cameraXYZ,n))<t.worldViewRadius+i&&e.forEach(function(n){return n.draw(t)})},add:function(n,t){n.maxSize<=a?e.push(n):t.push(n)}}}function O(n,t,e,a,i,o){void 0===a&&(a=!0);var u=function(r,a){return cn(n,t,e,r,a)};return{center:n,maxSize:Math.max(t.l,t.w),preventsTreeAt:u,collidesWith:function(n,t){return a&&u(n,t)},contains:u,draw:function(a){var u=Math.sqrt(t.l*t.l+t.w*t.w);if(!(c(h(n,a.cameraXYZ))-u>a.worldViewRadius)){var l=en(n,t,e),f=l.map(function(e){return r(e.x,e.y,n.z+t.h)}),s=l.map(function(n){return c(h(a.cameraXYZ,n))}),y=s.indexOf(Math.min.apply(Math,s)),m=a.transform.xyzs(l.concat(f));a.lib.fillStyle=i||"black",a.lib.globalCompositeOperation=o||(i?"overlay":"source-over"),[(y+3)%4,y].forEach(function(n){a.lib.beginPath();var t=(n+1)%4;rn(m[n],a),on([m[n+4],m[t+4],m[t],m[n]],a),a.lib.fill()}),a.lib.beginPath(),rn(m[4],a),on([m[5],m[6],m[7],m[4]],a),a.lib.globalCompositeOperation=o||(i?"multiply":"source-over"),a.lib.fill()}}}}function D(n,t,e,r){var a=h(e,n),i=t+r+.25;return a.x*a.x+a.y*a.y<i*i}function G(n,t,e,a,i){var o=function(e,r){return D(n,t,e,r)};return{center:n,maxSize:t,preventsTreeAt:o,collidesWith:o,contains:o,draw:function(o){var u=h(n,o.cameraXYZ),l=c(u);if(!(l>o.worldViewRadius)){var f=Math.atan2(u.y,u.x),s=Math.asin(t/l),y=f-s,m=f+s,p=r(o.cameraXYZ.x+Math.cos(y)*l,o.cameraXYZ.y+Math.sin(y)*l,n.z),x=r(o.cameraXYZ.x+Math.cos(m)*l,o.cameraXYZ.y+Math.sin(m)*l,n.z),v=o.transform.xyzs([p,x,n,r(o.cameraXYZ.x,o.cameraXYZ.y,0)]),d=n.z+e,M=r(p.x,p.y,d),b=r(x.x,x.y,d),w=o.transform.xyzs([M,b,r(n.x,n.y,d)]),g=c(h(w[0],w[2]));o.lib.fillStyle=a||"black",o.lib.globalCompositeOperation=i||(a?"overlay":"source-over"),o.lib.beginPath(),rn(v[0],o),an(w[0],o),e<3?o.lib.arcTo(v[3].x,v[3].y,w[1].x,w[1].y,g):o.lib.lineTo(w[1].x,w[1].y),o.lib.arcTo(v[3].x,v[3].y,w[0].x,w[0].y,c(h(v[0],v[2]))),o.lib.fill(),o.lib.beginPath(),o.lib.arc(w[2].x,w[2].y,g,0,2*Math.PI),o.lib.fill()}}}}function B(n,t,e,r,a,i,o){var u=function(r,a){return cn(n,t,e,r,a)};return{center:n,maxSize:Math.max(t.l,t.w),preventsTreeAt:function(n,t){return o&&u(n,t)},collidesWith:function(n,t){return i&&u(n,t)},contains:u,draw:function(i){if(r){if(c(h(n,i.playerXY))>i.worldViewRadius+Math.max(t.l,t.w))return;var o=en(n,t,e),u=i.transform.xyzs(o);i.lib.beginPath(),rn(u[0],i),on([u[1],u[2],u[3],u[0]],i),i.lib.fillStyle=r,i.lib.globalCompositeOperation=a,i.lib.fill()}}}}function j(e,a,o){a.w>a.l&&(a=i(a.w,a.l),o+=Math.PI/2);for(var c=[B(r(e.x,e.y,0),a,o,"#6d6d6d","multiply",!1,!0)],u=s(t(a.l,o)),l=h(e,u),f=m(e,u),y=function(n,t){return c.some(function(e){return e.contains(n,t)})},p=1;p<a.l-1;p+=4){var x=n(l.x+(f.x-l.x)*p/a.l,l.y+(f.y-l.y)*p/a.l);c.push(B(r(x.x,x.y,0),i(1,.15),o,"#fff","overlay",!1,!1))}return{center:e,maxSize:Math.max(a.l,a.l),preventsTreeAt:y,collidesWith:function(n,t){return!1},contains:y,draw:function(n){return c.forEach(function(t){return t.draw(n)})}}}function H(n,t,e,a,i,u){void 0===i&&(i=[255,255,255]),void 0===u&&(u=!1);var l="rgba("+i[0]+","+i[1]+","+i[2]+",";return{center:n,maxSize:t,preventsTreeAt:function(n,t){return!1},collidesWith:function(t,e,r,i){return i&&D(n,a,t,e)},contains:function(){return!1},draw:function(a){if(!(c(h(n,a.cameraXYZ))>a.worldViewRadius+t)){for(var i=a.transform.xyz(n),f=a.transform.xyz(y(n,r(t,0,0))),s=o(f.x-i.x,f.y-i.y),m=a.lib.createRadialGradient(i.x,i.y,0,i.x,i.y,s),x=e+e*(u?.1:0)*(.578-(Math.sin(a.time)+Math.sin(2.2*a.time+5.52)+Math.sin(2.9*a.time+.93)+Math.sin(4.6*a.time+8.94)))/4,v=1;v<21;v++){var d=15*Math.pow(v/20,2)+1,M=x/(d*d);M<.01&&(M=0),m.addColorStop((d-1)/15,l+M+")")}a.lib.fillStyle=m,p(a),a.lib.fillRect(i.x-s,i.y-s,2*s,2*s)}},setRadius:function(n){return t=n},setIntensity:function(n){return e=n}}}function N(n,e){var i=O(n,a(.27,.41,.9),e,!0,"red"),o=!0,c=y(n,s(t(.22,e+Math.PI/2))),u=[i,G(r(c.x,c.y,.9),.1,.01,"red")],l=function(n,t){return o&&u.some(function(e){return e.contains(n,t)})};return{center:n,maxSize:i.maxSize,preventsTreeAt:function(n,t){return!1},collidesWith:l,contains:l,draw:function(n){return o&&u.forEach(function(t){return t.draw(n)})},consume:function(){return o=!1}}}function J(t){for(var e=[],i=function(n,t,i){return e.push(O(r(n,t,0),a(.2,.2,1.2),i,!1))},o=0;o<t.length-2;o+=2)!function(n,t){for(var o=l(n,t),c=Math.ceil(o.r/3),u=(t.x-n.x)/c,f=(t.y-n.y)/c,s=0;s<c;s++){var y=n.x+u*s,h=n.y+f*s,m=y+u,p=h+f;i(y,h,o.a),e.push(O(r((y+m)/2,(h+p)/2,.7),a(o.r/c/2,.1,.1),o.a))}i(t.x,t.y,o.a)}(n(t[o],-t[o+1]),n(t[o+2],-t[o+3]));return e}function K(e){for(var i=[],o=function(n,t){return i.push.apply(i,[O(r(n.x,n.y),a(1,1,2),t),O(r(n.x,n.y),a(.8,.8,8),t,!1),O(r(n.x,n.y,8),a(1,1,1),t,!1)])},c=function(n,t){return i.push(O(r(n.x,n.y),a(.1,.1,9),t,!1))},u=function(n,t,e,o){return i.push(O(r((n.x+t.x)/2,(n.y+t.y)/2,e),a(o.r/2,.1,.1),o.a))},f=0;f<e.length-2;f+=2)!function(n,e){var r=l(n,e);o(n,r.a),o(e,r.a);for(var a=1.5;a<r.r-1.5;a++)c(m(n,s(t(a,r.a))),r.a);u(n,e,2,r),u(n,e,7,r)}(n(e[f],-e[f+1]),n(e[f+2],-e[f+3]));return i}function Q(e,a){for(var i=.9,c=function(){return Math.random()/2+.3},u=function(){return Math.random()<.15?1:30},l=[],f=0;f<e.length-2;f+=2)!function(n,e){var f=c(),y=c();l.push(G(r(n.x,n.y,0),f,u())),l.push(G(r(e.x,e.y,0),y,u()));for(var h,p=0,x=n;;p++){var v=function(n,p){var x=o(e.x-p.x,e.y-p.y)-f-y;if(x<i)return h=p,"break";var v=Math.atan2(e.y-p.y,e.x-p.x),d=Math.min(c(),x/2),M=i-Math.random()*i,b=t(f+M+d,v+1.6*Math.random()-.8),w=r((p=m(p,s(b))).x,p.y,0);a.some(function(n){return n.preventsTreeAt(w,d)})||l.push(G(w,d,u()));var g=m(p,s(t(2+2*Math.random(),b.a+Math.PI/2*(n%2?1:-1)))),T=r(g.x,g.y,0);c(),a.some(function(n){return n.preventsTreeAt(T,43)})||l.push(G(T,43,u())),f=d,h=p}(p,x);if(x=h,"break"===v)break}}(n(e[f],-e[f+1]),n(e[f+2],-e[f+3]));return l}function U(n){return[O(r(n[0]-.5,-n[1]),a(.25,4.5,2),n[2]),O(r(n[0],-n[1]),a(.75,4.5,1),n[2])]}function $(n){return[O(r(n[0],.4-n[1],.4),a(.35,1,.1),0,!1,"#a3a3a3","source-over"),O(r(n[0]-.2,-n[1],.4),a(.2,.5,.1),6.1,!1,"#a3a3a3","source-over"),O(r(n[0]+.2,-n[1],.4),a(.2,.5,.1),.2,!1,"#a3a3a3","source-over"),G(r(n[0]-.2,-n[1]-.5,.4),.25,.2,"#a3a3a3","source-over"),G(r(n[0]+.2,-n[1]-.5,.4),.25,.2,"#a3a3a3","source-over"),G(r(n[0],-n[1]-.5,.4),.35,.2,"#a3a3a3","source-over"),G(r(n[0],-n[1]-1.1,.4),.35,.2,"#a3a3a3","source-over")]}function _(){var n=r(0,0,0),e=function(t,e){return D(n,.1,t,e)},a=function(n){if(n.now>n.safeTime&&n.health>0){n.safeTime=n.now+1e3,n.health--,n.pain=1}};return{center:n,maxSize:.1,preventsTreeAt:function(n,t){return!1},collidesWith:function(n,t,r,i,o){return!r&&(!!e(n,t)&&(a(o),!0))},contains:e,draw:function(e){n.x=e.playerXY.x,n.y=e.playerXY.y;var r=On.map(function(r){return y(n,s(t(2*o(r.x,r.y),Math.atan2(r.y,r.x)+e.playerAngle-1.5*Math.PI)))}),a=e.transform.xyzs(r);e.lib.beginPath(),e.lib.moveTo(a[0].x,a[0].y);for(var i=1;i<a.length;i+=3)e.lib.bezierCurveTo(a[i].x,a[i].y,a[i+1].x,a[i+1].y,a[i+2].x,a[i+2].y);e.lib.fillStyle="black",p(e),e.lib.fill()}}}function nn(e){function r(n){for(var t=h(e,n.playerXY),r=Math.atan2(t.y,t.x),a=2*Math.PI,i=n.playerAngle;i>a;)i-=a;for(;i<-a;)i+=a;return Math.abs(Math.PI-Math.abs(Math.abs(i-r)-Math.PI))<1.2}function a(n,t,r){var a=u(n),i=L(e,a.a,a.r,.7,!1,!0,t,r);e.x=i.x,e.y=i.y}function i(n,t){c(h(n.playerXY,e))<20&&(f=l)}function o(n,r){g>0?g-=.01:f=i,a(s(t(.2,u(h(n.playerXY,e)).a+Math.PI)),r,n)}function l(i,l){var y=c(h(i.playerXY,e)),m=u(h(i.playerXY,e)),p=n(0,0),Y=i.now/1e3,X=(3+2*(.75-i.lanternIntensity))/100,A=y<6-3*i.lanternIntensity;if(y<8*i.lanternIntensity){if(g+=1/60,!A){var C=s(t(1*X*(1+g/T),m.a+Math.PI));p.x+=C.x,p.y+=C.y}}else g>0&&(g-=1/120);if(g>T&&(f=o,x=!1,v=!1),y<9*i.lanternIntensity&&!A&&(x=!1),y>10*i.lanternIntensity&&(x=!0),y>36&&(x=!1),A&&(x=!0),i.lanternIntensity<.2&&(x=!0),x&&(Y>b&&(v=!0,w=Y,d=2.5*Math.random()+.5,b=Y+d+(i.lanternIntensity+.5)*(r(i)?Math.pow(32*Math.random(),.5):Math.pow(Math.random(),2)),M=r(i)?4*Math.random()-2:2.8*Math.random()-1.4,y>20&&y<36&&(b=Y+d,M=Math.random()-.5)),v&&Y<w+d)){var P=s(t((.5-Math.abs((Y-w)/d-.5))*X*12,M+m.a));p.x+=P.x,p.y+=P.y}a(p,l,i)}var f,m=G(e,.7,30,"#000"),x=!1,v=!1,d=0,M=0,b=0,w=0,g=0,T=5;f=i;var Y=function(n,t){return m.contains(n,t)};return{center:e,maxSize:m.maxSize,preventsTreeAt:function(n,t){return Y(n,t)},collidesWith:function(n,t,e,r,a){return!r&&m.collidesWith(n,0,e,r,a)},contains:Y,draw:function(n){m.draw(n);var r=u(h(n.playerXY,e)),a=r.r,i=n.lanternIntensity>.2?(20-a)/25*n.lanternIntensity+.2:(5-a)/8,o=Math.round(255*Math.max(Math.min(i,1),0)),c=y(e,s(t(.4,r.a+1))),l=y(e,s(t(.4,r.a-1))),f=n.transform.xyz(c),x=n.transform.xyz(l);n.lib.beginPath(),n.lib.moveTo(f.x,f.y),n.lib.arc(f.x,f.y,2.5,0,2*Math.PI),n.lib.moveTo(x.x,x.y),n.lib.arc(x.x,x.y,2.5,0,2*Math.PI),p(n),n.lib.fillStyle="rgba("+o+",0,0,1)",n.lib.fill()},update:function(n,t){return f(n,t)}}}function tn(n){function e(n){return(.578-(Math.sin(n)+Math.sin(2.2*n+5.52)+Math.sin(2.9*n+.93)+Math.sin(4.6*n+8.94)))/4}function a(r,a){var i=c(h(r.playerXY,n));!d&&i<o&&(d=!0,r.spiritFound=!0),d&&i>f&&(M=!0);var l=r.now/1e3*.8;d&&(n.x+=e(l)/20,n.y+=e(l+16)/20);var y=u/50+Math.max(Math.min(i-f,15),0)/20;if(d&&M)if(i<f)M=!1;else{var m=s(t(y,Math.atan2(r.playerXY.y-n.y,r.playerXY.x-n.x)));n.x+=m.x,n.y+=m.y}}var i=H(n,15,1,0,[122,194,255]),o=6,u=1,f=4,m=[],x=[],v=[],d=!1,M=!1;return{center:n,maxSize:.3,preventsTreeAt:function(n,t){return!1},collidesWith:function(n,t){return!1},contains:function(n,t){return!1},draw:function(e){if(i.draw(e),m.push(r(n.x,n.y)),m.length>30){m.splice(0,1);var a=m[0],o=m[14],u=l(o,n),f=y(n,s(t(.3,u.a+Math.PI/2))),d=y(n,s(t(.3,u.a-Math.PI/2)));if(x.push(f),v.push(d),x.length>30){x.splice(0,1),v.splice(0,1);var M=x[14],b=v[14],w=e.transform.xyzs([n,o,a,f,d,M,b]);e.lib.beginPath(),e.lib.moveTo(w[4].x,w[4].y),e.lib.bezierCurveTo(w[6].x,w[6].y,w[2].x,w[2].y,w[2].x,w[2].y),e.lib.bezierCurveTo(w[5].x,w[5].y,w[3].x,w[3].y,w[3].x,w[3].y),p(e),e.lib.fillStyle="#fff",e.lib.fill(),e.lib.beginPath(),e.lib.arc(w[0].x,w[0].y,c(h(w[0],w[3])),0,2*Math.PI),e.lib.fill()}}},update:function(n,t){return a(n)}}}function en(n,e,r){var a=f(e);return[t(a.r,a.a+r),t(a.r,Math.PI-a.a+r),t(a.r,Math.PI+a.a+r),t(a.r,-a.a+r)].map(function(t){return y(n,s(t))})}function rn(n,t){t.lib.moveTo(n.x,n.y)}function an(n,t){t.lib.lineTo(n.x,n.y)}function on(n,t){n.forEach(function(n){return an(n,t)})}function cn(n,e,r,a,i){var o=h(a,n),u=m(s(t(c(o),Math.atan2(o.y,o.x)-r)),n);return u.x>=n.x-e.l-i&&u.x<=n.x+e.l+i&&u.y>=n.y-e.w-i&&u.y<=n.y+e.w+i}var un,ln,fn=[[312.5,383,0,.3,1.4,2],[310,390,0,.3,1.4,2],[314,377,0,1.3,1.3,1],[314,377,1,.8,.8,3],[293,370,0,.3,1.4,2],[293,373,0,.3,1.4,2],[319,378,0,1.4,.3,2],[311,359,0,1.4,.3,2],[302,359,0,1.4,.3,2],[316,359,0,1.3,1.3,1],[316,359,1,.8,.8,3],[292,405,1.5,.2,.2,1.2],[292,405,0,.2,1,1.5],[292,405,2.2,.2,.6,.2],[292,400,.6,1,1.6,.3],[292,400,.6,.6,1,1.6],[302,417,0,1.4,.3,2],[311,417,0,1.4,.3,2],[317.3,417.1,0,1.3,1.3,1],[317.3,417.1,1,.8,.8,3],[306,392,0,.4,2,.8],[326,370,0,.3,1.4,2],[327,404,0,.3,1.4,2],[467,490,0,1.5,3.5,.1],[466.3,490,0,.1,3.5,.8],[467.7,490,0,.1,3.5,.8],[467,491.7,0,1.5,.1,.8],[467,488.3,0,1.5,.1,.8],[466.8,490,.4,.4,1,.2,6,4],[467,489.6,.4,.7,2,.2,0,4],[467.2,490,.4,.4,1,.2,0,4],[519.6,234.1,0,2,26.5,2,6,1],[509.8,247,0,1.2,11.9,2,5,1],[513.3,251.3,0,1.7,11.9,2],[377.2,385,.4,.4,1,.2,0,4],[377,384.6,.4,.7,2,.2,0,4],[376.8,385,.4,.4,1,.2,6,4],[203,150.9,0,.8,11.1,50],[424,18,0,.8,4,50],[377,383.3,0,1.5,.1,.8],[494.8,209.3,1.8,2,.2,.2,5,1],[206,237.6,0,.2,.2,2],[377,386.7,0,1.5,.1,.8],[306,388,2.2,.2,.6,.2],[494.9,211.1,1.8,1,.3,.2],[206.8,162,0,7,.8,50],[494.9,211.1,0,1,.3,.2],[206.5,230.6,1.4,.2,3.2,.4,6,1],[434.8,4,0,2.7,.8,50],[425.1,4,0,2.7,.8,50],[480.5,222.7,0,.2,3.1,.2,6,1],[424,12,0,.8,4,50],[427.8,20,0,8,.8,50],[110,387.5,.4,.2,.2,10.2,5,1],[112.2,393.7,.4,4.5,.2,.2,1,1],[436,12,0,.8,16,50],[306,381,0,.3,1.4,2],[435,20,0,2,.8,50],[477,225.6,0,.2,.2,1],[65,367,0,20,22,25],[86.5,253.6,0,1.5,.2,.2],[110,386.4,.4,.2,.2,9.5,5,1],[424.1,242.6,3.3,.1,1.2,1.6],[424,242.6,0,.2,.2,5],[112.2,393.7,4.2,4.5,.2,.2,1,1],[327,400,.6,.6,1,1.6],[206.5,234.6,.7,.2,3.2,.4],[209,167,0,.8,10,50],[217,171.4,0,.8,2,50],[217,153.3,0,.8,3,2],[110,387.5,4.2,4.5,.2,.2,5,1],[21.7,147,0,1.7,11.9,2,6,1],[494.8,209.3,0,2,.2,.2,5,1],[86,257.6,0,1.5,.2,.2],[206,237.6,0,1.5,.2,.2],[206.5,233.6,0,.2,.2,2],[377.7,385,0,.1,3.5,.8],[206,238.6,.7,.2,3.2,.4],[86.5,251.6,0,.2,.2,2],[207.4,145,0,9.7,.8,50],[424,9,0,.8,2,2],[113.1,393.2,.4,.2,.2,10.8,1,1],[210.9,143.8,0,.3,3,50,4,1],[448.5,475.5,0,61.7,1,50],[111.2,394.3,.4,.2,.2,9.5,1,1],[495.4,211.1,0,.2,2.3,2],[206.5,235.6,0,1.5,.2,.2],[20.8,141.6,0,1.2,11.9,2,5,1],[327,400,.6,1,1.6,.3],[306,388,0,.2,1,1.5],[86.3,249.6,0,1.5,.2,.2,6,1],[206.3,231.6,0,1.5,.2,.2,6,1],[86,255.6,0,.2,.2,2],[385,385,0,1,30,50],[214.7,162,0,4,.8,50],[112.2,393.7,8.2,4.5,.2,.2,1,1],[306,392,0,.4,1.4,1],[86,257.6,0,.2,.2,2],[377,385,0,1.5,3.5,.1],[35.7,135.2,0,2,26.5,2,5,1],[314,377,1,.8,.8,3],[206,238.6,1.4,.2,3.2,.4],[86.5,252.6,.7,.2,3.2,.4],[335,395,0,1,10,50],[86.3,249.6,0,.2,.2,2,6,1],[72,318,0,18,16,25],[213,172,0,8.8,.8,50],[217,156.2,0,.8,3,50],[306,388,1.5,.2,.2,1.2],[206.5,234.6,1.4,.2,3.2,.4],[86.5,251.6,0,1.5,.2,.2],[206,239.6,0,.2,.2,2],[217,162,0,.8,3,50],[217,159,0,.1,3,50],[42.2,421,0,22,26,25],[86,256.6,1.4,.2,3.2,.4],[217,153.3,7,.2,3,.2],[217,153.3,0,.2,.2,50],[494.8,212.9,1.8,2,.2,.2,1,1],[203,160.9,0,.8,3,50],[16,334,0,20,22,25],[110.3,394.8,.4,.2,.2,8.5,1,1],[86.8,247.7,0,.2,.2,2,6,1],[206.5,230.6,.7,.2,3.2,.4,6,1],[203,158,7,.2,3,.2],[206.3,231.6,0,.2,.2,2,6,1],[332.2,379,0,5,.5,50,6,1],[68,337,0,26,22,25],[203,157.9,0,.8,3,2],[86.5,253.6,0,.2,.2,2],[332.2,390.9,0,5,.5,50],[475,490,0,1,30,50],[217,148.6,0,.8,6.5,50],[335,374.9,0,1,10,50],[114.1,392.6,.4,.2,.2,11,1,1],[86,255.6,0,1.5,.2,.2],[112.2,393.7,.4,.2,.2,10.2,1,1],[206.5,235.6,0,.2,.2,2],[29,200.7,3.3,.1,1.2,1.6,5,1],[29,200.6,0,.2,.2,5,5,1],[493.8,211.3,0,1.2,7,2],[481.7,220.7,.2,1.5,1.5,.1,5,1],[206,239.6,0,1.5,.2,.2],[314,377,0,1.3,1.3,1],[206.5,233.6,0,1.5,.2,.2],[110,388.6,.4,.2,.2,10.8,5,1],[86,256.6,.7,.2,3.2,.4],[110,387.5,8.2,4.5,.2,.2,5,1],[456.1,504.5,0,60.6,1,50],[360,399.5,0,50,1,50],[86.8,247.7,0,1.5,.2,.2,6,1],[86.5,252.6,1.4,.2,3.2,.4],[203,158,0,.2,.2,50],[206.8,229.7,0,1.5,.2,.2,6,1],[424,6,0,.8,4,50],[216.1,145,0,2.5,.8,50],[61.2,424,0,16,18,25],[86.5,248.6,.7,.2,3.2,.4,6,1],[494.8,212.9,0,2,.2,.2,1,1],[376.3,385,0,.1,3.5,.8],[360,370.5,0,50,1,50],[471,251,0,.4,6.4,50],[470,248,0,2,.4,50],[463,251,0,.4,6.4,50],[467,254,0,8,.4,50],[465,248,0,4,.4,50],[29,311.7,3.3,.1,1.2,1.6,5,1],[29,311.6,0,.2,.2,5,5,1],[110,389.7,.4,.2,.2,11,5,1],[206.8,229.7,0,.2,.2,2,6,1],[351.1,226.6,3.3,.1,1.2,1.6],[351,226.6,0,.2,.2,5],[110,385.4,.4,.2,.2,8.5,5,1],[86.5,248.6,1.4,.2,3.2,.4,6,1],[19,370,0,20,28,25],[110,387.5,.4,4.5,.2,.2,5,1]],sn=[[474.5,248,0,.3,5,1],[474.5,248,5,.6,.2,1],[466.8,490.5,.4,.5,.2,4],[467,490.5,.4,.7,.2,4],[467.2,490.5,.4,.5,.2,4],[467,491.1,.4,.7,.2,4],[527.1,220.6,0,2.5,2,1],[377,386.1,.4,.7,.2,4],[377.2,385.5,.4,.5,.2,4],[377,385.5,.4,.7,.2,4],[376.8,385.5,.4,.5,.2,4],[104.5,397,5,.6,.2,1],[104.5,397,0,.3,5,1],[45.5,326,5,.6,.2,1],[45.5,326,0,.3,5,1],[231.5,196.8,5,.6,.2,1],[231.5,196.8,0,.3,5,1],[106.5,160.2,1.2,.4,.2,1],[106.5,160.2,0,.3,1.5,1],[104.5,383,5,.6,.2,1],[104.5,383,0,.3,5,1],[52.5,399,5,.6,.2,1],[52.5,399,0,.3,5,1],[493.1,213.4,0,1.3,.5,1],[489.8,216.3,0,1.3,.5,1],[493.1,209.2,0,1.3,.5,1],[216.5,226,5,.6,.2,1],[216.5,226,0,.3,5,1],[229.1,163,5,.6,.2,1],[229.1,163,0,.3,5,1],[495.3,207,0,2,50,1],[46.5,260,5,.6,.2,1],[46.5,260,0,.3,5,1],[30.5,360,5,.6,.2,1],[30.5,360,0,.3,5,1],[46.5,246,5,.6,.2,1],[46.5,246,0,.3,5,1],[493.1,209.2,1.6,1.3,.5,1],[48.9,127.3,0,2.5,2,1],[229.1,152,5,.6,.2,1],[229.1,152,0,.3,5,1]],yn=[[114.8,195.2,1,2.6,3.93,1,3],[387.4,243.5,1.1,.5,0,1,3],[94,253,10,1.2,0,5,1],[152.7,126.5,1.1,2.4,1.93,1,3],[380.2,183.6,1.1,2.6,.34,1,3],[422.4,-.2,.6,1.9,1.25,1,3],[387.4,224,1.1,1,0,1,3],[343.3,92,.5,2,.1,1,3],[367.7,160.3,1.1,3.1,.62,1,3],[172.5,123.1,1.1,2.2,1.53,1,3],[260.9,427.5,1.2,1,5.24,1,3],[112.6,196.5,1,2.6,3.4,1,3],[254.5,130.3,1.1,6.9,1.26,1,3],[61.2,410,2.8,1,4.71,2,1],[106.9,191.6,.8,3.1,1.57,1,3],[279.5,392.5,1.2,.5,0,1,3],[303.1,102.6,1.1,14.6,.89,1,3],[212.2,119.7,1.1,2.2,1.53,1,3],[192.4,121.3,1.1,2.2,1.79,1,3],[385.9,207.3,1.1,2.5,.12,1,3],[106.5,193.4,.7,3.1,2.36,1,3],[279.4,343,1.2,5.6,0,1,3],[118.1,191.2,.8,2.6,4.19,1,3],[395,490,14,.5,0,3,1],[108.6,195.1,.7,3.1,2.62,1,3],[470,490,1,2.9,0,3,1],[380,385,1,2.9,0,3,1],[135.1,143.9,1.1,3.8,2.72,1,3],[38,184,1.2,40,0,5,1],[115.1,175,4,1,0,1,3],[22,338,2,1,0,2,1],[398,282.4,1.1,6,.32,1,3],[145.4,133.9,.7,1.3,2.26,1,3],[373.1,15.2,.4,1,0,1,3],[267.5,422.4,1.2,1,5.5,1,3],[120.6,183.8,1.5,2.6,4.45,1,3],[279.4,373,1.2,1,0,1,3],[260,235,19,1.2,0,5,1],[374.2,5.1,.4,1.1,6.09,1,3],[107.3,194.8,.7,3.1,1.83,1,3],[77,390,9,1.2,0,2,1],[480,235,25,1.2,0,5,1],[95.6,156,.8,2.6,4.71,2,1],[277.1,403.2,1.2,2,6.02,1,3],[229.2,437.2,1.2,6,4.97,1,3],[58,318,2.8,1,0,2,1],[27,328,.2,.4,0,2,1],[291,490,-8.3,6.6,0,1,3],[110.1,127,5,5,0,1,3],[436.5,0,.6,1.9,5.04,1,3],[131.4,124.4,1.1,4.8,1.53,1,3],[379.4,.9,.4,1.1,5.31,1,3],[22,367,2,1,0,2,1],[97.8,179.1,2.6,1.8,1.91,1,3],[430,10,.7,1.5,0,1,3],[338.5,113.1,.6,2.8,5.86,1,3],[121.7,156,2.7,.9,0,1,3],[88.8,444.6,1.2,22.7,4.71,1,3],[343.8,72.9,.5,2,6.12,1,3],[272.6,415.8,1.2,1,5.76,1,3],[163.1,125.4,.7,1,1.71,1,3],[374.4,33.1,.4,1,6.02,1,3],[400,-50,20,10,0,1,3],[110.1,165,5,1,0,1,3],[210.1,153.5,1.4,1.6,0,3,1],[388.1,250.1,1.1,1,.15,1,3],[358.9,50.6,.4,4,5.46,1,3],[358.9,50.6,.4,4,5.46,1,3],[107.5,194.7,.8,3.1,3.14,1,3],[374.4,24.5,.4,1,.27,1,3],[26.9,383,.2,.4,0,2,1],[358.9,50.6,.4,4,5.46,1,3],[355,385,4,.5,0,3,1],[371.8,2.7,.5,1.1,.33,1,3]],hn=[[2,50,129,82,136],[2,72,368,110,342,175,331,271,358],[3,110,384,110,344],[1,68,400,68,415],[2,97,260,52,263,47,276,66,309],[2,15,152,7,322],[2,427,512,376,500,345,495,333,518],[1,369,230,409,230],[1,227,161,227,178,211,178,211,173],[1,55,327,48,327,48,382,72,382,72,377],[2,438,20,448,51,397,34,397,117,359,119],[1,48,311,63,311],[1,47,163,47,196],[2,371,242,312,258,252,249,226,267,206,242],[2,424,467,375,480,345,485,333,466],[3,291,379,291,357,331,357,331,375,308,375,308,394],[2,400,118,471,150,539,188,530,219],[1,376,20,424,20],[2,397,263,459,272,510,256],[1,272,389,288,389],[3,291,389,291,420,331,420,331,395],[2,376,228,332,214,269,214,253,227,235,228],[1,202,154,169,144,144,159,150,205,123,234,48,196],[1,47,155,47,129],[2,269,213,253,150,233,130],[3,110,396,110,437],[2,56,203,45,231,88,244],[2,205,228,195,217,204,196,209,173],[2,378,163,423,174,459,201,495,194,508,205,488,202,435,227],[1,369,240,409,240],[1,24,345,24,360],[1,227,155,227,129],[1,272,379,288,379],[1,24,388,24,400,51,400,51,408]],mn=[[474.5,248,10,10,.79],[474.5,248,10,10,0],[518.6,240,47.2,13.8,4.12],[447.2,168.4,58.1,10.9,2.36],[104.5,397,10,10,0],[104.5,397,10,10,.79],[45.5,326,10,10,0],[45.5,326,10,10,.79],[213.5,140.2,11.1,5.9,4.82],[231.5,196.8,10,10,0],[231.5,196.8,10,10,.79],[387.1,27.8,22.8,5,.26],[198.6,134.5,32.5,6.8,3.25],[424,242.6,18,8,0],[177.1,371.6,9,31.1,3.41],[206.9,415.8,9.6,22.9,5.14],[295,385,12.8,64,1.57],[483.4,220.8,39,16.6,3.67],[104.5,383,10,10,0],[104.5,383,10,10,.79],[16.7,352.1,21.7,74.3,0],[52.5,399,10,10,0],[52.5,399,10,10,.79],[375.6,51.5,50.2,6.3,1.31],[514.4,213.8,39.4,8.9,3.67],[400,8,50,16,0],[214.1,159.2,31.6,25.9,1.57],[571.6,374.1,207.2,169,0],[415,30,38,5,6.02],[468.3,490,32,80.6,1.57],[352.7,107.1,91,6.7,1.09],[150,369.9,8.7,29.6,5.87],[359,385,32,64,1.57],[226.2,202.5,55.9,9.1,1.31],[229.7,373.4,11.9,27.4,2.09],[50,416.8,34.7,41.6,4.71],[131.7,191.9,29.9,11.2,4.3],[159,137.1,14.9,6.5,3.51],[216.5,226,10,10,0],[216.5,226,10,10,.79],[229.1,163,10,10,0],[229.1,163,10,10,.79],[166.2,356.9,10.4,22,4.37],[233.1,161.7,32.5,9.1,1.57],[110,389.8,17.3,13.7,4.71],[217.3,396.5,9.9,38.1,5.97],[371.2,136.5,55.9,9.1,2.62],[104.5,212.7,20.9,11.2,2.99],[134.4,387.6,9.3,27.2,4.97],[590.3,67.4,426.1,169,5.21],[407.7,495.5,6.7,43.7,1.31],[87,184.5,67.2,11.2,5],[509.8,190.5,39.4,10.4,2.27],[412.4,149.5,39.4,12.9,3.14],[430,15,14,38,0],[119.1,209.3,20.9,11.2,3.77],[62.1,157.4,38,6.8,3.25],[31.9,139.9,47.2,13.8,3.6],[46.5,260,10,10,0],[46.5,260,10,10,.79],[29,200.6,18,8,4.71],[173.4,135,19,5.2,2.99],[188.7,415.1,9.6,22.9,4.36],[30.5,360,10,10,0],[30.5,360,10,10,.79],[281.4,384,11.7,50.3,4.71],[46.5,246,10,10,0],[46.5,246,10,10,.79],[250.5,380.9,11.9,29.7,1.05],[336.5,388,74.2,95.7,1.57],[60.7,345.2,26.7,74.2,0],[351.5,490,6,206.5,1.57],[327.1,490,24.3,24.3,.79],[180,397.9,9.3,31.1,3.15],[146.8,146.1,19,6.9,4.04],[481,182.5,39.4,10.4,3.4],[136.9,164.2,29.9,11.2,4.56],[97.2,9.7,448.5,169,0],[467,247.3,23.1,16,0],[29,311.6,18,8,4.71],[410,483.8,6.7,47.2,1.83],[351,226.6,18,8,0],[229.1,152,10,10,0],[229.1,152,10,10,.79]],pn=[[432.1,22.6,5.2],[496.4,218.2,0],[67.2,400.8,5],[49.2,311.8,2.9],[464.1,250.7,1],[215,169.7,6],[106.4,158.5,2.9],[463.8,247.1,6],[426.1,20.9,0],[467,248.9,6]],xn=[[474.5,248,30,1,10],[104.5,397,50,1.2,10],[45.5,326,50,1.2,10],[231.5,196.8,30,1,10],[104.5,160.2,50,2,10],[104.5,383,50,1.2,10],[52.5,399,50,1.2,10],[216.5,226,30,1,10],[229.1,163,30,1,10],[46.5,260,40,1,10],[30.5,360,50,1.2,10],[46.5,246,40,1,10],[229.1,152,30,1,10],[467,490,100,1.4,10],[377,385,100,1.4,50]],vn=[[377,-390,2],[345,54,4],[404,71,0],[156,465,4],[344,138,4],[430,-9,5],[280,394,4],[194,463,4],[412,-10,5],[267,431,4],[110,197,5],[387,246,4],[101,133,5],[363,64,0],[111,461,4],[332,120,4],[371,5,4],[194,463,4],[390,28,0],[379,194,4],[164,115,4],[359,155,4],[404,71,0],[357,41,4],[379,99,0],[336,94,4],[329,107,0],[199,112,4],[281,368,4],[124,154,5],[375,-5,5],[421,44,0],[281,326,4],[367,24,4],[133,122,4],[237,454,4],[374,176,4],[386,222,4],[339,72,4],[391,-12,5],[106,174,5],[227,114,4]],dn=[[329,412],[295,404],[173,406],[85,259],[173,341],[372,235],[337,139],[84,248]],Mn=[[409.8,499,6.2],[453,482,0],[429,498,0],[432.1,481.9,0],[438,481.9,0],[419.8,481.3,.1],[363,377,0],[450,482,0],[351,393,0],[372,377,0],[345,393,0],[447,498,0],[339,377,0],[444,482,0],[415,500.4,6.2],[406.6,502.4,.5],[369,393,0],[369,377,0],[363,393,0],[459,482,0],[366,393,0],[354,377,0],[348,393,0],[348,377,0],[440.6,481.8,6.2],[360,393,0],[447,482,0],[342,377,0],[422.1,481.9,.1],[425.1,481.9,0],[394.9,477.5,0],[339,393,0],[444,498,0],[413.6,478,0],[357,377,0],[357,393,0],[450,498,0],[342,393,0],[435.1,481.9,0],[456,498,0],[419.6,499.5,.1],[432,498,0],[410.4,480.8,.3],[402.4,500.7,0],[372,393,0],[453,498,0],[422.1,497.9,0],[415.6,479.3,6.2],[360,377,0],[462,482,0],[456,482,0],[345,377,0],[425.1,497.9,6.2],[403.6,480.7,.4],[351,377,0],[366,377,0],[354,393,0],[441,498,0],[429.1,481.9,0],[435,498,0],[438,498,0],[462,498,0],[459,498,0]],bn=[[0,2,.01,1.21,1.21,.41,5.5,2],[0,-2,.01,1.21,1.21,.41,5.5,2],[0,0,.01,1.7,4,.41,0,2],[0,.83,.01,1.3,.42,.41,0,4],[0,-1.32,.01,1.3,.42,.41,0,4]],wn=bn.map(function(n){return[n[1],n[0],n[2],n[4],n[3],n[5],n[6],n[7]]}),gn=!0,Tn=!0,Yn=0,Xn=.5,An=.2,Cn=.08,Pn=1.5,zn=.3,In=.05,Sn=4096,Wn=3,Zn=new Float32Array([0,1,.8,.6,.4]),En=new Float32Array(Zn.length),Rn=function(n){return n.createPeriodicWave(Zn,En)},Vn=function(){return function(n,t,e,r){this.gain=n.createGain(),this.gain.connect(t),this.filter=n.createBiquadFilter(),this.filter.connect(this.gain),this.filter.type=e,this.filter.frequency.value=r,this.processor=n.createScriptProcessor(Sn,1,1),this.processor.connect(this.filter)}}(),kn=function(){return function(n,t,e,r,a,i){this.panner=n.createPanner(),this.panner.setPosition(e.x,e.y,0),this.panner.connect(t),this.gain=n.createGain(),this.gain.connect(this.panner),this.filter=n.createBiquadFilter(),this.filter.connect(this.gain),this.filter.type="allpass",this.filter.frequency.value=i}}(),Ln=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],qn={};[0,1,2,3,4,5,6,7,8].forEach(function(n){for(var t=0,e=Ln;t<e.length;t++){var r=e[t],a=12*(n-4)+(Ln.indexOf(r)-Ln.indexOf("A"));qn[r+n]=440*Math.pow(1.059,a)}});var Fn=[0],On=[n(-.113,.106),n(-.113,.106),n(-.097,.038),n(.002,.04),n(.103,.041),n(.098,.113),n(.116,.131),n(.141,.158),n(.226,.129),n(.227,.25),n(.228,.316),n(.087,.361),n(-.022,.354),n(-.116,.354),n(-.269,.319),n(-.269,.183),n(-.271,.013),n(-.2,-.082),n(-.15,-.08),n(-.097,-.081),n(-.085,-.033),n(-.097,-.003),n(-.156,.146),n(-.111,.106),n(-.111,.106)],Dn=30;!function(){function o(){var t=window.innerWidth,e=window.innerHeight;h.style.width=t+"px",h.style.height=e+"px",h.width=t,h.height=e,d.canvasLW=i(t,e),d.canvasCenter=n(Math.round(t/2),Math.round(e/2))}function c(n){switch(n){case 65:Z=-.032;break;case 68:Z=.032;break;case 87:W=.07;break;case 83:W=-.05}}function u(n){switch(n){case 65:case 68:Z=0;break;case 87:case 83:W=0}}function l(n){return n.map(function(n){return O(r(n[0],-n[1],n[2]),a(n[3]/2,n[4]/2,n[5]),n[6],!1,rn[n[7]-1],"source-over")})}function f(){var n=(new Date).getTime();if(d.frameMS=n-d.now,d.now=n,d.time+=.1,d.playerXY.y<1&&(d.playerAngle+=Z),d.playerXY=L(d.playerXY,d.playerAngle,W,.3,!0,!1,Bn,d),d.fuel=Math.max(d.fuel-d.frameMS/1e3*.7,0),d.lanternIntensity=Math.max(.07*(Math.pow(d.fuel,.5)+Math.pow(d.fuel,1/3)),.1),un.center.x=d.playerXY.x,un.center.y=d.playerXY.y,un.setIntensity(d.lanternIntensity),d.fuel>0&&(F=d.now+2e4),d.now>=F){var a=s(t(5*Math.random()+5,2*Math.random()*Math.PI)),i=nn(r(d.playerXY.x+a.x,d.playerXY.y+a.y));Bn.push(i),Cn.push(i),F=d.now+3e4}var o=s(t(1,d.playerAngle));if(C(X,d.playerXY,o),W&&Math.round(10*d.time)%Dn==0&&z(X),d.cameraXYZ.x+=.02*(d.playerXY.x-d.cameraXYZ.x),d.cameraXYZ.y+=.02*(d.playerXY.y-d.cameraXYZ.y),d.cameraAngle+=.02*(d.playerAngle-d.cameraAngle),d.lib.fillStyle="#000",p(d),d.lib.fillRect(0,0,d.canvasLW.l,d.canvasLW.w),d.transform=x(d),d.lib.fillStyle="black",Bn.forEach(function(n){return n.draw(d)}),Xn.forEach(function(n){n.contains(d.playerXY,.5)&&(n.consume(),setTimeout(function(){return d.fuel=Math.min(d.fuel+50,100)},400),I(X),(v=e(d.playerXY)).z=m)}),Cn.forEach(function(n){return n.update(d,Bn)}),d.health>0)d.pain>0&&(d.pain-=1/120,d.pain<=0&&(d.pain=0),p(d),d.lib.fillStyle="rgba(25,0,0,"+d.pain+")",d.lib.fillRect(0,0,d.canvasLW.l,d.canvasLW.w));else{d.pain-=1/120,p(d);var c=Math.round(d.pain/4),u=Math.round(d.pain/8),l=u;d.lib.fillStyle="rgba("+c+","+u+","+l+",1)",d.lib.fillRect(0,0,d.canvasLW.l,d.canvasLW.w),d.playerXY=e(v),d.cameraXYZ=e(v),d.spiritFound&&(An.center.x=v.x,An.center.y=v.y),d.fuel=100,d.pain<-1&&(I(X),d.pain=1,d.health=3)}if(w(d,Wn),!E&&d.playerXY.y<-21&&(Y(Wn),E=!0),k&&d.playerXY.x<335&&T(d,Zn),!k&&d.playerXY.x>374&&d.playerXY.y<-370&&(d.playerXY.x+=90,d.playerXY.y-=105,d.cameraXYZ.x+=90,d.cameraXYZ.y-=105,An.center.x+=90,An.center.y-=105,k=!0,g(d,Zn),D=!0,en=d.now+16e3),d.playerXY.y<-450&&(d.fuel+=1/30),D&&d.now<en){var y=d.canvasLW.l/2-50,h=d.canvasLW.w/4;d.lib.globalCompositeOperation="source-over",d.lib.fillStyle="#888",d.lib.font="24px Arial",d.lib.textAlign="center",d.lib.fillText("You open the corpse's mouth and retrieve two copper coins.",y,h)}window.requestAnimationFrame(f)}var y=document.body.style;y.margin="0",y.backgroundColor="#000",y.overflow="hidden",y.cursor="none";var h=document.createElement("canvas");document.body.appendChild(h),V();var m=25,v=r(340,-385,m),d={lib:h.getContext("2d"),canvasLW:void 0,canvasCenter:void 0,worldViewRadius:37,time:0,playerXY:e(v),playerAngle:-Math.PI/2,fuel:100,lanternIntensity:1,cameraXYZ:e(v),cameraAngle:-Math.PI/2,transform:void 0,now:(new Date).getTime(),frameMS:0,health:3,pain:0,safeTime:0,spiritFound:!1},M=vn.filter(function(n){return 2==n[2]})[0],X=A(d.playerXY,n(M[0],M[1]),vn.filter(function(n){n[0],n[1];var t=n[2];return 4===t||5===t}).map(function(t){return n(t[0],t[1])}));P(X),S(X),R(X);var W=0,Z=0,E=!1,k=!1,F=d.now+1e3,D=!1,en=0;window.addEventListener("resize",o),window.addEventListener("keydown",function(n){return c(n.keyCode)}),window.addEventListener("keyup",function(n){return u(n.keyCode)});for(var rn=["","#303030","","#383838"],an=["black","#888","#ff8d8d"],on=["","source-over","multiply","multiply"],cn=_(),un=H(r(0,0),d.worldViewRadius,1,0,[255,214,176],!0),ln=xn.map(function(n){return H(r(n[0],-n[1]),n[2],n[3],n[4])}),gn=mn.map(function(n){return B(r(n[0],-n[1],0),i(n[2]/2,n[3]/2),n[4],null,null,!1,!0)}),Tn=yn.filter(function(n){return 5!=n[5]}).map(function(n){return B(r(n[0],-n[1],0),i(5*n[2],5*n[3]),n[4],an[n[5]-1],on[n[5]],n[6]>1,2!=n[6])}),Yn=yn.filter(function(n){return 5==n[5]}).map(function(n){return j(r(n[0],-n[1],0),i(5*n[2],5*n[3]),n[4])}),Xn=pn.map(function(n){return N(r(n[0],-n[1],0),n[2])}),An=tn(r(490,-208)),Cn=[An].concat(dn.map(function(n){return nn(r(n[0],-n[1]))})),Pn=sn.map(function(n){return G(r(n[0],-n[1],n[2]),n[3]/2,n[4],null)}),zn=fn.map(function(n){return O(r(n[0],-n[1],n[2]),a(n[3]/2,n[4]/2,n[5]),n[6]?n[6]:0,!0,rn[n[7]?n[7]-1:0])}),In=Mn.reduce(function(n,t){return n.push.apply(n,U(t)),n},[]),Sn=hn.filter(function(n){return 1==n[0]||3==n[0]}).reduce(function(n,t){return n.push.apply(n,1==t[0]?J(t.slice(1)):K(t.slice(1))),n},[]),Wn=l(bn),Zn=l(wn),En=$([377,385]).concat($([467,490])),Rn=gn.concat(Tn,Yn,Xn,Cn,Pn,zn,Sn),Vn=hn.filter(function(n){return 2==n[0]}).reduce(function(n,t){return n.push.apply(n,Q(t.slice(1),Rn)),n},[]),kn=[],Ln=function(n,t){return n+Math.random()*(4-2*t)+t},qn=-20;qn<580;qn+=4)for(var Fn=-520;Fn<0;Fn+=4)!function(n){var t=Math.random()/2+.3,e=r(Ln(qn,t),Ln(n,t),0);Rn.some(function(n){return n.preventsTreeAt(e,t)})||kn.push(G(e,t,30,null))}(Fn);var On=[],Gn=q(Pn.concat(zn,En,In,Sn,Vn,kn),On),Bn=[un].concat(ln,gn,Tn,Yn,Wn,Zn,Xn,[cn],Cn,Gn,On);b(d,Wn),setTimeout(function(){o(),f()},10)}()}();
