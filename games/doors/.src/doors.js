function Point(t,e){this.x=t,this.y=e}Point.prototype.distanceTo=function(t){return Math.hypot(this.x-t.x,this.y-t.y)};const SPELL_SIZE=300;function Spell(t){this.colour=t,this.generatePoints()}function getBoundingBox(t){let e=Number.MAX_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER;for(let i=0;i<t.length;i++){let a=t[i].x,r=t[i].y;a<e&&(e=a),a>n&&(n=a),r<o&&(o=r),r>s&&(s=r)}return{minX:e,minY:o,maxX:n,maxY:s}}function quadraticInterp(t,e,o,n){return(1-n)*(1-n)*t+2*(1-n)*n*o+n*n*e}function makePoint(t,e){return new Point(getRandomInt(0,300),getRandomInt(0,300))}var time,deltaTime,paused,beginTime,startPauseTime,timePaused,timeouts;function startTime(){beginTime=performance.now(),time=0,timePaused=0,paused=!1,timeouts=[]}function updateTime(){let t=performance.now()-beginTime-timePaused;deltaTime=t-time,time=t;for(let t=0;t<timeouts.length;t++){let e=timeouts[t];time-e.startTime>=e.timeoutTime&&(timeouts.splice(t,1),t--,e.parameters?e.func(...e.parameters):e.func())}}function pauseTime(){startPauseTime=performance.now(),paused=!0}function restartTime(){let t=performance.now();time=t-beginTime-(timePaused+=t-startPauseTime),paused=!1}function startTimeout(t,e,...o){let n={startTime:time,timeoutTime:e,func:t,parameters:o};return timeouts.push(n),n}function cancelTimeout(t){let e=timeouts.indexOf(t);return-1!==e&&(timeouts.splice(e,1),!0)}Spell.prototype.generatePoints=function(){this.pointNum=3,this.points=[],this.controlPoints=[];for(let t=0;t<this.pointNum;t++)this.points.push(makePoint()),this.controlPoints.push(makePoint());this.curvePoints=[];for(let t=1;t<this.pointNum;t++)for(let e=0;e<=1;e+=.1){let o=quadraticInterp(this.points[t-1].x,this.points[t].x,this.controlPoints[t].x,e),n=quadraticInterp(this.points[t-1].y,this.points[t].y,this.controlPoints[t].y,e);this.curvePoints.push(new Point(o,n))}for(let t=this.curvePoints.length-1;t>=0;t--)this.curvePoints[t].x-=this.curvePoints[0].x,this.curvePoints[t].y-=this.curvePoints[0].y;this.distances=[];for(let t=0;t<this.curvePoints.length-1;t++)this.distances.push(this.curvePoints[t].distanceTo(this.curvePoints[t+1]));Object.assign(this,getBoundingBox(this.curvePoints))},Spell.prototype.matches=function(t){let e=getBoundingBox(t),o=((e.maxX-e.minX)/(this.maxX-this.minX)+(e.maxY-e.minY)/(this.maxY-this.minY))/2,n=0;for(let e=t.length-1;e>=0;e--)t[e].x=(t[e].x-t[0].x)/o,t[e].y=(t[e].y-t[0].y)/o;for(let e=0,o=0;e<this.curvePoints.length;e++){let s=0;for(;s<this.distances[e]&&o<t.length-1;)s+=t[o].distanceTo(t[o+1]),o++;n+=this.curvePoints[e].distanceTo(t[o])}return n/=this.curvePoints.length,n},Spell.prototype.draw=function(){let t=this.points,e=this.controlPoints,o=context.createLinearGradient(t[0].x,t[0].y,t[t.length-1].x,t[t.length-1].y);o.addColorStop(0,"black"),o.addColorStop(1,this.colour),context.beginPath(),context.moveTo(t[0].x,t[0].y);for(let o=1;o<this.pointNum;o++)context.quadraticCurveTo(e[o].x,e[o].y,t[o].x,t[o].y);context.lineWidth=10,context.strokeStyle=o,context.stroke()},Spell.prototype.drawPoints=function(){context.fillStyle="#000000";let t=this.points[0].x,e=this.points[0].y;for(let o=0;o<this.curvePoints.length;o++)context.beginPath(),context.arc(this.curvePoints[o].x+t,this.curvePoints[o].y+e,5,0,2*Math.PI),context.fill()};const HUD_WIDTH=230,HEALTH_WIDTH=200,HEALTH_HEIGHT=20,OFFSET=10,SPELL_HUD_SIZE=100,SPELL_HUD_OFFSET=40,PAUSE_BUTTON_SIZE=205,PAUSE_BUTTON_Y=480,PAUSE_SIZE=40;var outlineX,outlineY,outlineSize,outlineAlpha;function initHud(){outlineAlpha=.5,outlineX=(WIDTH-230)/2+230-(outlineSize=300)/2,outlineY=HEIGHT/2-outlineSize/2}function insideSpell(t,e){let o=Math.floor((e-40)/110);if(t>=10&&t<=220&&e>=40&&o<Math.floor((spells.length+1)/2)&&(e-40)%110<=100){if(t<=110)return 2*o;if(t>=120&&(spells.length%2==0||o<(spells.length-1)/2))return 2*o+1}return-1}function insidePause(t,e){return t>=10&&t<=215&&e>=480&&e<=685}function drawHud(){gameState===gameEnum.GAME&&(context.beginPath(),context.lineWidth=5,context.strokeStyle="#666666",context.moveTo(230,PLAYER_SEPARATOR),context.lineTo(WIDTH,PLAYER_SEPARATOR),context.stroke()),context.beginPath(),context.strokeStyle="#000000",context.moveTo(230,0),context.lineTo(230,HEIGHT),context.stroke(),context.beginPath(),context.rect(10,10,player.health/player.maxHealth*200,20),context.fillStyle="#ff4444",context.fill(),context.beginPath(),context.rect(10,10,200,20),context.stroke();for(let t=0;t<spells.length;t++){let e=10,o=40+110*Math.floor(t/2);t%2==1&&(e+=110),context.beginPath(),context.lineWidth=5,context.strokeStyle="#000000",context.rect(e,o,100,100),context.stroke(),context.translate(e,o),context.scale(100/300,100/300),spells[t].draw(),context.scale(3,3),context.translate(-e,-o)}context.beginPath(),context.rect(10,480,205,205),context.lineWidth=10,context.strokeStyle="#000000",context.stroke(),paused?(context.beginPath(),context.fillStyle="#77ff77",context.translate(112.5,582.5),context.moveTo(-40,40),context.lineTo(-40,-40),context.lineTo(40,0),context.closePath(),context.fill(),context.translate(-112.5,-582.5)):(context.beginPath(),context.fillStyle="#7777ff",context.rect(10+205/3-20,520,40,125),context.fill(),context.rect(10+410/3-20,520,40,125),context.fill())}function drawOutline(t){context.globalAlpha=outlineAlpha;let e=outlineSize,o=outlineSize,n=outlineX,s=outlineY;context.translate(n-e/2,s-o/2),context.scale(outlineSize/300,outlineSize/300),spells[t].draw(),context.scale(300/outlineSize,300/outlineSize),context.translate(e/2-n,o/2-s),context.globalAlpha=1}function setOutlineVars(t){t.x&&(outlineX=t.x),t.y&&(outlineY=t.y),t.size&&(outlineSize=t.size),t.alpha&&(outlineAlpha=t.alpha)}function SpellShot(t,e,o){this.x=t,this.y=e,this.colour=o,this.radius=10,this.speed=.2}function randStep(){return.4*Math.random()+.2}SpellShot.prototype.draw=function(){context.beginPath(),context.fillStyle=this.colour,context.translate(this.x,this.y),context.arc(0,0,this.radius,0,2*Math.PI),context.fill(),context.beginPath(),context.moveTo(this.radius,0);for(let t=0,e=randStep();t<=2*Math.PI;t+=e,e=randStep()){let o=10*Math.random()+5;context.lineTo((this.radius+o)*Math.cos(t+e/2),(this.radius+o)*Math.sin(t+e/2)),context.lineTo(this.radius*Math.cos(t+e),this.radius*Math.sin(t+e))}context.fill(),context.translate(-this.x,-this.y)},SpellShot.prototype.update=function(){this.y-=this.speed*deltaTime};const shotEnum={STRAIGHT:0,SINE:1,DIAGONAL:2};function EnemyShot(t,e,o){this.x=t,this.y=e,this.colour=o,this.radius=10,this.speed=.2,this.drawRand=1e7*Math.random();let n=Object.keys(shotEnum);this.type=shotEnum[n[Math.floor(n.length*Math.random())]],this.type===shotEnum.SINE?(this.startTime=time,this.startX=t,this.varX=40):this.type===shotEnum.DIAGONAL&&(this.direction=.5*Math.sign(Math.random()-.5),this.startX=t,this.startTime=time)}EnemyShot.prototype.draw=function(){let t=context.createRadialGradient(this.x,this.y,this.radius/2,this.x,this.y,this.radius);t.addColorStop((Math.sin(.001*time+this.drawRand)+1)/2,"white"),t.addColorStop((Math.cos(.002*time+this.drawRand)+1)/2,this.colour),t.addColorStop((Math.cos(.003*time+this.drawRand)+1)/2,"black"),context.beginPath(),context.fillStyle=t,context.strokeStyle="#000000",context.lineWidth=2,context.arc(this.x,this.y,this.radius,0,2*Math.PI),context.fill(),context.stroke()},EnemyShot.prototype.update=function(){switch(this.y+=this.speed*deltaTime,this.type){case shotEnum.STRAIGHT:break;case shotEnum.SINE:this.x=Math.sin((time-this.startTime)*this.speed*.01)*this.varX+this.startX;break;case shotEnum.DIAGONAL:this.x=this.startX+(time-this.startTime)*this.direction*.1}};const POINT_NUM=30,SHOOT_TIME=2e3,IDLE_TIME=2e3,stateEnum={IDLE:0,MOVE:1,SHOOT:2};function Enemy(t,e){this.x=t,this.y=e,this.radius=15,this.health=10,this.speed=.05,this.drawRand=1e6*Math.random();let o=getRandomInt(0,COLOURS.length-1);this.colour=COLOURS[o],this.state=stateEnum.IDLE,this.interval=null,this.targetLocation=null,this.alive=!0,this.chooseState()}Enemy.prototype.draw=function(){context.translate(this.x,this.y),context.beginPath(),context.fillStyle="#000000",context.arc(0,0,this.radius,0,2*Math.PI),context.fill(),context.beginPath(),context.strokeStyle=this.colour,context.moveTo(this.radius,0);for(let t=0;t<30;t++){let e=2*t*Math.PI/30*(time+this.drawRand)*.001,o=Math.cos(e)*this.radius,n=Math.sin(e)*this.radius,s=Math.cos(e)*(this.radius+10),i=Math.sin(e)*(this.radius+10);t%2==0?context.quadraticCurveTo(o,n,s,i):context.quadraticCurveTo(s,i,o,n)}context.stroke(),context.translate(-this.x,-this.y)},Enemy.prototype.takeDamage=function(t){this.health-=t,this.health<=0&&(this.alive=!1)},Enemy.prototype.chooseState=function(){if(this.alive)if(Math.abs(this.x-player.x)<50*Math.random()+50)this.state=stateEnum.SHOOT,startTimeout(this.shoot.bind(this),2e3);else if(Math.random()<.7){let t;this.state=stateEnum.MOVE;let e=.4*Math.random()+.3;t=this.x>player.x?e*(this.x-player.x)+player.x:e*(player.x-this.x)+this.x;let o=Math.random()*PLAYER_SEPARATOR;this.targetLocation=new Point(t,o)}else this.state=stateEnum.IDLE,startTimeout(this.chooseState.bind(this),2e3)},Enemy.prototype.shoot=function(){if(this.alive){addEnemyShot(new EnemyShot(this.x,this.y,this.colour)),this.chooseState()}},Enemy.prototype.update=function(){if(this.state===stateEnum.MOVE){let t=this.targetLocation,e=Math.atan2(t.y-this.y,t.x-this.x);this.x+=this.speed*deltaTime*Math.cos(e),this.y+=this.speed*deltaTime*Math.sin(e),Math.hypot(this.x-t.x,this.y-t.y)<=3&&this.chooseState()}},Enemy.prototype.collidesWith=function(t){return Math.hypot(t.x-this.x,t.y-this.y)<=this.radius+5+t.radius+5&&(this.colour===t.colour?this.takeDamage(5):this.takeDamage(3),!0)};const PORTAL_DIVISION_SIZE=10;function Portal(t,e,o,n,s){this.x=t,this.y=e,this.width=o,this.height=n,this.boss=s,this.widthRemoved=0,this.heightRemoved=0,startTimeout(this.createEnemy.bind(this),1e4*Math.random()+5e3),this.health=6,this.array=[];let i=this.width/10,a=this.height/10;for(let t=0;t<i;t++){this.array[t]=[];for(let e=0;e<a;e++){let o=(1-Math.abs((i-1)/2-t)/((i-1)/2)+(1-Math.abs((a-1)/2-e)/((a-1)/2)))/2*.7+.3;if(Math.random()<o){let o=getRandomInt(1,GLITCH_PALETTE.length-1);this.array[t][e]=GLITCH_PALETTE[o]}else this.array[t][e]="#ffffff"}}}function BossPoint(t,e,o,n,s){this.x=t,this.y=e,this.radius=o,this.colour=n,this.boss=s,this.chargeTime=getRandomInt(7e3,13e3),this.shootTime=getRandomInt(3e3,5e3),this.startStateTime=time,this.state=BOSS_AI_ENUM.IDLE,this.timeout=startTimeout(this.changeState.bind(this),this.chargeTime)}function rand(){return.5*Math.random()+1}function smallRand(){return.8*Math.random()+.6}Portal.prototype.createEnemy=function(){this.health>0&&this.boss.currentStage===BOSS_STAGE_ENUM.PORTALS&&(createEnemy(this.x+this.width/2,this.y+this.height/2),startTimeout(this.createEnemy.bind(this),1e4*Math.random()+5e3))},Portal.prototype.draw=function(){let t=this.width/10,e=this.height/10;for(let o=this.widthRemoved;o<t;o++)for(let t=this.heightRemoved;t<e;t++){let e=10*o+this.x,n=10*t+this.y;context.fillStyle=this.array[o][t],context.beginPath(),context.rect(e,n,10,10),context.fill()}},Portal.prototype.collidesWith=function(t){let e=this.x+this.widthRemoved+this.width/2,o=this.y+this.heightRemoved+this.height/2;return Math.hypot(e-t.x,o-t.y)<t.radius+(this.width+this.height)/2&&(this.width-=2,this.widthRemoved++,this.height-=2,this.heightRemoved--,this.health-=2,!0)},BossPoint.prototype.draw=function(){let t=this.getActualPosition();context.translate(t.x,t.y),context.beginPath(),context.fillStyle=glitchPattern,context.arc(0,0,this.radius,0,2*Math.PI),context.fill();let e=clamp(this.radius*(time-this.startStateTime)/this.chargeTime,10,this.radius);context.beginPath();let o,n;for(let t=0;t<=30;t++){let s=e*Math.cos(2*t*Math.PI/30)*rand(),i=e*Math.sin(2*t*Math.PI/30)*rand();0===t&&(context.moveTo(s,i),o=s,n=i),30===t&&(s=o,i=n),context.lineTo(s,i)}let s=.6*e;for(let t=0;t<=30;t++){let e=s*Math.cos(2*t*Math.PI/30)*smallRand(),i=s*Math.sin(2*t*Math.PI/30)*smallRand();0===t&&(o=e,n=i),30===t&&(e=o,i=n),context.lineTo(e,i)}context.fillStyle="#dd0000",context.fill("evenodd"),context.translate(-t.x,-t.y),this.state===BOSS_AI_ENUM.SHOOTING&&(context.globalAlpha=.5,context.beginPath(),context.arc(t.x,t.y,this.radius,0,Math.PI,!0),context.rect(t.x-this.radius,t.y,2*this.radius,HEIGHT-t.y),context.fillStyle=this.colour,context.fill(),context.globalAlpha=1)},BossPoint.prototype.getActualPosition=function(){return{x:this.x+this.boss.x,y:this.y+this.boss.y}},BossPoint.prototype.changeState=function(){switch(this.state){case BOSS_AI_ENUM.IDLE:this.state=BOSS_AI_ENUM.SHOOTING,this.timeout=startTimeout(this.changeState.bind(this),this.shootTime);break;case BOSS_AI_ENUM.SHOOTING:this.state=BOSS_AI_ENUM.IDLE,this.startStateTime=time,this.timeout=startTimeout(this.changeState.bind(this),this.chargeTime)}},BossPoint.prototype.collidesWith=function(t){let e=this.getActualPosition();if(this.state===BOSS_AI_ENUM.IDLE){if(Math.hypot(e.x-t.x,e.y-t.y)<=this.radius+t.radius)return this.boss.takeDamage(3),!0}else if(this.state===BOSS_AI_ENUM.SHOOTING&&e.x-this.radius<=t.x+t.radius&&e.x+this.radius>=t.x-t.radius)return!0;return!1},BossPoint.prototype.hittingPlayer=function(t){if(this.state===BOSS_AI_ENUM.SHOOTING){let e=this.getActualPosition();if(e.x-this.radius<=t.x+t.radius&&e.x+this.radius>=t.x-t.radius)return cancelTimeout(this.timeout),this.changeState(),!0}return!1};const BOSS_STAGE_ENUM={PORTALS:0,BOSS:1,DEAD:2},BOSS_AI_ENUM={MOVE:0,SHOOTING:1};function Boss(){this.maxHealth=50,this.health=this.maxHealth,this.currentStage=BOSS_STAGE_ENUM.PORTALS,this.portals=[]}Boss.prototype.createPortal=function(){let t,e,o,n,s;do{t=!0,e=10*getRandomInt(6,10),o=10*getRandomInt(6,10),n=Math.random()*(WIDTH-230-e)+230+e,s=Math.random()*(HEIGHT-o-PLAYER_SEPARATOR);for(let i=0;i<this.portals.length;i++){let a=this.portals[i];if(Math.max(n,a.x)<Math.min(n+e,a.x+a.width)&&Math.max(s,a.y)<Math.min(s+o,a.y+a.height)){t=!1;break}}}while(!t);this.portals.push(new Portal(n,s,e,o,this))},Boss.prototype.draw=function(){for(let t=0;t<this.portals.length;t++)this.portals[t].draw();if(this.currentStage===BOSS_STAGE_ENUM.BOSS){context.beginPath(),context.fillStyle=glitchPattern,context.rect(this.x,this.y,this.width,this.height),context.fill();for(let t=0;t<this.points.length;t++)this.points[t].draw()}else if(this.currentStage===BOSS_STAGE_ENUM.DEAD){let t=this.width*(this.startTime-time+this.animTime)/this.animTime,e=this.height*(this.startTime-time+this.animTime)/this.animTime;context.save(),context.translate(this.x,this.y),context.beginPath();let o=10,n=.55,s=1.1,i=.001*(time-this.startTime);context.moveTo(t,0);for(let a=0;a<=o;a++)context.quadraticCurveTo(2*t*Math.cos(i*(a+n)/o*2*Math.PI),2*e*Math.sin(i*(a+n)/o*2*Math.PI),1.5*t*Math.cos(i*(a+s)/o*2*Math.PI),1.5*e*Math.sin(i*(a+s)/o*2*Math.PI)),context.lineTo(t*Math.cos((a+1)/o*2*Math.PI),e*Math.sin((a+1)/o*2*Math.PI));context.fillStyle=glitchPattern,context.fill(),context.restore()}context.globalAlpha=.5,context.fillStyle="#000000",context.font="20px Verdana";let t=context.measureText("Boss Health:").width;context.fillText("Boss Health:",(WIDTH-230)/2+230-t/2,20),context.lineWidth=5;let e=(WIDTH-230)/2+230-150;context.beginPath(),context.fillStyle="#ff0000",context.rect(e,35,this.health/this.maxHealth*300,30),context.fill(),context.beginPath(),context.strokeStyle="#000000",context.rect(e,35,300,30),context.stroke(),context.globalAlpha=1},Boss.prototype.update=function(){switch(this.currentStage){case BOSS_STAGE_ENUM.PORTALS:this.portals.length<4&&Math.random()<.005&&this.createPortal();break;case BOSS_STAGE_ENUM.BOSS:switch(this.aiAction){case BOSS_AI_ENUM.MOVE:let t=this.targetLocation,e=Math.atan2(t.y-this.y,t.x-this.x);this.x+=this.speed*deltaTime*Math.cos(e),this.y+=this.speed*deltaTime*Math.sin(e),Math.hypot(this.x-t.x,this.y-t.y)<=3&&this.changeAction(BOSS_AI_ENUM.SHOOTING);break;case BOSS_AI_ENUM.SHOOTING:for(let t=0;t<this.points.length;t++)this.points[t].hittingPlayer(player)&&player.health}}},Boss.prototype.takeDamage=function(t){this.health-=t,this.currentStage===BOSS_STAGE_ENUM.PORTALS&&this.health<=25&&this.startBossState(),this.currentStage===BOSS_STAGE_ENUM.BOSS&&this.health<=0&&this.startDeathState()},Boss.prototype.changeAction=function(t){if(this.currentStage===BOSS_STAGE_ENUM.BOSS)switch(this.aiAction=t,this.aiAction){case BOSS_AI_ENUM.MOVE:let t=getRandomInt(0,(WIDTH-230)/2)+230,e=20*Math.random();this.targetLocation=new Point(t,e),this.points=[];break;case BOSS_AI_ENUM.SHOOTING:let o=getRandomInt(2,4);for(let t=0;t<o;t++){let e=this.width*t/(o-1),n=this.height,s=30,i=getRandomInt(0,spells.length-1),a=spells[i].colour;this.points.push(new BossPoint(e,n,s,a,this))}startTimeout(this.changeAction.bind(this),5e4,BOSS_AI_ENUM.MOVE)}},Boss.prototype.hittingPlayer=function(t){if(this.currentStage===BOSS_STAGE_ENUM.BOSS)for(let e=0;e<this.points.length;e++)if(this.points[e].hittingPlayer(t))return!0},Boss.prototype.collidesWith=function(t){if(this.currentStage===BOSS_STAGE_ENUM.PORTALS){for(let e=0;e<this.portals.length;e++)if(this.portals[e].collidesWith(t))return this.portals[e].health<=0&&(this.portals.splice(e,1),e--),this.takeDamage(2),!0;return!1}if(this.currentStage===BOSS_STAGE_ENUM.BOSS)for(let e=0;e<this.points.length;e++)if(this.points[e].collidesWith(t))return!0},Boss.prototype.startBossState=function(){this.currentStage=BOSS_STAGE_ENUM.BOSS,this.portals=[],this.width=300,this.height=100,this.x=(WIDTH-230)/2+230-this.width/2,this.y=-this.height,this.speed=.1,this.points=[],this.aiAction=null,this.changeAction(BOSS_AI_ENUM.MOVE)},Boss.prototype.startDeathState=function(){this.currentStage=BOSS_STAGE_ENUM.DEAD,this.points=[],this.startTime=time,this.animTime=1e4,startTimeout(playerWins,this.animTime)};const DOOR_WIDTH=170,DOOR_HEIGHT=280,OPEN_AMOUNT=40;function Door(t,e,o){this.x=t,this.y=e,o?(this.glitch=!1,this.colour=o):(this.glitch=!0,this.colour="glitch"),this.open=!1,this.effects=[]}var wrapperX,inputX,wrapperY,inputY,wrapperSize,inputSize,wrapperAlpha,inputAlpha,wrapperFullscreen;Door.prototype.draw=function(){context.beginPath(),context.rect(this.x-85,this.y-140,170,280),context.fillStyle="#ffffff",context.fill(),context.lineWidth=6,context.strokeStyle="#000000",context.stroke(),context.save(),context.beginPath(),context.rect(this.x-85+3,this.y-140+3,164,274),context.clip(),context.translate(this.x-85,this.y),this.open&&(context.beginPath(),context.rect(130,-140,40,280),context.fillStyle="#000000",context.fill(),context.beginPath(),context.rect(0,-140,130,280),context.clip(),context.scale(130/170,1));for(let t=0;t<this.effects.length;t++){let e=this.effects[t],o=e.pos.y-140,n=e.pos.x,s=o;if(this.glitch)context.fillStyle=glitchPattern,n+=10*Math.floor(Math.cos(.001*(time-e.startTime))*(time-e.startTime)*.001),s+=10*Math.floor(Math.sin(.001*(time-e.startTime))*(time-e.startTime)*.001);else{let t=context.createRadialGradient(e.pos.x,o,10,e.pos.x,o,30);t.addColorStop(0,this.colour),t.addColorStop(1,"black"),context.fillStyle=t,n+=Math.cos(.001*(time-e.startTime))*(time-e.startTime)*.005,s+=Math.sin(.001*(time-e.startTime))*(time-e.startTime)*.005}context.beginPath(),context.arc(n,s,30,0,2*Math.PI),context.fill()}context.beginPath(),context.arc(135,0,10,0,2*Math.PI),context.strokeStyle="#000000",context.lineWidth=5,context.fillStyle="#ffffff",context.fill(),context.stroke(),context.restore()},Door.prototype.coordsInside=function(t,e){return t>=this.x-85&&t<=this.x+85&&e>=this.y-140&&e<=this.y+140},Door.prototype.update=function(){if(Math.random()<.05){let t=new Point(170*Math.random(),280*Math.random());this.effects.push({startTime:time,pos:t})}for(let t=0;t<this.effects.length;t++)time-this.effects[t].startTime>=5e3&&(this.effects.splice(t,1),t--)};var mouseDown,fullscreen=!1;function startOptions(){startInputs(),setInputPositions(),hideOptions(),document.body.addEventListener("fullscreenchange",onFullscreenChange)}function drawOptions(){let t=WIDTH/3,e=HEIGHT/3+120,o=WIDTH/2-t/2,n=HEIGHT/2-e/2;wrapperX.style.display="block",wrapperY.style.display="block",wrapperSize.style.display="block",wrapperAlpha.style.display="block",wrapperFullscreen.style.display="block",context.beginPath(),context.fillStyle="#ffffff",context.strokeStyle="#000000",context.lineWidth=5,context.moveTo(o+50,n),context.lineTo(o+t-50,n),context.arcTo(o+t,n,o+t,n+50,50),context.lineTo(o+t,n+e-50),context.arcTo(o+t,n+e,o+t-50,n+e,50),context.lineTo(o+50,n+e),context.arcTo(o,n+e,o,n+e-50,50),context.lineTo(o,n+50),context.arcTo(o,n,o+50,n,50),context.stroke(),context.fill(),context.font="30px Verdana";let s="Paused - Options",i=context.measureText(s).width;context.fillStyle="#000000",context.fillText(s,WIDTH/2-i/2,n+50)}function hideOptions(){wrapperX.style.display="none",wrapperY.style.display="none",wrapperSize.style.display="none",wrapperAlpha.style.display="none",wrapperFullscreen.style.display="none"}function startInputs(){let t=createNumSlider(0,WIDTH,outlineX,20,"inputX","Outline X:");inputX=t.input,wrapperX=t.wrapper;let e=createNumSlider(0,HEIGHT,outlineY,20,"inputY","Outline Y:");inputY=e.input,wrapperY=e.wrapper;let o=createNumSlider(50,1e3,outlineSize,20,"inputSize","Outline Size:");inputSize=o.input,wrapperSize=o.wrapper;let n=createNumSlider(0,1,outlineAlpha,.1,"inputAlpha","Outline Opacity:");inputAlpha=n.input,wrapperAlpha=n.wrapper;let s=createCheckbox(toggleFullscreen,"fullscreen","Fullscreen:");wrapperFullscreen=s.wrapper}function onFullscreenChange(t){fullscreen=document.fullscreenElement===document.body}function toggleFullscreen(){fullscreen?document.exitFullscreen():document.body.requestFullscreen(),fullscreen=!fullscreen}function createCheckbox(t,e,o){let n=document.createElement("DIV");n.style.position="absolute",document.body.appendChild(n);let s=document.createElement("LABEL");s.htmlFor=e,s.innerHTML=o,n.appendChild(s);let i=document.createElement("INPUT");return i.type="checkbox",i.oninput=t,i.id=e,n.appendChild(i),{wrapper:n,check:i}}function setInputPositions(){setWrapperPos(wrapperX,WIDTH/2-200,HEIGHT/2-40),setWrapperPos(wrapperY,WIDTH/2-200,HEIGHT/2+40),setWrapperPos(wrapperSize,WIDTH/2+20,HEIGHT/2-40),setWrapperPos(wrapperAlpha,WIDTH/2+20,HEIGHT/2+40),setWrapperPos(wrapperFullscreen,WIDTH/2-100,HEIGHT/2+120)}function setWrapperPos(t,e,o){let n=convertCoordsBack(e,o);t.style.left=n.x+"px",t.style.top=n.y+"px"}function createNumSlider(t,e,o,n,s,i){let a=document.createElement("DIV");a.style.position="absolute",document.body.appendChild(a);let r=document.createElement("LABEL");r.htmlFor=s,r.innerHTML=i,a.appendChild(r),a.appendChild(document.createElement("BR"));let l=document.createElement("INPUT");return l.type="range",l.step=n,a.appendChild(l),l.min=t,l.max=e,l.value=o,l.id=s,l.oninput=onInputChange,{wrapper:a,input:l}}function onInputChange(){setOutlineVars({x:inputX.value,y:inputY.value,size:inputSize.value,alpha:inputAlpha.value})}const mouseEnum={NONE:0,SPELL:1,MOVE:2};var mouseType,updateInterval,paused$1,playing,doors,doorColour,mouse,mouseDown$1;function initVars(){doors=[],mouseType=mouseEnum.NONE,mouseDown=!1}function startDoor(){setPlayerPos(),initVars();let t,e=(WIDTH-230)/4;t=roundNum<6?0:roundNum-5;let o=getFreeColours(3-t);for(let t=0,e=o.length;t<3-e;t++){let e=getRandomInt(0,2);null!==o[e]?o.splice(e,0,null):t--}let n=new Door(230+e,200,o[0]);doors.push(n);let s=new Door(230+2*e,200,o[1]);doors.push(s);let i=new Door(230+3*e,200,o[2]);doors.push(i),paused$1=!1,playing=!0,addEvents(),updateDraw(),updateInterval=setInterval(updateLogic,1e3/30)}function endDoor(){removeEvents(),clearInterval(updateInterval),playing=!1}function addEvents(){touch?(document.addEventListener("touchstart",onMouseDown),document.addEventListener("touchmove",onMouseMove),document.addEventListener("touchend",onMouseUp)):(document.addEventListener("mousedown",onMouseDown),document.addEventListener("mousemove",onMouseMove),document.addEventListener("mouseup",onMouseUp))}function removeEvents(){touch?(document.removeEventListener("touchstart",onMouseDown),document.removeEventListener("touchmove",onMouseMove),document.removeEventListener("touchend",onMouseUp)):(document.removeEventListener("mousedown",onMouseDown),document.removeEventListener("mousemove",onMouseMove),document.removeEventListener("mouseup",onMouseUp))}function onMouseDown(t){mouseDown=!0,t instanceof MouseEvent?mouse=convertCoords(t.offsetX,t.offsetY):t instanceof TouchEvent&&(mouse=convertCoords(t.changedTouches[0].clientX,t.changedTouches[0].clientY)),player.coordsInside(mouse.x,mouse.y)&&!paused$1?mouseType=mouseEnum.MOVE:insidePause(mouse.x,mouse.y)&&(paused$1?(paused$1=!1,hideOptions(),restartTime(),updateInterval=setInterval(updateLogic,1e3/30)):(paused$1=!0,clearInterval(updateInterval),pauseTime()))}function onMouseMove(t){if(mouseDown&&mouseType===mouseEnum.MOVE){let e;t instanceof MouseEvent?e=convertCoords(t.offsetX,t.offsetY):t instanceof TouchEvent&&(e=convertCoords(t.changedTouches[0].clientX,t.changedTouches[0].clientY));let o={x:e.x-mouse.x,y:e.y-mouse.y};mouse=e,movePlayer(o.x,o.y);for(let t=0;t<doors.length;t++)doors[t].coordsInside(player.x,player.y)?doors[t].open=!0:doors[t].open=!1}}function movePlayer(t,e){player.x=clamp(player.x+t,230+player.radius,WIDTH-player.radius),player.y=clamp(player.y+e,player.radius,HEIGHT-player.radius)}function onMouseUp(t){mouseDown=!1,mouseType=mouseEnum.NONE;for(let t=0;t<doors.length;t++)doors[t].open&&(doorColour=doors[t].colour,endDoor(),onDoorEnd())}function updateDraw(){clearCanvas();for(let t=0;t<doors.length;t++)doors[t].draw();player.draw(),drawHud(),paused$1&&drawOptions(),playing&&requestAnimationFrame(updateDraw)}function updateLogic(){updateTime();for(let t=0;t<doors.length;t++)doors[t].update()}const mouseEnum$1={NONE:0,SPELL:1,MOVE:2};var mouseType$1,spellPoints,updateInterval$1,showSpell,spellShown;const SPELL_MIN_ACCEPT=50,PLAYER_SEPARATOR=400;var spells;const MAX_ENEMIES=10;var enemies,enemyShots,spellShots,bossFight,boss,playing$1,paused$2,mouse$1;function initGameState(){spells=[]}function initVars$1(){enemies=[],enemyShots=[],spellShots=[],paused$2=!1,playing$1=!0,showSpell=!1,mouseDown$1=!1,mouseType$1=mouseEnum$1.NONE}function startGame(){addEvents$1(),initVars$1(),setPlayerPos(),"glitch"===doorColour?(bossFight=!0,boss=new Boss):(bossFight=!1,addSpell(doorColour),addEnemies()),updateDraw$1(),updateInterval$1=setInterval(updateLogic$1,1e3/30)}function playerWins(){endGame(),onPlayerWin()}function playerLoses(){endGame(),onPlayerLoss()}function endGame(){removeEvents$1(),playing$1=!1,clearInterval(updateInterval$1)}function addEnemies(){let t=1*roundNum;for(let e=0;e<t;e++){createEnemy(Math.random()*(WIDTH-230)+230,Math.random()*PLAYER_SEPARATOR)}}function createEnemy(t,e){enemies.length<10&&enemies.push(new Enemy(t,e))}function addEnemyShot(t){enemyShots.push(t)}function getFreeColours(t){let e,o,n=[];for(;n.length<t;){do{o=!1,e=COLOURS[getRandomInt(0,COLOURS.length-1)];for(let t=0;t<spells.length;t++)spells[t].colour===e&&(o=!0);n.includes(e)&&(o=!0)}while(o);n.push(e)}return n}function addSpell(t){let e=new Spell(t);spells.push(e),player.generateSpellVar()}function addSpellShot(t){spellShots.push(new SpellShot(player.x,player.y,spells[t].colour))}function addEvents$1(){touch?(document.addEventListener("touchstart",onMouseDown$1),document.addEventListener("touchmove",onMouseMove$1),document.addEventListener("touchend",onMouseUp$1)):(document.addEventListener("mousedown",onMouseDown$1),document.addEventListener("mousemove",onMouseMove$1),document.addEventListener("mouseup",onMouseUp$1))}function removeEvents$1(){touch?(document.removeEventListener("touchstart",onMouseDown$1),document.removeEventListener("touchmove",onMouseMove$1),document.removeEventListener("touchend",onMouseUp$1)):(document.removeEventListener("mousedown",onMouseDown$1),document.removeEventListener("mousemove",onMouseMove$1),document.removeEventListener("mouseup",onMouseUp$1))}function onMouseDown$1(t){mouseDown$1=!0,t instanceof MouseEvent?mouse$1=convertCoords(t.offsetX,t.offsetY):t instanceof TouchEvent&&(mouse$1=convertCoords(t.changedTouches[0].clientX,t.changedTouches[0].clientY));let e=insideSpell(mouse$1.x,mouse$1.y);player.coordsInside(mouse$1.x,mouse$1.y)&&!paused$2?mouseType$1=mouseEnum$1.MOVE:-1==e||paused$2?insidePause(mouse$1.x,mouse$1.y)?paused$2?(paused$2=!1,restartTime(),updateInterval$1=setInterval(updateLogic$1,1e3/30),hideOptions()):(paused$2=!0,clearInterval(updateInterval$1),pauseTime()):paused$2||(mouseType$1=mouseEnum$1.SPELL,(spellPoints=[]).push(new Point(mouse$1.x,mouse$1.y))):showSpell?e==spellShown?showSpell=!1:spellShown=e:(showSpell=!0,spellShown=e)}function onMouseMove$1(t){if(mouseDown$1){let e;t instanceof MouseEvent?e=convertCoords(t.offsetX,t.offsetY):t instanceof TouchEvent&&(e=convertCoords(t.changedTouches[0].clientX,t.changedTouches[0].clientY));let o={x:e.x-mouse$1.x,y:e.y-mouse$1.y};switch(mouse$1=e,mouseType$1){case mouseEnum$1.MOVE:movePlayer$1(o.x,o.y);break;case mouseEnum$1.SPELL:spellPoints.push(new Point(mouse$1.x,mouse$1.y))}}}function movePlayer$1(t,e){player.x=clamp(player.x+t,230+player.radius,WIDTH-player.radius),player.y=clamp(player.y+e,PLAYER_SEPARATOR+player.radius,HEIGHT-player.radius)}function onMouseUp$1(t){switch(mouse$1=convertCoords(t.offsetX,t.offsetY),mouseDown$1=!1,mouseType$1){case mouseEnum$1.SPELL:let t,e=51;for(let o=0;o<spells.length;o++){let n=spells[o].matches(spellPoints);n<e&&(e=n,t=o)}e<50&&addSpellShot(t)}mouseType$1=mouseEnum$1.NONE}function updateDraw$1(){clearCanvas(),drawHud(),player.draw();for(let t=0;t<spellShots.length;t++)spellShots[t].draw();bossFight&&boss.draw();for(let t=0;t<enemies.length;t++)enemies[t].draw();for(let t=0;t<enemyShots.length;t++)enemyShots[t].draw();showSpell&&drawOutline(spellShown),paused$2&&drawOptions(),playing$1&&requestAnimationFrame(updateDraw$1)}function updateLogic$1(){updateTime();for(let t=0;t<enemyShots.length;t++)player.collidesWith(enemyShots[t])&&(enemyShots.splice(t,1),t--);for(let t=0;t<enemies.length;t++){enemies[t].update();for(let e=0;e<spellShots.length;e++)if(enemies[t].collidesWith(spellShots[e])&&(spellShots.splice(e,1),e--,!enemies[t].alive)){enemies.splice(t,1),t--;break}}if(bossFight){boss.update(),boss.hittingPlayer(player)&&player.takeDamage(6);for(let t=0;t<spellShots.length;t++)boss.collidesWith(spellShots[t])&&(spellShots.splice(t,1),t--);boss.hittingPlayer(player)&&player.takeDamage(5)}else if(0===enemies.length)return endGame(),void onGameEnd();for(let t=0;t<spellShots.length;t++)spellShots[t].update(),spellShots[t].y<-spellShots[t].radius&&(spellShots.splice(t,1),t--);for(let t=0;t<enemyShots.length;t++)enemyShots[t].update(),enemyShots[t].y>HEIGHT+enemyShots[t].radius&&(enemyShots.splice(t,1),t--);for(let t=0;t<enemies.length;t++)enemies[t].update()}function Player(){this.x=0,this.y=0,this.radius=40,this.maxHealth=40,this.health=this.maxHealth,this.spellVar=[]}Player.prototype.generateSpellVar=function(t){let e={};e.speed=.01*Math.random(),e.radius=(this.radius-20)*Math.random()+10,e.clockwise=Math.random()<.5?1:-1,this.spellVar.push(e)},Player.prototype.draw=function(){context.translate(this.x,this.y),context.beginPath(),context.fillStyle="#f5d742",context.arc(0,0,this.radius,0,2*Math.PI),context.strokeStyle="#000000",context.lineWidth=3,context.fillStyle="#ffffff",context.fill(),context.stroke(),context.lineWidth=4;for(let t=0;t<spells.length;t++)context.beginPath(),context.ellipse(0,0,this.radius,this.spellVar[t].radius,this.spellVar[t].clockwise*time*this.spellVar[t].speed,0,Math.PI),context.strokeStyle=spells[t].colour,context.stroke();for(let t=spells.length-1;t>=0;t--)context.beginPath(),context.ellipse(0,0,this.radius,this.spellVar[t].radius,this.spellVar[t].clockwise*time*this.spellVar[t].speed,Math.PI,2*Math.PI),context.strokeStyle=spells[t].colour,context.stroke();context.translate(-this.x,-this.y)},Player.prototype.takeDamage=function(t){this.health-=t,this.health<=0&&playerLoses()},Player.prototype.heal=function(t){this.health=Math.min(this.maxHealth,this.health+t)},Player.prototype.coordsInside=function(t,e){return Math.hypot(this.x-t,this.y-e)<=this.radius+10},Player.prototype.collidesWith=function(t){return Math.hypot(this.x-t.x,this.y-t.y)<=this.radius+t.radius&&(this.takeDamage(3),!0)};const MENUSTATE={START:0,WIN:1,LOSE:2};var menuState,menuPlaying,menuDoors;function startMenu(t){menuState=t,menuPlaying=!0,menuDoors=[],document.addEventListener("mousedown",onMouseDown$2),updateDraw$2()}function updateDraw$2(){clearCanvas(),updateTime(),Math.random()<.005&&menuDoors.push(new MenuDoor);for(let t=0;t<menuDoors.length;t++)menuDoors[t].door.update(),menuDoors[t].door.x+=.3,menuDoors[t].door.y-=.3,menuDoors[t].door.x>WIDTH+menuDoors[t].door.width||menuDoors[t].door.y<-menuDoors[t].door.height?(menuDoors.splice(t,1),t--):menuDoors[t].draw();let t,e;switch(context.font="50px Verdana",menuState){case MENUSTATE.START:t="Doors",e="Click to play";break;case MENUSTATE.WIN:t="You won!",e="Click to play again";break;case MENUSTATE.LOSE:t="You lost",e="Click to play again"}let o=context.measureText(t).width,n=WIDTH/2-o/2,s=HEIGHT/3;context.beginPath(),context.rect(n-10,s-50,o+20,60),context.strokeStyle="#000000",context.stroke(),context.fillStyle="#ffffff",context.fill(),context.fillStyle="#000000",context.fillText(t,n,s);let i=context.measureText(e).width;n=WIDTH/2-i/2,s=2*HEIGHT/3,context.beginPath(),context.rect(n-10,s-50,i+20,60),context.strokeStyle="#000000",context.stroke(),context.fillStyle="#ffffff",context.fill(),context.fillStyle="#000000",context.fillText(e,n,s),menuPlaying&&requestAnimationFrame(updateDraw$2)}function onMouseDown$2(t){0===t.button&&exitMenu()}function exitMenu(){menuPlaying=!1,menuDoors=[],document.removeEventListener("mousedown",onMouseDown$2),initGame()}function MenuDoor(){let t,e,o;if(this.rotation=2*Math.random()*Math.PI,Math.random()<.01)t=null;else{let e=getRandomInt(0,COLOURS.length-1);t=COLOURS[e]}Math.random()<.5?(e=-170,o=Math.random()*(HEIGHT-300)+300):(e=Math.random()*(WIDTH-300),o=HEIGHT+280),this.door=new Door(e,o,t)}MenuDoor.prototype.draw=function(){context.save(),context.translate(this.door.x,this.door.y),context.rotate(this.rotation),context.translate(-this.door.x,-this.door.y),this.door.draw(),context.restore()};const COLOURS=["red","green","blue","orange","orangered","purple","darkviolet","brown"],GLITCH_PALETTE=["#FEFEF3","#E1B288","#BFB6C7","#7D7199","#1A100E"];var glitchPattern;const gameEnum={MENU:0,GAME:1,DOOR:2};var gameState,canvas,context,player,roundNum;const WIDTH=1366,HEIGHT=695,RATIO=WIDTH/HEIGHT;var touch=!1;function start(t){context=(canvas=t).getContext("2d"),initHud(),startTime(),startOptions(),generateGlitchPattern(),touch="ontouchstart"in window||navigator.msMaxTouchPoints>0,resize(),window.addEventListener("resize",resize),window.addEventListener("contextmenu",t=>{t.preventDefault()}),startMenu(MENUSTATE.START)}function initGame(){player=new Player,initGameState(),startTime(),gameState=gameEnum.DOOR,roundNum=1,startDoor()}function generateGlitchPattern(){let t=document.createElement("CANVAS"),e=t.getContext("2d");t.width=500,t.height=500;for(let o=0;o<t.width;o+=10)for(let n=0;n<t.height;n+=10){let t=getRandomInt(0,GLITCH_PALETTE.length-1);e.fillStyle=GLITCH_PALETTE[t],e.fillRect(o,n,10,10)}glitchPattern=context.createPattern(t,"repeat")}function onDoorEnd(){gameState=gameEnum.GAME,startGame()}function onGameEnd(){gameState=gameEnum.DOOR,startDoor(),player.heal(10),roundNum++}function onMenuEnd(){gameState=gameEnum.DOOR,startDoor()}function onPlayerWin(){gameState=gameEnum.MENU,startMenu(MENUSTATE.WIN)}function onPlayerLoss(){gameState=gameEnum.MENU,startMenu(MENUSTATE.LOSE)}function resize(){let t=window.innerWidth/window.innerHeight;RATIO>t?(canvas.width=window.innerWidth,canvas.height=window.innerWidth/RATIO):(canvas.width=window.innerHeight*RATIO,canvas.height=window.innerHeight),setInputPositions(),resetTransform()}function convertCoords(t,e){return{x:WIDTH*t/canvas.width,y:HEIGHT*e/canvas.height}}function convertCoordsBack(t,e){return{x:t*canvas.width/WIDTH,y:e*canvas.height/HEIGHT}}function resetTransform(){context.setTransform(1,0,0,1,0,0),context.scale(canvas.width/WIDTH,canvas.height/HEIGHT)}function setPlayerPos(){player.x=230+(WIDTH-230)/2,player.y=600}function clearCanvas(){context.clearRect(0,0,WIDTH,HEIGHT)}function getRandomInt(t,e){return Math.floor(Math.random()*(e-t+1))+t}function clamp(t,e,o){return t<e?e:t>o?o:t}export{COLOURS,GLITCH_PALETTE,HEIGHT,WIDTH,canvas,clamp,clearCanvas,context,convertCoords,convertCoordsBack,gameEnum,gameState,getRandomInt,glitchPattern,initGame,onDoorEnd,onGameEnd,onMenuEnd,onPlayerLoss,onPlayerWin,player,roundNum,setPlayerPos,start,touch};