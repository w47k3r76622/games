(()=>{"use strict";const t=({max:t,min:i})=>Math.floor(Math.random()*t)+i,i=function(){return(new Date).getTime()},e=()=>!!navigator.userAgent.match(/iPhone|Android.+Mobile/),s=1e3,h={APP_ELEMENT:"#app",CANVAS_WIDTH:s,CANVAS_HEIGHT:600,GROUND_HEIGHT:60,GROUND_START_Y:540,GRAVITY:.4,STAGE_MAX_X:11e3};class n{constructor(t){this.options=t}update(t){}draw(t){}}const a=[{speed:1,jump:0,walkLength:100},{speed:1,jump:10,walkLength:200},{speed:3,jump:0,walkLength:100},{speed:2,jump:100,walkLength:300},{speed:3,jump:100,walkLength:250}],o=[{speed:2,jump:20,walkLength:900},{speed:3,jump:10,walkLength:900},{speed:5,jump:100,walkLength:900},{speed:15,jump:0,walkLength:900}];class r extends n{constructor(i){super(i);let e=4;i.level&&(e=i.level+1,3===i.level&&(e=5)),this.pattern=a[t({max:e,min:0})],i.pattern&&(this.pattern=i.pattern),this.x=i.x||0,this.yv=10,this.startPosition=i.startPosition,this.turn=!1,this.y=0,this.height=this.width=32,i.size&&(this.height=this.width=i.size),this.jumping=!1,this.standingPos=0,this.jumpTop=void 0,this.jumpingTimer=0,this.currentStage=void 0,this.downing=!1,this.downingTimer=0,this.moveImages=i.moveImages,this.imageIndex=0,this.timer=0,this.hitting=!1,this.hittingTimer=0,this.hitPoint=0,i.hitPoint&&(this.hitPoint=i.hitPoint)}draw(t){let i=0;const e=h.CANVAS_WIDTH/2;t.player.realX<=e?i=0:t.player.realX>=e&&t.player.realX<=t.stageMaxX-e?i=t.player.realX-e:t.player.realX>=t.stageMaxX-e&&(i=t.stageMaxX-h.CANVAS_WIDTH);const s=this.turn?"trans":"normal",n=this.moveImages[s];let a=n[0];this.timer%5==0&&(this.imageIndex++,this.imageIndex>=n.length&&(this.imageIndex=0)),a=n[this.imageIndex],(this.jumping||this.downing)&&(a=n[0]),(!this.hitting||this.hittingTimer>0&&this.hittingTimer%2==0)&&t.ctx.drawImage(a,this.x+this.startPosition-i,h.GROUND_START_Y+this.y-this.height,this.width,this.height)}update(t){this.x>=this.pattern.walkLength&&(this.turn=!0),this.x<=0&&(this.turn=!1),this.turn?this.x-=this.pattern.speed:this.x+=this.pattern.speed,!this.downing&&!this.jumping&&this.pattern.jump>0&&this.x%this.pattern.jump==0&&(this.jumping=!0,this.standingPos=this.y,this.jumpTop=void 0,this.jumpingTimer=0);const i=t.getViewStages({x:this.x+this.startPosition,height:this.height}),e=this.x+this.startPosition;this.currentStage&&(this.currentStage.x>e||this.currentStage.x+this.currentStage.width<e)&&!this.downing&&!this.jumping&&(this.downing=!0,this.standingPos=this.y,this.downingTimer=0),this.jumping&&this._jump(i),this.downing&&this._down(i),this.timer++,this.hitting&&(this.hittingTimer-=1,0===this.hittingTimer&&(this.hitting=!1))}_jump(t){const i=this.y;this.y=this.standingPos+.5*h.GRAVITY*this.jumpingTimer*this.jumpingTimer-this.yv*this.jumpingTimer,this.jumpingTimer++,this.y>1&&this._reset();const e=i<this.y;e&&!this.jumpTop&&(this.jumpTop=i);const s=t.find((t=>this.jumpTop<=t.y-h.GROUND_START_Y&&i<=t.y-h.GROUND_START_Y&&this.y>=t.y-h.GROUND_START_Y));e&&s&&this._reset(s)}_down(t){const i=this.y;this.y=.5*h.GRAVITY*this.downingTimer*this.downingTimer+this.standingPos,this.downingTimer++,this.y>1&&this._reset();const e=t.find((t=>i<=t.y-h.GROUND_START_Y&&this.y>=t.y-h.GROUND_START_Y));e&&this._reset(e)}_reset(t){t?(this.y=t.y-h.GROUND_START_Y,this.jumping=!1,this.downing=!1,this.jumpTop=void 0,this.currentStage=t):(this.y=0,this.downing=!1,this.currentStage=void 0,this.jumping=!1,this.jumpTop=void 0)}}class m extends n{constructor(t){super(t),this.width=t.width,this.height=t.height,this.x=t.x,this.y=t.y,this.color=t.color}draw(t){t.ctx.strokeStyle=this.color,t.ctx.fillStyle=this.color;let i=0;const e=h.CANVAS_WIDTH/2;t.player.realX<=e?i=0:t.player.realX>=e&&t.player.realX<=t.stageMaxX-e?i=t.player.realX-e:t.player.realX>=t.stageMaxX-e&&(i=t.stageMaxX-h.CANVAS_WIDTH),t.ctx.strokeRect(this.x-i,this.y,this.width,this.height),t.ctx.fillRect(this.x-i,this.y,this.width,this.height)}}const l={stage:[{width:150,height:100,x:700,y:440,color:"#5b5b5b"},{width:150,height:180,x:900,y:360,color:"#5b5b5b",item:"coin"},{width:150,height:270,x:1100,y:270,color:"#5b5b5b",item:"rosary"},{width:150,height:25,x:1050,y:150,color:"white"},{width:150,height:30,x:1200,y:70,color:"white",item:"coin"},{width:130,height:30,x:1800,y:100,color:"white"},{width:20,height:240,x:2e3,y:300,color:"#5b5b5b"},{width:180,height:30,x:2300,y:60,color:"white"},{width:150,height:100,x:2700,y:440,color:"#5b5b5b"},{width:150,height:180,x:2900,y:360,color:"#5b5b5b"},{width:150,height:270,x:3100,y:270,color:"#5b5b5b",item:"rosary"},{width:150,height:25,x:3050,y:150,color:"white"},{width:130,height:30,x:3400,y:100,color:"white"},{width:20,height:240,x:3600,y:300,color:"#5b5b5b",item:"coin"},{width:180,height:30,x:4200,y:60,color:"white"},{width:150,height:100,x:4700,y:440,color:"#5b5b5b"},{width:150,height:180,x:4900,y:360,color:"#5b5b5b"},{width:150,height:270,x:5100,y:270,color:"#5b5b5b",item:"rosary"},{width:150,height:25,x:5050,y:150,color:"white"},{width:150,height:100,x:5700,y:440,color:"#5b5b5b"},{width:150,height:180,x:5900,y:360,color:"#5b5b5b",item:"coin"},{width:350,height:270,x:6100,y:270,color:"#5b5b5b",item:"rosary"},{width:150,height:25,x:6050,y:150,color:"white"},{width:150,height:180,x:6500,y:360,color:"#5b5b5b"},{width:150,height:100,x:6700,y:440,color:"#5b5b5b",item:"coin"},{width:150,height:20,x:7e3,y:440,color:"#5b5b5b"},{width:150,height:20,x:7500,y:400,color:"#5b5b5b"},{width:150,height:20,x:8e3,y:140,color:"white"},{width:50,height:100,x:8500,y:440,color:"#5b5b5b"},{width:150,height:20,x:8300,y:100,color:"white"},{width:150,height:20,x:8750,y:40,color:"white"},{width:150,height:20,x:9300,y:140,color:"white"},{width:150,height:100,x:9500,y:440,color:"#5b5b5b",item:"coin"},{width:100,height:100,x:9700,y:440,color:"#5b5b5b"},{width:50,height:100,x:1e4,y:440,color:"#5b5b5b",item:"coin"},{width:500,height:10,x:1400,y:-10,color:"white"},{width:500,height:10,x:2e3,y:-10,color:"white"},{width:500,height:10,x:2600,y:-10,color:"white"},{width:500,height:10,x:3300,y:-10,color:"white"},{width:500,height:10,x:4e3,y:-10,color:"white"},{width:100,height:10,x:4600,y:-10,color:"white"},{width:500,height:10,x:4800,y:-10,color:"white"},{width:500,height:10,x:5400,y:-10,color:"white"},{width:500,height:10,x:6e3,y:-10,color:"white"},{width:500,height:10,x:6800,y:-10,color:"white"},{width:500,height:10,x:7400,y:-10,color:"white"},{width:500,height:10,x:8e3,y:-10,color:"white"},{width:500,height:10,x:8700,y:-10,color:"white"},{width:500,height:10,x:9300,y:-10,color:"white"}],boss_stage:[{width:100,height:20,x:50,y:440,color:"#5b5b5b"},{width:100,height:20,x:50,y:240,color:"#5b5b5b"},{width:100,height:20,x:50,y:40,color:"#5b5b5b"},{width:100,height:20,x:220,y:340,color:"#5b5b5b"},{width:100,height:20,x:220,y:140,color:"#5b5b5b"},{width:100,height:20,x:400,y:240,color:"#5b5b5b"},{width:100,height:20,x:400,y:40,color:"#5b5b5b"},{width:100,height:20,x:550,y:240,color:"#5b5b5b"},{width:100,height:20,x:550,y:40,color:"#5b5b5b"},{width:100,height:20,x:680,y:340,color:"#5b5b5b"},{width:100,height:20,x:680,y:140,color:"#5b5b5b"},{width:100,height:20,x:850,y:440,color:"#5b5b5b"},{width:100,height:20,x:850,y:240,color:"#5b5b5b"},{width:100,height:20,x:850,y:40,color:"#5b5b5b"}]};class g extends n{constructor(t){super(t);this.lifePoint={x:0,y:0,img:t.image,point:3,maxPoint:3},this.rosary={x:3*this.lifePoint.img.width+200,y:0,img:t.rosaryImage,point:0},this.coin={x:3*this.lifePoint.img.width+200+this.rosary.img.width+30,y:-3,img:t.coinImage,point:0},this.time={x:h.CANVAS_WIDTH-10,y:10,startTime:i(),nowTime:0},this.stageText={x:this.lifePoint.x+(this.lifePoint.maxPoint+1)*this.lifePoint.img.width,y:10}}draw(t){for(let i=0;i<this.lifePoint.point;i++)t.ctx.drawImage(this.lifePoint.img,this.lifePoint.x+i*t.player.width+5,this.lifePoint.y);let e=`STAGE ${t.level}`;t.level>3&&(e="BOSS STAGE"),t.ctx.beginPath(),t.ctx.textBaseline="top",t.ctx.textAlign="left",t.ctx.fillStyle="white",t.ctx.font="bold 20px Arial, meiryo, sans-serif",t.ctx.fillText(e,this.stageText.x,this.stageText.y),t.ctx.beginPath(),t.ctx.textBaseline="top",t.ctx.textAlign="right",t.ctx.fillText(Math.floor(i()-this.time.startTime)/1e3,this.time.x,this.time.y),t.ctx.drawImage(this.rosary.img,this.rosary.x,this.rosary.y),t.ctx.beginPath(),t.ctx.textBaseline="top",t.ctx.textAlign="left",t.ctx.fillStyle="white",t.ctx.fillText(this.rosary.point,this.rosary.x+this.rosary.img.width+5,this.rosary.y+10),t.ctx.drawImage(this.coin.img,this.coin.x,this.coin.y),t.ctx.beginPath(),t.ctx.textBaseline="top",t.ctx.textAlign="left",t.ctx.fillStyle="white",t.ctx.fillText(this.coin.point,this.coin.x+this.coin.img.width+5,this.coin.y+13)}}class d extends n{constructor(t){super(t),this.image=t.image,this.type=t.type,this.x=t.x,this.y=t.y}draw(t){let i=0;const e=h.CANVAS_WIDTH/2;t.player.realX<=e?i=0:t.player.realX>=e&&t.player.realX<=t.stageMaxX-e?i=t.player.realX-e:t.player.realX>=t.stageMaxX-e&&(i=t.stageMaxX-h.CANVAS_WIDTH),t.ctx.drawImage(this.image,this.x-i,h.GROUND_START_Y+this.y-32)}coinAction(t){t.header.coin.point++}rosaryAction(t){t.header.rosary.point++}action(t){"coin"===this.type&&this.coinAction(t),"rosary"===this.type&&this.rosaryAction(t)}}function c(...t){return y.play(...t)}const y={volume:.3,sampleRate:44100,x:new(window.AudioContext||webkitAudioContext),play:function(...t){return this.playSamples(this.buildSamples(...t))},playSamples:function(...t){const i=this.x.createBuffer(t.length,t[0].length,this.sampleRate),e=this.x.createBufferSource();return t.map(((t,e)=>i.getChannelData(e).set(t))),e.buffer=i,e.connect(this.x.destination),e.start(),e},buildSamples:function(t=1,i=.05,e=220,s=0,h=0,n=.1,a=0,o=1,r=0,m=0,l=0,g=0,d=0,c=0,y=0,p=0,w=0,x=1,u=0,T=0){const b=2*Math.PI;let A,_,I=this.sampleRate,v=r*=500*b/I/I,f=e*=(1+2*i*Math.random()-i)*b/I,S=[],R=0,E=0,X=0,j=1,P=0,N=0,D=0;for(m*=500*b/I**3,y*=b/I,l*=b/I,g*=I,d=d*I|0,_=(s=s*I+9)+(u*=I)+(h*=I)+(n*=I)+(w*=I)|0;X<_;S[X++]=D)++N%(100*p|0)||(D=a?a>1?a>2?a>3?Math.sin((R%b)**3):Math.max(Math.min(Math.tan(R),1),-1):1-(2*R/b%2+2)%2:1-4*Math.abs(Math.round(R/b)-R/b):Math.sin(R),D=(d?1-T+T*Math.sin(b*X/d):1)*(D>0?1:-1)*Math.abs(D)**o*t*this.volume*(X<s?X/s:X<s+u?1-(X-s)/u*(1-x):X<s+u+h?x:X<_-w?(_-X-w)/n*x:0),D=w?D/2+(w>X?0:(X<_-w?1:(_-X)/w)*S[X-w|0]/2):D),A=(e+=r+=m)*Math.cos(y*E++),R+=A-A*c*(1-1e9*(Math.sin(X)+1)%2),j&&++j>g&&(e+=l,f+=l,j=0),!d||++P%d||(e=f,r=v,j=j||1);return S},getNote:function(t=0,i=440){return i*2**(t/12)}},p=()=>c(...[,,105,,.22,.09,1,.06,19,,,,.15,.1,31,.2,,,.16,.48]);class w{constructor({player:t,enemyMoveImages:i,enemyStopImages:s,coinImage:n,rosaryImage:a}){this.player=t,this.header=void 0,this.stages=[],this.enemies=[],this.items=[],this.enemyMoveImages=i,this.enemyStopImages=s,this.coinImage=n,this.rosaryImage=a,this.timer=0,this.keyboard=[],this.level=1,this.clear=!1,this.clearTIme=0,this.bossTimer=0,this.bossClear=!1,this.explainedRosary=!1,this.showExplainRosary=!1,this.showExplainRosaryTimer=0,this.stageMaxX=h.STAGE_MAX_X,this.gamemode="title",this.header=new g({image:this.player.stopImage.normal,rosaryImage:this.rosaryImage,coinImage:this.coinImage});const o=document.querySelector(h.APP_ELEMENT),[r,m]=[h.CANVAS_WIDTH,h.CANVAS_HEIGHT];let l=r;e()&&(l=r+300),[o.style.width,o.style.height]=[`${l}px`,`${m}px`],this.offscreenEl=document.createElement("canvas"),[this.offscreenEl.width,this.offscreenEl.height]=[r,m],this.ctx=this.offscreenEl.getContext("2d"),e()&&(this.leftBtn=document.createElement("button"),[this.leftBtn.style.width,this.leftBtn.style.height]=["100px",`${m}px`],this.leftBtn.innerText="<<<",this.leftBtn.id="leftbtn",o.appendChild(this.leftBtn),this.rightBtn=document.createElement("button"),[this.rightBtn.style.width,this.rightBtn.style.height]=["100px",`${m}px`],this.rightBtn.innerText=">>>",this.rightBtn.id="rightbtn",o.appendChild(this.rightBtn));const d=document.createElement("canvas");[d.style.width,d.style.height]=[`${r}px`,`${m}px`],[d.width,d.height]=[r,m],this.displayCtx=d.getContext("2d"),o.appendChild(d),e()&&(this.jumpBtn=document.createElement("button"),[this.jumpBtn.style.width,this.jumpBtn.style.height]=["100px",`${m}px`],this.jumpBtn.innerText="JUMP",this.jumpBtn.id="jumpbtn",o.appendChild(this.jumpBtn)),this.setKeyEvent()}setPlayer(t){this.player=t}setKeyEvent(){let t,s,h;e()&&(t=document.querySelector("#leftbtn"),s=document.querySelector("#rightbtn"),h=document.querySelector("#jumpbtn"));const n=t=>{this.keyboard=[...new Set([...this.keyboard,t.code])]},a=t=>{"title"===this.gamemode&&(this.gamemode="play",this.player.initialize(),this.header.time.startTime=i(),this.header.rosary.point=0,this.header.coin.point=0,this.header.lifePoint.point=this.header.lifePoint.maxPoint,p(),this._draw()),"gameover"!==this.gamemode&&"clear"!==this.gamemode||"Enter"!==t.code||(this.gamemode="title",p(),this._draw()),this.keyboard=this.keyboard.filter((i=>i!==t.code))};e()&&(t.addEventListener("mousedown",(t=>{n({code:"ArrowLeft"})})),s.addEventListener("mousedown",(t=>{n({code:"ArrowRight"})})),h.addEventListener("mousedown",(t=>{n({code:"ArrowUp"})})),t.addEventListener("mouseup",(t=>{a({code:"ArrowLeft"})})),s.addEventListener("mouseup",(t=>{a({code:"ArrowRight"})})),h.addEventListener("mouseup",(t=>{a({code:"ArrowUp"})})),t.addEventListener("touchstart",(t=>{n({code:"ArrowLeft"})})),s.addEventListener("touchstart",(t=>{n({code:"ArrowRight"})})),h.addEventListener("touchstart",(t=>{n({code:"ArrowUp"})})),t.addEventListener("touchend",(t=>{a({code:"ArrowLeft"})})),s.addEventListener("touchend",(t=>{a({code:"ArrowRight"})})),h.addEventListener("touchend",(t=>{a({code:"ArrowUp"})}))),document.addEventListener("keydown",n),document.addEventListener("keyup",a)}_draw(){this.ctx.save(),"gameover"!==this.gamemode&&(this.ctx.fillStyle="maroon",this.ctx.fillRect(0,0,h.CANVAS_WIDTH,h.CANVAS_HEIGHT),this.ctx.fillStyle="#78882d",this.ctx.fillRect(0,h.GROUND_START_Y,h.CANVAS_WIDTH,h.GROUND_HEIGHT)),"title"===this.gamemode&&this._drawTitle(),"play"===this.gamemode&&this._drawGame(),"boss"===this.gamemode&&this._drawBoss(),"gameover"===this.gamemode&&this._drawGameover(),"clear"===this.gamemode&&this._drawClear(),this.ctx.restore(),this.displayCtx.drawImage(this.offscreenEl,0,0),"play"!==this.gamemode&&"boss"!==this.gamemode||(this.timer=requestAnimationFrame(this._draw.bind(this)))}_drawTitle(){this.level=1,this.clear=!1,this.clearTIme=0,this.explainedRosary=!1,this.showExplainRosary=!1,this.showExplainRosaryTimer=0,this.stageMaxX=h.STAGE_MAX_X,this.initializeStage(),this.stages.filter((t=>t.x+t.width>=0&&t.x<=h.CANVAS_WIDTH)).forEach((t=>{t.update(this),t.draw(this)}));let t="One day... There was a treasures hunter.\n";t+="He heard a rumor that there was some treasures in the mountain.\n",t+="There is a king zombie in the mountain. The king zombie attacked many villages. \n",t+="So he went to the mountain but... He was lost!\n",t+="You need to navigate to the king zombie for him.\n",t+="You should careful child zombies on the way to the king zombie.\n",t+="\n",t+="----------------------------------------------------------\n",t+="ArrowKeys(Left/Right): move\n",t+="ArrowKeys(Up): jump\n",t+="----------------------------------------------------------\n",t+="\n",t+="Press any key to start a new game.",this._drawText("Lost Treasures 2","One day... There was a treasures hunter.\nHe heard a rumor that there was some treasures in the mountain.\nThere is a king zombie in the mountain. The king zombie attacked many villages. \nSo he went to the mountain but... He was lost!\nYou need to navigate to the king zombie for him.\nYou should careful child zombies on the way to the king zombie.\n\n----------------------------------------------------------\nArrowKeys(Left/Right): move\nArrowKeys(Up): jump\n----------------------------------------------------------\n\nPress any key to start a new game.")}initializeStage(){this.player.initialize(),this.items=[new d({image:this.coinImage,x:100,y:0,type:"coin"}),new d({image:this.rosaryImage,x:200,y:0,type:"rosary"})],this.stages=l.stage.map((t=>{if(t.item){const i="coin"===t.item?this.coinImage:this.rosaryImage;this.items.push(new d({image:i,x:t.x+t.width/2-i.width/2,y:t.y-h.GROUND_START_Y,type:t.item}))}return new m(t)}));for(let i=0;i<this.stageMaxX/h.CANVAS_WIDTH;i++){const e=t({max:this.level+2,min:this.level});this.items=this.items.concat([...Array(e)].map((()=>{const e=t({max:h.CANVAS_WIDTH+i*h.CANVAS_WIDTH,min:i*h.CANVAS_WIDTH});return new d({image:this.coinImage,x:e,y:0,type:"coin"})})))}this.enemies=[];for(let i=0;i<this.stageMaxX/h.CANVAS_WIDTH;i++){const e=t({max:2*this.level,min:this.level});this.enemies=this.enemies.concat([...Array(e)].map((()=>{const e=t({max:h.CANVAS_WIDTH+i*h.CANVAS_WIDTH,min:i*h.CANVAS_WIDTH+10});return new r({level:this.level,startPosition:e,moveImages:{normal:[this.enemyStopImages[0],this.enemyMoveImages[0]],trans:[this.enemyStopImages[1],this.enemyMoveImages[1]]}})})))}}_drawGame(){const t=this.player.realX;let i=0,e=h.CANVAS_WIDTH;t>=this.stageMaxX-h.CANVAS_WIDTH/2?(i=this.stageMaxX-h.CANVAS_WIDTH,e=this.stageMaxX):t>=h.CANVAS_WIDTH/2&&(i=t-h.CANVAS_WIDTH/2,e=t+h.CANVAS_WIDTH/2),t>=h.STAGE_MAX_X&&(this.clear=!0,this.clearTIme=0,this.level++,p(),this.level>3?(this.stages=[],this.enemies=[],this.items=[],this.header.rosary.point=0,this.gamemode="boss",this.player.initialize()):this.initializeStage()),this.clear&&this.showCLearText();const s=this.enemies.filter((t=>t.x+t.startPosition+t.height>i&&t.x+t.startPosition-t.height<e)),n=this._hit(this.enemies);!this.player.hitting&&n>=0&&!this.enemies[n].hitting&&this._hitAction(n);const a=this.getItem();a>=0&&this.getItemAction(a),this.stages.filter((t=>t.x+t.width>=i&&t.x<=e)).forEach((t=>{t.update(this),t.draw(this)})),this.items.forEach((t=>t.draw(this))),s.forEach((t=>{t.update(this),t.draw(this)})),this.player.update(this),this.player.draw(this),this.header.draw(this),this.showExplainRosary&&this._drawExplainRosary()}_drawBoss(){0===this.stages.length&&(this.stages=l.boss_stage.map((t=>new m(t)))),0===this.enemies.length&&(this.enemies=[new r({hitPoint:6,size:128,pattern:{speed:5,jump:0,walkLength:900},startPosition:0,x:100,moveImages:{normal:[this.enemyStopImages[0],this.enemyMoveImages[0]],trans:[this.enemyStopImages[1],this.enemyMoveImages[1]]}})]);let i=5,e=101,s=101;if(this.enemies[0].hitPoint<=3&&(i=3,e=151,s=71),this.bossTimer%s==0&&(this.enemies[0].pattern=o[t({max:o.length,min:0})],this.enemies[0].hitPoint<=3&&(this.enemies[0].pattern.speed=15,this.enemies[0].pattern.jump=10)),this.items.length<=i&&this.bossTimer%e==0){const i=t({max:this.stages.length,min:0}),e=this.stages[i],s=["coin","rosary","coin","none"],n=s[t({max:s.length,min:0})];"none"===n||("coin"===n?this.items.push(new d({image:this.coinImage,x:e.x+e.width/2-this.coinImage.width/2,y:e.y-h.GROUND_START_Y,type:n})):"rosary"===n&&!this.items.some((t=>"rosary"===t.type))&&this.header.rosary.point<=0&&this.items.push(new d({image:this.rosaryImage,x:e.x+e.width/2-this.rosaryImage.width/2,y:e.y-h.GROUND_START_Y,type:n})))}const n=this.getItem();n>=0&&this.getItemAction(n),this.stages.forEach((t=>t.draw(this))),this.items.forEach((t=>t.draw(this))),this.enemies.forEach((t=>{t.update(this),t.draw(this)}));const a=this._hit(this.enemies);!this.player.hitting&&a>=0&&!this.enemies[a].hitting&&(this._hitAction(a),0===this.enemies[a].hitPoint&&(this.gamemode="clear")),this.stageMaxX=h.CANVAS_WIDTH,this.player.update(this),this.player.draw(this),this.header.draw(this),this.bossTimer++}_drawGameover(){let t="He was killed zombies.\n";t+="He will live in the mountain as a zombie.\n",t+="\n",t+="Press Enter key to go back Title.",this._drawText("GAME OVER... YOU ARE DEAD","He was killed zombies.\nHe will live in the mountain as a zombie.\n\nPress Enter key to go back Title.")}_drawClear(){let t="He could kill the king zombie and he could find many treasures.\n";t+="His treasure hunt will continue.\n",t+="\n",t+="Your Record is ...\n",t+="----------------------------------------------------------\n";t+=`Time: ${Math.floor(i()-this.header.time.startTime)/1e3}s \n`,t+=`Coin: ${this.header.coin.point} \n`,t+="----------------------------------------------------------\n",t+="\n",t+="\n",t+="Press Enter key to go back Title.",this._drawText("Game Clear!!!",t)}getViewStages(t){const i=t.x+t.height/2;return this.stages.filter((t=>t.x<=i&&t.x+t.width>=i)).sort(((t,i)=>t.y<i.y?-1:1))}_hit(t){const i=this.player.realX,e=this.player.realX+this.player.width,s=this.player.realY-this.player.height,h=this.player.realY;return t.findIndex((t=>{const n=t.x+t.startPosition+10,a=t.x+t.startPosition+t.width-10,o=t.y-t.height,r=t.y;return n<=i&&i<=a&&o<=s&&s<=r||n<=e&&e<=a&&o<=s&&s<=r||n<=i&&i<=a&&o<=h&&h<=r||n<=e&&e<=a&&o<=h&&h<=r}))}_hitAction(t){if(this.header.rosary.point>0){c(...[1.85,,224,.01,.1,.19,4,2.26,,,,,,.9,-338,.4,.16,.9,.04]);const i=this.enemies[t];i.hitPoint&&i.hitPoint>0?(this.enemies[t].hitPoint--,this.enemies[t].hitting=!0,this.enemies[t].hittingTimer=100,i.hitPoint<=3&&(this.enemies[t].pattern.speed=3)):this.enemies.splice(t,1),this.header.rosary.point--}else c(...[,,311,.03,.05,.2,4,1.86,-7.3,7.5,,,,2,,.2,,.97,.01]),this.header.lifePoint.point-=1,this.header.lifePoint.point<=0&&(this.gamemode="gameover"),this.player.hitting=!0,this.player.hittingTimer=100}getItem(){const t=this.player.realX,i=this.player.realX+this.player.width,e=this.player.realY-this.player.height,s=this.player.realY;return this.items.findIndex((h=>{const n=h.x,a=h.x+32,o=h.y-32,r=h.y;return n<=t&&t<=a&&o<=e&&e<=r||n<=i&&i<=a&&o<=e&&e<=r||n<=t&&t<=a&&o<=s&&s<=r||n<=i&&i<=a&&o<=s&&s<=r}))}getItemAction(t){const i=this.items[t];"coin"===i.type&&c(...[1.02,,258,.01,.09,.19,2,1.71,,2.6,635,.08,.08,,,,,.6,.03]),"rosary"===i.type&&c(...[,,499,.04,.27,.41,,.59,,9.5,,,.13,,,,,.54,.14,.03]),"rosary"!==i.type||this.explainedRosary||(this.explainedRosary=!0,this.showExplainRosary=!0,this.showExplainRosaryTimer=0),i.action(this),this.items.splice(t,1)}showCLearText(){const t=`Stage${this.level} Clear!!!`;this._drawText(t,void 0),this.clearTIme++,this.clearTIme>=100&&(this.clear=!1,this.clearTIme=0)}rosaryAction(){this.header.rosary.point++}_drawExplainRosary(){let t="If you have rosaries, you can attack enemies.\n";t+="1 rosary can attack 1 enemy.\n",this._drawText("You got Rosary!","If you have rosaries, you can attack enemies.\n1 rosary can attack 1 enemy.\n"),this.showExplainRosaryTimer++,this.showExplainRosaryTimer>300&&(this.showExplainRosaryTimer=0,this.showExplainRosary=!1)}_drawText(t,i){if(t&&(this.ctx.font="bold 40px serif",this.ctx.fillStyle="white",this.ctx.textBaseline="center",this.ctx.textAlign="center",this.ctx.fillText(t,h.CANVAS_WIDTH/2,h.CANVAS_HEIGHT/4)),i){const t=20,r=1.2,m=20,l=h.CANVAS_HEIGHT/4+50;this.ctx.beginPath(),this.ctx.textBaseline="left",this.ctx.textAlign="left",this.ctx.font="bold "+t+"px Arial, meiryo, sans-serif";for(var e=i.split("\n"),s=0,n=e.length;n>s;s++){var a=e[s],o=t;s&&(o+=t*r*s),this.ctx.fillText(a,m+0,l+o)}}}run(){this._draw()}}class x extends n{constructor(t){super(t),this.height=this.width=32,this.maxXV=5,this.yv=10,this.initialize(),this.stopImage=t.stopImage,this.moveImages=t.moveImages}initialize(){this.xv=0,this.realY=0,this.realX=0,this.viewY=0,this.viewX=0,this.moving=!1,this.movingTImer=0,this.movingImageIdx=0,this.turn=!1,this.jumping=!1,this.standingPos=0,this.jumpTop=void 0,this.jumpingTimer=0,this.currentStage=void 0,this.downing=!1,this.downingTimer=0,this.hitting=!1,this.hittingTimer=0}draw(t){const i=this.turn?"trans":"normal",e=this.moveImages[i];let s=this.stopImage[i];this.moving&&(this.movingTImer%5==0&&(this.movingImageIdx++,this.movingImageIdx>=e.length&&(this.movingImageIdx=0)),s=e[this.movingImageIdx]),(this.jumping||this.downing)&&(s=e[0]),(!this.hitting||this.hittingTimer>0&&this.hittingTimer%2==0)&&t.ctx.drawImage(s,this.viewX,h.GROUND_START_Y+this.viewY-this.height)}update(t){if(t.keyboard.find((t=>"ArrowRight"===t))){this.moving=!0,this.turn=!1,this.realX+=2+this.xv,this.movingTImer++;const i=h.CANVAS_WIDTH/2;this.realX>=i&&this.realX<=t.stageMaxX-i?this.viewX=h.CANVAS_WIDTH/2:this.realX>=t.stageMaxX?(this.realX=t.stageMaxX,this.viewX=h.CANVAS_WIDTH):this.viewX+=2+this.xv}else if(t.keyboard.find((t=>"ArrowLeft"===t))){this.moving=!0,this.turn=!0,this.movingTImer++,this.realX-=2+this.xv;const i=h.CANVAS_WIDTH/2;this.realX>=i&&this.realX<=t.stageMaxX-i?this.viewX=h.CANVAS_WIDTH/2:this.realX<=0?this.realX=this.viewX=0:this.viewX-=2+this.xv}else this.moving=!1,this.xv=0,this.movingTImer=0;this.moving&&this.xv<=this.maxXV&&(this.xv+=.01),!t.keyboard.find((t=>"ArrowUp"===t))||this.jumping||this.downing||(this.jumping=!0,this.standingPos=this.realY,this.jumpTop=void 0,this.jumpingTimer=0,c(...[,,443,.04,.05,.07,,.22,6,3.5,,,,.5,,,,.72,.05]));const i=t.getViewStages({x:this.realX,height:this.height}),e=this.realX+this.height/2;this.currentStage&&(this.currentStage.x>e||this.currentStage.x+this.currentStage.width<e)&&!this.downing&&!this.jumping&&(this.downing=!0,this.standingPos=this.realY,this.downingTimer=0),this.jumping&&this._jump(i),this.downing&&this._down(i),this.hitting&&(this.hittingTimer-=1,0===this.hittingTimer&&(this.hitting=!1))}_jump(t){const i=this.realY;this.realY=this.standingPos+.5*h.GRAVITY*this.jumpingTimer*this.jumpingTimer-this.yv*this.jumpingTimer,this.jumpingTimer++,this.realY>1&&this._reset();const e=i<this.realY;e&&!this.jumpTop&&(this.jumpTop=i);const s=t.find((t=>this.jumpTop<=t.y-h.GROUND_START_Y&&i<=t.y-h.GROUND_START_Y&&this.realY>=t.y-h.GROUND_START_Y));e&&s&&this._reset(s),this.viewY=this.realY}_down(t){const i=this.realY;this.realY=.5*h.GRAVITY*this.downingTimer*this.downingTimer+this.standingPos,this.downingTimer++,this.realY>1&&this._reset();const e=t.find((t=>i<=t.y-h.GROUND_START_Y&&this.realY>=t.y-h.GROUND_START_Y));e&&this._reset(e),this.viewY=this.realY}_reset(t){t?(this.realY=t.y-h.GROUND_START_Y,this.jumping=!1,this.downing=!1,this.jumpTop=void 0,this.currentStage=t):(this.realY=0,this.downing=!1,this.currentStage=void 0,this.jumping=!1,this.jumpTop=void 0)}}const u=[new Image,new Image],T=[new Image,new Image],b=[new Image,new Image],A=[new Image,new Image],_=new Image,I=new Image;((t,i)=>{let e=0;for(var s=0;s<t.length;++s)t[s].onload=function(){++e,e==t.length&&i(t)}})([u[0],u[1],T[0],T[1],b[0],b[1],A[0],A[1],_,I],(function(){const t=new x({stopImage:{normal:u[0],trans:u[1]},moveImages:{normal:[u[0],T[0]],trans:[u[1],T[1]]}});new w({player:t,stages:[],enemies:[],enemyMoveImages:A,enemyStopImages:b,coinImage:_,rosaryImage:I}).run()})),u[0].src="./assets/images/player_stop.png",u[1].src="./assets/images/player_stop_trans.png",T[0].src="./assets/images/player_move.png",T[1].src="./assets/images/player_move_trans.png",b[0].src="./assets/images/enemy_stop.png",b[1].src="./assets/images/enemy_stop_trans.png",A[0].src="./assets/images/enemy_move.png",A[1].src="./assets/images/enemy_move_trans.png",_.src="./assets/images/coin.png",I.src="./assets/images/rosary.png"})();