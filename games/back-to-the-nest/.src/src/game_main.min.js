let{init:init,initKeys:initKeys,setImagePath:setImagePath,load:load,on:on,imageAssets:imageAssets,TileEngine:TileEngine,Sprite:Sprite,SpriteSheet:SpriteSheet,Animation:Animation,keyPressed:keyPressed,Context:Context,GameLoop:GameLoop}=kontra,{canvas:canvas,context:context}=init();canvas.width=640,canvas.height=640;let canvasWidthMid=canvas.width/2,canvasHeightMid=canvas.height/2;initKeys();let numAssets=6,assetsLoaded=0;on("assetLoaded",(e,t)=>{assetsLoaded++,console.log("#"+assetsLoaded+" asset loaded")});let sprites=[];function sphereCollision(e){let t=this.x-e.x,i=this.y-e.y;return Math.sqrt(t*t+i*i)<this.radius+e.radius}function moveToWorm(e,t){if(0==t.isAlive);else{let i=t.x,a=e.x;e.dx=i>a?e.playerSpeed:-e.playerSpeed}}function moveToNest(e){return e.distanceFromNest<=0?void(e.dx=0):void(e.distanceFromNest>0&&(e.dx=-e.playerSpeed))}function spawnEnemyBird(e,t,i){let a=-4.12-e.width/2,s=-9.23-e.width;rand=Math.random();let o=Math.floor(rand*(s-a+1))+a;rand=Math.random();let r=Math.floor(rand*(6.23-4.12+1))+4.12,l=e.mapwidth,n=Math.floor(rand*(canvas.height-canvas.height/4-canvas.height/4))+canvas.height/4,h=Sprite({x:l,y:n,dx:o,dy:r,swoopRadians:0,radius:5,anchor:{x:.5,y:.5},collidesWith:sphereCollision,animations:t.animations,update(t){this.swoopRadians+=.0125,this.y=n+canvas.height/4*Math.sin(this.swoopRadians),this.dy=0,e.width>25&&(this.x+=o),this.collidesWith(t)&&(t.hasEnemyCollision=1),this.x<0&&(this.ttl=0,e.removeObject(this))}});h.playAnimation("flapLeft"),i.push(h),e.addObject(h)}function addChunkToMap(e){let t=e.layers[1].data,i=0,a=e.width,s=[],o=[1,3,5],r=[1,1,1,1,1,1,4],l=0;for(var n=0;n<10;n++){for(var h=0;h<a;h++)s.push(t[i]),i+=1;for(h=0;h<8;h++)9==n?s.push(2):8==n?(l=Math.floor(3*Math.random()),s.push(o[l])):(l=Math.floor(7*Math.random()),s.push(r[l]))}let d=s;return d=d.map(function(e){return e<2?0:4==e?0:e}),(e=TileEngine({tilewidth:64,tileheight:64,width:a=(i+80)/10,height:10,tilesets:[{firstgid:1,image:imageAssets.BackToTheNestMap}],layers:[{name:"collision",data:d},{name:"background",data:s}]})).setTileAtLayer("background",{x:e.mapwidth-100,y:550},1),e.setTileAtLayer("collision",{x:e.mapwidth-100,y:550},0),e}function initMap(){return TileEngine({tilewidth:64,tileheight:64,width:2,height:10,tilesets:[{firstgid:1,image:imageAssets.BackToTheNestMap}],layers:[{name:"collision",data:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,2]},{name:"background",data:[1,1,1,1,1,1,4,1,1,1,1,1,1,4,1,1,1,6,2,2]}]})}setImagePath("assets/sprites"),load("Chick.png","BackToTheNestMap.png","MotherBirdFullSpriteSheet.png","BirdEnemyFullSpriteSheet.png","WormFullSpriteSheet.png","Egg.png").then(function(e){console.log("All Assets Successfully Loaded.");let t=initMap(),i=SpriteSheet({image:imageAssets.MotherBirdFullSpriteSheet,frameWidth:64,frameHeight:64,animations:{idleRight:{frames:0},flapRight:{frames:[2,4,6,4],frameRate:15},hopRight:{frames:[0,8,10,8],frameRate:15},glideRight:{frames:24,frameRate:15},idleWormRight:{frames:12},flapWormRight:{frames:[14,16,18,16],frameRate:15},hopWormRight:{frames:[12,20,22,20],frameRate:15},glideWormRight:{frames:26,frameRate:15},idleLeft:{frames:1},flapLeft:{frames:[3,5,7,5],frameRate:15},hopLeft:{frames:[1,9,11,9],frameRate:15},glideLeft:{frames:25,frameRate:15},idleWormLeft:{frames:13},flapWormLeft:{frames:[15,17,19,17],frameRate:15},hopWormLeft:{frames:[1,21,23,21],frameRate:15},glideWormLeft:{frames:27,frameRate:15}}}),a=SpriteSheet({image:imageAssets.BirdEnemyFullSpriteSheet,frameWidth:64,frameHeight:64,animations:{flapLeft:{frames:[0,1,2],frameRate:15}}}),s=SpriteSheet({image:imageAssets.WormFullSpriteSheet,frameWidth:64,frameHeight:64,animations:{flapLeft:{frames:[0,1,2,3,4,5,6],frameRate:5}}});t=addChunkToMap(t);let o=0,r=0,l=0,n=0,h=t.mapwidth-100,d=0,m=[],p=Sprite({x:h,y:576,radius:20,anchor:{x:.5,y:1},collidesWith:sphereCollision,animations:s.animations});sprites.push(p);let f=Sprite({x:80,y:485,image:imageAssets.Egg,anchor:{x:.5,y:.5}});sprites.push(f);let g=Sprite({x:96,y:478,width:64,height:64,ddy:.05,anchor:{x:.5,y:.5},radius:17,collidesWith:sphereCollision,animations:i.animations,playerState:"IdleRight",hasForwardCollision:0,hasDownwardCollision:0,hasCollision:0,hasEnemyCollision:0,distanceFromNest:0,playerSpeed:3.5,isVulnerable:1,update(){if(1==this.hasEnemyCollision)this.dx=0,this.playerState="idleRight";else{if(this.distanceFromNest=this.x-96,this.hasCollision=t.layerCollidesWith("collision",g),1==this.hasCollision){let e=0,i=0;i=t.tileAtLayer("collision",{x:g.x,y:g.y+36}),(e=0==o?t.tileAtLayer("collision",{x:g.x+36,y:g.y}):t.tileAtLayer("collision",{x:g.x-36,y:g.y}))>0&&(this.hasForwardCollision=1),i>0&&(this.hasDownwardCollision=1)}else this.hasForwardCollision=0,this.hasDownwardCollision=0;1==this.hasForwardCollision&&(this.dx=0),0==o&&0==this.hasForwardCollision?moveToWorm(g,p):1==o&&0==this.hasForwardCollision&&moveToNest(g),keyPressed("space")?(this.y-=5,this.ddy=-.05,n=1,0==this.hasForwardCollision&&0==o&&(moveToWorm(g,p),this.playerState="FlapRight"),0==this.hasForwardCollision&&1==o&&(moveToNest(g),this.playerState="FlapWormLeft")):(this.ddy=.05,this.y<576&&0==o?this.playerState="GlideRight":this.y<576&&1==o&&(this.playerState="GlideWormLeft")),this.y>540&&0==keyPressed("space")&&(this.y=540,this.ddy=0,this.playerState=1==o?"HopWormLeft":"HopRight"),this.y<0&&(this.y=0)}switch(this.playerState){case"IdleRight":this.playAnimation("idleRight");break;case"IdleLeft":this.playAnimation("idleLeft");break;case"GlideRight":this.playAnimation("glideRight");break;case"GlideLeft":this.playAnimation("glideLeft");break;case"FlapRight":this.playAnimation("flapRight");break;case"FlapLeft":this.playAnimation("flapLeft");break;case"HopRight":this.playAnimation("hopRight");break;case"HopLeft":this.playAnimation("hopLeft");break;case"IdleWormRight":this.playAnimation("idleWormRight");break;case"IdleWormLeft":this.playAnimation("idleWormLeft");break;case"GlideWormRight":this.playAnimation("glideWormRight");break;case"GlideWormLeft":this.playAnimation("glideWormLeft");break;case"FlapWormRight":this.playAnimation("flapWormRight");break;case"FlapWormLeft":this.playAnimation("flapWormLeft");break;case"HopWormRight":this.playAnimation("hopWormRight");break;case"HopWormLeft":this.playAnimation("hopWormLeft");break;default:this.playAnimation("glideRight")}this.advance()}});sprites.push(g);let c=Sprite({x:120,y:485,radius:2,anchor:{x:.5,y:.5},collidesWith:sphereCollision,image:imageAssets.Chick});sprites.push(c);for(var y=0;y<sprites.length;y++)t.addObject(sprites[y]);for(y=0;y<m.length;y++)t.addObject(m[y]);GameLoop({update:function(){if(sprites.map(e=>{e.update()}),m.map(e=>{e.update(g),e.playAnimation("flapLeft")}),1==g.hasEnemyCollision){if(g.playerHasWorm=0,keyPressed("enter")){l=0,m.map(e=>{e.ttl=0,t.removeObject(e)}),t=addChunkToMap(t=initMap()),g.x=96,g.y=478,g.playerHasWorm=0,p.ttl=999999,p.x=t.mapwidth-100,sprites.push(p);for(var e=0;e<sprites.length;e++)t.addObject(sprites[e]);g.hasEnemyCollision=0}}else{if(g.x>=canvas.width/2&&0==o?t.sx=g.x-320:1==o&&(t.sx=g.x-320),p.collidesWith(g)&&(o=1,p.ttl=0),1==o&&(d+=1/60)>1&&(d=0,spawnEnemyBird(t,a,m)),g.distanceFromNest<=0&&1==o){(l+=1)>r&&(r+=1),o=0,d=0,t=addChunkToMap(t),p.ttl=999999,p.x=t.mapwidth-100,sprites.push(p);for(e=0;e<sprites.length;e++)t.addObject(sprites[e]);for(e=0;e<m.length;e++)t.addObject(m[e])}sprites=sprites.filter(e=>e.isAlive()),m=m.filter(e=>e.isAlive())}},render:function(){t.renderLayer("background"),sprites.map(e=>e.render()),m.map(e=>e.render()),context.font="30px Verdana";var e=context.createLinearGradient(0,canvas.width/4,canvas.width-canvas.width/4,0);e.addColorStop("0"," magenta"),e.addColorStop("0.5","blue"),e.addColorStop("1.0","red"),context.fillStyle=e,0==n&&(context.fillText("Hit spacebar to fly!",canvas.width/4,canvas.height/2),context.fillText("Bring back a worm to produce an egg",30,canvas.height/1.8)),1==g.hasEnemyCollision&&(context.fillText("GAME OVER!",canvas.width/4,canvas.height/2),context.fillText("Hit enter to continue",canvas.width/4,canvas.height/1.5));var i=imageAssets.Egg;context.drawImage(i,0,0),context.fillText(l,64,64);i=imageAssets.Egg;context.drawImage(i,350,0),context.fillText("High Score: "+r,400,64)}}).start()});