!function(){"use strict";var e=(e,i)=>{var r=0;return i.map(i=>{e[r++]=i.x,e[r++]=i.y,e[r++]=i.z}),e},i=(i,r)=>{var t=new Float32Array(3*r.vertices.length);i.attrs.position=e(t,r.vertices);var n=new Float32Array(3*r.colors.length);return i.attrs.color=e(n,r.colors),i},t=(e=0,i=0,r=0)=>({x:e,y:i,z:r}),n=t(),a=(e,i,r,t)=>(e.x=i,e.y=r,e.z=t,e),v=(e,i)=>(e.x=i,e.y=i,e.z=i,e),m=e=>t(e.x,e.y,e.z),y=(e,i)=>(e.x+=i.x,e.y+=i.y,e.z+=i.z,e),d=(e,i,r)=>(e.x+=i.x*r,e.y+=i.y*r,e.z+=i.z*r,e),l=(e,i)=>(e.x-=i.x,e.y-=i.y,e.z-=i.z,e),p=(e,i,r)=>(e.x=i.x-r.x,e.y=i.y-r.y,e.z=i.z-r.z,e),x=(e,i)=>(e.x*=i,e.y*=i,e.z*=i,e),g=(e,i)=>{var{x:r,y:t,z:n}=e,a=1/(i[3]*r+i[7]*t+i[11]*n+i[15]);return e.x=(i[0]*r+i[4]*t+i[8]*n+i[12])*a,e.y=(i[1]*r+i[5]*t+i[9]*n+i[13])*a,e.z=(i[2]*r+i[6]*t+i[10]*n+i[14])*a,e},f=(e,i)=>{var{x:r,y:t,z:n}=e,a=i.x,o=i.y,s=i.z,c=i.w,v=c*r+o*n-s*t,m=c*t+s*r-a*n,y=c*n+a*t-o*r,d=-a*r-o*t-s*n;return e.x=v*c+d*-a+m*-s-y*-o,e.y=m*c+d*-o+y*-a-v*-s,e.z=y*c+d*-s+v*-o-m*-a,e},u=(e,i)=>{var{x:r,y:t,z:n}=e;return e.x=i[0]*r+i[4]*t+i[8]*n,e.y=i[1]*r+i[5]*t+i[9]*n,e.z=i[2]*r+i[6]*t+i[10]*n,M(e)},b=(e,i)=>x(e,1/i),z=(e,i)=>e.x*i.x+e.y*i.y+e.z*i.z,w=e=>Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z),M=e=>b(e,w(e)||1),_=(e,i)=>x(M(e),i),j=(e,i)=>{var{x:r,y:t,z:n}=e;return e.x=t*i.z-n*i.y,e.y=n*i.x-r*i.z,e.z=r*i.y-t*i.x,e},O=(e,i,r)=>{var t=i.x,n=i.y,a=i.z,o=r.x,s=r.y,c=r.z;return e.x=n*c-a*s,e.y=a*o-t*c,e.z=t*s-n*o,e},R=(e,i)=>Math.sqrt(A(e,i)),A=(e,i)=>{var r=e.x-i.x,t=e.y-i.y,n=e.z-i.z;return r*r+t*t+n*n},P=(e,i)=>(e.x=i[12],e.y=i[13],e.z=i[14],e),F=(e,i)=>(e.x=i[0],e.y=i[1],e.z=i[2],e),L=t(1,0,0),E=t(0,1,0),C=t(0,0,1),T=(e,i,r)=>{var t=z(e,i);t<0?t*=r:t/=r,d(e,i,-t)},k=t(),S=t(),I=t(),q=()=>new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),W=(e,i,r)=>{var t=i[0],n=i[4],a=i[8],o=i[12],s=i[1],c=i[5],v=i[9],m=i[13],y=i[2],d=i[6],l=i[10],p=i[14],x=i[3],g=i[7],f=i[11],u=i[15],h=r[0],b=r[4],z=r[8],w=r[12],M=r[1],_=r[5],j=r[9],O=r[13],R=r[2],A=r[6],P=r[10],F=r[14],L=r[3],E=r[7],C=r[11],T=r[15];return e[0]=t*h+n*M+a*R+o*L,e[4]=t*b+n*_+a*A+o*E,e[8]=t*z+n*j+a*P+o*C,e[12]=t*w+n*O+a*F+o*T,e[1]=s*h+c*M+v*R+m*L,e[5]=s*b+c*_+v*A+m*E,e[9]=s*z+c*j+v*P+m*C,e[13]=s*w+c*O+v*F+m*T,e[2]=y*h+d*M+l*R+p*L,e[6]=y*b+d*_+l*A+p*E,e[10]=y*z+d*j+l*P+p*C,e[14]=y*w+d*O+l*F+p*T,e[3]=x*h+g*M+f*R+u*L,e[7]=x*b+g*_+f*A+u*E,e[11]=x*z+g*j+f*P+u*C,e[15]=x*w+g*O+f*F+u*T,e},B=(e,i)=>{var r=i[0],t=i[1],n=i[2],a=i[3],o=i[4],s=i[5],c=i[6],v=i[7],m=i[8],y=i[9],d=i[10],l=i[11],p=i[12],x=i[13],g=i[14],f=i[15],u=y*g*v-x*d*v+x*c*l-s*g*l-y*c*f+s*d*f,h=p*d*v-m*g*v-p*c*l+o*g*l+m*c*f-o*d*f,b=m*x*v-p*y*v+p*s*l-o*x*l-m*s*f+o*y*f,z=p*y*c-m*x*c-p*s*d+o*x*d+m*s*g-o*y*g,w=r*u+t*h+n*b+a*z;if(0===w)return(e=>(e.set([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),e))(e);var M=1/w;return e[0]=u*M,e[1]=(x*d*a-y*g*a-x*n*l+t*g*l+y*n*f-t*d*f)*M,e[2]=(s*g*a-x*c*a+x*n*v-t*g*v-s*n*f+t*c*f)*M,e[3]=(y*c*a-s*d*a-y*n*v+t*d*v+s*n*l-t*c*l)*M,e[4]=h*M,e[5]=(m*g*a-p*d*a+p*n*l-r*g*l-m*n*f+r*d*f)*M,e[6]=(p*c*a-o*g*a-p*n*v+r*g*v+o*n*f-r*c*f)*M,e[7]=(o*d*a-m*c*a+m*n*v-r*d*v-o*n*l+r*c*l)*M,e[8]=b*M,e[9]=(p*y*a-m*x*a-p*t*l+r*x*l+m*t*f-r*y*f)*M,e[10]=(o*x*a-p*s*a+p*t*v-r*x*v-o*t*f+r*s*f)*M,e[11]=(m*s*a-o*y*a-m*t*v+r*y*v+o*t*l-r*s*l)*M,e[12]=z*M,e[13]=(m*x*n-p*y*n+p*t*d-r*x*d-m*t*g+r*y*g)*M,e[14]=(p*s*n-o*x*n-p*t*c+r*x*c+o*t*g-r*s*g)*M,e[15]=(o*y*n-m*s*n+m*t*c-r*y*c-o*t*d+r*s*d)*M,e},D=(e,i)=>e+Math.random()*(i-e),N=e=>e*(.5-Math.random()),V=(e=0,i=0,r=0,t=1)=>({x:e,y:i,z:r,w:t}),U=(e,i)=>(e.x=i.x,e.y=i.y,e.z=i.z,e.w=i.w,e),G=(e,i)=>{var{x:r,y:t,z:n}=i,a=Math.cos(r/2),o=Math.cos(t/2),s=Math.cos(n/2),c=Math.sin(r/2),v=Math.sin(t/2),m=Math.sin(n/2);return e.x=c*o*s+a*v*m,e.y=a*v*s-c*o*m,e.z=a*o*m+c*v*s,e.w=a*o*s-c*v*m,e},H=e=>{var i=(e=>Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w))(e);return i?(i=1/i,e.x=e.x*i,e.y=e.y*i,e.z=e.z*i,e.w=e.w*i):(e.x=0,e.y=0,e.z=0,e.w=1),e},$=t(),K=q(),Y=()=>({parent:void 0,children:[],components:[],position:t(),quaternion:V(),scale:t(1,1,1),matrix:q(),matrixWorld:q(),modelViewMatrix:q(),visible:!0}),X=(e,i)=>{((e,i,r,t)=>(p(I,i,r),w(I)||(I.z=1),M(I),O(k,t,I),w(k)||(1===Math.abs(t.z)?I.x+=1e-4:I.z+=1e-4,M(I),O(k,t,I)),M(k),O(S,I,k),e[0]=k.x,e[4]=S.x,e[8]=I.x,e[1]=k.y,e[5]=S.y,e[9]=I.y,e[2]=k.z,e[6]=S.z,e[10]=I.z,e))(K,i,e.position,E),((e,i)=>{var r,t=i[0],n=i[4],a=i[8],o=i[1],s=i[5],c=i[9],v=i[2],m=i[6],y=i[10],d=t+s+y;d>0?(r=.5/Math.sqrt(d+1),e.w=.25/r,e.x=(m-c)*r,e.y=(a-v)*r,e.z=(o-n)*r):t>s&&t>y?(r=2*Math.sqrt(1+t-s-y),e.w=(m-c)/r,e.x=.25*r,e.y=(n+o)/r,e.z=(a+v)/r):s>y?(r=2*Math.sqrt(1+s-t-y),e.w=(a-v)/r,e.x=(n+o)/r,e.y=.25*r,e.z=(c+m)/r):(r=2*Math.sqrt(1+y-t-s),e.w=(o-n)/r,e.x=(a+v)/r,e.y=(c+m)/r,e.z=.25*r)})(e.quaternion,K)},Q=(e,i)=>(i.parent=e,e.children.push(i),e),J=(e,i)=>{var r=e.children.indexOf(i);r>=0&&e.children.splice(r,1)},Z=(e,i,r)=>(f(Object.assign($,i),e.quaternion),y(e.position,x($,r)),e),ee=(e,i)=>Z(e,C,i),ie=(e,i)=>{i(e),e.children.map(e=>ie(e,i))},re=e=>{(e=>{((e,i,r,t)=>{var{x:n,y:a,z:o,w:s}=r,c=n+n,v=a+a,m=o+o,y=n*c,d=n*v,l=n*m,p=a*v,x=a*m,g=o*m,f=s*c,u=s*v,h=s*m,b=t.x,z=t.y,w=t.z;e[0]=(1-(p+g))*b,e[1]=(d+h)*b,e[2]=(l-u)*b,e[3]=0,e[4]=(d-h)*z,e[5]=(1-(y+g))*z,e[6]=(x+f)*z,e[7]=0,e[8]=(l+u)*w,e[9]=(x-f)*w,e[10]=(1-(y+p))*w,e[11]=0,e[12]=i.x,e[13]=i.y,e[14]=i.z,e[15]=1})(e.matrix,e.position,e.quaternion,e.scale)})(e),e.parent?W(e.matrixWorld,e.parent.matrixWorld,e.matrix):((e,i)=>(e.set(i),e))(e.matrixWorld,e.matrix),e.children.map(re)},te=Math.PI/180,ne=e=>{var{near:i,far:r}=e,t=i*Math.tan(.5*te*e.fov),n=-t,a=n*e.aspect,o=t*e.aspect,s=2*i/(o-a),c=2*i/(t-n),v=(o+a)/(o-a),m=(t+n)/(t-n),y=-(r+i)/(r-i),d=-2*r*i/(r-i);e.projectionMatrix.set([s,0,0,0,0,c,0,0,v,m,y,-1,0,0,d,0])},ae=V(),oe=V(),se=e=>{let i=()=>{};return"function"==typeof e&&(i=e,e={}),{parent:void 0,update:i,...e}},ce=(e,...i)=>(i.map(i=>{ve(e,i)||(i.parent=e,e.components.push(i))}),e),ve=(e,i)=>e.components.includes(i),me=(e,...i)=>{e.components.map(e=>e.update(e,...i))},ye=(...e)=>e.reduceRight((e,i)=>(...r)=>e(i(...r))),de=e=>(...i)=>r=>e(r,...i),le=e=>e[Math.floor(Math.random()*e.length)],pe=window.AudioContext||window.webkitAudioContext,xe=window.OfflineAudioContext||window.webkitOfflineAudioContext,ge=new pe,{sampleRate:fe}=ge,ue=(e,i,r)=>{for(var t=i*fe,n=ge.createBuffer(1,t,fe),a=n.getChannelData(0),o=0;o<t;o++)a[o]=e(o/fe,o,a)*r;return n},he=["c","cs","d","ds","e","f","fs","g","gs","a","as","b"],be=/(\w+)(\d+)/,ze=ge.createGain();ze.gain.value=.3,ze.connect(ge.destination);var we=ge.createGain();we.gain.value=1-ze.gain.value,we.connect(ge.destination);var Me=ge.createConvolver();Me.connect(ze);var _e=ge.createGain();_e.gain.value=.8,_e.connect(we),_e.connect(Me);var je=ue((e,i,r)=>(2*Math.random()-1)*Math.pow(r.length,-i/r.length),3,1);(e=>{var i=new xe(1,je.length,fe),r=i.createBufferSource();r.buffer=je,r.connect(i.destination),r.start();var t=i.startRendering();void 0!==t?t.then(i=>e.buffer=i):i.oncomplete=i=>e.buffer=i.renderedBuffer})(Me);var Oe=(e,i)=>r=>{var t=e(r);return e=>i*t(e)},Re=((e,i,r)=>new Proxy({},{get(t,n){if(!t[n]){var a=ue(e((e=>2**((e-69)/12)*440)((e=>{var i=e.match(be);if(i){var[,r,t]=i;return 12*(+t+1)+he.indexOf(r)}})(n))),i,r);t[n]=a}return t[n]}}))(((e,i)=>r=>{var t=e(r),n=i(r);return e=>t(e)*n(e)})(((e,i)=>r=>{var t=e(r),n=i(r);return e=>t(e)+n(e)})(Oe(e=>i=>Math.sin(2*i*Math.PI*e),.5),Oe(()=>{var e=0;return()=>{var i=N(1),r=(e+.02*i)/1.02;return e=r,3.5*r}},1)),(e=>()=>i=>Math.exp(-i*e))(16)),.25,1),Ae=e=>((e,i=ge.destination)=>{var r=ge.createBufferSource();r.buffer=e,r.connect(i),r.start()})(e,_e),Pe=()=>{ge.resume(),(async()=>{ge.resume()})(),document.removeEventListener("click",Pe)};document.addEventListener("click",Pe);var Fe,Le,Ee,Ce,Te,ke,Se,Ie,qe,We,Be,De,Ne,Ve,Ue,Ge,He,$e,Ke,Ye,Xe=(e,i,r)=>({a:e,b:i,c:r,color:t(1,1,1),vertexColors:[]}),Qe=e=>({a:e.a,b:e.b,c:e.c,color:m(e.color),vertexColors:e.vertexColors.map(m)}),Je=t(),Ze=(e,i,r,t)=>(a(Je,i,r,t),e.vertices.map(e=>y(e,Je)),e),ei=de(Ze),ii=de((e,i)=>{var r=e.vertices.length;return e.vertices.push(...i.vertices.map(m)),e.faces.push(...i.faces.map(e=>{var i=Qe(e);return i.a+=r,i.b+=r,i.c+=r,i})),e}),ri=de(e=>{var i={vertices:[],faces:[]};return i.vertices=e.vertices.map(m),i.faces=e.faces.map(Qe),i}),ti=(e,i,r)=>{var n=e/2,a=i/2,o=r/2;return((e,i,r)=>{var n,a=e.vertices.length;for(n=0;n<i.length;n+=3)e.vertices.push(t(i[n],i[n+1],i[n+2]));for(n=0;n<r.length;n+=3)e.faces.push(Xe(a+r[n],a+r[n+1],a+r[n+2]));return e})({vertices:[],faces:[]},[n,a,o,n,a,-o,n,-a,o,n,-a,-o,-n,a,-o,-n,a,o,-n,-a,-o,-n,-a,o],[0,2,1,2,3,1,4,6,5,6,7,5,4,5,1,5,0,1,7,6,2,6,3,2,5,7,0,7,2,0,1,3,4,3,6,4])},ni=[0],ai=[1],oi=[2],si=[3],ci=[4],vi=[5],mi=[6],yi=[7],di=[...ni,...ai],li=[...oi,...si],pi=[...ci,...vi],xi=[...mi,...yi],gi=[...ni,...oi],fi=[...ai,...si],ui=[...ci,...mi],hi=[...vi,...yi],bi=[...ni,...vi],zi=[...ai,...ci],wi=[...oi,...yi],Mi=[...si,...mi],_i=[...di,...li],ji=[...pi,...xi],Oi={px_py_pz:ni,px_py_nz:ai,px_ny_pz:oi,px_ny_nz:si,nx_py_nz:ci,nx_py_pz:vi,nx_ny_nz:mi,nx_ny_pz:yi,px_py:di,px_ny:li,nx_py:pi,nx_ny:xi,px_pz:gi,px_nz:fi,nx_nz:ui,nx_pz:hi,py_pz:bi,py_nz:zi,ny_pz:wi,ny_nz:Mi,px:_i,nx:ji,py:[...di,...pi],ny:[...li,...xi],pz:[...gi,...hi],nz:[...fi,...ui],all:[..._i,...ji]},Ri=de((Fe=t(),(e,i)=>(((e,i,r=t())=>(a(r,0,0,0),i.map(i=>y(r,e.vertices[i])),b(r,i.length),r))(e,Oi[i],Fe),Ze(e,-Fe.x,-Fe.y,-Fe.z)))),Ai=de((Le=t(),(e,i=t())=>(r,t)=>(Object.keys(t).map(n=>{var a=t[n],o=Oi[n];if(Array.isArray(a))F(Le,a);else if("object"==typeof a)Object.assign(Le,i,a);else{if("number"!=typeof a)return;v(Le,a)}o.map(i=>e(r.vertices[i],Le))}),r))((e,i)=>(e.x*=i.x,e.y*=i.y,e.z*=i.z,e),t(1,1,1))),Pi=e=>(i,r)=>(Object.keys(r).map(t=>{var n=r[t];Oi[t].map(r=>e(i.vertices[r],n))}),i),Fi=de(Pi((e,i)=>(e.x=i,e))),Li=de(Pi((e,i)=>(e.y=i,e))),Ei=()=>({color:t(1,1,1),specular:t(1/15,1/15,1/15),shininess:30,emissive:t()}),Ci=(e,i)=>({...Y(),geometry:e,material:i}),Ti=t(),ki=(e=t(1/0,1/0,1/0),i=t(-1/0,-1/0,-1/0))=>({min:e,max:i}),Si=(e,i)=>(Object.assign(e.min,i.min),Object.assign(e.max,i.max),e),Ii=(e,i)=>(((e,i)=>(e.x=Math.min(e.x,i.x),e.y=Math.min(e.y,i.y),e.z=Math.min(e.z,i.z),e))(e.min,i),((e,i)=>(e.x=Math.max(e.x,i.x),e.y=Math.max(e.y,i.y),e.z=Math.max(e.z,i.z),e))(e.max,i),e),qi=(e,i)=>((e=>(e.min.x=e.min.y=e.min.z=1/0,e.max.x=e.max.y=e.max.z-=1/0,e))(e),((e,i)=>(re(i),ie(i,i=>{var{geometry:r}=i;r&&r.vertices.map(r=>{Object.assign(Ti,r),g(Ti,i.matrixWorld),Ii(e,Ti)})}),e))(e,i),e),Wi=(e,i)=>e.min.x<=i.x&&i.x<=e.max.x&&e.min.y<=i.y&&i.y<=e.max.y&&e.min.z<=i.z&&i.z<=e.max.z,Bi=(e,i)=>!(e.max.x<=i.min.x||e.min.x>=i.max.x||e.max.y<=i.min.y||e.min.y>=i.max.y||e.max.z<=i.min.z||e.min.z>=i.max.z),Di=(e,i)=>(y(e.min,i),y(e.max,i),e),Ni=(e,i)=>ce(e,((e,i)=>se({physics:i,boundingBox:qi(ki(),e),velocity:t(),update(e,i){d(e.parent.position,e.velocity,i)},shouldCollide(){},collide(){}}))(e,i)),Vi=e=>((e,i)=>e.components.find(i))(e,Ui),Ui=e=>e.physics,Gi=e=>{var i=[];return ie(e,e=>{i.push(...((e,i)=>e.components.filter(i))(e,Ui))}),i},Hi=(Ee=t(),(e,i,r,t)=>{var n=t.max.x-r.min.x,o=r.max.x-t.min.x,s=t.max.y-r.min.y,c=r.max.y-t.min.y,v=t.max.z-r.min.z,m=r.max.z-t.min.z,p=0;n>0&&o>0&&(p=n<o?n:-o);var g=0;s>0&&c>0&&(g=s<c?s:-c);var f=0;v>0&&m>0&&(f=v<m?v:-m);var u=Math.abs(p),h=Math.abs(g),b=Math.abs(f);u<h&&u<b?a(Ee,p,0,0):h<b?a(Ee,0,g,0):a(Ee,0,0,f);var z=e.parent,w=i.parent;1===e.physics?(d(w.position,Ee,-1.001),T(i.velocity,M(Ee),1.001)):1===i.physics?(d(z.position,Ee,1.001),T(e.velocity,M(Ee),1.001)):(x(Ee,.5),y(z.position,Ee),l(w.position,Ee))}),$i=(Ce=t(),Te=t(),(e,i,r,t,n)=>{if(Bi(t,n))return e.allsolid=!0,void(e.fraction=0);v(Ce,1/0),p(Te,r.velocity,i.velocity);var o=Te.x,s=Te.y,c=Te.z,m=n.max.x-t.min.x,y=t.max.x-n.min.x,d=n.max.y-t.min.y,l=t.max.y-n.min.y,x=n.max.z-t.min.z,g=t.max.z-n.min.z,f=0,u=1/0;if(o<0){if(m<0)return;m>0&&(u=Math.min(-m/o,u)),y<0&&(Ce.x=y/o,f=Math.max(Ce.x,f))}else if(o>0){if(y<0)return;y>0&&(u=Math.min(y/o,u)),m<0&&(Ce.x=-m/o,f=Math.max(Ce.x,f))}if(!(f>u)){if(s<0){if(d<0)return;d>0&&(u=Math.min(-d/s,u)),l<0&&(Ce.y=l/s,f=Math.max(Ce.y,f))}else if(s>0){if(l<0)return;l>0&&(u=Math.min(l/s,u)),d<0&&(Ce.y=-d/s,f=Math.max(Ce.y,f))}if(!(f>u)){if(c<0){if(x<0)return;x>0&&(u=Math.min(-x/c,u)),g<0&&(Ce.z=g/c,f=Math.max(Ce.z,f))}else if(c>0){if(g<0)return;g>0&&(u=Math.min(g/c,u)),x<0&&(Ce.z=-x/c,f=Math.max(Ce.z,f))}f>u||(e.fraction=f,Ce.x<Ce.y&&Ce.x<Ce.z?a(e.normal,Math.sign(o),0,0):Ce.y<Ce.z?a(e.normal,0,Math.sign(s),0):a(e.normal,0,0,Math.sign(c)))}}}),Ki=(e,i)=>Di(Si(e,i.boundingBox),i.parent.position),Yi=(ke=ki(),Se=ki(),Ie=ki(),e=>{for(var i=0;i<e.length;i++)for(var r=e[i],t=i+1;t<e.length;t++){var n,a,o=e[t];if((1!==r.physics||1!==o.physics)&&(4!==r.physics||4!==o.physics)&&(4!==r.physics&&4!==o.physics||(4===r.physics?(n=r,a=o):(n=o,a=r),Ki(ke,a),!Wi(ke,n.parent.position)||!1!==n.collide(a.parent)))&&(Ki(Se,r),Ki(Ie,o),Bi(Se,Ie))){if(!1===r.collide(o.parent)||!1===o.collide(r.parent))continue;Hi(r,o,Se,Ie)}}}),Xi=()=>({allsolid:!1,fraction:1,endpos:t(),normal:t()}),Qi=(e,i)=>(e.allsolid=i.allsolid,e.fraction=i.fraction,Object.assign(e.endpos,i.endpos),Object.assign(e.normal,i.normal),e),Ji=(qe=Xi(),e=>(Qi(e,qe),e)),Zi=(()=>{var e=ki(),i=ki(),r=ki(),n=t(),a=t(),o=Xi();return(t,s,c,v)=>{Ji(s);var m=Gi(t.scene).filter(e=>e!==t.body);Object.assign(n,t.body.velocity),p(a,v,c),Object.assign(t.body.velocity,a),Di(Si(e,t.body.boundingBox),c),Di(Si(r,t.body.boundingBox),v),Ii(r,e.min),Ii(r,e.max);for(var d=0;d<m.length;d++){var l=m[d];Di(Si(i,l.boundingBox),l.parent.position),Bi(r,i)&&($i(Ji(o),t.body,l,e,i),o.fraction<s.fraction&&Qi(s,o))}Object.assign(t.body.velocity,n),((e,i,r,t)=>y(x(p(e,r,i),t),i))(s.endpos,c,v,s.fraction)}})(),er=(Be=t(),De=[...Array(5)].map(()=>t()),Ne=t(),Ve=Xi(),Ue=t(),Ge=t(),He=t(),(e,i)=>{i&&(Object.assign(Ge,e.body.velocity),Ge.y-=e.gravity*e.dt,e.body.velocity.y=.5*(e.body.velocity.y+Ge.y),e.groundPlane&&T(e.body.velocity,e.groundTrace.normal,1.001));var r,t=e.dt;for(e.groundPlane?(We=1,Object.assign(De[0],e.groundTrace.normal)):We=0,Object.assign(De[We],e.body.velocity),M(De[We]),We++,r=0;r<4;r++){if(Object.assign(Ue,e.object.position),d(Ue,e.body.velocity,t),Zi(e,Ve,e.object.position,Ue),Ve.allsolid)return e.body.velocity.y=0,!0;if(Ve.fraction>0&&Object.assign(e.object.position,Ve.endpos),1===Ve.fraction)break;if(t-=t*Ve.fraction,We>=5)return v(e.body.velocity,0),!0;var n;for(n=0;n<We;n++)if(z(Ve.normal,De[n])>.99){y(e.body.velocity,Ve.normal);break}if(!(n<We))for(Object.assign(De[We],Ve.normal),We++,n=0;n<We;n++)if(!(z(e.body.velocity,De[n])>=.1)){Object.assign(Ne,e.body.velocity),T(Ne,De[n],1.001),i&&(Object.assign(He,Ge),T(He,De[n],1.001));for(var a=0;a<We;a++)if(a!==n&&!(z(Ne,De[a])>=.1||(T(Ne,De[a],1.001),i&&T(He,De[a],1.001),z(Ne,De[n])>=0))){O(Be,De[n],De[a]),M(Be);var o=z(Be,e.body.velocity);Object.assign(Ne,Be),x(Ne,o),i&&(o=z(Be,Ge),Object.assign(He,Be),x(He,o));for(var s=0;s<We;s++)if(s!==n&&s!==a&&!(z(Ne,De[s])>=.1))return v(e.body.velocity,0),!0}Object.assign(e.body.velocity,Ne),i&&Object.assign(Ge,He);break}}return i&&Object.assign(e.body.velocity,Ge),0!==r}),ir=(()=>{var e=t(),i=t(),r=t(),n=t(),a=Xi();return(t,o)=>{if(Object.assign(e,t.object.position),Object.assign(i,t.body.velocity),!1!==er(t,o)&&(Object.assign(n,e),n.y-=18,Zi(t,a,e,n),Object.assign(r,E),!(t.body.velocity.y>0&&(1===a.fraction||z(t.groundTrace.normal,r)<.7)||(Object.assign(r,e),r.y+=18,Zi(t,a,e,r),a.allsolid)))){var s=a.endpos.y-e.y;Object.assign(t.object.position,a.endpos),Object.assign(t.body.velocity,i),er(t,o),Object.assign(n,t.object.position),n.y-=s,Zi(t,a,t.object.position,n),a.allsolid||Object.assign(t.object.position,a.endpos),a.fraction<1&&T(t.body.velocity,a.normal,1.001);var c=t.object.position.y-e.y;c>2&&(t.dy=Math.min(c,16))}}})(),rr=($e=t(),Ke=t(),e=>{if((e=>!(e.command.up<10||(2&e.movementFlags?(e.command.up=0,1):(e.groundPlane=!1,e.walking=!1,e.movementFlags|=2,e.body.velocity.y=270,0))))(e))tr(e);else{nr(e);var i=e.command.forward,r=e.command.right,t=ar(e);e.viewForward.y=0,e.viewRight.y=0,T(e.viewForward,e.groundTrace.normal,1.001),T(e.viewRight,e.groundTrace.normal,1.001),M(e.viewForward),M(e.viewRight),v($e,0),d($e,e.viewForward,i),d($e,e.viewRight,r),Object.assign(Ke,$e);var n=w(Ke);M(Ke),or(e,Ke,n*=t,10),T(e.body.velocity,e.groundTrace.normal,1.001),(e.body.velocity.x||e.body.velocity.z)&&ir(e,!1)}}),tr=(()=>{var e=t(),i=t();return r=>{nr(r);var t=r.command.forward,n=r.command.right,a=ar(r);r.viewForward.y=0,r.viewRight.y=0,M(r.viewForward),M(r.viewRight),v(e,0),d(e,r.viewForward,t),d(e,r.viewRight,n),e.y=0,Object.assign(i,e);var o=w(i);M(i),or(r,i,o*=a,1),r.groundPlane&&T(r.body.velocity,r.groundTrace.normal,1.001),ir(r,!0)}})(),nr=(Ye=t(),e=>{var i=e.body.velocity;Object.assign(Ye,i),e.walking&&(Ye.y=0);var r=w(Ye);if(r<1)return i.x=0,void(i.z=0);var t=0;e.walking&&(t+=6*(r<100?100:r)*e.dt);var n=r-t;n<0&&(n=0),x(i,n/=r)}),ar=e=>{var i=Math.abs(e.command.forward);if(Math.abs(e.command.right)>i&&(i=Math.abs(e.command.right)),Math.abs(e.command.up)>i&&(i=Math.abs(e.command.up)),!i)return 0;var r=Math.sqrt(e.command.forward**2+e.command.right**2+e.command.up**2);return e.speed*i/(127*r)},or=(e,i,r,t)=>{var n=r-z(e.body.velocity,i);if(!(n<=0)){var a=t*e.dt*r;a>n&&(a=n),d(e.body.velocity,i,a)}},sr=(()=>{var e=t(),i=Xi();return r=>{if(Object.assign(e,r.object.position),e.y-=.25,Zi(r,i,r.object.position,e),1===i.fraction)return r.groundPlane=!1,void(r.walking=!1);r.groundPlane=!0,r.walking=!0}})(),cr=t(),vr=t(),mr=t(),yr=t(),dr=q(),lr=t(),pr=t(),xr=(e=t(),i=t())=>({origin:e,direction:i}),gr=(e,i,r,n,a)=>{p(vr,r,i),p(mr,n,i),O(yr,vr,mr);var o=z(e.direction,yr),s=1;if(!(o>0)&&o<0){s=-1,o*=-1,p(cr,e.origin,i);var c=s*z(e.direction,O(mr,cr,mr));if(!(c<0)){var v=s*z(e.direction,j(vr,cr));if(!(v<0||c+v>o)){var m=-s*z(cr,yr);if(!(m<0))return((e,i,r=t())=>y(x(Object.assign(r,e.direction),i),e.origin))(e,m/o,a)}}}},fr=xr(),ur=(e,i)=>{var r=[];B(dr,i.matrixWorld),hr(((e,i)=>(Object.assign(e.origin,i.origin),Object.assign(e.direction,i.direction),e))(fr,e),dr);var{vertices:t,faces:n}=i.geometry;return n.map((n,a)=>{var o=t[n.a],s=t[n.b],c=t[n.c],v=((e,i,r,t,n,a)=>{if(gr(i,r,t,n,a))return Object.assign(pr,a),g(pr,e.matrixWorld),m(pr)})(i,fr,o,s,c,lr);v&&r.push({point:v,object:i,face:n,faceIndex:a,distance:R(e.origin,v)})}),r},hr=(e,i)=>(g(e.origin,i),u(e.direction,i),e),br=q(),zr=m(E),wr=Ei();v(wr.color,0),v(wr.specular,0),wr.shininess=0;var Mr=t(0,-800,0),_r=ti(1,1,2),jr=[[1,.5,.2],[1,1,.8],[1,1,1]].map(e=>{var i=Ei();return F(i.color,e),F(i.emissive,e),i}),Or=t(),Rr=()=>{var e=0,i=Ei();i.emissive.x=1;var r,t=!1,o=ce(Ni(Ci(ti(1,1,4),i),4),se((i,n)=>{if(Object.assign(Or,o.position),v(o.position,0),X(o,r.velocity),Object.assign(o.position,Or),(e+=n)>4)J(o.parent,o);else if(t){J(o.parent,o);var s=(e=>{for(var i=Y(),r=[],t=e;t--;){var n=Ci(_r,le(jr));v(n.scale,D(1,8)),a(n.position,N(1),N(1),N(1)),Q(i,n);var o=_(m(n.position),D(64,128));r.push(o)}return i=ce(i,se((e,t)=>{var n=Math.exp(-4*t),a=0;i.children.map((e,i)=>{d(e.position,d(r[i],Mr,t),t),x(e.scale,n),w(e.scale)>.01&&a++}),a||J(i.parent,i)}))})(4);return Q(o.parent,s),void Object.assign(s.position,o.position)}}));return o.alive=!0,o.reflected=!1,(r=Vi(o)).collide=e=>!!o.alive&&(!(e.iT&&!o.reflected)&&(e.iR?(o.reflected=!0,i.emissive.y=1,Object.assign(Or,e.normal),z(r.velocity,Or)<0&&(e=>(e.x=-e.x,e.y=-e.y,e.z=-e.z,e))(Or),((e,i)=>l(e,x(Object.assign(n,i),2*z(e,i))))(r.velocity,Or),!1):void(t=!0))),o},Ar=e=>{var i=0,r=ye(Ri("ny"),Ai({py:[.75,1,.75]}))(ti(24,24,24)),t=20,n=Ei();a(n.color,2.5,1,1.2);var o=ce(Ni(Ci(r,n),1),se(()=>n.emissive.z=0),((e,i)=>{var r=0;return se((t,n)=>{(r+=n)>e&&(i(),r-=e)})})(.1,()=>{var r=xr();Object.assign(r.origin,o.position),r.origin.y+=18,p(r.direction,e.object.position,o.position);var t=((e,i)=>i.flatMap(i=>ur(e,i)).sort((e,i)=>e.distance-i.distance))(r,Gi(e.scene).filter(i=>i.parent!==o&&!i.parent.iR&&(i===e.body||1===i.physics)).map(e=>e.parent));if(t.length&&t[0].object===e.object){var n=Rr();Object.assign(n.position,o.position),n.position.y+=18,X(n,e.object.position),_(f(Object.assign(Vi(n).velocity,C),n.quaternion),512),((e,i)=>Z(e,L,i))(n,11*(i%2?-1:1)),ee(n,24*-Math.SQRT2),Q(e.scene,n),i=(i+1)%2,(()=>Ae(le([Re.f1,Re.gs1,Re.a1])))()}}));return o.iT=!0,Vi(o).collide=e=>{e.alive&&e.reflected&&(t--,e.alive=!1),t<=0&&J(o.parent,o)},o},Pr=Y(),Fr=!1,Lr=(()=>{var e={};return document.addEventListener("keydown",i=>e[i.code]=!0),document.addEventListener("keyup",i=>e[i.code]=!1),e})();c.addEventListener("mousedown",()=>Fr=!0),c.addEventListener("mouseup",()=>Fr=!1),r.addEventListener("click",()=>window.location.reload());var Er=(e,i,r)=>{e.uniform1f(i,r)},Cr=(e,i,r)=>{e.uniformMatrix4fv(i,!1,r)},Tr=(e,i,r)=>{e.uniform3f(i,r.x,r.y,r.z)},kr="#extension GL_OES_standard_derivatives : enable\nprecision highp float;precision highp int;\n#define R 0.31830988618\n#define s(a)clamp(a,0.0,1.0)\nuniform vec3 diffuse;uniform vec3 emissive;uniform vec3 specular;uniform float shininess;varying vec3 vColor;uniform vec3 fogColor;varying vec3 fogPosition;uniform float fogNear;uniform float fogFar;uniform vec3 ambient;struct D{vec3 direction;vec3 color;};uniform D directionalLights[NUM_DIR_LIGHTS];varying vec3 vViewPosition;void main(){vec3 dD=vec3(0.0);vec3 dS=vec3(0.0);vec3 c=diffuse*vColor;vec3 n=normalize(cross(dFdx(vViewPosition),dFdy(vViewPosition)));vec3 v=normalize(vViewPosition);for(int i=0;i<NUM_DIR_LIGHTS;i++){D d=directionalLights[i];vec3 r=s(dot(n,d.direction))*d.color;dD+=r*R*c;vec3 h=normalize(d.direction+v);float L=s(dot(d.direction,h));dS+=r*(((1.0-specular)*(exp2((-5.55473*L-6.98316)*L))+specular)*(0.25*(R*(shininess*0.5+1.0)*pow(s(dot(n,h)),shininess))));}gl_FragColor=vec4(mix(dD+(ambient*R*c)+dS+emissive,fogColor,smoothstep(fogNear,fogFar,length(fogPosition))),1.0);}",Sr=c.getContext("webgl");Sr.clearColor(0,0,0,0),Sr.enable(Sr.DEPTH_TEST),Sr.enable(Sr.CULL_FACE),Sr.getExtension("OES_standard_derivatives");var Ir=!0,qr=Y();qr.fogColor=t(),qr.fogNear=1,qr.fogFar=1e3;var Wr,Br,Dr,Nr,Vr=((e=60,i=1,r=.1,t=2e3)=>{var n={...Y(),fov:e,near:r,far:t,aspect:i,up:m(E),matrixWorldInverse:q(),projectionMatrix:q()};return ne(n),n})(90);((e,i)=>{if("pointerLockElement"in document){document.addEventListener("pointerlockchange",()=>{e.enabled=i===document.pointerLockElement}),document.addEventListener("click",()=>i.requestPointerLock())}else e.enabled=!0})((Wr=Vr,Br=t(),Dr=t(),Nr={object:Wr,sensitivity:.002,enabled:!1,onMouseMove(e){var i,r,t,n,a,o,s,c,v,m;Nr.enabled&&(Br.x-=e.movementY*Nr.sensitivity,Dr.y-=e.movementX*Nr.sensitivity,Br.x=((e,i,r)=>Math.min(Math.max(e,i),r))(Br.x,-Math.PI/2,Math.PI/2),G(ae,Br),G(oe,Dr),r=ae,t=(i=oe).x,n=i.y,a=i.z,o=i.w,s=r.x,c=r.y,v=r.z,m=r.w,i.x=t*m+o*s+n*v-a*c,i.y=n*m+o*c+a*s-t*v,i.z=a*m+o*v+t*c-n*s,i.w=o*m-t*s-n*c-a*v,Object.assign(Wr.quaternion,oe))}},document.addEventListener("mousemove",Nr.onMouseMove),Nr),c);var Ur=((e,i,r)=>{var n=[0,0,0];e.clearColor(...n,1),F(i.fogColor,n);var c=Y();Q(i,c);var m=t(.2,.2,.2),y=((e=t(),i=1)=>({...Y(),color:e,intensity:i,target:Y()}))(t(.6,.5,1.3));y.intensity=3,a(y.position,512,1024,256);var d=[y];d.map(e=>Q(c,e));var l=Y();Q(l,r),Q(c,l);var p=Ni(Ci(ti(30,56,30),Ei()),2);p.position.y+=28,p.visible=!1,Object.assign(l.position,p.position),Q(c,p);var x=Vi(p);x.update=()=>{};var g=((e,i)=>({object:e,body:i,scene:void 0,command:{forward:0,right:0,up:0,hook:0},dt:0,gravity:800,speed:320,viewForward:t(),viewRight:t(),movementFlags:0,walking:!1,groundPlane:!1,groundTrace:{normal:t(0,1,0)}}))(p,x);g.scene=c;var u=Ri("py");[[[128,16,1536],[0,0,-640]],[[512,16,256],[-64,0,-1280],Ri("px_py")],[[256,16,256],[-192,0,-1408],Ri("px_py_pz")],[[2048,64,2048],[-192,0,-1408],Ri("px_py_pz")]].map(([e,i,r=u])=>{var t=Ni(Ci(r(ti(...e)),Ei()),1);a(t.position,...i),a(t.material.color,.5,.5,.5),Q(c,t)});var b=e=>{var i=(e=>({...Ci(e.geometry,wr),mesh:e}))(e);i.position.y=.1,i.light=y,e.shadow=i},z=Ri("ny");[[[256,1024,256],[192,0,-512]],[[256,1024,256],[-256,0,-480]],[[256,1024,256],[-256,0,0]],[[256,1024,256],[-1152,0,-1576]],[[128,64,128],[0,0,-284]],[[96,64,160],[-208,0,-172]],[[16,128,1280],[-64,0,-512]],[[16,128,1536],[64,0,-640]],[[128,128,16],[0,0,128]],[[256,128,16],[64,0,-1400],Ri("px_ny")],[[512,128,16],[-56,0,-1148],Ri("px_ny")],[[16,128,256],[-192,0,-1392],Ri("px_ny_pz")],[[16,128,256],[-560,0,-1120],Ri("px_ny_pz")],[[16,128,256],[-560,0,-1120],Ri("px_ny_pz")],[[128,64,256],[-200,0,-1720],Ri("px_ny_pz")],[[128,64,256],[-760,0,-1600],Ri("px_ny_pz")],[[256,64,384],[-320,0,-1792],Ri("px_ny_pz")],[[512,32,64],[-386,128,-1728],Ri("px_ny_pz")],[[512,128,64],[-920,0,-2240],Ri("px_ny_pz")],[[256,32,256],[-1240,0,-2400],Ri("px_ny_pz")]].map(([e,i,r=z])=>{var t=Ni(Ci(r(ti(...e)),Ei()),1);a(t.position,...i),b(t),Q(c,t)});[[[128,8,16],[0,0,-100],8,-1],[[128,8,16],[-264,0,-1600],8,-1],[[128,8,16],[-824,0,-1484],8,-1],[[128,8,16],[-450,64,-1976],12,1]].map(([[e,i,r],[t,n,o],s,v])=>{for(var m=0;m<s;m++){var y=(m+1)*i,d=Ni(Ci(ti(e,y,r),Ei()),1);a(d.position,t,n+y/2,v*m*r+o),b(d),Q(c,d)}});[[0,0,-768],[-280,64,-1720],[-800,64,-1640],[-1e3,0,-1920],[-860,160,-1760],[-1320,32,-2500]].map(e=>{var i=Ar(g);a(i.position,...e),b(i),Q(c,i)});var w=(()=>{var e=ti(4,26,1),i=Ei();v(i.emissive,1);var r=ce(Ni(Ci(ti(56,56,16),i),1),se(()=>{f(Object.assign(r.normal,C),r.quaternion)}));return r.iR=!0,r.normal=t(),r.geometry=ye(ii(ye(ri(),ei(-26,17,0),Fi({nx_py:-4,px_py:-4}),Li({px_py:24}))(e)),ii(ye(ri(),ei(26,17,0),Fi({nx_py:4,px_py:4}),Li({nx_py:24}))(e)),ii(ye(ri(),ei(26,-17,0),Fi({nx_ny:4,px_ny:4}),Li({nx_ny:-24}))(e)),ii(ye(ri(),ei(-26,-17,0),Fi({nx_ny:-4,px_ny:-4}),Li({px_ny:-24}))(e)))({vertices:[],faces:[]}),r})();a(w.position,0,512,-512),Q(c,w);var _=100,O=100;return x.collide=e=>{e.alive&&(_-=2,e.alive=!1,_<=0&&(o.hidden=!1,document.exitPointerLock()))},ce(c,se((e,i)=>{if(!(_<=0)){var t=Gi(c);Yi(t),g.dt=i,g.command.forward=0,g.command.right=0,g.command.up=0,(Lr.KeyW||Lr.ArrowUp)&&g.command.forward++,(Lr.KeyS||Lr.ArrowDown)&&g.command.forward--,(Lr.KeyA||Lr.ArrowLeft)&&g.command.right--,(Lr.KeyD||Lr.ArrowRight)&&g.command.right++,Lr.Space&&g.command.up++;g.command.forward*=127,g.command.right*=127,g.command.up*=127,f(a(g.viewForward,0,0,-1),r.quaternion),M(j(a(g.viewRight,0,-1,0),g.viewForward)),(e=>{e.command.up<10&&(e.movementFlags&=-3),sr(e),e.walking?rr(e):tr(e),sr(e)})(g),g.time=performance.now();if(g.dy){var n,o=g.time-g.stepTime;n=o<200?g.stepChange*(200-o)/200:0,g.stepChange=Math.min(n+g.dy,32),g.stepTime=g.time,g.dy=0}Object.assign(l.position,p.position);var v=g.time-g.stepTime;if(!Number.isNaN(v)&&v<200&&(l.position.y-=g.stepChange*(200-v)/200),h.style.setProperty("--h",`${_}%`),s.style.setProperty("--h",`${O}%`),Fr&&O>0&&p.position.z<-256){O=Math.max(O-50*i,0),Object.assign(Pr.position,g.object.position),Object.assign(Pr.quaternion,r.quaternion),ee(Pr,-48);((e,i,r)=>(e.x+=(i.x-e.x)*r,e.y+=(i.y-e.y)*r,e.z+=(i.z-e.z)*r,e))(w.position,Pr.position,16*i),((e,i,r)=>{if(0===r)return e;if(1===r)return U(e,i);var{x:t,y:n,z:a,w:o}=e,s=o*i.w+t*i.x+n*i.y+a*i.z;if(s<0?(e.w=-i.w,e.x=-i.x,e.y=-i.y,e.z=-i.z,s=-s):U(e,i),s>=1)return e.w=o,e.x=t,e.y=n,e.z=a,e;var c=1-s*s;if(c<=Number.EPSILON){var v=1-r;return e.w=v*o+r*e.w,e.x=v*t+r*e.x,e.y=v*n+r*e.y,e.z=v*a+r*e.z,H(e)}var m=Math.sqrt(c),y=Math.atan2(m,s),d=Math.sin((1-r)*y)/m,l=Math.sin(r*y)/m;e.w=o*d+e.w*l,e.x=t*d+e.x*l,e.y=n*d+e.y*l,e.z=a*d+e.z*l})(w.quaternion,Pr.quaternion,16*i)}else O=Math.min(O+10*i,100);_=Math.min(_+1*i,100)}})),{ambient:m,directional:d}})(Sr,qr,Vr),Gr=((e,i,r)=>{var t=e.createProgram(),n=(i,r)=>{var n=e.createShader(i);e.shaderSource(n,r),e.compileShader(n),e.attachShader(t,n)};return n(e.VERTEX_SHADER,i),n(e.FRAGMENT_SHADER,r),e.linkProgram(t),t})(Sr,"precision highp int;precision highp float;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;attribute vec3 position;varying vec3 vViewPosition;attribute vec3 color;varying vec3 vColor;varying vec3 fogPosition;void main(){vColor=color;vec4 e=modelViewMatrix*vec4(position,1.0);gl_Position=projectionMatrix*e;vViewPosition=-e.xyz;fogPosition=e.xyz;}",kr.replace(/NUM_DIR_LIGHTS/g,Ur.directional.length));Sr.useProgram(Gr);var Hr,$r=((e,i)=>{for(var r={},t=e.getProgramParameter(i,e.ACTIVE_ATTRIBUTES),n=0;n<t;n++){var a=e.getActiveAttrib(i,n),{name:o}=a;r[o]=e.getAttribLocation(i,o)}return r})(Sr,Gr),Kr=((e,i)=>{for(var r={},t=e.getProgramParameter(i,e.ACTIVE_UNIFORMS),n=0;n<t;n++){var a=e.getActiveUniform(i,n),{name:o}=a;r[o]=e.getUniformLocation(i,o)}return r})(Sr,Gr),Yr=0,Xr=new WeakMap,Qr=(e,i,r,t)=>{var n=Xr.get(r);n||(n={},Xr.set(r,n));var a=n[e];a||(a=((e,i)=>{var r=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW),r})(Sr,r.attrs[e]),n[e]=a),((e,i,r,t)=>{e.bindBuffer(e.ARRAY_BUFFER,r),e.enableVertexAttribArray(i),e.vertexAttribPointer(i,t,e.FLOAT,!1,0,0)})(Sr,i,a,t)},Jr=new WeakMap,Zr=e=>{var{geometry:r,material:t}=e;Tr(Sr,Kr.fogColor,qr.fogColor),Er(Sr,Kr.fogNear,qr.fogNear),Er(Sr,Kr.fogFar,qr.fogFar),Tr(Sr,Kr.diffuse,t.color),Tr(Sr,Kr.specular,t.specular),Er(Sr,Kr.shininess,t.shininess),Tr(Sr,Kr.emissive,t.emissive),W(e.modelViewMatrix,Vr.matrixWorldInverse,e.matrixWorld),Cr(Sr,Kr.modelViewMatrix,e.modelViewMatrix),Cr(Sr,Kr.projectionMatrix,Vr.projectionMatrix);var n=Jr.get(r);n||(n=((e,r)=>i(e,(e=>{var i=[],r=[];return e.faces.map(t=>{i.push(e.vertices[t.a],e.vertices[t.b],e.vertices[t.c]);var{vertexColors:n}=t;if(3===n.length)r.push(...n);else{var{color:a}=t;r.push(a,a,a)}}),{vertices:i,colors:r}})(r)))({attrs:{}},r),Jr.set(r,n)),Qr("position",$r.position,n,3),Qr("color",$r.color,n,3),Sr.drawArrays(Sr.TRIANGLES,0,n.attrs.position.length/3)},et=t(),it=()=>{re(qr),B(Vr.matrixWorldInverse,Vr.matrixWorld),Sr.clear(Sr.COLOR_BUFFER_BIT|Sr.DEPTH_BUFFER_BIT),Tr(Sr,Kr.ambient,Ur.ambient),Ur.directional.map((e,i)=>{var r=t(),n=P(et,e.matrixWorld);P(r,e.target.matrixWorld),u(l(n,r),Vr.matrixWorldInverse);var a=x(Object.assign(r,e.color),e.intensity);Tr(Sr,Kr[`directionalLights[${i}].direction`],n),Tr(Sr,Kr[`directionalLights[${i}].color`],a)}),ie(qr,e=>{e.visible&&e.geometry&&e.material&&(Zr(e),e.shadow&&(((e,i,r=.001)=>{var{y:t}=e.position,n=z(zr,i)-t*r;br[0]=n-i.x*zr.x,br[4]=-i.x*zr.y,br[8]=-i.x*zr.z,br[12]=-i.x*-t,br[1]=-i.y*zr.x,br[5]=n-i.y*zr.y,br[9]=-i.y*zr.z,br[13]=-i.y*-t,br[2]=-i.z*zr.x,br[6]=-i.z*zr.y,br[10]=n-i.z*zr.z,br[14]=-i.z*-t,br[3]=-r*zr.x,br[7]=-r*zr.y,br[11]=-r*zr.z,br[15]=n-r*-t,W(e.matrixWorld,br,e.mesh.matrixWorld)})(e.shadow,e.shadow.light.position),Zr(e.shadow)))})},rt=()=>{(()=>{var e=.001*(performance.now()||0);Hr||(Hr=e);var i=Math.min(e-Hr,.1);for(Yr+=i,Hr=e;Yr>=1/60;)ie(qr,e=>{me(e,1/60,qr)}),Yr-=1/60})(),it(),Ir&&requestAnimationFrame(rt)},tt=(e,i)=>{var{devicePixelRatio:r=1}=window;c.width=e*r,c.height=i*r,c.style.width=`${e}px`,c.style.height=`${i}px`,Sr.viewport(0,0,c.width,c.height),Vr.aspect=e/i,ne(Vr)};tt(window.innerWidth,window.innerHeight),rt(),window.addEventListener("resize",()=>{tt(window.innerWidth,window.innerHeight),it()}),document.addEventListener("keypress",e=>{"KeyP"===e.code&&((Ir=!Ir)?rt():document.exitPointerLock())})}();