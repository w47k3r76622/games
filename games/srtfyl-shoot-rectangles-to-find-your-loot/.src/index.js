import{initFont,font}from"./tf.js";class Powerup{constructor(t,i,s,h,e){this.active=!0,this.game=t,this.x=i,this.y=s,this.width=15,this.height=15,this.name=h,this.icon=e}draw(){this.active&&(this.game.ctx.fillStyle="green",this.game.ctx.fillRect(this.x,this.y,this.width,this.height),this.game.render(this.icon,this.x,this.y,14,"black"),this.update())}update(){if(collision(this.game.player,this)){switch(this.name){case"laser":this.game.player.powerups.laser=!0,setTimeout((()=>{this.game.player.powerups.laser=!1}),5e3);break;case"split":this.game.player.powerups.split=!0,setTimeout((()=>{this.game.player.powerups.split=!1}),5e3)}this.active=!1}}}class Bullet{constructor(t,i=!1){this.game=t,this.height=15,this.width=15,this.x=t.player.x+t.player.width/2,this.y=t.player.y+t.player.height/2,this.rotation=t.player.rotation,this.vx=25,this.vy=25,this.active=!0,this.revert=i}draw(){(this.y>this.game.height||this.y<0||this.x>this.game.width||this.x<0)&&(this.active=!1),this.active&&(this.game.ctx.fillStyle="blue",this.game.ctx.fillRect(this.x,this.y,this.width,this.height),this.revert?(this.x-=Math.cos(this.rotation)*this.vx,this.y-=Math.sin(this.rotation)*this.vy):(this.x+=Math.cos(this.rotation)*this.vx,this.y+=Math.sin(this.rotation)*this.vy))}}class Enemy{constructor(t,i=25,s=25,h=100,e=1,a="yellow"){this.active=!0,this.game=t,this.ctx=t.ctx,this.height=i,this.width=s,this.health=h,this.score=e,this.color=a,this.x=getRandomInt(0,this.game.width-25),this.y=getRandomInt(0,this.game.height-25)}draw(){this.active&&(this.ctx.fillStyle=this.color,this.ctx.fillRect(this.x,this.y,this.width,this.height),this.checkHits())}checkHits(){let t=this.game.bullets.filter((t=>{if(collision(t,this))return!0}));t.length>0&&(this.game.player.powerups.laser||t.forEach((t=>t.active=!1)),Math.random()<this.game.player.critrate?this.health-=this.game.player.damage*this.game.player.critdamage:this.health-=this.game.player.damage,this.health<=0&&(this.active=!1,this.game.score+=this.score,getRandomInt(0,2)<.1&&(getRandomInt(0,2)<.5?this.game.drops.push(new Powerup(this.game,this.x,this.y,"split","S")):this.game.drops.push(new Powerup(this.game,this.x,this.y,"laser","L")))))}}class Boss extends Enemy{constructor(t){super(t,50,50,1e3,10,"red")}}class Player{constructor(t){this.active=!0,this.rotation=0,this.game=t,this.height=25,this.width=25,this.x=t.width/2-this.width/2,this.y=t.height/2-this.height/2,this.up=0,this.left=0,this.down=0,this.right=0,this.speed=5,this.critrate=1,this.critdamage=2,this.damage=100,this.range=0,this.health=3,this.autoshoot=!1,this.powerups={laser:!1,split:!1,invincible:!1}}draw(){if(this.active){if(this.game.enemies.filter((t=>collision(t,this))).length>0&&!this.powerups.invincible&&(console.log("Hit"),this.health-=1,this.powerups.invincible=!0,console.log("Invicible"),setTimeout((()=>{this.powerups.invincible=!1,console.log("Not Invicible")}),1e3)),this.health<=0)return this.active=!1,this.game.state=1,void(this.game.score>this.game.highscore&&(this.game.highscore=this.game.score,localStorage.setItem("o9asdjad_highscore",this.game.highscore)));this.game.ctx.save(),this.up&&(this.y-=this.speed),this.down&&(this.y+=this.speed),this.left&&(this.x-=this.speed),this.right&&(this.x+=this.speed),this.rotation=Math.atan2(this.game.mousepos.y-this.y,this.game.mousepos.x-this.x),this.game.ctx.fillStyle="red",this.game.ctx.translate(this.x+this.width/2,this.y+this.height/2),this.game.ctx.rotate(this.rotation),this.game.ctx.fillRect(-this.width/2,-this.height/2,this.width,this.height),this.game.ctx.translate(0,0),this.game.ctx.restore()}}}class Game{constructor(){this.state=2,this.bullets=[],this.enemies=[],this.canvas=document.getElementById("canvas"),this.ctx=this.canvas.getContext("2d"),this.height=window.innerHeight,this.width=window.innerWidth,this.player=new Player(this),this.score=0,this.highscore=localStorage.getItem("o9asdjad_highscore")??0,this.mousepos={},this.render=initFont(font,this.ctx),this.drops=[],this.stars=[],window.addEventListener("keydown",(t=>{38!=t.keyCode&&90!=t.keyCode&&87!=t.keyCode||(this.player.up=!0),39!=t.keyCode&&68!=t.keyCode||(this.player.right=!0),40!=t.keyCode&&83!=t.keyCode||(this.player.down=!0),37!=t.keyCode&&65!=t.keyCode&&81!=t.keyCode||(this.player.left=!0),70===t.keyCode&&(this.player.autoshoot=!this.player.autoshoot),this.player.rotation=Math.atan2(this.mousepos.y-this.player.y,this.mousepos.x-this.player.x)})),window.addEventListener("keyup",(t=>{38!=t.keyCode&&90!=t.keyCode&&87!=t.keyCode||(this.player.up=!1),39!=t.keyCode&&68!=t.keyCode||(this.player.right=!1),40!=t.keyCode&&83!=t.keyCode||(this.player.down=!1),37!=t.keyCode&&65!=t.keyCode&&81!=t.keyCode||(this.player.left=!1)})),this.canvas.addEventListener("mousemove",(t=>{const i=parseInt(t.clientX-offset(canvas).left),s=parseInt(t.clientY-offset(canvas).top);this.mousepos={x:i,y:s};const h=Math.atan2(s-this.player.y,i-this.player.x);this.player.rotation=h})),this.canvas.addEventListener("click",(t=>{this.bullets.push(new Bullet(this))})),this.init()}init(){this.canvas.style.height=this.height+"px",this.canvas.style.width=this.width+"px",this.canvas.setAttribute("height",this.height),this.canvas.setAttribute("width",this.width),this.initStars(),setInterval((()=>{this.enemies.length>100||(Math.random()<.1?this.enemies.push(new Boss(this)):this.enemies.push(new Enemy(this)))}),10),window.requestAnimationFrame(this.draw.bind(this))}draw(){if(0!==this.state){if(1===this.state){this.ctx.clearRect(0,0,this.width,this.height),this.ctx.translate(0,0);for(let t=0;t<this.enemies.length;t++)this.enemies[t].draw();this.ctx.save(),this.ctx.globalAlpha=.5,this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.globalAlpha=1;let t=(t,i)=>30*t+30*(""+i).length;this.render("GAME OVER",this.width/2-190,50,50,"white"),this.render(`SCORE: ${this.score}`,this.width/2-t(7,this.score)/2,this.height/2-50,40,"white"),this.render(`HIGHSCORE: ${this.highscore}`,this.width/2-t(11,this.highscore)/2,this.height/2,40,"white"),this.ctx.restore(),this.state=0}else if(2===this.state){this.ctx.save(),this.ctx.clearRect(0,0,this.width,this.height),this.ctx.translate(0,0);for(let t of this.stars)t.update();this.player.draw(),this.player.autoshoot&&(this.bullets.push(new Bullet(this)),this.player.powerups.split&&this.bullets.push(new Bullet(this,!0))),this.bullets=this.bullets.filter((t=>t.active)),this.enemies=this.enemies.filter((t=>t.active));for(let t=0;t<this.bullets.length;t++)this.bullets[t].draw();for(let t=0;t<this.enemies.length;t++)this.enemies[t].draw();for(let t=0;t<this.drops.length;t++)this.drops[t].draw();this.ctx.restore(),this.render(`SCORE: ${this.score}`,25,25,38,"white"),this.render(`LIVES: ${this.player.health}`,25,75,38,"white")}window.requestAnimationFrame(this.draw.bind(this))}}initStars(){for(let t=0;t<50;++t){const t=Math.random()*(this.width-starsConfig.nearStar.width),i=Math.random()*(this.height-starsConfig.nearStar.width);this.stars.push(new Star(this.ctx,t,i,starsConfig.nearStar.width,starsConfig.nearStar.speed))}for(let t=0;t<100;++t){const t=Math.random()*(this.width-starsConfig.midStar.width),i=Math.random()*(this.height-starsConfig.midStar.width);this.stars.push(new Star(this.ctx,t,i,starsConfig.midStar.width,starsConfig.midStar.speed))}for(let t=0;t<350;++t){const t=Math.random()*(this.width-starsConfig.farStar.width),i=Math.random()*(this.height-starsConfig.farStar.width);this.stars.push(new Star(this.ctx,t,i,starsConfig.farStar.width,starsConfig.farStar.speed))}}}const starsConfig={nearStar:{width:3,speed:.2},midStar:{width:2,speed:.1},farStar:{width:1,speed:.025}};function offset(t){var i=t.getBoundingClientRect(),s=document.body;return{top:i.top+s.scrollTop,left:i.left+s.scrollLeft}}function getRandomInt(t,i){return t=Math.ceil(t),i=Math.floor(i),Math.floor(Math.random()*(i-t)+t)}function collision(t,i){return t.x<i.x+i.width&&t.x+t.width>i.x&&t.y<i.y+i.height&&t.y+t.height>i.y}class Star{constructor(t,i,s,h,e){this.ctx=t,this.x=i,this.y=s,this.width=h,this.speed=e,this.color="#fff"}draw(){this.ctx.fillStyle=this.color,this.ctx.fillRect(this.x,this.y,this.width,this.width)}update(){this.x+this.width>innerWidth&&(this.x=0),this.x+=this.speed,this.draw()}}new Game;