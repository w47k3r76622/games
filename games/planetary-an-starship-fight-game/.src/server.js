(()=>{let e={};function t(t,s){setTimeout(()=>{e[t]&&delete e[t]},60*s*1e3)}class s{constructor(s,i,r,o){if(this.gameID=s,t(this.gameID,90),i.userID,this.gameID,!(r=parseInt(r))||2>r||r>10)return i.emit("notify","The number of players must to be between 2 and 10"),void this.gameID;this.players=[],this.ownerID=i.userID,this.numPlayers=r,this.isPublic=o,e[this.gameID]=this,i.emit("romCreated",this.gameID),this.addPlayer(i)}addPlayer(e){if(e.userID,this.gameID,this.players.length>=this.numPlayers)return this.gameID,e.emit("notify",`The room ${this.gameID} is full.`);this.players.push(e),e.join(this.gameID),e.room=this,this.gameID,this.players.length,this.players.length==this.numPlayers&&(this.gameID,this.isPublic=!1),e.emit("numPlayers",this.numPlayers),e.userID==this.ownerID&&(this.owner=e,e.emit("youAreTheOwner")),this.emit("usrsConn",this.players.map(e=>e.userID))}disconnect(e){this.players=this.players.filter(t=>t.id!=e.id),this.emit("usrDisconn",e.userID)}getPlayer(e){return this.players.find(t=>t.userID==e)}emit(e,t){io.to(this.gameID).emit(e,t)}emitTo(e,t,s){let i=this.getPlayer(e);i&&i.emit(t,s)}}function i(e){this.userID,e&&e.type,this.room&&(e.fromClient?this.room.owner.emit("peeringMessage",e):this.room.emitTo(e.userID,"peeringMessage",e))}module.exports={io:r=>{r.on("myID",e=>{r.userID=e,r.id}),r.on("creteRoom",({num:e,pub:t})=>{new s(mkID(),r,e,t)}),r.on("join",t=>{e[t]?e[t].addPlayer(r):r.emit("roomNotFound",t)}),r.on("gameEnd",e=>{r.room&&t(r.room.gameID,1)}),r.on("chat",e=>{r.room&&r.room.emit("chat",{userID:r.userID,msg:e})}),r.on("disconnect",()=>{r.userID||r.id,r.room&&r.room.disconnect(r),clearInterval(o)}),r.on("peeringMessage",i.bind(r)),r.on("RTCStatus",e=>r.room&&r.room.emit("RTCStatus",e));let o=setInterval(()=>{r.room?clearInterval(o):r.emit("rooms",Object.values(e).filter(e=>e.isPublic&&e.players.length).map(e=>[e.gameID,e.players.length,e.numPlayers]))},2e3);r.id}}})();
