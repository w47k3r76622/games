(()=>{let e=document.body,t=e.classList,n=document.location.search.substr(1);let o=(e,t,n="")=>{let o=document.createElement(e);return o.appendChild(document.createTextNode(n)),t.appendChild(o),o},i=CanvasRenderingContext2D.prototype;function r(e){return(e.userID?e.userID:e).split("\n")[0]}Object.keys(i).sort().forEach(e=>{let t=e[0]+e.replace(/[^A-Z]/g,"");i[t]&&(t=e[0]+e[1]+e.replace(/[^A-Z]/g,""));try{if("function"!=typeof i[e])throw 1;i[t]=i[e]}catch(n){i[t]=function(t){this[e]=t}}}),i.g=function(e,t,n,o,i,r,s,a,...l){let c=e?this.cRG(n,o,i,r,s,a):this.cLG(n,o,r,s);l.forEach((e,t)=>{let n=e[1]/100||t/(l.length-1);c.addColorStop(n,e[0])}),this[t](c)};let s=1,a=!1,l=[],c=null,d=!1,f=0,u={x:3e3,y:0,velX:0,velY:0,rot:0,roI:0},h={GARBAGE:1,LOW:2,MEDIUM:3,HIGH:4},F=0,p=.05,m=2,y=10,g=30,b=sqrt(98);function I(e){let t=o("div",msgList),n=o("div",t,e);t.classList.add("new"),n.classList.add("logmsg"),setTimeout(()=>t.classList.remove("new"),200),setTimeout(()=>t.classList.add("remove"),2e4),setTimeout(()=>msgList.removeChild(t),23e3)}let T=io({upgrade:!1,transports:["websocket"]});if(!(localStorage.userID||"").match(/\n/)){let e=prompt("Set your player name:");localStorage.userID=(e?e+"\n":"unnamed-")+mkID()}T.on("connect",()=>{T.emit("myID",localStorage.userID)}),T.on("notify",e=>I(e));let C,D,P=null,E=0,w=[],S=[],x=[],L=[],v=[],k=[],O=[],R=[],A=e.querySelector("#shipStatus p"),M=o("i",missilBar),$=()=>{$=()=>0,P=new Worker("ww.js"),P.onmessage=({data:[e,t]})=>{"started"==e&&(G("init",{nP:f||10,planets:U.map(e=>({a:e.a,d:e.d,rot:e.rot,radius:e.radius}))}),_()),"update"==e&&N(e,t),"winner"==e&&(N(e,t),T.emit("gameEnd"))}};let B=e=>t=>{let n=R.find(e=>e.id==t.src)||l[t.src]||t,o=e.find(e=>e.id==t.id);o||(o={...t,x:n.x,y:n.y,rot:n.rot},e.push(o))};function H(t){E=Date.now(),v=t.boxes,v.forEach(B(k)),x=t.booms,x.forEach(B(L)),O=t.missiles,O.forEach(B(R)),S=t.planets,w=t.players,w.forEach(e=>{let t=l[e.userID];t&&(ee.forEach(n=>t[n]=e[n]),t.lifeEl&&(t.lifeEl.style.width=t.life+"%"))}),u.eyEl&&(u.eyEl.style.width=u.ey+"%");let n=sqrt(u.velX**2+u.velY**2)/b*100;var o;n>99.999&&(n=99.999),a&&(u.life||u.reborn?m=n>50?.7:u.land>-1?1.5:1:(u.lost=1,e.classList.add("lost"),m=.3)),A.innerHTML=u.lost?"You lose. "+(C?r(C)+" wins!":""):`Missiles: ${u.misTot} &nbsp; Lifes: ${u.reborn} &nbsp; &nbsp; ${n.toFixed(3)}% of light speed`,a&&(o=u,sqrt(o.x**2+o.y**2)>2e4)&&!D&&(I("You are far away from Sun! Good, you can't be found on radar."),setTimeout(()=>I("...but you can't recharge."),3e3),D=1,setTimeout(()=>D=0,6e4))}function N(e,t){l.forEach(n=>n.send(e,t))}function G(e,t){P?P.postMessage([e,t]):setTimeout(()=>G(e,t),100)}function _(){G("updadeUsers",l.map(e=>["userID",...te].reduce((t,n)=>(t[n]=e[n],t),{})))}function J(e,t,n){return e.forEach((e,o)=>{let i;e.id?(i=t.find(t=>t.id==e.id),i||(i={...e},t.push(i))):i=t[o],i.userID=e.userID,["x","y","radius","a","rot","go"].forEach(t=>i[t]=(i[t]*n+e[t])/(n+1))}),t.filter(t=>e.find(e=>t.id==e.id))}let W=1120,U=[{radius:200,a:0,d:2e3,r:80,g:80,b:80},{radius:300,a:0,d:4e3,r:100,g:50,b:30},{radius:400,a:PI,d:4e3,r:150,g:80,b:130},{radius:350,a:0,d:8e3,r:0,g:80,b:200},{radius:450,a:.66*PI,d:8e3,r:30,g:100,b:0},{radius:350,a:1.3*PI,d:8e3,r:180,g:60,b:60},{radius:800,a:0,d:12e3,r:0,g:40,b:220},{radius:700,a:.9*PI,d:12e3,r:160,g:140,b:40},{radius:300,a:0,d:16e3,r:120,g:120,b:120},{radius:200,a:PI/2,d:16e3,r:100,g:80,b:50},{radius:300,a:PI,d:16e3,r:120,g:120,b:100},{radius:200,a:1.6*PI,d:16e3,r:120,g:50,b:100}].map(e=>({...e,rot:0,x:0,y:0}));function j(){if(a)return!1;l.forEach(e=>{if(e!=u){let t=o("a",enemyLife,r(e)),n=o("div",t),i=o("i",n);e.lifeEl=i}}),u.lifeEl=e.querySelector("#shipLife i"),u.eyEl=e.querySelector("#shipEy i"),d&&G("startGame",!0),a=!0,lobby.classList.add("hidden"),t.add("game-on"),m=1,y=30,l.forEach(e=>e.fOn=0),window.addEventListener("keydown",e=>{"ArrowUp"==e.key&&c.send("fOn",u.fOn=1),"ArrowDown"==e.key&&c.send("re",u.re=1),"ArrowLeft"==e.key&&c.send("rotJet",u.rotJet=-1),"ArrowRight"==e.key&&c.send("rotJet",u.rotJet=1)," "==e.key&&c.send("misOn",1)}),window.addEventListener("keyup",e=>{"ArrowUp"==e.key&&c.send("fOn",0),"ArrowDown"==e.key&&c.send("re",0),"ArrowLeft"==e.key&&c.send("rotJet",0),"ArrowRight"==e.key&&c.send("rotJet",0)," "==e.key&&c.send("misOn",0)})}function q(){roomsList.innerHTML=`\n    <h2>Room ${T.room} for ${f} players</h2>\n    <div id="players">${l.map(e=>`<span class="${e.connected?"conn":""}">${r(e)}</span>`).join(" &nbsp; ")}</div>\n    <p id="chatNote">Press enter to chat.</p>\n  `,l.length!=f||l.find(e=>!e.connected)||setTimeout(j,500)}if(setTimeout(()=>{roomsList.innerHTML="Loading..."},100),n.match(/\bgame=/))s=2,m=.3,T.room=n.replace(/.*\bgame=([^&]*).*/,"$1"),T.emit("join",T.room),T.on("roomNotFound",e=>{I(`The room "${e}" do not exists.`),setTimeout(()=>document.location.href=document.location.href.replace(/game=[^&]*/,""),2e3)}),window.addEventListener("keyup",e=>{"Enter"==e.key&&(chatInput.className="show",chatInput.focus())}),chatInput.addEventListener("keydown",e=>e.stopPropagation()),chatInput.addEventListener("keyup",e=>{e.stopPropagation(),"Enter"==e.key&&(chatInput.value&&T.emit("chat",chatInput.value),chatInput.value=chatInput.className="",chatInput.blur())}),T.on("chat",({userID:e,msg:t})=>{I(r(e)+": "+t)}),T.on("youAreTheOwner",()=>{d=!0,I("You're the owner. Don't disconnect."),$()}),T.on("numPlayers",e=>{f=e});else{p=.666,y=500;let e=PI/2;setInterval(()=>{e-=.001,m=sign(cos(e))!=sign(sin(e))?.25:.05,u.x=(49*u.x+6e3*cos(e))/50,u.y=(49*u.y+2500*sin(e))/50},33),T.on("rooms",e=>{e.length?(roomsList.innerHTML="<p>Public rooms:</p>",e.forEach(([e,t,n])=>{let i=o("a",roomsList);i.href="?game="+e,i.innerText=`Players: ${t} of ${n}`})):roomsList.innerHTML="There are no public rooms yet."});let t=o("label",lobby,"Create a new room:");t=o("label",lobby),t.innerText="Players:";let n=o("input",lobby);n.id="inputNum",n.type="number",n.min=2,n.max=10,n.value=2,t=o("label",lobby);let i=o("input",lobby);i.type="checkbox",i.checked=!0,o("span",lobby,"Public");let r=o("button",lobby,"Create");r.id="btCreateRoom",r.onclick=()=>{T.emit("creteRoom",{num:n.value,pub:i.checked}),lobby.classList.add("hidden")},T.on("romCreated",e=>{document.location.href="?game="+e})}let Y=[];Y[Event.CAPTURING_PHASE]="CAPTURING_PHASE",Y[Event.AT_TARGET]="AT_TARGET",Y[Event.BUBBLING_PHASE]="BUBBLING_PHASE";let X=e=>d?e.kind:"";class z{constructor(e,t=!1){this.userID=e,this.isClient=t,this.connected=!1,this.initICE(),this.init()}get kind(){return this.isClient?"CLIENT":"HOST"}initICE(){X(this),r(this),function(e){e.peerConn=new RTCPeerConnection({iceServers:[{urls:`stun:stun${Math.floor(5*rnd())||""}.l.google.com:19302`}]}),e.peerConn.usr=e,e.peerConn.onicecandidate=t=>{t.candidate?(e.kind,r(e),t.candidate.candidate,T.emit("peeringMessage",{FROM:"onicecandidate",fromClient:e.isClient,userID:e.userID,type:"candidate",sdpMLineIndex:t.candidate.sdpMLineIndex,sdpMid:t.candidate.sdpMid,candidate:t.candidate.candidate})):(e.kind,r(e))};let t=t=>{e.peerConn&&"failed"===e.peerConn.iceConnectionState&&e.reconnect()};setTimeout(t.bind(e),1e3),e.peerConn.oniceconnectionstatechange=t,!1}(this),this.isClient?this.peerConn.ondatachannel=e=>{X(this),this.dataChannel=e.channel,V(this)}:(this.dataChannel=this.peerConn.createDataChannel("game",{ordered:!0,maxRetransmits:1}),V(this),X(this),r(this),this.peerConn.createOffer().then(K.bind(this)))}reconnect(){this.connected||(this.peerConn.close(),this.initICE())}disconnect(){this.peerConn.close(),this.peerConn=null,this.onDisconnect&&this.onDisconnect()}send(e,t=null){if("open"==this.dataChannel.readyState)try{this.dataChannel.send(JSON.stringify([e,{userID:this.userID,payload:t}]))}catch(e){}else r(this),this.dataChannel.readyState}cmd_connected({userID:e}){e==this.userID&&(this.connected=!0),We()}}class Z extends z{init(){r(this)}cmd_fOn({userID:e,payload:t}){G("fOn",[e,t])}cmd_re({userID:e,payload:t}){G("re",[e,t])}cmd_rotJet({userID:e,payload:t}){G("rotJet",[e,t])}cmd_misOn({userID:e,payload:t}){G("misOn",[e,t])}}class Q extends z{init(){r(this)}cmd_update({userID:e,payload:t}){H(t)}cmd_winner({userID:e,payload:t}){C=t,l[C]===u&&(youWin.className="show"),m=.3}}function K(e){this.kind,r(this),e.sdp.replace(/.*(ice-pwd:[^\s]+).*/ms,"$1"),this.peerConn.setLocalDescription(e).then(()=>{this.kind,this.kind,this.peerConn.localDescription,T.emit("peeringMessage",{FROM:"setLocalDescription",fromClient:this.isClient,userID:this.userID,...this.peerConn.localDescription.toJSON()})})}function V(e){e.dataChannel.onopen=()=>{X(e),r(e),e.send("connected")},e.dataChannel.onclose=()=>{r(e),e.connected=!1,We()},e.dataChannel.onmessage=t=>{let[n,o]=JSON.parse(t.data);e["cmd_"+n]&&e["cmd_"+n](o)}}T.on("peeringMessage",(function(e){let t=(e||{}).userID;if(r(t),e&&e.type,!e)return null;let n=c;e.fromClient&&(n=l[t]),delete e.fromClient,delete e.userID,"offer"===e.type?(n.peerConn.setRemoteDescription(new RTCSessionDescription(e)),n.peerConn.createAnswer().then(K.bind(n))):"answer"===e.type?n.peerConn.setRemoteDescription(new RTCSessionDescription(e)):"candidate"===e.type&&(n.kind,r(t),e.candidate,n.peerConn.addIceCandidate(e))}));let ee=["ey","life","reborn","velX","velY","roI","land","misTot","misEn","fOn","re","rotJet"],te=["x","y","rot",...ee];class ne{constructor(e){this.userID=e,this.init()}init(){this.userID,this.constructor,this.isMySelf=this.userID===localStorage.userID,this.isMySelf&&(u=this),te.forEach(e=>this[e]=0),this.x=8e4*(rnd()-.5),this.y=8e4*(rnd()-.5),this.rot=3*-PI,this.life=100,this.ey=100,this.reborn=3,this.misTot=3,this.land=-1}disconnect(){}onDisconnect(){}}let oe=Z.prototype;Object.getOwnPropertyNames(ne.prototype).forEach(e=>{if("constructor"==e)return;let t=ne.prototype[e];if(oe[e],oe[e]){let n=oe[e];oe[e]=function(...e){n.apply(this,e),t.apply(this,e)}}else oe[e]=t});let ie,re=null,se=window.innerWidth,ae=window.innerHeight,le=1,ce=30,de=[],fe=[],ue=[],he=(t,n)=>{let i=o("canvas",e);return i.width=t,i.height=n,i},Fe=he(),pe=he(),me=he(2048,2048),ye=he(),ge=he(300,300),be=he(300,300),Ie=he(),Te=he(400,400);function Ce(e,t){if(F!==e||t){Object.entries(h).find(([t,n])=>n===e)[0];F=e,le=5-F,se=round(window.innerWidth/le),ae=round(window.innerHeight/le),Ie.width=se,Ie.height=ae,re=Ie.getContext("2d"),re.fS("#000"),re.fR(0,0,se,ae),Fe.width=pe.width=ye.width=2*round(se/3),Fe.height=pe.height=ye.height=2*round(ae/3),Be(Fe,de,7),Be(pe,fe,5),Be(ye,ue,2)}}function De(e,t,n,o){let i=e.width,r=e.height,s=i*o,a=r*o;t/=le,n/=le,(t%=s)>0&&(t-=s),(n%=a)>0&&(n-=a);for(let o=t;o<se;o+=s)for(let t=n;t<ae;t+=a)re.dI(e,0,0,i,r,o,t,s,a)}function Pe({x:e,y:t}){return[se/2+(e-u.x)*p/le,ae/2+(t-u.y)*p/le]}Ie.id="gameCanvas",Te.id="radar",window.addEventListener("resize",()=>Ce(F,!0)),navigator.userAgent.match(/Firefox\//)&&t.add("firefox");let Ee=0,we=Date.now(),Se=0;function xe(){if(window.requestAnimationFrame(xe),Ee++,ie=Date.now(),function(){if(0==E)return;let e=(Date.now()-E)/upDalay;e>1&&(e=1),upDalay;let t=ce/(1e3/upDalay);w.forEach(e=>{let n=l[e.userID];n?(n.x=(n.x*t+e.x)/(t+1),n.y=(n.y*t+e.y)/(t+1),n.rot=(n.rot*t+e.rot)/(t+1)):r(e)}),u.misEn?(missilBar.style.opacity=1,M.style.width=u.misEn+"%"):(missilBar.style.opacity=0,setTimeout(()=>M.style.width=0,500)),J(S,U,t),R=J(O,R,t),k=J(v,k,t),L=J(x,L,t)}(),p=(p*y+m)/(y+1),1<p&&p<1.001&&(p=1),function(){let{x:e,y:t,velX:n,velY:o}=u;re.gCO("source-over"),re.fS("#000"),re.fR(0,0,se,ae),re.gCO("screen"),De(ye,-e/15,-t/15,1),De(me,-(e+9e3)/9,-(t+7e3)/9,2/le),De(pe,-e/6,-t/6,1),De(Fe,-e/3,-t/3,1)}(),re.gCO("source-over"),k.forEach(Re),L.forEach(Me),R.forEach(Ae),U.forEach(ve),l.filter(e=>e.life).forEach(Oe),function(){let[e,t]=Pe({x:0,y:0}),n=1040*p/le,o=1200*p/le;(function(e,t,n,o,i){let r=PI/180;[0,10*r].forEach(s=>{re.g(1,"fS",e,t,n/3,e,t,i,["#FC0"],["#FC0",84],["rgba(255,200,0,0.1)"]);let a=ie/10;re.bP(),re.moT(cos(s)*n+e,sin(s)*n+t);for(let l=0;l<=PI2;l+=4*r){let c=l+s,d=15*cos(a/7/PI+18*l)*p/le,f=15*sin(a/7/PI+18*l)*p/le;re.bCT(cos(c+r)*o+e,sin(c+r)*o+t,cos(c+r)*o+e+d,sin(c+r)*o+t+f,cos(c+2*r)*i+e+d,sin(c+2*r)*i+t+f);let u=c+4*r;re.bCT(cos(u-r)*o+e+d,sin(u-r)*o+t+f,cos(u-r)*o+e+d,sin(u-r)*o+t+f,cos(u)*n+e,sin(u)*n+t)}re.cP(),re.f()})})(e,t,n,W*p/le,o),re.g(1,"fS",e,t,n/3,e,t,o,["#F40"],["#F80",60],["#FC0",82],["#FC0",85],["rgba(255,200,0,0.2)",95],["rgba(200,100,0,0.0)",99]),re.bP(),re.a(e,t,o,0,PI2),re.cP(),re.f()}(),Ee%5==0&&function(){let e=He.gID(0,0,Ne,Ne),t=e.data;if(t.forEach((e,n)=>t[n]=n%4==3?e-5:e),He.pID(e,0,0),He.gCO("screen"),Ee%25==5){He.sS("#040"),He.lW(2),He.bP(),He.moT(211.2,Ge);let e=PI/10;for(let t=0;t<PI2;t+=e)He.moT(Ge+cos(t)*W*_e,Ge+sin(t)*W*_e),He.lT(Ge+cos(t+e/3)*W*_e,Ge+sin(t+e/3)*W*_e);He.cP(),He.st()}He.lW(.6),He.sS("#080"),He.bP(),Ee%15==0&&U.forEach(e=>{let t=e.radius*_e*.8,n=Ge+e.x*_e,o=Ge+e.y*_e;He.moT(n+t,o),He.a(n,o,t,0,PI2)});He.cP(),He.st(),He.lW(1.6),l.filter(e=>e.life).forEach(e=>{He.sS("#000"),He.fS(e.isMySelf?"#00F":"#D00"),He.bP(),He.a(Ge+e.x*_e,Ge+e.y*_e,2,0,PI2),He.cP(),He.f(),He.st()}),R.forEach(e=>{He.fS(e.userID==u.userID?"#00F":"#D00"),He.fR(Ge+e.x*_e,Ge+e.y*_e,1.3,1.3)}),k.forEach(e=>{He.fS("rgba(127,255,0,.1)"),He.fR(Ge+e.x*_e,Ge+e.y*_e,1.3,1.3)})}(),Ee%10==0){ce=round(1e4/(ie-we)),ce>33||(!a||F<h.MEDIUM)&&ce>22?Se++:ce<(a?20:12)?(Se--,a&&ce<12&&(Se-=5)):Se/=2,we=ie,Se<-2&&(F>1&&Ce(F-1),Se=0),Se>60&&(F<h.HIGH&&Ce(F+1),Se=0)}}let Le=["00F0 00F0 00F4 00F0 00F0 00F0       00F0 00F0 00F0 00F0","00F2 00F8 0FFf 08F8 00F4 00F0          00F0","00F0 00F4 00Ff 00F8 00F2 00F0          00F0","00F0 00F0 00F0 00F0 00F0 00F0       F000 F000 F000 ","        F000 F000 F000 F000 F000 F003 F000 ","      F000 F000 F000 F004 F004 F001 F004 F001 F000 ","      F000 F002 F404 F004 F000 F004 F002 F000 F000 ","     F000 F000 F00f F80f F808 FF0F F008 F000 F000  ","    F000 F000 F004 F00f F408 F000 FC08 F806 F002 F000  ","    F000 F002 F008 F008 F004 F002 F002 F003 F000 F000  ","   F000 F001 F004 F000 F000 F000 F000 F000 F000 F000   ","   F000 F002 F000 F000    F000 F000 F000   ","   F000 F000 F000    F080 F080 F084 F080 F000 F0F0 00F0","         F0F0 F088 F0F4 F0F8 F0F4 00F2 00F0","         F080 F0F0 F0F8 80FF 80F8 00F4 00F0"," 00F0 00F0 00F0      F000 80F0 80F0 80F0 00F4 00F0 00F0"];function ve(e){let{rot:t,radius:n,a:o,d:i}=e,r=2*n,s=r*p/le,[a,l]=Pe(e),c=-n*p/le;re.s(),re.tr(a,l),re.ro(t),re.dI(e.c1,0,0,r,r,c,c,s,s),re.ro(-t),re.ro(o),re.gCO("multiply"),re.dI(e.c4,0,0,r,r,c,c,s,s),re.re()}U.forEach((function(e,t){let{radius:n,a:o,d:i,r:r,g:s,b:a}=e,l=2*n;e.c1=he(l,l),e.c4=he(l,l);let c=e.c1.getContext("2d"),d=e.c4.getContext("2d");c.bP(),c.a(n,n,n-1,0,PI2),c.cP(),c.clip(),c.fS(`rgb(${r},${s},${a})`),c.fR(0,0,l,l);let f=c.gID(0,0,l,l),u=f.data;u.forEach((e,t)=>u[t]=t%4==3?e:e-30*(rnd()-.5)),c.pID(f,0,0),d.fS("#FFF"),d.fR(0,0,l,l),d.g(1,"fS",.2*n,n,.2*n,.8*n,n,1.2*n,["rgba(255,255,255, 0)"],["rgba(  1,  1,  1, 1)"]),d.bP(),d.a(n,n,n,0,PI2),d.cP(),d.f()}));function ke(e,t){let n=75,o=e.getContext("2d");function i(e){o.bP();let i=PI*(5-2*e)/10;o.moT(cos(i)*n,-sin(i)*n),o.a(0,0,n,i,PI*(5-8*e)/10,e>0),o.cP(),o.g(0,"fS",n*e,0,0,n*e*.6,0,0,["#BBB"],[t?"#369":"#943"],["#222"]),o.f()}o.tr(150,150),o.ro(PI/2),i(-1),i(1),o.bP(),o.moT(-45,0),o.lT(45,0),o.bCT(60,0,60,37.5,45,37.5),o.lT(-45,37.5),o.bCT(-60,37.5,-60,0,-45,0),o.cP(),o.g(0,"fS",0,0,0,0,37.5,0,["#333"],["#999"],["#333"]),o.f(),o.bP(),o.moT(0,-90),o.bCT(30,-75,30,-37.5,30,0),o.lT(30,n),o.lT(-30,n),o.lT(-30,0),o.bCT(-30,-37.5,-30,-75,0,-90),o.cP(),o.g(0,"fS",-37.5,0,0,37.5,0,0,["#444"],["#BBB"],["#444"]),o.f(),o.bP(),o.moT(0,-75),o.bCT(22.5,-75,22.5,-37.5,22.5,-37.5),o.lT(-22.5,-37.5),o.bCT(-22.5,-37.5,-22.5,-75,0,-75),o.cP(),o.g(0,"fS",-22.5,0,0,22.5,0,0,["#222"],["#888"],["#888"],["#222"]),o.f(),o.gCO("multiply"),o.bP();let r=29.25;function s(e){o.moT(e*r,19),o.lT(e*n*.1,19),o.lT(e*n*.1,3.75),o.moT(e*n*.1,-3),o.lT(e*n*.1,-12),o.moT(e*n*.1,-18.75),o.lT(e*n*.1,-24.75)}!function(e,t){for(let n=0;n<e;n++)t(n)}(3,e=>{o.moT(-r,n-14*e-14),o.lT(r,n-14*e-14)}),s(-1),s(1),o.sS(t?"rgba(0,100,255,0.4)":"rgba(255,60,0,0.4)"),o.lW(8),o.st()}function Oe(e){let[t,n]=Pe(e),o=120*p/le,i=o/4,s=g*p/le,a=e.isMySelf?ge:be;re.s(),re.tr(t,n),re.fS("rgba(255,255,255,0.6)"),e.isMySelf||(re.font=`normal ${8/le+5}px sans-serif`,re.tA("center"),re.fT(r(e),0,-s-16/le)),re.ro(e.rot),e.fOn&&function(e){re.g(1,"fS",1.1*-e,0,2,1.2*-e,0,e/3,["#8FF"],["#08F"]),re.bP();let t=1.15;re.moT(.8*-e,0),re.bCT(-e*t,.6*-e,-e*t,.1*-e,-e*(2+sin(ie/30%PI2)/20),0),re.bCT(-e*t,.1*e,-e*t,.6*e,.8*-e,0),re.f()}(i),e.re&&function(e){re.bP(),re.moT(0,0),re.moT(cos(.8)*e,sin(.8)*e),re.a(0,0,1.15*e,.8,2.5,0),re.moT(cos(-.8)*e,sin(-.8)*e),re.a(0,0,1.15*e,-.8,-2.5,1),re.moT(0,0),re.lW(e/2.5),re.g(1,"sS",0,0,e,0,0,1.4*e,["#0FF"],["rgba(0,0,255,0)"]),re.st()}(i),0!=e.rotJet&&function(e,t){re.bP(),re.moT(.75*e,.65*-e*t),re.lT(.5*e,1.5*-e*t),re.moT(.75*-e,.65*e*t),re.lT(.5*-e,1.5*e*t),re.g(1,"sS",0,0,.8*e,0,0,1.5*e,["rgba(255,255,255,0.5)"],["rgba(255,255,255,0)"]),re.lW(2),re.st()}(i,e.rotJet),re.dI(a,0,0,300,300,-o/2,-o/2,o,o),re.re()}function Re(e){let t=g*p/le,[n,o]=Pe(e);re.s(),re.tr(n,o),re.ro(ie/1e3%PI2),re.fS("#852"),re.bP(),re.moT(.7*t,.9*-t),re.lT(.9*t,.7*-t),re.lT(.9*t,.9*t),re.lT(0,0),re.f(),re.fS("#631"),re.bP(),re.moT(.9*-t,.7*t),re.lT(.7*-t,.9*t),re.lT(.9*t,.9*t),re.lT(0,0),re.f(),re.fS("#A73"),re.fR(.9*-t,.9*-t,1.6*t,1.6*t),re.ro(PI/4),re.fS("#421"),re.font=`normal ${t/3}px sans-serif`,re.tA("center"),re.fT("WEAPON",-t/8,t/8),re.re()}function Ae(e){let t=15*p/le,[n,o]=Pe(e);re.s(),re.tr(n,o),re.ro(e.rot),re.g(1,"fS",1.1*-t,0,1,1.2*-t,0,t/3,["#8FF"],["#08F"]),re.bP();let i=1.1*-t;re.moT(.9*-t,0),re.bCT(i,.3*-t,i,.1*-t,2*-t,0),re.bCT(i,.1*t,i,.3*t,.9*-t,0),re.f(),re.bP(),re.moT(-t,0),re.lT(.6*-t,-t/3),re.lT(0,0),re.lT(.6*-t,t/3),re.moT(t,0),re.a(.8*t,0,.2*t,0,PI2),re.fS("#888"),re.f(),re.fS("#BBB"),re.fR(-t,.1*-t,1.6*t,.2*t),re.re()}function Me(e){let[t,n]=Pe(e),o=e.radius,i=7.5+o*p/le;re.bP(),re.a(t,n,i,0,PI2),re.cP(),re.sS(`rgba(255,${255-o},0,${1-(o/255)**2})`),re.lW(2*i/(1+(o/2<g?0:(o/2-g)/4))),re.st(),re.lW(1)}function $e(e){let t=0,n=0,o=0;return rnd()<.5?t=n=o=255:rnd()<.5?(o=255,t=255*rnd(),n=127+t/2):(t=n=255,o=255*rnd()),{x:rnd(),y:rnd(),size:rnd()*e,r:t,g:n,b:o}}ke(ge,!0),ke(be);for(let e=0;e<25;e++)de[e]=$e(7);for(let e=0;e<40;e++)fe[e]=$e(5);for(let e=0;e<120;e++)ue[e]=$e(2);function Be(e,t,n){let o=e.getContext("2d"),i=e.width,r=e.height;o.clearRect(0,0,i,r);let s=o.gID(0,0,i,r),a=s.data;t.forEach(({x:e,y:t,size:o,r:s,g:l,b:c})=>{let d=round((i-4)*e+2),f=round((r-4)*t+2);function u(e,t,n){let o=4*(t*i+e);a[o+0]=s,a[o+1]=l,a[o+2]=c,a[o+3]=n}let h=o/le;u(d,f,n<3&&le>2?128:255);for(let e=0;e<7;e++){let t=255*(h-e)/(n/le);u(d+e,f,t),u(d-e,f,t),u(d,f+e,t),u(d,f-e,t)}}),o.pID(s,0,0)}let He=Te.getContext("2d"),Ne=400,Ge=200,_e=.01;function Je(e,t){if(!a){let t=l[e];t&&d&&t.disconnect(),l=l.filter(t=>t.userID!=e),l.forEach(e=>l[e.userID]=e),_()}q()}function We(){T.emit("RTCStatus",l.map(e=>[e.userID,e.connected]))}T.on("disconnect",()=>{l.forEach(e=>Je(e.userID,!0)),a||(l=[])}),T.on("usrsConn",e=>function(e){a?e.forEach(e=>{l[e]&&d&&l[e].reconnect()}):(c||(c=new Q(localStorage.userID,!0)),e.forEach(e=>{if(!l[e]){let t=new(d?Z:ne)(e);l.push(t),l[e]=t,_()}}));l.map(e=>e.userID).join(", "),q()}(e)),T.on("usrDisconn",e=>Je(e)),T.on("RTCStatus",e=>{d||e.forEach(([e,t])=>{l[e].connected=t}),a||q()}),Ce(h.HIGH),re.iSE(!0),re.imageSmoothingQuality="low",function(){let e=me.getContext("2d"),t=me.width;Le=Le.map(e=>e.split(" "));let n=Le.length,o=e.gID(0,0,t,t),i=o.data,r=t/n;for(let e=0;e<n;e++)for(let o=0;o<n;o++){let n=4*(e*r*t+o*r),s=Le[e][o].split("");for(let e=0;e<4;e++)i[n+e]=parseInt(s[e]+s[e]||"00",16)}for(;r>1;){for(let e=0;e<t;e+=r)for(let n=0;n<t;n+=r){let o=4*(e*t+n),s=0==e?t-r:e-r,a=0==n?t-r:n-r,l=0==e?t-r/2:e-r/2,c=0==n?t-r/2:n-r/2,d=4*(s*t+n),f=4*(e*t+a),u=4*(l*t+n),h=4*(e*t+c),F=4*(l*t+c),p=[rnd(),rnd(),rnd()];for(let e=0;e<4;e++){let t=i[o+e],n=i[d+e],r=i[f+e];i[u+e]=t*p[0]+n*(1-p[0]),i[h+e]=t*p[1]+r*(1-p[1]),i[F+e]=.67*(r*p[2]+n*(1-p[2]))+.33*t}}r/=2}e.pID(o,0,0)}(),xe()})();
