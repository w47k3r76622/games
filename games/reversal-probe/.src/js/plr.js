var Plr=function(){function a(a){d[0]=Math.min(d[0],a[0]),d[1]=Math.min(d[1],a[1]),d[2]=Math.max(d[2],a[0]),d[3]=Math.max(d[3],a[1])}function b(){d=[env.w,env.w,0,0];for(var b=c.length-1;b>0;b--)a(c[b])}var c=[],d=(env.w/2,[env.w,env.w,0,0]);exy=[env.x,env.y],tail=[],tail_end=exy,r=10,fill="white",stroke="black";for(var e=0,f=100;f>e;e++)c.push(exy);return{is_in_trail_bounds:function(a,b){return a>d[0]&&a<d[2]&&b>d[1]&&b<d[3]?!0:!1},is_touching_trail:function(a,b,d){if("start"===game_mode){for(var e=c.length-1;e>0;e--)if(utl.is_close_course(a,b,d,c[e][0],c[e][1],2))return!0;return!1}},add_to_tail:function(a){con+=6.5,a.fill=fill,a.stroke=stroke,tail.push(a),snds.upgrade()},tail_ht:function(a,b,d){var e=tail.length;if("start"===game_mode&&utl.is_close(a,b,d,env.x,env.y,r)){if(e)tail[0].death_init(),tail.splice(h,1),con-=6.5;else{for(var f=0;12>f;f++){var g=new Nmy2;g.x=env.x,g.y=env.y,g.bits_count=-1*f,g.death_init(),nmys.push(g)}ngn.end_game(),scrbrd.die(),tail=[],c=[]}return!0}for(var h=0;e>h;h++){var f=tail[h];if(utl.is_close_course(a,b,d,f.x,f.y,f.r)&&utl.is_close(a,b,d,f.x,f.y,f.r))return f.death_init(),tail.splice(h,1),con-=6.5,scrbrd.pt(),!0}return!1},is_touching_whole:function(a,b,c){if(utl.is_close(a,b,c,env.x,env.y,r))return!0;if(utl.is_close(a,b,c,tail_end[0],tail_end[1],6.5))return!0;for(var d=tail.length,e=0;d>e;e++){var f=tail[e];if(utl.is_close_course(a,b,c,f.x,f.y,f.r)&&utl.is_close(a,b,c,f.x,f.y,f.r))return!0}},mv:function(){if("start"==game_mode){if(ins.keysDown.left&&(rgd.ply.rot-=.01),ins.keysDown.right&&(rgd.ply.rot+=.01),ins.keysDown.up){var e=Math.sqrt(con),f=rgd.ply.ang;snds.thrust_start(),rgd.ang.vel-=Math.cos(f+pi/2-rgd.ang.rad)/200/e,axy=utl.get_xy(f,.2-e/100,0,0),rgd.lin.vx+=axy[0],rgd.lin.vy+=axy[1]}env.x=utl.bounds(env.x+rgd.lin.vx,env.w),env.y=utl.bounds(env.y+rgd.lin.vy,env.h),env.scrx=env.x*(env.w-cvw)/env.w,env.scry=env.y*(env.h-cvh)/env.h,rgd.ang.rad+=rgd.ang.vel,rgd.ply.ang+=rgd.ply.rot,rgd.ply.rot*=.94,rgd.ang.vel*=.996,rgd.lin.vx*=.99,rgd.lin.vy*=.99;for(var g=utl.plr_to_scr(env.x,env.y),h=g[0],i=g[1],j=rgd.ang.rad,k=(rgd.ply.ang,-13),l=utl.get_xy(j,con,h,i),m=0,n=tail.length;n>m;m++)tail[m]&&(l=utl.get_xy(j,k,l[0],l[1]),tail[m].x=l[0]+env.scrx,tail[m].y=l[1]+env.scry);if(l=utl.get_xy(j,-1*con,h,i),tail_end=[l[0]+env.scrx,l[1]+env.scry],!(mvs%3)){var o=c.shift();(o[0]<=d[0]||o[0]>=d[2]||o[1]<=d[1]||o[1]>=d[3])&&b(),c.push(tail_end),a(tail_end)}}},drw:function(){if("init"!==game_mode){var a=utl.plr_to_scr(env.x,env.y),b=utl.get_xy(i,con,a[0],a[1]);utl.shape_start(b),utl.ln_2_pt(c[0]);for(var d=c[0][0],e=c[0][1],f=0,g=c.length;g>f;f++)(Math.abs(c[f][0]-d)>3||Math.abs(c[f][1]-e)>3)&&(cx.strokeStyle="rgba(255,255,255,"+f/120+")",cx.lineWidth=f/30,utl.shape_start([d-env.scrx,e-env.scry]),cx.lineTo(c[f][0]-env.scrx,c[f][1]-env.scry),cx.stroke(),cx.strokeStyle="rgba(175,255,215,"+f/240+")",cx.lineWidth=f/15,cx.moveTo(d-env.scrx,e-env.scry),cx.lineTo(c[f][0]-env.scrx,c[f][1]-env.scry),cx.stroke(),cx.closePath(),d=c[f][0],e=c[f][1]);cx.lineWidth=.5;var h=[tail_end[0]-env.scrx,tail_end[1]-env.scry],i=(h[0],h[1],rgd.ang.rad),j=rgd.ply.ang,k=i+pi/12,l=6,m=pi/6,n=utl.get_xy(i,con,env.x-env.scrx,env.y-env.scry);utl.shape_start(h),cx.lineWidth=2,cx.strokeStyle="rgba(0,0,0,0.25)",utl.ln_2_pt(n),utl.shape_stop(),cx.beginPath(),cx.lineWidth=.5,cx.fillStyle=fill,cx.strokeStyle=stroke,cx.arc(h[0],h[1],l,k,k+3*m);var o=utl.get_xy(k+3.5*m,l,h[0],h[1]);if(cx.arc(o[0],o[1],l/3.5,k+.5*m,k+6.5*m),cx.arc(h[0],h[1],l,k+4*m,k+7*m),o=utl.get_xy(k+7.5*m,l,h[0],h[1]),cx.arc(o[0],o[1],l/3.5,k+4.5*m,k+10.5*m),cx.arc(h[0],h[1],l,k+8*m,k+11*m),o=utl.get_xy(k+11.5*m,l,h[0],h[1]),cx.arc(o[0],o[1],l/3.5,k+8.5*m,k+14.5*m),utl.shape_stop(),h=n,"start"===game_mode&&ins.keysDown.up){cx.beginPath(),cx.strokeStyle="rgb(150,150,150)";for(var p=utl.get_xy(j,-3*r,h[0],h[1]),f=0;2>f;f++){var q=p[0]+utl.any(r,0)-r/2,s=p[1]+utl.any(r,0)-r/2,t=utl.any(r,0)/2+r/4;cx.moveTo(h[0],h[1]),cx.lineTo(q,s),cx.moveTo(q+t,s),cx.arc(q,s,t,0,2*pi)}cx.stroke(),cx.closePath()}var u=pi/32,v=utl.get_xy(j+28*u,1.1*r,h[0],h[1]);utl.get_xy(j+36*u,1.1*r,h[0],h[1]);utl.shape_start(h),utl.ln_2_pt(v),cx.arc(h[0],h[1],1.1*r,j+29*u,j+35*u),utl.ln_2_pt(h),cx.strokeStyle=stroke,cx.fillStyle="#bbb",utl.shape_stop(),cx.fillStyle=fill;var w=utl.get_xy(j+39*u,r,h[0],h[1]),x=utl.get_xy(j+54*u,.7*r,h[0],h[1]),y=utl.get_xy(j+74*u,.7*r,h[0],h[1]),z=utl.get_xy(j+89*u,r,h[0],h[1]),A=utl.get_xy(j,.5*r,h[0],h[1]);utl.shape_start(w),utl.ln_2_pt(x),cx.arc(A[0],A[1],.58*r,j-pi/2,j+pi/2),utl.ln_2_pt(y),utl.ln_2_pt(z),utl.ln_2_pt(w),utl.shape_stop(),utl.shape_start(A[0]+.3*r,A[1]),cx.arc(A[0],A[1],.3*r,0,2*pi),cx.stroke();var B=utl.get_xy(j+48*u,.6*r,h[0],h[1]),C=utl.get_xy(j+16*u,.6*r,h[0],h[1]),D=utl.get_xy(j+43*u,1*r,h[0],h[1]),E=utl.get_xy(j+21*u,1*r,h[0],h[1]);cx.moveTo(B[0],B[1]),utl.ln_2_pt(C),utl.ln_2_pt(E),utl.ln_2_pt(z),utl.ln_2_pt(w),utl.ln_2_pt(D),utl.ln_2_pt(B),cx.fillStyle="#ddd",utl.shape_stop();var F=utl.get_first_close_nmy(env.x,env.y),G=0,H=.12*r,I=.08*r;F?(G=utl.angle_between(F.x,F.y,env.x,env.y),I=.12*r):G=-1*utl.angle_between(rgd.lin.vy,rgd.lin.vx,0,0)+pi/2;var J=utl.get_xy(G,I,A[0],A[1]);cx.beginPath(),cx.arc(J[0],J[1],H,0,2*pi),cx.fillStyle="#309060",utl.shape_stop()}}}},plr=new Plr;