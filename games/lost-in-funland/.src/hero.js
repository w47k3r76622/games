var hero_w=22,hero_h=28,uright=[1,0],ubottom=[0,1],uL1=[-11,-14],uC1=[0,-14],uR1=[11,-14],uL2=[-11,0],uR2=[11,0],uL3=[-11,8],uC3=[0,14],uR3=[11,8],uL4=[-11,14],uR4=[11,14],uL5=[-7,14],uR5=[7,14];base_vectors={right:uright,bottom:ubottom},vectors={L1:uL1,C1:uC1,R1:uR1,L2:uL2,R2:uR2,L3:uL3,C3:uC3,R3:uR3,L4:uL4,R4:uR4,L5:uL5,R5:uR5};var hero={x:55,y:50,angle:0,right:[],bottom:[],L1:[],C1:[],R1:[],L2:[],R2:[],L3:[],C3:[],R3:[],L4:[],R4:[],L5:[],R5:[],max_walk_speed:3,walk_acceleration:1,walk_idle_deceleration:-1,jump_speed:-15,gravity:.5,boost_speed:0,walk_speed:0,fall_speed:0,max_fall_speed:5,freefall:!0},rotate_hero=function(e){for(var o in hero.angle=e*Math.PI/180,base_vectors)hero[o]=[base_vectors[o][0]*Math.cos(hero.angle)-base_vectors[o][1]*Math.sin(hero.angle),base_vectors[o][0]*Math.sin(hero.angle)+base_vectors[o][1]*Math.cos(hero.angle)];for(var o in vectors)hero[o]=[vectors[o][0]*hero.right[0]+vectors[o][1]*hero.bottom[0],vectors[o][0]*hero.right[1]+vectors[o][1]*hero.bottom[1]]},move_hero=function(){keys.left&&!keys.right?(hero.walk_speed-=hero.walk_acceleration+hero.boost_speed,hero.walk_speed<-hero.max_walk_speed-hero.boost_speed&&(hero.walk_speed=-hero.max_walk_speed-hero.boost_speed),keys.down&&(hero.walk_speed=-1)):keys.right&&!keys.left?(hero.walk_speed+=hero.walk_acceleration+hero.boost_speed,hero.walk_speed>hero.max_walk_speed+hero.boost_speed&&(hero.walk_speed=hero.max_walk_speed+hero.boost_speed),keys.down&&(hero.walk_speed=1)):Math.abs(hero.walk_speed)<1?hero.walk_speed=0:hero.walk_speed>0?hero.walk_speed+=hero.walk_idle_deceleration:hero.walk_speed<0&&(hero.walk_speed-=hero.walk_idle_deceleration);for(var e=0;e<Math.abs(hero.walk_speed)*frametime_coef;e++)if(hero.x+=hero.right[0]*Math.sign(hero.walk_speed),hero.y+=hero.right[1]*Math.sign(hero.walk_speed),hero.walk_speed>0){if(!(is_solid(hero.x+hero.R1[0]+-3*hero.bottom[0],hero.y+hero.R1[1]+-3*hero.bottom[1])||is_solid(hero.x+hero.C1[0],hero.y+hero.C1[1])||is_solid(hero.x+hero.L1[0],hero.y+hero.L1[1])||is_solid(hero.x+hero.R2[0],hero.y+hero.R2[1])||is_solid(hero.x+hero.R3[0],hero.y+hero.R3[1])))for(var o=0;o<4;o++)if(is_solid(hero.x+hero.R4[0]+-o*hero.bottom[0],hero.y+hero.R4[1]+-o*hero.bottom[1])){hero.x+=4*-hero.bottom[0],hero.y+=4*-hero.bottom[1];break}if(is_solid(hero.x+hero.R1[0],hero.y+hero.R1[1])||is_solid(hero.x+hero.R2[0],hero.y+hero.R2[1])||is_solid(hero.x+hero.R3[0],hero.y+hero.R3[1])){hero.walk_speed=0,hero.x-=hero.right[0],hero.y-=hero.right[1];break}}else if(hero.walk_speed<0){if(!(is_solid(hero.x+hero.L1[0]+-3*hero.bottom[0],hero.y+hero.L1[1]+-3*hero.bottom[1])||is_solid(hero.x+hero.C1[0],hero.y+hero.C1[1])||is_solid(hero.x+hero.R1[0],hero.y+hero.R1[1])||is_solid(hero.x+hero.L2[0],hero.y+hero.L2[1])||is_solid(hero.x+hero.L3[0],hero.y+hero.L3[1])))for(o=0;o<4;o++)if(is_solid(hero.x+hero.L4[0]+-o*hero.bottom[0],hero.y+hero.L4[1]+-o*hero.bottom[1])){hero.x+=4*-hero.bottom[0],hero.y+=4*-hero.bottom[1];break}if(is_solid(hero.x+hero.L1[0],hero.y+hero.L1[1])||is_solid(hero.x+hero.L2[0],hero.y+hero.L2[1])||is_solid(hero.x+hero.L3[0],hero.y+hero.L3[1])){hero.walk_speed=0,hero.x-=-hero.right[0],hero.y-=-hero.right[1];break}}keys.up&&!hero.freefall&&(hero.freefall=!0,hero.fall_speed+=hero.jump_speed),hero.fall_speed+=hero.gravity,hero.fall_speed>hero.max_fall_speed&&(hero.fall_speed=hero.max_fall_speed),l1.value=hero.fall_speed;e:for(e=0;e<Math.abs(hero.fall_speed)*frametime_coef;e++)if(hero.x+=hero.bottom[0]*Math.sign(hero.fall_speed),hero.y+=hero.bottom[1]*Math.sign(hero.fall_speed),hero.fall_speed>0)for(o=0;o<hero_w;o++){if(x=hero.x+hero.L4[0]+o*hero.right[0],y=hero.y+hero.L4[1]+o*hero.right[1],is_solid(x,y)){if(is_spike(x,y)&&(location.href="404.html"),is_buff(x,y)){hero.boost_speed<=10&&(hero.boost_speed+=1),gameScore+=500;var r=document.createElement("span");r.innerHTML="50",r.setAttribute("style","color: #4F4;"),r.setAttribute("id","box3"),r.classList.add("moveFade"),document.getElementById("heading").appendChild(r),setTimeout(function(){r.remove()},1e3),maps[current_map].splice([Math.floor(y/tile_h)],1,maps[current_map][Math.floor(y/tile_h)].substring(0,Math.floor(x/tile_w))+"1"+maps[current_map][Math.floor(y/tile_h)].substring(Math.floor(x/tile_w)+1))}hero.fall_speed=0,hero.x-=hero.bottom[0],hero.y-=hero.bottom[1],hero.freefall=!1;break e}is_trigger(x,y)&&(maps[current_map].pop(),maps[1]=maps[1].concat(generateLevel(100)).splice(1),current_map=1,crawlingGas.speed+=.1,hero.fall_speed+=1/3,hero.max_fall_speed+=1/3,hero.jump_speed+=1/3,hero.walk_speed+=1/3,crawlingGas.isCrawling=!0)}else if(hero.fall_speed<0&&(is_solid(hero.x+hero.L1[0],hero.y+hero.L1[1])||is_solid(hero.x+hero.C1[0],hero.y+hero.C1[1])||is_solid(hero.x+hero.R1[0],hero.y+hero.R1[1]))){hero.fall_speed=0,hero.x-=-hero.bottom[0],hero.y-=-hero.bottom[1];break}};