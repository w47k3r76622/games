(()=>{var t={341:(t,e)=>{!function(t){t.BloomFilter=n,t.fnv_1a=r;var e="undefined"!=typeof ArrayBuffer;function n(t,n){var i;"number"!=typeof t&&(t=32*(i=t).length);var r=Math.ceil(t/32),a=-1;if(this.m=t=32*r,this.k=n,e){var o=1<<Math.ceil(Math.log(Math.ceil(Math.log(t)/Math.LN2/8))/Math.LN2),s=1===o?Uint8Array:2===o?Uint16Array:Uint32Array,l=new ArrayBuffer(o*n),c=this.buckets=new Int32Array(r);if(i)for(;++a<r;)c[a]=i[a];this._locations=new s(l)}else{c=this.buckets=[];if(i)for(;++a<r;)c[a]=i[a];else for(;++a<r;)c[a]=0;this._locations=[]}}function i(t){return 16843009*((t=(858993459&(t-=t>>1&1431655765))+(t>>2&858993459))+(t>>4)&252645135)>>24}function r(t,e){for(var n=2166136261^(e||0),i=0,r=t.length;i<r;++i){var o=t.charCodeAt(i),s=65280&o;s&&(n=a(n^s>>8)),n=a(n^255&o)}return function(t){return t+=t<<13,t^=t>>>7,t+=t<<3,t^=t>>>17,t+=t<<5,4294967295&t}(n)}function a(t){return t+(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24)}n.prototype.locations=function(t){for(var e=this.k,n=this.m,i=this._locations,a=r(t),o=r(t,1576284489),s=a%n,l=0;l<e;++l)i[l]=s<0?s+n:s,s=(s+o)%n;return i},n.prototype.add=function(t){for(var e=this.locations(t+""),n=this.k,i=this.buckets,r=0;r<n;++r)i[Math.floor(e[r]/32)]|=1<<e[r]%32},n.prototype.test=function(t){for(var e=this.locations(t+""),n=this.k,i=this.buckets,r=0;r<n;++r){var a=e[r];if(!(i[Math.floor(a/32)]&1<<a%32))return!1}return!0},n.prototype.size=function(){for(var t=this.buckets,e=0,n=0,r=t.length;n<r;++n)e+=i(t[n]);return-this.m*Math.log(1-e/this.m)/this.k}}(e)}},e={};function n(i){var r=e[i];if(void 0!==r)return r.exports;var a=e[i]={exports:{}};return t[i](a,a.exports,n),a.exports}(()=>{"use strict";function t(t,e,n,i){const r=["VERTEX_SHADER","FRAGMENT_SHADER"],a=e.map(((e,n)=>function(t,e,n){const i=document.getElementById(e);return function(t,e,n){const i=t.createShader(n);return t.shaderSource(i,e),t.compileShader(i),i}(t,i.text,n||("x-shader/x-vertex"===i.type?t.VERTEX_SHADER:t.FRAGMENT_SHADER))}(t,e,t[r[n]]))),o=t.createProgram();return a.forEach((e=>t.attachShader(o,e))),n&&n.forEach(((e,n)=>t.bindAttribLocation(o,i?i[n]:n,e))),t.linkProgram(o),o}let e=Float32Array;function i(t,n,i,o){o=o||new e(16);var s=a(function(t,n,i){return i=i||new e(3),i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],i}(t,n)),l=a(r(i,s)),c=a(r(s,l));return o[0]=l[0],o[1]=l[1],o[2]=l[2],o[3]=0,o[4]=c[0],o[5]=c[1],o[6]=c[2],o[7]=0,o[8]=s[0],o[9]=s[1],o[10]=s[2],o[11]=0,o[12]=t[0],o[13]=t[1],o[14]=t[2],o[15]=1,o}function r(t,n,i){return(i=i||new e(3))[0]=t[1]*n[2]-t[2]*n[1],i[1]=t[2]*n[0]-t[0]*n[2],i[2]=t[0]*n[1]-t[1]*n[0],i}function a(t,n){n=n||new e(3);var i=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return i>1e-5&&(n[0]=t[0]/i,n[1]=t[1]/i,n[2]=t[2]/i),n}const{BloomFilter:o}=n(341),s={red:0,blue:1,green:2},l={0:"red",1:"blue",2:"green"},c=()=>{const t=document.querySelectorAll(".square"),e=(t=>{let e="";return t.forEach((t=>{const n=s[t].toString(2).padStart(2,"0");e+=n})),e})(Array.from(t).map((t=>t.style.backgroundColor)));return h(e)},h=t=>{t=t.padEnd(8*Math.ceil(t.length/8),"0");const e=[];for(let n=0;n<t.length;n+=8)e.push(parseInt(t.substring(n,n+8),2));const n=new Uint8Array(e);let i=btoa(String.fromCharCode.apply(null,n));return i=i.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""),i},u=(t,e)=>{const n=2*e,i=d(t).substring(0,n);if(i.length!==n)throw new Error("Decoded binary string does not match the expected length.");const r=[];for(let t=0;t<i.length;t+=2){const e=parseInt(i.substring(t,t+2),2);r.push(l[e])}return r},d=t=>{switch((t=t.replace(/-/g,"+").replace(/_/g,"/")).length%4){case 2:t+="==";break;case 3:t+="="}const e=atob(t);let n="";for(let t=0;t<e.length;t++)n+=e.charCodeAt(t).toString(2).padStart(8,"0");return n},f=(t,e,n)=>{let i=Math.floor(t/e),r=t%e;const a=[];for(let t=-1;t<=1;t++)for(let o=-1;o<=1;o++)if(0===t&&0===o);else{let s=i+t,l=r+o;if(s>=0&&s<n&&l>=0&&l<e){let t=s*e+l;a.push(t)}}return a},m=t=>{switch(t){case 0:case 1:return[4,2,5,3];case 2:case 3:return[4,5,0,1];case 4:case 5:return[2,3,0,1];default:throw new Error("Invalid face index")}},g=(t,e,n,i,r)=>{performance.now();const a=u(t,e*n),l=new o(288e7,12),c=[],h=[],d={};for(let t=0;t<e*n;t++)d[t]=i?m(t):f(t,n,e);c.push({currentState:a.map((t=>s[t])),index:0,moves:[]});let g=!1,y=0,v=0,p=0;for(;c.length>0||h.length>0;){0===c.length?(g=!0,y=h.length,v=0):v>=y&&(g=!1),v++;const{currentState:t,index:e,moves:n}=g?h.shift():c.shift();if(e>=t.length)continue;if(t.every((t=>t===s.red)))return n;if(p!==n.length&&(p=n.length,null!=r&&n.length>=r))return null;const i=t.join("")+"-"+e;if(l.test(i))continue;l.add(i);const a=[...t];a[e]=(a[e]+1)%3;for(let t of d[e])a[t]=(a[t]+1)%3;h.push({currentState:a,index:0,moves:[...n,e]}),c.push({currentState:t,index:e+1,moves:n})}return null},y=t=>new Promise(((e,n)=>{const i=new Image;i.onload=function(){try{e(i)}catch(t){n(t)}},i.onerror=function(t){n(t)},i.src=t.toDataURL("image/png")})),v=(t,e=!1)=>{const n=document.getElementById("canvas-img"),i=n.getContext("2d"),r=2048;t.forEach(((t,a)=>{const o=t.color,s=t.value;i.save(),e&&(i.scale(-1,1),i.translate(-n.width,0)),i.fillStyle=o,i.fillRect(a*r,0,r,r),i.strokeStyle="black",i.lineWidth=10,i.strokeRect(a*r,0,r,r),i.font="bold 500pt Luminari";const l=s.split("").join(String.fromCharCode(8202));i.fillStyle=function(t,e,n,i){let r,a,o,s,l,c,h,u=null,d=parseInt,f=Math.round,m="string"==typeof n;if("number"!=typeof t||t<-1||t>1||"string"!=typeof e||"r"!=e[0]&&"#"!=e[0]||n&&!m)return null;u||(u=t=>{let e=t.length,n={};if(e>9){if([r,a,o,m]=t=t.split(","),e=t.length,e<3||e>4)return null;n.r=d("a"==r[3]?r.slice(5):r.slice(4)),n.g=d(a),n.b=d(o),n.a=m?parseFloat(m):-1}else{if(8==e||6==e||e<4)return null;e<6&&(t="#"+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+(e>4?t[4]+t[4]:"")),t=d(t.slice(1),16),9==e||5==e?(n.r=t>>24&255,n.g=t>>16&255,n.b=t>>8&255,n.a=f((255&t)/.255)/1e3):(n.r=t>>16,n.g=t>>8&255,n.b=255&t,n.a=-1)}return n});if(h=e.length>9,h=m?n.length>9||"c"==n&&!h:h,l=u(e),s=t<0,c=n&&"c"!=n?u(n):s?{r:0,g:0,b:0,a:-1}:{r:255,g:255,b:255,a:-1},s=1-(t=s?-1*t:t),!l||!c)return null;i?(r=f(s*l.r+t*c.r),a=f(s*l.g+t*c.g),o=f(s*l.b+t*c.b)):(r=f((s*l.r**2+t*c.r**2)**.5),a=f((s*l.g**2+t*c.g**2)**.5),o=f((s*l.b**2+t*c.b**2)**.5));return m=l.a,c=c.a,l=m>=0||c>=0,m=l?m<0?c:c<0?m:m*s+c*t:0,h?"rgb"+(l?"a(":"(")+r+","+a+","+o+(l?","+f(1e3*m)/1e3:"")+")":"#"+(4294967296+16777216*r+65536*a+256*o+(l?f(255*m):0)).toString(16).slice(1,l?void 0:-2)}(.7,o);const c=i.measureText(l),h=c.width,u=c.actualBoundingBoxAscent+c.actualBoundingBoxDescent,d=a*r+1024-h/2,f=(r+u)/2;i.fillText(l,d,f),i.restore()}))};let p=!1;function E(n){v([{color:"#ff4949",value:"11"},{color:"#9c27b0",value:"14"},{color:"#4caf50",value:"12"},{color:"#ffcc00",value:"13"}],!0);const r=[0,0,.25,0,0,1,0,1,.25,0,.25,1],a=[.25,0,.5,0,.25,1,.25,1,.5,0,.5,1],o=[.5,0,.75,0,.5,1,.5,1,.75,0,.75,1],s=[.75,0,1,0,.75,1,.75,1,1,0,1,1],l=[0,0,.25,0,0,1,.25,0,.25,1,0,1],c=[.25,0,.5,0,.25,1,.5,0,.5,1,.25,1],h=[.5,0,.75,0,.5,1,.75,0,.75,1,.5,1],u=[.75,0,1,0,.75,1,1,0,1,1,.75,1],d=[0,1,2,0,1,2];let f=d,m=-1,g=null;var E=null,w=null,b=null;function A(t){var e=new Float32Array([-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,.5,.5,.5,.5,.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5]);t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)}function B(t,e){t.bufferData(t.ARRAY_BUFFER,new Float32Array([...R(e[0],!0),...R(e[1]),...R(e[2],!0),...R(e[3]),...R(e[4],!0),...R(e[5])]),t.STATIC_DRAW)}function x(t,e){let n=new Float32Array(36),i=6*e;for(let t=i;t<i+6;t++)n[t]=1;t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW)}function R(t,e=!1){return 0===t?e?l:r:1===t?e?c:a:2===t?e?h:o:3===t?e?u:s:(alert("Invalid texture index:"+t),null)}return function(){var r=document.querySelector("#game-canvas-3d"),a=r.getContext("webgl");if(!a)return;g=a,E=a.createBuffer(),w=a.createBuffer(),b=a.createBuffer();let o=-1,s=-1,l=-1,c=!1,h=0;var u=$(60),v=$(0),R=$(0);function I(t){const e=r.getBoundingClientRect();return t.touches&&t.touches.length>0?{x:t.touches[0].clientX-e.left,y:t.touches[0].clientY-e.top}:t.changedTouches&&t.changedTouches.length>0?{x:t.changedTouches[0].clientX-e.left,y:t.changedTouches[0].clientY-e.top}:{x:t.clientX-e.left,y:t.clientY-e.top}}const F=t=>{if(h>10)return;h=0;const e=t=>{t.forEach((t=>{f[t]=(f[t]+1)%3}))};switch(l){case 1:e([0,4,2,5,3]);break;case 2:e([1,4,2,5,3]);break;case 3:e([2,4,5,0,1]);break;case 4:e([3,4,5,0,1]);break;case 5:e([4,2,3,0,1]);break;case 6:e([5,2,3,0,1])}m=-1,a.bindBuffer(a.ARRAY_BUFFER,w),x(a,m),async function(){try{a.bindBuffer(a.ARRAY_BUFFER,E),B(a,f)}catch(t){alert("Error updating texture:"+t)}}(),setTimeout(_,100)};function k(t){t.preventDefault();const{x:e,y:n}=I(t);if(o=e,s=n,c){let e=t.touches?t.touches[0].clientX-M:t.movementX,n=t.touches?t.touches[0].clientY-T:t.movementY;h+=Math.abs(e)+Math.abs(n),R+=e/100,v+=n/100,t.touches&&(M=t.touches[0].clientX,T=t.touches[0].clientY)}}a.canvas.addEventListener("mousemove",k),a.canvas.addEventListener("mousedown",(t=>{c=!0,h=0})),a.canvas.addEventListener("mouseup",(t=>{c=!1}));let M=0,T=0;a.canvas.addEventListener("touchstart",(t=>{c=!0,h=0;const{x:e,y:n}=I(t);o=e,s=n,M=t.touches[0].clientX,T=t.touches[0].clientY,t.preventDefault()})),a.canvas.addEventListener("touchmove",k),a.canvas.addEventListener("touchend",(t=>{c=!1})),a.canvas.addEventListener("click",F),a.canvas.addEventListener("touchend",(t=>{F(),t.preventDefault()}));const S=0;function _(){let t=!0;for(let e=0;e<f.length;e++)if(f[e]!==S){t=!1;break}t&&n()}!async function(){const t=await y(document.getElementById("canvas-img"));a.bindTexture(a.TEXTURE_2D,O),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,t),a.generateMipmap(a.TEXTURE_2D)}();const L=t(a,["pick-vertex-shader","pick-fragment-shader"]);var U=a.getAttribLocation(L,"a_position"),C=a.getAttribLocation(L,"a_picking_color"),D=a.getUniformLocation(L,"u_matrix"),Y=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,Y),function(t){var e=[1,2,3,4,5,6].map((t=>t/255)),n=[];e.forEach((t=>{for(var e=0;e<6;e++)n.push(t)})),t.bufferData(t.ARRAY_BUFFER,new Float32Array(n),t.STATIC_DRAW)}(a);var q=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,q),A(a);var H=t(a,["vertex-shader-3d","fragment-shader-3d"]),P=a.getAttribLocation(H,"a_position"),X=a.getAttribLocation(H,"a_texcoord"),N=a.getAttribLocation(H,"a_flash"),z=a.getUniformLocation(H,"u_matrix"),G=a.getUniformLocation(H,"u_texture"),W=a.getUniformLocation(H,"u_time");a.bindBuffer(a.ARRAY_BUFFER,b),A(a),a.bindBuffer(a.ARRAY_BUFFER,E),B(a,d),a.bindBuffer(a.ARRAY_BUFFER,w),x(a,m);var O=a.createTexture();function $(t){return t*Math.PI/180}a.bindTexture(a.TEXTURE_2D,O),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,new Uint8Array([0,0,255,0,255,0,255,0,0,255,255,0])),requestAnimationFrame((function t(){let n=(Date.now()-V)/1e3;if(function(t,e=1){const n=t.clientWidth*e|0,i=t.clientHeight*e|0;(t.width!==n||t.height!==i)&&(t.width=n,t.height=i)}(a.canvas,3),a.viewport(0,0,a.canvas.width,a.canvas.height),a.enable(a.CULL_FACE),a.enable(a.DEPTH_TEST),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),p){const t=$(1);u=Math.min(Math.PI,u+t);const e=$(10),n=$(10);v+=e,R+=n}let r=a.canvas.clientWidth/a.canvas.clientHeight,c=function(t,n,i,r,a){a=a||new e(16);var o=Math.tan(.5*Math.PI-.5*t),s=1/(i-r);return a[0]=o/n,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=o,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=(i+r)*s,a[11]=-1,a[12]=0,a[13]=0,a[14]=i*r*s*2,a[15]=0,a}(u,r,1,2e3),h=function(t,n){n=n||new e(16);var i=t[0],r=t[1],a=t[2],o=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=t[8],d=t[9],f=t[10],m=t[11],g=t[12],y=t[13],v=t[14],p=t[15],E=f*p,w=v*m,b=c*p,A=v*h,B=c*m,x=f*h,R=a*p,I=v*o,F=a*m,k=f*o,M=a*h,T=c*o,S=u*y,_=g*d,L=s*y,U=g*l,C=s*d,D=u*l,Y=i*y,q=g*r,H=i*d,P=u*r,X=i*l,N=s*r,z=E*l+A*d+B*y-(w*l+b*d+x*y),G=w*r+R*d+k*y-(E*r+I*d+F*y),W=b*r+I*l+M*y-(A*r+R*l+T*y),O=x*r+F*l+T*d-(B*r+k*l+M*d),$=1/(i*z+s*G+u*W+g*O);return n[0]=$*z,n[1]=$*G,n[2]=$*W,n[3]=$*O,n[4]=$*(w*s+b*u+x*g-(E*s+A*u+B*g)),n[5]=$*(E*i+I*u+F*g-(w*i+R*u+k*g)),n[6]=$*(A*i+R*s+T*g-(b*i+I*s+M*g)),n[7]=$*(B*i+k*s+M*u-(x*i+F*s+T*u)),n[8]=$*(S*h+U*m+C*p-(_*h+L*m+D*p)),n[9]=$*(_*o+Y*m+P*p-(S*o+q*m+H*p)),n[10]=$*(L*o+q*h+X*p-(U*o+Y*h+N*p)),n[11]=$*(D*o+H*h+N*m-(C*o+P*h+X*m)),n[12]=$*(L*f+D*v+_*c-(C*v+S*c+U*f)),n[13]=$*(H*v+S*a+q*f-(Y*f+P*v+_*a)),n[14]=$*(Y*c+N*v+U*a-(X*v+L*a+q*c)),n[15]=$*(X*f+C*a+P*c-(H*c+N*f+D*a)),n}(i([0,0,2],[0,0,0],[0,1,0])),d=function(t,n,i){i=i||new e(16);var r=t[4],a=t[5],o=t[6],s=t[7],l=t[8],c=t[9],h=t[10],u=t[11],d=Math.cos(n),f=Math.sin(n);return i[4]=d*r+f*l,i[5]=d*a+f*c,i[6]=d*o+f*h,i[7]=d*s+f*u,i[8]=d*l-f*r,i[9]=d*c-f*a,i[10]=d*h-f*o,i[11]=d*u-f*s,t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i}(function(t,n,i){i=i||new e(16);var r=n[0],a=n[1],o=n[2],s=n[3],l=n[4],c=n[5],h=n[6],u=n[7],d=n[8],f=n[9],m=n[10],g=n[11],y=n[12],v=n[13],p=n[14],E=n[15],w=t[0],b=t[1],A=t[2],B=t[3],x=t[4],R=t[5],I=t[6],F=t[7],k=t[8],M=t[9],T=t[10],S=t[11],_=t[12],L=t[13],U=t[14],C=t[15];return i[0]=r*w+a*x+o*k+s*_,i[1]=r*b+a*R+o*M+s*L,i[2]=r*A+a*I+o*T+s*U,i[3]=r*B+a*F+o*S+s*C,i[4]=l*w+c*x+h*k+u*_,i[5]=l*b+c*R+h*M+u*L,i[6]=l*A+c*I+h*T+u*U,i[7]=l*B+c*F+h*S+u*C,i[8]=d*w+f*x+m*k+g*_,i[9]=d*b+f*R+m*M+g*L,i[10]=d*A+f*I+m*T+g*U,i[11]=d*B+f*F+m*S+g*C,i[12]=y*w+v*x+p*k+E*_,i[13]=y*b+v*R+p*M+E*L,i[14]=y*A+v*I+p*T+E*U,i[15]=y*B+v*F+p*S+E*C,i}(c,h),v);d=function(t,n,i){i=i||new e(16);var r=t[0],a=t[1],o=t[2],s=t[3],l=t[8],c=t[9],h=t[10],u=t[11],d=Math.cos(n),f=Math.sin(n);return i[0]=d*r-f*l,i[1]=d*a-f*c,i[2]=d*o-f*h,i[3]=d*s-f*u,i[8]=d*l+f*r,i[9]=d*c+f*a,i[10]=d*h+f*o,i[11]=d*u+f*s,t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i}(d,R),a.useProgram(L),a.enableVertexAttribArray(U),a.enableVertexAttribArray(C),a.bindBuffer(a.ARRAY_BUFFER,q),a.vertexAttribPointer(U,3,a.FLOAT,!1,0,0),a.bindBuffer(a.ARRAY_BUFFER,Y),a.vertexAttribPointer(C,1,a.FLOAT,!1,0,0),a.uniformMatrix4fv(D,!1,d),a.drawArrays(a.TRIANGLES,0,36);const f=o*a.canvas.width/a.canvas.clientWidth,m=a.canvas.height-s*a.canvas.height/a.canvas.clientHeight-1,g=new Uint8Array(4);a.readPixels(f,m,1,1,a.RGBA,a.UNSIGNED_BYTE,g);const y=g[0];l=y,a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),a.useProgram(H),a.enableVertexAttribArray(P),a.bindBuffer(a.ARRAY_BUFFER,b),a.vertexAttribPointer(P,3,a.FLOAT,!1,0,0),a.enableVertexAttribArray(N),a.bindBuffer(a.ARRAY_BUFFER,w),a.vertexAttribPointer(N,1,a.FLOAT,!1,0,0),a.enableVertexAttribArray(X),a.bindBuffer(a.ARRAY_BUFFER,E),a.vertexAttribPointer(X,2,a.FLOAT,!1,0,0),a.uniformMatrix4fv(z,!1,d),a.uniform1i(G,0),a.uniform1f(W,n),a.drawArrays(a.TRIANGLES,0,36),requestAnimationFrame(t)}));let V=Date.now()}(),{getFaceState:()=>f,highlightFace:t=>{m=t,g.bindBuffer(g.ARRAY_BUFFER,w),x(g,m)}}}async function w(t,e){const n=document.getElementById("game-container-2d");v([{color:"#ff4949",value:"11"},{color:"#ffcc00",value:"13"},{color:"#4caf50",value:"12"},{color:"#9c27b0",value:"14"}],!1);const i=await(async t=>{const e=await y(t),n=document.createElement("canvas"),i=n.getContext("2d"),r=e.width/4,a=e.height;n.width=r,n.height=a;const o=[];for(let t=0;t<4;t++){i.clearRect(0,0,n.width,n.height),i.drawImage(e,t*r,0,r,a,0,0,r,a);const s=n.toDataURL();o.push(s)}const s=[];for(let t=0;t<4;t++)s.push(`<img style="zoom: .2" src="${o[t]}" />`);return s})(document.getElementById("canvas-img")),r=i[1],a=i[0],o=i[2],s=["red","blue","green"];let l=!1,c=t.width,h=t.height,d=((t,e)=>{const n=document.getElementById("game-container-wrapper-2d"),i=n.offsetWidth,r=n.offsetHeight,a=Math.min(Math.floor(i/t),Math.floor(r/e));return Math.min(a,300)})(c,h),f=((t,e,n)=>{try{return u(t,n*e)}catch(t){return null}})(t.colors,h,c);const m=t=>{let e=(s.indexOf(t.style.backgroundColor)+1)%s.length;switch(t.style.backgroundColor=s[e],s[e]){case"red":t.innerHTML=r;break;case"blue":t.innerHTML=a;break;case"green":t.innerHTML=o;break;default:t.innerHTML=""}};n.style.width=c*d+"px";const g=t=>{let i=t.target.closest(".square");if(l||!i)return;let r=Array.from(i.parentNode.children).indexOf(i),a=Math.floor(r/c),o=r%c;for(let t=-1;t<=1;t++)for(let e=-1;e<=1;e++)if(0===t&&0===e)m(i);else{let i=a+t,r=o+e;if(i>=0&&i<h&&r>=0&&r<c){let t=i*c+r,e=n.children[t];m(e)}}(()=>{const t=document.getElementsByClassName("hint-highlight");for(let e=0;e<t.length;e++)t[e].classList.remove("hint-highlight")})(),(()=>{let t=n.querySelectorAll(".square");return Array.from(t).every((t=>"red"===t.style.backgroundColor))})()&&(l=!0,setTimeout((()=>{e()}),500))};return n.addEventListener("click",g),((t,e,n,i,r,a,o,s,l)=>{const c=n*i;t.style.gridTemplateColumns=`repeat(${n}, ${r}px)`;for(let n=0;n<c;n++){let i=document.createElement("div");i.classList.add("square"),i.style.width=`${r}px`,i.style.height=`${r}px`;let c=null===e?a[Math.floor(Math.random()*a.length)]:e[n];i.style.backgroundColor=c,"red"===c?i.innerHTML=o:"blue"===c?i.innerHTML=s:"green"===c&&(i.innerHTML=l),t.appendChild(i)}})(n,f,c,h,d,s,r,a,o),()=>{n.removeEventListener("click",g)}}class b{constructor(t,e,n,i){this.x=t,this.y=e,this.color=n,this.radius=2*Math.random()+1,this.angle=2*Math.random()*Math.PI,this.speed=5*Math.random()+.01,this.friction=i?.999:.98,this.gravity=.05,this.opacity=1,this.decay=i?.004:.01}update(){this.speed*=this.friction,this.x+=Math.cos(this.angle)*this.speed,this.y+=Math.sin(this.angle)*this.speed+this.gravity,this.opacity-=this.decay,this.opacity=Math.max(0,this.opacity)}draw(t){t.save(),t.globalAlpha=this.opacity,t.fillStyle=this.color,Math.random()>1?(t.beginPath(),t.arc(this.x,this.y,this.radius,0,2*Math.PI),t.fill()):(t.font=`${this.size}px Arial`,t.fillText("13",this.x,this.y)),t.restore()}}class A{constructor(t,e,n,i){this.x=t,this.y=e,this.size=n,this.color=i,this.angle=2*Math.random()*Math.PI,this.rotationSpeed=.02*(Math.random()-.5),this.speedX=2*(Math.random()-.5),this.speedY=2*(Math.random()-.5)}update(){this.x+=this.speedX,this.y+=this.speedY;const t=-100;this.x>window.innerWidth-t&&(this.x=t),this.x<t&&(this.x=window.innerWidth-t),this.y>window.innerHeight-t&&(this.y=t),this.y<t&&(this.y=window.innerHeight-t),this.angle+=this.rotationSpeed}draw(t){t.save(),t.translate(this.x+this.size/2,this.y+this.size/2),t.rotate(this.angle),t.translate(-this.size/2,-this.size/2),t.fillStyle=this.color,t.fillRect(0,0,this.size,this.size),t.fillStyle="#fff",t.font=this.size/2+"px Arial";const e=t.measureText("13"),n=e.width,i=e.actualBoundingBoxAscent+e.actualBoundingBoxDescent,r=(this.size-n)/2,a=(this.size+i)/2-e.actualBoundingBoxDescent;t.fillText("13",r,a),t.restore()}}const B="yams-2024-",x=document.getElementById("background-canvas");function R(){x.width=window.innerWidth,x.height=window.innerHeight}R(),window.addEventListener("resize",R);const I=new class{constructor(t,e){this.canvas=e,this.rate=t,this.ctx=e.getContext("2d"),this.fireworks=[],this.animationId=null,this.isRunning=!1,this.fireworksTimeout=null}createFirework(t,e,n){const i=["#ff4949","#ffcc00","#4caf50","#2196f3","#9c27b0"],r=i[Math.floor(Math.random()*i.length)];if(n)for(let n of i)for(let i=0;i<500;i++)this.fireworks.push(new b(t,e,n,!0));else for(let n=0;n<100;n++)this.fireworks.push(new b(t,e,r,!1))}animate(){this.ctx.fillStyle="rgba(0, 0, 0, 0.1)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.fireworks=this.fireworks.filter((t=>t.opacity>0)),this.fireworks.forEach((t=>{t.update(),t.draw(this.ctx)})),this.animationId=requestAnimationFrame(this.animate.bind(this))}sample_poisson(t){return-Math.log(Math.random())/t}createPoissonFirework(){if(!this.isRunning)return;this.createFirework(window.innerWidth*Math.random(),window.innerHeight*Math.random());const t=this.sample_poisson(10);this.fireworksTimeout=setTimeout(this.createPoissonFirework.bind(this),1e3*t)}startFireworks(){this.isRunning||(this.isRunning=!0,this.createPoissonFirework(),this.animate())}stopFireworks(){this.isRunning=!1,clearTimeout(this.fireworksTimeout),cancelAnimationFrame(this.animationId),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}}(10,x),F=new class{constructor(t,e){this.canvas=e,this.rate=t,this.ctx=e.getContext("2d"),this.squares=[],this.animationId=null,this.isRunning=!1}createSquare(t,e){const n=["#ff4949","#ffcc00","#4caf50","#2196f3","#9c27b0"],i=n[Math.floor(Math.random()*n.length)],r=40*Math.random()+20;this.squares.push(new A(t,e,r,i))}animate(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.squares.forEach((t=>{t.update(),t.draw(this.ctx)})),this.animationId=requestAnimationFrame(this.animate.bind(this))}createSquares(){for(let t=0;t<50;t++)this.createSquare(Math.random()*window.innerWidth,Math.random()*window.innerHeight)}start(){this.isRunning||(this.isRunning=!0,this.createSquares(),this.animate())}stop(){this.isRunning=!1,cancelAnimationFrame(this.animationId),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}}(50,x),k=[{mode:"2d",colors:"QA",width:1,height:1,subtitle:"Make it 13"},{mode:"2d",colors:"kA",width:1,height:3,subtitle:"Make them all 13"},{mode:"2d",colors:"GQ",width:1,height:4,subtitle:"Make them all 13"},{mode:"2d",colors:"SSFA",width:3,height:3,subtitle:"Make them all 13"},{mode:"2d",colors:"SSFA",width:3,height:4,subtitle:"Make them all 13"},{mode:"2d",colors:"SCpGRQ",width:3,height:4,subtitle:"Make them all 13"},{mode:"3d",subtitle:"Make them all 13, try dragging"}];let M,T,S=0,_=k[S];function L(t,e){return Math.random()*(e-t)+t}let U=!1;function C(){const t=document.querySelectorAll(".square");U=!0,t.forEach((t=>{const e=L(-500,500),n=L(-500,500);t.style.transform=`translate(${e}px, ${n}px)`,t.style.transition="transform 1s ease, opacity 1s ease",t.style.opacity="0.3"})),setTimeout((()=>function(){if(!1===U)return;const t=document.querySelectorAll(".square");t.forEach((t=>{t.style.transform="scale(5)",t.style.opacity="0"}))}()),1e3)}const D=document.getElementById("win-message"),Y=()=>{document.getElementById("win-modal").style.display="none",document.getElementById("next-level").style.display="none",document.getElementById("hint-modal").style.display="none"},q=()=>{Y(),S++,N(S),null!=M&&M()};document.getElementById("replay").addEventListener("click",(()=>{Y(),N(S),null!=M&&M()})),document.getElementById("next-level").addEventListener("click",q);const H=async(t,e=7)=>{if(S<=3&&(e=100),"2d"===_.mode){const t=c(),a=(n=t,i=_.height,r=_.width,g(n,i,r,!1,e));if(null!=a&&a.length>0){const t=a[0],e=document.getElementsByClassName("square");for(let n=0;n<e.length;n++){const i=e[n];n===t&&i.classList.add("hint-highlight")}}null==a&&z()}else{const t=(t=>g(t,2,3,!0))(h((t=>{let e="";return t.forEach((t=>{const n=t.toString(2).padStart(2,"0");e+=n})),e})(T.getFaceState()))),e=t[0];T.highlightFace(e)}var n,i,r};document.getElementById("hint").addEventListener("click",H);let P=!0;document.getElementById("skip").addEventListener("click",(function(){P&&(S===k.length-1?X():q(),P=!1,setTimeout((function(){P=!0}),500))}));const X=()=>{I.startFireworks();const t=document.getElementById("game-canvas-3d").getBoundingClientRect(),e=t.left+t.width/2,n=t.top+t.height/2;setTimeout((()=>I.createFirework(e,n,!0)),3e3),p=!0;const i=document.getElementById("title");i.textContent="You win!",i.style.color="white",document.getElementById("subtitle").style.visibility="hidden",document.getElementById("controls").style.visibility="hidden",document.getElementById("controls-end").style.visibility="unset",(()=>{const t=new AudioContext,e=[46,47,50,51,5,21,44,45,48,49,52,53,42,43,54,55,1,3,7,17,19,23,36,37,40,41,56,57,34,35,38,39,58,59,1,7,9,11,13,17,23,25,27,29,60,61,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,52,54,56,58,60,62,33,35,37,39,41,43,45,47,49,51,53,55,57,59,61,1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,42,44,46,48,50,63,64,65];[1,1,1,1,3,3,3,3,3,3,3,3,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22].map(((n,i)=>{if(n){const r=t.createOscillator(),a=e[i]/5;r.connect(t.destination),r.frequency.value=988/1.06**n,r.type="triangle",r.start(a),r.stop(a+.2)}}))})()},N=async t=>{const e=document.getElementById("game-container-2d");e.innerHTML="",I.stopFireworks(),U=!1,e.style.boxShadow="0 4px 15px rgba(128,128,128,.5)";document.getElementById("title").style.filter="";document.getElementById("controls").style.visibility="";var n=localStorage.getItem(B+t);document.getElementById("skip").style.display="true"===n?"block":"none",_=k[t],document.getElementById("title").textContent=`Level ${t+1}`,document.getElementById("subtitle").textContent=_.subtitle,document.getElementById("subtitle").style.visibility="unset","2d"===_.mode?(document.getElementById("game-container-wrapper-2d").style.visibility="unset",document.getElementById("game-canvas-3d").style.visibility="hidden",M=await w(_,(()=>{localStorage.setItem(B+t,"true"),I.startFireworks(),(()=>{const t=new AudioContext,e=[5,1,3,7,1,7,9,5,6,3,4,7,8,1,2,9];[3,6,6,6,10,10,10,15,15,18,18,18,18,22,22,22].map(((n,i)=>{if(n){const r=t.createOscillator(),a=e[i]/5;r.connect(t.destination),r.frequency.value=988/1.06**n,r.type="triangle",r.start(a),r.stop(a+.2)}}))})(),C(),((t,e)=>{document.getElementById("game-container-2d").style.boxShadow="unset",document.getElementById("title").style.filter="invert(1)",D.textContent=`Congratulations! You beat level ${e+1} of ${k.length}!`,document.getElementById("next-level").style.display="unset",document.getElementById("win-modal").style.display="block",document.getElementById("controls").style.visibility="hidden",document.getElementById("subtitle").style.visibility="hidden"})(0,S)}))):(document.getElementById("title").textContent=`Level ${t+1}`,document.getElementById("game-container-wrapper-2d").style.visibility="hidden",document.getElementById("game-canvas-3d").style.visibility="unset",T=E((()=>{localStorage.setItem(B+t,"true"),X()})))};document.getElementById("close-intro").addEventListener("click",(function(){document.getElementById("game-container").style.visibility="unset",document.getElementById("intro-modal").style.display="none",F.stop()})),document.getElementById("curmudgeon").addEventListener("click",(function(){window.location.href="https://dev.js13kgames.com/2024/games"})),document.getElementById("okay").addEventListener("click",(function(){Y()})),document.getElementById("wait").addEventListener("click",(function(){Y(),H(0,null)})),document.getElementById("controls-end").addEventListener("click",(function(){location.reload()}));const z=()=>{document.getElementById("hint-modal").style.display="block"};N(S),F.start()})()})();