<html>
  <head>
    <title>JS13K 21</title>
    <meta
      name="viewport"
      content="user-scalable=no, width=device-width, initial-scale=1.0"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <style>*{padding:0;margin:0}body,html{height:100%;overflow:hidden}body{background:#222;overscroll-behavior:none}#g{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;overflow-x:hidden}canvas{image-rendering:pixelated;object-fit:contain;max-height:100%;max-width:100%}</style>
  </head>
  <body>
    <div id="g" />
    <script>class t{x=0;y=0;width=0;height=0;velocity={x:0,y:0};alive=!0;hp=1;speed=1;constructor(t,e){this.x=t,this.y=e}update(t){this.x+=this.velocity.x,this.y+=this.velocity.y}setSprite(t){this.source=t,this.flashSprite=f(t,"#FFFFFF"),this.width=t.width,this.height=t.height,this.pixelMap=function(t){return a(t.getContext("2d"),0,0,t.width,t.height)}(t),this.sx=0,this.sy=0}render(){F(this)}}function e(t,e){const n=Math.cos(e),i=Math.sin(e);let o=t.x;return t.x=t.x*n-t.y*i,t.y=o*i+t.y*n,t}function n(t){return t.x=0,t.y=0,t}function i(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function o(t,e,n){return t.x=e,t.y=n,t}function s(t){if(function(t){return 0===t.x&&0===t.y}(t))return t;if(0===t.x)return t.y=t.y>0?1:-1,t;if(0===t.y)return t.x=t.x>0?1:-1,t;const e=i(t);return t.x/=e,t.y/=e,t}function h(t,e){return{x:t.x-e.x,y:t.y-e.y}}function r(t,e){return t.x*=e,t.y*=e,t}function a(t,e,n,i,o){const s=[];for(let h=0;h<o;h++)for(let o=0;o<i;o++){const i=t.getImageData(e+o,n+h,1,1);void 0===s[h]&&(s[h]=[]),s[h][o]=0!==i.data[3]}return s}function l(t,e,n){const i=n.x-n.width/2,o=n.y-n.height/2,s=Math.floor(i-(t.x-t.width/2)),h=Math.floor(o-(t.y-t.height/2)),r=Math.floor(i-(e.x-e.width/2)),a=Math.floor(o-(e.y-e.height/2));for(let i=0;i<Math.floor(n.height);i++)for(let o=0;o<Math.floor(n.width);o++){const n=d(o+s,0,1/0),l=d(i+h,0,1/0),c=d(o+r,0,1/0),u=d(i+a,0,1/0);if(void 0===t.pixelMap[l])continue;if(void 0===e.pixelMap[u])continue;const f=t.pixelMap[l][n],x=e.pixelMap[u][c];if(!0===f&&!0===x)return!0}return!1}function c(t,e){const n=t.width/2,i=e.width/2,o=t.height/2,s=e.height/2,h=Math.min(t.x-n,e.x-i),r=Math.max(t.x+n,e.x+i),a=Math.min(t.y-o,e.y-s),l=r-h,c=Math.max(t.y+o,e.y+s)-a,u=t.width+e.width,f=t.height+e.height;if(!1===(u>l&&f>c))return!1;const d=u-l,x=f-c;return{x:Math.max(t.x-n,e.x-i)+d/2,y:Math.max(t.y-o,e.y-s)+x/2,width:d,height:x}}function u(t,e){const n=document.createElement("canvas"),i=n.getContext("2d");return n.width=t,n.height=e,[n,i]}function f(t,e,n="source-atop"){const[i,o]=u(t.width,t.height);return o.drawImage(t,0,0),o.globalCompositeOperation=n,o.fillStyle=e,o.fillRect(0,0,t.width,t.height),i}function d(t,e,n){return Math.min(Math.max(t,e),n)}let x=0,y=0;function g(t){return t.alive}function p(t,e){const[n,i,o,s]=t,h=3*(i.x-n.x),r=3*(o.x-i.x)-h,a=s.x-n.x-h-r,l=3*(i.y-n.y),c=3*(o.y-i.y)-l,u=s.y-n.y-l-c;return{x:a*Math.pow(e,3)+r*Math.pow(e,2)+h*e+n.x,y:u*Math.pow(e,3)+c*Math.pow(e,2)+l*e+n.y}}function w(t,e=16){const n=1/e,i=[];for(let e=0;e<=1;e+=n){const n=p(t,e);i.push(n)}return i}function m(t,e,n,i,o,s=1){t.imageSmoothingEnabled=!1,n.toUpperCase().split("").forEach(((n,h)=>{const r=function(t){const e=t.charCodeAt(0);return e>=43&&e<59?3*(e-43):39===e?129:63===e?126:e>=65&&e<91?3*(e-64)+45:null}(n);if(null===r)return;const a=4*h*s;t.drawImage(e,r,0,3,5,i+a,o,3*s,5*s)})),t.imageSmoothingEnabled=!0}let z=[];function v(t,e,n,i,o){const s=t[e],h=(n-s)/i;s!==n&&z.push({obj:t,prop:e,to:n,increment:h,fn:o,alive:!0})}function M(){if(xt===ct&&(bt.drawImage(le,5,yt.logoY+2),bt.drawImage(ae,3,yt.logoY),function(){let t=yt.y;yt.items.forEach(((e,n)=>{let i=e.text;yt.selected===n&&(i="- "+i+" -");const o=2,s=C(i,o),h=wt/2-s.width/2;m(bt,se,i,h,t+30*n,o)}))}(),Kt>0)){const t=`HI SCORE: ${Kt}`,e=C(t,2),n=wt/2-e.width/2;m(bt,he,t,n,250,2)}if(xt===ut){let t=""+kt,e=se;kt>Kt&&(e=he),m(bt,se,"Score:",5,5),m(bt,e,t,33,5),m(bt,se,"Lives:",140,5);for(let t=0;t<Yt;t++){const e=168+10*t;bt.drawImage(Et,24,16,8,5,e,5,8,5)}}if(xt===ft&&bt.drawImage(ce,0,100),xt===dt){bt.drawImage(winImage,0,100);const t=`SCORE: ${kt}`,e=C(t,2),n=wt/2-e.width/2;if(m(bt,se,t,n,250,2),kt>Kt){const t="NEW HIGH SCORE",e=C(t,2),n=wt/2-e.width/2;m(bt,he,t,n,280,2)}}}function C(t,e=1){return{width:4*t.length*e,height:5*e}}function S(t,e){const n=new b(t.x,t.y,r(e,t.bulletSpeed));fe.push(n)}function I(t,n){const i=Math.PI/2/n,o=e({x:0,y:1},-i*Math.round(n/2));!function(t,e){for(let n=0;n<t;n++)e(n)}(n,(()=>{const n={...e(o,i)},s=new b(t.x,t.y,r(n,t.bulletSpeed));fe.push(s)}))}class b extends t{width=5;height=5;sx=24;sy=8;constructor(t,e,n){super(t,e),this.velocity=n,this.pixelMap=St.bullet,this.source=Et}}class E extends t{width=9;height=7;sx=24;sy=0;velocity={x:0,y:-5};constructor(t,e){super(t,e),this.pixelMap=St.bullet,this.source=Et}}function F(t,e){let{x:n,y:i,sx:o,sy:s,source:h,width:r,height:a}=t;e&&(n+=e.x,i+=e.y),bt.drawImage(h,o,s,r,a,Math.floor(n-r/2),Math.floor(i-a/2),r,a)}function R(t,e=100){const n=t.source;n!==t.flashSprite&&(t.source=t.flashSprite,setTimeout((()=>{t.source=n}),e))}const T=[[null,51,null],[40,35,41],[null,52,null]],L=[[6,50,7],[22,48,23]],X=[[8,36,9],[18,33,19],[22,48,23]],P=[[null,49,null],[6,37,7],[54,59,55]],B=[[null,57,null],[22,35,23],[40,33,41],[40,33,41],[6,35,7],[22,52,23]],A=[[0,5,57,4,1],[18,35,32,35,19],[40,32,33,32,41],[2,35,32,35,3],[16,21,56,20,17]];function G(t){const e=8*t.length,n=8*t[0].length,[i,o]=u(n,e);for(let e=0;e<t.length;e++)for(let n=0;n<t[0].length;n++){let i=t[e][n];if(null===i)continue;const s=56+8*(i%16),h=16+8*Math.floor(i/16),r=8*n,a=8*e;o.drawImage(oe,s,h,8,8,r,a,8,8)}return i}class k extends t{score=100;shootingCooldown=0;weaponSpeed=2e3;bulletSpeed=1.5;update(t){if(super.update(t),this.shootingCooldown-=1e3*t,this.shootingCooldown<0&&(this.shootingCooldown=0),this.shoot(),this.target&&this.path&&this.path.length>2){const t=10;e=this,n=this.target,i(h(e,n))<t&&(this.target=this.path[++this.pathIndex],this.seekTarget())}var e,n}shoot(){this.shootingCooldown>0||this.y<0||(this.shootingCooldown+=this.weaponSpeed,zzfxP(ee),function(t){const e=s(h(at,t)),n=new b(t.x,t.y,r(e,t.bulletSpeed));fe.push(n)}(this))}seekTarget(){this.target&&(this.velocity.x=this.target.x-this.x,this.velocity.y=this.target.y-this.y,s(this.velocity),r(this.velocity,this.speed))}damage(t){zzfxP(Jt),st(t.x,t.y),R(this),this.hp-=1,this.hp<=0&&(setTimeout((()=>{this.alive=!1}),50),kt+=this.score)}}class K extends k{score=50;constructor(t,e){super(t,e),this.setSprite(Mt.drone)}shoot(){}}class Y extends k{hp=3;score=200;constructor(t,e){super(t,e),this.setSprite(Mt.fighter)}}class $ extends k{hp=2;score=100;speed=1.5;bulletSpeed=2;constructor(t,e){super(t,e),this.setSprite(Mt.fighter2)}shoot(){this.shootingCooldown>0||this.y<0||(this.shootingCooldown+=this.weaponSpeed,zzfxP(ee),S(this,{x:0,y:1}))}}class D extends k{hp=5;score=300;constructor(t,e){super(t,e),this.setSprite(Mt.bomber)}shoot(){this.shootingCooldown>0||this.y<0||(this.shootingCooldown+=this.weaponSpeed,zzfxP(ee),I(this,3))}}class O extends k{hp=7;score=500;constructor(t,e){super(t,e),this.setSprite(Mt.frigate)}shoot(){this.shootingCooldown>0||this.y<0||(this.shootingCooldown+=this.weaponSpeed,zzfxP(ee),S(this,s({x:-1,y:this.velocity.y})),S(this,s({x:1,y:this.velocity.y})))}}function H(t,e){const[n,i]=e,o=new t(n.x,n.y);o.path=e,o.pathIndex=0,o.target=i,o.seekTarget(),de.push(o)}const V="KeyW",W="KeyS",j="KeyZ",q="ArrowUp",U="ArrowDown",_="Space",N="Enter",Q={};function Z(...t){return t.some((t=>!!Q[t]))}const J=[{x:45,y:0,width:9,height:9},{x:54,y:0,width:9,height:9},{x:63,y:0,width:9,height:9}],tt=[{x:72,y:0,width:4,height:9},{x:76,y:0,width:4,height:9},{x:80,y:0,width:4,height:9},{x:76,y:0,width:4,height:9}],et=[{x:76,y:0,width:4,height:11},{x:80,y:0,width:4,height:11},{x:84,y:0,width:4,height:11},{x:80,y:0,width:4,height:11}];let nt=[];class it extends t{frames=[];currentFrame=0;counter=0;fps=12;loop=!1}class ot extends it{frames=J;constructor(t,e){super(t,e),this.source=Et;const n=J[0];this.width=n.width,this.height=n.height,this.sx=n.x,this.sy=n.y}}function st(t,e){const n=new ot(t,e);xe.push(n),nt.push(n)}let ht=[];const rt=()=>{ht.forEach((t=>{bt.drawImage(t.img,0,t.y),bt.drawImage(t.img,0,0-t.img.height+t.y)}))};let at;class lt extends t{width=24;height=16;sx=0;sy=0;speed=2;weaponSpeed=200;shootingCooldown=0;hasControl=!1;invulnerable=!1;constructor(){super(wt/2,0),this.source=Et,this.flashSprite=vt,this.pixelMap=a(Ft,0,0,32,32);const t=tt[0],e={x:-9,y:10,width:t.width,height:t.height,alive:!0,source:Et,sx:t.x,sy:t.y,frames:tt,currentFrame:0,counter:0,fps:10,loop:!0},n={...e,x:9};this.engineTrailLeft=e,this.engineTrailRight=n,nt.push(e,n)}update(t){super.update(t),this.shootingCooldown-=1e3*t,this.shootingCooldown<0&&(this.shootingCooldown=0)}shoot(){if(this.shootingCooldown>0)return;this.shootingCooldown+=this.weaponSpeed,zzfxP(te);const t=new E(this.x,this.y);ue.push(t)}damage(t){this.invulnerable||(R(this),st(t.x,t.y),zzfxP(Jt),Yt-=1,zzfxP(ne),0===Yt?(xt=ft,at.hasControl=!1,n(at.velocity),setTimeout((()=>{gt(),xt=ct,de=[],fe=[],ue=[],xe=[],at.y=9999}),3e3)):(at.hasControl=!1,at.invulnerable=!0,setTimeout((()=>{at.x=wt/2,at.y=mt+50,setTimeout((()=>{let t=setInterval((()=>{R(at)}),200);setTimeout((()=>{clearInterval(t),at.invulnerable=!1}),1500),v(at,"y",320,1e3,(()=>{at.hasControl=!0}))}),1e3)}),50)))}render(){F(this),F(this.engineTrailLeft,this),F(this.engineTrailRight,this)}}const ct=0,ut=1,ft=3,dt=4;let xt=ct,yt={y:200,logoY:-100,selected:0,items:[{text:"new game",fn:function(){xt=ut,At=function(t){const e=[];for(let n=0;n<t.waves.length;n++){const i=t.waves[n],[o,s,h,r=1,a=1]=i;for(let t=0;t<r;t++)e.push([o+t*a,H,[s,h]])}return{time:0,events:e}}(Qt),kt=0,Yt=3,setTimeout((()=>{at.hasControl=!0}),500)}}]};function gt(){kt>Kt&&(localStorage.setItem(Gt,kt),Kt=kt)}function pt(t,e,n){const i=2*mt,[o,s]=u(wt,i);for(let o=0;o<e;o++){const e=$t.randomIntBetween(0,wt),o=$t.randomIntBetween(0,i-t),l=$t.randomIntBetween(1,3)/10;s.fillStyle=(h=$t.randomIntBetween(200,255),r=$t.randomIntBetween(200,255),a=$t.randomIntBetween(200,255),`rgba(${h},${r},${a},${n-l})`),s.fillRect(e,o,t,t)}var h,r,a;return o}const wt=240,mt=400,zt=Math.floor(Math.min(window.innerWidth/wt,window.innerHeight/mt));let vt,Mt,Ct=!0,St={};const[It,bt]=u(wt,mt),[Et,Ft]=u(256,256),[Rt,Tt]=u(132,5),[Lt,Xt]=u(wt,50);let Pt;It.style.width=wt*zt,It.style.height=mt*zt;const Bt={x:wt/2,y:mt/2,width:wt,height:mt};let At,Gt="beeglebug_xiiivious_hiscore",kt=0,Kt=localStorage.getItem(Gt)||0,Yt=3;const $t=new class{constructor(t){this.m=2147483648,this.a=1103515245,this.c=12345,this.seed=t||Math.floor(Math.random()*(this.m-1)),this.state=this.seed}randomInt(){return this.state=(this.a*this.state+this.c)%this.m}random(){return this.randomInt()/(this.m-1)}randomIntBetween(t,e){const n=e-t,i=this.randomInt()/this.m;return t+Math.floor(i*n)}randomItem(t){return t[this.randomIntBetween(0,t.length)]}randomChance(t){return this.random()<t/100}shuffle(t){let e=t.length;for(;e;){let n=Math.floor(this.random()*e--),i=t[e];t[e]=t[n],t[n]=i}return t}}(2047356049);ht=[{y:0,img:pt(2,30,.8),speed:1.2},{y:0,img:pt(1,100,.7),speed:1},{y:0,img:pt(1,200,.6),speed:.8}];const Dt=wt/2,Ot=(w([{x:Dt,y:-50},{x:Dt-100,y:100},{x:Dt+100,y:mt-100},{x:Dt,y:mt}]),[...w([{x:Dt,y:100},{x:Dt+200,y:300},{x:Dt-200,y:300},{x:Dt,y:100}]),{x:Dt,y:200},{x:Dt,y:100}]),Ht=[{x:Dt,y:-100},{x:Dt,y:200},...Ot,...Ot,...Ot,...Ot,...Ot,...Ot,...Ot,...Ot,...Ot],Vt=w([{x:wt-50,y:-100},{x:50,y:100},{x:Dt-200,y:300},{x:wt+50,y:mt}]),Wt=w([{x:50,y:-100},{x:wt-50,y:100},{x:wt,y:300},{x:-50,y:mt}]),jt=w([{x:wt-50,y:-50},{x:Dt+100,y:mt},{x:Dt-100,y:mt},{x:50,y:-50}]),qt=w([{x:50,y:-50},{x:Dt-100,y:200},{x:Dt+100,y:mt-200},{x:wt-50,y:mt}]),Ut=w([{x:wt-50,y:-50},{x:Dt+100,y:mt-200},{x:Dt-100,y:200},{x:50,y:mt}]),_t=[{x:50,y:-50},{x:50,y:mt+50}],Nt=[{x:wt-50,y:-50},{x:wt-50,y:mt+50}],Qt={waves:[[0,K,_t,3,800],[0,K,Nt,3,800],[3e3,O,[{x:Dt,y:-50},{x:Dt,y:mt+50}],3,2e3],[5e3,$,qt],[5e3,$,Ut],[1e4,$,qt,2,1e3],[1e4,$,Ut,2,1e3],[13e3,Y,qt,3,2e3],[13e3,Y,Ut,3,2e3],[19e3,O,_t],[19e3,O,Nt],[2e4,D,Wt],[2e4,D,Vt],[22e3,K,jt,5,800],[25e3,$,qt,2,1e3],[25e3,$,Ut,2,1e3],[28e3,Y,qt,3,2e3],[28e3,Y,Ut,3,2e3],[35e3,class extends k{hp=50;score=5e3;speed=1;weaponSpeed=3e3;constructor(t,e){super(t,e),this.setSprite(Mt.boss),setTimeout((()=>{this.weaponSpeed=1e3}),2e3)}shoot(){this.shootingCooldown>0||this.y<0||(this.shootingCooldown+=this.weaponSpeed,zzfxP(ee),I(this,5))}},Ht]]};function Zt(t){At.time+=1e3*t;const{time:e,events:i}=At;for(let t=i.length-1;t>=0;t--){const[n,o,s]=i[t];e>=n&&(o(...s),i.splice(t,1))}0===i.length&&0===de.length&&0===fe.length&&0!==Yt&&(xt=dt,at.hasControl=!1,n(at.velocity),v(at,"x",wt/2,1e3),v(at,"y",320,1e3),ue=[],xe=[],setTimeout((()=>{gt(),xt=ct}),3e3))}zzfx=(...t)=>zzfxP(zzfxG(...t)),zzfxP=(...t)=>{let e=zzfxX.createBufferSource(),n=zzfxX.createBuffer(t.length,t[0].length,zzfxR);return t.map(((t,e)=>n.getChannelData(e).set(t))),e.buffer=n,e.connect(zzfxX.destination),e.start(),e},zzfxG=(t=1,e=.05,n=220,i=0,o=0,s=.1,h=0,r=1,a=0,l=0,c=0,u=0,f=0,d=0,x=0,y=0,g=0,p=1,w=0,m=0)=>{let z,v,M=2*Math.PI,C=a*=500*M/zzfxR**2,S=(0<x?1:-1)*M/4,I=n*=(1+2*e*Math.random()-e)*M/zzfxR,b=[],E=0,F=0,R=0,T=1,L=0,X=0,P=0;for(i=99+zzfxR*i,w*=zzfxR,o*=zzfxR,s*=zzfxR,g*=zzfxR,l*=500*M/zzfxR**3,x*=M/zzfxR,c*=M/zzfxR,u*=zzfxR,f=zzfxR*f|0,v=i+w+o+s+g|0;R<v;b[R++]=P)++X%(100*y|0)||(P=h?1<h?2<h?3<h?Math.sin((E%M)**3):Math.max(Math.min(Math.tan(E),1),-1):1-(2*E/M%2+2)%2:1-4*Math.abs(Math.round(E/M)-E/M):Math.sin(E),P=(f?1-m+m*Math.sin(2*Math.PI*R/f):1)*(0<P?1:-1)*Math.abs(P)**r*t*zzfxV*(R<i?R/i:R<i+w?1-(R-i)/w*(1-p):R<i+w+o?p:R<v-g?(v-R-g)/s*p:0),P=g?P/2+(g>R?0:(R<v-g?1:(v-R)/g)*b[R-g|0]/2):P),z=(n+=a+=l)*Math.sin(F*x-S),E+=z-z*d*(1-1e9*(Math.sin(R)+1)%2),F+=z-z*d*(1-1e9*(Math.sin(R)**2+1)%2),T&&++T>u&&(n+=c,I+=c,T=0),!f||++L%f||(n=I,a=C,T=T||1);return b},zzfxV=.3,zzfxR=44100,zzfxX=new(window.AudioContext||webkitAudioContext),
//! ZzFXM (v2.0.3) | (C) Keith Clark | MIT | https://github.com/keithclark/ZzFXM
zzfxM=(t,e,n,i=125)=>{let o,s,h,r,a,l,c,u,f,d,x,y,g,p,w,m=0,z=[],v=[],M=[],C=0,S=0,I=1,b={},E=zzfxR/i*60>>2;for(;I;C++)z=[I=u=x=g=0],n.map(((i,x)=>{for(c=e[i][C]||[0,0,0],I|=!!e[i][C],w=g+(e[i][0].length-2-!u)*E,p=x==n.length-1,s=2,r=g;s<c.length+p;u=++s){for(a=c[s],f=s==c.length+p-1&&p||d!=(c[0]||0)|a|0,h=0;h<E&&u;h++>E-99&&f?y+=(y<1)/99:0)l=(1-y)*z[m++]/2||0,v[r]=(v[r]||0)-l*S+l,M[r]=(M[r++]||0)+l*S+l;a&&(y=a%1,S=c[1]||0,(a|=0)&&(z=b[[d=c[m=0]||0,a]]=b[[d,a]]||(o=[...t[d]],o[2]*=2**((a-12)/12),a>0?zzfxG(...o):[])))}g=w}));return[v,M]};let Jt=zzfxG(...[2.41,,271,,,.21,4,2.88,3.1,,,,.07,.1,,.3,.1,.55,.04,.16]),te=zzfxG(...[2.04,,477,0,.09,.01,1,1.6,-3.6,,,,.08,.7,,,.1,.95]),ee=zzfxG(...[1.01,,394,.01,.06,0,,1.69,-7.8,,,,,,,,,.98]),ne=zzfxG(...[1.97,,992,.01,.18,.87,3,4.91,,.5,,,,.6,-5.2,.6,.46,.75,.02]);var ie;document.getElementById("g").appendChild(It),(ie=document).addEventListener("keydown",(({code:t})=>{xt===ct&&([_,N].includes(t)&&yt.items[yt.selected].fn(),[V,j,q].includes(t)&&(yt.selected--,yt.selected<0&&(yt.selected=yt.items.length-1)),[W,U].includes(t)&&(yt.selected++,yt.selected>=yt.items.length&&(yt.selected=0))),Q[t]=!0})),ie.addEventListener("keyup",(({code:t})=>{Q[t]=!1})),document.addEventListener("visibilitychange",(()=>{Ct="visible"===document.visibilityState})),document.addEventListener("contextmenu",(t=>{t.preventDefault()})),document.addEventListener("click",(t=>{if(xt!==ct)return;const e={x:(t.clientX-Pt.x)/zt,y:(t.clientY-Pt.y)/zt},n=yt.items.find((t=>function(t,e){const n=e.x-e.width/2,i=e.y-e.height/2,o=e.x+e.width/2,s=e.y+e.height/2;return t.x>n&&t.x<o&&t.y>i&&t.y<s}(e,t.rect)));n&&n.fn()}));const oe=new Image;oe.onload=function(){vt=f(oe,"#FFFFFF"),Ft.drawImage(oe,0,0),Tt.drawImage(oe,0,59,132,5,0,0,132,5),se=Rt,he=f(Rt,"#FFFF00"),re=f(Rt,"#FF0000"),greenFont=f(Rt,"#00FF00"),le=function(){const t="iiiviou",e=C(t,5),n=wt/2-e.width/2;return Xt.fillStyle="#FFFFFF",Xt.fillRect(20,0,194,4),Xt.fillRect(50,42,140,8),m(Xt,se,"X",20,10,8),m(Xt,se,t,n,10,5),m(Xt,se,"S",190,10,8),Lt}(),ae=f(le,"#5b6ee1"),ce=function(){const[t,e]=u(wt,100),n=C("XXXX",5),i=wt/2-n.width/2;return m(e,re,"GAME",i,10,5),m(e,re,"OVER",i,40,5),t}(),winImage=function(){const[t,e]=u(wt,100),n=C("XXXXX",5),i=wt/2-n.width/2;return m(e,greenFont,"LEVEL",i,10,5),m(e,greenFont,"CLEAR",i,40,5),t}(),function(t){t.items.forEach(((e,n)=>{const i=C("- "+e.text+" -",2),o=wt/2;e.rect={x:o,y:t.y+30*n+i.height/2,width:i.width+20,height:i.height+20}}))}(yt),St.bullet=a(Ft,24,0,9,6),St.enemyBullet=a(Ft,24,8,5,5),Pt=It.getBoundingClientRect(),at=new lt,Mt={drone:G(T),fighter:G(L),fighter2:G(P),frigate:G(B),bomber:G(X),boss:G(A)},yt.logoY=-100,at.y=mt+50,v(yt,"logoY",80,1e3),v(at,"y",320,1e3),ye()},oe.src="sprites.png";let se,he,re,ae,le,ce,ue=[],fe=[],de=[],xe=[];function ye(){requestAnimationFrame(ye),function(t){if(!1===Ct)return;(function(){let t=n(at.velocity);xt===ut&&!1!==at.hasControl&&(Z(_)&&at.shoot(),Z(V,j,q)&&(t.y-=1),Z(W,U)&&(t.y+=1),Z("KeyA","KeyQ","ArrowLeft")&&(t.x-=1),Z("KeyD","ArrowRight")&&(t.x+=1),s(t),r(t,at.speed),at.velocity=t)})(),xt===ut&&(at.engineTrailLeft.frames=tt,at.engineTrailRight.frames=tt,at.sy=0,o(at.engineTrailLeft,-9,10),o(at.engineTrailRight,9,10),at.velocity.x>0&&(at.sy=16,o(at.engineTrailLeft,-7,9),o(at.engineTrailRight,7,12),at.engineTrailLeft.frames=et),at.velocity.x<0&&(at.sy=32,o(at.engineTrailLeft,-7,12),o(at.engineTrailRight,7,9),at.engineTrailRight.frames=et),at.velocity.y<0&&(at.engineTrailLeft.frames=et,at.engineTrailRight.frames=et));xt!==ut&&xt!==ft||(at.update(t),de.forEach((e=>e.update(t))),fe.forEach((e=>e.update(t))),ue.forEach((e=>e.update(t))),Zt(t),fe.forEach((t=>{if(!1!==c(t,Bt)){if(!1===at.invulnerable){const e=c(t,at);e&&l(t,at,e)&&(t.alive=!1,at.damage(e))}}else t.alive=!1})),ue.forEach((t=>{!1!==c(t,Bt)?de.forEach((e=>{const n=c(t,e);n&&l(t,e,n)&&(t.alive=!1,e.damage(n))})):t.alive=!1})),de.forEach((t=>{const e=c(t,at);e&&l(t,at,e)&&(t.damage(e),at.damage(e)),t.y>mt&&(t.alive=!1)})),!0===at.hasControl&&(at.x=d(at.x,0,wt),at.y=d(at.y,0,mt)),de=de.filter(g),fe=fe.filter(g),ue=ue.filter(g),xe=xe.filter(g));ht.forEach((t=>{t.y+=t.speed,t.y>=t.img.height&&(t.y=t.img.height-t.y)})),function(t){z.forEach((e=>{const{obj:n,prop:i,to:o,increment:s,fn:h}=e,r=s*t*1e3,a=n[i]+r,l=a-o;if(r<0&&a<o||r>0&&a>o||Math.abs(l)<Math.abs(r))return n[i]=o,e.alive=!1,h&&h();n[i]=a})),z=z.filter(g)}(t),function(t){nt.forEach((e=>{e.counter+=1e3*t;const n=1e3/e.fps;if(e.counter>=n){if(e.counter=e.counter%n,e.currentFrame++,e.currentFrame>e.frames.length-1){if(!1===e.loop)return void(e.alive=!1);e.currentFrame=0}const t=e.frames[e.currentFrame];e.sx=t.x,e.sy=t.y,e.width=t.width,e.height=t.height}}))}(t)}(function(){y=x,x=performance.now();let t=(x-y)/1e3;return fps=1/t,t}()),bt.fillStyle="#000000",bt.fillRect(0,0,wt,mt),rt(),at.render(),de.forEach((t=>t.render())),fe.forEach((t=>t.render())),ue.forEach((t=>t.render())),xe.forEach((t=>t.render())),M()}</script>
  </body>
</html>
