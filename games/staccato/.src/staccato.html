<html><head><title>Staccato</title><style type="text/css">div{width:100%;min-height:100%;margin:0}canvas{position:absolute;top:0;left:0;width:100%;height:100%}</style>
</head><body><div><canvas id=c></canvas><canvas id=g></canvas></div><script>function aa(a){this.h=a;x(this)}aa.prototype={};function ba(a,b){var e=controls,c=!0,d=0,d=window.event?window.event.keyCode:a.which;b&&(e.ya=d);switch(d){case 37:e.mb=b;break;case 38:e.ob=b;break;case 39:e.nb=b;break;case 40:e.kb=b;break;case 32:case 13:e.lb=b;break;case 27:e.La=b;break;default:c=!1}for(var h=0;2>h;++h)for(var g=0;5>g;++g)d==e.h.data.keys[h][g]&&(e.I[h][g]=b,c=!0);return c}function ca(a,b,e,c){var d=a.h.data.keys[b][e];a=a.h;a.data.keys[b][e]=c;-1<c&&z(a);return d} function x(a){a.mb=!1;a.nb=!1;a.ob=!1;a.kb=!1;a.I=[[!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1]];da(a)}function da(a){a.lb=!1;a.La=!1;a.ya=0;a.Ja=0;a.I[0][4]=a.I[1][4]=!1}function fa(a){this.ba=0;this.j=2;this.S=0;this.controls=a;this.m=new ga(this.h=a.h);this.t=new M(1,5,a,this.m,-1);this.t.X[0][3]=this.t.na;this.t.X[0][4]=this.t.dc;this.H=new M(2,6,a,this.m,4);for(var b=0;2>b;++b)for(var e=0;5>e;++e)this.H.X[b][e]=this.H.$b;this.Z=new M(1,3,a,this.m,1);this.Z.X[0][2]=this.H.hc;this.F=new M(1,6,a,this.m,5);this.b=new ha(this.controls)}fa.prototype={};function ia(a,b){var e=game;e.N=a;e.g=b} function ja(){var a=game;a.g.clear();20==a.ba&&a.N.Da();2==a.state&&ka(a.g,a.b.j);2==a.N.fa&&(a.g.a.fillStyle="#000",a.g.a.fillRect(-1,-a.g.a.height>>1,2,a.g.a.height));if(2<=a.state){la(a.g,a.b.j,a.b.d,a.b.time,2==a.state);for(var b=0;b<a.j;++b)0<a.b.d[b].B?ma(a.g,b,a.b.j,a.b.d[b],a.h.data.M[a.S]):a.b.d[b].Ta?na(a.g,b,"Lap "+(1+a.b.d[b].k)+"/"+a.b.va):a.controls.I[b][4]&&oa(a.N,b);50>a.b.time&&(pa(a.g,a.b.time/50),qa(a.g,a.b.time/50))}0<a.ba&&(ra(a.g,1-a.ba/20),0!=a.U&&4!=a.U||sa(a.g,a.t,4==a.U), -1!=a.U&&-2!=a.U||ta(a.g,a.H,a.controls),1==a.U&&ua(a.g,a.F,a.b.c,a.h.data.M),3==a.U&&va(a.g,a.Z),a.g.endOffset());ra(a.g,-a.ba/20);0!=a.state&&4!=a.state||sa(a.g,a.t,4==a.state);-1!=a.state&&-2!=a.state||ta(a.g,a.H,a.controls);1==a.state&&ua(a.g,a.F,a.b.c,a.h.data.M);3==a.state&&va(a.g,a.Z);a.g.endOffset();wa(a.N);da(a.controls);a.ba&&--a.ba;requestAnimationFrame(function(){ja()})} function N(a,b){a.U=a.state;a.state=b;a.ba=20;a.t.C();a.H.C();a.F.C();a.Z.C();a.N.fa=a.j;0==b&&-1!=a.U&&(O(a,2,0),a.N.fa=2);1==b&&(a.N.fa=1,a.F.f=a.S,O(a,a.S,a.j))} function xa(){N(game,0);setInterval(function(){var a=game;0==a.state&&(P(a.t),a.t.R&&(2==a.t.f?N(a,-1):(a.j=a.t.f+1,N(a,1))));-1==a.state&&(P(a.H),a.H.R&&N(a,0));-2==a.state&&(P(a.H),a.H.R&&N(a,4));if(1==a.state&&(P(a.F),a.S!=a.F.f&&5>a.F.f&&O(a,a.F.f,a.j),a.F.R)){var b=a.F.f==a.F.T-1?0:2;N(a,b)}3==a.state&&(P(a.Z),a.Z.R&&(b=[2,1][a.Z.f],2==b&&O(a,a.S,a.j),N(a,b)));4==a.state&&(P(a.t),a.t.R&&(b=[2,1,-2][a.t.f],N(a,b)));if(-2!=a.state&&1!=a.state&&4!=a.state&&(b=a.b,0<=++b.time)){for(var e=0;e<b.j;++e){var c= b,d=e,h=c.d[d];h.K=-(0.2+0.6/(1+0.4*h.speed))*((c.controls.I[d][2]?-1:0)+(c.controls.I[d][3]?1:0));var g=Math.cos(h.heading)*h.n+Math.sin(h.heading)*h.o,l=0<=g&&c.controls.I[d][0],n=0>g&&c.controls.I[d][1],g=0<=g&&c.controls.I[d][1]||0>g&&c.controls.I[d][0];0<h.B&&(accelerate=!1,g=!0);ya(c,d,l?2E4:n?-8E3:0,g?2E4:0)}for(e=b.j;e<b.G;++e){c=b.d[e];c.aa=c.p;for(d=!1;!d;)c.aa=(c.aa+1)%b.c.r,d=b.c.l[c.aa].Sb;d=(c.aa+1)%b.c.r;h=0.25*Math.PI*b.c.l[d].dir;l=0.5+0.4*Math.sin(h)+(c.yb-0.5)*Math.cos(h);c.Ab= (b.c.l[c.aa].x+(0.5+0.4*Math.cos(h)-(c.yb-0.5)*Math.sin(h)))*sz;c.Bb=(b.c.l[c.aa].y+l)*sz;c.ab=40-12*Math.abs(b.c.l[d].pa);var d=2E4,h=0,l=c.Ab-c.v,n=c.Bb-c.w,g=Math.atan2(n,l)-c.heading,m=Math.min(0.2+0.6/(1+0.4*c.speed),Math.abs(Math.sin(g)));c.K=m*(0<Math.sin(g)?1:-1);0>Math.cos(c.heading)*c.n+Math.sin(c.heading)*c.o&&(c.K=-c.K);0<c.Y&&5>c.speed&&(c.sa=0<c.sa?0:40);c.sa?(--c.sa,d=-8E3):(l=Math.sqrt(l*l+n*n)/sz,c.speed>c.ab&&2>l&&(d=0,h=Math.min(2E4,1E3*(c.speed-c.ab)/(l+0.1))));0<c.B&&(d=0,h=2E4); ya(b,e,d,h)}e=[];for(c=0;c<b.G;++c)e.push([[],[],[],[],[],[],[]]);for(c=0;c<b.G;++c){d=b.d[c];d.Y=d.ta=0;h=Math.cos(d.heading);l=Math.sin(d.heading);g=[{x:d.Na,y:d.ca},{x:-d.Ya,y:d.ca},{x:-d.Ya,y:-d.ca},{x:d.Na,y:-d.ca}];for(m=0;4>m;++m){var q=(d.v+g[m].x*h-g[m].y*l)/sz,s=(d.w+g[m].x*l+g[m].y*h)/sz,n=b.c.W[16*Math.floor(s)+Math.floor(q)&255];255<n&&(n=1>=Math.abs((n&255)-d.p)||Math.abs((n&255)-d.p)==b.c.r-1?n&255:n>>8);n=Q(b.c,0<=n?b.c.l[n].Ga:-1,q-Math.floor(q),s-Math.floor(s));n.Wa&&e[c][6].push([c, g[m].x,g[m].y,n.pa,75E3*d.speed*Math.abs(Math.cos(n.pa-d.heading))])}for(n=0;n<b.G;++n)if(n!=c){var r=b.d[n];if(1>=Math.abs(d.p-r.p)||Math.abs(d.p-r.p)==b.c.r-1)for(m=0;4>m;++m){var t=Math.cos(r.heading),w=Math.sin(r.heading),q=d.v-r.v+g[m].x*h-g[m].y*l,s=d.w-r.w+g[m].x*l+g[m].y*h,u=q*t+s*w,q=-q*w+s*t;u>-r.Ya&&u<r.Na&&q>-r.ca&&q<r.ca&&(t=d.n-r.n,w=d.o-r.o,s=10*Math.sqrt(t*t+w*w),t=Math.atan2(w,t),e[c][n].push([c,g[m].x,g[m].y,r.heading+Math.atan2(q,u),s*r.J]),e[n][c].push([n,u,q,r.heading+t,s*d.J]))}}}for(c= 0;c<b.G;++c){d=b.d[c];for(n=g=l=m=0;n<=b.G;++n)for(r=e[c][n].length,k=0;k<r;++k)h=e[c][n][k],d.ta=d.speed,d.Y=h[4]/2E6/r,m+=h[4]*Math.cos(h[3]-d.heading),l+=h[4]*Math.sin(h[3]-d.heading),g+=0.1*(h[1]*l-h[2]*m);n=m/d.J;r=l/d.J;h=Math.cos(d.heading);l=Math.sin(d.heading);m=h*n-l*r;h=l*n+h*r;d.n+=0.02*m;d.o+=0.02*h;d.speed=Math.sqrt(d.n*d.n+d.o*d.o);d.v+=4E-4*m;d.w+=4E-4*h;h=g/d.vb;d.P+=0.02*h;d.heading+=4E-4*h;l=d.v/sz;g=d.w/sz;h=b.c.W[16*Math.floor(g)+Math.floor(l)&255];n=h&255;if(1==Math.abs(n-d.p)|| Math.abs(n-d.p)==b.c.r-1)d.p=n;255<h&&(n=h>>8,1==Math.abs(n-d.p)||Math.abs(n-d.p)==b.c.r-1)&&(d.p=n);d.xa=!1;255<h&&d.p==(h&255)&&(d.xa=!Q(b.c,b.c.l[h>>8].Ga,l-Math.floor(l),g-Math.floor(g)).Wa);l=(d.xb+1)%b.c.r;n=h&255;n!=l&&255<h&&(n=h>>8);d.Ta=!1;if(n==l&&(d.xb=n,0==n&&(++d.k,d.Ta=!0,d.A.push(b.time),d.k>=b.va)))for(m=1;m<d.A.length;++m)d.B=Math.min(d.A[m]-d.A[m-1],0==d.B?9999:d.B)}}if(2==a.state){for(b=0;b<a.b.j;++b)if(0<a.b.d[b].B){e=a.h;c=a.S;d=a.b.d[b].B;h=a.b.d[b].A[a.b.d[b].k];if(e.data.M[c].k> d||0==e.data.M[c].k)e.data.M[c].k=d;if(e.data.M[c].c>h||0==e.data.M[c].c)e.data.M[c].c=h;z(e)}b=a.b;e=b.d[0].k>=b.va;1<b.j&&(e=e&&b.d[1].k>=b.va);e&&N(a,3);a.controls.La&&N(a,4)}b=2==a.state;za(a.m,0,b,a.b.d[0].$a,a.b.d[0].Ia,a.b.d[0].xa);za(a.m,1,b,a.b.d[a.j-1].$a,a.b.d[a.j-1].Ia,a.b.d[a.j-1].xa);0<a.b.d[0].Y&&Aa(a.m,0,Math.min(1,a.b.d[0].Y),a.b.d[0].ta/30);0<a.b.d[a.j-1].Y&&Aa(a.m,1,Math.min(1,a.b.d[a.j-1].Y),a.b.d[a.j-1].ta/30);-150<=a.b.time&&0>=a.b.time&&0==a.b.time%50&&(b=a.m,a=!a.b.time,b.h.data.V&& (b.O&&(b.O.stop(0),b.O.disconnect()),b.O=b.i.createBufferSource(),b.O.buffer=b.zb,b.O.playbackRate.value=a?2:1,b.O.loop=!1,b.O.connect(b.i.destination),b.O.start(0,0)))},20);requestAnimationFrame=requestAnimationFrame||webkitRequestAnimationFrame;requestAnimationFrame(function(){ja()})} function O(a,b,e){a.b.C(e,a.S=b);b=a.N;e=a.b.c;b.eb=[];b.gb=[];b.fb=[];b.la=[];b.Ba=[];b.Aa=[];for(var c=[0,0.8,0.25,0.95],d=0;d<e.l.length;++d){var h=e.l[d],g=h.x,l=h.y,n=h.Ga,m=Math.PI*(n&3)/2,q=Math.cos(m),m=Math.sin(m),s=h.Fa,h=0.1+h.z;if(0==d){b.la.push((g+0.1+0.05)*sz,l*sz,4+h,(g+0.95-0.1)*sz,l*sz,4+h,(g+0.1+0.05)*sz,l*sz,6+h,(g+0.1+0.05)*sz,l*sz,6+h,(g+0.95-0.1)*sz,l*sz,4+h,(g+0.95-0.1)*sz,l*sz,6+h);b.Ba.push(0.05,0.5,0.05,0.749,0.143,0.5,0.143,0.5,0.05,0.749,0.143,0.749);for(var r=0;6>r;++r)b.Aa.push(0, 0.7,0.7);R(b,g,l,0,0.09,h,q,m,6,0.3);R(b,g,l,0,0.91,h,q,m,6,0.3)}switch(n>>2){case 0:S(b,g,l,0,0.1,q,m,h);S(b,g,l,1,0.1,q,m,h+s);S(b,g,l,0,0.9,q,m,h);S(b,g,l,0,0.9,q,m,h);S(b,g,l,1,0.1,q,m,h+s);S(b,g,l,1,0.9,q,m,h+s);b.gb.push(c[0],c[3],c[0],c[1],c[2],c[3],c[2],c[3],c[0],c[1],c[2],c[1]);for(var n=q*Math.sin(s/8),t=m*Math.sin(s/8),w=Math.sqrt(1-n*n-t*t),r=0;6>r;++r)b.fb.push(n,t,w);for(r=0;4>r;++r)R(b,g,l,r/4,0.09,h+s*r/4,q,m,1,0.3),R(b,g,l,r/4,0.91,h+s*r/4,q,m,1,0.3),T(b,g,l,r/4,0.09,0.5+h+s*r/4, (r+1)/4,0.09,0.5+h+s*(r+1)/4,q,m,0.2),T(b,g,l,r/4,0.91,0.5+h+s*r/4,(r+1)/4,0.91,0.5+h+s*(r+1)/4,q,m,0.2);break;case 1:s=(c[3]-c[1])/10;for(r=0;10>r;++r)n=r*Math.PI/10/2,t=(r+1)*Math.PI/10/2,S(b,g,l,0.9*Math.cos(n),0.9*Math.sin(n),q,m,h),S(b,g,l,0.1*Math.cos(n),0.1*Math.sin(n),q,m,h),S(b,g,l,0.9*Math.cos(t),0.9*Math.sin(t),q,m,h),S(b,g,l,0.9*Math.cos(t),0.9*Math.sin(t),q,m,h),S(b,g,l,0.1*Math.cos(n),0.1*Math.sin(n),q,m,h),S(b,g,l,0.1*Math.cos(t),0.1*Math.sin(t),q,m,h),b.gb.push(c[2],c[1]+r*s,c[0], c[1]+r*s,c[2],c[1]+(r+1)*s,c[2],c[1]+(r+1)*s,c[0],c[1]+r*s,c[0],c[1]+(r+1)*s),b.fb.push(0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1);R(b,g,l,0.09,0,h,q,m,1,0.4);T(b,g,l,0.09,0,0.5+h,0,0.09,0.5+h,q,m,0.2);for(r=0;6>r;++r)R(b,g,l,0.91*Math.cos(Math.PI*r/12),0.91*Math.sin(Math.PI*r/12),h,q,m,1,0.3),T(b,g,l,0.91*Math.cos(Math.PI*r/12),0.91*Math.sin(Math.PI*r/12),0.5+h,0.91*Math.cos(Math.PI*(r+1)/12),0.91*Math.sin(Math.PI*(r+1)/12),0.5+h,q,m,0.2)}}gl.bindBuffer(gl.ARRAY_BUFFER,b.ec=gl.createBuffer());gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(b.eb),gl.STATIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,b.gc=gl.createBuffer());gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(b.gb),gl.STATIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,b.fc=gl.createBuffer());gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(b.fb),gl.STATIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,b.Xb=gl.createBuffer());gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(b.la),gl.STATIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,b.Zb=gl.createBuffer());gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(b.Ba), gl.STATIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,b.Yb=gl.createBuffer());gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(b.Aa),gl.STATIC_DRAW);b=a.N;c=a.b.c;b.Sa=[];b.L=256;b.Ea=c.Tb;for(a=0;a<b.L*b.L;++a)b.Sa.push(a?99:0);for(d=0;d<c.r;++d)for(g=c.l[d],l=c.W[16*g.y+g.x&255]&255,a=0;11>a;++a)for(e=0;11>e;++e)q=e/10,m=a/10,Q(c,c.l[l].Ga,q,m).Wa||U(b,48+10*g.x+e,48+10*g.y+a,Ba(c,g.x+q,g.y+m,l));c=[];for(a=0;a<=b.L;++a)for(e=0;e<=b.L;++e)99==V(b,e,a)&&c.push([e,a,Math.min(V(b,e-1,a),V(b,e+1,a),V(b,e,a-1), V(b,e,a+1))]);for(e=0;e<c.length;++e)U(b,c[e][0],c[e][1],c[e][2]);W(b,0,0,b.L,12);b.Pa=[];b.Ra=[];b.Qa=[];for(e=0;e<=b.L;++e)for(a=0;a<=b.L;++a)c=V(b,e,a),b.Pa.push(1.6*(e-48),1.6*(a-48),c),b.Ra.push(0.3,0.03*Math.min(6.5,Math.max(-0.5,c))+0.77),c=V(b,e+1,a),b.Pa.push(1.6*(e-47),1.6*(a-48),c),b.Ra.push(0.4,0.03*Math.min(6.5,Math.max(-0.5,c))+0.77),c=0.3*(V(b,e-1,a)-V(b,e+1,a)),d=0.3*(V(b,e,a-1)-V(b,e,a+1)),g=Math.sqrt(1-c*c-d*d),b.Qa.push(c,d,g),c=0.3*(V(b,e,a)-V(b,e+2,a)),d=0.3*(V(b,e+1,a-1)-V(b, e+1,a+1)),g=Math.sqrt(1-c*c-d*d),b.Qa.push(c,d,g);gl.bindBuffer(gl.ARRAY_BUFFER,b.Pb=gl.createBuffer());gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(b.Pa),gl.STATIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,b.Rb=gl.createBuffer());gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(b.Ra),gl.STATIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,b.Qb=gl.createBuffer());gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(b.Qa),gl.STATIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,b.ic=gl.createBuffer());gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-76.8,-76.8,-0.5,332.8,-76.8,-0.5,-76.8,332.8,-0.5,332.8,332.8,-0.5]),gl.STATIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,b.jc=gl.createBuffer());gl.bufferData(gl.ARRAY_BUFFER,new Float32Array([0.5,0.75,0.75,0.75,0.5,1,0.75,1]),gl.STATIC_DRAW)}function M(a,b,e,c,d){this.controls=e;this.m=c;this.Ib=a;this.T=b;this.sb=d;this.X=[];for(e=0;e<a;++e)for(this.X.push([]),c=0;c<b;++c)this.X[e].push(this.Ub);this.C()} M.prototype={C:function(){this.Za=this.R=!1;this.f=this.D=this.tb=0;x(this.controls)},Ub:function(){return!0},na:function(){this.m.na();return!1},dc:function(){this.m.cb();return!1},$b:function(a,b){this.Za=!0;this.tb=ca(this.controls,a,b,-1);return!1},hc:function(){var a="https://twitter.com/intent/tweet?hashtags=js13k&original_referer="+window.location.href+"&source=tweetbutton&text=",a=a+("I completed "+game.b.c.Db[game.S]+" in "+X(game.b.d[0].A[game.b.d[0].A.length-1])+", best lap in "+X(game.b.d[0].B)+ ". Staccato, a crooked racing game for #js13k");window.open(a.replace(/ /g,"%20"),"","");return!1}}; function P(a){if(a.Za)a.controls.ya&&(ca(a.controls,a.D,a.f,27==a.controls.ya?a.tb:a.controls.ya),a.Za=!1);else{a.D+=(a.controls.mb&&0<a.D?-1:0)+(a.controls.nb&&a.D<a.Ib-1?1:0);a.f+=(a.controls.ob&&0<a.f?-1:0)+(a.controls.kb&&a.f<a.T-1?1:0);if(a.controls.Ja){var b=a.controls.Ja-1;a.f=b%a.T;a.D=(b-a.f)/a.T}a.controls.La&&-1<a.sb&&(a.D=0,a.f=a.sb,a.R=!0);if(a.controls.Ja||a.controls.lb)a.R=a.X[a.D][a.f].call(a,a.D,a.f)}x(a.controls)} function Ca(a){this.canvas=a;this.a=a.getContext("2d");this.Da();this.a.lineJoin="bevel";this.a.lineWidth=4;this.a.textAlign="center";this.q=0;this.Vb=["1 UP","2 UP","CONTROLS","MUSIC : ","SOUND FX : "];this.Wb=["RESUME RACE","QUIT TO MENU","CONTROLS","MUSIC : ","SOUND FX : "];this.Jb=["ACCELERATE","BRAKE","STEER LEFT","STEER RIGHT","CHANGE CAMERA"];this.Nb=["RACE AGAIN","BACK TO TRACK MENU","TWEET RACE TIME"];this.message=["",""];this.Va=[0,0];this.Ob="PRESS KEY{{{{{{{{{BACKSPACE{TAB{{{KEYPAD 5{ENTER{{{SHIFT{CTRL{ALT{PAUSE{CAPS LOCK{{{{{{{{{{{{SPACE{PAGE UP{PAGE DOWN{END{HOME{LEFT ARROW{UP ARROW{RIGHT ARROW{DOWN ARROW{){*{+{,{INS{DEL{/{0{1{2{3{4{5{6{7{8{9{:{;{<{={>{?{@{A{B{C{D{E{F{G{H{I{J{K{L{M{N{O{P{Q{R{S{T{U{V{W{X{Y{Z{LEFT WINDOWS{RIGHT WINDOWS{SELECT{^{_{KEYPAD 0{KEYPAD 1{KEYPAD 2{KEYPAD 3{KEYPAD 4{KEYPAD 5{KEYPAD 6{KEYPAD 7{KEYPAD 8{KEYPAD 9{KEYPAD *{KEYPAD +{l{KEYPAD -{KEYPAD .{KEYPAD /{F1{F2{F3{F4{F5{F6{F7{F8{F9{F10{F11{F12{|{}{~{\u007f{{{{{{{{{{{{{{{{{NUM LOCK{SCROLL LOCK{{{{{{{{{{{{{{{^{!{{{${%{{{{){*{{{{{{{{{{{{{{{{;{={,{-{.{/{`{{{{{{{{{{{{{{{{{{{{{{{{{{{[{\\{]{'{{APPLE".split("{")} Ca.prototype={Da:function(){var a=window.innerWidth,b=window.innerHeight;this.canvas.height=this.a.height=b;this.canvas.width=this.a.width=a;this.a.translate(a>>1,b>>1);this.scale=0.1*Math.min(0.5*a,b)},clear:function(){this.a.clearRect(-this.a.width>>1,-this.a.height>>1,this.a.width,this.a.height)},endOffset:function(){this.a.restore()}}; function ka(a,b){for(var e=0;e<b;++e)a.Va[e]&&(a.a.strokeStyle="#000",a.a.fillStyle="#FFF",Y(a,a.message[e],(e-1)*(a.a.width>>1)+(a.a.width/b>>1),-3.5*a.scale,0.5),--a.Va[e])}function na(a,b,e){a.message[b]=e;a.Va[b]=50}function va(a,b){a.a.save();var e="#FFF";0==a.q%3&&0==(Math.floor(a.q/50)&1)&&(e="#F77");for(var c=Math.round(50+50*Math.cos(a.q/20)),d=0;3>d;++d)a.a.strokeStyle="hsl(0,0%,"+(b.f==d?c:0)+"%)",a.a.fillStyle=b.f==d?e:"#AAA",Y(a,a.Nb[d],0,(2.4+d)*a.scale,0.8);a.a.restore();++a.q} function ma(a,b,e,c,d){b=(b-1)*(a.a.width>>1)+(a.a.width/e>>1);a.a.fillStyle="#FFF";a.a.strokeStyle="#000";Y(a,"YOUR BEST LAP",b,-3.5*a.scale,0.5);Y(a,"TOTAL RACE TIME",b,-0.5*a.scale,0.5);Y(a,X(c.B),b,-2.5*a.scale,0.8);e=c.A[c.A.length-1];Y(a,X(e),b,0.5*a.scale,0.8);var h="You just drove the fastest lap on that track !";c.B>d.k&&(h="Best lap ever "+X(d.k));Y(a,h,b,-2*a.scale,0.3);h=e>d.c?"All time best "+X(d.c):"NEW TRACK RECORD !";Y(a,h,b,a.scale,0.3)} function la(a,b,e,c,d){a.a.save();a.a.translate(0,-a.a.height>>1);a.a.fillStyle="rgba(0,0,0,.5)";a.a.fillRect(-a.a.width>>1,0,a.a.width,0.5*a.scale);var h=a.a.width/b;a.a.textAlign="right";for(var g=0;g<b;++g){var l=[-0.5,0.1][g]*a.a.width,n=e[g];a.a.fillStyle="#C00";a.a.fillRect(l+h/30,a.scale/15,Math.min(n.speed,60)*h/8/60,a.scale/3);a.a.strokeRect(l+h/30,a.scale/15,h/8,a.scale/3);var m=Math.round(3.6*n.speed)+" km/h";a.a.fillStyle="#FFF";Y(a,m,l+0.12*h,a.scale/3,0.25);for(m=0;4>m;++m){var q="--:--"; n.A.length>1+m&&(q=X(n.A[m+1]-n.A[m]));Y(a,q,l+h*(m+1.5)/6,a.scale/3,0.25)}}d&&0<c&&(q=X(c),a.a.textAlign="center",Y(a,q,[l+h-2*a.scale,0][b-1],a.scale/2-2,0.5));a.a.restore()}function X(a){if(0==a)return"--:--";a*=2;var b=a%100,e=(a-b)/100%60;a=(a-b-100*e)/6E3;return(0<a?a+":":"")+(0<a&10>e?"0":"")+e+":"+(10>b?"0":"")+b} function qa(a,b){var e=a.scale*(-4-4*(-4>b?-4-b:0<b?b:0));a.a.fillStyle="#000";for(var c=0;5>c;++c)a.a.fillRect(a.scale*(2*c-4.8),e,1.6*a.scale,1.8*a.scale);for(c=0;5>c;++c)a.a.fillStyle=4>c?3<=c-b?"#F00":"#000":0<=b?"#0F0":"#000",a.a.beginPath(),a.a.arc(a.scale*(2*c-4),e+0.9*a.scale,0.6*a.scale,0,7,!1),a.a.fill()}function pa(a,b){a.a.font=Math.ceil(10*a.scale)+"px Verdana";a.a.fillStyle="#FFF";a.a.fillText("GET READY !",a.a.width*(-4.8-b),a.a.height*(b+7)/5)} function ua(a,b,e,c){a.a.save();var d="#FFF";0==a.q%3&&0==(Math.floor(a.q/50)&1)&&(d="#F77");for(var h=Math.round(50+50*Math.cos(a.q/20)),g=0;g<b.T-1;++g){a.a.fillStyle=b.f==g?d:"#AAA";a.a.strokeStyle="hsl(0,0%,"+(b.f==g?h:0)+"%)";a.a.textAlign="left";var l=9*(g+1)*a.scale/b.T-(a.a.height>>1);Y(a,e.Db[g],-0.48*a.a.width,l,0.75);a.a.textAlign="right";Y(a,X(c[g].k),0.24*a.a.width,l,0.75);Y(a,X(c[g].c),0.48*a.a.width,l,0.75)}g=b.T-1;l=9*(g+1)*a.scale/b.T-(a.a.height>>1);a.a.fillStyle=b.f==g?d:"#AAA"; a.a.strokeStyle="hsl(0,0%,"+(b.f==g?h:0)+"%)";a.a.textAlign="center";Y(a,"BACK TO MAIN",0,l,0.75);a.a.restore();++a.q} function ta(a,b,e){a.a.save();var c="#FFF";0==a.q%3&&0==(Math.floor(a.q/50)&1)&&(c="#F77");var d=Math.round(50+50*Math.cos(a.q/20));a.a.fillStyle="#AAA";a.a.strokeStyle="#000";for(var h=0;5>h;++h)Y(a,a.Jb[h],0,1.2*(h-3)*a.scale,0.6);for(h=0;2>h;++h)for(var g=0;g<6-h;++g)a.a.strokeStyle="hsl(0,0%,"+(b.f!=g||b.D!=h&&5!=g?0:d)+"%)",a.a.fillStyle=b.f!=g||b.D!=h&&5!=g?"#AAA":c,Y(a,5>g?a.Ob[1+e.h.data.keys[h][g]]:"BACK",-400+800*h+400*(5==g),1.2*(5==g?3:g-3)*a.scale,0.6);a.a.restore();++a.q} function sa(a,b,e){a.a.save();var c="#FFF";0==a.q%3&&0==(Math.floor(a.q/50)&1)&&(c="#F77");for(var d=Math.round(50+50*Math.cos(a.q/20)),h=0;5>h;++h){a.a.fillStyle=b.f==h?c:"#AAA";a.a.strokeStyle="hsl(0,0%,"+(b.f==h?d:0)+"%)";var g=e?a.Wb[h]:a.Vb[h],g=g+(3==h?b.m.ra?b.m.h.data.ja?"ON":"OFF":"not supported":""),g=g+(4==h?b.m.oa?b.m.h.data.V?"ON":"OFF":"not supported":"");Y(a,g,0,1.5*(h-2)*a.scale,0.8)}a.a.restore();++a.q}function ra(a,b){a.a.save();a.a.translate(0,a.canvas.height*b)} function Y(a,b,e,c,d){a.a.font=Math.ceil(d*a.scale)+"px Verdana";a.a.strokeText(b,e,c);a.a.fillText(b,e,c)}function Da(){this.data={V:!0,ja:!0,M:[{k:0,c:0},{k:0,c:0},{k:0,c:0},{k:0,c:0},{k:0,c:0}],keys:[[87,65,83,68,112],[38,40,37,39,122]]};var a=localStorage.getItem("StaccatoData");a&&(this.data=JSON.parse(a))}Da.prototype={cb:function(){this.data.V=!this.data.V;z(this)},na:function(){this.data.ja=!this.data.ja;z(this)}};function z(a){localStorage.setItem("StaccatoData",JSON.stringify(a.data))} function ha(a){this.G=6;this.controls=a;this.c=new Ea} ha.prototype={C:function(a,b){this.j=a;for(var e=this.c,c=[[0.2,4,10,0,2,1,0,0,6,0,-2,1,0,0,1,0,-2,1,0,0,2,1,-2,1,0,0,3,0,-2,1,0,0,1,0,2,1,0,0,2,0,2,1,0,0,6,0,-2,1,0,0,1,0,-2,1,0,0,2,-1,-2,1,0,0,2,0,-2,1,0,0,1,0,2,1,0,0,3,0],[0.3,7,8,0,0,3,0,2,1,0,0,1,0,2,1,0,0,6,0,-2,1,0,0,2,0,-2,1,0,0,2,0,0,2,1,-2,1,0,0,7,0,-2,1,0,0,1,0,-2,1,0,2,2,0,-2,2,0,0,5,0,2,1,0,0,1,0,2,1,0,0,2,-1,2,1,0,0,4,0],[0.6,5,10,2,0,1,1,-2,2,0,0,1,2,2,2,0,0,1,1,0,1,2,0,1,1,2,1,0,0,1,1,0,6,0,2,2,0,0,2,-1,0,1,0,-2,2,0,0,2,0,0,2,-1,0, 1,0,2,1,0,0,1,-1,2,1,0,0,1,0,-2,1,0,0,1,0,0,1,-1,0,3,0,-2,1,0,0,1,-1,-2,1,0,0,1,-1,-2,1,0,0,5,0,2,1,0,0,2,0,2,1,0,0,1,-1,2,1,0,0,1,-1,0,3,0,2,1,0,0,5,0,2,1,0,0,1,1,2,1,0,-2,1,0,0,1,1,2,1,0,-2,1,0,0,2,0],[0.99,9,12,2,0,1,0,-2,1,0,0,2,0,-2,1,0,0,9,0,-2,1,0,0,1,1,0,2,0,-2,1,0,0,1,-1,0,9,0,2,1,0,0,3,0,2,1,0,0,2,-1,2,1,0,0,12,0,2,1,0,0,2,1,2,1,0,0,3,0,2,1,0,0,12,0,-2,1,0,0,4,0,0,2,1,-2,1,0,0,4,0,-2,1,0,2,1,0,0,1,-2,0,4,0,2,1,0,0,1,0,2,1,0,0,1,0,-2,1,0,2,2,0,0,2,1,0,3,0,2,1,0,-2,2,0,0,1,-2,0,2,0,-2,2,0, 0,1,2,-2,1,0,0,4,0,0,2,-1,2,1,0,0,1,0,2,1,0,-2,1,0,0,1,0,2,1,0,0,1,0,2,1,0,0,5,0,2,1,0,-2,1,0,0,3,0,2,1,0,0,1,0,2,1,0,0,2,-1,2,1,0,0,12,0,2,1,0,0,2,0,2,1,0,0,3,0,0,1,1,2,1,0,0,1,0,0,1,1,0,7,0],[0.9,10,7,6,0,2,-1,0,3,0,-2,1,0,0,1,0,0,2,-1,-2,1,0,0,3,0,0,2,-1,0,2,0,-2,1,0,0,5,0,2,1,0,0,1,2,2,1,0,0,3,0,0,2,1,0,1,0,0,2,1,2,1,0,0,2,0,2,1,0,0,3,0,0,2,-1,0,3,0,-2,1,0,0,1,0,0,2,-1,-2,1,0,0,3,0,0,2,-1,0,2,0,-2,1,0,0,5,0,2,1,0,0,1,0,2,1,0,-2,1,0,2,1,0,0,1,2,2,1,0,-2,1,0,0,1,0,-2,1,0,2,1,0,0,1,2,2,1,0,-2,1, 0,0,1,0,-2,1,0,2,1,0,0,1,2,2,1,0,0,3,0,2,1,0,0,5,0,0,2,-1,0,3,0,-2,1,0,0,1,0,0,2,-1,-2,1,0,0,3,0,0,2,-1,0,2,0,-2,1,0,0,5,0,2,1,0,0,1,2,2,1,0,0,10,0,2,1,0,0,2,2,2,1,0,0,5,0,0,2,-1,0,3,0,-2,1,0,0,1,0,0,2,-1,-2,1,0,0,3,0,0,2,-1,0,2,0,-2,1,0,0,7,0,2,1,0,0,1,0,2,1,0,0,4,0,-2,1,0,2,1,0,0,1,2,2,1,0,-2,1,0,0,1,2,-2,1,0,2,1,0,0,1,2,2,1,0,-2,1,0,0,1,0,2,1,0,0,2,0,2,1,0,0,5,0]][b],d=e.r=0;256>d;++d)e.Cb[d]=e.W[d]=-1;e.l=[];var d=[1,1,0,-1,-1,-1,0,1],h=[0,1,1,1,0,-1,-1,-1],g=[[7,-1,4,-1,5,-1,6,-1],[],[0,-1,1, -1,2,-1,3,-1],[],[4,-1,5,-1,6,-1,7,-1]];e.Tb=c[0];for(var l=c[1],n=c[2],m=c[3],q=2,s=4;s<c.length;){for(var r=c[s],t=c[s+1],w=c[s+2],u=0;u<t;++u){var y=g[2+r][q];e.l.push({pa:r,dir:q,x:l,y:n,z:m,Ga:y,Fa:w,Sb:0!=r||0==u||u==t-1});e.Cb[16*n+l]=y;y=e.W[16*n+l];y=-1==y?e.r++:m<e.l[y].z?(y<<8)+e.r++:(e.r++<<8)+y;e.W[16*n+l]=y;q=q-r&7;l+=d[q];n+=h[q];m+=w}s+=3}this.va=4;this.d=[];e=this.c.l[this.c.r-1];for(c=0;c<this.G;++c)this.d.push({v:sz*(e.x+(c&1?0.7:0.3)),w:sz*(e.y+0.8-0.25*(this.G-c-1)),speed:0,n:0, o:0,K:0,heading:Math.PI/2,P:0,wb:0,Mb:0,ca:1,Na:1.8,Ya:1.8,wa:1.4,Ca:1.4,hb:1,$a:0,J:1500,vb:1500,p:Math.floor(this.c.r-1+0.8-0.25*(this.G-c-1)),k:-1,Ta:!1,xb:this.c.r-1,A:[],B:0,totalTime:0,yb:c&1?0.3:0.7,Ab:0,Bb:0,ab:0,aa:-1,sa:0,Y:0,ta:0,Ia:!1,xa:c});this.time=0<a?-350:0}}; function ya(a,b,e,c){b=a.d[b];b.Ia=0<e;var d=b.wa+b.Ca,h=b.J*(9.81*(b.Ca/d)-b.wb*b.hb/d),g=b.J*(9.81*(b.wa/d)+b.wb*b.hb/d),d=Math.sin(b.heading),l=Math.cos(b.heading),n=l*b.n+d*b.o,m=-d*b.n+l*b.o,q=Math.atan2(m+-b.Ca*b.P,Math.abs(n)),s=0.5*b.Mb,r=1-s,h=Math.min(2,Math.max(-2,-5*(Math.atan2(m+b.wa*b.P,Math.abs(n))-(0>n?-1:1)*b.K)))*h,g=Math.min(2,Math.max(-2,-5.2*q))*g,q=a.c.W[16*Math.floor(b.w/sz)+Math.floor(b.v/sz)&255]&255;255==q&&(q=0);a=a.c.l[q];var q=-0.3*a.Fa,t=0.25*Math.PI*a.dir;a=9.81*b.J* q*Math.cos(t-b.heading);var q=9.81*b.J*q*Math.sin(t-b.heading),w=q+e*s*Math.sin(b.K),t=(h+w)*b.wa-g*b.Ca;c=(-30*n-5*n*Math.abs(n)+(a+e*(r+s*Math.cos(b.K))-c*(0<n?1:-1)))/b.J;m=(-30*m-5*m*Math.abs(m)+w+Math.cos(b.K)*h+g)/b.J;b.n+=0.02*(l*c-d*m);b.o+=0.02*(d*c+l*m);b.speed=Math.sqrt(b.n*b.n+b.o*b.o);b.$a=Math.abs(150*n);1>Math.abs(b.speed)&&!e&&!a&&!q&&(b.n/=2,b.o/=2,t=0,b.P/=2);b.P+=0.02*(t/b.vb);b.heading+=0.02*b.P;b.v+=0.02*b.n;b.w+=0.02*b.o}function ga(a){this.h=a} ga.prototype={C:function(){try{var a=(new Audio("")).canPlayType("audio/wav");this.ra="probably"==a||"maybe"==a}catch(b){this.ra=!1}try{this.oa=!0,"undefined"!==typeof AudioContext?this.i=new AudioContext:"undefined"!==typeof webkitAudioContext?this.i=new webkitAudioContext:this.oa=!1}catch(e){this.oa=!1}if(this.oa){this.qb=this.i.createBuffer(1,22050,22050);for(var a=this.qb.getChannelData(0),c=0;c<a.length;++c)a[c]=c%1102/551-1;this.rb=this.i.createBuffer(1,22050,22050);a=this.rb.getChannelData(0);for(c=0;c<a.length;++c)a[c]= 551<c%1102?1:-1;this.jb=this.i.createBuffer(1,22050,22050);a=this.jb.getChannelData(0);for(c=0;c<a.length;++c)a[c]=(2*Math.random()-1)*Math.exp(-2E-5*c*c);this.zb=this.i.createBuffer(1,22050,22050);a=this.zb.getChannelData(0);for(c=0;c<a.length;++c)a[c]=(50<c%100?1:-1)*Math.exp(-4E-4*c);this.Q=[!1,!1];this.O=!1;a=this.i.createGainNode();c=this.i.createGainNode();a.gain.value=c.gain.value=0;this.ib=[a,c];var d=this.i.createGainNode(),h=this.i.createGainNode();d.gain.value=h.gain.value=0;this.bb=[d,h];var g=this.i.createBiquadFilter(),l=this.i.createBiquadFilter();g.type=l.type=0;g.frequency.value=l.frequency.value=9;this.Ma= [g,l];this.Ua=this.i.createChannelMerger(2);this.Ha=this.i.createGainNode();this.Ha.gain.value=0;d.connect(g);h.connect(l);a.connect(g);c.connect(l);g.connect(this.Ua);l.connect(this.Ua);this.Ua.connect(this.Ha);this.Ha.connect(this.i.destination);this.h.data.V&&Fa(this);}},cb:function(){this.oa&&(this.h.cb(),this.h.data.V?Fa(this):(this.ha[0].stop(0),this.ha[1].stop(0),this.ia[0].stop(0),this.ia[1].stop(0),this.ha[0].disconnect(), this.ha[1].disconnect(),this.ia[0].disconnect(),this.ia[1].disconnect()))},na:function(){this.ra&&this.h.na()}};function Aa(a,b,e,c){a.h.data.V&&(a.ib[b].gain.value=0.5+e,a.Q[b]&&(a.Q[b].stop(0),a.Q[b].disconnect()),a.Q[b]=a.i.createBufferSource(),a.Q[b].buffer=a.jb,a.Q[b].playbackRate.value=c,a.Q[b].connect(a.ib[b]),a.Q[b].start(0,0))} function za(a,b,e,c,d,h){a.h.data.V&&(a.Ha.gain.value=e?1:0,a.bb[b].gain.value=d?1:0,a.ha[b].playbackRate.value=Math.max(800,c)/1E3,a.ia[b].playbackRate.value=Math.max(400,c)/500,a.Ma[b].frequency.value=h?220:880)}function Fa(a){var b=a.i.createBufferSource(),e=a.i.createBufferSource();b.buffer=e.buffer=a.qb;b.loop=e.loop=!0;b.connect(a.Ma[0]);e.connect(a.Ma[1]);a.ha=[b,e];var c=a.i.createBufferSource(),d=a.i.createBufferSource();c.buffer=d.buffer=a.rb;c.loop=d.loop=!0;c.connect(a.bb[0]);d.connect(a.bb[1]);a.ia=[c,d];b.start(0,0);e.start(0,0);c.start(0,0);d.start(0,0)} function Ea(){this.Cb=Array(256);this.W=Array(256);this.ea=0.1;this.Db=["Training Grounds","Indefinite Loop","Winding Heights","Gordian Knot Interchange","Maelstrom Speedway"]}Ea.prototype={};function Q(a,b,e,c){var d=Math.PI*(b&3)/2,h=Math.cos(d),g=Math.sin(d),l=0.5+h*(e-0.5)+g*(c-0.5);e=0.5-g*(e-0.5)+h*(c-0.5);h=0;c=!1;switch(b>>2){case 0:c=e<a.ea||e>1-a.ea;h=Math.PI*(e<a.ea?0.5:1.5);break;case 1:b=Math.sqrt(l*l+e*e),c=b<a.ea||b>1-a.ea,h=Math.atan2(e,l)+(b<a.ea?0:Math.PI)}return{Wa:c,pa:h+d}} function Ba(a,b,e,c){if(0>c||c>=a.r)return-1;a=a.l[c];return a.z+a.Fa*[b-a.x,0,e-a.y,0,a.x+1-b,0,a.y+1-e][a.dir&7]}function Ga(a,b){gl=a.getContext("experimental-webgl");this.canvas=a;this.s=b;this.fa=2;this.time=0;this.Ka=[0,0];this.Da()} Ga.prototype={C:function(){gl.clearColor(0.6,0.8,1,1);gl.clearDepth(1);gl.enable(gl.DEPTH_TEST);gl.depthFunc(gl.LEQUAL);gl.shaderSource(v=gl.createShader(gl.VERTEX_SHADER),"attribute vec3 a;attribute vec2 t;attribute vec3 n;uniform mat4 mX,mP;varying vec2 vT;varying vec4 vP;varying vec3 vN;void main(){vN=(mX*vec4(n,0.)).rgb,vP=mX*vec4(a,1.),gl_Position=mP*vP,vT=t;}");gl.compileShader(v);gl.shaderSource(f=gl.createShader(gl.FRAGMENT_SHADER),"#ifdef GL_ES \nprecision lowp float;\n#endif\nvarying vec2 vT;varying vec3 vN;varying vec4 vP;uniform sampler2D uZ;uniform vec4 uE,uC;void main(){vec3 v=normalize(vN);if(uC.a==.5){vec2 u=3000.*(vT.rg-vec2(.625,.875));float r=0.;for(float f=0.;f<6.28;f+=.7)r+=cos(sin(f*2.3)*2.7+cos(f)*u.r+sin(f)*u.g+uE.a*.1-length(u));v=normalize(vec3(.3+.1*r,0.,1.-r));}vec4 u=texture2D(uZ,vec2(vT.r,vT.g));u=mix(vec4(uC.rgb,1.),u,u.a);vec3 f=vec3(1.,0.,0.),r=normalize(f+normalize(uE.rgb-vP.rgb));float S=.7+dot(v,f),g=pow(max(0.,dot(r,v)),2.);gl_FragColor=vec4(uC.a*g+S*u.rgb,u.a);}"); gl.compileShader(f);gl.attachShader(this.e=gl.createProgram(),v);gl.attachShader(this.e,f);gl.linkProgram(this.e);gl.useProgram(this.e);gl.enableVertexAttribArray(p=gl.getAttribLocation(this.e,"a"));gl.enableVertexAttribArray(gl.getAttribLocation(this.e,"t"));gl.enableVertexAttribArray(gl.getAttribLocation(this.e,"n"));gl.bindBuffer(gl.ARRAY_BUFFER,this.Fb=gl.createBuffer());for(var a=new Float32Array(198),b=0;198>b;++b)a[b]=[-2,-1,0.1][b%3]+[4,2,1.1][b%3]*("77s5CsLCsLSs5Ss7_sH7sc;Vc[VH_s\\#V\\sVp%@s4@r1*re*sb@pq@n%*nq*l'Rp4SpbSloR5#V5sV.#V.sV##*''9'#*'s*'o9#s*k%9kq9i#Dc#DcsDisD`'5`#*3#*3s*`s*`o53'53o5l#*ls*0#D0sD#&V#pV#;V#[V*#D*sD#'@#o@#;@#[@s1#n%#nq#se#".charCodeAt(b)- 35)/80;gl.bufferData(gl.ARRAY_BUFFER,a,gl.STATIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,this.Hb=gl.createBuffer());a=[];for(b=0;66>b;++b){var e="UVNOWXMFGPDI46./793:<>?ATY\\amckrjp;B;CJBCCSZJJSZ;B[b\\a^_[behfg&3:'".charCodeAt(b)-35;a.push((e&7)/32,(e>>3)/40)}gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(a),gl.STATIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,this.Gb=gl.createBuffer());a=[];for(b=0;132>b;++b){var e=("j5m%pGoNmrjaj;mGnOj[Z8Z^N?PHPHLNSNNWN?NWY<gHhOYZT8T^U6U`Q*N6X7X_N`SiN9N]S:O7O_S\\P6\\7\\7\\_\\_P`J8J^N;N[I8I^X0XfZ#T#I5IaL*LlK#K#UFM?MWWO".charCodeAt(2* b)-35)*Math.PI/80,c=-Math.PI+("j5m%pGoNmrjaj;mGnOj[Z8Z^N?PHPHLNSNNWN?NWY<gHhOYZT8T^U6U`Q*N6X7X_N`SiN9N]S:O7O_S\\P6\\7\\7\\_\\_P`J8J^N;N[I8I^X0XfZ#T#I5IaL*LlK#K#UFM?MWWO".charCodeAt(2*b+1)-35)*Math.PI/40;a.push(Math.sin(e)*Math.cos(c),Math.sin(e)*Math.sin(c),Math.cos(e))}gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(a),gl.STATIC_DRAW);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.Eb=gl.createBuffer());a=[];for(b=0;300>b;++b)a.push("#$%&'()%*+&,)*-.+,/012345/12467809:3)-;<.,#);<,(#%),&(=#;<(>?@ABCD5E/4F6-879.:GH7:IJ-7HI:.KLMNOP-Q;<R.-*8+.9-HKPI.-KQRP.KMQRNP5SEFT670/3:47/E4:F7EGJF:QU;<VR#W$'X(WY$'ZX#=WX>(U=;<>V[=UV>\\W]YZ^X?]@C^D]W@CX^]?_`D^]_YZ`^W=[\\>XW[@C\\X5abcd651ad265bSTc6'&%$'%*%&*&+8+98*+89383003202112d1daY'$YZ'Y_ZZ_`?`_?D`".charCodeAt(b)- 35);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(a),gl.STATIC_DRAW);a=new Float32Array(78);for(b=0;26>b;++b)a[3*b]=0.3*Math.cos(Math.PI*b/6),a[3*b+1]=b&1?-0.1:0.1,a[3*b+2]=0.3+0.3*Math.sin(Math.PI*b/6);gl.bindBuffer(gl.ARRAY_BUFFER,this.bc=gl.createBuffer());gl.bufferData(gl.ARRAY_BUFFER,a,gl.STATIC_DRAW);a=new Float32Array(42);a[0]=0;a[1]=0.1;a[2]=0.3;for(b=0;13>b;++b)a[3*b+3]=0.3*Math.cos(Math.PI*b/6),a[3*b+4]=0.1,a[3*b+5]=0.3+0.3*Math.sin(Math.PI*b/6);gl.bindBuffer(gl.ARRAY_BUFFER,this.ac= gl.createBuffer());gl.bufferData(gl.ARRAY_BUFFER,a,gl.STATIC_DRAW);a=new Float32Array(52);for(b=0;26>b;++b)a[2*b]=0.8,a[2*b+1]=0.6;gl.bindBuffer(gl.ARRAY_BUFFER,this.cc=gl.createBuffer());gl.bufferData(gl.ARRAY_BUFFER,a,gl.STATIC_DRAW);b=new Float32Array(6E4);for(a=0;2E4>a;++a)b[3*a]=0,b[3*a+1]=0,b[3*a+2]=1;gl.bindBuffer(gl.ARRAY_BUFFER,this.pb=gl.createBuffer());gl.bufferData(gl.ARRAY_BUFFER,b,gl.STATIC_DRAW)},Da:function(){var a=window.innerWidth,b=window.innerHeight;this.canvas.height=gl.height= b;this.canvas.width=gl.width=a;this.za=1==this.fa?a:(a>>1)-1;this.Xa=b}}; function Ha(a,b){var e=128,c=128,d=-20,h=++a.time/100,g=0.6,l=-150,n=400;1!=a.s.state&&(d=a.s.b.d[b],e=a.Ka[b],n=[40,40,3,7,7,2][e],g=[0,0,1.35,1.05,0.85,1.45][e],l=[0,0,-9,-11,-40,0][e],h=1==e?0:d.heading-Math.PI/2,e=d.v,c=d.w,d=n+Ba(a.s.b.c,e/16,c/16,d.p),n=200);var m=-e,q=-c,s=-d,r=a.za/a.Xa,t=2*Math.tan(60*Math.PI/360),w=Math.cos(h),u=Math.sin(h),y=Math.cos(g),E=Math.sin(g),r=4/(t*r- -t*r),t=4/(t- -t),G=-(n+2)/(n-2);gl.uniformMatrix4fv(gl.getUniformLocation(a.e,"mP"),!1,new Float32Array([r*w, -y*t*u,E*u*G,-E*u,r*u,t*w*y,-G*E*w,E*w,0,E*t,G*y,-y,m*r*w+q*r*u,-m*y*t*u+q*t*w*y+s*E*t,m*E*u*G-q*G*E*w+s*G*y+l*G+-4*n/(n-2),-m*E*u+q*E*w-s*y-l]));gl.activeTexture(gl.TEXTURE0);gl.uniform1i(gl.getUniformLocation(a.e,"uZ"),0);gl.uniform4f(gl.getUniformLocation(a.e,"uE"),e+l*Math.sin(g)*Math.sin(h),c+l*Math.sin(g)*Math.cos(h),d-l*Math.cos(g),a.time);gl.uniformMatrix4fv(gl.getUniformLocation(a.e,"mX"),!1,new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]));gl.bindBuffer(gl.ARRAY_BUFFER,a.ec);gl.vertexAttribPointer(p, 3,gl.FLOAT,!1,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,a.fc);gl.vertexAttribPointer(gl.getAttribLocation(a.e,"n"),3,gl.FLOAT,!1,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,a.gc);gl.vertexAttribPointer(gl.getAttribLocation(a.e,"t"),2,gl.FLOAT,!1,0,0);gl.uniform4f(gl.getUniformLocation(a.e,"uC"),0.1,0.2,0.2,0.4);gl.drawArrays(gl.TRIANGLES,0,a.eb.length/3);gl.bindBuffer(gl.ARRAY_BUFFER,a.Xb);gl.vertexAttribPointer(p,3,gl.FLOAT,!1,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,a.Yb);gl.vertexAttribPointer(gl.getAttribLocation(a.e, "n"),3,gl.FLOAT,!1,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,a.Zb);gl.vertexAttribPointer(gl.getAttribLocation(a.e,"t"),2,gl.FLOAT,!1,0,0);gl.uniform4f(gl.getUniformLocation(a.e,"uC"),0.7,0.7,0.7,0.6);gl.drawArrays(gl.TRIANGLES,0,a.la.length/3);gl.bindBuffer(gl.ARRAY_BUFFER,a.Pb);gl.vertexAttribPointer(p,3,gl.FLOAT,!1,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,a.Rb);gl.vertexAttribPointer(gl.getAttribLocation(a.e,"t"),2,gl.FLOAT,!1,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,a.Qb);gl.vertexAttribPointer(gl.getAttribLocation(a.e, "n"),3,gl.FLOAT,!1,0,0);gl.uniform4f(gl.getUniformLocation(a.e,"uC"),0,0,0,0);for(g=0;256>g;++g)gl.drawArrays(gl.TRIANGLE_STRIP,514*g,514);gl.bindBuffer(gl.ARRAY_BUFFER,a.ic);gl.vertexAttribPointer(p,3,gl.FLOAT,!1,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,a.jc);gl.vertexAttribPointer(gl.getAttribLocation(a.e,"t"),2,gl.FLOAT,!1,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,a.pb);gl.vertexAttribPointer(gl.getAttribLocation(a.e,"n"),3,gl.FLOAT,!1,0,0);gl.uniform4f(gl.getUniformLocation(a.e,"uC"),0,0.06,0.2,0.5);gl.drawArrays(gl.TRIANGLE_STRIP, 0,4);if(1!=a.s.state)for(g=0;g<a.s.b.G;++g)gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,a.Eb),gl.bindBuffer(gl.ARRAY_BUFFER,a.Fb),gl.vertexAttribPointer(p,3,gl.FLOAT,!1,0,0),l=Math.min(g,2),gl.uniform4f(gl.getUniformLocation(a.e,"uC"),[0.5,0,1][l],[0,0,1][l],[0,1,0][l],0.55),gl.bindBuffer(gl.ARRAY_BUFFER,a.Hb),gl.vertexAttribPointer(gl.getAttribLocation(a.e,"t"),2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,a.Gb),gl.vertexAttribPointer(gl.getAttribLocation(a.e,"n"),3,gl.FLOAT,!1,0,0),l=a.s.b.d[g].v,e= a.s.b.d[g].w,m=l/sz,q=e/sz,c=0.1+Ba(a.s.b.c,m,q,a.s.b.d[g].p),h=-a.s.b.d[g].heading,d=Math.cos(h),n=Math.sin(h),m=a.s.b.c.W[16*Math.floor(q)+Math.floor(m)&255]&255,255==m&&(m=0),m=a.s.b.c.l[m],q=Math.atan(m.Fa/16),s=0.25*Math.PI*m.dir,m=-Math.sin(s)*q,q*=Math.cos(s),s=Math.cos(m),w=Math.sin(m),u=Math.cos(q),y=Math.sin(q),gl.uniformMatrix4fv(gl.getUniformLocation(a.e,"mX"),!1,new Float32Array([d*u-n*w*y,-n*s,d*y+n*w*u,0,n*u+d*w*y,d*s,n*y-d*w*u,0,-s*y,w,s*u,0,l,e,c,1])),gl.drawElements(gl.TRIANGLES, 300,gl.UNSIGNED_SHORT,0),gl.bindBuffer(gl.ARRAY_BUFFER,a.pb),gl.vertexAttribPointer(gl.getAttribLocation(a.e,"n"),3,gl.FLOAT,!1,0,0),gl.uniform4f(gl.getUniformLocation(a.e,"uC"),0,0,0,0),Z(a,l,e,c,-h,1.4,0.95,m,q,Math.PI+a.s.b.d[g].K),Z(a,l,e,c,-h,1.4,-0.95,m,q,a.s.b.d[g].K),Z(a,l,e,c,-h,-1.4,0.95,m,q,Math.PI),Z(a,l,e,c,-h,-1.4,-0.95,m,q,0)} function Z(a,b,e,c,d,h,g,l,n,m){var q=Math.cos(d),s=Math.sin(d);b=b+q*h+s*g;e=e+s*h-q*g;q=Math.cos(d+m);s=-Math.sin(d+m);d=Math.cos(l);l=Math.sin(l);m=Math.cos(n);n=Math.sin(n);gl.uniformMatrix4fv(gl.getUniformLocation(a.e,"mX"),!1,new Float32Array([q*m-s*l*n,-s*d,q*n+s*l*m,0,s*m+q*l*n,q*d,s*n-q*l*m,0,-d*n,l,d*m,0,b,e,c,1]));gl.bindBuffer(gl.ARRAY_BUFFER,a.bc);gl.vertexAttribPointer(p,3,gl.FLOAT,!1,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,a.cc);gl.vertexAttribPointer(gl.getAttribLocation(a.e,"t"),2,gl.FLOAT, !1,0,0);gl.drawArrays(gl.TRIANGLE_STRIP,0,26);gl.bindBuffer(gl.ARRAY_BUFFER,a.ac);gl.vertexAttribPointer(p,3,gl.FLOAT,!1,0,0);gl.drawArrays(gl.TRIANGLE_FAN,0,14)}function wa(a){gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT);gl.viewport(0,0,a.za,a.Xa);Ha(a,0);1<a.fa&&(gl.viewport(a.za+2,0,a.za,a.Xa),Ha(a,1))} function T(a,b,e,c,d,h,g,l,n,m,q,s){var r=sz*(b+0.5+m*(c-0.5)-q*(d-0.5));c=sz*(e+0.5+q*(c-0.5)+m*(d-0.5));b=sz*(b+0.5+m*(g-0.5)-q*(l-0.5));e=sz*(e+0.5+q*(g-0.5)+m*(l-0.5));d=e-c;var t=b-r;g=t?-d:1;l=t;var w=g*g+l*l;m=-l*(n-h);q=g*(n-h);d=g*d-l*t;g/=Math.sqrt(w);l/=Math.sqrt(w);w=Math.sqrt(m*m+q*q+d*d);m/=w;q/=w;d/=w;for(w=0;8>w;++w){var t=2*Math.PI*w/8,u=t+Math.PI/4;a.la.push(r+s*(g*Math.cos(t)+m*Math.sin(t)),c+s*(l*Math.cos(t)+q*Math.sin(t)),h+s*d*Math.sin(t),r+s*(g*Math.cos(u)+m*Math.sin(u)),c+ s*(l*Math.cos(u)+q*Math.sin(u)),h+s*d*Math.sin(u),b+s*(g*Math.cos(t)+m*Math.sin(t)),e+s*(l*Math.cos(t)+q*Math.sin(t)),n+s*d*Math.sin(t),b+s*(g*Math.cos(t)+m*Math.sin(t)),e+s*(l*Math.cos(t)+q*Math.sin(t)),n+s*d*Math.sin(t),r+s*(g*Math.cos(u)+m*Math.sin(u)),c+s*(l*Math.cos(u)+q*Math.sin(u)),h+s*d*Math.sin(u),b+s*(g*Math.cos(u)+m*Math.sin(u)),e+s*(l*Math.cos(u)+q*Math.sin(u)),n+s*d*Math.sin(u));a.Ba.push(0.01,0.74,0.03,0.74,0.01,0.54,0.01,0.74,0.03,0.74,0.01,0.54);a.Aa.push(g*Math.cos(t)+m*Math.sin(t), l*Math.cos(t)+q*Math.sin(t),d*Math.sin(t),g*Math.cos(u)+m*Math.sin(u),l*Math.cos(u)+q*Math.sin(u),d*Math.sin(u),g*Math.cos(t)+m*Math.sin(t),l*Math.cos(t)+q*Math.sin(t),d*Math.sin(t),g*Math.cos(t)+m*Math.sin(t),l*Math.cos(t)+q*Math.sin(t),d*Math.sin(t),g*Math.cos(u)+m*Math.sin(u),l*Math.cos(u)+q*Math.sin(u),d*Math.sin(u),g*Math.cos(u)+m*Math.sin(u),l*Math.cos(u)+q*Math.sin(u),d*Math.sin(u))}} function R(a,b,e,c,d,h,g,l,n,m){T(a,b,e,c,d,h,c,d,h+n,g,l,m);b=sz*(b+0.5+g*(c-0.5)-l*(d-0.5));e=sz*(e+0.5+l*(c-0.5)+g*(d-0.5));for(c=0;8>c;++c)d=2*Math.PI*c/8,g=d+Math.PI/4,a.la.push(b+m*Math.cos(d),e+m*Math.sin(d),h+n,b+m*Math.cos(g),e+m*Math.sin(g),h+n,b,e,h+n+0.1),a.Ba.push(0.01,0.74,0.03,0.74,0.01,0.54),a.Aa.push(0.7*Math.cos(d),0.7*Math.sin(d),0.7,0.7*Math.cos(g),0.7*Math.sin(g),0.7,0.7*Math.cos(d),0.7*Math.sin(d),0.7)} function S(a,b,e,c,d,h,g,l){a.eb.push(sz*(b+0.5+h*(c-0.5)-g*(d-0.5)),sz*(e+0.5+g*(c-0.5)+h*(d-0.5)),l)} function W(a,b,e,c,d){var h=V(a,b,e),g=V(a,b+c,e),l=V(a,b,e+c),n=V(a,b+c,e+c);c>>=1;var m=V(a,b+c,e);99==m&&U(a,b+c,e,m=0.5*(h+g)+d*($(a)-0.5));var q=V(a,b,e+c);99==q&&U(a,b,e+c,q=0.5*(h+l)+d*($(a)-0.5));h=V(a,b+2*c,e+c);99==h&&U(a,b+2*c,e+c,h=0.5*(g+n)+d*($(a)-0.5));g=V(a,b+c,e+2*c);99==g&&U(a,b+c,e+2*c,g=0.5*(l+n)+d*($(a)-0.5));99==V(a,b+c,e+c)&&U(a,b+c,e+c,0.25*(m+q+h+g)+d*($(a)-0.5));1<c&&(d*=0.6,W(a,b,e,c,d),W(a,b+c,e,c,d),W(a,b,e+c,c,d),W(a,b+c,e+c,c,d))} function $(a){a.Ea=3.9*a.Ea*(1-a.Ea);return a.Ea}function U(a,b,e,c){a.Sa[(e&255)*a.L+(b&255)]=c}function V(a,b,e){return a.Sa[(e&255)*a.L+(b&255)]}function oa(a,b){a.Ka[b]=(a.Ka[b]+1)%6} function Ia(){var a=document.createElement("canvas");a.width=a.height=512;for(var b=a.getContext("2d"),e=0;8>e;++e)for(var c=0;3>c;++c)b.fillStyle=c+e&1?"#FFF":"#000",b.fillRect(25+16*c,256+16*e,16,16);b.fillStyle="#666";b.fillRect(16,51,80,13);b.fillRect(16,77,80,12);b.fillRect(16,51,16,38);b.fillRect(80,51,16,38);b.fillRect(16,24,32,9);b.fillRect(64,24,32,9);b.fillStyle="#300";b.beginPath();b.fillRect(25,92,9,9);b.fillRect(36,92,7,9);b.fillRect(69,92,7,9);b.fillRect(78,92,9,9);b.fill();e=b.createLinearGradient(128, 384,128,511);e.addColorStop(0,"#753");e.addColorStop(0.08,"#531");e.addColorStop(0.16,"#040");e.addColorStop(1,"#564");b.fillStyle=e;b.fillRect(128,384,128,127);gl.bindTexture(gl.TEXTURE_2D,gl.createTexture());gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,a);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST)} window.onload=function(){controls=new aa(new Da);document.onkeydown=function(a){return!ba(a,!0)};document.onkeyup=function(a){return!ba(a,!1)};sz=16;game=new fa(controls);game.m.C();var a=new Ga(document.getElementById("c"),game),b=new Ca(document.getElementById("g"));a.C();Ia();ia(a,b);xa()};</script></body></html>