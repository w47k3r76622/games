<!doctype html><html lang=en><meta charset=utf-8><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"name=viewport><title>.</title><style>*{margin:0;padding:0}canvas{position:absolute;left:0px;top:0px;overflow:hidden;display:block;image-rendering:optimizeSpeed;image-rendering:-moz-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:-o-crisp-edges;image-rendering:pixelated;-ms-interpolation-mode:nearest-neighbor;width:800px;height:444px}svg{transform:scale(6);transform-origin:left;position:absolute;margin-top:60px;display:none}svg#btn{left:70%}</style><body><svg style="z-index: 3" height=40 id=arw width=40><g style=fill:#fff;stroke:#87ceeb;stroke-width:.5;opacity:.2 transform="translate(0 20) rotate(-45)"><rect height=11.25 id=up rx=1.8 ry=1.8 width=11.25 x=11.25 y=4.5 /><rect height=11.25 id=right rx=1.8 ry=1.8 width=11.25 x=11.25 y=15.76 /><rect height=11.25 id=down rx=1.8 ry=1.8 width=11.25 x=0 y=15.76 /><rect height=11.25 id=left rx=1.8 ry=1.8 width=11.25 x=0 y=4.5 /></g></svg> <svg style="z-index: 3" height=40 id=btn width=27><g style=fill:#fff;stroke:#87ceeb;stroke-width:.5;opacity:.2 transform="translate(0 20) rotate(-45)"><rect height=11.25 id=a rx=1.8 ry=1.8 width=11.25 x=11.25 y=4.5 /><rect height=11.25 id=b rx=1.8 ry=1.8 width=11.25 x=0 y=15.76 /></g></svg><canvas style="z-index: 1" height=100 id=c width=180></canvas><canvas style="z-index: 2" height=100 id=u width=180></canvas><script type=text/javascript>!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=5)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.emptyCmd=function(){return[null,null]},t.run=function(e,t){if(null==e[0]&&null==e[1]);else{var r=e[0],n=e[1];r(),null!=n&&t(n)}},t.create=function(e,t){return[e,t]}},function(e,t,r){"use strict";function n(e,t){return[e,t]}function o(e,t){e[0];return(0,e[1])(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.create=n,t.run=o,t.sampleOn=function(e,t,r){var a=e[0],i=(e[1],t[0]);return t[1],n(a+"|"+i,function(n){var a=r,i=o(t,function(e){return a=e}),u=o(e,function(e){n(a==r?e:a),a=r});return function(){u(),i()}})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.partition=function(e,t){var r=[],n=[];return t.forEach(function(t){e(t)?r.push(t):n.push(t)}),[r,n]},t.isEnemy=function(e){return"vending"==e[8]||"drone"==e[8]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=document.getElementById("u").getContext("2d"),o=new Image;o.src="atlas.png",n.font="8px Verdana";performance.now();function a(e,t){n.canvas.style.width=window.innerWidth+"px",n.canvas.style.height=window.innerHeight+"px",n.fillStyle="#000000",n.clearRect(0,0,180,100),n.fillRect(0,0,180,100),n.font="8px Verdana",n.fillStyle="#54ed25",n.font="8px Verdana",function(e,t){var r=0==Math.floor(.1*performance.now()%2)?"|":"";if(performance.now()>e)return void i(n,t+""+r,8,15,170,10);for(var o=Math.floor(.01*performance.now()%t.length+1),a="",u=0;u<o;u++)a+=t.charAt(u);i(n,a+" "+r,8,15,170,10)}(t,e),n.fillStyle="#ffffff"}function i(e,t,r,n,o,a){for(var i=t.split(" "),u="",c=0;c<i.length;c++){var f=u+i[c]+" ";e.measureText(f).width>o&&c>0?(e.fillText(u,r,n),u=i[c]+" ",n+=a):u=f}e.fillText(u,r,n)}n.fillStyle="#ffffff",t.renderUi=function(e){n.clearRect(0,0,180,100),n.canvas.style.width=window.innerWidth+"px",n.canvas.style.height=window.innerHeight+"px";var t=e[1].filter(function(e){return"player"==e[8]})[0];n.fillText(t[11].toString(),15,10),n.drawImage(o,10,0,10,8,3,3,10,8),function(e){for(var t=0,r=0;r<e.length;r++)"key"==e[r][1]&&t++;n.fillText(t.toString(),35,10),n.drawImage(o,20,0,13,5,42,4,13,5)}(e[5]),function(e){for(var t=0,r=0,a=0;a<e.length;a++)"server"==e[a][8]&&(t++,r=e[a][11]<0?r+1:r);n.fillText(r+"/"+t,60,10),n.drawImage(o,33,0,9,10,75,3,9,10)}(e[1]),e[7].length>0&&a(e[7],performance.now()+2e3)},t.showMessage=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);function o(e,t,r,n){return Math.floor(t/r)*n+Math.floor(e/r)}function a(e,t,r,n){return[[e,t],[e+r,t],[e+r,t+n],[e,t+n]]}function i(e){return["x","d","_","0"].indexOf(e)<0}function u(e,t){return e[0]<t[0]+t[2]&&e[0]+e[2]>t[0]&&e[1]<t[1]+t[3]&&e[1]+e[3]>t[1]}t.gtn=o,t.gab=a,t.moveBody=function(e,t,r,c,f,s,l){e[7];var d=e[0],v=e[1],_=e[2],h=e[3],g=e[4],m=e[5],p=e[6],x=(e[7],e[8]),w=e[9],y=e[10],A=e[11],E=a(Math.floor(d),Math.floor(v),_,h),T=E[0],b=T[0],R=T[1],k=E[1],S=k[0],M=k[1],F=E[2],C=F[0],B=F[1],D=E[3],P=D[0],G=D[1],O=o(C,B,f,s),U=o(P,G,f,s),I=o(S,M,f,s),q=o(b,R,f,s),L=v,j=d,X=!0,N=y,z=p,W=g,Y=h,H=m,V=n.emptyCmd(),J=!0,K=!0,Q=!0,Z=!0,$=A,ee=function(e){return"vending"==e||"drone"==e};if(a(d,v,e[2],e[3]).map(function(e){return o(e[0],e[1],f,s)}).map(function(e){return l[e]}).forEach(function(n){n&&n.filter(function(e){return e[9]!=w}).forEach(function(n){var o=n[0],a=n[1],i=n[2],c=n[3],f=n[8],s=v+h-4<a,l=t>d&&o<d,_=t<d&&o>d;u([d,v,e[2],e[3]],[o,a,i,c])&&(function(e){return!("key"==e||"hammer"==e||"server"==e||"door"==e)}(f)&&(J=!(r<v)||s,K=!(r>v)||ee(x),Q=!(t>d)||s||l,Z=!(t<d)||s||_,"player"==f&&a+c-2<v&&ee(x)?$=5e3:"player"==f&&ee(x)&&1==n[10]?$=1e3:"player"==x&&ee(f)&&1==e[10]&&n[11],"player"==x&&ee(f)&&a>v+h-2&&n[11],ee(f)&&"player"==x&&0==n[11]&&(0==e[10]&&($-=1),j=n[0]>d?d-5:d+5)),"player"!=f||"key"!=x&&"hammer"!=x||(j=-1e4),"player"==f&&"server"==x&&1==n[10]&&$>-1&&($-=1,L=v-.5))})}),t>d){var te=o(C,B-5,f,s);i(c.charAt(I))&&i(c.charAt(te))&&Q&&(j=t)}else if(t<d){var re=o(P,G-5,f,s);i(c.charAt(q))&&i(c.charAt(re))&&Z&&(j=t)}return r>v&&i(c.charAt(U))&&i(c.charAt(O))&&K?(X=!1,L=r):r<v&&i(c.charAt(q))&&i(c.charAt(I))&&J&&(X=!1,L=r),r>v&&!i(c.charAt(U))&&!i(c.charAt(O))&&e[7],"vending"!=x&&"drone"!=x||0!=$||("r"==p?j>=y&&(N=j-100,z="l",W=-1*g):j<=y&&(N=j+100,z="r",W=-1*g)),[[j,L,_,Y,W,H,z,X,x,w,N,$],V]},t.collide=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),o=r(0),a=r(6),i=r(7),u=r(13),c=r(2),f=r(4),s=r(14),l=r(3),d=n.create("c1",function(e){var t=0,r=0,n=function(o){var a=o-r;e({kind:"t",delta:a=a>17?16:a}),r=o,t=requestAnimationFrame(n)};return t=requestAnimationFrame(n),function(){return cancelAnimationFrame(t)}}),v=n.create("t1",function(e){var t=function(t){switch(t.currentTarget.id){case"a":e({kind:"up",delta:16});break;case"b":e({kind:"attkp",delta:16});break;case"left":e({kind:"lp",delta:16});break;case"right":e({kind:"rp",delta:16});break;case"up":e({kind:"use",delta:16})}},r=function(t){switch(t.currentTarget.id){case"b":e({kind:"attkr",delta:16});break;case"left":e({kind:"lr",delta:16});break;case"right":e({kind:"rr",delta:16})}},n=document.querySelectorAll("rect"),o={passive:!0};return n.forEach(function(e){e.addEventListener("touchstart",t,o),e.addEventListener("touchend",r,o)}),function(){n.forEach(function(e){e.removeEventListener("touchstart",t,o),e.removeEventListener("touchend",r,o)})}}),_=n.create("p1",function(e){var t=function(t){switch(t.keyCode){case 37:e({kind:"lp",delta:16});break;case 39:e({kind:"rp",delta:16});break;case 38:e({kind:"up",delta:16});break;case 13:e({kind:"use",delta:16});break;case 32:e({kind:"attkp",delta:16})}};return window.addEventListener("keydown",t,!0),function(){return window.removeEventListener("keydown",t,!0)}}),h=n.create("r1",function(e){var t=function(t){switch(t.keyCode){case 37:e({kind:"lr",delta:16});break;case 39:e({kind:"rr",delta:16});break;case 32:e({kind:"attkr",delta:16})}};return window.addEventListener("keyup",t,!0),function(){return window.removeEventListener("keyup",t,!0)}}),g=function(e){return e[1].forEach(function(e){"player"==e[8]&&(e[4]=0,e[10]=0)}),e},m=function(e,t){var r=function(e,t){var r=o.emptyCmd(),n=u.insertInCells(e,new Array(e[4].length),20,50),a=n[0],i=n[1],c=n[2],s=n[3],l=n[4],d=n[5],v=n[6],_=n[7],h=i.filter(function(e){return"player"==e[8]})[0],g=s[0],m=i.map(function(e){var n=e[0],o=e[1],a=(e[2],e[3],e[4]),i=e[5],u=(e[6],e[7],e[8],e[9],e[10],e[11],"drone"==e[8]&&0==e[11]?0:i),s=f.moveBody(e,n+a*t,o+u*t,l,20,50,c),d=s[0],v=s[1];return r=v,d[5]=Math.min(i+g,g),d}),p=a[2]/7;h[0]<a[0]+2*p?a=u.moveCamera(a,a[0]-.075*t,a[1],1e3,1e3):h[0]>a[0]+a[2]-4*p&&(a=u.moveCamera(a,a[0]+.075*t,a[1],1e3,1e3));var x=a[3]/5;return h[1]-(a[1]+x)<70?a=u.moveCamera(a,a[0],a[1]-.075*t,1e3,1e3):h[1]-(a[1]+x)>70&&(a=u.moveCamera(a,a[0],a[1]+.075*t,1e3,1e3)),[[a,m,c,s,l,d,v,_],r]}(e,t),n=r[0],a=r[1];return[y(w(function(e){var t=e[5].map(function(e){return e[0]})||[];return e[1].filter(function(e){return e[0]<-1&&("key"==e[8]||"hammer"==e[8])}).forEach(function(r){if(t.indexOf(r[9])<0){var n="key"==r[8]?"key":"hammer";e[5].push([r[9],n])}}),e}(n)),t),a]};t.update=function(e,t){switch(e.kind){case"t":return m(t,e.delta);case"up":return[function(e){var t=e[1],r=e[3][2];return t.forEach(function(e){"player"==e[8]&&e[7]&&(e[5]=r,e[7]=!1)}),e}(t),o.emptyCmd()];case"lp":return[function(e){var t=e[1],r=e[3][1];return t.forEach(function(e){"player"==e[8]&&(e[4]=-r,e[6]="l")}),e}(t),o.emptyCmd()];case"rp":return[function(e){var t=e[1],r=e[3][1];return t.forEach(function(e){"player"==e[8]&&(e[4]=r,e[6]="r")}),e}(t),o.emptyCmd()];case"lr":case"rr":return[g(t),o.emptyCmd()];case"use":return[u.openUse(t),o.emptyCmd()];case"attkp":return[x(t),o.emptyCmd()];case"attkr":return[g(t),o.emptyCmd()]}};var p=function(e){for(var t=!1,r=0;r<e.length;r++)"hammer"==e[r][1]&&(t=!0);return t},x=function(e){for(var t=0;t<e[1].length;t++)"player"==e[1][t][8]&&p(e[5])&&(e[1][t][10]=1);return e[6]=e[6]-e[6],e},w=function(e){e[1].filter(function(e){return"player"==e[8]})[0][11]<0&&(e[7]="Game Over!");for(var t=0,r=0,n=0;n<e[1].length;n++)"server"==e[1][n][8]&&(t++,r=e[1][n][11]<0?r+1:r);return t==r&&(e[7]="You won! they are offline."),e},y=function(e,t){return e[1].forEach(function(e){c.isEnemy(e)&&(e[11]=Math.max(0,e[11]-t),e[11]<100&&0!=e[11]?(e[1]=e[1]-5,e[3]=21,e[4]="r"==e[6]?.03:-.03):e[11]>100&&(e[4]=0,e[3]=13))}),e};t.render=function(e){return function(e){performance.now()>e[6]+2e3?i.render(e,e[4],20,50):l.showMessage("Use arrows + space + enter in desktop, virtual gamepad in mobile. and smash all datacenters",e[6])}},t.subs=function(e){return[d,_,h,v]},t.initStateCmd=[u.initState,o.create(function(){/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&document.querySelectorAll("svg").forEach(function(e){e.style.display="block"});s.playSound()},null)],a.runGame(t.update,t.render,t.subs,t.initStateCmd)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(1),a=r(2);t.runGame=function(e,t,r,i){var u=[],c=i[0],f=c;function s(n){!function(t){setTimeout(function(){var n=e(t,f),o=n[0];l(n[1],r(o)),f=o},30)}(n),t(s)(f)}function l(e,t){n.run(e,s);var r=u.map(function(e){return e[0]}),i=a.partition(function(e){return r.indexOf(e[0])>-1},t),c=i[0],f=i[1],l=a.partition(function(e){return c.map(function(e){return e[0]}).indexOf(e)>-1},r)[1];f.forEach(function(e){var t=e[0];e[1],u=[[t,o.run(e,s)]].concat(u)}),l.forEach(function(e){u.filter(function(t){return t[0]==e}).forEach(function(e){return e[1]()}),u=u.filter(function(t){return t[0]!=e})})}l(i[1],r(c))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(8),o=r(3),a=n.getImg("atlas.png");t.charsAtlas={0:[40,90,20,20],_:[0,131,20,20],c:[20,131,20,20],w:[39,110,20,20],d1:[0,110,20,20],d2:[40,131,20,20],d3:[20,171,20,20],door:[40,171,20,40],d:[0,171,20,20],f:[20,151,20,20],hui:[10,0,10,8],hammer:[0,0,10,6],kui:[20,0,13,5],key:[42,0,10,10],l:[40,151,20,20],s:[0,151,20,20],ph1:[0,49,17,20],ph2:[17,49,17,20],pi1:[32,10,8,20],pi2:[40,10,8,20],pj1:[0,30,12,17],pj2:[22,30,12,17],p:[37,69,20,20],pw1:[48,10,8,20],pw2:[12,30,10,19],r:[20,90,20,20],t:[0,90,20,20],sof:[0,10,16,10],son:[16,10,16,10],server:[34,49,18,20],srvui:[33,0,9,10],servero:[0,69,18,20],vo:[34,30,20,13],vw1:[18,69,19,21],vw2:[20,110,19,21]};var i=function(e){return Math.floor(1+.004*e%2)},u=function(e){return Math.round(.008*e)%10==2?2:1},c=function(e){return Math.round(.001*performance.now()/.04)%3+1},f=function(e){return 0==Math.floor(.008*e%2)};function s(e,r){switch(e[8]){case"player":return[a,function(e,r,n,o){var a=i(o),c=u(o);return r?1==n?t.charsAtlas["ph"+a]:0==e?t.charsAtlas["pi"+c]:t.charsAtlas["pw"+a]:t.charsAtlas["pj"+a]}(e[4],e[7],e[10],r)];case"vending":return[a,function(e,r){var n=i(r);return Math.round(.008*r),e>0?t.charsAtlas.vo:t.charsAtlas["vw"+n]}(e[11],r)];case"drone":return[a,function(e,r){var n=c(r);return t.charsAtlas.d1[1]=110,t.charsAtlas.d1[3]=20,e>0?(t.charsAtlas.d1[1]=115,t.charsAtlas.d1[3]=15,t.charsAtlas.d1):t.charsAtlas["d"+n]}(e[11],r)];default:return[a,function(e,r){return"server"==e&&r<0?t.charsAtlas.servero:t.charsAtlas[e]}(e[8],e[11])]}}function l(e,r,o,i){var u=s(e,r),c=u[0],l=u[1],d=l[0],v=l[1],_=l[2],h=l[3],g="l"==e[6]?1:-1;n.drawImage(c.tex,c.w,c.h,d,v,_,h,Math.round(e[0]-o)+(g<0?_:0),Math.round(e[1]-i),_*g,h),function(e,r,o,i,u){if(("vending"==e||"drone"==e)&&f(u)){var c=r>0?"sof":"son",s=t.charsAtlas[c],l=s[0],d=s[1],v=s[2],_=s[3],h="drone"==e?[2,5]:[0,0],g=h[0],m=h[1];n.drawImage(a.tex,a.w,a.h,l,d,v,_,Math.round(o+g),Math.round(i+m-_),v,_)}}(e[8],e[11],e[0]-o,e[1]-i,r)}t.render=function(e,r,i,u){n.g.canvas.style.width=window.innerWidth+"px",n.g.canvas.style.height=window.innerHeight+"px",n.g.viewport(0,0,n.g.canvas.width,n.g.canvas.height),n.g.clear(n.g.COLOR_BUFFER_BIT),n.g.blendFunc(n.g.SRC_ALPHA,n.g.ONE_MINUS_SRC_ALPHA),n.g.enable(n.g.BLEND);var c=e[0],f=c[0],s=c[1],d=c[2],v=c[3],_=e[1],h=Math.floor(f/i),g=h+d/i,m=Math.floor(s/i),p=m+v/i,x=h*i-f,w=m*i-s;n.bindFrameBuffer();for(var y=h;y<=g;y++){for(var A=m;A<=p;A++){var E=(y-h)*i+x,T=(A-m)*i+w,b=r.charAt(A*u+y);if("`"!=b&&"x"!=b)try{var R=t.charsAtlas[b],k=R[0],S=R[1],M=R[2],F=R[3];n.drawImage(a.tex,a.w,a.h,k,S,M,F,Math.round(E),Math.round(T),i,i)}catch(e){}}for(var C=0;C<_.length;C++)_[C][0]+_[C][2]>f&&_[C][0]<f+d&&_[C][1]>s&&_[C][1]<s+v&&l(_[C],performance.now(),f,s)}n.renderPostProcessing(performance.now(),n.postTexture),o.renderUi(e),n.bindFrameBuffer()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(9),o=r(10),a=r(11),i=r(12);t.canvas=document.getElementById("c"),t.g=t.canvas.getContext("webgl");var u=S(t.g,o,n),c=S(t.g,i,a),f=b(u,"a_p"),s=b(u,"a_t"),l=b(c,"a_t"),d=b(c,"a_p"),v=R(u,"u_m"),_=R(u,"u_tm"),h=R(u,"u_tx"),g=R(c,"u_r"),m=t.g.createBuffer();t.g.bindBuffer(t.g.ARRAY_BUFFER,m);t.g.bufferData(t.g.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),t.g.STATIC_DRAW);var p=t.g.createBuffer();t.g.bindBuffer(t.g.ARRAY_BUFFER,p);function x(e,t,r,n,o){return void 0===o&&(o=null),(o=o||new Float32Array(16))[0]=t*e[0],o[1]=t*e[1],o[2]=t*e[2],o[3]=t*e[3],o[4]=r*e[4],o[5]=r*e[5],o[6]=r*e[6],o[7]=r*e[7],o[8]=n*e[8],o[9]=n*e[9],o[10]=n*e[10],o[11]=n*e[11],e!==o&&(o[12]=e[12],o[13]=e[13],o[14]=e[14],o[15]=e[15]),o}function w(e){var t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),t}t.g.bufferData(t.g.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),t.g.STATIC_DRAW),t.createAndSetupTexture=w,t.getImg=function(e){var r={w:1,h:1,tex:w(t.g)},n=new Image;return n.addEventListener("load",function(){r.w=n.width,r.h=n.height,t.g.bindTexture(t.g.TEXTURE_2D,r.tex),t.g.texImage2D(t.g.TEXTURE_2D,0,t.g.RGBA,t.g.RGBA,t.g.UNSIGNED_BYTE,n)}),n.src=e,r},t.postTexture=w(t.g),t.g.texImage2D(t.g.TEXTURE_2D,0,t.g.RGBA,t.g.canvas.width,t.g.canvas.height,0,t.g.RGBA,t.g.UNSIGNED_BYTE,null);var y=t.g.createFramebuffer(),A=t.g.COLOR_ATTACHMENT0;t.bindFrameBuffer=function(){t.g.bindFramebuffer(t.g.FRAMEBUFFER,y),t.g.framebufferTexture2D(t.g.FRAMEBUFFER,A,t.g.TEXTURE_2D,t.postTexture,0)},t.drawImage=function(e,r,n,o,a,i,c,l,d,g,w){void 0===l&&(l=o,o=0),void 0===d&&(d=a,a=0),void 0===i&&(i=r),void 0===c&&(c=n),void 0===g&&(g=i,i=r),void 0===w&&(w=c,c=n),t.g.bindTexture(t.g.TEXTURE_2D,e),t.g.useProgram(u),k(f,m),k(s,p);var y=function(e,t,r,n,o,a,i){return void 0===i&&(i=null),(i=i||new Float32Array(16))[0]=2/(t-e),i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2/(n-r),i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2/(o-a),i[11]=0,i[12]=(e+t)/(e-t),i[13]=(r+n)/(r-n),i[14]=(o+a)/(o-a),i[15]=1,i}(0,t.g.canvas.width,t.g.canvas.height,0,-1,1);y=x(y=function(e,t,r,n,o){void 0===o&&(o=null),o=o||new Float32Array(16);var a=e[0],i=e[1],u=e[2],c=e[3],f=e[4],s=e[5],l=e[6],d=e[7],v=e[8],_=e[9],h=e[10],g=e[11],m=e[12],p=e[13],x=e[14],w=e[15];return e!==o&&(o[0]=a,o[1]=i,o[2]=u,o[3]=c,o[4]=f,o[5]=s,o[6]=l,o[7]=d,o[8]=v,o[9]=_,o[10]=h,o[11]=g),o[12]=a*t+f*r+v*n+m,o[13]=i*t+s*r+_*n+p,o[14]=u*t+l*r+h*n+x,o[15]=c*t+d*r+g*n+w,o}(y,l,d,0),g,w,1),t.g.uniformMatrix4fv(v,!1,y);var A=function(e,t,r,n){return void 0===n&&(n=null),(n=n||new Float32Array(16))[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=e,n[13]=t,n[14]=r,n[15]=1,n}(o/r,a/n,0);A=x(A,i/r,c/n,1),t.g.uniformMatrix4fv(_,!1,A),t.g.uniform1i(h,0),t.g.drawArrays(t.g.TRIANGLES,0,6)};var E=t.g.createBuffer(),T=t.g.createBuffer();function b(e,r){return t.g.getAttribLocation(e,r)}function R(e,r){return t.g.getUniformLocation(e,r)}function k(e,r){t.g.bindBuffer(t.g.ARRAY_BUFFER,r),t.g.enableVertexAttribArray(e),t.g.vertexAttribPointer(e,2,t.g.FLOAT,!1,0,0)}function S(e,t,r){var n=e.createProgram(),o=e.createShader(e.VERTEX_SHADER);e.shaderSource(o,r),e.compileShader(o);var a=e.createShader(e.FRAGMENT_SHADER);return e.shaderSource(a,t),e.compileShader(a),e.attachShader(n,o),e.attachShader(n,a),e.linkProgram(n),n}t.renderPostProcessing=function(e,r){t.g.bindFramebuffer(t.g.FRAMEBUFFER,null),t.g.bindTexture(t.g.TEXTURE_2D,r),t.g.viewport(0,0,t.g.canvas.width,t.g.canvas.height),t.g.clearColor(.678,.498,.659,1),t.g.clear(t.g.COLOR_BUFFER_BIT|t.g.DEPTH_BUFFER_BIT),t.g.useProgram(c),k(l,T),t.g.bufferData(t.g.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),t.g.STATIC_DRAW),k(d,E),function(e,t,r,n,o){var a=t,i=t+n,u=r,c=r+o;e.bufferData(e.ARRAY_BUFFER,new Float32Array([a,u,i,u,a,c,a,c,i,u,i,c]),e.STATIC_DRAW)}(t.g,0,0,t.g.canvas.width,t.g.canvas.height),t.g.uniform2f(g,t.g.canvas.width,t.g.canvas.height),t.g.drawArrays(t.g.TRIANGLES,0,6)}},function(e,t){e.exports="attribute vec4 a_p;\nattribute vec2 a_t;\nuniform mat4 u_m;\nuniform mat4 u_tm;\nvarying vec2 v_td;\nvoid main() {\ngl_Position = u_m * a_p;\nv_td = (u_tm * vec4(a_t, 0, 1)).xy;\n}\n"},function(e,t){e.exports="precision mediump float;\nvarying vec2 v_td;\nuniform sampler2D u_tx;\nuniform float time;\nvoid main() {\ngl_FragColor = texture2D(u_tx, v_td);\n}\n"},function(e,t){e.exports="attribute vec2 a_p;\nattribute vec2 a_t;\nuniform vec2 u_r;\nvarying vec2 v_t;\nvoid main() {\n   vec2 z1 = a_p / u_r;\n   vec2 z2 = z1 * 2.0;\n   vec2 cspc = z2 - 1.0;\n   gl_Position = vec4(cspc * vec2(1, -1), 0, 1) * vec4(1.0,-1.0,1.0,1.0);\n   v_t = a_t;\n}\n"},function(e,t){e.exports="precision highp float;\nuniform vec2 u_r;\nuniform sampler2D img;\nvarying vec2 v_t;\nconst vec4 vColor = vec4(1.0,1.0,1.0,1.0);\nconst float R = 0.75;\nconst float S = 0.45;\nconst vec3 SP = vec3(1.2, 1.0, 0.8); \nfloat rand(vec2 co) {\nreturn fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\nvoid main() {\nvec4 tClr = texture2D(img, v_t);\nvec2 pos = (gl_FragCoord.xy / u_r.xy) - vec2(0.5);\nfloat len = length(pos);\nfloat vnnt = smoothstep(R, R-S, len);\ntClr.rgb = mix(tClr.rgb, tClr.rgb * vnnt, 0.5);\nfloat gray = dot(tClr.rgb, vec3(0.299, 0.587, 0.114));\nvec3 spc = vec3(gray) * SP;\ntClr.rgb = mix(tClr.rgb, spc, 0.22);\ngl_FragColor = tClr;\n}\n"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(4);var o=function(e){var t="";return e.split(",").forEach(function(e){for(var r=e.split("-"),n=r[0],o=r[1],a=parseInt(n);a--;)t+=o}),t}("1-x,2-t,1-l,2-t,1-l,2-t,1-l,2-t,1-l,2-t,1-l,2-t,1-l,2-t,1-l,1-t,1-x,1-f,1-x,1-t,1-l,2-t,1-l,2-t,1-l,2-t,1-l,2-t,1-l,2-t,1-l,2-t,1-l,3-t,2-x,4-`,1-0,3-_,1-0,3-_,1-0,3-_,1-0,5-`,1-x,1-f,1-x,3-`,1-0,3-_,1-0,3-_,1-0,3-_,1-0,7-`,2-x,2-`,1-w,4-`,1-s,5-`,1-w,4-`,1-0,2-_,1-0,1-x,1-f,1-x,2-`,1-s,4-`,1-w,6-`,1-s,4-`,1-w,3-`,2-x,1-r,1-p,1-c,1-s,3-r,1-s,1-c,1-p,6-r,1-d,2-r,1-c,1-p,1-r,1-x,1-f,1-x,1-r,1-c,1-s,8-r,1-c,1-p,1-c,1-s,3-r,1-s,2-c,2-r,2-x,3-d,7-f,3-d,2-f,3-d,4-f,1-x,1-f,1-x,7-f,3-d,13-f,52-x,23-`,1-x,24-`,2-x,23-`,1-x,24-`,2-x,23-`,1-x,24-`,2-x,23-`,1-x,24-`,2-x,23-`,1-x,24-`,2-x,23-`,1-x,24-`,2-x,23-`,1-x,24-`,2-x,23-`,1-x,25-`,1-x,23-`,1-x,25-`,1-x,23-`,1-x,1725-`");function a(e,t,r){return r.indexOf(e)===t}t.initState=[[0,0,180,100,0,0,0],[[657,60,10,10,0,0,"r",!0,"hammer",33,0,0],[106,2,10,10,0,0,"r",!0,"key",99,0,0],[242,39,20,40,0,0,"r",!0,"door",63,67,99],[680,39,20,40,0,0,"r",!0,"door",67,63,-1],[777,80,18,20,0,0,"r",!0,"server",12,1,100],[830,80,18,20,0,0,"r",!0,"server",13,1,100],[597,80,18,20,0,0,"r",!0,"server",14,1,100],[830,45,19,21,.03,.058,"r",!0,"vending",104,180,0],[830,45,19,21,.03,.058,"r",!0,"drone",105,180,0],[697,45,19,21,.03,.058,"r",!0,"vending",106,180,0],[30,60,8,20,0,.058,"r",!0,"player",0,0,100]],[],[.058,.075,-.35],o,[],performance.now()+8e3,""],t.moveCamera=function(e,t,r,n,o){var a=e[2],i=e[3],u=e[4],c=e[5],f=e[6],s=[t%(n-a),r%(o-i)],l=[s[0]==t?t:n-a,s[1]==r?r:o-i,a,i,u,c,f];return l[0]=l[0]<0?0:l[0],l[1]=l[1]<0?0:l[1],l},t.tilesFromMap=function(e,t,r){for(var o=e[0],a=e[1],i=e[2],u=e[3],c=Math.floor(o/r),f=c+i/r,s=Math.floor(a/r),l=s+u/r,d=[],v=c;v<f;v++)for(var _=s;_<l;_++)d.push(t.charAt(n.gtn(v*r,_*r,r,5)));return d},t.insertInCells=function(e,t,r,o){var i=e[0],u=e[1],c=e[3],f=e[4],s=e[5],l=e[6],d=e[7];return u.forEach(function(e){n.gab(e[0],e[1],e[2],e[3]).map(function(e){return n.gtn(e[0],e[1],r,o)}).filter(a).forEach(function(r){t[r]?t[r].push(e):t[r]=[e]})}),[i,u,t,c,f,s,l,d]},t.openUse=function(e){var r,o,a=t.insertInCells(e,new Array(100),20,10),i=a[0],u=a[1],c=a[2],f=a[3],s=a[4],l=a[5],d=a[6],v=a[7],_=u.filter(function(e){return"player"==e[8]})[0],h=_[0],g=_[1],m=_[2],p=_[3];return n.gab(h,g,m,p).map(function(e){return n.gtn(e[0],e[1],20,10)}).map(function(e){return c[e]}).forEach(function(e){e&&e.filter(function(e){var t=e[0],r=e[1],o=e[2],a=e[3],i=_[0],u=_[1],c=_[2],f=_[3];return n.collide([i,u,c,f],[t,r,o,a])}).forEach(function(e){if("door"==e[8]){var t=e[10],n=u.filter(function(e){return e[9]==t})[0],a=e[11];if(a>0)for(var i=0;i<l.length;i++)"key"==l[i][1]&&l[i][0]==a&&(r=n[0],o=n[1]);else r=n[0],o=n[1]}else if("server"==e[8]){var c=e[11];l.filter(function(e){return"hammer"==e[1]}).map(function(e){return e[0]}).indexOf(c)>-1&&(e[10]=0)}})}),r&&o?(i[0]=r-70,i[1]=o-70,_[0]=r,_[1]=o+10,[i,u,[],f,s,l,d,v]):(e[6]=e[6]-e[6],e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r(15);var n=new AudioContext,o=new sonantx.MusicGenerator({rowLen:7692,endPattern:10,songData:[{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:1,osc2_oct:7,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:154,osc2_waveform:1,noise_fader:0,env_attack:197,env_sustain:88,env_release:10614,env_master:45,fx_filter:0,fx_freq:11025,fx_resonance:255,fx_delay_time:2,fx_delay_amt:146,fx_pan_freq:3,fx_pan_amt:47,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[1,1,2,3,1,1,1,2,3],c:[{n:[147,0,147,0,147,0,147,0,147,0,147,0,147,0,147,0,147,0,147,0,147,0,147,0,147,0,147,0,147,0,147,0]},{n:[159,0,0,0,159,0,0,0,159,0,0,0,159,0,151,0,159,0,0,0,159,0,0,0,159,0,0,0,159,0,151,0]},{n:[159,0,0,0,159,0,0,0,159,0,0,0,159,0,0,0,147,0,147,0,147,0,147,0,147,0,147,0,147,0,147,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:1,osc2_oct:7,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:154,osc2_waveform:1,noise_fader:0,env_attack:197,env_sustain:88,env_release:10614,env_master:45,fx_filter:0,fx_freq:11025,fx_resonance:255,fx_delay_time:2,fx_delay_amt:146,fx_pan_freq:3,fx_pan_amt:47,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[1,1,0,2,1,1,1,0,2],c:[{n:[143,0,143,0,143,0,143,0,143,0,143,0,143,0,143,0,143,0,143,0,143,0,143,0,143,0,143,0,143,0,143,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,143,0,143,0,143,0,143,0,143,0,143,0,143,0,143,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:1,osc2_oct:7,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:154,osc2_waveform:1,noise_fader:0,env_attack:197,env_sustain:88,env_release:10614,env_master:45,fx_filter:0,fx_freq:11025,fx_resonance:255,fx_delay_time:2,fx_delay_amt:146,fx_pan_freq:3,fx_pan_amt:47,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[1,1,0,2,1,1,1,0,2],c:[{n:[140,0,140,0,140,0,140,0,140,0,140,0,140,0,140,0,139,0,139,0,139,0,139,0,139,0,139,0,139,0,139,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,139,0,139,0,139,0,139,0,139,0,139,0,139,0,139,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:3,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:255,osc2_waveform:0,noise_fader:127,env_attack:22,env_sustain:22,env_release:2193,env_master:255,fx_filter:3,fx_freq:4067,fx_resonance:176,fx_delay_time:4,fx_delay_amt:12,fx_pan_freq:2,fx_pan_amt:84,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:3,lfo_amt:96,lfo_waveform:0,p:[0,0,0,0,1,1,1],c:[{n:[0,164,0,0,0,152,0,0,154,0,159,0,154,0,164,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]}],songLen:57});t.playSound=function(){o.createAudioBuffer(function(e){var t=n.createBufferSource();t.buffer=e;var r=n.createGain();r.gain.value=.18,r.connect(n.destination),t.connect(r),t.loop=!0,t.start(),t.loopEnd=46})}},function(e,t){var r;!function(){"use strict";r={},window.sonantx=r;var e=2,t=33,n=null;function o(e){return Math.sin(6.283184*e)}var a=[o,function(e){return o(e)<0?-1:1},function(e){return e%1-.5},function(e){var t=e%1*4;return t<2?t-1:3-t}];function i(e){return.00390625*Math.pow(1.059463094,e-128)}function u(r,n){setTimeout(function(){var o=new Uint8Array(r*e*2),a=o.length-2,i=function(){for(var e=new Date,r=0;a>=0;)if(o[a]=0,o[a+1]=128,a-=2,(r+=1)%1e3==0&&new Date-e>t)return void setTimeout(i,0);setTimeout(function(){n(o)},0)};setTimeout(i,0)},0)}function c(e,r,n,o,a){var i=n.fx_delay_time*o>>1,u=n.fx_delay_amt/255,c=0,f=function(){for(var n=new Date,o=0;c<r-i;){var s=4*c,l=4*(c+i),d=e[l]+(e[l+1]<<8)+(e[s+2]+(e[s+3]<<8)-32768)*u;if(e[l]=255&d,e[l+1]=d>>8&255,d=e[l+2]+(e[l+3]<<8)+(e[s]+(e[s+1]<<8)-32768)*u,e[l+2]=255&d,e[l+3]=d>>8&255,++c,(o+=1)%1e3==0&&new Date-n>t)return void setTimeout(f,0)}setTimeout(a,0)};setTimeout(f,0)}r.AudioGenerator=function(t){this.mixBuf=t,this.waveSize=t.length/e/2},r.AudioGenerator.prototype.getWave=function(){var t,r,n,o,a,i,u,c=this.mixBuf,f=this.waveSize*e*2;for(i=(a=f-8)-36,o=String.fromCharCode(82,73,70,70,255&a,a>>8&255,a>>16&255,a>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&i,i>>8&255,i>>16&255,i>>24&255),t=0;t<f;){for(n="",r=0;r<256&&t<f;++r,t+=2)u=(u=4*(c[t]+(c[t+1]<<8)-32768))<-32768?-32768:u>32767?32767:u,n+=String.fromCharCode(255&u,u>>8&255);o+=n}return o},r.AudioGenerator.prototype.getAudio=function(){var e=this.getWave(),t=new Audio("data:audio/wav;base64,"+btoa(e));return t.preload="none",t.load(),t},r.AudioGenerator.prototype.getAudioBuffer=function(r){null===n&&(n=new AudioContext);var o=this.mixBuf,a=this.waveSize*e*2,i=n.createBuffer(e,this.waveSize,44100),u=i.getChannelData(0),c=i.getChannelData(1),f=0,s=function(){for(var e=new Date,n=0;f<a/2;){var l=4*(o[4*f]+(o[4*f+1]<<8)-32768);if(l=l<-32768?-32768:l>32767?32767:l,u[f]=l/32768,l=(l=4*(o[4*f+2]+(o[4*f+3]<<8)-32768))<-32768?-32768:l>32767?32767:l,c[f]=l/32768,f+=1,(n+=1)%1e3==0&&new Date-e>t)return void setTimeout(s,0)}setTimeout(function(){r(i)},0)};setTimeout(s,0)},r.SoundGenerator=function(e,t){this.instr=e,this.rowLen=t||5605,this.osc_lfo=a[e.lfo_waveform],this.osc1=a[e.osc1_waveform],this.osc2=a[e.osc2_waveform],this.attack=e.env_attack,this.sustain=e.env_sustain,this.release=e.env_release,this.panFreq=Math.pow(2,e.fx_pan_freq-8)/this.rowLen,this.lfoFreq=Math.pow(2,e.lfo_freq-8)/this.rowLen},r.SoundGenerator.prototype.genSound=function(e,t,r){new Date;for(var n=0,a=0,u=i(e+12*(this.instr.osc1_oct-8)+this.instr.osc1_det)*(1+8e-4*this.instr.osc1_detune),c=i(e+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),f=this.instr.fx_resonance/255,s=0,l=0,d=this.attack+this.sustain+this.release-1;d>=0;--d){var v=d+r,_=this.osc_lfo(v*this.lfoFreq)*this.instr.lfo_amt/512+.5,h=1;d<this.attack?h=d/this.attack:d>=this.attack+this.sustain&&(h-=(d-this.attack-this.sustain)/this.release);var g=u;this.instr.lfo_osc1_freq&&(g+=_),this.instr.osc1_xenv&&(g*=h*h),n+=g;var m=this.osc1(n)*this.instr.osc1_vol;g=c,this.instr.osc2_xenv&&(g*=h*h),a+=g,m+=this.osc2(a)*this.instr.osc2_vol,this.instr.noise_fader&&(m+=(2*Math.random()-1)*this.instr.noise_fader*h),m*=h/255;var p=this.instr.fx_freq;this.instr.lfo_fx_freq&&(p*=_);var x=f*(m-l)-(s+=(p=1.5*Math.sin(3.141592*p/44100))*l);switch(l+=p*x,this.instr.fx_filter){case 1:m=x;break;case 2:m=s;break;case 3:m=l;break;case 4:m=s+x}if(g=o(v*this.panFreq)*this.instr.fx_pan_amt/512+.5,m*=39*this.instr.env_master,(v*=4)+3<t.length){var w=t[v]+(t[v+1]<<8)+m*(1-g);t[v]=255&w,t[v+1]=w>>8&255,w=t[v+2]+(t[v+3]<<8)+m*g,t[v+2]=255&w,t[v+3]=w>>8&255}}},r.SoundGenerator.prototype.getAudioGenerator=function(e,t){var n=this.attack+this.sustain+this.release-1+32*this.rowLen,o=this;u(n,function(a){o.genSound(e,a,0),c(a,n,o.instr,o.rowLen,function(){t(new r.AudioGenerator(a))})})},r.SoundGenerator.prototype.createAudio=function(e,t){this.getAudioGenerator(e,function(e){t(e.getAudio())})},r.SoundGenerator.prototype.createAudioBuffer=function(e,t){this.getAudioGenerator(e,function(e){e.getAudioBuffer(t)})},r.MusicGenerator=function(e){this.song=e,this.waveSize=44100*e.songLen},r.MusicGenerator.prototype.generateTrack=function(n,o,a){var i=this;u(this.waveSize,function(u){var f=i.waveSize,s=i.waveSize*e*2,l=i.song.rowLen,d=i.song.endPattern,v=new r.SoundGenerator(n,l),_=0,h=0,g=0,m=function(){for(var e=new Date;;)if(32!==g){if(h===d-1)return void setTimeout(p,0);var r=n.p[h];if(r){var o=n.c[r-1].n[g];o&&v.genSound(o,u,_)}if(_+=l,g+=1,new Date-e>t)return void setTimeout(m,0)}else g=0,h+=1},p=function(){c(u,f,n,l,w)},x=0,w=function(){for(var e=new Date,r=0;x<s;){var n=o[x]+(o[x+1]<<8)+u[x]+(u[x+1]<<8)-32768;if(o[x]=255&n,o[x+1]=n>>8&255,x+=2,(r+=1)%1e3==0&&new Date-e>t)return void setTimeout(w,0)}setTimeout(a,0)};setTimeout(m,0)})},r.MusicGenerator.prototype.getAudioGenerator=function(e){var t=this;u(this.waveSize,function(n){var o=0,a=function(){o<t.song.songData.length?(o+=1,t.generateTrack(t.song.songData[o-1],n,a)):e(new r.AudioGenerator(n))};a()})},r.MusicGenerator.prototype.createAudio=function(e){this.getAudioGenerator(function(t){e(t.getAudio())})},r.MusicGenerator.prototype.createAudioBuffer=function(e){this.getAudioGenerator(function(t){t.getAudioBuffer(e)})}}()}]);</script>
