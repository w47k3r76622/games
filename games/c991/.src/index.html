<!DOCTYPE html><html><head><title>C99+1</title><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><script src="https://js13kgames.com/webxr-src/2022/aframe.js"></script><style type="text/css">body,html{margin:0;padding:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell}.main{position:fixed;z-index:1000;background:linear-gradient(#4c4c4c,#0d0d0d);color:#fff;width:100%;height:100vh;display:flex;align-items:center;justify-content:center}h1{font-size:30px;padding:0;background:-webkit-linear-gradient(#eee,#a1a1a1);-webkit-background-clip:text;-webkit-text-fill-color:transparent}h1,p{margin:5px}p{font-size:12px}.gamebutton{display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:center}.credit{position:fixed;bottom:0;background:#fff;color:#2e2e2e;width:110%;padding:10px;z-index:1000}.content,.credit{text-align:center}.content{width:90%;padding:0 20px}.history{max-width:700px;margin:0 auto}button{background:none;border:2px solid #fff;color:#fff;cursor:pointer}.p-10{padding:10px}.fs-16{font-size:16px}.fs-20{font-size:20px}.fs-10{font-size:12px}.bt{background:linear-gradient(#616161,#303030)}input[type=checkbox],input[type=radio]{-webkit-appearance:none;-moz-appearance:none;appearance:none;display:inline-block;width:25px;height:25px;padding:6px;background-clip:content-box;border:2px solid #bbb;background-color:#e7e6e7}input[type=radio]{border-radius:50%}input[type=checkbox]:checked,input[type=radio]:checked{background-color:#e02626}.r{color:#e02626}.flex{display:flex;align-items:center;justify-content:center}.dn{display:none}.w{width:100%}</style></head><body><a-scene vr-mode-ui="enterVRButton: #bvr"><div id="mainUI"><div class="main"><div class="content"><h1>C99+1</h1><p class="fs-16 history">Escaping from the city dome has been your life goal. You and many others started the long path, many of them have fallen and perished along the way. You stand alone now but close to end. The 99+1 cubes Well plus the 7 levels remaining are the last obstacle before freedom. Find your way out from one level to the next, through cubes that never disappear.</p><div class="gamebutton"><div class="p-10"><p class="fs-10 r">Tested in META QUEST 2</p><button id="bvr" class="w p-10 fs-20 bt">VR</button><p class="fs-10">Use thumbstick controls for translate<br>A || B buttons for rotating 30º<br>Playing standing up and facing the stage</p></div><div class="p-10"><p class="fs-10 r">Play in your computer</p><button id="bdk" class="w p-10 fs-20 bt">Desktop</button><p class="fs-10">move - AWSD keys<br>rotate camera - mouse left+click</p></div></div><div><p>How to play: Move up levels by reaching the cube that is in front of you. You will have to move through cycles 1 never falls, always remember to have the cube on top of it.</p><p></p><div class="flex settings"><input id="nochall" type="radio" name="diffi"> <label for="nochall" class="p-10">VERY EASY</label> <input id="chall" type="radio" name="diffi" checked="true"> <label for="chall" class="p-10">HARD</label> <input id="music" type="checkbox" checked="true"> <label for="music" class="p-10">music</label> <input id="fx" type="checkbox" checked="true"> <label for="fx" class="p-10">FX sounds</label></div><p id="save" class="dn"></p><button id="reset" onclick="resetLevel()" class="dn p-10">Reset</button></div></div><p class="credit fs-10">code - oscar bravo villacorta | shaders - shaderfrog.com | music - deconstructive remix from original SWAY by bits'n'bites | thanks to andrew</p></div></div><a-entity id="rig" wasd-controls="acceleration:15" look-controls><a-entity camera id="camera"><a-entity id="log" text="side:double" position="0 0 -1" scale="1.3 1.3 1.3"></a-entity><a-entity id="fade" geometry="primitive: plane" scale="3 3 3" material="shader: flat; color: #393939;opacity: 0; transparent: true" position="0 0 -0.2"></a-entity></a-entity><a-entity oculus-touch-controls="hand: right"></a-entity><a-entity oculus-touch-controls="hand: left"></a-entity></a-entity><a-entity id="collisionRay" position="0 0 0" raycaster="direction: 0 -1 0;far: 4;objects: .boxCollider,.initCube, .endCube;"><a-ring color="#393939" position="0 -.95 0" rotation="-90 0 0" scale="0.05 0.05 0.05" width="120"></a-ring></a-entity><a-sky id="sky" color="#2f2f2f"></a-sky></a-scene><script type="text/javascript">!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=3)}([function(t,e){AFRAME.registerComponent("move-control",{init:function(){this.moveSpeed=1,this.clock=new THREE.Clock,this.cameraDirection=new THREE.Vector3,this.x=0,this.y=0,this.el.addEventListener("thumbstickmoved",t=>{this.x=t.detail.x,this.y=t.detail.y}),this.el.addEventListener("abuttondown",t=>{this.turnReady=!0,this.tunrLeft=!0}),this.el.addEventListener("bbuttondown",t=>{this.turnReady=!0,this.tunrLeft=!1}),this.el.addEventListener("xbuttondown",t=>{this.turnReady=!0,this.tunrLeft=!0}),this.el.addEventListener("ybuttondown",t=>{this.turnReady=!0,this.tunrLeft=!1}),this.turnReady=!0,this.startAngle=0,this.endAngle=0,this.turnInProgress=!1,this.turnAngle=15,this.turnDuration=.05,this.turnTime=0,this.tunrLeft=!1},lerp:function(t,e,i){return t+(e-t)*i},tick:function(){this.deltaTime=this.clock.getDelta(),this.leftJoystickLength=Math.sqrt(this.x*this.x+this.y*this.y),this.leftJoystickLength>.1&&(this.el.sceneEl.camera.getWorldDirection(this.cameraDirection),this.cameraAngle=Math.atan2(this.cameraDirection.z,this.cameraDirection.x),this.leftJoystickAngle=Math.atan2(this.y,this.x),this.moveDistance=this.moveSpeed*this.deltaTime,this.moveAngle=this.cameraAngle+this.leftJoystickAngle,this.moveRight=-this.leftJoystickLength*Math.sin(this.moveAngle)*this.moveDistance,this.moveForward=this.leftJoystickLength*Math.cos(this.moveAngle)*this.moveDistance,this.el.object3D.position.x=this.el.object3D.position.x+this.moveRight,this.el.object3D.position.z=this.el.object3D.position.z+this.moveForward),this.turnReady&&(this.startAngle=this.el.getAttribute("rotation").y,this.tunrLeft?this.endAngle=this.startAngle-this.turnAngle:this.endAngle=this.startAngle+this.turnAngle,this.turnInProgress=!0,this.turnTime=0,this.turnReady=!1),this.turnInProgress&&(this.turnTime+=this.deltaTime,this.rot=this.el.getAttribute("rotation"),this.rot.y=this.lerp(this.startAngle,this.endAngle,this.turnTime/this.turnDuration),this.el.setAttribute("rotation",this.rot),this.turnTime>=this.turnDuration&&(this.turnInProgress=!1))}})},function(t,e){AFRAME.registerComponent("look-down",{init:function(){this.campos=new THREE.Vector3(0,0,0),this.cam=document.getElementById("camera"),this.el.sceneEl.addEventListener("loaded",()=>{this.cam.object3D.getWorldPosition(this.campos)})},tick:function(){this.cam.object3D.getWorldPosition(this.campos),this.el.setAttribute("position",`${this.campos.x} ${this.campos.y}  ${this.campos.z} `)}})},function(t,e,i){},function(t,e,i){"use strict";i.r(e);const n={START:"start",STARTPLAY:"startPlay",PLAY:"play",FALLING:"falling",FINISH:"finish",NEXTLEVEL:"nextLevel",END:"end"},o={RISEUP:"riseup",RISEDOWN:"risedown",CUBEUP:"upcube",CUBEDOWN:"downcube",FALL:"fall",FADEIN:"fadein",FADEOUT:"fadeout",DOWNSTAGE:"downstage"},s={CUBO_0:"cubo_0",CUBO_777:"cubo_777"},r="Congratulations you have managed to overcome all obstacles on your quest to freedom. The price to freedom is perish while trying. Your life preserved in the city dome, from a hostile and uninhabitable world. A result of confrontation between powerful nations since ancient times. The tunnel is now closed and there is no more paths to go nor turning back,,,, no more challenges but just one destiny ahead in an apocalyptic world: TO DIE . . . . . . . . . . . . . . . (It was meant to have a Shader twist between lines, due to restrictions, I’m unable. Just imagine a Shader with fire & sulfur. Thanks though. Oscar)",a={id:5867,name:"cubo",fragment:"precision highp float;\nprecision highp int;\nuniform vec3 color;\nuniform float brightness;\nuniform float falloff;\nuniform mat4 modelMatrix;\nuniform vec3 uvScale;\nuniform vec3 uvOffset;\nuniform vec3 colorFront1;\nuniform vec3 colorFront2;\nuniform vec3 colorRight1;\nuniform vec3 colorRight2;\nuniform vec3 colorTop1;\nuniform vec3 colorTop2;\nvarying vec2 vUv;\nvarying vec4 worldCoord;\nvarying float lightStrengthX;\nvarying float lightStrengthY;\nvarying float lightStrengthZ;\nvec4 Cube_Edges1468788327926_62_main() \n                                                                                                                                                                                                                                                                                                                                            {\n                                                                                                                                                                                                                                                                                                                                                vec4 Cube_Edges1468788327926_62_gl_FragColor = vec4(0.0);\n                                                                                                                                                                                                                                                                                                                                                vec2 multiplier = pow(abs(vUv - 0.5), vec2(falloff));\n                                                                                                                                                                                                                                                                                                                                                Cube_Edges1468788327926_62_gl_FragColor = vec4(color * brightness * length(multiplier), 1.0);\n                                                                                                                                                                                                                                                                                                                                                return Cube_Edges1468788327926_62_gl_FragColor *= 1.0;\n                                                                                                                                                                                                                                                                                                                                            }\nvec4 World_Based_Gradients1472519140028_142_main() \n                                                                                                                                                                                                                                                                                                                                            {\n                                                                                                                                                                                                                                                                                                                                                vec4 World_Based_Gradients1472519140028_142_gl_FragColor = vec4(0.0);\n                                                                                                                                                                                                                                                                                                                                                float gradientX = clamp((worldCoord.x + uvOffset.z + uvScale.z * 0.5) / uvScale.z, 0.0, 1.0);\n                                                                                                                                                                                                                                                                                                                                                float gradientY = clamp((worldCoord.z + uvOffset.x + uvScale.x * 0.5) / uvScale.x, 0.0, 1.0);\n                                                                                                                                                                                                                                                                                                                                                float gradientZ = clamp((worldCoord.y + uvOffset.y + uvScale.y * 0.5) / uvScale.y, 0.0, 1.0);\n                                                                                                                                                                                                                                                                                                                                                vec3 gradientTop = mix(colorTop1, colorTop2, gradientX);\n                                                                                                                                                                                                                                                                                                                                                vec3 gradientRight = mix(colorRight1, colorRight2, gradientZ);\n                                                                                                                                                                                                                                                                                                                                                vec3 gradientFront = mix(colorFront1, colorFront2, gradientY);\n                                                                                                                                                                                                                                                                                                                                                vec3 outputColor = (gradientFront * lightStrengthY) + (gradientRight * lightStrengthX) + (gradientTop * lightStrengthZ);\n                                                                                                                                                                                                                                                                                                                                                World_Based_Gradients1472519140028_142_gl_FragColor = vec4(outputColor, 1.0);\n                                                                                                                                                                                                                                                                                                                                                return World_Based_Gradients1472519140028_142_gl_FragColor *= 1.0;\n                                                                                                                                                                                                                                                                                                                                            }\nvoid main() \n                                                                                                                                                                                                                                                                                                                                            {\n                                                                                                                                                                                                                                                                                                                                                gl_FragColor = (Cube_Edges1468788327926_62_main() + World_Based_Gradients1472519140028_142_main());                                                                                                                                                                                                                                                                                                                                            }\n",vertex:"precision highp float;\nprecision highp int;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 modelMatrix;\nattribute vec3 position;\nattribute vec2 uv;\nattribute vec3 normal;\nvarying vec2 vUv;\nvarying vec4 worldCoord;\nvarying float lightStrengthX;\nvarying float lightStrengthY;\nvarying float lightStrengthZ;\nvec3 lightPositionX = vec3(1.0, 0.0, 0.0);\nvec3 lightPositionY = vec3(0.0, 1.0, 0.0);\nvec3 lightPositionZ = vec3(0.0, 0.0, 1.0);\nfloat getLightStrength(vec3 lightPosition, vec3 norm) \n                                                                                                                                                                                                                                                                                                                                            {\n                                                                                                                                                                                                                                                                                                                                                return pow(min(abs(dot(normalize(norm), normalize(vec3(vec4(lightPosition, 1.0) * modelMatrix)))), 1.0), 2.0);\n                                                                                                                                                                                                                                                                                                                                            }\nvec4 Cube_Edges1468788327926_62_main() \n                                                                                                                                                                                                                                                                                                                                            {\n                                                                                                                                                                                                                                                                                                                                                vec4 Cube_Edges1468788327926_62_gl_Position = vec4(0.0);\n                                                                                                                                                                                                                                                                                                                                                vUv = uv;\n                                                                                                                                                                                                                                                                                                                                                Cube_Edges1468788327926_62_gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n                                                                                                                                                                                                                                                                                                                                                return Cube_Edges1468788327926_62_gl_Position *= 1.0;\n                                                                                                                                                                                                                                                                                                                                            }\nvec4 World_Based_Gradients1472519140028_142_main() \n                                                                                                                                                                                                                                                                                                                                            {\n                                                                                                                                                                                                                                                                                                                                                vec4 World_Based_Gradients1472519140028_142_gl_Position = vec4(0.0);\n                                                                                                                                                                                                                                                                                                                                                worldCoord = modelMatrix * vec4(position, 1.0);\n                                                                                                                                                                                                                                                                                                                                                lightStrengthX = getLightStrength(lightPositionX, normal);\n                                                                                                                                                                                                                                                                                                                                                lightStrengthY = getLightStrength(lightPositionY, normal);\n                                                                                                                                                                                                                                                                                                                                                lightStrengthZ = getLightStrength(lightPositionZ, normal);\n                                                                                                                                                                                                                                                                                                                                                World_Based_Gradients1472519140028_142_gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n                                                                                                                                                                                                                                                                                                                                                return World_Based_Gradients1472519140028_142_gl_Position *= 1.0;\n                                                                                                                                                                                                                                                                                                                                            }\nvoid main() \n                                                                                                                                                                                                                                                                                                                                            {\n                                                                                                                                                                                                                                                                                                                                                gl_Position = Cube_Edges1468788327926_62_main() + World_Based_Gradients1472519140028_142_main();                                                                                                                                                                                                                                                                                                                                            }\n",uniforms:{color:{value:{r:1,g:1,b:1},type:"c",glslType:"vec3"},brightness:{value:"10.04980631",type:"f",glslType:"float"},falloff:{value:"4.18104668",type:"f",glslType:"float"},uvScale:{value:{x:"1",y:"1",z:"1"},type:"v3",glslType:"vec3"},uvOffset:{value:{x:0,y:0,z:0},type:"v3",glslType:"vec3"},colorFront1:{value:{r:"0.3",g:"0.3",b:"0.3"},type:"c",glslType:"vec3"},colorFront2:{value:{r:"0.3",g:"0.3",b:"0.3"},type:"c",glslType:"vec3"},colorRight1:{value:{r:"0.4",g:"0.4",b:"0.4"},type:"c",glslType:"vec3"},colorRight2:{value:{r:"0.4",g:"0.4",b:"0.4"},type:"c",glslType:"vec3"},colorTop1:{value:{r:"0.4",g:"0.4",b:"0.4"},type:"c",glslType:"vec3"},colorTop2:{value:{r:"0.4",g:"0.4",b:"0.4"},type:"c",glslType:"vec3"}}},l={id:5962,name:"rejilla",fragment:"#define PI 3.1415926535897932384626433832795\n\nprecision highp float;\nprecision highp int;\nuniform float time;\nuniform float resolution;\nuniform float intensity;\nuniform float speed;\nuniform vec3 lightColor;\nuniform vec3 baseColor;\nvarying vec2 vUv;\nvarying vec3 vPosition;\nvec2 circuit(vec2 p) \n                                                                                                                                                                                                                                                                                                                                            {\n                                                                                                                                                                                                                                                                                                                                                p = fract(p);\n                                                                                                                                                                                                                                                                                                                                                float r = 0.3;\n                                                                                                                                                                                                                                                                                                                                                float v = 0.0, g = 1.0;\n                                                                                                                                                                                                                                                                                                                                                float d;\n                                                                                                                                                                                                                                                                                                                                                const int iter = 7;\n                                                                                                                                                                                                                                                                                                                                                for (int i = 0;\n i < iter; i++) \n                                                                                                                                                                                                                                                                                                                                                {\n                                                                                                                                                                                                                                                                                                                                                    d = p.x - r;\n                                                                                                                                                                                                                                                                                                                                                    g += pow(clamp(1.0 - abs(d), 0.0, 1.0), 200.0);\n                                                                                                                                                                                                                                                                                                                                                    if (d > 0.0) \n                                                                                                                                                                                                                                                                                                                                                    {\n                                                                                                                                                                                                                                                                                                                                                        p.x = (p.x - r) / (1.8 - r);\n                                                                                                                                                                                                                                                                                                                                                    }\n else \n                                                                                                                                                                                                                                                                                                                                                    {\n                                                                                                                                                                                                                                                                                                                                                        p.x = p.x;\n                                                                                                                                                                                                                                                                                                                                                    }\n                                                                                                                                                                                                                                                                                                                                                    p = p.yx;\n                                                                                                                                                                                                                                                                                                                                                }\n                                                                                                                                                                                                                                                                                                                                                v /= float(iter);\n                                                                                                                                                                                                                                                                                                                                                return vec2(g, v);\n                                                                                                                                                                                                                                                                                                                                            }\nvec4 Circuit_Grid1660733470007_170_main() \n                                                                                                                                                                                                                                                                                                                                            {\n                                                                                                                                                                                                                                                                                                                                                vec4 Circuit_Grid1660733470007_170_gl_FragColor = vec4(0.0);\n                                                                                                                                                                                                                                                                                                                                                vec2 uv = (vUv.xy + 0.5) * resolution;\n                                                                                                                                                                                                                                                                                                                                                vec2 cid2 = floor(uv);\n                                                                                                                                                                                                                                                                                                                                                float cid = (cid2.y + cid2.x);\n                                                                                                                                                                                                                                                                                                                                                vec2 dg = circuit(uv);\n                                                                                                                                                                                                                                                                                                                                                float d = dg.x;\n                                                                                                                                                                                                                                                                                                                                                vec3 col1 = (0.2 - vec3(max(min(d, 2.0) - 1.0, 0.0))) * baseColor;\n                                                                                                                                                                                                                                                                                                                                                vec3 col2 = vec3(max(d - 1.0, 0.0)) * lightColor;\n                                                                                                                                                                                                                                                                                                                                                float f = max(0.4 - mod(uv.y - uv.x + (time * speed) + (dg.y * 0.2), 2.5), 0.0) * intensity;\n                                                                                                                                                                                                                                                                                                                                                col2 *= f;\n                                                                                                                                                                                                                                                                                                                                                Circuit_Grid1660733470007_170_gl_FragColor = vec4(col1 + col2, 1.0);\n                                                                                                                                                                                                                                                                                                                                                return Circuit_Grid1660733470007_170_gl_FragColor *= 1.0;\n                                                                                                                                                                                                                                                                                                                                            }\nvoid main() \n                                                                                                                                                                                                                                                                                                                                            {\n                                                                                                                                                                                                                                                                                                                                                gl_FragColor = Circuit_Grid1660733470007_170_main();                                                                                                                                                                                                                                                                                                                                            }\n",vertex:"precision highp float;\nprecision highp int;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\nvarying vec2 vUv;\nvarying vec3 vPosition;\nvec4 Circuit_Grid1660733470007_170_main() \n                                                                                                                                                                                                                                                                                                                                            {\n                                                                                                                                                                                                                                                                                                                                                vec4 Circuit_Grid1660733470007_170_gl_Position = vec4(0.0);\n                                                                                                                                                                                                                                                                                                                                                vUv = uv;\n                                                                                                                                                                                                                                                                                                                                                vPosition = position;\n                                                                                                                                                                                                                                                                                                                                                Circuit_Grid1660733470007_170_gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n                                                                                                                                                                                                                                                                                                                                                return Circuit_Grid1660733470007_170_gl_Position *= 1.0;\n                                                                                                                                                                                                                                                                                                                                            }\nvoid main() \n                                                                                                                                                                                                                                                                                                                                            {\n                                                                                                                                                                                                                                                                                                                                                gl_Position = Circuit_Grid1660733470007_170_main();                                                                                                                                                                                                                                                                                                                                            }\n",uniforms:{time:{type:"f",glslType:"float"},resolution:{value:"4",type:"f",glslType:"float"},intensity:{value:"10",type:"f",glslType:"float"},speed:{value:"0.6",type:"f",glslType:"float"},lightColor:{value:{r:.1,g:.2,b:.3},type:"c",glslType:"vec3"},baseColor:{value:{r:.9,g:.9,b:.9},type:"c",glslType:"vec3"}}};var c=[["rojo",[.9137254901960784,.027450980392156862,.027450980392156862,1],[50],[6]],["violeta",[.8980392156862745,.027450980392156862,.9137254901960784,1],[50],[6]],["azul",[.027450980392156862,.615686274509804,.9137254901960784,1],[50],[6]],["verde",[.027450980392156862,.9137254901960784,.29411764705882354,1],[50],[6]],["amarillo",[.9137254901960784,.8823529411764706,.027450980392156862,1],[50],[6]],["naranja",[.9137254901960784,.33725490196078434,.027450980392156862,1],[50],[6]],["negro",[.9137254901960784,.027450980392156862,.027450980392156862,1],[50],[6]],["gris",[.3,.3,.3,1],[40],[4.3]],["pared",[.25,.25,.25,-.5],[80],[8]],["debug",[.85,.85,.85,-1],[50],[7]]],h={};function u(){}function d(){let t=arguments.length,e=arguments[0];if(t<2)return e;for(let i=1;i<t;i++){let t=arguments[i],n=Object.keys(t||{}),o=n.length;for(let i=0;i<o;i++){let o=n[i];e[o]=t[o]}}return e}h.cuboShader=a,h.rejilla=l,c.map(t=>{const e={r:t[1][0],g:t[1][1],b:t[1][2]},i=JSON.parse(JSON.stringify(a));i.uniforms.color.value={r:t[1][3],g:t[1][3],b:t[1][3]},i.uniforms.brightness.value=t[2],i.uniforms.falloff.value=t[3],i.uniforms.colorFront1.value=e,i.uniforms.colorFront2.value=e,h[`cubo-${t[0]}`]=i;const n=JSON.parse(JSON.stringify(a));n.uniforms.color.value={r:t[1][3],g:t[1][3],b:t[1][3]},n.uniforms.brightness.value=t[2],n.uniforms.falloff.value=t[3],n.uniforms.colorFront1.value=e,n.uniforms.colorFront2.value=e,n.uniforms.colorRight1.value=e,n.uniforms.colorRight2.value=e,n.uniforms.colorTop1.value=e,n.uniforms.colorTop2.value=e,h[`cubo-${t[0]}-complete`]=n;const o=JSON.parse(JSON.stringify(l));o.uniforms.lightColor.value=e,h[`wall-${t[0]}`]=o}),AFRAME.shaderfrog=h,u.prototype={mainCamera:null,cubeCameras:{},reserved:{time:null,cameraPosition:null},umap:{float:{type:"f",value:0},int:{type:"i",value:0},vec2:{type:"v2",value:()=>new THREE.Vector2},vec3:{type:"v3",value:()=>new THREE.Vector3},vec4:{type:"v4",value:()=>new THREE.Vector4},samplerCube:{type:"t"},sampler2D:{type:"t"}},get(t){let e=this.shaderTypes[t];return e.initted||this.create(t),e.material},add(t,e){let i,n=d({},e);for(var o in n.fragmentShader=e.fragment,n.vertexShader=e.vertex,delete n.fragment,delete n.vertex,n.uniforms)null===(i=n.uniforms[o]).value&&(n.uniforms[o].value=this.getUmap(i.glslType));return t in this.shaderTypes?d(this.shaderTypes[t],n):this.shaderTypes[t]=n,n},create(t){let e=this.shaderTypes[t];return delete e.id,e.material=new THREE.RawShaderMaterial(e),this.runningShaders.push(e),e.init&&e.init(e.material),e.material.needsUpdate=!0,e.material.side=THREE.DoubleSide,e.initted=!0,e.material},updateShaders(t,e){let i,n;for(e=e||{},n=0;i=this.runningShaders[n++];){for(let t in e.uniforms)t in i.material.uniforms&&(i.material.uniforms[t].value=e.uniforms[t]);"cameraPosition"in i.material.uniforms&&this.mainCamera&&(i.material.uniforms.cameraPosition.value=this.mainCamera.position.clone()),"viewMatrix"in i.material.uniforms&&this.mainCamera&&(i.material.uniforms.viewMatrix.value=this.mainCamera.matrixWorldInverse),"time"in i.material.uniforms&&(i.material.uniforms.time.value=t)}},shaderTypes:h,runningShaders:[]},AFRAME.registerSystem("shader-frog",{init:function(){window.frog_runtime=new u,this.clock=new THREE.Clock},tick:function(t){window.frog_runtime.updateShaders(this.clock.getElapsedTime())}}),AFRAME.registerComponent("shader-frog",{schema:{name:{type:"string"}},init:function(){this.originalMaterial=this.el.getObject3D("mesh").material,this.shaderData=h[this.data.name]},update:function(){window.frog_runtime.add(this.data.name,this.shaderData);var t=window.frog_runtime.get(this.data.name);this.el.getObject3D("mesh").material=t}});class m{constructor(t,e,i,n,o,s,r,a=!1){this.estado=0,this.el=document.createElement("a-box");var l=document.createElement("a-plane");l.setAttribute("id",r),l.setAttribute("visible","false"),l.setAttribute("class","boxCollider"),l.setAttribute("position","0 -0.53 0"),l.setAttribute("rotation","90 0 0"),l.setAttribute("scale","1 1 1"),l.setAttribute("shader-frog","name:cuboShader"),this.el.appendChild(l),this.el.setAttribute("geometry",{width:n.width,height:n.width,depth:n.depth}),this.el.setAttribute("class","stage"),this.el.setAttribute("shader-frog","name:cubo-rojo"),this.el.object3D.position.set(t,e,i),this.el.setAttribute("id",r)}}const g=10,v=[{p:"7 15 0",r:"0 90 0"},{p:"-7 15 0",r:"0 90 0"},{p:"0 15 -7",r:"0 180 0"},{p:"0 15 7",r:"0 -180 0"}],f=[{p:"-6.2 0 0",r:!1},{p:"6.2 0 0",r:!1},{p:"0 0 6.2",r:!0},{p:"0 0 -6.2",r:!0}];function p(t){const e=document.createElement("a-entity");return f.map((t,i)=>{const n=document.createElement("a-box");n.setAttribute("scale","-0.5 0.5 12"),n.setAttribute("position",t.p),n.setAttribute("shader-frog","name:cubo-pared"),t.r&&n.setAttribute("rotation","0 90 0"),e.appendChild(n)}),e.setAttribute("position",t),e}function b(t,e){const i=document.createElement("a-entity");i.setAttribute("position",t),i.setAttribute("rotation",e);let n=1;for(let t=0;t<3;t++)for(let e=0;e<50;e++){const o=1.5*Math.random()+1,s=Math.random()<.5?-1:1;let r=document.createElement("a-box");const a=1.1*Math.random()+.1,l=0===a?a-.1:a;r.setAttribute("position",`${t+1*t+s*l} ${-1*Math.random()+0} ${e+1*e}`),r.setAttribute("scale",`${o} 1 ${o}`),r.setAttribute("shader-frog","name:cubo-pared-complete"),i.appendChild(r),n+=1}return i}function y(){const t=document.createElement("a-entity");var e;return t.appendChild(b("-2 80 7.5","90 0 0")),t.appendChild(b("2 80 -7.5","90 0 -180")),t.appendChild(b("-7.5 80 -2","90 0 90")),t.appendChild(b("7.5 80 2","90 0 -90")),t.appendChild((e=document.createElement("a-entity"),v.map(t=>{var i=document.createElement("a-entity");i.setAttribute("position",t.p),i.setAttribute("rotation",t.r);for(let t=0;t<10;t++){var n=document.createElement("a-plane");n.setAttribute("class","walls"),n.setAttribute("scale","14 15 1"),n.setAttribute("position",`0 ${15*t-50} 0`),n.setAttribute("shader-frog","name:wall-rojo"),i.appendChild(n)}e.appendChild(i)}),e)),t.appendChild(function(){const t=document.createElement("a-entity");for(let e=0;e<7;e++)t.appendChild(p(`0 ${g*e} 0`));return t}()),t}const _=[{mods:[[85,84,74,64,54,44],[44,45,46,36,26,25,15]],key:[44],inicio:95,final:5,tiempoCiclo:10},{mods:[[15,25,35,34,33,32],[33,43,53,62,63,73,62,64,65,66,67,68],[57,77,87,67]],key:[33,67],inicio:5,final:97,tiempoCiclo:10},{mods:[[87,77,67,66,65,64,63,62],[63,73,83,92,93,94,95],[95,85,75,65,55,45,34,35,36,24,25,26],[36,37,27,17]],key:[63,95,36],inicio:97,final:7,tiempoCiclo:10},{mods:[[17,27,37,47,46,45,35],[35,34,33,43,53,54,63,64],[53,52,62,72,73,74,75,76,77,78],[75,85,86,87,88],[88,78,68,69,70,80,90]],key:[35,53,75,88],inicio:7,final:100,tiempoCiclo:10},{mods:[[90,89,88,87,86,85,84,83,82,72,62,63,64,65,66,67,68,69,70],[66,76,77,78,79,80],[79,88,89,98,97,96,95,94,93],[95,85,75,76,77,67,57,47,48,58,49,59,46,56,45,55,44,54],[56,66,65,64,63,53,43,33,34,35,36,37,38,39],[37,27,17,18,16,15,14]],key:[66,79,95,56,37],inicio:100,final:4,tiempoCiclo:15},{mods:[[5,6,7,8,9,18,28,38],[11,12,13,14,15,16,17,18,19,20,21,31,41,42,30,40,50,49,48,47,46,44,45,44],[46,36,26,25,24,23,33,43,53,63,73,62,61,64,65,66,67,68,69,70],[74,75,65,55,56,57,58,59,60],[69,59,49,39,29,19,18,17,27,37,47],[44,45,46,47,48,54,64,74,75,76,77,78,79],[48,49,50,60,70,80,90,89,88,87,86,85,84,83,82]],key:[18,46,65,59,47,48],inicio:4,final:94,tiempoCiclo:15},{mods:[[61,62,63,64,65,66,67,68,69,70,80,71,81,82,83,84,85,86,87,88,89,90],[68,78,77,76,75,74,73,72],[84,74,64,54,55,56,57,58,59,60,50,40,30,29,28,27,17,37,26,25,24,34,44,53,52],[36,37,38,46,45],[45,55,65,75,74,73,72,62,52,42,43,32,33,22],[43,44,34,24,25,26,27,28,29,39,49,59,69,58,68,67,67],[68,78,88,87,86,85,75,65,55],[53,54,55,56,57,47,37,27,43,33,23,24,14]],key:[68,74,37,45,43,68,55],inicio:94,final:4,tiempoCiclo:15}];var x=function(){var t,e,i,n,o,s=function(t){return Math.sin(6.283184*t)},r=function(t){return.003959503758*2**((t-128)/12)},a=function(t,e,i){var n,o,s,a,c,h,u=l[t.i[0]],d=t.i[1],m=t.i[3]/32,g=l[t.i[4]],v=t.i[5],f=t.i[8]/32,p=t.i[9],b=t.i[10]*t.i[10]*4,y=t.i[11]*t.i[11]*4,_=t.i[12]*t.i[12]*4,x=1/_,A=-t.i[13]/16,C=t.i[14],E=i*2**(2-t.i[15]),T=new Int32Array(b+y+_),w=0,S=0;for(n=0,o=0;n<b+y+_;n++,o++)o>=0&&(o-=E,c=r(e+(15&(C=C>>8|(255&C)<<4))+t.i[2]-128),h=r(e+(15&C)+t.i[6]-128)*(1+8e-4*t.i[7])),s=1,n<b?s=n/b:n>=b+y&&(s=(1-(s=(n-b-y)*x))*3**(A*s)),a=u(w+=c*s**m)*d,a+=g(S+=h*s**f)*v,p&&(a+=(2*Math.random()-1)*p),T[n]=80*a*s|0;return T},l=[s,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var e=t%1*4;return e<2?e-1:3-e}];this.init=function(s){t=s,e=s.endPattern,i=0,n=s.rowLen*s.patternLen*(e+1)*2,o=new Int32Array(n)},this.generate=function(){var r,c,h,u,d,m,g,v,f,p,b,y,_,x,A=new Int32Array(n),C=t.songData[i],E=t.rowLen,T=t.patternLen,w=0,S=0,L=!1,D=[];for(h=0;h<=e;++h)for(g=C.p[h],u=0;u<T;++u){var I=g?C.c[g-1].f[u]:0;I&&(C.i[I-1]=C.c[g-1].f[u+T]||0,I<17&&(D=[]));var R=l[C.i[16]],P=C.i[17]/512,B=2**(C.i[18]-9)/E,O=C.i[19],F=C.i[20],M=43.23529*C.i[21]*3.141592/44100,k=1-C.i[22]/255,U=1e-5*C.i[23],j=C.i[24]/32,$=C.i[25]/512,G=6.283184*2**(C.i[26]-9)/E,N=C.i[27]/255,W=C.i[28]*E&-2;for(b=(h*T+u)*E,d=0;d<4;++d)if(m=g?C.c[g-1].n[u+d*T]:0){D[m]||(D[m]=a(C,m,E));var V=D[m];for(c=0,r=2*b;c<V.length;c++,r+=2)A[r]+=V[c]}for(c=0;c<E;c++)(p=A[v=2*(b+c)])||L?(y=M,O&&(y*=R(B*v)*P+.5),S+=(y=1.5*Math.sin(y))*(_=k*(p-S)-(w+=y*S)),p=3==F?S:1==F?_:w,U&&(p=(p*=U)<1?p>-1?s(.25*p):-1:1,p/=U),L=(p*=j)*p>1e-5,x=p*(1-(f=Math.sin(G*v)*$+.5)),p*=f):x=0,v>=W&&(x+=A[v-W+1]*N,p+=A[v-W]*N),A[v]=0|x,A[v+1]=0|p,o[v]+=0|x,o[v+1]+=0|p}return++i/t.numChannels},this.createAudioBuffer=function(t){for(var e=t.createBuffer(2,n/2,44100),i=0;i<2;i++)for(var s=e.getChannelData(i),r=i;r<n;r+=2)s[r>>1]=o[r]/65536;return e},this.createWave=function(){var t=44+2*n-8,e=t-36,i=new Uint8Array(44+2*n);i.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var s=0,r=44;s<n;++s){var a=o[s];a=a<-32767?-32767:a>32767?32767:a,i[r++]=255&a,i[r++]=a>>8&255}return i},this.getData=function(t,e){for(var i=2*Math.floor(44100*t),n=new Array(e),s=0;s<2*e;s+=1){var r=i+s;n[s]=t>0&&r<o.length?o[r]/32768:0}return n}};let A=[];const C=[{songData:[{i:[2,100,128,0,3,201,128,0,0,0,0,6,29,0,0,0,0,194,4,1,3,25,191,115,244,147,6,84,6],p:[],c:[]},{i:[0,255,117,64,0,255,110,0,64,0,4,6,35,0,0,0,0,0,0,0,2,14,1,1,39,76,5,0,0],p:[,1,1,1,1,1,1,2,,,,1,1,1,1,1,1,,,1,1,1,1,1,1],c:[{n:[147,,,,,,147,,,,147,,,,,,147,,,,,,147,,,,147,,,,147],f:[]},{n:[147],f:[]}]},{i:[0,0,140,0,0,0,140,0,0,60,4,10,68,0,0,0,0,187,5,0,1,239,135,0,32,108,5,16,4],p:[,1,1,2,3,2,3,4,,,,2,3,2,3,2,3,,,5,5,5,5,5,5,4],c:[{n:[,,,,147,,,,,,,,148,,,,,,,,147,,,,,,,,147],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,35]},{n:[,,,,147,,,147,,,,,148,,,,,,,,147,,,147,,,147,,,,147],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,35]},{n:[,,,,147,,,147,,,,,148,,,,,,,,147,,,147,,,147,,,147,147,147],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,35]},{n:[147],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,68]},{n:[147,,,147,,,147,,147,,,147,,147,,147,147,,,147,,,147,,147,,,147,,147,,147],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,35]}]},{i:[2,192,128,0,2,192,140,18,0,0,107,115,138,0,0,0,0,136,5,1,2,8,92,21,8,148,5,85,8],p:[3,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2],c:[{n:[111],f:[]},{n:[114],f:[]},{n:[111],f:[25,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,25,5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,56]}]},{i:[3,0,127,0,3,32,127,0,64,218,4,4,40,0,0,0,1,55,4,1,2,28,115,124,190,67,6,39,1],p:[,,,1,2,1,2,3,,,,1,2,1,2,1,2,,,1,4,1,4,1,4,3],c:[{n:[,,,,147,,,,,,,,147,,,,,,,,147,,,,,,,,147],f:[]},{n:[,,,,147,,,,,,,,147,,,,,,,,147,,,,,,,,147,,147,147],f:[]},{n:[147],f:[]},{n:[,,,,147,,,,,,,,147,,,,,,,,147,,,,,,,,147,,,147],f:[]}]},{i:[0,91,128,0,0,95,123,15,0,0,12,0,89,0,0,0,0,0,0,0,2,30,61,0,20,131,0,88,4],p:[,,,1,2,3,2,1,2,,,1,2,3,2,1,2,,,,,4,5,4,5],c:[{n:[159,,147,,154,,147,,157,,147,,154,,150,,159,,147,,154,,147,,162,,147,,154,,150,,123],f:[5,13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,67]},{n:[159,,147,,154,,147,,157,,147,,154,,150,,159,,147,,154,,147,,162,,147,,157,,162,,126],f:[]},{n:[159,,147,,154,,147,,157,,147,,154,,150,,159,,147,,154,,147,,162,,147,,154,,150,,123],f:[5,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,3]},{n:[159,,162,,164,,,,159,,162,164,,,162,,159,,162,,164,,,,159,,162,164,,,162],f:[13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,25]},{n:[157,,162,,164,,,,157,,162,164,,,162,,157,,162,,164,,,,157,,162,164,,,162],f:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,67]}]}],rowLen:5513,patternLen:32,endPattern:25,numChannels:6},{songData:[{i:[0,0,140,0,0,0,148,0,0,255,158,158,158,0,0,0,0,109,2,1,2,20,233,0,32,88,1,144,2],p:[1],c:[{n:[104,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,141],f:[18,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,22,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,88,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,20]}]}],rowLen:5513,patternLen:110,endPattern:0,numChannels:1},{songData:[{i:[0,255,106,64,0,255,106,0,64,0,5,7,164,0,0,0,0,0,0,0,2,255,0,3,27,83,5,125,1],p:[1],c:[{n:[147],f:[18,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,88]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1},{songData:[{i:[0,91,128,0,0,95,128,12,0,0,12,0,72,0,0,0,0,0,0,0,2,255,0,0,32,83,3,130,4],p:[1],c:[{n:[125],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1}];class E{constructor(t){this.ctx=t,this.timeout1,this.timeout2,this.intervalsAllowed=!1,this.targetPosition=new THREE.Vector3,this.menFinal="",this.i=0}setdebug(t,e){this.ctx.debug&&e?(t.removeAttribute("shader-frog"),t.setAttribute("shader-frog","name:cubo-debug")):this.ctx.debug&&!e&&(t.setAttribute("shader-frog",""),this.changeColor(t,c[this.ctx.level-1][0],!1))}gameRun(){setTimeout(()=>{this.intervalsAllowed=!0,this.dispatch(o.RISEUP)},3e3)}dispatch(t){this.ctx.state.v===n.PLAY&&(t===o.RISEUP?this.intervalsAllowed&&(this.movimiento(o.RISEUP),this.timeout1=setTimeout(function(){this.dispatch(o.RISEDOWN),this.ctx.level_count<this.ctx.Gamelevel.mods.length-1?this.ctx.level_count+=1:this.ctx.level_count=0,clearTimeout(this.timeout1)}.bind(this),1e3*this.ctx.Gamelevel.tiempoCiclo)):this.intervalsAllowed&&(this.ctx.camera.emit(o.RISEDOWN,{}),this.movimiento(o.RISEDOWN),this.timeout2=setTimeout(function(){this.dispatch(o.RISEUP),clearTimeout(this.timeout2)}.bind(this),1e3)))}movimiento(t){t===o.RISEUP&&this.ctx.fx&&setTimeout(()=>{A[2].play()},500),this.ctx.Gamelevel.mods[this.ctx.level_count].map(e=>{const i=this.ctx.Gamelevel.key[this.ctx.level_count];if(t===o.RISEDOWN&&e!==i?this.getCube(e).emit(o.CUBEDOWN,{}):t===o.RISEDOWN&&e===i&&this.setdebug(this.getCube(e),!1),t===o.RISEUP){0!==this.getCube(e).getAttribute("position").y&&(this.getCube(e).emit(o.CUBEUP,{}),e===i&&this.setdebug(this.getCube(e),!0))}})}setTarget(){const t=document.getElementById(s.CUBO_777),e=this.getCube(this.ctx.Gamelevel.final);let i=new THREE.Vector3;e.object3D.getWorldPosition(i),t.object3D.position.set(i.x,0,i.z),this.targetPosition=i}setInit(){const t=this.ctx.isVR?.8:1.8,e=document.getElementById(s.CUBO_0),i=this.getCube(this.ctx.Gamelevel.inicio);let n=new THREE.Vector3;i.object3D.getWorldPosition(n),e.object3D.position.set(n.x,0,n.z),this.ctx.rig.object3D.position.set(n.x,t,n.z)}resetPosition(){if(this.ctx.rig.object3D.rotation.set(0,0,0),this.setTarget(),this.setInit(),this.ctx.level%2!=0&&!this.ctx.isVR){this.ctx.rig.setAttribute("rotation","0 -180 0");var t=this.ctx.rig.getAttribute("rotation");this.ctx.rig.components["look-controls"].pitchObject.rotation.x=THREE.Math.degToRad(t.x),this.ctx.rig.components["look-controls"].yawObject.rotation.y=THREE.Math.degToRad(t.y)}this.ctx.isVR&&(this.ctx.level%2!=0?this.ctx.rig.setAttribute("rotation","0 180 0"):this.ctx.rig.setAttribute("rotation","0 -180 0"))}fallingDown(){A[1].play(),this.clearTimeouts(),this.ctx.rig.emit(o.FALL,{}),this.ctx.fade.emit(o.FADEIN,{}),setTimeout(()=>{this.downCubes(),this.ctx.level_count=0,this.ctx.state.set(n.STARTPLAY)},1300)}downCubes(){const t=document.getElementsByClassName("stage");for(let e of t)e.object3D.position.setY(40)}clearTimeouts(){this.intervalsAllowed=!1,clearTimeout(this.timeout1),clearTimeout(this.timeout2)}getCube(t){return document.getElementById(`cubo_${t}`)}setSound(){this.ctx.fx&&setTimeout(()=>{A[0].play(),A[0].loop=!0},1e3)}setMusic(){this.ctx.music&&setTimeout(()=>{A[3].volume=.3,A[3].play(),A[3].loop=!0},1e3)}hideShowUI(t,e){document.getElementById(e).style.display=t?"block":"none"}setLevel(){this.ctx.Gamelevel=_[this.ctx.level-1],this.ctx.levelDesign.setAttribute("position",`0 ${-10*(this.ctx.level-1)} 0`),this.ctx.gameCubes.setAttribute("position",`4.7 ${-10*(this.ctx.level-1)} 4.7`),this.changeAllColors(),this.changeColor(document.getElementById(s.CUBO_0),c[this.ctx.level-1][0],!1),this.changeColor(document.getElementById(s.CUBO_777),c[this.ctx.level][0],!1)}changeAllColors(){let t=document.getElementsByClassName("stage");for(let e of t){const t=this.ctx.level-1==6?"rojo":c[this.ctx.level-1][0];this.changeColor(e,t,!1),this.changeBoxProp(e)}t=document.getElementsByClassName("walls");for(let e of t){const t=this.ctx.level-1==6?"rojo":c[this.ctx.level-1][0];e.removeAttribute("shader-frog"),e.setAttribute("shader-frog",`name:wall-${t}`)}}changeBoxProp(t){const e=t.object3D.position.x,i=t.object3D.position.z;t.removeAttribute("animation__a1"),t.removeAttribute("animation__a2"),t.setAttribute("animation__a1",`startEvents: ${o.CUBEDOWN};property: position; to: ${e} 40 ${i};easing: easeInCubic;delay: ${600*Math.random()}`),t.setAttribute("animation__a2",`startEvents: ${o.CUBEUP};property: position; to: ${e} ${-10*(this.ctx.level-1)} ${i};easing: easeOutCubic;delay: ${600*Math.random()}`)}changeColor(t,e,i){t.removeAttribute("shader-frog");const n=i?`name:cubo-${e}-complete`:`name:cubo-${e}`;t.setAttribute("shader-frog",n)}changeTargets(){this.ctx.initCubo.getAttribute("id")===s.CUBO_0?(this.ctx.initCubo.setAttribute("id",s.CUBO_777),this.ctx.finalCubo.setAttribute("id",s.CUBO_0)):(this.ctx.initCubo.setAttribute("id",s.CUBO_0),this.ctx.finalCubo.setAttribute("id",s.CUBO_777))}setTargetCube(){this.changeColor(document.getElementById(s.CUBO_777),c[this.ctx.level][0],!1),this.setTarget()}storage(t){this.ctx.debug=document.getElementById("nochall").checked,t?localStorage.setItem("box_99_level",this.ctx.level.toString()):null===localStorage.getItem("box_99_level")?localStorage.setItem("box_99_level","1"):this.ctx.level=parseInt(localStorage.getItem("box_99_level"))}nextLevel(){this.clearTimeouts(),this.downCubes(),this.changeTargets(),this.ctx.level+=1,this.ctx.Gamelevel=_[this.ctx.level-1],this.setTargetCube(),this.changeAllColors(),this.storage(!0),this.ctx.level_count=0,this.ctx.levelDesign.removeAttribute("animation__a1"),this.ctx.levelDesign.setAttribute("animation__a1",`startEvents: ${o.DOWNSTAGE};property: object3D.position.y; to:${-10*(this.ctx.level-1)};easing:easeInOutCubic;dur:2000`),this.ctx.gameCubes.setAttribute("position",`4.7 ${-10*(this.ctx.level-1)} 4.7s`),this.ctx.levelDesign.emit(o.DOWNSTAGE,null,!1),setTimeout(()=>{this.ctx.state.set(n.PLAY)},3e3)}setSettings(){this.ctx.music=!!document.getElementById("music").checked,this.ctx.fx=!!document.getElementById("fx").checked}end(){this.ctx.fade.emit(o.FADEIN,{}),setTimeout(()=>{A[3].pause(),localStorage.setItem("box_99_level","1"),this.ctx.gameCubes.setAttribute("visible","false"),this.ctx.levelDesign.setAttribute("visible","false"),this.ctx.initCubo.setAttribute("visible","false"),this.ctx.finalCubo.setAttribute("visible","false"),this.ctx.fade.emit(o.FADEOUT,{}),this.ctx.sky.setAttribute("color","#ae0e0e"),this.ctx.isVR&&this.ctx.log.setAttribute("scale","0.6 0.6 0.6"),this.typeText()},1e3)}typeText(){this.i<r.length&&(this.menFinal+=r.charAt(this.i),this.ctx.log.setAttribute("text","value",this.menFinal),this.i++,setTimeout(this.typeText.bind(this),50))}}AFRAME.registerComponent("cheap-collider",{init:function(){this.isHit=!0,this.key=null,this.game=null,this.ready=!1,this.el.sceneEl.addEventListener("loaded",()=>{this.game=document.querySelector("a-scene").systems.game,this.ready=!0}),this.el.addEventListener("raycaster-intersection",t=>{this.key=parseInt(t.detail.els[0].id.split("_")[1]),this.isHit=!0,this.evaluate(t)}),this.el.addEventListener("raycaster-intersection-cleared",t=>{if(this.ready&&this.game.state.v===n.PLAY){this.isHit=!1;var e=setTimeout(()=>{this.isHit||this.game.state.set(n.FALLING),clearTimeout(e)},200)}})},evaluate:function(){this.ready&&this.game.state.v===n.PLAY&&(777===this.key&&7!==this.game.level?this.game.state.set(n.NEXTLEVEL):777===this.key&&7===this.game.level&&this.game.state.set(n.END))}});i(0),i(1);AFRAME.registerSystem("game",{schema:{},init:function(){this.isVR=!1,this.debug=!1,this.music=!0,this.fx=!0,this.timeFall=900,this.level=1,this.state={v:n.START,set:t=>{this.state.v=t,this.gameControlState()}},this.scene=this.el.sceneEl,this.camera=document.getElementById("camera"),this.collider=document.getElementById("collisionRay"),this.collider.setAttribute("look-down",""),this.collider.setAttribute("cheap-collider",""),this.rig=document.getElementById("rig"),this.rig.setAttribute("animation__a2",`dur:${this.timeFall};startEvents: ${o.FALL};property: position;to: 0 -20 0`),this.fade=document.getElementById("fade"),this.fade.setAttribute("animation__a1",`startEvents: ${o.FADEIN};property: material.opacity;from: 0 ; to: 1;dur:${this.timeFall}`),this.fade.setAttribute("animation__a2",`startEvents: ${o.FADEOUT};property: material.opacity;from: 1 ; to: 0;dur:${this.timeFall}`),this.gameCubes=function(){const t=document.createElement("a-entity");t.setAttribute("id","gameCubes"),t.setAttribute("position","4.7 0 4.7"),t.setAttribute("rotation","0 270 180");let e=1;for(let i=0;i<10;i++)for(let n=0;n<10;n++){let o=new m(i+.2,40,n+.2,{width:.95,height:.95,depth:.95},0,!1,`cubo_${e}`);t.appendChild(o.el),e+=1}return t}(),this.scene.appendChild(this.gameCubes),this.levelDesign=y(),this.scene.appendChild(this.levelDesign),this.sky=document.getElementById("sky"),this.initCubo=document.createElement("a-box"),this.initCubo.setAttribute("id","cubo_0"),this.initCubo.setAttribute("class","initCube"),this.scene.appendChild(this.initCubo),this.finalCubo=document.createElement("a-box"),this.finalCubo.setAttribute("id","cubo_777"),this.finalCubo.setAttribute("class","endCube"),this.scene.appendChild(this.finalCubo),this.Gamelevel,this.level_count=0,this.gc=new E(this),this.log=document.getElementById("log"),document.getElementById("bdk").addEventListener("click",t=>{this.gc.storage(!1),this.gc.hideShowUI(!1,"mainUI"),this.state.set(n.STARTPLAY)}),document.getElementById("bvr").addEventListener("click",()=>{this.isVR=!0,this.gc.storage(!1),this.gc.hideShowUI(!1,"mainUI"),this.rig.setAttribute("move-control",""),this.rig.removeAttribute("look-controls"),this.rig.removeAttribute("awsd-controls"),this.state.set(n.STARTPLAY)}),this.scene.addEventListener("loaded",()=>{C.map(t=>{const e=new x;e.init(t);let i=!1;setInterval(()=>{if(!i&&(i=e.generate()>=1)){var t=e.createWave(),n=document.createElement("audio");n.src=URL.createObjectURL(new Blob([t],{type:"audio/wav"})),A.push(n)}})})})},gameControlState(){switch(this.state.v){case n.STARTPLAY:this.gc.setSettings(),this.gc.setSound(),this.gc.setMusic(),this.gc.setLevel(),this.gc.resetPosition(),this.state.set(n.PLAY),this.fade.emit(o.FADEOUT,{});break;case n.PLAY:this.gc.gameRun();break;case n.FALLING:this.gc.fallingDown();break;case n.NEXTLEVEL:this.gc.nextLevel();break;case n.END:this.gc.end()}}}),document.addEventListener("DOMContentLoaded",function(){var t=document.getElementById("save"),e=document.getElementById("reset"),i=localStorage.getItem("box_99_level");null!==i&&"1"!==i&&(t.classList.remove("dn"),e.classList.remove("dn"),t.innerHTML="saved LEVEL "+i),window.resetLevel=()=>{localStorage.setItem("box_99_level","1"),t.classList.add("dn"),e.classList.add("dn")}});i(2)}]);</script></body></html>