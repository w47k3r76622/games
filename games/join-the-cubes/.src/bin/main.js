import{canvas,gl}from"./init.js";import{handleActions}from"./logic.js";import{changeMap,maps}from"./maps.js";import{animate,projection}from"./render.js";const overlay=document.getElementById("overlay");overlay.addEventListener("click",()=>{document.documentElement.requestFullscreen(),overlay.classList.contains("game")&&overlay.requestPointerLock()});{const e=["info","level","credits"];e.forEach(e=>{const t=document.getElementById(e);t.classList.add("button"),t.addEventListener("click",()=>{overlay.classList.add(e)})}),e.push("game");const t=document.getElementById("back");t.classList.add("button"),t.addEventListener("click",()=>{e.forEach(e=>{overlay.classList.remove(e)})})}const levelsList=document.getElementById("level-contents");maps.list.forEach((e,t)=>{const n=document.createElement("div");n.id="level-"+t,n.classList.add("button"),n.innerHTML=(t+1).toString().padStart(2,t<5?"T":"0"),n.addEventListener("click",()=>{changeMap(t),n.classList.add("visited"),overlay.requestPointerLock(),overlay.classList.add("game"),overlay.classList.remove("level")}),levelsList.appendChild(n)});const resizeCanvas=()=>{canvas.width=window.innerWidth,canvas.height=window.innerHeight,gl.viewport(0,0,canvas.width,canvas.height),projection.perspective(Math.PI/3,canvas.width/canvas.height,.1,1e3)};resizeCanvas(),window.addEventListener("resize",resizeCanvas);const currentActions=new Set;window.addEventListener("keydown",({code:e})=>{void 0!==e&&currentActions.add(e)}),window.addEventListener("keyup",({code:e})=>{void 0!==e&&currentActions.delete(e)});let prevTime=performance.now();function renderLoop(e){const t=(e-prevTime)/1e3;handleActions(maps.current,currentActions.values()),currentActions.clear(),animate(t,e,maps.current),prevTime=e,requestAnimationFrame(renderLoop)}requestAnimationFrame(renderLoop);