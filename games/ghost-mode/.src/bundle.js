(()=>{"use strict";let t=()=>{};let i,e,s={};function h(t,...i){(s[t]||[]).map((t=>t(...i)))}let n={get:(i,e)=>"_proxy"==e||t};function a(){return e}function r(t,i,e){return Math.min(Math.max(t,e),i)}function o(t,i){return[t,i]=[t,i].map((t=>function(t){let{x:i=0,y:e=0,width:s,height:h}=t.world||t;return t.mapwidth&&(s=t.mapwidth,h=t.mapheight),t.anchor&&(i-=s*t.anchor.x,e-=h*t.anchor.y),s<0&&(i+=s,s*=-1),h<0&&(e+=h,h*=-1),{x:i,y:e,width:s,height:h}}(t))),t.x<i.x+i.width&&t.x+t.width>i.x&&t.y<i.y+i.height&&t.y+t.height>i.y}class l{constructor(t=0,i=0,e={}){this.x=t,this.y=i,e._c&&(this.clamp(e._a,e._b,e._d,e._e),this.x=t,this.y=i)}add(t){return new l(this.x+t.x,this.y+t.y,this)}subtract(t){return new l(this.x-t.x,this.y-t.y,this)}scale(t){return new l(this.x*t,this.y*t)}normalize(t=this.length()){return new l(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}clamp(t,i,e,s){this._c=!0,this._a=t,this._b=i,this._d=e,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?r(this._a,this._d,t):t}set y(t){this._y=this._c?r(this._b,this._e,t):t}}function d(){return new l(...arguments)}class c extends class{constructor(t){return this.init(t)}init(t={}){this.position=d(),this.velocity=d(),this.acceleration=d(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let i=this.acceleration;t&&(i=i.scale(t)),this.velocity=this.velocity.add(i);let e=this.velocity;t&&(e=e.scale(t)),this.position=this.position.add(e),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}{init({width:t=0,height:i=0,context:e=a(),render:s=this.draw,update:h=this.advance,children:n=[],anchor:r={x:0,y:0},opacity:o=1,rotation:l=0,scaleX:d=1,scaleY:c=1,...g}={}){this._c=[],super.init({width:t,height:i,context:e,anchor:r,opacity:o,rotation:l,scaleX:d,scaleY:c,...g}),this._di=!0,this._uw(),this.addChild(n),this._rf=s,this._uf=h}update(t){this._uf(t),this.children.map((i=>i.update&&i.update(t)))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),1==this.scaleX&&1==this.scaleY||t.scale(this.scaleX,this.scaleY);let i=-this.width*this.anchor.x,e=-this.height*this.anchor.y;(i||e)&&t.translate(i,e),this.context.globalAlpha=this.opacity,this._rf(),(i||e)&&t.translate(-i,-e),this.children.map((t=>t.render&&t.render())),t.restore()}draw(){}_pc(){this._uw(),this.children.map((t=>t._pc()))}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:i=0,_wo:e=1,_wr:s=0,_wsx:h=1,_wsy:n=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=e*this.opacity,this._wsx=h*this.scaleX,this._wsy=n*this.scaleY,this._wx=this._wx*h,this._wy=this._wy*n,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wr=s+this.rotation;let{x:a,y:r}=function(t,i){let e=Math.sin(i),s=Math.cos(i);return{x:t.x*s-t.y*e,y:t.x*e+t.y*s}}({x:this._wx,y:this._wy},s);this._wx=a,this._wy=r,this._wx+=t,this._wy+=i}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...i){i.flat().map((i=>{this.children.push(i),i.parent=this,i._pc=i._pc||t,i._pc()}))}removeChild(...t){t.flat().map((t=>{(function(t,i){let e=t.indexOf(i);if(-1!=e)return t.splice(e,1),!0})(this.children,t)&&(t.parent=null,t._pc())}))}get opacity(){return this._opa}set opacity(t){this._opa=t,this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,i=t){this.scaleX=t,this.scaleY=i}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class g extends c{init({image:t,width:i=(t?t.width:void 0),height:e=(t?t.height:void 0),...s}={}){super.init({image:t,width:i,height:e,...s})}get animations(){return this._a}set animations(t){let i,e;for(i in this._a={},t)this._a[i]=t[i].clone(),e=e||this._a[i];this.currentAnimation=e,this.width=this.width||e.width,this.height=this.height||e.height}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){super.advance(t),this.currentAnimation&&this.currentAnimation.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}function y(t){let i=t.canvas;t.clearRect(0,0,i.width,i.height)}function w({fps:i=60,clearCanvas:e=!0,update:s=t,render:n,context:r=a(),blur:o=!1}={}){if(!n)throw Error("You must provide a render() function");let l,d,c,g,w,p=0,u=1e3/i,f=1/i,m=e?y:t,x=!0;function v(){if(d=requestAnimationFrame(v),x&&(c=performance.now(),g=c-l,l=c,!(g>1e3))){for(h("tick"),p+=g;p>=u;)w.update(f),p-=u;m(r),w.render()}}return o||(window.addEventListener("focus",(()=>{x=!0})),window.addEventListener("blur",(()=>{x=!1}))),w={update:s,render:n,isStopped:!0,start(){l=performance.now(),this.isStopped=!1,requestAnimationFrame(v)},stop(){this.isStopped=!0,cancelAnimationFrame(d)},_frame:v,set _last(t){l=t}},w}new WeakMap;let p={},u={},f={},m={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function x(i=t,e){i._pd&&e.preventDefault(),i(e)}function v(t){let i=m[t.code],e=p[i];f[i]=!0,x(e,t)}function _(t){let i=m[t.code],e=u[i];f[i]=!1,x(e,t)}function b(){f={}}function T(t,i,{handler:e="keydown",preventDefault:s=!0}={}){let h="keydown"==e?p:u;i._pd=s,[].concat(t).map((t=>h[t]=i))}function P(t){return!!f[t]}const L=(t,...i)=>{const e=t.canvas;t.fillStyle="white",t.font="22px Sans-serif";for(let s=0;s<i.length;s++){const h=i[s],n=13*h.length,a=e.width/2-n/2,r=.25*e.height+40*s;t.fillText(h,a,r)}},S=(()=>{const t=document.createElement("canvas");t.width=30,t.height=300;const i=t.getContext("2d");if(i){i.save();for(let t=0;t<4.6875;t++)i.fillStyle="rgb(80,20,20)",i.fillRect(0,64*t,10,64),i.fillRect(20,64*t,7.5,64),i.fillStyle="rgb(100,60,60)",i.fillRect(0,64*t+32,30,6.4);i.restore()}return t})();class C extends g{constructor(){super({width:30,height:300,image:S})}}class k extends c{constructor(){super({color:"green",width:200,height:20})}draw(){const t=this.context;t.save(),t.fillStyle=this.color,t.fillRect(0,0,this.width,this.height),t.fillStyle="#00A000",t.fillRect(0,0,this.width,this.height/4),t.restore()}}function M(){var t,i,e,s,h,n=function(t){return Math.sin(6.283184*t)},a=function(t){return.003959503758*Math.pow(2,(t-128)/12)},r=function(t,i,e){var s,h,n,r,l,d,c,g=o[t.i[0]],y=t.i[1],w=t.i[3],p=o[t.i[4]],u=t.i[5],f=t.i[8],m=t.i[9],x=t.i[10]*t.i[10]*4,v=t.i[11]*t.i[11]*4,_=t.i[12]*t.i[12]*4,b=1/_,T=t.i[13],P=e*Math.pow(2,2-t.i[14]),L=new Int32Array(x+v+_),S=0,C=0;for(s=0,h=0;s<x+v+_;s++,h++)h>=0&&(h-=P,d=a(i+(15&(T=T>>8|(255&T)<<4))+t.i[2]-128),c=a(i+(15&T)+t.i[6]-128)*(1+8e-4*t.i[7])),n=1,s<x?n=s/x:s>=x+v&&(n-=(s-x-v)*b),r=d,w&&(r*=n*n),l=g(S+=r)*y,r=c,f&&(r*=n*n),l+=p(C+=r)*u,m&&(l+=(2*Math.random()-1)*m),L[s]=80*l*n|0;return L},o=[n,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var i=t%1*4;return i<2?i-1:3-i}];this.init=function(n){t=n,i=n.endPattern,e=0,s=n.rowLen*n.patternLen*(i+1)*2,h=new Int32Array(s)},this.generate=function(){var a,l,d,c,g,y,w,p,u,f,m,x,v,_,b=new Int32Array(s),T=t.songData[e],P=t.rowLen,L=t.patternLen,S=0,C=0,k=!1,M=[];for(d=0;d<=i;++d)for(w=T.p[d],c=0;c<L;++c){var D=w?T.c[w-1].f[c]:0;D&&(T.i[D-1]=T.c[w-1].f[c+L]||0,D<16&&(M=[]));var F=o[T.i[15]],A=T.i[16]/512,V=Math.pow(2,T.i[17]-9)/P,E=T.i[18],R=T.i[19],I=43.23529*T.i[20]*3.141592/44100,O=1-T.i[21]/255,z=1e-5*T.i[22],G=T.i[23]/32,W=T.i[24]/512,Y=6.283184*Math.pow(2,T.i[25]-9)/P,H=T.i[26]/255,U=T.i[27]*P&-2;for(m=(d*L+c)*P,g=0;g<4;++g)if(y=w?T.c[w-1].n[c+g*L]:0){M[y]||(M[y]=r(T,y,P));var X=M[y];for(l=0,a=2*m;l<X.length;l++,a+=2)b[a]+=X[l]}for(l=0;l<P;l++)(f=b[p=2*(m+l)])||k?(x=I,E&&(x*=F(V*p)*A+.5),C+=(x=1.5*Math.sin(x))*(v=O*(f-C)-(S+=x*C)),f=3==R?C:1==R?v:S,z&&(f=(f*=z)<1?f>-1?n(.25*f):-1:1,f/=z),k=(f*=G)*f>1e-5,_=f*(1-(u=Math.sin(Y*p)*W+.5)),f*=u):_=0,p>=U&&(_+=b[p-U+1]*H,f+=b[p-U]*H),b[p]=0|_,b[p+1]=0|f,h[p]+=0|_,h[p+1]+=0|f}return++e/t.numChannels},this.createWave=function(){var t=44+2*s-8,i=t-36,e=new Uint8Array(44+2*s);e.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&i,i>>8&255,i>>16&255,i>>24&255]);for(var n=0,a=44;n<s;++n){var r=h[n];r=r<-32767?-32767:r>32767?32767:r,e[a++]=255&r,e[a++]=r>>8&255}return e},this.getData=function(t,i){for(var e=2*Math.floor(44100*t),s=new Array(i),n=0;n<2*i;n+=1){var a=e+n;s[n]=t>0&&a<h.length?h[a]/32768:0}return s}}const D="main",F="jump",A=document.createElement("audio"),V=document.createElement("audio"),E=document.createElement("audio"),R=(t,i,e)=>new Promise((s=>{var h=new M;h.init(i);var n=!1;setInterval((function(){if(!n&&(n=h.generate()>=1)){var i=h.createWave();t.src=URL.createObjectURL(new Blob([i],{type:"audio/wav"})),t.loop=e,s()}}),0)})),I=(t,i=0)=>{var e=t.volume;if(t.volume>i)var s=setInterval((function(){(e=(parseFloat(e)-.1).toFixed(1))>i?t.volume=e:(t.volume=i,0===i&&t.pause(),clearInterval(s))}),100)},O=(t,i=1)=>{t.play();var e=t.volume;if(t.volume<i)var s=setInterval((function(){(e=(parseFloat(e)+.1).toFixed(1))<i?t.volume=e:(t.volume=i,clearInterval(s))}),100)},z=t=>{switch(t){case D:O(A,.9);break;case"end":O(E,.5),I(A);break;case F:V.currentTime=0,V.play();break;case"finished":I(A,.05);break;case"start":A.volume=0;var i=A.play();void 0!==i&&i.then((()=>{})).catch((t=>{console.log("No for autoplay!"+t)})),I(A),A.currentTime=0}},G=new Image;G.src="stand.png";const W=new Image;W.src="walk.png";const Y=new Image;Y.src="climb.png";const H=new Image;var U;H.src="climbright.png",function(t){t[t.OnPlatform=0]="OnPlatform",t[t.Falling=1]="Falling",t[t.Dropping=2]="Dropping",t[t.Climbing=3]="Climbing",t[t.Dead=4]="Dead"}(U||(U={}));class X extends c{constructor(t){super({width:60,height:90}),this.level=t,this.xVel=0,this.yVel=0,this.latestOnPlatformTime=0,this.state=U.OnPlatform,this.fallingToGround=!1,this.stopClimbing=!1,this.moveLeft=!1,this.moveLeftFoot=0,this.walkingSpeed=5,this.died=()=>{}}isOnGround(){return this.y+this.height>this.level.height-5}isDead(){return this.state===U.Dead}die(){this.state!==U.Dead&&(this.state=U.Dead,this.died(),z("end"))}resurrect(){this.state===U.Dead&&(this.state=U.OnPlatform,this.width=60,this.height=90,this.xVel=0,this.yVel=0,this.fallingToGround=!1,this.stopClimbing=!1)}hasJustDropped(){return null!=this.dropStartTime&&performance.now()-this.dropStartTime<400}draw(){const t=this.context;t.save(),this.isDead()||this.fallingToGround?(t.translate(0,this.height),t.rotate(-Math.PI/2)):this.state===U.Climbing?this.moveLeftFoot<5?this.image=Y:this.image=H:(this.moveLeft&&(t.translate(30,0),t.scale(-1,1),t.translate(-30,0)),this.moveLeftFoot<this.walkingSpeed?this.image=G:this.image=W),this.moveLeftFoot>2*this.walkingSpeed&&(this.moveLeftFoot=0),t.scale(1,1),t.drawImage(this.image,0,0),t.restore()}findLadderCollision(t){let i=!1,e=!1;for(let s=0;s<t.length;s++){const h=t[s];o(h,this)&&(i=!0,h.y<this.y&&this.y<h.y+h.height&&(e=!0))}return{collision:i,collidesHigh:e}}hit(t){Math.abs(this.xVel)<100&&(this.xVel+=t)}customUpdate(t,i,e){const s=performance.now();if(this.state===U.Dead){const t=this.findPlatform(i);return t&&(this.latestOnPlatformTime=s),void(t?(this.y=t.y-this.height,this.yVel=0):this.y+this.height<this.level.height&&(this.yVel+=1,this.y+=this.yVel))}null!=this.dropStartTime&&s-this.dropStartTime>=400&&(this.dropStartTime=void 0);const h=this.findPlatform(i);h&&(this.latestOnPlatformTime=s);let n={dx:0,dy:0};const a=this.findLadderCollision(t);a.collision||this.state!==U.Climbing?this.yVel>40?this.fallingToGround||(this.fallingToGround=!0,this.turnHorizontally()):this.fallingToGround||(n=this.handleControls(s,a,h)):this.state=U.Falling;let{dx:r,dy:o}=n;0!==this.xVel&&(r+=this.xVel,Math.abs(this.xVel)>4?this.xVel*=.97:this.xVel=0),this.state===U.Falling&&(this.yVel+=1,o+=this.yVel),this.updateHorizontalPosition(r),this.updateVerticalPosition(e,h,o)}screenShake(t){const i=Math.min(80,Math.max(this.yVel-20,0))/80*20;t.shake(i,.5)}turnHorizontally(){const t=this.width,i=this.height;this.width=i,this.height=t}handleControls(t,i,e){let s=0,h=0;(P("arrowleft")||P("a"))&&this.x>0?(s=this.state===U.Climbing?-2:-7,this.moveLeft=!0,this.state!==U.Falling&&this.moveLeftFoot++):(P("arrowright")||P("d"))&&this.x<this.level.width-this.width&&(s=this.state===U.Climbing?2:7,this.moveLeft=!1,this.state!==U.Falling&&this.moveLeftFoot++);const n=P("arrowup")||P("w"),a=P("arrowdown")||P("s");return n||(this.stopClimbing=!1),n&&!this.stopClimbing?(this.state===U.Climbing&&0===s&&e&&!i.collidesHigh?(this.state=U.OnPlatform,this.stopClimbing=!0):!(e||t-this.latestOnPlatformTime<200||this.isOnGround())||0===s&&i.collidesHigh?this.yVel>=0&&i.collision&&(this.state=U.Climbing,this.yVel=0,h-=6):(z(F),this.yVel=-20,this.state=U.Falling,this.latestOnPlatformTime=0),this.state===U.Climbing&&this.moveLeftFoot++):a&&i.collision?(this.state=U.Climbing,this.yVel=0,h+=6,this.moveLeftFoot++):a&&e&&(this.state=U.Dropping,this.dropStartTime=t,h=this.height+25),{dx:s,dy:h}}updateHorizontalPosition(t){this.x+t>this.level.width-this.width?(this.x=this.level.width-this.width,this.xVel=0):this.x+t<this.level.left?(this.x=this.level.left,this.xVel=0):0!==t&&(this.x+=t)}updateVerticalPosition(t,i,e){if(this.y+e>this.level.height-this.height)this.y=this.level.height-this.height,this.fallingToGround?(this.screenShake(t),this.die()):this.state=U.OnPlatform,this.yVel=0;else if(this.fallingToGround)this.state=U.Falling,this.y+=e;else if(this.state===U.Dropping)this.y+=e,this.state=U.Falling;else if(this.state===U.Climbing)this.y+=e;else if(e>0&&i){const t=5;this.y=i.y-this.height+t,this.yVel=0,this.state=U.OnPlatform}else this.state=U.Falling,this.y+=e}findPlatform(t){for(let i=0;i<t.length;i++){const e=t[i];if(o(this,e)&&this.y+this.height<e.y+e.height)return e}}}class J extends c{constructor(t,i,e){super({width:30,height:30,dx:3}),this.area=t,this.player=i,this.state={type:"patrol"},this.alarmed=()=>{};const s=Math.min(160+5*e,240);this.color="rgb("+s+", 50, 50)"}goTo(t){this.state={type:"goto",target:t}}die(){this.state={type:"dead"}}isDead(){return"dead"===this.state.type}update(){const t=performance.now();switch(this.state.type){case"dead":break;case"alarm":t-this.state.start>2e3&&(this.state={type:"patrol"});break;case"patrol":{this.patrol();const i=this.player;!i.isDead()&&this.position.distance(i.position)<200&&(this.state={type:"alarm",start:t},this.dx=0,this.dy=0,this.alarmed(d(i.x,i.y)));break}case"goto":{const i=this.state.target;this.position.distance(i)>100?this.moveTowards(i):(this.state={type:"attack",start:t},this.dx=0,this.dy=0);break}case"attack":{const i=this.player;!i.isDead()&&this.position.distance(i.position)<350?this.moveTowards(i.position):t-this.state.start>4e3&&(this.state={type:"patrol"});break}}this.advance()}draw(){const t=performance.now(),i=this.context;i.save();const e=1.4*this.width,s=this.height;switch(this.state.type){case"dead":break;case"alarm":i.fillStyle=function(t){return Math.floor(t/500)%2==0?"rgba(255, 0, 0, 0.9)":"rgba(255, 255, 255, 0.9"}(t),i.fillRect(0,s/2,e,s/2),i.beginPath(),i.arc(e/2,s/2,e/2,0,2*Math.PI),i.fill();break;default:i.fillStyle="rgba(255, 255, 255, 0.9)",i.fillRect(0,s/2,e,s/2),i.beginPath(),i.arc(e/2,s/2,e/2,0,2*Math.PI),i.fill()}i.restore()}patrol(){const t=this.area.y+this.area.height/2;this.y<t-10?this.dy=3:t+10<this.y?this.dy=-3:0!==this.dy&&(this.dy=0),0===this.dx||this.dx<0&&this.x<=this.area.x+2*this.width?this.dx=3:this.dx>0&&this.area.x+this.area.width-2*this.width<=this.x&&(this.dx=-3)}moveTowards(t){const i=t.subtract(this.position).normalize().scale(3);this.dx=i.x,this.dy=i.y}}const B=(t=1)=>Math.random()*t,j=(t,i)=>Math.random()*(i-t)+t;class q extends c{constructor(t){super({width:30,height:90}),this.level=t,this.startTime=performance.now()}draw(){const t=this.context,i=performance.now();t.save(),t.globalAlpha=Math.min((i-this.startTime)/3e3,1);const e=1.4*this.width,s=this.height;t.fillStyle="rgba(255, 255, 255, 0.9)",t.fillRect(0,s/2,e,s/2),t.beginPath(),t.arc(e/2,s/2,e/2,0,2*Math.PI),t.fill(),t.fillStyle="rgba(0, 0, 0, 0.9)",t.beginPath(),t.arc(.3*e,s/2,.16*e,0,2*Math.PI),t.arc(.7*e,s/2,.16*e,0,2*Math.PI),t.fill(),t.restore()}update(){const{dx:t,dy:i}=this.handleControls();this.updateHorizontalPosition(t),this.updateVerticalPosition(i)}handleControls(){let t=0,i=0;return(P("arrowleft")||P("a"))&&this.x>0?t=-7:(P("arrowright")||P("d"))&&this.x<this.level.width-this.width&&(t=7),P("arrowup")||P("w")?i-=7:(P("arrowdown")||P("s"))&&(i+=7),{dx:t,dy:i}}updateHorizontalPosition(t){this.x+t>this.level.width-this.width?this.x=this.level.width-this.width:this.x+t<this.level.x?this.x=this.level.x:0!==t&&(this.x+=t)}updateVerticalPosition(t){this.y+t>this.level.height-this.height?this.y=this.level.height-this.height:this.y+t<this.level.y?this.y=this.level.y:this.y+=t}}const N=300;function Z(t,i){return t.y+t.height-30<i.y}class K{constructor(t){this.number=0,this.x=0,this.y=0,this.left=0,this.top=0,this.width=2400,this.height=3300,this.score=0,this.lives=5,this.isFinished=!1,this.player=new X(this),this.enemies=[],this.enemyWaweCount=0,this.ladders=[],this.platforms=[],this.number=t,this.lastEnemyAddTime=performance.now(),t>=1&&(this.fill(),this.player.x=100,this.player.y=this.height-this.player.height,this.addEnemies(),this.player.died=()=>{this.lives--,this.playerDeathTime=performance.now()})}getTimeAsGhost(){if(this.ghost)return Math.floor((6e3-(performance.now()-this.ghost.startTime))/1e3)+1}getMultiplier(){const t=this.ghost?this.ghost:this.player;return t.y>this.height-300?1:t.y>this.height-600?2:t.y>this.height-900?3:t.y>this.height-1200?4:t.y>this.height-1500?5:t.y>this.height-1800?6:t.y>this.height-2100?7:t.y>this.height-2400?8:t.y>this.height-2700?10:t.y>this.height-3e3?12:20}isOver(){return this.lives<=0}render(t,i){this.renderBackground(t);for(let t=0;t<this.platforms.length;t++)this.platforms[t].render();for(let t=0;t<this.ladders.length;t++)this.ladders[t].render();for(let t=0;t<this.enemies.length;t++)this.enemies[t].render();this.player.render(),this.ghost&&this.ghost.render(),i.target||(t.save(),t.strokeStyle="red",t.lineWidth=5,t.beginPath(),t.lineTo(0,0),t.lineTo(this.width,0),t.lineTo(this.width,this.height),t.lineTo(0,this.height),t.closePath(),t.stroke(),t.restore())}renderBackground(t){t.save(),t.fillStyle="black",t.fillRect(0,0,this.width,this.height),t.restore()}addEnemies(){const t=this.height/N,i=[];for(let e=0;e<5;e++){const e=0===this.enemyWaweCount?1:Math.floor(B(t)),s=this.height-e*N;if(s-N<this.player.y&&this.player.y<s)continue;const h={x:0,y:s-N,width:this.width,height:N},n=new J(h,this.player,this.enemyWaweCount);n.x=B(this.width),n.y=s-150;const a=i.length;n.alarmed=t=>{for(let e=0;e<i.length;e++)if(e!==a){const s=i[e],h=700,n=d(t.x+j(-h,h),t.y+j(-h,h));s.goTo(n)}},i.push(n)}this.enemies=this.enemies.concat(i),this.enemyWaweCount++}fill(){const t=400,i=this.width/t,e=this.height/N,s=(i-1)*t/2;for(let h=1;h<e;h++){const e=this.height-h*N,n=new k;n.width=s,n.x=0,n.y=e,this.platforms.push(n);const a=new k;if(a.width=s,a.x=this.width-s-100,a.y=e,this.platforms.push(a),h<3){for(let i=0;i<3;i++){const e=new C;e.x=i*t+10,e.y=n.y,this.ladders.push(e)}for(let e=4;e<i;e++){const i=new C;i.x=e*t+10,i.y=n.y,this.ladders.push(i)}}else if(h<4){for(let i=1;i<3;i++){const e=new C;e.x=i*t-200,e.y=n.y,this.ladders.push(e)}for(let e=4;e<i-1;e++){const i=new C;i.x=e*t+200,i.y=n.y,this.ladders.push(i)}}else if(h<5){for(let i=1;i<3;i++){const e=new C;e.x=i*t-100,e.y=n.y,this.ladders.push(e)}for(let e=4;e<i-1;e++){const i=new C;i.x=e*t+200,i.y=n.y,this.ladders.push(i)}}else if(h<6){for(let i=1;i<2;i++){const e=new C;e.x=i*t+10,e.y=n.y,this.ladders.push(e)}for(let e=5;e<i;e++){const i=new C;i.x=e*t+10,i.y=n.y,this.ladders.push(i)}}else if(h<7){for(let i=2;i<3;i++){const e=new C;e.x=i*t+10,e.y=n.y,this.ladders.push(e)}for(let e=4;e<i-1;e++){const i=new C;i.x=e*t+10,i.y=n.y,this.ladders.push(i)}}}}update(t){const i=performance.now();for(let t=0;t<this.enemies.length;t++)this.enemies[t].update();if(this.player.customUpdate(this.ladders,this.platforms,t),null!=this.playerDeathTime&&i-this.playerDeathTime>1e3)if(this.playerDeathTime=void 0,this.lives>0){const t=new q(this);t.x=this.player.x+30,t.y=this.player.y-50,this.ghost=t,this.camera&&this.camera.follow(this.ghost)}else this.ghost=void 0;if(this.ghost&&(this.ghost.update(),i-this.ghost.startTime>6e3&&(this.player.x=this.ghost.x,this.player.y=this.ghost.y,this.player.resurrect(),this.ghost=void 0,t.follow(this.player))),!this.player.isDead())for(let t=0;t<this.enemies.length;t++){const i=this.enemies[t];i.isDead()||o(this.player,i)&&(Z(this.player,i)||this.player.hasJustDropped()?(i.die(),this.score+=this.getMultiplier()):this.player.die())}i-this.lastEnemyAddTime>1e4&&(this.addEnemies(),this.lastEnemyAddTime=i)}}class Q{constructor(t,i){this.level=t,this.canvas=i,this.x=0,this.y=0,this.zoom=1,this.shakePower=0,this.shakeDecay=0,this.target=null}follow(t){this.zoom=1,this.target=t}zoomToLevel(){this.target=null,this.x=this.level.left+this.level.width/2,this.y=this.level.top+this.level.height/2,this.level.width/this.level.height>=this.canvas.width/this.canvas.height?this.zoom=this.canvas.width/this.level.width:this.zoom=this.canvas.height/this.level.height}shake(t=8,i=.5){this.shakePower=t,this.shakeDecay=t/i}update(){this.target&&(this.fitZoom(),this.followFrame(this.target)),this.shakeFrame()}shakeFrame(){const{shakePower:t}=this;t<=0||(this.x+=B(2*t)-t,this.y+=B(2*t)-t,this.shakePower-=this.shakeDecay*(1/60))}fitZoom(){const t=this.level.width*this.zoom,i=this.level.height*this.zoom;(t<this.canvas.width||i<this.canvas.height)&&(this.zoom=Math.max(this.canvas.width/this.level.width,this.canvas.height/this.level.height))}followFrame(t){let i=t.x+t.width,e=t.y+t.height;const s=this.canvas.width/this.zoom,h=this.canvas.height/this.zoom;i-s/2<this.level.left?i=this.level.left+s/2:i+s/2>this.level.width&&(i=this.level.width-s/2),e-h/2<this.level.top?e=this.level.top+h/2:e+h/2>this.level.height&&(e=this.level.height-h/2),this.x=i,this.y=e}}var $;!function(t){t[t.Loading=0]="Loading",t[t.Running=1]="Running",t[t.LevelFinished=2]="LevelFinished"}($||($={}));let tt,it,et,st,ht,nt=!1,at=0,rt=$.Loading;const ot=()=>w({render(){it.clearRect(0,0,tt.width,tt.height),rt!==$.Loading&&nt?dt("Press enter to start          "):dt("Loading.............          ")}}),lt=t=>{et.stop(),st=new K(t),ht=new Q(st,tt),st.camera=ht,0===t?et=ot():(z(D),ht.follow(st.player),et=w({update(){st.update(ht),ht.update(),st.isFinished&&rt===$.Running&&(rt=$.LevelFinished,setTimeout((()=>{at++,lt(at)}),1500))},render(){it.save(),it.translate(tt.width/2,tt.height/2),it.scale(ht.zoom,ht.zoom),it.translate(-ht.x,-ht.y),st.render(it,ht),it.restore(),((t,i)=>{t.fillStyle="white",t.font="20px Sans-serif",t.fillText("SCORE     "+i,60,35)})(it,st.score),((t,i)=>{const e=t.canvas;t.fillStyle="white",t.font="20px Sans-serif",t.fillText("MULTIPLIER     "+i,e.width/2-100,35)})(it,st.getMultiplier()),((t,i)=>{const e=t.canvas;t.fillStyle="white",t.font="20px Sans-serif",t.fillText("LIVES     "+i,e.width-200,35)})(it,st.lives);const t=st.getTimeAsGhost();st.isOver()?L(it,"GAME OVER!               ","Your score: "+st.score+"            ","Press enter to try again."):null!=t&&(L(it,"Continue as ghost for a while!         "),((t,i)=>{const e=t.canvas;t.fillStyle="white",t.font="50px Sans-serif",t.fillText(""+i,e.width/2,1*e.height/3)})(it,t))}})),rt=$.Running,et.start()},dt=t=>{L(it,"                    Ghost Mode                            ","","Jump on enemies to kill them and score points.            ","Get higher to score more points.                          ","Use death wisely.                                         ","","Controls                                                  ","Use ARROWS or W/A/S/D to move. Jump with UP or W.         ","","(c) 2022 by Sami H & Tero J                               ","",t)},{canvas:ct,context:gt}=function(t,{contextless:s=!1}={}){if(i=document.getElementById(t)||t||document.querySelector("canvas"),s&&(i=i||new Proxy({},n)),!i)throw Error("You must provide a canvas element for the game");return e=i.getContext("2d")||new Proxy({},n),e.imageSmoothingEnabled=!1,h("init"),{canvas:i,context:e}}(),yt=()=>{ct.width=window.innerWidth-10,ct.height=window.innerHeight-10};window.addEventListener("resize",yt,!1),yt(),tt=ct,it=gt,rt=$.Loading,function(){let t;for(t=0;t<26;t++)m["Key"+String.fromCharCode(t+65)]=String.fromCharCode(t+97);for(t=0;t<10;t++)m["Digit"+t]=m["Numpad"+t]=""+t;window.addEventListener("keydown",v),window.addEventListener("keyup",_),window.addEventListener("blur",b)}(),Promise.all([R(A,{songData:[{i:[0,0,140,0,0,0,140,0,0,255,158,158,158,0,0,0,51,2,1,2,58,239,0,32,88,1,157,2],p:[1,2],c:[{n:[147],f:[]},{n:[],f:[]}]}],rowLen:5513,patternLen:32,endPattern:1,numChannels:1},!0),R(V,{songData:[{i:[0,192,104,1,0,80,99,0,0,0,4,0,66,0,0,3,0,0,0,1,0,1,2,32,0,12,60,8],p:[1],c:[{n:[137],f:[27,28,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,60,8]}]}],rowLen:5513,patternLen:8,endPattern:0,numChannels:1},!1),R(E,{songData:[{i:[0,255,106,1,0,255,106,0,1,0,5,7,164,0,0,0,0,0,0,2,255,0,2,32,83,5,25,1],p:[1],c:[{n:[147],f:[]}]}],rowLen:5513,patternLen:20,endPattern:0,numChannels:1},!1)]).then((()=>{nt=!0})),st=new K(0),ht=new Q(st,tt),at=0,et=ot(),et.start(),rt=$.Running,T("enter",(()=>{0===at?(at=1,lt(at)):st.isOver()&&(at=0,lt(at))})),T("esc",(()=>{at=0,lt(at)})),T("1",(()=>{ht.follow(st.player)})),T("2",(()=>{ht.zoomToLevel()})),T("n",(()=>{at<4?at++:at=1,lt(at)}))})();