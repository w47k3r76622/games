window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();var wae=window.addEventListener;var FPS=60,pi_by_180=Math.PI/180,epsilon=.1,c=null,ctx=null,bc=null,bc_ctx=null,objs=[],keys=[],last_time=0,debug=1,debug_color="#ffffff",stage=null,supportsLocalStorage=false,W,H,shakeTime=0,shakeTimeMax=0,shakeIntensity=7,score=0,life=2,hs=0,PAUSE=true;var DisplayObject=function(){};var p=DisplayObject.prototype;p.x=0;p.y=0;p.width=0;p.height=0;p.hitarea=null;p.scale_x=1;p.scale_y=1;p.rotation=0;p.alpha=1;p.visible=true;p.hitTestPoint=null;p.draw=function(e){};p.update=function(e){};var Stage=function(){};function init(e){averagefps={x:0,y:0};W=window.innerWidth;H=window.innerHeight;c=document.getElementById(e);c.width=W;c.height=H;ctx=c.getContext("2d");bc=document.createElement("canvas");bc.width=c.width;bc.height=c.height;bc_ctx=bc.getContext("2d");objs=[];stage=new Stage;stage.update=function(e){if("function"===typeof onStageUpdated)onStageUpdated(e)};addChild(stage);try{if(window["localStorage"]!=null){supportsLocalStorage=true;if(!(hs=window.localStorage.getItem(game_config.score_key))){hs=0;localStorage.setItem(game_config.score_key,0)}}}catch(t){supportsLocalStorage=false}var i={x:5,y:15,fps:0,visible:true,update:function(e){this.fps=Math.round(1/e);if(this.fps!==Infinity){averagefps.x=(averagefps.x*averagefps.y+this.fps)/++averagefps.y}},draw:function(e){if(!debug)return;e.font="12px Verdana";e.fillStyle="#F00";e.fillText(this.fps+" fps",0,0)}};addChild(i);var s={x:50,y:15,visible:true,draw:function(e){if(!debug)return;e.font="12px Verdana";e.fillStyle="#F00";e.fillText(objs.length+" Entities",0,0)}};addChild(s);game.init();wae("keypress",onKeyPress);wae("keydown",onKeyDown);wae("keyup",onKeyUp);gameLoop()}function gameLoop(){window.requestAnimFrame(gameLoop);update();draw()}function onKeyUp(e){keys[e.which]=false}function onKeyDown(e){keys[e.which]=true}function onKeyPress(e){if({68:1,100:1}[e.which]){}else if(PAUSE&&{88:1,120:1}[e.which]){}}function update(){var e=(new Date).getTime();if(!last_time)last_time=e;var t=(e-last_time)/1e3;last_time=e;if(shakeTime>0){shakeTime-=t}for(var i=objs.length;i--;){var s=objs[i];if(typeof s.update=="function"){s.update(t)}}}function draw(){clearScreen(bc_ctx,"#9CC5C9");var e=bc_ctx;if(shakeTime>0){var t=shakeTime/shakeTimeMax*shakeIntensity;var i=random(-t,t);var s=random(-t,t);e.save();e.translate(i,s)}for(var a=0,r=objs.length;a<r;a++){var n=objs[a];if(typeof n.draw=="function"&&n.visible){e.save();!isNaN(n.x)&&!isNaN(n.y)&&e.translate(n.x,n.y);!isNaN(n.scale_x)&&!isNaN(n.scale_y)&&e.scale(n.scale_x,n.scale_y);!isNaN(n.rotation)&&e.rotate(n.rotation*pi_by_180);!isNaN(n.alpha)&&(e.globalAlpha=n.alpha);n.draw(e);e.restore()}}e.font="18px Verdana";e.fillStyle="#FF0";e.fillText("Score: "+score,20,H-30);e.fillText("Life: "+life,20,H-10);if(shakeTime>0){e.restore()}clearScreen(ctx);ctx.drawImage(bc,0,0)}function clearScreen(e,t){e.clearRect(0,0,c.width,c.height)}function addChild(e){objs.push(e)}function removeChild(e){for(var t=objs.length;t--;)if(objs[t]===e){delete e;objs.splice(t,1);break}}function removeChildAt(e){if(!objs[e])return;delete objs[e];objs.splice(e,1)}function setChildIndex(e,t){for(var i=-1,s=objs.length;++i<s;){if(objs[i]===e&&i!=t){objs.splice(i,1);objs.splice(t,0,e)}}}function shake(e){shakeTimeMax=shakeTime=e}function random(e,t){if(!t){t=e;e=0}return e+~~(Math.random()*(t-e+1))}function resetScore(){score>hs?hs=score:null;score=0}function saveScore(){localStorage.setItem(game_config.score_key,hs)}function dist(e,t,i,s){var a=e-i;var r=t-s;return Math.abs(Math.sqrt(a*a+r*r))}function J(){this.B=function(e){for(var t=0;24>t;t++)this[String.fromCharCode(97+t)]=e[t]||0;.01>this.c&&(this.c=.01);e=this.b+this.c+this.e;.18>e&&(e=.18/e,this.b*=e,this.c*=e,this.e*=e)}}var W=new function(){this.A=new J;var e,t,i,s,a,r,n,o,h,c,l,f;this.reset=function(){var e=this.A;s=100/(e.f*e.f+.001);a=100/(e.g*e.g+.001);r=1-.01*e.h*e.h*e.h;n=1e-6*-e.i*e.i*e.i;e.a||(l=.5-e.n/2,f=5e-5*-e.o);o=0<e.l?1-.9*e.l*e.l:1+10*e.l*e.l;h=0;c=1==e.m?0:2e4*(1-e.m)*(1-e.m)+32};this.D=function(){this.reset();var s=this.A;e=1e5*s.b*s.b;t=1e5*s.c*s.c;i=1e5*s.e*s.e+10;return e+t+i|0};this.C=function(d,u){var p=this.A,y=1!=p.s||p.v,w=.1*p.v*p.v,v=1+3e-4*p.w,g=.1*p.s*p.s*p.s,m=1+1e-4*p.t,b=1!=p.s,x=p.x*p.x,_=p.g,k=p.q||p.r,S=.2*p.r*p.r*p.r,j=p.q*p.q*(0>p.q?-1020:1020),C=p.p?(2e4*(1-p.p)*(1-p.p)|0)+32:0,W=p.d,T=p.j/2,A=.01*p.k*p.k,I=p.a,M=e,H=1/e,F=1/t,P=1/i,p=5/(1+20*p.u*p.u)*(.01+g);.8<p&&(p=.8);for(var p=1-p,D=!1,q=0,R=0,N=0,L=0,U=0,E,z=0,V,K=0,B,O=0,G,J=0,Q,X=0,Y=Array(1024),Z=Array(32),$=Y.length;$--;)Y[$]=0;for($=Z.length;$--;)Z[$]=2*Math.random()-1;for($=0;$<u;$++){if(D)return $;C&&++J>=C&&(J=0,this.reset());c&&++h>=c&&(c=0,s*=o);r+=n;s*=r;s>a&&(s=a,0<_&&(D=!0));V=s;0<T&&(X+=A,V*=1+Math.sin(X)*T);V|=0;8>V&&(V=8);I||(l+=f,0>l?l=0:.5<l&&(l=.5));if(++R>M)switch(R=0,++q){case 1:M=t;break;case 2:M=i}switch(q){case 0:N=R*H;break;case 1:N=1+2*(1-R*F)*W;break;case 2:N=1-R*P;break;case 3:N=0,D=!0}k&&(j+=S,B=j|0,0>B?B=-B:1023<B&&(B=1023));y&&v&&(w*=v,1e-5>w?w=1e-5:.1<w&&(w=.1));Q=0;for(var et=8;et--;){K++;if(K>=V&&(K%=V,3==I))for(E=Z.length;E--;)Z[E]=2*Math.random()-1;switch(I){case 0:G=K/V<l?.5:-.5;break;case 1:G=1-2*(K/V);break;case 2:G=K/V;G=.5<G?6.28318531*(G-1):6.28318531*G;G=0>G?1.27323954*G+.405284735*G*G:1.27323954*G-.405284735*G*G;G=0>G?.225*(G*-G-G)+G:.225*(G*G-G)+G;break;case 3:G=Z[Math.abs(32*K/V|0)]}y&&(E=z,g*=m,0>g?g=0:.1<g&&(g=.1),b?(U+=(G-z)*g,U*=p):(z=G,U=0),z+=U,L+=z-E,G=L*=1-w);k&&(Y[O%1024]=G,G+=Y[(O-B+1024)%1024],O++);Q+=G}Q=.125*Q*N*x;d[$]=1<=Q?32767:-1>=Q?-32768:32767*Q|0}return u}};window.jsfxr=function(e){W.A.B(e);var t=W.D();e=new Uint8Array(4*((t+1)/2|0)+44);var t=2*W.C(new Uint16Array(e.buffer,44),t),i=new Uint32Array(e.buffer,0,44);i[0]=1179011410;i[1]=t+36;i[2]=1163280727;i[3]=544501094;i[4]=16;i[5]=65537;i[6]=44100;i[7]=88200;i[8]=1048578;i[9]=1635017060;i[10]=t;for(var t=t+44,i=0,s="data:audio/wav;base64,";i<t;i+=3)var a=e[i]<<16|e[i+1]<<8|e[i+2],s=s+("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[a>>18]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[a>>12&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[a>>6&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[a&63]);i-=t;return s.slice(0,s.length-i)+"==".slice(0,i)};var game=function(e){var t={namespace:"sdrow",name:"sdrow",score_key:"sdrow"};var i,s=[],a=1.4,r={},n={1:{width:10,height:10},2:{width:20,height:20},3:{width:35,height:35}},o=0,h=0,l=0,f=["type me","me too","collect coins","coins reverse words"],d=["amazing","poor","brilliant","crazy","horrible","fun"],u=["cat","elephant","concept","game","gamer","power"];I("coin",[[2,,.0547,.5447,.1704,.5662,,,,,,,,,,,,,1,,,,,.5],[2,,.0236,.3286,.2658,.6069,,,,,,.2147,.5666,,,,,,1,,,,,.5],[2,,.0143,.5022,.26,.5323,,,,,,.3248,.5518,,,,,,1,,,,,.5]]);I("powerup",[[2,,.2307,,.4397,.3404,,.1526,,.0544,.4236,,,.3724,,,,,1,,,,,.5],[2,,.3894,,.3024,.4107,,.1792,,,,,,.0228,,.5141,,,1,,,,,.5]]);I("explosion",[[3,,.3708,.5822,.3851,.0584,,-.0268,,,,-.0749,.7624,,,,,,1,,,,,.5],[3,,.1669,.6956,.4757,.053,,.25,,,,.5472,.7599,,,.516,.3194,-.1415,1,,,,,.5],[3,,.1679,.6792,.4546,.1048,,-.3239,,,,-.3376,.6851,,,,,,1,,,,,.5]]);I("hit",[[0,,.0658,,.2198,.4852,,-.5898,,,,,,.4405,,,,,1,,,,,.5],[0,,.0444,,.1355,.2247,,-.3034,,,,,,.416,,,,,1,,,.1094,,.5],[3,,.0833,,.1753,.3698,,-.3655,,,,,,,,,,,1,,,,,.5],[1,,.0892,,.2721,.38,,-.379,,,,,,,,,,,1,,,.1896,,.5]]);I("button",[[0,.1696,.5004,.2598,.3914,.7047,,.0141,-5e-4,,,.6608,-.8497,-.1484,-.0163,.5521,.2529,-.5832,.6323,-.595,.9155,.2821,-.0615,.26]]);I("gameover",[[2,.18,.24,,.54,.34,,,,1,.31,,,,.8522,,,,.23,,,,,.49]]);function p(){this.type="player";this.speed_x=0;this.speed_y=0;this.max_speed=300;this.acceleration=2e3;this.friction=.93;this.width=25;this.height=15;this.color="#0f0";this.generateWordTime=2;this.wordGenerateInterval=3;this.reset=function(){this.x=W/2;this.y=H-100;this.speed_x=this.speed_y=0}}p.prototype=new DisplayObject;p.prototype.draw=function(e){e.strokeStyle=this.color;e.lineWidth=3;e.lineWidth=7+Math.sin(pi_by_180*Date.now()/2)*3;e.shadowBlur=5+Math.sin(pi_by_180*Date.now()/5)*10;e.shadowColor=this.color;e.beginPath();var t=7+Math.sin(pi_by_180*Date.now()/2)*3;e.arc(0,0,t,0,2*Math.PI,false);e.stroke()};p.prototype.update=function(e){this.generateWordTime-=e;if(this.generateWordTime<0){objs.push(new y);this.generateWordTime=this.wordGenerateInterval}if(keys[37]){this.speed_x-=this.acceleration*e}else if(keys[39]){this.speed_x+=this.acceleration*e}if(keys[38]){this.speed_y-=this.acceleration*e}else if(keys[40]){this.speed_y+=this.acceleration*e}else{}this.speed_x*=this.friction;this.speed_y*=this.friction;this.x+=this.speed_x*e;this.y+=this.speed_y*e;if(this.x>W)this.x=0;if(this.x<0)this.x=W;if(this.y<0)this.y=H;if(this.y>H)this.y=0};function y(e){e=e||{};this.type="word";this.level=e.level||3;this.x=random(100,W-200*2);this.y=random(0,5);this.width=n[this.level].width;this.height=n[this.level].height;this.isDead=false;this.speed_y=60;this.value=l===f.length?d[random(d.length-1)]+" "+u[random(u.length-1)]:f[l++];this.isReversed=l===f.length?!!random(0,1):0;if(l===4){this.isReversed=true}this.reversedValue=A(this.value);this.correctIndex=0;this.hit=function(){return}}y.prototype=new DisplayObject;y.prototype.draw=function(e){e.font="30px Verdana";var t=this.isReversed?"#FF0":"#F00",s=this.isReversed?"#F00":"#FF0";substrLen=this.isReversed?this.value.length-this.correctIndex:this.correctIndex;e.fillStyle=t;e.fillText(this.isReversed?this.reversedValue:this.value,0,0);e.fillStyle=s;e.fillText((this.isReversed?this.reversedValue:this.value).substr(0,substrLen),0,0);e.beginPath();e.moveTo(this.value.length*10,0);e.lineTo(i.x-this.x,i.y-this.y);var a=.6*(1-dist(this.x,this.y,i.x,i.y)/H);e.strokeStyle="rgba(255, 255, 255, "+a+")";e.stroke();e.beginPath()};y.prototype.update=function(e){this.y+=this.speed_y*e;if(this.x>W)this.x=0;if(this.x<0)this.x=W;if(this.y<0)this.y=H;if(this.y>H){j();removeChild(this)}};y.prototype.checkCharacter=function(e){if(this.value[this.correctIndex]===e){this.correctIndex++;if(this.value[this.correctIndex]===" ")this.correctIndex++;M("hit");if(this.correctIndex===this.value.length){m(8,this.x,this.y);M("explosion");score++;shake(1);removeChild(this)}}};function w(e,t,i){this.type="coin";this.x=e;this.y=t;this.width=2;this.height=2;this.speed=100+random(200,500);this.speed_x=~~(Math.cos(i*pi_by_180)*this.speed);this.speed_y=~~(Math.sin(i*pi_by_180)*this.speed);this.lifetime_sec=8;this.color="#ff0"}var v=w.prototype=new DisplayObject;v.friction=.9;v.draw=function(e){e.fillStyle="#ff0";e.shadowBlur=5+Math.sin(pi_by_180*Date.now()/5)*10;e.shadowColor=this.color;var t=7;var i=Math.sin(pi_by_180*Date.now()/5);e.save();e.scale(i,1);e.beginPath();e.arc(0,0,t,0,2*Math.PI,false);e.fill();e.restore()};v.update=function(e){this.lifetime_sec-=e;if(this.lifetime_sec<=0&&this.state!=="taken")removeChild(this);this.speed_x*=this.friction;this.speed_y*=this.friction;this.x+=this.speed_x*e;this.y+=this.speed_y*e;var t=dist(this.x,this.y,i.x,i.y);if(t<200){this.x+=(i.x-this.x)*.1;this.y+=(i.y-this.y)*.1;if(t<20){this.state="taken";M("coin");o++;h++;g();removeChild(this)}}};function g(){if(h>9){var e=false;for(var t=0;t<objs.length;t++){var i=objs[t];if(i.type==="word"&&i.isReversed){console.log(99,i);i.isReversed=false;e=true;break}}if(e){M("powerup");h=0}}}function m(e,t,i){for(var s=e;s--;){objs.push(new w(t,i,random(0,360)))}}function b(e){var t;var i=String.fromCharCode(e.which).toLowerCase();for(var s=objs.length;s--;){t=objs[s];if(t.type==="word"){t.checkCharacter(i)}}}function x(){var e=document.querySelector("#bg1"),t=e.getContext("2d"),i=0,s=0;e.width=W;e.height=H;T("hsl(0, 0%, 10%)",0,0,W,H,t);t.fillStyle="hsl(0, 0%, 20%)";t.beginPath();while(++i<150){s=random(1,10);t.rect(random(W),random(H),s,s)}t.fill()}function _(){var e=document.querySelector("#fg1"),t=e.getContext("2d"),i=0,s=2,a=s+1,r=H/a;e.width=W;e.height=H;t.fillStyle="hsla(0, 0%, 20%, 0.4)";t.beginPath();while(++i<r){t.rect(0,i*a,W,s)}t.fill()}function k(){resetScore();l=0}function S(){x();_();k();i=new p;i.reset();addChild(i);PAUSE=false;wae("keypress",b)}function j(){M("explosion");shake(3);life--;if(!life){PAUSE=1;document.querySelector("#lost").style.display="block"}}function C(t){W=c.width=e.innerWidth;H=c.height=e.innerHeight}function T(e,t,i,s,a,r){r=r||ctx;r.beginPath();r.fillStyle=e||"#e22";r.rect(t,i,s,a);r.fill()}function A(e){return e.split("").reverse().join("")}function I(e,t){r[e]=[];t.forEach(function(t){var i=new Audio;i.src=jsfxr(t);r[e].push(i)})}function M(e){r[e]&&r[e][random(0,r[e].length-1)].play()}return{init:S,resize:C}}(window);function initialize(){init("c")}wae("load",initialize);wae("resize",game.resize);window.debug=0;