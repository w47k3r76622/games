!function(){function n(n,r){var o=document.createElement("canvas");return o.width=n||hn,o.height=r||hn,{c:o,o:o.getContext("2d"),w:o.width,t:o.height}}function r(n,r){return Math.max(n,r)}function o(n,r){return Math.min(n,r)}function t(n){return Math.round(n)}function f(n){return Math.abs(n)}function i(){return Math.random()}function a(n){return Math.ceil(n)}function e(n){return Math.floor(n)}function u(n){function r(n,r,o){return o<0&&(o+=1),o>1&&(o-=1),o<1/6?n+6*(r-n)*o:o<.5?r:o<2/3?n+(r-n)*(2/3-o)*6:n}var o=(n=n||p())[0],f=n[1],i=n[2],a=n[3];o/=360,i/=100;var e,u,c;if(0==(f/=100))e=u=c=i;else{var v=i<.5?i*(1+f):i+f-i*f,l=2*i-v;e=r(l,v,o+1/3),u=r(l,v,o),c=r(l,v,o-1/3)}return"rgba("+t(255*e)+","+t(255*u)+","+t(255*c)+","+a+")"}function c(n,r,o,t,f,i){t<2*i&&(i=t/2),f<2*i&&(i=f/2),m(n),n.moveTo(r+i,o),n.arcTo(r+t,o,r+t,o+f,i),n.arcTo(r+t,o+f,r,o+f,i),n.arcTo(r,o+f,r,o,i),n.arcTo(r,o,r+t,o,i),y(n),n.fill()}function v(n,r,o,t){m(n),n.arc(r,o,t,0,2*Math.PI,!0),n.fill()}function l(n,r,o,t,f,i,a){m(n),n.moveTo(r,o),n.lineTo(t,f),n.lineTo(i,a),y(n),n.fill()}function h(n,r,o,t,f,i){f?n.drawImage(r,o,t,f,i):n.drawImage(r,o,t)}function s(n,r){n.fillStyle=r}function d(n,r,o,t,f){n.fillRect(r,o,t,f)}function w(n,r,o,t,f){n.clearRect(r,o,t,f)}function g(n,r){n.globalAlpha=r}function m(n){n.beginPath()}function y(n){n.closePath()}function p(){return[180,60,90,1]}function M(r,o,t,f){var v=(r=r||hn)+ln,l=(o=o||hn)+ln,h=n(v,l);if(o>r&&(o=hn),s(h.o,t||u(Kn)),d(h.o,vn,vn,r,o),h.i=vn+r/2,h.u=vn+o/2,o>ln){for(y=0;y<30;y++){var w=vn+a(i()*(.8*v)),g=e(i()*(v-w)),m=e(i()*(v-w));c(h.o,g,m,w,w,5)}for(var y=vn;y<r+vn;y++)if(i()>.4){var p=e(i()*vn*2),M=e(i()*l)-hn*i();d(h.o,y,p,1,M)}}return h}function b(r){var o=yn[gn],t=n(o.naturalWidth,o.naturalHeight);t.o.drawImage(o,0,0);var f=[];_n=[],nr=[],rr=[],tr=[],or=[],Hn=[];for(var a=t.t-1;a>=0;a--)for(var u=0;u<t.w;u++){var c=t.o.getImageData(u,a,1,1).data,v={x:w=u*hn,y:g=a*hn,v:m=e(i()*Wn.length)};if(c[1]<=103&&c[1]>=97)f.push(v);else if(c[2]>=98&&c[2]<=106)K(w,g);else if(c[2]<=255&&c[2]>=250&&0==c[0])or.push(v);else if(c[0]<=255&&c[0]>=250&&0==c[1])rr.push(v);else if(c[0]>=98&&c[0]<=106&&0==c[1]){rr.push(v);e(i()*Xn.length);nr.push(v)}else if(c[0]<=0)_n.push(v);else if(c[0]<200){e(i()*Xn.length);nr.push(v)}}for(var l=-1,h=0,s=0,d=0;d<f.length;d++){var w=f[d].x,g=f[d].y,m=w<bn/2?1:0,y=w<.3*bn?hn-ln:w>.6*bn?bn-sn+ln:null;y?tr.push({x:y,y:g,v:m}):s=d,-1===Mn||0===Mn?(-1===l||w<l)&&(l=w,h=g):1===Mn&&(-1===l||w>l)&&(l=w,h=g)}0===gn&&0===pn&&(l=f[s].x,h=f[s].y),Bn.l=l,Bn.h=h}function I(){for(n=0;n<nr.length;n++){r=nr[n];h(Dn.o,Xn[r.v].c,r.x-vn,r.y-vn)}for(var n=0;n<tr.length;n++){var r=tr[n];h(Dn.o,$n[r.v].c,r.x-vn,r.y-vn)}}function x(){for(c=0;c<rr.length;c++){for(var n=rr[c],r=Zn[0],o=0,t=!1,f=!1,i=!1,a=!1,e=0;e<_n.length;e++){var u=_n[e];u.y==n.y+hn&&u.x==n.x&&(a=!0),u.x==n.x-hn&&u.y==n.y&&(t=!0),u.y==n.y-hn&&u.x==n.x&&(i=!0),u.x==n.x+hn&&u.y==n.y&&(f=!0)}t&&(o=90),f&&(o=270),i&&(o=180),i&&f&&(o=225),i&&t&&(o=135),a&&(o=0),a&&f&&(o=315),a&&t&&(o=45),qn.o.save(),qn.o.translate(n.x-vn+r.w/2,n.y-vn+r.t/2),qn.o.rotate(o*Math.PI/180),h(qn.o,r.c,-r.w/2,-r.t/2,r.w,r.t),qn.o.restore()}for(var c=0;c<_n.length;c++){n=_n[c];h(qn.o,Wn[n.v].c,n.x-vn,n.y-vn)}}function k(){var n=Dn.o;s(n,Pn);var r=4*hn,o=1.2*hn,f=r+o,a=0,e=0,u=0;m(n),n.moveTo(a,f);for(var c=0;c<20;c++){var v=sn+t(i()*r);v,a+=v;var l=f+t(i()*o)*(i()>.5?1:-1);u=l,n.lineTo(a,l),0==c&&(e=l)}n.lineTo(bn,u),n.lineTo(bn,In),n.lineTo(0,In),n.lineTo(0,e),n.fill()}function A(){s(Gn.o,u(Ln)),d(Gn.o,0,0,Gn.w,Gn.t);var n=An;Gn.o.save(),g(Gn.o,.15),Gn.o.translate(0,Gn.t),Gn.o.scale(1,-1),h(Gn.o,n,-ln,-(Gn.t+2.25*hn),bn,In),h(Gn.o,n,ln,-(Gn.t+2.25*hn),bn,In),g(Gn.o,.4),h(Gn.o,n,0,-(Gn.t+2.25*hn),bn,In),Gn.o.restore(),s(Gn.o,On),d(Gn.o,0,0,Gn.w,Gn.t),h(kn,Gn.c,-vn,Fn,Gn.w+vn,Gn.t)}function B(){(Bn=J(0,0,wn,wn,!1,!1)).s=0,Bn.g=!1,Bn.m=0}function U(){Bn.g||0===gn&&1===En?Bn.p=!1:(1===ir.left&&(Bn.M=-1),1===ir.right&&(Bn.M=1),1!==ir.left&&1!==ir.right?(Bn.p&&(Bn.I=Un),Un-2e3>Bn.I&&(Bn.M=0),Bn.p=!1):(Bn.p||(Bn.I=Un),Bn.p=!0))}function j(){Bn.k=Un,Bn.A=!0,Bn.B=!1}function q(){Bn.A=!1,Bn.k=Un}function D(){Bn.B||(Bn.k=Un),Bn.A=!1,Bn.B=!0}function F(){Bn.g||(Bn.g=!0,Bn.m=Un,Bn.U=0,Bn.j=Un+1500,D())}function G(){if(Bn.g&&Un-4e3>Bn.m)fn();else{var n=0===Bn.q&&!Bn.F.D,t=0===Bn.G&&!Bn.H.D,f=n&&1===ir.right,i=t&&1===ir.left;if((f||i)&&(Bn.s&&Un>Bn.s&&(Bn.s=0,Bn.B=!1),Bn.g||Bn.s||Bn.A||(Bn.B&&!Bn.s?Bn.s=Un+Cn/3*((Un-Bn.k)/Cn):j())),Bn.A){u=(1-r(0,o(1,(Un-Bn.k)/Cn)))*Sn;u=o(Bn.N,u),Bn.y=a(Bn.y-u),Bn.dy=u,(0==u||n&&t&&!i&&!f||n&&!t&&!f||t&&!n&&!i)&&q()}else if(Bn.S>0){if(Bn.B||D(),(1!==ir.T||Bn.g)&&(0==Bn.N||(!Bn.s||Un>Bn.s)&&(n||t))&&(Bn.B=!1),Bn.B){var u=r(0,o(1,(Un-Bn.k)/Cn))*zn;Bn.s&&(n||t)&&(u/=2),u=o(Bn.S,u),Bn.y=e(Bn.y+u),Bn.dy=u}}else Bn.B=!1;for(c=0;c<rr.length;c++)C(rr[c]);for(var c=0;c<or.length;c++)E(or[c]);Bn.x+Bn.i<=0?(0===gn&&(pn=-1),-1===pn?gn++:gn--,Mn=1,tn()):Bn.x+Bn.i>=bn?(0===gn&&(pn=1),1===pn?gn++:gn--,Mn=-1,tn()):Bn.y+wn>=In-hn&&!Bn.g&&(F(),Bn.m-=2500)}}function H(){P(Bn)}function N(){return ir.left||ir.right||ir.T}function S(n){N()&&n.preventDefault()}function T(){for(var n in ir)-1==ir[n]&&(ir[n]=0)}function Y(n,r,o){var t=r.x,i=r.y,a=hn;r.c&&(a=wn);var e=a,u=n.w-ln;if(n.y>=i&&n.y<i+e||n.y+u>i&&n.y+u<=i+e||n.y<i&&n.y+u>=i+e){if((!o||o&&o.right)&&(n.x+u<t||n.x+u<t+a)){var c=t-(n.x+u);c<n.q&&(n.q=f(c),n.F=r)}if((!o||o&&o.left)&&n.x+u>t+a){var v=n.x-(t+a);v<n.G&&(n.G=f(v),n.H=r)}}if(n.x>=t&&n.x<t+a||n.x+u>t&&n.x+u<=t+a||n.x<t&&n.x+u>=t+a){if((!o||o&&o.T)&&n.y+u<i+e){var l=i-(n.y+u);l<n.S&&(n.S=f(l),n.Y=r)}if((!o||o&&o.C)&&n.y+u>i+e){var h=n.y-(i+e);h<n.N&&(n.N=f(h),n.J=r)}}}function z(n){n.q=bn,n.G=bn,n.N=In,n.S=In,n.F={},n.H={},n.J={},n.Y={};for(r=0;r<_n.length;r++)Y(n,_n[r]);for(r=0;r<or.length;r++)Y(n,or[r]);if(n.D||n.K)for(r=0;r<Hn.length;r++)Y(n,Hn[r]);if(n.D){for(var r=0;r<rr.length;r++)Y(n,rr[r]);0===Bn.G&&-1===n.M||0===Bn.q&&1===n.M?Y(n,Bn):Y(n,Bn,{T:n.N>hn})}}function C(n){Bn.x>n.x+hn-ln||Bn.x+wn<n.x+ln||Bn.y>n.y+hn-ln||Bn.y+wn<n.y+ln||F()}function E(n){n.L&&n.O&&n.P>0&&(Bn.x>n.O.x+n.O.width||Bn.x+wn<n.O.x||Bn.y>n.O.y+n.O.height||Bn.y+wn<n.O.y||F())}function J(n,r,o,t,f){var i=M(o,t,null);return i.x=n,i.y=r,i.l=n,i.h=r,i.K=!f,i.D=f,i.M=f?-1:0,i.p=!!f,i.I=0,i.B=!1,i.k=0,i.R=Nn,i.V={},i.W=R(i),i}function K(n,r){var o=J(n,r,wn,wn,!0);return Hn.push(o),o}function L(){for(var n=0;n<Hn.length;n++)O(Hn[n]);O(Bn)}function O(n){if(n.K&&U(),z(n),n.K&&n.F.D&&n.G>0&&n.q<=n.F.dx&&n.F.p&&-1===n.F.M)n.x=n.F.x-wn,z(n);else if(n.K&&n.H.D&&n.q>0&&n.G<=n.H.dx&&n.H.p&&1===n.H.M)n.x=n.H.x+wn,z(n);else{n.V={},n.K&&0===n.S&&n.Y.p&&n.Y.D&&(n.V=n.Y,n.p=!0,n.I=n.V.I);var t=n.D?n.M:1===ir.left?-1:1===ir.right?1:0,f=0===t||t===n.V.M?n.V.M:0,i=r(.2,o(1,(Un-n.I)/300))*n.R;n.V.D&&(t===f?i+=n.V.dx:i=n.V.dx);var u=!1;n.D&&n.q<hn&&n.G<hn&&(u=!0),n.p&&!u?1===t||1===f?(i=o(n.q,i),n.q>0&&(n.x=a(n.x+i))):-1!==t&&-1!==f||(i=o(n.G,i),n.G>0&&(n.x=e(n.x-i))):i=0,n.dx=i,n.D&&0===i&&(n.p=!1),z(n),n.D&&(n.x+wn<=0?n.x=bn:n.x>=bn?n.x=0:(1==n.M&&0==n.q||-1==n.M&&0==n.G||n.S>=hn&&n.N>=hn)&&(n.p=!0,n.M*=-1,n.I=0))}n.K&&G(),n.W&&V(n)}function P(n){h(kn,n.c,n.x-vn,n.y-vn,n.w,n.t),n.W&&W(n)}function Q(){for(var n=0;n<Hn.length;n++)P(Hn[n]);H()}function R(r){var o=n(4*vn,4*vn);return s(o.o,u(Kn)),o.x=r.i-o.w/2-vn,o.y=r.i-o.w/2-vn,r.j=0,r.X=p(),r.U=1,o}function V(n){var t=n.W,i=p();if(n.D?i=Vn:n.g?(i[0]=Kn[0],i[1]=Kn[1],i[2]=Kn[2]):(i[1]=100,i[2]=100),n.U<1){var a=r(0,o(1,(Un-n.j)/1e3))*Yn;n.U+=o(1-n.U,a),i[3]=n.U}n.X=i;var e=n.i-t.w/2-vn+n.M*ln;t.targetX=e;var u=n.A?-1:n.B?1:0,c=n.i-t.t/2-vn+u*ln,v=e!=t.x?(e>t.x?1:-1)*o(f(t.x-e),Tn):0,l=c!=t.y?(c>t.y?1:-1)*o(f(t.y-c),Tn):0,h=t.x+v,s=t.y+l;t.x=h,t.y=s}function W(n){var r=n.W;s(n.o,u(n.X)),v(n.o,n.i,n.i,n.i-4*vn),w(r.o,0,0,r.w,r.t),v(r.o,r.w/2,r.t/2,ln),h(kn,r.c,n.x+r.x,n.y+r.y,r.w,r.t)}function X(){for(var n=qn.o,r=0;r<or.length;r++){var o=(f=or[r]).x,t=f.y;f.w=hn+ln,f.t=hn+ln,f.i=o+dn,f.u=t+dn,f.L=!0,f.P=0,f.Z=Un+1500,h(n,Wn[f.v].c,o-vn,t-vn),s(n,u(Vn)),g(n,.3),c(n,o+dn/2-vn,t+dn/2-vn,dn+ln,dn+ln,5),g(n,1),c(n,o+dn/2,t+dn/2,dn,dn,5)}for(r=0;r<or.length;r++){var f=or[r];z(f),s(Dn.o,u(Kn));for(var i=0;i<4;i++){var a=0===i?f.N:1===i?f.S:2===i?f.G:f.q,e=0===i?f.J:1===i?f.Y:2===i?f.H:f.F,v=f.x+hn,l=f.y+hn;a>0&&i%2&&e&&e.L&&(i<2?(d(Dn.o,f.i-1,l,2,a),f.O={x:f.i-1,y:l,width:2,height:a}):(d(Dn.o,v,f.u-1,a,2),f.O={x:v,y:f.u-1,width:a,height:2}))}}}function Z(){for(var n=0;n<or.length;n++)$(or[n])}function $(n){Un>n.Z&&(0===n.P?(n.P=1,n.Z=Un+100):1===n.P?(n.P=-1,n.Z=Un+100):-1===n.P?(n.P=2,n.Z=Un+100):n.P>=2&&(n.P=0,n.Z=Un+1900))}function _(){for(var n=0;n<or.length;n++)nn(or[n])}function nn(n){kn.strokeStyle=u(Vn),kn.lineWidth=3,s(kn,u(Vn));for(var r=0;r<4;r++){var o=0===r?n.N:1===r?n.S:2===r?n.G:n.q,t=0===r?n.J:1===r?n.Y:2===r?n.H:n.F,f=n.x+hn,a=n.y+hn;if(o>0&&r%2&&n.P>0&&t&&t.L){if(m(kn),r<2){kn.moveTo(n.i,a);for(c=a;c<a+o;c+=12)i()>.97&&kn.lineTo(n.i+e(i()+dn)*(i()>.5?-1:1),c);kn.lineTo(n.i,a+o)}else{kn.moveTo(f,n.u);for(var c=f;c<f+o;c+=12)i()>.97&&kn.lineTo(c,n.u+e(i()+dn)*(i()>.5?-1:1));kn.lineTo(f+o,n.u)}kn.stroke(),y(kn)}}}function rn(n){kn.textAlign="center",kn.font="24px menlo,monaco,monospace",kn.fillStyle="white","object"==typeof n?(kn.fillText(n[0],xn,Fn),kn.fillText(n[1],xn,Fn+30)):kn.fillText(n,xn,Fn)}function on(n){var r=new Image;r.onload=function(){yn[n]=r,n===gn&&tn()},r.src="level"+(n+1)+".gif"}function tn(){cn=!1;yn[gn]||(gn=0,pn=0),s(Dn.o,u()),d(Dn.o,0,0,bn,In),w(qn.o,0,0,qn.w,qn.t),Bn||B(),k(),b(),I(),X(),x(),fn(),cn=!0}function fn(){for(var n in ir)ir[n]=-1;for(var r=0;r<Hn.length;r++)Hn[r].x=Hn[r].l,Hn[r].y=Hn[r].h;Bn.g=!1,Bn.x=Bn.l,Bn.y=Bn.h}function an(){if(En>0){var n=jn.length-1,o=e((Un+Jn)/3500);En<1?En-=.01:N()&&o>=n?En=.99:N()&&1===En&&(Jn+=200),s(kn,u(Kn)),g(kn,r(0,En)),d(kn,0,0,bn,In),!jn[o]&&En>0&&(o=n),jn[o]&&(o<n&&(o>=3?g(kn,1):g(kn,.6)),rn(jn[o])),g(kn,1),H()}}function en(n){Un=n||0,cn&&(Z(),L(),T(),h(kn,Dn.c,0,0,bn,In),Q(),h(kn,qn.c,0,0,bn,In),_(),A(),an()),requestAnimationFrame(en)}var un=window,cn=!1,vn=3,ln=2*vn,hn=24,sn=2*hn,dn=hn/2,wn=48,gn=0,mn=5,yn=[],pn=0===gn?0:1,Mn=0,bn=18*sn,In=18*sn,xn=In/2,kn=n(bn,In).o,An=kn.canvas;An.id="c",document.body.appendChild(An);var Bn,Un,jn=["A Studio Universe game.","@alpearcedev","Hold a direction to skip.",'"The Black Garden grows once more,',"More blight, more spines, more eyesore.","You always thought you could tear through,","But you lost the fight, didn't you?","My path will be chosen with care,","My path, my climb, into the nightmare.","I hope you can see me, all courage and heart,","No more saying I'm too weak, to explore and depart.","I will fight back, and I will find you,","Don't tell me, what I can't do.\"",["Move left, right, and down.","Use your arrow keys or press your screen edges."]],qn=n(bn,In),Dn=n(bn,In),Fn=24.75*hn,Gn=n(bn,In-Fn),Hn=[],Nn=3,Sn=3,Tn=1,Yn=.5,zn=8,Cn=400,En=0===gn?1:0,Jn=0,Kn=(u(),p());Kn[2]=6;var Ln=p();Ln[1]/=2,Ln[2]=25;var On=Gn.o.createLinearGradient(0,0,0,Gn.t);On.addColorStop(0,"rgba(50, 50, 50, 0.01)"),On.addColorStop(.05,"rgba(0, 0, 0, 0.2)"),On.addColorStop(.9,u(Kn));var Pn=Dn.o.createLinearGradient(0,0,0,In),Qn=p();Qn[2]-=5;var Rn=p();Rn[0]-=20,Rn[1]+=50,Rn[2]-=5,Pn.addColorStop(0,u(Qn)),Pn.addColorStop(.3,u(Qn)),Pn.addColorStop(1,u(Rn));var Vn=p();Vn[0]=30,Vn[1]+=50,Vn[2]=75;for(var Wn=[],Xn=[],Zn=[],$n=[],_n=[],nr=[],rr=[],or=[],tr=[],fr=0;fr<8;fr++)Wn.push(M(0,sn,null)),Xn.push(M(0,0,u(Ln),!0));for(fr=0;fr<1;fr++)Zn.push(function(){var r=hn+ln,o=hn/3,t=n(hn+ln,r);t.$=!0,s(t.o,u(Kn));for(var f=0;f<3;f++){var i=vn+f*o;l(t.o,i,r,i+o/2,0,i+o,r)}return t}());for(fr=0;fr<2;fr++)$n.push(function(r){var o=n(hn+ln,hn+ln);return s(o.o,u(Kn)),0===r?l(o.o,vn,vn,vn,o.t-vn,o.w,o.t/2):l(o.o,o.w-vn,vn,o.w-vn,o.t-vn,0,o.t/2),o.o.fill(),o}(fr));var ir={left:0,right:0,T:0,_:!1};un.onkeydown=function(n){var r=n.keyCode||n.which;65!=r&&37!=r||(ir.left=1),68!=r&&39!=r||(ir.right=1),83!=r&&40!=r||(ir.T=1),S(n)},un.onkeyup=function(n){var r=n.keyCode||n.which;65!=r&&37!=r||(ir.left=-1),68!=r&&39!=r||(ir.right=-1),83!=r&&40!=r||(ir.T=-1),S(n)},un.onmousedown=function(n){var r=window.innerWidth,o=window.innerHeight,t=n.touches&&n.touches.length?n.touches[0].clientX:n.clientX,f=n.touches&&n.touches.length?n.touches[0].clientY:n.clientY;t>.35*r&&t<.65*r&&f>.5*o?ir.T=1:(t<r/2&&(ir.left=1),t>r/2&&(ir.right=1)),S(n)},un.onmouseup=function(n){ir.left=-1,ir.right=-1,ir.T=-1,S(n)},un.ontouchstart=un.onmousedown,un.ontouchend=un.onmouseup,function(){for(var n=0;n<mn;n++)on(n)}(),en(0)}();
