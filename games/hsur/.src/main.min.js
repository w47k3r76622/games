window.rAF=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),function(){"use strict";function e(){s(),i()}function i(){switch(y){case 0:o();break;case 1:t(),l(),n();break;case 2:f();break;case 3:h();break;case 4:a();break;case 9:r()}window.rAF(i)}function t(){q.vx=0,p[65]&&(q.vx-=5),p[68]&&(q.vx+=5),p[32]&&!q.jumping&&(q.jumping=!0,q.vy=12,U++),q.fd.x=0,q.fd.y=0,p[37]&&(q.fd.x-=1),p[38]&&(q.fd.y-=1),p[39]&&(q.fd.x+=1),p[40]&&(q.fd.y+=1)}function l(){var e=0,i=0,t=0,l=0,n=0,o=0,f=0,h=!1,a=0;for(q.immunity&&(++q.immunityCount,120==q.immunityCount&&(q.immunityCount=0,q.immunity=!1)),e=0,i=b.length;i>e;e++)if(b[e].alive){for(Math.abs(b[e].x-q.x)<=16&&Math.abs(b[e].y-q.y)<=16&&!q.immunity&&(q.immunity=!0,q.hp--,b[e].alive=!1),t=0,l=k.length;l>t;t++)k[t].alive&&Math.abs(b[e].x+8-k[t].x)<=16&&Math.abs(b[e].y+4-k[t].y)<=16&&(b[e].alive=!1,k[t].alive=!1,A++,H++);if(++b[e].fireCount,75===b[e].fireCount){for(b[e].fireCount=0,t=0,l=N.length,h=!1;l>t&&!h;t++)N[t].alive||(N[t].x=b[e].x,N[t].y=b[e].y,N[t].fd.x=q.x-b[e].x,N[t].fd.y=q.y-b[e].y,N[t].fv=1/Math.sqrt(N[t].fd.x*N[t].fd.x+N[t].fd.y*N[t].fd.y),N[t].alive=!0,h=!0);h||(o=q.x-b[e].x,f=q.y-b[e].y,N.push({x:b[e].x,y:b[e].y,fd:{x:o,y:f},fv:1/Math.sqrt(o*o+f*f),alive:!0}))}}for(t=0,l=N.length;l>t;t++)N[t].alive&&Math.abs(q.x+8-N[t].x)<=8&&Math.abs(q.y+8-N[t].y)<=8&&!q.immunity&&(q.immunity=!0,q.hp--,N[t].alive=!1);for(0===q.hp&&(y=9,F=!1),q.vx>0?q.y>=R[Math.floor((16+q.x+q.vx+g)/32)]?q.x+=q.vx:q.x=32*Math.floor((16+q.x+q.vx+g)/32)-g-17:q.vx<0&&(q.x+q.vx<0?q.x=0:q.y>=R[Math.floor((q.x+q.vx+g)/32)]?q.x+=q.vx:q.x=32*Math.floor((q.x+q.vx+g)/32+1)-g),q.y+q.vy<Math.max(R[Math.floor((q.x+g)/32)],R[Math.floor((16+q.x+g)/32)])?(q.y=Math.max(R[Math.floor((q.x+g)/32)],R[Math.floor((16+q.x+g)/32)]),q.vy=0,q.jumping=!1):(q.y+=q.vy,q.vy-=1),q.x>500&&(g+=q.x-500,j+=q.x-500,I+=q.x-500,H=0,20>=j%5e3&&(E=1+Math.floor(j/5e3)/2),q.x=500,g>=32&&(g%=32,R.shift(),u(R.length))),j>=1e4*(q.fr-1)&&A>=10*(q.fr-1)&&q.fr++,e=0,i=k.length;i>e;e++)k[e].alive&&(k[e].x+=k[e].vx,k[e].y+=k[e].vy,k[e].alive=k[e].x>=0&&k[e].x<=c.width&&k[e].y>=0&&k[e].y<=c.height);for(e=0,i=N.length;i>e;e++)N[e].alive&&(N[e].x+=5*N[e].fd.x*N[e].fv,N[e].y+=5*N[e].fd.y*N[e].fv,N[e].alive=N[e].x>=0&&N[e].x<=c.width&&N[e].y>=0&&N[e].y<=c.height);if(C||(S=(S+1)%(60/q.fr),S||(C=!0)),C&&(0!==q.fd.x||0!==q.fd.y)){for(C=!1,I=0,a=1/Math.sqrt(q.fd.x*q.fd.x+q.fd.y*q.fd.y),e=0,i=k.length;i>e&&!h;e++)k[e].alive||(h=!0,k[e].x=q.x+8,k[e].y=q.y+8,k[e].vx=5*q.fd.x*a,k[e].vy=5*q.fd.y*a,k[e].alive=!0);h||k.push({x:q.x+8,y:q.y+8,vx:5*q.fd.x*a,vy:5*q.fd.y*a,alive:!0})}if(P++,P%Math.floor(300/E)===0){for(P=0,n=Math.max.apply(null,R),e=0,i=b.length,h=!1;i>e&&!h;e++)b[e].alive||(b[e].x=800,b[e].y=(308-n)*Math.random()+n+8,b[e].v=1+5*Math.random(),b[e].alive=!0,b[e].fireCount=0,h=!0);h||b.push({x:800,y:(308-n)*Math.random()+n+8,v:1+5*Math.random(),alive:!0,fireCount:0})}for(e=0,i=b.length;i>e;e++)b[e].alive&&(b[e].x-=b[e].v,b[e].x<-16&&(b[e].alive=!1));I>=6500&&!Y.noShoot.achieveThisRun&&(Y.achieveThisRun++,Y.noShoot.achieveThisRun=!0,Y.noShoot.achieve=!0),H>=10&&!Y.noScrolling.achieveThisRun&&(Y.achieveThisRun++,Y.noScrolling.achieveThisRun=!0,Y.noScrolling.achieve=!0),j>=15e3&&(A>=18&&!Y.kills.achieveThisRun&&(Y.achieveThisRun++,Y.kills.achieveThisRun=!0,Y.kills.achieve=!0),U>=50&&!Y.jumps.achieveThisRun&&(Y.achieveThisRun++,Y.jumps.achieveThisRun=!0,Y.jumps.achieve=!0),4===Y.achieveThisRun&&(Y.achieveThisRun++,Y.all.achieveThisRun=!0,Y.all.achieve=!0))}function n(){var e=0,i=k.length;for(v.fillStyle="#000",v.fillRect(0,0,c.width,c.height),v.fillStyle="#FF0",e=0;i>e;e++)k[e].alive&&v.fillRect(k[e].x-2,k[e].y-2,5,5);for(v.fillStyle="#0F0",e=0,i=N.length;i>e;e++)N[e].alive&&v.fillRect(N[e].x-2,N[e].y-2,5,5);for(v.fillStyle="#FFF",e=0,i=R.length;i>e;e++)v.fillRect(32*e-g,0,32,R[e]);for(q.render(),10===++D&&(D=0),e=0,i=b.length;i>e;e++)b[e].alive&&(v.fillStyle="#F33",v.beginPath(),v.moveTo(b[e].x,b[e].y),v.lineTo(b[e].x+16,b[e].y+8),v.lineTo(b[e].x+16,b[e].y-8),v.fill(),v.fillStyle="#FF0",v.fillRect(b[e].x+16,b[e].y-8,Math.abs(10-D)%5,4),v.fillRect(b[e].x+16,b[e].y+4,Math.abs(10-D)%5,4));for(v.fillStyle="#FFF",v.fillText("HP:",700,314),e=0;e<q.hp;e++)v.fillRect(740+20*e,300,16,16);v.fillText("Fire ratio: "+q.fr,5,314),v.fillText("Distance:   "+Math.floor(j/10),5,300),v.fillText("Kills:      "+A,5,286),q.immunity&&D%10!==0&&v.fillText("IMMUNE",700,284),v.fillText("Achievements:",300,314),Y.noShoot.achieveThisRun&&v.fillRect(450,302,12,12),Y.noScrolling.achieveThisRun&&v.fillRect(465,302,12,12),Y.kills.achieveThisRun&&v.fillRect(480,302,12,12),Y.jumps.achieveThisRun&&v.fillRect(495,302,12,12),Y.all.achieveThisRun&&v.fillRect(510,302,12,12)}function o(){var e=0,i=T.length;for(v.fillStyle="#000",v.fillRect(0,0,c.width,c.height),v.fillStyle="#FFF",v.font="50px Courier New",v.fillText("Hsur",20,60),v.font="25px Courier New",e=0;i>e;e++)d===e?(v.fillStyle="#00C",v.fillRect(20,114+30*e,16,16),v.fillStyle="#FF0"):v.fillStyle="#FFF",v.fillText(T[e],50,130+30*e);v.fillStyle="#FFF",v.font="18px Courier New",v.fillText('Press "W/S" to change options',450,260),v.fillText('and press "space" to select it',450,280),p[83]?(0===m&&(d=(d+1)%i),30===++m&&(m=0)):p[87]?(0===m&&(d--,-1===d&&(d=i-1)),30===++m&&(m=0)):m=0,p[32]?F&&(y=d+1,F=!1):F=!0}function f(){v.fillStyle="#000",v.fillRect(0,0,c.width,c.height),v.fillStyle="#FFF",v.font="50px Courier New",v.fillText("Instructions",20,60),v.font="18px Courier New",v.fillText("Movement:",50,90),v.font="15px Courier New",v.fillText("Use W and D for moving to left and right.",70,105),v.fillText('Use "space" for jumping.',70,120),v.fillText("Run to the right to increment your distance score.",70,135),v.font="18px Courier New",v.fillText("Shooting:",50,160),v.font="15px Courier New",v.fillText('Use "arrow keys" for shooting in that direction.',70,180),v.fillText("Hit the enemies with the bullets to increment your kill score.",70,195),v.fillText("Your fire ratio is the number of bullets per second and it",70,210),v.fillText("is incremented by 1 for every 10 kills and 1000 distance score.",70,225),v.font="18px Courier New",v.fillText("Defeat:",50,250),v.font="15px Courier New",v.fillText("Green bullets and enemies kill you.",70,270),v.fillText("You are immune when hit for a short period.",70,285),v.fillText("Your final score is: Distance * (1 + Kills).",70,300),v.font="18px Courier New",v.fillText('Press "space" to exit',530,280),p[32]?F&&(y=0,F=!1):F=!0}function h(){v.fillStyle="#000",v.fillRect(0,0,c.width,c.height),v.fillStyle="#FFF",v.font="50px Courier New",v.fillText("Story",20,60),v.font="18px Courier New",v.fillText("Year 2342:",50,85),v.font="15px Courier New",v.fillText("Aliens from the planet Hsur are invading the Earth, but, space soldiers like you",70,105),v.fillText("are defending it.",70,120),v.fillText("Armed with your antigravitational device and your pulse gun you rush the bottom",70,160),v.fillText("of the mother ship.",70,175),v.fillText("Hsur is a hard enemy, their battleships are going to destroy you...",70,215),v.fillText("...sooner or later. Good luck and try to save the Earth!",70,250),v.fillText('Press "space" to exit',530,280),p[32]?F&&(y=0,F=!1):F=!0}function a(){v.fillStyle="#000",v.fillRect(0,0,c.width,c.height),v.fillStyle="#FFF",v.font="50px Courier New",v.fillText("Achievements",20,60),v.font="18px Courier New",v.fillStyle=Y.noShoot.achieve?"#FF0":"#FFF",v.fillText("-"+Y.noShoot.text,50,100),v.fillStyle=Y.noScrolling.achieve?"#FF0":"#FFF",v.fillText("-"+Y.noScrolling.text,50,120),v.fillStyle=Y.kills.achieve?"#FF0":"#FFF",v.fillText("-"+Y.kills.text,50,140),v.fillStyle=Y.jumps.achieve?"#FF0":"#FFF",v.fillText("-"+Y.jumps.text,50,160),v.fillStyle=Y.all.achieve?"#FF0":"#FFF",v.fillText("-"+Y.all.text,50,180),v.fillStyle="#FFF",v.fillText('Press "space" to exit',530,280),p[32]?F&&(y=0,F=!1):F=!0}function r(){var e=0;v.fillStyle="#000",v.fillRect(0,0,c.width,c.height),v.fillStyle="#FFF",v.font="50px Courier New",v.fillText("GAME OVER",20,60),v.font="25px Courier New",v.fillText("Kills:       "+A,50,130),v.fillText("Distance:    "+Math.floor(j/10),50,160),v.fillText("Final Score: "+(1+A)*Math.floor(j/10),50,190),v.fillText("Achievements this run:",360,90),v.font="15px Courier New",Y.noShoot.achieveThisRun&&(e++,v.fillText("-"+Y.noShoot.text,380,100+20*e)),Y.noScrolling.achieveThisRun&&(e++,v.fillText("-"+Y.noScrolling.text,380,100+20*e)),Y.kills.achieveThisRun&&(e++,v.fillText("-"+Y.kills.text,380,100+20*e)),Y.jumps.achieveThisRun&&(e++,v.fillText("-"+Y.jumps.text,380,100+20*e)),Y.all.achieveThisRun&&(e++,v.fillText("-"+Y.all.text,380,100+20*e)),v.font="18px Courier New",v.fillText('Press "space" to restart',500,280),p[32]?F&&(y=0,F=!1,m=0,g=0,w=0,S=0,s(),x(k),x(b),x(N),j=0,A=0,E=1,P=0,q.x=0,q.y=32,q.hp=3,q.fr=2,H=0,I=0,U=0,Y.achieveThisRun=0,Y.noShoot.achieveThisRun=!1,Y.noScrolling.achieveThisRun=!1,Y.kills.achieveThisRun=!1,Y.jumps.achieveThisRun=!1,Y.all.achieveThisRun=!1):F=!0}function x(e){for(var i=0,t=e.length;t>i;i++)e[i].alive=!1}function s(){var e;for(R[0]=32,R[1]=32,e=2;26>e;e++)u(e)}function u(e){var i=Math.random();R[e-1]===R[e-2]?(M[0]=.45,M[1]=.55,w=R[e-1]):R[e-1]>R[e-2]?(M[0]=.4,M[1]=.6,w=R[e-2]):(M[0]=.3,M[1]=.5,w=R[e-1]),R[e]=i<=M[0]?w-(w>0?32:0):i<=M[1]?w:w+(256>=w?32:0)}var c=document.getElementById("game"),v=c.getContext("2d"),y=0,T=["Play","Instructions","Story","Achievements"],d=0,m=0,F=!0,p={},R=[],g=0,w=0,S=0,M=[0,1],C=!0,k=[],b=[],N=[],j=0,A=0,E=1,P=0,D=0,G=[83,87,65,68,32,37,38,39,40],q={x:0,y:32,vx:0,vy:0,hp:3,fr:2,fd:{x:0,y:0},jumping:!1,immunity:!0,immunityCount:0,render:function(){v.fillStyle="#00C",v.fillRect(this.x,this.y,16,16)}},H=0,I=0,U=0,Y={noShoot:{text:"Get 650 distance without shooting.",achieveThisRun:!1,achieve:!1},noScrolling:{text:"Get 10 kills without scrolling.",achieveThisRun:!1,achieve:!1},kills:{text:"Get 18 kills at least with 1500 distance.",achieveThisRun:!1,achieve:!1},jumps:{text:"Jump 50 times at least with 1500 distance.",achieveThisRun:!1,achieve:!1},all:{text:"Get all achievements in the same run.",achieveThisRun:!1,achieve:!1},achieveThisRun:0};document.addEventListener("keydown",function(e){p[e.which]=!0,-1!==G.indexOf(e.which)&&e.preventDefault()}),document.addEventListener("keyup",function(e){p[e.which]=!1,-1!==G.indexOf(e.which)&&e.preventDefault()}),e()}();