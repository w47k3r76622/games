function t(t,i,e,s){Object.defineProperty(t,i,{get:e,set:s,enumerable:!0,configurable:!0})}function i(t){return t&&t.__esModule?t.default:t}var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},s={},a={},n=e.parcelRequirefff2;null==n&&((n=function(t){if(t in s)return s[t].exports;if(t in a){var i=a[t];delete a[t];var e={id:t,exports:{}};return s[t]=e,i.call(e.exports,e,e.exports),e.exports}var n=Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(t,i){a[t]=i},e.parcelRequirefff2=n);var h=n.register;/**
 * @preserve
 * Kontra.js v10.0.2
 */function r(t,i){return Math.atan2(i.y-t.y,i.x-t.x)}function o(t,i,e){return{x:t.x+Math.cos(i)*e,y:t.y+Math.sin(i)*e}}function c(t,i){let e=l(t),s=l(i);return e.x<s.x+s.width&&e.x+e.width>s.x&&e.y<s.y+s.height&&e.y+e.height>s.y}function l(t){let{x:i=0,y:e=0,width:s,height:a,radius:n}=t.world||t;return t.mapwidth&&(s=t.mapwidth,a=t.mapheight),t.anchor&&(i-=s*t.anchor.x,e-=a*t.anchor.y),s<0&&(i+=s,s*=-1),a<0&&(e+=a,a*=-1),{x:i,y:e,width:s,height:a}}h("czZXI",function(i,e){t(i.exports,"register",()=>s,t=>s=t);var s,a=new Map;s=function(t,i){for(var e=0;e<i.length-1;e+=2)a.set(i[e],{baseUrl:t,path:i[e+1]})}}),h("fhYBo",function(i,e){t(i.exports,"getBundleURL",()=>s,t=>s=t);var s,a={};s=function(t){var i=a[t];return i||(i=function(){try{throw Error()}catch(i){var t=(""+i.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^)\n]+/g);if(t)return(""+t[2]).replace(/^((?:https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/.+)\/[^/]+$/,"$1")+"/"}return"/"}(),a[t]=i),i}}),n("czZXI").register(n("fhYBo").getBundleURL("hwOQr"),JSON.parse('["hwOQr","index.079e44ea.js","4U3ss","m.79ee6b06.png","f8m61","d.d8193a02.png","2rsXb","h.16d705d5.png","4Q1SH","t.323707e5.png","dUgnv","e.d027a945.png"]'));let d=()=>{},u,f,p={};function m(t,i){p[t]=p[t]||[],p[t].push(i)}function g(t,...i){(p[t]||[]).map(t=>t(...i))}let w={get:(t,i)=>"_proxy"==i||d};class x{constructor({spriteSheet:t,frames:i,frameRate:e,loop:s=!0,name:a}){let{width:n,height:h,spacing:r=0,margin:o=0}=t.frame;Object.assign(this,{spriteSheet:t,frames:i,frameRate:e,loop:s,name:a,width:n,height:h,spacing:r,margin:o,isStopped:!1,_f:0,_a:0})}clone(){return new x(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(t=1/60){if(!this.isStopped){if(this.loop||this._f!=this.frames.length-1)for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate;else this.stop()}}render({x:t,y:i,width:e=this.width,height:s=this.height,context:a=f}){let n=this.frames[this._f]/this.spriteSheet._f|0,h=this.frames[this._f]%this.spriteSheet._f|0;a.drawImage(this.spriteSheet.image,this.margin+h*this.width+(2*h+1)*this.spacing,this.margin+n*this.height+(2*n+1)*this.spacing,this.width,this.height,t,i,e,s)}}let y=/^\//,A=/\/$/,_=new WeakMap;function b(t,i){return new URL(t,i).href}let v={},k={};function E(t){return window.__k||(window.__k={dm:_,u:b,d:k,i:v}),new Promise((i,e)=>{let s,a,n;if(v[s=["".replace(A,""),t].filter(t=>t).join("/")])return i(v[s]);(a=new Image).onload=function(){let e;n=b(s,window.location.href),v[2==(e=t.replace("."+t.split(".").pop(),"")).split("/").length?e.replace(y,""):e]=v[s]=v[n]=this,g("assetLoaded",this,t),i(this)},a.onerror=function(){e(s)},a.src=s})}class S{constructor(t=0,i=0,e={}){null!=t.x?(this.x=t.x,this.y=t.y):(this.x=t,this.y=i)}set(t){this.x=t.x,this.y=t.y}add(t){return new S(this.x+t.x,this.y+t.y,this)}}class R{constructor(t){return this.init(t)}init(t={}){this.position=function(){return new S(...arguments)}(),Object.assign(this,t)}update(t){this.advance(t)}advance(t){}_pc(){}}class H extends R{init({width:t=0,height:i=0,context:e=f,render:s=this.draw,update:a=this.advance,anchor:n={x:0,y:0},scaleX:h=1,scaleY:r=1,...o}={}){super.init({width:t,height:i,context:e,anchor:n,scaleX:h,scaleY:r,...o}),this._di=!0,this._uw(),this._rf=s,this._uf=a,m("init",()=>{this.context??=f})}update(t){this._uf(t)}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),1==this.scaleX&&1==this.scaleY||t.scale(this.scaleX,this.scaleY);let i=this.width,e=this.height,s=-i*this.anchor.x,a=-e*this.anchor.y;(s||a)&&t.translate(s,a),this._rf(),(s||a)&&t.translate(-s,-a),t.restore()}draw(){}_pc(){this._uw()}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:i=0,_wsx:e=1,_wsy:s=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wsx=e*this.scaleX,this._wsy=s*this.scaleY,this._wx=this._wx*e,this._wy=this._wy*s,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,scaleX:this._wsx,scaleY:this._wsy}}setScale(t,i=t){this.scaleX=t,this.scaleY=i}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class L extends H{init({image:t,width:i=t?t.width:void 0,height:e=t?t.height:void 0,...s}={}){super.init({image:t,width:i,height:e,...s})}get animations(){return this._a}set animations(t){let i,e;for(i in this._a={},t)this._a[i]=t[i].clone(),e=e||this._a[i];this.currentAnimation=e,this.width=this.width||e.width,this.height=this.height||e.height}playAnimation(t){this.currentAnimation?.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){super.advance(t),this.currentAnimation?.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}function M(){return new L(...arguments)}let T=new WeakMap,X={},O={},D={0:"left",1:"middle",2:"right"};function C(t,i){return parseFloat(t.getPropertyValue(i))||0}function F(t){O[null!=t.button?D[t.button]:"left"]=!0,P(t,"onDown")}function B(t){O[null!=t.button?D[t.button]:"left"]=!1,P(t,"onUp")}function Y(t){P(t,"onOver")}function W(t){T.get(t.target)._oo=null,O={}}function U(t,i,e){let s=function(t){let i=t._lf.length?t._lf:t._cf;for(let e=i.length-1;e>=0;e--){let s=i[e];if(s.collidesWithPointer?s.collidesWithPointer(t):function(t,i){let{x:e,y:s,width:a,height:n}=l(i);do e-=i.sx||0,s-=i.sy||0;while(i=i.parent)let h=t.x-Math.max(e,Math.min(t.x,e+a)),r=t.y-Math.max(s,Math.min(t.y,s+n));return h*h+r*r<t.radius*t.radius}(t,s))return s}}(t);s&&s[i]&&s[i](e),X[i]&&X[i](e,s),"onOver"==i&&(s!=t._oo&&t._oo&&t._oo.onOut&&t._oo.onOut(e),t._oo=s)}function P(t,i){t.preventDefault();let e=t.target,s=T.get(e),{scaleX:a,scaleY:n,offsetX:h,offsetY:r}=function(t){let{canvas:i,_s:e}=t,s=i.getBoundingClientRect(),a="none"!=e.transform?e.transform.replace("matrix(","").split(","):[1,1,1,1],n=parseFloat(a[0]),h=parseFloat(a[3]),r=(C(e,"border-left-width")+C(e,"border-right-width"))*n,o=(C(e,"border-top-width")+C(e,"border-bottom-width"))*h,c=(C(e,"padding-left")+C(e,"padding-right"))*n,l=(C(e,"padding-top")+C(e,"padding-bottom"))*h;return{scaleX:(s.width-r-c)/i.width,scaleY:(s.height-o-l)/i.height,offsetX:s.left+(C(e,"border-left-width")+C(e,"padding-left"))*n,offsetY:s.top+(C(e,"border-top-width")+C(e,"padding-top"))*h}}(s);t.type.includes("touch")?(Array.from(t.touches).map(({clientX:t,clientY:i,identifier:e})=>{let o=s.touches[e];o||(o=s.touches[e]={start:{x:(t-h)/a,y:(i-r)/n}},s.touches.length++),o.changed=!1}),Array.from(t.changedTouches).map(({clientX:e,clientY:o,identifier:c})=>{let l=s.touches[c];l.changed=!0,l.x=s.x=(e-h)/a,l.y=s.y=(o-r)/n,U(s,i,t),g("touchChanged",t,s.touches),"onUp"==i&&(delete s.touches[c],s.touches.length--,s.touches.length||g("touchEnd"))})):(s.x=(t.clientX-h)/a,s.y=(t.clientY-r)/n,U(s,i,t))}function Q(t){let i=t.canvas;t.clearRect(0,0,i.width,i.height)}let I=[],q={},j={},G={0:"south",1:"east",2:"west",3:"north",4:"leftshoulder",5:"rightshoulder",6:"lefttrigger",7:"righttrigger",8:"select",9:"start",10:"leftstick",11:"rightstick",12:"dpadup",13:"dpaddown",14:"dpadleft",15:"dpadright"};function $(t){I[t.gamepad.index]={pressedButtons:{},axes:{}}}function z(t){delete I[t.gamepad.index]}function N(){I.map(t=>{t.pressedButtons={},t.axes={}})}function Z(){let t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[];for(let i=0;i<t.length;i++){let e=t[i];if(!e)continue;e.buttons.map((t,i)=>{let s=G[i],{pressed:a}=t,{pressedButtons:n}=I[e.index],h=n[s];!h&&a?[q[e.index],q].map(i=>{i?.[s]?.(e,t,s)}):h&&!a&&[j[e.index],j].map(i=>{i?.[s]?.(e,t,s)}),n[s]=a});let{axes:s}=I[e.index];s.leftstickx=e.axes[0],s.leftsticky=e.axes[1],s.rightstickx=e.axes[2],s.rightsticky=e.axes[3]}}let J,K={},V=!1,tt={swipe:{touches:1,threshold:10,touchend({0:t}){let i=t.x-t.start.x,e=t.y-t.start.y,s=Math.abs(i),a=Math.abs(e);if(!(s<this.threshold&&a<this.threshold))return s>a?i<0?"left":"right":e<0?"up":"down"}},pinch:{touches:2,threshold:2,touchstart({0:t,1:i}){this.prevDist=Math.hypot(t.x-i.x,t.y-i.y)},touchmove({0:t,1:i}){let e=Math.hypot(t.x-i.x,t.y-i.y);if(Math.abs(e-this.prevDist)<this.threshold)return;let s=e>this.prevDist?"out":"in";return this.prevDist=e,s}}},ti,te={},ts={},ta={},tn={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function th(t=d,i){t._pd&&i.preventDefault(),t(i)}function tr(t){let i=tn[t.code],e=te[i];ta[i]=!0,th(e,t)}function to(t){let i=tn[t.code],e=ts[i];ta[i]=!1,th(e,t)}function tc(){ta={}}function tl(t,i,{handler:e="keydown",preventDefault:s=!0}={}){let a="keydown"==e?te:ts;i._pd=s,[].concat(t).map(t=>a[t]=i)}function td(){ti??=Date.now(),ti|=0;let t=(ti=ti+2654435769|0)^ti>>>16;return t=Math.imul(t,569420461),t^=t>>>15,t=Math.imul(t,1935289751),((t^=t>>>15)>>>0)/4294967296}function tu(t,i,e=td){return(e()*(i-t+1)|0)+t}class tf{constructor({image:t,frameWidth:i,frameHeight:e,spacing:s=0,margin:a=0,animations:n}={}){this.animations={},this.image=t,this.frame={width:i,height:e,spacing:s,margin:a},this._f=(t.width-a)/i|0,this.createAnimations(n)}createAnimations(t){let i,e;for(e in t){let{frames:s,frameRate:a,loop:n}=t[e];i=[],[].concat(s).map(t=>{i=i.concat(function(t){if(+t==t)return t;let i=[],e=t.split(".."),s=+e[0],a=+e[1],n=s;if(s<a)for(;n<=a;n++)i.push(n);else for(;n>=a;n--)i.push(n);return i}(t))}),this.animations[e]=function(){return new x(...arguments)}({spriteSheet:this,frames:i,frameRate:a,loop:n,name:e})}}}function tp(){return new tf(...arguments)}var tm={};tm=n("fhYBo").getBundleURL("hwOQr")+"m.79ee6b06.png";class tg{constructor(t){this.canvas=t}async init(){window.addEventListener("click",this.#t.bind(this));let t=tp({frameWidth:16,frameHeight:16,spacing:0,margin:0,animations:{grass:{frames:0},wall:{frames:1}},image:await E(i(tm))});this.map=[];for(let i=0;i<13;i++)for(let e=0;e<20;e++){let s=new M({x:16*e,y:16*i,animations:t.animations});(i<3||i>11)&&s.playAnimation("wall"),this.map.push(s)}}isOutOfBounds({y:t}){return t<=50||t>=180}handleMapClick(t){window.addEventListener("mapClick",i=>{t(i.detail)})}render(){this.map.forEach(t=>t.render())}#t(t){if(t.target!==this.canvas)return;let{x:i,y:e}=function(t=u){return T.get(t)}(),s=this.isOutOfBounds({y:e}),a=new CustomEvent("mapClick",{detail:{x:i,y:e,outOfBounds:s}});window.dispatchEvent(a)}}async function tw(t){let i=new tg(t);return await i.init(),i}class tx extends L{init(t){super.init(t),this.width=4,this.height=4,this.y-=5,this.anchor={x:.5,y:.5}}update(){this.advance()}draw(){this.parent.isSelected&&(this.context.strokeStyle="#FFE629",this.context.lineWidth=2,this.context.beginPath(),this.context.ellipse(this.x+16,this.y+32,6,2,0,0,Math.PI),this.context.stroke())}}class ty extends L{init(t){super.init(t),this.width=4,this.height=4,this.y-=5,this.anchor={x:.5,y:.5},this.opacity=.8,this.color=t?.color||"#0090FF"}update(){this.advance()}draw(){this.parent.so&&(this.context.strokeStyle=this.color,this.context.lineWidth=2,this.context.beginPath(),this.context.ellipse(this.x+16,this.y+32,6,2,0,0,Math.PI),this.context.stroke())}}class tA extends L{init(t){super.init({...t}),this.mh=100,this.h=this.mh,this.d=null,this.a=null,this.width=32,this.height=32,this.anchor={x:.5,y:.5},this.movingTo=null,this.target=null,this.ft=null,this.speed=t.speed||1,this.isSelected=!1,this.chl=new tx({parent:this}),this.co=new ty({parent:this}),this.abilities=[],this.so=!1}collidesWithPointer(t){return t.x>this.x-this.width/2&&t.x<this.x+this.width/2&&t.y>this.y-this.height/2&&t.y<this.y+this.height/2}addAbility(t){this.abilities.push(t)}moveTo({x:t,y:i}){this.movingTo={x:t,y:i}}iA(){return this.h>0}dodgeAttack(){return tu(1,100)<=this.d}blockAttack(){return tu(1,100)<=this.a}takeDamage(t,i){this.iA()&&!this.target&&(this.target=t,this.isSelected&&(this.enemies.forEach(t=>t.so=!1),t.so=!0)),this.blockAttack()||this.dodgeAttack()||(this.h-=i)}gainHealth(t){this.h+=t}draw(){super.draw(),this.chl.draw(),this.co.draw()}update(t){if(this.advance(),!this.iA()){this.playAnimation("dead");return}if(this.target&&!this.target.iA()&&(this.target.so=!1,this.target=null),this.abilities.forEach(i=>i.update(t)),this.movingTo){if(Math.hypot(this.movingTo.x-this.x,this.movingTo.y-this.y)>this.speed){this.isMoving=!0,this.movingTo.x<this.x?this.scaleX=-1:this.scaleX=1;let{x:t,y:i}=o(this,r(this,this.movingTo),this.speed);this.x=Math.round(t),this.y=Math.round(i),this.playAnimation("w")}else this.movingTo=null,this.playAnimation("i"),this.basicAttack?.isMelee()&&this.basicAttack?.resetCooldown()}}}tA.frameRates={image:null,frameWidth:32,frameHeight:32,spacing:0,margin:0,animations:{i:{frames:[4,5],frameRate:2},w:{frames:[6,7],frameRate:6},attack:{frames:[2,3],loop:!1,frameRate:6},ability:{frames:[0,1],loop:!1,frameRate:6},profile:{frames:1},dead:{frames:8}}};var t_=tA;class tb extends L{init(t){super.init({...t,anchor:{x:.5,y:.5}}),this.speed=t.speed||1,this.onHit=t.onHit||(()=>{})}update(){if(this.advance(),"explode"===this.currentAnimation.name){this.currentAnimation.isStopped&&(this.ttl=-1);return}if(!this.target)return;if(c(this,this.target)){this.onHit(),this.playAnimation("explode");return}let{x:t,y:i}=o(this,r(this,this.target),this.speed);this.x=t,this.y=i}}var tv={};tv=n("fhYBo").getBundleURL("hwOQr")+"d.d8193a02.png";class tk extends tb{init(t){super.init({...t,animations:tk.spritesheet.animations,width:12,height:12})}update(t){super.update(t)}}async function tE(){let t=tp({image:await E(i(tv)),frameWidth:32,frameHeight:32,spacing:0,margin:0,animations:{seek:{frames:[0,1],frameRate:4,loop:!0},explode:{frames:[0],frameRate:30,loop:!1}}});tk.spritesheet=t}class tS{#i;constructor({name:t,type:i,description:e,action:s,cooldown:a}){this.name=t,this.type=i,this.description=e,this.action=s,this.cooldown=a,this.#i=this.cooldown}update(t){this.#i+=t}isMelee(){return"melee"===this.type}criticalHit(t,i,e){return tu(1,100)<=t?e*i:e}canUse(){return this.#i>=this.cooldown}resetCooldown(){this.#i=this.cooldown}percentRemainingCooldown(){return(this.cooldown-this.#i)/this.cooldown}isReady(){return this.cooldown-this.#i<=0}use(t){this.canUse()&&this.action(t)&&(this.#i=0)}}class tR extends t_{init(t){super.init(t),this.addAbility(new tS({action:t=>this.fireball(t),cooldown:1})),this.basicAttack=new tS({action:()=>this.attack(25),cooldown:2}),this.a=8,this.d=8}fireball(t){if(!this.target?.iA())return!1;this.playAnimation("ability");let i=new tk({x:this.x,y:this.y,target:this.target,onHit:()=>{if(!this.target?.iA())return!1;let t=tu(30,40);this.target.takeDamage(t)}});return t.push(i),!0}attack(t){return t=this.basicAttack.criticalHit(20,4,t),!!this.target?.iA()&&(this.target.takeDamage(t),"ability"!==this.currentAnimation.name&&this.playAnimation("attack"),!0)}update(t){super.update(t),this.iA()&&(this.basicAttack.update(t),this.basicAttack.use(),this.target||(this.target=this.enemies[tu(0,this.enemies.length-1)],this.enemies.forEach(t=>t.so=!1),this.target.so=!0),["attack","ability"].includes(this.currentAnimation.name)&&this.currentAnimation.isStopped&&this.playAnimation("i"),"w"!==this.currentAnimation.name&&this.target&&this.target.iA()&&(this.target.x<this.x?this.scaleX=-1:this.scaleX=1))}}async function tH(){let t=await E(i(tv));return new tR({x:80,y:112,animations:tp({...t_.frameRates,image:t}).animations})}var tL={};tL=n("fhYBo").getBundleURL("hwOQr")+"h.16d705d5.png";class tM extends t_{init(t){super.init({...t}),this.addAbility(new tS({action:()=>(this.playAnimation("hh"),this.heal(40)),cooldown:2})),this.autoHeal=new tS({action:()=>this.heal(3),cooldown:1}),this.a=10,this.d=10}heal(t){return!!this.ft?.iA()&&!(this.ft.h>=100)&&(this.ft.h=Math.min(this.ft.h+t,100),"hh"!==this.currentAnimation.name&&this.playAnimation("heal"),!0)}update(t){super.update(t),this.iA()&&(this.isSelected&&this.ft?this.ft.so=!0:this.ft&&(this.ft.so=!1),this.autoHeal.update(t),this.autoHeal.use(),["heal","hh"].includes(this.currentAnimation.name)&&this.currentAnimation.isStopped&&this.playAnimation("i"),this.ft&&!this.ft.iA()&&this.playAnimation("i"),"walk"!==this.currentAnimation.name&&this.ft&&this.ft.iA()&&(this.ft.x<this.x?this.scaleX=-1:this.scaleX=1))}}async function tT(){let t=await E(i(tL));return new tM({x:144,y:112,animations:tp({...t_.frameRates,image:t,animations:{...t_.frameRates.animations,heal:{frames:[2,3],loop:!1,frameRate:3},hh:{frames:[0,1,2,1,0],loop:!1,frameRate:6}}}).animations})}var tX={};tX=n("fhYBo").getBundleURL("hwOQr")+"t.323707e5.png";class tO extends t_{init(t){super.init(t),this.speed=1.1,this.addAbility(new tS({action:()=>this.taunt(),cooldown:3})),this.basicAttack=new tS({type:"melee",action:()=>this.attack(25),cooldown:1}),this.a=5,this.d=5}taunt(){return this.enemies.forEach(t=>{t.target=this}),this.playAnimation("ability"),!0}attack(t){t=this.basicAttack.criticalHit(15,2,t);let i={x:this.x-8,y:this.y-8,width:8,height:8};return!!(this.target?.iA()&&c(i,this.target))&&(this.target.takeDamage(t),"ability"!==this.currentAnimation.name&&this.playAnimation("attack"),!0)}update(t){if(super.update(t),this.iA()&&(this.basicAttack.update(t),this.basicAttack.use(),["attack","ability"].includes(this.currentAnimation.name)&&this.currentAnimation.isStopped&&this.playAnimation("i"),this.target&&!this.target.iA()&&this.playAnimation("i"),this.target&&this.target.iA())){let t={x:this.x-8,y:this.y-8,width:8,height:8};if(this.target.x<this.x?this.scaleX=-1:this.scaleX=1,!c(t,this.target)){let{x:t,y:i}=o(this,r(this,this.target),this.speed);this.x=t,this.y=i,this.playAnimation("w")}}}}async function tD(){let t=await E(i(tX));return new tO({x:112,y:112,animations:tp({...t_.frameRates,image:t,animations:{...t_.frameRates.animations,ability:{frames:[0,1,0],loop:!1,frameRate:4}}}).animations})}class tC extends L{draw(){let t=Math.max(0,this.combatant.h)/this.combatant.mh,i=Math.ceil(t*this.maxWidth);M({x:-1,y:-1,width:this.maxWidth+2,height:this.height+2,color:"black"}).render(),M({x:0,y:0,width:this.maxWidth,height:this.height,color:"#203C25"}).render(),M({x:0,y:0,width:i,height:this.height,color:t<.3?"#E54D2E":"#46A758"}).render(),M({x:0,y:0,width:this.maxWidth,height:Math.floor(this.height/2),color:"rgba(255, 255, 255, 0.3)"}).render()}}class tF extends L{init(t){super.init({...t,anchor:{x:.5,y:.5}}),this.mh=100,this.h=this.mh,this.d=null,this.a=null,this.damage=5,this.width=32,this.height=32,this.target=null,this.speed=t.speed||1,this.timeSinceLastAttack=1,this.co=new ty({parent:this,color:"#E54D2E"})}iA(){return this.h>0}dodgeAttack(){return tu(1,100)<=this.d}blockAttack(){return tu(1,100)<=this.a}takeDamage(t){this.blockAttack()||this.dodgeAttack()||(this.h-=t)}attackTarget(){this.target.takeDamage(this,this.damage),"attack"!==this.currentAnimation.name&&this.playAnimation("attack")}collidesWithPointer(t){return t.x>this.x-this.width/2&&t.x<this.x+this.width/2&&t.y>this.y-this.height/2&&t.y<this.y+this.height/2}update(t){if(this.advance(),!this.iA()){this.playAnimation("dead"),this.so=!1,this.opacity=.5;return}if(!this.target||!this.target.iA()){let t=this.characters;this.target=t[tu(0,t.length-1)]}if(this.target&&this.target.iA()&&(this.target.x<this.x?this.scaleX=-1:this.scaleX=1,!c({x:this.x-8,y:this.y-8,width:8,height:8},this.target))){let{x:t,y:i}=o(this,r(this,this.target),this.speed);this.x=t,this.y=i,this.playAnimation("w")}this.target&&this.target.iA()&&c({x:this.x-8,y:this.y-8,width:8,height:8},this.target)?(this.timeSinceLastAttack>=1&&(this.attackTarget(),this.timeSinceLastAttack=0),this.timeSinceLastAttack+=t):(this.playAnimation("i"),this.timeSinceLastAttack=1)}draw(){super.draw(),this.co.draw(),this.iA()&&new tC({parent:this,combatant:this,maxWidth:12,height:2,x:10,y:0}).render()}}var tB={};async function tY(){let t=tp({image:await E(i(tB)),frameWidth:32,frameHeight:32,spacing:0,margin:0,animations:{i:{frames:[3,4],frameRate:2},w:{frames:[3,4],frameRate:5},attack:{frames:[3,4,1,2],frameRate:10},dead:{frames:[0],frameRate:1}}});return i=>{var e;return e=t.animations,Array.from({length:i},()=>new tF({x:tu(0,2)%2==0?-10:330,y:tu(60,190),speed:1,animations:e}))}}tB=n("fhYBo").getBundleURL("hwOQr")+"e.d027a945.png";class tW extends H{#e;#s;setCharacters(...t){this.#e=t,this.#s=t.map(t=>{let i=M({width:32,height:32,animations:t.animations});return i.playAnimation("profile"),i})}update(t){this.#s.forEach(i=>i.update(t))}draw(){this.context.fillStyle="#fff",this.context.font="8px",this.#e.forEach((t,i)=>{let e=72*i,s=M({x:e,y:4,width:34,height:34,color:t.isSelected?"#FFE629":"black"});s.render(),M({x:e+1,y:5,width:32,height:32,color:"black"}).render(),new tC({combatant:t,maxWidth:30,height:4,x:e+2,y:32}).render();let a=[];t.abilities?.forEach(t=>{let i=M({x:e+36,y:4+4,width:24,height:24,color:t.isReady()?"black":"rgba(0,0,0,.7)"});i.render(),M({x:e+36,y:4+24,width:Math.max(0,24*t.percentRemainingCooldown()),height:4,color:"white"}).render(),a.push(i)});let{x:n,y:h}=s.world;this.#s[i].x=n,this.#s[i].y=h,this.#s[i].render(),this.context.fillText(`${i+1}`,s.x+3,14),a.forEach(t=>{let{x:i,y:e}=t.world;this.context.fillText("Q",i+2,e+8)})})}}async function tU(){let t=new tW;return console.log("initHUD"),t}!async function(){let t;!function({contextless:t=!1}={}){u=document.getElementById(void 0)||document.querySelector("canvas"),t&&(u=u||new Proxy({},w)),(f=u.getContext("2d")||new Proxy({},w)).imageSmoothingEnabled=!1,g("init")}(),function(t={}){(function(){let t;for(t=0;t<26;t++)tn["Key"+String.fromCharCode(t+65)]=String.fromCharCode(t+97);for(t=0;t<10;t++)tn["Digit"+t]=tn["Numpad"+t]=""+t;window.addEventListener("keydown",tr),window.addEventListener("keyup",to),window.addEventListener("blur",tc)})(),function({radius:t=5,canvas:i=u}={}){let e=T.get(i);if(!e){let s=window.getComputedStyle(i);e={x:0,y:0,radius:t,touches:{length:0},canvas:i,_cf:[],_lf:[],_o:[],_oo:null,_s:s},T.set(i,e)}i.addEventListener("mousedown",F),i.addEventListener("touchstart",F),i.addEventListener("mouseup",B),i.addEventListener("touchend",B),i.addEventListener("touchcancel",B),i.addEventListener("blur",W),i.addEventListener("mousemove",Y),i.addEventListener("touchmove",Y),e._t||(e._t=!0,m("tick",()=>{e._lf.length=0,e._cf.map(t=>{e._lf.push(t)}),e._cf.length=0}))}(t.pointer),V||(V=!0,m("touchChanged",(t,i)=>{Object.keys(tt).map(e=>{let s,a=tt[e];(!J||J==e)&&i.length==a.touches&&[...Array(i.length).keys()].every(t=>i[t])&&(s=a[t.type]?.(i)??"")&&K[e+s]&&(J=e,K[e+s](t,i))})}),m("touchEnd",()=>{J=0})),window.addEventListener("gamepadconnected",$),window.addEventListener("gamepaddisconnected",z),window.addEventListener("blur",N),m("tick",Z)}();let i=document.querySelector("canvas");document.addEventListener("contextmenu",t=>t.preventDefault());let[e,s,a,n,h,r]=await Promise.all([tw(i),tH(),tT(),tD(),tU(),tY(),tE()]),o=[s,n,a];h.setCharacters(...o);let c=r(1);c.forEach(t=>{t.characters=o}),o.forEach(t=>t.enemies=c),a.ft=n;let p=i=>()=>{o.forEach(t=>t.isSelected=!1),(t=o[i]).isSelected=!0,c.forEach(t=>t.so=!1),t.target&&(t.target.so=!0)};p(0)();let x=[...o,...c];tl("1",p(0)),tl("2",p(1)),tl("3",p(2)),tl("q",()=>t.abilities[0].use(x)),tl("r",()=>{window.location.reload()}),e.handleMapClick(({x:i,y:e,outOfBounds:h})=>{if(h)return;let r=o.find(t=>!!t.iA()&&t.collidesWithPointer({x:i,y:e})),l=c.find(t=>!!t.iA()&&t.collidesWithPointer({x:i,y:e}));if(t===a&&r){o.forEach(t=>t.so=!1),a.ft=r;return}if([s,n].includes(t)&&l){c.forEach(t=>t.so=!1),t.target=l,t.target.so=!0,t===n&&(t.movingTo=null);return}t===n&&(t.so=!1,t.target=null),t.moveTo({x:i,y:e})});let y=1,A=!1;(function({fps:t=60,clearCanvas:i=!0,update:e=d,render:s,context:a=f,blur:n=!1}={}){let h,r,o,c,l,u=0,p=1e3/t,w=1/t,x=i?Q:d,y=!0;function A(){if(r=requestAnimationFrame(A),y&&(c=(o=performance.now())-h,h=o,!(c>1e3))){for(u+=c;u>=p;)g("tick"),l.update(w),u-=p;x(l.context),l.render()}}return n||(window.addEventListener("focus",()=>{y=!0}),window.addEventListener("blur",()=>{y=!1})),m("init",()=>{l.context??=f}),l={update:e,render:s,isStopped:!0,context:a,start(){this.isStopped&&(h=performance.now(),this.isStopped=!1,requestAnimationFrame(A))},stop(){this.isStopped=!0,cancelAnimationFrame(r)}}})({blur:!0,fps:40,update:function(t){if(o.every(t=>!t.iA())){A=!0;return}if(h.update(),c.every(t=>!t.iA())){let t=r(Math.min(y+=1,13));t.forEach(t=>{t.characters=o}),o.forEach(i=>i.enemies=t),x.push(...t),c.push(...t)}x.sort((t,i)=>{let e=function(t,i,e="y"){return[t,i]=[t,i].map(l),t[e]-i[e]}(t,i,"y");if(t.iA&&i.iA){if(t.iA()&&!i.iA())return 1;if(!t.iA()&&i.iA())return -1}return e}),x.forEach(i=>i.update(t))},render:function(){e.render(),h.render(),x.forEach(t=>{t instanceof tk&&t.currentAnimation.isStopped&&x.splice(x.indexOf(t),1),t.render()});let t=i.getContext("2d");t.fillStyle="#fff",t.font="bold 14px",t.fillText(`${y}`,i.width-24,20),A&&(t.fillText("end",100,100),t.fillText("R-etry",100,120))}}).start()}();