(()=>{"use strict";var t={11:(t,e,r)=>{e.__esModule=!0,e.chooseNextMove=void 0;var i=r(769);e.chooseNextMove=function(t){var e=i.ALL_DIRECTIONS.map((function(e){for(var r=t.existingCardsAfterMove(e),n=r.newCards,a=r.areChanged?0:-1/0,o=0,s=n;o<s.length;o++){var h=s[o];h.val===i.WIN_VAL?a+=2*h.val:8===h.val?a-=2*h.val:6===h.val&&(a+=h.val)}return{direction:e,score:a-=n.length}}));return e.sort((function(t,e){return t.score-e.score})),e.pop().direction}},769:function(t,e,r){var i=this&&this.__generator||function(t,e){var r,i,n,a,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&a[0]?i.return:a[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,a[1])).done)return n;switch(i=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((n=(n=o.trys).length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){o.label=a[1];break}if(6===a[0]&&o.label<n[1]){o.label=n[1],n=a;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(a);break}n[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],i=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};e.__esModule=!0,e.Game=e.Card=e.WIN_VAL=e.ALL_DIRECTIONS=void 0;var n=r(350);e.ALL_DIRECTIONS=[[0,-1],[1,0],[0,1],[-1,0]],e.WIN_VAL=9;var a=function(){function t(){this.since=Date.now()}return t.prototype.copy=function(){var e=new t;return e.x=this.x,e.y=this.y,e.val=this.val,e.since=this.since,e},t.prototype.valid=function(){return this.val>0&&this.val<e.WIN_VAL},t}();e.Card=a;var o=function(){function t(t,e){void 0===e&&(e=3),this.cards=new Array,this.doneCards=new Array,this.score=0,this.kills=0,this.garbageIn=new Array,this.garbageOut=0,this.alive=!0,this.cardHistory=new WeakMap,this.size=e;var r=new n.RC4(t);for(this.iterator=this.newIterator(r);this.cards.length<e;){var i=r.inRange(0,e),o=r.inRange(0,e);if(!this.cardAt(i,o)){var s=new a;s.x=i,s.y=o,s.val=this.iterator.next().value,this.cards.push(s)}}this.next=this.iterator.next().value}return t.prototype.update=function(t){var r=this,i=this.existingCardsAfterMove(t),n=i.newCards;if(i.areChanged){this.cards=n;for(var a=0,o=this.cards;a<o.length;a++){var s=o[a];s.val===e.WIN_VAL&&(this.score+=s.val,this.garbageOut++)}this.doneCards=this.cards.filter((function(t){return!t.valid()})),this.cards=this.cards.filter((function(t){return t.valid()}));var h=this.newCardAfterMove(t);this.cards.push(h)}var u=e.ALL_DIRECTIONS.map((function(t){return r.existingCardsAfterMove(t)})).filter((function(t){return t.areChanged}));0===u.length&&(this.alive=!1)},t.prototype.addSourceToCard=function(t,e){this.cardHistory.has(t)||this.cardHistory.set(t,new Array),this.cardHistory.get(t).push(e)},t.prototype.existingCardsAfterMove=function(t){for(var e=this.cards.concat(),r=new Array,i=!1,n=!1;;){for(var o=Array(),s=function(e){var s=e.x+t[0],u=e.y+t[1];if((s<0||s>=h.size)&&(s=e.x),(u<0||u>=h.size)&&(u=e.y),s===e.x&&u===e.y)r.push(e.copy());else{var c=r.find((function(t){return t.x===s&&t.y===u}));if(c)h.canMerge(e.val,c.val)?(c.val+=e.val,h.addSourceToCard(c,e),c.since=Date.now(),i=!0):r.push(e.copy());else if(n){var l=new a;l.x=s,l.y=u,l.val=e.val,r.push(l),h.addSourceToCard(l,e),i=!0}else o.push(e)}},h=this,u=0,c=e;u<c.length;u++)s(c[u]);if(0===o.length)break;o.length===e.length?n=!0:e=o}return{newCards:r,areChanged:i}},t.prototype.newIterator=function(t){var e,r,n;return i(this,(function(i){switch(i.label){case 0:e=new Array,i.label=1;case 1:if(0===e.length)for(r=[1,2];r.length;)n=r.splice(t.inRange(0,r.length),1)[0],e.push(n);return[4,e.pop()];case 2:return i.sent(),[3,1];case 3:return[2]}}))},t.prototype.cardAt=function(t,e){return this.cards.find((function(r){return r.x===t&&r.y===e}))},t.prototype.newCardAfterMove=function(t){var e=[-1,-1];do{for(var r=0;r<2;++r)switch(t[r]){case-1:e[r]=this.size-1;break;case 0:e[r]=Math.floor(Math.random()*this.size);break;case 1:e[r]=0}}while(this.cardAt(e[0],e[1]));var i=new a;return i.x=e[0],i.y=e[1],this.garbageIn.length?i.val=this.garbageIn.shift():(i.val=this.next,this.next=this.iterator.next().value),i},t.prototype.canMerge=function(t,e){return t===2*e||t===3*e||e===2*t||e===3*t},t}();e.Game=o},251:(t,e,r)=>{e.__esModule=!0,e.BotPlayer=void 0;var i=r(769),n=r(11),a=function(){function t(t){this.viewing=!1,this.parent=t}return t.prototype.makeMove=function(){var t=this;if(this.game.alive&&this.parent.hasViewingPlayers){var e=(0,n.chooseNextMove)(this.game);this.game.update(e),this.parent.notifyMove(this.id,e),setTimeout((function(){return t.makeMove()}),500+500*Math.random())}else this.lastAttacker&&this.lastAttacker.scoreKill()},t.prototype.startGame=function(t,e){var r=this;this.game=new i.Game(e),this.id=t,setTimeout((function(){return r.makeMove()}),500+500*Math.random())},t.prototype.notifyGarbage=function(t,e){t===this.id&&(this.game.garbageIn.push(e),this.parent.ackGarbage(this.id,e))},t.prototype.isAlive=function(){return this.game.alive},t.prototype.getGarbageOut=function(){return this.game.garbageOut},t.prototype.decrementGarbageOut=function(){this.game.garbageOut--},t.prototype.isViewing=function(){return this.viewing},t.prototype.updatePlayerCount=function(t){},t.prototype.updateOpponent=function(t,e){},t.prototype.scoreKill=function(){},t}();e.BotPlayer=a},350:(t,e)=>{function r(){for(var t=new Array,e=0;e<16;++e)t.push(Math.floor(256*Math.random()));return t}e.__esModule=!0,e.RC4=e.seedFromSystemRandom=void 0,e.seedFromSystemRandom=r;var i=function(){function t(t){this.s=new Array(256),this.i=0,this.j=0;for(var e=0;e<256;e++)this.s[e]=e;t||(t=r()),this.mix(t)}return t.prototype._swap=function(t,e){var r=this.s[t];this.s[t]=this.s[e],this.s[e]=r},t.prototype.mix=function(t){for(var e=0,r=0;r<this.s.length;r++)e+=this.s[r]+t[r%t.length],e%=256,this._swap(r,e)},t.prototype.nextByte=function(){return this.i=(this.i+1)%256,this.j=(this.j+this.s[this.i])%256,this._swap(this.i,this.j),this.s[(this.s[this.i]+this.s[this.j])%256]},t.prototype.uniform=function(){for(var t=0,e=0;e<7;e++)t*=256,t+=this.nextByte();return t/(Math.pow(2,56)-1)},t.prototype.inRange=function(t,e){return t+Math.floor(this.uniform()*(e-t))},t}();e.RC4=i}},e={};function r(i){var n=e[i];if(void 0!==n)return n.exports;var a=e[i]={exports:{}};return t[i].call(a.exports,a,a.exports,r),a.exports}r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var t=r(350),e=r(251),i=null,n=function(){function t(t,e){var r=this;this.viewing=!0,this.parent=e,this.socket=t,this.alive=!0,this.garbageOut=0,t.on("move",(function(t){e.notifyMove(r.id,t)})),t.on("sendGarbage",(function(){r.garbageOut++})),t.on("ackGarbage",(function(t){e.ackGarbage(r.id,t)})),t.on("death",(function(){r.alive=!1,r.lastAttacker&&r.lastAttacker.scoreKill()})),t.on("disconnect",(function(){console.log("Disconnected: "+t.id),r.viewing=!1,r.alive=!1,e.removePlayer(r)}))}return t.prototype.isAlive=function(){return this.alive},t.prototype.isViewing=function(){return this.viewing},t.prototype.getGarbageOut=function(){return this.garbageOut},t.prototype.decrementGarbageOut=function(){this.garbageOut--},t.prototype.scoreKill=function(){this.socket.emit("scoreKill")},t.prototype.notifyGarbage=function(t,e){this.socket.emit("notifyGarbage",t,e)},t.prototype.updatePlayerCount=function(t){this.socket.emit("updatePlayerCount",t)},t.prototype.startGame=function(t,e){this.socket.emit("startGame",t,e),this.id=t},t.prototype.updateOpponent=function(t,e){this.socket.emit("updateOpponent",t,e)},t}();r.g.module.exports={io:function(t){(null===i||i.isFull())&&(i=new a);var e=new n(t,i);i.addPlayer(e),console.log("Connected: "+t.id)}};var a=function(){function r(){var t=this;this.players=new Array,this.initTime=Date.now(),this.started=!1,setTimeout((function(){return t.checkPlayerCount()}),1e3)}return r.prototype.checkPlayerCount=function(){var t=this;if(9===this.players.length)this.start();else{var r=Math.max(this.players.length,Math.floor((Date.now()-this.initTime)/1e3));if(9===r){for(;this.players.length<9;)this.addPlayer(new e.BotPlayer(this));this.start()}else{for(var i=0,n=this.players;i<n.length;i++)n[i].updatePlayerCount(r);setTimeout((function(){return t.checkPlayerCount()}),1e3)}}},r.prototype.removePlayer=function(t){this.started||this.players.splice(this.players.indexOf(t),1)},r.prototype.start=function(){for(var e=(0,t.seedFromSystemRandom)(),r=0;r<this.players.length;++r)this.players[r].startGame(r,e);this.started=!0},r.prototype.isFull=function(){return 9===this.players.length},r.prototype.addPlayer=function(t){this.players.push(t)},r.prototype.notifyMove=function(t,e){for(var r=0;r<this.players.length;++r)r!==t&&(this.players[r].updateOpponent(t,e),this.distributeGarbage(t))},r.prototype.hasViewingPlayers=function(){return this.players.some((function(t){return t.isViewing}))},r.prototype.distributeGarbage=function(t){for(;this.players[t].getGarbageOut()>0;){this.players[t].decrementGarbageOut();for(var e=t;e===t||!this.players[e].isAlive;)e=Math.floor(Math.random()*this.players.length);this.players[e].notifyGarbage(e,8),this.players[e].notifyGarbage(e,1),this.players[e].lastAttacker=this.players[t]}},r.prototype.ackGarbage=function(t,e){for(var r=0;r<this.players.length;++r)r!==t&&this.players[r].notifyGarbage(t,e)},r}()})()})();