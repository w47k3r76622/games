let t={};function s(){const{canvas:s}=t,e=s.getContext("2d"),i=s.width,h=s.height;e.fillStyle="#942193",e.fillRect(0,0,i,h)}const{cos:e,sin:i,abs:h,sqrt:o,acos:n,min:r,max:l,trunc:a}=Math,{PI:c}=Math,d=2*c;function u(t,s,e){return Math.min(Math.max(t,s),e)}function p(t){return t*(Math.PI/180)}const g=p(30);function f(t){return 60*t}const m=1/f(1);class y{constructor(){}setup(){this.cells=new Array;const s=t.pSys.count();for(let e=0;e<s;++e){const s=10===t.pSys.getRadius(e),i=1;this.cells.push({idx:e,isTerm:s,t:i})}}update(){this.life(),this.drawCircles()}getCellular(t){return this.cells[t]}life(){const{pSys:s,flow:e}=t,i=s.count();for(let t=0;t<i;t++){const i=s.getPos(t),h=s.getRadius(t),o=e.getParts(i);if(o.length){for(let t of o)t.pos_sta.sub(i).mag()<h&&e.newPart(t);this.cells[t].t>=1&&(this.cells[t].t=0)}}}drawCircles(){const{pSys:s}=t,{ctx:i}=t;i.strokeStyle="white";const o=s.count();for(let t=0;t<o;t++){const o=s.getPos(t);if(!o)continue;const n=s.getRadius(t),l=.7+.3*h(e(this.cells[t].t*c));this.cells[t].t=r(this.cells[t].t+m,1),i.beginPath(),i.arc(o.x,o.y,l*n,0,2*Math.PI),i.strokeStyle="white",i.fillStyle="#942193",i.stroke()}}}function v(t,s,e,i,h){return t===s?t:e+(i-e)*(h-t)/(s-t)}function w(t,s,e){return t+(s-t)*e}class x{static VEC2(t,s){return new x(t,s)}constructor(t,s){this.x=t,this.y=s}add(t){return new x(this.x+t.x,this.y+t.y)}addInPlace(t){this.x+=t.x,this.y+=t.y}subInPlace(t){this.x-=t.x,this.y-=t.y}negate(){return new x(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}sub(t){return new x(this.x-t.x,this.y-t.y)}scale(t){return new x(this.x*t,this.y*t)}scaleInPlace(t){return this.x*=t,this.y*=t,this}dot(t){return this.x*t.x+this.y*t.y}mag(){const t=this;return Math.sqrt(t.x*t.x+t.y*t.y)}assign(t,s){this.x=t,this.y=s}zero(){return this.x=0,this.y=0,this}copyFrom(t){return this.x=t.x,this.y=t.y,this}lerp(t,s){return new x(w(this.x,t.x,s),w(this.y,t.y,s))}normalize(){return this.scale(1/this.mag())}angle(t){const s=u(this.dot(t)/(this.mag()*t.mag()),-1,1);return n(s)}clone(){return new x(this.x,this.y)}toString(){return`[${this.x},${this.y}]`}isNaN(){return isNaN(this.x)||isNaN(this.y)}isInfinity(){return!isFinite(this.x)||!isFinite(this.y)}}function _(t,s){return t.sub(s)}const T=()=>new x(0,0),S=x.VEC2;class M{constructor(){this.indexes=[]}add(t){this.indexes.push(t)}size(){return this.indexes.length}clear(){this.indexes.length=0}}class P{constructor(t,s,e){this.n=t,this.cell_size=s,this.isNear=e,this.buckets=new Array;for(let s=0;s<t;++s)this.buckets.push(new M)}add(t,s,e){const i=this.adjacentCells(s,e);for(const s of i)this.buckets[s].add(t)}getBucket(t){const s=this.posToIndex(t);return this.buckets[s].indexes}clear(){this.buckets.forEach((t=>{t.clear()}))}posToIndex(t){const s=Math.trunc(t.x/this.cell_size),e=Math.trunc(t.y/this.cell_size);return h(73856093*s^19349663*e)%this.n}adjacentCells(t,s){const e=new Set;return e.add(this.posToIndex(t)),this.isNear&&(e.add(this.posToIndex(t.add(S(+s,+s)))),e.add(this.posToIndex(t.add(S(-s,-s))))),e}}const z=Math.random,b=function(t){return function(t,s){return t=Math.ceil(t),s=Math.floor(s),Math.floor(Math.random()*(s-t)+t)}(0,t)};function F(t,s){return t===s?t:Math.random()*(s-t)+t}const X=.5*(Math.sqrt(3)-1),E=(3-Math.sqrt(3))/6,C=(Math.sqrt(5)-1)/4,Y=(5-Math.sqrt(5))/20,I=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),L=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);var k=class{constructor(t=Math.random){const s="function"==typeof t?t:function(t){let s=0,e=0,i=0,h=1;const o=function(){let t=4022871197;return function(s){s=s.toString();for(let e=0;e<s.length;e++){t+=s.charCodeAt(e);let i=.02519603282416938*t;t=i>>>0,i-=t,i*=t,t=i>>>0,i-=t,t+=4294967296*i}return 2.3283064365386963e-10*(t>>>0)}}();s=o(" "),e=o(" "),i=o(" "),s-=o(t),s<0&&(s+=1);e-=o(t),e<0&&(e+=1);i-=o(t),i<0&&(i+=1);return function(){const t=2091639*s+2.3283064365386963e-10*h;return s=e,e=i,i=t-(h=0|t)}}(t);this.p=function(t){const s=new Uint8Array(256);for(let t=0;t<256;t++)s[t]=t;for(let e=0;e<255;e++){const i=e+~~(t()*(256-e)),h=s[e];s[e]=s[i],s[i]=h}return s}(s),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let t=0;t<512;t++)this.perm[t]=this.p[255&t],this.permMod12[t]=this.perm[t]%12}noise2D(t,s){const e=this.permMod12,i=this.perm;let h=0,o=0,n=0;const r=(t+s)*X,l=Math.floor(t+r),a=Math.floor(s+r),c=(l+a)*E,d=t-(l-c),u=s-(a-c);let p,g;d>u?(p=1,g=0):(p=0,g=1);const f=d-p+E,m=u-g+E,y=d-1+2*E,v=u-1+2*E,w=255&l,x=255&a;let _=.5-d*d-u*u;if(_>=0){const t=3*e[w+i[x]];_*=_,h=_*_*(I[t]*d+I[t+1]*u)}let T=.5-f*f-m*m;if(T>=0){const t=3*e[w+p+i[x+g]];T*=T,o=T*T*(I[t]*f+I[t+1]*m)}let S=.5-y*y-v*v;if(S>=0){const t=3*e[w+1+i[x+1]];S*=S,n=S*S*(I[t]*y+I[t+1]*v)}return 70*(h+o+n)}noise3D(t,s,e){const i=this.permMod12,h=this.perm;let o,n,r,l;const a=.3333333333333333*(t+s+e),c=Math.floor(t+a),d=Math.floor(s+a),u=Math.floor(e+a),p=.16666666666666666*(c+d+u),g=t-(c-p),f=s-(d-p),m=e-(u-p);let y,v,w,x,_,T;g>=f?f>=m?(y=1,v=0,w=0,x=1,_=1,T=0):g>=m?(y=1,v=0,w=0,x=1,_=0,T=1):(y=0,v=0,w=1,x=1,_=0,T=1):f<m?(y=0,v=0,w=1,x=0,_=1,T=1):g<m?(y=0,v=1,w=0,x=0,_=1,T=1):(y=0,v=1,w=0,x=1,_=1,T=0);const S=g-y+.16666666666666666,M=f-v+.16666666666666666,P=m-w+.16666666666666666,z=g-x+.3333333333333333,b=f-_+.3333333333333333,F=m-T+.3333333333333333,X=g-1+.5,E=f-1+.5,C=m-1+.5,Y=255&c,L=255&d,k=255&u;let N=.6-g*g-f*f-m*m;if(N<0)o=0;else{const t=3*i[Y+h[L+h[k]]];N*=N,o=N*N*(I[t]*g+I[t+1]*f+I[t+2]*m)}let V=.6-S*S-M*M-P*P;if(V<0)n=0;else{const t=3*i[Y+y+h[L+v+h[k+w]]];V*=V,n=V*V*(I[t]*S+I[t+1]*M+I[t+2]*P)}let A=.6-z*z-b*b-F*F;if(A<0)r=0;else{const t=3*i[Y+x+h[L+_+h[k+T]]];A*=A,r=A*A*(I[t]*z+I[t+1]*b+I[t+2]*F)}let W=.6-X*X-E*E-C*C;if(W<0)l=0;else{const t=3*i[Y+1+h[L+1+h[k+1]]];W*=W,l=W*W*(I[t]*X+I[t+1]*E+I[t+2]*C)}return 32*(o+n+r+l)}noise4D(t,s,e,i){const h=this.perm;let o,n,r,l,a;const c=(t+s+e+i)*C,d=Math.floor(t+c),u=Math.floor(s+c),p=Math.floor(e+c),g=Math.floor(i+c),f=(d+u+p+g)*Y,m=t-(d-f),y=s-(u-f),v=e-(p-f),w=i-(g-f);let x=0,_=0,T=0,S=0;m>y?x++:_++,m>v?x++:T++,m>w?x++:S++,y>v?_++:T++,y>w?_++:S++,v>w?T++:S++;const M=x>=3?1:0,P=_>=3?1:0,z=T>=3?1:0,b=S>=3?1:0,F=x>=2?1:0,X=_>=2?1:0,E=T>=2?1:0,I=S>=2?1:0,k=x>=1?1:0,N=_>=1?1:0,V=T>=1?1:0,A=S>=1?1:0,W=m-M+Y,H=y-P+Y,D=v-z+Y,R=w-b+Y,q=m-F+2*Y,G=y-X+2*Y,$=v-E+2*Y,B=w-I+2*Y,O=m-k+3*Y,U=y-N+3*Y,j=v-V+3*Y,K=w-A+3*Y,J=m-1+4*Y,Q=y-1+4*Y,Z=v-1+4*Y,tt=w-1+4*Y,st=255&d,et=255&u,it=255&p,ht=255&g;let ot=.6-m*m-y*y-v*v-w*w;if(ot<0)o=0;else{const t=h[st+h[et+h[it+h[ht]]]]%32*4;ot*=ot,o=ot*ot*(L[t]*m+L[t+1]*y+L[t+2]*v+L[t+3]*w)}let nt=.6-W*W-H*H-D*D-R*R;if(nt<0)n=0;else{const t=h[st+M+h[et+P+h[it+z+h[ht+b]]]]%32*4;nt*=nt,n=nt*nt*(L[t]*W+L[t+1]*H+L[t+2]*D+L[t+3]*R)}let rt=.6-q*q-G*G-$*$-B*B;if(rt<0)r=0;else{const t=h[st+F+h[et+X+h[it+E+h[ht+I]]]]%32*4;rt*=rt,r=rt*rt*(L[t]*q+L[t+1]*G+L[t+2]*$+L[t+3]*B)}let lt=.6-O*O-U*U-j*j-K*K;if(lt<0)l=0;else{const t=h[st+k+h[et+N+h[it+V+h[ht+A]]]]%32*4;lt*=lt,l=lt*lt*(L[t]*O+L[t+1]*U+L[t+2]*j+L[t+3]*K)}let at=.6-J*J-Q*Q-Z*Z-tt*tt;if(at<0)a=0;else{const t=h[st+1+h[et+1+h[it+1+h[ht+1]]]]%32*4;at*=at,a=at*at*(L[t]*J+L[t+1]*Q+L[t+2]*Z+L[t+3]*tt)}return 27*(o+n+r+l+a)}};class N{simplex=new k;computeCurl2(t){const s=1e-4,e=t.scale(.01),i=.5*this.simplex.noise2D(e.x-s,e.y)+.5,h=(.5*this.simplex.noise2D(e.x+s,e.y)+.5-i)/(2*s),o=.5*this.simplex.noise2D(e.x,e.y-s)+.5,n=.5*this.simplex.noise2D(e.x,e.y+s)+.5;return S((n-o)/(2*s),-h)}}const V=f(10);class A{noise=new N;constructor(){this.grid=new P(1400,100,!1)}setup(){this.parts=[];for(let t=0;t<500;++t){const s={idx:t};this.newPart(s),this.parts.push(s)}}teardown(){this.grid.clear(),this.parts.length=0}update(){this.grid.clear(),this.renderParts()}getParts(t){return this.grid.getBucket(t).map((t=>this.parts[t]))}reycleParts(t){t.forEach((t=>this.newPart(t)))}renderParts(){const{ctx:s}=t;this.parts.forEach((t=>{this.advPart(t)||this.newPart(t);const e=i(t.ttl_now/t.ttl_sta*c);s.strokeStyle=`rgba( 255,255,255, ${e} )`,s.beginPath(),s.moveTo(t.pos_sta.x,t.pos_sta.y),s.lineTo(t.pos_end.x,t.pos_end.y),s.stroke()}))}newPart(s){const e=t.gate.getSource(),i=this.noise.computeCurl2(e),h=i.scale(24),o=i.scale(4),n=e.add(o),r=.5*V+z()*V;Object.assign(s,{pos_sta:e,vel_sta:h,pos_end:n,ttl_sta:r,ttl_now:r})}advPart(s){if(--s.ttl_now<=0)return!1;const e=t.gate.getAdv(s.pos_sta).scale(48),i=s.vel_sta.scale(.016666666666666666),h=s.pos_sta.add(i),o=this.noise.computeCurl2(h),n=e.add(o.scale(24)),r=o.scale(4),l=h.add(r);return s.pos_sta=h,s.vel_sta=n,s.pos_end=l,this.grid.add(s.idx,s.pos_sta,1),!0}}const W=1/f(2),H=Math.trunc(16),D=Math.trunc(12);let R;var q;(q=R||(R={}))[q.Source=0]="Source",q[q.Attractor=1]="Attractor";class G{constructor(){this.grid=new P(192,2500,!1)}setup(){this.grid.clear(),this.gates=[],this.isMoving=!1;{const t=S(800*z()*.8+80,600*z()*.8+60),s=S(F(-1,1),F(-1,1)).normalize(),e=[R.Source,R.Attractor],i=e.length,h=50,o=.1;e.forEach(((e,n)=>{this.gates.push({pos:t,adv:s,type:e,prog:n,t:1,radius:h*(1-n*o),active:e===R.Source,disabled:!1,delta:n*d/(i-1)})})),this.selected=this.gates[i-1]}}update(){this.renderGates()}selectAt(t){for(let s of this.gates.slice(0).reverse()){if(s.pos.sub(t).mag()<s.radius)return this.selected=s,!0}return this.selected=null,!1}moveTo(t){return!!this.selected&&(this.selected.pos=t,this.compGrid(),this.isMoving=!0,!0)}drawLine(){const{ctx:s}=t,{pos:e}=this.gates[R.Attractor],{pos:i}=this.gates[R.Source];s.beginPath(),s.moveTo(e.x,e.y),s.lineTo(i.x,i.y),s.strokeStyle="white",s.stroke()}movedTo(t){return this.isMoving=!1,!0}getSource(){const t=this.gates.filter((t=>t.type===R.Source)),s=t[b(t.length)],{pos:h}=s,o=this.gates[0].radius*z(),n=z()*d;return S(h.x+o*e(n),h.y+o*i(n))}getAdv(t){return this.grid.getBucket(t)[0]??T()}compGrid(){this.grid.clear();const t=T();for(let s=0;s<D;++s)for(let e=0;e<H;++e){t.x=50*(s+.5),t.y=50*(e+.5);const i=this.compAdv(t),h=this.grid.getBucket(t);h.length||h.push(T()),h[0].addInPlace(i)}}compAdv(t){const s=T();for(const e of this.gates){const i=e.pos.sub(t);e.type===R.Source&&i.negateInPlace();const h=i.mag(),n=i.normalize(),r=.1/o(h),l=n.scale(r);s.addInPlace(l)}return s}renderGates(){const{ctx:s}=t;this.gates.forEach((t=>{let e=t.radius;t.active&&(e=.9*t.radius+.1*t.radius*i(t.t*d),t.t+=W,t.t>1&&(t.t=0)),s.beginPath(),s.arc(t.pos.x,t.pos.y,e,0,2*Math.PI,!1),s.strokeStyle="white",s.stroke()})),this.isMoving&&this.drawLine()}}function $(t,s,e){return{apply:(i,h,o)=>{const n=i[t],r=i[s],l=n.sub(r),a=l.mag(),c=(a-e)/a,d=n.sub(l.scale(.5*c)),u=r.add(l.scale(.5*c)),p=d.sub(n).scale(3600),g=u.sub(r).scale(3600),f=o[t],m=o[s];f.addInPlace(p),m.addInPlace(g)},has:e=>e===t||e===s}}class B{constructor(){}setUp(){this.p0=[],this.p1=[],this.p2=[],this.a=[],this.v=[],this.r=[],this.d=[],this.cp=[],this.ct=[],this.fp=[],this.ft=[],this.grid=new P(1e3,100,!0)}tearDown(){this.p0.length=0,this.p1.length=0,this.p2.length=0,this.a.length=0,this.v.length=0,this.r.length=0,this.d.length=0,this.cp.length=0,this.ct.length=0,this.fp.length=0,this.ft.length=0,this.grid.clear()}update(){this.v.forEach((t=>{t&&t.zero()}));for(let t=0;t<4;++t)this.updateGrid(),this.gridCollision(),this.a.forEach((t=>t.zero())),this.accumulateForces(this.fp),this.accumulateForces(this.ft),this.verletInt(),this.satisfyConstraints(this.ct),this.satisfyConstraints(this.cp),this.ft.length=0,this.ct.length=0}updateGrid(){this.grid.clear();for(let t=0;t<this.p1.length;++t)this.grid.add(t,this.p1[t],this.r[t])}n2Collision(){const t=this.count();for(let s=0,e=t-1;s<e;++s)for(let e=s+1;e<t;++e){const t=this.p1[s],i=this.p1[e],h=t.sub(i).mag(),o=this.r[s]+this.r[e];h<o&&this.addTmpForce($(s,e,o))}}gridCollision(){for(let t=0,s=this.count();t<s;t++){const s=this.grid.getBucket(this.p1[t]);if(1!=s.length)for(const e of s){if(e==t)continue;const s=this.p1[t],i=this.p1[e],h=s.sub(i).mag(),o=this.r[t]+this.r[e];h>=o||this.addTmpForce($(t,e,o))}}}verletInt(){const t=this.p0.length;for(let s=0;s<t;s++){const t=this.p2[s],e=this.p1[s],i=this.p0[s],h=this.a[s],o=this.v[s],n=this.d[s];if(null===t)continue;o.copyFrom(h.scale(.0002777777777777778)),o.addInPlace(e.sub(i).scaleInPlace(n));const r=e.add(o);t.copyFrom(r)}[this.p0,this.p1,this.p2]=[this.p1,this.p2,this.p0]}accumulateForces(t){t.forEach((t=>t.apply(this.p1,this.p0,this.a)))}satisfyConstraints(t){for(let s=0;s<4;s++)t.forEach((t=>t.apply(this.p1)))}addParticle(t,s=10,e=.9999){const i=this.p0.length;return this.p0.push(t.clone()),this.p1.push(t.clone()),this.p2.push(t.clone()),this.v.push(T()),this.a.push(T()),this.r.push(s),this.d.push(e),i}removeConstraints(t){this.fp=this.fp.filter((s=>!s.has(t))),this.cp=this.cp.filter((s=>!s.has(t)))}removeParticle(t){this.fp=this.fp.filter((s=>!s.has(t))),this.cp=this.cp.filter((s=>!s.has(t))),t===this.p1.length-1?this.removeTailParticles(t):this.deleteParticle(t)}removeTailParticles(t,s=1){this.p0.splice(t,s),this.p1.splice(t,s),this.p2.splice(t,s),this.a.splice(t,s),this.v.splice(t,s),this.v.splice(t,s),this.r.splice(t,s)}deleteParticle(t){this.p0[t]=null,this.p1[t]=null,this.p2[t]=null,this.a[t]=null,this.v[t]=null,this.r[t]=null}addConstraint(t){this.cp.push(t)}removeConstraint(t){this.cp.splice(this.cp.findIndex((s=>s===t)),1)}addTmpConstraint(t){this.ct.push(t)}addForce(t){this.fp.push(t)}removeForce(t){this.fp.splice(this.fp.findIndex((s=>s===t)),1)}addTmpForce(t){this.ft.push(t)}getPos(t){return this.p1[t]}count(){return this.p1.length}getRadius(t){return this.r[t]}getParticleAt(t){const s=this.count();for(let e=0;e<s;++e){const s=this.p1[e];if(!s)continue;if(s.sub(t).mag()<this.r[e])return e}return null}}const O={0:[],1:["W","S"],2:["E","S"],3:["W","E"],4:["N","E"],5:["N","W","S","E"],6:["N","S"],7:["N","W"],8:["N","W"],9:["N","S"],10:["N","E","S","W"],11:["N","E"],12:["E","W"],13:["E","S"],14:["S","W"],15:[]};function U(t){const s=new Array;for(let n=0;n<t.length-1;n++){s.push([]);for(let r=0;r<t[n].length-1;r++){var e=+t[n][r],i=+t[n][r+1],h=+t[n+1][r],o=+t[n+1][r+1];s[n].push((h<<0)+(o<<1)+(i<<2)+(e<<3))}}return s}function j(t){t.minX;const s=t.maxX,e=t.stepX,i=(t.minY,t.maxY),h=t.stepY,o=t.fn,n=Math.ceil(i/h),r=Math.ceil(s/e),l=new Array;for(let t=0;t<=n;t++){const s=t*h;l.push([]);for(let i=0;i<=r;i++){const h=i*e;l[t].push(o(h,s))}}return l}function K(t,s){const e=new Array;for(var i=0;i<t.length;i++){e.push([]);for(var h=0;h<t[i].length;h++)e[i].push(t[i][h]>s)}return e}class J{constructor(t){this._cellSize=t.cellSize,this._threshold=t.threshold||1}get _canvas(){return t.canvas}get _ctx(){return t.ctx}recalculate(t){this._samples=j({minX:0,maxX:this._canvas.width,stepX:this._cellSize,minY:0,maxY:this._canvas.height,stepY:this._cellSize,fn:t}),this._thresholdedSamples=K(this._samples,this._threshold),this._cellTypes=U(this._thresholdedSamples)}drawBg(){const t=this._ctx,s=this._canvas.width,e=this._canvas.height;{const i=t.createLinearGradient(0,e,s,0);i.addColorStop(0,"#9437ff"),i.addColorStop(.75,"#942193"),i.addColorStop(1,"#ffffff"),t.fillStyle="#942193",t.fillRect(0,0,s,e)}}drawCornerSamples(){this._ctx.fillStyle="#888",this._ctx.font="10px monospace";for(var t=0;t<this._samples.length;t++)for(var s=0;s<this._samples[t].length;s++){var e=this._samples[t][s],i=s*this._cellSize,h=t*this._cellSize;this._ctx.fillRect(i-2,h-2,4,4),this._ctx.fillText((""+e).substr(0,4),i+5,h+7)}}drawThresholdedCells(){this._ctx.fillStyle="green";for(var t=0;t<this._thresholdedSamples.length;t++)for(var s=0;s<this._thresholdedSamples[t].length;s++){var e=this._thresholdedSamples[t][s],i=s*this._cellSize,h=t*this._cellSize;e&&this._ctx.fillRect(Math.floor(i-this._cellSize/2),Math.floor(h-this._cellSize/2),this._cellSize,this._cellSize)}}drawThresholdedCorners(){this._ctx.fillStyle="#888";for(var t=0;t<this._thresholdedSamples.length;t++)for(var s=0;s<this._thresholdedSamples[t].length;s++){var e=this._thresholdedSamples[t][s],i=s*this._cellSize,h=t*this._cellSize;this._ctx.fillStyle=e?"#0f0":"#888",this._ctx.fillRect(i-2,h-2,4,4)}}drawCellClassification(){this._ctx.fillStyle="#888",this._ctx.font="10px monospace";for(var t=0;t<this._cellTypes.length;t++)for(var s=0;s<this._cellTypes[t].length;s++){var e=this._cellTypes[t][s],i=s*this._cellSize+(this._cellSize-10)/2,h=t*this._cellSize+(this._cellSize+10)/2;this._ctx.fillText(""+e,i,h)}}drawGridLines(t=0,s=0){this._ctx.strokeStyle="#888";for(var e=t||0;e<this._canvas.width;e+=this._cellSize)this._ctx.beginPath(),this._ctx.moveTo(e,0),this._ctx.lineTo(e,this._canvas.height),this._ctx.stroke();for(var i=s||0;i<this._canvas.height;i+=this._cellSize)this._ctx.beginPath(),this._ctx.moveTo(0,i),this._ctx.lineTo(this._canvas.width,i),this._ctx.stroke()}drawScaledLine(t,s){var e=t[1]*this._cellSize,i=t[0]*this._cellSize,h=s[1]*this._cellSize,o=s[0]*this._cellSize;this._ctx.beginPath(),this._ctx.moveTo(e,i),this._ctx.lineTo(h,o),this._ctx.stroke()}draw45DegContours(){this._ctx.strokeStyle="green";for(var t=0;t<this._cellTypes.length;t++)for(var s=0;s<this._cellTypes[t].length;s++){var e=this._cellTypes[t][s],i=O[e],h={N:[t,s+.5],W:[t+.5,s],E:[t+.5,s+1],S:[t+1,s+.5]};2===i.length?this.drawScaledLine(h[i[0]],h[i[1]]):4===i.length&&(this.drawScaledLine(h[i[0]],h[i[1]]),this.drawScaledLine(h[i[2]],h[i[3]]))}}drawSmoothContours(){this._ctx.strokeStyle="white";for(var t=0;t<this._cellTypes.length;t++)for(var s=0;s<this._cellTypes[t].length;s++){var e=this._cellTypes[t][s],i=O[e],h=this._samples[t][s],o=this._samples[t][s+1],n=this._samples[t+1][s],r=this._samples[t+1][s+1],l=(4&e)==(8&e)?.5:v(h,o,0,1,this._threshold),a=(2&e)==(4&e)?.5:v(o,r,0,1,this._threshold),c=(1&e)==(2&e)?.5:v(n,r,0,1,this._threshold),d={N:[t,s+l],W:[t+((1&e)==(8&e)?.5:v(h,n,0,1,this._threshold)),s],E:[t+a,s+1],S:[t+1,s+c]};2===i.length?this.drawScaledLine(d[i[0]],d[i[1]]):4===i.length&&(this.drawScaledLine(d[i[0]],d[i[1]]),this.drawScaledLine(d[i[2]],d[i[3]]))}}}function Q(s,e){const{pSys:i}=t;let h=0;const o=i.count();for(let t=0;t<o;t++){const o=i.getPos(t);if(!o)continue;const n=i.getRadius(t),r=n*n,l=s-o.x,a=e-o.y;h+=r/(l*l+a*a)}return h}let Z;var tt;(tt=Z||(Z={})).Forward="F",tt.Push="[",tt.Pop="]",tt.Right="+",tt.Left="-",tt[tt.Length=5]="Length";class st{constructor(t){this.rules=t}applyProd(t,s=1){let e="",i=t;for(let t=0;t<s;++t){e=i,i="";for(const t of e)this.rules.has(t)?i+=this.rules.get(t):i+=t}return i}applyTurtle(t,s,e){const i=new Array;for(const h of s)switch(h){case Z.Forward:t.forward(e);break;case Z.Push:i.push(t),t=t.fork();break;case Z.Pop:{const s=i[i.length-1];i.pop(),t=s;break}case Z.Right:t.right();break;case Z.Left:t.left()}}}class et{static VEC3(t,s,e){return new et(t,s,e)}static fromVec2(t){return new et(t.x,t.y,0)}constructor(t,s,e){this.x=t,this.y=s,this.z=e}add(t){const s=this;return new et(s.x+t.x,s.y+t.y,s.z+t.z)}addInPlace(t){this.x+=t.x,this.y+=t.y,this.z+=t.z}subInPlace(t){this.x-=t.x,this.y-=t.y,this.z-=t.z}negate(){const t=this;return new et(-t.x,-t.y,-t.z)}sub(t){const s=this;return new et(s.x-t.x,s.y-t.y,s.z-t.z)}scale(t){const s=this;return new et(s.x*t,s.y*t,s.z*t)}scaleInPlace(t){const s=this;return s.x*=t,s.y*=t,s.z*=t,this}dot(t){const s=this;return s.x*t.x+s.y*t.y+s.z*t.z}cross(t){const s=this,e=s.y*t.z-s.z*t.y,i=s.z*t.x-s.x*t.z,h=s.x*t.y-s.y*t.x;return new et(e,i,h)}mag(){const t=this;return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)}assign(t,s,e){this.x=t,this.y=s,this.z=e}zero(){return this.x=0,this.y=0,this.z=0,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}lerp(t,s){const e=this;return new et(w(e.x,t.x,s),w(e.y,t.y,s),w(e.z,t.z,s))}normalize(){return this.scale(1/this.mag())}angle(t){return n(this.dot(t)/(this.mag()*t.mag()))}clone(){return new et(this.x,this.y,this.z)}toVec2(){return new x(this.x,this.y)}toString(){return`[${this.x},${this.y},${this.z}]`}isNaN(){return isNaN(this.x)||isNaN(this.y)||isNaN(this.z)}isInfinity(){return!isFinite(this.x)||!isFinite(this.y)||!isFinite(this.z)}}function it(t,s,e,i=e){return{apply:h=>{const o=h[t],n=h[s],r=_(o,n),l=r.mag();const a=u(l,e,i),c=(l-a)/a;r.scaleInPlace(.5*c),o.subInPlace(r),n.addInPlace(r)},has:e=>e===t||e===s}}function ht(t,s,e=0,i=e){return{apply:h=>{const o=_(h[t],s),n=o.mag();if(n<Number.EPSILON)return;const r=o.normalize(),l=u(n,e,i),a=s.add(r.scaleInPlace(l));h[t]=a},has:s=>s===t}}function ot(t,s,h,o){return{apply:n=>{const r=n[t].sub(s),l=r.mag(),a=r.normalize(),c=et.fromVec2(h),d=et.fromVec2(a),p=u((c.cross(d).z>0?1:-1)*h.angle(a),-o,+o),g=S(h.x*e(p)-h.y*i(p),h.x*i(p)+h.y*e(p)),f=s.add(g.scale(l));n[t]=f},has:s=>s===t}}function nt(t,s,h,o){return{apply:n=>{const r=n[t].sub(n[s]),l=r.mag(),a=r.normalize(),c=et.fromVec2(h),d=et.fromVec2(a),p=u((c.cross(d).z>0?1:-1)*h.angle(a),-o,+o),g=S(h.x*e(p)-h.y*i(p),h.x*i(p)+h.y*e(p)),f=n[s].add(g.scale(l));n[t]=f},has:e=>e===t||e===s}}class rt{constructor(t,s,e,i,h,o,n=-1){this.main_radius=t,this.secondary_radius=s,this.pos=e,this.angle=i,this.step=h,this.alpha=o,this.last_part=n}forward(t){const s=new Array,h=this.pos.clone(),o=S(e(this.angle),i(this.angle)),n=this.pos.add(o.scale(this.step));{const e=this.main_radius,i=this.secondary_radius,h=this.step-2*e-2*i,n=this.pos.add(o.scale(e+i)),r=n.add(o.scale(h)),l=Math.floor(h/(2*i));for(let e=0;e<l;++e){const h=1===l?.5:e/(l-1),o=n.lerp(r,h),a=t.addParticle(o,i);s.push(a)}}this.pos=n;const r=t.addParticle(this.pos,this.main_radius);if(s.push(r),this.last_part>=0){const e=t.getPos(this.last_part).sub(t.getPos(s[0])).mag();t.addConstraint(it(this.last_part,s[0],e,1.1*e))}else t.addConstraint(ht(s[0],t.getPos(s[0]).clone(),0,10));for(let e=1;e<s.length;++e){const i=t.getPos(s[e]).sub(t.getPos(s[e-1])).mag();t.addConstraint(it(s[e],s[e-1],i,1.1*i))}{const e=this.last_part<0?ot(s[0],h,o,g):nt(s[0],this.last_part,o,g);t.addConstraint(e)}for(let e=1;e<s.length;++e){const i=nt(s[e],s[e-1],o,g);t.addConstraint(i)}return this.last_part=r,this.pos.toString(),s}right(){this.angle+=this.alpha}left(){this.angle-=this.alpha}fork(){return new rt(this.main_radius,this.secondary_radius,this.pos.clone(),this.angle,this.step,this.alpha,this.last_part)}}const lt=[()=>{const s=new st(new Map([["F","F[+F]F[-F]F"]]));{const e=s.applyProd("F",2),i=new rt(10,5,S(400,600),p(-90),60,p(40));s.applyTurtle(i,e,t.pSys)}},()=>{const s=new st(new Map([["F","F[+F]F[-F]F"]]));{const e=s.applyProd("F",2),i=new rt(10,5,S(400,600),p(-90),60,p(90));s.applyTurtle(i,e,t.pSys)}},()=>{const s=new st(new Map([["X","F[+X]F[-X]+X"],["F","FF"]]));{const e=s.applyProd("X",2),i=new rt(10,5,S(400,600),p(-90),60,p(70));s.applyTurtle(i,e,t.pSys)}{const e=s.applyProd("X",2),i=new rt(10,5,S(400,0),p(90),60,p(70));s.applyTurtle(i,e,t.pSys)}},()=>{const s=new st(new Map([["F","F[+F]F[-F]F"]])),h=s.applyProd("F",1);for(let o=0;o<6;++o){const n=d/6*o,r=0,l=new rt(10,5,S(400+r*e(n),300+r*i(n)),n,60,p(60));s.applyTurtle(l,h,t.pSys)}},()=>{const s=new st(new Map([["X","F[+X][-X]FX"],["F","FF"]]));for(let e=0;e<3;++e){const i=s.applyProd("X",2),h=new rt(10,5,S(400*e,600),p(-45)*(e+1),60,p(40));s.applyTurtle(h,i,t.pSys)}},()=>{const s=new st(new Map([["X","F[+X][-X]FX"],["F","FF"]]));{const e=s.applyProd("X",3),i=new rt(10,5,S(400,600),p(-90),60,p(35));s.applyTurtle(i,e,t.pSys)}}];class at{constructor(t,s){this.element=t,this.touchStartX=null,this.touchStartY=null,this.touchEndX=null,this.touchEndY=null,this.touchMoveX=null,this.touchMoveY=null,this.velocityX=null,this.velocityY=null,this.longPressTimer=null,this.doubleTapTimer=null,this.doubleTapWaiting=!1,this.thresholdX=0,this.thresholdY=0,this.disregardVelocityThresholdX=0,this.disregardVelocityThresholdY=0,this.swipingHorizontal=!1,this.swipingVertical=!1,this.swipingDirection=null,this.swipedHorizontal=!1,this.swipedVertical=!1,this.handlers={panstart:[],panmove:[],panend:[],swipeleft:[],swiperight:[],swipeup:[],swipedown:[],tap:[],doubletap:[],longpress:[]},this._onTouchStart=this.onTouchStart.bind(this),this._onTouchMove=this.onTouchMove.bind(this),this._onTouchEnd=this.onTouchEnd.bind(this),this.opts=Object.assign({},at.defaults,s),this.element.addEventListener("touchstart",this._onTouchStart,ct),this.element.addEventListener("touchmove",this._onTouchMove,ct),this.element.addEventListener("touchend",this._onTouchEnd,ct),this.opts.mouseSupport&&!("ontouchstart"in window)&&(this.element.addEventListener("mousedown",this._onTouchStart,ct),document.addEventListener("mousemove",this._onTouchMove,ct),document.addEventListener("mouseup",this._onTouchEnd,ct))}destroy(){var t,s;this.element.removeEventListener("touchstart",this._onTouchStart),this.element.removeEventListener("touchmove",this._onTouchMove),this.element.removeEventListener("touchend",this._onTouchEnd),this.element.removeEventListener("mousedown",this._onTouchStart),document.removeEventListener("mousemove",this._onTouchMove),document.removeEventListener("mouseup",this._onTouchEnd),clearTimeout(null!==(t=this.longPressTimer)&&void 0!==t?t:void 0),clearTimeout(null!==(s=this.doubleTapTimer)&&void 0!==s?s:void 0)}on(t,s){if(this.handlers[t])return this.handlers[t].push(s),{type:t,fn:s,cancel:()=>this.off(t,s)}}off(t,s){if(this.handlers[t]){const e=this.handlers[t].indexOf(s);-1!==e&&this.handlers[t].splice(e,1)}}fire(t,s){for(let e=0;e<this.handlers[t].length;e++)this.handlers[t][e](s)}onTouchStart(t){this.thresholdX=this.opts.threshold("x",this),this.thresholdY=this.opts.threshold("y",this),this.disregardVelocityThresholdX=this.opts.disregardVelocityThreshold("x",this),this.disregardVelocityThresholdY=this.opts.disregardVelocityThreshold("y",this),this.touchStartX="mousedown"===t.type?t.screenX:t.changedTouches[0].screenX,this.touchStartY="mousedown"===t.type?t.screenY:t.changedTouches[0].screenY,this.touchMoveX=null,this.touchMoveY=null,this.touchEndX=null,this.touchEndY=null,this.swipingDirection=null,this.longPressTimer=setTimeout((()=>this.fire("longpress",t)),this.opts.longPressTime),this.fire("panstart",t)}onTouchMove(t){var s,e,i,h,o;if("mousemove"===t.type&&(!this.touchStartX||null!==this.touchEndX))return;const n=("mousemove"===t.type?t.screenX:t.changedTouches[0].screenX)-(null!==(s=this.touchStartX)&&void 0!==s?s:0);this.velocityX=n-(null!==(e=this.touchMoveX)&&void 0!==e?e:0),this.touchMoveX=n;const r=("mousemove"===t.type?t.screenY:t.changedTouches[0].screenY)-(null!==(i=this.touchStartY)&&void 0!==i?i:0);this.velocityY=r-(null!==(h=this.touchMoveY)&&void 0!==h?h:0),this.touchMoveY=r;const l=Math.abs(this.touchMoveX),a=Math.abs(this.touchMoveY);this.swipingHorizontal=l>this.thresholdX,this.swipingVertical=a>this.thresholdY,this.swipingDirection=l>a?this.swipingHorizontal?"horizontal":"pre-horizontal":this.swipingVertical?"vertical":"pre-vertical",Math.max(l,a)>this.opts.pressThreshold&&clearTimeout(null!==(o=this.longPressTimer)&&void 0!==o?o:void 0),this.fire("panmove",t)}onTouchEnd(t){var s,e,i,h,o,n,r,l;if("mouseup"===t.type&&(!this.touchStartX||null!==this.touchEndX))return;this.touchEndX="mouseup"===t.type?t.screenX:t.changedTouches[0].screenX,this.touchEndY="mouseup"===t.type?t.screenY:t.changedTouches[0].screenY,this.fire("panend",t),clearTimeout(null!==(s=this.longPressTimer)&&void 0!==s?s:void 0);const a=this.touchEndX-(null!==(e=this.touchStartX)&&void 0!==e?e:0),c=Math.abs(a),d=this.touchEndY-(null!==(i=this.touchStartY)&&void 0!==i?i:0),u=Math.abs(d);c>this.thresholdX||u>this.thresholdY?(this.swipedHorizontal=this.opts.diagonalSwipes?Math.abs(a/d)<=this.opts.diagonalLimit:c>=u&&c>this.thresholdX,this.swipedVertical=this.opts.diagonalSwipes?Math.abs(d/a)<=this.opts.diagonalLimit:u>c&&u>this.thresholdY,this.swipedHorizontal&&(a<0?((null!==(h=this.velocityX)&&void 0!==h?h:0)<-this.opts.velocityThreshold||a<-this.disregardVelocityThresholdX)&&this.fire("swipeleft",t):((null!==(o=this.velocityX)&&void 0!==o?o:0)>this.opts.velocityThreshold||a>this.disregardVelocityThresholdX)&&this.fire("swiperight",t)),this.swipedVertical&&(d<0?((null!==(n=this.velocityY)&&void 0!==n?n:0)<-this.opts.velocityThreshold||d<-this.disregardVelocityThresholdY)&&this.fire("swipeup",t):((null!==(r=this.velocityY)&&void 0!==r?r:0)>this.opts.velocityThreshold||d>this.disregardVelocityThresholdY)&&this.fire("swipedown",t))):c<this.opts.pressThreshold&&u<this.opts.pressThreshold&&(this.doubleTapWaiting?(this.doubleTapWaiting=!1,clearTimeout(null!==(l=this.doubleTapTimer)&&void 0!==l?l:void 0),this.fire("doubletap",t)):(this.doubleTapWaiting=!0,this.doubleTapTimer=setTimeout((()=>this.doubleTapWaiting=!1),this.opts.doubleTapTime),this.fire("tap",t)))}}at.defaults={threshold:(t,s)=>Math.max(25,Math.floor(.15*("x"===t?window.innerWidth||document.body.clientWidth:window.innerHeight||document.body.clientHeight))),velocityThreshold:10,disregardVelocityThreshold:(t,s)=>Math.floor(.5*("x"===t?s.element.clientWidth:s.element.clientHeight)),pressThreshold:8,diagonalSwipes:!1,diagonalLimit:Math.tan(.375*Math.PI),longPressTime:500,doubleTapTime:300,mouseSupport:!0};let ct=!1;try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){ct={passive:!0}}}))}catch(t){}class dt{static eventToPos(s){const e=s.clientX-t.canvas.offsetLeft,i=s.clientY-t.canvas.offsetTop;return S(e,i)}constructor(){}setup(){const s={threshold:(t,s)=>Math.max(25,Math.floor(.15*("x"===t?window.innerWidth||document.body.clientWidth:window.innerHeight||document.body.clientHeight))),velocityThreshold:10,disregardVelocityThreshold:(t,s)=>Math.floor(.15*("x"===t?s.element.clientWidth:s.element.clientHeight)),pressThreshold:8,diagonalSwipes:!1,diagonalLimit:Math.tan(.375*Math.PI),mouseSupport:!0};this.gesture=new at(t.canvas,s),this.gesture.on("panstart",(s=>{t.gate.selectAt(dt.eventToPos(s))})),this.gesture.on("panmove",(s=>{t.gate.moveTo(dt.eventToPos(s))})),this.gesture.on("panend",(s=>{t.gate.movedTo(dt.eventToPos(s))}))}}(()=>{const e=document.createElement("canvas");e.width=800,e.height=600,document.body.appendChild(e);const i=document.createElement("div");document.body.appendChild(i),i.appendChild(document.createTextNode(`The High Cost Of Life v.1.0.0 - (c) ${(new Date).getFullYear()} - 2 THINK SNC`));const h=e.getContext("2d");if(!h)return;t.canvas=e,t.ctx=h,(t.pSys=new B).setUp(),(t.gate=new G).setup(),(t.flow=new A).setup(),t.cellular=new y,t.sim=new J({cellSize:5,threshold:1}),(t.slashUi=new dt).setup();(0,lt[b(lt.length)])(),t.cellular.setup(),setInterval((()=>{const s=t.pSys.count(),e=b(s),i=10*(1-t.cellular.getCellular(e).t)*60;t.pSys.addTmpForce(function(t,s){return{apply:(e,i,h)=>{h[t].addInPlace(s)},has:s=>s===t}}(e,S(10*(2*Math.random()-1)*60,i)))}),1e3),function(){const e=()=>{s(),t.pSys.update(),t.gate.update(),t.flow.update(),t.cellular.update(),t.sim.recalculate(((t,s)=>Q(t,s))),t.sim.drawSmoothContours(),requestAnimationFrame(e)};requestAnimationFrame(e)}()})();