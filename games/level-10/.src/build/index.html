<!DOCTYPE html>
<html lang="en-us">
<head>
<title>Level 10</title>
<style>#game,#wrpr{width:600px;position:relative}#g,#game{margin:0 auto}.glitch,th{text-align:left}*{margin:0;padding:0;overflow:hidden;font-family:"Lucida Console",Monaco,monospace;letter-spacing:2px;box-sizing:border-box}body{background:#171717}#wrpr{margin:20px auto 60px;border:1px solid #000;border-radius:4px;font-size:18px}#game{height:800px;z-index:1}#g{z-index:0;position:absolute;display:block;top:0}#gOScRN,#pauseScreen,#startScreen{position:absolute;width:100%;height:100%;z-index:2;background:#000;color:#fff}.title{font-size:78px;margin-bottom:36px}.ctrbndr{margin-left:32px;padding-left:42px;position:relative;cursor:pointer}.ctrbndr:hover{text-shadow:0 0 5px #fff,0 0 10px #fff,0 0 20px #fffc00}[data-control]:before{position:absolute;left:0;content:'\25be \25ac'}[data-control=leftUp]:before{transform:scaleY(-1)}[data-control=rightUp]:before{transform:scaleX(-1) scaleY(-1)}[data-control=rightDown]:before{transform:scaleX(-1)}#gOScRN,#pauseScreen{display:none}#gOScRN,#pauseScreen,#startScreen{padding:24px}#pauseScreen>div:first-child{font-size:56px}.btn,table{font-size:24px}#pauseScreen>div:last-child{font-size:24px}table{width:100%}th{color:#fff}table td{padding:4px}table tr.new{color:#fff9a6;text-shadow:0 0 5px #fff9a6,0 0 10px #fff9a6,0 0 15px #988E2D,0 0 20px #988E2D}.modesElement{list-style:none}.btn{cursor:pointer;display:inline-block;color:#fff;padding:12px 12px 12px 36px;position:relative}.btn:hover{text-shadow:0 0 5px #fff,0 0 10px #fff,0 0 20px #8000ff,0 0 30px #8000ff,0 0 40px #8000ff,0 0 55px #8000ff,0 0 75px #8000ff}.btn:before{content:'\25ba';padding-right:10px;font-size:16px;position:absolute;top:18px;left:8px;animation:bounce 2s infinite}@keyframes bounce{0%,100%,20%,50%,80%{transform:translateX(0)}40%{transform:translateX(8px)}60%{transform:translateX(4px)}}.modesElement>li{background:#fff;color:#000;margin:10px 20px;cursor:pointer}.glitch{color:#fff;position:relative;font-weight:700}.glitch:after,.glitch:before{content:attr(data-text);position:absolute;top:0;color:#fff;background:#000;overflow:hidden}@keyframes noise-anim{0%{clip:rect(39px,999px,74px,0)}5%{clip:rect(79px,999px,83px,0)}10%{clip:rect(13px,999px,3px,0)}15%{clip:rect(21px,999px,41px,0)}20%{clip:rect(59px,999px,75px,0)}25%{clip:rect(66px,999px,22px,0)}30%{clip:rect(99px,999px,26px,0)}35%{clip:rect(66px,999px,67px,0)}40%{clip:rect(48px,999px,46px,0)}45%{clip:rect(30px,999px,30px,0)}50%{clip:rect(66px,999px,7px,0)}55%{clip:rect(34px,999px,36px,0)}60%{clip:rect(52px,999px,85px,0)}65%{clip:rect(88px,999px,84px,0)}70%{clip:rect(66px,999px,60px,0)}75%{clip:rect(56px,999px,65px,0)}80%{clip:rect(17px,999px,82px,0)}85%{clip:rect(83px,999px,33px,0)}90%{clip:rect(99px,999px,78px,0)}95%{clip:rect(89px,999px,48px,0)}100%{clip:rect(65px,999px,81px,0)}}.glitch:after{left:2px;text-shadow:-1px 0 red;clip:rect(0,900px,0,0);animation:noise-anim 2s infinite linear alternate-reverse}@keyframes noise-anim-2{0%{clip:rect(23px,999px,51px,0)}5%{clip:rect(93px,999px,44px,0)}10%{clip:rect(56px,999px,90px,0)}15%{clip:rect(82px,999px,88px,0)}20%{clip:rect(38px,999px,79px,0)}25%{clip:rect(27px,999px,10px,0)}30%{clip:rect(55px,999px,35px,0)}35%{clip:rect(83px,999px,12px,0)}40%{clip:rect(11px,999px,33px,0)}45%{clip:rect(65px,999px,59px,0)}50%{clip:rect(63px,999px,79px,0)}55%{clip:rect(73px,999px,49px,0)}60%{clip:rect(88px,999px,38px,0)}65%{clip:rect(14px,999px,51px,0)}70%{clip:rect(83px,999px,62px,0)}75%{clip:rect(74px,999px,55px,0)}80%{clip:rect(27px,999px,79px,0)}85%{clip:rect(64px,999px,34px,0)}90%{clip:rect(68px,999px,22px,0)}95%{clip:rect(94px,999px,70px,0)}100%{clip:rect(41px,999px,20px,0)}}.glitch:before{left:-2px;text-shadow:1px 0 #00f;clip:rect(0,900px,0,0);animation:noise-anim-2 3s infinite linear alternate-reverse}#cred{position:absolute; bottom: 0; left: 0; color: #777; font-size: 12px; padding: 6px;</style>
</head><body><div id="wrpr"><div id="game"><div id="startScreen"><div class="title glitch" data-text="LEVEL 10">LEVEL 10</div><div style="color: #00b9c5">SELECT A MODE</div><div class="btn" id="classicMode">CLASSIC</div><div class="btn" id="survivalMode">SURVIVAL</div><div style="color: #c57100">HOW TO PLAY</div><div>- Move the ball by tilting/raising the bar</div><div style="color: #bbb">  Controls: (click to re-bind)</div><div class="ctrbndr" data-control="leftUp"></div><div class="ctrbndr" data-control="leftDown"></div><div class="ctrbndr" data-control="rightUp"></div><div class="ctrbndr" data-control="rightDown"></div><div>- Classic Rules </div><div style="color: #bbb">  Navigate the ball into the goals</div><div style="color: #bbb">  Avoid all other holes</div><div>- Survival Rules </div><div style="color: #bbb">  Lift the ball as high as you can</div><div style="color: #bbb">  Avoid all holes</div><div>- Press 'P' to Pause</div><div id="cred">Mike Ferron | <a target="_blank" href="https://twitter.com/ferronsays">@ferronsays</a></div></div><div id="pauseScreen"><div class="title glitch" data-text="PAUSED">PAUSED</div><div>PRESS 'P' TO RESUME</div></div><div id="gOScRN"><div class="title glitch" data-text="GAME OVER">GAME OVER</div><div class="btn" id="restart">TRY AGAIN</div><div class="btn" id="goToMenu">MAIN MENU</div><table><thead><tr><th>Rank</th><th>Score</th></tr></thead><tbody id="highScores"></tbody></table></div><canvas id="g"></canvas></div></div>
<script>function J(){this.B=function(t){for(var i=0;24>i;i++)this[String.fromCharCode(97+i)]=t[i]||0;.01>this.c&&(this.c=.01),t=this.b+this.c+this.e,.18>t&&(t=.18/t,this.b*=t,this.c*=t,this.e*=t)}}var Ball=function(){var t=function(t,i,s){this.circle=new Circle(t,i,s),this.circle.restitutionCoeff=0,this.gravityVec=new V2(0,.75),this.circle.acc=this.gravityVec.copy(),this.circle.entity=this,this.isOnLine=!1,this.isAlive=!0};return t.prototype={addToWorld:function(t){t.addCircle(this.circle)},handleCollision:function(t,i,s){if(t===this.circle){if("TRIGGER"===i.type){var s=this.circle.pos.copy().sub(i.pos),e=Math.sqrt(s.dot(s));if(e<=Math.abs(this.circle.radius-i.radius))this.onSunk(i);else if(this.circle.pos.y-this.circle.radius<=i.pos.y&&this.circle.pos.y>=i.pos.y-i.radius&&e-this.circle.radius<=i.radius-.75*this.circle.radius){var n=i.pos.copy().sub(this.circle.pos).norm();n.x*=.35,n.y*=Math.max(.12*e,1.1),this.circle.acc.add(n)}else this.circle.acc=this.gravityVec.copy()}"LINE"===i.type&&(this.isOnLine=!0)}},onSunk:function(t){var i=t.entity;document.dispatchEvent(new CustomEvent("ballSunk",{detail:{ball:this,hole:i}}))},step:function(){if(this.isOnLine){var t=Math.abs(this.circle.rotationSpeed);t>1.5?sfx.play("rollFast"):t>.6&&1.5>t?sfx.play("rollMedium"):t>.1&&.6>t&&sfx.play("rollSlow")}this.isOnLine=!1,this.circle.acc=this.gravityVec.copy()},render:function(t){t.beginPath(),t.arc(this.circle.pos.x+SHADOW_OFFSET,this.circle.pos.y+SHADOW_OFFSET,this.circle.radius,this.circle.rotation,this.circle.rotation+2*Math.PI),t.fillStyle="rgba(0,0,0,0.15)",t.fill(),t.closePath(),t.save(),t.translate(this.circle.pos.x,this.circle.pos.y),t.beginPath(),t.arc(0,0,this.circle.radius,0,2*Math.PI),t.fillStyle="#2f2f2f",t.fill(),t.closePath(),t.fillStyle="#fff",t.rotate(this.circle.rotation),t.beginPath(),t.arc(6,0,2,0,2*Math.PI),t.fill(),t.closePath(),t.beginPath(),t.arc(-6,0,2,0,2*Math.PI),t.fill(),t.closePath(),t.beginPath(),t.arc(0,6,2,0,2*Math.PI),t.fill(),t.closePath(),t.beginPath(),t.arc(0,-6,2,0,2*Math.PI),t.fill(),t.closePath(),t.restore()},destroy:function(){this.isAlive=!1,this.circle.isAlive=!1}},t}(),Bar=function(){var t=function(t,i,s){var e=i/2;this.length=i,this.centerPoint=t.copy(),this.edgeHeight=s,this.baseOffset=10,this.maxHeightDifference=175,this.leftPoint=new V2(t.x-e,t.y),this.rightPoint=new V2(t.x+e,t.y),this.base=new Line(this.leftPoint.x,this.leftPoint.y,this.rightPoint.x,this.rightPoint.y),this.leftBoundary=new Line(this.leftPoint.x,this.leftPoint.y,this.leftPoint.x,this.leftPoint.y-s),this.rightBoundary=new Line(this.rightPoint.x,this.rightPoint.y,this.rightPoint.x,this.rightPoint.y-s),this.leftBoundary.entity=this.rightBoundary.entity=this.base.entity=this,this.wasBCWS=!1,this.isBCWS=!1,this.wasBCWB=!1,this.isBCWB=!1,this.isAlive=!0,this.timeSinceLastInput=0,this.receivingInput=!1};return t.prototype={addToWorld:function(t){t.addLine(this.base),t.addLine(this.leftBoundary),t.addLine(this.rightBoundary)},handleInput:function(t,i){var s=0,e=0,n=2.6;if(t.LU&&(s-=n),t.LD&&(s+=n),t.RU&&(e-=n),t.RD&&(e+=n),0===e&&0===s){var r=i.currentTargetIndex?Math.max(12e3-1200*i.currentTargetIndex,3e3):5e3;if(!(this.timeSinceLastInput>=r))return;var h=Math.abs(this.base.p1.y-this.base.p2.y);2*n>=h&&0!==h?(s=this.base.p1.y-(this.base.p2.y-this.base.p1.y),e=this.base.p2.y-(this.base.p1.y-this.base.p2.y)):this.base.p1.y<this.base.p2.y?(s=Math.min(h,n),e=-Math.min(h,n)):this.base.p1.y>this.base.p2.y?(e=Math.min(h,n),s=-Math.min(h,n)):e=s=-n,sfx.play("jerk"),this.timeSinceLastInput=0}this.receivingInput=!0;var o=this.base.p1.copy().add(new V2(0,s)),a=this.base.p2.copy().add(new V2(0,e));if(!(Math.abs(a.y-o.y)>this.maxHeightDifference)){var c=window.GAME.modeBarLimitFn(o,a);this.changePosition(c[0],c[1])}},changePosition:function(t,i){this.base.updatePosition(t,i);var s=Math.atan2(this.base.p2.y-this.base.p1.y,this.base.p2.x-this.base.p1.x);s+=Math.PI/2;var e=new V2(Math.cos(s),Math.sin(s)).mult(-this.edgeHeight);this.leftBoundary.updatePosition(this.base.p1.copy(),this.base.p1.copy().add(e)),this.rightBoundary.updatePosition(this.base.p2.copy(),this.base.p2.copy().add(e))},handleCollision:function(t){return t==this.leftBoundary||t==this.rightBoundary?(this.isBCWS=!0,void 0):(t==this.base&&(this.isBCWB=!0),void 0)},step:function(t){this.receivingInput?this.timeSinceLastInput=0:this.timeSinceLastInput+=t,!this.wasBCWS&&this.isBCWS&&(sfx.play("hit"),camera.shake=25),!this.wasBCWB&&this.isBCWB&&(sfx.play("hitSoft"),camera.shake=10),this.wasBCWS=this.isBCWS,this.isBCWS=!1,this.wasBCWB=this.isBCWB,this.isBCWB=!1,this.receivingInput=!1},render:function(t){t.save(),t.strokeStyle="rgba(0,0,0,0.15)",t.beginPath(),t.moveTo(this.base.p1.x+SHADOW_OFFSET,this.base.p1.y+SHADOW_OFFSET),t.lineTo(this.base.p2.x+SHADOW_OFFSET,this.base.p2.y+SHADOW_OFFSET),t.stroke(),t.beginPath(),t.moveTo(this.leftBoundary.p1.x+SHADOW_OFFSET,this.leftBoundary.p1.y+SHADOW_OFFSET),t.lineTo(this.leftBoundary.p2.x+SHADOW_OFFSET,this.leftBoundary.p2.y+SHADOW_OFFSET),t.stroke(),t.beginPath(),t.moveTo(this.rightBoundary.p1.x+SHADOW_OFFSET,this.rightBoundary.p1.y+SHADOW_OFFSET),t.lineTo(this.rightBoundary.p2.x+SHADOW_OFFSET,this.rightBoundary.p2.y+SHADOW_OFFSET),t.stroke(),t.fillStyle="black",t.font="normal 14px monospace",t.textAlign="left",GAME.inputController.presses[0]||t.fillText(String.fromCharCode(parseInt("25B2",16))+" "+KEYCODES[GAME.inputController.CONTROLS.leftUp],this.leftBoundary.p2.x+5,this.leftBoundary.p2.y),GAME.inputController.presses[1]||t.fillText(String.fromCharCode(parseInt("25BC",16))+" "+KEYCODES[GAME.inputController.CONTROLS.leftDown],this.leftBoundary.p1.x+5,this.leftBoundary.p1.y-5),t.textAlign="right",GAME.inputController.presses[2]||t.fillText(KEYCODES[GAME.inputController.CONTROLS.rightUp]+" "+String.fromCharCode(parseInt("25B2",16)),this.rightBoundary.p2.x-5,this.rightBoundary.p2.y),GAME.inputController.presses[3]||t.fillText(KEYCODES[GAME.inputController.CONTROLS.rightDown]+" "+String.fromCharCode(parseInt("25BC",16)),this.rightBoundary.p1.x-5,this.rightBoundary.p1.y-5),t.restore()},returnToStart:function(){var t=new V2(this.centerPoint.x-this.length/2,this.centerPoint.y),i=new V2(this.centerPoint.x+this.length/2,this.centerPoint.y);this.changePosition(t,i)},getY:function(){return(this.base.p1.y+this.base.p2.y)/2}},t}(),Hole=function(){var t=function(t,i,s,e){this.trigger=new Trigger(t,i,s),this.isHole=!0,e=e?e:{t:!1,i:null},this.isTarget=e.t||!1,this.targetIndex=e.i||-1,this.isActiveTarget=!1,this.pointValue=e.pointValue||0,this.trigger.entity=this,this.isAlive=!0};return t.prototype={addToWorld:function(t){t.addTrigger(this.trigger)},handleCollision:function(){},step:function(){},render:function(t){if(t.beginPath(),t.arc(this.trigger.pos.x+SHADOW_OFFSET,this.trigger.pos.y+SHADOW_OFFSET,this.trigger.radius,0,2*Math.PI),t.fillStyle="rgba(0,0,0,0.15)",t.fill(),t.closePath(),t.beginPath(),t.strokeStyle="#34495e",t.arc(this.trigger.pos.x,this.trigger.pos.y,this.trigger.radius,0,2*Math.PI),t.fillStyle="#11181f",t.fill(),t.closePath(),this.isTarget){var i=Math.PI;if(this.isActiveTarget){{var s=Math.sin(.0045*Date.now());Math.sin(.002*Date.now())}i=2*Math.PI*s;var e=this.trigger.radius-.01*Date.now()%this.trigger.radius;t.beginPath(),t.strokeStyle="rgba(255,255,255,"+e/this.trigger.radius+")",t.arc(this.trigger.pos.x,this.trigger.pos.y,e,0,2*Math.PI),t.stroke(),t.closePath()}var n=i+Math.PI;t.strokeStyle="rgba(0,0,0,0.15)",t.beginPath(),t.arc(this.trigger.pos.x+SHADOW_OFFSET,this.trigger.pos.y+SHADOW_OFFSET,this.trigger.radius+4,i,n),t.stroke(),t.strokeStyle="#34495e",t.beginPath(),t.arc(this.trigger.pos.x,this.trigger.pos.y,this.trigger.radius+4,i,n),t.stroke(),t.fillText(this.targetIndex,this.trigger.pos.x,this.trigger.pos.y-this.trigger.radius-8)}},destroy:function(){this.isAlive=!1,this.trigger.isAlive=!1}},t}(),InputController=function(){var t=function(t){this.CONTROLS=t||{},this.bind(),this.presses=[0,0,0,0]};return t.prototype={bind:function(){var t=this,i=window.addEventListener;i("keydown",function(i){if(window.GAME.keybindingObj.isListening)return this.CONTROLS[window.GAME.keybindingObj.controlCode]=i.keyCode,window.GAME.updateControlView(),window.GAME.keybindingObj.isListening=!1,void 0;if(80===i.keyCode)return window.GAME.isPaused?window.GAME.resume():window.GAME.pause(),void 0;switch(i.keyCode){case this.CONTROLS.leftUp:t.presses[0]=1,t.LU=bT;break;case this.CONTROLS.leftDown:t.presses[1]=1,t.LD=bT;break;case this.CONTROLS.rightUp:t.presses[2]=1,t.RU=bT;break;case this.CONTROLS.rightDown:t.presses[3]=1,t.RD=bT}}.bind(this)),i("keyup",function(i){switch(i.keyCode){case this.CONTROLS.leftUp:t.LU=bF;break;case this.CONTROLS.leftDown:t.LD=bF;break;case this.CONTROLS.rightUp:t.RU=bF;break;case this.CONTROLS.rightDown:t.RD=bF}}.bind(this))}},t}(),Pulse=function(){var t=function(t,i,s,e,n,r){this.x=t,this.y=i,this.lifeExpectancy=n,this.isGood=r,this.lifetime=0,this.isAlive=!0,this.startSize=s,this.endSize=e,this.radius=s};return t.prototype={step:function(t){return this.lifetime+=t,this.lifetime>this.lifeExpectancy?(this.destroy(),void 0):(this.radius=App.lerp(this.startSize,this.endSize,this.lifetime/this.lifeExpectancy),void 0)},render:function(t){var i=1-this.lifetime/this.lifeExpectancy,s=this.isGood?"rgba(46, 204, 113,"+i+")":"red",e=this.radius;t.beginPath(),t.arc(this.x+SHADOW_OFFSET,this.y+SHADOW_OFFSET,e,0,2*Math.PI),t.strokeStyle="rgba(0,0,0,"+.15*i+")",t.stroke(),t.closePath(),t.beginPath(),t.arc(this.x,this.y,e,0,2*Math.PI),t.strokeStyle=s,t.stroke(),t.closePath()},destroy:function(){this.isAlive=!1}},t}(),App=function(){var t=function(){this.init()};return t.extend=function(t,i,s){for(var e in i)(s||t.hasOwnProperty(e))&&(t[e]=i[e]);return t},t.randPN=function(){return 2*Math.random()-1},t.degToRad=function(t){return t*Math.PI/180},t.radToDeg=function(t){return 180*t/Math.PI},t.wrapAngle=function(t){for(;t<-Math.PI;)t+=2*Math.PI;for(;t>Math.PI;)t-=2*Math.PI;return t},t.wrapNumber=function(t,i,s){return i>t?s:t>s?i:t},t.randRange=function(t,i){return Math.floor(Math.random()*(i-t+1)+t)},t.clamp=function(t,i,s){return i>t?i:s>t?t:s},t.inRange=function(t,i,s){return t>=i&&s>=t},t.pad=function(t,i){for(var s=""+t;s.length<i;)s="0"+s;return s},t.lerp=function(t,i,s){return s=0>s?0:s,s=s>1?1:s,t+(i-t)*s},t.getHSLString=function(t){return"hsl("+t[0]+", "+t[1]+"%,"+t[2]+"%)"},t.prototype={init:function(){this.width=WIDTH,this.height=HEIGHT,this.dt=0,this.currentTime=(new Date).getTime(),this.nodes=[],this.canvas=document.getElementById("g"),this.resetDimensions(this.canvas,this.width,this.height),this.ctx=this.canvas.getContext("2d"),this.started=!1,this.isPaused=!1,this.pixelation=100,this.backgroundColor=[214,100,93],this.storage=window.localStorage;var t=this.storage.getItem("highScores"),i=this.storage.getItem("keyBindings");t||this.storage.setItem("highScores",[300,600,1100,1400,1700,2100,2500,3e3,4e3,5e3]);var t=this.storage.getItem("highScoresSurvival");t||this.storage.setItem("highScoresSurvival",[500,1e3,1750,2500,3500,4500,6e3,7750,1e4,14e3]),i?i=JSON.parse(i):(i={leftUp:65,leftDown:90,rightUp:75,rightDown:77},this.storage.setItem("keyBindings",JSON.stringify(i))),this.inputController=new InputController(i),this.keybindingObj={isListening:!1,controlCode:null},this.physics=new Physics,this.camera=new Camera(this),this.camera.lookat=new V2(this.width/2,this.height/2),window.camera=this.camera,this.lastModeStartFn=noop,this.modeStepFn=noop,this.initSounds(),this.initElements(),this.initEventListeners(),this.updateGlow(),this.playMusic()},initSounds:function(){this.sfx=new SFX,window.sfx=this.sfx;var t=[[0,,.0596,,.2991,.26,,-.4176,,,,,,.4098,,,,,1,,,,,.5],[1,,.01,,.2483,.2643,,-.3235,,,,,,,,,,,1,,,,,.5],[3,,.0633,,.2823,.4429,,-.6523,,,,,,,,,,,1,,,.0184,,.5]];this.sfx.add("hit",6,t,.5),this.sfx.add("hitSoft",6,t,.15),this.sfx.add("rollFast",3,[[3,.1611,.0188,,,,,-1,-1,,,-1,-.4823,,-1,,-1,-1,.27,-.8,,,-1,.5]],.1),this.sfx.add("rollMedium",1,[[3,.1606,.0193,.0118,,,,-.9775,-1,.045,.0064,-1,,,-.9992,,-.9556,-.9679,.27,-.8,.0314,.0197,-1,.5]],.1),this.sfx.add("rollSlow",1,[[3,.1611,.0188,,.51,,,-1,-1,,,-1,,,-1,,-1,-1,.27,-.8,,,-1,.5]],.1),this.sfx.add("sinkGood",1,[[1,,.2434,,.4381,.2149,,.242,,.3704,.593,,,,,,,,1,,,,,.5]],.5),this.sfx.add("sinkBad",1,[[3,,.2104,.3283,.4148,.2317,,,,,,.4105,.6585,,,.7011,.2052,-.2005,1,,,,,.5]],.5),this.sfx.add("jerk",1,[[3,.0153,.2006,.525,1e-4,.0617,,.0561,-.0122,.0055,,-.4821,.8556,.0084,.0352,.0247,.0426,-.2518,.9836,-.0067,,.032,-.044,.5]],.5)},initElements:function(){var t=document.getElementById.bind(document);this.$gOScRN=t("gOScRN"),this.$startScreen=t("startScreen"),this.$pauseScreen=t("pauseScreen"),this.$classicMode=t("classicMode"),this.$survivalMode=t("survivalMode"),this.$highScores=t("highScores"),this.$restart=t("restart"),this.$goToMenu=t("goToMenu"),this.$wrpr=t("wrpr"),this.$ctrbndrs=[].slice.call(document.getElementsByClassName("ctrbndr")),this.updateControlView()},updateControlView:function(){this.$ctrbndrs.forEach(function(t){var i=this.inputController.CONTROLS,s="leftUp",e="leftDown",n="rightUp",r="rightDown";switch(t.dataset.control){case s:t.innerHTML=KEYCODES[i[s]];break;case e:t.innerHTML=KEYCODES[i[e]];break;case n:t.innerHTML=KEYCODES[i[n]];break;case r:t.innerHTML=KEYCODES[i[r]]}}.bind(this))},initEventListeners:function(){window.addEventListener("keydown",function(){}.bind(this)),this.$classicMode.addEventListener("click",function(){this.toggleScreens(null,this.$startScreen),this.startClassicMode(),this.keybindingObj.isListening=!1}.bind(this)),this.$survivalMode.addEventListener("click",function(){this.toggleScreens(null,this.$startScreen),this.startSurvivalMode(),this.keybindingObj.isListening=!1}.bind(this)),this.$ctrbndrs.forEach(function(t){t.addEventListener("click",function(i){this.keybindingObj={isListening:!0,controlCode:t.dataset.control},i.target.innerHTML="PRESS ANY KEY"}.bind(this))}.bind(this)),this.$restart.addEventListener("click",function(){this.toggleScreens(null,this.$gOScRN),this.lastModeStartFn()}.bind(this)),this.$goToMenu.addEventListener("click",function(){this.toggleScreens(this.$startScreen,this.$gOScRN),this.ctx.clearRect(0,0,this.width,this.height)}.bind(this)),document.addEventListener("ballSunk",function(i){var s=i.detail.ball,e=i.detail.hole,n=e.trigger.pos,r=e.trigger.radius;if(s.destroy(),e.isActiveTarget){sfx.play("sinkGood");for(var h=0;5>h;h++)this.addChild(new Pulse(n.x,n.y,r,t.randRange(2*r,4*r),t.randRange(400,1e3),!0));7==this.currentTargetIndex&&(this.totalBalls+=1),this.score+=this.bonus;var o=this.currentTargetIndex+1;o>10&&(o=1),this.setCurrentTarget(o)}else{sfx.play("sinkBad");for(var h=0;5>h;h++)this.addChild(new Pulse(n.x,n.y,r,t.randRange(2*r,3*r),t.randRange(50,300),!1));if(this.pixelation=0,this.camera.shake=70,this.totalBalls-=1,0==this.totalBalls)return this.onGameOver(),void 0}this.bar.returnToStart(),window.setTimeout(this.spawnBall.bind(this),1)}.bind(this))},startClassicMode:function(){this.inputController.presses=[0,0,0,0],this.camera.lookat=new V2(this.width/2,this.height/2),this.lastModeStartFn=this.startClassicMode,this.modeStepFn=function(t){this.bonusCounter+=t,this.bonusCounter>3e3&&(this.bonusCounter=0,this.bonus=Math.max(this.bonus-10,0))}.bind(this),this.modeBarLimitFn=function(t,i){return t.y=t.y>HEIGHT-40?HEIGHT-40:t.y,i.y=i.y>HEIGHT-40?HEIGHT-40:i.y,t.y=t.y<40?40:t.y,i.y=i.y<40?40:i.y,[t,i]}.bind(this),this.modeScoreDrawFn=function(){this.ctx.fillStyle="black",this.ctx.font="normal 18px monospace",this.ctx.fillText("BALLS: "+this.totalBalls,10,HEIGHT-10),this.ctx.fillText("BONUS: "+this.bonus,150,HEIGHT-10),this.ctx.fillText("SCORE: "+this.score,350,HEIGHT-10)}.bind(this),this.nodes=[],this.physics.reset(),this.totalBalls=3,this.score=0,this.bonus=0,this.bonusCounter=0,this.currentTargetIndex=1,this.pixelation=100,this.camera.dist=100,this.spawnBall(),this.spawnBar();for(var t=0;t<STANDARD_CONFIG.length;t++){var i=new Hole(STANDARD_CONFIG[t].b?21:17,STANDARD_CONFIG[t].x,STANDARD_CONFIG[t].y-20,STANDARD_CONFIG[t]);this.addChild(i),i.addToWorld(this.physics)}this.setCurrentTarget(1),this.enable()},startSurvivalMode:function(){this.inputController.presses=[0,0,0,0],this.lastModeStartFn=this.startSurvivalMode;var i=function(i,s){for(var e,n,r,h=!1,o=function(){e=t.randRange(10,this.width-10),n=t.randRange(i,s),h=Math.random()>.5?21:17;for(var r=!0,o=0;o<this.physics.triggers.length;o++){var a=DO_CIRCLES_COLLIDE({pos:new V2(e,n),radius:h},this.physics.triggers[o]);if(a){r=!1;break}}return r}.bind(this),a=!1;!a;){var c=o();if(c){r=new Hole(h,e,n);break}}return r}.bind(this),s=function(t,s){var e=i(t,s);this.addChild(e),e.addToWorld(this.physics)}.bind(this);this.modeStepFn=function(){var t=this.bar.getY()-300;this.camera.moveTo(this.width/2,t);var i=this.score;this.score=Math.max(Math.round(Math.abs(this.bar.getY()-(HEIGHT-40))),this.score),this.scoreCounter=this.scoreCounter||0;var e=0;this.nodes=this.nodes.filter(function(t){return t.isHole&&t.trigger.pos.y>this.bar.getY()+200&&(t.destroy(),e+=2),!0}.bind(this));var n=this.score-i;0!=n&&(this.scoreCounter+=n,this.scoreCounter>100&&(e+=1,this.scoreCounter=0));for(var r=0;e>r;r++){var h=this.camera.screenToWorld(0,this.camera.vp.t).y;s(h+100,h+50)}}.bind(this),this.modeBarLimitFn=function(t,i){return t.y=t.y>HEIGHT-40?HEIGHT-40:t.y,i.y=i.y>HEIGHT-40?HEIGHT-40:i.y,[t,i]}.bind(this),this.modeScoreDrawFn=function(){this.ctx.fillStyle="black",this.ctx.font="normal 18px monospace",this.ctx.fillText("SCORE: "+this.score,10,HEIGHT-10)}.bind(this),this.nodes=[],this.physics.reset(),this.totalBalls=1,this.score=0,this.camera.dist=100,this.spawnBall(),this.spawnBar();for(var e=0;70>e;e++)s(-400,this.height-200);this.enable()},setCurrentTarget:function(t){this.nodes.forEach(function(i){"undefined"!=typeof i.targetIndex&&(i.isActiveTarget=!1,i.targetIndex==t&&(i.isActiveTarget=!0))}),this.currentTargetIndex=t,this.bonus=100*this.currentTargetIndex},enable:function(){this.started=!0,this.animate((new Date).getTime())},animate:function(t){this.animationFrame=requestAnimationFrame(function(){this.animate((new Date).getTime())}.bind(this));var i=t-this.currentTime;this.currentTime=t,this.step(i)},disable:function(){this.started=!1,cancelAnimationFrame(this.animationFrame)},toggleScreens:function(t,i){t?t.style.display="block":noop,i?i.style.display="none":noop},pause:function(){this.started&&(this.disable(),this.isPaused=!0,this.toggleScreens(this.$pauseScreen,null))},resume:function(){this.isPaused&&(this.currentTime=(new Date).getTime(),this.enable(),this.isPaused=!1,this.toggleScreens(null,this.$pauseScreen))},onGameOver:function(){function i(t){switch(t){case 1:return"1st";case 2:return"2nd";case 3:return"3rd";default:return t+"th"}}this.disable();var s=this.lastModeStartFn===this.startClassicMode?"highScores":"highScoresSurvival",e=this.storage.getItem(s).split(",").map(function(t){return parseInt(t)});e.sort(function(t,i){return i-t});var n=e.some(function(t){return t<this.score}.bind(this));n&&(e.push(this.score),e.sort(function(t,i){return i-t}),e=e.slice(0,10),this.storage.setItem(s,e)),this.$highScores.innerHTML=e.reduce(function(s,e,n){return s+'<tr class="'+(e==this.score?"new":"")+'"><td>'+i(n+1)+"</td><td>"+t.pad(e,6)+"</td></tr>"}.bind(this),""),this.toggleScreens(this.$gOScRN,null)},resetDimensions:function(t,i,s){this.width=t.width=i,this.height=t.height=s},addChild:function(t){this.nodes.push(t)},addChildAt:function(t,i){i>=0&&i<=this.nodes.length&&this.nodes.splice(i,0,t)},step:function(t){if(t){this.camera.step(t),this.physics.update(),this.modeStepFn(t),this.pixelation<100&&(this.pixelation=Math.min(100,this.pixelation+1)),this.bar.handleInput(this.inputController,this);for(var i=this.nodes.length;i--;){var s=this.nodes[i];s.step(t),s.isAlive||this.nodes.splice(i,1)}this.render(),this.updateGlow()}},render:function(){this.ctx.fillStyle=t.getHSLString(this.backgroundColor),this.ctx.fillRect(0,0,this.width,this.height),this.ctx.save(),this.ctx.lineWidth=2,this.ctx.strokeStyle="#2c3e50",this.ctx.font="12px monospace",this.ctx.textAlign="center",this.ctx.save(),this.camera.begin();for(var i=this.nodes.length;i--;)this.nodes[i].render(this.ctx);if(this.physics.render(this.ctx),this.ctx.restore(),this.camera.end(),100!==this.pixelation){var s=this.canvas.width*this.pixelation*.01,e=this.canvas.height*this.pixelation*.01;this.ctx.drawImage(this.canvas,0,0,s,e),this.ctx.drawImage(this.canvas,0,0,s,e,0,0,this.canvas.width,this.canvas.height)}this.ctx.restore(),this.modeScoreDrawFn()},spawnBall:function(){this.mainBall=new Ball(10,300,HEIGHT-60),this.mainBall.addToWorld(this.physics),this.addChildAt(this.mainBall,0)},spawnBar:function(){this.bar=new Bar(new V2(300,HEIGHT-40),540,30),this.bar.addToWorld(this.physics),this.addChild(this.bar)},updateGlow:function(){this.backgroundColor[0]=t.wrapNumber(this.backgroundColor[0]+.25,0,360),this.$wrpr.style.boxShadow="0px 0px 80px "+t.getHSLString(this.backgroundColor)},playMusic:function(){}},t}(),V2=function(){function t(t,i){this.x=t||0,this.y=i||0}return t.prototype={set:function(t,i){return this.x=t,this.y=i,this},copy:function(){return new t(this.x,this.y)},copyVec:function(t){return this.x=t.x,this.y=t.y,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthSquared:function(){return Math.pow(this.x,2)+Math.pow(this.y,2)},norm:function(){var t=this.length();return t>0&&this.divide(t),this},limit:function(t){return this.length()>t?(this.norm(),this.mult(t)):this},heading:function(){return-1*Math.atan2(-1*this.y,this.x)},add:function(t){return this.x+=t.x,this.y+=t.y,this},sub:function(t){return this.x-=t.x,this.y-=t.y,this},mult:function(t){return this.x=this.x*t,this.y=this.y*t,this},divide:function(t){return this.x=this.x/t,this.y=this.y/t,this},dot:function(t){return this.x*t.x+this.y*t.y},toInt:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},t}(),ABC123="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",noop=function(){},SHADOW_OFFSET=6,WIDTH=600,HEIGHT=800,GRAVITY_VECTOR=new V2(0,.4),DO_CIRCLES_COLLIDE=function(t,i){if(!t||!i)return!1;if(Math.abs(t.pos.y-i.pos.y)>100)return!1;var s=t.pos.copy().sub(i.pos),e=s.dot(s),n=t.radius+i.radius,r=n*n;return e>r?!1:!0},bT=!0,bF=!1,STANDARD_CONFIG=[{x:492,y:707,t:bF},{x:300,y:666,t:bT,i:1},{x:109,y:658,t:bF},{x:181,y:638,t:bF},{x:239,y:636,t:bF,b:bT},{x:373,y:646,t:bF},{x:473,y:642,t:bT,i:2},{x:532,y:640,t:bF},{x:553,y:597,t:bF,b:bT},{x:493,y:594,t:bF},{x:426,y:610,t:bF},{x:381,y:590,t:bF},{x:302,y:612,t:bF},{x:127,y:589,t:bT,i:3},{x:71,y:606,t:bF},{x:44,y:547,t:bF,b:bT},{x:169,y:555,t:bF},{x:308,y:544,t:bF,b:bT},{x:393,y:534,t:bT,i:4},{x:441,y:531,t:bF,b:bT},{x:559,y:544,t:bF,b:bT},{x:502,y:460,t:bF,b:bT},{x:403,y:465,t:bF},{x:359,y:460,t:bF},{x:282,y:485,t:bF},{x:254,y:518,t:bF},{x:218,y:487,t:bF},{x:131,y:496,t:bF,b:bT},{x:183,y:450,t:bF},{x:228,y:434,t:bT,i:5},{x:327,y:431,t:bF},{x:469,y:411,t:bF},{x:528,y:374,t:bF},{x:432,y:369,t:bF},{x:314,y:358,t:bF},{x:227,y:350,t:bF},{x:187,y:387,t:bF},{x:137,y:412,t:bF,b:bT},{x:91,y:433,t:bF},{x:66,y:388,t:bF},{x:41,y:341,t:bF,b:bT},{x:277,y:318,t:bF,b:bT},{x:352,y:319,t:bF,b:bT},{x:396,y:331,t:bF},{x:471,y:331,t:bT,i:6},{x:543,y:330,t:bF},{x:563,y:287,t:bF,b:bT},{x:508,y:288,t:bF},{x:473,y:247,t:bF},{x:398,y:279,t:bF,b:bT},{x:313,y:278,t:bT,i:7},{x:239,y:280,t:bF},{x:190,y:270,t:bF},{x:146,y:290,t:bF},{x:101,y:271,t:bF},{x:43,y:243,t:bF,b:bT},{x:84,y:223,t:bF},{x:142,y:222,t:bT,i:8},{x:203,y:222,t:bF},{x:276,y:237,t:bF,b:bT},{x:352,y:238,t:bF,b:bT},{x:403,y:210,t:bF},{x:313,y:196,t:bF},{x:248,y:163,t:bF},{x:141,y:159,t:bF},{x:98,y:174,t:bF},{x:110,y:109,t:bF,b:bT},{x:182,y:91,t:bF},{x:215,y:128,t:bF,b:bT},{x:281,y:127,t:bF,b:bT},{x:341,y:141,t:bF},{x:406,y:141,t:bT,i:9},{x:437,y:176,t:bF},{x:468,y:140,t:bF},{x:548,y:126,t:bF,b:bT},{x:438,y:106,t:bF},{x:406,y:71,t:bF},{x:373,y:107,t:bF},{x:311,y:91,t:bF},{x:279,y:57,t:bF,b:bT},{x:247,y:92,t:bT,i:10},{x:214,y:56,t:bF,b:bT}],KEYCODES={3:"break",8:"backspace / delete",9:"tab",12:"clear",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause/break",20:"caps lock",27:"escape",32:"spacebar",33:"page up",34:"page down",35:"end",36:"home",37:"left arrow",38:"up arrow",39:"right arrow",40:"down arrow",41:"select",42:"print",43:"execute",44:"Print Screen",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",58:":",59:"semicolon (firefox), equals",60:"<",61:"equals (firefox)",63:"ß",64:"@ (firefox)",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"Windows Key / Left cmd / Chromebook Search key",92:"right window key",93:"Windows Menu / Right cmd",96:"numpad 0",97:"numpad 1",98:"numpad 2",99:"numpad 3",100:"numpad 4",101:"numpad 5",102:"numpad 6",103:"numpad 7",104:"numpad 8",105:"numpad 9",106:"multiply",107:"add",108:"numpad period (firefox)",109:"subtract",110:"decimal point",111:"divide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",124:"f13",125:"f14",126:"f15",127:"f16",128:"f17",129:"f18",130:"f19",131:"f20",132:"f21",133:"f22",134:"f23",135:"f24",144:"num lock",145:"scroll lock",160:"^",161:"!",163:"#",164:"$",165:"ù",166:"page backward",167:"page forward",169:"closing paren (AZERTY)",170:"*",171:"~ + * key",173:"minus (firefox), mute/unmute",174:"decrease volume level",175:"increase volume level",176:"next",177:"previous",178:"stop",179:"play/pause",180:"e-mail",181:"mute/unmute (firefox)",182:"decrease volume level (firefox)",183:"increase volume level (firefox)",186:"semi-colon",187:"equal sign",188:"comma",189:"dash",190:"period",191:"forward slash",192:"grave accent",193:"?, /",194:"numpad period (chrome)",219:"open bracket",220:"back slash",221:"close bracket",222:"single quote",223:"`",224:"left or right cmd key (firefox)",225:"altgr",226:"< /git >",230:"GNOME Compose Key",233:"XF86Forward",234:"XF86Back",255:"toggle touchpad"};window.onload=function(){window.GAME=new App};var SFX=function(){var t=function(){this.sounds={}};return t.prototype={add:function(t,i,s,e){this.sounds[t]=[];for(var n=0;n<s.length;n++){var r=s[n];this.sounds[t].push({tick:0,count:i,pool:[]});for(var h=0;i>h;h++){var o=new Audio;o.src=jsfxr(r),o.volume=e,this.sounds[t][n].pool.push(o)}}},play:function(t){if(window.chrome){var i=this.sounds[t],s=i.length>1?i[Math.floor(Math.random()*i.length)]:i[0];s.pool[s.tick].play(),s.tick<s.count-1?s.tick++:s.tick=0}}},t}(),Camera=function(){var t=function(t){this.dist=100,this.targetDistance=600,this.lookat=new V2,this.c=t.ctx,this.fov=Math.PI/4,this.vp={l:0,r:0,t:0,b:0,w:0,h:0,scale:new V2(1,1)},this.lerp=!0,this.lerpD=.04,this.shake=0,this.stepVp(0)};return t.prototype={begin:function(){this.c.save(),this.scale(),this.translate()},end:function(){this.c.restore()},scale:function(){this.c.scale(this.vp.scale.x,this.vp.scale.y)},translate:function(){this.c.translate(-this.vp.l,-this.vp.t)},step:function(t){this.shake=Math.max(this.shake-t,0),this.zoomTo(this.dist+.05*(this.targetDistance-this.dist))},stepVp:function(){this.aspectRatio=this.c.canvas.width/this.c.canvas.height,this.vp.w=this.dist*Math.tan(this.fov),this.vp.h=this.vp.w/this.aspectRatio,this.vp.l=this.lookat.x-this.vp.w/2,this.vp.t=this.lookat.y-this.vp.h/2,this.vp.scale.x=WIDTH/this.vp.w,this.vp.scale.y=HEIGHT/this.vp.h,this.shake>0&&(this.vp.l+=4*App.randPN(),this.vp.t+=4*App.randPN()),this.vp.r=this.vp.l+this.vp.w,this.vp.b=this.vp.t+this.vp.h},zoomTo:function(t){this.dist=t,this.stepVp()},moveTo:function(t,i){this.lerp?(this.lookat.x-=(this.lookat.x-t)*this.lerpD,this.lookat.y-=(this.lookat.y-i)*this.lerpD):(this.lookat.x=t,this.lookat.y=i),this.stepVp()},lockBounds:function(){this.vp.l=App.clamp(this.vp.l,this.bounds.l,this.bounds.r-this.vp.w),this.vp.t=App.clamp(this.vp.t,this.bounds.t,this.bounds.b-this.vp.h)},screenToWorld:function(t,i,s){return s=s||{},s.x=t/this.vp.scale.x+this.vp.l,s.y=i/this.vp.scale.y+this.vp.t,s},worldToScreen:function(t,i,s){return s=s||{},s.x=(t-this.vp.l)*this.vp.scale.x,s.y=(i-this.vp.t)*this.vp.scale.y,s}},t}(),Physics=function(){var t=function(){this.reset()};return t.prototype={reset:function(){this.circles=[],this.lines=[],this.triggers=[]},update:function(){this.triggers=this.triggers.filter(function(t){return t.isAlive}),this.triggers.forEach(function(t){t.detectCircleCollisions(this.circles,function(i){i.entity&&i.entity.handleCollision(i,t)})}.bind(this)),this.circles=this.circles.filter(function(t){return t.isAlive}),this.circles.forEach(function(t){t.integrate(),t.detectCircleCollisions(this.circles,function(){}),t.detectLineCollisions(this.lines,function(i,s){i.entity&&i.entity.handleCollision(i,t),t.entity&&t.entity.handleCollision(t,i);var e=t.projectOut(s);t.pos=t.pos.copy().add(e.copy().mult(t.restitutionCoeff)),t.rotate(e)})}.bind(this))},render:function(t){this.circles.forEach(function(i){i.render(t)}),this.lines.forEach(function(i){i.render(t)}),this.triggers.forEach(function(i){i.render(t)})},addCircle:function(t){this.circles.push(t)},addLine:function(t){this.lines.push(t)},addTrigger:function(t){this.triggers.push(t)}},t}(),Line=function(){var t=function(t,i,s,e){this.type="LINE",this.entity=null,this.isAlive=!0,this.point=new V2,this.pointVec=new V2,this.p1=new V2(t,i),this.p2=new V2(s,e),this.piece=(new V2).copyVec(this.p2).sub(this.p1),this.norm=(new V2).copyVec(this.piece).norm(),this.sqrLength=this.piece.lengthSquared()};return t.prototype={nearestPoint:function(t){return this.pointVec.copyVec(t).sub(this.p1),normalizedProjection=this.pointVec.dot(this.piece),0>normalizedProjection?this.p1:normalizedProjection>this.sqrLength?this.p2:(this.point.copyVec(this.piece).mult(normalizedProjection/this.sqrLength).add(this.p1),this.point)},updatePosition:function(t,i){this.p1=t.copy(),this.p2=i.copy(),this.piece=(new V2).copyVec(this.p2).sub(this.p1),this.norm=(new V2).copyVec(this.piece).norm(),this.sqrLength=this.piece.lengthSquared()},render:function(t){t.beginPath(),t.strokeStyle="#333",t.moveTo(this.p1.x,this.p1.y),t.lineTo(this.p2.x,this.p2.y),t.stroke()}},t}(),Circle=function(){var t=function(t,i,s,e,n){this.type="CIRCLE",this.entity=null,this.isAlive=!0,this.newPos=new V2,this.acc=GRAVITY_VECTOR.copy(),this.rotation=0,this.rotationSpeed=0,this.pointToPos=new V2,this.radius=t,this.radiusSquared=Math.pow(t,2),this.pos=new V2(i,s),this.prevPos=new V2(e||this.pos.x,n||this.pos.y),this.restitutionCoeff=.8,this.rotation=Math.floor(Math.random()*(-Math.PI-Math.PI+1)+Math.PI)};return t.prototype={velocity:function(){return this.pos.copy().sub(this.prevPos)},integrate:function(){this.newPos.copyVec(this.pos).mult(2).sub(this.prevPos).add(this.acc),this.prevPos.copyVec(this.pos),this.pos.copyVec(this.newPos),this.rotation+=this.rotationSpeed/this.radius,this.rotation=App.wrapAngle(this.rotation),this.acc=GRAVITY_VECTOR.copy()},rotate:function(t,i){var s=this.prevPos.copy().sub(this.pos),e=new V2(t.y,-t.x).norm(),n=e.copy().mult(s.dot(e));i=i||.2;var r,h;h=e.dot(n)<=0?-n.length():n.length(),r=h-this.rotationSpeed,this.rotationSpeed+=r*i},detectCircleCollisions:function(t){t.forEach(function(t){if(t!==this){var i=DO_CIRCLES_COLLIDE(t,this);if(i){var s=Math.sqrt(distanceSquared),e=distanceVec.copy().divide(s),n=radius-s,r=t.radius>0?1/t.radius:0,h=this.radius>0?1/this.radius:0,o=e.copy().mult(n/(r+h));t.pos=t.pos.copy().sub(o.copy().mult(r)),this.pos=this.pos.copy().add(o.copy().mult(h));var a=this.velocity().sub(t.velocity()),c=a.copy().dot(e),l=.15,d=-(1+l)*c/(r+h),u=e.copy().mult(d);t.pos=t.pos.copy().sub(u.copy().mult(r)),this.pos=this.pos.copy().add(u.copy().mult(h))}}}.bind(this))},detectLineCollisions:function(t,i){var s,e=new V2;t.forEach(function(t){s=t.nearestPoint(this.pos),e.copyVec(this.pos).sub(s),e.lengthSquared()<this.radiusSquared&&i(t,e)
}.bind(this))},projectOut:function(t){var i=new V2,s=this.radius-t.length();return i.copyVec(t).norm().mult(s),this.pos.add(i),i},render:function(){}},t}(),Trigger=function(){var t=function(t,i,s){this.type="TRIGGER",this.entity=null,this.isAlive=!0,this.radius=t,this.radiusSquared=Math.pow(t,2),this.pos=new V2(i,s),this.isTriggered=!1};return t.prototype={detectCircleCollisions:function(t,i){this.isTriggered=!1,t.forEach(function(t){var s=t.pos.copy().sub(this.pos),e=s.dot(s),n=t.radius+this.radius,r=n*n;e>r||(i(t),this.isTriggered=!0)}.bind(this))},render:function(){}},t}(),Z=new function(){this.A=new J;var t,i,s,e,n,r,h,o,a,c,l,d;this.reset=function(){var t=this.A;e=100/(t.f*t.f+.001),n=100/(t.g*t.g+.001),r=1-t.h*t.h*t.h*.01,h=-t.i*t.i*t.i*1e-6,t.a||(l=.5-t.n/2,d=5e-5*-t.o),o=1+t.l*t.l*(0<t.l?-.9:10),a=0,c=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.D=function(){this.reset();var e=this.A;return t=e.b*e.b*1e5,i=e.c*e.c*1e5,s=e.e*e.e*1e5+12,3*((t+i+s)/3|0)},this.C=function(u,p){var f=this.A,y=1!=f.s||f.v,g=f.v*f.v*.1,b=1+3e-4*f.w,x=f.s*f.s*f.s*.1,v=1+1e-4*f.t,m=1!=f.s,S=f.x*f.x,w=f.g,T=f.q||f.r,C=f.r*f.r*f.r*.2,F=f.q*f.q*(0>f.q?-1020:1020),E=f.p?((1-f.p)*(1-f.p)*2e4|0)+32:0,O=f.d,M=f.j/2,k=f.k*f.k*.01,P=f.a,A=t,I=1/t,B=1/i,D=1/s,f=5/(1+f.u*f.u*20)*(.01+x);f>.8&&(f=.8);for(var L,H,V,R,G,f=1-f,W=!1,N=0,_=0,$=0,q=0,U=0,j=0,Y=0,K=0,z=0,Z=0,J=Array(1024),X=Array(32),Q=J.length;Q--;)J[Q]=0;for(Q=X.length;Q--;)X[Q]=2*Math.random()-1;for(Q=0;p>Q;Q++){if(W)return Q;if(E&&++z>=E&&(z=0,this.reset()),c&&++a>=c&&(c=0,e*=o),r+=h,e*=r,e>n&&(e=n,w>0&&(W=!0)),H=e,M>0&&(Z+=k,H*=1+Math.sin(Z)*M),H|=0,8>H&&(H=8),P||(l+=d,0>l?l=0:l>.5&&(l=.5)),++_>A)switch(_=0,++N){case 1:A=i;break;case 2:A=s}switch(N){case 0:$=_*I;break;case 1:$=1+2*(1-_*B)*O;break;case 2:$=1-_*D;break;case 3:$=0,W=!0}T&&(F+=C,V=0|F,0>V?V=-V:V>1023&&(V=1023)),y&&b&&(g*=b,1e-5>g?g=1e-5:g>.1&&(g=.1)),G=0;for(var ti=8;ti--;){if(Y++,Y>=H&&(Y%=H,3==P))for(L=X.length;L--;)X[L]=2*Math.random()-1;switch(P){case 0:R=l>Y/H?.5:-.5;break;case 1:R=1-Y/H*2;break;case 2:R=Y/H,R=6.28318531*(R>.5?R-1:R),R=1.27323954*R+.405284735*R*R*(0>R?1:-1),R=.225*((0>R?-1:1)*R*R-R)+R;break;case 3:R=X[Math.abs(32*Y/H|0)]}y&&(L=j,x*=v,0>x?x=0:x>.1&&(x=.1),m?(U+=(R-j)*x,U*=f):(j=R,U=0),j+=U,q+=j-L,R=q*=1-g),T&&(J[K%1024]=R,R+=J[(K-V+1024)%1024],K++),G+=R}G=.125*G*$*S,u[Q]=G>=1?32767:-1>=G?-32768:32767*G|0}return p}};window.jsfxr=function(t){Z.A.B(t);var i=Z.D();t=new Uint8Array(4*((i+1)/2|0)+44);var i=2*Z.C(new Uint16Array(t.buffer,44),i),s=new Uint32Array(t.buffer,0,44);s[0]=1179011410,s[1]=i+36,s[2]=1163280727,s[3]=544501094,s[4]=16,s[5]=65537,s[6]=44100,s[7]=88200,s[8]=1048578,s[9]=1635017060,s[10]=i;for(var i=i+44,s=0,e="data:audio/wav;base64,";i>s;s+=3)var n=t[s]<<16|t[s+1]<<8|t[s+2],e=e+(ABC123[n>>18]+ABC123[n>>12&63]+ABC123[n>>6&63]+ABC123[63&n]);return e};</script>
</body>
</html>
