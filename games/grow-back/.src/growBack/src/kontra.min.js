var kontra=function(){"use strict";let t,i,e={};function h(t,...i){e[t]&&e[t].map(t=>t(...i))}function s(){return t}function n(){return i}new WeakMap;const o=()=>{};function r(){let t=s();n().clearRect(0,0,t.width,t.height)}let a={},c={},d={13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"};function u(t){let i=d[t.which];c[i]=!0,a[i]&&a[i](t)}function l(t){c[d[t.which]]=!1}function f(){c={}}let p=[],x=[],g={},_=[],y={},m={0:"left",1:"middle",2:"right"},w={x:0,y:0,radius:5};function v(t){let i=t.x,e=t.y;t.anchor&&(i-=t.width*t.anchor.x,e-=t.height*t.anchor.y);let h=w.x-Math.max(i,Math.min(w.x,i+t.width)),s=w.y-Math.max(e,Math.min(w.y,e+t.height));return h*h+s*s<w.radius*w.radius}function b(){let t,i,e=x.length?x:p;for(let h=e.length-1;h>=0;h--)if(i=(t=e[h]).collidesWithPointer?t.collidesWithPointer(w):v(t))return t}function j(t){let i=void 0!==t.button?m[t.button]:"left";y[i]=!0,S(t,"onDown")}function A(t){let i=void 0!==t.button?m[t.button]:"left";y[i]=!1,S(t,"onUp")}function E(t){S(t,"onOver")}function M(){y={}}function S(t,i){let e,h,n=s();if(!n)return;-1!==["touchstart","touchmove","touchend"].indexOf(t.type)?(e=(t.touches[0]||t.changedTouches[0]).clientX,h=(t.touches[0]||t.changedTouches[0]).clientY):(e=t.clientX,h=t.clientY);let o=n.height/n.offsetHeight,r=n.getBoundingClientRect(),a=(e-r.left)*o,c=(h-r.top)*o;w.x=a,w.y=c,t.preventDefault();let d=b();d&&d[i]&&d[i](t),g[i]&&g[i](t,d)}class z{constructor({create:t,maxSize:i=1024}={}){let e;if(!t||!(e=t())||!(e.update&&e.init&&e.isAlive))throw Error("Must provide create() function which returns an object with init(), update(), and isAlive() functions");this._c=t,this._i=0,this.objects=[t()],this.size=1,this.maxSize=i}get(t={}){if(this.objects.length==this._i){if(this.size===this.maxSize)return;for(let t=0;t<this.size&&this.objects.length<this.maxSize;t++)this.objects.unshift(this._c());this.size=this.objects.length}let i=this.objects.shift();return i.init(t),this.objects.push(i),this._i++,i}getAliveObjects(){return this.objects.slice(this.objects.length-this._i)}clear(){this._i=this.objects.length=0,this.size=1,this.objects.push(this._c())}update(t){let i,e=this.size-1,h=Math.max(this.objects.length-this._i,0);for(;e>=h;)(i=this.objects[e]).update(t),i.isAlive()?e--:(this.objects=this.objects.splice(e,1).concat(this.objects),this._i--,h++)}render(){let t=Math.max(this.objects.length-this._i,0);for(let i=this.size-1;i>=t;i--)this.objects[i].render()}}function L(t){return new z(t)}function k(t,i){let e=[],h=i.x+i.width/2,s=i.y+i.height/2,n=t.y<s&&t.y+t.height>=i.y,o=t.y+t.height>=s&&t.y<i.y+i.height;return t.x<h&&t.x+t.width>=i.x&&(n&&e.push(0),o&&e.push(2)),t.x+t.width>=h&&t.x<i.x+i.width&&(n&&e.push(1),o&&e.push(3)),e}L.prototype=z.prototype,L.class=z;class O{constructor({maxDepth:t=3,maxObjects:i=25,bounds:e}={}){this.maxDepth=t,this.maxObjects=i;let h=s();this.bounds=e||{x:0,y:0,width:h.width,height:h.height},this._b=!1,this._d=0,this._o=[],this._s=[],this._p=null}clear(){this._s.map(function(t){t.clear()}),this._b=!1,this._o.length=0}get(t){let i,e,h=new Set;for(;this._s.length&&this._b;){for(i=k(t,this.bounds),e=0;e<i.length;e++)this._s[i[e]].get(t).forEach(t=>h.add(t));return Array.from(h)}return this._o.filter(i=>i!==t)}add(){let t,i,e,h;for(i=0;i<arguments.length;i++)if(e=arguments[i],Array.isArray(e))this.add.apply(this,e);else if(this._b)this._a(e);else if(this._o.push(e),this._o.length>this.maxObjects&&this._d<this.maxDepth){for(this._sp(),t=0;h=this._o[t];t++)this._a(h);this._o.length=0}}_a(t,i,e){for(i=k(t,this.bounds),e=0;e<i.length;e++)this._s[i[e]].add(t)}_sp(t,i,e){if(this._b=!0,!this._s.length)for(t=this.bounds.width/2|0,i=this.bounds.height/2|0,e=0;e<4;e++)this._s[e]=D({bounds:{x:this.bounds.x+(e%2==1?t:0),y:this.bounds.y+(e>=2?i:0),width:t,height:i},maxDepth:this.maxDepth,maxObjects:this.maxObjects}),this._s[e]._d=this._d+1,this._s[e]._p=this}}function D(t){return new O(t)}D.prototype=O.prototype,D.class=O;class P{constructor(t=0,i=0){this._x=t,this._y=i}add(t,i=1){return Y(this.x+(t.x||0)*i,this.y+(t.y||0)*i,this)}clamp(t,i,e,h){this._c=!0,this._a=t,this._b=i,this._d=e,this._e=h}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?Math.min(Math.max(this._a,t),this._d):t}set y(t){this._y=this._c?Math.min(Math.max(this._b,t),this._e):t}}function Y(t,i,e={}){let h=new P(t,i);return e._c&&(h.clamp(e._a,e._b,e._d,e._e),h.x=t,h.y=i),h}Y.prototype=P.prototype,Y.class=P;class C{constructor(t){this.init(t)}init(t={}){let{x:i,y:e,dx:h,dy:s,ddx:o,ddy:r,width:a,height:c,image:d}=t;this.position=Y(i,e),this.velocity=Y(h,s),this.acceleration=Y(o,r),this._fx=this._fy=1,this.width=this.height=this.rotation=0,this.ttl=1/0,this.anchor={x:0,y:0},this.context=n();for(let i in t)this[i]=t[i];d&&(this.width=void 0!==a?a:d.width,this.height=void 0!==c?c:d.height),this.sx=0,this.sy=0}get x(){return this.position.x}get y(){return this.position.y}get dx(){return this.velocity.x}get dy(){return this.velocity.y}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}get animations(){return this._a}get viewX(){return this.x-this.sx}get viewY(){return this.y-this.sy}get width(){return this._w}get height(){return this._h}set x(t){this.position.x=t}set y(t){this.position.y=t}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}set animations(t){let i,e;for(i in this._a={},t)this._a[i]=t[i].clone(),e=e||this._a[i];this.currentAnimation=e,this.width=this.width||e.width,this.height=this.height||e.height}set viewX(t){}set viewY(t){}set width(t){let i=t<0?-1:1;this._fx=i,this._w=t*i}set height(t){let i=t<0?-1:1;this._fy=i,this._h=t*i}isAlive(){return this.ttl>0}collidesWith(t){if(this.rotation||t.rotation)return null;let i=this.x-this.width*this.anchor.x,e=this.y-this.height*this.anchor.y,h=t.x,s=t.y;return t.anchor&&(h-=t.width*t.anchor.x,s-=t.height*t.anchor.y),i<h+t.width&&i+this.width>h&&e<s+t.height&&e+this.height>s}update(t){this.advance(t)}render(){this.draw()}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){this.velocity=this.velocity.add(this.acceleration,t),this.position=this.position.add(this.velocity,t),this.ttl--,this.currentAnimation&&this.currentAnimation.update(t)}draw(){let t=-this.width*this.anchor.x,i=-this.height*this.anchor.y;if(this.context.save(),this.context.translate(this.viewX,this.viewY),this.rotation&&this.context.rotate(this.rotation),-1==this._fx||-1==this._fy){let e=this.width/2+t,h=this.height/2+i;this.context.translate(e,h),this.context.scale(this._fx,this._fy),this.context.translate(-e,-h)}this.image?this.context.drawImage(this.image,0,0,this.image.width,this.image.height,t,i,this.width,this.height):this.currentAnimation?this.currentAnimation.render({x:t,y:i,width:this.width,height:this.height,context:this.context}):(this.context.fillStyle=this.color,this.context.fillRect(t,i,this.width,this.height)),this.context.restore()}}function X(t){return new C(t)}return X.prototype=C.prototype,X.class=C,{init:function(e){if(!(t=document.getElementById(e)||e||document.querySelector("canvas")))throw Error("You must provide a canvas element for the game");return(i=t.getContext("2d")).imageSmoothingEnabled=!1,h("init"),{canvas:t,context:i}},getCanvas:s,getContext:n,emit:h,GameLoop:function({fps:t=60,clearCanvas:i=!0,update:e,render:s}={}){if(!e||!s)throw Error("You must provide update() and render() functions");let n,a,c,d,u,l=0,f=1e3/t,p=1/t,x=i?r:o;function g(){if(a=requestAnimationFrame(g),c=performance.now(),d=c-n,n=c,!(d>1e3)){for(h("tick"),l+=d;l>=f;)u.update(p),l-=f;x(),u.render()}}return u={update:e,render:s,isStopped:!0,start(){n=performance.now(),this.isStopped=!1,requestAnimationFrame(g)},stop(){this.isStopped=!0,cancelAnimationFrame(a)},_frame:g,set _last(t){n=t}}},keyMap:d,initKeys:function(){let t;for(t=0;t<26;t++)d[65+t]=(10+t).toString(36);for(t=0;t<10;t++)d[48+t]=""+t;window.addEventListener("keydown",u),window.addEventListener("keyup",l),window.addEventListener("blur",f)},keyPressed:function(t){return!!c[t]},initPointer:function(){let t=s();t.addEventListener("mousedown",j),t.addEventListener("touchstart",j),t.addEventListener("mouseup",A),t.addEventListener("touchend",A),t.addEventListener("blur",M),t.addEventListener("mousemove",E),t.addEventListener("touchmove",E),on("tick",()=>{x.length=0,p.map(t=>{x.push(t)}),p.length=0})},pointer:w,track:function(t){[].concat(t).map(t=>{t._r||(t._r=t.render,t.render=function(){p.push(this),this._r()},_.push(t))})},untrack:function(t){[].concat(t).map(t=>{t.render=t._r,t._r=0;let i=_.indexOf(t);-1!==i&&_.splice(i,1)})},pointerOver:function(t){return!!_.includes(t)&&b()===t},onPointerDown:function(t){g.onDown=t},onPointerUp:function(t){g.onUp=t},pointerPressed:function(t){return!!y[t]},Pool:L,Quadtree:D,Sprite:X,Vector:Y}}();
