const cy=["a","about","above","across","act","active","activity","add","afraid","after","again","age","ago","agree","air","all","alone","along","already","always","am","amount","an","and","angry","another","answer","any","anyone","anything","anytime","appear","apple","are","area","arm","army","around","arrive","art","as","ask","at","attack","aunt","autumn","away","baby","back","bad","bag","ball","bank","base","basket","bath","be","bean","bear","beautiful","bed","bedroom","beer","behave","before","begin","behind","bell","below","besides","best","better","between","big","bird","birth","birthday","bit","bite","black","bleed","block","blood","blow","blue","board","boat","body","boil","bone","book","border","born","borrow","both","bottle","bottom","bowl","box","boy","branch","brave","bread","break","breakfast","breathe","bridge","bright","bring","brother","brown","brush","build","burn","business","bus","busy","but","buy","by","cake","call","can","candle","cap","car","card","care","careful","careless","carry","case","cat","catch","central","century","certain","chair","chance","change","chase","cheap","cheese","chicken","child","children","chocolate","choice","choose","circle","city","class","clever","clean","clear","climb","clock","cloth","clothes","cloud","cloudy","close","coffee","coat","coin","cold","collect","colour","comb","comfortable","common","compare","come","complete","computer","condition","continue","control","cook","cool","copper","corn","corner","correct","cost","contain","count","country","course","cover","crash","cross","cry","cup","cupboard","cut","dance","dangerous","dark","daughter","day","dead","decide","decrease","deep","deer","depend","desk","destroy","develop","die","different","difficult","dinner","direction","dirty","discover","dish","do","dog","door","double","down","draw","dream","dress","drink","drive","drop","dry","duck","dust","duty","each","ear","early","earn","earth","east","easy","eat","education","effect","egg","eight","either","electric","elephant","else","empty","end","enemy","enjoy","enough","enter","equal","entrance","escape","even","evening","event","ever","every","everyone","exact","everybody","examination","example","except","excited","exercise","expect","expensive","explain","extremely","eye","face","fact","fail","fall","false","family","famous","far","farm","father","fast","fat","fault","fear","feed","feel","female","fever","few","fight","fill","film","find","fine","finger","finish","fire","first","fish","fit","five","fix","flag","flat","float","floor","flour","flower","fly","fold","food","fool","foot","football","for","force","foreign","forest","forget","forgive","fork","form","fox","four","free","freedom","freeze","fresh","friend","friendly","from","front","fruit","full","fun","funny","furniture","further","future","game","garden","gate","general","gentleman","get","gift","give","glad","glass","go","goat","god","gold","good","goodbye","grandfather","grandmother","grass","grave","great","green","gray","ground","group","grow","gun","hair","half","hall","hammer","hand","happen","happy","hard","hat","hate","have","he","head","healthy","hear","heavy","heart","heaven","height","hello","help","hen","her","here","hers","hide","high","hill","him","his","hit","hobby","hold","hole","holiday","home","hope","horse","hospital","hot","hotel","house","how","hundred","hungry","hour","hurry","husband","hurt","I","ice","idea","if","important","in","increase","inside","into","introduce","invent","iron","invite","is","island","it","its","jelly","job","join","juice","jump","just","keep","key","kill","kind","king","kitchen","knee","knife","knock","know","ladder","lady","lamp","land","large","last","late","lately","laugh","lazy","lead","leaf","learn","leave","leg","left","lend","length","less","lesson","let","letter","library","lie","life","light","like","lion","lip","list","listen","little","live","lock","lonely","long","look","lose","lot","love","low","lower","luck","machine","main","make","male","man","many","map","mark","market","marry","matter","may","me","meal","mean","measure","meat","medicine","meet","member","mention","method","middle","milk","million","mind","minute","miss","mistake","mix","model","modern","moment","money","monkey","month","moon","more","morning","most","mother","mountain","mouth","move","much","music","must","my","name","narrow","nation","nature","near","nearly","neck","need","needle","neighbour","neither","net","never","new","news","newspaper","next","nice","night","nine","no","noble","noise","none","nor","north","nose","not","nothing","notice","now","number","obey","object","ocean","of","off","offer","office","often","oil","old","on","one","only","open","opposite","or","orange","order","other","our","out","outside","over","own","page","pain","paint","pair","pan","paper","parent","park","part","partner","party","pass","past","path","pay","peace","pen","pencil","people","pepper","per","perfect","period","person","petrol","photograph","piano","pick","picture","piece","pig","pin","pink","place","plane","plant","plastic","plate","play","please","pleased","plenty","pocket","point","poison","police","polite","pool","poor","popular","position","possible","potato","pour","power","present","press","pretty","prevent","price","prince","prison","private","prize","probably","problem","produce","promise","proper","protect","provide","public","pull","punish","pupil","push","put","queen","question","quick","quiet","quite","radio","rain","rainy","raise","reach","read","ready","real","really","receive","record","red","remember","remind","remove","rent","repair","repeat","reply","report","rest","restaurant","result","return","rice","rich","ride","right","ring","rise","road","rob","rock","room","round","rubber","rude","rule","ruler","run","rush","sad","safe","sail","salt","same","sand","save","say","school","science","scissors","search","seat","second","see","seem","sell","send","sentence","serve","seven","several","sex","shade","shadow","shake","shape","share","sharp","she","sheep","sheet","shelf","shine","ship","shirt","shoe","shoot","shop","short","should","shoulder","shout","show","sick","side","signal","silence","silly","silver","similar","simple","single","since","sing","sink","sister","sit","six","size","skill","skin","skirt","sky","sleep","slip","slow","small","smell","smile","smoke","snow","so","soap","sock","soft","some","someone","something","sometimes","son","soon","sorry","sound","soup","south","space","speak","special","speed","spell","spend","spoon","sport","spread","spring","square","stamp","stand","star","start","station","stay","steal","steam","step","still","stomach","stone","stop","store","storm","story","strange","street","strong","structure","student","study","stupid","subject","substance","successful","such","sudden","sugar","suitable","summer","sun","sunny","support","sure","surprise","sweet","swim","sword","table","take","talk","tall","taste","taxi","tea","teach","team","tear","telephone","television","tell","ten","tennis","terrible","test","than","that","the","their","then","there","therefore","these","thick","thin","thing","think","third","this","though","threat","three","tidy","tie","title","to","today","toe","together","tomorrow","tonight","too","tool","tooth","top","total","touch","town","train","tram","travel","tree","trouble","true","trust","twice","try","turn","type","ugly","uncle","under","understand","unit","until","up","use","useful","usual","usually","vegetable","very","village","voice","visit","wait","wake","walk","want","warm","was","wash","waste","watch","water","way","we","weak","wear","weather","wedding","week","weight","welcome","were","well","west","wet","what","wheel","when","where","which","while","white","who","why","wide","wife","wild","will","win","wind","window","wine","winter","wire","wise","wish","with","without","woman","wonder","word","work","world","worry","yard","yell","yesterday","yet","you","young","your","zero","zoo"];class ZxGame{constructor(){this.ai={bw:cz(),br:null,bz:[],da:[],db:null,dc:null,ah:"dd"},this.de=null,this.df=1e4,this.cm=null,this.dg=setInterval(()=>{this.dh().catch(a=>{console.error("Error in update loop",a)})},100),this.bg=null,this.dj=null}dk(a,b,c){for(const d of this.ai.bz)d!==c&&dm(d.ab,a,b)}async dh(){var a=Math.floor;switch(this.ai.ah){case"dd":this.df++,this.df>=this.ai.bz.length&&(this.df=0);const b=await dp();if(1===this.ai.bz.length&&0<b.length){this.ai.dc=null;const c=b[a(Math.random()*b.length)];this.de=c.as,this.cm=c.cm,this.ai.ah="dr"}else 0!==this.ai.bz.length&&(this.ai.dc=this.ai.bz[this.df],this.de=cy[a(Math.random()*cy.length)],dm(this.ai.dc.ab,"aw",{ba:this,as:this.de}),this.dk("bb",{ba:this,ax:this.ai.dc},this.ai.dc),this.ai.ds=1,this.ai.ah="dt",this.aq=5+this.de.length);break;case"dt":this.dk("aq",{aq:this.aq}),this.aq-=.1,0>=this.aq&&(this.ai.dc.ai.cb-=50,0>this.ai.dc.ai.cb&&(this.ai.dc.ai.cb=0),this.dk("bj",{ba:this}),this.ai.da.push(`${this.ai.dc.ai.br} took too long to draw!`),this.ai.ah="dd",this.dk("bk",{bl:this.ai.da.slice(-5).reverse()}));break;case"dr":this.bg=this.cm.length-1,this.dj=this.cm[this.bg].length-1,this.ai.ah="am";let c=0;for(const a of this.cm)c+=a.length;this.dw=Math.ceil(c/100),this.dk("am",{au:dx(this.cm)},this.ai.dc),this.ai.dc&&dm(this.ai.dc.ab,"bd",{au:dx(this.cm)});break;case"am":for(let a=0;a<this.dw;a++){if(this.dj--,0>this.dj){if(this.bg--,0>this.bg){this.ai.ah="dy",this.aq=5;break}this.dj=this.cm[this.bg].length-1}const a=this.cm[this.bg][this.dj];this.dk("be",{bg:this.cm.length-this.bg,be:a})}break;case"dy":this.dk("aq",{aq:this.aq}),this.aq-=.1,0>=this.aq&&(this.ai.dc&&(this.ai.dc.ai.cb-=75,0>this.ai.dc.ai.cb&&(this.ai.dc.ai.cb=0),this.dk("bj",{ba:this})),this.ai.da.push(`No one guessed the word in time. The word was ${this.de}!`),this.ai.ah="dd",this.dk("bk",{bl:this.ai.da.slice(-5).reverse()}));}}}class ZxPlayer{constructor(a){aj("Creating player",a.id),this.ai={bw:cz(),br:null,cb:0},this.ab=a,this.ba=null}}const ea={},bz=[],eb=[],av={bq(a,b){let c=b.br||"Player",d=1;for(const e of a.ba.ai.bz)(e.ai.br==c||e.ai.br==c+" "+d)&&d++;return 1<d&&(c=c+" "+d),a.ai.br=c,dm(a.ab,"bc",{}),a.ba.dk("bj",{ba:a.ba}),{ee:!0}},ce(a){const b=new ZxGame;return b.ai.bz.push(a),eb.push(b),a.ba=b,b},ef(a,b){const c=eb.find(a=>a.ai.bw===b.eg);if(c)return c.ai.bz.push(a),c.dk("bj",{ba:c}),a.ba=c,c},eh(){return eb},cj(a,b){const c=b.ch.trim().toLowerCase();c&&a.ba.ai.da.push(`${a.ai.br}: ${c}`),c==a.ba.de?(a.ba.ai.da.push(`${a.ai.br} guessed correctly, the word is ${a.ba.de}!`),a.ai.cb+=100,a.ba.ai.ah="dd"):(a.ai.cb-=5,0>a.ai.cb&&(a.ai.cb=0)),a.ba.dk("bj",{ba:a.ba}),a.ba.dk("bk",{bl:a.ba.ai.da.slice(-5).reverse()})},ei(){return cy[Math.floor(Math.random()*cy.length)]},async cl(a,b){if("dt"===a.ba.ai.ah&&a===a.ba.ai.dc){if(!b.length)return void(a.ba.ai.ah="dd");a.ba.cm=b,a.ba.ai.ah="dr";const c=await dp();c.unshift({as:a.ba.de,cm:b});let d="";for(const a of c){const b=el(a.cm),c=a.as+":"+b.length+":"+b+":";d.length+c.length<6656&&(d+=c)}await storage.set("savedWords",d,!1)}}},dx=a=>{let b=1e4,c=1e4,d=0,e=0;for(const f of a)for(const a of f)a[0]<b&&(b=a[0]),a[1]<c&&(c=a[1]),a[0]>d&&(d=a[0]),a[1]>e&&(e=a[1]);return`${b-5} ${c-5} ${d-b+10} ${e-c+10}`},el=a=>{let b="";for(const c of a){const a=String.fromCharCode.apply(null,Uint16Array.from(c.flat()));b+=a.length+":"+a+":"}return b},eu=a=>{const b=[];for(;0<a.length;){const c=a.indexOf(":"),d=parseInt(a.substr(0,c));a=a.substr(c+1);const e=a.substr(0,d);a=a.substr(d+1);const f=new ArrayBuffer(2*e.length),g=new Uint16Array(f);for(let a=0,b=e.length;a<b;a++)g[a]=e.charCodeAt(a);const h=[];for(let a=0;a<g.length;a+=2)h.push([g[a],g[a+1]]);b.push(h)}return b},dp=async()=>{let a=await storage.get("savedWords","",!1);const b=[];for(;0<a.length;){const c=a.indexOf(":"),d=a.substr(0,c);a=a.substr(c+1);const e=a.indexOf(":"),f=parseInt(a.substr(0,e));a=a.substr(e+1);const g=a.substr(0,f);a=a.substr(f+1),b.push({as:d,cm:eu(g)})}return b},fc=new ZxGame;eb.push(fc),module.exports={io:a=>{ea[a.id]=a;const b=new ZxPlayer(a);bz.push(b),fc.ai.bz.push(b),b.ba=fc,a.on("disconnect",()=>{fc.ai.bz=fc.ai.bz.filter(a=>b!=a),fc.dk("bj",{ba:fc}),delete ea[a.id]}),a.on("bs",bt(a,b))},stat:(a,b)=>{storage.get("games",0).then(a=>{b.send(`<h1>Games played: ${a}</h1>`)})}};