var GA=GA||{};GA.VERSION="0.0.1";GA.plugins=void 0;GA.custom=void 0;
GA.create=function(b,e,g,k,h){function l(){requestAnimationFrame(l,d.canvas);if(void 0===d._fps)p(),d.render(d.canvas,0);else{var a=Date.now(),c=a-d._startTime;1E3<c&&(c=d._frameDuration);d._startTime=a;for(d._lag+=c;d._lag>=d._frameDuration;)q(),p(),d._lag-=d._frameDuration;d.render(d.canvas,d._lag/d._frameDuration)}}function q(){function a(c){c._previousX=c.x;c._previousY=c.y;c.children&&0<c.children.length&&c.children.forEach(function(c){a(c)})}d.stage.children.forEach(function(c){a(c)})}function p(){if(0<
d.buttons.length){d.canvas.style.cursor="auto";for(var a=d.buttons.length-1;0<=a;a--){var c=d.buttons[a];c.update(d.pointer,d.canvas);"over"!==c.state&&"down"!==c.state||c.stage||(d.canvas.style.cursor="pointer")}}d.dragAndDrop&&d.pointer.updateDragAndDrop();d.state&&!d.paused&&d.state();if(0!==d.updateFunctions.length)for(a=0;a<d.updateFunctions.length;a++)(0,d.updateFunctions[a])()}function n(a){a.x=0;a.y=0;a.vx=0;a.vy=0;a.width=0;a.height=0;a.scaleX=1;a.scaleY=1;a.pivotX=.5;a.pivotY=.5;a.rotation=
0;a.visible=!0;a.parent=void 0;a.stage=!1;a.shadow=!1;a.shadowColor="rgba(100, 100, 100, 0.5)";a.shadowOffsetX=3;a.shadowOffsetY=3;a.shadowBlur=3;a.blendMode=void 0;a._alpha=1;a._draggable=void 0;a._layer=0;a._circular=!1;a._interactive=!1;a._previousX=void 0;a._previousY=void 0;a.children=[];a.addChild=function(c){c.parent&&c.parent.removeChild(c);c.parent=a;a.children.push(c)};a.removeChild=function(c){if(c.parent===a)a.children.splice(a.children.indexOf(c),1);else throw Error(c+"is not a child of "+
a);};a.swapChildren=function(c,b){var d=a.children.indexOf(c),f=a.children.indexOf(b);if(-1!==d&&-1!==f)c.childIndex=f,b.childIndex=d,a.children[d]=b,a.children[f]=c;else throw Error(child+" Both objects must be a child of the caller "+a);};a.add=function(c){var b=Array.prototype.slice.call(arguments);1<b.length?b.forEach(function(c){a.addChild(c)}):a.addChild(b[0])};a.remove=function(c){var b=Array.prototype.slice.call(arguments);1<b.length?b.forEach(function(c){a.removeChild(c)}):a.removeChild(b[0])};
a.setPosition=function(c,b){a.x=c;a.y=b};a.putCenter=function(c,b,d){c.x=a.x+a.halfWidth-c.halfWidth+(b||0);c.y=a.y+a.halfHeight-c.halfHeight+(d||0);a.compensateForParentPosition(a,c)};a.putTop=function(c,b,d){c.x=a.x+a.halfWidth-c.halfWidth+(b||0);c.y=a.y-c.height+(d||0);a.compensateForParentPosition(a,c)};a.putRight=function(c,b,d){c.x=a.x+a.width+(b||0);c.y=a.y+a.halfHeight-c.halfHeight+(d||0);a.compensateForParentPosition(a,c)};a.putBottom=function(c,b,d){c.x=a.x+a.halfWidth-c.halfWidth+(b||0);
c.y=a.y+a.height+(d||0);a.compensateForParentPosition(a,c)};a.putLeft=function(c,b,d){c.x=a.x-c.width+(b||0);c.y=a.y+a.halfHeight-c.halfHeight+(d||0);a.compensateForParentPosition(a,c)};a.compensateForParentPosition=function(a,b){if(0!==b.parent.gx||0!==b.parent.gy)b.x-=a.gx,b.y-=a.gy};Object.defineProperties(a,{gx:{get:function(){return this.parent?this.x+this.parent.gx:this.x},enumerable:!0,configurable:!0},gy:{get:function(){return this.parent?this.y+this.parent.gy:this.y},enumerable:!0,configurable:!0},
position:{get:function(){return{x:a.x,y:a.y}},enumerable:!0,configurable:!0},alpha:{get:function(){return a.parent._alpha*a._alpha},set:function(c){a._alpha=c},enumerable:!0,configurable:!0},halfWidth:{get:function(){return a.width/2},enumerable:!0,configurable:!0},halfHeight:{get:function(){return a.height/2},enumerable:!0,configurable:!0},centerX:{get:function(){return a.x+a.halfWidth},enumerable:!0,configurable:!0},centerY:{get:function(){return a.y+a.halfHeight},enumerable:!0,configurable:!0},
layer:{get:function(){return a._layer},set:function(c){a._layer=c;a.parent.children.sort(y)},enumerable:!0,configurable:!0},circular:{get:function(){return a._circular},set:function(c){!0===c&&!1===a._circular&&(u(a),a._circular=!0);!1===c&&!0===a._circular&&(delete a.diameter,delete a.radius,a._circular=!1)},enumerable:!0,configurable:!0},draggable:{get:function(){return a._draggable},set:function(c){!0===c&&(d.draggableSprites.push(a),a._draggable=!0,!1===d.dragAndDrop&&(d.dragAndDrop=!0));!1===
c&&d.draggableSprites.splice(d.draggableSprites.indexOf(a),1)},enumerable:!0,configurable:!0},interactive:{get:function(){return a._interactive},set:function(c){!0===c&&(w(a),a._interactive=!0);!1===c&&(d.buttons.splice(d.buttons.indexOf(a),1),a._interactive=!1)},enumerable:!0,configurable:!0},localBounds:{get:function(){return{x:0,y:0,width:a.width,height:a.height}},enumerable:!0,configurable:!0},globalBounds:{get:function(){return rectangle={x:a.gx,y:a.gy,width:a.gx+a.width,height:a.gy+a.height}},
enumerable:!0,configurable:!0},empty:{get:function(){return 0===a.children.length?!0:!1},enumerable:!0,configurable:!0}})}function u(a){Object.defineProperties(a,{diameter:{get:function(){return a.width},set:function(c){a.width=c;a.height=c},enumerable:!0,configurable:!0},radius:{get:function(){return a.width/2},set:function(c){a.width=2*c;a.height=2*c},enumerable:!0,configurable:!0}})}function w(a){a.press=a.press||void 0;a.release=a.release||void 0;a.over=a.over||void 0;a.out=a.out||void 0;a.tap=
a.tap||void 0;a.state="up";a.action="";a.pressed=!1;a.enabled=!0;a.hoverOver=!1;d.buttons.push(a);a.update=function(c,b){a.enabled&&(b=d.pointer.hitTestSprite(a),c.isUp&&(a.state="up","button"===a.subtype&&a.show(0)),b&&(a.state="over",a.frames&&3===a.frames.length&&"button"===a.subtype&&a.show(1),c.isDown&&(a.state="down","button"===a.subtype&&(3===a.frames.length?a.show(2):a.show(1)))),"down"!==a.state||a.pressed||(a.press&&a.press(),a.pressed=!0,a.action="pressed"),"over"===a.state&&(a.pressed&&
(a.release&&a.release(),a.pressed=!1,a.action="released",d.pointer.tapped&&a.tap&&a.tap()),a.hoverOver||(a.over&&a.over(),a.hoverOver=!0)),"up"===a.state&&(a.pressed&&(a.release&&a.release(),a.pressed=!1,a.action="released"),a.hoverOver&&(a.out&&a.out(),a.hoverOver=!1)))}}function r(a){var c={};c.code=a;c.isDown=!1;c.isUp=!0;c.press=void 0;c.release=void 0;c.downHandler=function(a){a.keyCode===c.code&&(c.isUp&&c.press&&c.press(),c.isDown=!0,c.isUp=!1);a.preventDefault()};c.upHandler=function(a){a.keyCode===
c.code&&(c.isDown&&c.release&&c.release(),c.isDown=!1,c.isUp=!0);a.preventDefault()};window.addEventListener("keydown",c.downHandler.bind(c),!1);window.addEventListener("keyup",c.upHandler.bind(c),!1);return c}function y(a,c){return a.layer<c.layer?-1:1}var d={};d.canvas=document.createElement("canvas");d.canvas.setAttribute("width",1*b);d.canvas.setAttribute("height",1*e);d.canvas.style.backgroundColor="black";document.body.appendChild(d.canvas);d.canvas.ctx=d.canvas.getContext("2d");d.stage=function(){var a=
{};n(a);a.stage=!0;a.width=d.canvas.width;a.height=d.canvas.height;a.x=0;a.y=0;a.parent=void 0;return a}();d.pointer=function(){var a={_x:0,_y:0};Object.defineProperties(a,{x:{get:function(){return a._x/d.scale},enumerable:!0,configurable:!0},y:{get:function(){return a._y/d.scale},enumerable:!0,configurable:!0},centerX:{get:function(){return a.x},enumerable:!0,configurable:!0},centerY:{get:function(){return a.y},enumerable:!0,configurable:!0},position:{get:function(){return{x:a.x,y:a.y}},enumerable:!0,
configurable:!0}});a.isDown=!1;a.isUp=!0;a.tapped=!1;a.downTime=0;a.elapsedTime=0;a.press=void 0;a.release=void 0;a.tap=void 0;a.dragSprite=null;a.dragOffsetX=0;a.dragOffsetY=0;a.moveHandler=function(c){a._x=c.pageX-c.target.offsetLeft;a._y=c.pageY-c.target.offsetTop;c.preventDefault()};a.touchmoveHandler=function(c){a._x=c.targetTouches[0].pageX-d.canvas.offsetLeft;a._y=c.targetTouches[0].pageY-d.canvas.offsetTop;c.preventDefault()};a.downHandler=function(c){a._x=c.pageX-c.target.offsetLeft;a._y=
c.pageY-c.target.offsetTop;a.isDown=!0;a.isUp=!1;a.tapped=!1;a.downTime=Date.now();a.press&&a.press();c.preventDefault()};a.touchstartHandler=function(c){a._x=c.targetTouches[0].pageX-d.canvas.offsetLeft;a._y=c.targetTouches[0].pageY-d.canvas.offsetTop;a.isDown=!0;a.isUp=!1;a.tapped=!1;a.downTime=Date.now();a.press&&a.press();c.preventDefault()};a.upHandler=function(c){a.elapsedTime=Math.abs(a.downTime-Date.now());200>=a.elapsedTime&&(a.tapped=!0,a.tap&&a.tap());a.isUp=!0;a.isDown=!1;a.release&&a.release();
c.preventDefault()};d.canvas.addEventListener("mousemove",a.moveHandler.bind(a),!1);d.canvas.addEventListener("mousedown",a.downHandler.bind(a),!1);window.addEventListener("mouseup",a.upHandler.bind(a),!1);d.canvas.addEventListener("touchmove",a.touchmoveHandler.bind(a),!1);d.canvas.addEventListener("touchstart",a.touchstartHandler.bind(a),!1);window.addEventListener("touchend",a.upHandler.bind(a),!1);d.canvas.style.touchAction="none";a.hitTestSprite=function(c){if(c.circular){var b=a.x-(c.gx+c.halfWidth),
d=a.y-(c.gy+c.halfHeight);c=Math.sqrt(b*b+d*d)<c.radius}else{b=c.gx+c.width;d=c.gy;var e=c.gy+c.height;c=a.x>c.gx&&a.x<b&&a.y>d&&a.y<e}return c};a.updateDragAndDrop=function(){if(a.isDown)if(null===a.dragSprite)for(var c=d.draggableSprites.length-1;-1<c;c--){var b=d.draggableSprites[c];if(b.draggable&&a.hitTestSprite(b)){a.dragOffsetX=a.x-b.gx;a.dragOffsetY=a.y-b.gy;a.dragSprite=b;c=b.parent.children;c.splice(c.indexOf(b),1);c.push(b);d.draggableSprites.splice(d.draggableSprites.indexOf(b),1);d.draggableSprites.push(b);
break}}else a.dragSprite.x=a.x-a.dragOffsetX,a.dragSprite.y=a.y-a.dragOffsetY;a.isUp&&(a.dragSprite=null);d.draggableSprites.some(function(c){if(c.draggable&&a.hitTestSprite(c))return d.canvas.style.cursor="pointer",!0;d.canvas.style.cursor="auto";return!1})};return a}();d.key=function(){var a={};a.leftArrow=r(37);a.upArrow=r(38);a.rightArrow=r(39);a.downArrow=r(40);a.space=r(32);return a}();d.buttons=[];d.dragAndDrop=!1;d.draggableSprites=[];d.tweens=[];d.state=void 0;d.load=h||void 0;d.setup=g||
void 0;if(void 0===d.setup)throw Error("Please supply the setup function in the constructor");d.assetFilePaths=k||void 0;d.paused=!1;d._fps=60;d._startTime=Date.now();d._frameDuration=1E3/d._fps;d._lag=0;d.interpolate=!0;d.updateFunctions=[];d.scale=1;d.start=function(){d.assetFilePaths?(d.assets.whenLoaded=function(){d.state=void 0;d.setup()},d.assets.load(d.assetFilePaths),d.load&&(d.state=d.load)):d.setup();l()};d.pause=function(){d.paused=!0};d.resume=function(){d.paused=!1};d.hidePointer=function(){d.canvas.style.cursor=
"none"};d.showPointer=function(){d.canvas.style.cursor="auto"};Object.defineProperties(d,{fps:{get:function(){return d._fps},set:function(a){d._fps=a;d._startTime=Date.now();d._frameDuration=1E3/d._fps},enumerable:!0,configurable:!0},backgroundColor:{set:function(a){d.canvas.style.backgroundColor=a},enumerable:!0,configurable:!0}});d.remove=function(a){var c=Array.prototype.slice.call(arguments);if(c[0]instanceof Array){if(c=c[0],0<c.length)for(var b=c.length-1;0<=b;b--){var d=c[b];d.parent.removeChild(d);
c.splice(c.indexOf(d),1)}}else 1<c.length?c.forEach(function(a){a.parent.removeChild(a)}):c[0].parent.removeChild(c[0])};d.group=function(a){var c={};n(c);c.addChild=function(a){a.parent&&a.parent.removeChild(a);a.parent=c;c.children.push(a);c.calculateSize()};c.removeChild=function(a){if(a.parent===c)c.children.splice(c.children.indexOf(a),1);else throw Error(a+"is not a child of "+c);c.calculateSize()};c.calculateSize=function(){0<c.children.length&&(c._newWidth=0,c._newHeight=0,c.children.forEach(function(a){a.x+
a.width>c._newWidth&&(c._newWidth=a.x+a.width);a.y+a.height>c._newHeight&&(c._newHeight=a.y+a.height)}),c.width=c._newWidth,c.height=c._newHeight)};d.stage.addChild(c);a&&Array.prototype.slice.call(arguments).forEach(function(a){c.addChild(a)});return c};d.rectangle=function(a,c,b,e,g,t,z){var f={};n(f);f.mask=!1;f.width=a||32;f.height=c||32;f.fillStyle=b||"red";f.strokeStyle=e||"none";f.lineWidth=g||0;f.x=t||0;f.y=z||0;d.stage.addChild(f);f.render=function(a){a.strokeStyle=f.strokeStyle;a.lineWidth=
f.lineWidth;a.fillStyle=f.fillStyle;a.beginPath();a.rect(-f.width*f.pivotX,-f.height*f.pivotY,f.width,f.height);!0===f.mask?a.clip():("none"!==f.strokeStyle&&a.stroke(),"none"!==f.fillStyle&&a.fill())};return f};d.circle=function(a,c,b,e,g,t){var f={};n(f);f.mask=!1;f.width=a||32;f.height=a||32;f.fillStyle=c||"red";f.strokeStyle=b||"none";f.lineWidth=e||"none";f.x=g||0;f.y=t||0;d.stage.addChild(f);u(f);f.render=function(a){a.strokeStyle=f.strokeStyle;a.lineWidth=f.lineWidth;a.fillStyle=f.fillStyle;
a.beginPath();a.arc(f.radius+-f.diameter*f.pivotX,f.radius+-f.diameter*f.pivotY,f.radius,0,2*Math.PI,!1);!0===f.mask?a.clip():("none"!==f.strokeStyle&&a.stroke(),"none"!==f.fillStyle&&a.fill())};return f};d.line=function(a,c,b,e,g,t){var f={};n(f);b||0===b||(b=0);e||0===e||(e=0);g||0===g||(g=32);t||0===t||(t=32);f.ax=b;f.ay=e;f.bx=g;f.by=t;f.strokeStyle=a||"red";f.lineWidth=c||1;f.lineJoin="round";d.stage.addChild(f);f.render=function(a){a.strokeStyle=f.strokeStyle;a.lineWidth=f.lineWidth;a.lineJoin=
f.lineJoin;a.beginPath();a.moveTo(f.ax,f.ay);a.lineTo(f.bx,f.by);"none"!==f.strokeStyle&&a.stroke();"none"!==f.fillStyle&&a.fill()};return f};d.text=function(a,c,b,e,g){var f={};n(f);f.content=a||"Hello!";f.font=c||"12px sans-serif";f.fillStyle=b||"red";f.textBaseline="top";Object.defineProperties(f,{width:{get:function(){return d.canvas.ctx.measureText(f.content).width},enumerable:!0,configurable:!0},height:{get:function(){return d.canvas.ctx.measureText("M").width},enumerable:!0,configurable:!0}});
d.stage.addChild(f);f.x=e||0;f.y=g||0;f.render=function(a){a.strokeStyle=f.strokeStyle;a.lineWidth=f.lineWidth;a.fillStyle=f.fillStyle;0===f.width&&(f.width=a.measureText(f.content).width);0===f.height&&(f.height=a.measureText("M").width);a.translate(-f.width*f.pivotX,-f.height*f.pivotY);a.font=f.font;a.textBaseline=f.textBaseline;a.fillText(f.content,0,0)};return f};d.frame=function(a,c,b,d,e){var f={};f.image=a;f.x=c;f.y=b;f.width=d;f.height=e;return f};d.frames=function(a,c,b,d){var f={};f.image=
a;f.data=c;f.width=b;f.height=d;return f};d.filmstrip=function(a,c,b,e){var f=d.assets[a].source,g=[],h=f.width/c;f=f.height/b*h;for(var k=0;k<f;k++){var l=k%h*c;var v=Math.floor(k/h)*b;e&&0<e&&(l+=e+e*k%h,v+=e+e*Math.floor(k/h));g.push([l,v])}return d.frames(a,g,c,b)};d.sprite=function(a){var c={};if(void 0===a)throw Error("Sprites require a source");n(c);c.frames=[];c.loop=!0;c._currentFrame=0;c.setTexture=function(a){if(a.image)if(a.image&&!a.data){if(!(d.assets[a.image].source instanceof Image))throw Error(a.image+
" is not an image file");c.source=d.assets[a.image].source;c.sourceX=a.x;c.sourceY=a.y;c.width=a.width;c.height=a.height;c.sourceWidth=a.width;c.sourceHeight=a.height}else a.image&&a.data&&(c.source=d.assets[a.image].source,c.frames=a.data,c.sourceX=c.frames[0][0],c.sourceY=c.frames[0][1],c.width=a.width,c.height=a.height,c.sourceWidth=a.width,c.sourceHeight=a.height);else a instanceof Array?(c.frames=a,c.source=d.assets[a[0]].source,c.sourceX=d.assets[a[0]].frame.x,c.sourceY=d.assets[a[0]].frame.y,
c.width=d.assets[a[0]].frame.w,c.height=d.assets[a[0]].frame.h,c.sourceWidth=d.assets[a[0]].frame.w,c.sourceHeight=d.assets[a[0]].frame.h):(c.tilesetFrame=d.assets[a],c.source=c.tilesetFrame.source,c.sourceX=c.tilesetFrame.frame.x,c.sourceY=c.tilesetFrame.frame.y,c.width=c.tilesetFrame.frame.w,c.height=c.tilesetFrame.frame.h,c.sourceWidth=c.tilesetFrame.frame.w,c.sourceHeight=c.tilesetFrame.frame.h)};c.setTexture(a);c.gotoAndStop=function(a){if(0<c.frames.length)c.frames[0]instanceof Array?(c.sourceX=
c.frames[a][0],c.sourceY=c.frames[a][1]):d.assets[c.frames[a]].frame&&(c.source=d.assets[c.frames[a]].source,c.sourceX=d.assets[c.frames[a]].frame.x,c.sourceY=d.assets[c.frames[a]].frame.y,c.sourceWidth=d.assets[c.frames[a]].frame.w,c.sourceHeight=d.assets[c.frames[a]].frame.h,c.width=d.assets[c.frames[a]].frame.w,c.height=d.assets[c.frames[a]].frame.h),c._currentFrame=a;else throw Error("Frame number "+a+"doesn't exist");};c.x=0;c.y=0;0<c.frames.length&&(d.addStatePlayer(c),Object.defineProperty(c,
"currentFrame",{get:function(){return c._currentFrame},enumerable:!1,configurable:!1}));d.stage.addChild(c);c.render=function(a){a.drawImage(c.source,c.sourceX,c.sourceY,c.sourceWidth,c.sourceHeight,-c.width*c.pivotX,-c.height*c.pivotY,c.width,c.height)};return c};d.button=function(a){a=d.sprite(a);a.subtype="button";w(a);return a};d.image=function(a){return d.assets[a]};d.json=function(a){return d.assets[a]};d.addStatePlayer=function(a){function c(c){d();h=c[0];k=c[1];g=k-h;0===h&&(g+=1,e+=1);1===
g&&(g=2,e+=1);a.fps||(a.fps=12);c=1E3/a.fps;a.gotoAndStop(h);n||(l=setInterval(b.bind(this),c),n=!0)}function b(){e<g?(a.gotoAndStop(a.currentFrame+1),e+=1):a.loop&&(a.gotoAndStop(h),e=1)}function d(){void 0!==l&&!0===n&&(n=!1,g=k=h=e=0,clearInterval(l))}var e=0,g=0,h=0,k=0,l=void 0,n=!1;a.show=function(c){d();"string"!==typeof c?a.gotoAndStop(c):a.gotoAndStop(a.frames.indexOf(c))};a.play=function(){c([0,a.frames.length-1])};a.stop=function(){d();a.gotoAndStop(a.currentFrame)};a.playing=n;a.playSequence=
c};d.render=function(a,c){function b(f){if(f.visible&&f.gx<a.width+f.width&&f.gx+f.width>=-f.width&&f.gy<a.height+f.height&&f.gy+f.height>=-f.height){e.save();d.interpolate?(f.renderX=void 0!==f._previousX?(f.x-f._previousX)*c+f._previousX:f.x,f.renderY=void 0!==f._previousY?(f.y-f._previousY)*c+f._previousY:f.y):(f.renderX=f.x,f.renderY=f.y);e.translate(f.renderX+f.width*f.pivotX,f.renderY+f.height*f.pivotY);e.globalAlpha=f.alpha;e.rotate(f.rotation);e.scale(f.scaleX,f.scaleY);f.shadow&&(e.shadowColor=
f.shadowColor,e.shadowOffsetX=f.shadowOffsetX,e.shadowOffsetY=f.shadowOffsetY,e.shadowBlur=f.shadowBlur);f.blendMode&&(e.globalCompositeOperation=f.blendMode);f.render&&f.render(e);if(f.children&&0<f.children.length){e.translate(-f.width*f.pivotX,-f.height*f.pivotY);for(var g=0;g<f.children.length;g++)b(f.children[g])}e.restore()}}var e=a.ctx;e.clearRect(0,0,a.width,a.height);for(var g=0;g<d.stage.children.length;g++)b(d.stage.children[g])};d.assets={toLoad:0,loaded:0,imageExtensions:["bmp","png",
"jpg","gif","webp"],fontExtensions:["ttf","otf","ttc","woff"],audioExtensions:["mp3","ogg","wav","webm"],jsonExtensions:["json"],whenLoaded:void 0,load:function(a){console.log("Loading assets...");var c=this;c.toLoad=a.length;a.forEach(function(a){var b=a.split(".").pop();if(-1!==c.imageExtensions.indexOf(b)){var e=new Image;e.addEventListener("load",function(){e.name=a;c[e.name]={source:e,frame:{x:0,y:0,w:e.width,h:e.height}};c.loadHandler()},!1);e.src=a}else if(-1!==c.fontExtensions.indexOf(b)){b=
a.split("/").pop().split(".")[0];var f=document.createElement("style");f.appendChild(document.createTextNode("@font-face {font-family: '"+b+"'; src: url('"+a+"');}"));document.head.appendChild(f);c.loadHandler()}else if(-1!==c.audioExtensions.indexOf(b))b=d.makeSound(a,c.loadHandler.bind(c)),b.name=a,c[b.name]=b;else if(-1!==c.jsonExtensions.indexOf(b)){var g=new XMLHttpRequest,h={};g.open("GET",a,!0);g.addEventListener("readystatechange",function(){200===g.status&&4===g.readyState&&(h=JSON.parse(g.responseText),
h.name=a,c[h.name]=h,h.frames?c.createTilesetFrames(h,a):c.loadHandler())});g.send()}else console.log("File type not recognized: "+a)})},createTilesetFrames:function(a,c){var b=this,d=c.replace(/[^\/]*$/,""),e=new Image;e.addEventListener("load",function(){b[d+a.meta.image]={source:e,frame:{x:0,y:0,w:e.width,h:e.height}};Object.keys(a.frames).forEach(function(c){b[c]=a.frames[c];b[c].source=e});b.loadHandler()},!1);e.src=d+a.meta.image},loadHandler:function(){this.loaded+=1;console.log(this.loaded);
this.toLoad===this.loaded&&(this.loaded=this.toLoad=0,this.whenLoaded())}};d.keyboard=r;d.makeDisplayObject=n;void 0!==GA.plugins&&GA.plugins(d);void 0!==GA.custom&&GA.custom(d);return d};window.ga=GA.create;GA=GA||{};
GA.plugins=function(b){b.move=function(b){if(!1===b instanceof Array)b.x+=b.vx|0,b.y+=b.vy|0;else for(var e=0;e<b.length;e++){var k=b[e];k.x+=k.vx|0;k.y+=k.vy|0}};b.distance=function(b,g){var e=g.centerX-b.centerX;b=g.centerY-b.centerY;return Math.sqrt(e*e+b*b)};b.scaleToWindow=function(e){var g=Math.min(window.innerWidth/b.canvas.width,window.innerHeight/b.canvas.height);b.canvas.style.transformOrigin="0 0";b.canvas.style.transform="scale("+g+")";var k=b.canvas.width>b.canvas.height?b.canvas.width*
g<window.innerWidth?"horizontally":"vertically":b.canvas.height*g<window.innerHeight?"vertically":"horizontally";if("horizontally"===k){var h=(window.innerWidth-b.canvas.width*g)/2;b.canvas.style.marginLeft=h+"px";b.canvas.style.marginRight=h+"px"}"vertically"===k&&(h=(window.innerHeight-b.canvas.height*g)/2,b.canvas.style.marginTop=h+"px",b.canvas.style.marginBottom=h+"px");b.canvas.style.paddingLeft=0;b.canvas.style.paddingRight=0;b.canvas.style.paddingTop=0;b.canvas.style.paddingBottom=0;b.canvas.style.display=
"block";document.body.style.backgroundColor=e||"#2C3539";b.pointer.scale=g;b.scale=g;b.canvas.scaled=!0;e=navigator.userAgent.toLowerCase();-1==e.indexOf("safari")||-1<e.indexOf("chrome")||(b.canvas.style.maxHeight="100%",b.canvas.style.minHeight="100%")};b.particles=[];b.particleEffect=function(e,g,k,h,l,q,p,n,u,w,r,y,d,a,c,f,v,A){function t(h){var m=k();0<m.frames.length&&m.gotoAndStop(Math.floor(Math.random()*(m.frames.length-1+1))+0);m.x=e-m.halfWidth;m.y=g-m.halfHeight;var n=Math.floor(Math.random()*
(w-u+1))+u;m.width=n;m.height=n;m.scaleSpeed=d+Math.random()*(a-d);m.alphaSpeed=c+Math.random()*(f-c);m.rotationSpeed=v+Math.random()*(A-v);n=r+Math.random()*(y-r);m.vx=n*Math.cos(h);m.vy=n*Math.sin(h);m.updateParticle=function(){m.vy+=l;m.x+=m.vx;m.y+=m.vy;0<m.scaleX-m.scaleSpeed&&(m.scaleX-=m.scaleSpeed);0<m.scaleY-m.scaleSpeed&&(m.scaleY-=m.scaleSpeed);m.rotation+=m.rotationSpeed;m.alpha-=m.alphaSpeed;0>=m.alpha&&(b.remove(m),b.particles.splice(b.particles.indexOf(m),1))};b.particles.push(m)}void 0===
e&&(e=0);void 0===g&&(g=0);void 0===k&&(k=function(){return b.circle(10,"red")});void 0===h&&(h=10);void 0===l&&(l=0);void 0===q&&(q=!0);void 0===p&&(p=0);void 0===n&&(n=6.28);void 0===u&&(u=4);void 0===w&&(w=16);void 0===r&&(r=.1);void 0===y&&(y=1);void 0===d&&(d=.01);void 0===a&&(a=.05);void 0===c&&(c=.02);void 0===f&&(f=.02);void 0===v&&(v=.01);void 0===A&&(A=.03);for(var z=[],x,C=(n-p)/(h-1),B=0;B<h;B++)q?(x=p+Math.random()*(n-p),z.push(x)):(void 0===x&&(x=p),z.push(x),x+=C);z.forEach(function(a){t(a)})};
b.updateParticles=function(){if(0<b.particles.length)for(var e=b.particles.length-1;0<=e;e--)b.particles[e].updateParticle()};b.updateFunctions.push(b.updateParticles);b.emitter=function(b,g){function e(){g()}var h={},l=void 0;h.playing=!1;h.play=function(){h.playing||(g(),l=setInterval(e.bind(this),b),h.playing=!0)};h.stop=function(){h.playing&&(clearInterval(l),h.playing=!1)};return h};b.hitTestPoint=function(b,g){var e=g.radius?"circle":"rectangle";if("rectangle"===e){var h=g.x;var l=g.x+g.width;
var q=g.y;var p=g.y+g.height;h=b.x>h&&b.x<l&&b.y>q&&b.y<p}"circle"===e&&(e=b.x-g.centerX,b=b.y-g.centerY,b=Math.sqrt(e*e+b*b),h=b<g.radius);return h};b.hitTestRectangle=function(b,g,k){void 0===k&&(k=!1);if(k){var e=b.gx+b.halfWidth-(g.gx+g.halfWidth);var l=b.gy+b.halfHeight-(g.gy+g.halfHeight)}else e=b.centerX-g.centerX,l=b.centerY-g.centerY;k=b.halfWidth+g.halfWidth;b=b.halfHeight+g.halfHeight;return Math.abs(e)<k?Math.abs(l)<b?!0:!1:!1}};"use strict";
var ga=ga(480,448,load,"player.bmp platform_on.bmp platform_off.bmp spikes.bmp spikes2.bmp small_spikes.bmp small_spikes2.bmp".split(" ")),levels=[{t:"##########################################################################################################################################....#....####...#.....#...################",l:["Hello. Press left and right arrow keys to move.","Press up arrow key to jump."],f:function(){map.startPos={x:1,y:10};createDoor(13,10)}},{t:"##########################################################################################################.............#####..........####...#...#...##............#################",
l:["",""],f:function(){map.startPos={x:1,y:10};createDoor(1,7)}},{t:"##########################################################################################################.............#####.#.#......##.........#...##............#################",l:["You can turn the whole system on or off","by pressing the space bar."],f:function(){map.startPos={x:1,y:10};createDoor(1,7);createLaserV(5,7,1);createLaserV(7,7,1);createLaserV(10,7,2)}},{t:"########################################....###########...############....##.............##.............##......#......##.............##.............##.............################",
l:["Platforms move when the power is on.","Turn the power off to stop them."],f:function(){map.startPos={x:1,y:10};createDoor(13,2);createLaserV(9,5,6);createPlatformV(3,9,7);createPlatformV(11,7,2)}},{t:"################################################...........##.............####.........####.............##.......##....####.........####...........####...........##################",l:["Beware of the spikes! They will kill you on the slightest touch.","Turning the power off won't stop them from hurting you."],
f:function(){map.startPos={x:1,y:10};createDoor(1,4);createLaserV(2,4,1);createLaserV(2,6,2);createLaserV(12,6,2);createLaserV(12,3,2);createPlatformV(3,10,7);createPlatformH(6,11,8);createPlatformV(11,7,4);createPlatformH(9,3,4);createGroundSpikes(8,6);createGroundSpikes(9,6)}},{t:"################.........#.####....####.#.####.....###...####.....###...#####....###.#.####.....###...####.....###...####....####.#.####.....###...####.....###.....################",l:["",""],f:function(){map.startPos=
{x:1,y:10};createDoor(13,10);createLaserH(1,7,5);createLaserH(1,4,5);createLaserH(1,1,9);createLaserV(10,3,2);createLaserV(10,6,2);createLaserV(10,9,2);createLaserH(9,5,1);createLaserH(11,8,1);createPlatformV(3,10,2);createPlatformV(9,10,2);createPlatformV(11,10,2)}},{t:"################...#...###...##.......###..###...###.###...##...#...###...##...#...###...##...#...###...##...#.#####...##...#.........##...#.........##...#...###...################",l:["",""],f:function(){map.startPos={x:1,y:9};createDoor(13,
1);createLaserV(4,2,1);createLaserV(9,8,2);createLaserH(5,7,1);createLaserH(7,3,1);createPlatformV(1,10,1);createPlatformV(2,10,1);createPlatformV(3,10,1);createPlatformV(12,9,1);createCeilingSpikes(1,1);createCeilingSpikes(2,1);createCeilingSpikes(3,1);createGroundSpikes(5,10);createGroundSpikes(6,10);createGroundSpikes(7,10);createGroundSpikes(11,10);createGroundSpikes(12,10);createGroundSpikes(13,10);createSmallGroundSpikes(6,2);createSmallGroundSpikes(6,6);createSmallGroundSpikes(7,6)}},{t:"################XXX#XXX########...#...########...#...#XXX#.##...#.......#.##...#...###.#.##...#...#...#.##.......#.###.##...#...#.....##...#...#.....##...#YYY#YYYYY################",
l:["",""],f:function(){map.startPos={x:1,y:10};createDoor(13,3);createLaserV(4,7,1);createLaserV(8,4,1);createLaserV(10,6,1);createPlatformV(2,10,1);createPlatformV(5,1,10,1);createPlatformV(6,1,10,1);createPlatformV(7,1,10,1);createPlatformH(9,11,9);createPlatformV(13,9,4);createCeilingSpikes(1,1);createCeilingSpikes(2,1);createCeilingSpikes(3,1);createCeilingSpikes(5,1);createCeilingSpikes(6,1);createCeilingSpikes(7,1);createGroundSpikes(5,10);createGroundSpikes(6,10);createGroundSpikes(7,10);createGroundSpikes(9,
10);createGroundSpikes(10,10);createGroundSpikes(11,10);createGroundSpikes(12,10);createGroundSpikes(13,10)}},{t:"##########################################################################################################.............##.............##..........<#.##..YYYYYYYYY#.################",l:["",""],f:function(){map.startPos={x:1,y:10};createDoor(13,10);createLaserH(1,9,11);createPlatformH(3,7,9);createPlatformH(9,11,9);for(var b=0;9>b;b++)createSmallGroundSpikes(3+b,10)}},{t:"################.............###............###YYYYYYYYYYY.##############.##...x...x...x.##.y...y...y...##.##############.............##YYYYYY.YYYYYY########.######################",
l:["",""],f:function(){map.startPos={x:1,y:1};createDoor(7,10);createLaserV(5,1,3);createLaserV(9,1,3);createPlatformH(2,4,2);createPlatformH(6,9,2);createPlatformH(10,13,2);createPlatformH(1,13,8);for(var b=0;11>b;b++)createGroundSpikes(2+b,3);for(b=0;3>b;b++)createSmallCeilingSpikes(12-4*b,5);for(b=0;3>b;b++)createSmallGroundSpikes(10-4*b,6);for(b=0;6>b;b++)createGroundSpikes(1+b,9);for(b=0;6>b;b++)createGroundSpikes(8+b,9)}}],time,deaths,playing,level=-1,map,titleLabel=[],levelLabel=[],endLabel=
[],player,playerSpeedMax=5,gravity=4,jumpSteps=12,jumpSpeed=48/jumpSteps,sysOn=!0;ga.start();ga.fps=60;function load(){ga.backgroundColor="#d0d0d0";ga.state=nop;playing=!1;for(var b=["Welcome test unit 478.","Your task is to reach a portal","represented by white square on each floor.","Try not to get destroyed while doing so. Good luck!","Press space to proceed."],e=0,g=b.length;e<g;e++)titleLabel[e]=centeredLabel(b[e],"16px serif","black",45+45*e);setupTitleControls()}
function startGame(){for(var b=0,e=titleLabel.length;b<e;b++)ga.stage.removeChild(titleLabel[b]);playing=!0;deaths=time=0;ga.state=game;player=createPlayer();b=0;for(e=2;b<e;b++)levelLabel[b]=ga.text("","15px serif","white",2,392+32*b);setupPlayerControls();nextLevel()}function clear(){ga.stage.removeChild(map);ga.stage.removeChild(map.doors);ga.stage.removeChild(map.lasers);ga.stage.removeChild(map.platforms);ga.stage.removeChild(map.spikes)}
function centeredLabel(b,e,g,k){b=ga.text(b,e,g,1,k);ga.canvas.ctx.font=e;b.x=.5*(ga.stage.width-b.width);return b}
function endGame(){playing=!1;clear();ga.stage.removeChild(player);for(var b=0,e=levelLabel.length;b<e;b++)ga.stage.removeChild(levelLabel[b]);var g=["Thanks for playing!","Your time was: "+time.toFixed(2)+"s","You died: "+deaths+" times","Refresh page to play again."],k=sysOn?"black":"white";b=0;for(e=g.length;b<e;b++)endLabel[b]=centeredLabel(g[b],"21px serif",k,45+45*b);ga.state=nop}
function nextLevel(){level++;var b=levels[level];if(!b)return endGame();map&&clear();map=createMap(b.t,15,12,32,32);for(var e=0,g=b.l.length;e<g;e++)levelLabel[e].content=b.l[e];b.f();resetPlayer(player);switchSys(!0)}function createTile(b,e,g,k){var h=ga.rectangle(b-1,e-1,"","",1,g,k);h.renderOrg=h.render;h.render=function(b){h.fillStyle=sysOn?"#e7e7e7":"#0f0f0f";h.strokeStyle=sysOn?"#e0e0e0":"#000000";h.renderOrg(b)};return h}
function createMap(b,e,g,k,h){for(var l=ga.group(),q=0,p=e*g;q<p;q++){var n=q%e*k,u=Math.floor(q/e)*h;"#"==b[q]&&(n=createTile(k,h,n,u),l.addChild(n))}l.lasers=ga.group();l.platforms=ga.group();l.spikes=ga.group();l.startPos={x:1,y:1};l.tiles=b;l.nx=e;l.ny=g;l.tx=k;l.ty=h;l.htx=k/2;l.hty=h/2;l.isWall=function(b,e){b=this.getTileXY(b,e);return"#"==this.tiles[b.y*this.nx+b.x]};l.getTileXY=function(b,e){return{x:Math.floor(b/this.tx),y:Math.floor(e/this.ty)}};l.getX=function(b){return b*this.tx};l.getY=
function(b){return b*this.ty};return l}function createPlayer(){var b=ga.sprite("player.bmp");b.standing=!1;b.jumping=0;b.platforming=void 0;return b}function resetPlayer(b){b.setPosition(map.getX(map.startPos.x),map.getY(map.startPos.y));b.standing=!1;b.platforming=void 0;b.jumping=0}function killPlayer(b){resetPlayer(b);deaths+=1}function createLaserV(b,e,g){b=ga.rectangle(3,map.ty*g,"red","orange",1,map.getX(b)+map.htx,map.getY(e));map.lasers.addChild(b);return b}
function createLaserH(b,e,g){b=ga.rectangle(map.tx*g,3,"red","orange",1,map.getX(b),map.getY(e)+map.hty);map.lasers.addChild(b);return b}function createPlatformV(b,e,g,k){var h=ga.sprite("platform_on.bmp");map.platforms.addChild(h);h.x=map.getX(b);h.ty0=e;h.ty1=g;h.dt=k||0;h.platformType="v";return h}function createPlatformH(b,e,g,k){var h=ga.sprite("platform_on.bmp");map.platforms.addChild(h);h.y=map.getY(g+1);h.tx0=b;h.tx1=e;h.dt=k||0;h.platformType="h";return h}
function createDoor(b,e){b=ga.rectangle(map.tx-2,map.ty-2,"azure","grey",1,map.getX(b),map.getY(e));map.doors=b}function createGroundSpikes(b,e){var g=ga.sprite("spikes.bmp");g.x=map.getX(b);g.y=map.getY(e)+6;map.spikes.addChild(g)}function createCeilingSpikes(b,e){var g=ga.sprite("spikes2.bmp");g.x=map.getX(b);g.y=map.getY(e);map.spikes.addChild(g)}function createSmallGroundSpikes(b,e){var g=ga.sprite("small_spikes.bmp");g.x=map.getX(b)+3;g.y=map.getY(e)+20;map.spikes.addChild(g)}
function createSmallCeilingSpikes(b,e){var g=ga.sprite("small_spikes2.bmp");g.x=map.getX(b)+3;g.y=map.getY(e);map.spikes.addChild(g)}
function switchSys(b){sysOn=b;map.lasers.visible=sysOn;ga.backgroundColor=b?"#d0d0d0":"#4d4d4d";for(var e=0,g=map.platforms.children.length;e<g;e++)map.platforms.children[e].setTexture(b?"platform_on.bmp":"platform_off.bmp");e=0;for(g=levelLabel.length;e<g;e++)levelLabel[e].fillStyle=b?"black":"white";if(!playing)for(e=0,g=endLabel.length;e<g;e++)endLabel[e].fillStyle=b?"black":"white"}function setupTitleControls(){ga.key.space.press=function(){startGame()}}
function setupPlayerControls(){ga.key.upArrow.press=function(){0==player.jumping&&(player.standing||player.platforming)&&(player.jumping=jumpSteps,player.standing=!1)};ga.key.rightArrow.press=function(){player.vx=playerSpeedMax};ga.key.rightArrow.release=function(){ga.key.leftArrow.isDown||(player.vx=0)};ga.key.leftArrow.press=function(){player.vx=-playerSpeedMax};ga.key.leftArrow.release=function(){ga.key.rightArrow.isDown||(player.vx=0)};ga.key.space.press=function(){switchSys(!sysOn)}}
function isStandingOnPlatform(b,e){if(!e)return!1;var g=b.centerX,k=b.centerY;e={x:e.x,y:e.y-b.halfHeight,width:e.width,height:b.halfHeight+2*e.height};var h={x:g+b.halfWidth/2,y:k+b.halfHeight};return ga.hitTestPoint({x:g-b.halfWidth/2,y:k+b.halfHeight},e,!1)||ga.hitTestPoint(h,e,!1)}
function getPlatform(b){for(var e=isStandingOnPlatform(b,b.platforming)?b.platforming:void 0,g=0,k=map.platforms.children.length;g<k;g++){var h=map.platforms.children[g];e&&(h.y>e.y||0<h.dir)||isStandingOnPlatform(b,h)&&(e=h)}return e}
function movePlayer(b){ga.move(b);var e=map.getTileXY(b.centerX,b.centerY),g=b.centerX,k=b.centerY,h=map.tx/3;b.platforming=getPlatform(b);if(0>b.vx){if(map.isWall(g-map.htx,k)){var l=map.getX(e.x);b.x=l}}else 0<b.vx&&map.isWall(g+map.htx,k)&&(l=map.getX(e.x),b.x=l);if(0<b.vy)if(b.standing=!1,b.platforming)b.y+b.height>b.platforming.y&&(b.y=b.platforming.y-b.height,b.jumping=0,b.standing=!0);else{if(map.isWall(g-h,k+map.hty)||map.isWall(g+h,k+map.hty))e=map.getY(e.y),b.y=e,b.jumping=0,b.standing=
!0}else 0>b.vy&&map.isWall(g,k-map.hty)&&(e=map.getY(e.y),b.y=e,b.jumping=0)}function movePlatform(b){b.dt+=.02;b.delta=Math.cos(b.dt);var e=1-(b.delta+1)/2;"v"==b.platformType?(b.y=map.getY(b.ty0*(1-e)+b.ty1*e+1),b.dir=(b.ty1-b.ty0)*Math.cos(b.dt)):"h"==b.platformType&&(b.x=map.getX(b.tx0*(1-e)+b.tx1*e),b.dir=(b.tx1-b.tx0)*Math.cos(b.dt))}function checkNextLevel(b){return ga.distance(b,map.doors)<map.htx?(nextLevel(),!0):!1}
function checkDead(b){if(sysOn)for(var e=0,g=map.lasers.children.length;e<g;e++){var k=ga.hitTestRectangle(b,map.lasers.children[e],!0);if(k)return!0}e=0;for(g=map.spikes.children.length;e<g;e++)if(k=ga.hitTestRectangle(b,map.spikes.children[e],!1))return!0;return!1}
function update(){0<player.jumping?(player.vy=-jumpSpeed,player.jumping--):player.vy=gravity;if(sysOn)for(var b=0,e=map.platforms.children.length;b<e;b++)movePlatform(map.platforms.children[b]);movePlayer(player);checkNextLevel(player)||checkDead(player)&&killPlayer(player)}function nop(){}function game(){time+=1/ga.fps;update()};
