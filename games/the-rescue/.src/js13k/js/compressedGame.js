function setPlayerDefaultValues(){player={x:50,y:50,speed:2,keyDown_left:!1,keyDown_up:!1,keyDown_right:!1,keyDown_down:!1,keyDown_space:!1,keyDown_r:!1,keyDown_enter:!1,seen:!1}}function showStartScreen(){setPlayerDefaultValues();menuInterval=setInterval(updateStartScreen,1e3/60)}function updateStartScreen(){clearScreen(),"menu"==CURRENT_STATE&&showMenuOptions(),"controls"==CURRENT_STATE&&showControls(),"credits"==CURRENT_STATE&&showCredits(),handleStartScreenInput()}function showMenuOptions(){showTitle(),showIntroText();var e=halfCanvasHeight+120;MENU_OPTIONS.forEach(function(t,n){var i=e+50*n;drawText(t,halfCanvasWidth,i,"center"),SELECTED_OPTION==n&&colorRect(halfCanvasWidth/2,i-40,halfCanvasWidth,58,"rgba(206, 26, 26, 0.25)")})}function showControls(){showTitle();var e=["MENU","Move - Arrow keys/WASD","Select - Space/Enter","GAME","Move - Arrow keys/WASD","Attack - Space"],t=175;drawText("CONTROLS",halfCanvasWidth,t,"center","45px Calibri"),t+=50,e.forEach(function(e,n){drawText(e,halfCanvasWidth,t+50*n,"center","25px Calibri")}),drawText("Press space/enter to go back",halfCanvasWidth,canvas.height-50,"center","20px Calibri")}function showCredits(){showTitle();var e=["DESIGN","Jeremy Jackson","PROGRAMMING","Jeremy Jackson","WRITING","Jeremy Jackson"],t=175;drawText("CREDITS",halfCanvasWidth,t,"center","45px Calibri"),t+=50,e.forEach(function(e,n){var i=t+50*n;n%2!=0&&(i-=10),drawText(e,halfCanvasWidth,i,"center","25px Calibri")}),drawText("Press space/enter to go back",halfCanvasWidth,canvas.height-50,"center","20px Calibri")}function handleStartScreenInput(){player.keyDown_up&&(selectSound.play(),--SELECTED_OPTION<0&&(SELECTED_OPTION=MENU_OPTIONS.length-1),player.keyDown_up=!1),player.keyDown_down&&(selectSound.play(),++SELECTED_OPTION==MENU_OPTIONS.length&&(SELECTED_OPTION=0),player.keyDown_down=!1),(player.keyDown_space||player.keyDown_enter)&&(player.keyDown_space&&(player.keyDown_space=!1),player.keyDown_enter&&(player.keyDown_enter=!1),"menu"==CURRENT_STATE?"game"==(CURRENT_STATE=GAME_STATES[SELECTED_OPTION+1])&&(clearInterval(menuInterval),startGame()):(SELECTED_OPTION=0,CURRENT_STATE=GAME_STATES[0]))}function showTitle(){drawText(TITLE,halfCanvasWidth,100,"center","78px Calibri")}function showIntroText(){drawText("MISSION BRIEFING",100,150,"start","20px Calibri"),drawText(INTRO_TEXT.substring(0,74),100,175,"start","20px Calibri"),drawText(INTRO_TEXT.substring(74,148),100,200,"start","20px Calibri"),drawText(INTRO_TEXT.substring(148,190),100,225,"start","20px Calibri"),drawText("OBJECTIVES",100,275,"start","20px Calibri"),drawText("- Locate Shadow",100,300,"start","20px Calibri"),drawText("- Avoid enemy detection",100,325,"start","20px Calibri"),drawText("TIPS",halfCanvasWidth,275,"start","20px Calibri"),drawText("- Use walls and corners to avoid detection",halfCanvasWidth,300,"start","20px Calibri"),drawText("- Press space to take out enemies when close",halfCanvasWidth,325,"start","20px Calibri")}function startGame(){SHOW_END_DIALOGUE=!1,SHOW_GHOST_END_DIALOGUE=!1,SHOW_SPECTRE_END_DIALOGUE=!1,SHOW_MISSION_COMPLETE=!1,CURRENT_LEVEL=0,LEVEL_LOADED=!1;gameInterval=setInterval(updateGame,1e3/65)}function updateGame(){if(!LEVEL_LOADED)return loadLevel();checkCollisions(),moveAll(),drawAll()}function goToNextLevel(){CURRENT_LEVEL++,LEVEL_LOADED=!1}function loadLevel(){CURRENT_LEVEL=CURRENT_LEVEL||0,setPlayerDefaultValues(),setPlayerPosition(),setEnemies(),6==CURRENT_LEVEL?setShadow():setGoal(),setWalls(),LEVEL_LOADED=!0}function setPlayerPosition(){player.x=LEVELS[CURRENT_LEVEL].playerPosition.x,player.y=LEVELS[CURRENT_LEVEL].playerPosition.y}function setWalls(){walls=LEVELS[CURRENT_LEVEL].walls}function setGoal(){goal=LEVELS[CURRENT_LEVEL].goal}function setShadow(){shadow=LEVELS[CURRENT_LEVEL].shadow}function setEnemies(){enemies=JSON.parse(JSON.stringify(LEVELS[CURRENT_LEVEL].enemies))}function moveAll(){movePlayer(),moveEnemies()}function drawAll(){if(clearScreen(),6==CURRENT_LEVEL?shadow&&drawShadow():drawGoal(),enemies.forEach(drawEnemy),drawPlayer(),drawWalls(),SHOW_MISSION_COMPLETE)return handleMissionComplete();SHOW_END_DIALOGUE&&showEndDialogue()}function checkCollisions(){enemies.forEach(checkPlayerEnemyCollision),6==CURRENT_LEVEL?checkPlayerShadowCollision():checkPlayerGoalCollision()}function checkPlayerEnemyCollision(e,t){var n=getDistance(e.currentPosition,player);n<=ATTACK_DISTANCE&&player.attack&&!player.seen&&(attackSound.play(),enemies.splice(t,1)),n<=COLLISION_DISTANCE&&(e.spottedPlayer=!0)}function doesCollideWithWall(e,t){var n=!1;return walls.forEach(function(i,a){if(!n){var o=Math.abs(e-i.x-i.width/2),r=Math.abs(t-i.y-i.height/2);if(o>i.width/2+RADIUS)n=!1;else if(r>i.height/2+RADIUS)n=!1;else if(o<=i.width/2)n=!0;else if(r<=i.height/2)n=!0;else{var s=o-i.width/2,l=r-i.height/2;n=s*s+l*l<=RADIUS*RADIUS}}}),n}function checkPlayerGoalCollision(){player.onGoal=player.x>goal.x&&player.y>goal.y&&player.x<goal.x+goal.width&&player.y<goal.y+goal.height,player.onGoal&&goToNextLevel()}function checkPlayerShadowCollision(){getDistance(shadow,player)<70&&0==enemies.length&&(SHOW_END_DIALOGUE=!0)}function drawGoal(){colorRect(goal.x,goal.y,goal.width,goal.height,"rgb(16, 99, 52)")}function drawShadow(){colorCircle(shadow.x,shadow.y,RADIUS,"purple")}function drawWalls(){canvasContext.strokeStyle="green",walls.forEach(function(e){canvasContext.beginPath(),canvasContext.rect(e.x,e.y,e.width,e.height),canvasContext.stroke(),canvasContext.closePath()})}function movePlayer(){if(player.seen)return player.keyDown_enter&&(player.keyDown_enter=!1,CURRENT_STATE="menu",clearInterval(gameInterval),showStartScreen()),void(player.keyDown_r&&(player.keyDown_r=!1,loadLevel()));if(SHOW_MISSION_COMPLETE)player.keyDown_enter&&(player.keyDown_enter=!1,clearInterval(gameInterval),SHOW_MISSION_COMPLETE=!1,SHOW_END_DIALOGUE=!1,CURRENT_STATE="menu",showStartScreen());else if(SHOW_END_DIALOGUE)player.keyDown_space&&(player.keyDown_space=!1,SHOW_GHOST_END_DIALOGUE?(SHOW_GHOST_END_DIALOGUE=!1,SHOW_SPECTRE_END_DIALOGUE=!0):(SHOW_END_DIALOGUE=!1,SHOW_SPECTRE_END_DIALOGUE=!1,SHOW_MISSION_COMPLETE=!0));else{var e,t;if(player.keyDown_left&&player.x>=0){if(e=player.x-player.speed,t=player.y,doesCollideWithWall(e,t))return;player.x-=player.speed}if(player.keyDown_up&&player.y>=0){if(e=player.x,t=player.y-player.speed,doesCollideWithWall(e,t))return;player.y-=player.speed}if(player.keyDown_right&&player.x<=canvas.width){if(e=player.x+player.speed,t=player.y,doesCollideWithWall(e,t))return;player.x+=player.speed}if(player.keyDown_down&&player.y<=canvas.height){if(e=player.x,t=player.y+player.speed,doesCollideWithWall(e,t))return;player.y+=player.speed}}}function moveEnemies(){enemies.forEach(function(e){if(!(e.isWaiting||e.isTurningAround||e.spottedPlayer)){var t=e.isReturning?e.startPosition:e.goToPosition;if(getDistance(e.currentPosition,t)<=0)return toggleEnemyWaitAndReturn(e);e.currentPosition.x<t.x?e.currentPosition.x+=e.speed:e.currentPosition.x>t.x&&(e.currentPosition.x-=e.speed),e.currentPosition.y<t.y?e.currentPosition.y+=e.speed:e.currentPosition.y>t.y&&(e.currentPosition.y-=e.speed)}})}function toggleEnemyWaitAndReturn(e){e.isReturning=!e.isReturning,e.isWaiting=!0}function drawPlayer(){checkIfSeen();var e="white";player.seen&&(e="blue"),colorCircle(player.x,player.y,RADIUS,e),player.seen&&handleGameOver()}function toggleDebug(){DEBUG=!DEBUG,console.log("debug =",DEBUG)}function drawEnemy(e){colorCircle(e.currentPosition.x,e.currentPosition.y,RADIUS,"red");var t=getRadians(0);if(e.spottedPlayer)e.currentDirection={x:player.x,y:player.y};else if(e.isTurningAround){e.rotations||(e.rotations=0),e.angle=0;var n=getDegrees(getAngleBetweenThreePoints(e.currentPosition,e.direction,e.currentDirection));if((0==Math.floor(n)||0==Math.ceil(n))&&e.rotations>1)return e.isTurningAround=!1,e.rotations=0,void(e.angle=0);e.angle+=TURN_RATE,t=getRadians(e.angle);var i=Math.cos(t),a=Math.sin(t),o=(l=subtractVectors(e.currentDirection,e.currentPosition)).x*i-l.y*a+e.currentPosition.x,r=l.y*i+l.x*a+e.currentPosition.y;e.currentDirection={x:o,y:r},e.rotations++}else if(e.isWaiting){if(e.goToMax)if(e.angle<e.maxAngle){if(e.angle+=TURN_RATE,e.returnToCenterAngle&&0==e.angle){e.isTurningAround=!0;var s=subtractVectors(e.startPosition,e.goToPosition);setTimeout(function(){0!=s.x&&(e.direction.x*=-1),0!=s.y&&(e.direction.y*=-1),e.isWaiting=!1},directionDelay)}}else e.angle>=e.maxAngle&&setTimeout(function(){e.goToMax=!1},500);else e.angle>e.minAngle&&(e.angle-=TURN_RATE),e.angle<=e.minAngle&&setTimeout(function(){e.goToMax=!0,e.returnToCenterAngle=!0},500);t=getRadians(e.angle);var i=Math.cos(t),a=Math.sin(t),o=(l=subtractVectors(e.direction,e.currentPosition)).x*i-l.y*a+e.currentPosition.x,r=l.y*i+l.x*a+e.currentPosition.y;e.currentDirection={x:o,y:r}}else{var i=Math.cos(t),a=Math.sin(t),l=subtractVectors(e.direction,e.currentPosition),o=l.x*i-l.y*a+e.currentPosition.x,r=l.y*i+l.x*a+e.currentPosition.y;e.currentDirection={x:o,y:r}}e.facing=getDirection(e.currentPosition,e.currentDirection);var c=rotateDirection(e.facing,halfFoVCos,halfFoVSin),y=visionRadius;e.visionRadius&&(y=e.visionRadius),c[0]=scaleVector(c[0],y),c[1]=scaleVector(c[1],y),e.fovDirections=c;var h=addVectors(e.currentPosition,c[0]),d=addVectors(e.currentPosition,c[1]);e.fovEdges=[h,d],canvasContext.beginPath(),canvasContext.moveTo(e.currentPosition.x,e.currentPosition.y),canvasContext.lineTo(h.x,h.y),canvasContext.lineTo(d.x,d.y),canvasContext.moveTo(h.x,h.y),canvasContext.closePath(),canvasContext.fillStyle="rgba(162, 225, 249, 0.5)",canvasContext.fill()}function colorRect(e,t,n,i,a){canvasContext.fillStyle=a,canvasContext.fillRect(e,t,n,i)}function colorCircle(e,t,n,i){canvasContext.fillStyle=i,canvasContext.beginPath(),canvasContext.arc(e,t,n,0,2*Math.PI,!0),canvasContext.fill()}function clearScreen(){colorRect(0,0,canvas.width,canvas.height,"black")}function drawText(e,t,n,i,a){canvasContext.fillStyle="white",canvasContext.font="35px Calibri",i&&(canvasContext.textAlign=i),a&&(canvasContext.font=a),canvasContext.fillText(e,t,n)}function setUpInput(){document.addEventListener("keydown",keyPressed),document.addEventListener("keyup",keyReleased)}function keyPressed(e){setKey(e.keyCode||e.which,!0)}function keyReleased(e){setKey(e.keyCode||e.which,!1)}function setKey(e,t){if(e!=controls.left_arrow&&e!=controls.a_key||(player.keyDown_left=t),e!=controls.up_arrow&&e!=controls.w_key||(player.keyDown_up=t),e!=controls.right_arrow&&e!=controls.d_key||(player.keyDown_right=t),e!=controls.down_arrow&&e!=controls.s_key||(player.keyDown_down=t),e==controls.r_key&&(player.keyDown_r=t),e==controls.space_key){if(player.keyDown_space=t,player.seen)return;player.attack=t,setTimeout(function(){player.attack=!1,player.keyDown_space=!1},100)}if(e==controls.enter_key){if(player.keyDown_enter=t,player.seen)return;setTimeout(function(){player.keyDown_enter=!1},100)}}function getNormalizedVector(e){var t=Math.sqrt(e.x*e.x+e.y*e.y),n={x:0,y:0};return 0!=t&&(n.x=e.x/t,n.y=e.y/t),n}function subtractVectors(e,t){return{x:e.x-t.x,y:e.y-t.y}}function addVectors(e,t){return{x:e.x+t.x,y:e.y+t.y}}function scaleVector(e,t){return{x:e.x*t,y:e.y*t}}function getDistance(e,t){var n=subtractVectors(e,t);return Math.abs(Math.sqrt(n.x*n.x+n.y*n.y))}function dotProduct(e,t){return e.x*t.x+e.y*t.y}function getDegrees(e){return e*(180/Math.PI)}function getRadians(e){return e*(Math.PI/180)}function getAngleBetweenThreePoints(e,t,n){var i=Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2),a=Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2),o=Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2);return Math.acos((i+a-o)/Math.sqrt(4*i*a))}function getDirection(e,t){return getNormalizedVector(subtractVectors(t,e))}function squaredLength(e){return e.x*e.x+e.y*e.y}function crossProduct(e,t){return e.x*t.y-e.y*t.x}function rotateDirection(e,t,n){var i=e.x*t,a=e.y*t,o=e.x*n,r=e.y*n;return[{x:i-r,y:o+a},{x:i+r,y:-o+a}]}function checkIfSeen(){player.seen=!1,enemies.forEach(function(e){if(e.spottedPlayer=!1,!isWallBetweenPlayerAndEnemy(e)){var t=subtractVectors(player,e.currentPosition);if(!(dotProduct(t,e.facing)<=0)){var n=squaredVisionRadius;e.squaredVisionRadius&&(n=e.squaredVisionRadius),squaredLength(t)-n>epsilon||(player.seen=crossProduct(e.fovDirections[0],t)<=0&&crossProduct(t,e.fovDirections[1])<=0,e.spottedPlayer=player.seen)}}})}function checkIfLinesIntersect(e,t){var n=e[0].x,i=e[0].y,a=e[1].x,o=e[1].y,r=t[0].x,s=t[0].y,l=t[1].x,c=t[1].y,y=((n*o-i*a)*(r-l)-(n-a)*(r*c-s*l))/((n-a)*(s-c)-(i-o)*(r-l)),h=((n*o-i*a)*(s-c)-(i-o)*(r*c-s*l))/((n-a)*(s-c)-(i-o)*(r-l));if(isNaN(y)||isNaN(h))return!1;if(n>=a){if(!(a<=y&&y<=n))return!1}else if(!(n<=y&&y<=a))return!1;if(i>=o){if(!(o<=h&&h<=i))return!1}else if(!(i<=h&&h<=o))return!1;if(r>=l){if(!(l<=y&&y<=r))return!1}else if(!(r<=y&&y<=l))return!1;if(s>=c){if(!(c<=h&&h<=s))return!1}else if(!(s<=h&&h<=c))return!1;return!0}function isWallBetweenPlayerAndEnemy(e){var t=!1,n=[{x:player.x,y:player.y},{x:e.currentPosition.x,y:e.currentPosition.y}];return walls.forEach(function(e){if(!t){var i=[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y}],a=[{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height}],o=[{x:e.x,y:e.y+e.height},{x:e.x+e.width,y:e.y+e.height}],r=[{x:e.x,y:e.y},{x:e.x,y:e.y+e.height}];t=checkIfLinesIntersect(n,i)||checkIfLinesIntersect(n,a)||checkIfLinesIntersect(n,o)||checkIfLinesIntersect(n,r)}}),t}function handleGameOver(){var e=canvasContext.fillStyle="rgba(0, 0, 0, 0.5)";colorRect(0,0,canvas.width,canvas.height,e),drawText(SPOTTED_TEXT,halfCanvasWidth,halfCanvasHeight-25,"center"),drawText(RETRY_TEXT,halfCanvasWidth,halfCanvasHeight+25,"center","25px Calibri"),drawText(RETURN_TO_MENU_TEXT,halfCanvasWidth,halfCanvasHeight+60,"center","25px Calibri")}function showEndDialogue(){SHOW_GHOST_END_DIALOGUE||SHOW_SPECTRE_END_DIALOGUE||(SHOW_GHOST_END_DIALOGUE=!0);var e=canvasContext.fillStyle="rgba(80, 82, 84, 0.25)";colorRect(0,halfCanvasHeight,canvas.width,halfCanvasHeight,e),SHOW_GHOST_END_DIALOGUE&&(drawText("GHOST",halfCanvasWidth/8,halfCanvasHeight+35,"start"),drawText(GHOST_DIALOGUE.substring(0,49),halfCanvasWidth/8,halfCanvasHeight+70,"start"),drawText(GHOST_DIALOGUE.substring(49),halfCanvasWidth/8,halfCanvasHeight+100,"start"),drawText("PRESS SPACE TO CONTINUE",600,canvas.height-20,"start","15px Calibri")),SHOW_SPECTRE_END_DIALOGUE&&(drawText("SPECTRE",halfCanvasWidth/8,halfCanvasHeight+35,"start"),drawText(SPECTRE_DIALOGUE.substring(0,50),halfCanvasWidth/8,halfCanvasHeight+70,"start"),drawText(SPECTRE_DIALOGUE.substring(50),halfCanvasWidth/8,halfCanvasHeight+100,"start"),drawText("PRESS SPACE TO CONTINUE",600,canvas.height-20,"start","15px Calibri"))}function handleMissionComplete(){var e=canvasContext.fillStyle="rgba(0, 0, 0, 0.5)";colorRect(0,0,canvas.width,canvas.height,e),drawText("MISSION COMPLETE",halfCanvasWidth,halfCanvasHeight-25,"center"),drawText("You located Shadow. Good job, soldier!",halfCanvasWidth,halfCanvasHeight+25,"center","25px Calibri"),drawText(RETURN_TO_MENU_TEXT,halfCanvasWidth,halfCanvasHeight+80,"center","25px Calibri")}var LEVELS=[{playerPosition:{x:50,y:50},enemies:[{angle:0,maxAngle:50,minAngle:-50,speed:1,goToMax:!0,isWaiting:!1,isReturning:!1,isTurningAround:!1,secondsToWait:2,startPosition:{x:350,y:200},currentPosition:{x:350,y:200},goToPosition:{x:350,y:350},direction:{x:350,y:400}},{angle:0,maxAngle:50,minAngle:-50,speed:1,goToMax:!0,isWaiting:!1,isReturning:!1,isTurningAround:!1,secondsToWait:2,startPosition:{x:720,y:150},currentPosition:{x:720,y:150},goToPosition:{x:720,y:450},direction:{x:720,y:500}}],walls:[{x:80,y:50,width:600,height:100},{x:80,y:450,width:600,height:100},{x:750,y:0,width:50,height:240},{x:750,y:360,width:50,height:240}],goal:{x:750,y:250,width:50,height:100}},{playerPosition:{x:20,y:300},enemies:[{angle:0,maxAngle:50,minAngle:-50,speed:1,goToMax:!0,isWaiting:!1,isReturning:!1,isTurningAround:!1,secondsToWait:2,startPosition:{x:150,y:450},currentPosition:{x:150,y:450},goToPosition:{x:600,y:450},direction:{x:650,y:450}},{angle:0,maxAngle:50,minAngle:-50,speed:1,goToMax:!0,isWaiting:!1,isReturning:!1,isTurningAround:!1,secondsToWait:2,startPosition:{x:620,y:100},currentPosition:{x:620,y:100},goToPosition:{x:620,y:250},direction:{x:620,y:300}},{angle:0,maxAngle:60,minAngle:-60,speed:1,goToMax:!0,isWaiting:!1,isReturning:!1,isTurningAround:!1,secondsToWait:2,startPosition:{x:600,y:65},currentPosition:{x:600,y:65},goToPosition:{x:150,y:65},direction:{x:-650,y:65}}],walls:[{x:65,y:140,width:500,height:100},{x:65,y:495,width:730,height:100},{x:650,y:50,width:100,height:100},{x:5,y:0,width:50,height:240},{x:5,y:360,width:50,height:240}],goal:{x:80,y:0,width:100,height:50}},{playerPosition:{x:100,y:570},enemies:[{angle:0,maxAngle:50,minAngle:-50,speed:1,goToMax:!0,isWaiting:!1,isReturning:!1,isTurningAround:!1,secondsToWait:2,startPosition:{x:700,y:475},currentPosition:{x:700,y:475},goToPosition:{x:700,y:475},direction:{x:700,y:525}},{angle:0,maxAngle:35,minAngle:-35,speed:1,goToMax:!0,isWaiting:!1,isReturning:!1,isTurningAround:!1,secondsToWait:2,startPosition:{x:180,y:100},currentPosition:{x:180,y:100},goToPosition:{x:180,y:450},direction:{x:180,y:500}},{angle:0,maxAngle:37,minAngle:-37,speed:1,goToMax:!0,isWaiting:!1,isReturning:!1,isTurningAround:!1,secondsToWait:2,startPosition:{x:375,y:450},currentPosition:{x:375,y:450},goToPosition:{x:375,y:100},direction:{x:375,y:-500}},{angle:0,maxAngle:20,minAngle:-20,speed:1,goToMax:!0,isWaiting:!1,isReturning:!1,isTurningAround:!1,secondsToWait:2,startPosition:{x:500,y:80},currentPosition:{x:500,y:80},goToPosition:{x:200,y:80},direction:{x:-550,y:80}},{angle:0,maxAngle:20,minAngle:-20,speed:1,goToMax:!0,isWaiting:!1,isReturning:!1,isTurningAround:!1,secondsToWait:2,startPosition:{x:350,y:350},currentPosition:{x:350,y:350},goToPosition:{x:200,y:350},direction:{x:-400,y:350}}],walls:[{x:75,y:100,width:75,height:75},{x:75,y:250,width:75,height:75},{x:75,y:400,width:75,height:75},{x:630,y:50,width:100,height:100},{x:450,y:160,width:100,height:440}],goal:{x:650,y:550,width:100,height:50}},{playerPosition:{x:750,y:50},enemies:[{angle:0,maxAngle:50,minAngle:-50,speed:1,goToMax:!0,isWaiting:!1,isReturning:!1,isTurningAround:!1,secondsToWait:2,startPosition:{x:150,y:275},currentPosition:{x:150,y:275},goToPosition:{x:150,y:275},direction:{x:800,y:275},visionRadius:700,squaredVisionRadius:49e4}],walls:[{x:625,y:20,width:75,height:125},{x:625,y:220,width:75,height:125},{x:325,y:400,width:375,height:75}],goal:{x:50,y:550,width:100,height:50}},{playerPosition:{x:100,y:50},enemies:[{angle:0,maxAngle:35,minAngle:-35,speed:1,goToMax:!0,isWaiting:!1,isReturning:!1,isTurningAround:!1,secondsToWait:2,startPosition:{x:110,y:200},currentPosition:{x:110,y:200},goToPosition:{x:110,y:450},direction:{x:110,y:500}},{angle:0,maxAngle:35,minAngle:-35,speed:1,goToMax:!0,isWaiting:!1,isReturning:!1,isTurningAround:!1,secondsToWait:2,startPosition:{x:250,y:350},currentPosition:{x:250,y:350},goToPosition:{x:500,y:350},direction:{x:550,y:350}}],walls:[{x:200,y:0,width:595,height:280},{x:200,y:420,width:595,height:180},{x:70,y:70,width:75,height:75}],goal:{x:750,y:300,width:50,height:100}},{playerPosition:{x:40,y:375},enemies:[{angle:0,maxAngle:35,minAngle:-35,speed:1,goToMax:!0,isWaiting:!1,isReturning:!1,isTurningAround:!1,secondsToWait:2,startPosition:{x:215,y:50},currentPosition:{x:215,y:50},goToPosition:{x:215,y:300},direction:{x:215,y:350}},{angle:0,maxAngle:35,minAngle:-35,speed:1,goToMax:!0,isWaiting:!1,isReturning:!1,isTurningAround:!1,secondsToWait:2,startPosition:{x:250,y:350},currentPosition:{x:250,y:350},goToPosition:{x:500,y:350},direction:{x:550,y:350}},{angle:0,maxAngle:35,minAngle:-35,speed:1,goToMax:!0,isWaiting:!1,isReturning:!1,isTurningAround:!1,secondsToWait:2,startPosition:{x:700,y:50},currentPosition:{x:700,y:50},goToPosition:{x:700,y:300},direction:{x:700,y:350}},{angle:0,maxAngle:35,minAngle:-35,speed:1,goToMax:!0,isWaiting:!1,isReturning:!1,isTurningAround:!1,secondsToWait:2,startPosition:{x:500,y:100},currentPosition:{x:500,y:100},goToPosition:{x:500,y:100},direction:{x:-550,y:100}}],walls:[{x:275,y:175,width:75,height:150},{x:0,y:250,width:150,height:75},{x:0,y:420,width:650,height:180},{x:475,y:175,width:75,height:150}],goal:{x:650,y:0,width:100,height:50}},{playerPosition:{x:700,y:550},enemies:[{angle:0,maxAngle:35,minAngle:-35,speed:1,goToMax:!0,isWaiting:!1,isReturning:!1,isTurningAround:!1,secondsToWait:2,startPosition:{x:250,y:150},currentPosition:{x:250,y:150},goToPosition:{x:250,y:300},direction:{x:250,y:350}}],walls:[{x:0,y:0,width:150,height:410},{x:350,y:0,width:450,height:300},{x:0,y:420,width:600,height:180}],shadow:{x:250,y:50}}],canvas,canvasContext,halfCanvasHeight,halfCanvasWidth,gameInterval,menuInterval,attackSound=new Audio("sounds/attack.wav"),selectSound=new Audio("sounds/select.wav");attackSound.volume=.5,selectSound.volume=.5;var DEBUG=!1,directionDelay=0,epsilon=.075,TURN_RATE=.5,fieldOfView=getRadians(66),halfFoV=fieldOfView/2,halfFoVCos=Math.cos(halfFoV),halfFoVSin=Math.sin(halfFoV),visionRadius=130,squaredVisionRadius=visionRadius*visionRadius,TITLE="THE RESCUE",INTRO_TEXT='"This is Spectre... Operation Rescue JS13K. Infiltrate the enemy base and find out what happened to Shadow, our missing agent. If he\'s still alive, get him out of there! Good luck, Ghost!"',GAME_STATES=["menu","game","controls","credits"],MENU_OPTIONS=["Start","Controls","Credits"],SPOTTED_TEXT="YOU WERE SPOTTED",RETRY_TEXT="Press R to try again",RETURN_TO_MENU_TEXT="Press Enter to return to the menu",CURRENT_STATE=GAME_STATES[0],SELECTED_OPTION=0,SHOW_END_DIALOGUE=!1,SHOW_GHOST_END_DIALOGUE=!1,SHOW_SPECTRE_END_DIALOGUE=!1,SHOW_MISSION_COMPLETE=!1,GHOST_DIALOGUE="Spectre, I've located Shadow... he's unconscious but breathing. Get the chopper ready.",SPECTRE_DIALOGUE="Well done, Ghost! A chopper is on the way. You'll be home in time for dinner!",CURRENT_LEVEL,RADIUS=13,ATTACK_DISTANCE=2.25*RADIUS,COLLISION_DISTANCE=RADIUS+3,TOTAL_LEVELS=LEVELS.length,LEVEL_LOADED=!1,player,enemies,goal,shadow,controls={left_arrow:37,up_arrow:38,right_arrow:39,down_arrow:40,w_key:87,a_key:65,s_key:83,d_key:68,r_key:82,space_key:32,enter_key:13};window.onload=function(){canvas=document.getElementById("gameCanvas"),canvasContext=canvas.getContext("2d"),halfCanvasWidth=canvas.width/2,halfCanvasHeight=canvas.height/2,showStartScreen(),setUpInput()};