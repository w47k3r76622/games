(function(){for(var A=0,y=["ms","moz","webkit","o"],s=0;s<y.length&&!window.requestAnimationFrame;++s)window.requestAnimationFrame=window[y[s]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[y[s]+"CancelAnimationFrame"]||window[y[s]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(s,E){var B=(new Date).getTime(),z=Math.max(0,16-(B-A)),t=window.setTimeout(function(){s(B+z)},z);A=B+z;return t});window.cancelAnimationFrame||(window.cancelAnimationFrame=
function(s){clearTimeout(s)})})();
(function(){function A(a,b){return Math.random()*(b-a)+a}function y(){for(var a=0;4>a;a++){var b=a*t(90),c=r/2+u*Math.cos(b),l=n/2+u*Math.sin(b),b=L(Math.atan2(e.y-l,e.x-c));g.push({x:c,y:l,angle:b,health:100,alpha:1,radius:10,shootTime:W,isActive:!1})}}function s(a,b,c,l){var d=10;"bomber"===c&&(d*=4);for(var f=0;f<d;f++){var g=A(1,360),e=Math.floor(5*Math.random()/2)+5,k=Math.floor(10*Math.random())+5,m=g*Math.PI/180,g=Math.cos(m)*e,e=Math.sin(m)*e,n=m=8;"shot"===c?m=n=4:"bomber"===c&&(m=n=10);
q.push({x:a,y:b,xunits:g,yunits:e,life:k,colour:l,width:m,height:n,gravity:0.5,moves:0,alpha:1,maxLife:k})}}function fa(){switch(x){case m.GAME:if(0===Q){var a=Math.floor(360*Math.random()),p=r/2+u*Math.cos(a),h=n/2+u*Math.sin(a),a=L(Math.atan2(e.y-h,e.x-p)),l,G,H,y=R.NONE;G=Math.floor(50*Math.random());var D=ga;1===I?(l=w.BASIC,H=X):2===I?(l=0===G%2?w.BASIC:w.PROWLER,H=l===w.BASIC?X:Y+A(1,300)):(3===I?(l=0===G%2?w.PROWLER:w.DIRECT,H=l===w.PROWLER?Y+A(1,400):ha):5>=G?(l=w.BASIC,H=X):5<G&&25>=G?(l=
w.PROWLER,H=Y+A(1,250)):(l=w.DIRECT,H=ha),D=A(ga,ma));y=R.CLOCK;l===w.PROWLER&&0===G%2&&(y=R.ANTI);c.push({x:p,y:h,direction:y,angle:a,radius:na,isWaiting:!0,waitTime:H,vx:0,vy:0,speed:D,damage:Z,isActive:!0,type:l,colour:"#000"});S<oa?S++:(S=0,I++,K=100<K?K-100:75);Q=K}else Q--;for(a=0;a<c.length;a++)if(c[a].isActive)if(c[a].isWaiting){c[a].waitTime--;switch(c[a].type){case w.PROWLER:c[a].angle=c[a].direction===R.CLOCK?c[a].angle+Math.acos(1-Math.pow(c[a].speed/u,2)/2):c[a].angle-Math.acos(1-Math.pow(c[a].speed/
u,2)/2);c[a].x=r/2+u*Math.cos(c[a].angle);c[a].y=n/2+u*Math.sin(c[a].angle);break;case w.DIRECT:c[a].waitTime=0}0>=c[a].waitTime&&(c[a].isWaiting=!1,c[a].angle=L(Math.atan2(e.y-c[a].y,e.x-c[a].x)))}else p=Math.cos(t(c[a].angle)),h=Math.sin(t(c[a].angle)),c[a].vx=p*c[a].speed,c[a].vy=h*c[a].speed,c[a].x+=c[a].vx,c[a].y+=c[a].vy;if(5<=I)if(0===$){a=!0;for(p=0;p<g.length;p++)if(!g[p].isActive){a=!1;break}if(!a){a=0;do a=Math.floor(A(0,g.length));while(g[a].isActive);g[a].isActive=!0;g[a].health=100;
g[a].shootTime=W;$=pa}}else $--;for(a=0;a<g.length;a++)g[a].isActive&&(0>=g[a].health?(s(g[a].x,g[a].y,"bomber",M[0]),g[a].isActive=!1):0===g[a].shootTime?(d.push({x:g[a].x,y:g[a].y,radius:6,colourIndex:0,angle:g[a].angle,speed:1,vx:0,vy:0,isActive:!0}),g[a].shootTime=W):g[a].shootTime--);for(a=0;a<d.length;a++)d[a].isActive&&(d[a].vx+=0.005*Math.cos(t(d[a].angle)),d[a].vy+=0.005*Math.sin(t(d[a].angle)),d[a].x+=d[a].vx,d[a].y+=d[a].vy);0>=e.luck&&z(m.OVER);f.isActive&&(f.vx+=Math.cos(t(f.angle))*
f.speed,f.vy+=Math.sin(t(f.angle))*f.speed,f.x+=f.vx,f.y+=f.vy);for(a=q.length-1;0<=a;a--)q[a].moves++,q[a].x+=q[a].xunits,q[a].y+=q[a].yunits,q[a].life--,0>=q[a].life&&q.splice(a,1);for(a=0;a<c.length;a++)c[a].isActive&&(f.isActive&&(p=f.radius+c[a].radius,h=c[a].x-f.x,l=c[a].y-f.y,h=Math.sqrt(h*h+l*l),h<p&&(c[a].colour="#00F",c[a].isActive=!1,f.isActive=!1,p=c[a].x,h=c[a].y,l=L(Math.atan2(N+T/2-h,J-p)),k.push({x:p,y:h,text:"+5",radius:20,angle:l,vx:0,vy:0,speed:0.5,isActive:!0,wait:30}),s(c[a].x,
c[a].y,"ball","#EB1010"))),p=e.radius+c[a].radius,h=c[a].x-e.x,l=c[a].y-e.y,h=Math.sqrt(h*h+l*l),h<p&&(c[a].colour="#F00",e.luck-=Z,c[a].isActive=!1));for(a=0;a<g.length;a++)if(g[a].isActive&&f.isActive&&(p=f.radius+g[a].radius,h=g[a].x-f.x,l=g[a].y-f.y,h=Math.sqrt(h*h+l*l),h<p)){g[a].health-=qa;f.isActive=!1;s(f.x,f.y,"",M[0]);break}for(a=0;a<d.length;a++)if(d[a].isActive&&(p=e.radius+d[a].radius,h=d[a].x-e.x,l=d[a].y-e.y,h=Math.sqrt(h*h+l*l),h<p&&(d[a].isActive=!1,e.luck-=ra)),d[a].isActive&&f.isActive&&
(p=f.radius+d[a].radius,h=d[a].x-f.x,l=d[a].y-f.y,h=Math.sqrt(h*h+l*l),h<p)){d[a].isActive=!1;f.isActive=!1;s(d[a].x,d[a].y,"",M[d[a].colourIndex]);break}for(a=0;a<k.length;a++)k[a].isActive&&(p=sa+k[a].radius,h=k[a].x-ia,l=k[a].y-ja,h=Math.sqrt(h*h+l*l),h<p&&(200>e.luck&&(e.luck+=5),k[a].isActive=!1));for(a=0;a<k.length;a++)k[a].isActive&&(0==k[a].wait?(k[a].vx+=Math.cos(t(k[a].angle))*k[a].speed,k[a].vy+=Math.sin(t(k[a].angle))*k[a].speed,k[a].x+=k[a].vx,k[a].y+=k[a].vy):k[a].wait--);break;case m.PAUSED:0===
aa?(O<ba.length-1?O++:O=0,aa=50):aa--;break;case m.OVER:ca||(C>U&&localStorage.setItem(ka+"long",C),ca=!0);break;case m.LOAD:2===da&&z(m.MENU)}b.fillStyle="#FFF";b.fillRect(0,0,r,n);b.fillStyle="black";b.lineWidth=2.5;b.beginPath();b.fillStyle="#CCC";b.arc(r/2,n/2,u,0,2*Math.PI,!1);b.fill();b.closePath();b.stroke();switch(x){case m.GAME:b.fillStyle="#EEE";b.beginPath();b.arc(e.x,e.y,e.radius,0,2*Math.PI,!1);b.fill();b.closePath();b.stroke();b.beginPath();b.arc(v.x,v.y,v.radius,0,2*Math.PI,!1);b.fill();
b.closePath();b.stroke();b.fillStyle=10>=e.luck?"#B22222":50>=e.luck?"yellow":"green";b.font="24px impact";b.fillText("LUCK",J,n/3-45);b.strokeText("LUCK",J,n/3-45);b.fillRect(J,N+T-e.luck,50,e.luck);b.strokeStyle="#000000";b.strokeRect(J,N,50,T);b.lineWidth=1;for(a=0;a<c.length;a++)c[a].isActive&&(b.save(),b.translate(c[a].x,c[a].y),b.rotate(Math.atan2(e.y-c[a].y,e.x-c[a].x)),b.drawImage(F,-10,-10),b.restore());f.isActive&&(b.fillStyle="#000",b.beginPath(),b.arc(f.x,f.y,f.radius,0,2*Math.PI,!1),
b.fill(),b.closePath(),b.stroke());for(a=0;a<d.length;a++)d[a].isActive&&(b.fillStyle=M[d[a].colourIndex],b.beginPath(),b.arc(d[a].x,d[a].y,d[a].radius,0,2*Math.PI,!1),b.fill(),b.closePath(),b.stroke(),d[a].colourIndex===M.length-1?d[a].colourIndex=0:d[a].colourIndex++);for(a=0;a<g.length;a++)g[a].isActive&&(b.save(),b.globalAlpha=0.1*g[a].health,b.translate(g[a].x,g[a].y),b.rotate(Math.atan2(e.y-g[a].y,e.x-g[a].x)),b.drawImage(V,-15,-15,30,30),b.fillStyle="red",b.fillRect(-20,-10,5,g[a].health/5),
b.strokeRect(-20,-10,5,20),b.restore());for(a=0;a<q.length-1;a++)b.globalAlpha=q[a].life/q[a].maxLife,b.fillStyle=q[a].colour,b.fillRect(q[a].x,q[a].y,q[a].width,q[a].height),b.globalAlpha=1;for(a=0;a<k.length;a++)k[a].isActive&&(b.fillStyle="#FF0000",0===k[a].wait&&(b.fillStyle="#000000"),b.font="14px impact",b.fillText(k[a].text,k[a].x,k[a].y));break;case m.MENU:B("MEE-OOOWWWW!",r/2,n/2,u+20,1,42,"#000");B("PRESS ENTER TO START",r/2,n/2,u+10,0,18,"#000");b.save();b.translate(r/2-F.width/2,n/2-F.height/
2);E("kill to ward off bad luck!",-65,-20,18,"#000",!1);E("kill these too!",-30,35,18,"#000",!1);b.rotate(t(90));b.translate(-(F.width/2),-(F.height/2));b.drawImage(F,-25,80);b.drawImage(V,25,45,25,25);b.restore();break;case m.PAUSED:B("PAUSED!",r/2,n/2,u+20,1,42,ba[O]);E("PRESS SPACEBAR TO RESUME",r/2,n/2,18,"#000",!0);break;case m.OVER:B("GAME OVER!",r/2,n/2,u+20,1,42,"#000"),E("YOUR LUCK LASTED FOR "+C+" SECONDS!",r/2,n/2,18,"#000",!0),la&&(C>U?E("YOUR LUCKIEST YET!",r/2,n/2+40,18,"#00F",!0):E("YOU'VE BEEN LUCKIER! ("+
U+" s)",r/2,n/2+40,18,"#000",!0)),B("PRESS ENTER FOR MENU",r/2,n/2,u,0,18,ba[O])}requestAnimationFrame(fa)}function E(a,c,h,d,f,e){b.fillStyle=f;b.font=" "+d+"px impact";b.shadowColor="rgba(255, 0, 0, 0.3)";b.shadowOffsetX=b.shadowOffsetY=1.5;b.textAlign="left";d=0;e&&(d=b.measureText(a).width/2);b.fillText(a,c-d,h);b.shadowOffsetX=b.shadowOffsetY=0}function B(a,c,d,f,e,g,k){var m=Math.PI/a.length;b.save();b.translate(c,d);c=e?1:-1;b.rotate(-c*((Math.PI-m)/2));for(d=0;d<a.length;d++)b.save(),b.rotate(c*
d*m),b.textAlign="center",b.textBaseline=e?"bottom":"top",E(a[d],0,-c*f,g,k,!1),b.restore();b.restore()}function z(a){x=a;if(x===m.MENU){ca=!1;e.luck=50;I=1;K=300;for(a=S=0;a<g.length;a++)g[a].isActive=!1;d=[];c=[];q=[];P=C=0}else x===m.PAUSED?(P=Math.round(((new Date).getTime()-ea)/1E3),C+=P):x===m.GAME?ea=(new Date).getTime():x===m.OVER&&(P=Math.round(((new Date).getTime()-ea)/1E3),C+=P)}function t(a){return a*(Math.PI/180)}function L(a){return a*(180/Math.PI)}function ta(a){a=Math.atan2(a.pageY-
D.offsetTop-v.y,a.pageX-D.offsetLeft-v.x);v.angle=L(a);v.x=r/2+e.radius*Math.cos(t(v.angle));v.y=n/2+e.radius*Math.sin(t(v.angle))}function ua(a){a.preventDefault();x===m.GAME&&(f={x:v.x,y:v.y,radius:4,colour:"#000",angle:v.angle,speed:2,vx:0,vy:0,isActive:!0},s(f.x,f.y,"shot","orange"))}function va(a){32===a.keyCode?x===m.GAME?z(m.PAUSED):x===m.PAUSED&&z(m.GAME):13===a.keyCode&&(x===m.MENU?z(m.GAME):x===m.OVER&&z(m.MENU))}var D,b,r,n,m={LOAD:0,MENU:1,GAME:2,PAUSED:3,OVER:4},ba=["#000","#FF0"],O=
0,aa=50,x=m.LOAD,e={},v={},f={},qa=10,q=[],u=140,c=[],F=new Image,ga=1.5,ma=2.75,na=10,Z=10,w={BASIC:0,PROWLER:1,DIRECT:2},R={NONE:0,CLOCK:1,ANTI:-1},K=300,Q=0,X=50,Y=150,ha=20,V=new Image,g=[],d=[],M="#B22222 #9A1D1D #801818 #F2870B #FFF802 #4D0F0F".split(" "),W=300,$=0,pa=700,ra=2*Z,J=0,N=0,T=200,ia=0,ja=0,sa=25,k=[],ea=0,C=0,P=0,U=0,la=!1,ka="js13kmw",ca=!1,I=1,S=0,oa=8,da=0;(function(){I=5;D=document.getElementById("c");b=D.getContext("2d");document.onselectstart=function(a){a.preventDefault();
return!1};b.textAlign="left";r=D.width;n=D.height;J=r-75;N=n/4;ia=J+25;ja=N+T/2;F.onload=function(){da++};V.onload=function(){da++};F.src="img/cat.png";V.src="img/bomber.png";window.addEventListener("mousemove",ta,!1);window.addEventListener("mouseup",ua,!1);window.addEventListener("keyup",va,!1);Q=K;window.localStorage&&(U=localStorage.getItem(ka+"long"),la=!0);e={x:r/2,y:n/2,radius:10,luck:50,score:0};v={x:r/2,y:n/2+e.radius,radius:5,angle:0};y();fa()})()})();