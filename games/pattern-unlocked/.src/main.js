Array.prototype.shuffle=function(){for(var a=this,b=a.length-1;0<=b;b--){var c=Math.floor(Math.random()*(b+1)),d=a[c];a[c]=a[b],a[b]=d}return a};var controller=[49,50,51,52];document.onkeydown=a=>{(68==a.keyCode||39==a.keyCode)&&(player.pressingRight=!0),(65==a.keyCode||37==a.keyCode)&&(player.pressingLeft=!0),16==a.keyCode&&(player.xspd=20,player.yspd=20),(enterStage3||enterStage4||enterStage5)&&((87==a.keyCode||38==a.keyCode)&&(player.pressingTop=!0),(83==a.keyCode||40==a.keyCode)&&(player.pressingBottom=!0))},document.onkeyup=a=>{if((68==a.keyCode||39==a.keyCode)&&(player.pressingRight=!1),(65==a.keyCode||37==a.keyCode)&&(player.pressingLeft=!1),(enterStage3||enterStage4||enterStage5)&&((87==a.keyCode||38==a.keyCode)&&(player.pressingTop=!1),(83==a.keyCode||40==a.keyCode)&&(player.pressingBottom=!1)),16==a.keyCode&&setTimeout(()=>{player.xspd=5,player.yspd=5},200),13==a.keyCode)if(100<=player.x&&200>=player.x&&!0==enterStage0)controllerResetLimit=0,blockReset(),enterStageCheck("enterStage1");else if(1100<=player.x&&1200>player.x&&!0==enterStage0)(targetHit||0>=totalBullets)&&(totalBullets=5),targetHit&&(targetHit=4,targets.s2yspd=5),enterStageCheck("enterStage2");else if(2100<=player.x&&2200>player.x&&!0==enterStage0&&!targetHit)enterStageCheck("enterStage3");else if(3100<=player.x&&3200>player.x&&!0==enterStage0&&"red"==fillStyleTargetS3[0]&&"red"==fillStyleTargetS3[1]&&"red"==fillStyleTargetS3[2])randomBlockGenerator(),generateButtons(),wallBoundaries(),buttonReset(),enterStageCheck("enterStage4");else if(4100<=player.x&&4200>player.x&&!0==enterStage0&&holdKey){fillStyleTargetS3[0]=fillStyleTargetS3[1]=fillStyleTargetS3[2]="#ff7777",blockReset();for(let a=0;3>a;a++)fillStyleTargetS3[0]="#ff7777";targetBlinking=!1,clearInterval(blink3),enterStageCheck("enterStage5")}else 100<=player.s1x&&200>player.s1x&&!0==enterStage1?(enterStageCheck("enterStage0"),showText1=!showText1):100<=player.s2x&&200>player.s2x&&!0==enterStage2?(enterStageCheck("enterStage0"),defaultSizeCanvas()):100<=player.s3x&&200>player.s3x&&!0==enterStage3?(enterStageCheck("enterStage0"),defaultSizeCanvas()):100<=player.s4x&&200>player.s4x&&!0==enterStage4&&100<=player.s4y+player.height&&300>=player.s4y?backToStage0():2350<=player.s4x&&2450>player.s4x&&!0==enterStage4&&2363<=player.s4y+player.height&&2563>=player.s4y?(player.x=4460,backToStage0()):100<=player.s5x&&200>player.s5x&&!0==enterStage5&&(enterStageCheck("enterStage0"),defaultSizeCanvas());if(backToStage0=function(){enterStageCheck("enterStage0"),blocks={},gates={},buttons={},walls={},defaultSizeCanvas()},(500<=player.s1x+player.width/2&&550>=player.s1x+player.width/2||enterStage5)&&(0<controllerLimit&&(a.keyCode==controller[0]&&(controllerLimit--,block.b4=!block.b4,block.b2=!block.b2,block.b1=!block.b1),a.keyCode==controller[1]&&(controllerLimit--,block.b2=!block.b2,block.b4=!block.b4),a.keyCode==controller[2]&&(controllerLimit--,block.b2=!block.b2,block.b1=!block.b1,block.b3=!block.b3),a.keyCode==controller[3]&&(controllerLimit--,block.b1=!block.b1,block.b4=!block.b4)),82==a.keyCode&&blockReset()),66==a.keyCode&&enterStage4&&buttonReset(),32==a.keyCode){if(!0==enterStage2&&!0==holdGun)generateBullet(player.s2x,player.s2y+2*player.width/3,"s2");else if(!0==enterStage3&&!0==holdGun)generateBullet(player.s3x,player.s3y+2*player.width/3,"s3");else if(!0==enterStage4&&!0==holdGun)generateBullet(player.s4x,player.s4y+2*player.width/3,"s4");else if(!0==enterStage5&&!0==holdGun)return void(1>Object.keys(bulletlist).length&&(controllerResetLimit--,blockReset(),generateBullet(player.s5x,player.s5y+2*player.width/3,"s5")));totalBulletsFired--}73==a.keyCode&&(showText1=!showText1)},enterStageCheck=function(a){enterStage0=!("enterStage0"!=a),enterStage1=!("enterStage1"!=a),enterStage2=!("enterStage2"!=a),enterStage3=!("enterStage3"!=a),enterStage4=!("enterStage4"!=a),enterStage5=!("enterStage5"!=a),console.log(enterStage0,enterStage1)},defaultSizeCanvas=function(){ctxS.width=980,ctxS.height=300};var images={},player={},bulletlist={},buttons={},playerPositionBeforeCenter={x:0,s4x:0,s4y:0,s5x:0},playerPositionAfterCenter={x:0,s4x:0,s4y:0,s5x:0},ctx=document.getElementById("canvas").getContext("2d"),ctxS=document.getElementById("canvas");player.x=10,player.width=.5*219,player.height=.5*375,player.xspd=5,player.yspd=5,player.mapSize=5590,player.mapSizeS1=ctxS.clientWidth,player.aimAngle=0;var blink3,frameTime=30,enterStage0=!0,enterStage1=!1,enterStage2=!1,enterStage3=!1,enterStage4=!1,enterStage5=!1,controllerLimit=6,controllerResetLimit=2,buttonLimit=6,buttonResetLimit=2,dialogues=[["Your choice doesn't matter","But Destiny","Enter the room and","unlock the gun that you need for stage 2"],["HIT the target thrice","you can make only 5 mistakes"],["Complete the other two","Before Entering this room"],["Keep Moving ==>","Forward","You will go BACK-ward"],["Press shift to move faster and go back to play game","To enter room press shift + upper Arrow"]],controllerText="controller",undef=void 0,targets={s2y:0,s2yspd:5,s3y1:0,s3y2:250,s3y3:400,s3y1spd:5,s3y2spd:10,s3y3spd:7,s2x:1270,s3x1:1050,s3x2:970,s3x3:890,s2Width:10,s2Height:100,s3Width:40,s3Height:140,s3Tx:1180,s3T1y:60,s3T2y:260,s3T3y:460,s3TWidth:80,s3THeight:80,s3Txspd:0,s3Tyspd:0},targetDirectionbool=!1,targetColor="black",totalBullets=5,targetHit=4,spdConst=1,wallColor="#990000",blockInitialPosition=600,showText1=!0,totalBulletsFired=6;images.bg=new Image,images.bg.src="./bg.png";var block={},holdGun=!1,holdKey=!1;blockReset=function(){0<controllerResetLimit?(block.b1=!0,block.b2=!1,block.b3=!0,block.b4=!1,controllerLimit=6,controllerResetLimit--):(controller.shuffle(),controllerResetLimit=2,blockReset())};var tgl=!0;drawMap=function(a=0,b,c=0){let d=0,e=0;!0==enterStage0&&(e=d=!0==tgl?0:.5,tgl=!tgl,a+=d,c+=e),ctx.drawImage(images.bg,d,e,43,43,a,c,b,b)},drawDoor=function(a=0,b=100,c=0,d=100){ctx.save(),ctx.fillStyle="#8b4513",ctx.fillRect(b+a,d+c,100,200),grd=ctx.createLinearGradient(0,6,900,300),grd.addColorStop(0,"black"),grd.addColorStop(.5,"white"),grd.addColorStop(1,"black"),ctx.fillStyle=grd,ctx.fillRect(b+10+a,d+10+c,80,50),ctx.beginPath(),ctx.arc(b+15+a,d+100+c,7,0,2*Math.PI,!1),ctx.fillStyle="grey",ctx.fill(),ctx.lineWidth=2,ctx.strokeStyle="black",ctx.stroke(),ctx.restore()},drawText=function(b=0,c=199,d,e="30px Georgia",f=0,g=150,h=1){ctx.save(),ctx.font=e;let i=e.slice(0,2);styleText("red",c,b,d,i*h,f,g),styleText("blue",c,b+2,d,i*h,f,g),styleText("white",c,b+1,d,i*h,f,g),ctx.restore()},styleText=function(b,c,d,e,f,a,g){ctx.fillStyle=b;for(let h=0;h<e.length;h++)ctx.fillText(e[h],c+d,a+g+ +f*h)},drawPlayer=function(){totalBulletsFired||(holdGun=!1),!0==enterStage1?stage1():!0==enterStage2?stage2():!0==enterStage3?stage3():!0==enterStage4?stage4():!0==enterStage5?stage5():stage0(),drawText(0,ctxS.width-250,[`Game Over in ${gmin}:${gsec}`],"30px Georgia",0,20)},stage0=function(){ctx.save(),!0==player.pressingRight&&(player.x+=player.xspd),!0==player.pressingLeft&&(player.x-=player.xspd);const a=centerPlay("x",player.mapSize);mapMovement(xMovement,"x",player.mapSize,5,dialogues),stayInBoundary("x",0,player.mapSize,"map"),!0==holdGun&&drawGun(a),!0==holdKey&&drawKey(a,y-180+player.height/3),boundaryStage5(),ctx.drawImage(document.getElementById("svg"),0,0,219,375,a,120,player.width,player.height),ctx.restore()},boundaryStage5=function(){3400<player.x+player.width&&3400>player.x&&(player.x=2640),3500>player.x&&3500<player.x+player.width&&(player.x=3500)},stayInBoundary=(a,b,c,d,e=!0,f,g)=>{player[a]<b&&"map"==d&&(player[a]=b),player[a]+player.width>=c&&!0==e&&(player[a]=c-player.width),f!=undef&&(player[f]<b&&"map"==d&&(player[f]=b),player[f]+player.height>=g&&(player[f]=g-player.height))};var xMovement,yMovement;centerPlay=function(a,b){return player[a]+player.width/2>=ctxS.clientWidth/2&&player[a]+player.width/2<b-ctxS.clientWidth/2&&("x"==a||"s4x"==a||"s5x"==a)?(xMovement=player[a]-playerPositionBeforeCenter[a],playerPositionAfterCenter[a]=player[a],ctxS.clientWidth/2-player.width/2):player[a]+player.width/2>=b-ctxS.clientWidth/2&&("x"==a||"s4x"==a||"s5x"==a)?(xMovement=playerPositionAfterCenter[a]-playerPositionBeforeCenter[a],player[a]-playerPositionAfterCenter[a]+ctxS.clientWidth/2-player.width/2):(xMovement=0,player[a])},centerPlayY=function(a,b){return player[a]+player.height/2>=ctxS.clientHeight/2&&player[a]+player.height/2<b-ctxS.clientHeight/2&&"s4y"==a?(yMovement=player[a]-playerPositionBeforeCenter[a],playerPositionAfterCenter[a]=player[a],ctxS.clientHeight/2-player.height/2):player[a]+player.height/2>=b-ctxS.clientHeight/2&&"s4y"==a?(yMovement=playerPositionAfterCenter[a]-playerPositionBeforeCenter[a],player[a]-playerPositionAfterCenter[a]+ctxS.clientHeight/2-player.height/2):(yMovement=0,player[a])},mapMovement=function(a,b,c,d=0,e,f,g=0,h=""){"s2x"==b?drawColoredMap("#ff4444"):drawMap(-a,c,-g),"s1x"==b&&(drawBlock(),drawControlBox()),"s5x"==b&&drawBlock(200,600,xMovement);for(let j=0;j<d;j++)drawDoor(-a,100*(10*j+1),-g),drawText(-a,100*(10*j+1)+100,e[j],f,-g),0==a&&("x"==b||"s4x"==b||"s5x"==b)&&(playerPositionBeforeCenter[b]=player[b]),0==g&&"s4y"==h&&(playerPositionBeforeCenter[h]=player[h]);"s4y"==h&&drawDoor(-a,2350,-g,2363)},mapMovementY=function(a,b,c){drawMap(-a,c),0==a&&"s4y"==StageX&&(playerPositionBeforeCenter[b]=player[b])},drawBlock=function(a=0,b=358,c=0){ctx.save();var d=ctx.createLinearGradient(0,0,980,0);for(let e=0;980>e;e+=100)d.addColorStop(.1*e/100,e/100%2?"white":"grey");ctx.fillStyle=d;for(let d=0;4>d;d++)!0==block[`b${d+1}`]&&ctx.fillRect(a+blockInitialPosition+40*d-c,0,30,b);ctx.fillStyle="#555";for(let d=0;4>d;d++)ctx.fillRect(a+blockInitialPosition+40*d-c,0,30,50);ctx.restore()},drawControlBox=function(){ctx.save(),ctx.fillStyle="grey",ctx.fillRect(500,200,50,100),ctx.lineWidth="2",ctx.beginPath(),ctx.rect(510,210,30,80),ctx.font="10px Georgia",ctx.fillStyle="black";for(let a=0;a<controllerText.length;a+=2)ctx.fillText(controllerText.charAt(a),517,220+8*a),ctx.fillText(controllerText.charAt(a+1),526,220+8*a);ctx.stroke(),ctx.restore()},drawGun=function(a,b=0){ctx.save();let c=800,d=250;!0==holdGun&&(c=a+2*player.width/3,d=180+b),ctx.fillStyle="black",ctx.fillRect(c,d,100,25),ctx.fillRect(c+100,d+7.5,20,10),ctx.fillRect(c,d+25,25,25),ctx.lineWidth="5",ctx.beginPath(),ctx.rect(c+25,d+25,30,15),ctx.stroke(),ctx.fillRect(c+30,d+25,6,10),ctx.restore()},drawColoredMap=function(a){ctx.save(),ctx.fillStyle=a,ctx.fillRect(0,0,player.mapSizeWidthS2,player.mapSizeHeightS2),ctx.restore()},generateBullet=function(a,b,c,d=0){self={id:Math.random(),from:c,x:a+player.width/2+120,y:b,height:20,width:20,xspd:15,yspd:0,aimAngle:d},self.update=function(a,b,c=0,d=0){a.from==b&&(a.x+=a.xspd*spdConst,a.y+=a.yspd*spdConst,drawBullet(a.x,a.y,c,d))},bulletlist[self.id]=self},document.onclick=a=>{for(let b in mouseX=a.clientX-document.getElementById("canvas").getBoundingClientRect().left,mouseY=a.clientY-document.getElementById("canvas").getBoundingClientRect().top,mouseX>ctxS.width-55&&mouseX<ctxS.width&&55>mouseY&&0<mouseY&&enterStage1&&(showText1=!1),buttons)mouseX+xMovement>=50*buttons[b].x-40&&mouseX+xMovement<=50*buttons[b].x+40&&mouseY+yMovement>=50*buttons[b].y-40&&mouseY+yMovement<=50*buttons[b].y+40&&0<buttonLimit&&(buttonLimit--,buttonsSet1[0]==b?(buttons[buttonsSet1[0]].blink=!buttons[buttonsSet1[0]].blink,buttons[buttonsSet1[1]].blink=!buttons[buttonsSet1[1]].blink,buttons[buttonsSet1[3]].blink=!buttons[buttonsSet1[3]].blink):buttonsSet1[1]==b?(buttons[buttonsSet1[1]].blink=!buttons[buttonsSet1[1]].blink,buttons[buttonsSet1[3]].blink=!buttons[buttonsSet1[3]].blink):buttonsSet1[2]==b?(buttons[buttonsSet1[0]].blink=!buttons[buttonsSet1[0]].blink,buttons[buttonsSet1[1]].blink=!buttons[buttonsSet1[1]].blink,buttons[buttonsSet1[2]].blink=!buttons[buttonsSet1[2]].blink):buttonsSet1[3]==b?(buttons[buttonsSet1[0]].blink=!buttons[buttonsSet1[0]].blink,buttons[buttonsSet1[3]].blink=!buttons[buttonsSet1[3]].blink):buttonsSet2[0]==b?(buttons[buttonsSet2[0]].blink=!buttons[buttonsSet2[0]].blink,buttons[buttonsSet2[1]].blink=!buttons[buttonsSet2[1]].blink,buttons[buttonsSet2[3]].blink=!buttons[buttonsSet2[3]].blink):buttonsSet2[1]==b?(buttons[buttonsSet2[1]].blink=!buttons[buttonsSet2[1]].blink,buttons[buttonsSet2[3]].blink=!buttons[buttonsSet2[3]].blink):buttonsSet2[2]==b?(buttons[buttonsSet2[0]].blink=!buttons[buttonsSet2[0]].blink,buttons[buttonsSet2[1]].blink=!buttons[buttonsSet2[1]].blink,buttons[buttonsSet2[2]].blink=!buttons[buttonsSet2[2]].blink):buttonsSet2[3]==b?(buttons[buttonsSet2[0]].blink=!buttons[buttonsSet2[0]].blink,buttons[buttonsSet2[3]].blink=!buttons[buttonsSet2[3]].blink):buttonsSet3[0]==b?(buttons[buttonsSet3[0]].blink=!buttons[buttonsSet3[0]].blink,buttons[buttonsSet3[1]].blink=!buttons[buttonsSet3[1]].blink,buttons[buttonsSet3[3]].blink=!buttons[buttonsSet3[3]].blink,buttons[buttonsSet3[4]].blink=!buttons[buttonsSet3[4]].blink):buttonsSet3[1]==b?(buttons[buttonsSet3[1]].blink=!buttons[buttonsSet3[1]].blink,buttons[buttonsSet3[3]].blink=!buttons[buttonsSet3[3]].blink,buttons[buttonsSet3[4]].blink=!buttons[buttonsSet3[4]].blink):buttonsSet3[2]==b?(buttons[buttonsSet3[0]].blink=!buttons[buttonsSet3[0]].blink,buttons[buttonsSet3[1]].blink=!buttons[buttonsSet3[1]].blink,buttons[buttonsSet3[2]].blink=!buttons[buttonsSet3[2]].blink,buttons[buttonsSet3[4]].blink=!buttons[buttonsSet3[4]].blink):buttonsSet3[3]==b?(buttons[buttonsSet3[0]].blink=!buttons[buttonsSet3[0]].blink,buttons[buttonsSet3[3]].blink=!buttons[buttonsSet3[3]].blink,buttons[buttonsSet3[4]].blink=!buttons[buttonsSet3[4]].blink):buttonsSet3[4]==b&&(buttons[buttonsSet3[0]].blink=!buttons[buttonsSet3[0]].blink,buttons[buttonsSet3[1]].blink=!buttons[buttonsSet3[1]].blink,buttons[buttonsSet3[2]].blink=!buttons[buttonsSet3[2]].blink,buttons[buttonsSet3[3]].blink=!buttons[buttonsSet3[3]].blink,buttons[buttonsSet3[4]].blink=!buttons[buttonsSet3[4]].blink))},drawBullet=function(a,b,c,d){ctx.save(),ctx.beginPath(),ctx.fillStyle="red",ctx.arc(a+c,b+d,20,0,2*Math.PI),ctx.fill(),ctx.stroke(),ctx.restore()},drawEnemyWall=function(a){ctx.save(),ctx.fillStyle=wallColor,0>=totalBullets&&(holdGun=!1),0>totalBullets&&(totalBullets=0),ctx.fillRect(a[0]*totalBullets/5,0,a[0],a[1]),ctx.fillStyle=targetColor,ctx.fillRect(a[0]-20,turnBack(a,"s2y","s2yspd","s2x","s2Width","s2Height"),20,100),bulletTargetCollisionCheck("s2y","s2yspd","s2x","s2Width","s2Height"),ctx.restore()},turnBack=function(a,b,c,d,e,f){return targets[b]+targets[f]>=a[1]&&(targets[c]=-targets[c]),0>targets[b]&&(targets[c]=-targets[c]),targetDirectionbool?targets[b]-=targets[c]*spdConst:targets[b]+=targets[c]*spdConst},bulletTargetCollisionCheck=function(a,b,c,d,e){for(let f in bulletlist)if(bulletlist[f].x+bulletlist[f].width>=targets[c]-50&&bulletlist[f].x<=targets[c]+targets[d]+30&&bulletlist[f].y+bulletlist[f].height>=targets[a]-30&&bulletlist[f].y<=targets[a]+targets[e]+30&&(spdConst=.1),bulletlist[f].x+bulletlist[f].width>=targets[c]&&bulletlist[f].x-bulletlist[f].width<=targets[c]+targets[d]&&bulletlist[f].y+bulletlist[f].height>=targets[a]&&bulletlist[f].y-bulletlist[f].height<=targets[a]+targets[e]){if(delete bulletlist[f],spdConst=1,(enterStage3||enterStage5)&&"s3TWidth"==d){fillStyleTargetS3[+a.slice(3,4)-1]="red";for(let a=0;5>=a;a++)setTimeout(()=>{for(let a=0;3>a;a++)fillStyleTargetS3[a]="red"==fillStyleTargetS3[a]?"#ff7777":"red"},200*a);"red"==fillStyleTargetS3[0]&&"red"==fillStyleTargetS3[1]&&"red"==fillStyleTargetS3[2]&&(blink3=setInterval(()=>{for(let a=0;3>a;a++)fillStyleTargetS3[a]="red"==fillStyleTargetS3[a]?"#ff7777":"red"},200),targetBlinking=!0)}if(targetHit&&enterStage2){targets[b]+=targets[b],targetHit--;for(let a=0;5>=a;a++)setTimeout(()=>{targetColor="black"==targetColor?"#990000":"black",wallColor="#990000"==wallColor?"#ff4444":"#990000"},200*a)}}else bulletlist[f].x>=ctxS.width&&(delete bulletlist[f],spdConst=1,totalBullets--)},infoBox=function(a){ctx.save(),ctx.fillStyle="black",ctx.font="25px Georgia",ctx.fillRect(0,0,ctxS.width,ctxS.height),ctx.fillStyle="white";for(let b=0;b<a[0].length;b++)ctx.fillText(a[0][b],20,30*(b+1));ctx.fillStyle="red",ctx.beginPath(),ctx.arc(ctxS.width-30,30,25,0,2*Math.PI,!0),ctx.fill(),ctx.fillStyle="white",ctx.fillText("X",ctxS.width-40,38),ctx.restore()};var gmin=0,gsec=0;startTimer=function(a){function b(){c=a-(0|(Date.now()-f)/1e3),d=0|c/60,e=0|c%60,console.log(c),c||(alert("Game Over"),location.reload(!0)),gmin=d=10>d?"0"+d:d,gsec=e=10>e?"0"+e:e,0>=c&&(f=Date.now()+1e3)}var c,d,e,f=Date.now();b(),setInterval(b,1e3)},window.onload=function(){startTimer(480)};player.s1x=100,stage1=function(){if(ctx.save(),TextS1=[["Go to the controller and","Press 1, 2, 3 or 4 to lock or unlock the bars[Obstacles]","different bars gets locked or unlocked on certain key[1,2,3,4] press","Figure it out with which key[1,2,3,4] press cause bar/bars to respond","understand the pattern and unlock it","with a 3 digit code to get the GUN","fun fact :- You can press keys[1,2,3,4] only 6 times to lock or unlock the bars","You can reset the position of bars and get one more chance to press the keys 6 more times","by pressing 'r'.If you press the r second time, the code to unlock the doors will be changed"]],TextS2=[["Remember","you have to find the pattern","Press i to see the","info box again"]],!0==showText1)infoBox(TextS1);else{!0==player.pressingRight&&(player.s1x+=player.xspd),!0==player.pressingLeft&&(player.s1x-=player.xspd);const a=centerPlay("s1x",player.mapSizeS1);mapMovement(xMovement,"s1x",player.mapSize,1,TextS2,"27px Georgia"),800<=player.s1x+player.width&&(totalBulletsFired=6,holdGun=!0),!0==holdGun?drawGun(a):drawGun(),!0==holdKey&&drawKey(a),stayInBoundary("s1x",0,player.mapSizeS1,"map");for(let a=0;4>a;a++)stayInBoundary("s1x",blockInitialPosition+40*a,blockInitialPosition+40*a,"block",block[`b${a+1}`]);ctx.drawImage(document.getElementById("svg"),0,0,219,375,a,120,player.width,player.height)}ctx.restore()},player.s2x=100,player.s2y=120,stage2=function(){ctx.save(),TextS2=[["Press Space to fire bullets",`No of times you can can hit the wall : ${totalBullets}`,`NO. of times you have to hit the moving black box : ${targetHit}`,"To enter the third round"]];let a=newSizeCanvas();const b=centerPlay("s2x",player.mapSizeWidthS2);for(let c in mapMovement(xMovement,"s2x",player.mapSize,1,TextS2,"27px Georgia"),targetHit&&drawEnemyWall(a),!0==holdGun&&drawGun(b,player.s2y-180+player.height/3),!0==holdKey&&drawKey(b),bulletlist)bulletlist[c].update(bulletlist[c],"s2");ctx.drawImage(document.getElementById("svg"),0,0,219,375,b,player.s2y,player.width,player.height),ctx.restore()},newSizeCanvas=function(){document.getElementById("body");return[player.mapSizeWidthS2=ctxS.width=1280,player.mapSizeHeightS2=ctxS.height=600]},player.s3x=100,player.s3y=120,targetY1=0,targetY2=0,targetY3=0;var targetBlinking=!1;fillStyleTargetS3=["#ff7777","#ff7777","#ff7777"],stage3=function(){ctx.save(),TextS2=[["HIT the three circular bubbles"]],!0==player.pressingTop&&(player.s3y-=player.yspd),!0==player.pressingBottom&&(player.s3y+=player.yspd);let a=newSizeCanvas();const b=centerPlay("s3x",player.mapSizeWidthS2);for(let c in mapMovement(xMovement,"s3x",player.mapSize,1,TextS2,"20px Georgia"),drawObstacles(a),drawTarget(a),stayInBoundary("s3x",0,player.mapSizeWidthS2,"map",!0,"s3y",a[1]),!0==holdGun&&drawGun(b,player.s3y-180+player.height/3),!0==holdKey&&drawKey(b,player.s3y),bulletlist)bulletlist[c].update(bulletlist[c],"s3");ctx.drawImage(document.getElementById("svg"),0,0,219,375,b,player.s3y,player.width,player.height),ctx.restore()},drawObstacles=function(a){for(let b=1;4>b;b++)ctx.drawImage(images.bg,a[0]-150-2*(b*targets.s3Width),turnBack(a,`s3y${b}`,`s3y${b}spd`,`s3x${b}`,"s3Width","s3Height"),targets.s3Width,targets.s3Height),bulletTargetCollisionCheck(`s3y${b}`,`s3y${b}spd`,`s3x${b}`,"s3Width","s3Height")},drawTarget=function(a,b=1,c=0){ctx.save(),ctx.lineWidth=6;const d=a[1]/3/2;ctx.beginPath(),ctx.moveTo(a[0]*b-60-xMovement-c,100),ctx.lineTo(a[0]*b-60-xMovement-c,500),ctx.stroke();for(let e=1;4>e;e++)targetBlinking||bulletTargetCollisionCheck(`s3T${e}y`,0,"s3Tx","s3TWidth","s3THeight"),ctx.fillStyle=fillStyleTargetS3[e-1],ctx.beginPath(),ctx.arc(a[0]*b-100-xMovement-c,a[1]*e/3-d,40,0,2*Math.PI),ctx.fill(),ctx.stroke();ctx.restore()},player.s4x=100,player.s4y=120;var string=[[13,0,15,12,0],[0,9,9,12,0],[20,5,22,12,0],[0,18,2,21,1],[3,18,12,21,0],[13,12,15,46,0],[20,12,22,52,0],[3,43,13,46,0],[34,0,36,38,0],[34,38,36,42,2],[23,42,26,46,3],[27,42,51,46,0],[46,0,51,5,4]],blocks={},gate1=[],gate2=[],gate3=[],gate4=[],blockGate=[],gates={},buttonsSet1=[],gateAccessProhibition1=!0,buttonsSet2=[],gateAccessProhibition2=!0,buttonsSet3=[],gateAccessProhibition3=!0,buttons={},walls={},buttonString=[[6,15,1,0],[8,15,1,1],[10,15,1,2],[12,15,1,3],[26,38,2,0],[28,38,2,1],[30,38,2,2],[32,38,2,3],[41,1,3,0],[45,1,3,1],[43,3,3,2],[41,5,3,3],[45,5,3,4]],wallString=[[13,0,3,46,0],[0,9,10,3,0],[20,5,3,47,0],[0,18,3,3,1],[3,18,9,3,0],[3,43,10,3,0],[34,0,3,38,0],[34,38,3,4,2],[23,42,4,4,3],[27,42,24,4,0],[46,0,6,5,4]],blockSpeed=20,deleteSpeed=60,stage4=function(){ctx.save(),TextS1=[["Welcome to stage 4"]],TextS2=[["Be sure You have everything",["because You won't be able to go back"],["As I had to work as per the theme"]]],!0==player.pressingRight&&(player.s4x+=player.xspd),!0==player.pressingLeft&&(player.s4x-=player.xspd),!0==player.pressingTop&&(player.s4y-=player.yspd),!0==player.pressingBottom&&(player.s4y+=player.yspd);let a=newSizeCanvas();const b=centerPlay("s4x",2*a[0]),c=centerPlayY("s4y",2*a[0]);for(let d in mapMovement(xMovement,"s4x",player.mapSize,1,TextS2,"27px Georgia",yMovement,"s4y"),stayInBoundary("s4x",0,2*a[0],"map",!0,"s4y",2*a[0]),drawTrack(xMovement,yMovement),drawMovingBubbles(9,38,-xMovement,-yMovement),!0==holdKey?drawKey(b,c-180+player.height/3):drawKey(),!0==holdGun&&drawGun(b,c-player.s5y),bulletlist)bulletlist[d].update(bulletlist[d],"s4",-xMovement,-yMovement);drawText(0,20,[`Buttons click left ${buttonLimit} & button Reset ${buttonResetLimit} 
                Press b to reset`],"30px Georgia",0,20),ctx.drawImage(document.getElementById("svg"),0,0,219,375,b,c,player.width,player.height),ctx.restore()};drawKey=function(a=0,b=0){ctx.save();let c=2350-xMovement;y=100-yMovement;let d=1;!0==holdKey&&(c=a+2*player.width/3,y=200+b,d=.4),ctx.fillStyle="yellow",ctx.beginPath(),ctx.arc(c,y,30*d,0,2*Math.PI),ctx.fill(),ctx.fillRect(c,y-15*d,145*d,15*d),ctx.fillRect(c+130*d,y,15*d,40*d),ctx.fillRect(c+100*d,y,15*d,30*d),ctx.fillRect(c+70*d,y,15*d,40*d),ctx.restore()};var wallBoundaries=function(){for(let a=0;a<wallString.length;a++)self={id:Math.random(),x:50*wallString[a][0],y:50*wallString[a][1],width:50*wallString[a][2]-10,height:50*wallString[a][3]-10},self.update=function(a){player.s4y+player.height>a.y&&player.s4y<a.y&&player.s4x+player.width>a.x&&player.s4x<a.x+a.width&&(player.s4y-=20==player.xspd?20:5),player.s4y<a.y+a.height&&player.s4y+player.height>a.y+a.height&&player.s4x+player.width>a.x&&player.s4x<a.x+a.width&&(player.s4y+=20==player.xspd?20:5),player.s4x+player.width>a.x&&player.s4x<a.x&&player.s4y+player.height>a.y&&player.s4y<a.y+a.height&&(player.s4x-=20==player.xspd?20:5),player.s4x<a.x+a.width&&player.s4x+player.width>a.x+a.width&&player.s4y+player.height>a.y&&player.s4y<a.y+a.height&&(player.s4x+=20==player.xspd?20:5)},walls[self.id]=self,wallString[a][4]&&(blockGate[wallString[a][4]-1]=self.id)},drawTrack=function(a,b){for(let c in blocks)blocks[c].update(blocks[c],a,b);for(let c in gates)gates[c].update(gates[c],a,b);for(let c in buttons)buttons[c].update(buttons[c],a,b);for(let c in walls)walls[c].update(walls[c]);buttons[buttonsSet1[0]].blink&&buttons[buttonsSet1[1]].blink&&buttons[buttonsSet1[2]].blink&&buttons[buttonsSet1[3]].blink&&gateAccessProhibition1&&(gateAccessProhibition1=!1,delete walls[blockGate[0]],delB(gate1)),buttons[buttonsSet2[0]].blink&&buttons[buttonsSet2[1]].blink&&buttons[buttonsSet2[2]].blink&&buttons[buttonsSet2[3]].blink&&gateAccessProhibition2&&(gateAccessProhibition2=!1,delete walls[blockGate[1]],delete walls[blockGate[2]],delB(gate2),delB(gate3)),buttons[buttonsSet3[0]].blink&&buttons[buttonsSet3[1]].blink&&buttons[buttonsSet3[2]].blink&&buttons[buttonsSet3[3]].blink&&gateAccessProhibition3&&(gateAccessProhibition3=!1,delete walls[blockGate[3]],delB(gate4)),!holdKey&&2350<player.s4x&&100>player.s4y&&(holdKey=!0)},randomBlockGenerator=function(){var b=0,c=string[b][0],d=string[b][1],e=!0,f=0,g=setInterval(()=>{var a=0==string[b][4]?"#e14c21":"purple";generateBlock(c,d,a,string[b][4],f),!0==e?c++:c--,c>string[b][2]&&(e=!1,c--,d++),c<string[b][0]&&(e=!0,c++,d++),f++,d==string[b][3]&&(++b<string.length?(c=string[b][0],d=string[b][1],f=0,e=!0):clearInterval(g))},blockSpeed)},generateBlock=function(a,b,c,d,e,f=40,g=40){ctx.save(),self={id:Math.random(),x:a,y:b,width:f,height:g,color:c},self.update=function(a,b,c){ctx.save(),ctx.fillStyle=a.color,ctx.fillRect(50*a.x-b,50*a.y-c,a.width,a.height),ctx.restore()},1==d?gate1[e]=self.id:2==d?gate2[e]=self.id:3==d?gate3[e]=self.id:4==d&&(gate4[e]=self.id),d?gates[self.id]=self:blocks[self.id]=self,ctx.restore()},generateButtons=function(){for(let a=0;a<buttonString.length;a++)drawButtons(buttonString[a][0],buttonString[a][1],buttonString[a][2],buttonString[a][3]);var a=setInterval(()=>{for(let a in buttons)buttons[a].blink&&(buttons[a].fill="#ff7777"==buttons[a].fill?"red":"#ff7777");enterStage4||clearInterval(a)},300)},drawButtons=function(a,b,c,d){self={id:Math.random(),x:a,y:b,fill:"#ff7777",blink:!1},self.update=function(a,b,c){ctx.save(),ctx.lineWidth=4,ctx.fillStyle=a.fill,ctx.beginPath(),ctx.arc(50*a.x-b,50*a.y-c,40,0,2*Math.PI),ctx.fill(),ctx.stroke(),ctx.restore()},1==c?buttonsSet1[d]=self.id:2==c?buttonsSet2[d]=self.id:3==c&&(buttonsSet3[d]=self.id),buttons[self.id]=self},delB=function(a){let b,c=0;b=setInterval(()=>{delete gates[a[c++]],c>=a.length&&clearInterval(b)},deleteSpeed)},radius=110,radiusConstant=1,add=!0,drawMovingBubbles=function(a=1,b=3,c=0,d=0){ctx.save(),150<radius?add=!1:100>radius&&(add=!0),add?radius+=radiusConstant:radius-=radiusConstant,ctx.lineWidth=6,ctx.fillStyle="#ff7777",ctx.beginPath(),ctx.arc(50*a+c,50*b+d,radius,0,2*Math.PI),ctx.stroke(),ctx.fill(),ctx.restore()};buttonReset=function(){0<buttonResetLimit?(buttons[buttonsSet1[0]].blink=!1,buttons[buttonsSet1[1]].blink=!0,buttons[buttonsSet1[2]].blink=!1,buttons[buttonsSet1[3]].blink=!0,buttons[buttonsSet2[0]].blink=!1,buttons[buttonsSet2[1]].blink=!0,buttons[buttonsSet2[2]].blink=!1,buttons[buttonsSet2[3]].blink=!0,buttons[buttonsSet3[0]].blink=!1,buttons[buttonsSet3[1]].blink=!0,buttons[buttonsSet3[2]].blink=!1,buttons[buttonsSet3[3]].blink=!0,buttons[buttonsSet3[4]].blink=!1,buttonLimit=6,buttonResetLimit--):(buttonsSet1.shuffle(),buttonsSet1.shuffle(),buttonsSet2.shuffle(),buttonResetLimit=2,buttonReset())},player.s5x=100,player.s5y=120;var allowMovement=!1,direction=!0,buttonResetLimit=2;stage5=function(){ctx.save(),TextS1=[["Welcome to stage 5"]],TextS2=[["you know this stage has everything",["that you saw 'back' in every previous stage"]]],allowMovement&&(!0==player.pressingRight&&(player.s5x+=player.xspd),!0==player.pressingLeft&&(player.s5x-=player.xspd),!0==player.pressingTop&&(player.s5y-=player.yspd),!0==player.pressingBottom&&(player.s5y+=player.yspd));let a=newSizeCanvas();const b=centerPlay("s5x",2*a[0]-170);for(let c in mapMovement(xMovement,"s5x",2*a[0]-170,1,TextS2,"27px Georgia"),drawTarget(a),drawTarget(a,2,170),1500<=player.s5x&&drawText(20-xMovement,1140,["WINNER"],"300px Georgia",270,10),allowMovement||upDown(),checkForMovement(),!0==holdGun&&drawGun(b,player.s5y-180+player.height/3),bulletlist)bulletlist[c].update(bulletlist[c],"s5",-xMovement);stayInBoundary("s5x",0,2*a[0]-170,"map",!0,"s5y",a[1]);for(let a=0;4>a;a++)stayInBoundary("s5x",200+blockInitialPosition+40*a,200+blockInitialPosition+40*a,"block",block[`b${a+1}`]);bulletBlockCollisionCheck(a[0]),ctx.drawImage(document.getElementById("svg"),0,0,219,375,b,player.s5y,player.width,player.height),ctx.restore()},bulletBlockCollisionCheck=function(a){for(let b in bulletlist)for(let c=0;4>c;c++)if(block[`b${c+1}`]){if(bulletlist[b].x>=200+blockInitialPosition+40*c&&"s5"==bulletlist[b].from){delete bulletlist[b],spdConst=1;break}else 1==spdConst&&400<=bulletlist[b].x&&(spdConst=.1);}else if(bulletlist[b].x>=a){delete bulletlist[b],spdConst=1;break}else(!(1100>bulletlist[b].x)||!(800<bulletlist[b].x))&&(block.b1||block.b2||block.b3||block.b4)||(spdConst=1)},checkForMovement=function(){"red"==fillStyleTargetS3[0]&&"red"==fillStyleTargetS3[1]&&"red"==fillStyleTargetS3[2]&&(allowMovement=!0)},upDown=function(){checkForMovement(),0>=player.s5y&&(direction=!0),600<=player.s5y+player.height&&(direction=!1),direction?player.s5y+=5*spdConst:player.s5y-=5*spdConst};var frames=setInterval(()=>{update()},30);function update(){drawPlayer()}