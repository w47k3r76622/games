const scenes={sceneText:{0:'CONSCIOUS',1:['"...family?"','"...accident"','"...lost..."'],2:['"...ok?"','"...comatose"','"...monitoring..."'],3:['"condition not..."','"...last the night?"','"come back..."'],4:['"...stabilizing"','"we love you..."','"can...hear us?"'],5:['"See that...finger twitch!"','"...GET THE DOCTOR!"','"Don\'t give up..."'],win:'Welcome back'}};kontra.init(),kontra.assets.load().then(()=>{function a(t,u){var v=5>=c.level?(c.level+1)/2:c.level/4;var w=4e-3,x={x:(u.x-t.x)*w*v,y:(u.y-t.y)*w*v};return x}function b(){for(var t=kontra.canvas.height-20,u=kontra.canvas.width-20,v={x:u/2,y:t/2},w=0;1>w;w++){var x=''+Math.round(Math.random())+Math.round(Math.random()),y;y='00'==x?{x:Math.random()*u,y:0}:'01'==x?{x:Math.random()*u,y:t}:'10'==x?{x:0,y:Math.random()*u}:'11'==x?{x:u,y:Math.random()*t}:{x:0,y:0};var z=a(y,v);q.get({x:y.x,y:y.y,dx:z.x,dy:z.y,color:'blue',radius:20,ttl:Infinity,speed:0,type:'enemy',update:function(){o(this)?(this.ttl=0,g.points+=1,p()):n(this,e)&&(g.points-=1,0>g.points&&(h.livesLeft-=1,g.points=0),this.ttl=0),p(),this.advance()},render:function(){this.context.fillStyle=this.color,this.context.beginPath(),this.context.arc(this.x,this.y,this.radius,0,2*Math.PI),this.context.fill()}})}}let c={isPaused:!1,level:0,islevelTransition:!0,completedLevel:!1};const d={lightness:0};let e=kontra.sprite({x:400,y:300,color:'white',radius:100,render:function(){this.context.fillStyle=this.color,this.context.beginPath(),this.context.arc(this.x,this.y,this.radius,0,2*Math.PI),this.context.fill(),1===c.level&&(this.context.beginPath(),this.context.font='italic 15px Arial',this.context.fillStyle='grey',this.context.fillText(`Left (clockwise) & right (counter-clockwise) keys to move paddle and collect your consciousness.`,100,575))}}),f=kontra.sprite({x:e.x,y:e.y,color:'white',radius:110,lineWidth:6,startAngle:2*Math.PI,angleLength:2*Math.PI/15,update:function(){(kontra.keys.pressed('left')||kontra.keys.pressed('a'))&&(this.startAngle+=4*(Math.PI/180)),(kontra.keys.pressed('right')||kontra.keys.pressed('d'))&&(this.startAngle-=4*(Math.PI/180))},render:function(){this.context.lineWidth=this.lineWidth,this.context.beginPath(),this.context.arc(this.x,this.y,this.radius,this.startAngle,this.startAngle+this.angleLength),this.context.strokeStyle=this.color,this.context.stroke()}}),g=kontra.sprite({points:0,x:100,y:100,render:function(){this.context.beginPath(),this.context.font='30px Arial',this.context.fillText(`${this.points}`,this.x,this.y)}}),h=kontra.sprite({livesLeft:3,x:550,y:100,render:function(){this.context.font='25px Arial',this.context.fillText(`Lives left: ${this.livesLeft}`,this.x,this.y)}});const j=function(t,u){t.font='italic 15px Arial',t.fillStyle='grey',t.fillText(`Press space to ${u}.`,320,575)},k=function(t,u){t.font='50px Arial',t.fillStyle='grey',t.fillText(u,250,300)},l=function(t){t.strokeStyle='white',t.lineWidth=2,t.moveTo(0,300),t.lineTo(70,300),t.lineTo(100,200),t.lineTo(130,400),t.lineTo(160,300),t.lineTo(800,300),t.stroke()};let m=kontra.sprite({x:200,y:200,render:function(){if(this.context.beginPath(),this.context.font='30px Arial',this.context.fillStyle='white',this.context.beginPath(),0===c.level)k(this.context,scenes.sceneText[0]),j(this.context,'continue');else if('lose'===c.level)d.lightness=0,kontra.canvas.style.backgroundColor=`hsl(0, 0%, ${d.lightness}%`,l(this.context);else if('win'===c.level)d.lightness=100,kontra.canvas.style.backgroundColor=`hsl(0, 0%, ${d.lightness}%`,document.body.style.backgroundColor=`hsl(0, 0%, ${d.lightness}%`,k(this.context,scenes.sceneText.win),j(this.context,'play again');else{kontra.canvas.style.backgroundColor=`hsl(0, 0%, 0%)`;let t={x:this.x,y:this.y};for(let u=0;u<scenes.sceneText[c.level].length;u++)this.context.fillText(`${scenes.sceneText[c.level][u]}`,t.x+100*u,t.y+100*u);j(this.context,'continue')}}});const n=function(t,u){const v=t.x-u.x,w=t.y-u.y,x=Math.sqrt(v*v+w*w);return x<t.radius+u.radius},o=function(t){const u=t.x-e.x,v=t.y-e.y;let w=Math.atan2(v,u);const x=f.startAngle%(2*Math.PI);return 0>w&&(w=2*Math.PI+w),n(t,f)&&w>x&&w<x+f.angleLength},p=function(){0>g.points||0===h.livesLeft?(c.islevelTransition=!0,c.level='lose'):5<=g.points&&(g.points=0,5===c.level?c.level='win':c.level+=1,c.islevelTransition=!0)},q=kontra.pool({create:kontra.sprite,maxSize:d.MAX_NUM_MEMORIES}),r=function(){c.level=0,c.islevelTransition=!0,d.lightness=0,g.points=0,h.livesLeft=3};let s=kontra.gameLoop({update:()=>{c.islevelTransition?m.update():(q.update(),0===q.getAliveObjects().length&&b(),e.update(),f.update(),g.update(),h.update())},render:()=>{c.islevelTransition?m.render():(q.render(),e.render(),f.render(),g.render(),h.render())}});kontra.keys.bind('esc',()=>{c.isPaused?(c.isPaused=!1,s.start()):(c.isPaused=!0,s.stop())}),kontra.keys.bind('space',()=>{c.islevelTransition&&(0===c.level?c.level+=1:c.islevelTransition=!1,'win'===c.level&&r())}),s.start()}).then(()=>{}).catch(console.error);
