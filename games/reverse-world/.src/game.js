function Point(a,b){this.x=a,this.y=b}function changeKeys(key_type){keys=eval("keys_"+key_type)}function keyToString(a){var b={38:"row up",37:"row left",39:"row right",27:"scape"};return a in b?b[a]:String.fromCharCode(a)}function updateMRU(a,b,c){return a+b*c}function updateMRUV(a,b,c){var d=.9,e={};return e.speed=b+d*c,e.pos=a+b*c+.5*d*Math.pow(c,2),e}function MultidimensionalArray(a){for(var b=[],c=0;a>c;c++)b[c]=[];return b}function MapConf(a,b,c,d,e,f){return conf={start_tile:a,end_tile:b,reverse_tiles:c,reverse_map:d,reverse_gravity:e,non_reverse_tiles:f||[]},conf}function tileToPoint(a,b){var a=a;return new Point(a.x*b+b/2,a.y*b+b/2)}function pointToTile(a,b){return new Point(Math.floor(a.x/b),Math.floor(a.y/b))}function isInArray(a,b){for(var c in a)if(a[c]==b)return!0;return!1}function enemyConf(a,b){var c={pos:new Point(a.x,a.y),speed:b};return c}function loadMaxLevel(){void 0!=localStorage["Reverse World Max Level"]?max_level=localStorage["Reverse World Max Level"]:localStorage["Reverse World Max Level"]=0}function setMaxLevel(a){a>max_level&&(localStorage["Reverse World Max Level"]=a)}function Chrono(){this.start_time=null,this.difference=null,this.min=null,this.seconds=null}function drawWord(a,b,c,d){var e=[];try{b=b.toUpperCase()}catch(f){console.log("Broke")}for(var g=0;g<b.length;g++){var h=letters[b.charAt(g)];h&&e.push(h)}a.fillStyle="black";var i=0;for(g=0;g<e.length;g++){h=e[g];for(var k=0,l=0;l<h.length;l++){for(var m=h[l],n=0;n<m.length;n++)m[n]&&a.fillRect(i+n*c+d.x,l*c+d.y,c,c);k=Math.max(k,m.length*c)}i+=c+k}}function H(){this.A=function(a){for(var b=0;24>b;b++)this[String.fromCharCode(97+b)]=a[b]||0;.01>this.c&&(this.c=.01),a=this.b+this.c+this.e,.18>a&&(a=.18/a,this.b*=a,this.c*=a,this.e*=a)}}function ArcadeAudio(){this.sounds={}}function Animation(a,b){this.element=[],this.nex_step=10,this.timer=4}function AnimationManager(a){this.current_animation=0,this.max_animations=5,this.animation_type=a,this.fill()}function endLevelPointAnimation(a,b,c){var d=endLevelPointAnimation.size;color="purple",a.beginPath(),a.fillStyle=color,a.arc(b.x,b.y+c,d,0,Math.PI/180*360,!1),a.fill(),a.closePath(),0==endLevelPointAnimation.step&&(endLevelPointAnimation.size=++endLevelPointAnimation.size%10),endLevelPointAnimation.step=++endLevelPointAnimation.step%5}function FireAnimation(){Animation.call(this),this.size=10}function IceAnimation(){Animation.call(this),this.max_effect_size=10,this.max_elemtns=10,this.generate(50)}function Events(){this.keys_down={},this.keys_up={},this.last_key=null,this.key_down_listener=null,this.key_up_listener=null,this.key_used=[]}function Particle(a,b,c,d,e,f){this.position=a,this.radius=b,this.life=c,this.speed=d,this.angle=e,this.color=f}function ParticleSystem(a,b,c){this.end=!0,a&&(this.fill(a,b,c),this.end=!1)}function Tile(a,b,c,d,e,f){this.walkable=a,this.color=b,this.size=c,this.is_reversed=!1,this.is_lethal=d,this.reverse=e||this,this.animation=f}function Character(a,b,c){this.world=c,this.position=a||new Point(0,0),this.speed=new Point(0,0),this.dimensions=b}function Player(a,b){Character.call(this,a,5,b),this.in_the_air=!1,this.parkour_right=!1,this.parkour_left=!1,this.move_right=!1,this.move_left=!1,this.jump=!1,this.is_alive=!1,this.total_deaths=0,this.reverse_map_pressed=!1,this.reverse_tiles_pressed=!1;var c=this;this.action={up:function(){c.jump=!0,console.log("jump")},right:function(){c.move_right=!0},left:function(){c.move_left=!0},no_right:function(){c.move_right=!1},no_left:function(){c.move_left=!1},no_up:function(){c.jump=!1},reverse_map:function(){c.reverse_map_pressed||(c.world.map.reverseMap(),c.reverse_map_pressed=!0)},no_reverse_map:function(){c.reverse_map_pressed=!1},reverse_tiles:function(){c.reverse_tiles_pressed||(c.world.map.reverseTiles(),c.reverse_tiles_pressed=!0)},no_reverse_tiles:function(){c.reverse_tiles_pressed=!1}},this.keys={up:keys.up,right:keys.right,left:keys.left,reverse_map:keys.reverse_map,reverse_tiles:keys.reverse_tiles}}function Enemy(a,b,c){var d=tileToPoint(a,c.tile_size);Character.call(this,d,10,c),this.position.y=(Math.floor(this.position.y/this.world.tile_size)+1)*this.world.tile_size-this.dimensions,this.speed.x=b}function Map(a,b,c,d,e,f){if(!b)throw"Error map conf";this.tiles_type=c,this.map=a,this.current_map=this.map[0],this.n_current_map=0,this.is_reversed_tiles=!1,this.is_reversed=!1,this.reverse_map=null,this.conf=b,this.tile_dimensions=d,this.enemy=e,this.current_enemy=[],this.world=f,this.createReverseMap()}function Button(a,b,c,d){this.name=a,this.width=b,this.height=c,this.action=d,this.activated=!1}function Menu(a,b,c,d){this.button=a,this.curren_buton=0,this.button[this.curren_buton].activated=!0,this.title=b,this.background_color=null,this.events=c,this.draw_type=d}function MenuManager(a,b){this.menu=[],this.event=new Events,this.canvas=document.getElementById(a),this.ctx=this.canvas.getContext("2d"),this.current_menu=0,b&&this.fill(b),this.timer=null,this.running=!1}function World(a,b,c,d,e,f,g){this.canvas=document.getElementById(a),this.ctx=this.canvas.getContext("2d"),this.type_tiles=e,this.tile_size=f,this.map=new Map(b,c,e,this.tile_size,d,this),this.player=new Player(new Point(0,0),this),this.enemy=null,this.event=new Events,this.chrono=new Chrono,this.running=!1,this.time_out=null,this.callback=g,this.player_die_animation=new ParticleSystem,this.enemy_die_animation=[]}Point.prototype.equals=function(a){return this.x==a.x&&this.y==a.y},Point.prototype.random=function(a,b){this.x=Math.random()*a,this.y=Math.random()*b};var keys_a={up:38,right:39,left:37,reverse_map:82,reverse_tiles:69},keys_b={up:87,right:68,left:65,reverse_map:80,reverse_tiles:79},keys=keys_a,max_level=null;Chrono.prototype.start=function(){this.start_time=(new Date).getTime(),this.min=0,this.seconds=0},Chrono.prototype.step=function(){var a=(new Date).getTime();this.difference=(a-this.start_time)/1e3/60,this.updateMinAndSecons()},Chrono.prototype.updateMinAndSecons=function(){this.min=Math.floor(this.difference),this.seconds=Math.floor(60*this.difference%60)},Chrono.prototype.toString=function(){return(this.min<10?"0":"")+this.min+":"+(this.seconds<10?"0":"")+this.seconds};var letters=letters={A:[[,1],[1,,1],[1,,1],[1,1,1],[1,,1]],B:[[1,1],[1,,1],[1,1,1],[1,,1],[1,1]],C:[[1,1,1],[1],[1],[1],[1,1,1]],D:[[1,1],[1,,1],[1,,1],[1,,1],[1,1]],E:[[1,1,1],[1],[1,1,1],[1],[1,1,1]],F:[[1,1,1],[1],[1,1],[1],[1]],G:[[,1,1],[1],[1,,1,1],[1,,,1],[,1,1]],H:[[1,,1],[1,,1],[1,1,1],[1,,1],[1,,1]],I:[[1,1,1],[,1],[,1],[,1],[1,1,1]],J:[[1,1,1],[,,1],[,,1],[1,,1],[1,1,1]],K:[[1,,,1],[1,,1],[1,1],[1,,1],[1,,,1]],L:[[1],[1],[1],[1],[1,1,1]],M:[[1,1,1,1,1],[1,,1,,1],[1,,1,,1],[1,,,,1],[1,,,,1]],N:[[1,,,1],[1,1,,1],[1,,1,1],[1,,,1],[1,,,1]],O:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],P:[[1,1,1],[1,,1],[1,1,1],[1],[1]],Q:[[0,1,1],[1,,,1],[1,,,1],[1,,1,1],[1,1,1,1]],R:[[1,1],[1,,1],[1,,1],[1,1],[1,,1]],S:[[1,1,1],[1],[1,1,1],[,,1],[1,1,1]],T:[[1,1,1],[,1],[,1],[,1],[,1]],U:[[1,,1],[1,,1],[1,,1],[1,,1],[1,1,1]],V:[[1,,,,1],[1,,,,1],[,1,,1],[,1,,1],[,,1]],W:[[1,,,,1],[1,,,,1],[1,,,,1],[1,,1,,1],[1,1,1,1,1]],X:[[1,,,,1],[,1,,1],[,,1],[,1,,1],[1,,,,1]],Y:[[1,,1],[1,,1],[,1],[,1],[,1]],Z:[[1,1,1,1,1],[,,,1],[,,1],[,1],[1,1,1,1,1]],0:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],1:[[,1],[,1],[,1],[,1],[,1]],2:[[1,1,1],[,,1],[1,1,1],[1,,],[1,1,1]],3:[[1,1,1],[,,1],[1,1,1],[,,1],[1,1,1]],4:[[1,,1],[1,,1],[1,1,1],[,,1],[,,1]],5:[[1,1,1],[1,,],[1,1,1],[,,1],[1,1,1]],6:[[1,1,1],[1,,],[1,1,1],[1,,1],[1,1,1]],7:[[1,1,1],[,,1],[,,1],[,,1],[,,1]],8:[[1,1,1],[1,,1],[1,1,1],[1,,1],[1,1,1]],9:[[1,1,1],[1,,1],[1,1,1],[,,1],[1,1,1]],":":[[,1],[,1],[,,],[,1],[,1]]," ":[[,,],[,,],[,,],[,,],[,,]]},standard_size=4,U=new function(){this.z=new H;var a,b,c,d,e,f,g,h,i,j,k,l;this.reset=function(){var a=this.z;d=100/(a.f*a.f+.001),e=100/(a.g*a.g+.001),f=1-.01*a.h*a.h*a.h,g=1e-6*-a.i*a.i*a.i,a.a||(k=.5-a.n/2,l=5e-5*-a.o),h=1+a.l*a.l*(0<a.l?-.9:10),i=0,j=1==a.m?0:2e4*(1-a.m)*(1-a.m)+32},this.C=function(){this.reset();var d=this.z;return a=1e5*d.b*d.b,b=1e5*d.c*d.c,c=1e5*d.e*d.e+12,3*((a+b+c)/3|0)},this.B=function(m,n){var o=this.z,p=1!=o.s||o.v,q=.1*o.v*o.v,r=1+3e-4*o.w,s=.1*o.s*o.s*o.s,t=1+1e-4*o.t,u=1!=o.s,v=o.x*o.x,w=o.g,x=o.q||o.r,y=.2*o.r*o.r*o.r,z=o.q*o.q*(0>o.q?-1020:1020),A=o.p?(2e4*(1-o.p)*(1-o.p)|0)+32:0,B=o.d,C=o.j/2,D=.01*o.k*o.k,E=o.a,F=a,G=1/a,H=1/b,I=1/c,o=5/(1+20*o.u*o.u)*(.01+s);o>.8&&(o=.8);for(var P,R,T,V,X,o=1-o,J=!1,K=0,L=0,M=0,N=0,O=0,Q=0,S=0,U=0,W=0,Y=0,Z=Array(1024),$=Array(32),_=Z.length;_--;)Z[_]=0;for(_=$.length;_--;)$[_]=2*Math.random()-1;for(_=0;n>_;_++){if(J)return _;if(A&&++W>=A&&(W=0,this.reset()),j&&++i>=j&&(j=0,d*=h),f+=g,d*=f,d>e&&(d=e,w>0&&(J=!0)),R=d,C>0&&(Y+=D,R*=1+Math.sin(Y)*C),R|=0,8>R&&(R=8),E||(k+=l,0>k?k=0:k>.5&&(k=.5)),++L>F)switch(L=0,++K){case 1:F=b;break;case 2:F=c}switch(K){case 0:M=L*G;break;case 1:M=1+2*(1-L*H)*B;break;case 2:M=1-L*I;break;case 3:M=0,J=!0}x&&(z+=y,T=0|z,0>T?T=-T:T>1023&&(T=1023)),p&&r&&(q*=r,1e-5>q?q=1e-5:q>.1&&(q=.1)),X=0;for(var aa=8;aa--;){if(S++,S>=R&&(S%=R,3==E))for(P=$.length;P--;)$[P]=2*Math.random()-1;switch(E){case 0:V=k>S/R?.5:-.5;break;case 1:V=1-2*(S/R);break;case 2:V=S/R,V=6.28318531*(V>.5?V-1:V),V=1.27323954*V+.405284735*V*V*(0>V?1:-1),V=.225*((0>V?-1:1)*V*V-V)+V;break;case 3:V=$[Math.abs(32*S/R|0)]}p&&(P=Q,s*=t,0>s?s=0:s>.1&&(s=.1),u?(O+=(V-Q)*s,O*=o):(Q=V,O=0),Q+=O,N+=Q-P,V=N*=1-q),x&&(Z[U%1024]=V,V+=Z[(U-T+1024)%1024],U++),X+=V}X*=.125*M*v,m[_]=X>=1?32767:-1>=X?-32768:32767*X|0}return n}};window.jsfxr=function(a){U.z.A(a);var b=U.C(),a=new Uint8Array(4*((b+1)/2|0)+44),b=2*U.B(new Uint16Array(a.buffer,44),b),c=new Uint32Array(a.buffer,0,44);c[0]=1179011410,c[1]=b+36,c[2]=1163280727,c[3]=544501094,c[4]=16,c[5]=65537,c[6]=44100,c[7]=88200,c[8]=1048578,c[9]=1635017060,c[10]=b;for(var b=b+44,c=0,d="data:audio/wav;base64,",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";b>c;c+=3)var f=a[c]<<16|a[c+1]<<8|a[c+2],d=d+(e[f>>18]+e[f>>12&63]+e[f>>6&63]+e[63&f]);return d},ArcadeAudio.prototype.add=function(a,b,c){this.sounds[a]=[],c.forEach(function(c,d){this.sounds[a].push({tick:0,count:b,pool:[]});for(var e=0;b>e;e++){var f=new Audio;f.src=jsfxr(c),this.sounds[a][d].pool.push(f)}},this)},ArcadeAudio.prototype.play=function(a){var b=this.sounds[a],c=b.length>1?b[Math.floor(Math.random()*b.length)]:b[0];c.pool[c.tick].play(),c.tick<c.count-1?c.tick++:c.tick=0};var sound=new ArcadeAudio;sound.add("enemy collision",2,[[0,,.01,,.4384,.2,,.12,.28,1,.65,,,.0419,,,,,1,,,,,.7],[0,,.16,.18,.18,.47,.0084,-.26,,,,,,.74,-1,,-.76,,1,,,,,.7],[3,.416,.01,7e-4,.7888,.2095,,-.4258,.3622,.0059,.974,-.6585,.9994,,.0026,.8715,-.5074,.0024,.6412,.0723,.9087,.0028,,.7]]),sound.add("jump",2,[[0,,.2924,,.293,.4953,,.186,,,,,,.4419,,,,,1,,,,,.5],[0,,.3207,,.2198,.3493,,.1111,,,,,,.1762,,,,,.7561,,,.0578,,.5],[0,,.201,,.1722,.4551,,.1751,,,,,,.5608,,,,,.7395,,,,,.5],[0,,.115,,.1937,.4699,,.2536,,,,,,.0368,,,,,1,,,.2923,,.5]]),sound.add("damage",2,[[3,.0014,.4585,.4709,.9125,.5115,,.0034,.0032,.2743,.2059,.4905,.9914,.1378,-.8535,.8741,-.9957,.8661,.7004,.1646,.0784,.0294,-.0086,.7],[3,,.0138,,.2701,.4935,,-.6881,,,,,,,,,,,1,,,,,.7],[0,,.0639,,.2425,.7582,,-.6217,,,,,,.4039,,,,,1,,,,,.7],[3,,.0948,,.2116,.7188,,-.6372,,,,,,,,,,,1,,,.2236,,.25],[3,,.1606,.5988,.2957,.1157,,-.3921,,,,,,,,,.3225,-.2522,1,,,,,.7],[3,.416,.01,7e-4,.7888,.2095,,-.4258,.3622,.0059,.974,-.6585,.9994,,.0026,.8715,-.5074,.0024,.6412,.0723,.9087,.0028,,.7]]),sound.add("burn",2,[[3,.416,.01,7e-4,.7888,.2095,,-.4258,.3622,.0059,.974,-.6585,.9994,,.0026,.8715,-.5074,.0024,.6412,.0723,.9087,.0028,,.7]]),sound.add("lvl",2,[[1,.9876,.6664,.2142,.8339,.5548,,-.3651,-.068,-.4612,-.6212,.0553,.2654,.6906,.0047,.7033,,-.3417,.9778,.084,-.6355,.4507,,.7]]),sound.add("revive",2,[[0,.2138,.3716,5e-4,.7417,.5986,,-.3799,-.6957,-.0543,,.3396,.2935,.261,-.3713,.6473,-.0169,.0024,.2597,.1164,.2496,.4791,,.7],[0,.4579,.064,.025,.0224,.1467,,.2338,.0064,.0304,,-.6727,,.1385,-.7814,-.7199,-.0037,-.0489,.9918,.0266,,.0364,.0371,.7],[2,.24,.254,.1162,.3272,.3786,,.0087,.2178,.9537,.7424,-.0406,-.172,,,,-.5926,.8116,.9999,.1757,.4642,.0932,-.0447,.7]]),AnimationManager.prototype=[],AnimationManager.prototype.fill=function(){this.splice(0,this.length);for(var i=0;i<this.max_animations;i++)this.push(eval("new "+this.animation_type+"()"))},AnimationManager.prototype.draw=function(a,b,c,d,e){this[this.current_animation].draw(a,b,c,d,e),this.nextAnimation()},AnimationManager.prototype.nextAnimation=function(){this.current_animation=++this.current_animation%this.max_animations},endLevelPointAnimation.size=0,endLevelPointAnimation.step=0,FireAnimation.prototype=new Animation,FireAnimation.prototype.constructor=FireAnimation,FireAnimation.prototype.generate=function(a){var b=Math.floor(a/this.size)-1,c=Math.floor(a/this.size)-1;this.element=MultidimensionalArray(c+1);for(var d=c;d>-1;d--)for(var e=b;e>-1;e--){var f="orange",g=Math.abs(e-b/2)*(b/2),h=c-d,i=h+g;0==Math.floor(Math.random()*i)&&(f="red"),this.element[d][e]=f}},FireAnimation.prototype.changeAnimation=function(a){++this.timer%this.nex_step==0&&(this.timer=1,this.generate(a))},FireAnimation.prototype.draw=function(a,b,c,d,e){this.changeAnimation(e);for(var f=0;f<this.element.length;f++)for(var g=0;g<this.element[f].length;g++)a.fillStyle=this.element[f][g],a.fillRect(c*e+g*this.size,b*e+f*this.size+d,this.size,this.size)},IceAnimation.prototype=new Animation,IceAnimation.prototype.constructor=IceAnimation,IceAnimation.prototype.generate=function(a){this.element=[];for(var b=0;b<this.max_elemtns;b++){var c=Math.random()*a,d=Math.random()*a;this.element.push({pos:new Point(c,d),size:3})}},IceAnimation.prototype.changeAnimation=function(a){if(++this.timer%this.nex_step==0){this.timer=1;for(var b=0;b<this.max_elemtns;b++)this.generate(a)}},IceAnimation.prototype.draw=function(a,b,c,d,e){this.changeAnimation(e),a.fillStyle="#A5F2F3",a.fillRect(c*e,b*e+d,e,e),a.fillStyle="white";for(var f=0;f<this.max_elemtns;f++){var g=this.element[f].size;a.fillRect(c*e+this.element[f].pos.x,b*e+d+this.element[f].pos.y,g,g)}},Events.prototype.enableInputs=function(){var a=this;this.key_down_listener=function(b){console.log(b.keyCode),a.keys_down[b.keyCode]=!0,a.last_key=b.keyCode,delete a.keys_up[b.keyCode]},addEventListener("keydown",this.key_down_listener,!1),this.keys_up_listener=function(b){a.keys_up[b.keyCode]=!0,a.last_key=b.keyCode,delete a.keys_down[b.keyCode],delete a.key_used[b.keyCode]},addEventListener("keyup",this.keys_up_listener,!1)},Events.prototype.isNotUsed=function(a){return a in this.keys_down&&!(a in this.key_used)?(this.key_used[a]=!0,!0):!1},Events.prototype.removeInputs=function(){removeEventListener("keydown",this.key_down_listener,!1),removeEventListener("keyup",this.key_up_listener,!1),this.keys_up=[],this.keys_down=[],this.key_used=[]},Events.prototype.addKeyDown=function(a){this.keys_down[a.keyCode]=!0,this.last_key=a.keyCode,delete this.keys_up[a.keyCode]},Events.prototype.addKeyUp=function(a){this.keys_up[a.keyCode]=!0,this.last_key=a.keyCode,delete this.keys_down[a.keyCode]};var N=200;ParticleSystem.prototype=[],ParticleSystem.prototype.fill=function(a,b,c){b=b||"black",c=c||2,this.end=!1;for(var d=0;N>d;d++)this.push(new Particle(new Point(a.x,a.y),c,Math.floor(100*Math.random()),5*Math.random(),Math.floor(360*Math.random()),b))},ParticleSystem.prototype.empty=function(){this.splice(0,this.length)},ParticleSystem.prototype.draw=function(a,b){for(var c=0;c<this.length;c++)a.fillStyle=this[c].color,a.beginPath(),a.arc(this[c].position.x,this[c].position.y+b,this[c].radius,0,2*Math.PI,!0),a.fill()},ParticleSystem.prototype.updatePhysics=function(a){for(var b=0;b<this.length;b++)this[b].life-=a,this[b].life<0?this.splice(b--,1):(this[b].position.x+=Math.cos(this[b].angle)*this[b].speed*a,this[b].position.y+=Math.sin(this[b].angle)*this[b].speed*a);this.length<=0&&(this.end=!0)},Tile.prototype.draw=function(a,b,c,d){this.is_reversed?this.drawReverse(a,b,c,d):this.drawMe(a,b,c,d,this.size)},Tile.prototype.drawMe=function(a,b,c,d){this.animation?this.animation.draw(a,b,c,d,this.size):(a.fillStyle=this.color,a.fillRect(c*this.size,b*this.size+d,this.size,this.size)),a.strokeStyle="black",a.lineWidth=.8,a.strokeRect(c*this.size,b*this.size+d,this.size,this.size)},Tile.prototype.drawReverse=function(a,b,c,d){this.reverse.drawMe(a,b,c,d,this.size)},Tile.prototype.isWalkable=function(){return this.is_reversed?this.isWalkableReverse():this.imWalkable()},Tile.prototype.imWalkable=function(){return this.walkable},Tile.prototype.isWalkableReverse=function(){return this.reverse.imWalkable()},Tile.prototype.isLethal=function(){return this.is_reversed?this.isLethalReverse():this.imLethal()},Tile.prototype.imLethal=function(){return this.is_lethal},Tile.prototype.isLethalReverse=function(){return this.reverse.imLethal()},Character.prototype.getSquarePoints=function(a,b,c,d){var e={},d=d||0;return e.down=Math.floor((b+this.dimensions-1+d)/c),e.up=Math.floor((b-this.dimensions-d)/c),e.left=Math.floor((a-this.dimensions-d)/c),e.right=Math.floor((a+this.dimensions-1+d)/c),e},Character.prototype.collision=function(a){return this.position.x+this.dimensions<a.position.x-a.dimensions||this.position.y+this.dimensions<a.position.y-a.dimensions||this.position.x-this.dimensions>a.position.x+a.dimensions||this.position.y-this.dimensions>a.position.y+a.dimensions?!1:!0},Player.prototype=new Character,Player.prototype.constructor=Player,Player.prototype.updatePhysics=function(a){if(this.is_alive){var b=!1;this.move_right&&(b=!0,this.speed.x=5),this.move_left&&(b=!0,this.speed.x=-5),b||(this.speed.x=0);var c=updateMRU(this.position.x,this.speed.x,1),d=this.world.checkMovement(this.getSquarePoints(c,this.position.y,this.world.tile_size));this.speed.x>0?d["up right"]&&d["down right"]?this.position.x=c:this.position.x=Math.floor(this.position.x+this.dimensions)/this.world.tile_size*this.world.tile_size-this.dimensions:d["up left"]&&d["down left"]?this.position.x=c:this.position.x=Math.floor((this.position.x-this.dimensions+1)/this.world.tile_size)*this.world.tile_size+this.dimensions,this.jump&&this.canJump()&&(this.speed.y=-10,this.in_the_air=!0,sound.play("jump")),d=this.world.checkMovement(this.getSquarePoints(this.position.x,this.position.y,this.world.tile_size,1)),d["down right"]&&d["down left"]&&(this.in_the_air||(this.in_the_air=!0));var e={pos:null,speed:null};this.in_the_air&&(e=updateMRUV(this.position.y,this.speed.y,1),this.speed.y=e.speed,d=this.world.checkMovement(this.getSquarePoints(this.position.x,e.pos,this.world.tile_size)),d["down right"]&&d["down left"]?d["up right"]&&d["up left"]?this.position.y=e.pos:(this.position.y=Math.floor(this.position.y/this.world.tile_size)*this.world.tile_size+this.dimensions,this.speed.y=0):(this.position.y=(Math.floor(this.position.y/this.world.tile_size)+1)*this.world.tile_size-this.dimensions,this.speed.y=0,this.in_the_air=!1))}},Player.prototype.draw=function(a,b){this.is_alive&&(a.fillStyle="black",a.fillRect(this.position.x-this.dimensions,this.position.y+b-this.dimensions,2*this.dimensions,2*this.dimensions),color="white",a.beginPath(),a.fillStyle=color,a.arc(this.position.x,this.position.y+b,2,0,Math.PI/180*360,!1),a.fill(),a.closePath())},Player.prototype.stop=function(){this.move_right=!1,this.move_left=!1,this.jump=!1},Player.prototype.canJump=function(){var a=!1;return this.in_the_air||(a=!0),a},Player.prototype.reverseControls=function(){for(var a=null,b=["up","right","left"],c=b.length,d=["reverse_map","reverse_tiles"],e=d.length,f=0;c>f;f++){var g=Math.floor(Math.random()*c),a=this.keys[b[g]];this.keys[b[g]]=this.keys[b[f]],this.keys[b[f]]=a}for(var f=0;e>f;f++){var g=Math.floor(Math.random()*e),a=this.keys[d[g]];this.keys[d[g]]=this.keys[d[f]],this.keys[d[f]]=a}this.stop()},Player.prototype.die=function(){this.is_alive=!1,this.total_deaths++,sound.play("damage")},Player.prototype.restart=function(a){this.is_alive=!0,this.position.x=a.x,this.position.y=a.y},Player.prototype.orderControls=function(){for(var a in keys)this.keys[a]=keys[a]},Player.prototype.events=function(a){this.keys.right in a.keys_up&&this.action.no_right(),this.keys.left in a.keys_up&&this.action.no_left(),this.keys.up in a.keys_up&&this.action.no_up(),this.keys.reverse_map in a.keys_up&&this.action.no_reverse_map(),this.keys.reverse_tiles in a.keys_up&&this.action.no_reverse_tiles(),this.keys.up in a.keys_down&&this.action.up(),this.keys.right in a.keys_down&&this.action.right(),this.keys.left in a.keys_down&&this.action.left(),this.keys.reverse_map in a.keys_down&&this.action.reverse_map(),this.keys.reverse_tiles in a.keys_down&&this.action.reverse_tiles()},Enemy.prototype=new Character,Enemy.prototype.constructor=Enemy,Enemy.prototype.updatePhysics=function(a){var b=updateMRU(this.position.x,this.speed.x,1),c=this.world.checkMovement(this.getSquarePoints(b,this.position.y,this.world.tile_size));this.speed.x>0?c["up right"]&&c["down right"]?this.position.x=b:(this.position.x=Math.floor((this.position.x+this.dimensions)/this.world.tile_size)*this.world.tile_size-this.dimensions,this.speed.x*=-1):c["up left"]&&c["down left"]?this.position.x=b:(this.position.x=Math.floor((this.position.x-this.dimensions+1)/this.world.tile_size)*this.world.tile_size+this.dimensions,this.speed.x*=-1);var d=updateMRUV(this.position.y,this.speed.y,1);this.speed.y=d.speed,c=this.world.checkMovement(this.getSquarePoints(this.position.x,d.pos+this.dimensions,this.world.tile_size)),c["down right"]&&this.speed.x>0&&(this.speed.x*=-1),c["down left"]&&this.speed.x<0&&(this.speed.x*=-1),c["down right"]&&c["down left"]?this.position.y=d.pos:(this.position.y=(Math.floor(this.position.y/this.world.tile_size)+1)*this.world.tile_size-this.dimensions,this.speed.y=0,this.in_the_air=!1)},Enemy.prototype.getSquarePoints=function(a,b,c){var d={};return d.down=Math.floor((b+this.dimensions-1)/c),d.up=Math.floor((b-this.dimensions)/c),d.left=Math.floor((a-this.dimensions-1)/c),d.right=Math.floor((a+this.dimensions-1)/c),d},Enemy.prototype.draw=function(a,b){a.beginPath(),a.fillStyle="red",a.arc(this.position.x,this.position.y+b,this.dimensions,0,Math.PI/180*360,!1),a.fill(),a.closePath()},Map.prototype.visibleTiles=function(){var a=this.current_map.length,b=Math.floor(this.world.canvas.height/this.tile_dimensions);return b>=a?a:b},Map.prototype.halfVisibility=function(){return Math.floor(this.visibleTiles()/2)},Map.prototype.length=function(){return this.current_map.length},Map.prototype.width=function(){return this.current_map[0].length},Map.prototype.changeCurrentMap=function(a){return a<this.map.length||this.n_current_map+1<this.map.length?(this.restart(),this.current_map=this.map[a>=0?this.n_current_map=a:++this.n_current_map],this.createReverseMap(),this.spawnEnemy(),sound.play("lvl"),!0):!1},Map.prototype.spawnEnemy=function(){this.current_enemy.splice(0,this.current_enemy.length);var a=this.enemy[this.n_current_map];for(var b in a)this.current_enemy.push(new Enemy(a[b].pos,a[b].speed,this.world))},Map.prototype.drawScroll=function(a,b,c,d){for(var e=pointToTile(b,this.tile_dimensions),f=Math.max(0,e.y-this.halfVisibility()-d),g=Math.min(this.length(),e.y+this.halfVisibility()+1-d),h=f;g>h;h++){(0>h||h>this.current_map.length-1)&&alert(h);for(var i=0;i<this.current_map[h].length;i++){if("f"==this.current_map[h][i]);this.tiles_type[this.current_map[h][i]].draw(a,h,i,c)}}var k=this.getEndPoint();endLevelPointAnimation(a,k,c)},Map.prototype.isWalkable=function(a,b){return this.tiles_type[this.current_map[a][b]].isWalkable()},Map.prototype.isLethal=function(a,b){return this.tiles_type[this.current_map[a][b]].isLethal()},Map.prototype.reverseTiles=function(){if(this.conf[this.n_current_map].reverse_tiles){for(var a in this.tiles_type)this.tiles_type[a].is_reversed=!this.tiles_type[a].is_reversed;this.is_reversed_tiles=!this.is_reversed_tiles}},Map.prototype.createReverseMap=function(){this.reverse_map=MultidimensionalArray(this.current_map.length);for(var a=0;a<this.current_map.length;a++)for(var b=this.current_map[a].length-1;b>=0;b--)if(this.conf[this.n_current_map].non_reverse_tiles.length>0){var c=this.conf[this.n_current_map].non_reverse_tiles,d=this.current_map[a].length-1-b;isInArray(c,this.current_map[a][b])||isInArray(c,this.reverse_map[a][d])||isInArray(c,this.current_map[a][d])?this.reverse_map[a][b]=this.current_map[a][b]:this.reverse_map[a][d]=this.current_map[a][b]}else this.reverse_map[a][this.current_map[a].length-1-b]=this.current_map[a][b]},Map.prototype.reverseMap=function(){if(this.conf[this.n_current_map].reverse_map){var a=this.current_map;this.current_map=this.reverse_map,this.reverse_map=a,this.is_reversed=!this.is_reversed,this.reverseEnemy()}},Map.prototype.reverseEnemy=function(){for(var a in this.current_enemy){var b=this.current_enemy[a],c=this.current_map[0].length*this.tile_dimensions-b.position.x,d=pointToTile(new Point(c,b.position.y),this.tile_dimensions);isInArray(this.conf[this.n_current_map].non_reverse_tiles,this.current_map[d.y][d.x])||(b.position.x=c,b.speed.x*=-1)}},Map.prototype.restart=function(){this.is_reversed&&this.reverseMap(),this.is_reversed_tiles&&this.reverseTiles()},Map.prototype.getStartPoint=function(){return tileToPoint(this.conf[this.n_current_map].start_tile,this.tile_dimensions)},Map.prototype.getStartTile=function(){return this.conf[this.n_current_map].start_tile},Map.prototype.getEndPoint=function(){return tileToPoint(this.conf[this.n_current_map].end_tile,this.tile_dimensions)},Map.prototype.getEndTile=function(){return this.conf[this.n_current_map].end_tile},Map.prototype.endLevel=function(){return this.n_current_map>=this.map.length-1};var tile_size=50,path=new Tile(!0,"white",tile_size,!1),ground=new Tile(!1,"brown",tile_size,!1,path),rock=new Tile(!1,"grey",tile_size,!1,null),water=new Tile(!1,"#A5F2F3",tile_size,!1,null,new IceAnimation),fire=new Tile(!1,"red",tile_size,!0,water,new FireAnimation);water.reverse=fire;var special=new Tile(!1,"black",tile_size,!1),all_tiles={g:ground,w:water,p:path,f:fire,r:rock,s:special},map1=[["r","r","r","r","r","r","r","r","r","r","r","r","r"],["r","r","r","r","r","r","r","r","r","r","r","r","r"],["r","r","r","r","r","r","r","r","r","r","r","r","r"],["r","r","p","r","p","p","r","p","p","p","s","r","r"],["r","r","s","s","r","r","r","p","p","r","r","r","r"],["r","r","p","p","p","p","p","p","r","p","s","r","r"],["r","r","r","r","r","r","r","r","r","r","r","r","r"],["r","r","r","r","r","r","r","r","r","r","r","r","r"],["r","r","r","r","r","r","r","r","r","r","r","r","r"],["r","r","r","r","r","r","r","r","r","r","r","r","r"]],map2=[["r","r","r","r","r","r","r","r","r","r","r","r","r"],["r","r","r","r","r","r","r","r","r","r","r","r","r"],["r","r","p","p","p","p","p","p","p","p","r","r","r"],["r","r","r","w","w","f","f","w","w","g","r","r","r"],["r","r","r","r","r","r","r","r","r","g","r","r","r"],["r","r","g","p","p","p","p","p","p","p","r","r","r"],["r","r","p","f","f","f","w","w","w","r","r","r","r"],["r","r","r","r","r","r","r","r","r","r","r","r","r"],["r","r","r","r","r","r","r","r","r","r","r","r","r"],["r","r","r","r","r","r","r","r","r","r","r","r","r"]],map3=[["r","r","r","r","r","r","r","r","r","r","r","r","r"],["r","r","p","g","g","g","g","g","g","g","r","r","r"],["r","r","p","p","p","p","p","g","p","p","r","r","r"],["r","r","g","w","g","g","g","g","g","g","r","r","r"],["r","r","g","g","g","g","g","g","p","r","r","r","r"],["r","r","w","w","w","w","w","w","p","r","r","r","r"],["r","r","p","p","p","p","p","p","p","p","r","r","r"],["r","r","r","w","w","w","w","f","f","f","r","r","r"],["r","r","r","r","r","r","r","r","r","r","r","r","r"],["r","r","r","r","r","r","r","r","r","r","r","r","r"]],map4=[["r","r","r","r","r","r","r","r","r","r"],["r","p","p","p","g","p","p","p","p","r"],["r","r","r","r","r","r","r","r","g","r"],["r","p","p","r","r","p","p","p","g","r"],["r","p","r","r","r","r","r","p","p","r"],["r","p","r","r","r","r","r","r","r","r"],["r","p","p","p","p","p","p","p","p","r"],["r","w","f","f","f","w","w","r","p","r"],["r","r","r","r","r","r","r","r","p","r"],["r","p","p","p","p","r","r","p","p","r"],["r","r","r","r","r","r","r","r","r","r"]],map5=[["r","r","r","r","r","r","r","r","r","r"],["r","p","p","p","g","p","p","p","p","r"],["r","p","w","f","w","f","w","p","s","r"],["r","p","r","r","r","r","r","r","p","r"],["r","g","p","p","p","p","r","r","r","r"],["r","p","r","r","r","r","r","r","r","r"],["r","g","p","p","p","p","p","p","p","r"],["r","p","p","r","r","r","r","s","s","r"],["r","f","p","p","p","p","p","p","p","r"],["r","r","r","r","r","r","r","r","r","r"]],map6=[["r","r","r","r","r","r","r","r","r","r"],["r","p","p","p","p","p","p","r","r","r"],["r","r","w","f","w","f","p","p","r","r"],["r","s","s","s","s","s","w","p","p","r"],["r","s","p","p","p","p","r","f","r","r"],["r","p","p","s","f","g","g","r","r","r"],["r","s","p","p","r","w","g","p","r","r"],["r","p","p","s","r","r","f","p","r","r"],["r","s","p","p","r","p","g","p","r","r"],["r","p","p","s","r","p","f","w","r","r"],["r","s","p","p","r","p","r","r","r","r"],["r","p","p","s","s","p","r","r","r","r"],["r","s","p","p","p","f","r","r","r","r"],["r","p","p","s","r","r","r","r","r","r"],["r","s","p","p","p","s","s","s","s","r"],["r","r","r","f","p","p","p","p","p","r"],["r","p","p","p","r","r","r","r","p","r"],["r","r","p","p","p","p","p","p","p","r"],["r","r","r","r","r","r","r","r","r","r"],["r","r","r","r","r","r","r","r","r","r"]],map7=[["r","r","r","r","r","r","r","r","r","r","r","r","r"],["r","p","p","p","w","f","w","f","f","w","f","r","r"],["r","r","r","p","p","p","p","p","p","p","p","p","r"],["r","r","r","r","r","r","r","r","g","g","g","p","r"],["r","p","p","p","p","p","p","p","p","r","r","r","r"],["r","p","p","r","r","r","r","r","r","r","r","r","r"],["r","r","p","p","p","p","p","p","p","p","p","p","r"],["r","r","r","r","r","r","r","r","r","r","p","p","r"],["r","p","p","p","p","p","p","p","p","p","r","p","r"],["r","r","r","r","r","r","r","r","r","r","r","r","r"]],map8=[["r","r","r","r","r","r","r","r","r","r","r","r","r"],["r","p","p","p","p","p","p","r","r","r","r","r","r"],["r","r","p","r","r","r","p","r","r","r","r","r","r"],["r","r","p","g","p","r","p","r","r","r","r","r","r"],["r","r","f","w","p","r","p","g","p","r","r","r","r"],["r","r","p","r","g","r","f","w","p","r","r","r","r"],["r","r","r","r","w","f","w","w","p","p","p","r","r"],["r","r","p","g","p","g","p","p","r","r","g","r","r"],["r","r","p","p","g","w","f","p","p","p","p","r","r"],["r","r","p","w","w","r","r","r","r","r","g","r","r"],["r","r","p","r","r","r","r","r","r","r","w","r","r"],["r","r","p","p","p","p","p","p","p","p","r","r","r"],["r","r","r","r","r","r","r","r","r","p","r","p","r"],["r","r","p","g","p","g","p","g","p","p","r","p","r"],["r","r","g","w","w","w","w","w","w","g","w","p","r"],["r","r","g","g","w","r","r","r","w","g","w","p","r"],["r","p","r","g","g","w","w","w","g","g","w","p","r"],["r","p","p","r","g","g","g","g","g","w","p","g","r"],["r","r","p","p","r","r","p","r","w","r","r","p","r"],["r","r","g","p","p","p","p","p","p","p","p","g","r"],["r","r","g","r","r","r","r","p","r","r","r","r","r"],["r","r","g","r","r","r","r","p","r","r","r","r","r"],["r","r","g","r","r","r","r","p","p","p","p","r","r"],["r","p","p","p","p","r","r","r","r","r","p","w","r"],["r","r","r","r","r","r","p","p","p","g","p","r","r"],["r","r","r","p","p","p","p","r","w","g","w","r","r"],["r","r","r","p","f","w","f","r","r","r","r","r","r"],["r","r","r","p","g","p","p","g","p","g","p","r","r"],["r","r","r","w","r","w","f","w","w","w","r","r","r"],["r","r","r","r","r","r","r","r","r","r","r","r","r"]],map9=[["r","r","r","r","r","r","r","r","r","r"],["r","p","p","p","p","p","p","p","r","r"],["r","r","f","f","f","r","r","p","g","r"],["r","r","r","r","r","r","r","w","p","r"],["r","r","r","r","r","r","r","g","p","r"],["r","p","p","p","p","p","r","p","w","r"],["r","w","w","f","p","p","r","p","p","r"],["r","p","p","p","p","g","r","w","g","r"],["r","p","p","p","p","f","r","p","p","r"],["r","p","p","p","w","p","r","g","f","r"],["r","p","p","f","p","p","r","p","p","r"],["r","r","p","p","p","p","r","g","g","r"],["r","p","p","f","p","p","r","p","p","r"],["r","p","p","p","p","g","r","w","p","r"],["r","p","p","p","p","f","r","p","g","r"],["r","p","p","p","w","p","r","p","w","r"],["r","p","p","f","p","p","r","p","p","r"],["r","p","g","g","g","p","r","w","p","r"],["r","g","p","p","p","p","r","g","p","r"],["r","w","f","g","f","p","r","p","w","r"],["r","p","p","p","p","g","r","p","g","r"],["r","p","g","f","f","r","r","w","p","r"],["r","f","p","r","r","r","r","p","p","r"],["r","p","g","p","p","p","r","p","g","r"],["r","r","r","w","f","p","r","p","w","r"],["r","p","p","p","p","g","r","g","p","r"],["r","p","r","f","r","r","r","w","p","r"],["r","g","p","p","p","p","p","p","p","r"],["r","r","r","r","r","r","r","r","r","r"],["r","r","r","r","r","r","r","r","r","r"]],map10=[["r","r","r","r","r","r","r","r","r","r"],["r","p","p","p","p","p","p","p","p","r"],["r","s","s","s","r","r","p","p","p","r"],["r","g","g","g","r","r","r","r","r","r"],["r","p","p","p","r","r","r","r","r","r"],["r","p","p","p","r","r","p","p","p","r"],["r","f","f","f","r","r","p","p","p","r"],["r","r","r","g","r","r","p","p","p","r"],["r","r","r","p","r","r","r","r","r","r"],["r","g","r","p","r","r","p","p","p","r"],["r","p","r","r","r","r","r","r","w","r"],["r","p","r","g","r","r","p","p","p","r"],["r","r","r","p","p","p","w","r","r","r"],["r","r","r","r","r","r","r","r","r","r"],["r","r","r","r","r","r","r","r","r","r"]],map11=[["r","r","f","f","w","f","w","r","r","r"],["r","p","p","p","p","p","p","p","p","r"],["r","f","w","w","f","w","f","p","p","r"],["r","p","p","p","p","p","p","p","w","r"],["r","p","p","f","w","f","w","f","r","r"],["r","w","p","p","p","p","p","p","p","r"],["r","r","f","w","f","w","f","p","p","r"],["r","p","p","p","p","p","p","p","w","r"],["r","p","p","f","w","f","w","f","r","r"],["r","w","p","p","p","p","p","p","p","r"],["r","r","f","w","f","w","f","p","p","r"],["r","p","p","p","p","p","p","p","w","r"],["r","p","p","f","w","f","w","f","r","r"],["r","w","p","p","p","p","p","p","p","r"],["r","r","f","w","f","w","f","p","p","r"],["r","p","p","p","p","p","p","p","w","r"],["r","p","p","f","w","f","w","f","r","r"],["r","w","p","p","p","p","p","p","p","r"],["r","r","f","w","f","w","f","p","p","r"],["r","p","p","p","p","p","p","p","w","r"],["r","p","p","f","w","f","w","f","r","r"],["r","w","p","p","p","p","p","p","p","r"],["r","r","f","w","f","w","f","p","p","r"],["r","p","p","p","p","p","p","p","w","r"],["r","p","p","f","w","f","w","f","r","r"],["r","w","p","p","p","p","p","p","p","r"],["r","r","f","w","f","w","f","p","p","r"],["r","p","p","p","p","p","p","p","w","r"],["r","p","p","f","w","f","w","f","r","r"],["r","w","p","p","p","p","p","p","p","r"],["r","r","f","w","f","w","f","p","p","r"],["r","p","p","p","p","p","p","p","w","r"],["r","p","p","f","w","f","w","f","r","r"],["r","w","p","p","p","p","p","p","p","r"],["r","r","f","w","f","w","f","p","p","r"],["r","p","p","p","p","p","p","p","w","r"],["r","p","p","f","w","f","w","f","r","r"],["r","r","p","p","p","p","p","p","p","r"],["r","r","r","r","r","r","r","r","r","r"],["r","r","r","r","r","r","r","r","r","r"]],maps=[map1,map2,map3,map4,map5,map6,map7,map8,map9,map10,map11],map_conf=[MapConf(new Point(2,3),new Point(9,3),!1,!0,!1,["s"]),MapConf(new Point(2,2),new Point(2,5),!0,!1,!1),MapConf(new Point(2,1),new Point(9,6),!0,!0,!0),MapConf(new Point(1,1),new Point(1,9),!0,!0,!0),MapConf(new Point(8,8),new Point(8,1),!0,!0,!0,["s"]),MapConf(new Point(8,17),new Point(1,1),!0,!0,!0,["s"]),MapConf(new Point(1,8),new Point(1,1),!0,!0,!1,["s"]),MapConf(new Point(1,1),new Point(10,27),!0,!1,!0),MapConf(new Point(1,1),new Point(1,5),!0,!1,!0),MapConf(new Point(1,1),new Point(4,12),!0,!0,!0,["s"]),MapConf(new Point(8,37),new Point(1,1),!0,!0,!0,["s"])],enemy=[[enemyConf(new Point(4,5),2)],[],[],[],[enemyConf(new Point(4,6),2)],[enemyConf(new Point(4,15),2)],[enemyConf(new Point(4,3),2)],[enemyConf(new Point(2,11),2),enemyConf(new Point(8,22),4),enemyConf(new Point(1,23),2)],[],[enemyConf(new Point(4,5),-10)],[enemyConf(new Point(5,37),-10),enemyConf(new Point(6,35),-10),enemyConf(new Point(6,35),10),enemyConf(new Point(5,33),-10),enemyConf(new Point(5,33),10),enemyConf(new Point(6,31),-10),enemyConf(new Point(6,31),10),enemyConf(new Point(5,29),-10),enemyConf(new Point(5,29),10),enemyConf(new Point(6,27),-10),enemyConf(new Point(6,27),10),enemyConf(new Point(5,25),-10),enemyConf(new Point(5,25),10),enemyConf(new Point(6,23),-10),enemyConf(new Point(6,23),10),enemyConf(new Point(5,21),-10),enemyConf(new Point(5,21),10),enemyConf(new Point(6,19),-10),enemyConf(new Point(6,19),10),enemyConf(new Point(6,19),3),enemyConf(new Point(5,17),-10),enemyConf(new Point(5,17),10),enemyConf(new Point(5,17),-6),enemyConf(new Point(6,15),-10),enemyConf(new Point(6,15),10),enemyConf(new Point(5,13),-10),enemyConf(new Point(5,13),10),enemyConf(new Point(5,13),-7),enemyConf(new Point(6,11),-10),enemyConf(new Point(6,11),10),enemyConf(new Point(5,9),-10),enemyConf(new Point(5,9),10),enemyConf(new Point(6,7),-10),enemyConf(new Point(6,7),10),enemyConf(new Point(6,7),5),enemyConf(new Point(5,5),-10),enemyConf(new Point(5,5),10),enemyConf(new Point(6,3),-10),enemyConf(new Point(6,3),10),enemyConf(new Point(6,3),-5),enemyConf(new Point(5,1),-10),enemyConf(new Point(5,1),10),enemyConf(new Point(5,1),7),enemyConf(new Point(5,1),-7)]];
Button.prototype.draw=function(a,b){a.strokeStyle="black",a.lineWidth=3,a.strokeRect(b.x,b.y,this.width,this.height),this.activated?a.fillStyle="white":a.fillStyle="DeepSkyBlue",a.fillRect(b.x,b.y,this.width,this.height);var c=b.x+(this.width/2-this.name.length*standard_size/2*standard_size),d=b.y+(this.height/2-12.5);drawWord(a,this.name,standard_size,new Point(c,d))},Menu.prototype.draw=function(a,b,c){a.fillStyle="MediumBlue",a.fillRect(0,0,b,c),title_size=10;var d=0+(b/2-this.title.length*title_size/2*standard_size),e=c/2/2;drawWord(a,this.title,title_size,new Point(d,10));var f="Created by Daniel Fernandez";drawWord(a,f,2,new Point(b-8*(f.length+1),c-15));var g="GitHub danielfdzperez";drawWord(a,g,2,new Point(b-8*(f.length+1),c-50)),this["drawButtons"+this.draw_type](a,b,c,e)},Menu.prototype.drawButtonsCenter=function(a,b,c,d){for(var e in this.button)this.button[e].draw(a,new Point(b/2-this.button[e].width/2,100*e+d))},Menu.prototype.drawButtonsList=function(a,b,c,d){var e=0,f=0,g=5;for(var h in this.button){var i=this.button[h].width+g,j=this.button[h].height+g;this.button[h].draw(a,new Point(i*e+g,f*j+d)),++e*i+g+i>b&&(e=0,f++)}},Menu.prototype.drawButtonsEdited=function(a,b,c,d){},Menu.prototype.nexButton=function(){this.button[this.curren_buton].activated=!1,this.curren_buton=++this.curren_buton%this.button.length,this.button[this.curren_buton].activated=!0},Menu.prototype.previousButton=function(){this.button[this.curren_buton].activated=!1,--this.curren_buton<0&&(this.curren_buton=this.button.length-1),this.button[this.curren_buton].activated=!0},MenuManager.prototype.start=function(){this.event.enableInputs(),this.running=!0,this.loop()},MenuManager.prototype.loop=function(){this.draw(),this.menu[this.current_menu].events(this.event);var a=this;this.running&&(this.timer=setTimeout(function(){a.loop()},10))},MenuManager.prototype.stop=function(){this.event.removeInputs(),clearTimeout(this.timer),this.running=!1},MenuManager.prototype.fill=function(a){this.menu=[];for(var b in a)this.menu.push(a[b])},MenuManager.prototype.changeMenu=function(a){a<this.menu.length&&a>=0&&(this.current_menu=a),a||0==a||(this.current_menu=++this.current_menu%this.menu.length)},MenuManager.prototype.draw=function(){this.menu[this.current_menu].draw(this.ctx,this.canvas.width,this.canvas.height)},MenuManager.prototype.events=function(){};var SCAPE=27,Z=90,X=88;World.prototype.initiateVariables=function(){this.player_die_animation=new ParticleSystem,this.enemy_die_animation=[],this.running=!0},World.prototype.start=function(a){this.newLevel(a||0),this.event.enableInputs(),this.initiateVariables(),this.loop()},World.prototype.stop=function(){this.event.removeInputs(),clearTimeout(this.time_out),this.running=!1,this.callback()},World.prototype.newLevel=function(a){this.map.changeCurrentMap(a)||this.stop(),setMaxLevel(this.map.n_current_map),this.player.stop(),this.restartPlayerPosition(),this.player.orderControls(),this.enemy=this.map.current_enemy,this.chrono.start()},World.prototype.restartPlayerPosition=function(){var a=this.map.getStartPoint();this.player.restart(a)},World.prototype.restartLevel=function(){this.map.restart(),this.restartPlayerPosition(),sound.play("revive")},World.prototype.loop=function(){var a=new Date;this.chrono.step();var b=1;this.update(b),this.draw();var c=new Date,d=1e3/60-(c.getTime()-a.getTime());10>d&&(d=10);var e=this;this.running&&(this.time_out=setTimeout(function(){e.loop()},d)),this.actions()},World.prototype.actions=function(){SCAPE in this.event.keys_down&&this.stop(),this.event.isNotUsed(Z)&&this.newLevel(),this.event.isNotUsed(X)&&this.player.orderControls()},World.prototype.draw=function(){canvas.width=canvas.width;var a=pointToTile(this.player.position,this.tile_size),b=0;a.y<this.map.halfVisibility()?b=a.y-this.map.halfVisibility():a.y>=this.map.length()-this.map.halfVisibility()-1&&(b=a.y+1+this.map.halfVisibility()-this.map.length());var c=null,d=b>0?b-1:b;c=0!=b?50*(this.map.halfVisibility()-a.y+d):50*(this.map.halfVisibility()-this.player.position.y/50),this.map.drawScroll(this.ctx,this.player.position,c,b),this.player.draw(this.ctx,c);for(var e in this.enemy)this.enemy[e].draw(this.ctx,c);for(var e in this.enemy_die_animation)this.enemy_die_animation[e].draw(this.ctx,c);this.player_die_animation.draw(this.ctx,c),drawWord(this.ctx,"Deaths: "+this.player.total_deaths.toString(),standard_size,new Point(0,0));var f=this.map.width()*this.tile_size-75;drawWord(this.ctx,this.chrono.toString(),standard_size,new Point(f,0))},World.prototype.update=function(a){if(!this.player_die_animation.end)return this.player_die_animation.updatePhysics(1),void(this.player_die_animation.end&&this.restartLevel());for(var b in this.enemy)this.enemy[b].updatePhysics(a);if(this.player.events(this.event),this.player.updatePhysics(a),!this.chekPlayerAlive()||this.checkPlayerInsideWalkableTile())return this.player_die_animation.fill(this.player.position),void this.player.die();this.checkPlayerEnemyCollision();for(var b in this.enemy_die_animation)this.enemy_die_animation[b].updatePhysics(a),this.enemy_die_animation[b].end&&this.enemy_die_animation.splice(b,1);this.checkEndLevel()},World.prototype.checkEndLevel=function(){var a=this.player.getSquarePoints(this.player.position.x,this.player.position.y,this.tile_size),b=this.map.getEndTile();return(a.up==b.y&&a.right==b.x||a.up==b.y&&a.left==b.x||a.down==b.y&&a.right==b.x||a.down==b.y&&a.left==b.x)&&this.newLevel(),!1},World.prototype.checkMovement=function(a){var b={};return b["up right"]=this.map.isWalkable(a.up,a.right),b["up left"]=this.map.isWalkable(a.up,a.left),b["down right"]=this.map.isWalkable(a.down,a.right),b["down left"]=this.map.isWalkable(a.down,a.left),b},World.prototype.chekPlayerAlive=function(){var a=this.player.getSquarePoints(this.player.position.x,this.player.position.y,this.tile_size,1),b={};b["up right"]=this.map.isLethal(a.up,a.right),b["up left"]=this.map.isLethal(a.up,a.left),b["down right"]=this.map.isLethal(a.down,a.right),b["down left"]=this.map.isLethal(a.down,a.left);for(var c in b)if(b[c])return!1;return!0},World.prototype.checkPlayerInsideWalkableTile=function(){var a=this.checkMovement(this.player.getSquarePoints(this.player.position.x,this.player.position.y,this.tile_size));for(var b in a)if(!a[b])return!0;return!1},World.prototype.checkPlayerEnemyCollision=function(){for(var a in this.enemy)this.player.collision(this.enemy[a])&&(this.player.reverseControls(),this.enemy_die_animation.push(new ParticleSystem(this.enemy[a].position,"red",this.enemy[a].dimensions/2)),this.enemy.splice(a,1),sound.play("enemy collision"));return!1},function(){function start(){world=new World("canvas",maps,map_conf,enemy,all_tiles,tile_size,function(){createMenu()}),createMenu()}function createMenu(){function button_action(a){return function(){menu.stop(),world.start(a)}}loadMaxLevel();var key={enter:13,up:38,down:40,right:39,left:37,scape:27};menu=new MenuManager("canvas");var start_button=[];start_button.push(new Button("Start",150,60,function(){menu.stop(),world.start()})),start_button.push(new Button("Levels",150,60,function(){menu.changeMenu(1)})),start_button.push(new Button("Controls",150,60,function(){menu.changeMenu(2)}));for(var start_menu_event=function(a){a.isNotUsed(key.enter)&&this.button[this.curren_buton].action(),a.isNotUsed(key.up)&&this.previousButton(),a.isNotUsed(key.down)&&this.nexButton()},menus=[],start_menu=new Menu(start_button,"Reverse World",start_menu_event,"Center"),level_menu_event=function(a){a.isNotUsed(key.enter)&&this.button[this.curren_buton].action(),a.isNotUsed(key.left)&&this.previousButton(),a.isNotUsed(key.right)&&this.nexButton(),a.isNotUsed(key.scape)&&menu.changeMenu(0)},level_button=[],i=0;i<maps.length;i++)max_level>=i?level_button.push(new Button((i+1).toString(),100,80,button_action(i))):level_button.push(new Button("Loked",100,80,function(){}));var level_menu=new Menu(level_button,"Select level",level_menu_event,"List"),controls_button=[];controls_button.push(new Button("Controls A",180,60,function(){changeKeys("a"),menu.changeMenu(0)})),controls_button.push(new Button("Controls B",180,60,function(){changeKeys("b"),menu.changeMenu(0)}));var control_menu=new Menu(controls_button,"Controls",level_menu_event,"Edited");control_menu.drawButtonsEdited=function(ctx,width,height,start_point){var key_conf=null;key_conf=this.button[0].activated?"a":"b";var row=0,col_1=start_point,col_2=col_1+300;key_conf=eval("keys_"+key_conf);for(var i in key_conf)drawWord(ctx,i,standard_size,new Point(col_1,50*row+start_point)),drawWord(ctx,keyToString(key_conf[i]),standard_size,new Point(col_2,50*row+start_point)),row++;drawWord(ctx,"Go back",standard_size,new Point(col_1,50*row+start_point)),drawWord(ctx,"scape",standard_size,new Point(col_2,50*row+start_point));for(var i in this.button)this.button[i].draw(ctx,new Point(i*(this.button[i].width+5)+5,height-this.button[i].height-5))},menus.push(start_menu),menus.push(level_menu),menus.push(control_menu),menu.fill(menus),menu.start()}window.addEventListener("load",start,!1);var menu=null,world=null}();