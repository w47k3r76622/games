"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var socket,mouseDown,player,joinedRoom,maxFPS=60,lastFrameTimeMs=0,screen=3,entityNonce=0,mousePos={},keyDown={},entities={},roundStats=[],gameStats=[],environmentKeys=[],map={},a=document.getElementById("a"),ctx=a.getContext("2d");function resetCTX(){ctx.globalAlpha=1,ctx.font="30px Arial Black",ctx.textAlign="start",ctx.fillStyle="black"}function text(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"#208C30",o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:30,r=(5<arguments.length&&void 0!==arguments[5]&&arguments[5],6<arguments.length&&void 0!==arguments[6]?arguments[6]:"start");ctx.globalAlpha=.6,ctx.font=o+"px Arial Black",ctx.fillStyle=i,ctx.textAlign=r,ctx.fillText(t,e,n),resetCTX()}function square(t,e,n,i){var o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"red",r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:1;ctx.globalAlpha=r,ctx.fillStyle=o,ctx.fillRect(t,e,n,i),resetCTX()}function mouseInBounds(t,e,n,i){return mousePos.x>t&&mousePos.x<t+i&&mousePos.y>e&&mousePos.y<e+n}function entitiesCall(e,n){forObj(entities,function(t){return t[e](n)})}function getEnemies(){return Object.keys(entities).filter(function(t){return t.includes("enemy-")}).map(function(t){return entities[t]})}function addEntity(t,e){return t.nonce=entityNonce,t.namespace=e,entities[e||entityNonce]=t,entityNonce++,t}a.width=window.innerWidth,a.height=window.innerHeight;var Button=function(t){function a(t,e,n,i,o){var r;return _classCallCheck(this,a),(r=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,t,e,30,400,o))).text=n,r.onClick=i,r}return _inherits(a,Entity),a}(),TitleButton=function(t){function c(t,e,n,i,o,r){var s;return _classCallCheck(this,c),(s=_possibleConstructorReturn(this,_getPrototypeOf(c).call(this,a.width/2-200,e,n,o,r))).sideText=i,s.render=function(){var t=this;square(t.x,t.y,t.width,t.height,this.hovered?"#208C80":"#208C30",.6),text(t.text,t.x+20,t.y+20,"black",20,.6),this.hovered&&text("> "+t.sideText,t.x-10,t.y+this.height/2+7,"#208C80",20,1,"right")},s.onResize=function(){this.x=a.width/2-200},s}return _inherits(c,Button),c}(),FullSize=function(t){function n(t){var e;return _classCallCheck(this,n),(e=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,0,0,window.innerHeight,window.innerWidth,t))).timer=0,e.cX=e.width/2,e.cY=e.height/2,e.onResize=function(){this.height=window.innerHeight,this.width=window.innerWidth,this.cX=this.width/2,this.cY=this.height/2},e.onTick=function(){this.timer+=1,60===this.timer&&(this.timer=0)},e}return _inherits(n,Entity),n}(),Background=function(t){function i(t){var e;_classCallCheck(this,i);var n=_assertThisInitialized(_assertThisInitialized(e=_possibleConstructorReturn(this,_getPrototypeOf(i).call(this,t))));return n.render=function(){square(0,0,n.width,n.height,"black"),ctx.fillStyle="#208C30",ctx.globalAlpha=.05;for(var t=function(e){[5,10,15,120].forEach(function(t){return ctx.fillRect(0,15*e+n.timer-200,n.width,t)})},e=0;e<1e3;e++)t(e)},e}return _inherits(i,FullSize),i}(),TitleCard=function(t){function i(t){var e;_classCallCheck(this,i);var n=_assertThisInitialized(_assertThisInitialized(e=_possibleConstructorReturn(this,_getPrototypeOf(i).call(this,t))));return e.render=function(){ctx.globalAlpha=.6,ctx.font="240px Arial Black",ctx.fillStyle="#083F10",this.timer<=30&&ctx.fillText(">",this.width/2+5-440,this.y+5+275),ctx.fillText("LINK",this.width/2-5-280,this.y+5+275),ctx.fillStyle="#208C30",30<=this.timer&&(ctx.globalAlpha=.2),ctx.fillText(">",this.width/2-440,this.y+275),30<=this.timer&&(ctx.globalAlpha=.6),ctx.fillText("LINK",this.width/2-280,this.y+275),ctx.font="24px Arial Black";for(var t=function(e){[80,335].forEach(function(t){ctx.fillText("= ",25*e+n.width/2-455,t)}),[430,-460].forEach(function(t){ctx.fillText("+",t+n.width/2,7*e+88)})},e=0;e<36;e++)t(e);ctx.globalAlpha=1},e}return _inherits(i,FullSize),i}(),CreditsTextOverlay=function(t){function n(t){var e;return _classCallCheck(this,n),(e=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,t))).render=function(){var i=this;["Cody Mikol|https://github.com/codymikol|grey","John Flynn|https://github.com/Neuman968|purple","Morgan Coleman|https://github.com/KingCole22|blue"].forEach(function(t,e){var n=t.split("|");text(n[0],i.cX,440+110*e,void 0,30,1,"center"),text(n[1],i.cX,480+110*e,void 0,25,1,"center"),player.render.call({x:i.cX-395,y:455+110*e,isDead:!1,color:n[2],rotationDegrees:0,width:20,height:20})})},e}return _inherits(n,FullSize),n}(),InstructionsTextOverlay=function(t){function n(t){var e;return _classCallCheck(this,n),(e=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,t))).render=function(){text("MOUSE",this.cX-396,450,"black",15,1,"center"),text("DOWN",this.cX-396,470,"black",15,1,"center"),text("Fire your held Killing Device",this.cX-330,470,void 0,20,1,"start"),text("W A",this.cX-396,560,"black",25,1,"center"),text("S D",this.cX-396,590,"black",25,1,"center"),text("Navigate the Pre-Network Dungeon",this.cX-330,570,void 0,20,1,"start"),text("E",this.cX-396,680,"black",25,1,"center"),text("Pick up Killing Devices scattered about the Pre Network",this.cX-330,680,void 0,20,1,"start")},e}return _inherits(n,FullSize),n}(),dY=440,dX=340;function getStatusVals(t){switch(t){case"TIE":return{color:"#cd7f32",text:"LINK TIE"};case"WINNER":return{color:"gold",text:"VICTORY"};default:return{color:"red",text:"TERMINATED"}}}var NameCollector=function(t){function n(t){var e;return _classCallCheck(this,n),(e=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,t))).name="",e.dirty=!1,e.render=function(){var t=this;square(t.cX-200,345,400,40,"#208C30",1),square(t.cX-195,350,390,30,"black",1),t.timer<30&&text(">",t.cX-190,375,"#208C30",24),this.dirty||text("Enter Name",t.cX-170,373,"#208C30",24),this.dirty&&text(this.name,t.cX-170,373,"#208C30",24)},e.onAnyKeyDown=function(t){10<this.name.length&&"Backspace"!==t||("Backspace"===t&&""!==this.name?this.name=this.name.substring(0,this.name.length-1):1===t.length&&(this.dirty=!0,this.name+=t),socket.emit("update-name",this.name))},e}return _inherits(n,FullSize),n}(),EndGameTextOverlay=function(t){function n(t){var e;return _classCallCheck(this,n),(e=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,t))).render=function(){var o=this;if(0<gameStats.length){var t=gameStats.filter(function(t){return t.nonce===player.nonce})[0].gameStats,e=getStatusVals(t.winStatus);text("".concat(player.name," - ").concat(t.totalWins," Points"),o.width/2-170,425,void 0,16),text("STATUS: ".concat(e.text),o.width/2-300,467,e.color,30),text("Total Kills: ".concat(t.totalKills),o.width/2+100,440,void 0,14),text("Total Accuracy: ".concat(Math.floor(t.totalHits/(t.totalHits+t.totalMisses)*100)||0,"% ").concat(t.totalHits,"/").concat(t.totalHits+t.totalMisses),o.width/2+100,460,void 0,14),text("Total Deaths: ".concat(t.totalDeaths),o.width/2+100,480,void 0,14),getEnemies().forEach(function(e,t){var n=gameStats.filter(function(t){return t.nonce===e.nonce})[0].gameStats,i=getStatusVals(n.winStatus);text("".concat(e.name," - ").concat(n.totalWins," Points"),o.width/2-170,425+110*(t+1),void 0,16),text("STATUS: ".concat(i.text),o.width/2-300,467+110*(t+1),i.color,30),text("Total Kills: ".concat(n.totalKills),o.width/2+100,440+110*(t+1),void 0,14),text("Total Accuracy: ".concat(Math.floor(n.totalHits/(n.totalHits+n.totalMisses)*100)||0,"% ").concat(n.totalHits,"/").concat(n.totalHits+n.totalMisses),o.width/2+100,460+110*(t+1),void 0,14),text("Total Deaths: ".concat(n.roundKills),o.width/2+100,480+110*(t+1),void 0,14)})}},e}return _inherits(n,FullSize),n}(),PlayerListGUI=function(t){function i(t,r,e){var n;_classCallCheck(this,i),(n=_possibleConstructorReturn(this,_getPrototypeOf(i).call(this,t))).hidePlayer=e;var a=_assertThisInitialized(_assertThisInitialized(n));return n.render=function(){joinedRoom&&joinedRoom.countdown;var t="   ";15<=this.timer&&(t=".  "),30<=this.timer&&(t=".. "),45<=this.timer&&(t="...");var e=joinedRoom&&joinedRoom.countdown?"Competitors found, starting game in "+Math.floor(joinedRoom.countdown/tick_rate):"Connection is scarce, you must compete for this privilege, awaiting competition"+t;r&&(e=r),text(e,a.width/2,369,"#208C30",16,1,"center");for(var n=function(e){[410,520,630,740,850].forEach(function(t){text("=",25*e+a.width/2-455,t)})},i=0;i<36;i++)n(i);var o=function(e){[430,-460].forEach(function(t){text("+",t+a.width/2,7*e+320,void 0,24)})};for(i=0;i<76;i++)o(i);[410,520,630,740].forEach(function(t){square(a.width/2-435,t+3,80,80,"white",.2)}),this.hidePlayer||player.render.call({x:a.width/2-395,y:455,isDead:!1,color:"green",rotationDegrees:0,width:20,height:20}),Object.keys(entities).filter(function(t){return t.includes("enemy-")}).forEach(function(t,e){entities[t].render.call({x:a.width/2-395,y:455+110*(e+1),isDead:!1,color:"red",rotationDegrees:0,width:20,height:20})})},n}return _inherits(i,FullSize),i}(),LobbyTextOverlay=function(t){function n(t){var e;return _classCallCheck(this,n),(e=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,t))).render=function(){var n=this;text("Competitor: ".concat(player.name),n.width/2-325,465,void 0,30),getEnemies().forEach(function(t,e){return text("Competitor: ".concat(t.name),n.width/2-325,465+110*(e+1),void 0,30)})},e}return _inherits(n,FullSize),n}(),StatsTextOverlay=function(t){function n(t){var e;return _classCallCheck(this,n),(e=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,t))).render=function(){var i=this,t=roundStats.filter(function(t){return t.nonce===player.nonce})[0];text("".concat(player.name," - ").concat(t.totalWins," Points"),i.width/2-170,425,void 0,16),text("Disposition: ".concat(t.roundWon?"ALIVE":"DEAD"),i.width/2-340,440,void 0,14),text("Shot Accuracy: ".concat(Math.floor(t.roundHits/(t.totalHits+t.totalMisses)*100)||0,"% ").concat(t.roundHits,"/").concat(t.totalHits+t.totalMisses),i.width/2-340,460,void 0,14),text("Kills: ".concat(t.roundKills),i.width/2-340,480,void 0,14),text("Total Kills: ".concat(t.totalKills),i.width/2+100,440,void 0,14),text("Total Accuracy: ".concat(Math.floor(t.totalHits/(t.totalHits+t.totalMisses)*100)||0,"% ").concat(t.totalHits,"/").concat(t.totalHits+t.totalMisses),i.width/2+100,460,void 0,14),text("Total Deaths: ".concat(t.roundKills),i.width/2+100,480,void 0,14),getEnemies().forEach(function(e,t){var n=roundStats.filter(function(t){return t.nonce===e.nonce})[0];text("".concat(e.name," - ").concat(n.totalWins," Points"),i.width/2-170,425+110*(t+1),void 0,16),text("Disposition: ".concat(n.roundWon?"ALIVE":"DEAD"),i.width/2-340,440+110*(t+1),void 0,14),text("Shot Accuracy: ".concat(Math.floor(n.roundHits/(n.totalHits+n.totalMisses)*100)||0,"% ").concat(n.roundHits,"/").concat(n.totalHits+n.totalMisses),i.width/2-340,460+110*(t+1),void 0,14),text("Kills: ".concat(n.roundKills),i.width/2-340,480+110*(t+1),void 0,14),text("Total Kills: ".concat(n.totalKills),i.width/2+100,440+110*(t+1),void 0,14),text("Total Accuracy: ".concat(Math.floor(n.totalHits/(n.totalHits+n.totalMisses)*100)||0,"% ").concat(n.totalHits,"/").concat(n.totalHits+n.totalMisses),i.width/2+100,460+110*(t+1),void 0,14),text("Total Deaths: ".concat(n.roundKills),i.width/2+100,480+110*(t+1),void 0,14)})},e}return _inherits(n,FullSize),n}(),Player=function(t){function s(t,e,n,i,o,r){var a;return _classCallCheck(this,s),(a=_possibleConstructorReturn(this,_getPrototypeOf(s).call(this,t,e,"green",n,i,o,r))).onMouseMove=function(){this.rotationDegrees=180*Math.atan2(mousePos.y-this.y,mousePos.x-this.x)/Math.PI},a.onTick=function(t){var e=this,n=this.x,i=this.y;keyDown.w&&(this.y-=this.velocity*t),keyDown.s&&(this.y+=this.velocity*t),Object.keys(entities).some(function(t){return!!entities[t].blocking&&entitiesCollide(entities[t],e)})&&(this.y=i),keyDown.a&&(this.x-=this.velocity*t),keyDown.d&&(this.x+=this.velocity*t),Object.keys(entities).some(function(t){return!!entities[t].blocking&&entitiesCollide(entities[t],e)})&&(this.x=n),mouseDown&&!this.isDead&&0===this.weaponCooldown&&socket.emit("fire-projectile",{x:this.x,y:this.y,rotationDegrees:this.rotationDegrees})},a}return _inherits(s,Actor),s}(),Enemy=function(t){function a(t,e,n,i,o,r){return _classCallCheck(this,a),_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,t,e,"red",n,i,o,r))}return _inherits(a,Actor),a}(),Contrail=function(t){function r(t,e,n,i){var o;return _classCallCheck(this,r),(o=_possibleConstructorReturn(this,_getPrototypeOf(r).call(this,t,e,n,i,1))).halflife=1,o.render=function(){ctx.globalAlpha=1/this.halflife,ctx.fillStyle="yellow",ctx.strokeStyle="yellow",ctx.beginPath(),ctx.arc(this.x,this.y,this.height*this.halflife/20,0,2*Math.PI),ctx.stroke(),ctx.fill(),ctx.globalAlpha=1},o.onTick=function(){this.halflife++,10===this.halflife&&this.destroy()},o}return _inherits(r,Entity),r}();window.oncontextmenu=function(){return!1},window.addEventListener("load",function(){function e(t){keyDown[t.key.toLowerCase()]="d"===t.type[3]}socket=io({upgrade:!0,transports:["websocket"]}),player=new Player,addEntity(new Background(1)),addEntity(new Floor(550,420,790,1040)),addEntity(player),addEntity(new Background(2)),addEntity(new TitleCard(2)),addEntity(new PlayerListGUI(2)),addEntity(new LobbyTextOverlay(2)),addEntity(new Background(3)),addEntity(new TitleCard(3)),addEntity(new NameCollector(3)),addEntity(new TitleButton(a.width/2-200,400,"Connect","ssh",function(){return socket.emit("join")},3)),addEntity(new TitleButton(a.width/2-200,440,"Our Creators","blame",function(){return screen=5},3)),addEntity(new TitleButton(a.width/2-200,480,"Internal Documentation","man",function(){return screen=6},3)),addEntity(new Background(4)),addEntity(new TitleCard(4)),addEntity(new PlayerListGUI(4,"Post round stats, the next round will begin shortly")),addEntity(new StatsTextOverlay(4)),addEntity(new Background(5)),addEntity(new TitleCard(5)),addEntity(new PlayerListGUI(5,"This hot mess was brought to you by...")),addEntity(new CreditsTextOverlay(5)),addEntity(new TitleButton(a.width/2-200,770,"Return","CTRL C",function(){return screen=3},5)),addEntity(new Background(6)),addEntity(new TitleCard(6)),addEntity(new PlayerListGUI(6,'This terminal has many useful commands for accessing "The Network"',!0)),addEntity(new InstructionsTextOverlay(6)),addEntity(new TitleButton(a.width/2-200,770,"Return","exit()",function(){return screen=3},6)),addEntity(new Background(7)),addEntity(new TitleCard(7)),addEntity(new PlayerListGUI(7," ")),addEntity(new EndGameTextOverlay(7)),addEntity(new TitleButton(a.width/2-200,350,"Return To Prompt",":q!",function(){getEnemies().forEach(function(t){delete entities["enemy-"+t.nonce]}),screen=3},7)),forObj({"joined-room":function(t){player.nonce=t.nonce,player.name=t.name,screen=2},"round-start":function(t){environmentKeys.forEach(function(t){return delete entities[t]}),environmentKeys=[],t.walls.forEach(function(t){environmentKeys.push(addEntity(new Wall(t.nonce,t.x,t.y,t.height,t.width,1)).nonce)}),t.actors.forEach(function(t){if(t.nonce===player.nonce)player.x=t.x,player.y=t.y;else{var e=entities["enemy-"+t.nonce];e.x=t.x,e.y=t.y}}),t.groundWeapons.forEach(function(t){var e=newGunWithNonce(t.nonce,t.weaponTag,[t.x,t.y]);entities["groundweapon-"+t.nonce]=e}),screen=1},"round-end":function(t){Object.keys(entities).filter(function(t){return t.includes("groundweapon-")}).forEach(function(t){return delete entities[t]}),roundStats=t,screen=4},"game-end":function(t){gameStats=t,screen=7},destroy:function(t){Array.isArray(t)?t.forEach(function(t){return delete entities[t]}):delete entities[t]},"projectile-collision":function(t){t.forEach(function(t){delete entities["projectile-"+t.nonce]})},"projectile-fire":function(t){t.forEach(function(t){var e=entities["projectile-"+t.nonce];if(e)copyProps(t,e);else{var n=new ShotgunProjectile(t.nonce,t.x,t.y,t.rotationDegrees,t.fireTime,t.playerNonce);copyProps(t,n),addEntity(n,"projectile-"+t.nonce)}})},"weapon-pickup":function(t){var e=entities["groundweapon-"+t.nonce],n=t.playerNonce===player.nonce?player:entities["enemy-"+t.playerNonce];e&&n&&(n.activeWeapon=e.weaponTag),delete entities["groundweapon-"+t.nonce],entities["groundweapon-"+t.droppedWeapon.nonce]=newGunWithNonce(t.droppedWeapon.nonce,t.droppedWeapon.weaponTag,[t.droppedWeapon.x,t.droppedWeapon.y])},"update-chosen-room":function(t){joinedRoom=t,serverTime=t.serverTime,t.actors.forEach(function(t){if(t.nonce!==player.nonce){var e=entities["enemy-"+t.nonce];e?copyProps(t,e):addEntity(new Enemy(t.x,t.y),"enemy-"+t.nonce)}else player.isDead=t.isDead,player.health=t.health,player.activeWeapon=t.activeWeapon,player.weaponCooldown=t.weaponCooldown}),socket.emit("update-player",player)}},function(t,e){socket.on(e,t)}),onclick=function(t){entitiesCall("_click"),entitiesCall("_anyclick")},onkeydown=function(t){e(t),entitiesCall("_keydown",t.key),entitiesCall("_anykeydown",t.key)},onkeyup=e,onmousedown=function(){mouseDown=!0},onmouseup=function(){mouseDown=!1},onmousemove=function(t){var e=a.getBoundingClientRect();mousePos.x=t.clientX-e.left,mousePos.y=t.clientY-e.top,entitiesCall("_sethover"),entitiesCall("_mousemove")},onresize=function(){a.height=window.innerHeight,a.width=window.innerWidth,entitiesCall("_resize")},requestAnimationFrame(function t(e){if(e<lastFrameTimeMs+1e3/maxFPS)requestAnimationFrame(t);else{var n=e-lastFrameTimeMs;lastFrameTimeMs=e,entitiesCall("_tick",n),ctx.clearRect(0,0,a.width,a.height),ctx.font="30px Arial",entitiesCall("_render"),ctx.font="30px Arial",ctx.fillStyle="black",requestAnimationFrame(t)}})},!1);