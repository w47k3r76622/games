!function(t){var e={};function s(i){if(e[i])return e[i].exports;var h=e[i]={i:i,l:!1,exports:{}};return t[i].call(h.exports,h,h.exports,s),h.l=!0,h.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var h in t)s.d(i,h,function(e){return t[e]}.bind(null,h));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=1)}([function(t,e,s){"use strict";s.r(e);class i{constructor(t,e,s=!1){this.current=s,this.gameState=t.g,this.pos=e,this.text=t.t}d(){ctx.font="22px Arial",this.current?(ctx.fillStyle="#fff",ctx.fillRect(this.pos.x-30,this.pos.y-30,150,50),ctx.fillStyle="#000",ctx.fillText(this.text,this.pos.x,this.pos.y)):(ctx.fillStyle="#fff",ctx.fillText(this.text,this.pos.x,this.pos.y))}}class h{constructor(t,e){this.x=t,this.y=e}fillRect(t,e){ctx.fillRect(this.x-t/2,this.y-e/2,t,e)}set(t,e){return this.x=t,this.y=e,this}cadd(t,e){let s=new h(this.x,this.y);return s.add(new h(t,e)),s}add(t){return this.x+=t.x,this.y+=t.y,this}eq(t){return this.x===t.x&&this.y===t.y}toString(){return`${this.x} | ${this.y}`}stance(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}}var a=h;function o(){window.press={},window.onkeydown=(t=>{press[t.keyCode]=!0}),window.onkeyup=(t=>{press[t.keyCode]=!1})}o.UP=38,o.LEFT=37,o.DOWN=40,o.RIGHT=39,o.A=17,o.B=32,o.HELP=72,o.RESET=82,o.ESC=27;var r=o;window.imageridle=!0;class l{constructor(t,e,s){if(this.title=t,this.isLevel=s,this.current=0,this.items=[],this.isLevel){let t=100,s=-170;e.forEach((e,h)=>{t+=50,h%5==0&&(t=100,s+=200),console.log(t,s),this.items.push(new i({t:`Level ${h+1}`},new a(s,t),0===h))})}else e.forEach((t,e)=>{this.items.push(new i(t,new a(30,50*e+100),0===e))})}d(){ctx.font="32px Arial",ctx.fillStyle="#fff",ctx.fillText(this.title,40,40),this.items.forEach(t=>{t.d()})}wait(){window.imageridle=!1,setTimeout(()=>{window.imageridle=!0},150)}k(){window.imageridle&&(press[r.UP]&&(this.current>0&&this.current--,this.wait()),press[r.DOWN]&&(this.current<this.items.length-1&&this.current++,this.wait()),press[r.B]&&(this.isLevel?(setLevel(this.current),window.gameState="play"):"play"===this.items[this.current].gameState?setLevel(0):window.gameState=this.items[this.current].gameState,"editor"===window.gameState&&openEdit(),this.wait())),this.items.forEach((t,e)=>{e===this.current?t.current=!0:t.current=!1})}}var n=[{ttl:18,w:24,h:10,edges:[[99,100,1],[100,101,1],[101,102,1],[102,103,1],[103,104,1],[104,105,1],[105,129,1],[129,153,1],[152,153,1],[151,152,1],[150,151,1],[150,174,1],[174,198,1],[198,199,1],[199,200,1],[200,201,1],[201,202,1],[202,203,1],[203,204,1],[204,205,1],[152,176,1],[175,176,1],[174,175,1],[128,129,1],[127,128,1],[103,127,1],[128,152,1]],vertices:[{id:99,t:"start",th:0},{id:205,t:"end",th:0}]},{ttl:50,w:10,h:10,edges:[[33,34,1],[34,35,1],[35,36,1],[36,37,1],[37,38,1],[38,48,1],[48,58,1],[58,68,1],[68,78,1],[78,88,1],[34,44,1],[44,54,1],[54,55,1],[55,56,1],[46,56,1],[36,46,1]],vertices:[{id:33,t:"start",th:0},{id:88,t:"end",th:0},{id:78,t:"gate",th:2},{id:54,t:"data",th:0},{id:56,t:"data",th:0}]},{ttl:14,w:24,h:10,edges:[[51,52,1],[52,53,1],[53,54,1],[54,78,1],[78,102,1],[102,103,1],[103,104,1],[104,105,1],[81,105,1],[57,81,1],[79,103,1],[55,79,1],[55,56,1],[56,80,1],[79,80,1],[57,58,1]],vertices:[{id:51,t:"start",th:0},{id:55,t:"data",th:0},{id:56,t:"data",th:0},{id:58,t:"end",th:0},{id:57,t:"gate",th:2}]},{ttl:30,w:24,h:10,edges:[[102,103,1],[103,104,1],[104,105,1],[81,105,1],[57,81,1],[57,58,1],[58,59,1],[59,60,1],[60,84,1],[84,108,1],[107,108,1],[106,107,1],[106,130,1],[130,154,1],[108,109,1],[85,109,1],[61,85,1],[61,62,1],[62,63,1],[63,87,1],[87,111,1],[110,111,1],[109,110,1],[86,87,1],[109,133,1],[133,157,1],[157,158,1],[158,159,1],[159,160,1],[160,161,1],[161,162,1],[162,163,1]],vertices:[{id:102,t:"start",th:0},{id:106,t:"data",th:0},{id:163,t:"end",th:0},{id:130,t:"gate",th:1},{id:154,t:"data",th:0},{id:86,t:"data",th:0},{id:133,t:"gate",th:3}]},{ttl:11,w:24,h:10,edges:[[31,55,1],[55,79,1],[78,79,1],[79,80,1],[78,102,1],[102,126,1],[126,127,1],[127,128,1],[104,128,1],[80,104,1],[127,151,1],[151,175,1],[175,199,1]],vertices:[{id:31,t:"start",th:0},{id:102,t:"data",th:0},{id:128,t:"data",th:0},{id:199,t:"end",th:0},{id:175,t:"gate",th:2}]},{ttl:24,w:24,h:10,edges:[[106,107,1],[107,108,1],[84,108,1],[84,85,1],[85,109,1],[109,133,1],[133,157,1],[157,181,1],[180,181,1],[179,180,1],[178,179,1],[177,178,1],[176,177,1],[152,176,1],[128,152,1],[104,128,1],[104,105,1],[105,129,1],[129,130,1],[133,134,1],[134,135,1],[135,159,1],[159,183,1],[183,207,1],[206,207,1],[205,206,1],[181,205,1]],vertices:[{id:106,t:"start",th:0},{id:130,t:"end",th:0},{id:104,t:"gate",th:0},{id:152,t:"data",th:0},{id:179,t:"gate",th:0},{id:135,t:"data",th:0},{id:183,t:"data",th:0}]},{ttl:28,w:24,h:10,edges:[[57,58,1],[56,57,1],[55,56,1],[55,79,1],[79,103,1],[103,127,1],[127,128,1],[128,129,1],[129,130,1],[130,131,1],[131,132,1],[132,133,1],[133,134,1],[134,135,1],[111,135,1],[87,111,1],[63,87,1],[62,63,1],[60,61,1],[61,62,1],[59,60,1],[39,63,1],[39,40,1],[40,41,1],[41,65,1],[65,89,1],[89,113,1],[113,137,1],[137,161,1],[160,161,1],[159,160,1],[135,159,1],[81,82,1],[82,83,1],[83,84,1],[84,85,1],[85,109,1],[108,109,1],[107,108,1],[106,107,1],[105,106,1],[81,105,1]],vertices:[{id:58,t:"end",th:0},{id:59,t:"start",th:0},{id:65,t:"data",th:0},{id:137,t:"data",th:0},{id:81,t:"data",th:0},{id:105,t:"data",th:0},{id:109,t:"data",th:0},{id:85,t:"data",th:0},{id:79,t:"gate",th:2},{id:113,t:"gate",th:1}]},{ttl:24,w:24,h:10,edges:[[49,50,1],[50,51,1],[51,52,1],[28,52,1],[27,28,1],[27,51,1],[50,74,1],[74,98,1],[98,122,1],[122,123,1],[123,124,1],[124,148,1],[148,172,1],[171,172,1],[148,149,1],[149,150,1],[126,150,1],[126,127,1],[103,127,1],[103,104,1],[80,104,1],[56,80,1],[150,174,1],[174,175,1]],vertices:[{id:49,t:"start",th:0},{id:27,t:"data",th:0},{id:52,t:"data",th:0},{id:98,t:"gate",th:2},{id:171,t:"data",th:0},{id:80,t:"gate",th:4},{id:56,t:"end",th:0},{id:175,t:"data",th:0}]},{w:24,h:10,edges:[[82,106,1],[82,83,1],[83,107,1],[106,107,1],[106,130,1],[129,130,1],[105,129,1],[105,106,1],[59,83,1],[59,60,1],[60,84,1],[83,84,1],[129,153,1],[128,129,1],[128,152,1],[152,153,1],[153,154,1],[154,155,1],[155,156,1],[132,156,1],[108,132,1],[58,59,1],[57,58,1],[56,57,1],[56,80,1],[80,104,1]],vertices:[{id:106,t:"start",th:0},{id:60,t:"data",th:0},{id:152,t:"data",th:0},{id:108,t:"end",th:0},{id:132,t:"gate",th:3},{id:56,t:"data",th:0}]},{w:24,h:10,edges:[[130,131,1],[106,130,1],[106,107,1],[107,131,1],[130,154,1],[153,154,1],[129,153,1],[129,130,1],[152,153,1],[153,177,1],[83,107,1],[107,108,1],[83,84,1],[84,108,1],[108,132,1],[132,156,1],[156,180,1],[179,180,1],[178,179,1],[177,178,1],[176,177,1],[152,176,1],[128,152,1],[104,128,1],[80,104,1],[80,81,1],[81,82,1],[82,83,1],[180,204,1],[180,181,1],[181,205,1],[204,205,1],[56,80,1],[55,56,1],[55,79,1],[79,80,1],[56,57,1],[57,58,1],[58,59,1],[59,60,1],[60,61,1],[61,62,1],[62,86,1],[86,110,1],[110,134,1],[134,158,1],[158,159,1],[159,160,1],[160,161,1],[161,162,1],[138,162,1],[114,138,1],[90,114,1],[66,90,1],[65,66,1],[64,65,1],[63,64,1],[62,63,1],[134,135,1],[135,136,1],[136,137,1],[113,137,1],[89,113,1],[65,89,1],[112,136,1],[112,113,1],[158,182,1],[182,206,1],[206,207,1],[183,207,1],[182,183,1],[38,62,1],[38,39,1]],vertices:[{id:130,t:"start",th:0},{id:55,t:"data",th:0},{id:176,t:"data",th:0},{id:84,t:"data",th:0},{id:205,t:"data",th:0},{id:104,t:"gate",th:2},{id:81,t:"gate",th:2},{id:179,t:"gate",th:2},{id:156,t:"gate",th:2},{id:110,t:"gate",th:4},{id:112,t:"data",th:0},{id:162,t:"data",th:0},{id:207,t:"data",th:0},{id:38,t:"gate",th:7},{id:39,t:"end",th:0}]}];class d{constructor(){this.active=!1,this.pos=new a(0,0),this.time=0,this.lastUpdate=0}placeBeacon(t){this.active=!0,this.lastUpdate=(new Date).getTime(),this.pos.set(t.x,t.y),this.time=5e3}reset(){this.active=!1}k(){this.time<0&&this.active&&(p.pos.set(this.pos.x,this.pos.y),this.active=!1)}d(){if(this.active){ctx.beginPath(),ctx.arc(30*this.pos.x,30*this.pos.y,8,0,2*Math.PI),ctx.fillStyle="#fff",ctx.strokeWidth=2,ctx.fill(),ctx.fillStyle="#000",ctx.fillText(this.calcTime(),30*this.pos.x-3,30*this.pos.y+3);let t=this.time/200;ctx.beginPath(),ctx.arc(13*Math.cos(t)+30*this.pos.x,13*Math.sin(t)+30*this.pos.y,3,0,2*Math.PI),ctx.fillStyle=`hsla(${30*t%300}, 100%, 50%, 1)`,ctx.fill()}}calcTime(){let t=(new Date).getTime()-this.lastUpdate;return this.lastUpdate=new Date,this.time=this.time-t,(this.time/1e3).toFixed(0)}}var f=class{constructor(){this.moving=!1,this.beacon=new d}setLevel(t,e){this.map=t,this.w=t.w;let s=t.vertices.find(t=>"start"===t.t);this.totalDataCount=0,t.vertices.forEach(t=>{"data"===t.t&&this.totalDataCount++}),this.pos=new a(s.id%this.w,Math.floor(s.id/this.w)),this.edges=e.edges,this.vertices=e.vertices,this.ttl=t.ttl,this.network=e,this.dataCount=0,this.beacon.reset()}reset(){this.dataCount=0,this.beacon.reset(),this.network.reset(),this.edges=this.network.edges,this.vertices=this.network.vertices;let t=this.map.vertices.find(t=>"start"===t.t);this.pos=new a(t.id%this.w,Math.floor(t.id/this.w)),this.ttl=this.map.ttl}k(){if(this.beacon.k(),press[r.HELP]&&(window.gameState="help"),!this.moving){let t;if(press[r.RESET]&&(this.reset(),this.handleMove()),press[r.A]&&(this.beacon.active?(this.beacon.reset(),this.pos.set(this.beacon.pos.x,this.beacon.pos.y)):this.beacon.placeBeacon(this.pos),this.handleMove()),press[r.LEFT]){let e=this.pos.cadd(-1,0);t={from:this.pos,to:e},this.checkMove(t)&&(this.pos=e,this.move())}if(press[r.RIGHT]){let e=this.pos.cadd(1,0);t={from:this.pos,to:e},this.checkMove(t)&&(this.pos=e,this.move())}if(press[r.UP]){let e=this.pos.cadd(0,-1);t={from:this.pos,to:e},this.checkMove(t)&&(this.pos=e,this.move())}if(press[r.DOWN]){let e=this.pos.cadd(0,1);t={from:this.pos,to:e},this.checkMove(t)&&(this.pos=e,this.move())}}}getRoute(t){return this.edges.find(e=>e.from.eq(t.from)&&e.to.eq(t.to)||e.from.eq(t.to)&&e.to.eq(t.from))}checkMove(t){this.handleMove();let e=this.network.vertices.find(e=>e.pos.eq(t.to));if(e&&e.type&&"gate"===e.type&&e.opt>this.dataCount)return!1;let s=this.getRoute(t);return!(!s||!s.isAvailable()||(this.ttl<1?(window.hint.show(1),1):(this.ttl--,s.consume(),0)))}d(){this.beacon.d(),ctx.beginPath(),ctx.arc(30*this.pos.x,30*this.pos.y,8,0,2*Math.PI),ctx.fillStyle="#68afff",ctx.fill(),ctx.fillStyle="#fff";for(let t=0;t<this.ttl;t++)ctx.fillStyle="#3e70ea",ctx.fillRect(10+8*t,10,4,4);for(let t=0;t<this.totalDataCount;t++)ctx.fillStyle="#3e70ea",t>=this.dataCount?(ctx.beginPath(),ctx.rect(10+12*t,20,8,8),ctx.strokeStyle="#4671f7",ctx.setLineDash([]),ctx.stroke()):(ctx.fillStyle="#4671f7",ctx.fillRect(10+12*t,20,8,8))}handleMove(){this.moving=!0,setTimeout(()=>{this.moving=!1},250)}move(){this.vertices.forEach(t=>{t.pos.eq(this.pos)&&"data"===t.type&&!1!==t.status&&(this.dataCount++,t.consume()),t.pos.eq(this.pos)&&"end"===t.type&&nextLevel()})}};class x{constructor(t,e,s){this.pos=t,this.type=e,this.opt=s,this.consumed=!1,this.fa=0,this.a=0,this.status="off",this.acc=0}de(){ctx.fillStyle="#fff","data"===this.type?ctx.fillStyle="#3ae2ff":"gate"===this.type?ctx.fillStyle="#50ff2b":"end"===this.type?ctx.fillStyle="#001eff":"start"===this.type?ctx.fillStyle="#fffa1c":"ttl"===this.type?ctx.fillStyle="#ff00a3":ctx.fillStyle="#ff9200",ctx.beginPath(),ctx.arc(30*this.pos.x,30*this.pos.y,5,0,2*Math.PI),ctx.fill()}data(t){return{id:this.pos.x+this.pos.y*t,t:this.type,th:this.opt}}d(){this.acc+=.1,ctx.fillStyle=`rgba(255,255,255,${this.a})`,"data"===this.type?this.drawData():"gate"===this.type?this.drawGate():"start"===this.type||("end"===this.type?this.drawEnd():(ctx.beginPath(),ctx.arc(30*this.pos.x,30*this.pos.y,3,0,2*Math.PI),ctx.strokeStyle="rgba(255,255,255, 0.8)",ctx.strokeWidth=2,ctx.fillStyle="#000",ctx.fill(),ctx.stroke()))}consume(){this.consumed=!0}boot(){this.a=0,this.fa=0,this.lastUpdate=(new Date).getTime(),this.status="booting"}finish(){this.status="finish"}k(){"booting"===this.status&&(this.delta=(new Date).getTime()-this.lastUpdate,this.fa=this.fa+this.delta/1e3,this.fa>1?(this.a=1,this.status="on"):this.a=this.fa,this.lastUpdate=(new Date).getTime())}drawData(){ctx.beginPath(),ctx.moveTo(30*this.pos.x-15,10*Math.sin(0)+30*this.pos.y);for(let t=0;t<30;t++)ctx.lineTo(t+30*this.pos.x-15,10*Math.sin((t+this.acc)/3)+30*this.pos.y);ctx.strokeStyle="rgba(255,255,255, 0.3)",ctx.strokeWidth=1,ctx.stroke(),ctx.beginPath(),ctx.moveTo(30*this.pos.x,30*this.pos.y-8),ctx.lineTo(30*this.pos.x+8,30*this.pos.y),ctx.lineTo(30*this.pos.x,30*this.pos.y+8),ctx.lineTo(30*this.pos.x-8,30*this.pos.y),ctx.lineTo(30*this.pos.x,30*this.pos.y-8),this.consumed?(ctx.strokeStyle=`rgba(0,255,255,${this.a})`,ctx.stroke()):(ctx.fillStyle=`rgba(0,255,255,${this.a})`,ctx.fill()),ctx.beginPath(),ctx.arc(30*this.pos.x,30*this.pos.y,18,0,2*Math.PI),ctx.strokeStyle="rgba(255,255,255,0.3)",ctx.stroke()}drawEnd(){ctx.beginPath(),ctx.fillStyle=`rgba(255,255,255,${this.a})`,ctx.arc(30*this.pos.x,30*this.pos.y,2*Math.cos(this.acc)+5,0,2*Math.PI),ctx.fill()}drawGate(){for(let t=0;t<this.opt;t++)p.dataCount>t?(ctx.beginPath(),ctx.arc(15*Math.cos(2*Math.PI/this.opt*t)+30*this.pos.x,15*Math.sin(2*Math.PI/this.opt*t)+30*this.pos.y,5,0,2*Math.PI),ctx.fillStyle="#fff",ctx.fill()):(ctx.beginPath(),ctx.arc(15*Math.cos(2*Math.PI/this.opt*t)+30*this.pos.x,15*Math.sin(2*Math.PI/this.opt*t)+30*this.pos.y,5,0,2*Math.PI),ctx.strokeStyle="#fff",ctx.stroke());p.dataCount>=this.opt?(ctx.fillStyle=`rgba(30,150,170,${this.a})`,ctx.beginPath(),ctx.arc(30*this.pos.x,30*this.pos.y,5,0,2*Math.PI),ctx.strokeStyle="#fff",ctx.stroke()):(ctx.beginPath(),ctx.arc(30*this.pos.x,30*this.pos.y,5,0,2*Math.PI),ctx.strokeStyle="#911",ctx.fillStyle=`rgba(150,17,17,${this.a})`,ctx.fill())}reboot(){this.boot()}}class g{constructor(t,e,s){this.from=t,this.to=e,this.remaining=s,this.isUnlimited=-1===s,this.a=0,this.fa=0}data(t){return[this.from.x+this.from.y*t,this.to.x+this.to.y*t,this.remaining]}d(){ctx.beginPath(),ctx.moveTo(30*this.from.x,30*this.from.y),ctx.lineTo(30*this.to.x,30*this.to.y),this.isUnlimited?(ctx.strokeStyle=`rgba(152,235,235,${this.a/3})`,ctx.lineWidth=12,ctx.stroke(),ctx.strokeStyle=`rgba(255,255,255,${this.a})`,ctx.lineWidth=2,ctx.stroke()):1===this.remaining?(ctx.strokeStyle=`rgba(152,235,235,${this.a})`,ctx.lineWidth=2,ctx.stroke()):0===this.remaining&&(ctx.strokeStyle=`rgba(68,17,204,${this.a/2})`,ctx.lineWidth=2,ctx.stroke()),ctx.lineWidth=1}de(){ctx.beginPath(),ctx.moveTo(30*this.from.x,30*this.from.y),ctx.lineTo(30*this.to.x,30*this.to.y),this.isUnlimited?ctx.strokeStyle="#78ff3b":1===this.remaining?ctx.strokeStyle="#41c":0===this.remaining&&(ctx.strokeStyle="rgba(68,17,204,0.2)"),ctx.lineWidth=5,ctx.stroke(),ctx.lineWidth=1}k(){if("booting"===this.status){let t=(new Date).getTime()-this.lastUpdate;this.fa=this.fa+t/1e3,this.fa>1?(this.a=1,this.status="on"):this.a=this.fa,this.lastUpdate=(new Date).getTime()}}consume(){this.remaining--}isAvailable(){return this.isUnlimited||this.remaining>0}boot(){this.status="booting",this.a=0,this.fa=0,this.lastUpdate=(new Date).getTime()}finish(){this.status="finish"}reboot(){this.a=0,this.fa=0,this.boot()}}class u{constructor(t,e,s,i,h=1e3){this.color=s,this.lifeSpan=h*Math.random(),this.olifeSpan=h,this.pos=new a(e.x,e.y),this.opos=new a(e.x,e.y),this.lastUpdate=(new Date).getTime(),this.d=0,this.moveVector=new a(Math.cos(t)*i,Math.sin(t)*i)}dr(){let t=.7;this.lifeSpan<300&&(t=this.lifeSpan/300),ctx.fillStyle=`hsla(${this.color}, 50%, 50%, ${t})`,ctx.fillRect(this.pos.x,this.pos.y,2,2)}k(){this.d=(new Date).getTime()-this.lastUpdate,this.lastUpdate=(new Date).getTime(),this.lifeSpan=this.lifeSpan-this.d,this.lifeSpan<0&&(this.lifeSpan=this.olifeSpan,this.pos.set(this.opos.x,this.opos.y)),this.pos.add(this.moveVector)}}class w{constructor(){this.particles=[]}addInToOut(t){this.particles=[];for(let e=0;e<100;e++){let e=new u(2*Math.random()*Math.PI,t,188,.4,1e3);this.particles.push(e)}}addOutToIn(t){for(let e=0;e<100;e++){let e=2*Math.random()*Math.PI,s=new u(-e,new a(t.x+15*Math.cos(e),t.y+15*Math.sin(e)),354,.4,1e3);this.particles.push(s)}}d(){for(let t=0;t<this.particles.length;t++)this.particles[t].dr()}k(){for(let t=0;t<this.particles.length;t++)this.particles[t].k()}}var y=class{constructor(t){this.map=t,this.w=t.w,this.h=t.h,this.particlePool=new w,this.vertices=[],this.edges=[],this.buildNetwork(this.map)}reset(){this.buildNetwork(this.map),this.reboot()}buildNetwork(){this.vertices=[],this.edges=[],this.map.vertices.forEach(t=>{let e=new a(t.id%this.w,Math.floor(t.id/this.w));this.vertices.push(new x(e,t.t,t.th))}),this.map.edges.forEach(t=>{let e=new a(t[0]%this.w,Math.floor(t[0]/this.w)),s=new a(t[1]%this.w,Math.floor(t[1]/this.w));this.edges.push(new g(e,s,t[2])),this.vertices.find(t=>t.pos.eq(e))||this.vertices.push(new x(e,"n")),this.vertices.find(t=>t.pos.eq(s))||this.vertices.push(new x(s));let i=this.vertices.find(t=>"start"===t.type);this.particlePool.addInToOut(new a(30*i.pos.x,30*i.pos.y));let h=this.vertices.find(t=>"end"===t.type);this.particlePool.addOutToIn(new a(30*h.pos.x,30*h.pos.y))})}k(){this.particlePool.k(),this.edges.forEach(t=>{t.k()}),this.vertices.forEach(t=>{t.k()})}d(){this.edges.forEach(t=>{t.d()}),this.vertices.forEach(t=>{t.d()}),this.particlePool.d()}reboot(){this.edges.forEach(t=>{t.reboot()}),this.vertices.forEach(t=>{t.reboot()})}boot(){this.edges.forEach(t=>{t.boot()}),this.vertices.forEach(t=>{t.boot()})}finish(){this.edges.forEach(t=>{t.finish()}),this.vertices.forEach(t=>{t.finish()})}};var m=class{constructor(){this.cells=[];for(let t=0;t<900;t++)this.cells.push(Math.floor(100*Math.random()))}d(){for(let t=0;t<900;t++){let e=Math.abs(this.cells[t]-5)/500;ctx.fillStyle=`rgba(150,0,0,${e})`,ctx.fillRect(t%30*30,30*Math.floor(t/30),30,30)}}l(){for(let t=0;t<900;t++)this.cells[t]<100?this.cells[t]+=.4:this.cells[t]=0}};window.C_WIDTH=800,window.C_HEIGHT=400,window.hint=new class{constructor(){this.hints=[{m:"Press [Arrows] for moving, SPACE for action H in game for help"},{m:"Press [R] to reset level"},{m:"Use [Up and Down Arrows]  to move Up and Down, Select with [Space]"},{m:"Use [Ctrl] to place beacon, You will be brought back to the beacon after 5 seconds"}]}d(){this.active&&(ctx.font="14px Arial",ctx.fillStyle="rgba(0,0,0,.5)",ctx.fillRect(20,C_HEIGHT-60,700,50),ctx.fillStyle="#fff",ctx.fillText(this.currentHint.m,30,C_HEIGHT-20))}show(t){return this.handle&&clearTimeout(this.handle),this.active=!0,!this.hints[t].used&&(this.currentHint=this.hints[t],this.currentHint.used=!0,this.handle=setTimeout(()=>{this.active=!1},15e3),!0)}},r(),window.currentLevel=0;const v=new class{constructor(){this.credits=["Freely inspired by LOSSST by Xem","","Hardcoded by alternative","","Thanks to:","Anouk","Adrien","JB","Antoine","for supporting & testing"],this.cd=100}d(){ctx.font="22px Arial",ctx.fillStyle="#fff",this.cd-=.4,ctx.fillText("You win",10,this.cd),ctx.font="18px Arial";for(let t=0;t<this.credits.length;t++)ctx.fillText(this.credits[t],10,this.cd+40*t+20)}},S=new class{constructor(){this.data=new x(new a(3,3),"data",1),this.data.consumed=!1,this.data.a=1,this.gateOpen=new x(new a(3,4),"gate",0),this.gateOpen.a=1,this.gateClosed=new x(new a(3,5),"gate",2),this.gateClosed.a=1}d(){ctx.font="16px Arial",ctx.fillStyle="rgba(0,0,0,.5)",ctx.fillRect(20,20,C_WIDTH-40,C_HEIGHT-40),ctx.fillStyle="#8f949a",ctx.fillText("Data",120,95),ctx.fillText("Open gate",120,125),ctx.fillText("Closed gate",120,155),this.data.d(),this.gateOpen.d(),this.gateClosed.d()}k(){return press[r.HELP]||(window.gameState="play"),this}},b=new class{constructor(){window.openEdit=(()=>{editorC.style.display="block"}),this.w=24,this.h=10,this.edges=[],this.vertices=[],this.pen="data",this.toggleButton(dataB),this.currentItem=null,this.penPos=new a,closeEB.onclick=(()=>{this.setText(""),gameState="home",editorC.style.display="none"}),dataB.onclick=(()=>{this.pen="data",this.toggleButton(dataB)}),startB.onclick=(()=>{this.pen="start",this.toggleButton(startB)}),endB.onclick=(()=>{this.toggleButton(endB),this.pen="end"}),gateB.onclick=(()=>{this.toggleButton(gateB),this.pen="gate"}),ttlB.onclick=(()=>{this.toggleButton(ttlB),this.pen="ttl"}),c.onclick=(t=>{if("editor"!==gameState)return;if(this.pStance()<6){let e=new a(Math.floor((t.offsetX+15)/30),Math.floor((t.offsetY+15)/30)),s=new x(e,this.pen,0),i=this.vertices.find(t=>t.pos.eq(e));switch(i?this.currentItem=i:(this.vertices.push(s),this.currentItem=s),this.currentItem.type){case"gate":this.setText("Threshold"),setting.value=this.currentItem.opt;break;case"ttl":this.setText("TTL Boost"),setting.value=this.currentItem.opt;break;default:this.setText("")}}let e=this.penPos.x-30*Math.floor(this.penPos.x/30),s=this.penPos.y-30*Math.floor((this.penPos.y+15)/30);if(e>6&&e<24&&s<6&&s>-6){let t=Math.floor(this.penPos.x/30),e=Math.floor((this.penPos.y+15)/30),s=new a(t,e),i=new a(t+1,e),h=this.edges.find(t=>t.from.eq(s)&&t.to.eq(i));if(h)this.currentItem=h,setting.value=h.remaining;else{setting.value=1;let t=new g(s,i,1);this.edges.push(t),this.currentItem=t}this.setText("lifespan")}if(e=this.penPos.x-30*Math.floor((this.penPos.x+15)/30),(s=this.penPos.y-30*Math.floor(this.penPos.y/30))>6&&s<24&&e>-6&&e<6){let t=Math.floor((this.penPos.x+15)/30),e=Math.floor(this.penPos.y/30),s=new a(t,e),i=new a(t,e+1),h=this.edges.find(t=>t.from.eq(s)&&t.to.eq(i));if(h)this.currentItem=h,setting.value=h.remaining;else{setting.value=1;let t=new g(s,i,1);this.edges.push(t),this.currentItem=t}this.setText("lifespan")}this.updateMap()}),setting.onchange=(()=>{this.currentItem instanceof g?this.currentItem.remaining=parseInt(setting.value):this.currentItem.opt=parseInt(setting.value),this.updateMap()}),ttl.onchange=(()=>{this.ttl=parseInt(ttl.value),this.updateMap()}),c.onmousemove=(t=>{this.penPos.set(t.offsetX,t.offsetY)})}toggleButton(t){this.olButton&&this.olButton.classList.remove("active"),this.olButton=t,t.classList.add("active")}updateMap(){let t={ttl:this.ttl,w:this.w,h:this.h,edges:this.edges.map(t=>t.data(this.w)),vertices:this.vertices.map(t=>t.data(this.w))};mapData.value=JSON.stringify(t)}d(){ctx.fillRect(0,0,100,100);for(let t=0;t<this.w;t++)for(let e=0;e<this.h;e++)ctx.beginPath(),ctx.arc(30*t,30*e,6,0,2*Math.PI),ctx.strokeStyle="#fff",ctx.stroke();for(let t=0;t<this.h;t++)ctx.beginPath(),ctx.moveTo(0,30*t),ctx.lineTo(30*this.w-30,30*t),ctx.strokeStyle="rgba(255,0,0,0.4)",ctx.stroke();for(let t=0;t<this.w;t++)ctx.beginPath(),ctx.moveTo(30*t,0),ctx.lineTo(30*t,30*this.h-30),ctx.strokeStyle="rgba(255,0,0,0.4)",ctx.stroke();ctx.beginPath(),this.pStance()<6&&(ctx.arc(30*Math.floor((this.penPos.x+15)/30),30*Math.floor((this.penPos.y+15)/30),8,0,2*Math.PI),ctx.fillStyle="#fff",ctx.fill()),ctx.fillStyle="#09c";let t=this.penPos.x-30*Math.floor(this.penPos.x/30),e=this.penPos.y-30*Math.floor((this.penPos.y+15)/30);t>6&&t<24&&e<6&&e>-6&&ctx.fillRect(30*Math.floor(this.penPos.x/30),30*Math.floor((this.penPos.y+15)/30)-5,30,10),t=this.penPos.x-30*Math.floor((this.penPos.x+15)/30),(e=this.penPos.y-30*Math.floor(this.penPos.y/30))>6&&e<24&&t>-6&&t<6&&ctx.fillRect(30*Math.floor((this.penPos.x+15)/30)-5,30*Math.floor(this.penPos.y/30),10,30),this.vertices.forEach(t=>{t.de()}),this.edges.forEach(t=>{t.de()}),this.currentItem&&(this.currentItem instanceof g?(ctx.beginPath(),ctx.moveTo(30*this.currentItem.from.x,30*this.currentItem.from.y),ctx.lineTo(30*this.currentItem.to.x,30*this.currentItem.to.y),ctx.strokeStyle="#ff8919",ctx.stroke()):(ctx.beginPath(),ctx.strokeStyle="#ff8919",ctx.arc(30*this.currentItem.pos.x,30*this.currentItem.pos.y,8,0,2*Math.PI),ctx.stroke()))}setText(t){""===t?(settingI.innerHTML="",setting.style.display="none"):(settingI.innerHTML=t,setting.style.display="inline-block")}pStance(){return new a(30*Math.floor((this.penPos.x+15)/30),30*Math.floor((this.penPos.y+15)/30)).stance(new a(this.penPos.x,this.penPos.y))}};let k=new y(n[currentLevel]);window.p=new f,p.setLevel(n[currentLevel],k);const P=new class{constructor(){this.current=0,this.active=!1,this.currentLine=0,this.lastUpdate=0,this.dialogs=[["You exprience a network failure","To activate network you have to reach the core","Move with [arrows]","Press [R] to reset the level, [H] for help"],["You have to gather data to move across restricted access"],["Use [ctrl.] to place a beacon, you will be brought back after 5 seconds","or by pressing [ctrl.] again"]]}set(){this.current=0,this.currentLine=0,this.active=!0,this.lastUpdate=(new Date).getTime(),this.current=currentLevel,this.dialog=this.dialogs[this.current],this.dialog?this.active=!0:(this.active=!1,this.start())}k(){if(this.active){let t=(new Date).getTime()-this.lastUpdate;this.count=t/30,this.count>this.dialog[this.currentLine].length&&this.dialog.length>this.currentLine+1&&(this.currentLine++,this.count=0,this.lastUpdate=(new Date).getTime()),this.dialog.length===this.currentLine+1&&this.dialog[this.currentLine].length<this.count&&(this.h=setTimeout(()=>{this.start(),this.h=null},5e3)),press[r.ESC]&&(this.start(),clearTimeout(this.h),this.h=null)}}start(){this.active=!1,this.currentLetter=0,startLevel()}d(){if(this.active){ctx.font="18px Arial",ctx.fillStyle="#121314",ctx.fillRect(0,0,C_WIDTH,150),ctx.fillStyle="#4ddfe2";for(let t=0;t<this.currentLine;t++)ctx.fillText(this.dialog[t],0,30+30*t);let t=this.dialog[this.currentLine].substr(0,this.count);ctx.fillText(t,0,30+30*this.currentLine),ctx.beginPath(),ctx.rect(C_WIDTH-100,120,80,20),ctx.strokeStyle="#fff",ctx.strokeWidth=2,ctx.stroke(),ctx.fillStyle="#fff",ctx.font="14px Arial",ctx.fillText("Esc to skip",C_WIDTH-95,135)}}};window.nextLevel=(()=>{currentLevel++,currentLevel!==n.length?(k=new y(n[currentLevel]),p.setLevel(n[currentLevel],k),P.set()):gameState="win"}),window.startLevel=(()=>{k.boot()}),window.setLevel=(t=>{gameState="play",currentLevel=t,k=new y(n[currentLevel]),p.setLevel(n[currentLevel],k),P.set()});const T=new m;window.ctx=c.getContext("2d"),c.width=C_WIDTH,c.height=C_HEIGHT,ctx.fillStyle="#000",ctx.fillRect(0,0,C_WIDTH,C_HEIGHT),window.gameState="home";let M=new l("Silent Network",[{t:"Play",g:"play"},{t:"Level select",g:"select"},{t:"Editor",g:"editor"}]),I=new l("Select Level",n,!0);hint.show(2);let L=()=>{c.width+=0,T.l(),T.d(),"home"===gameState?(M.k(),hint.d(2),M.d()):"select"===gameState?(I.k(),I.d()):"play"===gameState?(P.k(),p.k(),k.k(),k.d(),p.d(),hint.d(),P.d()):"editor"===gameState?b.d():"win"===gameState?v.d():"help"===gameState&&S.k().d(),requestAnimationFrame(L)};L()},function(t,e,s){t.exports=s(0)}]);