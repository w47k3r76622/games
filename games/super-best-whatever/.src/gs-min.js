var cl=[],ml=[],sl=[],bp=[],ol=[],rl=[],il=[],tl=[],gt=0,gl=0,sm=0,gg=0,bt=0,gm=-1,gs=-1,rc="#bf5f2b",gc="#26ab7a",bc="#2671ab",yc="#c9c72d",dc="#000000",cc=null,wn="",df="";rl.push({n:"godfather",o:"murder",t:1,i:[11,12,13,14,15,17,18,19,42,43],c:[25,26,29],e:[4,20]});rl.push({n:"fbi agent",o:"eliminate",t:1,i:[11,12,13,14,15,17,18,19,41,42],c:[3,5,13,21,24],e:[20]});rl.push({n:"n00b warrior",o:"break",t:1,i:[11,12,13,41,42,43,45,46],c:[31],e:[20]});
rl.push({n:"alien",o:"slaughter",t:1,i:[14,15,42,44,45,46,47,48,65],c:[1,4,7,28,30,32],e:[20]});rl.push({n:"police officer",o:"arrest",t:2,i:[20,21,22,23,24],c:[0,18,19],e:[20]});rl.push({n:"forger",o:"circulate to",t:2,i:[28,70,71],c:[6,18,19],e:[1,20]});rl.push({n:"merchant",o:"sell to",t:2,i:[26,27,72],c:[2,11,27],e:[20]});rl.push({n:"undercover ufo",o:"take samples from",t:2,i:[29,73,74],c:[11,15,29,30],e:[1,3,20]});rl.push({n:"teenage girl",o:"kiss",t:2,i:[6,7,8],c:[22,23],e:[]});
rl.push({n:"mafia",o:"guard",t:3,i:[0,38,39,49,50,51,62,66],c:[0,6,19],e:[4,20]});rl.push({n:"pimp",o:"protect",t:3,i:[0,1,5,51,59,62,63],c:[18],e:[4,20]});rl.push({n:"cleric",o:"support",t:3,i:[10,50,59,63,64,66],c:[2,27],e:[20]});rl.push({n:"android",o:"cover",t:3,i:[9,38,60,64,66],c:[16],e:[28,20]});rl.push({n:"terrorist",o:"kill",t:4,i:[25,40,17,18,19,65,42],c:[],e:[]});rl.push({n:"depressed high school student",o:"murder",t:4,i:[11,12,16,17,18,19,65],c:[],e:[]});
rl.push({n:"dragon",o:"destroy",t:4,i:[11,12,13,16,19,40,65],c:[],e:[]});rl.push({n:"rebel robot",o:"exterminate",t:4,i:[11,12,16,17,18,66],c:[],e:[28]});rl.push({n:"mutant",o:"slaughter",t:4,i:[44,45,46,47,48,14,15],c:[],e:[]});rl.push({n:"hooker",o:"have sex with",t:5,i:[30,31,32],c:[],e:[4,20]});rl.push({n:"drug dealer",o:"deal with",t:5,i:[33,34,67],c:[],e:[4,20]});rl.push({n:"dungeon keeper",o:"imprison",t:5,i:[20,21,22,23,24],c:[],e:[27]});
rl.push({n:"martian",o:"contact with",t:5,i:[66,68,69],c:[],e:[1]});rl.push({n:"vampire",o:"bite and transform",t:5,i:[55,56,75,66],c:[],e:[]});rl.push({n:"werewolf",o:"bite and kill",t:5,i:[45,47,48,66],c:[],e:[]});rl.push({n:"zombie",o:"bite and infect",t:5,i:[54,55,56,66,75],c:[],e:[]});rl.push({n:"super hero",o:"save",t:6,i:[3,9,35,36,37],c:[],e:[]});rl.push({n:"security",o:"secure",t:6,i:[0,2,38,50,59,63,64],c:[],e:[]});rl.push({n:"good wizard",o:"protect",t:6,i:[0,10,49,51,67,38,62],c:[],e:[]});
rl.push({n:"galactic commander",o:"guard",t:6,i:[0,3,5,38,60,64,65,66],c:[],e:[]});rl.push({n:"sneak",o:"survive",t:7,i:[0,3,4,38,51,62,64,66],c:[],e:[0,20]});rl.push({n:"civilian",o:"don't die",t:7,i:[0,3,4,5,59,60,62],c:[],e:[3]});rl.push({n:"barrel",o:"stay whole",t:7,i:[9,10,50,61,62,66],c:[],e:[2]});rl.push({n:"galaxy hitchhiker",o:"be safe",t:7,i:[0,49,50,61,62,66],c:[],e:[3]});rl.push({n:"thief",o:"rob",t:5,i:[52,53,76],c:[],e:[4]});il.push({n:"nothing :P"});il.push({n:"golden teeth"});il.push({n:"uselessness"});
il.push({n:"mp3 player"});il.push({n:"briefcase"});il.push({n:"colorful and furry clothes"});il.push({n:"boy band t-shirt",v:"kiss",a:interact});il.push({n:"ridiculous make-up",v:"kiss",a:interact});il.push({n:"disturbing voice",v:"kiss",a:interact});il.push({n:"rusty nail"});il.push({n:"generous loot"});il.push({n:"pistol",v:"fire",a:fire,rl:30,r:350,p:[15,25,4]});il.push({n:"sub machine gun",v:"fire",a:fire,rl:15,r:300,p:[20,15,4]});
il.push({n:"assault rifle",v:"fire",a:fire,rl:10,r:400,p:[25,20,4]});il.push({n:"sniper rifle",v:"fire",a:fire,rl:50,r:900,p:[45,60,4]});il.push({n:"heavy machine gun",v:"fire",a:fire,rl:5,r:400,p:[30,20,4]});il.push({n:"fire breath",v:"breath fire",a:fire,rl:5,r:150,p:[30,15,3]});il.push({n:"fireball spell scrolls",v:"cast",a:fire,cd:100,l:[10,19],r:200,p:[30,55,3]});il.push({n:"arcane spell scrolls",v:"cast",a:fire,cd:100,l:[20,25],r:200,p:[20,70,0]});
il.push({n:"thunder spell scrolls",v:"cast",a:fire,cd:100,l:[10,19],r:200,p:[40,40,1]});il.push({n:"handcuffs",v:"use",a:arrest,cd:150});il.push({n:"cable tie",v:"use",a:arrest,cd:150});il.push({n:"chains",v:"use",a:arrest,cd:150});il.push({n:"fishnet gun",v:"throw",a:rngarrest,cd:150,r:150,l:[3,7],p:20});il.push({n:"teleport to prison spell",v:"cast",a:rngarrest,cd:100,r:150,l:[3,7],p:20});il.push({n:"explosive belt",v:"detonate",a:scdatt,r:75});
il.push({n:"brand new shields",v:"offer your goods",a:interact,cd:200});il.push({n:"common weapons",v:"offer your goods",a:interact,cd:200});il.push({n:"forged banknotes",v:"circulate",a:interact,cd:200});il.push({n:"sample bag",v:"take samples",a:interact,cd:250});il.push({n:"strawberry condoms",v:"have sex",a:sex,cd:300});il.push({n:"sexy lingerie",v:"have sex",a:sex,cd:300});il.push({n:"hiv positive lol",v:"have sex",a:sex,cd:300});il.push({n:"synthetic drugs",v:"sell drugs",a:inject,cd:30});
il.push({n:"fresh weed",v:"sell drugs",a:inject,cd:30});il.push({n:"super punch",v:"punch",a:stun,cd:300,p:150});il.push({n:"super kick",v:"kick",a:stun,cd:300,p:200});il.push({n:"super slap",v:"slap",a:stun,cd:300,p:100});il.push({n:"pepper spray",v:"spray",a:suspend,cd:150,l:[3,7]});il.push({n:"banknotes",v:"bribe",a:suspend,cd:150,l:[1,3]});il.push({n:"ground mine",v:"lay ground mine",a:minelay,cd:300,r:100,l:[5,10]});il.push({n:"dagger",v:"stab",a:mlatt,cd:50,p:[20,10]});
il.push({n:"bastard sword",v:"bash",a:mlatt,cd:150,p:[40,20]});il.push({n:"two handed axe",v:"hurl",a:mlatt,cd:250,p:[60,30]});il.push({n:"197 pointy teeth",v:"bite",a:mlatt,cd:100,p:[25,0]});il.push({n:"claws on his both hands",v:"punch",a:mlatt,cd:200,p:[50,0]});il.push({n:"33 arms",v:"punch",a:mlatt,cd:100,p:[50,0]});il.push({n:"fluffy fur",v:"bite",a:mlatt,cd:500,p:[150,50]});il.push({n:"no tusk xD",v:"bite",a:mlatt,cd:10,p:[5,10]});
il.push({n:"memory eraser",v:"fire",a:rngstun,cd:250,r:200,l:[1,3],p:[30,600]});il.push({n:"teasar gun",v:"activate",a:rngstun,cd:250,r:150,l:[3,7],p:[30,300]});il.push({n:"pain killers",v:"use",a:selfheal,cd:100,r:80,l:[1,3],p:10});il.push({n:"weak pickpocket skills",v:"rob someone near you",a:rob,cd:300,p:75});il.push({n:"strong pickpocket skills",v:"rob someone near you",a:rob,cd:200,p:25});il.push({n:"infection",v:"attack",a:transmit,cd:250});il.push({n:"sexy look",v:"bite",a:transmit,cd:250});
il.push({n:"red and black cloak",v:"bite",a:transmit,cd:250});il.push({n:"something"});il.push({n:"something"});il.push({n:"mushroom",v:"eat",a:cngcnt,r:50,cd:500,p:500});il.push({n:"horse semen",v:"drink",a:cngcnt,r:50,cd:400,p:400});il.push({n:"beeper",v:"call for help",a:call,cd:100,r:200,l:[1,3],p:450});il.push({n:"huge dildo",v:"expose the dildo",a:surprise,cd:400,r:333,p:500});il.push({n:"heal spell",v:"cast the spell",a:rngheal,cd:450,r:300,p:30});
il.push({n:"molecular transportation device",v:"fire",a:rndgo,r:300,cd:400,l:[1,3]});il.push({n:"holy hand grenade",v:"take out the holy pin",a:bomb,r:100,cd:400,l:[1,3],p:[30,300]});il.push({n:"towel",v:"bring out your towel for an instant win",a:win});il.push({n:"very bad goods",v:"sell drugs",a:inject,cd:30});il.push({n:"awesome intelligence",v:"contact",a:interact});il.push({n:"scary look",v:"contact",a:interact});il.push({n:"forged documents",v:"circulate",a:interact,cd:200});
il.push({n:"forged id cards",v:"circulate",a:interact,cd:200});il.push({n:"rare spell scrolls",v:"offer your goods",a:interact,cd:200});il.push({n:"spoon",v:"take samples",a:interact,cd:250});il.push({n:"specimen bottle",v:"take samples",a:interact,cd:250});il.push({n:"vampire fang",v:"bite",a:transmit,cd:300});il.push({n:"epic pickpocket skills",v:"rob someone near you",a:rob,cd:200,p:5});var ss=new Image;ss.onload=mainsc;ss.src="ss.png";
function ecl(a,b,c,e){return Math.sqrt((a-c)*(a-c)+(b-e)*(b-e))}function rnd(a,b){return a+Math.round(Math.random()*(b-a-1))}function def(a){return"undefined"!=typeof a}function mainsc(){gl=0;reset();for(var a=0;4>a;a++)cl[a].r=rl[0],initch(cl[a]);cl[3].i=il[15];cl[0].hd=["the background ? :S",300,"what's wrong with",300];cl[0].dx=350;wa=!0;sm=setInterval(mainlp,20)}
function mainlp(){upddrw();wrt("super best friends",12,73,50,rc);ctx.fillStyle=bc;ctx.fillRect(565,73,360,15);wrt("whatever",10,604,127,bc);if(0==gg&&0==cl[0].t)cl[0].d=1,cl[0].hd=["i am roger!",100,"hey kids :D",100],gg++;else if(1==gg&&0==cl[0].hd.length)cl[0].hd=["in super fun land!",250,"have super fun time",250,"together we gonna",250],gg++;else if(2==gg&&0==cl[0].hd.length)cl[0].d=0,cl[1].dx=510,cl[0].hd=["super best friends.",250,"he's one of my",250,"hey! here's roderick.",250],gg++;else if(3==
gg&&0==cl[1].t)cl[0].hd=[],cl[1].hd=["my awesome friend?",250,"how are you",250,"hey roger :D",250],gg++;else if(4==gg&&0==cl[1].hd.length)cl[0].hd=["actually i'm superb.",200,"fine.",200],gg++;else if(5==gg&&0==cl[0].hd.length)cl[1].hd=["brian and samson?",250,"our other two best friends",250,"cool! have you seen",250],gg++;else if(6==gg&&0==cl[1].hd.length)cl[2].dx=700,cl[0].hd=["isn't this samson's voice?",250,"but wait!",250,"no...",250],gg++,updmvs(!1,7);else if(7==gg&&0==cl[2].t)cl[0].hd=[],
cl[2].hd=["run for your lives!",250,"seriously...",250,"guys guys guys!",250],gg++;else if(8==gg&&0==cl[2].hd.length)cl[1].d=0,cl[1].hd=["what's going on?",250,"my fantastic mate samson!",250],gg++;else if(9==gg&&0==cl[1].hd.length)cl[2].hd=["to our repository.",250,"wrong source codes",250,"idiot developers commited",250],gg++;else if(10==gg&&0==cl[2].hd.length)cl[3].dx=850,cl[2].hd=["this's a shot'em up game!",250,"now brian thinks",250],gg++;else if(11==gg&&0==cl[3].t)cl[2].hd=[],cl[3].hd=["to my little fella",
250,"say hello",250,"here you are my best friends.",250],addhud(cl[0],"wut?",250),addhud(cl[1],"wtf?",250),addhud(cl[2],"ah come on!",250),gg++;else if(12==gg&&0==cl[3].hd.length){for(var a=0;a<cl.length;a++)cl[a].dx=-400;addhud(cl[0],"aaaahhhhh",9999);addhud(cl[1],"run away! run away!",9999);addhud(cl[2],"holy sh...",9999);addhud(cl[3],"die guys. lol",9999);gg++;updmvs(!1,10)}else if(0==cl[3].t&&13==gg){cl[0].x=-100;cl[1].x=-260;cl[2].x=-450;cl[3].x=-600;for(a=0;a<cl.length;a++)cl[a].dx=1400;gg++;
updmvs(!1,10)}else if(14==gg&&0==cl[3].t){cl[0].x=1400;cl[1].x=1560;cl[2].x=1750;cl[3].x=2E3;for(a=0;a<cl.length;a++)cl[a].dx=-400;gg--;updmvs(!1,10)}else 13==gg||14==gg?(fire.call(cl[3]),updmvs(!1,10)):7==gg&&updmvs(!1,7);13!=gg&&14!=gg&&7!=gg&&updmvs(!1,3);wrt("press a to start",7,73,512,gc)}function initlvl(){reset();gl++;createchs();introsc();gs=1}
function createchs(){var a=[];cc=cl[rnd(0,cl.length)];cc.r=rl[rnd(0,rl.length)];initch(cc);var a=a.concat(cc.r.c).concat(cc.r.e),b;do b=cl[rnd(0,cl.length)];while(b==cc);if(4>cc.r.t){if(b.r=rl[cc.r.c[rnd(0,cc.r.c.length)]],3==cc.r.t){var c;do c=cl[rnd(0,cl.length)];while(c==cc||c==b);c.r=rl[b.r.e[rnd(0,b.r.e.length)]];initch(c);a=a.concat(c.r.c).concat(c.r.e)}}else{do b.r=rl[rnd(0,rl.length)];while(4!=b.r.t);0<cc.r.e.length&&(b.r=rl[cc.r.e[rnd(0,cc.r.e.length)]])}initch(b);a=a.concat(b.r.c).concat(b.r.e);
for(c=0;c<rl.length;c++)0==rl[c].c.length&&a.push(c);for(c=0;c<cl.length;c++)if(!def(cl[c].r)){do{cl[c].r=rl[a[rnd(0,a.length)]];for(var e=0;e<c;e++)cl[e].r==cl[c].r&&(cl[c].r=cc.r)}while(cl[c].r==cc.r||cl[c].r==b.r);initch(cl[c]);a=a.concat(cl[c].r.c).concat(cl[c].r.e)}}
function introsc(){ctx.clearRect(0,0,cnv.width,cnv.height);bgdrw();cc.x=77;cc.y=77;var a=info(cc);wrt(a[0],3,190,73,bc);wrt(a[1],2,190,100,dc);2<a.length&&wrt(a[2],2,190,123,dc);drw(cc,!1);for(var b=215,c=0;c<cl.length;c++)if(cl[c]!=cc){cl[c].x=77;cl[c].y=b;drw(cl[c],!1);a=info(cl[c]);wrt(a[0],3,190,b-4,bc);wrt(a[1],2,190,b+23,dc);wrt("stamina: ",2,190,b+46,dc);ctx.fillStyle=3==cl[c].s?rc:6==cl[c].s?yc:gc;for(a=0;a<cl[c].s/3;a++)ctx.fillRect(260+13*a,b+43,10,15);wrt("vitality: ",2,320,b+46,dc);ctx.fillStyle=
80==cl[c].mh?rc:100==cl[c].mh?yc:gc;for(a=0;a<(cl[c].mh-60)/20;a++)ctx.fillRect(400+13*a,b+43,10,15);wrt("intelligence: ",2,455,b+46,dc);ctx.fillStyle=70==cl[c].di?rc:100==cl[c].di?yc:gc;for(a=0;a<(cl[c].di-40)/30;a++)ctx.fillRect(570+13*a,b+43,10,15);b+=cl[c].h+41}gt=25+10*rnd(0,3);a="to win: "+cc.r.o;if(4>cc.r.t){for(c=0;c<cl.length;c++)-1!=cc.r.c.indexOf(rl.indexOf(cl[c].r))&&ol.push(cl[c].n);a=a+" "+(3==ol.length?"everybody.":ol.join()+".");c=a.lastIndexOf(",");-1!=c&&(a=a.substr(0,c)+" and "+
a.substr(c+1,a.length))}else a=7>cc.r.t?a+" "+(1==(gm=rnd(1,4))?"1 character.":gm+" characters."):a+".";gg=cc.r.t;wrt("you play as:",6,77,23,rc);wrt("other characters:",6,77,161,rc);wrt(a,6,77,b-8,rc);wrt("game time is  "+gt+" seconds.",6,269,b+38,rc);gt*=50}
function placechs(){for(var a=0;a<cl.length;a++){var b;do{b=!0;cl[a].dx=rnd(19,cnv.width-cl[a].w-19);cl[a].dy=rnd(19,cnv.height-cl[a].h-19);for(var c=0;c<a;c++)333>ecl(cl[a].dx,cl[a].dy,cl[c].dx,cl[c].dy)&&(b=!1)}while(!b)}sm=setInterval(upd,20)}
function upd(){if(2==gs){for(var a=0,b=0;b<cl.length;b++)0==cl[b].t&&(a++,cl[b].d=1);4==a&&(clearInterval(sm),gs=3);updmvs(!1,15)}else if(4==gs){null!=cc&&0>=cc.ac&&checkcc();for(b=0;b<cl.length;b++)cl[b]!=cc&&checkch(cl[b]);for(b=0;b<cl.length;b++)interaction(cl[b]);updmvs(!0,0);gt--;mc--}upddrw();3==gs&&wrt("ready?",7,cnv.width/2-msr("ready?",7),250,dc);wrt("level: "+gl,3,28,27,rc);wrt("time left: "+Math.round(gt/50),3,28,51,bc);checkgame()}
function updmvs(a,b){for(var c=0;c<cl.length;c++)cl[c].ac--,def(cl[c].i.a)&&cl[c].i.t--,0>=cl[c].ac&&move(cl[c],a,b);for(c=0;c<ml.length;c++)if(move(ml[c],!1,0),0==ml[c].t){if("stan"==ml[c].n)for(var e=rnd(7,19),g=0;g<e;g++){var h={x:rnd(ml[c].x-ml[c].w/2,ml[c].x+ml[c].w/2),y:rnd(ml[c].y-ml[c].h/2,ml[c].y+ml[c].h/2),w:9,h:9,ox:197,oy:204,n:"bill",s:30};h.dm=rnd(30,70);var f=rnd(70,100),f=calcdest(h.x,h.y,rnd(0,4),f);h.dx=f.dx;h.dy=f.dy;h.o=ml[c].o;ml.push(h)}ml.splice(c,1)}}
function upddrw(){bgdrw();for(var a=0;a<sl.length;a++)drw(sl[a],!1);for(a=0;a<cl.length;a++)drw(cl[a],!0);for(a=0;a<ml.length;a++)drw(ml[a],!1)}function checkcc(){rp&&0>mc||0<mc&&lp?cc.dx+=cc.s:lp&&0>mc||0<mc&&rp?cc.dx-=cc.s:up&&0>mc||0<mc&&dp?cc.dy-=cc.s:dp&&0>mc||0<mc&&up?cc.dy+=cc.s:cc.t=0;def(cc.i.a)&&wa&&cc.i.a.call(cc)}function checkch(a){def(a.i.a)&&0>=a.ac&&0>=a.i.t&&aiact(a);(0>=a.dt--||0>=a.t)&&aimove(a)}
function finalscene(){ctx.clearRect(0,0,cnv.width,cnv.height);bgdrw();5==gs?(wrt("level "+gl+" cleared",12,cnv.width/2-msr("level "+gl+" cleared",12),73,rc),wrt(wn,7,cnv.width/2-msr(wn,7),190,bc)):6==gs&&(wrt("level "+gl+" failed",12,cnv.width/2-msr("level "+gl+" failed",12),73,rc),wrt(df,7,cnv.width/2-msr(df,7),190,bc),wrt("your score is "+(gl-1),7,cnv.width/2-msr("your score is "+gl,7),330,yc));wrt("press a to continue.",5,cnv.width/2-msr("press a to continue.",5),500,gc)}
function bgdrw(){ctx.clearRect(0,0,cnv.width,cnv.height);if(0==bt--){bp=[];for(var a=0;a<Math.ceil(cnv.height/23);a++){for(var b=[],c=0;c<Math.ceil(cnv.width/23);c++)b.push(rnd(0,7));bp.push(b)}bt=40}for(a=0;a<Math.ceil(cnv.height/23);a++)for(c=0;c<Math.ceil(cnv.width/23);c++)ctx.drawImage(ss,23*bp[a][c],204,23,23,23*c,23*a,23,23)}
function reset(){gg=0;cl=[];sl=[];ml=[];ol=[];gm=0;cl.push({x:-300,y:300,w:48,h:51,ox:48,oy:0,n:"roger"});cl.push({x:1200,y:350,w:48,h:51,ox:48,oy:51,n:"roderick"});cl.push({x:2E3,y:400,w:48,h:51,ox:48,oy:102,n:"samson"});cl.push({x:1200,y:260,w:48,h:51,ox:48,oy:153,n:"brian"});df=wn="";wa=!1}
function initch(a){a.i=il[a.r.i[rnd(0,a.r.i.length)]];def(a.i.a)&&def(a.i.l)&&(a.i.c=0==a.i.l.length?a.i.l[0]:rnd(a.i.l[0],a.i.l[1]));a.i.t=0;if(a==cc){var b=0;3>gl?b=2:6>gl&&(b=1);a.s=3+3*rnd(b,3);a.mh=80+20*rnd(b,3)}else a.s=3*rnd(1,4),a.mh=80+20*rnd(0,3);a.ch=a.mh;a.di=70+30*rnd(0,3);a.hd=[];a.c=[];a.e=[];a.t=1;a.d=1;a.dt=0;a.aa=null;a.a=!1;a.dx=a.x;a.dy=a.y;a.ct=0;a.co=null;a.ac=0}
function info(a){var b=[];b.push(a.n+" the "+a.r.n);it="with "+a.i.n;"undefined"!=typeof a.i.c&&(it+=1==a.i.c?": 1 usage only":": "+a.i.c+" usages");b.push(it+".");def(a.i.a)&&b.push("press  a  to "+a.i.v);return b}function drw(a,b){def(a.hd)&&otp(a);if(b){var c=10>a.t?0:5;a.ox=a.w*a.d;ctx.drawImage(ss,a.ox,a.oy+a.h/2,a.w,a.h/2,a.x,a.y+a.h/2,a.w,a.h/2);ctx.drawImage(ss,a.ox,a.oy,a.w,a.h/2,a.x,a.y+c+1,a.w,a.h/2)}else ctx.drawImage(ss,a.ox,a.oy,a.w,a.h,a.x,a.y,a.w,a.h)}
function otp(a){if(0!=a.hd.length){6<a.hd.length&&a.hd.splice(0,a.hd.length-6);for(var b=0;b<a.hd.length;b+=2)wrt(a.hd[b],2,a.x+a.w/2-msr(a.hd[b],2),a.y-19-7*b,dc),a.hd[b+1]--;0>=a.hd[1]&&a.hd.splice(0,2)}}
function move(a,b,c){c=0==c?a.s:c;20==a.t++&&(a.t=1);var e=a.dx-a.x,g=a.dy-a.y;Math.abs(e)>c/2?(a.x+=0<e?c:-c,a.d=0<e?0:3,b&&!colldet(a)&&(a.x-=0<e?c:-c,a==cc?a.dx=a.x:(def(a.i.a)&&0>=a.i.t&&aiact(a),aimove(a)))):Math.abs(g)>c/2?(a.y+=0<g?c:-c,a.d=0<g?1:2,b&&!colldet(a)&&(a.y-=0<g?c:-c,a==cc?a.dy=a.y:(def(a.i.a)&&0>=a.i.t&&aiact(a),aimove(a)))):(a.t=0,a.dx=a.x,a.dy=a.y)}
function colldet(a){var b=!0;if(0>a.x||a.x+a.w+9>cnv.width)b=!1;if(0>a.y||a.y+a.h+9>cnv.height)b=!1;var c=a.x,e=a.y,g=a.w,h=a.h;0>=a.ct--&&(a.co=null);for(var f=0;f<cl.length;f++)if(cl[f]!=a){var k=cl[f].x-7,l=cl[f].y-7,d=cl[f].h+14,m=cl[f].x,n=cl[f].y,p=cl[f].w,q=cl[f].h;c<k+(cl[f].w+14)&&c+g>k&&e<l+d&&h+e>l&&(0==a.d&&k>c?(a.co=cl[f],a.ct=3):3==a.d&&c>k?(a.co=cl[f],a.ct=3):1==a.d&&l>e?(a.co=cl[f],a.ct=3):2==a.d&&e>l?(a.co=cl[f],a.ct=3):a.ct--);c<m+p&&c+g>m&&e<n+q&&h+e>n&&(b=!1)}return b}
function interaction(a){for(var b,c,e,g,h=a.x,f=a.y,k=a.w,l=a.h,d=0;d<ml.length;d++)if(ml[d].o!=a&&(b=ml[d].x,c=ml[d].y,e=ml[d].w,g=ml[d].h,h<b+e&&h+k>b&&f<c+g&&l+f>c)){if(-1==cl.indexOf(a))break;if("bill"==ml[d].n)appdmg(a,ml[d]);else if("mike"==ml[d].n)sl.push({x:a.x,y:a.y,w:a.w,h:a.h,ox:48,oy:a.oy,n:"cgd",o:ml[d].o,s:a,hd:["prisoned",9999]}),cl.splice(cl.indexOf(a),1),ml[d].o==cc?exclude(a.n):a==cc&&(cc=null);else if("joel"==ml[d].n)a.ac=ml[d].dm,addhud(a,"stunned :D",ml[d].dm);else if("leon"==
ml[d].n){do for(a.x=rnd(19,cnv.width-a.w-19),a.y=rnd(19,cnv.height-a.h-19),b=0;b<cl.length;b++)cl[d]!=a&&200>ecl(a.x,a.y,cl[d].x,cl[d].y)&&(a.x=0);while(0==a.x)}else if("stan"==ml[d].n)for(b=rnd(7,19),d=0;d<b;d++)c={x:rnd(ml[d].x-ml[d].w/2,ml[d].x+ml[d].w/2),y:rnd(ml[d].y-ml[d].h/2,ml[d].y+ml[d].h/2),w:9,h:9,ox:197,oy:204,n:"bill",s:30},c.dm=rnd(30,70),e=rnd(70,100),e=calcdest(c.x,c.y,rnd(0,4),e),c.dx=e.dx,c.dy=e.dy,c.o=ml[d].o,ml.push(c);ml.splice(d,1)}for(d=0;d<sl.length;d++)sl[d].o!=a&&(b=sl[d].x,
c=sl[d].y,e=sl[d].w,g=sl[d].h,h<b+e&&h+k>b&&f<c+g&&l+f>c&&"mn"==sl[d].n&&(appdmg(a,sl[d]),sl.splice(d,1)))}function addhud(a,b,c){a.hd.push(b);a.hd.push(c)}
function checkgame(){if((""!=wn||""!=df)&&77>gm)gm++;else{if(""!=wn||""!=df)gs=""!=wn?5:6,finalscene();if(6==gs||5==gs)clearInterval(sm),finalscene();null==cc&&(df="you are inactivated.");var a=0;if(1==gg||4==gg){for(var b=0;b<sl.length;b++)if(-1!=ol.indexOf(sl[b].s.n)&&sl[b].o==cc&&1==gg)a++;else if(-1==ol.indexOf(sl[b].s.n)&&sl[b].o==cc&&1==gg){df="you killed "+sl[b].s.n+" by mistake.";break}else if(-1!=ol.indexOf(sl[b].n)&&1==gg){df="your target is killed by "+sl[b].o.n+".";break}else 4==gg&&sl[b].o==
cc&&a++;a==ol.length&&1==gg?wn="you killed all your targets.":a==gm&&4==gg?wn="you killed enough.":4==gg&&gm-a>cl.length&&(df="not enough character left for you.")}else if(3==gg||6==gg){for(b=0;b<cl.length;b++)-1!=ol.indexOf(cl[b].n)&&3==gg&&a++;a!=ol.length&&3==gg?df="you couldn't guard.":cl.length-1<gm&&(df="you couldn't guard.")}if(0>=gt&&(3==cc.r.t||6==cc.r.t||7==cc.r.t))wn="you've made it.",gm=99;else if(0>=gt)df="time is over.",gm=99;else if(""!=wn||""!=df)gm=0}}
function checkitem(a){var b=0;def(a.i.cd)?(b=a.i.cd,wa=!1):def(a.i.rl)?b=a.i.rl:wa=!1;if(!def(a.i.r)&&null==a.co&&0>=a.i.t)return addhud(a,"nobody around",50),!1;if(0<a.i.t&&!wa&&a==cc)return addhud(a,"cooling down",50),!1;if(0<a.i.t)return!1;if("undefined"!=typeof a.i.c){if(0>=a.i.c)return a==cc&&addhud(a,"out of item",50),!1;addhud(a,a.i.n+" usages left: "+--a.i.c,50)}a.i.t=b;return!0}
function aimove(a){a.dt=a.di;a.c=[];a.e=[];for(var b=0;b<cl.length;b++)cl[b]!=a&&(-1!=a.r.c.indexOf(rl.indexOf(cl[b].r))?a.c.push(cl[b]):-1!=a.r.e.indexOf(rl.indexOf(cl[b].r))?a.e.push(cl[b]):4==cl[b].r.t?a.e.push(cl[b]):6!=a.r.t||1!=cl[b].r.t&&4!=cl[b].r.t?0==a.r.c.length&&a.c.push(cl[b]):a.c.push(cl[b]));a.aa=null;77>rnd(0,99)&&0!=a.c.length?(a.aa=a.c[rnd(0,a.c.length)],a.dx=a.aa.x,a.dy=a.aa.y):0!=a.e.length&&(a.aa=a.e[rnd(0,a.e.length)],a.dx=a.x-(a.aa.x-a.x),a.dy=a.y-(a.aa.y-a.y),0>a.dx?a.dx=19:
a.dx>cnv.width-a.w&&(a.dx=cnv.width-a.w-19),0>a.dy?a.dy=19:a.dy>cnv.height-a.h&&(a.dy=cnv.height-a.h-19));if(null==a.aa||197>ecl(a.x,a.y,a.dx,a.dy))a.dx=rnd(19,cnv.width-a.w-19),a.dy=rnd(19,cnv.height-a.h-19)}function aiact(a){var b=3==a.r.t||6==a.r.t||7==a.r.t?a.e:a.c;if(def(a.i.r))for(var c=0;c<b.length;c++){if(ecl(a.x,a.y,b[c].x,b[c].y)<a.i.r){a.i.a.call(a);break}}else null!=a.co&&-1!=b.indexOf(a.co)&&a.i.a.call(a)}
function appdmg(a,b){addhud(a,"damage taken - hp:"+(a.ch-=b.dm)+"/"+a.mh,50);0>=a.ch&&die(a,b.o)}function die(a,b){sl.push({x:a.x,y:a.y,w:48,h:51,ox:192,oy:a.oy,n:"grv",o:b,s:a,hd:["rip",9999]});cl.splice(cl.indexOf(a),1);a==cc&&(cc=null)}function apphl(a,b){a.ch=a.ch+b>a.mh?a.mh:a.ch+b;addhud(a,"healed - hp:"+a.ch+"/"+a.mh,50)}function calcdest(a,b,c,e){0==c?a+=e:3==c?a-=e:b=1==c?b+e:b-e;return{dx:a,dy:b}}
function exclude(a){2==gg&&-1!=ol.indexOf(a)?(ol.splice(ol.indexOf(a),1),0==ol.length&&(wn="you got the job done.")):2==gg?df="wrong target: "+a:5==gg&&0==--gm&&(wn="that's enough for now :D")}function interact(){checkitem(this)&&(addhud(this,"success!",50),this==cc&&exclude(this.co.n))}
function fire(){if(checkitem(this)){var a={x:this.x+this.w/2,y:this.y+this.h/2,w:9,h:9,ox:161+9*this.i.p[2],oy:204,s:this.i.p[0],dm:this.i.p[1],n:"bill"},b=calcdest(a.x,a.y,this.d,this.i.r);a.dx=b.dx;a.dy=b.dy;a.o=this;ml.push(a)}}function arrest(){checkitem(this)&&(sl.push({x:this.co.x,y:this.co.y,w:this.co.w,h:this.co.h,ox:48,oy:this.co.oy,n:"cgd",o:this,s:this.co,hd:["prisoned",9999]}),cl.splice(cl.indexOf(this.co),1),this==cc?exclude(this.co.n):this.co==cc&&(cc=null))}
function rngarrest(){if(checkitem(this)){var a={x:this.x+this.w/2,y:this.y+this.h/2,w:9,h:9,ox:188,oy:204,o:this,n:"mike"};a.s=this.i.p;var b=calcdest(a.x,a.y,this.d,this.i.r);a.dx=b.dx;a.dy=b.dy;a.o=this;ml.push(a)}}
function scdatt(){if(checkitem(this)){var a=rnd(7,19);die(this,this);for(var b=0;b<a;b++){var c={x:rnd(this.x-this.w/2,this.x+this.w/2),y:rnd(this.y-this.h/2,this.y+this.h/2),w:9,h:9,ox:197,oy:204,n:"bill",s:30};c.dm=rnd(30,70);var e=rnd(70,100),e=calcdest(c.x,c.y,rnd(0,4),e);c.dx=e.dx;c.dy=e.dy;c.o=this;ml.push(c)}}}
function sex(){checkitem(this)&&(this.co.ch>.7*this.co.mh?addhud(this,"health is high - rejected",50):(apphl(this.co,30),0>=this.co.s&&(this.co.s=1),addhud(this.co,"speed nerfed",50),0>=this.s&&(this.s=1),addhud(this,"speed nerfed",50),this==cc&&exclude(this.co.n)))}
function inject(){checkitem(this)&&(this.co.ch<.5*this.co.mh?addhud(this,"health is low - rejected",50):(appdmg(this.co,{dm:30,o:this}),this.co.s+=2,9<=this.co.s&&(this.co.s=9),addhud(this.co,"speed buffed",50),this.co.ac=100,addhud(this.co,"stonned",100),this==cc&&exclude(this.co.n)))}function stun(){checkitem(this)&&(this.co.ac=this.i.p,addhud(this.co,this.i.v+"ed",this.i.p),addhud(this.co,"stunned",this.i.p))}
function rngstun(){if(checkitem(this)){var a={x:this.x+this.w/2,y:this.y+this.h/2,w:9,h:9,ox:179,oy:204,n:"joel"};a.s=this.i.p[0];a.dm=this.i.p[1];var b=calcdest(a.x,a.y,this.d,this.i.r);a.dx=b.dx;a.dy=b.dy;a.o=this;ml.push(a)}}
function suspend(){if(checkitem(this)){addhud(this.co,this.i.v+"ed",50);addhud(this.co,"running away",50);var a=calcdest(this.co.x,this.co.y,(this.co.d+2)%3,500);this.co.dx=a.x;this.co.dy=a.y;0>this.co.dx&&(this.co.dx=0);this.co.dx>cnv.width-this.co.w&&(this.co.dx=cnv.width-this.co.w);0>this.co.dy&&(this.co.dy=0);this.co.dy>cnv.height-this.co.h&&(thid.co.dy=cnv.height-this.co.h);this.co.dt=130}}
function minelay(){checkitem(this)&&sl.push({x:this.x,y:this.y,w:18,h:9,ox:161,oy:213,n:"mn",o:this,dm:150})}function mlatt(){checkitem(this)&&(rnd(0,100)<this.i.p[1]?addhud(this,"miss",50):appdmg(this.co,{dm:this.i.p[0],o:this}))}function selfheal(){checkitem(this)&&(this!=cc&&this.ch>.7*this.mh||apphl(this,this.i.p))}function rngheal(){if(checkitem(this))for(var a=0;a<cl.length;a++)this!=cl[a]&&ecl(cl[a].x,cl[a].y,this.x,this.y)<this.i.r&&apphl(cl[a],this.i.p)}
function rob(){checkitem(this)&&(rnd(0,100)<this.i.p?(addhud(this,"failed",50),addhud(this.co,"heeey!",50)):(addhud(this,"success",50),addhud(this.co,"robbed",50),this==cc&&exclude(this.co.n)))}function transmit(){checkitem(this)&&(sl.push({x:this.co.x,y:this.co.y,w:this.co.w,h:this.co.h,ox:48,oy:this.co.oy,n:"trns",o:this,s:this.co,hd:["transformed",9999]}),cl.splice(cl.indexOf(this.co),1),this==cc?exclude(this.co):this.co==cc&&(cc=null))}
function cngcnt(){checkitem(this)&&this==cc&&(mc=this.i.p,addhud(this,"haluscinating",this.i.p))}function call(){if(checkitem(this)){for(var a=null,b=0;b<cl.length;b++)if(cl[b]!=this){var c=ecl(this.x,this.y,cl[b].x,cl[b].y);if(-1!=this.r.c.indexOf(rl.indexOf(cl[b].r))&&c<this.i.p[0]){a=cl[b];break}}null!=a?(a.dx=this.x,a.dy=this.y,a.dt=130,addhud(this,a.r.n+" is called",50),addhud(a,"coming!",50)):addhud(this,"no one to call around",50)}}
function surprise(){if(checkitem(this)){for(var a=0;a<cl.length;a++)cl[a]!=this&&ecl(this.x,this.y,cl[a].x,cl[a].y)<this.i.p&&(cl[a].ac=50,0==rnd(0,2)?addhud(cl[a],"wtf!",50):0==rnd(0,2)?addhud(cl[a],"wut?",50):0==rnd(0,2)?addhud(cl[a],"is that a joke?",50):addhud(cl[a],"wtf did i just see?",50));addhud(this,"surprise mfs",50)}}
function rndgo(){if(checkitem(this)){var a={x:this.x+this.w/2,y:this.y+this.h/2,w:9,h:9,ox:160,oy:204,o:this,n:"leon",s:20},b=calcdest(a.x,a.y,this.d,this.i.r);a.dx=b.dx;a.dy=b.dy;a.o=this;ml.push(a)}}function bomb(){if(checkitem(this)){var a={x:this.x+this.w/2,y:this.y+this.h/2,w:12,h:12,ox:179,oy:213,o:this,n:"stan",s:25},b=calcdest(a.x,a.y,this.d,this.i.r);a.dx=b.dx;a.dy=b.dy;a.o=this;a.t=3;ml.push(a)}}function win(){checkitem&&this==cc&&(wn="towel win.",gm=99)};
