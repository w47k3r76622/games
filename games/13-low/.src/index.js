(()=>{"use strict";const t=Math,s=(t.PI,(t,s)=>t>s?t:s),e=(t,s)=>t<s?t:s,i=s=>t.random()*s,r=s=>t.floor(s),h=(s,e)=>t.hypot(s.x-e.x,s.y-e.y),n=(t,s)=>(t.push(s),t),o=(t,s)=>new Array(t).fill(s),a=localStorage,c=(t,s)=>a.setItem(t,s),p=t=>a.getItem(t),l=[{tap:1,dg:[],map:[[1,0,0,0,2]]},{tap:1,dg:[5],map:[[0,0,0,0,2],[1,0,0,0,9]]},{tap:1,dg:[5,7,5,7,5,8],map:[[1,9,0,0,0,11,2],[0,0,0,11,0,0,0]]},{tap:1,dg:[5,5,7,8],map:[[1,0,9,0,2],[0,0,0,0,9]]},{tap:2,dg:[5,7],map:[[8,0,0,11,0],[0,0,0,0,0],[0,2,0,0,0],[0,0,0,0,6],[0,11,0,1,0]]},{tap:2,dg:[7,9],map:[[0,0,0,0,8],[0,0,0,11,0],[0,0,11,2,0],[0,0,0,11,0],[0,1,0,0,0]]},{tap:2,dg:[6,6,10],map:[[8,0,0,0,0],[0,0,0,0,0],[0,0,2,9,1],[0,0,0,0,0],[7,0,0,0,0]]},{tap:2,dg:[9],map:[[0,0,11,0,0,0],[0,0,0,2,0,0],[0,1,0,0,11,0]]},{tap:3,dg:[8],map:[[0,0,10,0,0,0],[0,0,2,0,0,0],[0,0,0,0,1,0]]},{tap:3,dg:[7,9],map:[[11,11,0,0,6,0],[0,0,2,0,0,10],[0,11,10,0,0,0],[0,0,6,0,1,0]]},{tap:3,dg:[5,6,9],map:[[0,0,0,0,0,0],[0,11,0,0,11,0],[0,11,10,0,2,10],[0,11,0,0,11,0],[1,0,0,0,0,0]]},{tap:3,dg:[5,6,7,8],map:[[0,0,10,0,0],[0,11,2,11,0],[0,0,11,0,0],[0,0,0,0,0],[0,0,0,1,0]]},{tap:2,dg:[10],map:[[0,0,9,0,0,0],[0,9,2,9,3,0],[0,0,9,0,0,0],[0,0,0,0,1,0]]},{tap:4,dg:[5,3,7],map:[[0,0,0,0,0,0,0],[0,0,8,0,0,0,0],[0,11,2,9,0,0,0],[0,0,9,0,0,0,0],[0,0,0,10,0,0,1]]},{tap:4,dg:[3,7],map:[[10,4,0,10,9,0,6],[0,0,0,9,9,0,0],[0,0,11,0,1,11,0],[0,2,0,0,0,0,0],[0,11,0,0,0,0,0],[0,0,0,0,0,0,0]]},{tap:3,dg:[5,6,7],map:[[0,0,0,0,0,0,0],[0,0,0,9,2,9,0],[0,0,0,0,0,4,0],[9,0,0,0,9,0,0],[0,1,0,0,0,0,0],[0,0,0,11,0,3,11]]},{tap:8,dg:[4,7,10],map:[[0,0,0,0,0,0,0,0,0,0],[0,1,0,9,0,0,0,6,6,6],[0,0,0,0,0,10,0,0,9,0],[0,0,3,0,7,0,0,9,2,0],[0,0,0,0,0,0,0,0,9,0]]},{tap:6,dg:[7],map:[[10,0,0,0,0,0,0,0,0],[0,0,0,9,9,9,0,0,0],[1,0,11,5,2,6,11,0,0],[0,0,0,9,9,9,0,0,0],[0,4,0,0,0,0,0,3,0],[0,0,0,0,0,10,0,0,10]]},{tap:10,dg:[],map:[[0,0,0,0,0,9,0,4,0,0],[0,0,9,0,0,0,0,0,0,0],[0,0,0,0,1,0,9,0,0,0],[0,2,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,9,0,0]]},{tap:8,dg:[7],map:[[0,0,9,0,0,0,0,0,4,0],[0,2,0,0,0,0,9,0,0,0],[0,0,3,0,0,9,9,0,0,0],[0,9,0,0,0,0,9,0,1,0],[0,0,0,0,9,0,0,0,0,0]]},{tap:15,dg:[8],map:[[0,0,0,0,0,0,0,1,0],[0,0,0,3,0,0,0,0,0],[9,9,9,0,0,9,9,9,9],[0,0,9,0,0,0,11,0,9],[0,2,9,0,0,0,9,9,9],[0,0,9,0,4,0,0,11,9],[11,0,9,10,0,9,9,9,9]]}],d=document,u=t=>t.getContext("2d"),g=t=>new Image,m=t=>t.toDataURL(),w=d.getElementById("canvas");const y=u(w),f=(t,s)=>{t&&y.drawImage(t,s.x,s.y,s.w,s.h)},x=t=>y.globalAlpha=t,v=t=>y.fillStyle="#"+t,b=t=>y.save(),M=t=>y.restore(),T=[0,0,0],k=[0,1,0],I=[1,0,0],E=[0,0,1],O="333",A="fff",R="065279",C="425066",P={tiles:[null],clickTiles:[],player:[],A2ZTile:{},ATB:{},item:{color:[O,"2a7",O,A,"a84",O,"bcb","a00","216","216","297",...o(4,A),"216","216",A],count:[T,T,T,T,I,T,T,T,I,I,k,k,k,k,k,E,E,k],pattern:["p𡎁鉈饓乒𑁁ǀ"," ￰𝶀𝮻𸀷ǿ"," 𡿀🰿𼏸𿿧𤬤᤮","௾윘𗖑𵫫𙄵̜࿺","𘐙؀𙠙𘙀ᤆ怘ၤ","鿿퉙鏉驋𙉹鍉῿","𕿿𝕝𕗕𕵗𝕵𕝕῿","᯾큜熑𱣣𙄱݁࿻","Ё𡿰𔤤𤌤𲤤𤡥ᔐ","𦄤𡥂𔐤𔌘⒄𱡑ѐ","𬁰𱣁𧍤릳𥅚Ҿ࿹","𾀀𺁇𬹓𐕈𥻊𿢁","萉Ȁ耈Ȁࠂ ဤ","耀̀．𿏾ฃ‌","𠀀ఀ𿰸𼿸㠏耰","𾀀𑥱꛹ꄤ𿓃🡥","𾀀𑩱쫲𒅌𿥂🡩","ᤁ𸑱༅𰗠𐘑Є"]},font:{color1:o(40,"a78e44"),color2:o(40,"e29c45"),pattern:["","𲅻𛴉","𒥎䀑","䘮䀑","𭙮","𡃄","𤘮🢍","𤘮𞣅","𺔩萣","𰘮","𸘮","𢈟䈐","𴘾","𴘾𐡃","읮𑷾","𼘯","蘮","옯","𸘿🢅","𸘿ႅ","𨘮","𼘱𑣇","𡂎","䈐쥊","𺘱𑢤","萡🂄","흱𑣆","홱𑣇","옮","𼘮ႅ","옮🳖","𼘯𑒕","𰘮","𡂟䈐","옱","옱䕆","옱𑷖","𢨱𑢨","𢨱䈐","𢈿🢈"]}},j={mw:0,mh:0,mis:300,level:0,player:null,tap:0,emerge:0,sound:1,dragRect:null,dragNumber:0,dragCount:2,background:null,trans:{s:0,st:null,e:0,et:null},UI:{controler:[1,0,0],view:[]},meunMaxWidth:250,meunMaxheight:150,meunItemLenth:24,gm:[],dragMax:[],gameObject:[],dragObject:[],clickObject:[],historyMap:[],currentMap:[],RME:function(t){return this.UI.controler=[...t],[...t]},get gameStart(){return this.UI.controler.find((t=>1==t))},get fadeIn(){return this.trans.s=1,this.trans.e=0,1},get fadeOut(){return this.trans.s=0,this.trans.e=1,0},get cw(){return this.mw/2},get ch(){return this.mh/2},get mwl(){let t=0;return this.currentMap.forEach((e=>{t=s(t,e.length)})),t},get mhl(){return this.currentMap.length},get grid(){let t=e(this.mw,this.mh),i=s(this.mwl,this.mhl)+3;return e(this.mis,t/i)},get gwh(){return{x:this.grid,y:this.grid}},get menuItemSize(){return{x:e(this.meunMaxWidth,1.5*this.grid),y:e(this.meunMaxheight,this.ch/(this.meunItemLenth/4))}},get CurPos(){return{x:this.cw-this.mwl*this.grid/2,y:this.ch-this.mhl*this.grid/2}},get maxLgth(){return{x:this.mwl,y:this.mhl}}},S=({x:t,y:s,w:e,h:i},r=1,h=0,n=5)=>{y.beginPath(),y.moveTo(t+n,s),y.lineTo(t+e-n,s),y.quadraticCurveTo(t+e,s,t+e,s+n),y.lineTo(t+e,s+i-n),y.quadraticCurveTo(t+e,s+i,t+e-n,s+i),y.lineTo(t+n,s+i),y.quadraticCurveTo(t,s+i,t,s+i-n),y.lineTo(t,s+n),y.quadraticCurveTo(t,s,t+n,s),y.closePath(),r&&y.fill(),h&&y.stroke()},H=(t,s,e,i,r=0)=>{let h=((t,s,e)=>Array.from({length:e},((e,i)=>t.slice(i*s,(i+1)*s))))(((t,s,e)=>{let i=[];return[...t].forEach((t=>{let s=t.codePointAt(0);for(let t=0;t<18;t++)i.push(1&s),s>>=1})),i.slice(0,e)})(t,0,e*i),e,i);var n=d.createElement("canvas"),o=u(n);const a=16,c=e*a,p=i*a;n.width=c,n.height=p,o.clearRect(0,0,c,p);const l=(t,s)=>{[{r:!h[s][t-1],m:[0,0],l:[0,1]},{r:!h[s][t+1],m:[1,0],l:[1,1]},{r:!h[s-1]||!h[s-1][t],m:[0,0],l:[1,0]},{r:!h[s+1]||!h[s+1][t],m:[0,1],l:[1,1]}].forEach((e=>{e.r&&(o.beginPath(),o.lineWidth=5,o.strokeStyle="#ccc",o.moveTo((t+e.m[0])*a,(s+e.m[1])*a),o.lineTo((t+e.l[0])*a,(s+e.l[1])*a),o.stroke())}))};for(var w=0;w<i;w++)for(var y=0;y<e;y++)h[w][y]&&(o.fillStyle="#"+s,o.fillRect(y*a,w*a,a,a),r&&l(y,w));return new Promise((t=>{let s=g();s.src=m(n),s.onload=()=>t(s)}))},U=async(t,s,e=0)=>Object.fromEntries(await z(" %!?0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("").map(((i,r)=>H(t[r],s[r],5,7,e).then((t=>[i,t])))))),D=(t,s)=>{var e=d.createElement("canvas"),i=u(e),r=t.width,h=t.height,n=s*Math.PI/180;return e.width=r,e.height=h,i.translate(r/2,h/2),i.rotate(n),i.drawImage(t,-r/2,-h/2),new Promise((t=>{let s=g();s.src=m(e),s.onload=()=>t(s)}))},z=async t=>await Promise.all(t);class L{constructor(t=0,s=0,e=0,i=0){this.x=t,this.y=s,this.h=i,this.w=e}set(t){return this.x=t.x,this.y=t.y,this}setwh(t,s){return this.w=s,this.h=s,this.set(t)}add(t){return this.x+=t.x,this.y+=t.y,this}equal(t){return this.x==t.x&&this.y==t.y}inside(t){return this.x<t.x&&this.y<t.y&&this.x>=0&&this.y>=0}zero(){this.x=this.y=0}substract(t){return this.x-=t.x,this.y-=t.y,this}dotwh(){return this.x*=this.w,this.y*=this.h,this}dot(t){return this.x*=t,this.y*=t,this}clone(){return new L(this.x,this.y,this.w,this.h)}}class N{constructor(t=1,s=1,e=1,i=0){this.startTime=t,this.endTime=s,this.step=e,this.loop=i}set(t,s,e){this.startTime=t,this.endTime=s,this.step=e}add(){this.startTime+=this.step}sub(){this.startTime-=this.step}reset(){this.startTime=0}start(){return this.startTime<this.endTime?(this.add(),0):(this.loop&&this.reset(),1)}get progress(){return e(this.startTime/this.endTime,1)}}class Y{constructor(t){this.pill=[],this.connections=[],this.mainHue=i(360);for(let s=0;s<t;s++)this.pill.push({x:i(j.mw),y:i(j.mh),size:i(3)+2,speedX:i(1)-.5,speedY:i(1)-.5,hue:this.mainHue+i(60)-30})}update(t){this.pill.forEach((t=>{t.x+=t.speedX,t.y+=t.speedY,t.x<0&&(t.x=window.innerWidth),t.x>window.innerWidth&&(t.x=0),t.y<0&&(t.y=window.innerHeight),t.y>window.innerHeight&&(t.y=0),t.hue=this.mainHue+i(60)-30})),this.connects(t),this.draw()}draw(){y.save(),this.pill.forEach(((t,s)=>{y.beginPath(),y.arc(t.x,t.y,t.size,0,2*Math.PI),y.fillStyle="#bbb",y.fill()})),this.connections.forEach((t=>{const s=y.createLinearGradient(t.x1,t.y1,t.x2,t.y2);if(s.addColorStop(0,`hsla(${t.hue}, 70%, 60%, ${.5*t.alpha})`),s.addColorStop(.3,`hsla(${t.hue}, 100%, 80%, ${t.alpha})`),s.addColorStop(1,`hsla(${t.hue}, 70%, 60%, ${.5*t.alpha})`),y.beginPath(),y.moveTo(t.x1,t.y1),y.lineTo(t.x2,t.y2),y.strokeStyle=s,y.lineWidth=2*t.alpha,y.stroke(),i(1)<.05){y.beginPath(),y.moveTo(t.x1,t.y1);const s=(t.x1+t.x2)/2+i(20)*i(.5),e=(t.y1+t.y2)/2+i(20)*i(.5);y.quadraticCurveTo(s,e,t.x2,t.y2),y.strokeStyle=`hsla(${t.hue}, 100%, 80%, ${t.alpha})`,y.lineWidth=3*t.alpha,y.stroke()}})),y.restore()}connects(t){this.connections=[];let s=this.pill;for(let t=0;t<s.length;t++)for(let e=t+1;e<s.length;e++){const i=h(s[t],s[e]);i<100&&this.connections.push({x1:s[t].x,y1:s[t].y,x2:s[e].x,y2:s[e].y,alpha:1-i/100,hue:(s[t].hue+s[e].hue)/2})}}}class W{constructor(t,i=0,r=0){this.moveY=i,this.waveY=r,t=t.split("\n");let h=e(j.grid,50),n=0,o=j.ch-t.length*h/2;this.char=t.flatMap(((t,e)=>(n=s(n,t.length),t.split("").map(((t,s)=>({pos:new L(0,o+h*e*1.3,h,h),vpos:new L(e,s),c:t,size:h})))))),this.x=j.cw-h*n/2,this.pos=new L(this.x,o-h*s(this.waveY,2)/2,h*n,(h+15)*(t.length+s(this.waveY,1)))}update(t){b(),v(C),S(this.pos.clone().add({x:5,y:5}),1,0,15),v(R),S(this.pos,1,1,15),this.char.forEach(((t,s)=>{t.pos.y=t.pos.y+Math.sin(.01*Date.now()+s*this.moveY)*this.waveY,t.pos.x=this.x+t.size*t.vpos.y,f(P.A2ZTile[t.c],t.pos.clone().dot(1.01)),f(P.ATB[t.c],t.pos)})),M()}}class q extends W{constructor(t){super(t),this.timer=new N(0,100),this.dtimer=new N(0,2,.01),this.reverse=1,this.trigger=0;let s=e(j.grid,50);this.x=j.cw-s*t.length/2,t=t.split("\n"),this.char=t.flatMap(((t,e)=>t.split("").map(((t,r)=>({pos:new L(i(j.mw),i(j.mh)),epos:new L(this.x+s*r,j.ch+s*e),spos:new L(i(j.mw),i(j.mh)),c:t,size:s,opacity:1}))))),this.rains=[];for(let t=0;t<50;t++)this.rains.push({x:i(j.mw),y:i(j.mh),length:i(20)+10,speed:i(5)+2,opacity:i(.5)+.2});this.rainDrops=[]}update(t){b(),this.rains.forEach((t=>{t.y+=t.speed,t.y>canvas.height&&(t.y=-t.length,t.x=Math.random()*canvas.width),y.strokeStyle=`rgba(255, 255, 255, ${t.opacity})`,y.lineWidth=2,y.beginPath(),y.moveTo(t.x,t.y),y.lineTo(t.x,t.y+t.length),y.stroke()}));let i=j.grid+15;this.reverse?(this.dtimer.add(),this.dtimer.progress>=.7&&(this.reverse=0)):(this.dtimer.sub(),this.dtimer.progress<0&&(this.reverse=1)),x(s(this.dtimer.progress,0)),((t,s,e,i,r,h="888")=>{b(),(t=>{y.strokeStyle="#"+t})(h),S({x:t,y:s,w:e,h:i},0,1),v(h),S({x:t+e+10,y:s+i/4,w:e/8,h:i/2},1),M()})(this.x,j.ch-i,3*i,i-15),v("e61c5d"),y.fillRect(0,0,j.mw,j.mh),M(),b(),v("880"),S({x:this.x,y:j.ch-i,w:i/4,h:i-15}),this.char.forEach(((t,i)=>{t.pos.setwh(t.pos,e(j.grid,50)),this.trigger?(t.pos.add(t.spos.clone().substract(t.pos).dot(.02)),t.opacity=s(t.opacity-=.01,0)):(t.pos.add(t.epos.clone().substract(t.pos).dot(.02)),t.opacity=Math.min(t.opacity,1)),x(t.opacity),f(P.A2ZTile[t.c],t.pos.clone().dot(1.13)),f(P.ATB[t.c],t.pos)})),M(),this.trigger&&this.timer.start()&&(j.gm.find((t=>1==t))?j.RME([0,1,0]):(j.level=0,j.RME([0,0,0])))}}let B=null,$=[],G=!1,X=0;const J=["b","b","t","b","t","t"],V=["sawtooth","square","triangle","sine"],Z=[0];for(let t=0;t<50;t++)n(Z,130.81*Math.pow(2,t/12));const F=[[0,13,15,17,20,22],[0,17,19,21,24,26],[0,20,22,24,27,29],[0,24,26,28,31,33],[0,27,29,31,34,36]],K={t:[[1,.5,.5,[[0,1,3,4,5,7,8,10,12]],[1,0,0,1,0,2,0,0,2,3,4,5,0,0,5,4,3,0,0,2,2,0,0,0,1,1,0],.1,.01],[3,1,1,F,[1,0,0,0,0,3,0,0,0,0,2,0,0,3,0,1,0,0],.1,.01]],b:[[1,.5,.5,[[0,1,3,4,5,7,8,10,12]],[0,0,6,0,4,0,5,2,6,6,0,0,4,0,0,3,0,0,6,0,4,0,5,2,2,0,4,0,6,4,0,3,2,6,0,7,6,0,3,4],.1,.01],[3,1,1,F,[1,0,0,1,0,3,0,0,3,0,2,0,0,3,0,1,0,0],.1,.01]]},Q=t=>{if(G)return;$.forEach((t=>t.forEach((t=>t.stop())))),$=[],G=!0,B||(B=new(window.AudioContext||window.webkitAudioContext)),t.forEach(((t,s)=>{const e=V[t[0]],i=t[4],r=t[2],h=t[1],n=t[5],o=[];let a=B.currentTime;i.forEach((s=>{t[3].forEach((i=>{const c=B.createOscillator(),p=B.createGain();c.connect(p),p.connect(B.destination),c.type=e,c.frequency.value=Z[i[s]],p.gain.setValueAtTime(0,a),p.gain.linearRampToValueAtTime(1*n,a+t[6]*h),c.start(a),p.gain.exponentialRampToValueAtTime(.01*n,a+r),c.stop(a+r),o.push(c)})),a+=h})),$.push(o)}));const s=$[$.length-1];s[s.length-1].onended=t=>{X++,X>=J.length&&(X=0),G=!1,Q(K[J[X]])}};let _=null;const tt=44600,st=(t,s,e,i,h,n,o,a)=>{const c=r(tt*o),p=new Float32Array(c);for(let r=0;r<c;r++){const l=r/tt,d=t+r/c*(s-t);let u;u=l<e?l/e:l<e+i?1-(l-e)/i*(1-h):l<e+i+o-n?h:h*(1-(l-e-i-o+n)/n);const g=u*a*Math.sin(2*Math.PI*d*l);p[r]=g}return p},et=st(Z[4],Z[1],.1,1,0,.5,.8,.5),it=st(Z[5],Z[7],.1,1,.4,1,.5,.5),rt=t=>{(t=>{_||(_=new(window.AudioContext||window.webkitAudioContext));let s=_.createBuffer(1,t.length,tt);s.copyToChannel(t,0);let e=_.createBufferSource();e.buffer=s,e.connect(_.destination),e.start(),e.onended=t=>{e.stop(),e.disconnect(),e.buffer=null,e=null,s=null}})(2==t?it:et)};class ht{constructor(t,e=!1,i=3e3){this.foreground=t.pos,this.backgroundColor="#000",this.duration=i,this.timer=new N(0,i,32),this.maxRadius=s(w.width,w.height),this.minRadius=.5,this.isRunning=!0,this.fadeIn=e}update(){if(!this.isRunning)return;const t=this.timer.progress,s=(i=t)*(2-i);var i;let r;r=this.fadeIn?e(this.minRadius+s*(this.maxRadius-this.minRadius),this.maxRadius):this.maxRadius-s*(this.maxRadius-this.minRadius),y.save(),y.globalCompositeOperation="destination-in",y.beginPath(),y.arc(this.foreground.x+this.foreground.w/2,this.foreground.y+this.foreground.h/2,r,0,2*Math.PI),y.fill(),y.restore(),this.timer.add(),t>=1&&(this.isRunning=!1)}}class nt{constructor(t,s,e,i,r,h=0){this.npos=new L(t,s,e,i),this.pos=this.npos.clone(),this.spos=this.pos.clone(),this.prevpos=this.pos.clone(),this.dtimer=new N(0,1,.05,1),this.pd=8,this.cd=7,this.kind=r,this.isDragging=h,this.timer=new N(0,1,.1),this.mapLength=j.maxLgth,this.color=["#000","#0f0","#f00","#00f","#0ff","#f0f","#fff","#f5f"][r]}update(t){this.draw()}draw(){}isMouseOver(t,s){return t>this.pos.x&&t<this.pos.x+this.pos.w&&s>this.pos.y&&s<this.pos.y+this.pos.h}resize(){this.spos=this.pos.clone(),this.prevpos=this.pos.clone()}}class ot extends nt{constructor(t,s,e,i,r,h=-1){super(t,s,e,i,r,h>=0?0:1),this.sh=0,this.ds=0,this.canDrag=0,this.clickAction=h,this.drawImg=-1==h?P.tiles:P.clickTiles}shift(t){if(this.ds)return;const{x:s,y:e}=j.CurPos;this.prevpos.x=s+this.pos.w+this.pos.w*t,this.pos.x=s+this.pos.w+this.pos.w*t}draw(){b(),2==this.clickAction&&x(j.sound),f(this.drawImg[this.kind],this.pos),this.sh&&(x(.5),f(this.drawImg[this.kind],this.spos)),f(this.drawImg[this.kind],this.prevpos),M()}stopDragging(){this.pos=this.prevpos.clone(),this.spos=this.prevpos.clone(),this.sh&&this.npos.inside(this.mapLength)?(j.currentMap[this.npos.y][this.npos.x]=this.kind,j.dragObject=j.dragObject.filter((t=>t!=this))):(this.ds=0,this.pos=this.prevpos.clone(),this.spos=this.pos.clone())}drag(t,s){this.ds=1,this.isDragging&&(this.pos.x=t-this.pos.w/2,this.pos.y=s-this.pos.h/2,this.inGridMap())}inGridMap(){const t=j.CurPos,s=this.pos.clone().substract(t);s.x=r(s.x/s.w),s.y=r(s.y/s.h),s.inside(this.mapLength)?(0==j.currentMap[s.y][s.x]&&(this.spos.set(s.clone().dotwh().add(t)),this.npos.set(s)),this.sh=!0):this.sh=!1}}class at extends nt{constructor(t,s,e,i,r,h){super(t,s,e,i,r),this.show=1,this.player=h}update(t){this.player=t,this.pos=t.pos.clone().add(this.npos.clone().dot(t.pos.w)),this.draw()}draw(){b(),y.fillStyle="#888";{this.dtimer.start(),y.globalAlpha=.3;let t=4*(this.dtimer.progress>.5?0:1);f(P.clickTiles[this.kind+7+t],this.pos)}M()}}class ct extends nt{constructor(t,s,e,i,r){super(t,s,e,i,1),this.vpos=new L,this.ppos=new L,this.tap=r,this.kind=1,this.direction=1,this.mapping=[-3,3,2,-2].reduce(((t,s,e)=>(t[s]=e,t)),{}),this.mapping1=[1,-1,-2,2].reduce(((t,s,e)=>(t[s]=e,t)),{}),this.moving=0,this.arrowHint=[];const h=[0,0];this.arrows=[[1,0],[-1,0],[0,-1],[0,1]];const n=[...Array(5).fill(h),...this.arrows,...Array(6).fill(h)];this.moveset=n.map((([t,s])=>({x:t,y:s}))),this.arrows.forEach(((t,s)=>{this.arrowHint.push(new at(t[0],t[1],e,i,s+5,this))}))}update(t){let s=17;if(this.vpos.equal(this.moveset[0])&&this.direction>=9){if(this.tap<=0&&!this.moving)return j.trans.e||(j.trans.et=new ht(this,j.fadeOut),rt(3)),void(this.arrowHint=[]);0==this.tap&&(this.arrowHint=[]),this.arrowHint.forEach((t=>{const s=this.npos.clone().add(t.npos);s.inside(this.mapLength)?j.currentMap[s.y][s.x]<=8&&(t.show=1,t.update(this)):t.show=0}))}this.direction>=4&&this.direction<=8&&(this.vpos.set(this.moveset[this.direction]),this.direction>=5&&(this.cd=this.direction));const e=this.npos.clone();if(e.add(this.vpos),e.inside(this.mapLength)){if(!this.moving){const t=j.currentMap[e.y][e.x];t<=8?(this.ppos=this.npos.clone(),this.npos=e.clone(),this.moving=1):(11!=t&&16!=t&&18!=t||this.vpos.equal(this.moveset[0])||(this.tap=0,rt(3)),10==t&&(j.currentMap[e.y][e.x]=0),this.vpos.zero(),this.direction=9)}}else this.direction=9,this.vpos.zero();if(this.moving){const t=j.CurPos;this.prevpos.set(this.npos.clone().dot(this.pos.w)).add(t);const e=this.timer.progress;if(this.pos.add(this.prevpos.clone().substract(this.pos).dot(e)),this.pd==this.cd)s=this.cd<=6?18:16;else{let t=this.mapping[this.pd-this.cd];6!=this.pd&&6!=this.cd||(t=this.mapping1[this.pd-this.cd]),s=12+t}j.currentMap[this.ppos.y][this.ppos.x]=s||17,this.timer.start()&&(this.direction=j.currentMap[this.npos.y][this.npos.x],this.pd=this.cd,j.currentMap[this.npos.y][this.npos.x]=s||17,4==this.direction&&(j.currentMap=j.currentMap.map(((t,s)=>t.map(((t,e)=>{const i=l[j.level].map[s][e];return 4==i?0:i}))))),3==this.direction&&(j.currentMap=j.currentMap.map((t=>t.map((t=>9==t?0:t))))),2==this.direction&&(this.vpos.zero(),rt(2),j.gm[j.level]||(j.emerge+=r(87/l.length),c("bt",+j.emerge)),j.gm[j.level]=1,c("gm",JSON.stringify(j.gm)),j.level++,j.trans.et=new ht(this,j.fadeOut)),this.moving=0,this.timer.reset(),this.pos.set(this.prevpos))}}draw(){this.dtimer.start(),y.save();let t=4*(this.dtimer.progress>.5?0:1);v(R),x(.9),S(this.pos,10,0,0),f(P.player[this.cd-5+t],this.pos),y.restore()}resize(){const t=j.CurPos,s=j.grid;this.pos.setwh(this.npos.clone().dot(s).add(t),s)}}class pt extends nt{constructor(t,s,e,i,r){super(t,s,e,i,r),this.checked=!1,this.isHovered=!1}draw(){b();let t=R;j.gm[this.kind]&&(t="549688"),v(this.isHovered?"549688":C),S(this.pos.clone().add({x:5,y:5}),1,1),v(this.isHovered?"388E3C":t),S(this.pos,1,1,10);const e=this.pos.clone();e.w=this.pos.w/2,e.h=this.pos.h/2,e.x=this.pos.x+this.pos.w/4,e.y=this.pos.y+this.pos.h/4,f(P.tiles[s(1,this.kind%P.tiles.length)],e),M()}updateHover(t,s){this.isHovered=this.isMouseOver(t,s)}}class lt{constructor(t){this.menuItems=[];const s=j.menuItemSize;t.forEach(((t,e)=>{const i=r(e/4),h=e%4,n=j.cw-2.2*s.x+h*s.x*1.2,o=j.ch-3.2*s.y+i*s.y*1.2;this.menuItems.push(new pt(n,o,s.x,s.y,e))}))}update(t){this.menuItems.forEach((t=>t.draw()))}handleClick(t,s){this.menuItems.forEach((e=>{e.isMouseOver(t,s)&&(j.RME([0,0,0]),j.level=e.kind,j.trans.et=new ht(j.player,j.fadeOut),j.trans.et.isRunning=0)}))}handleMouseMove(t,s){this.menuItems.forEach((e=>{e.updateHover(t,s)}))}}const dt=()=>{j.mw=w.width=window.innerWidth,j.mh=w.height=window.innerHeight,j.background=new Y(100),j.UI.view[0]=new q("13% LOW"),j.UI.view[1]=new lt(l),j.UI.view[2]=new W(" THANK YOU!!\n FOR PLAYING \n GOOD DAY !!\n WANT MORE??\n LETS DEV !!",5,1,.8);const t=j.CurPos,s=j.grid;j.clickObject=[];for(let t=0;t<=2;t++)j.clickObject.push(new ot(10+1.2*s*t,20,s,s,2!=t?t+4*t:20,t));[{x:s/10,y:-s,w:.8*s,h:.8*s,id:9,index:3},{x:s*(j.dragCount+1)+s/10,y:-s,w:.8*s,h:.8*s,id:8,index:4}].forEach((s=>{j.clickObject.push(new ot(t.x+s.x,t.y+s.y,s.w,s.h,s.id,s.index))})),j.dragObject.forEach((e=>{e.pos.setwh(t,s).substract({x:0,y:1.1*s}),e.resize()})),j.gameObject.forEach((t=>{t.resize()}))},ut=()=>{if(j.level>=l.length)return void j.RME([0,0,1]);j.gameObject=[],j.dragObject=[],j.clickObject=[];let{x:t,y:s}=j.CurPos;const e=j.grid,i=l[j.level];j.currentMap=JSON.parse(JSON.stringify(i.map)),j.dragCount=j.mwl-4,j.dragMax=i.dg,j.dragNumber=0,j.dragMax.forEach((i=>{const r=new ot(t,s-1.1*e,e,e,i);j.dragObject.push(r)}));let r=i.map.flatMap(((t,s)=>t.map(((t,e)=>1===t?{i:s,j:e}:null)))).find((t=>t));j.player=new ct(r.j,r.i,j.grid,j.grid,i.tap),j.tap=i.tap,j.gameObject.push(j.player),j.trans.st=new ht(j.player,j.fadeIn),dt()},gt=()=>{y.clearRect(0,0,j.mw,j.mh),j.UI.controler[0]||j.background.update(1),j.gameStart?j.UI.view.forEach(((t,s)=>{j.UI.controler[s]&&t.update(1)})):(((t,s,e,i)=>{let{x:r,y:h}=j.CurPos;b(),v(C),S({x:r+10,y:h+10,w:e*s+10,h:i*s+10},1,0,20),v(R),S({x:r,y:h,w:e*s+10,h:i*s+10},1,1,20);for(let e=0;e<t.length;e++)for(let i=0;i<t[e].length;i++)t[e][i]&&y.drawImage(P.tiles[t[e][i]],i*s+r,e*s+h,s,s);M(),j.gameObject.forEach((t=>{t.update(1),t.draw()}));const n=j.dragCount,o=j.dragObject.length>j.dragCount?j.dragNumber:0,a=o+n;j.dragObject.slice(o,a).forEach(((t,s)=>{t.canDrag=1,t.shift(s),t.draw()})),j.clickObject.forEach((t=>{t.draw(1)})),f(P.ATB[j.tap%10],{x:r+s*(j.dragCount+3)+s/10,y:h-s,w:.8*s,h:.8*s}),f(P.ATB[j.tap/10|0],{x:r+s*(j.dragCount+2)+s/10,y:h-s,w:.8*s,h:.8*s})})(j.currentMap,j.grid,j.mwl,j.mhl),j.trans.s&&(j.trans.st.update(),j.trans.st.isRunning||(j.trans.s=0)),j.trans.e&&(j.trans.et.update(),j.trans.et.isRunning||ut())),requestAnimationFrame(gt)};function mt(t){if(t.clientX&&t.clientY)return{x:t.offsetX,y:t.offsetY};if(t.touches&&t.touches[0]){const s=w.getBoundingClientRect();return{x:t.touches[0].clientX-s.left,y:t.touches[0].clientY-s.top}}return{x:0,y:0}}function wt(t){t.preventDefault();const{x:e,y:i}=mt(t);Q(K[J[X]]),j.UI.controler[0]&&j.UI.view[0]&&(j.UI.view[0].trigger=1),j.UI.controler[1]&&j.UI.view[1]&&j.UI.view[1].handleClick(e,i),j.clickObject.forEach((t=>{t.isMouseOver(e,i)&&(1==t.clickAction&&ut(),0==t.clickAction&&j.RME([1,0,0]),2==t.clickAction&&(console.log(t.clickAction,j.sound),j.sound&&(G&&(B.suspend(),G=!1),j.sound=0)),3==t.clickAction&&(j.dragNumber=Math.max(0,j.dragNumber-1)),4==t.clickAction&&(j.dragNumber=Math.min(Math.max(j.dragObject.length-j.dragCount,0),j.dragNumber+1)))})),j.dragObject.forEach((t=>{t.isDragging&&t.isMouseOver(e,i)&&t.canDrag&&(j.dragRect=t)})),j.player&&j.player.arrowHint.forEach((t=>{t.isMouseOver(e,i)&&t.show&&(j.player.direction=t.kind,j.player.cd=t.kind,j.player.tap-=1,j.tap=s(j.player.tap,0))}))}function yt(t){t.preventDefault();const{x:s,y:e}=mt(t);j.dragRect&&j.dragRect.drag(s,e),j.UI.controler[1]&&j.UI.view[1]&&j.UI.view[1].handleMouseMove(s,e)}function ft(){j.dragRect&&(j.dragRect.stopDragging(),j.dragRect=null)}(async()=>{await(async()=>{j.mw=w.width=window.innerWidth,j.mh=w.height=window.innerHeight;const t=p("bt"),s=p("gm");j.emerge=t?+t:13,j.gm=s?JSON.parse(s):o(l.length,0),P.A2ZTile=await U(P.font.pattern,P.font.color1),P.ATB=await U(P.font.pattern,P.font.color2,1);const e=await z(P.item.pattern.map(((t,s)=>H(t,P.item.color[s],11,11)))),i=[0,180,270,90],r=await z(i.map((t=>D(e[4],t))));return new Promise((async t=>{const s=e.map((async(t,s)=>{const e=P.item.count[s];if(e==T||4==s)4==s?P.tiles=P.tiles.concat(r):P.tiles.push(t);else{const s=await z(i.map((s=>D(t,s))));e==k&&(P.clickTiles=P.clickTiles.concat(s)),e==I&&(P.tiles=P.tiles.concat(s)),e==E&&(P.player=P.player.concat(s))}}));await z(s),t()}))})(),ut(),gt()})(),onresize=()=>dt(),w.onmousedown=t=>wt(t),w.onmousemove=t=>yt(t),w.onmouseup=t=>ft(),w.onmouseleave=t=>ft(),w.ontouchstart=t=>wt(t),w.ontouchmove=t=>yt(t),w.ontouchend=t=>ft(),w.ontouchcancel=t=>ft()})();