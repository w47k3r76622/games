var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,e,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");b!=Array.prototype&&b!=Object.prototype&&(b[e]=c.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global?global:b};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(b,e,c,k){if(e){c=$jscomp.global;b=b.split(".");for(k=0;k<b.length-1;k++){var h=b[k];h in c||(c[h]={});c=c[h]}b=b[b.length-1];k=c[b];e=e(k);e!=k&&null!=e&&$jscomp.defineProperty(c,b,{configurable:!0,writable:!0,value:e})}};$jscomp.polyfill("Array.prototype.fill",function(b){return b?b:function(b,c,k){var e=this.length||0;0>c&&(c=Math.max(0,e+c));if(null==k||k>e)k=e;k=Number(k);0>k&&(k=Math.max(0,e+k));for(c=Number(c||0);c<k;c++)this[c]=b;return this}},"es6-impl","es3");
$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(b){var e=0;return $jscomp.iteratorPrototype(function(){return e<b.length?{done:!1,value:b[e++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(b,e){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var c=0,k={next:function(){if(c<b.length){var h=c++;return{value:e(h,b[h]),done:!1}}k.next=function(){return{done:!0,value:void 0}};return k.next()}};k[Symbol.iterator]=function(){return k};return k};
$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6-impl","es3");var GA=GA||{};GA.VERSION="0.0.1";GA.plugins=void 0;GA.custom=void 0;
GA.create=function(b,e,c,k,h){function n(){requestAnimationFrame(n,g.canvas);if(void 0===g._fps)p();else{var a=Date.now(),d=a-g._startTime;1E3<d&&(d=g._frameDuration);g._startTime=a;for(g._lag+=d;g._lag>=g._frameDuration;)f(),p(),g._lag-=g._frameDuration;g.render(g.canvas,g._lag/g._frameDuration)}}function f(){function a(d){d._previousX=d.x;d._previousY=d.y;d.children&&0<d.children.length&&d.children.forEach(function(d){a(d)})}g.stage.children.forEach(function(d){a(d)})}function p(){if(0<g.buttons.length){g.canvas.style.cursor=
"auto";for(var a=g.buttons.length-1;0<=a;a--){var d=g.buttons[a];d.update(g.pointer,g.canvas);"over"!==d.state&&"down"!==d.state||d.stage||(g.canvas.style.cursor="pointer")}}g.dragAndDrop&&g.pointer.updateDragAndDrop();g.state&&!g.paused&&g.state();if(0!==g.updateFunctions.length)for(a=0;a<g.updateFunctions.length;a++)(0,g.updateFunctions[a])()}function l(a){a.x=0;a.y=0;a.vx=0;a.vy=0;a.width=0;a.height=0;a.scaleX=1;a.scaleY=1;a.pivotX=.5;a.pivotY=.5;a.rotation=0;a.visible=!0;a.parent=void 0;a.stage=
!1;a.shadow=!1;a.shadowColor="rgba(100, 100, 100, 0.5)";a.shadowOffsetX=3;a.shadowOffsetY=3;a.shadowBlur=3;a.blendMode=void 0;a._alpha=1;a._draggable=void 0;a._layer=0;a._circular=!1;a._interactive=!1;a._previousX=void 0;a._previousY=void 0;a.children=[];a.addChild=function(d){d.parent&&d.parent.removeChild(d);d.parent=a;a.children.push(d)};a.removeChild=function(d){if(d.parent===a)a.children.splice(a.children.indexOf(d),1);else throw Error(d+"is not a child of "+a);};a.swapChildren=function(d,b){var e=
a.children.indexOf(d),c=a.children.indexOf(b);if(-1!==e&&-1!==c)d.childIndex=c,b.childIndex=e,a.children[e]=b,a.children[c]=d;else throw Error(child+" Both objects must be a child of the caller "+a);};a.add=function(d){var b=Array.prototype.slice.call(arguments);1<b.length?b.forEach(function(d){a.addChild(d)}):a.addChild(b[0])};a.remove=function(d){var b=Array.prototype.slice.call(arguments);1<b.length?b.forEach(function(d){a.removeChild(d)}):a.removeChild(b[0])};a.setPosition=function(d,b){a.x=d;
a.y=b};a.putCenter=function(d,b,e){d.x=a.x+a.halfWidth-d.halfWidth+(b||0);d.y=a.y+a.halfHeight-d.halfHeight+(e||0);a.compensateForParentPosition(a,d)};a.putTop=function(d,b,e){d.x=a.x+a.halfWidth-d.halfWidth+(b||0);d.y=a.x-d.height+(e||0);a.compensateForParentPosition(a,d)};a.putRight=function(d,b,e){d.x=a.x+a.width+(b||0);d.y=a.y+a.halfHeight-d.halfHeight+(e||0);a.compensateForParentPosition(a,d)};a.putBottom=function(d,b,e){d.x=a.x+a.halfWidth-d.halfWidth+(b||0);d.y=a.y+a.height+(e||0);a.compensateForParentPosition(a,
d)};a.putLeft=function(d,b,e){d.x=a.x-d.width+(b||0);d.y=a.y+a.halfHeight-d.halfHeight+(e||0);a.compensateForParentPosition(a,d)};a.compensateForParentPosition=function(a,b){if(0!==b.parent.gx||0!==b.parent.gy)b.x-=a.gx,b.y-=a.gy};Object.defineProperties(a,{gx:{get:function(){return this.parent?this.x+this.parent.gx:this.x},enumerable:!0,configurable:!0},gy:{get:function(){return this.parent?this.y+this.parent.gy:this.y},enumerable:!0,configurable:!0},position:{get:function(){return{x:a.x,y:a.y}},
enumerable:!0,configurable:!0},alpha:{get:function(){return a.parent._alpha*a._alpha},set:function(d){a._alpha=d},enumerable:!0,configurable:!0},halfWidth:{get:function(){return a.width/2},enumerable:!0,configurable:!0},halfHeight:{get:function(){return a.height/2},enumerable:!0,configurable:!0},centerX:{get:function(){return a.x+a.halfWidth},enumerable:!0,configurable:!0},centerY:{get:function(){return a.y+a.halfHeight},enumerable:!0,configurable:!0},layer:{get:function(){return a._layer},set:function(d){a._layer=
d;a.parent.children.sort(x)},enumerable:!0,configurable:!0},circular:{get:function(){return a._circular},set:function(d){!0===d&&!1===a._circular&&(t(a),a._circular=!0);!1===d&&!0===a._circular&&(delete a.diameter,delete a.radius,a._circular=!1)},enumerable:!0,configurable:!0},draggable:{get:function(){return a._draggable},set:function(d){!0===d&&(g.draggableSprites.push(a),a._draggable=!0,!1===g.dragAndDrop&&(g.dragAndDrop=!0));!1===d&&g.draggableSprites.splice(g.draggableSprites.indexOf(a),1)},
enumerable:!0,configurable:!0},interactive:{get:function(){return a._interactive},set:function(d){!0===d&&(u(a),a._interactive=!0);!1===d&&(g.buttons.splice(g.buttons.indexOf(a),1),a._interactive=!1)},enumerable:!0,configurable:!0},localBounds:{get:function(){return{x:0,y:0,width:a.width,height:a.height}},enumerable:!0,configurable:!0},globalBounds:{get:function(){return rectangle={x:a.gx,y:a.gy,width:a.gx+a.width,height:a.gy+a.height}},enumerable:!0,configurable:!0},empty:{get:function(){return 0===
a.children.length?!0:!1},enumerable:!0,configurable:!0}})}function t(a){Object.defineProperties(a,{diameter:{get:function(){return a.width},set:function(d){a.width=d;a.height=d},enumerable:!0,configurable:!0},radius:{get:function(){return a.width/2},set:function(d){a.width=2*d;a.height=2*d},enumerable:!0,configurable:!0}})}function u(a){a.press=a.press||void 0;a.release=a.release||void 0;a.over=a.over||void 0;a.out=a.out||void 0;a.tap=a.tap||void 0;a.state="up";a.action="";a.pressed=!1;a.enabled=
!0;a.hoverOver=!1;g.buttons.push(a);a.update=function(d,b){if(a.enabled){var e=g.pointer.hitTestSprite(a);d.isUp&&(a.state="up","button"===a.subtype&&a.show(0));e&&(a.state="over",a.frames&&3===a.frames.length&&"button"===a.subtype&&a.show(1),d.isDown&&(a.state="down","button"===a.subtype&&(3===a.frames.length?a.show(2):a.show(1))));"down"!==a.state||a.pressed||(a.press&&a.press(),a.pressed=!0,a.action="pressed");"over"===a.state&&(a.pressed&&(a.release&&a.release(),a.pressed=!1,a.action="released",
g.pointer.tapped&&a.tap&&a.tap()),a.hoverOver||(a.over&&a.over(),a.hoverOver=!0));"up"===a.state&&(a.pressed&&(a.release&&a.release(),a.pressed=!1,a.action="released"),a.hoverOver&&(a.out&&a.out(),a.hoverOver=!1))}}}function q(a){var d={};d.code=a;d.isDown=!1;d.isUp=!0;d.press=void 0;d.release=void 0;d.downHandler=function(a){a.keyCode===d.code&&(d.isUp&&d.press&&d.press(),d.isDown=!0,d.isUp=!1);a.preventDefault()};d.upHandler=function(a){a.keyCode===d.code&&(d.isDown&&d.release&&d.release(),d.isDown=
!1,d.isUp=!0);a.preventDefault()};window.addEventListener("keydown",d.downHandler.bind(d),!1);window.addEventListener("keyup",d.upHandler.bind(d),!1);return d}function x(a,d){return a.layer<d.layer?-1:1}var g={};g.canvas=document.createElement("canvas");g.canvas.setAttribute("width",1*b);g.canvas.setAttribute("height",1*e);g.canvas.style.backgroundColor="black";document.body.appendChild(g.canvas);g.canvas.ctx=g.canvas.getContext("2d");g.stage=function(){var a={};l(a);a.stage=!0;a.width=g.canvas.width;
a.height=g.canvas.height;a.x=0;a.y=0;a.parent=void 0;return a}();g.pointer=function(){var a={_x:0,_y:0};Object.defineProperties(a,{x:{get:function(){return a._x/g.scale},enumerable:!0,configurable:!0},y:{get:function(){return a._y/g.scale},enumerable:!0,configurable:!0},centerX:{get:function(){return a.x},enumerable:!0,configurable:!0},centerY:{get:function(){return a.y},enumerable:!0,configurable:!0},position:{get:function(){return{x:a.x,y:a.y}},enumerable:!0,configurable:!0}});a.isDown=!1;a.isUp=
!0;a.tapped=!1;a.downTime=0;a.elapsedTime=0;a.press=void 0;a.release=void 0;a.tap=void 0;a.dragSprite=null;a.dragOffsetX=0;a.dragOffsetY=0;a.moveHandler=function(d){a._x=d.pageX-d.target.offsetLeft;a._y=d.pageY-d.target.offsetTop;d.preventDefault()};a.touchmoveHandler=function(d){a._x=d.targetTouches[0].pageX-g.canvas.offsetLeft;a._y=d.targetTouches[0].pageY-g.canvas.offsetTop;d.preventDefault()};a.downHandler=function(d){a._x=d.pageX-d.target.offsetLeft;a._y=d.pageY-d.target.offsetTop;a.isDown=!0;
a.isUp=!1;a.tapped=!1;a.downTime=Date.now();a.press&&a.press();d.preventDefault()};a.touchstartHandler=function(d){a._x=d.targetTouches[0].pageX-g.canvas.offsetLeft;a._y=d.targetTouches[0].pageY-g.canvas.offsetTop;a.isDown=!0;a.isUp=!1;a.tapped=!1;a.downTime=Date.now();a.press&&a.press();d.preventDefault()};a.upHandler=function(d){a.elapsedTime=Math.abs(a.downTime-Date.now());200>=a.elapsedTime&&(a.tapped=!0,a.tap&&a.tap());a.isUp=!0;a.isDown=!1;a.release&&a.release();d.preventDefault()};g.canvas.addEventListener("mousemove",
a.moveHandler.bind(a),!1);g.canvas.addEventListener("mousedown",a.downHandler.bind(a),!1);window.addEventListener("mouseup",a.upHandler.bind(a),!1);g.canvas.addEventListener("touchmove",a.touchmoveHandler.bind(a),!1);g.canvas.addEventListener("touchstart",a.touchstartHandler.bind(a),!1);window.addEventListener("touchend",a.upHandler.bind(a),!1);g.canvas.style.touchAction="none";a.hitTestSprite=function(d){if(d.circular){var b=a.x-(d.gx+d.halfWidth),e=a.y-(d.gy+d.halfHeight);d=Math.sqrt(b*b+e*e)<d.radius}else{var b=
d.gx+d.width,e=d.gy,c=d.gy+d.height;d=a.x>d.gx&&a.x<b&&a.y>e&&a.y<c}return d};a.updateDragAndDrop=function(){if(a.isDown)if(null===a.dragSprite)for(var d=g.draggableSprites.length-1;-1<d;d--){var b=g.draggableSprites[d];if(b.draggable&&a.hitTestSprite(b)){a.dragOffsetX=a.x-b.gx;a.dragOffsetY=a.y-b.gy;a.dragSprite=b;d=b.parent.children;d.splice(d.indexOf(b),1);d.push(b);g.draggableSprites.splice(g.draggableSprites.indexOf(b),1);g.draggableSprites.push(b);break}}else a.dragSprite.x=a.x-a.dragOffsetX,
a.dragSprite.y=a.y-a.dragOffsetY;a.isUp&&(a.dragSprite=null);g.draggableSprites.some(function(d){if(d.draggable&&a.hitTestSprite(d))return g.canvas.style.cursor="pointer",!0;g.canvas.style.cursor="auto";return!1})};return a}();g.key=function(){var a={};a.leftArrow=q(37);a.upArrow=q(38);a.rightArrow=q(39);a.downArrow=q(40);a.space=q(32);return a}();g.buttons=[];g.dragAndDrop=!1;g.draggableSprites=[];g.tweens=[];g.state=void 0;g.load=h||void 0;g.setup=c||void 0;if(void 0===g.setup)throw Error("Please supply the setup function in the constructor");
g.assetFilePaths=k||void 0;g.paused=!1;g._fps=60;g._startTime=Date.now();g._frameDuration=1E3/g._fps;g._lag=0;g.interpolate=!0;g.updateFunctions=[];g.scale=1;g.start=function(){g.assetFilePaths?(g.assets.whenLoaded=function(){g.state=void 0;g.setup()},g.assets.load(g.assetFilePaths),g.load&&(g.state=g.load)):g.setup();n()};g.pause=function(){g.paused=!0};g.resume=function(){g.paused=!1};g.hidePointer=function(){g.canvas.style.cursor="none"};g.showPointer=function(){g.canvas.style.cursor="auto"};Object.defineProperties(g,
{fps:{get:function(){return g._fps},set:function(a){g._fps=a;g._startTime=Date.now();g._frameDuration=1E3/g._fps},enumerable:!0,configurable:!0},backgroundColor:{set:function(a){g.canvas.style.backgroundColor=a},enumerable:!0,configurable:!0}});g.remove=function(a){var d=Array.prototype.slice.call(arguments);if(d[0]instanceof Array){if(d=d[0],0<d.length)for(var b=d.length-1;0<=b;b--){var e=d[b];e.parent.removeChild(e);d.splice(d.indexOf(e),1)}}else 1<d.length?d.forEach(function(a){a.parent.removeChild(a)}):
d[0].parent.removeChild(d[0])};g.group=function(a){var d={};l(d);d.addChild=function(a){a.parent&&a.parent.removeChild(a);a.parent=d;d.children.push(a);d.calculateSize()};d.removeChild=function(a){if(a.parent===d)d.children.splice(d.children.indexOf(a),1);else throw Error(a+"is not a child of "+d);d.calculateSize()};d.calculateSize=function(){0<d.children.length&&(d._newWidth=0,d._newHeight=0,d.children.forEach(function(a){a.x+a.width>d._newWidth&&(d._newWidth=a.x+a.width);a.y+a.height>d._newHeight&&
(d._newHeight=a.y+a.height)}),d.width=d._newWidth,d.height=d._newHeight)};g.stage.addChild(d);a&&Array.prototype.slice.call(arguments).forEach(function(a){d.addChild(a)});return d};g.rectangle=function(a,d,b,e,c,f,k){var m={};l(m);m.mask=!1;m.width=a||32;m.height=d||32;m.fillStyle=b||"red";m.strokeStyle=e||"none";m.lineWidth=c||0;m.x=f||0;m.y=k||0;g.stage.addChild(m);m.render=function(a){a.strokeStyle=m.strokeStyle;a.lineWidth=m.lineWidth;a.fillStyle=m.fillStyle;a.beginPath();a.rect(-m.width*m.pivotX,
-m.height*m.pivotY,m.width,m.height);!0===m.mask?a.clip():("none"!==m.strokeStyle&&a.stroke(),"none"!==m.fillStyle&&a.fill())};return m};g.circle=function(a,d,b,e,c,m){var f={};l(f);f.mask=!1;f.width=a||32;f.height=a||32;f.fillStyle=d||"red";f.strokeStyle=b||"none";f.lineWidth=e||"none";f.x=c||0;f.y=m||0;g.stage.addChild(f);t(f);f.render=function(a){a.strokeStyle=f.strokeStyle;a.lineWidth=f.lineWidth;a.fillStyle=f.fillStyle;a.beginPath();a.arc(f.radius+-f.diameter*f.pivotX,f.radius+-f.diameter*f.pivotY,
f.radius,0,2*Math.PI,!1);!0===f.mask?a.clip():("none"!==f.strokeStyle&&a.stroke(),"none"!==f.fillStyle&&a.fill())};return f};g.line=function(a,d,b,e,c,f){var m={};l(m);b||0===b||(b=0);e||0===e||(e=0);c||0===c||(c=32);f||0===f||(f=32);m.ax=b;m.ay=e;m.bx=c;m.by=f;m.strokeStyle=a||"red";m.lineWidth=d||1;m.lineJoin="round";g.stage.addChild(m);m.render=function(a){a.strokeStyle=m.strokeStyle;a.lineWidth=m.lineWidth;a.lineJoin=m.lineJoin;a.beginPath();a.moveTo(m.ax,m.ay);a.lineTo(m.bx,m.by);"none"!==m.strokeStyle&&
a.stroke();"none"!==m.fillStyle&&a.fill()};return m};g.text=function(a,d,b,e,c){var f={};l(f);f.content=a||"Hello!";f.font=d||"12px sans-serif";f.fillStyle=b||"red";f.textBaseline="top";Object.defineProperties(f,{width:{get:function(){return g.canvas.ctx.measureText(f.content).width},enumerable:!0,configurable:!0},height:{get:function(){return g.canvas.ctx.measureText("M").width},enumerable:!0,configurable:!0}});g.stage.addChild(f);f.x=e||0;f.y=c||0;f.render=function(a){a.strokeStyle=f.strokeStyle;
a.lineWidth=f.lineWidth;a.fillStyle=f.fillStyle;0===f.width&&(f.width=a.measureText(f.content).width);0===f.height&&(f.height=a.measureText("M").width);a.translate(-f.width*f.pivotX,-f.height*f.pivotY);a.font=f.font;a.textBaseline=f.textBaseline;a.fillText(f.content,0,0)};return f};g.frame=function(a,d,b,e,c){var f={};f.image=a;f.x=d;f.y=b;f.width=e;f.height=c;return f};g.frames=function(a,d,b,e){var c={};c.image=a;c.data=d;c.width=b;c.height=e;return c};g.filmstrip=function(a,d,b,e){for(var c=g.assets[a].source,
f=[],k=c.width/d,c=c.height/b*k,h=0;h<c;h++){var r,l;r=h%k*d;l=Math.floor(h/k)*b;e&&0<e&&(r+=e+e*h%k,l+=e+e*Math.floor(h/k));f.push([r,l])}return g.frames(a,f,d,b)};g.sprite=function(a){var d={};if(void 0===a)throw Error("Sprites require a source");l(d);d.frames=[];d.loop=!0;d._currentFrame=0;d.setTexture=function(a){if(a.image)if(a.image&&!a.data){if(!(g.assets[a.image].source instanceof Image))throw Error(a.image+" is not an image file");d.source=g.assets[a.image].source;d.sourceX=a.x;d.sourceY=
a.y;d.width=a.width;d.height=a.height;d.sourceWidth=a.width;d.sourceHeight=a.height}else a.image&&a.data&&(d.source=g.assets[a.image].source,d.frames=a.data,d.sourceX=d.frames[0][0],d.sourceY=d.frames[0][1],d.width=a.width,d.height=a.height,d.sourceWidth=a.width,d.sourceHeight=a.height);else a instanceof Array?(d.frames=a,d.source=g.assets[a[0]].source,d.sourceX=g.assets[a[0]].frame.x,d.sourceY=g.assets[a[0]].frame.y,d.width=g.assets[a[0]].frame.w,d.height=g.assets[a[0]].frame.h,d.sourceWidth=g.assets[a[0]].frame.w,
d.sourceHeight=g.assets[a[0]].frame.h):(d.tilesetFrame=g.assets[a],d.source=d.tilesetFrame.source,d.sourceX=d.tilesetFrame.frame.x,d.sourceY=d.tilesetFrame.frame.y,d.width=d.tilesetFrame.frame.w,d.height=d.tilesetFrame.frame.h,d.sourceWidth=d.tilesetFrame.frame.w,d.sourceHeight=d.tilesetFrame.frame.h)};d.setTexture(a);d.gotoAndStop=function(a){if(0<d.frames.length)d.frames[0]instanceof Array?(d.sourceX=d.frames[a][0],d.sourceY=d.frames[a][1]):g.assets[d.frames[a]].frame&&(d.source=g.assets[d.frames[a]].source,
d.sourceX=g.assets[d.frames[a]].frame.x,d.sourceY=g.assets[d.frames[a]].frame.y,d.sourceWidth=g.assets[d.frames[a]].frame.w,d.sourceHeight=g.assets[d.frames[a]].frame.h,d.width=g.assets[d.frames[a]].frame.w,d.height=g.assets[d.frames[a]].frame.h),d._currentFrame=a;else throw Error("Frame number "+a+"doesn't exist");};d.x=0;d.y=0;0<d.frames.length&&(g.addStatePlayer(d),Object.defineProperty(d,"currentFrame",{get:function(){return d._currentFrame},enumerable:!1,configurable:!1}));g.stage.addChild(d);
d.render=function(a){a.drawImage(d.source,d.sourceX,d.sourceY,d.sourceWidth,d.sourceHeight,-d.width*d.pivotX,-d.height*d.pivotY,d.width,d.height)};return d};g.button=function(a){a=g.sprite(a);a.subtype="button";u(a);return a};g.image=function(a){return g.assets[a]};g.json=function(a){return g.assets[a]};g.addStatePlayer=function(a){function d(d){e();g=d[0];k=d[1];f=k-g;0===g&&(f+=1,c+=1);1===f&&(f=2,c+=1);a.fps||(a.fps=12);d=1E3/a.fps;a.gotoAndStop(g);l||(h=setInterval(b.bind(this),d),l=!0)}function b(){c<
f?(a.gotoAndStop(a.currentFrame+1),c+=1):a.loop&&(a.gotoAndStop(g),c=1)}function e(){void 0!==h&&!0===l&&(l=!1,f=k=g=c=0,clearInterval(h))}var c=0,f=0,g=0,k=0,h=void 0,l=!1;a.show=function(d){e();"string"!==typeof d?a.gotoAndStop(d):a.gotoAndStop(a.frames.indexOf(d))};a.play=function(){d([0,a.frames.length-1])};a.stop=function(){e();a.gotoAndStop(a.currentFrame)};a.playing=l;a.playSequence=d};g.render=function(a,d){function b(c){if(c.visible&&c.gx<a.width+c.width&&c.gx+c.width>=-c.width&&c.gy<a.height+
c.height&&c.gy+c.height>=-c.height){e.save();g.interpolate?(c.renderX=void 0!==c._previousX?(c.x-c._previousX)*d+c._previousX:c.x,c.renderY=void 0!==c._previousY?(c.y-c._previousY)*d+c._previousY:c.y):(c.renderX=c.x,c.renderY=c.y);e.translate(c.renderX+c.width*c.pivotX,c.renderY+c.height*c.pivotY);e.globalAlpha=c.alpha;e.rotate(c.rotation);e.scale(c.scaleX,c.scaleY);c.shadow&&(e.shadowColor=c.shadowColor,e.shadowOffsetX=c.shadowOffsetX,e.shadowOffsetY=c.shadowOffsetY,e.shadowBlur=c.shadowBlur);c.blendMode&&
(e.globalCompositeOperation=c.blendMode);c.render&&c.render(e);if(c.children&&0<c.children.length){e.translate(-c.width*c.pivotX,-c.height*c.pivotY);for(var f=0;f<c.children.length;f++)b(c.children[f])}e.restore()}}var e=a.ctx;e.clearRect(0,0,a.width,a.height);for(var c=0;c<g.stage.children.length;c++)b(g.stage.children[c])};g.assets={toLoad:0,loaded:0,imageExtensions:["png","jpg","gif","webp"],fontExtensions:["ttf","otf","ttc","woff"],audioExtensions:["mp3","ogg","wav","webm"],jsonExtensions:["json"],
whenLoaded:void 0,load:function(a){console.log("Loading assets...");var d=this;d.toLoad=a.length;a.forEach(function(a){var b=a.split(".").pop();if(-1!==d.imageExtensions.indexOf(b)){var c=new Image;c.addEventListener("load",function(){c.name=a;d[c.name]={source:c,frame:{x:0,y:0,w:c.width,h:c.height}};d.loadHandler()},!1);c.src=a}else if(-1!==d.fontExtensions.indexOf(b)){var b=a.split("/").pop().split(".")[0],e=document.createElement("style");e.appendChild(document.createTextNode("@font-face {font-family: '"+
b+"'; src: url('"+a+"');}"));document.head.appendChild(e);d.loadHandler()}else if(-1!==d.audioExtensions.indexOf(b))b=g.makeSound(a,d.loadHandler.bind(d)),b.name=a,d[b.name]=b;else if(-1!==d.jsonExtensions.indexOf(b)){var f=new XMLHttpRequest,k={};f.open("GET",a,!0);f.addEventListener("readystatechange",function(){200===f.status&&4===f.readyState&&(k=JSON.parse(f.responseText),k.name=a,d[k.name]=k,k.frames?d.createTilesetFrames(k,a):d.loadHandler())});f.send()}else console.log("File type not recognized: "+
a)})},createTilesetFrames:function(a,d){var b=this,c=d.replace(/[^\/]*$/,""),e=new Image;e.addEventListener("load",function(){b[c+a.meta.image]={source:e,frame:{x:0,y:0,w:e.width,h:e.height}};Object.keys(a.frames).forEach(function(d){b[d]=a.frames[d];b[d].source=e});b.loadHandler()},!1);e.src=c+a.meta.image},loadHandler:function(){this.loaded+=1;console.log(this.loaded);this.toLoad===this.loaded&&(this.loaded=this.toLoad=0,this.whenLoaded())}};g.keyboard=q;g.makeDisplayObject=l;void 0!==GA.plugins&&
GA.plugins(g);void 0!==GA.custom&&GA.custom(g);return g};window.ga=GA.create;GA=GA||{};
GA.plugins=function(b){b.move=function(b){b.x+=b.vx|0;b.y+=b.vy|0};b.randomInt=function(b,c){return Math.floor(Math.random()*(c-b+1))+b};b.randomFloat=function(b,c){return b+Math.random()*(c-b)};b.wait=function(b,c){return setTimeout(c,b)};b.worldCamera=function(b,c){return{width:c.width,height:c.height,_x:0,_y:0,get x(){return this._x},set x(c){this._x=c;b.x=-this._x;b._previousX=b.x},get y(){return this._y},set y(c){this._y=c;b.y=-this._y;b._previousY=b.y},get centerX(){return this.x+this.width/
2},get centerY(){return this.y+this.height/2},get rightInnerBoundary(){return this.x+this.width/2+this.width/4},get leftInnerBoundary(){return this.x+this.width/2-this.width/4},get topInnerBoundary(){return this.y+this.height/2-this.height/4},get bottomInnerBoundary(){return this.y+this.height/2+this.height/4},follow:function(c){c.x<this.leftInnerBoundary&&(this.x=c.x-this.width/4);c.y<this.topInnerBoundary&&(this.y=c.y-this.height/4);c.x+c.width>this.rightInnerBoundary&&(this.x=c.x+c.width-this.width/
4*3);c.y+c.height>this.bottomInnerBoundary&&(this.y=c.y+c.height-this.height/4*3);0>this.x&&(this.x=0);0>this.y&&(this.y=0);this.x+this.width>b.width&&(this.x=b.width-this.width);this.y+this.height>b.height&&(this.y=b.height-this.height)},centerOver:function(b){this.x=b.x+b.halfWidth-this.width/2;this.y=b.y+b.halfHeight-this.height/2}}};b.scaleToWindow=function(e){var c,k;c=Math.min(window.innerWidth/b.canvas.width,window.innerHeight/b.canvas.height);b.canvas.style.transformOrigin="0 0";b.canvas.style.transform=
"scale("+c+")";k=b.canvas.width>b.canvas.height?b.canvas.width*c<window.innerWidth?"horizontally":"vertically":b.canvas.height*c<window.innerHeight?"vertically":"horizontally";var h;"horizontally"===k&&(h=(window.innerWidth-b.canvas.width*c)/2,b.canvas.style.marginLeft=h+"px",b.canvas.style.marginRight=h+"px");"vertically"===k&&(h=(window.innerHeight-b.canvas.height*c)/2,b.canvas.style.marginTop=h+"px",b.canvas.style.marginBottom=h+"px");b.canvas.style.paddingLeft=0;b.canvas.style.paddingRight=0;
b.canvas.style.paddingTop=0;b.canvas.style.paddingBottom=0;b.canvas.style.display="block";document.body.style.backgroundColor=e||"#2C3539";b.pointer.scale=c;b.scale=c;b.canvas.scaled=!0;e=navigator.userAgent.toLowerCase();-1==e.indexOf("safari")||-1<e.indexOf("chrome")||(b.canvas.style.maxHeight="100%",b.canvas.style.minHeight="100%")};b.shoot=function(b,c,k,h,n,f){f=f();f.x=b.centerX-f.halfWidth+k*Math.cos(c);f.y=b.centerY-f.halfHeight+k*Math.sin(c);f.vx=Math.cos(c)*h;f.vy=Math.sin(c)*h;n.push(f);
return f};b.particles=[];b.particleEffect=function(e,c,k,h,n,f,p,l,t,u,q,x,g,a,d,r,y,z,m,A){function D(f){var h=k();0<h.frames.length&&h.gotoAndStop(Math.floor(Math.random()*(h.frames.length-1-0+1))+0);var l=Math.sin(f);f=Math.cos(f);var p=v(m,A);h.x=e-h.halfWidth+p*f;h.y=c-h.halfHeight+p*l;p=Math.floor(Math.random()*(u-t+1))+t;h.width=p;h.height=p;h.scaleSpeed=v(g,a);h.alphaSpeed=v(d,r);h.rotationSpeed=v(y,z);p=v(q,x);h.vx=p*f;h.vy=p*l;h.updateParticle=function(){h.vy+=n;h.x+=h.vx;h.y+=h.vy;0<h.scaleX-
h.scaleSpeed&&(h.scaleX-=h.scaleSpeed);0<h.scaleY-h.scaleSpeed&&(h.scaleY-=h.scaleSpeed);h.rotation+=h.rotationSpeed;h.alpha-=h.alphaSpeed;0>=h.alpha&&(b.remove(h),b.particles.splice(b.particles.indexOf(h),1))};b.particles.push(h)}void 0===e&&(e=0);void 0===c&&(c=0);void 0===k&&(k=function(){return b.circle(10,"red")});void 0===h&&(h=10);void 0===n&&(n=0);void 0===f&&(f=!0);void 0===p&&(p=0);void 0===l&&(l=6.28);void 0===t&&(t=4);void 0===u&&(u=16);void 0===q&&(q=.1);void 0===x&&(x=1);void 0===g&&
(g=.01);void 0===a&&(a=.05);void 0===d&&(d=.02);void 0===r&&(r=.02);void 0===y&&(y=.01);void 0===z&&(z=.03);void 0===m&&(m=0);void 0===A&&(A=0);for(var v=function(a,b){return a+Math.random()*(b-a)},B=[],w,E=(l-p)/(h-1),C=0;C<h;C++)f?(w=v(p,l),B.push(w)):(void 0===w&&(w=p),B.push(w),w+=E);B.forEach(function(a){D(a)})};b.updateParticles=function(){if(0<b.particles.length)for(var e=b.particles.length-1;0<=e;e--)b.particles[e].updateParticle()};b.updateFunctions.push(b.updateParticles);b.emitter=function(b,
c){function e(){c()}var h={},n=void 0;h.playing=!1;h.play=function(){h.playing||(c(),n=setInterval(e.bind(this),b),h.playing=!0)};h.stop=function(){h.playing&&(clearInterval(n),h.playing=!1)};return h};b.outsideBounds=function(b,c,k){var e=c.y,n=c.width,f=c.height,p;b.x<c.x-b.width&&(p="left");b.y<e-b.height&&(p="top");b.x>n&&(p="right");b.y>f&&(p="bottom");p&&k&&k(p);return p};b.hitTestCircle=function(b,c,k){var e;void 0===k&&(k=!1);k?(k=c.gx+c.radius-(b.gx+b.radius),e=c.gy+c.radius-(b.gy+b.radius)):
(k=c.centerX-b.centerX,e=c.centerY-b.centerY);return Math.sqrt(k*k+e*e)<b.radius+c.radius};b.hitTestRectangle=function(b,c,k){var e,n;void 0===k&&(k=!1);k?(e=b.gx+b.halfWidth-(c.gx+c.halfWidth),n=b.gy+b.halfHeight-(c.gy+c.halfHeight)):(e=b.centerX-c.centerX,n=b.centerY-c.centerY);k=b.halfWidth+c.halfWidth;b=b.halfHeight+c.halfHeight;return Math.abs(e)<k?Math.abs(n)<b?!0:!1:!1};b.hitTestCircleRectangle=function(e,c,k){var h,n,f,p;void 0===k&&(k=!1);k?(h=e.gx,n=e.gy,f=c.gx,p=c.gy):(h=e.x,n=e.y,f=c.x,
p=c.y);h=n<p-c.halfHeight?h<f-1-c.halfWidth?"topLeft":h>f+1+c.halfWidth?"topRight":"topMiddle":n>p+c.halfHeight?h<f-1-c.halfWidth?"bottomLeft":h>f+1+c.halfWidth?"bottomRight":"bottomMiddle":h<f-c.halfWidth?"leftMiddle":"rightMiddle";if("topMiddle"===h||"bottomMiddle"===h||"leftMiddle"===h||"rightMiddle"===h)e=b.hitTestRectangle(e,c,k);else{n={};switch(h){case "topLeft":n.x=f;n.y=p;break;case "topRight":n.x=f+c.width;n.y=p;break;case "bottomLeft":n.x=f;n.y=p+c.height;break;case "bottomRight":n.x=f+
c.width,n.y=p+c.height}e=b.hitTestCirclePoint(e,n,k)}return e?h:e};b.hitTestCirclePoint=function(e,c,k){void 0===k&&(k=!1);c.diameter=1;c.radius=.5;c.centerX=c.x;c.centerY=c.y;c.gx=c.x;c.gy=c.y;return b.hitTestCircle(e,c,k)};b.recreateStage=function(){var e={};b.makeDisplayObject(e);e.stage=!0;e.width=b.canvas.width;e.height=b.canvas.height;e.x=0;e.y=0;e.parent=void 0;b.stage=e}};var WorldSize=4096,time,player,enemies,spawner,world,grid,wormHole,wormHoleEmitter,gems,camera,bullets,cells,playerThrust,gemsMessage,timeMessage,healthMessage,gameOverMessage,gameOverMessage2,gameSummaryMessage,restartMessage,gameWonMessage,ga=ga(1024,1024,load);ga.start();ga.scaleToWindow();ga.fps=60;
function makeGrid(b,e,c,k,h,n,f,p){var l={};ga.makeDisplayObject(l);l.mask=!1;l.width=b||256;l.height=e||256;l.strokeStyle=h||"grey";l.lineWidth=n||1;l.x=f||0;l.y=p||0;ga.stage.addChild(l);l.render=function(b){b.strokeStyle=l.strokeStyle;b.lineWidth=l.lineWidth;b.beginPath();for(var e=0,f=this.height;e<=f;e+=c)b.moveTo(-l.width*l.pivotX+e,-l.height*l.pivotY),b.lineTo(-l.width*l.pivotX+e,l.height*(1-l.pivotY));e=0;for(f=this.height;e<=f;e+=k)b.moveTo(-l.width*l.pivotX,-l.height*l.pivotY+e),b.lineTo(l.width*
(1-l.pivotX),-l.height*l.pivotY+e);!0===l.mask?b.clip():"none"!==l.strokeStyle&&b.stroke()};return l}
function makeShip(b,e,c,k,h,n){var f={};ga.makeDisplayObject(f);f.mask=!1;f.width=b||32;f.height=b||32;f.fillStyle=e||"cyan";f.strokeStyle=c||"white";f.lineWidth=k||2;f.x=h||0;f.y=n||0;b*=.5;f.x1=b;f.y1=0;f.x2=-b;f.y2=-b;f.x3=.5*-b;f.y3=0;f.x4=-b;f.y4=b;ga.stage.addChild(f);f.render=function(b){b.strokeStyle=f.strokeStyle;b.fillStyle=f.fillStyle;b.lineWidth=f.lineWidth;b.beginPath();b.moveTo(f.x1,f.y1);b.lineTo(f.x2,f.y2);b.lineTo(f.x3,f.y3);b.lineTo(f.x4,f.y4);b.lineTo(f.x1,f.y1);!0===f.mask?b.clip():
("none"!==f.strokeStyle&&b.stroke(),"none"!==f.fillStyle&&b.fill())};return f}function makeWormhole(b,e,c,k,h,n){var f=ga.circle(b,e,c,k,h,n);wormHoleEmitter=ga.emitter(200,function(){return ga.particleEffect(f.centerX,f.centerY,function(){var b=ga.circle(8,"grey","white",1);b.frames=[];world.addChild(b);return b},16,0,!1,0,2*Math.PI,2,4,-.5,-1.25,void 0,void 0,void 0,void 0,void 0,void 0,f.radius,1.5*f.radius)});wormHoleEmitter.play();return f}
function makeGem(b,e,c,k,h,n){var f={},p=2*b;ga.makeDisplayObject(f);f.mask=!1;f.width=p||32;f.height=p||32;f.fillStyle=e||"white";f.strokeStyle=c||"red";f.lineWidth=k||2;f.x=h||0;f.y=n||0;e=2*Math.PI/3;f.x1=0;f.y1=b;f.x2=f.x1*Math.cos(e)-f.y1*Math.sin(e);f.y2=f.x1*Math.sin(e)+f.y1*Math.cos(e);f.x3=f.x1*Math.cos(-e)-f.y1*Math.sin(-e);f.y3=f.x1*Math.sin(-e)+f.y1*Math.cos(-e);ga.stage.addChild(f);f.render=function(c){c.strokeStyle=f.strokeStyle;c.fillStyle=f.fillStyle;c.lineWidth=f.lineWidth;c.beginPath();
c.arc(b+-p*f.pivotX,b+-p*f.pivotY,b,0,2*Math.PI,!1);c.stroke();c.beginPath();c.moveTo(f.x1,f.y1);c.lineTo(f.x2,f.y2);c.lineTo(f.x3,f.y3);!0===f.mask?c.clip():("none"!==f.strokeStyle&&c.stroke(),"none"!==f.fillStyle&&c.fill())};return f}
function makeEnemyExplodeSprite(b,e,c,k,h,n){var f={};ga.makeDisplayObject(f);f.mask=!1;f.width=b||32;f.height=e||32;f.rotation=c||0;f.lineWidth=k||2;f.x=h||0;f.y=n||0;f.time0=time;ga.stage.addChild(f);f.render=function(b){var c=time-this.time0,e=parseInt(255*(1-.75*c),10);b.strokeStyle="rgb("+e+", 0, 0)";b.lineWidth=f.lineWidth;b.beginPath();c=c*ga.fps*.5;b.moveTo(c+this.halfWidth,-this.halfHeight);b.lineTo(c+this.halfWidth,this.halfHeight);b.moveTo(this.halfWidth,c+this.halfHeight);b.lineTo(-this.halfWidth,
c+this.halfHeight);b.moveTo(-c-this.halfWidth,this.halfHeight);b.lineTo(-c-this.halfWidth,-this.halfHeight);b.moveTo(-this.halfWidth,-c-this.halfHeight);b.lineTo(this.halfWidth,-c-this.halfHeight);!0===f.mask?b.clip():("none"!==f.strokeStyle&&b.stroke(),"none"!==f.fillStyle&&b.fill())};return f}function explodePlayerShip(b,e){ga.particleEffect(b,e,function(){var b=ga.circle(10,"grey","cyan",1);b.frames=[];world.addChild(b);return b},36,0,!1,0,2*Math.PI,10,16,1,2,.001,.004)}
function createWorld(){world=ga.group();world.width=WorldSize;world.height=WorldSize;world.calculateSize=function(){}}
function partitionWorld(b){cells={size:b,count:WorldSize/b,data:{},addEnemy:function(b){var c=b.position,c=this.index(c.x,c.y);this.data[c]=this.data[c]||{};this.data[c].enemies=this.data[c].enemies||[];this.data[c].enemies.push(b);b.cell=c},addBullet:function(b){var c=b.position,c=this.index(c.x,c.y);this.data[c]=this.data[c]||{};this.data[c].bullets=this.data[c].bullets||[];this.data[c].bullets.push(b);b.cell=c},removeEnemy:function(b){var c=b.position;this.index(c.x,c.y);c=this.data[b.cell].enemies.indexOf(b);
if(-1!=c)this.data[b.cell].enemies.splice(c,1);else throw"invalid enemy index "+c;},removeBullet:function(b){var c=b.position;this.index(c.x,c.y);c=this.data[b.cell].bullets.indexOf(b);if(-1!=c)this.data[b.cell].bullets.splice(c,1);else throw"invalid bullet index "+c;},moveEnemy:function(b){var c=b.position,c=this.index(c.x,c.y);b.cell!=c&&(this.removeEnemy(b),this.addEnemy(b))},moveBullet:function(b){var c=b.position,c=this.index(c.x,c.y);b.cell!=c&&(this.removeBullet(b),this.addBullet(b))},getEnemies:function(b,
c){try{var e=this.index(b,c);return this.data[e].enemies}catch(h){return[]}},getBullets:function(b,c){try{var e=this.index(b,c);return this.data[e].bullets}catch(h){return[]}},index:function(b,c){var e=parseInt(b/this.size,10);return parseInt(c/this.size,10)*this.count+e}}}function setupGlobalControls(){ga.keyboard(82).press=function(){restartGame()}}
function setupPlayerControls(){ga.key.leftArrow.press=function(){player.rotationSpeed=-player.maxRotationSpeed};ga.key.leftArrow.release=function(){ga.key.rightArrow.isDown||(player.rotationSpeed=0)};ga.key.rightArrow.press=function(){player.rotationSpeed=player.maxRotationSpeed};ga.key.rightArrow.release=function(){ga.key.leftArrow.isDown||(player.rotationSpeed=0)};ga.key.upArrow.press=function(){player.isMoving=!0;playerThrust.play()};ga.key.upArrow.release=function(){player.isMoving=!1;playerThrust.stop()}}
function teardownPlayerControls(){ga.key.leftArrow.press=function(){};ga.key.leftArrow.release=function(){};ga.key.rightArrow.press=function(){};ga.key.rightArrow.release=function(){};ga.key.upArrow.press=function(){};ga.key.upArrow.release=function(){}}
function createPlayer(){player=makeShip(40,"cyan","white",4);player.maxRotationSpeed=.1;player.maxSpeed=10;player.isMoving=!1;player.rotationSpeed=0;player.acceleration=.36;player.friction=.95;player.maxHealth=5;player.health=player.maxHealth;player.gems=0;player.collect=function(){this.gems++};player.hit=function(){this.health--;this.updateColor();0>=this.health&&endGame()};player.updateColor=function(){var b=parseInt(this.health/this.maxHealth*255,10),e=parseInt((this.health+this.maxHealth)/(2*
this.maxHealth)*255,10);this.fillStyle="rgb(0, "+b+", "+b+")";this.strokeStyle="rgb("+e+", "+e+", "+e+")"};world.addChild(player);world.putCenter(player);setupPlayerControls();playerThrust=ga.emitter(100,function(){return ga.particleEffect((player.x-player.centerX)*Math.cos(player.rotation)-(player.centerY-player.centerY)*Math.sin(player.rotation)+player.centerX,(player.x-player.centerX)*Math.sin(player.rotation)+(player.centerY-player.centerY)*Math.cos(player.rotation)+player.centerY,function(){var b=
ga.circle(8,"grey","white",1);b.frames=[];world.addChild(b);return b},12,0,!1,2/3*Math.PI+player.rotation,4/3*Math.PI+player.rotation,8,12,2,4)})}
function spawnEnemy(b,e){var c=ga.rectangle(32,32,"red","yellow",4,b,e);c.vx=0;c.vy=0;c.rotation=ga.randomFloat(0,Math.PI);c.rotationSpeed=ga.randomFloat(.01,.02);c.shootDelaySeconds=ga.randomFloat(4,6);c.timeToShoot=c.shootDelaySeconds*ga.fps;c.hit=!1;c.update=function(){var b=player.x-this.x,c=player.y-this.y,e=Math.sqrt(b*b+c*c);this.vx=b/e*2.1;this.vy=c/e*2.1;this.rotation+=this.rotationSpeed};enemies.push(c);cells.addEnemy(c);world.addChild(c)}
function startSpawningEnemies(){var b=0,e={0:[0,0],1:[WorldSize-32,0],2:[WorldSize-32,WorldSize-32],3:[0,WorldSize-32]};spawner=ga.emitter(455,function(){var c=e[b++%4];spawnEnemy(c[0],c[1])});spawner.play()}
function createUi(){gemsMessage=ga.text("","30px sans-serif","grey",10,10);timeMessage=ga.text("","30px sans-serif","grey",1E3,10);healthMessage=ga.text("","30px sans-serif","grey",450,10);gameOverMessage=ga.text("","75px sans-serif","grey",-1,420);gameOverMessage2=ga.text("","75px sans-serif","grey",-1,550);gameSummaryMessage=ga.text("","75px sans-serif","grey",-1,650);restartMessage=ga.text("Press R to restart","75px sans-serif","grey",-1,750);gameOverMessage.visible=!1;gameOverMessage2.visible=
!1;gameSummaryMessage.visible=!1;restartMessage.visible=!1}function clamp(b,e){return Math.min(Math.max(b,-e),e)}function clamp2(b,e,c){return Math.min(Math.max(b,e),c)}function centerText(b,e){ga.canvas.ctx.font=e.font;e.x=.5*(b.width-e.width)}function load(){setupGlobalControls();intro();ga.state=empty}
function intro(){var b=-25,e=0,c=[];c[e++]=ga.text("You are lost in an odd square space.","45px sans-serif","grey",10,b+=100);c[e++]=ga.text("You must survive and escape.","45px sans-serif","grey",10,b+=100);c[e++]=ga.text("You need to retrieve four gems","45px sans-serif","grey",10,b+=100);c[e++]=ga.text("located at corners in this odd world","45px sans-serif","grey",10,b+=100);c[e++]=ga.text("and reach worm hole in center.","45px sans-serif","grey",10,b+=100);c[e++]=ga.text("Left/right arrow to steer your ship.",
"45px sans-serif","grey",10,b+=100);c[e++]=ga.text("Up arrow to accelerate.","45px sans-serif","grey",10,b+=100);c[e++]=ga.text("Press R at any time to restart game","45px sans-serif","grey",10,b+=100);c[e++]=ga.text("Press R to start","45px sans-serif","grey",10,b+=100);c.forEach(function(b){centerText(ga.stage,b)})}
function restartGame(){ga.state=void 0;spawner&&spawner.stop();playerThrust&&playerThrust.stop();wormHoleEmitter&&wormHoleEmitter.stop();ga.recreateStage();prepareGame();ga.state=play}
function prepareGame(){createWorld();time=0;enemies=[];bullets=[];partitionWorld(128);grid=makeGrid(WorldSize,WorldSize,128,128,"#333",2,0,0);wormHole=makeWormhole(64,"#111","#888",4);gems=[makeGem(21,"cyan","white",2,107,107),makeGem(21,"cyan","white",2,WorldSize-128-21,107),makeGem(21,"cyan","white",2,WorldSize-128-21,WorldSize-128-21),makeGem(21,"cyan","white",2,107,WorldSize-128-21)];world.addChild(grid);world.putCenter(grid);world.addChild(wormHole);world.putCenter(wormHole);gems.forEach(function(b){world.addChild(b)});
createPlayer();startSpawningEnemies();camera=ga.worldCamera(world,ga.canvas);camera.centerOver(player);createUi()}
function endGame(){spawner.stop();wormHoleEmitter.stop();explodePlayerShip(player.centerX,player.centerY);ga.remove(player);playerThrust.stop();teardownPlayerControls();updateUi();var b=time.toFixed(1);gameOverMessage.content="GAME OVER";gameOverMessage2.content="You died :(";gameSummaryMessage.content="You survived "+b+"s";centerText(ga.stage,gameOverMessage);centerText(ga.stage,gameOverMessage2);centerText(ga.stage,gameSummaryMessage);centerText(ga.stage,restartMessage);gameOverMessage.visible=
!0;gameOverMessage2.visible=!0;gameSummaryMessage.visible=!0;restartMessage.visible=!0;ga.state=gameOver}
function winGame(){spawner.stop();playerThrust.stop();teardownPlayerControls();updateUi();var b=time.toFixed(1);gameOverMessage.content="GAME COMPLETED";gameOverMessage2.content="You succeeded!";gameSummaryMessage.content="It took you "+b+"s";centerText(ga.stage,gameOverMessage);centerText(ga.stage,gameOverMessage2);centerText(ga.stage,gameSummaryMessage);centerText(ga.stage,restartMessage);gameOverMessage.visible=!0;gameOverMessage2.visible=!0;gameSummaryMessage.visible=!0;restartMessage.visible=
!0;ga.state=gameWon}function move(b){ga.move(b);b===player&&(0>b.x&&(b.vx=Math.max(b.vx,0)),b.x+b.width>world.width&&(b.vx=Math.min(b.vx,0)),0>b.y&&(b.vy=Math.max(b.vy,0)),b.y+b.height>world.height&&(b.vy=Math.min(b.vy,0)));b.x=clamp2(b.x+b.halfWidth,0,WorldSize)-b.halfWidth;b.y=clamp2(b.y+b.halfHeight,0,WorldSize)-b.halfHeight}
function updatePlayer(){player.rotation+=player.rotationSpeed;player.isMoving?(player.vx=clamp(player.vx+player.acceleration*Math.cos(player.rotation),player.maxSpeed),player.vy=clamp(player.vy+player.acceleration*Math.sin(player.rotation),player.maxSpeed)):(player.vx*=player.friction,player.vy*=player.friction);move(player);gems=gems.filter(function(b){var e=ga.hitTestCircleRectangle(b,player);e&&(ga.remove(b),player.collect());return!e});4<=player.gems&&ga.hitTestCircleRectangle(wormHole,player)&&
winGame()}function updateGems(){gems.forEach(function(b){b.rotation+=.04})}function shouldEnemyShoot(b){b.timeToShoot--;return 0>=b.timeToShoot}function enemyShoot(b){b.timeToShoot=b.shootDelaySeconds*ga.fps;for(var e=0;4>e;e++){var c=ga.shoot(b,b.rotation+Math.PI/4+Math.PI/2*e,36,3.6,bullets,function(){var b=ga.rectangle(12,12,"white","red",2);b.rotation=ga.randomFloat(0,Math.PI);world.addChild(b);return b});cells.addBullet(c)}}
function updateGrid(){var b=Math.abs(player.x-WorldSize/2)+Math.abs(player.y-WorldSize/2),e=WorldSize,c=51-b/e*51,k=.25*Math.sin(time)+.75,b=parseInt(k*(b/e*204+51),10),c=parseInt(k*c,10);grid.strokeStyle="rgb("+b+", "+c+", "+c+")"}function getEnemyHit(b){var e=b.position,e=cells.getEnemies(e.x,e.y),c;for(c in e){var k=e[c];if(ga.hitTestRectangle(k,b))return k}return!1}
function updateBullets(){var b=!1;bullets=bullets.filter(function(e){ga.move(e);cells.moveBullet(e);var c=ga.outsideBounds(e,world.localBounds),k=ga.hitTestRectangle(player,e),h=getEnemyHit(e);b=b||k;h&&(h.hit=!0);if(c||k||h)return ga.remove(e),cells.removeBullet(e),!1;e.rotation+=.21;return!0});b&&player.hit()}
function updateEnemies(){for(var b in enemies)updateEnemy(enemies[b]);if(b=getEnemyHit(player))b.hit=!0,player.hit();enemies=enemies.filter(function(b){if(b.hit){ga.remove(b);cells.removeEnemy(b);var c=makeEnemyExplodeSprite(b.width,b.height,b.rotation,b.lineWidth+1,b.x,b.y);world.addChild(c);ga.wait(1E3,function(){ga.remove(c)});return!1}return!0})}function updateEnemy(b){b.update();move(b);cells.moveEnemy(b);shouldEnemyShoot(b)&&enemyShoot(b)}
function updateUi(){ga.canvas.ctx.font=timeMessage.font;timeMessage.content="time: "+time.toFixed(1);timeMessage.x=1E3-timeMessage.width;gemsMessage.content="gems: "+player.gems+"/4";healthMessage.content="health: "+player.health}function empty(){}function play(){time+=1/ga.fps;updateGrid();updateBullets();updateEnemies();updatePlayer();updateGems();camera.centerOver(player);updateUi()}
function gameOver(){time+=1/ga.fps;updateGrid();bullets.forEach(function(b){b.rotation+=.21});enemies.forEach(function(b){b.update()});updateGems()}function gameWon(){time+=1/ga.fps;updateGrid();bullets.forEach(function(b){b.rotation+=.21});enemies.forEach(function(b){b.update()})};
