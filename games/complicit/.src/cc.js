function r_cycle(a,b){return a%b/b}function r_pingpong(b,c){return a=r_cycle(b,2*c),a<.5?2*a:2-2*a}function r_limit(a,b,c){return a<b?0:a>c?1:(a-b)/(c-b)}function r_siso(a){return 3*a*a-2*a*a*a}function r_i(a,b,c){return b*(1-a)+c*a}function idiv(a,b){return Math.floor(a/b)}function step(a,b){return Math.floor(a/b)*b}function adjustTowards(a,b,c){var d=b-a;return Math.abs(d)<c?b:d>0?a+c:a-c}function weaveAction(a,b,c,d,e,f){return function(g,h){g-=a,this.x=b+r_i(r_siso(r_pingpong(g,f)),0,d),this.y=c+r_i(r_limit(r_cycle(g,f),.8,1),0,e)+idiv(g,f)*e}}function wiggleAction(a,b,c,d,e,f){return function(g,h){g-=a,this.x=b+r_i(r_siso(r_pingpong(g,f)),0,d),this.y=c+g/f*e}}function slideAction(a,b,c,d,e,f){return function(g,h){g-=a,this.x=b+r_i(r_siso(r_pingpong(g,f)),0,d),this.y=c+r_i(r_cycle(g,f),0,e)+idiv(g,f)*e}}function followControllerAction(){return function(a,b){if(void 0===this.a&&(this.a=0,this.x=50,this.y=130,board.avatar=this),this.fireNow=!1,board.control_active){var c=(board.control_x-50)/100;c<-.45&&(c=-.45),c>.45&&(c=.45);var d=board.control_y<100?1:(150-board.control_y)/50;this.x=adjustTowards(this.x,50+100*c,.05*b),this.a=adjustTowards(this.a,d,b/1e3),this.fireNow=!0}if((board.keyList[68]||board.keyList[39])&&(this.x=adjustTowards(this.x,97,.05*b),this.fireNow=!0),(board.keyList[65]||board.keyList[37])&&(this.x=adjustTowards(this.x,3,.05*b),this.fireNow=!0),(board.keyList[87]||board.keyList[38])&&(this.a=adjustTowards(this.a,1,b/1e3),this.fireNow=!0),(board.keyList[83]||board.keyList[40])&&(this.a=adjustTowards(this.a,0,b/1e3),this.fireNow=!0),(board.keyList[32]||board.keyList[13])&&(this.fireNow=!0),this.fireNow){c=(this.x-50)/100;var e=this.a*c*c+this.a;this.y=135-50*e,this.pointAng=-Math.atan(2*this.a*c)-Math.PI/2,this.display.style.transform="rotate("+(this.pointAng+Math.PI/2)+"rad)"}}}function avatarFireAction(){return function(a,b){this.fireNow&&addOb(sprites.aBullet,bulletAction(this.x,this.y,this.pointAng,100),null),board.shadowRec.push({x:this.x,y:this.y,pAng:this.pointAng,fire:this.fireNow})}}function ghostFollowAction(a){return function(b,c){var d=idiv(b,250),e=b%250/250;if(!this.isDead){if(d+1>=a.length)return void killOb(this);this.x=r_i(e,a[d].x,a[d+1].x),this.y=r_i(e,a[d].y,a[d+1].y),this.pointAng=r_i(e,a[d].pAng,a[d+1].pAng),isNaN(this.pointAng)||(this.display.style.transform="rotate("+(this.pointAng+Math.PI/2)+"rad)")}}}function ghostFireAction(a){return function(b,c){if(!this.isDead){var d=idiv(b,250);a[d].fire&&addOb(sprites.gBullet,bulletAction(this.x,this.y,this.pointAng,100),null)}}}function regularFireAction(a,b,c,d){return function(e,f){(f+a)%b||addOb(c,bulletAction(this.x,this.y,1.57,d),null)}}function diveBombAction(a,b,c){return function(d,e){(e+a)%b||this.y>-50&&programOb(this,diveAction(this.x,this.y,c),null)}}function diveAction(a,b,c){var d=-a+board.avatar.x,e=c;return function(c,f){this.x=a+d*c/1e3,this.y=b+e*c/1e3}}function regularFireAngleAction(a,b,c,d,e){return function(f,g){if(!((g+a)%b)){var h=e*Math.random();board.avatar.x>this.x&&(h*=-1),addOb(c,bulletAction(this.x,this.y,1.57+h/180*3.14,d),null)}}}function dualFireAngleAction(a,b,c,d,e){return function(f,g){if(!((g+a)%b)){var h=e*Math.random();board.avatar.x>this.x&&(h*=-1),addOb(c,bulletAction(this.x,this.y,1.57+h/180*3.14,d),null),addOb(c,bulletAction(this.x,this.y,1.57+h/180*3.14/2,.9*d),null)}}}function xZoneFireAction(a,b,c,d,e){return function(f,g){Math.abs(board.avatar.x-this.x)>a||(g+b)%c||addOb(d,bulletAction(this.x,this.y,1.57,e),null)}}function bulletAction(a,b,c,d){var e=Math.cos(c)*d,f=Math.sin(c)*d;return function(c,d){this.x=a+e*c/1e3,this.y=b+f*c/1e3}}function sqAction(a,b,c,d,e,f,g){return function(h,i){h-=a,this.x=b+r_i(r_siso(r_limit(r_cycle(h,g),0,.25)),0,d)-r_i(r_siso(r_limit(r_cycle(h,g),.5,.75)),0,d),this.y=c+r_i(r_siso(r_limit(r_cycle(h,g),.25,.5)),0,e)-r_i(r_siso(r_limit(r_cycle(h,g),.75,1)),0,e)+h/g*f}}function cgrad(a,b,c,d){var e=a.createRadialGradient(0,0,0,0,0,b);return e.addColorStop(0,c),e.addColorStop(1,d),e}function createOGO(a){var b=Object.create(OGO);return a||(a=100),b.res=a,b.canvas=document.createElement("canvas"),b.canvas.width=a,b.canvas.height=a,b.ctx=b.canvas.getContext("2d"),b.ctx.translate(+b.canvas.width/2,+b.canvas.height/2),b.ctx.scale(b.canvas.width,b.canvas.height),b.ctx.lineCap="round",b.ctx.textAlign="center",b.ctx.textBaseline="middle",b}function prepSprites(){sprites.avatar=createOGO(200).lineWidth(5).lineGrad("#FA0","#F00").line(0,.2,0,.3).echo(5,0,0,.3,.2,0,0,1,.5,1,1).lineWidth(3).lineGrad("#FFA","#FF0").line(.4,.4,0,-.4).line(0,-.2,.2,.2).circle(.1,.1,.03).lineWidth(6).line(.3,.4,.3,0).mirror(!0,!1).echo(5,0,0,0,.2,0,0,1,1,1,0).makeSprite("normal",15,1),sprites.ghost=createOGO(200).lineWidth(5).lineGrad("#FA0","rgba(255,0,0,0)").line(0,.2,0,.3).echo(5,0,0,.3,.2,0,0,1,.5,1,1).lineWidth(3).lineGrad("#FFF","#FF8").line(.4,.4,0,-.4).line(0,-.2,.2,.2).circle(.1,.1,.03).lineWidth(6).line(.3,.4,.3,0).mirror(!0,!1).echo(3,0,0,0,.2,0,0,1,1,.3,0).makeSprite("normal",15,1),sprites.aBullet=createOGO(50).lineStyle("#ffffff").lineWidth(2).line(0,0,.3,-.3).lineStyle("#aaaa00").lineWidth(2).line(0,0,0,-.4).echo(10,0,0,0,0,0,90,1,.6,.3,1).rotSym(5).makeSprite("bullet",5,1),sprites.gBullet=createOGO(50).lineStyle("#AAAAAA").lineWidth(2).line(0,0,.3,-.3).lineStyle("#AAAA00").lineWidth(2).line(0,0,0,-.4).echo(10,0,0,0,0,0,90,1,.6,.3,.8).rotSym(5).makeSprite("bullet",5,1),sprites.grunt1=createOGO(150).lineStyle("#5F0").lineWidth(2).circle(.1,.1,.1).lineGrad("#000","#0F0").circle(.3,0,.1).echo(80,0,0,0,0,0,360,1,1,0,.5).rotSym(2).makeSprite("roll",10,2),sprites.grunt2=createOGO(150).lineStyle("#AAFF00").lineWidth(1).circle(.1,.1,.05).lineStyle("#00FF00").circle(.3,.2,.05).echo(80,0,0,0,0,0,120,1,1,0,.5).rotSym(3).makeSprite("rock",10,2),sprites.greenBullet=createOGO(50).lineStyle("#00ff00").lineWidth(3).line(0,.4,0,-.4).echo(20,0,0,.4,0,0,0,1,.1,.8,0).rotSym(2).makeSprite("bullet",4,2),sprites.bigGreenBullet=createOGO(50).lineStyle("#00AA00").lineWidth(3).line(0,.4,0,-.4).lineStyle("#88AA00").line(.15,.3,.15,-.3).line(.3,.2,.3,-.2).echo(20,0,0,.4,0,0,0,1,.1,.8,0).rotSym(2).makeSprite("bullet",5,2,1),sprites.flow1=createOGO(100).lineStyle("#00FF00").lineWidth(2).circle(.1,0,.2).echo(10,0,-.1,0,-.15,0,180,.2,1,.5,1).rotSym(3).makeSprite("throb",13,2),sprites.flow2=createOGO(100).lineStyle("#008800").lineWidth(2).circle(.1,0,.2).lineStyle("#00FF00").lineWidth(5).circle(.1,0,.1).echo(10,0,-.1,0,-.15,0,180,.2,1,.5,1).rotSym(2).makeSprite("roll",18,2),sprites.boss1=createOGO(200).lineStyle("#AAFFAA").lineWidth(3).circle(.3,.1,.1).lineStyle("#008800").lineWidth(3).circle(.3,.1,.05).lineStyle("#00FF00").line(0,.1,.3,.2).rotSym(6).echo(15,0,0,0,0,45,0,1,1,0,.4).makeSprite("roll",25,2,10),sprites.logo=createOGO(400).fillStyle("#999900").text("Complicit",0,0,1.5,!0).echo(20,0,0,0,-.05,0,20,1,.8,.3,0).fillStyle("#FFFF44").text("Complicit",0,0,1.5,!0).echo(10,0,0,0,.02,-90,-90,1,1,.3,0).makeSprite("none",25,0),sprites.zone0=createOGO(400).lineStyle("#00FF00").text("α-Zone",0,.2,2).echo(10,0,0,0,.9,0,60,1,.1,.5,0).lineStyle("#00FF00").text("α-Zone",0,.2,2).makeSprite("lev",40,0),sprites.zone1=createOGO(400).fillStyle("#4444FF").text("β-Zone",0,.25,2,!0).echo(20,0,0,.2,.2,0,-20,1,1,.4,0).fillStyle("#99F").text("β-Zone",0,.25,2,!0).makeSprite("lev",40,0),sprites.zone2=createOGO(400).fillGrad("#500","#F08").text("Ω",-.2,.2,3,!0).echo(40,0,0,0,0,90,0,.5,1,.1,.4).rotSym(4).lineStyle("#D00").text("Ω",-.2,.2,3.2).fillStyle("#F00").text("zone",.1,.25,1.5,!0).makeSprite("lev",40,0);var a="The avatar moves",b="with your touch",c="OR use <arrows>",d="and hold <space>";sprites.tuttouch=createOGO(400).lineStyle("#A40").lineWidth(5).circle(0,0,.45).fillStyle("#AA4").text(a,0,.2,.9,!0).text(b,0,.1,.9,!0).text(c,0,-.1,.9,!0).text(d,0,-.2,.9,!0).echo(80,0,0,.4,0,0,90,1,.1,.2,0).fillStyle("#FFA").text(a,0,.2,.9,!0).text(b,0,.1,.9,!0).text(c,0,-.1,.9,!0).text(d,0,-.2,.9,!0).makeSprite("tutorial",60,3),sprites.levcomplete=createOGO(400).lineStyle("#FFAA00").lineWidth(3).text("Zone Complete",0,.1,1).lineStyle("#CCAA00").line(0,.03,.4,.03).echo(40,0,0,0,-.1,0,0,1,.3,.3,0).fillStyle("#FFAA00").text("Zone Complete",0,.1,1,!0).mirror(!0,!0).makeSprite("tutorial",60,3),sprites.incoming=createOGO(500).lineStyle("#FF3300").lineWidth(3).text("INCOMING",0,0,1.8).echo(40,0,0,0,0,0,180,1,1,.2,0).fillStyle("#FA0").text("INCOMING",0,0,1.8,!0).makeSprite("roll",60,0),sprites.geo1=createOGO(100).lineStyle("#9900FF").lineWidth(3).line(.4,0,0,.4).echo(5,0,-.4,0,0,0,0,.2,1,.5,1).rotSym(3).echo(5,0,0,0,0,0,0,2,1,0,1).makeSprite("roll",10,2),sprites.geo2=createOGO(100).lineStyle("#DD00DD").lineWidth(3).line(.4,0,0,.4).echo(5,0,-.4,0,0,0,0,.2,1,.5,1).rotSym(6).echo(5,0,0,0,0,0,0,2,1,0,1).makeSprite("rock",12,2,1),sprites.geo3=createOGO(200).lineGrad("#00F","#F0F").lineWidth(2).line(0,0,.15,.3).line(0,0,.3,.3).line(0,0,.3,.15).line(.15,.3,.3,.3).line(.3,.3,.3,.15).rotSym(6).echo(8,0,0,0,0,0,-45,.8,1.2,1,0).makeSprite("roll120",15,2),sprites.geo4=createOGO(200).lineStyle("#5555FF").lineWidth(2).line(.2,0,0,.4).mirror(!0,!1).echo(10,0,-.4,0,0,0,0,.2,1,.5,1).echo(5,0,0,0,0,0,0,2,1,.1,1).makeSprite("throb2",15,2),sprites.bbullet=createOGO(100).lineStyle("#AAF").lineWidth(2).circle(.1,0,.2).echo(10,0,-.1,0,-.15,0,45,.2,1,.5,1).rotSym(3).makeSprite("roll",8,2),sprites.blueBoss=createOGO(200).lineStyle("#0000ff").lineWidth(2).lineGrad("#FFF","#00F").line(0,0,.15,.3).line(0,0,.3,.3).line(0,0,.3,.15).line(.15,.3,.3,.3).line(.3,.3,.3,.15).echo(20,-.2,-.2,0,0,0,-70,1,1,0,.5).rotSym(3).makeSprite("roll120",25,2,8),sprites.blueboss2=createOGO(300).lineGrad("#00F","#F08").lineWidth(3).line(.2,0,0,.4).mirror(!0,!1).echo(10,0,-.4,0,0,0,0,.2,1,.5,1).echo(5,0,-.1,0,0,0,0,2,1,.1,1).makeSprite("throb",80,2,40),sprites.red1=createOGO(200).lineGrad("#F00","#505").lineWidth(3).line(0,0,.15,.3).line(0,0,.3,.15).line(.15,.3,.3,.3).line(.3,.3,.3,.15).echo(10,-.4,.2,-.4,-.5,0,0,1.2,1,0,.8).rotSym(4).makeSprite("roll90",9,2),sprites.red2=createOGO(200).lineGrad("#F88","#F00").lineWidth(2).line(0,0,.15,.3).line(0,0,.3,.15).line(.15,.3,.3,.3).line(.3,.3,.3,.15).echo(30,-.2,-.2,0,0,0,25,1,1,0,.2).rotSym(3).mirror(!1,!0).makeSprite("rock",15,2),sprites.rbullet=createOGO(50).lineStyle("#F00").lineWidth(10).circle(.3,0,.05).lineStyle("#F8A").circle(.1,0,.01).echo(10,0,0,0,0,90,0,.5,1,.1,.5).rotSym(3).makeSprite("roll",6,2)}function positionBoard(){var a=window.innerWidth,b=window.innerHeight;1.5*a>b?a=b/1.5:b=1.5*a,board.fx=a/100,board.style.left=(window.innerWidth-a)/2+"px",board.style.top=(window.innerHeight-b)/2+"px",board.style.width=a+"px",board.style.height=b+"px"}function attachBoardHandlers(){function a(a){var b,c;a.touches?(b=a.touches[0].pageX,c=a.touches[0].pageY):a.pageX||a.pageY?(b=a.pageX,c=a.pageY):(b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c=a.clientY+document.body.scrollTop+document.documentElement.scrollTop),b-=board.offsetLeft,c-=board.offsetTop,board.control_x=b/board.fx,board.control_y=c/board.fx}function b(a,b){board.keyList[a]=b}function c(b){board.control_active=!0,a(b),b.preventDefault()}function d(a){board.control_active=!1,a.preventDefault()}function e(a){board.control_active=!1,a.preventDefault()}function f(b){board.control_active&&a(b),b.preventDefault()}board.keyList=[],board.addEventListener("touchstart",c,!1),board.addEventListener("touchend",d,!1),board.addEventListener("touchcancel",e,!1),board.addEventListener("touchmove",f,!1),board.addEventListener("mousedown",c,!1),board.addEventListener("mouseup",d,!1),board.addEventListener("mouseout",e,!1),board.addEventListener("mousemove",f,!1),board.onkeydown=function(a){return b(a.keyCode,1),a.preventDefault(),!1},board.onkeyup=function(a){return b(a.keyCode,0),a.preventDefault(),!1}}function position(a){void 0!==a.x&&(a.style.transform="translate3D("+a.x*board.fx+"px,"+a.y*board.fx+"px,0)")}function avatarKilled(){board.glitch=!0,board.classList.add("glitch"),setTimeout(function(){var a=document.createElement("div");a.classList.add("glitchtext"),a.innerHTML="[[[[Invalid System State]]]]",board.appendChild(a)},500),setTimeout(function(){var a=document.createElement("div");a.classList.add("glitchtext"),a.innerHTML="...game loop failed....",board.appendChild(a)},1e3),setTimeout(function(){var a=document.createElement("div");a.classList.add("glitchtext"),a.innerHTML="---- Restoring last Stable State ----",board.appendChild(a)},1500),setTimeout(function(){board.shadows.push(board.shadowRec),board.glitch=!1,board.classList.remove("glitch"),resetSection()},2500)}function resetSection(){board.innerHTML="",board.gameTime=board.sectionStartTime,board.focus(),addOb(sprites.avatar,followControllerAction(),avatarFireAction());for(var a=0;a<board.shadows.length;a+=1)addOb(sprites.ghost,ghostFollowAction(board.shadows[a]),ghostFireAction(board.shadows[a]));initSection()}function initSection(){board.shadowRec=[],board.levelContent[board.levelPos](),board.sectionStartTime=board.gameTime}function startZone(a){board.classList.toggle("active",!0),meta.classList.toggle("hide",!0),board.timer.classList.toggle("active",!0),board.levelContent=zones[a],board.zoneID=a,board.levelPos=0,board.scoreTime=0,board.sectionStartTime=0,board.shadows=[],board.active=!0,board.lastZoneIndex=a,resetSection()}function endZone(){board.active=!1,board.classList.toggle("active",!1),board.timer.classList.toggle("active",!1),meta.classList.toggle("hide",!1),localStorage.setItem("last_z"+board.zoneID,board.scoreTime);var a=Number(localStorage.getItem("best_z"+board.zoneID));(!a||a>board.scoreTime)&&localStorage.setItem("best_z"+board.zoneID,board.scoreTime),updateLevSel()}function updateLSZone(a){var b=document.getElementById("z"+a);b.style.backgroundImage="url("+sprites["zone"+a].imgData+")",a==board.lastZoneIndex?(b.classList.toggle("sel",!0),b.onclick=function(){}):(b.classList.toggle("sel",!1),b.onclick=function(){board.lastZoneIndex=a,updateLevSel()}),document.getElementById("zgo"+a).onclick=function(b){return startZone(a),!1},document.getElementById("zex"+a).onclick=function(a){return a.stopPropagation(),board.lastZoneIndex=-1,updateLevSel(),!1};var c=localStorage.getItem("last_z"+a);c=c?(c/1e3).toFixed(1):" - ",document.getElementById("zlt"+a).innerHTML=c;var d=localStorage.getItem("best_z"+a);d=d?(d/1e3).toFixed(1):" - ",document.getElementById("zbt"+a).innerHTML=d}function updateLevSel(){updateLSZone(0),updateLSZone(1),updateLSZone(2)}function setUp(){prepSprites(),updateLevSel(),document.getElementById("logo").style.backgroundImage="url("+sprites.logo.imgData+")",board.timer=document.getElementById("timer"),positionBoard(),attachBoardHandlers(),window.onresize=positionBoard,game()}function programOb(a,b,c){a.eachFrame=b,a.fire=c,a.createTime=board.gameTime}function addOb(a,b,c){var d=document.createElement("div");return d.classList.add("boardobject"),d.rad=a.size/2,d.coltype=a.coltype,d.health=a.health,d.style.width=2*d.rad*board.fx+"px",d.style.height=2*d.rad*board.fx+"px",d.style.left=-d.rad*board.fx+"px",d.style.top=-d.rad*board.fx+"px",programOb(d,b,c),d.x=d.y=-1e4,d.display=document.createElement("div"),d.display.classList.add(a.displayCls),d.display.style.backgroundImage="url("+a.imgData+")",d.appendChild(d.display),board.appendChild(d),d}function testCollision(a,b){var c=.9*Math.pow(a.rad+b.rad,2),d=Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2);return d<c}function checkKills(a){for(var b=[],c=board.children,d=0;d<c.length;d+=1)1==c[d].coltype&&c[d].y<10&&c[d].y>-1e4?b.push(c[d]):1!=c[d].coltype&&c[d].y>180?b.push(c[d]):c[d].isDead&&c[d].removeTime<board.gameTime&&b.push(c[d]);for(var d=0;d<b.length;d+=1)if(board.removeChild(b[d]),b[d]===board.avatar){avatarKilled();break}}function hitOb(a){a.health?a.health-=1:killOb(a)}function killOb(a){a.isDead=!0,a.classList.add("die"),a.removeTime=board.gameTime+500}function testCollisions(){var a=board.children;board.enemyCount=0;for(var b=0;b<a.length;b+=1)if(a[b].coltype>=2&&(board.enemyCount+=1),1==a[b].coltype&&!a[b].isDead)for(var c=0;c<a.length;c+=1)if(2==a[c].coltype&&!a[c].isDead&&testCollision(a[b],a[c])){hitOb(a[b]),hitOb(a[c]);break}}function game(){var a=0,c=0,d=250,e=250,f=function(b){window.requestAnimationFrame(f);var g=10;if(a&&(g=b-a),g>100&&(g=100),a=b,board.active){board.gameTime+=g,board.scoreTime+=g,board.glitch&&(board.gameTime+=g*(10*Math.random()-7));for(var h=0;h<board.children.length;h+=1){var i=board.children[h];i.eachFrame&&i.eachFrame(board.gameTime-i.createTime,g),position(i)}if(testCollisions(),board.gameTime>=e){for(var h=0;h<board.children.length;h+=1){var i=board.children[h];i.isDead||(i.fire&&i.fire(board.gameTime-i.createTime,c),c+=1)}if(0==board.enemyCount){if(board.levelPos+=1,board.levelPos>=board.levelContent.length)return void endZone();board.shadows=[],initSection()}}checkKills(),e=step(board.gameTime,d)+d,board.timer.innerHTML=(board.scoreTime/1e3).toFixed(1)+"s"}};window.requestAnimationFrame(f)}function weaveBlock(a,b,c,d,e,f,g,h,i){for(var j=0;j<b;j+=1)for(var k=0;k<c;k+=1)addOb(a,weaveAction(100*j,d+a.size*k,-f-a.size*j,e,g,i),regularFireAction(j+k,h,sprites.greenBullet,50))}function wiggleBlock(a,b,c,d,e,f,g,h,i){for(var j=0;j<b;j+=1)for(var k=0;k<c;k+=1)addOb(a,wiggleAction(100*j,d+a.size*k,-f-a.size*j,e,g,i),regularFireAction(j+k,h,sprites.greenBullet,70))}function weaveTrail(a,b,c,d,e,f,g,h,i){for(var j=0;j<b;j+=1)addOb(a,weaveAction(j*h,c,-e,d,f,i),regularFireAction(j,g,sprites.greenBullet,50))}function wiggleTrail(a,b,c,d,e,f,g,h,i){for(var j=0;j<b;j+=1)addOb(a,wiggleAction(j*h,c,-e,d,f,i),regularFireAction(j,g,sprites.greenBullet,70))}function finalSection(a){for(i=0;i<10;i+=1)addOb(a,bulletAction(30+40*Math.random(),40*-Math.random(),1.57,20+40*Math.random()));addOb(sprites.levcomplete,bulletAction(50,-50,1.57,30))}function incoming(){for(i=0;i<5;i+=1)addOb(sprites.incoming,bulletAction(30+40*Math.random(),40*-Math.random(),1.57,50+40*Math.random()))}function sqBlock(a,b,c,d,e,f,g,h,i,j,k){k||(k=0);for(var l=0;l<b;l+=1)for(var m=0;m<c;m+=1)addOb(a,sqAction((l+m)*k,d+a.size*m,-f-a.size*l,e,g,h,j),regularFireAngleAction(l+m,i,sprites.bbullet,50,20))}function sqTrail(a,b,c,d,e,f,g,h,i,j){for(var k=0;k<b;k+=1)addOb(a,sqAction(i*k,c,-e,d,f,g,j),regularFireAngleAction(k,h,sprites.bbullet,50,20))}function sqDBlock(a,b,c,d,e,f,g,h,i,j,k){k||(k=0);for(var l=0;l<b;l+=1)for(var m=0;m<c;m+=1)addOb(a,sqAction((l+m)*k,d+a.size*m,-f-a.size*l,e,g,h,j),diveBombAction(l+m,i,90))}function blueBossLine(a,b,c){for(var d=0;d<a;d+=1)addOb(sprites.blueBoss,wiggleAction(500*d,10,10-c,80,10,2e3),xZoneFireAction(20,0,b,sprites.bbullet,40))}function dropReleaseFireAction(a){return function(b,c){c%a||sqDBlock(sprites.geo4,2,2,this.x-10,10,-this.y-10,10,10,5,500)}}function sqRedBlock(a,b,c,d,e,f,g,h,i,j,k){k||(k=0);for(var l=0;l<b;l+=1)for(var m=0;m<c;m+=1)addOb(a,sqAction((l+m)*k,d+a.size*m,-f-a.size*l,e,g,h,j),dualFireAngleAction(l+m,i,sprites.rbullet,50,30))}function wiggleRedTrail(a,b,c,d,e,f,g,h,i){for(var j=0;j<b;j+=1)addOb(a,wiggleAction(j*h,c,-e,d,f,i),dualFireAngleAction(j,g,sprites.rbullet,70,30))}var OGO={line:function(a,b,c,d){return this.ctx.beginPath(),this.ctx.moveTo(a,b),this.ctx.lineTo(c,d),this.ctx.stroke(),this},circle:function(a,b,c){return this.ctx.beginPath(),this.ctx.arc(a,b,c,0,2*Math.PI,!1),this.ctx.stroke(),this},lineStyle:function(a){return this.ctx.strokeStyle=a,this},fillStyle:function(a){return this.ctx.fillStyle=a,this},lineGrad:function(a,b){return this.ctx.strokeStyle=cgrad(this.ctx,.5,a,b),this},fillGrad:function(a,b){return this.ctx.fillStyle=cgrad(this.ctx,15,a,b),this},lineWidth:function(a){return this.ctx.lineWidth=a/100,this},text:function(a,b,c,d,e){return this.ctx.save(),this.ctx.lineWidth=d/5,this.ctx.translate(-b,-c),this.ctx.scale(.01*d,.01*d),this.ctx.font="10px sans-serif",e?this.ctx.fillText(a,0,0):this.ctx.strokeText(a,0,0),this.ctx.restore(),this},setBackground:function(a){var b=document.getElementById(a),c=this.canvas.toDataURL();return b.style.backgroundImage="url("+c+")",this},setElementBackground:function(a){var b=this.canvas.toDataURL();return a.style.backgroundImage="url("+b+")",this},echo:function(a,b,c,d,e,f,g,h,i,j,k){for(var l=createOGO(this.res),m=0;m<a;m+=1){var n=m/a,o=1-n;l.ctx.save(),l.ctx.rotate((f*o+g*n)*Math.PI/180),l.ctx.translate(b*o+d*n,c*o+e*n),l.ctx.scale(h*o+i*n,h*o+i*n),l.ctx.globalAlpha=j*o+k*n,l.ctx.drawImage(this.canvas,-.5,-.5,1,1),l.ctx.restore()}return l},rotSym:function(a){return this.echo(a,0,0,0,0,0,360,1,1,1,1)},mirror:function(a,b){var c=createOGO(this.res);return c.ctx.drawImage(this.canvas,-.5,-.5,1,1),c.ctx.scale(a?-1:1,b?-1:1),c.ctx.drawImage(this.canvas,-.5,-.5,1,1),c},addDivSample:function(a){var b=document.createElement("div");return b.classList.add(a),b.classList.add("ttype"),this.setElementBackground(b),document.body.appendChild(b),this},makeSprite:function(a,b,c,d){return this.addDivSample(a),d||(d=0),{size:b,coltype:c,health:d,displayCls:a,imgData:this.canvas.toDataURL()}}},sprites={},board=document.getElementById("board"),meta=document.getElementById("levsel");board.lastZoneIndex=-1,setUp();var zoneA=[function(){addOb(sprites.tuttouch,bulletAction(50,0,1.57,20))},function(){incoming(),weaveBlock(sprites.grunt1,4,4,10,30,0,15,70,1e3)},function(){weaveTrail(sprites.grunt2,15,5,90,0,10,40,150,2e3),weaveTrail(sprites.grunt2,15,95,-90,40,10,40,150,2e3)},function(){weaveBlock(sprites.grunt1,4,8,1,30,0,10,50,1500)},function(){wiggleBlock(sprites.flow1,1,5,40,-30,0,30,40,2e3),wiggleBlock(sprites.flow1,1,5,10,30,15,30,40,2e3),wiggleBlock(sprites.flow1,1,5,40,-30,30,30,40,2e3),wiggleBlock(sprites.flow1,1,5,10,30,45,30,40,2e3)},function(){weaveTrail(sprites.grunt2,20,20,20,0,10,60,250,800),weaveTrail(sprites.grunt2,20,60,20,20,10,60,250,800)},function(){wiggleTrail(sprites.flow2,20,10,80,0,30,50,400,2e3)},function(){weaveTrail(sprites.grunt2,20,5,55,10,30,50,300,3e3),weaveTrail(sprites.grunt2,20,95,-55,20,30,50,300,3e3)},function(){weaveTrail(sprites.grunt2,10,5,40,10,20,60,250,2e3),weaveTrail(sprites.grunt2,10,95,-40,30,20,60,250,2e3),-weaveTrail(sprites.grunt2,30,10,80,60,20,60,250,1800)},function(){wiggleBlock(sprites.flow1,8,1,10,50,0,30,100,800),wiggleBlock(sprites.flow1,8,1,70,-50,50,30,100,1500),wiggleBlock(sprites.flow1,8,2,20,60,100,30,100,1e3)},function(){wiggleTrail(sprites.flow2,20,10,80,0,30,60,100,2e3)},function(){wiggleBlock(sprites.flow1,5,2,10,50,0,40,100,1e3),wiggleBlock(sprites.flow1,5,2,60,-50,0,40,100,1e3),wiggleBlock(sprites.flow1,5,2,30,60,50,45,100,1e3)},function(){for(var a=0;a<6;a+=1)weaveBlock(sprites.grunt1,2,2,a%3*25+5,30,20*a,20,50,1e3)},function(){wiggleTrail(sprites.flow2,20,90,-80,0,30,50,400,2e3),wiggleTrail(sprites.flow2,20,10,80,0,30,50,400,2e3)},function(){wiggleTrail(sprites.flow2,50,10,80,0,30,60,100,2e3)},function(){wiggleTrail(sprites.flow2,20,90,-80,0,30,30,200,2e3),wiggleTrail(sprites.flow2,20,10,80,0,30,30,200,2e3)},function(){addOb(sprites.boss1,wiggleAction(0,10,10,80,10,3e3),xZoneFireAction(20,0,1,sprites.bigGreenBullet,40)),wiggleTrail(sprites.flow2,20,10,30,100,30,100,200,2e3),weaveBlock(sprites.grunt1,3,3,45,30,50,20,50,1e3)},function(){finalSection(sprites.zone0)}],zoneB=[function(){incoming(),sqBlock(sprites.geo1,4,8,10,10,0,10,10,50,1500)},function(){sqTrail(sprites.geo3,60,5,90,0,30,20,100,100,6e3)},function(){sqBlock(sprites.geo2,3,3,5,60,20,30,20,20,2e3)},function(){sqTrail(sprites.geo3,15,5,40,0,20,40,100,250,2e3),sqTrail(sprites.geo3,15,95,-40,0,20,40,80,250,2e3)},function(){sqTrail(sprites.geo3,30,5,90,0,30,20,20,50,5e3)},function(){sqDBlock(sprites.geo4,6,4,5,40,0,40,20,50,5e3,100),sqDBlock(sprites.geo4,6,4,5,40,0,40,20,50,4e3,100)},function(){sqBlock(sprites.geo2,6,4,5,60,0,40,40,50,5e3)},function(){sqBlock(sprites.geo2,2,5,5,40,0,40,40,50,5e3),sqBlock(sprites.geo1,2,5,5,55,25,40,40,50,5e3),sqBlock(sprites.geo2,2,5,5,40,50,40,40,50,5e3)},function(){sqBlock(sprites.geo2,6,4,5,60,0,40,40,50,5e3)},function(){sqDBlock(sprites.geo4,4,4,5,40,0,40,20,20,2e3,120)},function(){sqBlock(sprites.geo2,2,2,5,25,0,30,30,20,3e3),sqBlock(sprites.geo2,2,2,80,-25,0,30,30,20,3e3),sqBlock(sprites.geo2,2,2,30,35,60,30,30,20,1500)},function(){wiggleBlock(sprites.flow1,8,1,10,50,50,30,100,800),wiggleBlock(sprites.flow1,8,2,30,50,150,30,100,800),blueBossLine(2,2,0)},function(){addOb(sprites.boss1,wiggleAction(0,10,10,80,5,3e3),xZoneFireAction(20,0,2,sprites.bigGreenBullet,40)),addOb(sprites.boss1,wiggleAction(1500,10,10,80,5,3e3),xZoneFireAction(20,1,2,sprites.bigGreenBullet,40)),sqBlock(sprites.geo1,3,4,5,25,50,10,20,50,2e3,50),sqTrail(sprites.geo3,15,55,20,0,30,20,60,50,1500)},function(){wiggleTrail(sprites.flow2,15,10,80,30,30,200,100,3e3),wiggleTrail(sprites.flow2,15,90,-80,60,30,200,100,3e3),sqBlock(sprites.geo1,3,4,5,25,0,10,20,50,2e3,50),sqBlock(sprites.geo1,3,4,60,-25,15,10,20,50,2e3,50)},function(){blueBossLine(5,5,0),sqDBlock(sprites.geo4,6,6,5,40,50,40,20,80,4e3,100),blueBossLine(5,5,50)},function(){addOb(sprites.blueboss2,wiggleAction(0,30,0,40,5,2e3),dropReleaseFireAction(5))},function(){finalSection(sprites.zone1)}],zoneC=[function(){incoming(),sqRedBlock(sprites.red1,4,8,10,10,0,10,10,50,1e3)},function(){wiggleRedTrail(sprites.red2,30,10,60,0,60,50,200,3e3)},function(){sqRedBlock(sprites.red1,2,2,5,25,0,30,30,30,3e3,100),sqRedBlock(sprites.red1,2,2,80,-25,0,30,30,30,3e3,100),sqRedBlock(sprites.red1,3,3,30,35,60,30,30,30,2e3,100),sqTrail(sprites.geo3,30,20,60,0,30,40,50,100,5e3)},function(){wiggleRedTrail(sprites.red2,10,10,60,0,60,50,300,3e3),wiggleRedTrail(sprites.red2,10,90,-60,0,60,50,300,4e3),wiggleBlock(sprites.flow1,8,1,10,50,0,30,70,800),wiggleBlock(sprites.flow1,8,1,70,-50,50,30,70,1e3)},function(){sqRedBlock(sprites.red1,3,7,5,40,80,40,40,50,5e3),sqBlock(sprites.geo2,2,5,5,40,50,40,40,50,5e3),sqDBlock(sprites.geo4,6,4,5,40,0,40,20,20,5e3,100)},function(){addOb(sprites.blueboss2,wiggleAction(0,30,0,40,5,2e3),dropReleaseFireAction(15)),blueBossLine(5,10,0),wiggleRedTrail(sprites.red2,10,90,-60,0,60,50,300,1e3),sqBlock(sprites.geo2,2,5,5,40,0,30,30,50,5e3)},function(){finalSection(sprites.zone2)}],zones=[zoneA,zoneB,zoneC];