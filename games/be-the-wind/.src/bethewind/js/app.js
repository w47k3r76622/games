function DirectWindManager(){function t(t){var e=new DirectWind(t.div(app.size.diff));this.activeWind=e,this.winds.push(e)}function e(t){this.activeWind!==!1&&(t.div(app.size.diff).sub(this.activeWind.position),this.activeWind.updateDirection(t))}function i(){this.activeWind!==!1&&(this.activeWind.apply(),this.activeWind=!1)}this.winds=[],this.activeWind=!1,app.canvas.addEventListener("touchstart",function(e){t.call(this,new Vector(e.touches[0].clientX-e.target.offsetParent.offsetLeft,e.touches[0].clientY-e.target.offsetParent.offsetTop))}.bind(this)),app.canvas.addEventListener("touchmove",function(t){e.call(this,new Vector(t.touches[0].clientX-t.target.offsetParent.offsetLeft,t.touches[0].clientY-t.target.offsetParent.offsetTop))}.bind(this)),document.addEventListener("touchend",function(){i.call(this)}.bind(this)),app.canvas.addEventListener("mousedown",function(e){0==e.button&&t.call(this,new Vector(e.clientX-e.target.offsetParent.offsetLeft,e.clientY-e.target.offsetParent.offsetTop))}.bind(this)),app.canvas.addEventListener("mousemove",function(t){e.call(this,new Vector(t.clientX-t.target.offsetParent.offsetLeft,t.clientY-t.target.offsetParent.offsetTop))}.bind(this)),document.addEventListener("mouseup",function(){i.call(this)}.bind(this))}function DirectWind(t){this.direction=new Vector(0,0),this.slowDown=1,this.position=t,this.power=0,this.angle=1,this.directionAngle=1,this.isActive=!0,this.inMove=!0}function Gravity(){app.gravity=new Vector(0,.1)}function Hole(){this.position=new Vector(60,300),this.power=50,this.isFull=!1,this.win=!0,this.inside={},this.holeParticles=new HoleParticles}function HoleParticle(){var t=2*Math.PI*Math.random();this.isActive=!0,this.position=new Vector(app.hole.position.x+app.hole.power*Math.cos(t),app.hole.position.y+app.hole.power*Math.sin(t)),this.velocity=new Vector(0,0),this.acceleration=new Vector(0,0)}function HoleParticles(){this.amount=30,this.particles=[]}function Leaf(t,e,i,n){this.isActive=!0,this.type=t,this.timeOut=parseInt(e*Math.random()*1e3),this.startTime=(new Date).getTime(),this.description=app.leaves[this.type],this.livingTime="undefined"!=typeof i?i:this.description.livingTime,this.mass=this.description.weight+.05*Math.random(),n?(this.timeOut=0,this.position=new Vector(25+parseInt(281*Math.random()),420+parseInt(41*Math.random()))):this.position=new Vector(25+parseInt(281*Math.random()),15+parseInt(41*Math.random())),this.velocity=new Vector(0,0),this.acceleration=new Vector(0,0),this.angle=0,this.aVelocity=0,this.aAcceleration=1e-5-2*Math.random()/1e5}function LeafParticle(t){this.isActive=!0,this.mass=.1+.05*Math.random(),this.position=t.get(),this.velocity=new Vector(.3*Math.cos(2*Math.PI*Math.random()),.3*Math.sin(2*Math.PI*Math.random())),this.acceleration=new Vector(0,0),this.startTime=(new Date).getTime(),this.livingTime=5e3}function LeafParticles(t){var e;for(this.amount=50,this.particles=[],this.isActive=!0,e=0;e<this.amount;e++)this.particles.push(new LeafParticle(t))}function Leaves(){}function Levels(){this.maxIndex=-1,this.currentIndex=-1}function DeadLeaves(){this.deadLeaves=[]}function StarFall(){}function Scene(){this.tree=new Tree,this.mouse=new Vector(0,0),this.paralax=new Vector(0,0),app.canvas.addEventListener("mousemove",function(t){this.mouse.apply(new Vector(t.clientX-t.target.offsetParent.offsetLeft,t.clientY-t.target.offsetParent.offsetTop)),this.paralax.x=10-20*(this.mouse.x/app.size.x),this.paralax.y=10-20*(this.mouse.y/app.size.y)}.bind(this))}function Tree(){this.leaves=[],this.deadLeaves=[],this.isFinished=!0}function LevelMenu(){this.currentLevel=app.levelsManager.getConfig()}function Menu(){function t(t){var e;if(0==this.currentMenuType)i(t,new Vector(160,320))&&(app.scene.tree.new(!0),this.currentMenuType=-1,app.canvas.style.cursor="default");else if(1==this.currentMenuType)i(t,new Vector(160,240))?(this.currentMenuType=2,app.canvas.style.cursor="default"):i(t,new Vector(160,330))&&(app.scene.tree.new(!1),this.currentMenuType=-1,app.canvas.style.cursor="default");else if(2==this.currentMenuType)for(e=0;e<=app.levelsManager.maxIndex;e++)i(t,new Vector(90+50*(e%4),200+50*parseInt(e/4)),new Vector(30,30))&&(app.scene.tree.new(!0,e),this.currentMenuType=-1,app.canvas.style.cursor="default");else 3==this.currentMenuType?i(t,new Vector(160,240))?(this.currentMenuType=2,app.canvas.style.cursor="default"):i(t,new Vector(160,330))&&(app.scene.tree.new(!0),this.currentMenuType=-1,app.canvas.style.cursor="default"):4==this.currentMenuType?i(t,new Vector(160,240))?(this.currentMenuType=2,app.canvas.style.cursor="default"):i(t,new Vector(160,330))&&(app.scene.tree.new(!1),this.currentMenuType=-1,app.canvas.style.cursor="default"):5==this.currentMenuType&&i(t,new Vector(160,320))&&(this.currentMenuType=2,app.canvas.style.cursor="default")}function e(t){var e;if(this.currentMenuType!=-1)if(0==this.currentMenuType||5==this.currentMenuType)i(t,new Vector(160,320))?(this.buttonScale[0]=.9,app.canvas.style.cursor="pointer"):(this.buttonScale[0]=.8,app.canvas.style.cursor="default");else if(2==this.currentMenuType)for(this.hoverLevelButtonIndex=-1,app.canvas.style.cursor="default",e=0;e<=app.levelsManager.maxIndex;e++)i(t,new Vector(90+50*(e%4),200+50*parseInt(e/4,10)),new Vector(30,30))&&(this.hoverLevelButtonIndex=e,app.canvas.style.cursor="pointer");else i(t,new Vector(160,240))?(this.buttonScale[0]=.9,app.canvas.style.cursor="pointer"):i(t,new Vector(160,330))?(this.buttonScale[1]=.9,app.canvas.style.cursor="pointer"):(this.buttonScale[0]=.8,this.buttonScale[1]=.8,app.canvas.style.cursor="default")}function i(t,e,i){var n=!1;return i="undefined"!=typeof i?i:new Vector(180,70),e.mult(app.size.diff),i.mult(app.size.diff),t.x>e.x-i.x/2&&t.x<e.x+i.x/2&&t.y>e.y-i.y/2&&t.y<e.y+i.y/2&&(n=!0),n}this.currentMenuType=-1,this.buttonScale=[.8,.8],this.hoverLevelButtonIndex=-1,app.canvas.addEventListener("touchstart",function(e){0==e.button&&t.call(this,new Vector(e.touches[0].clientX-e.target.offsetParent.offsetLeft,e.touches[0].clientY-e.target.offsetParent.offsetTop))}.bind(this)),app.canvas.addEventListener("touchmove",function(t){e.call(this,new Vector(t.touches[0].clientX-t.target.offsetParent.offsetLeft,t.touches[0].clientY-t.target.offsetParent.offsetTop))}.bind(this)),app.canvas.addEventListener("mousedown",function(e){0==e.button&&t.call(this,new Vector(e.clientX-e.target.offsetParent.offsetLeft,e.clientY-e.target.offsetParent.offsetTop))}.bind(this)),app.canvas.addEventListener("mousemove",function(t){e.call(this,new Vector(t.clientX-t.target.offsetParent.offsetLeft,t.clientY-t.target.offsetParent.offsetTop))}.bind(this))}function Vector(t,e){this.x=t,this.y=e}function Wind(){app.wind=new Vector(.005-.01*Math.random(),.001-.002*Math.random())}!function(){function t(){o=new Gravity,app.windManager=new Wind,app.directWindManager=new DirectWindManager,app.hole=new Hole,app.deadLeaves=new DeadLeaves,app.levelsManager=new Levels,app.leavesManager=new Leaves,app.levelMenu=new LevelMenu,app.menu=new Menu,app.scene=new Scene,app.menu.showMenu(0),i()}function e(){var t=window.innerHeight/480,e=window.innerWidth/320;t<e?(app.size.diff=window.innerHeight/480,app.size.y=window.innerHeight,app.size.x=window.innerHeight*(320/480)):(app.size.diff=window.innerWidth/320,app.size.y=1.5*window.innerWidth,app.size.x=window.innerWidth),s.setAttribute("width",app.size.x+"px"),s.setAttribute("height",app.size.y+"px"),appOut.scale(app.size.diff,app.size.diff)}function i(){n(),a(),window.requestAnimationFrame(arguments.callee)}function n(){app.scene.update(),app.windManager.update(),app.hole.update(),app.directWindManager.update(),app.deadLeaves.update()}function a(){app.scene.render(),app.hole.render(),app.directWindManager.render(),app.deadLeaves.render(),app.levelMenu.render(),app.menu.render()}var o,s=document.getElementById("app");app.canvas=s,app.size={x:480,y:320,diff:1},window.appOut=s.getContext("2d"),window.onload=t,window.onresize=e,e()}(),DirectWindManager.prototype={apply:function(t){var e=new Vector(0,0);return this.winds.forEach(function(i){e.add(i.getAcceleration(t))}),e},update:function(){var t=[];this.winds.forEach(function(e){e.update(),e.isActive||t.push(e)}.bind(this)),t.forEach(function(t){var e=this.winds.indexOf(t);e!==-1&&this.winds.splice(e,1)}.bind(this))},render:function(){this.winds.forEach(function(t){t.render()})}},DirectWind.prototype={update:function(){this.inMove||(this.power-=this.slowDown,this.power<=0&&(this.isActive=!1))},updateDirection:function(t){this.power=t.mag(),this.direction.apply(t.normalize()),this.directionAngle=this.direction.angle()},apply:function(){this.inMove=!1,this.start=(new Date).getTime()},getAcceleration:function(t){var e,i,n,a=t.distance(this.position),o=new Vector(0,0);return a<2*this.power&&(i=this.position.angle(t),this.directionAngle-this.angle/2<i&&this.directionAngle+this.angle/2>i&&(n=(1-a/(2*this.power))/12,e=new Vector(n*Math.cos(i),n*Math.sin(i)),o.add(e))),o},render:function(){appOut.save(),appOut.beginPath(),appOut.arc(this.position.x,this.position.y,3,0,2*Math.PI),appOut.fillStyle="rgba(0, 0, 0, 0.05)",appOut.fill(),appOut.beginPath(),appOut.arc(this.position.x,this.position.y,this.power,this.directionAngle-this.angle/2,this.directionAngle+this.angle/2),appOut.fillStyle="rgba(0, 0, 0, 0.05)",appOut.fill(),appOut.closePath(),appOut.restore()}},Gravity.prototype={update:function(){}},Hole.prototype={reset:function(){this.isFull=!1,this.win=!0,this.inside={}},apply:function(t){var e,i,n,a=t.distance(this.position),o=new Vector(0,0);return a<this.power&&(i=this.position.angle(t),n=(1-a/this.power)/1.2,e=new Vector(-n*Math.cos(i),-n*Math.sin(i)),o.add(e)),o},checkFull:function(){var t=!1,e=app.levelsManager.getConfig();e.goals.forEach(function(e){0==e.amount?this.inside[e.type]&&(this.win=!1,this.isFull=!0):this.inside[e.type]?this.inside[e.type]<e.amount?t=!0:this.inside[e.type]>e.amount&&(this.win=!1,this.isFull=!0):t=!0}.bind(this)),t||(this.isFull=!0)},isInside:function(t,e){var i=t.distance(this.position),n=!1;return!this.isFull&&i<this.power/5&&("undefined"==typeof this.inside[e]&&(this.inside[e]=0),this.inside[e]++,n=!0,this.checkFull()),n},update:function(){this.holeParticles.update()},render:function(){this.holeParticles.render()}},HoleParticle.prototype={check:function(){this.position.distance(app.hole.position)<=10&&(this.isActive=!1)},force:function(){var t=app.hole.position.get().sub(this.position);return t.div(200),t},update:function(){this.acceleration.add(this.force()),this.acceleration.add(this.force().get().perpendicular().div(4)),this.velocity.add(this.acceleration),this.position.add(this.velocity),this.acceleration.mult(0),this.check()},render:function(){appOut.save(),appOut.beginPath(),appOut.arc(this.position.x,this.position.y,2,0,2*Math.PI),appOut.fillStyle="rgba(0, 0, 0, 0.1)",appOut.fill(),appOut.closePath(),appOut.restore()}},HoleParticles.prototype={add:function(){this.particles.push(new HoleParticle)},checkToAdd:function(){this.particles.length<this.amount&&this.add()},update:function(){var t=[];this.particles.forEach(function(e){e.update(),e.isActive||t.push(e)}.bind(this)),t.forEach(function(t){var e=this.particles.indexOf(t);e!==-1&&this.particles.splice(e,1)}.bind(this)),this.checkToAdd()},render:function(){this.particles.forEach(function(t){t.isActive&&t.render()})}},Leaf.prototype={check:function(){this.position.y>450?(this.position.y=450,this.velocity.y*=-.2):this.position.y<10&&(this.position.y=10,this.velocity.y*=-.2),this.position.x>300?(this.position.x=300,this.velocity.x*=-.2):this.position.x<20&&(this.position.x=20,this.velocity.x*=-.2)},checkToDie:function(){(new Date).getTime()-this.startTime>=this.livingTime&&(this.isActive=!1,app.deadLeaves.add(this.position))},calculateAirFriction:function(){var t=this.velocity.mag(),e=.1*Math.pow(t,2)*this.mass,i=this.velocity.get();return i.mult(-1),i.normalize(),i.mult(e),i},calculateFriction:function(){var t=.01,e=1,i=t*e,n=this.velocity.get();return n.mult(-1),n.normalize(),n.mult(i),n},update:function(t){var e,i;app.hole.isInside(this.position,this.type)&&(this.isActive=!1),i=this.collisionDetection(t),this.timeOut!==!1&&(new Date).getTime()-this.startTime>=this.timeOut&&(this.timeOut=!1,this.startTime=(new Date).getTime()),this.isActive&&this.timeOut===!1&&(e=this.calculateFriction(),this.acceleration.add(e),this.acceleration.add(app.gravity.get().mult(this.mass)),this.acceleration.add(app.wind),this.acceleration.add(app.directWindManager.apply(this.position)),this.acceleration.add(app.hole.apply(this.position)),this.acceleration.add(i),this.velocity.add(this.acceleration),this.position.add(this.velocity),this.updateAngular(),this.acceleration.mult(0),this.check(),this.checkToDie())},calculateSecondaryPosition:function(){return new Vector(this.position.x+30*Math.cos(this.angle),this.position.y+30*Math.sin(this.angle))},updateAngular:function(){this.acceleration.mag()>.2&&(this.aVelocity=0),this.aVelocity+=this.aAcceleration,this.velocity.mag()<.02&&(this.aVelocity=0),this.angle+=this.aVelocity},collisionDetection:function(t){var e=new Vector(0,0);return t.forEach(function(t){if(this!==t&&this.position.distance(t.position)<=10){var i=this.position.get();i.sub(t.position),i.normalize(),i.div(100),e.apply(i)}}.bind(this)),e},calculateColor:function(){var t=(new Date).getTime()-this.startTime,e=1-t/this.livingTime,i="hsl(120, 40%, 41%)";return this.timeOut===!1&&(i="hsl("+parseInt(120*e)+", 50%, 41%)"),i},render:function(){appOut.save(),appOut.translate(this.position.x,this.position.y),appOut.rotate(this.angle),appOut.scale(.17,.17),this.description.vertices.fill.forEach(function(t){this.renderFillLayout(t)}.bind(this)),this.description.vertices.fill.forEach(function(t){this.renderStrokeLayout(t)}.bind(this)),this.description.vertices.stroke.forEach(function(t){this.renderStrokeLayout(t)}.bind(this)),appOut.restore()},renderStrokeLayout:function(t){appOut.beginPath(),t.forEach(function(e,i){i?(appOut.lineTo(e.x-100,e.y-100),i==t.length-1&&appOut.lineTo(t[0].x-100,t[0].y-100)):appOut.moveTo(e.x-100,e.y-100)}.bind(this)),appOut.strokeStyle="black",appOut.stroke(),appOut.closePath()},renderFillLayout:function(t){appOut.beginPath(),t.forEach(function(t,e){e?appOut.lineTo(t.x-100,t.y-100):appOut.moveTo(t.x-100,t.y-100)}.bind(this)),appOut.fillStyle=this.calculateColor(),appOut.fill(),appOut.closePath()}},LeafParticle.prototype={check:function(){(new Date).getTime()-this.startTime>=this.livingTime&&(this.isActive=!1)},calculateFriction:function(){var t=.01,e=1,i=t*e,n=this.velocity.get();return n.mult(-1),n.normalize(),n.mult(i),n},update:function(){this.acceleration.add(this.calculateFriction()),this.acceleration.add(app.gravity.get().mult(this.mass)),this.acceleration.add(app.wind),this.acceleration.add(app.directWindManager.apply(this.position)),this.acceleration.add(app.hole.apply(this.position)),this.velocity.add(this.acceleration),this.position.add(this.velocity),this.acceleration.mult(0),this.check()},render:function(){var t=1-((new Date).getTime()-this.startTime)/this.livingTime;appOut.save(),appOut.beginPath(),appOut.arc(this.position.x,this.position.y,1,0,2*Math.PI),appOut.fillStyle="rgba(70, 0, 0, "+t+")",appOut.fill(),appOut.closePath(),appOut.restore()}},LeafParticles.prototype={checkToDie:function(){0==this.particles.length&&(this.isActive=!1)},update:function(){var t=[];this.particles.forEach(function(e){e.update(),e.isActive||t.push(e)}.bind(this)),t.forEach(function(t){var e=this.particles.indexOf(t);e!==-1&&this.particles.splice(e,1)}.bind(this)),this.checkToDie()},render:function(){this.particles.forEach(function(t){t.isActive&&t.render()})}},window.app=window.app||{},window.app.leaves=[{type:0,weight:.1,livingTime:2e4,vertices:{fill:[[{x:8,y:10},{x:57,y:49},{x:34,y:107},{x:51,y:154},{x:142,y:189},{x:158,y:114},{x:150,y:66},{x:65,y:46},{x:19,y:4}]],stroke:[[{x:62,y:50},{x:85,y:125},{x:137,y:179},{x:88,y:122}],[{x:74,y:111},{x:55,y:149}],[{x:88,y:109},{x:152,y:113}]]}},{type:1,weight:.105,livingTime:2e4,vertices:{fill:[[{x:18,y:11},{x:57,y:55},{x:10,y:47},{x:15,y:107},{x:72,y:133},{x:117,y:188},{x:156,y:97},{x:143,y:31},{x:62,y:51},{x:36,y:11}]],stroke:[[{x:60,y:54},{x:119,y:111},{x:115,y:175},{x:113,y:114}],[{x:152,y:99},{x:71,y:57}],[{x:75,y:133},{x:60,y:57}]]}},{type:2,weight:.11,livingTime:2e4,vertices:{fill:[[{x:7,y:7},{x:36,y:60},{x:45,y:120},{x:59,y:121},{x:86,y:173},{x:101,y:159},{x:140,y:188},{x:176,y:175},{x:174,y:121},{x:138,y:115},{x:135,y:82},{x:40,y:57},{x:22,y:6}]],stroke:[[{x:40,y:61},{x:114,y:139},{x:171,y:171},{x:118,y:137}],[{x:62,y:88},{x:99,y:157}],[{x:68,y:83},{x:136,y:114}]]}},{type:3,weight:.115,livingTime:2e4,vertices:{fill:[[{x:43,y:12},{x:96,y:51},{x:47,y:34},{x:14,y:65},{x:27,y:75},{x:9,y:132},{x:52,y:115},{x:82,y:188},{x:117,y:130},{x:161,y:156},{x:163,y:82},{x:186,y:64},{x:146,y:46},{x:99,y:48},{x:63,y:11}]],stroke:[[{x:97,y:52},{x:82,y:179}],[{x:91,y:56},{x:16,y:124}],[{x:102,y:54},{x:158,y:150}]]}},{type:4,weight:.117,livingTime:2e4,vertices:{fill:[[{x:40,y:9},{x:73,y:55},{x:69,y:81},{x:14,y:105},{x:10,y:144},{x:96,y:182},{x:101,y:134},{x:114,y:177},{x:184,y:120},{x:167,y:81},{x:108,y:70},{x:82,y:54},{x:50,y:6}]],stroke:[[{x:77,y:55},{x:100,y:131}],[{x:79,y:76},{x:48,y:157}],[{x:87,y:75},{x:150,y:142}]]}},{type:5,weight:.108,livingTime:2e4,vertices:{fill:[[{x:58,y:9},{x:81,y:58},{x:46,y:40},{x:37,y:52},{x:65,y:66},{x:23,y:73},{x:15,y:116},{x:45,y:124},{x:77,y:105},{x:57,y:160},{x:107,y:190},{x:129,y:140},{x:110,y:94},{x:133,y:115},{x:178,y:109},{x:151,y:60},{x:103,y:63},{x:125,y:38},{x:100,y:26},{x:86,y:51},{x:65,y:4}]],stroke:[[{x:84,y:53},{x:104,y:180}],[{x:83,y:67},{x:17,y:113}],[{x:90,y:70},{x:171,y:104}]]}},{type:6,weight:.12,livingTime:2e4,vertices:{fill:[[{x:4,y:5},{x:30,y:32},{x:60,y:114},{x:179,y:189},{x:167,y:130},{x:124,y:72},{x:35,y:30},{x:20,y:5}]],stroke:[[{x:34,y:34},{x:116,y:107},{x:174,y:181},{x:110,y:109}],[{x:92,y:82},{x:162,y:129}],[{x:72,y:73},{x:121,y:151}]]}}],Leaves.prototype={getLeaf:function(t){return app.leaves[t]}},window.app=window.app||{},window.app.levels=[{level:0,timeToFall:3,isDown:!1,leaves:[{type:0,amount:1,livingTime:3e4}],goals:[{type:0,amount:1}]},{level:1,timeToFall:3,isDown:!1,leaves:[{type:0,amount:4,livingTime:25e3}],goals:[{type:0,amount:2}]},{level:2,timeToFall:3,isDown:!1,leaves:[{type:0,amount:3},{type:1,amount:4}],goals:[{type:0,amount:2},{type:1,amount:2}]},{level:3,timeToFall:3,isDown:!1,leaves:[{type:1,amount:8,livingTime:3e4},{type:2,amount:1,livingTime:1e4}],goals:[{type:1,amount:4},{type:2,amount:1}]},{level:4,timeToFall:7,isDown:!1,leaves:[{type:3,amount:3,livingTime:2e3},{type:3,amount:1,livingTime:1e4}],goals:[{type:3,amount:1}]},{level:5,timeToFall:0,leaves:[{type:4,amount:1,isDown:!0,livingTime:8e3}],goals:[{type:4,amount:1}]},{level:6,timeToFall:1,isDown:!1,leaves:[{type:4,amount:1,isDown:!0,livingTime:1e4},{type:5,amount:5,livingTime:15e3}],goals:[{type:4,amount:1},{type:5,amount:4}]},{level:7,timeToFall:3,isDown:!1,leaves:[{type:4,amount:10},{type:6,amount:3}],goals:[{type:6,amount:3}]},{level:8,timeToFall:7,isDown:!1,leaves:[{type:2,amount:10,isDown:!0}],goals:[{type:2,amount:6}]},{level:9,timeToFall:3,isDown:!1,leaves:[{type:0,amount:10},{type:5,amount:5,isDown:!0},{type:6,amount:5,isDown:!0}],goals:[{type:0,amount:0},{type:5,amount:3},{type:6,amount:3}]},{level:10,timeToFall:7,isDown:!1,leaves:[{type:4,amount:30},{type:1,amount:1}],goals:[{type:1,amount:1},{type:4,amount:0}]},{level:11,timeToFall:10,isDown:!1,leaves:[{type:0,amount:2},{type:2,amount:3},{type:4,amount:3},{type:5,amount:2},{type:6,amount:3}],goals:[{type:0,amount:0},{type:2,amount:2},{type:4,amount:3},{type:5,amount:1},{type:6,amount:0}]},{level:12,timeToFall:15,isDown:!1,leaves:[{type:0,amount:1,isDown:!0},{type:1,amount:3,isDown:!0},{type:2,amount:2},{type:3,amount:3},{type:4,amount:2},{type:5,amount:3},{type:6,amount:3}],goals:[{type:0,amount:1},{type:1,amount:0},{type:2,amount:0},{type:3,amount:0},{type:4,amount:2},{type:5,amount:0},{type:6,amount:0}]},{level:13,timeToFall:0,isDown:!1,leaves:[{type:2,amount:7,isDown:!0,livingTime:4e4},{type:3,amount:7,livingTime:4e4},{type:5,amount:7,isDown:!0,livingTime:4e4}],goals:[{type:2,amount:7},{type:3,amount:7},{type:5,amount:7}]},{level:14,timeToFall:0,isDown:!1,leaves:[{type:0,amount:15,isDown:!0,livingTime:25e3},{type:1,amount:15,isDown:!0,livingTime:25e3},{type:2,amount:1,isDown:!0,livingTime:2e4},{type:3,amount:15,isDown:!0,livingTime:25e3},{type:5,amount:10,livingTime:25e3}],goals:[{type:0,amount:0},{type:1,amount:0},{type:2,amount:1},{type:3,amount:0},{type:5,amount:0}]},{level:15,timeToFall:20,isDown:!1,leaves:[{type:0,amount:8,livingTime:6e4},{type:1,amount:8,livingTime:6e4},{type:2,amount:8,livingTime:6e4},{type:3,amount:8,livingTime:6e4},{type:4,amount:8,livingTime:6e4},{type:5,amount:8,livingTime:6e4},{type:6,amount:8,livingTime:6e4}],goals:[{type:0,amount:1},{type:1,amount:1},{type:2,amount:1},{type:3,amount:1},{type:4,amount:1},{type:5,amount:1},{type:6,amount:1}]}],Levels.prototype={next:function(t){return this.currentIndex=t?this.currentIndex+1:this.currentIndex,app.levelMenu.change(),this.maxIndex=this.currentIndex>this.maxIndex?this.currentIndex:this.maxIndex,this.getConfig()},open:function(t){return this.currentIndex=t,app.levelMenu.change(),this.maxIndex=this.currentIndex>this.maxIndex?this.currentIndex:this.maxIndex,this.getConfig()},updateMax:function(){this.maxIndex++},getConfig:function(){return app.levels[this.currentIndex]},isLast:function(){return this.currentIndex==app.levels.length-1}},DeadLeaves.prototype={add:function(t){this.deadLeaves.push(new LeafParticles(t))},update:function(){var t=[];this.deadLeaves.forEach(function(e){e.update(),e.isActive||t.push(e)}.bind(this)),t.forEach(function(t){var e=this.deadLeaves.indexOf(t);e!==-1&&this.deadLeaves.splice(e,1)}.bind(this))},render:function(){this.deadLeaves.forEach(function(t){t.render()})}},StarFall.prototype={update:function(){},render:function(){}},window.app=window.app||{},app.groundConfig={vertices:{fill:[[{x:318,y:419},{x:162,y:434},{x:109,y:455},{x:1,y:445},{x:1,y:479},{x:316,y:478}]],stroke:[]}},window.app=window.app||{},app.mountainsConfig={mountains:[{color:"#b3cccc",vertices:{fill:[[{x:0,y:421},{x:78,y:426},{x:212,y:374},{x:307,y:364},{x:319,y:409},{x:317,y:477},{x:0,y:478}]],stroke:[]}},{color:"#c6d6ec",vertices:{fill:[[{x:0,y:372},{x:73,y:348},{x:163,y:386},{x:246,y:404},{x:318,y:398},{x:318,y:477},{x:2,y:477}]],stroke:[]}},{color:"#d6e0f5",vertices:{fill:[[{x:1,y:405},{x:201,y:337},{x:319,y:390},{x:316,y:477},{x:2,y:475}]],stroke:[]}}]},Scene.prototype={update:function(){this.tree.update()},render:function(){appOut.fillStyle="#e4e4ce",appOut.fillRect(0,0,320,480),this.renderMountains(),this.renderGround(),this.tree.render()},renderGround:function(){appOut.save(),appOut.translate(this.paralax.x-10,this.paralax.y+10),appOut.scale(1.1,1.01),app.groundConfig.vertices.fill.forEach(function(t){this.renderFillLayout(t,"#bbbb77")}.bind(this)),app.groundConfig.vertices.fill.forEach(function(t){this.renderStrokeLayout(t,"black")}.bind(this)),app.groundConfig.vertices.stroke.forEach(function(t){this.renderStrokeLayout(t,"black")}.bind(this)),appOut.restore()},renderMountains:function(){var t,e;for(t=app.mountainsConfig.mountains.length-1;t>=0;t--)appOut.save(),appOut.translate((4-t)/10*this.paralax.x-10,(4-t)/10*this.paralax.y),appOut.scale(1.1,1.05),e=app.mountainsConfig.mountains[t].color,app.mountainsConfig.mountains[t].vertices.fill.forEach(function(t){this.renderFillLayout(t,e)}.bind(this)),app.mountainsConfig.mountains[t].vertices.fill.forEach(function(t){this.renderStrokeLayout(t,"black")}.bind(this)),app.mountainsConfig.mountains[t].vertices.stroke.forEach(function(t){this.renderStrokeLayout(t,"black")}.bind(this)),appOut.restore()},renderStrokeLayout:function(t,e){appOut.beginPath(),t.forEach(function(t,e){e?appOut.lineTo(t.x,t.y):appOut.moveTo(t.x,t.y)}.bind(this)),appOut.strokeStyle=e,appOut.stroke(),appOut.closePath()},renderFillLayout:function(t,e){appOut.beginPath(),t.forEach(function(t,e){e?appOut.lineTo(t.x,t.y):appOut.moveTo(t.x,t.y)}.bind(this)),appOut.fillStyle=e,appOut.fill(),appOut.closePath()}},window.app=window.app||{},app.treeConfig={vertices:{fill:[[{x:152,y:477},{x:193,y:449},{x:241,y:434},{x:267,y:401},{x:279,y:372},{x:291,y:173},{x:168,y:108},{x:156,y:69},{x:98,y:48},{x:2,y:75},{x:4,y:61},{x:66,y:40},{x:1,y:6},{x:1,y:0},{x:164,y:54},{x:140,y:5},{x:148,y:3},{x:172,y:28},{x:177,y:96},{x:292,y:140},{x:298,y:59},{x:213,y:60},{x:186,y:5},{x:195,y:5},{x:221,y:52},{x:281,y:45},{x:241,y:5},{x:253,y:2},{x:301,y:44},{x:303,y:0},{x:319,y:3},{x:316,y:476},{x:277,y:476},{x:286,y:449},{x:251,y:458},{x:226,y:478},{x:205,y:479},{x:232,y:450},{x:178,y:478}],[{x:117,y:36},{x:118,y:3},{x:107,y:3}],[{x:25,y:50},{x:1,y:33}]],stroke:[]}},Tree.prototype={new:function(t,e){var i,n;this.isFinished=!1,"undefined"!=typeof e?app.levelsManager.open(e):app.levelsManager.next(t),app.windManager.new(),app.hole.reset(),n=app.levelsManager.getConfig(),this.leaves.length=0,n.leaves.forEach(function(t){for(i=0;i<t.amount;i++)this.leaves.push(new Leaf(t.type,n.timeToFall,t.livingTime,t.isDown))}.bind(this))},checkLevelEnd:function(){!this.isFinished&&app.hole.isFull?(app.hole.win?app.levelsManager.isLast()?(app.levelsManager.updateMax(),app.menu.showMenu(5)):(app.levelsManager.updateMax(),app.menu.showMenu(3)):app.menu.showMenu(4),this.isFinished=!0):this.isFinished||0!=this.leaves.length||(app.menu.showMenu(4),this.isFinished=!0)},update:function(){var t=[];this.leaves.forEach(function(e){e.update(this.leaves),e.isActive||t.push(e)}.bind(this)),t.forEach(function(t){var e=this.leaves.indexOf(t);e!==-1&&this.leaves.splice(e,1)}.bind(this)),this.checkLevelEnd()},render:function(){this.renderTree(),this.leaves.forEach(function(t){t.isActive&&t.render()})},renderTree:function(){appOut.save(),appOut.scale(1.01,1.01),app.treeConfig.vertices.fill.forEach(function(t){this.renderFillLayout(t)}.bind(this)),app.treeConfig.vertices.fill.forEach(function(t){this.renderStrokeLayout(t)}.bind(this)),app.treeConfig.vertices.stroke.forEach(function(t){this.renderStrokeLayout(t)}.bind(this)),appOut.restore()},renderStrokeLayout:function(t){appOut.beginPath(),t.forEach(function(e,i){i?(appOut.lineTo(e.x,e.y),i==t.length-1&&appOut.lineTo(t[0].x,t[0].y)):appOut.moveTo(e.x,e.y)}.bind(this)),appOut.strokeStyle="black",appOut.stroke(),appOut.closePath()},renderFillLayout:function(t){appOut.beginPath(),t.forEach(function(t,e){e?appOut.lineTo(t.x,t.y):appOut.moveTo(t.x,t.y)}.bind(this)),appOut.fillStyle="#8a8a5c",appOut.fill(),appOut.closePath()}},LevelMenu.prototype={change:function(){this.currentLevel=app.levelsManager.getConfig()},update:function(){},render:function(){this.currentLevel&&this.currentLevel.goals.forEach(function(t,e){var i=app.leaves[t.type],n=app.hole.inside[t.type]?app.hole.inside[t.type]:0;this.renderLeaf(i,20,110+30*e),this.renderText(20,110+30*e,t,n)}.bind(this))},renderLeaf:function(t,e,i){appOut.save(),appOut.translate(e,i),appOut.scale(.13,.13),t.vertices.fill.forEach(function(t){this.renderFillLayout(t)}.bind(this)),t.vertices.fill.forEach(function(t){this.renderStrokeLayout(t)}.bind(this)),t.vertices.stroke.forEach(function(t){this.renderStrokeLayout(t)}.bind(this)),appOut.restore()},renderText:function(t,e,i,n){appOut.save(),appOut.font="13px",appOut.textBaseline="middle",appOut.fillStyle=n==i.amount?"green":n<i.amount?"black":"red",appOut.fillText(0==i.amount?"X":n+"/"+i.amount,t+15,e),appOut.restore()},renderStrokeLayout:function(t){appOut.beginPath(),t.forEach(function(e,i){i?(appOut.lineTo(e.x-100,e.y-100),i==t.length-1&&appOut.lineTo(t[0].x-100,t[0].y-100)):appOut.moveTo(e.x-100,e.y-100)}.bind(this)),appOut.strokeStyle="black",appOut.stroke(),appOut.closePath()},renderFillLayout:function(t){appOut.beginPath(),t.forEach(function(t,e){e?appOut.lineTo(t.x-100,t.y-100):appOut.moveTo(t.x-100,t.y-100)}.bind(this)),appOut.fillStyle="hsl(120, 40%, 41%)",appOut.fill(),appOut.closePath()}},window.app=window.app||{},app.menuConfig={back:{vertices:{fill:[[{x:36,y:64},{x:101,y:74},{x:248,y:60},{x:300,y:49},{x:294,y:109},{x:307,y:184},{x:296,y:277},{x:307,y:427},{x:216,y:420},{x:100,y:406},{x:33,y:424},{x:33,y:269},{x:22,y:178}]]}},button:{vertices:{fill:[[{x:19,y:14},{x:119,y:27},{x:175,y:14},{x:197,y:46},{x:179,y:85},{x:124,y:70},{x:65,y:71},{x:15,y:88},{x:35,y:44}]]}},logo:{vertices:{fill:[[{x:16,y:11},{x:27,y:17},{x:24,y:88},{x:42,y:78},{x:57,y:115},{x:51,y:135},{x:17,y:134},{x:18,y:102},{x:45,y:125},{x:35,y:94},{x:17,y:100}],[{x:91,y:120},{x:98,y:133},{x:64,y:137},{x:60,y:89},{x:102,y:90},{x:77,y:118},{x:75,y:105},{x:90,y:97},{x:69,y:96},{x:72,y:129}],[{x:123,y:15},{x:124,y:46},{x:113,y:42},{x:118,y:60},{x:125,y:59},{x:127,y:135},{x:136,y:137},{x:139,y:60},{x:148,y:62},{x:150,y:44},{x:132,y:45},{x:136,y:16}],[{x:159,y:16},{x:153,y:137},{x:166,y:139},{x:165,y:102},{x:194,y:138},{x:199,y:123},{x:184,y:97},{x:162,y:85},{x:174,y:17}],[{x:197,y:96},{x:207,y:138},{x:241,y:136},{x:240,y:119},{x:213,y:128},{x:206,y:105},{x:224,y:99},{x:212,y:113},{x:222,y:119},{x:241,y:99},{x:216,y:91}],[{x:267,y:93},{x:289,y:137},{x:301,y:118},{x:323,y:141},{x:337,y:99},{x:318,y:89},{x:322,y:124},{x:307,y:107},{x:294,y:118},{x:283,y:90}],[{x:347,y:93},{x:337,y:139},{x:357,y:139}],[{x:366,y:141},{x:364,y:87},{x:395,y:103},{x:417,y:140},{x:389,y:139},{x:392,y:112},{x:370,y:99},{x:376,y:138}],[{x:468,y:142},{x:464,y:8},{x:450,y:23},{x:461,y:132},{x:428,y:135},{x:438,y:104},{x:452,y:116},{x:454,y:83},{x:420,y:103},{x:422,y:141}]]}},levelBox:{vertices:{fill:[[{x:7,y:5},{x:45,y:21},{x:94,y:6},{x:87,y:50},{x:91,y:91},{x:46,y:83},{x:13,y:92},{x:18,y:49}]]}}},Menu.prototype={showMenu:function(t){0==t?this.currentMenuType=t:window.setTimeout(function(){this.currentMenuType=t}.bind(this),2e3)},update:function(){},render:function(){switch(this.currentMenuType){case 0:return this.renderBackground(),void this.renderWelcome();case 1:return this.renderBackground(),void this.renderGameMenu();case 2:return this.renderBackground(),void this.renderLevels();case 3:return this.renderBackground(),void this.renderEndLevelWin();case 4:return this.renderBackground(),void this.renderEndLevelLose();case 5:return this.renderBackground(),void this.renderEndWin();default:return}},renderBackground:function(){appOut.save(),app.menuConfig.back.vertices.fill.forEach(function(t){this.renderFillLayout(t,"#476b6b")}.bind(this)),appOut.restore()},renderWelcome:function(){this.renderLogo(),this.renderText("Just be the wind!",new Vector(160,180),"13px"),this.renderText("Touch the screen and move to choose",new Vector(160,200),"13px"),this.renderText("wind direction and catch the leaves...",new Vector(160,220),"13px"),this.renderText("Glitch of the nature",new Vector(160,240),"13px"),this.renderText("is waiting for these leaves :)",new Vector(160,260),"13px"),this.renderButton(new Vector(160,320),"Start",this.buttonScale[0])},renderGameMenu:function(){this.renderLogo(),this.renderButton(new Vector(160,240),"Levels",this.buttonScale[0]),this.renderButton(new Vector(160,330),"Restart",this.buttonScale[1])},renderLevels:function(){var t;for(this.renderLogo(),t=0;t<app.levels.length;t++)this.renderLevelBox(new Vector(90+50*(t%4),200+50*parseInt(t/4,10)),t,t<=app.levelsManager.maxIndex,t==this.hoverLevelButtonIndex)},renderEndLevelWin:function(){this.renderLogo(),this.renderText("Awesome!",new Vector(160,185),"26px"),this.renderButton(new Vector(160,240),"Levels",this.buttonScale[0]),this.renderButton(new Vector(160,330),"Next",this.buttonScale[1])},renderEndLevelLose:function(){this.renderLogo(),this.renderText("Maybe later...",new Vector(160,185),"26px"),this.renderButton(new Vector(160,240),"Levels",this.buttonScale[0]),this.renderButton(new Vector(160,330),"Try again",this.buttonScale[1])},renderEndWin:function(){this.renderLogo(),this.renderText("Congratulations!!!",new Vector(160,190),"26px"),this.renderButton(new Vector(160,320),"Levels",this.buttonScale[0]);
},renderButton:function(t,e,i){appOut.save(),appOut.translate(t.x,t.y),appOut.scale(i,i),app.menuConfig.button.vertices.fill.forEach(function(t){this.renderFillLayout(t,"#b38600",new Vector((-100),(-50)))}.bind(this)),appOut.font="24px Arial",appOut.textBaseline="middle",appOut.textAlign="center",appOut.fillStyle="#141f1f",appOut.fillText(e,0,0),appOut.restore()},renderLogo:function(){appOut.save(),appOut.translate(160,120),appOut.scale(.5,.5),app.menuConfig.logo.vertices.fill.forEach(function(t){this.renderFillLayout(t,"#b38600",new Vector((-220),(-75)))}.bind(this)),appOut.restore()},renderText:function(t,e,i,n){appOut.save(),appOut.font=(i?i:"32px")+" Arial",appOut.textBaseline="middle",appOut.textAlign="center",appOut.fillStyle=n?n:"white",appOut.fillText(t,e.x,e.y),appOut.restore()},renderLevelBox:function(t,e,i,n){appOut.save(),appOut.translate(t.x,t.y),appOut.scale(n?.44:.4,n?.44:.4),app.menuConfig.levelBox.vertices.fill.forEach(function(t){this.renderFillLayout(t,i?"#b38600":"#3e5b5b",new Vector((-50),(-50)))}.bind(this)),appOut.font="24px Arial",appOut.textBaseline="middle",appOut.textAlign="center",appOut.fillStyle="white",appOut.fillText(e,0,0),appOut.restore()},renderStrokeLayout:function(t,e){appOut.beginPath(),t.forEach(function(e,i){i?(appOut.lineTo(e.x,e.y),i==t.length-1&&appOut.lineTo(t[0].x,t[0].y)):appOut.moveTo(e.x,e.y)}.bind(this)),appOut.strokeStyle=e,appOut.stroke(),appOut.closePath()},renderFillLayout:function(t,e,i){"undefined"==typeof i&&(i=new Vector(0,0)),appOut.beginPath(),t.forEach(function(t,e){e?appOut.lineTo(t.x+i.x,t.y+i.y):appOut.moveTo(t.x+i.x,t.y+i.y)}.bind(this)),appOut.fillStyle=e,appOut.fill(),appOut.closePath()}},Vector.prototype={get:function(){return new Vector(this.x,this.y)},apply:function(t){return this.x=t.x,this.y=t.y,this},add:function(t){return this.x+=t.x,this.y+=t.y,this},sub:function(t){return this.x-=t.x,this.y-=t.y,this},mult:function(t){return this.x*=t,this.y*=t,this},div:function(t){return this.x/=t,this.y/=t,this},normalize:function(){var t;return this.x&&this.y&&(t=this.mag(),this.x/=t,this.y/=t),this},mag:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},distance:function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))},angle:function(t){var e;return e="undefined"!=typeof t?Math.atan2(t.y-this.y,t.x-this.x):Math.atan2(this.y,this.x)},perpendicular:function(){var t=this.x;return this.x=this.y,this.y=-t,this}},Wind.prototype={new:function(){app.wind.apply(new Vector(.005-.01*Math.random(),.001-.002*Math.random()))},update:function(){},render:function(){}};