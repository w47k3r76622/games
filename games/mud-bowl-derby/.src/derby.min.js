function RigidBody(a,b,c){this.position=new Vec,this.velocity=new Vec,this.forces=new Vec,this.mass=b,this.immovable=c||!1,this.angle=0,this.angularVelocity=0,this.torque=0,this.halfSize=a,this.rect={x:0,y:0,width:0,height:0},this.inertia=1/12*(a.x*a.x)*(a.y*a.y)*b,this.rect.x=-this.halfSize.x,this.rect.y=-this.halfSize.y,this.rect.width=2*this.halfSize.x,this.rect.height=2*this.halfSize.y}function Wheel(a,b){this.forwardAxis=new Vec(0,1),this.sideAxis=new Vec(-1,0),this.steeringAngle=0,this.wheelTorque=0,this.position=a,this.setSteeringAngle(0),this.wheelSpeed=0,this.wheelRadius=b,this.wheelInertia=b*b}function Vehicle(a,b,c){RigidBody.call(this,a,b),this.wheels=[],this.wheels[0]=new Wheel(new Vec(a.x,a.y),.5),this.wheels[1]=new Wheel(new Vec(-a.x,a.y),.5),this.wheels[2]=new Wheel(new Vec(a.x,-a.y),.5),this.wheels[3]=new Wheel(new Vec(-a.x,-a.y),.5)}function Car(a,b,c,d,e){this.health=1e3,this.smokeTimer=0,Vehicle.call(this,a,b,c),this.carId="car"+(""+Math.random()).substring(2),this.svgObj=document.createElementNS(svgNS,"g"),this.svgObj.setAttribute("id",this.carId),svg1.appendChild(this.svgObj),this.wheelSvgs=[];var f;for(f=0;f<this.wheels.length;f++){var g=this.relativeToWorld(this.wheels[f].getAttachPoint());this.wheelSvgs[f]=new Line(this.position.x+g.x,this.position.y+g.y-.8,this.position.x+g.x,this.position.y+g.y+1.6,"black",1),this.svgObj.appendChild(this.wheelSvgs[f].svgObj)}var h="grad"+(""+Math.random()).substring(2);for(this.gradient=createGradient(h,[{offset:"30%","stop-color":c},{offset:"70%","stop-color":d}]),this.svgChassis=document.createElementNS(svgNS,"path"),this.drawBody(e,a,h),this.brakes=[],f=0;2>f;f++)this.brakes[f]=document.createElementNS(svgNS,"rect"),this.brakes[f].setAttribute("x",this.polyChassisPoints[f?7:0].x+(f?-1.25:.25)),this.brakes[f].setAttribute("y",this.polyChassisPoints[f?7:0].y+.25),this.brakes[f].setAttribute("width",1),this.brakes[f].setAttribute("height",.5),this.brakes[f].style.fill="#660000",this.svgObj.appendChild(this.brakes[f]);for(this.lights=[],f=0;2>f;f++)this.lights[f]=document.createElementNS(svgNS,"ellipse"),this.lights[f].setAttribute("cx",this.polyChassisPoints[f?3:4].x+(f?.2:-.2)),this.lights[f].setAttribute("cy",this.polyChassisPoints[f?3:4].y-.6),this.lights[f].setAttribute("rx",.5),this.lights[f].setAttribute("ry",.3),this.lights[f].style.fill="#DAD45E",this.lights[f].style.stroke="black",this.lights[f].style.strokeWidth=.25,this.svgObj.appendChild(this.lights[f])}function CarAi(a,b,c,d,e,f){this.personality=e,this.target=car,this.frameCount=0,Car.call(this,a,b,c,d,f)}function CarPlayer(a,b,c,d,e){Car.call(this,a,b,c,d,e)}function Line(a,b,c,d,e,f,g){this.ox=a,this.oy=b,this.dx=c,this.dy=d,this.svgObj=document.createElementNS("http://www.w3.org/2000/svg","path"),this.svgObj.style.stroke=e||"black",this.svgObj.style.strokeWidth=f||4,g&&(this.svgObj.style.strokeDasharray=g),svg1.appendChild(this.svgObj),this.setPosition(a,b,c,d)}function checkCollision3(a,b){var c,d,e,f,g,h,i,j,k,l,m=-(1/0),n=null,o=null;for(c=0;c<a.length;c++){for(l=c===a.length-1?0:c+1,e=Vec.getNormal(a[c],a[l]),f=g=1/0,h=i=-(1/0),d=0;d<a.length;++d)k=Vec.dotProduct(a[d],e),k>h&&(h=k),f>k&&(f=k);for(d=0;d<b.length;++d)k=Vec.dotProduct(b[d],e),k>i&&(i=k),g>k&&(g=k);if(g>f?(j=g-h,e.x=-e.x,e.y=-e.y):j=f-i,j>=0)return!1;j>m&&(m=j,n=e.x,o=e.y)}for(c=0;c<b.length;c++){for(l=c==b.length-1?0:c+1,e=Vec.getNormal(b[c],b[l]),f=g=1/0,h=i=-(1/0),d=0;d<a.length;++d)k=Vec.dotProduct(a[d],e),k>h&&(h=k),f>k&&(f=k);for(d=0;d<b.length;++d)k=Vec.dotProduct(b[d],e),k>i&&(i=k),g>k&&(g=k);if(g>f?(j=g-h,e.x=-e.x,e.y=-e.y):j=f-i,j>=0)return!1;j>m&&(m=j,n=e.x,o=e.y)}return{overlap:m,normal:new Vec(n,o)}}function initAudio(){aa=new ArcadeAudio,aa.add("bigExplosion",5,[[3,,.41,.08,.61,.0144,,-.3399,-.14,.62,.47,-.86,,,,,-.24,-.0064,.78,,,,,.5]]),aa.add("engine",1,[[0,,.19,,,.07,,-.02,-.02,.52,.38,-.02,.74,,,,-.02,,.83,,,,,.5]]),aa.add("engine2",1,[[0,,.18,,,.1,.06,-.02,-.02,.52,.38,-.02,.74,,,,-.02,,.83,,,,,.5]]),aa.add("bip",1,[[0,,.0468,.5223,.2031,.56,,,,,,,,,,,,,1,,,,,.5]]),aa.add("bee",1,[[0,,.42,.13,.2031,.65,,,,,,,,,,,,,.46,,,,,.5]]),aa.add("damage",3,[[3,,.0138,,.2701,.4935,,-.6881,,,,,,,,,,,1,,,,,.25],[0,,.0639,,.2425,.7582,,-.6217,,,,,,.4039,,,,,1,,,,,.25],[3,,.0948,,.2116,.7188,,-.6372,,,,,,,,,,,1,,,.2236,,.25],[3,,.1606,.5988,.2957,.1157,,-.3921,,,,,,,,,.3225,-.2522,1,,,,,.25],[3,,.1726,.2496,.2116,.0623,,-.2096,,,,,,,,,.2665,-.1459,1,,,,,.25],[3,,.1645,.7236,.3402,.0317,,,,,,,,,,,,,1,,,,,.25]]),aa.add("base",2,[[3,,.14,.17,.2401,.0268,,.2041,,,,,,,,,,,1,,,,,.5]]),aa.add("snare",2,[[3,,.06,.17,.2401,.34,,-.38,.54,,,,,,,,,,1,,,,,.5]]),aa.add("note_g",3,[[0,,.32,.23,.2167,.38,,,,.06,,.02,,,,,.02,.02,.4,-.36,.33,.39,,.5]]),aa.add("note_f",3,[[0,,.32,.23,.2167,.37,,,,.06,,.02,,,,,.02,.02,.4,-.36,.33,.39,,.5]]),aa.add("note_e",3,[[0,,.32,.23,.2167,.35,,,,.06,,.02,,,,,.02,.02,.4,-.36,.33,.39,,.5]]),aa.add("note_d",3,[[0,,.32,.23,.2167,.33,,,,.06,,.02,,,,,.02,.02,.4,-.36,.33,.39,,.5]]),aa.add("note_c",3,[[0,,.32,.23,.2167,.27,,,,.06,,.02,,,,,.02,.02,.4,-.36,.33,.39,,.5]]),window.aa=aa}function playSong(a){var b={lost:{base:"000x000x000x00x0",snare:"0000x000x000x0x0",note_g:"00x0000000000000",note_f:"000000x000000000",note_e:"00x0000000000000",note_d:"000000x000000000",note_c:"0000000000x00000"},intro:{base:"x000x000x000x0000",snare:"00x000x000x000x0x",note_e:"0000x0000000xx000",note_d:"00x000x000x000x00",note_c:"x0000000x000000x0"},rockyou:{base:"xx00xx00xx000",snare:"00x000x000x0x",note_g:"x000000000000",note_f:"00x0000000000",note_e:"0000x000xx000",note_d:"000000x000000"}},c=0,d=setInterval(function(){c>=b[a].base.length&&clearTimeout(d);for(var e in b[a])"x"===b[a][e].charAt(c)&&aa.play(e);c++},Math.ceil(1e3/6))}function connect(){connected=!0,console.log("connecting"),socket.connected||(socket=io(document.location.href)),socket.on("leaders",showLeaders),socket.on("players",showPlayers),socket.on("disconnect",onDisconnect)}function showLeaders(a){highScores=a;for(var b="<table>",c=0;c<highScores.length;c++)b+="<tr><td>"+(c+1)+"</td><td>"+highScores[c].name+'</td><td align="right">'+highScores[c].score+"</td></tr>";b+="</table>";var d=document.getElementById("tdHighScores");d.innerHTML=b}function showPlayers(a){playersText.childNodes[0].textContent="Playing: "+a}function postHighScore(){var a=document.getElementById("txtPlayerName").value;a&&(highScoreDiv.style.display="none",localStorage.derbyPlayerName=a,handleEndGame())}function onDisconnect(){}function init(){initAudio(),aa.volume("engine",0,.3),aa.volume("engine2",0,.3),svg1.style.width=innerWidth,svg1.style.height=innerHeight,highScoreDiv=document.getElementById("divHighScoreEntry"),splashDiv=document.getElementById("divSplash"),splashDiv.style.left=innerWidth/2-splashDiv.offsetWidth/2+"px",splashDiv.style.top=innerHeight/2-splashDiv.offsetHeight/2+"px";var a=innerWidth/ARENA_WIDTH,b=innerHeight/ARENA_HEIGHT;Math.min(a,b);svg1.setAttribute("viewBox","0 0 "+ARENA_WIDTH+" "+ARENA_HEIGHT),document.body.oncopy=function(){return!1},document.body.oncut=function(){return!1},document.body.onpaste=function(){return!1},walls.push(new RigidBody({x:ARENA_WIDTH/2,y:5},1e4,!0)),walls[walls.length-1].position.x=ARENA_WIDTH/2,walls[walls.length-1].position.y=5,walls.push(new RigidBody({x:ARENA_WIDTH/2,y:5},1e4,!0)),walls[walls.length-1].position.x=ARENA_WIDTH/2,walls[walls.length-1].position.y=ARENA_HEIGHT-5,walls.push(new RigidBody({x:5,y:ARENA_HEIGHT/2},1e4,!0)),walls[walls.length-1].position.x=5,walls[walls.length-1].position.y=ARENA_HEIGHT/2,walls.push(new RigidBody({x:5,y:ARENA_HEIGHT/2},1e4,!0)),walls[walls.length-1].position.x=ARENA_WIDTH-5,walls[walls.length-1].position.y=ARENA_HEIGHT/2;var c=document.createElementNS(svgNS,"rect");c.setAttribute("width",walls[0].rect.width-10),c.setAttribute("height",walls[2].rect.height-10),c.setAttribute("x",5),c.setAttribute("y",5),c.setAttribute("rx",10),c.style.fill="#D27D2C",c.style.stroke="#140C1C",c.style.strokeWidth=10,svg1.appendChild(c),addText(walls[0].rect.width/2,5.5,"Mud Bowl Derby",10,"#DAD45E"),selectBox=document.createElementNS(svgNS,"rect"),selectBox.style.fillOpacity=0,selectBox.style.opacity=0,selectBox.style.stroke="#6DAA2C",selectBox.style.strokeWidth=2,svg1.appendChild(selectBox),scoreText=addText(2*walls[0].rect.width/3,walls[2].rect.height-5,"Score: "+score,8,"#8595A1"),playersText=addText(4*walls[0].rect.width/5,6,"Players: "+score,8,"#8595A1"),countDownText=addText(walls[0].rect.width/2,walls[2].rect.height/2,"3",16,"#DEEED6");var d=document.createElementNS(svgNS,"rect");d.setAttribute("width",walls[0].rect.width/3),d.setAttribute("height",8),d.setAttribute("x",walls[0].rect.width/6),d.setAttribute("y",walls[2].rect.height-9),d.setAttribute("rx",1),d.style.fill="#D04648",d.style.stroke="#8595A1",d.style.strokeWidth=1,svg1.appendChild(d),healthBar=document.createElementNS(svgNS,"rect"),healthBarMaxWidth=walls[0].rect.width/3-2,healthBar.setAttribute("width",healthBarMaxWidth),healthBar.setAttribute("height",6),healthBar.setAttribute("x",walls[0].rect.width/6+1),healthBar.setAttribute("y",walls[2].rect.height-8),healthBar.style.fill="#346524",healthBar.style.stroke="#346524",healthBar.style.strokeWidth=1,svg1.appendChild(healthBar),svgEffects=document.createElementNS(svgNS,"g"),svg1.appendChild(svgEffects);var e;for(e=0;30>e;e++){var f=document.createElementNS(svgNS,"ellipse");f.setAttribute("cx",0),f.setAttribute("cy",0),f.setAttribute("rx",4),f.setAttribute("ry",4),f.style.fill="url(#smoke1)",f.style.opacity=0,svgEffects.appendChild(f),smoke.push({time:0,active:!1,svg:f})}for(e=0;10>e;e++){var g=document.createElementNS(svgNS,"ellipse");g.setAttribute("cx",0),g.setAttribute("cy",0),g.setAttribute("rx",4),g.setAttribute("ry",4),g.style.fill="url(#fire1)",g.style.opacity=0,svgEffects.appendChild(g),fire.push({time:0,active:!1,svg:g})}for(e=0;10>e;e++){var h=addText(0,0,"100",7,"#8595A1",svgEffects);h.style.opacity=0,texts.push({time:0,active:!1,svg:h,x:0,y:0})}hasTouch&&createMobileControls(),car=new CarPlayer(Vec.divide(new Vec(5,8),2),10,"#597DCE","#6DC2CA","sport"),cars.push(car),initSteering(),loadLevel(0),playSong("intro");try{connect()}catch(i){console.log(i)}}function startGame(){loading=!0,keepPlaying=!1,score=0,scoreText.childNodes[0].textContent="Score: "+score,splashDiv.style.display="none",setTimeout(function(){loadLevel(1)},100)}function loadLevel(a){curLevel=a;var b=DEF_LEVELS[a];b||(curLevel--,b=DEF_LEVELS[curLevel]),car.setThrottle(0),car.setSteering(0),car.setLocation(new Vec(b.position.x,b.position.y),b.position.angle),car.dead=!1,car.handleCollision(),car.clearForces(),car.init(0);var c;for(c=1;c<cars.length;c++)cars[c].kill(),cars.splice(c,1),c--;for(c=0;c<b.opponents.length;c++){var d=b.opponents[c].ai||"default",e=DEFS_AI[d],f=new CarAi(Vec.divide(new Vec(e.width,e.height),2),e.mass,e.color_pri,e.color_sec,d,e.body);f.setThrottle(0),f.setSteering(0),f.setLocation(new Vec(b.opponents[c].x,b.opponents[c].y),b.opponents[c].angle),cars.push(f),f.init(0)}if(svg1.appendChild(svgEffects),loading=!1,keepPlaying=!0,0!==curLevel){var g=40;selectBox.style.opacity=1;var h=setInterval(function(){var a=car.position.x-g/2,b=car.position.y-g/2;5>g&&(clearInterval(h),selectBox.style.opacity=0),selectBox.setAttribute("x",a),selectBox.setAttribute("y",b),selectBox.setAttribute("width",g),selectBox.setAttribute("height",g),g-=g/7},100);countDown=3,countDownText.style.opacity=1,countDownText.childNodes[0].textContent=countDown,aa.play("bip"),svg1.appendChild(countDownText);var i=setInterval(function(){countDown--,0===countDown?(aa.play("bee"),countDownText.style.opacity=0,clearInterval(i),requestAnimationFrame(step)):(aa.play("bip"),countDownText.childNodes[0].textContent=countDown)},1e3)}}function step(){var a=0,b=0;car.dead||(KEY_LEFT&&(a+=1),KEY_RIGHT&&(a-=1),KEY_UP&&(b+=1),KEY_DOWN&&(b-=1)),car.setSteering(a),car.setThrottle(b),car.dead||0===curLevel?(aa.stop("engine",0),aa.stop("engine2",0)):b?aa.stop("engine",0):aa.stop("engine2",0);var c;for(c=0;c<cars.length;c++)cars[c].update(.02);var d,e;for(c=0;c<cars.length;c++){var f,g,h=[];for(d=0;d<cars[c].polyChassisPoints.length;d++)h.push(new Vec(cars[c].polyChassisPoints[d].x,cars[c].polyChassisPoints[d].y)),h[d].rotate(cars[c].angle),h[d].x+=cars[c].position.x,h[d].y+=cars[c].position.y;for(var i,j=0;j<walls.length;j++)if(i=!1,2>j&&Math.abs(cars[c].position.y-walls[j].position.y)<10?i=!0:j>=2&&Math.abs(cars[c].position.x-walls[j].position.x)<10&&(i=!0),i&&(g=[new Vec(walls[j].position.x+walls[j].rect.x,walls[j].position.y+walls[j].rect.y),new Vec(walls[j].position.x+walls[j].rect.x+walls[j].rect.width,walls[j].position.y+walls[j].rect.y),new Vec(walls[j].position.x+walls[j].rect.x+walls[j].rect.width,walls[j].position.y+walls[j].rect.y+walls[j].rect.height),new Vec(walls[j].position.x+walls[j].rect.x,walls[j].position.y+walls[j].rect.y+walls[j].rect.height)],f=checkCollision3(h,g))){var k=new Vec(f.normal.x,f.normal.y);k.normalize(),e=applyCollision(cars[c],walls[j],k,Vec.multiply(k,f.overlap),h),Math.abs(e)>20&&aa.play("damage")}for(var l=c+1;l<cars.length;l++)if(i=Math.abs(cars[c].position.x-cars[l].position.x)<10&&Math.abs(cars[c].position.y-cars[l].position.y)<10){for(g=[],d=0;d<cars[l].polyChassisPoints.length;d++)g.push(new Vec(cars[l].polyChassisPoints[d].x,cars[l].polyChassisPoints[d].y)),g[d].rotate(cars[l].angle),g[d].x+=cars[l].position.x,g[d].y+=cars[l].position.y;f=checkCollision3(h,g),f&&(e=applyCollision(cars[c],cars[l],new Vec(f.normal.x,f.normal.y),Vec.multiply(f.normal,f.overlap),h,g),Math.abs(e)>20&&aa.play("damage"))}}animateSmoke(),animateFire(),animateText(),frame++;var m=0;for(c=1;c<cars.length;c++)cars[c].health>0&&m++;keepPlaying&&!loading&&0===m?(loading=!0,playSong("rockyou"),setTimeout(function(){keepPlaying=!1,setTimeout(function(){loadLevel(curLevel+1)},1e3)},3e3)):keepPlaying&&!loading&&car.health<0&&(loading=!0,playSong("lost"),setTimeout(function(){handleEndGame()},3e3)),keepPlaying&&requestAnimationFrame(step)}function handleEndGame(){keepPlaying=!1;var a=highScores.length?highScores[highScores.length-1].score<score:!0;return a&&!localStorage.derbyPlayerName?(highScoreDiv.style.display="block",highScoreDiv.style.left=innerWidth/2-highScoreDiv.offsetWidth/2+"px",void(highScoreDiv.style.top=innerHeight/2-highScoreDiv.offsetHeight/2+"px")):void setTimeout(function(){try{a&&socket.emit("score",{name:localStorage.derbyPlayerName,score:score}),socket.emit("getScores")}catch(b){console.log(b)}car.health=1e3,healthBar.setAttribute("width",healthBarMaxWidth),loadLevel(0),splashDiv.style.display="block"},1e3)}function Vec(a,b){this.x=a||0,this.y=b||0}function initSteering(){document.onkeydown=function(a){switch(a.keyCode){case 37:KEY_LEFT=!0;break;case 38:KEY_UP=!0;break;case 39:KEY_RIGHT=!0;break;case 32:KEY_SPACE=!0;break;case 40:KEY_DOWN=!0}},document.onkeyup=function(a){switch(a.keyCode){case 37:KEY_LEFT=!1;break;case 38:KEY_UP=!1;break;case 39:KEY_RIGHT=!1;break;case 32:KEY_SPACE=!1;break;case 40:KEY_DOWN=!1}}}function createMobileControls(){function a(a,b,c,d,e){var f=document.createElementNS(svgNS,"path");f.style.fill="#DAD45E",f.style.stroke="#4E4A4E",f.style.strokeWidth=1,f.style.opacity=.6,f.setAttribute("d","M 0,40 L 20,0 L 40,40 z"),f.setAttribute("stroke-linejoin","round"),f.setAttribute("transform","translate("+a+" "+b+") rotate("+c+" 20 20)"),f.addEventListener("touchstart",d),f.addEventListener("touchend",e),svg1.appendChild(f)}var b=ARENA_WIDTH/ARENA_HEIGHT,c=innerWidth/innerHeight,d=0;c>b&&(d=(c-b)*ARENA_WIDTH/4),a(-d,20,0,function(a){KEY_UP=!0,a.preventDefault()},function(a){KEY_UP=!1,a.preventDefault()}),a(-d,70,180,function(a){KEY_DOWN=!0,a.preventDefault()},function(a){KEY_DOWN=!1,a.preventDefault()}),a(ARENA_WIDTH-40+d,70,90,function(a){KEY_RIGHT=!0,a.preventDefault()},function(a){KEY_RIGHT=!1,a.preventDefault()}),a(ARENA_WIDTH-90+d,70,270,function(a){KEY_LEFT=!0,a.preventDefault()},function(a){KEY_LEFT=!1,a.preventDefault()})}function addText(a,b,c,d,e,f){var g=document.createElementNS(svgNS,"text");g.setAttributeNS(null,"x",a),g.setAttributeNS(null,"y",b),g.setAttributeNS(null,"fill",e),g.setAttributeNS(null,"font-size",d),g.setAttributeNS(null,"text-anchor","middle"),g.setAttributeNS(null,"alignment-baseline","middle"),g.setAttributeNS(null,"font-family","Impact, Charcoal, sans-serif");var h=document.createTextNode(c);return g.appendChild(h),(f||svg1).appendChild(g),g}function showText(a,b,c){var d=texts[textsCounter];textsCounter=(textsCounter+1)%texts.length,d.time=0,d.active=!0,d.svg.childNodes[0].textContent=c,d.svg.setAttribute("x",a),d.svg.setAttribute("y",b),d.x=a,d.y=b,d.svg.style.opacity=1}function animateText(){for(var a=0;a<texts.length;a++)texts[a].active&&(texts[a].time++,texts[a].time<80?(texts[a].y-=3/(texts[a].time||1),texts[a].svg.setAttribute("y",Math.max(2,texts[a].y))):(texts[a].active=!1,texts[a].svg.style.opacity=0))}function animateSmoke(){for(var a=0;a<smoke.length;a++)smoke[a].active&&(smoke[a].time++,smoke[a].time<100?(smoke[a].svg.setAttribute("rx",1+.1*smoke[a].time),smoke[a].svg.setAttribute("ry",1+.1*smoke[a].time),smoke[a].svg.style.opacity=1-smoke[a].time/120):(smoke[a].active=!1,smoke[a].svg.style.opacity=0))}function addSmoke(a,b){var c=smoke[smokeCounter];smokeCounter=(smokeCounter+1)%smoke.length,c.time=0,c.active=!0,c.svg.setAttribute("cx",a),c.svg.setAttribute("cy",b),c.svg.setAttribute("rx",1),c.svg.setAttribute("ry",1),c.svg.style.opacity=1}function animateFire(){for(var a=0;a<fire.length;a++)fire[a].active&&(fire[a].time+=4,fire[a].time<100?(fire[a].svg.setAttribute("cx",fire[a].target.position.x),fire[a].svg.setAttribute("cy",fire[a].target.position.y),fire[a].svg.setAttribute("rx",1+.1*fire[a].time),fire[a].svg.setAttribute("ry",1+.1*fire[a].time),fire[a].svg.style.opacity=1-fire[a].time/1200):(fire[a].active=!1,fire[a].svg.style.opacity=0))}function addFire(a){var b=fire[fireCounter];fireCounter=(fireCounter+1)%fire.length,b.time=0,b.target=a,b.active=!0,b.svg.setAttribute("cx",a.position.x),b.svg.setAttribute("cy",a.position.y),b.svg.setAttribute("rx",2),b.svg.setAttribute("ry",2),b.svg.style.opacity=1}function goFullScreen(){svg1.requestFullscreen?svg1.requestFullscreen():svg1.webkitRequestFullscreen?svg1.webkitRequestFullscreen():svg1.mozRequestFullScreen?svg1.mozRequestFullScreen():svg1.msRequestFullscreen&&svg1.msRequestFullscreen()}function applyCollision(a,b,c,d,e,f){b.immovable?(a.position.x-=1.1*d.x,a.position.y-=1.1*d.y):(a.position.x-=d.x,a.position.y-=d.y,b.position.x+=d.x,b.position.y+=d.y);var g=b.velocity.subtract(a.velocity),h=g.dotProduct(c),i=.2,j=-(1+i)*h/(1/a.mass+1/b.mass);if(Math.abs(j)<20)return j;var k=Vec.multiply(c,j),l={x:(a.position.x-b.position.x)/2,y:(a.position.y-b.position.y)/2},m={x:(a.position.x+b.position.x)/2,y:(a.position.y+b.position.y)/2};b.immovable&&(l.x>l.y?l.x=a.position.x:l.y=a.position.y),a.velocity=a.velocity.subtract(Vec.multiply(k,1/a.mass)),a.angularVelocity=(l.x*g.y-l.y*g.x)/(l.x*l.x+l.y*l.y),a.handleCollision();var n=j;b.immovable&&a===car&&(n=j/50);var o=a.damagePoint(c,n,m,e);return a===car&&navigator.vibrate(Math.round(o)),b.immovable||(b.velocity=b.velocity.add(Vec.multiply(k,1/b.mass)),b.angularVelocity=(l.x*-g.y-l.y*-g.x)/(l.x*l.x+l.y*l.y),b.handleCollision(),b.health>0&&(o=b.damagePoint(c,j,m,f),a===car&&(score+=Math.abs(Math.round(o)),scoreText.childNodes[0].textContent="Score: "+score,showText(b.position.x,b.position.y,-o.toFixed(0))))),j}function createGradient(a,b){var c=svg1.namespaceURI,d=document.createElementNS(c,"linearGradient");d.setAttribute("id",a),d.setAttribute("x1","0%"),d.setAttribute("y1","0%"),d.setAttribute("x2","0%"),d.setAttribute("y2","100%"),d.setAttribute("gradientUnits","objectBoundingBox");for(var e=0;e<b.length;e++){var f=b[e],g=document.createElementNS(c,"stop");for(var h in f)f.hasOwnProperty(h)&&g.setAttribute(h,f[h]);d.appendChild(g)}var i=svg1.querySelector("defs")||svg1.insertBefore(document.createElementNS(c,"defs"),svg1.firstChild);return i.appendChild(d)}function updateGradient(a,b){a.setAttribute("gradientTransform","rotate("+180*-b.angle/Math.PI+" 0.5 0.5)")}function drawMud(){for(var a=mudCanvas.getContext("2d"),b=0;b<cars.length;b++)a.fillStyle="#854C30",a.rect(cars[b].position.x*innerWidth/ARENA_WIDTH,cars[b].position.y*innerHeight/ARENA_HEIGHT,2,2),a.stroke()}function generateNoise(a,b){var c=a.getContext("2d");c.fillStyle=b[0],c.rect(0,0,a.width,a.height),c.fill()}function ArcadeAudio(){this.sounds={}}function SfxrParams(){this.setSettings=function(a){for(var b=0;24>b;b++)this[String.fromCharCode(97+b)]=a[b]||0;this.c<.01&&(this.c=.01);var c=this.b+this.c+this.e;if(.18>c){var d=.18/c;this.b*=d,this.c*=d,this.e*=d}}}function SfxrSynth(){this._params=new SfxrParams;var a,b,c,d,e,f,g,h,i,j,k,l;this.reset=function(){var a=this._params;d=100/(a.f*a.f+.001),e=100/(a.g*a.g+.001),f=1-a.h*a.h*a.h*.01,g=-a.i*a.i*a.i*1e-6,a.a||(k=.5-a.n/2,l=5e-5*-a.o),h=1+a.l*a.l*(a.l>0?-.9:10),i=0,j=1==a.m?0:(1-a.m)*(1-a.m)*2e4+32},this.totalReset=function(){this.reset();var d=this._params;return a=d.b*d.b*1e5,b=d.c*d.c*1e5,c=d.e*d.e*1e5+12,3*((a+b+c)/3|0)},this.synthWave=function(m,n){var o=this._params,p=1!=o.s||o.v,q=o.v*o.v*.1,r=1+3e-4*o.w,s=o.s*o.s*o.s*.1,t=1+1e-4*o.t,u=1!=o.s,v=o.x*o.x,w=o.g,x=o.q||o.r,y=o.r*o.r*o.r*.2,z=o.q*o.q*(o.q<0?-1020:1020),A=o.p?((1-o.p)*(1-o.p)*2e4|0)+32:0,B=o.d,C=o.j/2,D=o.k*o.k*.01,E=o.a,F=a,G=1/a,H=1/b,I=1/c,J=5/(1+o.u*o.u*20)*(.01+s);J>.8&&(J=.8),J=1-J;for(var K,L,M,N,O,P,Q=!1,R=0,S=0,T=0,U=0,V=0,W=0,X=0,Y=0,Z=0,$=0,_=new Array(1024),aa=new Array(32),ba=_.length;ba--;)_[ba]=0;for(var ba=aa.length;ba--;)aa[ba]=2*Math.random()-1;for(var ba=0;n>ba;ba++){if(Q)return ba;if(A&&++Z>=A&&(Z=0,this.reset()),j&&++i>=j&&(j=0,d*=h),f+=g,d*=f,d>e&&(d=e,w>0&&(Q=!0)),L=d,C>0&&($+=D,L*=1+Math.sin($)*C),L|=0,8>L&&(L=8),E||(k+=l,0>k?k=0:k>.5&&(k=.5)),++S>F)switch(S=0,++R){case 1:F=b;break;case 2:F=c}switch(R){case 0:T=S*G;break;case 1:T=1+2*(1-S*H)*B;break;case 2:T=1-S*I;break;case 3:T=0,Q=!0}x&&(z+=y,M=0|z,0>M?M=-M:M>1023&&(M=1023)),p&&r&&(q*=r,1e-5>q?q=1e-5:q>.1&&(q=.1)),P=0;for(var ca=8;ca--;){if(X++,X>=L&&(X%=L,3==E))for(var da=aa.length;da--;)aa[da]=2*Math.random()-1;switch(E){case 0:O=k>X/L?.5:-.5;break;case 1:O=1-X/L*2;break;case 2:N=X/L,N=6.28318531*(N>.5?N-1:N),O=1.27323954*N+.405284735*N*N*(0>N?1:-1),O=.225*((0>O?-1:1)*O*O-O)+O;break;case 3:O=aa[Math.abs(32*X/L|0)]}p&&(K=W,s*=t,0>s?s=0:s>.1&&(s=.1),u?(V+=(O-W)*s,V*=J):(W=O,V=0),W+=V,U+=W-K,U*=1-q,O=U),x&&(_[Y%1024]=O,O+=_[(Y-M+1024)%1024],Y++),P+=O}P*=.125*T*v,m[ba]=P>=1?32767:-1>=P?-32768:32767*P|0}return n}}RigidBody.prototype.clearForces=function(){this.angularVelocity=0,this.torque=0,this.velocity=new Vec},RigidBody.prototype.setLocation=function(a,b){this.position=a,this.angle=b},RigidBody.prototype.getPosition=function(){return this.position},RigidBody.prototype.update=function(a){var b=Vec.divide(this.forces,this.mass);this.velocity=Vec.add(this.velocity,Vec.multiply(b,a)),this.position=Vec.add(this.position,Vec.multiply(this.velocity,a)),this.forces=new Vec(0,0);var c=this.torque/this.inertia;this.angularVelocity+=c*a,this.angle+=this.angularVelocity*a,this.torque=0},RigidBody.prototype.relativeToWorld=function(a){var b=new Vec(a.x,a.y);return b.rotate(this.angle),b},RigidBody.prototype.worldToRelative=function(a){var b=new Vec(a.x,a.y);return b.rotate(-this.angle),b},RigidBody.prototype.pointVel=function(a){var b=new Vec(-a.y,a.x);return Vec.add(Vec.multiply(b,this.angularVelocity),this.velocity)},RigidBody.prototype.addForce=function(a,b){this.forces=Vec.add(this.forces,a),this.torque+=Vec.crossProduct(b,a)},Wheel.prototype.setSteeringAngle=function(a){this.steeringAngle=a,this.forwardAxis.x=0,this.forwardAxis.y=1,this.sideAxis.x=-1,this.sideAxis.y=0,this.forwardAxis.rotate(a),this.sideAxis.rotate(a)},Wheel.prototype.addTransmissionTorque=function(a){this.wheelTorque+=a},Wheel.prototype.getWheelSpeed=function(){return this.wheelSpeed},Wheel.prototype.getAttachPoint=function(){return this.position},Wheel.prototype.calculateForce=function(a,b){var c=Vec.multiply(Vec.reverse(this.forwardAxis),this.wheelSpeed*this.wheelRadius),d=Vec.add(a,c),e=d.project(this.sideAxis),f=d.project(this.forwardAxis),g=f.mag,h=f.vec,i=Vec.multiply(Vec.reverse(e.vec),4);return i=Vec.subtract(i,h),this.wheelTorque+=g*this.wheelRadius,this.wheelSpeed+=this.wheelTorque/this.wheelInertia*b,this.wheelTorque=0,i},Vehicle.prototype=Object.create(RigidBody.prototype),Vehicle.prototype.constructor=Vehicle,Vehicle.prototype.handleCollision=function(){for(var a=0;a<this.wheels.length;a++)this.wheels[a].wheelSpeed=0,this.wheels[a].wheelTorque=0;this.forces=new Vec(0,0)},Vehicle.prototype.setSteering=function(a){var b=.75;this.wheels[0].setSteeringAngle(-a*b),this.wheels[1].setSteeringAngle(-a*b)},Vehicle.prototype.setThrottle=function(a,b){var c=80;if(a&&this===car){var d=this.worldToRelative(this.velocity);d.y>0&&0>a?this.velocity=Vec.multiply(this.velocity,.97):d.y<0&&a>0&&(this.velocity=Vec.multiply(this.velocity,.97))}b&&(this.wheels[0].addTransmissionTorque(a*c),this.wheels[1].addTransmissionTorque(a*c)),this.wheels[2].addTransmissionTorque(a*c),this.wheels[3].addTransmissionTorque(a*c)},Vehicle.prototype.setBrakes=function(a){console.log("barkes");for(var b=20,c=0;c<this.wheels.length;c++){var d=this.wheels[c].getWheelSpeed();this.wheels[c].addTransmissionTorque(-d*b*a)}},Vehicle.prototype.update=function(a){for(var b=0;b<this.wheels.length;b++){var c=this.relativeToWorld(this.wheels[b].getAttachPoint()),d=this.pointVel(c),e=this.worldToRelative(d),f=this.wheels[b].calculateForce(e,a),g=this.relativeToWorld(f);this.addForce(g,c)}RigidBody.prototype.update.call(this,a)},Car.prototype=Object.create(Vehicle.prototype),Car.prototype.constructor=Car,Car.prototype.drawBody=function(a,b,c){var d,e,f,g;if("sport"===a){for(this.polyChassisPoints=[new Vec(this.rect.x+this.rect.width/8,this.rect.y-this.rect.height/8),new Vec(this.rect.x,this.rect.y),new Vec(this.rect.x,this.rect.y+this.rect.height),new Vec(this.rect.x+this.rect.width/4,this.rect.y+5*this.rect.height/4),new Vec(this.rect.x+3*this.rect.width/4,this.rect.y+5*this.rect.height/4),new Vec(this.rect.x+this.rect.width,this.rect.y+this.rect.height),new Vec(this.rect.x+this.rect.width,this.rect.y),new Vec(this.rect.x+7*this.rect.width/8,this.rect.y-this.rect.height/8)],f="M "+this.polyChassisPoints[0].x+","+this.polyChassisPoints[0].y,g=0;g<this.polyChassisPoints.length;g++)f+=" L "+this.polyChassisPoints[g].x+","+this.polyChassisPoints[g].y;f+=" L "+this.polyChassisPoints[0].x+","+this.polyChassisPoints[0].y,this.svgChassis.setAttribute("d",f),this.svgChassis.style.fill="url(#"+c+")",this.svgChassis.style.stroke="black",this.svgChassis.style.strokeWidth=.25,this.svgObj.appendChild(this.svgChassis),d=document.createElementNS(svgNS,"rect"),d.setAttribute("x",-b.x+.25),d.setAttribute("y",0-b.y/2),d.setAttribute("width",2*b.x-.5),d.setAttribute("height",b.y/1),d.setAttribute("rx",1),d.style.fill="url(#screen1)",d.style.stroke="black",d.style.strokeWidth=.25,this.svgObj.appendChild(d),e=document.createElementNS(svgNS,"rect"),e.setAttribute("x",0-2*b.x/3),e.setAttribute("y",0-3*b.y/4),e.setAttribute("width",4*b.x/3),e.setAttribute("height",b.y/1),e.setAttribute("rx",1),e.style.fill="url(#"+c+")",e.style.stroke="black",e.style.strokeWidth=.25,this.svgObj.appendChild(e)}else if("wagon"===a){for(this.polyChassisPoints=[new Vec(this.rect.x+this.rect.width/8,this.rect.y-this.rect.height/8),new Vec(this.rect.x,this.rect.y-this.rect.height/16),new Vec(this.rect.x,this.rect.y+19*this.rect.height/16),new Vec(this.rect.x+this.rect.width/4,this.rect.y+5*this.rect.height/4),new Vec(this.rect.x+3*this.rect.width/4,this.rect.y+5*this.rect.height/4),new Vec(this.rect.x+this.rect.width,this.rect.y+19*this.rect.height/16),new Vec(this.rect.x+this.rect.width,this.rect.y-this.rect.height/16),new Vec(this.rect.x+7*this.rect.width/8,this.rect.y-this.rect.height/8)],f="M "+this.polyChassisPoints[0].x+","+this.polyChassisPoints[0].y,g=0;g<this.polyChassisPoints.length;g++)f+=" L "+this.polyChassisPoints[g].x+","+this.polyChassisPoints[g].y;f+=" L "+this.polyChassisPoints[0].x+","+this.polyChassisPoints[0].y,this.svgChassis.setAttribute("d",f),this.svgChassis.style.fill="url(#"+c+")",this.svgChassis.style.stroke="black",this.svgChassis.style.strokeWidth=.25,this.svgObj.appendChild(this.svgChassis),d=document.createElementNS(svgNS,"rect"),d.setAttribute("x",-b.x+.25),d.setAttribute("y",0-b.y),d.setAttribute("width",2*b.x-.5),d.setAttribute("height",7*b.y/4),d.setAttribute("rx",1),d.style.fill="url(#screen1)",d.style.stroke="black",d.style.strokeWidth=.25,this.svgObj.appendChild(d),e=document.createElementNS(svgNS,"rect"),e.setAttribute("x",0-5*b.x/6),e.setAttribute("y",0-7*b.y/8),e.setAttribute("width",5*b.x/3),e.setAttribute("height",4*b.y/3),e.setAttribute("rx",1),e.style.fill="url(#"+c+")",e.style.stroke="black",e.style.strokeWidth=.25,this.svgObj.appendChild(e)}else if("sedan"!==a&&a){if("pickup"===a){for(this.polyChassisPoints=[new Vec(this.rect.x+this.rect.width/8,this.rect.y-this.rect.height/8),new Vec(this.rect.x,this.rect.y),new Vec(this.rect.x,this.rect.y+9*this.rect.height/8),new Vec(this.rect.x+this.rect.width/4,this.rect.y+5*this.rect.height/4),new Vec(this.rect.x+3*this.rect.width/4,this.rect.y+5*this.rect.height/4),new Vec(this.rect.x+this.rect.width,this.rect.y+9*this.rect.height/8),new Vec(this.rect.x+this.rect.width,this.rect.y),new Vec(this.rect.x+7*this.rect.width/8,this.rect.y-this.rect.height/8)],f="M "+this.polyChassisPoints[0].x+","+this.polyChassisPoints[0].y,g=0;g<this.polyChassisPoints.length;g++)f+=" L "+this.polyChassisPoints[g].x+","+this.polyChassisPoints[g].y;f+=" L "+this.polyChassisPoints[0].x+","+this.polyChassisPoints[0].y,this.svgChassis.setAttribute("d",f),this.svgChassis.style.fill="url(#"+c+")",this.svgChassis.style.stroke="black",this.svgChassis.style.strokeWidth=.25,this.svgObj.appendChild(this.svgChassis),d=document.createElementNS(svgNS,"rect"),d.setAttribute("x",-b.x+.25),d.setAttribute("y",0),d.setAttribute("width",2*b.x-.5),d.setAttribute("height",b.y/1),d.setAttribute("rx",1),d.style.fill="url(#screen1)",d.style.stroke="black",d.style.strokeWidth=.25,this.svgObj.appendChild(d),e=document.createElementNS(svgNS,"rect"),e.setAttribute("x",0-2*b.x/3),e.setAttribute("y",0-1*b.y/8),e.setAttribute("width",4*b.x/3),e.setAttribute("height",7*b.y/8),e.setAttribute("rx",1),e.style.fill="url(#"+c+")",e.style.stroke="black",e.style.strokeWidth=.25,this.svgObj.appendChild(e);var h=document.createElementNS(svgNS,"rect");h.setAttribute("x",-b.x+.5),h.setAttribute("y",-b.y),h.setAttribute("width",2*b.x-1),h.setAttribute("height",15*b.y/16),h.setAttribute("rx",.1),h.style.fill="#757161",h.style.stroke="black",h.style.strokeWidth=.25,this.svgObj.appendChild(h)}}else{for(this.polyChassisPoints=[new Vec(this.rect.x+this.rect.width/8,this.rect.y-this.rect.height/8),new Vec(this.rect.x,this.rect.y),new Vec(this.rect.x,this.rect.y+19*this.rect.height/16),new Vec(this.rect.x+this.rect.width/4,this.rect.y+5*this.rect.height/4),new Vec(this.rect.x+3*this.rect.width/4,this.rect.y+5*this.rect.height/4),new Vec(this.rect.x+this.rect.width,this.rect.y+19*this.rect.height/16),new Vec(this.rect.x+this.rect.width,this.rect.y),new Vec(this.rect.x+7*this.rect.width/8,this.rect.y-this.rect.height/8)],f="M "+this.polyChassisPoints[0].x+","+this.polyChassisPoints[0].y,g=0;g<this.polyChassisPoints.length;g++)f+=" L "+this.polyChassisPoints[g].x+","+this.polyChassisPoints[g].y;f+=" L "+this.polyChassisPoints[0].x+","+this.polyChassisPoints[0].y,this.svgChassis.setAttribute("d",f),this.svgChassis.style.fill="url(#"+c+")",this.svgChassis.style.stroke="black",this.svgChassis.style.strokeWidth=.25,this.svgObj.appendChild(this.svgChassis),d=document.createElementNS(svgNS,"rect"),d.setAttribute("x",-b.x+.25),d.setAttribute("y",0-3*b.y/4),d.setAttribute("width",2*b.x-.5),d.setAttribute("height",13*b.y/8),d.setAttribute("rx",1),d.style.fill="url(#screen1)",d.style.stroke="black",
d.style.strokeWidth=.25,this.svgObj.appendChild(d),e=document.createElementNS(svgNS,"rect"),e.setAttribute("x",0-5*b.x/6),e.setAttribute("y",0-1*b.y/2),e.setAttribute("width",5*b.x/3),e.setAttribute("height",7*b.y/6),e.setAttribute("rx",1),e.style.fill="url(#"+c+")",e.style.stroke="black",e.style.strokeWidth=.25,this.svgObj.appendChild(e)}},Car.prototype.kill=function(){var a=document.getElementById(this.carId);svg1.removeChild(a)},Car.prototype.damagePoint=function(a,b,c,d){for(var e=(Vec.rotate(a,this.angle),0),f=1e4,g=0;g<d.length;g++){var h=Math.sqrt(Math.pow(c.x-d[g].x,2)+Math.pow(c.y-d[g].y,2));f>h&&(e=g,f=h)}var i=0;return i=3===e||4===e?4*b:2===e||5===e?1*b:b/4,this.health+=i,this.health<0&&!this.dead&&(this.dead=!0,addFire(this),aa.play("bigExplosion")),i},Car.prototype.setThrottle=function(a){if(this.oldThrottle!==a)for(var b=0;2>b;b++)this.brakes[b].style.fill=0>a?"#ff0000":"#660000";this.oldThrottle=a,Vehicle.prototype.setThrottle.call(this,a)},Car.prototype.init=function(a){Car.prototype.update.call(this,a)},Car.prototype.update=function(a){this.health<500&&this.smokeTimer<0&&(addSmoke(this.position.x,this.position.y),this.health<=0?this.smokeTimer=30:this.health<200?this.smokeTimer=70:this.smokeTimer=100),this.smokeTimer--,updateGradient(this.gradient,this),Vehicle.prototype.update.call(this,a);for(var b=0;2>b;b++){var c=this.wheels[b].getAttachPoint();this.wheelSvgs[b].svgObj.setAttribute("transform","rotate("+180*this.wheels[0].steeringAngle/Math.PI+" "+(c.x+.5)+" "+(c.y+.8)+")")}this.svgObj.setAttribute("transform","translate ("+this.position.x+" "+this.position.y+") rotate("+180*this.angle/Math.PI+" 0 0)")},Car.prototype.checkBounds=function(){},CarAi.prototype=Object.create(Car.prototype),CarAi.prototype.constructor=CarAi,CarAi.prototype.getAngleToCar=function(a){return Math.atan2(a.position.y-this.position.y,a.position.x-this.position.x)-Math.PI/2},CarAi.prototype.attackTarget=function(a){var b=this.getAngleToCar(this.target)+(0>a?Math.PI:0);b=0>b?b+2*Math.PI:b,b=b>2*Math.PI?b-2*Math.PI:b,this.angle=this.angle<0?this.angle+2*Math.PI:this.angle,this.angle=this.angle>2*Math.PI?this.angle-2*Math.PI:this.angle,Math.abs(this.angle-b)<.2?(this.setSteering(0),this.setThrottle(.7*a)):this.angle>b?(this.setSteering(1*a),this.setThrottle(.5*a)):(this.setSteering(-1*a),this.setThrottle(.5*a))},CarAi.prototype.update=function(a){if(this.health>0){if(this.frameCount%360===0){var b=Math.floor(Math.random()*cars.length);cars[b]!==this&&(this.target=cars[b])}"circles"===this.personality?(this.setSteering(-1),this.setThrottle(1)):"kamikazi"===this.personality?this.attackTarget(1):"rearakazi"===this.personality?this.attackTarget(-1):"erratic"===this.personality?Math.floor(this.frameCount/360)%2===1?this.attackTarget(1):this.attackTarget(-1):"stopngo"===this.personality&&Math.floor(this.frameCount/240)%2===1&&this.attackTarget(-1)}this.frameCount++,Car.prototype.update.call(this,a)},CarPlayer.prototype=Object.create(Car.prototype),CarPlayer.prototype.constructor=CarPlayer,CarPlayer.prototype.update=function(a){Car.prototype.update.call(this,a)},CarPlayer.prototype.damagePoint=function(a,b,c,d){Car.prototype.damagePoint.call(this,a,b,c,d),healthBar.setAttribute("width",Math.max(0,this.health/1e3*healthBarMaxWidth))};var DEFS_AI={"default":{color_pri:"#8595A1",color_sec:"#DEEED6",body:"sedan",width:4,height:7,mass:5},kamikazi:{color_pri:"#D27D2C",color_sec:"#DAD45E",body:"sedan",width:5,height:7,mass:5},stopngo:{color_pri:"#8595A1",color_sec:"#DEEED6",body:"sport",width:5,height:7,mass:5},rearakazi:{color_pri:"#346524",color_sec:"#6DAA2C",body:"wagon",width:5,height:9,mass:7},erratic:{color_pri:"#442434",color_sec:"#D04648",body:"pickup",width:5,height:9,mass:7},circles:{color_pri:"#442434",color_sec:"#D04648",body:"sport",width:5,height:8,mass:7}},DEF_LEVELS={0:{position:{x:60,y:60,angle:Math.PI/2},opponents:[{x:90,y:60,angle:Math.PI/2,ai:null}]},1:{position:{x:40,y:50,angle:Math.PI/2},opponents:[{x:160,y:50,angle:Math.PI/2,ai:"kamikazi"}]},2:{position:{x:40,y:50,angle:Math.PI/2},opponents:[{x:160,y:30,angle:Math.PI/2,ai:"kamikazi"},{x:160,y:70,angle:Math.PI/2,ai:"kamikazi"}]},3:{position:{x:40,y:50,angle:Math.PI/2},opponents:[{x:160,y:30,angle:Math.PI/2,ai:"kamikazi"},{x:160,y:50,angle:-Math.PI/2,ai:"erratic"},{x:160,y:70,angle:-Math.PI/2,ai:"rearakazi"},{x:40,y:30,angle:-Math.PI/2,ai:"kamikazi"},{x:40,y:70,angle:Math.PI/2,ai:"stopngo"}]}},DEFS_SOUNDS={explosion:"3,,0.2218,0.4695,0.2272,0.0636,,,,,,,,,,0.5301,,,1,,,,,0.5"};Line.prototype.setPosition=function(a,b,c,d){this.svgObj.setAttribute("d","M "+a+","+b+" L "+c+","+d)},Line.prototype.setColor=function(a){this.svgObj.style.stroke=a};var socket={},connected=!1,playerName="Player "+Math.random().toString().replace(/.*\./,""),car,cars=[],walls=[],smoke=[],smokeCounter=0,texts=[],textsCounter=0,fire=[],fireCounter=0,curLevel=0,frame=0,countDown,ARENA_WIDTH=192,ARENA_HEIGHT=108,svgNS="http://www.w3.org/2000/svg",svgEffects,healthBar,healthBarMaxWidth,selectBox,score=0,scoreText,playersText,aa,keepPlaying=!0,loading=!1,highScores=[],hasTouch=!!("ontouchstart"in window);navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate;var highScoreDiv,splashDiv,mudCanvas;Vec.prototype.getMagnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Vec.add=function(a,b){return new Vec(a.x+b.x,a.y+b.y)},Vec.prototype.add=function(a){return new Vec(this.x+a.x,this.y+a.y)},Vec.subtract=function(a,b){return new Vec(a.x-b.x,a.y-b.y)},Vec.prototype.subtract=function(a){return new Vec(this.x-a.x,this.y-a.y)},Vec.multiply=function(a,b){return new Vec(a.x*b,a.y*b)},Vec.divide=function(a,b){return new Vec(a.x/b,a.y/b)},Vec.dotProduct=function(a,b){return a.x*b.x+a.y*b.y},Vec.prototype.dotProduct=function(a){return this.x*a.x+this.y*a.y},Vec.crossProduct=function(a,b){return a.x*b.y-a.y*b.x},Vec.reverse=function(a){return new Vec(-a.x,-a.y)},Vec.prototype.normalize=function(){var a=this.getMagnitude();this.x/=a,this.y/=a},Vec.getNormal=function(a,b){var c=new Vec(-(a.y-b.y),a.x-b.x);return c.normalize(),c},Vec.prototype.getHeading=function(){return Math.atan2(this.y,this.x)},Vec.prototype.rotate=function(a){var b=this.x,c=this.y;this.x=b*Math.cos(a)-c*Math.sin(a),this.y=b*Math.sin(a)+c*Math.cos(a)},Vec.rotate=function(a,b){var c=new Vec(a.x,a.y),d=a.x,e=a.y;return c.x=d*Math.cos(b)-e*Math.sin(b),c.y=d*Math.sin(b)+e*Math.cos(b),c},Vec.prototype.getAngle=function(){return Math.atan2(this.y,this.x)},Vec.prototype.project=function(a){var b=Vec.dotProduct(this,a);return Vec.multiply(vec,b)},Vec.prototype.project=function(a){var b=Vec.dotProduct(this,a);return{vec:Vec.multiply(a,b),mag:b}};var KEY_LEFT,KEY_RIGHT,KEY_UP,KEY_DOWN,KEY_SPACE;ArcadeAudio.prototype.add=function(a,b,c){this.sounds[a]=[],c.forEach(function(c,d){this.sounds[a].push({tick:0,count:b,pool:[]});for(var e=0;b>e;e++){var f=new Audio;f.src=jsfxr(c),this.sounds[a][d].pool.push(f)}},this)},ArcadeAudio.prototype.play=function(a){var b=this.sounds[a],c=b.length>1?b[Math.floor(Math.random()*b.length)]:b[0];c.pool[c.tick].play(),c.tick<c.count-1?c.tick++:c.tick=0},ArcadeAudio.prototype.loop=function(a){var b=this.sounds[a],c=b.length>1?b[Math.floor(Math.random()*b.length)]:b[0],d=c.tick;return c.pool[d].loop=!0,c.pool[d].play(),c.tick<c.count-1?c.tick++:c.tick=0,d},ArcadeAudio.prototype.volume=function(a,b,c){var d=this.sounds[a],e=d.length>1?d[Math.floor(Math.random()*d.length)]:d[0];e.pool[b].volume=c},ArcadeAudio.prototype.stop=function(a,b){var c=this.sounds[a],d=c.length>1?c[Math.floor(Math.random()*c.length)]:c[0];d.pool[b].loop=!1},ArcadeAudio.prototype.speed=function(a,b,c,d){var e=this.sounds[a],f=e.length>1?e[Math.floor(Math.random()*e.length)]:e[0],g=0;c>10?g=.4:c>8?g=.3:c>6?g=.2:c>4?g=.15:c>2&&(g=.1),f.pool[b].playbackRate=.5+Math.abs(d/4)+3*g,f.pool[b].volume=d?.4:.25};var synth=new SfxrSynth;window.jsfxr=function(a){synth._params.setSettings(a);var b=synth.totalReset(),c=new Uint8Array(4*((b+1)/2|0)+44),d=2*synth.synthWave(new Uint16Array(c.buffer,44),b),e=new Uint32Array(c.buffer,0,44);e[0]=1179011410,e[1]=d+36,e[2]=1163280727,e[3]=544501094,e[4]=16,e[5]=65537,e[6]=44100,e[7]=88200,e[8]=1048578,e[9]=1635017060,e[10]=d,d+=44;for(var f=0,g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h="data:audio/wav;base64,";d>f;f+=3){var i=c[f]<<16|c[f+1]<<8|c[f+2];h+=g[i>>18]+g[i>>12&63]+g[i>>6&63]+g[63&i]}return h};