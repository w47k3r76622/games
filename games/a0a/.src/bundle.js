var Tetris=function(e){var t={};function s(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}([function(e,t,s){e.exports=s(1)},function(e,t,s){const n=s(2);e.exports=n.app},function(e,t,s){"use strict";function n(e){const t=document.createElement("canvas");let s=this.ctx=t.getContext("2d");t.width=this.width=320,t.height=this.height=180,e.appendChild(t),r(e,t,s);const n=document.createElement("canvas");this.fontCtx=n.getContext("2d"),this.fontCtx.imageSmoothingEnabled=!1,n.width=1600,n.height=900,e.appendChild(n),r(e,n,this.fontCtx),window.addEventListener("resize",()=>{r(e,t,s),r(e,n,this.fontCtx)})}function r(e,t,s){const n=e.getBoundingClientRect();let r=n.width,a=r/(16/9);n.height<a&&(a=n.height,r=a*(16/9)),t.style.width=r+"px",t.style.height=a+"px",s.imageSmoothingEnabled=!1}function a(e,t){let s=e.ctx,n=e.fontCtx,r=0,a=0;this.font=(e,t)=>{n.font=`${t}px ${e}`,n.textBaseline="middle"},this.fill=e=>{s.fillStyle=e},this.clear=()=>{n.clearRect(0,0,1600,900),s.clearRect(0,0,320,180)},this.clearfont=(e,t,s,r)=>{n.clearRect(5*e,5*t,5*s,5*r)},this.fr=(e,t,n,r)=>{s.fillRect(e,t,n,r)},this.print=(e,t,s)=>{t+=r,s+=a,n.fillText(e,5*t,5*s)},this.camera=(e=0,t=0)=>{r=e,a=t},this.sspr=(e,n,i,o,l,d,h=i,c=o)=>{l=Math.floor(l+r),d=Math.floor(d+a),s.drawImage(t,e,n,i,o,l,d,h,c)}}function i(e){this.start=t=>{let s=new Image;s.onload=()=>{t(s)},s.src=e}}function o(e){function t(){e(),requestAnimationFrame(t)}this.start=()=>{t()}}function l(){this.init=()=>{},this.update=()=>{},this.draw=()=>{}}function d(){let e;this.maxLevel=c.length-1,this.level=t=>{t=c.length-t-1,e=c[t].replace(/^\n|\n$/g,"").split("\n"),this.maxMoves=h[t]},this.mget=(t,s)=>e[s][t]}s.r(t),s.d(t,"app",(function(){return O}));const h=[45,74,45,57,19,12,11,7,7,5],c=["\nH.V...\nO..JH.\n.....J\n@J..V.\nV.H...\n..QB..\n","\nVB..H.\n.B....\nH.JB..\n@..H..\nH..O.V\nQQ....\n","\n...O.V\nVO....\n...H..\n@H.JJJ\nH.....\nH.....\n  ","\nVJ....\n..O.H.\n....O.\n@.JJ..\nH...O.\nH.....\n","\n.Bbb.J\n.J.J..\nVj..V.\n.j...J\nBbbOo.\n@o.oo.\n","\nHh.Bbb\nOoJBbb\noojBbb\n@.jBbb\n.HhBbb\n.HhBbb\n","\n.B..H.\n...J..\n.....J\n@.....\n...V..\nB...H.\n","\n....Hh\n......\n@....V\n.....v\n......\n....Hh\n","\n......\n......\n@.Vv..\n......\n......\n......\n","\n......\n......\n......\n@.....\n......\n......\n"],f={sx:64,sy:48,sw:16,sh:16,dw:16,dh:16,w:1,h:1},p={sx:0,sy:48,sw:16,sh:16,dw:16,dh:16,w:1,h:1},u={sx:0,sy:64,sw:32,sh:16,dw:32,dh:16,w:2,h:1},w={sx:0,sy:80,sw:16,sh:32,dw:16,dh:32,w:1,h:2},k={sx:16,sy:48,sw:48,sh:16,dw:48,dh:16,w:3,h:1},b={sx:16,sy:80,sw:16,sh:48,dw:16,dh:48,w:1,h:3},m={sx:32,sy:64,sw:32,sh:32,dw:32,dh:32,w:2,h:2};let x=["up","down","left","right"];function v(e,t){let s,n,r,{g:a,e:i}=t,o=!0;this.init=e=>{let t,a;o=!1,s=[],n={s:0,prevBlocks:[]},r={moves:0,maxMoves:e.maxMoves||0,addMoveX:0,addMoveY:0,shakeBiasX:0,shakeBiasY:0,shakeX:0,shakeTarget:0,shakeTimer:0,shakeY:0,shakeTargetY:0};for(let s=0;s<6;s++)for(let n=0;n<6;n++)switch(e.mget(s,n)){case"@":t=s,a=n;break;case"O":l(m,s,n);break;case"V":l(w,s,n);break;case"H":l(u,s,n);break;case"B":l(k,s,n);break;case"J":l(b,s,n);break;case"Q":l(p,s,n)}n.block=l(f,t,a),n.nextBlock=d()};const l=(e,t,n)=>{let r={};for(let e of x)r[e]={addTimer:0,add:!1,value:!1};let a={t:e,x:t,y:n,dx:0,dy:0,addXTimer:0,addYTimer:0,allows:r};return s.push(a),a},d=()=>{let e=s.indexOf(n.block);return s[(e+1)%s.length]},h=e=>{let t=n.block.allows[e];return t.addTimer>0?t.add:t.value},c=(e,t,n)=>{let r=y(e);if(r.x+=t,r.y+=n,r.x<0||r.x+r.w>6||r.y<0||r.y+r.h>6)return!0;for(let t of s){if(e===t)continue;if(M(r,y(t)))return!0}return!1};function v(e){let t={};if(n.block===e)t.up=!c(n.block,0,-1),t.left=!c(n.block,-1,0),t.right=!c(n.block,1,0),t.down=!c(n.block,0,1);else for(let e of x)t[e]=!1;e.addXTimer>0&&(e.addXTimer--,0===e.addXTimer&&(r.addMoveX=e.dx,e.x+=e.dx,e.dx=0)),e.addYTimer>0&&(e.addYTimer--,0===e.addYTimer&&(r.addMoveY=e.dy,e.y+=e.dy,e.dy=0));for(let s of x){let n=e.allows[s];n.addTimer>0?(n.addTimer--,0===n.addTimer&&(n.value=n.add)):n.value&&!t[s]?(n.add=t[s],n.addTimer=10):!n.value&&t[s]&&(n.value=t[s])}}function B(e){let t=(1-e.addXTimer/10)*e.dx*16,s=(1-e.addYTimer/10)*e.dy*16;a.sspr(e.t.sx,e.t.sy,e.t.sw,e.t.sh,96+16*(e.x+1)+t,40+16*(e.y+1)+s)}function X(e){let t=(1-e.addXTimer/10)*e.dx*16,s=(1-e.addYTimer/10)*e.dy*16;if(e.allows.right.value){let r=Math.floor(3*(1-e.allows.right.addTimer/10))%3;a.sspr(176+16*r,0,16,16,t+96+16*e.x+e.t.dw+16+4*Math.sin(n.s%30/30*Math.PI)-2,s+40+16*(e.y+1)+e.t.dh/2-8,16,16)}if(e.allows.left.value){let r=Math.floor(3*(1-e.allows.left.addTimer/10))%3;a.sspr(176+16*r,16,16,16,t+96+16*(e.x+1)-16-4*Math.sin(n.s%30/30*Math.PI)+2,s+40+16*(e.y+1)+e.t.dh/2-8,16,16)}if(e.allows.up.value){let r=Math.floor(3*(1-e.allows.up.addTimer/10))%3;a.sspr(176+16*r,32,16,16,t+96+16*(e.x+1)+e.t.dw/2-8,s+40+16*(e.y+1)-16-4*Math.sin(n.s%30/30*Math.PI)+2,16,16)}if(e.allows.down.value){let r=Math.floor(3*(1-e.allows.down.addTimer/10))%3;a.sspr(176+16*r,48,16,16,t+96+16*(e.x+1)+e.t.dw/2-8,s+40+16*e.y+e.t.dh+16+4*Math.sin(n.s%30/30*Math.PI)-2,16,16)}}this.update=()=>{if(o)return;if(n.s++,0==n.block.addXTimer&&0==n.block.addYTimer)if(i.p.right?h("right")&&(n.block.dx=1,n.block.addXTimer=10):i.p.left?h("left")&&(n.block.dx=-1,n.block.addXTimer=10):i.p.up?h("up")&&(n.block.dy=-1,n.block.addYTimer=10):i.p.down&&h("down")&&(n.block.dy=1,n.block.addYTimer=10),i.p.c)n.prevBlocks[n.prevBlocks.length-1]!==n.block&&n.prevBlocks.push(n.block),n.block=n.nextBlock,n.nextBlock=d();else if(i.p.x){let e=n.prevBlocks.pop();e&&(n.nextBlock=n.block,n.block=e)}for(let e of s)v(e);n.block.t===f&&5===n.block.x&&3===n.block.y&&(o=!0,e.nextLevel());let t=!0;for(let e of x)if(h(e)){t=!1;break}t&&(n.block=n.nextBlock,n.nextBlock=d()),0===r.addMoveX&&0===r.addMoveY||(r.shakeBiasX=4*r.addMoveX,r.shakeBiasY=4*r.addMoveY,r.addMoveX=0,r.addMoveY=0,r.moves++,r.moves>r.maxMoves&&(r.shakeTimer=10)),r.shakeTimer>0?(r.shakeTimer--,r.shakeTarget=r.shakeBiasX+-1+2*Math.random()*1,r.shakeTargetY=r.shakeBiasY+-1+2*Math.random()*1):(r.shakeTarget=0,r.shakeTargetY=0),r.shakeX=T(r.shakeX,r.shakeTarget,2),r.shakeY=T(r.shakeY,r.shakeTargetY,2)},this.draw=()=>{r.moves>1.4*r.maxMoves&&a.camera(r.shakeX,r.shakeY),a.sspr(0,0,16,16,96,40),a.sspr(32,0,16,16,208,40),a.sspr(0,32,16,16,96,152),a.sspr(32,32,16,16,208,152);for(let e=0;e<6;e++){a.sspr(16,0,16,16,96+16*(e+1),40),a.sspr(16,32,16,16,96+16*(e+1),152),a.sspr(0,16,16,16,96,40+16*(e+1)),a.sspr(32,16,16,16,208,40+16*(e+1));for(let t=0;t<6;t++)a.sspr(16,16,16,16,96+16*(e+1),40+16*(t+1))}a.sspr(48,0,16,16,96,88),a.sspr(48,16,16,16,96,104),a.sspr(48,32,16,16,96,120),a.sspr(64,0,16,16,208,88),a.sspr(64,16,16,16,208,104),a.sspr(64,32,16,16,208,120);for(let e of s)B(e);for(let e of s)X(e);let e=196;e+=r.shakeX,a.sspr(0,160,48,32,e,4),a.print(`${g(r.moves)}/${g(r.maxMoves)}`,e+4,20),a.camera()}}function g(e){return e<10?"0"+e:""+e}function y(e){let t=e.y+e.dy;return{x:e.x+e.dx,y:t,w:e.t.w,h:e.t.h}}function M(e,t){return!(e.x>=t.x+t.w||t.x>=e.x+e.w||e.y>=t.y+t.h||t.y>=e.y+e.h)}function T(e,t,s){return e<t?Math.min(t,e+s):Math.max(t,e-s)}function B(e,t){let s,{g:n}=t;const r=()=>{this.onTransition(),s&&s()};let a=0,i=0,o=0;this.off=()=>0===a,this.init=e=>{s=e,a=20,i=0,o=0},this.update=()=>{a>0&&(a--,10===a&&r()),a>10?o+=32:a<20&&(i+=32)},this.draw=()=>{n.fill("#fff1e8"),n.fr(i,0,o,180),n.clearfont(i,0,o,180)}}function X(e,t){let{g:s,e:n}=t,r=0,a=!1,i=0,o=[[3,3],[4,2],[0,0],[0,0],[-4,4],[1,5],[0,0],[0,0]];this.update=()=>{n.p.c&&(r++,r%=o.length),n.p.x&&e.resetLevels(),n.p.right?o[r][0]++:n.p.left?o[r][0]--:n.p.up?o[r][1]--:n.p.down&&o[r][1]++,a=!0;for(let[e,t]of o)if(0!==e){a=!1;break}i>0?i--:a&&(i=60)},this.draw=()=>{i>30||(s.sspr(112,144,16,16,32*o[0][0]+0,32*o[0][1]+0,32,32),s.sspr(128,144,16,16,32*o[1][0]+32,32*o[1][1]+0,32,32),s.sspr(144,144,16,16,32*o[2][0]+64,32*o[2][1]+0,32,32),s.sspr(160,144,16,16,32*o[3][0]+128,32*o[3][1]+0,32,32),s.sspr(128,144,16,16,32*o[4][0]+160,32*o[4][1]+0,32,32),s.sspr(176,144,16,16,32*o[5][0]+192,32*o[5][1]+0,32,32),s.sspr(112,144,16,16,32*o[6][0]+224,32*o[6][1]+0,32,32),s.sspr(192,144,16,16,32*o[7][0]+256,32*o[7][1]+0,32,32))}}function Y(e,t){let{e:s,g:n}=t,r=0;this.update=()=>{(s.p.x||s.p.c)&&e.beginLevels(),r++},this.draw=()=>{let e=16*Math.sin(r%60/60*Math.PI*2);n.sspr(96,64,42,48,e+64,16),n.sspr(144,64,56,48,e+64+48,16),n.sspr(96,64,42,48,e+64+56+48,16),e=16*Math.sin((r-5)/60*Math.PI*2),n.sspr(96,64,42,48,e+64,16),n.sspr(144,64,56,48,e+64+48,16),n.sspr(96,64,42,48,e+64+56+48,16),e=16*Math.sin((r-10)/60*Math.PI*2),n.sspr(96,64,42,48,e+64,16),n.sspr(144,64,56,48,e+64+48,16),n.sspr(96,64,42,48,e+64+56+48,16),n.print("C - next block",160,90),n.print("X - previous block",160,106),n.print("Arrows - move block",160,122),n.print("Enter - restart level",160,138),n.print("Press X to start",160,154)}}function H(e){let t,s,{g:n,e:r}=e,a=0,i=0,o=new d,h=new v(this,e),c=(new l(this,e),new B(this,e)),f=new X(this,e),p=new Y(this,e);c.onTransition=()=>{h.init(o),t=[];for(let e=0;e<6.625;e++)for(let s=0;s<11;s++)Math.random()<.3&&t.push({l:0,i:32*e-10,j:32*s})},n.fill("#1d2b53"),this.init=()=>{t=[],i=0,o.level(i),h.init(o),s=p},this.beginLevels=()=>{i=0,o.level(i),c.init(()=>{s=h})},this.nextLevel=()=>{i++,i>o.maxLevel?c.init(()=>{s=f}):(o.level(i),c.init())},this.resetLevels=()=>{i=0,o.level(i),c.init(()=>{s=h})},this.update=()=>{a++,r.p.enter&&c.init(),c.update(),s.update();for(let e of t)e.l>0?(r.c||r.x)&&e.l--:(e.ml=120+60*Math.random()*6,e.l=e.ml),e.j=e.l/e.ml*320*4%352-32},this.draw=()=>{n.clear(),n.fill("#1d2b53"),n.fr(0,0,320,180),n.sspr(240,16,8,8,40,0,32,180),n.sspr(240,16,8,8,248,0,32,180);for(let e=0;e<28.125;e+=2)n.sspr(192,224,32,32,Math.sin(Math.sin(a%6e3/6e3*Math.PI))*Math.sin(a%600/600*Math.PI)*32*8-128,32*e*10,320,320),n.sspr(192,224,32,32,248-32*Math.sin(a%600/600*Math.PI)*4,32*e*5-10,160,160);for(let e of t)n.sspr(224,224,32,32,e.j,e.i,16,16);s.draw(),c.draw()}}function J(){let e=["up","left","right","down","x","c","enter"];this.p={};let t={};this.update=()=>{for(let s of e)this[s]&&!t[s]?this.p[s]=!0:this.p[s]=!1,t[s]=this[s]};const s=e=>{this[e]=!0},n=e=>{this[e]=!1},r=e=>{switch(e.code){case"ArrowUp":s("up");break;case"ArrowDown":s("down");break;case"ArrowLeft":s("left");break;case"ArrowRight":s("right");break;case"KeyX":s("x");break;case"KeyC":s("c");break;case"Enter":s("enter")}},a=e=>{switch(e.code){case"ArrowUp":n("up");break;case"ArrowDown":n("down");break;case"ArrowLeft":n("left");break;case"ArrowRight":n("right");break;case"KeyX":n("x");break;case"KeyC":n("c");break;case"Enter":n("enter")}};this.bind=()=>{document.addEventListener("keydown",r),document.addEventListener("keyup",a)}}function O(e,t){let s=new n(e),r=new J;r.bind(),new i("assets/sprites.png").start(e=>{let t=new a(s,e);t.font("Arial",80);let n=new H({g:t,e:r});n.init(),new o(()=>{r.update(),n.update(),n.draw()}).start()})}}]);