!function(a,b,c){"use strict";function d(a){this.v=this.t=a,this.write()}function e(){this.setSettings=function(a){for(var b=0;24>b;b++)this[String.fromCharCode(97+b)]=a[b]||0;this.c<.01&&(this.c=.01);var c=this.b+this.c+this.e;if(.18>c){var d=.18/c;this.b*=d,this.c*=d,this.e*=d}}}function f(){this._params=new e;var a,b,c,d,f,g,h,i,j,k,l,m;this.reset=function(){var a=this._params;d=100/(a.f*a.f+.001),f=100/(a.g*a.g+.001),g=1-a.h*a.h*a.h*.01,h=-a.i*a.i*a.i*1e-6,a.a||(l=.5-a.n/2,m=5e-5*-a.o),i=1+a.l*a.l*(a.l>0?-.9:10),j=0,k=1==a.m?0:(1-a.m)*(1-a.m)*2e4+32},this.totalReset=function(){this.reset();var d=this._params;return a=d.b*d.b*1e5,b=d.c*d.c*1e5,c=d.e*d.e*1e5+12,3*((a+b+c)/3|0)},this.synthWave=function(e,n){var o=this._params,p=1!=o.s||o.v,q=o.v*o.v*.1,r=1+3e-4*o.w,s=o.s*o.s*o.s*.1,t=1+1e-4*o.t,u=1!=o.s,v=o.x*o.x,w=o.g,x=o.q||o.r,y=o.r*o.r*o.r*.2,z=o.q*o.q*(o.q<0?-1020:1020),A=o.p?((1-o.p)*(1-o.p)*2e4|0)+32:0,B=o.d,C=o.j/2,D=o.k*o.k*.01,E=o.a,F=a,G=1/a,H=1/b,I=1/c,J=5/(1+o.u*o.u*20)*(.01+s);J>.8&&(J=.8),J=1-J;for(var K,L,M,N,O,P,Q=!1,R=0,S=0,T=0,U=0,V=0,W=0,X=0,Y=0,Z=0,$=0,_=new Array(1024),ab=new Array(32),bb=_.length;bb--;)_[bb]=0;for(bb=ab.length;bb--;)ab[bb]=2*Math.random()-1;for(bb=0;n>bb;bb++){if(Q)return bb;if(A&&++Z>=A&&(Z=0,this.reset()),k&&++j>=k&&(k=0,d*=i),g+=h,d*=g,d>f&&(d=f,w>0&&(Q=!0)),L=d,C>0&&($+=D,L*=1+Math.sin($)*C),L|=0,8>L&&(L=8),E||(l+=m,0>l?l=0:l>.5&&(l=.5)),++S>F)switch(S=0,++R){case 1:F=b;break;case 2:F=c}switch(R){case 0:T=S*G;break;case 1:T=1+2*(1-S*H)*B;break;case 2:T=1-S*I;break;case 3:T=0,Q=!0}x&&(z+=y,M=0|z,0>M?M=-M:M>1023&&(M=1023)),p&&r&&(q*=r,1e-5>q?q=1e-5:q>.1&&(q=.1)),P=0;for(var cb=8;cb--;){if(X++,X>=L&&(X%=L,3==E))for(var db=ab.length;db--;)ab[db]=2*Math.random()-1;switch(E){case 0:O=l>X/L?.5:-.5;break;case 1:O=1-X/L*2;break;case 2:N=X/L,N=6.28318531*(N>.5?N-1:N),O=1.27323954*N+.405284735*N*N*(0>N?1:-1),O=.225*((0>O?-1:1)*O*O-O)+O;break;case 3:O=ab[Math.abs(32*X/L|0)]}p&&(K=W,s*=t,0>s?s=0:s>.1&&(s=.1),u?(V+=(O-W)*s,V*=J):(W=O,V=0),W+=V,U+=W-K,U*=1-q,O=U),x&&(_[Y%1024]=O,O+=_[(Y-M+1024)%1024],Y++),P+=O}P*=.125*T*v,e[bb]=P>=1?32767:-1>=P?-32768:32767*P|0}return n}}function g(a){M._params.setSettings(a);var b=M.totalReset(),c=new Uint8Array(4*((b+1)/2|0)+44),d=2*M.synthWave(new Uint16Array(c.buffer,44),b),e=new Uint32Array(c.buffer,0,44);e[0]=1179011410,e[1]=d+36,e[2]=1163280727,e[3]=544501094,e[4]=16,e[5]=65537,e[6]=44100,e[7]=88200,e[8]=1048578,e[9]=1635017060,e[10]=d,d+=44;for(var f=0,g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h="data:audio/wav;base64,";d>f;f+=3){var i=c[f]<<16|c[f+1]<<8|c[f+2];h+=g[i>>18]+g[i>>12&63]+g[i>>6&63]+g[63&i]}return h}function h(a){this.img=a.img,this.w=a.w,this.h=a.h,this.fs=a.fs,this.f=0,this.ft=this.fd=100,this.r=1}function i(a,b,c,d,e){this.x=a,this.y=b,this.s=d||fb,this.spr=P.get("font"),this.set(c,e)}function j(a,b,c,d,e,f,g){this.x=a,this.y=b,this.cb=d,this.w=e||200,this.h=f||50,this.a=0,this.d=g||0,this.la=0,this.txt=new i(a,b,c,4)}function k(a,b,c,d,e){this.x=a,this.y=b,this.s=c/e,this.h=10,this.v=0,this.m=e,this.c="#"+d}function l(a){this.c=K.makeCs(),this.c.width=this.w=a.w/2,this.c.height=this.h=a.h,this.s=a.seed,this.ctx=K.ctx(this.c),this.draw(L.bgs[a.f.b||0])}function m(a){this._="map",this.x=0,this.y=0,this.d=L.map,this.f=L.mtypes[Math.floor(a/4)],this.img=P.s[this.f.t].img,this.seed=a+1,this.s=128,this.bs=16,this.pads=[],this.lakes=[],this.trees=[],this.guys=[],this.c=K.makeCs(),this.c.width=this.s*this.bs,this.c.height=ab/2,this.w=this.s*this.bs*fb,this.h=ab,this.ctx=K.ctx(this.c),K.dis(this.ctx),this.p=this.generate(this.s,ab/2,ab/8,.7),this.addChildren(),this.draw()}function n(a,b){this._="copter",this.spr=P.get("copter"),this.init(a,b),this.vx=0,this.vy=0,this.dir=1,this.a=12,this.f=.07,this.dc=100,this.dt=0,this.st=this.sc=250,this.bc=this.bt=100,this.ppl=0,this.mPpl=5,this.wtr=0,this.mWtr=50,this.hp=100,this.kills=0,this.onWater=0,this.onPad=0,this.onDmg=0,this.c=K.makeCs(),this.c.width=this.w,this.c.height=this.h,this.ctx=K.ctx(this.c),K.dis(this.ctx)}function o(a,b){this._="guy",this.spr=P.get("guy"),this.spr.f=~~(Math.random()*this.spr.fs),this.init(a,b),this.y-=this.h/2+6}function p(a){this._="bird",this.spr=P.get("bird"),this.spr.f=~~(Math.random()*this.spr.fs),this.vx=1,this.lvl=100*Math.random()+50,this.init(a,V.getHeight(a)-this.l)}function q(a,b){this._="tree",this.spr=P.get("tree"),this.init(a,b),this.y-=this.h/2,ib.play.c.push(new w(a,this.y-this.h/2-6))}function r(a,b){this._="lake",this.w=192,this.h=32,this.x=a,this.y=b}function s(a,b){this._="pad",this.spr=P.get("pad"),this.init(a,b)}function t(a){this._="water",this.spr=P.get("drop"),this.init(a.x+a.dir*a.w/2,a.y+a.h/4),this.y+=this.h/2,this.vx=a.vx+2*a.dir,this.vy=a.vy/2,this.g=11,this.f=.01}function u(a,b){this._="smoke",this.x=a,this.y=b/2,this.w=P.s.flame.w*fb,this.h=b,this.a=1,this.p=[],this.st=0,this.ms=500}function v(a,b,c){this.x=Math.round(a+(Math.random()*c-c/2)),this.y=this.sy=b,this.s=this.ss=4,this.ms=16,this.l=0,this.vy=.5*Math.round(2*Math.random())+.5}function w(a,b){this._="flame",this.spr=P.get("flame"),this.spr.f=~~(Math.random()*this.spr.fs),this.init(a,b),this.s=new u(a,b),ib.play.c.push(this.s)}function x(a){jb=a,ib[jb].init()}function y(){kb=nb=ob=0,z()}function z(){nb=ob,eb.x=eb.y=0,x("play")}function A(){"play"===jb&&(R.k.pause=0,eb.ox=eb.x,eb.oy=eb.y,eb.x=eb.y=0,ib.pause.bg=G(),ib.pause.over=H(ib.pause.bg),x("pause"))}function B(){bb.globalAlpha=1,R.k.ent=R.k.pause=0,eb.x=eb.ox,eb.y=eb.oy,jb="play"}function C(a){ib.over.won=a,a&&(nb+=Math.floor(10*ib.play.tmr.v)),eb.ox=eb.x=eb.oy=eb.y=0,ib.over.bg=G(),ib.over.over=H(ib.over.bg),x("over")}function D(){kb+1>11?C(1):(eb.ox=eb.x=eb.oy=eb.y=0,ib.next.bg=G(),ib.next.over=H(ib.next.bg),x("next"))}function E(){ob=nb,kb++,z()}function F(){eb.ox=eb.oy=0,x("menu")}function G(){var a,b=K.makeCs();return b.width=_,b.height=ab,a=K.ctx(b),a.drawImage(Y,0,0),a.drawImage(X,0,0),a.drawImage(Z,0,0),b}function H(a){var b,c,d=K.makeCs(),e=.5;for(d.width=a.width,d.height=a.height,b=K.ctx(d),b.drawImage(a,0,0),b.globalAlpha=.3,c=0;8>c;c++)b.drawImage(d,c*e,0),b.drawImage(d,0,c*e),b.drawImage(d,-c*e,0),b.drawImage(d,0,-c*e);return b.fillStyle="#000",b.fillRect(0,0,_,ab),d}function I(a){nb+=a,0>nb&&(nb=0),N.play(a>0?"points":"kill")}function J(){var a=K.timestamp();for(hb+=Math.min(1,(a-S)/1e3),S=a;hb>gb;)hb-=gb,ib[jb].update(gb),lb&&T.update();cb.clearRect(0,0,_,ab),bb.clearRect(0,0,_,ab),db.clearRect(0,0,_,ab),bb.save(),bb.translate(eb.x,eb.y),ib[jb].render(),bb.restore(),lb&&T.render(db),requestAnimationFrame(J)}var K={h2r:function(a){function b(a){return parseInt(a+""+a,16)}return{r:b(a[0]),g:b(a[1]),b:b(a[2])}},ctx:function(a){return a.getContext("2d")},makeCs:function(){return a.createElement("canvas")},getEl:function(b){return a.getElementById(b)},listen:function(a,c,d){(d||b).addEventListener(a,c)},timestamp:b.performance&&b.performance.now?function(){return b.performance.now()}:function(){return+new Date},dis:function(a){["mozImageSmoothingEnabled","webkitImageSmoothingEnabled","msImageSmoothingEnabled","imageSmoothingEnabled"].forEach(function(b){a[b]=!1})},rngs:{},rnd:function(a,b){function c(a){this.s=a}var d;return c.prototype.rnd=function(){var a=1e4*Math.sin(this.s++);return a-Math.floor(a)},(!(d=this.rngs[a])||b)&&(d=this.rngs[a]=new c(a)),d.rnd()},rndInt:function(a,b){return Math.floor(this.rnd(a)*b)},rndRange:function(a,b,c){return this.rndInt(a,c-b)+b},zrs:function(a){a+="";var b=7-a.length+1;return new Array(0>b?0:b).join("0")+a}};d.prototype.write=function(){var a=~~(this.v/60),b=Math.abs(this.v-60*a);b=(10>b?"0":"")+b,b=b.length>3?b.substr(0,4):b+".0",this.txt=a+":"+b},d.prototype.update=function(a){this.v-=a,this.v<0&&(this.v=0),this.write()};var L={width:800,height:600,bgs:[["103","527","f66"],["122","267","6c6"],["012","369","fc6"]],map:{t:["17-19","24-27",32,33,"37-41","55-58","67-69",71,72,"78-81",86,87,"94-97","103-105","108-112",118,119],l:[13,50,90],p:[4,64,123],g:[21,29,35,43,60,74,76,83,100,115]},mtypes:[{b:0,t:"rock",l:"090",d:"060"},{b:1,t:"stripes",l:"7c7",d:"143"},{b:2,t:"ice",l:"fff",d:"9cf"}],sounds:{click:{c:3,s:[0,,.1,.4,.15,.54,,,,,,.6,.6,,,,,,1,,,,,.5]},drop:{c:5,s:[3,.2,.2,.01,.4,.8,,-.25,,,,,,,,.6,,,1,,,,,.2]},points:{c:5,s:[0,,.065,.5,.5,.7,,,,,,.46,.52,,,,,,1,,,,,.5]},copter:{c:5,s:[3,.1,.1,,.5,.7,,-.3,.9,,,-.1,,,.1,.46,,,.4,.04,.3,.1,-.02,.25]},kill:{c:5,s:[0,,.3,,.12,.32,,-.12,,,,,,.16,,,,,.9,,,,,.5]},pick:{c:5,s:[1,,.02,.56,.4,.5,,,,,,,,,,,,,1,,,,,.5]},hurt:{c:5,s:[1,,.015,,.16,.28,,-.36,,,,,,,,,,,1,,,.05,,.5]}}},M=new f,N={s:{},mute:0,setMute:function(a){this.mute=a,localStorage.setItem("copter-mute",a)},play:function(a){if(!this.mute){var b=N.s[a];b.p[b.t].play(),b.t=b.t+1<b.c?b.t+1:0}}};N.mute=+localStorage.getItem("copter-mute")||0,Object.keys(L.sounds).forEach(function(a){var b,c,d=L.sounds[a];for(N.s[a]={t:0,c:d.c,p:[]},c=0;c<d.c;c++)b=new Audio,b.src=g(d.s),N.s[a].p.push(b)}),h.prototype.render=function(a,b,c,d,e,f){d=d||this.w,e=e||this.h,f=f||1,a.drawImage(this.img,this.w*this.f,0,this.w,this.h,b-d*f/2,c-e*f/2,d*f,e*f)},h.prototype.update=function(a){1!==this.fs&&(this.ft>0&&(this.ft-=1e3*a),this.ft>0||(++this.f>=this.fs&&this.r&&(this.f=0),this.ft=this.fd))};var O={bird:[0,67,45,3,5],copter:[0,18,80,18,2],drop:[17,137,5,9],flame:[0,6,88,11,8],font:[0,0,156,5],guy:[0,137,16,12,2],ice:[33,104,32,32],logo:[33,71,32,32],pad:[0,54,48,12],rock:[0,71,32,32],splash:[0,37,60,16,4],stripes:[0,104,32,32],tree:[61,37,11,20]},P={s:{},load:function(a){function b(a,b){var e=d.s[a]={img:K.makeCs(),fs:b[4]||1};e.img.width=b[2],e.img.height=b[3],e.w=b[2]/e.fs,e.h=b[3],e.img.getContext("2d").drawImage(c,b[0],b[1],b[2],b[3],0,0,b[2],b[3])}var c,d=this;c=new Image,c.onload=function(){for(var c in O)b(c,O[c]);a()},c.src="img/sprites.png"},get:function(a){return new h(this.s[a])}},Q={mix:function(a){return Object.keys(Q).forEach(function(b){"mix"!==b&&(a[b]=Q[b])}),a},init:function(a,b){this.x=a,this.y=b,this.w=this.spr.w*fb,this.h=this.spr.h*fb},getLeft:function(){return this.x-this.w/2},getRight:function(){return this.x+this.w/2},getTop:function(){return this.y-this.h/2},getBottom:function(){return this.y+this.h/2},distanceTo:function(a){return Math.sqrt((this.x-a.x)*(this.x-a.x)+(this.y-a.y)*(this.y-a.y))},hasPoint:function(a,b){return!(a<this.getLeft()||a>this.getRight()||b<this.getTop()||b>this.getBottom())},intersects:function(a){return!(this.getRight()<a.getLeft()||this.getLeft()>a.getRight()||this.getBottom()<a.getTop()||this.getTop()>a.getBottom())},mtd:function(a){var b,c,d=a.getLeft()-this.getRight(),e=a.getRight()-this.getLeft(),f=a.getTop()-this.getBottom(),g=a.getBottom()-this.getTop();return d>0||0>e||f>0||0>g?0:(b=Math.abs(d)<e?d:e,c=Math.abs(f)<g?f:g,Math.abs(b)>Math.abs(c)?b=0:c=0,{x:b,y:c})}};i.prototype.chars="abcdefghijklmnopqrstuvwxyz1234567890!?\".,'$()-:;=[]/",i.prototype.set=function(a,b){this.txt=String(a).toLowerCase().split(""),this.clr=K.h2r(b||"fff"),this.write()},i.prototype.write=function(){var a,b,c,d,e=this.spr;for(this.c=K.makeCs(),this.c.width=4*this.txt.length-1,this.c.height=e.h,c=K.ctx(this.c),this.txt.forEach(function(a,b){d=this.chars.indexOf(a),d>-1&&c.drawImage(e.img,3*d,0,3,e.h,4*b,0,3,e.h)},this),a=c.getImageData(0,0,this.c.width,e.h),b=a.data,d=0;d<b.length;d+=4)b[d]=this.clr.r,b[d+1]=this.clr.g,b[d+2]=this.clr.b;c.putImageData(a,0,0),this.w=this.c.width*this.s,this.h=e.h*this.s},i.prototype.render=function(a){a.drawImage(this.c,this.x-this.w/2,this.y-this.h/2,this.w,this.h)},j.prototype=Q.mix({update:function(){this.d||(this.a=this.hasPoint(R.mx,R.my),this.a&&!this.la&&N.play("click"),this.a&&R.mb&&(R.mb=0,this.cb()),this.la=this.a)},render:function(a){a.beginPath(),a.save(),a.shadowColor="rgba(0,0,0,0.5)",a.shadowBlur=a.shadowOffsetX=0,a.shadowOffsetY=10,a.fillStyle=this.a?"#999":"#666",a.rect(this.getLeft(),this.getTop(),this.w,this.h),a.fill(),a.restore(),a.save(),a.shadowColor="rgba(0,0,0,0.5)",a.shadowBlur=a.shadowOffsetX=0,a.shadowOffsetY=3,this.txt.render(a),a.restore(),a.strokeStyle=this.a?"#fff":"#999",a.lineWidth=4,a.stroke()}}),k.prototype.render=function(a){a.fillStyle="rgba(0, 0, 0, 0.5)",a.fillRect(this.x,this.y,this.s*this.m,this.h),a.fillStyle=this.c,a.fillRect(this.x,this.y,this.s*this.v,this.h)},l.prototype.draw=function(a){var b,c,d,e,f=this.ctx.createLinearGradient(0,0,0,this.h),g=~~(this.w*this.h/2e3),h=this.s;for(a.forEach(function(b,c){f.addColorStop(c/(a.length-1),"#"+b)}),this.ctx.fillStyle=f,this.ctx.fillRect(0,0,this.w,this.h),K.rnd(h,1),e=0;g>e;e++)this.ctx.fillStyle="rgba(255, 255, 255, "+.5*K.rnd(h)+")",b=~~(3*K.rnd(h))+1,c=K.rnd(h)*this.w,d=K.rnd(h)*this.h,this.ctx.fillRect(~~c,~~d,b,b)},m.prototype.render=function(a){a.drawImage(this.c,this.x,this.y,this.w,this.h)},m.prototype.generate=function(a,b,c,d){var e,f,g,h=Math.pow(2,Math.ceil(Math.log(a)/Math.log(2))),i=[],j=this.seed;for(i[0]=b/2+K.rnd(j,1)*c*2-c,i[h]=b/2+K.rnd(j)*c*2-c,c*=d,f=1;h>f;f*=2){for(e=h/f/2,g=e;h>g;g+=h/f)i[g]=(i[g-e]+i[g+e])/2,i[g]+=K.rnd(j)*c*2-c,i[g]=i[g]>.9*b?.9*b:i[g]<.2*b?.2*b:i[g];c*=d}return i},m.prototype.makeChildren=function(){},m.prototype.addChildren=function(){var a=this.d;a.l.forEach(this.makeLake,this),a.p.forEach(this.makePad,this),a.t.forEach(this.makeTree,this),a.g.forEach(this.makeGuy,this)},m.prototype.makeLake=function(a){var b=this.p,c=Math.round((b[a-3]+b[a-2]+b[a-1]+b[a]+b[a+1]+b[a+2]+b[a+3])/7);b[a-3]=b[a+3]=c,b[a-2]=b[a+2]=c+12,b[a-1]=b[a+1]=b[a]=c+16,this.lakes.push(new r(a*this.bs*fb,c*fb))},m.prototype.makePad=function(a){var b=this.p,c=Math.round(b[a]);b[a-1]=b[a+1]=b[a]=c,this.pads.push(new s(a*this.bs*fb,c*fb))},m.prototype.makeTree=function(a){var b;if("string"==typeof a)for(a=a.split("-"),b=+a[0];b<=+a[1];b++)this.trees.push(new q(b*this.bs*fb,this.p[b]*fb));else this.trees.push(new q(a*this.bs*fb,this.p[a]*fb))},m.prototype.makeGuy=function(a){this.guys.push(new o(a*this.bs*fb,Math.round(this.p[a])*fb))},m.prototype.draw=function(){var a=this.ctx,b=this.c.height;a.clearRect(0,0,this.c.width,b),a.save(),a.scale(1/fb,1/fb),this.lakes.forEach(function(b){b.draw(a)}),a.restore(),a.beginPath(),a.moveTo(0,this.p[0]),this.p.forEach(function(b,c){a.lineTo(c*this.bs,b)},this),a.lineWidth=7,a.strokeStyle="#"+this.f.l,a.stroke(),a.lineTo(this.w,b),a.lineTo(0,b),a.closePath(),a.save(),a.shadowColor="#"+this.f.d,a.shadowBlur=a.shadowOffsetX=0,a.shadowOffsetY=-2,a.fillStyle=a.createPattern(this.img,"repeat"),a.fill(),a.restore();var c=a.createLinearGradient(0,2*b/3,0,b);c.addColorStop(0,"rgba(0,0,0,0)"),c.addColorStop(1,"rgba(0,0,0,0.7)"),a.fillStyle=c,a.fill(),a.save(),a.scale(1/fb,1/fb),this.pads.forEach(function(b){b.draw(a)}),this.trees.forEach(function(b){b.draw(a)}),a.restore()},m.prototype.getHeight=function(a){var b,d=this.bs*fb,e=~~((a+1)/d),f=this.p[e],g=this.p[e+1]!==c?this.p[e+1]:f,h=(a+1)%d;return 0===a||0===h||f===g?(f-3)*fb:(b=f+(g-f)*h/d,(b-3)*fb)};var R={k:{up:0,down:0,left:0,right:0,btn:0,pause:0,ent:0},m:{27:"pause",32:"btn",65:"left",68:"right",83:"down",87:"up",76:"btn",13:"ent"},mx:0,my:0,mb:0};K.listen("keydown",function(a){var b=R.m[a.keyCode];b&&(R.k[b]=1)}),K.listen("keyup",function(a){var b=R.m[a.keyCode];b&&(R.k[b]=0)}),K.listen("mousemove",function(a){R.mx=a.offsetX===c?a.layerX:a.offsetX,R.my=a.offsetY===c?a.layerY:a.offsetY},Z),K.listen("mousedown",function(){R.mb=1}),K.listen("mouseup",function(){R.mb=0}),K.listen("blur",function(){for(var a in R.k)R.k[a]=0}),n.prototype=Q.mix({update:function(a){this.spr.update(a);var b=0,c=0;this.dt>0&&(this.dt-=1e3*a),this.bt>0&&(this.bt-=1e3*a),this.snd(a),R.k.up&&c--,R.k.down&&c++,R.k.left&&b--,R.k.right&&b++,R.k.btn&&this.drop(),this.onWater&&this.pump(),this.onPad&&this.unload(),this.onDmg&&this.hurt(),b&&this.dir!==b&&(this.dir=b,this.flip()),this.vx+=b*this.a*a-this.vx*this.f,this.vy+=c*this.a*a-this.vy*this.f,this.x+=this.vx,this.y+=this.vy,this.x=this.x<0+this.w/2?0+this.w/2:this.x>V.w-this.w/2?V.w-this.w/2:this.x,this.y=this.y<0+this.h/2?0+this.h/2:this.y>V.h?V.h:this.y},drop:function(){this.dt>0||!this.wtr||this.onWater||(this.dt=this.dc,ib.play.c.push(new t(this)),this.wtr--,this.wtr<0&&(this.wtr=0))},pump:function(){this.wtr!==this.mWtr&&this.wtr++},unload:function(){this.ppl>0&&(this.ppl--,I(20))},hurt:function(){this.bt>0||(this.hp--,N.play("hurt"),this.hp<=0&&(this.dead=1),this.bt=this.bc)},snd:function(a){this.st-=1e3*a,this.st<=0&&(N.play("copter"),this.st=this.sc)},renderFrame:function(){this.spr.render(this.ctx,this.w/fb,this.h/fb,this.w,this.h)},flip:function(){this.ctx.clearRect(0,0,this.w,this.h),this.ctx.translate(this.w,0),this.ctx.scale(-1,1),this.renderFrame()},render:function(a){this.renderFrame(),a.drawImage(this.c,this.x-this.w/fb,this.y-this.h/fb)},collide:function(a){this.onPad=0,this.onWater=0,this.onDmg=0,a.forEach(function(a){var b,c,d,e,f=a._,g=this.getBottom();if("map"===f)b=a.getHeight(this.getLeft()),c=a.getHeight(this.x),d=a.getHeight(this.getRight()),(g>b||g>c||g>d)&&(this.y=Math.min(b,c,d)-this.h/2);else if(this.distanceTo(a)>_/2)return;"lake"===f&&g>a.y&&this.getLeft()>=a.getLeft()&&this.getRight()<=a.getRight()&&(this.y=a.y-this.h/2,this.onWater=1),"tree"===f&&(e=this.mtd(a))&&(this.x+=e.x,this.y+=e.y,e.x?this.vx*=-1:e.y&&(this.vy*=-1)),"pad"===f&&g>=a.getTop()&&this.x>a.getLeft()&&this.x<a.getRight()&&(this.onPad=1),"flame"!==f&&"smoke"!==f&&"bird"!==f||!this.intersects(a)||("bird"===f&&(a.dead=1),this.onDmg=1),"guy"===f&&this.intersects(a)&&this.ppl<this.mPpl&&(N.play("pick"),a.dead=1,this.ppl++)},this)}}),o.prototype=Q.mix({render:function(a){this.x>U.x+_||this.x<U.x-_||this.spr.render(a,this.x,this.y,this.w,this.h)},update:function(a){this.spr.update(a)}}),p.prototype=Q.mix({update:function(a){this.spr.update(a),this.x-=this.vx,this.x<this.w/2&&(this.dead=1),this.y=Math.round(V.getHeight(this.x)-this.lvl),this.y<20&&(this.y=20)},render:function(a){this.spr.render(a,this.x,this.y,0,0,2)}}),q.prototype=Q.mix({draw:function(a){this.spr.render(a,this.x,this.y,this.w,this.h)}}),r.prototype=Q.mix({draw:function(a){var b=a.createLinearGradient(this.x,this.y,this.x,this.y+this.h);b.addColorStop(0,"#4bf"),b.addColorStop(1,"#06b"),a.fillStyle=b,a.fillRect(this.getLeft(),this.y,this.w,this.h)}}),s.prototype=Q.mix({draw:function(a){this.spr.render(a,this.x,this.y,this.w,this.h)}}),t.prototype=Q.mix({update:function(a){this.spr.update(a),this.vx-=this.vx*this.f,this.vy+=this.g*a,this.x+=this.vx,this.y+=this.vy,(this.y>ab+this.h/2||this.spr.f>this.spr.fs)&&(this.dead=1)},render:function(a){this.spr.render(a,this.x,this.y,this.w,this.h)},collide:function(a){this.spl||a.forEach(function(a){var b,c=a._,d=this.getBottom(),e=this.x;"map"===c&&d>(b=a.getHeight(e))&&this.splash(b),"lake"===c&&e>=a.getLeft()&&e<=a.getRight()&&d>a.y&&this.splash(a.y),"tree"===c&&this.intersects(a)&&this.splash(a.y-a.h/2-1),"flame"!==c&&"bird"!==c||!this.intersects(a)||(I(10),a.s&&(a.s.dead=1),a.dead=1,this.dead=1),"guy"===c&&this.intersects(a)&&(I(-50),a.dead=1,this.dead=1)},this)},splash:function(a){N.play("drop"),this.spr=b.splash=P.get("splash"),this.spl=1,this.spr.r=0,this.spr.fd=50,this.vx=this.vy=this.g=0,this.init(this.x,a-this.spr.h)}}),u.prototype=Q.mix({update:function(a){for(var b,c=this.p.length;c--;)b=this.p[c],b.y<0?this.p.splice(c,1):b.update(a);this.st+=1e3*a,this.st>this.ms&&(this.p.push(new v(this.x,this.h,this.w)),this.st=0)},render:function(a){this.x>U.x+_||this.x<U.x-_||(a.fillStyle="#999",this.p.forEach(function(b){b.render(a)}))}}),v.prototype.update=function(){this.l=1-this.y/this.sy,this.l<0&&(this.l=0),this.s=Math.round(this.ss+(this.ms-this.ss)*this.l),this.a=1-this.l,this.y=this.y-this.vy},v.prototype.render=function(a){var b=this.s;a.save(),a.globalAlpha=this.a,a.beginPath(),a.fillRect(Math.round(this.x-b/2),Math.round(this.y-b/2),b,b),a.restore()},w.prototype=Q.mix({render:function(a){this.x>U.x+_||this.x<U.x-_||this.spr.render(a,this.x,this.y,this.w,this.h)},update:function(a){this.spr.update(a)}});var S,T,U,V,W,X=K.getEl("cm"),Y=K.getEl("cbg"),Z=K.getEl("cfg"),$=K.getEl("wrap"),_=X.width=Z.width=Y.width=$.width=L.width,ab=X.height=Z.height=Y.height=$.height=L.height,bb=K.ctx(X),cb=K.ctx(Y),db=K.ctx(Z),eb={x:0,y:0,ox:0,oy:0},fb=2,gb=1/60,hb=0,ib={},jb="",kb=0,lb=0,mb=1,nb=0,ob=0;K.dis(bb),K.dis(cb),K.dis(db),$.style.cssText="width:"+_+"px;height:"+ab+"px;margin:-"+ab/2+"px 0 0 -"+_/2+"px;",ib.menu={init:function(){lb||(this.l=P.get("logo"),this.ln=new i(_/2,ab/2+90,"pixel chinchilla studio",4),this.ls=new i(_/2,ab/2+112,"presents",2),this.lt=0),kb=nb=ob=0,bb.globalAlpha=lb?1:0,this.bStart=new j(_/2,265,"start",z),this.bCredits=new j(_/2,335,"credits",function(){x("credits")}),this.bg=new l({w:2*_,h:ab,seed:1,f:{}}),this.ui=[new i(_/2,100,"rescue copter",12),new i(_/2,155,"to the rescue!",4,"9cf"),this.bStart,this.bCredits,new i(45,465,"controls:"),new j(80,510,"w",0,40,40,1),new j(80,560,"s",0,40,40,1),new j(30,560,"a",0,40,40,1),new j(130,560,"d",0,40,40,1),new j(265,560,"space / l",0,170,40,1),new j(415,560,"esc",0,70,40,1)]},update:function(a){lb?(this.bStart.update(),this.bCredits.update(),R.k.ent&&(R.k.ent=0,z())):(bb.globalAlpha<1&&(bb.globalAlpha+=5*a),this.lt+=a,this.lt>1&&!this.s&&(N.play("points"),this.s=1),this.lt>3&&(lb=1))},render:function(){lb?(cb.drawImage(this.bg.c,0,0),this.ui.forEach(function(a){a.render(db)})):(this.l.render(bb,_/2,ab/2,0,0,4),this.ln.render(bb),this.lt>1&&this.ls.render(bb))}},ib.play={init:function(){this.c=[],nb=ob,V=new m(kb),W=new l(V),U=new n(V.pads[0].x,V.pads[0].y),this.bt=500*Math.ceil(6*Math.random()),this.tmr=new d(60),bb.globalAlpha=1,this.c.unshift(V),this.c=this.c.concat(V.pads,V.lakes,V.trees,V.guys),this.ppl=V.guys.length,this.c.push(U),mb&&(this.ttr=[new i(_/2,100,"- fill your water tank in a lake"),new i(_/2,120,"- put out the fire"),new i(_/2,140,"- pick up the survivors"),new i(_/2,160,"- unload the survivors on landing pads"),new i(_/2,180,"- avoid flames, smokes and birds"),new i(_/2,200,"good luck!")]),this.gWtr=new k(75,545,100,"4bf",U.mWtr),this.gPpl=new k(75,560,100,"090",U.mPpl),this.gPh=new k(75,575,100,"c00",U.hp),this.lPts=new i(63,20,nb,4),this.lTmr=new i(_/2,25,this.tmr.txt,6),this.ui=[new i(36,550,"water"),new i(40,565,"people"),new i(40,580,"health"),this.lPts,this.lTmr,this.gWtr,this.gPpl,this.gPh]},update:function(a){var b,c=this.c,d=c.length;for(this.tmr.v||(U.dead=1);d--;)b=this.c[d],b.dead&&("guy"===b._&&this.ppl--,c.splice(d,1));c.forEach(function(b){b.update&&b.update(a),b.collide&&b.collide(c)}),this.tmr.update(a),this.gWtr.v=U.wtr,this.gPpl.v=U.ppl,this.gPh.v=U.hp,this.lPts.set(K.zrs(nb)),this.lTmr.set(this.tmr.txt,this.tmr.v<15?"c00":this.tmr.v<30?"ff0":"fff"),this.updateScreen(a),this.ppl||U.ppl||D(),U.dead&&C(),R.k.pause&&A(),this.bt-=1e3*a,this.bt<=0&&(this.c.push(new p(U.x+_)),this.bt=1e3*Math.ceil(6*Math.random())),mb&&U.x>_&&(mb=0)},updateScreen:function(a){var b,c,d=U.x,e=U.y;b=_/2>d?d/_:d>V.w-_/2?1-(V.w-d)/_:.5,c=ab/2>e?e/ab:e>V.h-ab/2?1-(V.h-e)/ab:.5,eb.x+=(_*b-d-eb.x)*a,eb.y+=(ab*c-e-eb.y)*a},render:function(){this.c.forEach(function(a){a.render&&a.render(bb)}),this.ui.forEach(function(a){a.render(db)}),cb.save(),cb.translate(~~(eb.x/4),0),cb.drawImage(W.c,0,0),cb.restore(),mb&&this.ttr.forEach(function(a){a.render(db)})}},ib.pause={init:function(){this.bReturn=new j(_/2,265,"resume",B),this.bRestart=new j(_/2,335,"restart",z),this.bMenu=new j(_/2,405,"main menu",F),this.ui=[new i(_/2,100,"game paused",8),this.bMenu,this.bRestart,this.bReturn],bb.globalAlpha=0},update:function(a){return R.k.pause||R.k.ent?B():(this.bMenu.update(),this.bRestart.update(),this.bReturn.update(),void(bb.globalAlpha<1&&(bb.globalAlpha+=5*a)))},render:function(){cb.drawImage(this.bg,0,0),bb.drawImage(this.over,0,0),this.ui.forEach(function(a){a.render(db)})}},ib.over={won:!1,init:function(){this.bRestart=new j(_/2,265,"restart",y),this.bMenu=new j(_/2,335,"main menu",F),this.ui=[new i(_/2,100,this.won?"congratulations":"game over",8),new i(_/2,150,"your score: "+K.zrs(nb),4,"9cf"),this.bRestart,this.bMenu],bb.globalAlpha=0},update:function(a){bb.globalAlpha<1&&(bb.globalAlpha+=5*a),this.bRestart.update(),this.bMenu.update()},render:function(){cb.drawImage(this.bg,0,0),bb.drawImage(this.over,0,0),this.ui.forEach(function(a){a.render(db)})}},ib.next={init:function(){this.bReturn=new j(_/2,265,"next level",E),this.bRestart=new j(_/2,335,"restart",z),this.bMenu=new j(_/2,405,"main menu",F),this.ui=[new i(_/2,100,"level complete",8),this.bMenu,this.bRestart,this.bReturn],bb.globalAlpha=0},update:function(a){this.bMenu.update(),this.bRestart.update(),this.bReturn.update(),bb.globalAlpha<1&&(bb.globalAlpha+=5*a),R.k.ent&&(R.k.ent=0,E())},render:function(){cb.drawImage(this.bg,0,0),bb.drawImage(this.over,0,0),this.ui.forEach(function(a){a.render(db)})}},ib.credits={init:function(){this.bJS13=new j(_/2,430,"js13kgames.com",function(){location.href="http://js13kgames.com"},250),this.bClose=new j(_/2,500,"close",F,110),this.ui=[new i(_/2,50,"rescue copter",8),new i(_/2,90,"entry for js13k games 2014",2,"9cf"),new i(_/2,180,"created by",4,"9cf"),new i(_/2,220,"Greg Pabian",6),new i(_/2,260,"pixelchinchilla.com",4,"9cf"),new i(_/2,290,"twitter: gregpabian",4,"9cf"),new i(_/2,320,"github: gregpabian",4,"9cf"),this.bJS13,this.bClose]},update:function(){this.bJS13.update(),this.bClose.update()},render:function(){this.ui.forEach(function(a){a.render&&a.render(db)}),cb.drawImage(ib.menu.bg.c,0,0)}},P.load(function(){var b=a.createElement("link");b.type="image/x-icon",b.rel="shortcut icon",b.href=P.s.logo.img.toDataURL("image/x-icon"),a.head.appendChild(b),K.listen("blur",A),T=new j(_-45,ab-40,"s",function(){N.setMute(N.mute?0:1),T.txt.set(N.mute?"s:on":"s:off")},60,40),T.txt.s=2,T.txt.set(N.mute?"s:on":"s:off"),S=K.timestamp(),F(),J()})}(document,this);