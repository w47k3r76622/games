function UI(){this.elements={audio:null,audioState:null,score:null,scoreDisplay:null,best:null,bestDisplay:null,deaths:null,deathsDisplay:null},this.values={audio:"false"==localStorage.audio||"true"==localStorage.audio?JSON.parse(localStorage.audio):!0,score:0,best:0,deaths:0},this.elements.audio=document.querySelector('[data-js="audio"]'),this.elements.audioState=document.querySelector('[data-js="audio__state"]'),this.elements.audio.addEventListener("click",this.toggleAudio.bind(this),!1),this.elements.score=document.querySelector('[data-js="score"]'),this.elements.scoreDisplay=document.querySelector('[data-js="score__display"]'),this.elements.best=document.querySelector('[data-js="best"]'),this.elements.bestDisplay=document.querySelector('[data-js="best__display"]'),this.elements.deaths=document.querySelector('[data-js="deaths"]'),this.elements.deathsDisplay=document.querySelector('[data-js="deaths__display"]'),("true"!=localStorage.audio||"false"!=localStorage.audio)&&(localStorage.audio=this.values.audio),this.values.audio?(this.elements.audioState.innerHTML="ON",window.audio.setEnabled(!0)):(this.elements.audioState.innerHTML="OFF",window.audio.setEnabled(!1))}window.audio={audioCtx:null,enabled:!0,init:function(){window.AudioContext=window.AudioContext||window.webkitAudioContext,audio.audioCtx=new AudioContext},createSound:function(e,a,t){if(audio.enabled){t=t||!0;var r=audio.audioCtx.createOscillator();r.frequency.value=e,r.connect(audio.audioCtx.destination);var o=audio.audioCtx.currentTime;t?(r.start(o),r.stop(o+a)):(r.start(o+a),r.stop(o+2*a))}return audio},die:function(){audio.createSound(200,.25).createSound(300,.25)},collectPowerUp:function(){audio.createSound(500,.25,!1).createSound(600,.5,!1).createSound(700,.75,!1)},collectBomb:function(){audio.createSound(100,.1).createSound(150,.2).createSound(300,.3)},setEnabled:function(e){audio.enabled=e}},window.audio.init(),window.car={cars:[],speed:{slow:80,fast:130,difference:20},lane:{up:{fast:100,slow:210},down:{fast:430,slow:320}},car:function(){if(car.cars.length<=window.max.cars){var e={};e.lane=~~(2*Math.random())?"fast":"slow",e.direction=~~(2*Math.random())?"up":"down",e.length=~~(25*Math.random()+25),e.y="up"==e.direction?500:0-e.length,e.x="up"==e.direction?"fast"==e.lane?~~(Math.random()*(car.lane.up.fast+10-(car.lane.up.fast-10))+(car.lane.up.fast-10)):~~(Math.random()*(car.lane.up.slow+10-(car.lane.up.slow-10))+(car.lane.up.slow-10)):"fast"==e.lane?~~(Math.random()*(car.lane.down.fast+10-(car.lane.down.fast-10))+(car.lane.down.fast-10)):~~(Math.random()*(car.lane.down.slow+10-(car.lane.down.slow-10))+(car.lane.down.slow-10)),e.colour="rgb("+~~(256*Math.random())+", "+~~(256*Math.random())+", "+~~(256*Math.random())+")",e.speed="fast"==e.lane?~~(Math.random()*(car.speed.fast-(car.speed.fast-car.speed.difference))+(car.speed.fast-car.speed.difference)):~~(Math.random()*(car.speed.slow-(car.speed.slow-car.speed.difference))+(car.speed.slow-car.speed.difference)),car.cars.push(e)}},kill:function(e){car.cars.splice(e,1),~~(6*Math.random())&&new window.car.car},killAll:function(){car.cars=[]},hasCars:function(){return car.cars.length>0}};var colours=["#ebceae","#f3ccb3","#bf9084","#3f2d28"];window.player={colour:colours[~~(Math.random()*colours.length)],x:10,y:~~(480*Math.random()+10),left:!1,right:!1,up:!1,down:!1,speed:50,currentPowerUps:[],invincible:!1,timers:[],deaths:0,movement:function(e){player.left&&(player.x-=player.speed*e,player.x<=0&&(player.x+=player.speed*e)),player.right&&(player.x+=player.speed*e,player.x>=540&&(player.x-=player.speed*e)),player.up&&(player.y-=player.speed*e,player.y<=0&&(player.y+=player.speed*e)),player.down&&(player.y+=player.speed*e,player.y>=490&&(player.y-=player.speed*e))},hit:function(){if(window.car.hasCars())for(var e in window.car.cars){var a=window.car.cars[e];"undefined"!=typeof a&&(player.y>=a.y||player.y+5>=a.y||player.y-5>=a.y)&&(player.y<=a.y+a.length||player.y+5<=a.y+a.length||player.y-5<=a.y+a.length)&&(player.x>=a.x||player.x+5>=a.x||player.x-5>=a.x)&&(player.x<=a.x+20||player.x+5<=a.x+20||player.x-5<=a.x+20)&&player.die()}},collectPowerUp:function(){if(player.currentPowerUps.length<=window.max.powers)for(var e in window.points.powerUps){var a=window.points.powerUps[e];if((player.y>=a.y||player.y+10>=a.y)&&(player.y<=a.y+5||player.y+10<=a.y+5)&&(player.x>=a.x||player.x+10>=a.x)&&(player.x<=a.x+20||player.x+10<=a.x+5)){"minion"==a.power?(player.currentPowerUps.push({type:"minion",position:~~(360*Math.random())}),audio.collectPowerUp()):"bomb"==a.power?(player.currentPowerUps.push({type:"bomb",x:player.x,y:player.y,alpha:.5}),audio.collectBomb()):(player.currentPowerUps.push(a.power),audio.collectPowerUp());var t=player.currentPowerUps.length-1;if(points.killPowerUp(e),"speed"==a.power){player.speed*=2;for(var e in player.timers)"speed"==player.timers[e][0]&&clearTimeout(player.timers[e][1]);player.timers.push(["speed",setTimeout(function(){player.speed/=2,player.currentPowerUps.splice(t,1),draw.trails=[]},1e4)])}else if("invincibility"==a.power){player.invincible=!0;for(var e in player.timers)"invincibility"==player.timers[e][0]&&clearTimeout(player.timers[e][1]);player.timers.push(["invincibility",setTimeout(function(){player.invincible=!1,player.currentPowerUps.splice(t,1)},1e4)])}else"point"==a.power?points.scoreUp(1):"bomb"==a.power&&draw.explosion(a.x,a.y)}}},die:function(){if(!player.invincible){points.points>points.highScore&&(points.highScore=points.points,localStorage.highscore=points.highScore),audio.die(),player.colour=colours[~~(Math.random()*colours.length)],points.points=0,points.scoreSide="right",player.x=10,player.y=~~(480*Math.random()+10),player.deaths++,localStorage.deaths=player.deaths;for(var e in player.timers)clearTimeout(player.timers[e][1]);car.killAll(),points.killAllPowerUps(),player.speed=50,car.speed.fast=130,car.speed.slow=80,player.currentPowerUps=[]}},keyManagement:function(){document.addEventListener("keydown",function(e){kc=e.keyCode,(65==kc||37==kc)&&(player.left=!0),(68==kc||39==kc)&&(player.right=!0),(87==kc||38==kc)&&(player.up=!0),(83==kc||40==kc)&&(player.down=!0),(65==kc||37==kc||68==kc||39==kc||87==kc||38==kc||83==kc||40==kc)&&e.preventDefault()}),document.addEventListener("keyup",function(e){var a=e.keyCode;(65==a||37==a)&&(player.left=!1),(68==a||39==a)&&(player.right=!1),(87==a||38==a)&&(player.up=!1),(83==a||40==a)&&(player.down=!1),(65==a||37==a||68==a||39==a||87==a||38==a||83==a||40==a)&&e.preventDefault()})}},window.points={points:0,highScore:0,scoreSide:"right",powerUps:[],scoreUp:function(e){points.points+=e;for(var a=0;e>a;a++)new points.powerUp},score:function(){var e=1;for(var a in player.currentPowerUps)"minion"==player.currentPowerUps[a].type&&e++;player.x<=70&&player.x>=0&&"left"==points.scoreSide?(points.scoreSide="right",points.scoreUp(e)):player.x<=550&&player.x>=480&&"right"==points.scoreSide&&(points.scoreSide="left",points.scoreUp(e))},powerUp:function(e){if(points.powerUps.length<=window.max.powersOnScreen){var a={},t=["speed","invincibility","minion","point","bomb"];a.x=~~(530*Math.random()+10),a.y=~~(480*Math.random()+10),a.power=e?e:t[~~(Math.random()*t.length)],a.dashOffset=0,points.powerUps.push(a)}},hitPowerUp:function(){for(var e in window.car.cars){var a=window.car.cars[e];for(var t in window.points.powerUps){var r=window.points.powerUps[t];(r.y>=a.y||r.y+5>=a.y||r.y-5>=a.y)&&(r.y<=a.y+a.length||r.y+5<=a.y+a.length||r.y-5<=a.y+a.length)&&(r.x>=a.x||r.x+5>=a.x||r.x-5>=a.x)&&(r.x<=a.x+20||r.x+5<=a.x+20||r.x-5<=a.x+20)&&points.killPowerUp(t)}}},killPowerUp:function(e){points.powerUps.splice(e,1)},killAllPowerUps:function(){points.powerUps=[]}},window.draw={trails:[],map:function(){c.width=550,c.height=500,ctx.fillStyle="#161616",ctx.fillRect(0,0,c.width,c.height),ctx.fillStyle="#c0c0c0",ctx.fillRect(c.width/2-10,0,20,c.height),ctx.rect(70,0,0,c.height),ctx.lineWidth=20,ctx.lineDashOffset=2,ctx.setLineDash([10,20]),ctx.strokeStyle="#c0c0c0",ctx.stroke(),ctx.rect(c.width-70,0,0,c.height),ctx.lineWidth=20,ctx.lineDashOffset=2,ctx.setLineDash([10,20]),ctx.strokeStyle="#c0c0c0",ctx.stroke()},player:function(e){ctx.fillStyle=player.invincible?"#4ae9b8":player.colour,ctx.fillRect(player.x-5,player.y-5,10,10);for(var a in player.currentPowerUps){var t=player.currentPowerUps[a];"minion"==t.type?draw.minions(t,e):"bomb"==t.type?draw.explosion(t,e,a):"speed"==t&&draw.trail()}},cars:function(e){for(var a in window.car.cars){var t=window.car.cars[a];ctx.fillStyle=t.colour,ctx.fillRect(t.x,t.y,20,t.length),"up"==t.direction?t.y-=t.speed*e:t.y+=t.speed*e,"up"==t.direction?"fast"==t.lane?t.x>window.car.lane.up.fast-10&&t.x<window.car.lane.up.fast+10&&(~~(2*Math.random())?t.x+=10*e:t.x-=10*e):t.x>window.car.lane.up.slow-10&&t.x<window.car.lane.up.slow+10&&(~~(2*Math.random())?t.x+=10*e:t.x-=10*e):"fast"==t.lane?t.x>window.car.lane.down.fast-10&&t.x<window.car.lane.down.fast+10&&(~~(2*Math.random())?t.x+=10*e:t.x-=10*e):t.x>window.car.lane.down.slow-10&&t.x<window.car.lane.down.slow+10&&(~~(2*Math.random())?t.x+=10*e:t.x-=10*e),(t.y<=0-t.length||t.y>=c.height)&&window.car.kill(a)}},powerUps:function(e){for(var a in window.points.powerUps){var t=window.points.powerUps[a];ctx.fillStyle="rgba(74, 233, 184, .5)",ctx.beginPath(),ctx.arc(t.x,t.y,5,0,2*Math.PI,!0),ctx.closePath(),ctx.fill(),ctx.lineWidth=2,ctx.lineDashOffset=t.dashOffset,ctx.setLineDash([2,4]),ctx.strokeStyle="#4ae9b8",ctx.stroke(),ctx.fillStyle="#fff",ctx.textAlign="center",ctx.fillText(t.power,t.x,t.y-15),t.dashOffset+=10*e}},info:function(){UserInterface.updateScore(points.points),UserInterface.updateBest(points.highScore),UserInterface.updateDeaths(player.deaths)},minions:function(e,a){ctx.save(),ctx.translate(player.x,player.y),ctx.rotate(e.position%360*Math.PI/180),ctx.beginPath(),ctx.arc(10,10,5,0,2*Math.PI,!0),ctx.closePath(),ctx.fill(),ctx.restore(),~~(2*Math.random())?e.position+=100*a:e.position-=100*a},explosion:function(e,a){ctx.fillStyle="rgba(255, 0, 0, "+e.alpha+")",ctx.beginPath(),ctx.arc(e.x,e.y,80,0,2*Math.PI,!0),ctx.closePath(),ctx.fill(),e.alpha>=0&&(e.alpha-=a);for(var t in window.car.cars){var r=window.car.cars[t];Math.sqrt(Math.pow(Math.abs(Math.abs(r.x)-e.x),2)+Math.pow(Math.abs(Math.abs(r.y)-e.y),2))<=80&&e.alpha>0&&(window.car.kill(t),points.scoreUp(1),achievements.unlock("useBomb"))}},trail:function(){draw.trails.reverse();for(var e in draw.trails)ctx.fillRect(draw.trails[e][0]-5,draw.trails[e][1]-5,10,10);draw.trails.reverse(),draw.trails.push([player.x,player.y]),draw.trails.length>26&&(draw.trails.reverse().pop(),draw.trails.reverse())},achievement:function(e){switch(ctx.fillStyle="#fff",ctx.textAlign="right",ctx.textBaseline="top",e){case"die":ctx.fillText("I'm dead...",c.width,c.height-15);break;case"runOver":ctx.fillText("Ouch, that hurt.",c.width,c.height-15);break;case"useBomb":ctx.fillText("Bamb! Yo' dead!",c.width,c.height-15)}console.log("Unlocked:",e)}},UI.prototype={constructor:UI,toggleAudio:function(){this.values.audio?(this.elements.audioState.innerHTML="OFF",window.audio.setEnabled(!1)):(this.elements.audioState.innerHTML="ON",window.audio.setEnabled(!0)),this.values.audio=!this.values.audio,localStorage.audio=!JSON.parse(localStorage.audio)},updateScore:function(e){this.values.score=e,this.elements.scoreDisplay.innerHTML=this.values.score},updateBest:function(e){this.values.best=e,this.elements.bestDisplay.innerHTML=this.values.best},updateDeaths:function(e){this.values.deaths=e,this.elements.deathsDisplay.innerHTML=this.values.deaths}},window.UserInterface=new UI,window.max={powers:7,powersOnScreen:21,cars:14};var c=document.getElementById("board"),ctx=c.getContext("2d"),then=Date.now()/1e3,tick=function(){var e=Date.now()/1e3,a=e-then;then=e,player.movement(a),player.hit(),player.collectPowerUp(),points.score(),points.hitPowerUp(),draw.map(),draw.player(a),draw.cars(a),draw.powerUps(a),draw.info()};setInterval(tick,0),setInterval(function(){new car.car},2500),setInterval(function(){car.speed.slow++,car.speed.fast++},2500),setInterval(function(){new points.powerUp},6e4),player.keyManagement(),points.highScore=localStorage.highscore||0,player.deaths=localStorage.deaths||0;