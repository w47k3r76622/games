function Background(t){const{width:n,height:e,centerY:o}=t,{PI:i,cos:c,sin:r,abs:u,round:s,random:a}=Math,f=.5*i,l=2*i,d=8,h=30*d,g=60*(i/180),S=58,O=.5,C=1,R=100,m=300,y=2,p=6,w=51,E=10;let x,b,T=0,I=!0;const k=document.createElement("canvas"),L=k.getContext("2d");return k.width=n,k.height=e,function(){b=new Float32Array(h);for(let t=0;t<h;t+=d)A(t)}(),{update:function(){T++;for(let t=0;t<h;t+=d)B(t)},render:function(){I&&(x.save(),x.filter="blur(12px)",x.drawImage(k,0,0),x.restore(),x.drawImage(k,0,0))},reset:function(){T=0,k.width=n,k.height=e},show:function(){I=!0},hide:function(){I=!1},setContext:function(t){x=t}};function A(t){const e=U(n),i=s(U(1))?f:l-f,c=O+U(C),r=R+U(m),u=y+U(p),a=w+U(E);b.set([e,o,i,c,0,r,u,a],t)}function B(t){let n=b[t],e=b[t+1],o=b[t+2],i=b[t+3],a=b[t+4],f=b[t+5];!function(t,n,e,o,i,c){L.save();const r=.125*function(t,n){const e=.5*n;return u((t+e)%n-e)/e}(e,o);L.strokeStyle=function(t,n){return`hsla(${t},49%,46%,${n})`}(c,r),L.beginPath(),L.arc(t,n,i,0,l),L.stroke(),L.closePath(),L.restore()}(n,e,a,f,b[t+6],b[t+7]),a++,n+=c(o)*i,e+=r(o)*i;const d=!(T%s(U(S))||s(n)%6&&s(e)%6),h=s(U(1))?-1:1;o+=d?g*h:0,b[t]=n,b[t+1]=e,b[t+2]=o,b[t+4]=a,a>f&&A(t)}function U(t){return t*a()}}function getConfigs(t){const[n,e]=t,o=n/2,i=e/2;return function t(c){const r=Math.round(.618*c);const u=Math.round(.1*r);const s=16*r+8*u;if(s>n)return c=Math.round(.98*c),t(c);const a=Math.round(1.618*c);const f=Math.round(.618*c);const l=Math.round(.618*f);const d=`bold ${f}px monospace`;const h=2*c;const g=h+l;const S=o+r;const O=S+5*r+3*u;const C=o-5*r-3*u;const R=C-3*r-u;const m=[{Class:Text,config:{text:"BRING THE NUMBER BACK!",x:o,y:c,color:COLORS.c5,stroke:COLORS.c2,fontSize:r,fontFamily:"Fascinate Inline"}},{Class:Text,config:{text:"YOUR GUESS",x:S,y:h,color:COLORS.c4,stroke:COLORS.c2,fontSize:l,fontWeight:"bold",align:"left",fontFamily:"Fascinate Inline"}},{Class:Text,config:{text:"ROBOT GUESS",x:o-r,y:h,color:COLORS.c3,stroke:COLORS.c2,fontSize:l,fontWeight:"bold",align:"right",fontFamily:"Fascinate Inline"}},{Class:Text,config:{text:"SCORE",x:O,y:h,color:COLORS.c3,stroke:COLORS.c2,fontSize:l,fontWeight:"bold",align:"left",fontFamily:"Fascinate Inline"}},{Class:Text,config:{text:"SCORE",x:R+2*r+u,y:h,color:COLORS.c4,stroke:COLORS.c2,fontSize:l,fontWeight:"bold",align:"right",fontFamily:"Fascinate Inline"}}];return{width:n,height:e,centerX:o,centerY:i,initBlockY:g,rightBlockX:S,leftBlockX:C,rightBlockX1:O,leftBlockX1:R,stepHeight:a,digitBlockConfig:{dw:r,dh:c,dg:u,df:d},staticItems:m}}(Math.round(e/16))}const COLORS={c1:"#26717F",c2:"#0A4B59",c3:"#B19F3C",c4:"#F2AC29",c5:"#DB5C43"},RESULTS={USER:"You won!.A genuine triumph of the human mind!.Hit Space to beat that piece of metal again",ROBOT:"You lose.Don't sweat.Hit Space to try again.",DRAW:"It's a draw.You almost there.Hit Space to try again.",DUPLICATE_GUESS:"Oops!.You already have this variant.Think harder))",SCORE_ERROR:"Oops!.There is an error in your scores.Hit Space to restart the game."},INPUT_TYPES={GUESS:"guess",SCORE:"score"},EASINGS={IN_CUBIC:"inCubic",OUT_CUBIC:"outCubic",OUT_ELASTIC:"outElastic"};function Game(t,n,e){const{centerX:o,centerY:i,initBlockY:c,rightBlockX:r,leftBlockX:u,rightBlockX1:s,leftBlockX1:a,stepHeight:f,digitBlockConfig:l}=e,d=new Background(e),h=new Robot,g=new ResultDisplay(o,i,l),S=createTexture(l,COLORS.c4,COLORS.c1),O=createTexture(l,COLORS.c3,COLORS.c1);let C,R,m,y,p,w=!0;return{start:function(){C=0,R=[],h.start(),g.reset();const n=h.getGuess();w&&t.add(d);T(n)},toggleAnimation:function(){(w=!w)?d.show():d.hide()}};function E(t){const n=t.join("");if(m(),R.includes(n))k(RESULTS.DUPLICATE_GUESS),y.reset(),I(y,E);else{R.push(n),b(h.getScore(t))}}function x(t){m(),p=t,h.handleScore(t)?k(RESULTS.SCORE_ERROR):T()}function b(n){const e=c+C*f,o=n?s:a,i=n?COLORS.c3:COLORS.c4,r=n?O:S,u=new InputSet(INPUT_TYPES.SCORE,o,e,l,i,r);if(t.add(u),n){u.setDigits(n),1==++C&&t.add(g);const e=function(t){let n=null,e=L(t),o=L(p);o&&e?n=RESULTS.DRAW:o?n=RESULTS.ROBOT:e&&(n=RESULTS.USER);return n}(n);if(e)k(e);else{T(h.getGuess())}}else I(u,x)}function T(n){const e=c+C*f,o=n?u:r,i=n?COLORS.c3:COLORS.c4,s=n?O:S,a=new InputSet(INPUT_TYPES.GUESS,o,e,l,i,s);t.add(a),n?(a.setDigits(n),b()):I(a,E)}function I(t,e){t.activate(e),m=n.subscribe(t.onKey),y=t,d.reset()}function k(n){t.moveToTop(g),g.show(n)}function L(t){return 4===t[0]&&4===t[1]}}function Help(){const t=document.querySelector(".help-outer");let n=!0;return{toggle:function(){n=!n,t.style.display=n?"table":"none"}}}const world=new World,help=new Help,keyboard=new Keyboard,configs=getConfigs(world.getBounds()),game=new Game(world,keyboard,configs);let isFirstRun=!0;function init(){reset(),go()}function go(){game.start(),configs.staticItems.forEach(createStaticItem)}function reset(){world.reset()}function createStaticItem({Class:t,config:n}){const e=new t(n);world.add(e)}function onKey(t){t.isEscape?(isFirstRun&&(isFirstRun=!1,init()),help.toggle()):t.isSpace?init():t.isb&&game.toggleAnimation()}function InputItem(t,n,e,{dw:o,dh:i,dg:c,df:r},u,s,a){const f=n+t*(o+c),l=f+o/2,d=e+i/2,h=300;let g,S="",O=!1,C=!1,R=10*i;return{render:function(){g.fillStyle=O?COLORS.c5:u,g.fillRect(f,e,o,i),C?g.drawImage(a,0,R,o,i,f,e,o,i):(g.fillStyle=s,g.font=r,g.fillText(S,l,d))},setContext:function(t){g=t},setDigit:function(t){S=t,C=!0;const n={dy:R};tween(n,{dy:t*i},h,EASINGS.OUT_ELASTIC,function(){R=n.dy},function(){R=t*i,C=!1})},activate:function(){O=!0},deactivate:function(){O=!1}}}function InputSet(t,n,e,o,i,c){let r,u,s,a,f=null,l=[];const d=t===INPUT_TYPES.SCORE;d?(u=2,s=function(t){return t<=4}):(u=4,s=function(t){return!l.includes(t)});const{bgX:h,bgY:g,bgW:S,bgH:O}=function(t,n,e,{dw:o,dh:i,dg:c}){return{bgX:n-6,bgY:e-6,bgW:t*o+(t-1)*c+12,bgH:i+12}}(u,n,e,o),C=Array.from({length:u},(t,r)=>new InputItem(r,n,e,o,i,COLORS.c1,c));return{render:function(){a.save(),a.fillStyle=COLORS.c1,a.globalAlpha=.618,a.fillRect(h,g,S,O),a.restore(),C.forEach(t=>t.render())},setContext:function(t){a=t,C.forEach(n=>n.setContext(t))},setDigits:function(t){C.forEach((n,e)=>n.setDigit(t[e]))},activate:function(t){r=t,C[f=0].activate()},onKey:function(t){t.isDigit?function(t){if(!s(t))return;const n=l[f];if(l[f]=t,d&&m(l[0])&&m(l[1])&&(4===l[0]&&3===l[1]||!(l[0]>=l[1])))return void(l[f]=n);C[f].setDigit(t),R()}(t.digit):t.isArrowRight?R():t.isArrowLeft?function(){C[f].deactivate(),(f-=1)<0&&(f=u-1);C[f].activate()}():t.isEnter&&l.length===u&&(C[f].deactivate(),f=null,r(l))},reset:function(){l=[],C.forEach(t=>t.setDigit(""))}};function R(){C[f].deactivate(),C[f=(f+1)%u].activate()}function m(t){return Number.isInteger(t)}}function Keyboard(){let t={},n=[];return window.addEventListener("keyup",function(e){const o=Number(e.key),i={};c=e.key," "===c?i.isSpace=!0:!function(t){return Number.isInteger(t)}(o)?i[`is${e.key}`]=!0:(i.digit=o,i.isDigit=!0);var c;n.forEach(n=>t[n]&&t[n](i))}),{subscribe:function(e){const o=Date.now();return t[o]=e,n=Object.keys(t),function(){delete t[o],n=Object.keys(t)}},reset:function(){t={},n=[]}}}function ResultDisplay(t,n,{dw:e,dh:o,df:i}){let c,r="",u="",s="",a=0,f=100;const l=4e3,d=300,h=1200,g=1200,S=`bold ${.618*o*.618}px monospace`,O=16*e,C=4*o,R=t-O/2,m=n-C/2;return{render:function(){r&&(c.save(),c.globalAlpha=a,c.fillStyle=COLORS.c2,c.fillRect(R,m,O,C),c.lineWidth=6,c.strokeStyle=COLORS.c4,c.strokeRect(R,m,O,C),c.save(),f&&(c.filter=`blur(${f}px)`),c.fillStyle=COLORS.c3,c.font=i,c.fillText(r,t,n-o),c.font=S,c.fillText(u,t,n),c.fillText(s,t,n+o),c.restore(),c.restore())},reset:y,setContext:function(t){c=t},show:function(t){[r,u,s]=t.split(".");const n={alpha:0},e={blur:100};tween(n,{alpha:1},d,EASINGS.IN_CUBIC,function(){a=n.alpha},()=>{}),tween(e,{blur:0},h,EASINGS.OUT_CUBIC,function(){f=Math.round(e.blur)},function(){setTimeout(p,l)})},hide:p};function y(){a=0,f=100,r=""}function p(){const t={alpha:1};tween(t,{alpha:0},g,EASINGS.IN_CUBIC,function(){a=t.alpha,f=t.blur},y)}}function Robot(){const t=Array.from(Array(10),(t,n)=>n),n=permutations(t,4);let e,o,i;return{start:function(){e=getRandomItems(4,t),o=[...n]},handleScore:function(t){return 0===(o=reducePermutations(o,i,t[0],t[1])).length},getScore:function(t){return scoreGuess(e,t)},getGuess:function(){return i=pick(o)}}}function reducePermutations(t,n,e,o){const i=[...t];return 0===e?i.filter(function(t){return 0===t.reduce(c,0)}):i.filter(function(t){const[n,i]=t.reduce(r,[0,0]);return n===e&&i===o});function c(t,e){return-1!==n.indexOf(e)&&t++,t}function r(t,e,o){const i=n.indexOf(e);return-1!==i&&(t[0]++,i===o&&t[1]++),t}}function pick(t){return t[Math.floor(Math.random()*t.length)]}function getRandomItems(t,n){return shuffle(n).slice(0,t)}function scoreGuess(t,n){return t.reduce(function(t,e,o){const i=n.indexOf(e);-1!==i&&(t[0]+=1,i===o&&(t[1]+=1));return t},[0,0])}function permutations(t,n){const e=[];return function t(n,i,c=[]){if(c.length===i)e.push(c);else for(let e of n){const r=[...c];r.push(e);const u=o(e,n);t(u,i,r)}}(t,n),e;function o(t,n){return n.filter(n=>n!==t)}}function shuffle(t){for(let n=t.length-1;n>0;n--){const e=Math.floor(Math.random()*(n+1));[t[n],t[e]]=[t[e],t[n]]}return t}function Text({text:t="",fontFamily:n="fantasy",fontSize:e=14,align:o="center",strokeWidth:i=5,color:c,stroke:r,x:u,y:s,fontWeight:a}){let f;const l=`${a?`${a} `:""}${e}px ${n}`;return{render:function(){f.save(),f.font=l,f.textAlign=o,r&&(f.strokeStyle=r,f.lineWidth=i,f.strokeText(t,u,s));f.fillStyle=c,f.fillText(t,u,s),f.restore()},setContext:function(t){f=t},setText:function(n){t=n}}}function createTexture({dw:t,dh:n,df:e},o,i){const c=document.createElement("canvas"),r=c.getContext("2d"),u=t/2;return c.width=t,c.height=11*n,r.textAlign="center",r.textBaseline="middle",r.lineJoin="round",r.font=e,r.fillStyle=o,r.fillRect(0,0,t,c.height),r.fillStyle=i,Array.from({length:11},function(t,e){return{x:u,y:n/2+e*n,t:10===e?"":e}}).forEach(function({x:t,y:n,t:e}){r.fillText(e,t,n)}),c}function tween(t,n,e,o,i,c){const r={},u={},s=new Date,a=Object.keys(n),f={inCubic:function(t,n,e,o){return e*(t/=o)*t*t+n},outCubic:function(t,n,e,o){return e*((t=t/o-1)*t*t+1)+n},outElastic:function(t,n,e,o){let i=1.70158,c=0,r=e;return 0===t?n:1==(t/=o)?n+e:(c||(c=.3*o),r<Math.abs(e)?(r=e,i=c/4):i=c/(2*Math.PI)*Math.asin(e/r),r*Math.pow(2,-10*t)*Math.sin((t*o-i)*(2*Math.PI)/c)+e+n)}}[o];function l(n){a.forEach(o=>{t[o]=f(n,r[o],u[o],e)})}a.forEach(e=>{r[e]=t[e],u[e]=n[e]-r[e]}),function t(){let n=new Date-s;n<e?(l(n),i(),requestAnimationFrame(t)):(l(n=e),c())}()}function World(){const t=document.querySelector("canvas"),n=t.getContext("2d");let e=[],o=[];return t.width=window.innerWidth,t.height=window.innerHeight,n.textAlign="center",n.textBaseline="middle",n.lineJoin="round",requestAnimationFrame(function i(c){!function(t){o.forEach(n=>n.update(t))}(c);n.clearRect(0,0,t.width,t.height);e.forEach(t=>t.render());requestAnimationFrame(i)}),{getBounds:function(){return[t.width,t.height]},moveToTop:function(t){(e=e.filter(n=>n!==t)).push(t)},add:function(t){t.setContext(n),e.push(t),"function"==typeof t.update&&o.push(t)},remove:function(t){e=e.filter(n=>n!==t),o=o.filter(n=>n!==t)},reset:function(){e=[],o=[]}}}keyboard.subscribe(onKey);