function install_allegro(){log("Allegro installed!")}function allegro_init(){install_allegro()}function allegro_init_all(e,t,n,o,_){install_allegro(),set_gfx_mode(e,t,n),install_mouse(o),install_keyboard(_),install_sound()}function END_OF_MAIN(){window.addEventListener("load",main)}function install_mouse(e){return canvas?_mouse_installed?(_allog("Mouse already installed"),-1):(canvas.canvas.addEventListener("mouseup",_mouseup),canvas.canvas.addEventListener("mousedown",_mousedown),canvas.canvas.addEventListener("mousemove",_mousemove),canvas.canvas.addEventListener("wheel",_mousewheel),e?_menu_supress=!0:(canvas.canvas.addEventListener("contextmenu",_mousemenu),_menu_supress=!1),_mouse_installed=!0,log("Mouse installed!"),0):(_error("You must call set_gfx_mode before install_mouse"),-1)}function remove_mouse(){return _mouse_installed?(canvas.canvas.removeEventListener("mouseup",_mouseup),canvas.canvas.removeEventListener("mousedown",_mousedown),canvas.canvas.removeEventListener("mousemove",_mousemove),canvas.canvas.removeEventListener("wheel",_mousewheel),_menu_supress&&canvas.canvas.removeEventListener("contextmenu",_mousemenu),_mouse_installed=!1,log("Mouse removed!"),0):(_error("You must call install_mouse before remove_mouse"),-1)}function show_mouse(){return _mouse_installed?(canvas.canvas.style.cursor="auto",0):(_error("You must call install_mouse before show_mouse"),-1)}function hide_mouse(){return _mouse_installed?(canvas.canvas.style.cursor="none",0):(_error("You must call install_mouse before hide_mouse"),-1)}function _mousemenu(e){e.preventDefault()}function _mouseup(e){mouse_b&=~(1<<e.which-1),mouse_pressed|=1<<e.which-1,e.preventDefault()}function _mousedown(e){mouse_b|=1<<e.which-1,mouse_released|=1<<e.which-1,e.preventDefault()}function _mousemove(e){mouse_x=e.offsetX,mouse_y=e.offsetY,e.preventDefault()}function _mousewheel(e){mouse_z+=e.deltaY,e.preventDefault()}function _timer_lookup(e){for(var t=0;t<_installed_timers.length;t++)if(_installed_timers[t].timer==e)return _installed_timers[t];return-1}function SECS_TO_TIMER(e){return 1e3*e}function MSEC_TO_TIMER(e){return e}function BPS_TO_TIMER(e){return 1e3/e}function BPM_TO_TIMER(e){return 6e4/e}function install_timer(){}function time(){return(new Date).getTime()}function install_int(e,t){return install_int_ex(e,MSEC_TO_TIMER(t))}function install_int_ex(e,t){var n=window.setInterval(e,t);_installed_timers.push({timer:e,id:n}),log("Added insterrupt #"+n+" at "+t+"msec isntervals!")}function _uberloop(){if(_mouse_installed&&(mouse_mx=mouse_x-_last_mouse_x,mouse_my=mouse_y-_last_mouse_y,mouse_mz=mouse_z-_last_mouse_z),_loopproc(),_keyboard_installed)for(var e=0;128>e;e++)pressed[e]=!1,released[e]=!1;_mouse_installed&&(mouse_pressed=0,mouse_released=0,mouse_mx=0,mosue_my=0,mouse_mz=0,_last_mouse_x=mouse_x,_last_mouse_y=mouse_y,_last_mouse_z=mouse_z)}function loop(e,t){_loopproc=e;window.setInterval(_uberloop,t);log("Game loop initialised!")}function _progress_check(){for(var e=0,t=0,n=0;n<_downloadables.length;n++)e++,"snd"==_downloadables[n].type&&_downloadables[n].element.readyState>=_downloadables[n].element.HAVE_FUTURE_DATA&&(_downloadables[n].ready=!0),_downloadables[n].ready&&t++;_bar_proc&&_bar_proc(e/t),e>t?window.setTimeout(_progress_check,100):(log("Loading complete! Took "+((time()-_loader_init_time)/1e3).toFixed(1)+" seconds!"),_ready_proc())}function loading_bar(e){rectfill(canvas,5,SCREEN_H-55,SCREEN_W-10,50,makecol(0,0,0)),rectfill(canvas,10,SCREEN_H-50,SCREEN_W-20,40,makecol(255,255,255)),rectfill(canvas,15,SCREEN_H-45,SCREEN_W-30,30,makecol(0,0,0)),rectfill(canvas,20,SCREEN_H-40,scaleclamp(e,0,1,0,SCREEN_W-40),20,makecol(255,255,255))}function ready(e,t){_loader_init_time=time(),_ready_proc=e,log("Loader initialised!"),_bar_proc=t?t:loading_bar,window.setTimeout(_progress_check,100)}function remove_int(){for(var e=0;e<_installed_timers.length;e++)if(_installed_timers[e].timer==_installed_timers)return log("Removing interrupt "+_installed_timers[e].id+"!"),window.clearInterval(_installed_timers[e].id),void _installed_timers.splice(e,1)}function remove_all_ints(){for(var e=0;e<_installed_timers.length;e++)window.clearInterval(_installed_timers[e].id);_installed_timers=[],log("Removed all interrupts!")}function install_keyboard(e){if(_keyboard_installed)return _allog("Keyboard already installed"),-1;_enabled_keys=e?e:_default_enabled_keys;for(var t=0;128>t;t++)key[t]=!1,pressed[t]=!1,released[t]=!1;window.addEventListener("keyup",_keyup),window.addEventListener("keydown",_keydown),_keyboard_installed=!0,log("Keybaord installed!")}function remove_keyboard(){return _keyboard_installed?(window.removeEventListener("keyup",_keyup),window.removeEventListener("keydown",_keydown),_keyboard_installed=!1,void log("Keybaord removed!")):(_allog("Keyboard not installed"),-1)}function _keydown(e){key[e.keyCode]||(pressed[e.keyCode]=!0),key[e.keyCode]=!0,-1==_enabled_keys.indexOf(e.keyCode)&&e.preventDefault()}function _keyup(e){key[e.keyCode]=!1,released[e.keyCode]=!0,-1==_enabled_keys.indexOf(e.keyCode)&&e.preventDefault()}function BITMAP_OBJECT(){}function create_bitmap(e,t){log("Creating bitmap at "+e+" x "+t+"!");var n=document.createElement("canvas");n.width=e,n.height=t;var o=n.getContext("2d");return{w:e,h:t,canvas:n,context:o,ready:!0,type:"bmp"}}function load_bitmap(e){log("Loading bitmap "+e+"...");var t=new Image;t.src=e;var n=(time(),document.createElement("canvas")),o=n.getContext("2d"),_={canvas:n,context:o,w:-1,h:-1,ready:!1,type:"bmp"};return _downloadables.push(_),t.onload=function(){log("Bitmap "+e+" loaded, size: "+t.width+" x "+t.height+"!"),_.canvas.width=t.width,_.canvas.height=t.height,_.context.drawImage(t,0,0),_.w=t.width,_.h=t.height,_.ready=!0},_}function load_bmp(e){return load_bitmap(e)}function set_gfx_mode(e,t,n){var o=document.getElementById(e);if(!o)return _error("Can't find canvas with id "+e),-1;o.width=t,o.height=n;var _=o.getContext("2d");return SCREEN_W=t,SCREEN_H=n,canvas={w:t,h:n,canvas:o,context:_,ready:!0},font=create_font("monospace"),_gfx_installed=!0,0}function RAD(e){return-e*PI/180}function DEG(e){return 180*-e/PI}function _fillstyle(e,t){e.context.fillStyle="rgba("+getr(t)+","+getg(t)+","+getb(t)+","+getaf(t)+")"}function _strokestyle(e,t,n){n||(n=1),e.context.lineWidth=n,e.context.strokeStyle="rgba("+getr(t)+","+getg(t)+","+getb(t)+","+getaf(t)+")"}function makecol(e,t,n,o){return o||(o=255),o<<24|(255&e)<<16|(255&t)<<8|255&n}function makecolf(e,t,n,o){return o||(o=1),makecol(255*e,255*t,255*n,255*o)}function getr(e){return e>>16&255}function getg(e){return e>>8&255}function getb(e){return 255&e}function geta(e){return e>>>24}function getrf(e){return e>>16&255}function getgf(e){return e>>8&255}function getbf(e){return 255&e}function getaf(e){return(e>>>24)/255}function getpixel(e,t,n){var o=e.context.getImageData(t,n,1,1).data;return o[3]<<24|(255&o[0])<<16|(255&o[1])<<8|255&o[2]}function putpixel(e,t,n,o){_fillstyle(e,o),e.context.fillRect(t,n,1,1)}function clear_bitmap(e){_fillstyle(e,0),e.context.fillRect(0,0,e.w,e.h)}function clear_to_color(e,t){_fillstyle(e,t),e.context.fillRect(0,0,e.w,e.h)}function line(e,t,n,o,_,a,l){_strokestyle(e,a,l),e.context.beginPath(),e.context.moveTo(t,n),e.context.lineTo(o,_),e.context.stroke()}function vline(e,t,n,o,_,a){a||(a=1),_fillstyle(e,_),e.context.fillRect(t,n,a,o-n)}function hline(e,t,n,o,_,a){a||(a=1),_fillstyle(e,_),e.context.fillRect(t,n,o-t,a)}function triangle(e,t,n,o,_,a,l,r,s){_strokestyle(e,r,s),e.context.beginPath(),e.context.moveTo(t,n),e.context.lineTo(o,_),e.context.lineTo(a,l),e.context.closePath(),e.context.stroke()}function trianglefill(e,t,n,o,_,a,l,r){_fillstyle(e,r),e.context.beginPath(),e.context.moveTo(t,n),e.context.lineTo(o,_),e.context.lineTo(a,l),e.context.closePath(),e.context.fill()}function polygon(e,t,n,o,_){_strokestyle(e,o,_),e.context.beginPath();for(var a=0;t>a;a++)a?e.context.lineTo(n[2*a],n[2*a+1]):e.context.moveTo(n[2*a],n[2*a+1]);e.context.closePath(),e.context.stroke()}function polygonfill(e,t,n,o){_fillstyle(e,o),e.context.beginPath();for(var _=0;t>_;_++)_?e.context.lineTo(n[2*_],n[2*_+1]):e.context.moveTo(n[2*_],n[2*_+1]);e.context.closePath(),e.context.fill()}function rect(e,t,n,o,_,a,l){_strokestyle(e,a,l),e.context.strokeRect(t,n,o,_)}function rectfill(e,t,n,o,_,a){_fillstyle(e,a),e.context.fillRect(t,n,o,_)}function circle(e,t,n,o,_,a){_strokestyle(e,_,a),e.context.beginPath(),e.context.arc(t,n,o,0,PI2),e.context.stroke()}function circlefill(e,t,n,o,_){_fillstyle(e,_),e.context.beginPath(),e.context.arc(t,n,o,0,PI2),e.context.fill()}function arc(e,t,n,o,_,a,l,r){_strokestyle(e,l,r),e.context.beginPath(),o>_?e.context.arc(t,n,a,RAD(o),RAD(_)):e.context.arc(t,n,a,RAD(o),RAD(_)),e.context.stroke()}function arcfill(e,t,n,o,_,a,l){_fillstyle(e,l),e.context.beginPath(),o>_?e.context.arc(t,n,a,RAD(o),RAD(_)):e.context.arc(t,n,a,RAD(o),RAD(_)),e.context.fill()}function draw_sprite(e,t,n,o){e.context.drawImage(t.canvas,n,o)}function stretch_sprite(e,t,n,o,_,a){e.context.drawImage(t.canvas,0,0,t.w,t.h,n,o,_,a)}function rotate_sprite(e,t,n,o,_){e.context.save(),e.context.translate(n,o),e.context.rotate(RAD(_)),e.context.translate(-t.w/2,-t.h/2),e.context.drawImage(t.canvas,0,0),e.context.restore()}function pivot_sprite(e,t,n,o,_,a,l){e.context.save(),e.context.translate(n,o),e.context.rotate(RAD(l)),e.context.translate(-_,-a),e.context.drawImage(t.canvas,0,0),e.context.restore()}function rotate_scaled_sprite(e,t,n,o,_,a){e.context.save(),e.context.translate(n,o),e.context.rotate(RAD(_)),e.context.translate(-a*t.w/2,-a*t.h/2),e.context.drawImage(t.canvas,0,0,t.w,t.h,n,o,t.w*a,t.h*a),e.context.restore()}function pivot_scaled_sprite(e,t,n,o,_,a,l,r){e.context.save(),e.context.translate(n,o),e.context.rotate(RAD(l)),e.context.translate(-r*_,-r*a),e.context.drawImage(t.canvas,0,0,t.w,t.h,n,o,t.w*r,t.h*r),e.context.restore()}function blit(e,t,n,o,_,a,l,r){t.context.drawImage(e.canvas,n,o,l,r,_,a,l,r)}function stretch_blit(e,t,n,o,_,a,l,r,s,i){t.context.drawImage(e.canvas,n,o,_,a,l,r,s,i)}function FONT_OBJECT(){}function load_font(e){var t=document.createElement("style"),n="font"+_num_fonts++;return t.id=n,t.type="text/css",document.head.appendChild(t),t.textContent="@font-face { font-family: "+n+"; src:url('"+e+"');}",{element:t,file:e,name:n,type:"fnt"}}function create_font(e){return{element:null,file:"",name:e,type:"fnt"}}function textout(e,t,n,o,_,a,l,r,s){e.context.font=a.toFixed()+"px "+t.name,e.context.textAlign="left",_fillstyle(e,l),e.context.fillText(n,o,_),r&&(_strokestyle(e,r,s),e.context.strokeText(n,o,_))}function textout_centre(e,t,n,o,_,a,l,r,s){e.context.font=a.toFixed()+"px "+t.name,e.context.textAlign="center",_fillstyle(e,l),e.context.fillText(n,o,_),r&&(_strokestyle(e,r,s),e.context.strokeText(n,o,_))}function textout_right(e,t,n,o,_,a,l,r,s){e.context.font=a.toFixed()+"px "+t.name,e.context.textAlign="right",_fillstyle(e,l),e.context.fillText(n,o,_),r&&(_strokestyle(e,r,s),e.context.strokeText(n,o,_))}function SAMPLE_OBJECT(){}function install_sound(){}function set_volume(e){_volume=e;for(var t=0;t<_samples.length;t++)_samples[t].element.volume=_samples[t].volume*_volume}function get_volume(){return _volume}function load_sample(e){var t=document.createElement("audio");t.src=e;var n={element:t,file:e,volume:1,ready:!1,type:"snd"};return _downloadables.push(n),_samples.push(n),log("Loading sample "+e+"..."),t.onloadeddata=function(){n.ready||(n.ready=!0,log("Sample "+e+" loaded!"))},n}function destroy_sample(){}function play_sample(e,t,n,o){t||0==t||(t=1),n||0==n||(n=1),o||(o=!1),adjust_sample(e,t,n,o),e.element.currentTime=0,e.element.play()}function adjust_sample(e,t,n,o){e.volume=t,e.element.volume=e.volume*_volume,e.element.loop=o,e.element.playbackRate=n}function stop_sample(e){e.element.pause(),e.element.currentTime=0}function pause_sample(e){e.element.pause()}function rand(){return Math.floor(65536*Math.random())}function rand32(){return rand()|rand()<<16}function frand(){return Math.random()}function abs(e){return 0>e?-e:e}function length(e,t){return Math.sqrt(e*e-t*t)}function distance(e,t,n,o){return Math.sqrt((n-e)*(n-e)+(o-t)*(o-t))}function distance2(e,t,n,o){return(n-e)*(n-e)+(o-t)*(o-t)}function linedist(e,t,n,o,_,a){var l=n-e,r=o-t,s=l*l+r*r,i=((_-e)*l+(a-t)*r)/s;i>1?i=1:0>i&&(i=0);var c=e+i*l,u=t+i*r,d=c-_,m=u-a,f=Math.sqrt(d*d+m*m);return f}function lerp(e,t,n){return e+(t-e)*n}function dot(e,t,n,o){return e*n+t*o}function sgn(e){return 0>e?-1:e>0?1:0}function angle(e,t,n,o){var _=DEG(Math.atan2(o-t,n-e));return 0>_?_+360:_}function anglediff(e,t){var n=t-e;return n/=360,n=360*(n-floor(n)),n>180&&(n-=360),n}function clamp(e,t,n){return n>t?t>e?t:e>n?n:e:n>e?n:e>t?t:e}function scale(e,t,n,o,_){return o+(e-t)/(n-t)*(_-o)}function scaleclamp(e,t,n,o,_){return e=o+(e-t)/(n-t)*(_-o),_>o?(e=_>e?e:_,e>o?e:o):(e=o>e?e:o,e>_?e:_)}function _error(e){log("[ERROR] "+e),alert(e)}function enable_debug(e){_debug_element=document.getElementById(e),_debug_element&&(_debug_enabled=!0)}function log(e){ALLEGRO_CONSOLE&&console&&console.log(e),_debug_enabled&&(_debug_element.innerHTML=_debug_element.innerHTML+e+"<br/>")}function wipe_log(){_debug_enabled&&(_debug_element.innerHTML="")}var mouse_b=0,mouse_pressed=0,mouse_released=0,mouse_x=-1,mouse_y=-1,mouse_z=-1,mouse_mx=0,mouse_my=0,mouse_mz=0,_mouse_installed=!1,_last_mouse_x=-1,_last_mouse_y=-1,_last_mouse_z=-1,_menu=!1,_downloadables=[],_installed_timers=[],_loopproc,_loader_init_time,_ready_proc,_bar_proc,KEY_A=65,KEY_B=66,KEY_C=67,KEY_D=68,KEY_E=69,KEY_F=70,KEY_G=71,KEY_H=72,KEY_I=73,KEY_J=74,KEY_K=75,KEY_L=76,KEY_M=77,KEY_N=78,KEY_O=79,KEY_P=80,KEY_Q=81,KEY_R=82,KEY_S=83,KEY_T=84,KEY_U=85,KEY_V=86,KEY_W=87,KEY_X=88,KEY_Y=89,KEY_Z=90,KEY_0=48,KEY_1=49,KEY_2=50,KEY_3=51,KEY_4=52,KEY_5=53,KEY_6=54,KEY_7=55,KEY_8=56,KEY_9=57,KEY_0_PAD=96,KEY_1_PAD=97,KEY_2_PAD=98,KEY_3_PAD=99,KEY_4_PAD=100,KEY_5_PAD=101,KEY_6_PAD=102,KEY_7_PAD=103,KEY_8_PAD=104,KEY_9_PAD=105,KEY_F1=112,KEY_F2=113,KEY_F3=114,KEY_F4=115,KEY_F5=116,KEY_F6=117,KEY_F7=118,KEY_F8=119,KEY_F9=120,KEY_F10=121,KEY_F11=122,KEY_F12=123,KEY_ESC=27,KEY_TILDE=192,KEY_MINUS=189,KEY_EQUALS=187,KEY_BACKSPACE=8,KEY_TAB=9,KEY_OPENBRACE=219,KEY_CLOSEBRACE=221,KEY_ENTER=13,KEY_COLON=186,KEY_QUOTE=222,KEY_BACKSLASH=220,KEY_COMMA=188,KEY_STOP=190,KEY_SLASH=191,KEY_SPACE=32,KEY_INSERT=45,KEY_DEL=46,KEY_HOME=36,KEY_END=35,KEY_PGUP=33,KEY_PGDN=34,KEY_LEFT=37,KEY_RIGHT=39,KEY_UP=38,KEY_DOWN=40,KEY_SLASH_PAD=111,KEY_ASTERISK=106,KEY_MINUS_PAD=109,KEY_PLUS_PAD=107,KEY_ENTER_PAD=13,KEY_PRTSCR=44,KEY_PAUSE=19,KEY_EQUALS_PAD=12,KEY_LSHIFT=16,KEY_RSHIFT=16,KEY_LCONTROL=17,KEY_RCONTROL=17,KEY_ALT=18,KEY_ALTGR=18,KEY_LWIN=91,KEY_RWIN=92,KEY_MENU=93,KEY_SCRLOCK=157,KEY_NUMLOCK=144,KEY_CAPSLOCK=20,key=[],pressed=[],released=[],_keyboard_installed=!1,_default_enabled_keys=[KEY_F1,KEY_F2,KEY_F3,KEY_F4,KEY_F5,KEY_F6,KEY_F7,KEY_F8,KEY_F9,KEY_F10,KEY_F11,KEY_F12],_enabled_keys=[],canvas,_gfx_installed=!1,SCREEN_W=0,SCREEN_H=0,font,PI=3.14159265,PI2=6.2831853,PI_2=1.570796325,PI_3=3.14159265/3,PI_4=.7853981625,_num_fonts=0,_volume=1,_samples=[],_debug_enabled=!1,_debug_element,ALLEGRO_CONSOLE=!1;