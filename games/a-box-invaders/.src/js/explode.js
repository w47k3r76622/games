AFRAME.registerComponent("explode",{schema:{on:{default:""}},update:function(e){var t=this.el,n=this.handler=this.explode.bind(this);e&&t.removeEventListener(e.on,n),t.addEventListener(this.data.on,n)},explode:function(){function e(){n.remove(a),o.remove(n)}function t(e,t){var n=new THREE.Group;(t=t.clone()).side=THREE.DoubleSide;for(var o=0;o<e.faces.length;o++){var r=e.faces[o],a=e.vertices[r.a].clone(),i=e.vertices[r.b].clone(),s=e.vertices[r.c].clone(),c=new THREE.Geometry;c.vertices.push(a,i,s),c.faces.push(new THREE.Face3(0,1,2));var l=new THREE.Mesh(c,t);l.position.sub(c.center()),n.add(l)}return n.children.sort(function(e,t){return e.position.z-t.position.z}),n.rotation.set(0,0,0),n}var n=this.el.getObject3D("mesh"),o=this.el.sceneEl.object3D,r=8e3,a=t(n.geometry,n.material);n.material.visible=!1;for(var i=0;i<a.children.length;i++){var s=a.children[i];s.geometry.computeFaceNormals();var c=s.geometry.faces[0].normal.clone(),l=s.position.clone().add(c.multiplyScalar(300));new TWEEN.Tween(s.position).to(l,r).onComplete(e).start(),s.material.opacity=0,new TWEEN.Tween(s.material).to({opacity:1},r).start();var d=2*Math.PI,h={x:d,y:d,z:d};new TWEEN.Tween(s.rotation).to(h,r).start()}n.add(a),this.el.removeEventListener(this.data.on,this.handler)}});
