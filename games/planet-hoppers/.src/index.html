<script type=module>var t,e,n,s=Object.defineProperty,o=Object.defineProperties,i=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,c=Object.prototype.propertyIsEnumerable,u=(t,n,e)=>n in t?s(t,n,{t:!0,o:!0,writable:!0,value:e}):t[n]=e,h=(t,n)=>{for(var e in n||(n={}))r.call(n,e)&&u(t,e,n[e]);if(a)for(var e of a(n))c.call(n,e)&&u(t,e,n[e]);return t},x=(t,n)=>o(t,i(n)),f=(t,n,e)=>{if(!n.has(t))throw TypeError("Cannot "+e)},p=(t,n,e)=>(f(t,n,"read from private field"),e?e.call(t):n.get(t)),l=(t,n,e)=>{if(n.has(t))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(t):n.set(t,e)},d=(t,n,e,i)=>(f(t,n,"write to private field"),i?i.call(t,e):n.set(t,e),e);const w=document.getElementsByTagName("canvas")[0],y=w.getContext("2d");function S(){y.fillStyle="#121212",y.fillRect(0,0,w.width,w.height)}function M(t,n){return{x:t,y:n}}function v(t,n){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))}function b(t,n){return e=t.x-n.x,i=t.y-n.y,Math.atan2(i,e);var e,i}function g(t,n=1){return M(Math.cos(t)*n,Math.sin(t)*n)}class j{constructor(n){var e;l(this,t,void 0),this.position=M(n.x,n.y),this.i=n.i,d(this,t,null==(e=n.u)||e)}h(){}p(t,n){}get u(){return p(this,t)}set u(n){d(this,t,n)}}t=new WeakMap;class m extends j{constructor(t){var n;super(t),this.l=null!=(n=t.l)?n:0}}class P extends m{constructor(t){var n,e,i,o;super(t),this.S=null!=(n=t.S)?n:10,this.M=null!=(e=t.M)?e:"#fff",this.orientation=null!=(i=t.orientation)?i:0,this.v=null!=(o=t.v)?o:0}h(){y.beginPath(),y.fillStyle=function(t,n,e,i,o,s,a){const r=y.createLinearGradient(e,i,e+Math.cos(a)*o,i+Math.sin(a)*s);return r.addColorStop(0,t),r.addColorStop(1,"#000"),r}(this.M,0,this.position.x,this.position.y,2*this.S,2*this.S,this.orientation),y.arc(this.position.x,this.position.y,this.S,0,2*Math.PI),y.fill()}p(t,n){super.p(t,n),this.orientation=(this.orientation+this.v*n/1e3)%(2*Math.PI)}}class D extends P{constructor(t){var n;super(t),this.points=null!=(n=t.points)?n:1}}class R extends P{constructor(t){var n,e,i;super(x(h({},t),{S:null!=(n=t.S)?n:10,M:null!=(e=t.M)?e:"#fff",l:null!=(i=t.l)?i:40,u:!1})),this.g=1,this.j=0,this.m=null,this.u=!1}h(){super.h();const{position:t,j:n,S:e,orientation:i}=this;if(!n)return;y.save(),y.fillStyle="#e43",y.translate(t.x,t.y),y.rotate(i-Math.PI/2);const o=e,s=o/2,a=-s,r=e+s+n;y.fillRect(a,r,o,-n),function(t,...n){y.beginPath(),y.moveTo(...t),n.forEach(t=>{y.lineTo(...t)}),y.fill()}([a,r],[a+o,r],[0,r+s]),y.restore()}p(t,n){super.p(t,n);const e=this.m;if(null!==e){const{P:t,D:n}=e;this.orientation=t.orientation+n;const i=this.S+t.S,{x:o,y:s}=g(this.orientation,i);this.position.x=t.position.x+o,this.position.y=t.position.y+s,this.i=M(0,0)}}get u(){return super.u}set u(t){super.u=t,!1===t&&(this.m=null)}}class T extends P{constructor(t){var n,e;super(x(h({},t),{l:null!=(n=t.l)?n:30,S:null!=(e=t.S)?e:30,u:!0}))}}class F extends T{constructor(t){super(t),this.R=t.R}h(){super.h(),y.fillStyle=function(t,n,e,i,o){const s=y.createRadialGradient(e,i,0,e,i,o);return s.addColorStop(0,"transparent"),s.addColorStop(1,n),s}(0,this.R,this.position.x,this.position.y,this.S),y.arc(this.position.x,this.position.y,this.S,0,2*Math.PI),y.fill()}}class k extends D{constructor(t){var n,e;super(x(h({},t),{S:null!=(n=t.S)?n:5,M:null!=(e=t.M)?e:"#afa",u:!1})),this.P=t.P,this.T=(.1*Math.random()+.1)*(Math.random()<.5?-1:1),this.F=Math.random()*Math.PI*2,this.altitude=50*Math.random()+100}p(t,n){super.p(t,n),this.F+=this.T*(n/1e3),this.position.x=this.altitude*Math.cos(this.F)+this.P.position.x,this.position.y=this.altitude*Math.sin(this.F)+this.P.position.y}}class z extends P{constructor(t){var n,e,i;super(x(h({},t),{l:null!=(n=t.l)?n:3,S:null!=(e=t.S)?e:5,M:null!=(i=t.M)?i:"#d55",u:!1}))}}class E extends j{constructor(t){var n;super(t),this.fontSize=null!=(n=t.fontSize)?n:12,this.text=t.text}h(){super.h(),y.fillStyle="#EEE",y.font=this.fontSize+"px sans-serif";const t=y.measureText(this.text).width;y.fillText(this.text,this.position.x-t/2,this.position.y)}}function O(t,n){const e=t.indexOf(n);e>-1&&t.splice(e,1)}function A(){return parseInt(window.localStorage.getItem("planethoppers-level")||"0")}function C(t){window.localStorage.setItem("planethoppers-level",t.toString())}function G(t,n,e){const i=e.k;if(n instanceof D&&(e.points+=n.points,function(t){const{O:n}=t;null!=n&&t.points>=n&&et()}(e),O(i,n)),n instanceof T&&!t.u){let e;t.u=!0,o=t.position,s=n.position,e=o.x===s.x&&o.y===s.y?t.orientation:b(t.position,n.position)-n.orientation,t.m={P:n,D:e}}var o,s;n instanceof F&&et(),n instanceof z&&(Y=N[X]())}function W(t,n){const e=t.S+n.S;return v(t.position,n.position)<e}function H(t,n){const e=n.k;e.forEach(i=>{i===t||i instanceof R||(t instanceof R?i instanceof P&&W(t,i)&&G(t,i,n):i instanceof k&&t instanceof k||i instanceof P&&t instanceof P&&W(i,t)&&(O(e,t),i.u||O(e,i)))})}function L(t,n,e){y.strokeStyle="#eee",y.font=n+"em sans-serif";const i=w.width/2,o=y.measureText(t).width;y.strokeText(t,i-o/2,e)}function $(t){return()=>{const n=t(),{k:e}=n,i={points:0,k:e,O:n.O};return H(e.find(t=>t instanceof R),i),i}}function q(t,n){const e=new T(t),i=new Array(n).fill(0).map(t=>new k({x:0,y:0,P:e}));return[e,...i]}const I=$(()=>({k:[new R({x:400,y:200,orientation:Math.PI/4}),new T({x:400,y:200,M:"#f00"}),new F({x:800,y:300,M:"#f00",R:"#ff26"}),new E({x:640,y:450,fontSize:32,text:"Welcome to Planet Hoppers!"}),new E({x:640,y:500,fontSize:24,text:"Hold the spacebar to charge your jump"}),new E({x:640,y:550,fontSize:24,text:"release to get to your destination planet!"})]})),U=$(()=>({k:[new R({x:100,y:100,orientation:Math.PI}),new T({x:100,y:100,M:"#0f0",v:.5}),new F({x:300,y:300,M:"#f00",R:"#ff26"}),new E({x:640,y:450,fontSize:32,text:"Some planets will rotate"}),new E({x:640,y:500,fontSize:24,text:"Time your jump just right to get to the destination planet"})]})),B=$(()=>({k:[new R({x:100,y:100,orientation:.75*Math.PI}),new T({x:100,y:100,M:"#0f0"}),new T({x:300,y:300,M:"#ff0",v:.5}),new F({x:700,y:400,M:"#f00",R:"#ff26"})]})),J=$(()=>({O:3,k:[new R({x:300,y:300,orientation:1.5*Math.PI}),...q({x:300,y:300,M:"#0f0",v:1},3),new E({x:640,y:450,fontSize:32,text:"Collect space debris along your way for points"})]}));class K extends j{constructor(t,i){var o;super(t),l(this,e,void 0),l(this,n,void 0),this.A=1e3/t.C,this.G=t.G,this.W=null!=(o=t.W)?o:.1,d(this,e,0),d(this,n,i)}p(t,i){super.p(t,i);const{position:o,A:s,W:a,G:r}=this;for(d(this,e,p(this,e)+i);p(this,e)>s;){console.log("spawning"),d(this,e,p(this,e)-s);const i=a*Math.cos(r),l=a*Math.sin(r);t.k.push(new z(x(h({},p(this,n)),{x:o.x,y:o.y,i:M(i,l)})))}}}e=new WeakMap,n=new WeakMap;const N=[I,U,B,J,$(()=>({k:[new R({x:300,y:300,orientation:1.5*Math.PI}),new K({x:600,y:700,C:2,G:1.1*Math.PI,W:.2}),new K({x:800,y:600,C:2,G:1.3*Math.PI,W:.2}),new T({x:300,y:300,M:"#0f0",v:1}),new F({x:600,y:600,M:"#333",R:"#ff0"}),new E({x:640,y:450,fontSize:32,text:"Avoid asteroids at all costs!"})]})),$(()=>({O:3,k:[new R({x:300,y:300,orientation:1.5*Math.PI}),new K({x:300,y:700,C:.2,G:Math.PI/2,W:.2}),...q({x:300,y:300,M:"#0f0",v:1.4},7),...q({x:700,y:600,M:"#0a0",v:1.4},5)]})),$(()=>({k:[new R({x:700,y:600,orientation:1.5*Math.PI}),new K({x:300,y:900,C:1,G:-.3*Math.PI,W:.5}),new K({x:500,y:-100,C:1,G:.6*Math.PI,W:.5}),new T({x:700,y:600,M:"#0f0",v:1}),...q({x:500,y:350,M:"#ff5",v:1.5},10),new F({x:300,y:200,M:"#333",R:"#ff0"})]})),$(()=>({O:25,k:[new R({x:400,y:600,orientation:1.5*Math.PI}),new T({x:400,y:600,M:"#cfc",v:1}),...q({x:600,y:200,M:"#fa2",v:1},20),...q({x:750,y:350,M:"#2df",v:1},20),...q({x:450,y:350,M:"#a2d",v:1},20),new F({x:800,y:600,M:"#333",R:"#ff0"})]})),$(()=>({k:[new R({x:300,y:500,orientation:1.5*Math.PI}),new K({x:500,y:-100,C:.9,G:-1.7*Math.PI,W:.2}),new K({x:300,y:900,C:1,G:1.7*Math.PI,W:.2}),new T({x:300,y:500,M:"#0dd",v:1}),...q({x:500,y:300,M:"#aa0",v:1},10),...q({x:700,y:500,M:"#b1d",v:1},10),...q({x:900,y:300,M:"#dd1",v:1},10),new F({x:1100,y:500,M:"#333",R:"#ff0"})]})),$(()=>({k:[new R({x:300,y:500,orientation:1.5*Math.PI}),new K({x:400,y:900,C:2,G:1.7*Math.PI,W:.6}),new T({x:300,y:200,M:"#beb",v:1}),...q({x:500,y:200,M:"#0ff",v:1},50),new F({x:800,y:500,M:"#333",R:"#ff0"})]})),$(()=>({k:[new R({x:600,y:50,orientation:1.5*Math.PI}),new K({x:1300,y:-50,C:1,G:-1.2*Math.PI,W:.5}),new K({x:0,y:0,C:1,G:.2*Math.PI,W:.5}),new K({x:-50,y:900,C:1,G:-.2*Math.PI,W:.5}),new K({x:1500,y:900,C:.9,G:1.2*Math.PI,W:.5}),...q({x:600,y:50,M:"#0f0",v:1},10),new F({x:600,y:600,M:"#333",R:"#ff0",l:100,S:50})]})),$(()=>({k:[new R({x:400,y:200,orientation:Math.PI/4}),new T({x:400,y:200,M:"#f00",v:10}),new T({x:600,y:300,M:"#00f",v:-10}),new T({x:500,y:600,M:"#0f0",v:10}),new E({x:640,y:450,fontSize:32,text:"Congratulations, you win!"}),new E({x:640,y:525,fontSize:24,text:'Press "r" to reset your progress'})]}))];let Q=!1;const V=new class{constructor(){this.H=0,this.L="#888",this.$=3,this.q=200;const t=[n()];function n(){return[2e3*Math.random(),2e3*Math.random()]}function e(t,n){return v(M(...t),M(...n))}function i(n){let i=1/0,o=null;for(const s of t){if(!o){o=s,i=e(s,n);continue}const t=e(n,s);t<i&&(o=s,i=t)}return o}function o(){let t,o=0;for(let s=0;s<10;++s){const s=n(),a=e(i(s),s);a>o&&(o=a,t=s)}return t}for(let n=1;n<100;++n)t.push(o());this.I=t}update(t){this.H+=t}U(){const t=this.$,n=this.q;let e=Math.round(this.H/n);this.I.forEach(([n,i])=>{switch(e=(e+1)%4,y.fillStyle=this.L,e){case 0:y.fillRect(n,i,t,t);break;case 1:case 3:y.fillRect(n-t,i,3*t,t),y.fillRect(n,i-t,t,3*t);break;case 2:y.fillRect(n-t,i,3*t,t),y.fillRect(n,i-t,t,3*t),y.fillStyle="#121212",y.fillRect(n,i,t,t)}})}};let X=A();X>=N.length&&(C(0),X=A());let Y=N[X](),Z=!1,_=0;function tt(t){if(Z)return S(),y.fillStyle="#222",y.fillRect(0,0,w.width,w.height),L("Planet Hoppers",6,150),void L("Press Space to Resume",3,300);S();const n=Y.k,e=t-_;var i;_=t,console.debug("FPS: "+1e3/e),function(t,n){const e=t.k;V.update(n);const i=e.find(t=>t instanceof R);if(Q){if(i.u){const t=.2*i.g*n;let e=i.j+t;e>100?(i.g=-1,e-=e-100):e<0&&(i.g=1,e=Math.abs(e)),i.j=e}}else{const t=i.j;if(t){i.j=0,i.g=1,i.u=!1;const{x:n,y:e}=g(i.orientation,.002*t);i.i={x:n,y:e}}}e.forEach(e=>e.p(t,n));const o=e.filter(t=>t instanceof m);o.filter(t=>!t.u).forEach(e=>{e.i=e.i||M(0,0);let i=0,s=0;o.forEach(t=>{if(e===t)return;if(e instanceof R&&!t.u)return;const n=t.position.x-e.position.x||1e-8,o=t.position.y-e.position.y||1e-8,a=Math.sqrt(Math.pow(n,2)+Math.pow(o,2)),r=2e-5*e.l/(a*Math.sqrt(a+.15));i+=n*r,s+=o*r}),e.i.x+=i*n,e.i.y+=s*n,e instanceof P&&(e.orientation=Math.atan2(s,i)),e.position.x+=e.i.x*n,e.position.y+=e.i.y*n,H(e,t)})}(Y,e),V.U(),n.forEach(t=>{t.h()}),i=Y,y.fillStyle="#eee",y.font="30px sans-serif",y.fillText("Points: "+i.points,10,40)}function et(){C(++X),Y=N[X]()}function nt(){Z=!0}function st(t){switch(t.key){case"Escape":return void nt();case" ":return t.preventDefault(),Z&&(Z=!1),void(Q=!0);case"r":return C(0),void location.reload();case"n":return;default:console.debug("Unhandled keypress",t.key)}}function ot(t){switch(t.key){case" ":t.preventDefault(),Q=!1}}!function(){const t=n=>{tt(n),requestAnimationFrame(t)};requestAnimationFrame(t),addEventListener("blur",nt),addEventListener("keydown",st),addEventListener("keyup",ot)}()</script><style>*{margin:0;overflow:hidden}</style><div style=width:100%;height:100%;background-color:#0e0e0e><div style=width:1280;margin:auto><canvas width=1280 height=720 /></div></div>