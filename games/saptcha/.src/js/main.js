(()=>{"use strict";const e=document.createElement("canvas");e.width=128,e.height=128;const t=e.getContext("2d"),o=["#ef4040","#40ef40","#4040ef","#efef40","#ef40ef","#40efef","#ef8000","#80ef40","#8040ef","#efef80","#ef80ef","#80efef","#ef4080","#40ef80","#4080ef","#ef8080","#80ef80","#8080ef"],n=Array(16).fill(!1);let a=null,l=!1;const c=document.querySelector("#points_counter"),s=document.querySelector("#main_window"),r=document.querySelector("#modal"),d=document.querySelector("#best-score"),i=document.querySelector("#win-text"),u=document.querySelector("#lose-text"),m=document.querySelector("#win-arrow"),g=document.querySelector("#lose-arrow"),p=(e,t)=>{l&&window.AudioContext&&ZZFX.z(e,t)},h=(e,t=!1)=>{t||(e?p(55789,{volume:1,frequency:150,length:.5,attack:.4,slide:0,modulation:0,modulationPhase:.1}):p(77070,{volume:1,frequency:70,length:.5,attack:.1,slide:0,modulationPhase:.1})),i.textContent=35,u.textContent=25,r.classList.toggle("hidden",!e),s.classList.toggle("covered",e),!localStorage.getItem("saptcha_first_time")&&localStorage.setItem("saptcha_first_time",(new Date).toString())},f=(e,t,o,n)=>{let a=e,l=0;t>e?(c.classList.toggle("win",!0),m.classList.toggle("undisplayed",!1),l=(a+=o)>t?t:a):(c.classList.toggle("lose",!0),g.classList.toggle("undisplayed",!1),l=(a-=o)<0?0:a),c.textContent=l.toString().padStart(n,"0"),l!==t?setTimeout(f,45,l,t,o,n):(m.classList.toggle("undisplayed",!0),g.classList.toggle("undisplayed",!0),c.classList.remove("win","lose"))},y=()=>{const e=Number(localStorage.getItem("saptcha_best_record")),t=a.points>e?a.points:e;localStorage.setItem("saptcha_best_record",t),d.textContent=e.toString().padStart(5,"0")};(()=>{const e=localStorage.getItem("saptcha_unlocked_animals");let t=3;e?t=Number(e):localStorage.setItem("saptcha_unlocked_animals",3),a=new Game(16,35,25,t,3,100),!localStorage.getItem("saptcha_first_time")&&h(!0,!0);const o=localStorage.getItem("saptcha_last_record");o?(a.points=+o,f(0,+o,26,5)):localStorage.setItem("saptcha_last_record",a.points),y()})();const _=document.querySelector("#tiles_container"),S=[],b=document.querySelector("#verify_button"),k=document.querySelector("#skip_button"),L=document.querySelector("#reset_button"),v=document.querySelector("#objects_name"),w=document.querySelector("#install_button"),q=document.querySelector("#info_button"),A=document.querySelector("#close_button"),E=document.querySelector("#unlock_close_button"),I=document.querySelector("#unlock_modal"),x=document.querySelector("#unlock_image"),C=document.querySelector("#unlock_name"),P=document.querySelector("#unlock_continue"),$=document.querySelector("#sound_on"),z=document.querySelector("#sound_off");let M=null;const D=(e,t)=>{n[e.dataset.index]=e.classList.toggle("tile--selected",t),e.setAttribute("aria-checked",t);const o=n.some(e=>e);b.classList.toggle("undisplayed",!o),k.classList.toggle("undisplayed",o)},K=e=>{p(6982,{volume:1,frequency:99,length:.5}),D(e.currentTarget)},N=(e,t)=>{const o=document.createElement("div"),n=document.createElement("div");return o.appendChild(n),n.style.backgroundImage='url("images/image.png")',n.classList.add("tile__image"),o.classList.add("tile"),o.setAttribute("aria-checked","false"),o.setAttribute("role","checkbox"),o.setAttribute("tabindex",0),o.addEventListener("click",K),o.addEventListener("keypress",e=>"Space"===e.code&&K(e)),o.dataset.index=t,S.push({wrapper:o,image:n,index:t}),o},R=n=>{const a=shuffle(o);let l=0;return t.fillStyle="#eee",t.fillRect(0,0,e.width,e.height),n.forEach(e=>{e.forEach(e=>{if(t.beginPath(),t.fillStyle=a[l%a.length],"number"==typeof e[0])if(3===e.length){const[o,n,a]=e;t.arc(clamp(o+randomAround(a/8),0,128),clamp(n+randomAround(a/8),0,128),clamp(a+randomAround(a/8),0,128),0,2*Math.PI)}else{const[o,n,a,l,c]=e,s=Math.min(a,l);t.ellipse(clamp(o+randomAround(s/8),0,128),clamp(n+randomAround(s/8),0,128),clamp(a+randomAround(s/8),0,128),clamp(l+randomAround(s/8),0,128),(c+randomAround(5))*(Math.PI/180),0,2*Math.PI)}else e.forEach(([e,o],n)=>{(0===n?t.moveTo.bind(t):t.lineTo.bind(t))(e+randomAround(4),o+randomAround(2))});t.closePath(),t.fill(),t.fillStyle="#000",t.stroke(),l+=1})}),e.toDataURL()},T=(e,t,o)=>{if(!e)return p(77070,{volume:1,frequency:70,length:.5,attack:.1,slide:0,modulationPhase:.1}),I.classList.toggle("hidden",!0),clearInterval(M),void(M=null);p(8464,{volume:1,length:.5,modulation:0}),I.classList.toggle("hidden",!1);const n=()=>{x.style.backgroundImage=`url(${R(o)})`,C.textContent=`${t.match(/^[aeiou]/i)?"an":"a"} ${t}`,p(77070,{volume:1,frequency:130,length:.5,attack:.1,slide:0,modulationPhase:.1})};n(),M=setInterval(n,500)},U=()=>{const{comps:e,expected:t}=a.newRound(),o=`${t.match(/^[aeiou]/i)?"an":"a"} ${t}`;S.forEach(({wrapper:t,image:o,index:n})=>{D(t,!1),o.style.backgroundImage=`url(${R(e[n])})`}),v.textContent=o},H=()=>{p(76284,{volume:1,frequency:99,length:.5}),U()},Z=(e,t=!1)=>{z.classList.toggle("undisplayed",!e),$.classList.toggle("undisplayed",e),l=e,localStorage.setItem("saptcha_sound_enabled",e),e&&!t&&p(98452,{volume:1,frequency:99,length:.5,modulation:0})},j=()=>{const e=Boolean(localStorage.getItem("saptcha_sound_enabled"));Z(e,!0),$.removeAttribute("disabled")},B=e=>{const t=(Number(document.activeElement.dataset.index)+e+S.length)%S.length||0;S.find(({wrapper:e})=>Number(e.dataset.index)===t).wrapper.focus()};window.addEventListener("beforeinstallprompt",e=>{w.classList.toggle("hidden",!1),w.addEventListener("click",()=>(e=>{e.prompt(),e.userChoice.then(e=>{"accepted"===e.outcome?console.log("User accepted the A2HS prompt"):console.log("User dismissed the A2HS prompt")})})(e))}),window.addEventListener("appinstalled",()=>w.classList.toggle("hidden",!0)),window.addEventListener("keydown",({code:e})=>{switch(e){case"Enter":b.click();break;case"ArrowUp":case"KeyW":B(-4);break;case"ArrowRight":case"KeyD":B(1);break;case"ArrowDown":case"KeyS":B(4);break;case"ArrowLeft":case"KeyA":B(-1)}}),b.addEventListener("click",()=>{p(44781,{frequency:99,volume:1});const{curr:e,next:t,newAnimal:o}=a.verify(n);f(e,t,1,5),localStorage.getItem("saptcha_best_record")<a.points&&localStorage.setItem("saptcha_best_record",a.points),localStorage.setItem("saptcha_last_record",a.points),localStorage.setItem("saptcha_unlocked_animals",a.unlockedCount),y(),o&&T(!0,o.name,o.comps),U()}),k.addEventListener("click",throttle(H,250)),L.addEventListener("click",throttle(H,250)),q.addEventListener("click",()=>h(!0)),A.addEventListener("click",()=>h(!1)),E.addEventListener("click",()=>T(!1)),P.addEventListener("click",()=>T(!1)),z.addEventListener("click",()=>Z(!1)),$.addEventListener("click",()=>Z(!0)),document.monetization&&("started"===document.monetization.state&&j(),document.monetization.addEventListener("monetizationstart",()=>{j()})),(e=>{const t=e**2,o=Array(t).fill(Math.sqrt(t)).map(N);_.append(...o);[3,4].forEach(t=>_.classList.toggle(`tiles_container--${t}`,e===t))})(4),U()})();