!function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){window.clearTimeout(a)})}();var _={},$={},idCounter=0;_.uniqueId=function(a){var b=++idCounter+"";return a?a+b:b},_.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},_.extend=function(a){if(!_.isObject(a))return a;for(var b,c,d=1,e=arguments.length;e>d;d++){b=arguments[d];for(c in b)hasOwnProperty.call(b,c)&&(a[c]=b[c])}return a},_.pad=function(a,b){var c="0000000"+a;return c.substr(c.length-b)},$.Base=function(a){_.isObject(a)&&_.extend(this,a||{}),this.cid=_.uniqueId("c"),this.start.apply(this,arguments)},_.extend($.Base.prototype,{start:function(){}}),$.Base.extend=function(a,b){var c=this,d=function(){return c.apply(this,arguments)};_.extend(d,c,b);var e=function(){this.constructor=d};return e.prototype=c.prototype,d.prototype=new e,a&&_.extend(d.prototype,a),d._super=c.prototype,d},$.Entity=$.Base.extend({pos:{x:0,y:0},start:function(){},update:function(){},draw:function(){}}),$.Collection=$.Base.extend({entities:[],start:function(){this.entities=[]},update:function(){this.entities.forEach(function(a){a.update()})},draw:function(a){this.entities.forEach(function(b){b.draw(a)})}}),$.M=$.Base.extend({},{rnd:function(a,b){return Math.floor(Math.random()*(b-a+1)+a)},rnd01:function(){return Math.random()},rnd11:function(){return Math.random()>.5?1:-1},rndInCircle:function(a){var b=Math.random()*Math.PI*2,c=$.M.rnd(0,a);return{x:Math.cos(b)*c,y:Math.sin(b)*c}},lerp:function(a,b,c){return(1-c)*a+c*b},polygonPoints:function(a,b,c){for(var d=[],e=2*Math.PI/c,f=0;c>f;f++)d.push({x:a.x+b*Math.cos(f*e),y:a.y+b*Math.sin(f*e)});return d}}),$.C=$.Base.extend({},{white:[255,255,255,1],toRGBA:function(a){return Array.isArray(a)?"rgba("+(a[0]||0)+","+(a[1]||0)+","+(a[2]||0)+","+(a[3]||1).toFixed(1)+")":a},lerp:function(a,b,c){function d(a,b,c,d){return d=d?d:1,Math.round($.M.lerp(a,b,c)*d)/d}return[d(a[0],b[0],c),d(a[1],b[1],c),d(a[2],b[2],c),d(a[3]>=0?a[3]:1,b[3]>=0?b[3]:1,c,100)]},eql:function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]}}),$.V=$.Base.extend({},{zero:{x:0,y:0},one:{x:1,y:1},clone:function(a){return{x:a.x,y:a.y}},prod:function(a,b){return{x:a.x*b.x,y:a.y*b.y}},multiply:function(a,b){return{x:a.x*b,y:a.y*b}},divide:function(a,b){return{x:a.x/b,y:a.y/b}},add:function(a,b){return{x:a.x+b.x,y:a.y+b.y}},dif:function(a,b){return{x:b.x-a.x,y:b.y-a.y}},part:function(a,b,c){return $.V.lerp(a,b,c/10)},angleTo:function(a,b){var c=$.V.dif(a,b);return Math.atan2(c.y,c.x)},mid:function(a,b){return $.V.divide($.V.add(a,b),2)},eql:function(a,b){return a.x===b.x&&a.y===b.y},normal:function(a,b){var c=$.V.dif(a,b),d=$.V.magnitude(a,b);return{x:c.x/d||0,y:c.y/d||0}},origin:function(a,b){return{x:a.x-b.x/2,y:a.y-b.y/2}},center:function(a,b){return{x:a.x+b.x/2,y:a.y+b.y/2}},magnitude:function(a,b){var c=$.V.dif(a,b);return Math.sqrt(c.x*c.x+c.y*c.y)},pointInCircle:function(a,b,c){return $.V.magnitude(a,b)<c},lerp:function(a,b,c){return{x:a.x+(b.x-a.x)*c,y:a.y+(b.y-a.y)*c}},round:function(a){return a.x=Math.round(a.x),a.y=Math.round(a.y),a},isOut:function(a,b,c){return a.x<b.x||a.x>c.x||a.y<b.y||a.y>c.y}}),$.Renderer=$.Base.extend({},{fill:function(a,b){b.fill&&(a.fillStyle=$.C.toRGBA(b.fill),a.fill())},stroke:function(a,b){b.stroke&&(a.lineWidth=b.stroke.size||1,a.strokeStyle=$.C.toRGBA(b.stroke.color),a.stroke())},_rect:function(a,b){a.beginPath(),a.rect(b.pos.x,b.pos.y,b.size.x,b.size.y),$.Renderer.fill(a,b),$.Renderer.stroke(a,b)},circle:function(a,b){var c=b.angles&&b.angles.start||0,d=b.angles&&b.angles.end||2*Math.PI;a.beginPath(),b.lineCap&&(a.lineCap=b.lineCap),a.arc(b.pos.x,b.pos.y,b.radius,c,d,!1),$.Renderer.fill(a,b),$.Renderer.stroke(a,b)},line:function(a,b){var c=b.pos,d=b.to;a.beginPath(),a.lineCap="round",a.moveTo(c.x,c.y),a.lineTo(d.x,d.y),a.lineWidth=b.size,a.strokeStyle=$.C.toRGBA(b.color),a.stroke()},sprite:function(a,b){function c(){j?a.drawImage(d,j.x,j.y,j.w,j.h,f,g,h,i):a.drawImage(d,f,g,h,i)}var d=$.repo[b.resource],e=$.V.origin(b.pos,b.size),f=e.x,g=e.y,h=b.size.x,i=b.size.y,j=b.sprite;return isNaN(b.angle)?void c():(a.save(),a.translate(f+h/2,g+i/2),f=-h/2,g=-i/2,a.rotate(b.angle),c(),void a.restore())},text:function(a,b){a.font=b.size+"pt Arial",a.textBaseline=b.baseline||"middle",a.fillStyle=$.C.toRGBA(b.color),a.fillText(b.text,b.pos.x,b.pos.y)},rect:function(a,b){var c=b.pos.x,d=b.pos.y,e=b.size.x,f=b.size.y;if(!b.corner)return void $.Renderer.rect(a,b);var g=b.corner;a.beginPath(),a.moveTo(c+g,d),a.lineTo(c+e-g,d),a.quadraticCurveTo(c+e,d,c+e,d+g),a.lineTo(c+e,d+f-g),a.quadraticCurveTo(c+e,d+f,c+e-g,d+f),a.lineTo(c+g,d+f),a.quadraticCurveTo(c,d+f,c,d+f-g),a.lineTo(c,d+g),a.quadraticCurveTo(c,d,c+g,d),a.closePath(),$.Renderer.fill(a,b),$.Renderer.stroke(a,b)}}),$.Circle=$.Entity.extend({start:function(){},update:function(){},draw:function(a){$.Renderer.circle(a,this)}}),$.Line=$.Entity.extend({start:function(){},update:function(){},draw:function(a){$.Renderer.line(a,this)}}),$.Rect=$.Entity.extend({start:function(){},update:function(){},draw:function(a){$.Renderer.rect(a,this)}}),$.Text=$.Entity.extend({color:$.C.white,start:function(){},update:function(){},draw:function(a){$.Renderer.text(a,this)}}),$.Sprite=$.Entity.extend({start:function(){},update:function(){},draw:function(a){$.Renderer.sprite(a,this)}}),$.Controls=$.Base.extend({events:{pressing:null,moving:null,release:null,element:null,pause:null},enabled:!1,start:function(a){var b=window.document,c=this.container=a.container||b;c.onmouseup=this._onMouseEvent.bind(this,"release"),c.onmousedown=this._onMouseEvent.bind(this,"pressing"),c.onmousemove=this._onMouseEvent.bind(this,"moving"),b.addEventListener("keyup",this._onKeyUp.bind(this))},enable:function(){return this.enabled=!0,this},disable:function(){return this.enabled=!1,this},on:function(a,b){return this.events[a]||(this.events[a]=[]),this.events[a].push(b),this},off:function(a){return this.events[a]&&(this.events[a].length=0),this},_getEventName:function(a){switch(a.which||a.keyCode){case 81:case 113:return"element:fire";case 87:case 119:return"element:water";case 69:case 101:return"element:earth";case 82:case 114:return"element:air";case 112:case 80:return"pause"}},_onKeyUp:function(a){var b=this._getEventName(a);if((this.enabled||"pause"===b)&&b){if(b.indexOf("element")>-1){var c=b.split(":")[1];return void this.events.element.forEach(function(a){a(c)})}this.events[b].forEach(function(a){a()})}},_onMouseEvent:function(a,b){if(this.enabled){var c=this.getCoordsEvent(b,this.container);this.events[a].forEach(function(a){a(c)})}},getCoordsEvent:function(a,b){var c,d,e=document,f=e.body,g=e.documentElement;return a.pageX||a.pageY?(c=a.pageX,d=a.pageY):(c=a.clientX+f.scrollLeft+g.scrollLeft,d=a.clientY+f.scrollTop+g.scrollTop),c-=b.offsetLeft,d-=b.offsetTop,{x:c,y:d}}}),$.Particles=$.Collection.extend({max:250,start:function(){this.entities=[],this.emitters={},this.init(this.max)},init:function(a){for(var b=0;a>b;b++)this.entities.push({active:!1})},createEmitter:function(a,b){var c=this.emitters[a.cid]={emitter:a,options:b,count:0,lastr:0,active:b.auto?!0:!1};return c},toggleEmiter:function(a,b){var c=this.emitters[a];c&&(c.active=b)},playEmiter:function(a){this.toggleEmiter(a.cid,!0)},stopEmiter:function(a){this.toggleEmiter(a.cid,!1)},createEmitterParticles:function(a,b){for(var c=0;b>c;c++){var d=this.emitters[a];if(!this.initParticle(d.emitter,d.options))return}},runEmitters:function(){for(var a in this.emitters){var b=this.emitters[a];if(b.lastr-=$.dt,b.active&&b.count<b.options.max&&b.lastr<=0){b.lastr=b.options.rate;var c=b.options.ratep;this.createEmitterParticles(a,c),b.count+=c}}},initParticle:function(a,b){var c=this.getParticle();if(c){if(c.active=!0,c.g=b.g||$.V.zero,c.d=b.d||$.V.one,c.f=b.f||$.V.one,c.pos=a.pos,b.rad){var d=$.M.rnd(0,b.rad)*$.M.rnd11(),e=$.M.rnd(0,b.rad)*$.M.rnd11();c.pos={x:a.pos.x+d,y:a.pos.y+e}}return c.cFrom=b.cFrom,c.cTo=b.cTo,c.life=b.life,c.tlife=b.life,c.size=b.size||1,c.emitter=a,!0}return!1},getParticle:function(){for(var a=this.entities,b=a.length,c=0;b>c;c++)if(!a[c].active)return a[c];return null},updateParticle:function(a){a.f=$.V.multiply(a.g,$.dt),a.d=$.V.add(a.d,a.f),a.pos=$.V.add(a.pos,$.V.multiply(a.d,$.dt)),a.cFrom&&a.cTo&&(a.color=$.C.lerp(a.cFrom,a.cTo,1-100*a.life/a.tlife/100)),a.life-=$.dt},drawParticle:function(a,b){$.Renderer.circle(a,{pos:b.pos,radius:b.size,fill:b.color})},update:function(){this.runEmitters(),this.entities.forEach(function(a){if(a.life<=0&&(a.active=!1),a.active)this.updateParticle(a);else if(a.emitter){var b=this.emitters[a.emitter.cid];b&&b.active&&b.count--}},this)},draw:function(a){this.entities.forEach(function(b){b.active&&this.drawParticle(a,b)},this)}}),$.Node=$.Circle.extend({radius:3,fill:$.C.white,nears:null,temp:0,incTemp:0,incTempSize:0,burned:!1,shaked:!1,originalPos:null,hasEarth:!1,insideTarget:!1,blowing:!1,blowingEnd:0,colors:{cold:[200,200,200,1],burn:[255,0,0,1],burned:[,,,.2],earth:[190,160,40,1]},start:function(){this.nears=[]},addNear:function(a){this.nears.push(a)},randomBurn:function(){var a=this.nears.some(function(a){return a.burned});!a&&$.M.rnd01()<.15&&this.setBurned(!0)},getNearBurned:function(){var a;return this.nears.some(function(b){return b.burned?(a=b,!0):void 0}),a},shake:function(){this.originalPos?this.pos=this.originalPos:this.originalPos=this.pos,this.shaked=!0,this.pos=$.V.round($.V.add(this.pos,$.M.rndInCircle(.2)))},endShake:function(){this.originalPos&&(this.pos=this.originalPos),this.shaked=!1},revive:function(){this.burned&&(this.resetTemp(),this.burned=!1)},burn:function(){this.burned||(this.incTemp=1)},cool:function(){this.burned||(this.incTemp=-1,this.incTempSize=.5)},dirty:function(){this.burned||(this.hasEarth=!0)},blow:function(){if(!this.burned){if(this.blowing=!0,this.hasEarth){Particles.createEmitter(this,{auto:!0,max:20,rate:.2,ratep:10,life:1,rad:10,size:10,cFrom:[165,140,80,.8],cTo:[10,10,10,.1],g:{x:0,y:-100}});var a=this;window.setTimeout(function(){Particles.stopEmiter(a)},1e3)}this.hasEarth=!1,this.blowingEnd=$.tm+500}},getRandomNear:function(a){var b=[];if(this.nears.forEach(function(c){c.cid!==a&&!c.burned&&c.temp<.5&&b.push(c)}),b.length>0){var c=$.M.rnd(0,b.length-1);return b[c]}return null},resetTemp:function(){this.temp=0,this.incTemp=0,this.incTempSize=0},setBurned:function(a){if(this.burned=!0,this.fill=this.colors.burned,this.resetTemp(),!a){Particles.createEmitter(this,{auto:!0,max:20,rate:.2,ratep:10,life:1,rad:20,size:2,cFrom:[255,0,0,.8],cTo:[10,0,0,.1],g:{x:0,y:100}});var b=this;window.setTimeout(function(){Particles.stopEmiter(b)},1e3)}},update:function(){return this.burned?void 0:(this.blowing&&$.tm>this.blowingEnd&&(this.blowing=!1),this.hasEarth?(this.fill=this.colors.earth,void this.resetTemp()):this.nears.every(function(a){return a.burned})?void this.setBurned():(this.incTemp>0&&(this.incTempSize=this.blowing?.2:.1),this.blowing||this.insideTarget?this.shake():this.shaked&&this.endShake(),this.temp+=this.incTemp*this.incTempSize*$.dt,this.temp<=0&&this.resetTemp(),this.fill=$.C.lerp(this.colors.cold,this.colors.burn,this.temp),this.temp>1?(this.setBurned(),void this.resetTemp()):void 0))}}),$.Nodes=$.Collection.extend({paths:null,applyPos:null,applyRatio:0,element:null,start:function(){this.entities=[],this.paths=new $.Paths;var a=$.V.divide(config.size,2),b=config.world.margin;a.x-=b.x,a.y-=b.y;var c=$.V.center($.V.zero,config.size);this.createWeb(c,a)},createWeb:function(a,b){var c=0,d=30,e=d/5,f=6,g=3,h=2,i=8*f,j=$.V.add(a,$.V.multiply(b,-1)),k=$.V.add(a,b),l=[],m=new $.Node({pos:a});this.entities.push(m);var n,o=10,p=1,q=0;do{n=!1,p%g===0&&(f*=h),f>i&&(f=i);var r=$.M.polygonPoints(a,p*d+o,f);q+=r.length;var s=[];(10===p||20===p)&&(e+=.1),r.forEach(function(a){var b=$.V.round($.V.add(a,$.M.rndInCircle(e))),c=new $.Node({pos:b});$.V.isOut(b,j,k)?c.out=!0:(n=!0,this.entities.push(c)),s.push(c)},this),l[p-1]=s,p++}while(n);c=p-2,l[0].forEach(function(a){this.paths.addOne(m,a)},this);for(var t,u,v,w=c;w--;){var x=l[w],y=x.length;for(t=y;t--;){u=t+1,v=t*h,u>y-1&&(u=0),v>y*h-g&&(v=-h);var z=l[w][u];if(!z.out){var A=l[w+1],B=A[u];A.length>x.length&&(B=A[v+h]),c-1>w&&B&&!B.out&&this.paths.addOne(z,B);var C=l[w][t];C.out||this.paths.addOne(z,C)}}}this.entities.forEach(function(a){a.randomBurn()})},findNodeByCollider:function(){this.entities.forEach(function(a){$.V.pointInCircle(this.applyPos,a.pos,this.applyRatio)&&a[config.methods[config.elements.indexOf(this.element)]]()},this)},getNodes:function(){return this.entities},update:function(){this.applyPos&&this.findNodeByCollider(),this.paths.update(),$.Nodes._super.update.apply(this)},draw:function(a){this.paths.draw(a),$.Nodes._super.draw.apply(this,arguments)}}),$.Path=$.Line.extend({pos:{x:0,y:0},to:{x:0,y:0},size:2,tBurn:.5,burned:!1,heat:null,setHeat:function(a,b,c){var d=this.heat;if(!d||d.id===a.cid){d=this.heat||{};var e=2*c;d.id=a.cid,d.from=a.pos,d.to=$.V.round($.V.lerp(a.pos,b.pos,e>1?1:e)),this.heat=d}},update:function(){var a=this.na,b=this.nb,c=a.temp,d=b.temp,e=a.fill,f=b.fill;c||d?c>0?this.setHeat(a,b,c):d>0&&this.setHeat(b,a,d):this.heat=null,c>this.tBurn&&0===d?b.burn():d>this.tBurn&&0===c&&a.burn(),this.color=$.C.eql(e,f)?e:$.C.lerp(e,f,this.tBurn),(a.burned||b.burned)&&(this.heat=null,this.burned=!0,this.color=[,,,.2]),this.pos=this.na.pos,this.to=this.nb.pos},draw:function(a){$.Path._super.draw.apply(this,arguments),this.heat&&$.Renderer.line(a,{pos:this.heat.from,to:this.heat.to,size:5,color:[255,0,0,.4]})}}),$.Paths=$.Collection.extend({start:function(){this.entities=[]},hasOne:function(a,b){return this.entities.some(function(c){var d=c.na.cid,e=c.nb.cid;return!(a!==d&&a!==e||b!==d&&b!==e)})},addOne:function(a,b){b&&!this.hasOne(a.cid,b.cid)&&(a.addNear(b),b.addNear(a),this.entities.push(new $.Path({na:a,nb:b})))}}),$.Cursor=$.Circle.extend({stroke:{color:"#fff",size:2},active:!1,element:"fire",last:"",start:function(){var a=this;Controls.on("pressing",function(b){a.pos=b,a.active=!0}).on("moving",function(b){a.pos=b}).on("release",function(){a.active=!1}).on("element",function(b){a.element=b}),this.emiter=Particles.createEmitter(this,{max:50,rate:.1,ratep:2,life:1,rad:5,g:{x:0,y:0}}),this.setEmitter()},setEmitter:function(){function a(a,c,e){e=e||[10,10,10,.1],d.g.y=a,d.cFrom=c,d.cTo=e,d.size=b}var b=this.active?10:5,c=[[-100,[100,,,.8]],[100,[75,180,240,.8],[200,200,250,.1]],[100,[165,140,80,.8]]],d=this.emiter.options,e=c[config.elements.indexOf(this.element)];return this.last=this.element+":"+this.active,e?(Particles.playEmiter(this),void a.apply(null,e)):void Particles.stopEmiter(this)},update:function(){var a=this.element,b=config.elements.indexOf(a),c=.4,d=[20,20,20,50],e=[[255,,,c],[75,180,240,c],[165,140,80,c],[,220,255,c]];this.fill=e[b],this.radius=d[b],this.last!==a+":"+this.active&&this.setEmitter()}}),$.Spider=$.Sprite.extend({resource:"spider",size:{x:32,y:32},nFrom:null,nTo:null,journeyLength:null,traveling:!1,isDead:!1,temp:0,staying:!1,t_stay:2e3,t_startStay:0,t_nextStay:0,t_startMove:0,building:!1,spriteIndex:0,animTime:3,lastFrameTime:0,exited:!1,calmSpeed:.05,alertSpeed:.1,behaviour:{alertTemp:0,tStayA:3e3,tStayB:1e4},start:function(a){this.pos=$.V.round(a.pos),this.onDead=a.onDead,this.speed=this.calmSpeed,this.move=[];for(var b=0;3>b;b++)this.move.push({x:32*b,y:0,w:32,h:32});this.sprite=this.move[0]},setNode:function(a,b){this.nFrom=a,this.nTo=b,this.t_startMove=$.tm,this.journeyLength=$.V.magnitude(a.pos,b.pos),this.traveling=!0,this.angle=$.V.angleTo(this.pos,this.nTo.pos)},setDead:function(){this.isDead||(this.nFrom=null,this.nTo=null,this.dying=!0,this.vel=1,this.pos={x:this.pos.x,y:this.pos.y},this.onDead())},burn:function(){this.building=!1,this.burning=$.tm+3e3,this.temp=1,Particles.createEmitter(this,{auto:!0,max:50,rate:.1,ratep:2,life:1,rad:10,size:10,cFrom:[100,,,.4],cTo:[10,10,10,.1],g:{x:0,y:-100}})},animate:function(){this.staying||(this.lastFrameTime-=$.ft,this.lastFrameTime<=0&&(this.spriteIndex++,this.spriteIndex>2&&(this.spriteIndex=0),this.lastFrameTime=this.animTime/this.speed))},updateTemp:function(){var a=this.nFrom,b=this.nTo,c=a.temp,d=b.temp;if(1!==this.temp)return a.blowing||b.blowing?void(this.temp=.1):c||d?c>=d?void(this.temp=c):void(d>c&&(this.temp=d)):void(this.temp=0)},canMove:function(){return!this.staying&&!this.traveling&&!this.building},updateState:function(){var a=$.tm,b=this.behaviour,c=this.t_startStay,d=this.t_stay;return this.temp>b.alertTemp?(this.speed=this.alertSpeed,void(this.staying=!1)):(this.speed=this.calmSpeed,void(this.staying?a>c+d&&(this.staying=!1,this.t_nextStay=a+d/$.M.rnd(2,5)):a>this.t_nextStay&&$.M.rnd01()<.8&&(this.staying=!0,this.t_startStay=a,this.t_stay=$.M.rnd(b.tStayA,b.tStayB))))},updateMove:function(){if(!this.building&&(this.nFrom.burned||this.nTo.burned))return void this.setDead();var a=($.tm-this.t_startMove)*this.speed,b=a/this.journeyLength;return b>1?(this.pos=$.V.clone(this.nTo.pos),this.nTo.revive(),this.burning&&this.nTo.burn(),this.traveling=!1,this.building=!1,!0):(this.pos=$.V.round($.V.lerp(this.nFrom.pos,this.nTo.pos,b)),void this.animate())},buildWeb:function(a,b){this.building=!0,this.traveling=!0,this.setNode(a,b)},update:function(){if(this.sprite=this.move[this.spriteIndex],!(this.isDead||this.exited||this.inVacuum)){if(this.dying)return this.vel++,this.pos.y+=this.vel,void(this.pos.y>config.size.y&&(this.isDead=!0,Particles.stopEmiter(this)));this.updateTemp(),(!this.building&&!this.traveling||this.updateMove())&&(this.updateState(),this.burning&&this.burning<$.tm&&this.setDead())}},draw:function(a){this.isDead||(this.building&&$.Renderer.line(a,{pos:this.pos,to:this.nFrom.pos,size:2,color:$.C.white}),$.Spider._super.draw.apply(this,arguments))}}),$.Spiders=$.Collection.extend({spidersExit:0,spidersKilled:0,stats:{},amount:0,applyPos:null,applyRatio:0,element:null,start:function(){this.entities=[],this.generateSpiders(),this.updateGUI()},updateGUI:function(){this.stats={saved:this.spidersExit,killed:this.spidersKilled,alives:this.entities.length-(this.spidersKilled+this.spidersExit),total:this.entities.length}},onSpiderDead:function(){this.spidersKilled++,this.updateGUI()},generateSpiders:function(){var a,b,c=this.nodes.getNodes(),d=c.length,e=[],f=d<this.amount?d-2:this.amount;do b=$.M.rnd(0,d-1),a=c[b],a.burned||-1!==e.indexOf(a.cid)||(e.push(a.cid),this.entities.push(new $.Spider({pos:a.pos,onDead:this.onSpiderDead.bind(this)})),f--);while(f)},getSpiders:function(){return this.entities},gonnaBuildWeb:function(a,b){if(!a.hasEarth&&!a.temp&&$.M.rnd01()>.7){var c=a.getNearBurned();if(c)return b.buildWeb(a,c),!0}return!1},gotNearNodeToGo:function(a,b){var c=b.nodeFrom&&b.nodeFrom.cid||-1,d=a.getRandomNear(c);return d?(b.setNode(a,d),!0):!1},spiderNodeCollide:function(a,b){$.V.pointInCircle(a.pos,b.pos,5)&&(this.gonnaBuildWeb(b,a)||this.gotNearNodeToGo(b,a)||b.burned&&a.setDead())},findSpidersByCollider:function(){this.entities.forEach(function(a){$.V.pointInCircle(this.applyPos,a.pos,this.applyRatio)&&a[config.methods[config.elements.indexOf(this.element)]]()},this)},update:function(){this.applyPos&&"fire"===this.element&&this.findSpidersByCollider();var a=this.nodes.getNodes(),b=this.spidersExit;this.spidersExit=0,this.entities.forEach(function(b){b.exited?this.spidersExit++:b.canMove()&&a.some(function(a){this.spiderNodeCollide(b,a)},this),b.update()},this),b!==this.spidersExit&&this.updateGUI()},draw:function(a){this.entities.forEach(function(b){b.inVacuum||b.draw(a)})}}),$.Target=$.Circle.extend({stroke:{color:[80,255,85,.1]},angles:{start:.97*Math.PI,end:1.52*Math.PI},lineCap:"butt",suckForce:3,start:function(){var a=config,b=a.world.margin;this.size=a.size.y/6,this.radius=this.size/2,this.stroke.size=this.size,this.pos=$.V.prod($.V.one,a.size),this.pos.x-=b.x+10,this.pos.y-=b.y+20,this.saved=[],this.saving=[];var c=new $.Entity({pos:{x:this.pos.x-100,y:this.pos.y-100}}),d=$.V.normal(c.pos,this.pos);Particles.createEmitter(c,{auto:!0,max:10,rate:.5,ratep:1,life:1,rad:50,size:2,cFrom:[200,200,200,.5],cTo:[200,200,200,.1],g:$.V.multiply(d,150)})},setNodesInside:function(a){a.forEach(function(a){$.V.pointInCircle(a.pos,this.pos,this.size)&&(a.burned&&(a.burned=!1,a.revive()),a.insideTarget=!0)},this)},update:function(a){a.forEach(function(a){a.burning||a.dead||a.exited||$.V.pointInCircle(a.pos,this.pos,this.size)&&(a.building=!1,a.exited=!0,a.vel={x:0,y:0},this.saving.push(a))},this);var b=$.dt*this.suckForce,c=this.pos;this.saving.forEach(function(a){if(!a.catched){var d=a.pos,e=$.V.normal(d,c);a.vel=$.V.add(a.vel,$.V.multiply(e,b)),a.pos=$.V.add(d,a.vel),$.V.pointInCircle(a.pos,c,5)&&(a.catched=!0,this.saved.push(a))}},this)}}),$.Vacuum=$.Entity.extend({targetLen:0,start:function(a){this.target=a.target,this.size=config.vacuum.size,this.current=0,this.offx=30,this.offy=10,this.recipePos={x:this.offx+165,y:this.offy+65},this.recipeSize={x:80,y:300},this.createGraphics()},createGraphics:function(){var a=$.sprites.vacuum.size;this.bgBack=new $.Sprite({resource:"vacuum",pos:$.V.center({x:this.offx,y:this.offy},a),size:a});var b=[187,187,249],c={pos:this.recipePos,size:this.recipeSize,corner:6,fill:$.C.white,stroke:{size:2,color:b}};this.cilinder=new $.Rect(c),c.fill=[0,0,255,.5],this.glass=new $.Rect(c),this.stats=new $.Text({pos:{x:180,y:30},size:25,color:"#00ff00"})},update:function(){this.current=this.target.saved.length;var a=this.recipePos,b=this.recipeSize,c=a.y+b.y/2,d=a.x+b.x/2,e=2*$.tm*Math.PI;this.target.saved.forEach(function(a){if(a.inVacuum){a.animate();var b=a.vacuum;a.pos={x:b.ampX*Math.sin(e/b.velX)+d,y:b.ampY*Math.sin(e/b.velY)+c},a.angle+=b.rot}else a.inVacuum=!0,a.vacuum={ampY:$.M.rnd(10,c/2),velY:$.M.rnd(600,1e3),ampX:$.M.rnd(5,20),velX:$.M.rnd(2e3,6e3),rot:$.M.rnd(1,5)/10},a.pos={x:d,y:c}},this),this.stats.text=_.pad(this.current,2)+" / "+_.pad(this.targetLen,2)},draw:function(a){this.bgBack.draw(a),this.cilinder.draw(a),this.target.saved.forEach(function(b){b.draw(a)}),this.glass.draw(a),this.stats.draw(a)}}),$.Stats=$.Collection.extend({pos:{x:1,y:0},colors:{kills:"#ff0000"},start:function(){this.entities=[],this.pos=$.V.prod(this.pos,config.size),this.colors.alives="#"+$.sprites.color,this.stats={saved:0,killed:0,alives:0,total:0},this.createIcons(),this.createText()},createIcons:function(){var a=40,b=30,c=40,d={x:a,y:a},e={resource:"spider",sprite:{x:0,y:0,w:32,h:32},size:d,angle:Math.PI/2};e.pos={x:this.pos.x-b,y:this.pos.y+c+1.5*a},this.iconAPos=e.pos,this.entities.push(new $.Sprite(e)),e.pos={x:this.pos.x-b,y:this.pos.y+c},this.iconKPos=e.pos,this.entities.push(new $.Sprite(e)),this.entities.push(new $.Text({pos:{x:e.pos.x-15,y:e.pos.y},text:"X",size:30,color:this.colors.kills}))},createText:function(){var a=30,b=this.iconKPos,c=this.iconAPos;this.textKills=new $.Text({pos:{x:b.x-3.5*a,y:b.y},size:a,color:this.colors.kills}),this.entities.push(this.textKills),this.textAlives=new $.Text({pos:{x:c.x-2.5*a,y:c.y},size:a,color:this.colors.alives}),this.entities.push(this.textAlives)},update:function(a){this.stats=a,this.textKills.text=a.killed+" / "+this.maxKills,this.textAlives.text=_.pad(a.alives,2)}}),$.Element=$.Collection.extend({size:{x:96,y:96},start:function(){this.entities=[],this.active=!1,this.current=!1,this.createElement()},createElement:function(){var a=this.size,b=this.pos;this.bg=new $.Rect({pos:b,size:a,fill:[255,255,255,.1],stroke:{size:4,color:[30,30,30,1]},corner:8}),this.entities.push(this.bg),this.icon=new $.Sprite({resource:"elements",pos:$.V.center({x:b.x+3,y:b.y+6},{x:a.x-6,y:a.y-6}),size:a,angle:0,sprite:this.sprite}),this.entities.push(this.icon);var c={x:b.x,y:b.y+1.1*a.y},d=20;this.showKeys&&(this.ctrlKey=new $.Rect({pos:{x:c.x-d/2,y:c.y-d},size:$.V.multiply($.V.one,2*d),fill:[,,,1],corner:4}),this.entities.push(this.ctrlKey),this.txtKey=new $.Text({text:this.key,pos:c,size:d,color:$.C.white}),this.entities.push(this.txtKey))},update:function(){this.bg.fill=[255,255,255,this.active?1:.1],this.bg.stroke.color=this.current?$.C.white:[,,,1]}}),$.Elements=$.Collection.extend({pos:{x:20,y:50},size:96,gap:50,showKeys:!0,start:function(){this.entities=[],this.current="fire",this.active=!1,this.keys=["Q","W","E","R"],this.elements=config.elements,this.sprites={};for(var a=0;4>a;a++)this.sprites[this.elements[a]]={x:32*a,y:0,w:32,h:32};this.createElements()},createElements:function(){var a=this.size,b=this.gap+a,c=this.pos,d=this.showKeys;this.elements.forEach(function(e,f){this.entities.push(new $.Element({pos:{x:c.x,y:c.y+f*b},size:{x:a,y:a},name:e,key:this.keys[f],sprite:this.sprites[e],showKeys:d}))},this)},update:function(){this.entities.forEach(function(a){a.current=a.name===this.current,a.active=a.current&&this.active,a.update()},this)}}),$.sprites={bgColor:"rgba(0,0,0,0.1)",bg:[[1,,,,1,,,,,1],[,1,,1,,,,,1],[,,1,,,,,1,,],[,1,,1,,,1,,,],[1,,,,1,1,,,,],[,,,,1,1,,,,1],[,,,1,,,1,,1],[,,1,,,,,1,,],[,1,,,,,1,,1],[1,,,,,1,,,,1]],color:"b9ce5a",spider:[[,,,,,,,,,,,,,,,],[,,,,,,,,,,,,,,,],[,,,,7,,3,,3,,7,,,,,],[,,1,,7,1,3,,3,1,7,3,7,,,],[,7,3,1,,,1,,1,,3,7,3,7,,],[2,4,3,,1,,1,,1,,1,,,3,7],[,4,3,,,1,1,1,1,1,,,,3,2],[,,,,1,1,1,1,1,1,1,1,,3,2],[,3,2,,1,1,1,1,1,1,1,1,,4,,],[,3,2,,,1,1,1,1,1,,,,4,3],[4,3,2,,1,,1,,1,,1,,,4,3],[,4,3,1,,,1,,1,,3,1,,6,,2],[,,,3,1,7,3,3,3,7,7,,1,,2],[,,,,7,,3,,3,,7,,,2,,],[,,,,,,,,,,,,,,,],[,,,,,,,,,,,,,,,]],colors:[[,"ff1414","ffc700","fff600"],[,"5481ce","5cb1f2","90e3f9"],[,"966910","bf8f35"],[,"aed7ef","e3f9fc"]],elements:[[[,,,,,,,1,1,,,,,,,],[,,,,,,1,1,1,1,,,,,,],[,,,,,,1,1,1,1,1,,,,,],[,,,,,1,1,1,2,1,1,,,,,],[,,,1,,1,1,2,2,1,1,,,,,],[,,1,1,,1,1,2,2,1,1,,1,,,],[,1,1,1,,1,1,2,2,1,1,,1,1,,],[,1,1,1,,1,1,2,2,1,1,,1,1,1],[,1,2,1,1,1,1,2,2,1,1,,1,1,1],[,1,2,2,1,1,2,2,2,2,1,1,1,2,1],[,1,2,2,2,2,2,3,3,2,2,2,2,2,1],[,1,2,2,3,3,2,3,3,2,3,3,2,2,1],[,1,1,2,2,3,3,3,3,3,3,2,2,1,1],[,,1,1,2,2,3,3,3,2,2,2,1,1,,],[,,,1,1,2,2,2,2,2,2,1,1,,,],[,,,,1,1,1,1,1,1,1,1,,,,]],[[,,,,,,,1,1,,,,,,,],[,,,,,,,1,1,,,,,,,],[,,,,,,1,1,1,1,,,,,,],[,,,,,,1,1,1,1,,,,,,],[,,,,,1,1,1,2,1,1,,,,,],[,,,,1,1,1,2,2,1,1,1,,,,],[,,,,1,1,2,2,2,2,1,1,1,,,],[,,,1,1,2,2,2,2,3,2,1,1,,,],[,,1,1,2,2,2,2,3,3,3,2,1,1,,],[,,1,1,2,2,2,2,2,3,3,2,1,1,,],[,,1,1,2,2,2,2,2,2,2,2,1,1,,],[,,1,1,2,2,2,2,2,2,2,2,1,1,,],[,,1,1,2,2,2,2,2,2,2,2,1,1,,],[,,1,1,1,2,2,2,2,2,2,1,1,,,],[,,,1,1,1,1,1,1,1,1,1,,,,],[,,,,1,1,1,1,1,1,1,,,,,]],[[,,,,,,,,,,,,,,,],[,,,,,,,,,,,,,,,],[,,,,,,,1,1,,,,,,,],[,,,,,,1,1,1,1,,,,,,],[,,,,,1,1,2,2,1,1,,,,,],[,,,,,1,2,2,2,2,1,1,,,,],[,,,,1,1,2,1,2,2,2,1,,,,],[,,,,1,2,2,2,1,2,2,2,1,,,],[,,,1,2,2,2,2,2,2,1,1,2,1,,],[,,1,1,2,2,2,1,2,2,2,2,2,1,,],[,,1,2,2,1,1,2,2,1,2,2,2,2,1],[,1,1,2,2,2,2,2,2,2,1,1,2,2,1],[,1,2,2,2,2,2,1,1,2,2,2,2,2,1],[,1,2,2,1,2,1,2,2,1,2,2,2,2,1],[,,1,2,2,2,2,2,2,2,2,2,2,1,,],[,,1,1,1,1,1,1,1,1,1,1,1,1,,]],[[,,,,,,1,1,1,1,,,,,,],[,,,,,1,2,2,2,2,1,,,,,],[,,,,1,2,2,1,2,2,2,1,,,,],[,,,1,2,2,2,2,2,1,2,1,,,,],[,,1,1,1,2,2,2,2,2,2,1,1,1,,],[,1,2,2,2,1,2,2,2,2,1,2,2,2,1],[,1,2,1,2,2,2,1,2,2,2,2,2,2,1],[,1,2,2,2,1,2,2,2,1,2,2,2,2,1],[,,1,1,1,1,2,1,2,1,1,2,2,1,,],[,,,,,1,2,1,2,1,,1,1,,,],[,,,,,1,2,1,2,1,,,,,,],[,,,,,1,2,2,2,1,,,,,,],[,,,,,1,2,2,2,1,,,,,,],[,,,,1,2,2,1,2,2,1,,,,,],[,,,,1,2,1,2,1,2,1,,,,,],[,,,,1,1,1,1,1,1,1,,,,,]]],vacuum:{size:{x:300,y:500},path:[[70,460],[120,400],[160,445],[195,450,185,380],[225,380],[230,510,145,475]],fill:"#9e9e9e",stroke:"#474747",line:3,box:{pos:{x:150,y:50},size:{x:110,y:330},corner:6,fill:[158,158,158],stroke:{color:[71,71,71],size:2}}}},$.Creator=$.Base.extend({},{getSprites:function(){var a=$.sprites,b=this.generate;return{bg:b(a.bg,a.bgColor,!0,1),spider:b(a.spider,a.color,!0,3),favicon:b(a.spider,a.color,!0,1,1,!0),elements:b(a.elements,a.colors),vacuum:this.drawPath(a.vacuum)}},generate:function(a,b,c,d,e,f){var g=new window.Image,h=c?d:a.length,i=document.createElement("canvas"),j=c?a.length:a[0].length,k=c?a[0].length:a[0][0].length,l=e||2,m=e||2,n=l*j,o=m*k;i.width=n*h,i.height=o;var p=i.getContext("2d");p.clearRect(0,0,n,o);for(var q=0;h>q;q++)for(var r=0;j>r;r++)for(var s=0;k>s;s++){var t,u,v;c?(t=a[r][s],v=b.indexOf("rgb")>-1?b:"#"+b,u=q+2):(t=a[q][r][s],v="#"+b[q][t],u=q),(c&&(5===t&&(2===u||3===u)||6===t&&(3===u||4===u)||7===t&&(2===u||4===u)||1===t||t===u)||!c&&t)&&(p.save(),p.fillStyle=v,p.fillRect(s*l+n*q,r*m,l,m),p.restore())}return f?i.toDataURL():(g.src=i.toDataURL("image/png"),i=null,g)},drawPath:function(a){var b=new window.Image,c=a.path,d=a.fill,e=a.stroke,f=a.line,g=a.size,h=document.createElement("canvas");h.width=g.x,h.height=g.y;var i=h.getContext("2d");i.beginPath();var j=c[0];i.moveTo(j[0],j[1]);for(var k=1;k<c.length;k++){var l=c[k];4===l.length?i.quadraticCurveTo(l[0],l[1],l[2],l[3]):i.lineTo(l[0],l[1])}return i.lineTo(j[0],j[1]),d&&(i.fillStyle=d,i.fill()),i.lineWidth=f,i.strokeStyle=e,i.lineCap="round",i.stroke(),i.closePath(),$.Renderer.rect(i,a.box),b.src=h.toDataURL("image/png"),h=null,b}}),$.Modal=$.Base.extend({start:function(a){this._onExit=a.onExit,this.modalItems=[],this.initBackDrop(),this["init"+this.type](),document.addEventListener("keyup",this._onKeyUp.bind(this))},_onKeyUp:function(a){var b=window.modal;if(b===this.type){var c=this.levelIndex,d=a.which||a.keyCode;return 13===d?(this.hide(),void this._onExit()):void("level"===b&&(c=40===d?c+1:38===d?c-1:c,c=0>c?3:c>3?0:c,this.levelIndex=c,this.updateLevel()))}},updateLevel:function(){this.levels&&this.levels.forEach(function(a,b){a.color=b===this.levelIndex?"#00ff00":"#fff"},this),this.redraw()},initBackDrop:function(){this.bg=new $.Rect({pos:{x:0,y:0},size:config.size,corner:10,fill:[0,0,0,.5]})},initPressKey:function(a){var b={text:"-- PRESS ENTER --",pos:a,size:20,color:[0,255,0,1]};b.pos.x+=b.size*b.text.length*1.1/2,this.pressKey=new $.Text(b)},createHolder:function(a,b,c){var d=$.V.center($.V.zero,config.size);d.x-=a.x/2,d.y-=a.y/2;var e=new $.Rect({pos:d,size:a,fill:[30,30,30,1],corner:10,stroke:{size:3,color:[255,255,255,1]}}),f={text:b,pos:$.V.center(d,a),size:20};f.pos.x-=f.size*f.text.length*c/2,f.pos.y=d.y+2*f.size;var g=new $.Text(f);return this.modalItems.push(e),this.modalItems.push(g),{holder:e,title:g}},initmain:function(){var a=this.modalItems=[],b={x:600,y:550},c=this.createHolder(b,document.title,.8),d=c.holder.pos,e=c.title.pos,f={text:"Use The Elements to lead spiders into the Vacuum!",pos:$.V.center(d,b),size:15};f.pos.x-=f.size*f.text.length*.6/2,f.pos.y=e.y+2.5*f.size+10,a.push(new $.Text(f));var g={x:d.x+30,y:f.pos.y+35};a.push(new $.Elements({pos:g,size:66,gap:15,showKeys:!1}));var h=["BURN","COOL","DIRTY","BLOW"],i=["Burn the web but watch to not burn Spiders!","Fire propagates fast!, use the water to cool it","Stops the fire and avoid spiders re-build the web","Burn faster, annoy spiders and removes dirty"];h.forEach(function(b,c){var d={x:g.x+80,y:80*c+g.y+20};a.push(new $.Text({text:b,pos:d,size:15})),a.push(new $.Text({text:i[c],pos:{x:d.x,y:d.y+25},size:15}))});var j={text:"~ Apply an Element by clicking on the Web ~",pos:$.V.center(d,b),size:15,color:[255,150]};j.pos.x-=j.size*j.text.length*.6/2,j.pos.y=b.y-25,a.push(new $.Text(j));var k=$.V.clone(d);k.y+=b.y-30,this.initPressKey(k)},initlevel:function(){var a=this.modalItems=[],b=this.levels=[],c={x:600,y:500},d=this.createHolder(c,"How good you think you are?",.6),e=d.holder.pos,f=d.title.pos,g=["    AMATEUR","PRETTY GOOD","EXPERIENCED","     BUSTER!"],h={x:e.x+c.x/2-70,y:f.y+80};g.forEach(function(c,d){var e={x:h.x,y:60*d+h.y+10},f=new $.Text({text:c,pos:e,size:15,color:"#fff"});a.push(f),b.push(f)}),this.levelIndex=0;var i={text:"~ shh .. be quiet, don't scare spiders ~",pos:$.V.center(e,c),size:15,color:[200,200,200]};
i.pos.x-=i.size*i.text.length*.55/2,i.pos.y=c.y-10,a.push(new $.Text(i));var j=$.V.clone(e);j.y+=c.y-30,this.initPressKey(j),this.updateLevel()},initend:function(){var a=this.modalItems=[],b={x:600,y:250},c=this.createHolder(b,"LEVEL COMPLETED!",.85),d=c.holder.pos,e=c.title.pos,f={text:"Good Job. Try a harder level.",pos:$.V.center(d,b),size:15};f.pos.x-=f.size*f.text.length*.6/2,f.pos.y=e.y+4*f.size+10,a.push(new $.Text(f));var g=$.V.clone(d);g.y+=b.y-30,this.initPressKey(g)},hide:function(){var a=config.size;this.ctx.clearRect(0,0,a.x,a.y),window.modal=""},show:function(){this.hide();var a=this.ctx,b=this.modalItems;this.bg.draw(a),"end"===this.type&&(b[1].text=this.won?"LEVEL COMPLETED!":"SPIDER MURDERER!",b[2].text=this.won?"Good Job. Try a harder level.":"Don't kill them!. Let's try again"),b.forEach(function(b){b.draw(a)}),this.pressKey.draw(a),window.modal=this.type},redraw:function(){this.hide(),this.show()}}),$.Manager=$.Base.extend({level:0,start:function(){Particles=new $.Particles;var a=config.levels[this.level];this.spidersAm=a[0],this.spidersWin=a[1],this.spidersKill=a[2],this.cursor=new $.Cursor,this.nodes=new $.Nodes,this.paths=new $.Paths,this.target=new $.Target,this.vacuum=new $.Vacuum({target:this.target,targetLen:this.spidersWin}),this.elements=new $.Elements,this.spiders=new $.Spiders({nodes:this.nodes,amount:this.spidersAm}),this.stats=new $.Stats({maxKills:this.spidersKill}),this.target.setNodesInside(this.nodes.getNodes()),this.pauseMsg=new $.Text({pos:{x:10,y:config.size.y-20},text:"[P] Pause/Help",size:15})},checkState:function(){var a=this.stats.stats;a.saved>=this.spidersWin&&this.onEnd(a,!0),a.killed>=this.spidersKill&&this.onEnd(a,!1)},update:function(){var a=this.cursor,b=this.nodes,c=this.spiders,d=this.elements;a.update(),d.current=a.element,d.active=a.active,c.applyPos=b.applyPos=null,a.active&&(c.applyPos=b.applyPos=a.pos,c.applyRatio=b.applyRatio=a.radius,c.element=b.element=a.element),b.update(),c.update(),this.target.update(c.getSpiders()),this.vacuum.update(),this.stats.update(c.stats),d.update(),Particles.update(),this.checkState()},draw:function(a,b,c){var d=config.size,e=config.vacuum.size;a.clearRect(0,0,d.x,d.y),b.clearRect(0,0,d.x,d.y),c.clearRect(0,0,e.x,e.y),Particles.draw(a),this.cursor.draw(a),this.nodes.draw(b),this.spiders.draw(b),this.target.draw(b),this.vacuum.draw(c),this.stats.draw(a),this.elements.draw(a),this.pauseMsg.draw(a)}}),$.GameTime=$.Base.extend({lastTime:null,frameTime:0,deltaTime:0,typicalFrameTime:20,minFrameTime:12,time:0,start:function(){this.lastTime=Date.now(),$.tm=this.time,$.dt=this.deltaTime,$.ft=this.frameTime},tick:function(){var a=Date.now(),b=a-this.lastTime;return b<this.minFrameTime?!1:($.ft=b>2*this.typicalFrameTime?this.typicalFrameTime:b,this.frameTime=$.ft,$.dt=$.ft/1e3,this.time+=$.ft,$.tm=this.time,this.lastTime=a,!0)}}),$.Game=$.Base.extend({tLoop:null,paused:!1,start:function(){this.boundGameRun=this.gameRun.bind(this),this.initContexts(),this.started=!1;var a=this,b=this.modalsCtx;this.levelModal=new $.Modal({ctx:b,type:"level",onExit:function(){a.createManager(),a.started=!0,a.play()}}),this.mainModal=new $.Modal({ctx:b,type:"main",onExit:function(){a.started?a.play():a.levelModal.show()}}),this.endModal=new $.Modal({ctx:b,type:"end"}),this.mainModal.show()},createManager:function(){this.manager=new $.Manager({onEnd:this._endGame.bind(this),level:this.levelModal.levelIndex})},_endGame:function(a,b){var c=this;this.endModal.won=b,this.endModal._onExit=function(){b?c.levelModal.show():(c.createManager(),c.play())},this.endModal.show(),this.stop()},initContexts:function(){function a(a,b){return a.width=b.x,a.height=b.y,a.style.zIndex=++d,a.getContext("2d")}var b=config.size,c=config.vacuum.size,d=0;this.worldCtx=a(this.cworld,b),this.viewCtx=a(this.cview,b),this.vacuumCtx=a(this.cvacuum,c),this.modalsCtx=a(this.cmodals,b)},loop:function(){this.manager.update(),this.manager.draw(this.viewCtx,this.worldCtx,this.vacuumCtx)},play:function(){this.paused=!1,Controls.enable(),this.gameRun()},stop:function(){this.paused=!0,Controls.disable(),window.cancelAnimationFrame(this.tLoop)},gameRun:function(){this.paused||(Time.tick()&&this.loop(),this.tLoop=window.requestAnimationFrame(this.boundGameRun))}}),function(){function a(a){return g.getElementById(a)}function b(a){var b=g.createElement("canvas");return b.id=a,h.appendChild(b),b}function c(){function a(a){var d="offset",e="scroll";return Math.max(b["client"+a],b[e+a],b[d+a],c[e+a],c[d+a])}var b=g.documentElement,c=g.body,d=a("Width")-20,e=a("Height")-30,f={x:1250,y:750},i={x:950,y:640},j={x:d>f.x?f.x:d,y:e>f.y?f.y:e};return j.x=j.x<i.x?i.x:j.x,j.y=j.y<i.y?i.y:j.y,h.style.width=j.x+"px",h.style.height=j.y+"px",{size:j,world:{margin:{x:150,y:20}},vacuum:{size:{x:300,y:500}},levels:[[10,5,5],[25,20,5],[50,40,5],[80,70,2]],elements:["fire","water","earth","air"],methods:["burn","cool","dirty","blow"]}}function d(){function a(){game.paused?(game.mainModal.hide(),game.play()):(game.mainModal.show(),game.stop())}f.Time=new $.GameTime,f.Controls=new $.Controls({container:h}),f.game=new $.Game({cview:b("viewport"),cworld:b("world"),cvacuum:b("vacuum"),cmodals:b("modals")}),f.Controls.on("pause",a)}function e(){f.config=c(),$.repo=$.Creator.getSprites(),h.style.backgroundImage='url("'+$.repo.bg.src+'")';var b=a("favicon");b.href=$.repo.favicon,d()}var f=window,g=f.document;g.title="SPIDER BUSTERS",f.modal="";var h=a("ctn");f.onload=e}();