<!DOCTYPE html><html><head><title>Safe Space (js13k 2021)</title><style>body,html{overflow:hidden;margin:0;padding:0;background-color:#000;height:100%}#terminal{position:fixed;display:none;background-color:#000;background-image:radial-gradient(rgba(0,150,0,.8),#000 120%);height:100vh;margin:0;overflow:hidden;padding:5vw;color:rgba(255,255,255,.7);font-family:Inconsolata,monospace;text-shadow:0 0 5px #c8c8c8;box-sizing:border-box}#terminal::after{content:"";position:absolute;top:0;left:0;width:100vw;height:100vh;background:repeating-linear-gradient(0deg,rgba(0,0,0,.15),rgba(0,0,0,.15) 1px,transparent 1px,transparent 2px);pointer-events:none}#cursor{background-color:rgba(255,255,255,.7);margin-bottom:-2px;display:inline-block;box-shadow:0 0 5px #c8c8c8}#terminalText{user-select:none}</style></head><body><canvas id="sceneCanvas"></canvas><div id="terminal"><p><span id="terminalText"></span><span id="cursor"></span></p></div><canvas id="hudCanvas"></canvas><script>!function(){function t(){A.style.opacity=1}function e(){A.style.opacity=0}function n(){i()||A.requestPointerLock()}function o(){document.exitPointerLock()}function i(){return document.pointerLockElement===A}function r(i){let r=L;if(r===i)return!1;if(L=i,i===u)W=z,It(),Ct(),ae(),t(),o(),Q=1;else if(i===s){o(),It(),Pt(),e(),re();let t=ie[Q];se(t[0],t[1]),ne(Ot)}else r===s?(ae(),t(),n(),ne(Nt)):i===h?(e(),re(),se(0,2,!0),Ct(),o(),ne(Ot)):r===h?(Pt(),ae(),t(),ht.sideMovement=0,ht.straightMovement=0,ht.sideMovement=0,ht.straightMovement=0,n(),ne(Ot)):i===v?(e(),re(),se(3,4),Ct(),o(),ne(Kt)):i===x&&(e(),re(),se(5,6),Ct(),o())}function a(){ut=(new Date).getTime(),0===rt&&(rt=ut),ct>0&&(lt=ut-ct,at=ut-rt,L===u?L===u&&(W-=lt,W<=0&&(W=z)):L===f&&(function(){if(!zt&&Dt()?(ne(Gt),zt=!0):zt&&!Dt()&&(ne(jt),zt=!1),0!==ht.straightMovement){let t=30*(1===ht.straightMovement?-1:1)*lt/1e3;vn(ht,t*Math.sin(ht.yaw),0,t*Math.cos(ht.yaw))}if(0!==ht.sideMovement){let t=30*(1===ht.sideMovement?1:-1)*lt/1e3;vn(ht,t*Math.sin(ht.yaw+Math.PI/2),0,t*Math.cos(ht.yaw+Math.PI/2))}for(let t=0;t<Lt.length;t++){let e=Lt[t];if(ht.y<e.y){r(v);break}}_t(j)&&(wt||(wt=!0)),_t(q)&&(ne(te),3===Q?r(x):(Q++,r(s))),ht.isAirborne||(ht.straightMovement||ht.sideMovement?(gt+=lt,pt=1*Math.sin(gt/1e3*10),Tt-=lt,Tt<0&&(Tt=300,ne(Ht))):(mt+=lt,yt=.002*Math.sin(mt/1e3*3))),ht.upVelocity+=-50*lt/1e3;let t=ht.upVelocity*lt/1e3;if(vn(ht,0,t,0),V>0){let t=.3*V/w;ht.x+=Math.random()*t-t/2,ht.z+=Math.random()*t-t/2}}(),function(){if(L===f&&wt){tt.forEach((function(t){if(0===t.timeToNextBurst)Bt(t),ne(qt),ne(ee),V=w,t.timeToNextBurst=t.burstDelay;else{let e=t.timeToNextBurst;t.timeToNextBurst-=lt/1e3,t.timeToNextBurst<0?t.timeToNextBurst=0:Math.ceil(e)!==Math.ceil(t.timeToNextBurst)&&Math.ceil(t.timeToNextBurst)<=3&&ne($t)}}));let t=[];et.forEach((function(e){e.isCore?t.push(e):(e.radius+=lt/1e3*20,e.radius<500&&t.push(e)),!e.isPlayerIn&&kt(e)?(zt?ne(Wt):r(v),e.isPlayerIn=!0):e.isPlayerIn&&!kt(e)&&(e.isPlayerIn=!1)})),et=t,V>0&&(V-=lt,V<0&&(V=0))}}(),Mt.forEach((function(t){Ft(t)&&t.state===m?t.isActive&&(t.state=T,ne(Xt)):Ft(t)||t.state!==b||(t.state=M,ne(Jt));let e=E*lt/1e3;t.state===T?(t.offset+=e,t.offset>8&&(t.offset=8,t.state=b)):t.state===M&&(t.offset-=e,t.offset<0&&(t.offset=0,t.state=m))})),Math.random()<R&&ne(Qt)),bt&&(L===u&&(Ue(),function(){S.clearRect(0,0,st,ft),S.save(),S.scale(_,_),S.save();let t=S.createRadialGradient(p/2,-750,0,p/2,-750,1e3);t.addColorStop(0,"rgba(255, 0, 0, 1)"),t.addColorStop(.9,"rgba(255, 0, 0, 0.5)"),t.addColorStop(1,"rgba(255, 0, 0, 0.1)"),S.fillStyle=t,S.fillRect(0,0,p,y),S.translate(p/2,y/2),S.textAlign="center",S.fillStyle=S.strokeStyle="rgba(133, 172, 210, .7)",S.save(),S.translate(0,-23),S.scale(1.3,1.6),S.textBaseline="middle",S.font="100 140px impact",S.fillText("SAFE",0,0),S.font="100 100px impact",S.fillText("SPACE",0,100),S.restore(),S.fillStyle="#582f2d",S.fillRect(-150,246,300,22),S.font="100 23px verdana",S.fillStyle="#280f14",S.fillText("@ericdrowell JS13K 2021",1,267),S.fillStyle="#785e57",S.fillText("@ericdrowell JS13K 2021",-1,265),W<1e3&&(S.save(),S.font="100 38px monospace",S.translate(0,320),S.scale(1,1),S.fillStyle="#c80507",S.shadowColor="rgba(190, 0, 0, 0.8)",S.shadowBlur=7,S.fillText("CLICK TO START",0,0),S.restore()),S.restore(),S.restore()}()),L===f&&(Ue(),function(){S.clearRect(0,0,st,ft),S.save(),S.scale(_,_),S.save(),S.translate(p/2,y/2),S.lineWidth=2,S.strokeStyle="rgba(106, 187, 109, 0.2)",S.beginPath(),S.arc(0,0,20,0,2*Math.PI),S.stroke(),S.beginPath(),S.arc(0,0,30,0,2*Math.PI),S.stroke();const t=p/2-20,e=y/2-20;S.beginPath(),S.moveTo(t,0),S.quadraticCurveTo(t,e,0,e),S.quadraticCurveTo(-t,e,-t,0),S.quadraticCurveTo(-t,-e,0,-e),S.quadraticCurveTo(t,-e,t,0),S.stroke(),S.restore(),S.restore()}()))),ct=ut,window.requestAnimationFrame(a)}setTimeout((function(){var t;(function(){let t=window.innerWidth,e=window.innerHeight;F=t/e,F>d?(ft=e,st=e*d):(st=t,ft=t/d),_=st/p})(),A=document.getElementById("hudCanvas"),S=function(t,e,n){let o=t.getContext("2d");return t.width=e,t.height=n,t.style.width=e+"px",t.style.height=n+"px",t.style.position="fixed",t.style.top=0,t.style.left=0,o}(A,st,ft),F>d?(A.style.left="50%",A.style.marginLeft="-"+st/2+"px"):(A.style.top="50%",A.style.marginTop="-"+ft/2+"px"),U=document.createElement("canvas"),U.width=32,U.height=32,N=U.getContext("2d"),N.transform(1,0,0,-1,0,U.height),C=pn.create(),B=pn.create(),I=document.getElementById("sceneCanvas"),P=I.getContext("webgl"),k=P.createProgram(),Pe(k,P,Mn,zn),D=P.createProgram(),Pe(D,P,En,Rn),(t=I).width=st,t.height=ft,t.style.position="fixed",t.style.top=0,t.style.left=0,F>d?(t.style.left="50%",t.style.marginLeft="-"+st/2+"px"):(t.style.top="50%",t.style.marginTop="-"+ft/2+"px"),document.addEventListener("keydown",(function(t){!function(t){if(L===f){let e=t.which||t.keyCode;switch(n(),e){case 27:r(h);break;case 65:ht.sideMovement=-1;break;case 87:ht.straightMovement=1;break;case 68:ht.sideMovement=1;break;case 83:ht.straightMovement=-1;break;case 32:vt<1&&(ht.upVelocity=20,ht.isAirborne=!0,vt++,ne(Yt))}}}(t)}),!1),document.addEventListener("keyup",(function(t){!function(t){if(L===f){let e=t.which||t.keyCode;switch(n(),e){case 65:ht.sideMovement=0;break;case 87:ht.straightMovement=0;break;case 68:ht.sideMovement=0;break;case 83:ht.straightMovement=0}}}(t)}),!1),document.addEventListener("mousemove",(function(t){!function(t){L===f&&i()&&(ht.pitch+=t.movementY*Math.PI*.001*-1,ht.pitch>Math.PI/2&&(ht.pitch=Math.PI/2),ht.pitch<-1*Math.PI/2&&(ht.pitch=-1*Math.PI/2),ht.yaw+=t.movementX*Math.PI*.001*-1)}(t)}),!1),A.addEventListener("mousedown",(function(t){L===u?r(s):L===s?At?he():r(f):L===f?n():L===h?At?he():r(f):L===v?At?he():r(s):L===x&&(At?he():r(u))}),!1),document.addEventListener("pointerlockchange",(function(t){i()||L!==f||r(h)}),!1),X=zzfxM(...Ut),function(){let t=document.getElementById("cursor");O=document.getElementById("terminal"),H=document.getElementById("terminalText"),F>d?(O.style.left="50%",O.style.marginLeft="-"+st/2+"px"):(O.style.top="50%",O.style.marginTop="-"+ft/2+"px"),O.style.width=st+"px",O.style.height=ft+"px",O.style.fontSize=Math.round(.02*ft)+"px",t.style.height=Math.round(.02*ft)+"px",t.style.width=Math.round(.015*ft)+"px"}(),r(u),function(t){xt[ve]=function(){Te("#161616"),ge("rgba(255, 255, 255, 0.05)"),me("rgba(0, 0, 0, 0.3)");for(let t=0;t<4;t++)ye(5,5+8*t),ye(28,5+8*t);return U.toDataURL()}(),xt[0]=(Te("#161616"),N.lineWidth=4,N.lineCap="round",Re((function(t){let e=0===t?"rgba(255, 255, 255, 0.05)":"rgba(0, 0, 0, 0.9)";N.strokeStyle=e,N.beginPath(),N.moveTo(8,16),N.lineTo(8,28),N.stroke(),N.beginPath(),N.moveTo(24,4),N.lineTo(24,16),N.stroke()})),U.toDataURL()),xt[2]=function(){Te("#080808");for(let t=0;t<5;t++)de(5+5*t,2,1,27,"rgba(255, 255, 255, 0.07)"),de(5+5*t+1,3,1,27,"rgba(0, 0, 0, 0.2)");return U.toDataURL()}(),xt[12]=(Te("#2d0304"),pe(),U.toDataURL()),xt[1]=(Te("#03082d"),pe(),U.toDataURL()),xt[3]=(Te("#251808"),ge("rgba(255, 255, 255, 0.1)"),me("rgba(0, 0, 0, 0.5)"),Ee(),U.toDataURL()),xt[11]=(Te("#0c0c01"),ge("rgba(255, 255, 255, 0.1)"),me("rgba(0, 0, 0, 0.5)"),Me(),U.toDataURL()),xt[4]=(Te("#393939"),ge("rgba(255, 255, 255, 0.1)"),me("rgba(0, 0, 0, 0.5)"),Me(),U.toDataURL()),xt[5]=(be(),U.toDataURL()),xt[6]=function(){N.save(),N.translate(32,32),N.scale(-1,-1),be();let t=U.toDataURL();return N.restore(),t}(),xt[7]=function(){Te("#201b1b");let t="rgba(255, 255, 255, 0.2)";return de(3,5,3,22,t),de(4,6,3,22,t),de(14,5,3,22,t),de(15,6,3,22,t),de(25,5,3,22,t),de(26,6,3,22,t),U.toDataURL()}(),xt[10]=(Te("#111111"),ge("rgba(255, 255, 255, 0.05)"),me("rgba(0, 0, 0, 0.3)"),Ee(),U.toDataURL()),xt[8]=(Te("#1e1516"),Re((function(t){let e=0===t?"rgba(0, 0, 0, 0.3)":"rgba(59, 60, 62, 0.5)";!function(t,e){N.fillStyle=t,N.fillRect(3,3,1,26),N.fillRect(28,3,1,26),N.fillRect(3,3,26,1),N.fillRect(3,28,26,1)}(e),de(16,4,1,24,e),de(16,15,12,1,e)})),U.toDataURL());for(let t=0;t<xt.length;t++)xt[t]={encoding:xt[t]};let e=0,n=0;xt.forEach((function(t){!function(){n++;let o=t.glTexture=P.createTexture(),i=t.image=new Image;i.onload=function(){P.activeTexture(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,o),P.texImage2D(P.TEXTURE_2D,0,P.RGBA,P.RGBA,P.UNSIGNED_BYTE,i),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MAG_FILTER,P.NEAREST),P.generateMipmap(P.TEXTURE_2D),++e>=n&&(bt=!0)},i.src=t.encoding}()}))}(),a()}),50);const l={position:[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],texture:[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,1,1,0,1,0,0,1,0,0,1,0,0,1,0,1,1,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1],index:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]},c={};!function(){for(var t=[],e=[],n=[],o=0;o<=24;++o){const n=o/24,r=n*Math.PI,a=Math.cos(r),l=Math.sin(r);for(var i=0;i<=45;++i){const o=i/45,r=i/45*2*Math.PI,c=l*Math.cos(r),u=l*Math.sin(r);t.push(c),t.push(a),t.push(u),e.push(o),e.push(n)}}var r=0,a=46;for(o=0;o<24;++o){for(i=0;i<45;++i){const t=r+i,e=a+i;o>0&&(n.push(t),n.push(e),n.push(t+1)),o+1<24&&(n.push(e),n.push(e+1),n.push(t+1))}r=a,a+=46}c.position=t,c.texture=e,c.index=n}(),window&&window.devicePixelRatio;const u=0,s=1,f=2,h=3,v=4,x=5,d=16/9,p=1300,y=p/d,g=.3,m=0,T=1,b=2,M=3,E=20,R=.01,z=2e3,w=2e3;let A,S,L,I,P,C,B,k,D,F,_,U,N,O,H,Y,G,j,q,W,K,V,X,J,Q=0,Z=[],$=[],tt=[],et=[],nt={},ot={},it={},rt=0,at=0,lt=0,ct=0,ut=0,st=0,ft=0,ht={},vt=0,xt=[],dt=[],pt=0,yt=0,gt=0,mt=0,Tt=0,bt=!1,Mt=[],Et={},Rt={},zt=!0,wt=!1,At=!1,St=[],Lt=[];function It(){Z={},$=[],tt=[],et=[],Mt=[],Lt=[],V=0,ht={isAirborne:!1,sideMovement:0,straightMovement:0,upVelocity:0,pitch:0},zt=!1,wt=!1,pt=0,yt=0,gt=0,mt=0,L===u?(ht.x=0,ht.y=-6,ht.z=0,ht.yaw=Math.PI,Ne(0,-1,26),Bt({x:0,y:1.25,z:1,radius:2,isCore:!0})):1===Q?(ht.x=4,ht.y=.5,ht.z=-10,ht.yaw=Math.PI,Lt=[],Ze(-27,38,-10,24,41,260),je(-27,34,-10,0,41,71),je(-27,34,-10,0,220,260),je(28,34,-10,1,83,105),je(10,16,-10,2,102,112),je(-14,-2,-10,4,111,123),je(-14,-5,-10,-1,140,147),je(0,15,-10,0,161,175),je(-27,-15,-10,0,71,73),je(28,34,-10,1,180,200),en(10,34,0,24,240,240,ve),en(10,10,0,24,240,260,ve),We(-11,19,0,17,-18,40),Je(-16,4,0,18,261,339),He(15,-10,10,24,190,4,20),Ne(-9,10,116),Ge(-23,-15,-10,73,9,1),Ve(13,1,23),Ke(-18,1,44),Ke(-18,5,44),Ve(-22,1,50),Ve(31,1,50),Ke(5,1,170),Ke(25,1,236),Ve(-23,1,231),Ve(5,1,249)):2===Q?(ht.x=0,ht.y=0,ht.z=0,ht.yaw=Math.PI,tn(-28,53,-30,27,71,294),Ge(-25,-18,0,103,10,-1),Ge(45,50,-20,160,10,-1),je(-25,23,-30,0,72,82),je(-25,-17,-30,0,82,110),je(-25,-18,0,10,102,110),je(-25,-18,-30,5,130,140),je(2,14,-30,-6,134,146),je(44,50,-30,-20,134,160),je(44,50,-30,-10,160,180),je(28,36,-30,-5,180,188),je(16,32,-30,-2,200,250),je(10,20,-30,0,260,270),je(-25,50,-30,2,280,294),We(-10,10,0,18,-8,70),Je(8,28,2,20,295,345),He(-3,-30,10,24,100,5,8),Ne(8,0,140),Oe(47,-9,175),Ke(26,-1,202),Xe(26,-1,216),Ve(18,-1,210),Ke(26,-1,222),Xe(20,-1,236),Ve(28,-1,230)):3===Q&&(ht.x=0,ht.y=0,ht.z=8,ht.yaw=Math.PI,tn(-20,20,-15,20,51,410),je(-20,20,-15,0,50,70),$e(10,-15,1,92),Oe(-5,-10,110),$e(-10,-15,-3,140),Oe(5,-10,140),je(4,16,-15,-4,159,171),je(-17,17,-15,-1,190,410),Ne(10,2,165),We(-10,10,0,18,0,50),Je(-12,12,-1,18,411,440),He(0,-1,10,20,200,4,4),He(10,-1,10,20,250,9,4),He(-10,-1,10,20,300,10,4),He(10,-1,10,20,350,12,4)),function(){nt={};let t={};for(let e in Z)for(let n in Z[e])for(let o in Z[e][n]){let i=Z[e][n][o].texture;if(-1===i)continue;void 0===t[i]&&(t[i]=[{position:[],texture:[],index:[],numBlocks:0}]);let r=t[i][t[i].length-1],a=0;for(let t=0;t<l.position.length;t+=3)r.position.push(l.position[t]+2*parseInt(e)+a),r.position.push(l.position[t+1]+2*parseInt(n)+a),r.position.push(l.position[t+2]+2*parseInt(o)+a);Se(r.texture,l.texture);for(let t=0;t<l.index.length;t++)r.index.push(l.index[t]+24*r.numBlocks);r.numBlocks>=2666?t[i].push({position:[],texture:[],index:[],numBlocks:0}):r.numBlocks++}for(let e in t)nt[e]=[],t[e].forEach((function(t){nt[e].push({position:Ce(P,t.position),texture:Ce(P,t.texture),index:Be(P,t.index)})}))}(),function(){let t={position:[],texture:[],index:[]};for(let e=0;e<$.length;e++){let n=$[e];for(let e=0;e<l.position.length;e+=3)t.position.push(5*l.position[e]*2+2*parseInt(n.x)),t.position.push(5*l.position[e+1]*2+2*parseInt(n.y)),t.position.push(5*l.position[e+2]*2+2*parseInt(n.z));Se(t.texture,l.texture);for(let e=0;e<l.index.length;e++)t.index.push(l.index[e])}ot={position:Ce(P,t.position),texture:Ce(P,t.texture),index:Be(P,t.index)}}(),function(){let t={position:[],texture:[],index:[]};for(let e=0;e<c.position.length;e+=3)t.position.push(c.position[e]),t.position.push(c.position[e+1]),t.position.push(c.position[e+2]);Se(t.texture,c.texture);for(let e=0;e<c.index.length;e++)t.index.push(c.index[e]);it={position:Ce(P,t.position),texture:Ce(P,t.texture),index:Be(P,t.index)}}(),function(){let t={position:[],texture:[],index:[]},e=0;for(let n=0;n<7;n++)for(let o=0;o<10;o++)if(!(0===n&&o>3||1===n&&o>4||2===n&&o>5)){for(let e=0;e<l.position.length;e+=3)t.position.push(l.position[e]+2*n),t.position.push(l.position[e+1]+2*o),t.position.push(l.position[e+2]);Se(t.texture,l.texture);for(let n=0;n<l.index.length;n++)t.index.push(l.index[n]+24*e);e++}Et={position:Ce(P,t.position),texture:Ce(P,t.texture),index:Be(P,t.index)}}(),function(){let t={position:[],texture:[],index:[]},e=0,n=[0,-1,0,0,0,1,0,2,0,3,1,4,2,5,3,6,3,7,3,8,3,9,3,10];for(let o=0;o<n.length;o+=2){for(let e=0;e<l.position.length;e+=3)t.position.push(l.position[e]+2*n[o]),t.position.push(l.position[e+1]+2*n[o+1]),t.position.push(l.position[e+2]);Se(t.texture,l.texture);for(let n=0;n<l.index.length;n++)t.index.push(l.index[n]+24*e);e++}Rt={position:Ce(P,t.position),texture:Ce(P,t.texture),index:Be(P,t.index)}}(),function(){let t={position:[],texture:[],index:[]};for(let e=0;e<l.position.length;e+=3)t.position.push(l.position[e]),t.position.push(l.position[e+1]),t.position.push(l.position[e+2]);Se(t.texture,l.texture);for(let e=0;e<l.index.length;e++)t.index.push(l.index[e]);K={position:Ce(P,t.position),texture:Ce(P,t.texture),index:Be(P,t.index)}}()}function Pt(){Ct(),J=Tn(...X),J.loop=!0}function Ct(){J&&J.stop()}function Bt(t){et.push({x:t.x,y:t.y,z:t.z,radius:2,isCore:t.isCore})}function kt(t){const e=ht.x,n=ht.y,o=ht.z,i=t.x,r=t.y,a=t.z,l=t.radius;return Math.pow(e-i,2)+Math.pow(n-r,2)+Math.pow(o-a,2)<l*l}function Dt(){for(let t=0;t<$.length;t++){let e=$[t];if(ht.x>e.x-5&&ht.x<e.x+5&&ht.y>e.y-5&&ht.y<e.y+5&&ht.z>e.z-5&&ht.z<e.z+5)return!0}return!1}function Ft(t){let e=ht.x-t.x,n=ht.y-t.y,o=ht.z-t.z;return Math.sqrt(e*e+n*n+o*o)<20}function _t(t){return ht.z>t}const Ut=[[[.4,0,1e4,,,,,,,,,,.01,6.8,-.2],[1.4,0,84,,,,,.7,,,,.5,,6.7,1,.01],[,0,60,,.1,,2],[2,0,360,,,.12,2,2,,,,,,9,,.1]],[[[,-1,8,,,,,,8,,8,,,,,,8,,8,,,,,,8,,8,,,,,,8,,8,,,,,,8,,8,,,,,,8,,8,,,,,,8,,8,,,,,,8,,],[2,-1,,20,8,8,20,8,,8,,20,,8,20,8,,20,,20,8,8,20,8,,8,,20,,8,20,8,,8,,20,8,8,20,8,,8,,20,,8,20,8,,8,,20,8,8,20,8,,8,,20,,8,20,8,,20],[1,-1,20,,,20,,,20,,20,,,20,,,20,20.5,20,,,20,,,20,,20,,,20,,,20,20.5,20,,,20,,,20,,20,,,20,,,20,20.5,20,,,20,,,20,,20,,,20,,,20,20.25],[3,-1,,,,,32,,,,,,,,32,,,,,,,,32,,,,,,,,32,,,,,,,,32,,,,,,,,32,,,,,,,,32,,,,,,,,32,,,,]],[[,-1,8,,,,,,8,,8,,,,,,8,,6,,,,,,6,,6,,,,,,6,,13,,,,,,13,,13,,,,,,13,,8,,,,,,8,,8,,,,,,8,,],[2,-1,,20,8,8,20,8,,8,,20,,8,20,8,,20,,18,6,6,18,6,,18,,18,,6,18,6,,6,,25,13,13,25,13,,13,,25,13.75,13,25,13,,25,,20,8,8,20,8,,8,,20,,8,20,8,,20],[1,-1,20,,,20,,,20,22.5,20,,,20,,,20,20.25,20,,,20,,,20,,20,,,20,,,20,20.25,20,,,20,,,20,,20,,,20,,,20,20.25,20,,,20,,,20,,20,,,20,,,20,20.25],[3,-1,,,,,32,,,,,,,,32,,,,,,,,32,,,,,,,,32,,,,,,,,32,,,,,,,,32,,,,,,,,32,,,,,,,,32,,,,]],[[,-1,6,,,,,,6,,6,,,,,,6,,11,,,,,,11,,11,,,,,,11,,13,,,,,,13,,13,,,,,,13,,8,,,,,,8,,8,,,,,,8,,],[2,-1,,18,6,6,18,6,,6,,18,,6,18,6,,6,,23,11,11,23,11,,23,,23,,11,23,11,,11,,25,13,13,25,13,,13,,25,13.75,13,25,13,,25,,20,8,8,20,8,,8,,20,,8,20,8,,20],[1,-1,20,,,20,,,20,22.5,20,,,20,,,20,20.25,20,,,20,,,20,,20,,,20,,,20,20.25,20,,,20,,,20,,20,,,20,,,20,20.25,20,,,20,,,20,,20,,,20,,,20,20.25],[3,-1,,,,,32,,,,,,,,32,,,,,,,,32,,,,,,,,32,,,,,,,,32,,,,,,,,32,,,,,,,,32,,,,,,,,32,,,,]],[[3,-1,,,,,32,,,,,,,,32,,,,,,,,32,,,,,,,,32,,,,,,,,32,,,,,,,,32,,,,,,,,32,,,,,,,,32,,,,]]],[0,1,2],,{}],Nt=function(){yn(1,.05,217,.24,.03,.12,1,.58,1.1,0,0,0,0,0,-39,0,0,1,.15,0)},Ot=function(){yn(1.88,.05,44,.13,.05,.12,1,.24,0,0,0,0,0,0,-.1,0,.05,.07,.01,.76)},Ht=function(){yn(.8,.05,87,0,0,0,3,.52,-68,0,-543,.01,0,0,-27,0,0,1,.01,0)},Yt=function(){yn(1.1,.05,48,0,.1,0,1,.08,3.6,0,0,0,0,0,0,0,.05,1,.06,0)},Gt=function(){yn(1.99,.05,6,.09,.14,.46,1,.28,0,0,-54,.09,.06,0,0,0,.15,.54,.04,0)},jt=function(){yn(2.66,.05,687,.23,.1,0,2,1.9,0,0,-568,0,.3,0,71,0,.36,1,.01,.85)},qt=function(){yn(...[,,1875,.06,.19,3,3,.02,,18,-177,.24,,,-101,,,,1,.01])},Wt=function(){yn(...[,,1826,.25,,.16,3,.54,,,272,.04,.09,,,.6,,,.09])},Kt=function(){yn(...[1.79,,1358,.23,.11,.17,3,1.42,-9,,,,,,41,,.41,,.12])},Vt=function(){yn(...[,0,709,.01,.02,.03,1,.44,.1,3.2,,.02,.01,,,,,.3,.04])},Xt=function(){yn(...[1.59,,260,.24,,.05,,.7,64,,135,.22,.01,.1,,,.07,,.01,.54])},Jt=function(){yn(...[1.86,,191,.05,.17,.01,1,2.28,,-81,476,,,.2,163,,.04,.33])},Qt=function(){yn(...[1.05,.5,201,.09,.04,.08,1,1.87,,-25,,,,,55,,,.4,.01])},Zt=function(){yn(...[,,345,.2,.03,.07,,2.62,-.2,,193,.11,.21,,40,,,.42,.01])},$t=function(){yn(1.84,.05,74,.02,.14,.85,0,1.27,.6,.7,0,0,0,.4,-55,.4,.42,.86,.08,0)},te=function(){yn(...[1.3,,17,.1,.24,.33,,1.8,,-.1,70,.03,.09,,,,.09,.98,.09])},ee=function(){yn(...[,,538,1,.09,1,4,2.06,,-.2,474,.04,,.6,.1,.5,,,1])};function ne(t){t()}const oe=["PAUSED","Controls:#[WASD] _Run#[Mouse] Look#[Space] Jump & Double Jump#[Esc] __Pause","CLICK TO CONTINUE","YOU DIED...","CLICK TO PLAY AGAIN","YOU WON!","CLICK TO PLAY AGAIN","LEVEL 1","Dr. Heisenberg, there's no time to explain.  You must leave the ship at once.  The fusion reactors are melting down and we've lost power.  I've created a SAFE SPACE that protects you from radioactive bursts.  Enter it, wait for the burst to pass, and then make your way to the INFIRMARY.  HURRY!!","Controls:#[WASD] _Run#[Mouse] Look#[Space] Jump#[Esc] __Pause","CLICK TO START","LEVEL 2","The radioactive levels in the INFIRMARY are unsafe.  I've sealed the doors.  We've got to get you out another way IMMEDIATELY.","As fast as you can, make your way to the ENGINE ROOM before the hydraulics bridge collapses.  The lower deck is rapidly filling up with rocket fuel.  Avoid at all costs.  GO NOW!!","CLICK TO START","LEVEL 3","Dr. Heisenberg, you're almost there.  The ship is moments away from exploding.  Make your way to Bay 13, I have an escape pod waiting for you.  HURRY!","CLICK TO START"],ie={1:[7,10],2:[11,14],3:[15,17]};function re(){O.style.display="block"}function ae(){O.style.display="none"}function le(t,e,n){var o;t.length<=0?n():("#"===(o=t.shift())?o="<br>":"_"===o&&(o="&nbsp;"),H.innerHTML+=o,e?le(t,e,n):(ne(Vt),G=setTimeout((function(){le(t,e,n)}),10)))}function ce(t,e,n){let o=t.split("");""===H.innerHTML?H.innerHTML="> ":H.innerHTML+="<br><br>> ",le(o,e,n)}function ue(){Y&&clearTimeout(Y),G&&clearTimeout(G)}function se(t,e,n){St=[t,e],At=!0,ue(),H.innerHTML="",fe(t,e,n)}function fe(t,e,n){ce(oe[t],n,(function(){t<e?n?fe(t+1,e,n):Y=setTimeout((function(){fe(t+1,e,n)}),2e3):(At=!1,ne(Zt))}))}function he(){ue(),se(St[0],St[1],!0),At=!1}const ve=9,xe=10;function de(t,e,n,o,i){N.fillStyle=i,N.fillRect(t,e,n,o)}function pe(){for(let t=0;t<4;t++)de(8*t,0,4,32,"rgba(255, 255, 255, 0.05)"),de(2+8*t,0,4,32,"rgba(0, 0, 0, 0.5)")}function ye(t,e){N.beginPath(),N.arc(t,e,1.5,0,2*Math.PI,!1),N.fillStyle="rgba(0, 0, 0, 0.5)",N.fill(),N.beginPath(),N.arc(t-1,e-1,1.5,0,2*Math.PI,!1),N.fillStyle="rgba(255, 255, 255, 0.1)",N.fill()}function ge(t){N.fillStyle=t,N.fillRect(0,0,31,1),N.fillRect(0,0,1,31)}function me(t){N.fillStyle=t,N.fillRect(31,1,1,31),N.fillRect(0,31,31,1)}function Te(t){let e=function(t){t=t.replace("#","");var e=parseInt(t,16);return{r:e>>16&255,g:e>>8&255,b:255&e}}(t);for(let t=0;t<32;t++)for(let n=0;n<32;n++){let o=we({r:Ae(e.r,20),g:Ae(e.g,20),b:Ae(e.b,20)});N.fillStyle=o,N.fillRect(t,n,1,1)}}function be(){Te("#807218"),N.fillStyle="rgba(0, 0, 0, 0.8)",N.beginPath(),N.moveTo(0,0),N.lineTo(32,32),N.lineTo(16,32),N.lineTo(0,16),N.closePath(),N.fill(),N.beginPath(),N.moveTo(16,0),N.lineTo(32,0),N.lineTo(32,16),N.closePath(),N.fill(),N.fillStyle="rgba(255, 255, 255, 0.07)",N.fillRect(0,0,1,32),N.fillStyle="rgba(0, 0, 0, 0.5)",N.fillRect(31,0,1,32)}function Me(){ye(5,5),ye(5,27),ye(27,5),ye(27,27)}function Ee(){for(let t=6;t<32;t+=11)for(let e=6;e<32;e+=11)ye(t,e)}function Re(t){N.save(),N.translate(1,1),t(0),N.restore(),t(1)}function ze(t){var e=t.toString(16);return 1==e.length?"0"+e:e}function we(t){return"#"+ze(t.r)+ze(t.g)+ze(t.b)}function Ae(t,e){let n=Math.floor(t+Math.random()*e);return n>255?n=255:n<0&&(n=0),n}function Se(t,e){t.push.apply(t,e)}function Le(t,e){P.useProgram(k),De(k,P,"ve"),De(k,P,"tc"),ke(k,P,"mv"),ke(k,P,"pm"),ke(k,P,"lightPower"),P.depthMask(!0),P.enable(P.DEPTH_TEST),P.depthFunc(P.LESS),P.disable(P.BLEND),P.bindBuffer(P.ARRAY_BUFFER,t.position),P.vertexAttribPointer(k.ve,3,P.FLOAT,!1,0,0),P.bindBuffer(P.ARRAY_BUFFER,t.texture),P.vertexAttribPointer(k.tc,2,P.FLOAT,!1,0,0),P.activeTexture(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,e),P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,t.index),P.uniformMatrix4fv(k.pm,!1,B),P.uniformMatrix4fv(k.mv,!1,C);let n=L===u?4e3:1e4;P.uniform1f(k.lightPower,n),P.drawElements(P.TRIANGLES,t.index.numElements,P.UNSIGNED_SHORT,0)}function Ie(t,e,n,o,i){P.useProgram(D),De(D,P,"ve"),De(D,P,"tc"),ke(D,P,"mv"),ke(D,P,"pm"),ke(D,P,"t"),ke(D,P,"color"),ke(D,P,"perlinSize"),P.depthMask(!1),P.enable(P.DEPTH_TEST),P.depthFunc(P.LESS),P.enable(P.BLEND),P.blendFunc(P.SRC_ALPHA,P.ONE_MINUS_SRC_ALPHA),P.blendColor(1,1,1,1),P.bindBuffer(P.ARRAY_BUFFER,t.position),P.vertexAttribPointer(D.ve,3,P.FLOAT,!1,0,0),P.bindBuffer(P.ARRAY_BUFFER,t.texture),P.vertexAttribPointer(D.tc,2,P.FLOAT,!1,0,0),P.bindBuffer(P.ELEMENT_ARRAY_BUFFER,t.index),P.uniformMatrix4fv(D.pm,!1,B),P.uniformMatrix4fv(D.mv,!1,C),P.uniform1f(D.t,at*i),P.uniform3fv(D.color,e),P.uniform1f(D.perlinSize,n),P.drawElements(P.TRIANGLES,t.index.numElements,P.UNSIGNED_SHORT,0)}function Pe(t,e,n,o){let i;i=e.createShader(e.FRAGMENT_SHADER),e.shaderSource(i,n),e.compileShader(i),e.attachShader(t,i),i=e.createShader(e.VERTEX_SHADER),e.shaderSource(i,o),e.compileShader(i),e.attachShader(t,i),e.linkProgram(t)}function Ce(t,e){let n=t.createBuffer();return n.numElements=e.length,t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW),n}function Be(t,e){let n=t.createBuffer();return n.numElements=e.length,t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),t.STATIC_DRAW),n}function ke(t,e,n){t[n]=e.getUniformLocation(t,n)}function De(t,e,n){t[n]=e.getAttribLocation(t,n),e.enableVertexAttribArray(t[n])}function Fe(){var t=pn.create();pn.set(C,t),dt.push(t)}function _e(){C=dt.pop()}function Ue(){pn.perspective(45,I.width/I.height,.1,300,B),pn.identity(C),P.viewport(0,0,I.width,I.height),P.clear(P.COLOR_BUFFER_BIT|P.DEPTH_BUFFER_BIT|P.STENCIL_BUFFER_BIT),pn.rotate(C,-ht.pitch+yt,[1,0,0]),pn.rotate(C,-ht.yaw,[0,1,0]),pn.translate(C,[-2*ht.x,-2*(ht.y+6),-2*ht.z]),pn.translate(C,[0,pt,0]);for(let t in nt)nt[t].forEach((function(e){Le(e,xt[t].glTexture)}));let t=100,e=10;L===u&&(t=150,e=10);for(let t=0;t<Mt.length;t++){let e=Mt[t];Fe(),pn.translate(C,[2*(e.x+e.offset),2*e.y,2*e.z]),Le(Et,xt[8].glTexture),pn.scale(C,[-1,-1,1]),pn.translate(C,[4*e.offset,-18,0]),Le(Et,xt[8].glTexture),_e()}for(let t=0;t<Mt.length;t++){let e=Mt[t];Fe(),pn.translate(C,[2*(e.x-1+e.offset),2*e.y,2*e.z]),Le(Rt,xt[5].glTexture),pn.scale(C,[-1,-1,1]),pn.translate(C,[4*(e.offset-1),-18,0]),Le(Rt,xt[6].glTexture),_e()}for(let e=0;e<et.length;e++){let n=et[e],o=!0,i=1e-4,r=2*n.radius;L===u&&(o=!1,i=2e-5,r=2),Fe(),pn.translate(C,[2*n.x,2*n.y,2*n.z]),pn.scale(C,[r,r,r]),Ie(it,[.8,0,0],t,0,i),_e()}Ie(ot,[0,.5,.8],e,0,1e-4),Lt.forEach((function(t){Fe(),pn.translate(C,[2*t.x,2*t.y,2*t.z]),pn.scale(C,[t.scale,4.9,t.scale]),Ie(K,[0,1,0],20,0,5e-6),_e()}))}function Ne(t,e,n){const o=t-5,i=t+5,r=e-5,a=e+5,l=n-5,c=n+5;en(o,i,r,a,l,c,10),sn(o,i,r+1,a-1,l+1,c-1),sn(o+1,i-1,r+1,a,l+1,c-1),sn(o+1,i-1,r+1,a-1,l,c),function(t,e,n){$.push({x:t,y:e,z:n})}(t,e,n)}function Oe(t,e,n){const o=t-1,i=t+1+1,r=e,a=e+2+1,l=n-1,c=n+1+1;en(o,i,r,a,l,c,11),en(o+1,i-1,r+1,a-1,l,c,2),en(o+1,i-1,r,a,l+1,c-1,2),en(o,i,r+1,a-1,l+1,c-1,2)}function He(t,e,n,o,i,r,a){tt.push({x:t,y:n,z:i,burstDelay:a,timeToNextBurst:r}),Bt({x:t,y:n,z:i,isCore:!0}),en(t-1,t+1,e,n-3,i-1,i+1,xe),en(t-1,t+1,n+3,o,i-1,i+1,xe),Ye(t,n-2,i,2),Ye(t,n-1,i,3),Ye(t,n+2,i,3),Ye(t,n+3,i,2),qe(t-2,t+2,e,i-2,i+2),qe(t-2,t+2,o,i-2,i+2)}function Ye(t,e,n,o){en(t-o,t-o,e-1,e,n,n,xe),en(t+o,t+o,e-1,e,n,n,xe),en(t,t,e-1,e,n-o,n-o,xe),en(t,t,e-1,e,n+o,n+o,xe)}function Ge(t,e,n,o,i,r){let a=n+1,l=i;for(;l>0;)1===r?(en(t,e,a,a,o,o+l,ve),en(t,e,a,a,o+l,o+l,5)):(en(t,e,a,a,o-l,o,ve),en(t,e,a,a,o-l,o-l,5)),a++,l--;qe(t-1,e+1,n,o-1,o+i*r)}function je(t,e,n,o,i,r){en(t,e,n,o,i,i,ve),en(t,e,n,o,r,r,ve),en(t,t,n,o,i,r,ve),en(e,e,n,o,i,r,ve),qe(t,e,o,i,r),an(t+1,e-1,o,i+1,r-1),qe(t-1,e+1,n,i-1,r+1)}function qe(t,e,n,o,i){en(t,e,n,n,o,i,5)}function We(t,e,n,o,i,r){Qe(t,e,n,o,i,r,!0),j=r+30}function Ke(t,e,n){Oe(t+5,e,n),Oe(t,e,n),Oe(t-4,e,n+1)}function Ve(t,e,n){!function(t,e,n){Oe(t+1,e,n-2),Oe(t,e,n+3)}(t,e,n),Oe(t+1,e+4,n)}function Xe(t,e,n){Ke(t-1,e,n-4),Ke(t+1,e,n),Ke(t,e,n+5),Ve(t-2,e+4,n),Ve(t+2,e+4,n-1)}function Je(t,e,n,o,i,r){Qe(t,e,n,o,i,r,!1),q=i+10}function Qe(t,e,n,o,i,r,a){Ze(t,e,n,o,i,r),sn(t+1,e-1,n+1,o-1,i,i),sn(t+1,e-1,n+1,o-1,r,r),nn(t,e,n,o,r-1),un((e+t)/2,n+2,r,a),nn(t,e,n,o,i+1),un((e+t)/2,n+2,i,!a)}function Ze(t,e,n,o,i,r){nn(t,e,n,o,i),nn(t,e,n,o,r),on(t,n,o,i,r),rn(t+1,n,o,i,r),rn(e-2,n,o,i,r),on(e,n,o,i,r),function(t,e,n,o,i){en(t,e,n,n,o,i,2);for(let r=o;r<i;r++)r%8==0&&en(t,e,n-2,n,r,r,ve);for(let r=t;r<e;r++)for(let t=o;t<i;t++)(t+4)%32==0&&(r+4)%16==0&&(en(r-2,r+2,n-1,n-1,t-2,t+2,ve),en(r-1,r+1,n-1,n-1,t-1,t+1,7))}(t,e,o,i,r),function(t,e,n,o){en(t,t,e,e,n,o,12),en(t,t,e-2,e-2,n,o,1),en(t,t,e-8,e-8,n,o,12),en(t,t,e-10,e-10,n,o,1)}(e-1,o-2,i,r),function(t,e,n,o){en(t-1,t+1,e-1,e+1,n,o,4)}(t+4,o-4,i,r),an(t,e,n,i,r)}function $e(t,e,n,o){je(t-5,t+5,e,n-4,o-5,o+5),je(t-4,t+4,n-4,n,o-4,o+4)}function tn(t,e,n,o,i,r){Ze(t,e,n,o,i,r),Lt.push({x:(t+e)/2,y:n+3,z:(i+r)/2,scale:Math.max(t-e,r-i)})}function en(t,e,n,o,i,r,a){for(let l=t;l<=e;l++)for(let t=n;t<=o;t++)for(let e=i;e<=r;e++)ln(l,t,e,a)}function nn(t,e,n,o,i){en(t,e,n,o,i,i,2)}function on(t,e,n,o,i){en(t,t,e,n,o,i,2)}function rn(t,e,n,o,i){for(let r=o;r<i;r++)r%8==0&&en(t,t+1,e,n,r,r,ve)}function an(t,e,n,o,i){let r=e-t>16&&i-o>16;for(let a=t;a<=e;a++)for(let t=o;t<=i;t++)ln(a,n,t,!r||a%8!=0&&t%8!=0?0:2)}function ln(t,e,n,o){void 0===Z[t]&&(Z[t]=[]),void 0===Z[t][e]&&(Z[t][e]=[]),Z[t][e][n]={texture:o}}function cn(t,e,n,o){en(t-6,t+6,e,e+10,n,n,o),sn(t-5,t+5,e+1,e+9,n,n)}function un(t,e,n,o){cn(t,e-1,n+3,3),cn(t,e-1,n+2,3),cn(t,e-1,n-1,7),function(t,e,n,o){Mt.push({x:t,y:e,z:n,offset:0,state:m,isActive:o})}(t,e,n,o),cn(t,e-1,n+1,7),cn(t,e-1,n-2,3),cn(t,e-1,n-3,3),o||en(t-10,t+10,e-10,e+10,n,n,-1)}function sn(t,e,n,o,i,r){for(let a=t;a<=e;a++)for(let t=n;t<=o;t++)for(let e=i;e<=r;e++)fn(a,t,e)}function fn(t,e,n){Z[t]&&Z[t][e]&&Z[t][e][n]&&delete Z[t][e][n]}function hn(t,e,n){t=Math.round(t),e=Math.round(e),n=Math.round(n);let o=Z[t]&&Z[t][e]&&Z[t][e][n];return o?{x:t,y:e,z:n,texture:o.texture}:null}function vn(t,e,n,o){let i=t.x,r=t.y,a=t.z,l=Math.abs(n),c=Math.sign(n),u=n>0?7:0;for(let e=0;e<l+g;e+=g){if(e>l&&(e=l),hn(t.x,t.y+e*c+u,t.z)){t.upVelocity=0,n<0&&(t.isAirborne=!1,vt=0);break}r=t.y+e*c}let s=Math.abs(e),f=Math.sign(e);for(let e=0;e<s+g;e+=g){if(e>s&&(e=s),hn(t.x+e*f+.5*f,r,t.z)){hn(t.x+e*f+.5*f,r+1,t.z)||(r+=1);break}i=t.x+e*f}let h=Math.abs(o),v=Math.sign(o);for(let e=0;e<h+g;e+=g){if(e>h&&(e=h),hn(i,r,t.z+e*v+.5*v)){hn(i,r+1,t.z+e*v+.5*v)||(r+=1);break}a=t.z+e*v}t.x=i,t.y=r,t.z=a}var xn="undefined"!=typeof Float32Array?Float32Array:"undefined"!=typeof WebGLFloatArray?WebGLFloatArray:Array,dn=function(t){return new xn(9)},pn={create:function(t){return new xn(16)},set:function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},toInverseMat3:function(t,e){var n=t[0],o=t[1],i=t[2],r=t[4],a=t[5],l=t[6],c=t[8],u=t[9],s=t[10],f=s*a-l*u,h=-s*r+l*c,v=u*r-a*c,x=n*f+o*h+i*v;return x?(x=1/x,e||(e=dn()),e[0]=f*x,e[1]=(-s*o+i*u)*x,e[2]=(l*o-i*a)*x,e[3]=h*x,e[4]=(s*n-i*c)*x,e[5]=(-l*n+i*r)*x,e[6]=v*x,e[7]=(-u*n+o*c)*x,e[8]=(a*n-o*r)*x,e):null},translate:function(t,e,n){var o=e[0],i=e[1];if(e=e[2],!n||t==n)return t[12]=t[0]*o+t[4]*i+t[8]*e+t[12],t[13]=t[1]*o+t[5]*i+t[9]*e+t[13],t[14]=t[2]*o+t[6]*i+t[10]*e+t[14],t[15]=t[3]*o+t[7]*i+t[11]*e+t[15],t},scale:function(t,e,n){var o=e[0],i=e[1];return e=e[2],n&&t!=n?(n[0]=t[0]*o,n[1]=t[1]*o,n[2]=t[2]*o,n[3]=t[3]*o,n[4]=t[4]*i,n[5]=t[5]*i,n[6]=t[6]*i,n[7]=t[7]*i,n[8]=t[8]*e,n[9]=t[9]*e,n[10]=t[10]*e,n[11]=t[11]*e,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n):(t[0]*=o,t[1]*=o,t[2]*=o,t[3]*=o,t[4]*=i,t[5]*=i,t[6]*=i,t[7]*=i,t[8]*=e,t[9]*=e,t[10]*=e,t[11]*=e,t)},rotate:function(t,e,n,o){var i=n[0],r=n[1];n=n[2];var a=Math.sqrt(i*i+r*r+n*n);if(!a)return null;1!=a&&(i*=a=1/a,r*=a,n*=a);var l=Math.sin(e),c=Math.cos(e),u=1-c;e=t[0],a=t[1];var s=t[2],f=t[3],h=t[4],v=t[5],x=t[6],d=t[7],p=t[8],y=t[9],g=t[10],m=t[11],T=i*i*u+c,b=r*i*u+n*l,M=n*i*u-r*l,E=i*r*u-n*l,R=r*r*u+c,z=n*r*u+i*l,w=i*n*u+r*l;return i=r*n*u-i*l,r=n*n*u+c,(o=t)[0]=e*T+h*b+p*M,o[1]=a*T+v*b+y*M,o[2]=s*T+x*b+g*M,o[3]=f*T+d*b+m*M,o[4]=e*E+h*R+p*z,o[5]=a*E+v*R+y*z,o[6]=s*E+x*R+g*z,o[7]=f*E+d*R+m*z,o[8]=e*w+h*i+p*r,o[9]=a*w+v*i+y*r,o[10]=s*w+x*i+g*r,o[11]=f*w+d*i+m*r,o},frustum:function(t,e,n,o,i,r,a){a||(a=pn.create());var l=e-t,c=o-n,u=r-i;return a[0]=2*i/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*i/c,a[6]=0,a[7]=0,a[8]=(e+t)/l,a[9]=(o+n)/c,a[10]=-(r+i)/u,a[11]=-1,a[12]=0,a[13]=0,a[14]=-r*i*2/u,a[15]=0,a},perspective:function(t,e,n,o,i){return e*=t=n*Math.tan(t*Math.PI/360),pn.frustum(-e,e,-t,t,n,o,i)}};const yn=(...t)=>Tn(bn(...t)),gn=44100,mn=new(window.AudioContext||webkitAudioContext),Tn=(...t)=>{let e=mn.createBuffer(t.length,t[0].length,gn),n=mn.createBufferSource();return t.map(((t,n)=>e.getChannelData(n).set(t))),n.buffer=e,n.connect(mn.destination),n.start(),n},bn=(t=1,e=.05,n=220,o=0,i=0,r=.1,a=0,l=1,c=0,u=0,s=0,f=0,h=0,v=0,x=0,d=0,p=0,y=1,g=0,m=0)=>{let T,b,M=2*Math.PI,E=c*=500*M/gn/gn,R=n*=(1+2*e*Math.random()-e)*M/gn,z=[],w=0,A=0,S=0,L=1,I=0,P=0,C=0;for(u*=500*M/gn**3,x*=M/gn,s*=M/gn,f*=gn,h=h*gn|0,b=(o=o*gn+9)+(g*=gn)+(i*=gn)+(r*=gn)+(p*=gn)|0;S<b;z[S++]=C)++P%(100*d|0)||(C=a?a>1?a>2?a>3?Math.sin((w%M)**3):Math.max(Math.min(Math.tan(w),1),-1):1-(2*w/M%2+2)%2:1-4*Math.abs(Math.round(w/M)-w/M):Math.sin(w),C=(h?1-m+m*Math.sin(M*S/h):1)*(C>0?1:-1)*Math.abs(C)**l*t*.3*(S<o?S/o:S<o+g?1-(S-o)/g*(1-y):S<o+g+i?y:S<b-p?(b-S-p)/r*y:0),C=p?C/2+(p>S?0:(S<b-p?1:(b-S)/p)*z[S-p|0]/2):C),T=(n+=c+=u)*Math.cos(x*A++),w+=T-T*v*(1-1e9*(Math.sin(S)+1)%2),L&&++L>f&&(n+=s,R+=s,L=0),!h||++I%h||(n=R,c=E,L=L||1);return z};
//! ZzFXM (v2.0.3) | (C) Keith Clark | MIT | https://github.com/keithclark/ZzFXM
zzfxM=(t,e,n,o=125)=>{let i,r,a,l,c,u,s,f,h,v,x,d,p,y,g,m=0,T=[],b=[],M=[],E=0,R=0,z=1,w={},A=gn/o*60>>2;for(;z;E++)T=[z=f=x=p=0],n.map(((o,x)=>{for(s=e[o][E]||[0,0,0],z|=!!e[o][E],g=p+(e[o][0].length-2-!f)*A,y=x==n.length-1,r=2,l=p;r<s.length+y;f=++r){for(c=s[r],h=r==s.length+y-1&&y||v!=(s[0]||0)|c|0,a=0;a<A&&f;a++>A-99&&h?d+=(d<1)/99:0)u=(1-d)*T[m++]/2||0,b[l]=(b[l]||0)-u*R+u,M[l]=(M[l++]||0)+u*R+u;c&&(d=c%1,R=s[1]||0,(c|=0)&&(T=w[[v=s[m=0]||0,c]]=w[[v,c]]||(i=[...t[v]],i[2]*=2**((c-12)/12),c>0?bn(...i):[])))}p=g}));return[b,M]};const Mn="precision highp float;varying vec2 vTextureCoord;varying vec3 vLightWeighting;uniform sampler2D sa;void main(){lowp vec4 a;a.w=1.0;a.xyz=(texture2D(sa,vTextureCoord).xyz*vLightWeighting);gl_FragColor=a;}",En="precision highp float;varying vec2 vTextureCoord;varying float vTime;varying vec3 vColor;varying float vPerlinSize;void main(){vec3 a;a.z=1.0;a.xy=((vTextureCoord+vec2(vTime))*vec2(vPerlinSize));vec4 b;vec4 c;vec4 d;vec4 e;vec3 f;f=floor(a);vec3 g;g=(f-(floor((f*0.003460208))*289.0));vec3 h;vec3 i;i=(g+vec3(1.0,1.0,1.0));h=(i-(floor((i*0.003460208))*289.0));vec3 j;j=fract(a);vec3 k;k=(j-vec3(1.0,1.0,1.0));vec3 l;l=(((j*j)*j)*((j*((j*6.0)-15.0))+10.0));vec4 m;m.x=g.x;m.y=h.x;m.z=g.x;m.w=h.x;vec4 n;n.xy=g.yy;n.zw=h.yy;vec4 o;o=(((m*34.0)+1.0)*m);vec4 p;p=((o-(floor((o*0.003460208))*289.0))+n);vec4 q;vec4 r;r=(((p*34.0)+1.0)*p);q=(r-(floor((r*0.003460208))*289.0));vec4 s;s=(q+g.zzzz);vec4 t;t=(((s*34.0)+1.0)*s);vec4 u;u=(q+h.zzzz);vec4 v;v=(((u*34.0)+1.0)*u);vec4 w;w=((t-(floor((t*0.003460208))*289.0))*0.1428571);vec4 x;x=(fract((floor(w)*0.1428571))-0.5);vec4 y;y=((v-(floor((v*0.003460208))*289.0))*0.1428571);vec4 z;z=(fract((floor(y)*0.1428571))-0.5);vec4 A;A=fract(w);vec4 B;B=fract(y);vec4 C;C=((vec4(0.5,0.5,0.5,0.5)-abs(A))-abs(x));vec4 D;D=vec4(greaterThanEqual(vec4(0.0,0.0,0.0,0.0),C));vec4 E;E=((vec4(0.5,0.5,0.5,0.5)-abs(B))-abs(z));vec4 F;F=vec4(greaterThanEqual(vec4(0.0,0.0,0.0,0.0),E));e=(A-(D*(vec4(greaterThanEqual(A,vec4(0.0,0.0,0.0,0.0)))-0.5)));d=(x-(D*(vec4(greaterThanEqual(x,vec4(0.0,0.0,0.0,0.0)))-0.5)));c=(B-(F*(vec4(greaterThanEqual(B,vec4(0.0,0.0,0.0,0.0)))-0.5)));b=(z-(F*(vec4(greaterThanEqual(z,vec4(0.0,0.0,0.0,0.0)))-0.5)));vec3 G;G.x=e.x;G.y=d.x;G.z=C.x;vec3 H;H.x=e.y;H.y=d.y;H.z=C.y;vec3 I;I.x=e.z;I.y=d.z;I.z=C.z;vec3 J;J.x=e.w;J.y=d.w;J.z=C.w;vec3 K;K.x=c.x;K.y=b.x;K.z=E.x;vec3 L;L.x=c.y;L.y=b.y;L.z=E.y;vec3 M;M.x=c.z;M.y=b.z;M.z=E.z;vec3 N;N.x=c.w;N.y=b.w;N.z=E.w;vec4 O;O.x=dot(G,G);O.y=dot(I,I);O.z=dot(H,H);O.w=dot(J,J);vec4 P;P=(1.792843-(0.8537347*O));vec4 Q;Q.x=dot(K,K);Q.y=dot(M,M);Q.z=dot(L,L);Q.w=dot(N,N);vec4 R;R=(1.792843-(0.8537347*Q));vec3 S;S.x=k.x;S.yz=j.yz;vec3 T;T.x=j.x;T.y=k.y;T.z=j.z;vec3 U;U.xy=k.xy;U.z=j.z;vec4 V;V.x=dot((G*P.x),j);V.y=dot((H*P.z),S);V.z=dot((I*P.y),T);V.w=dot((J*P.w),U);vec3 W;W.xy=j.xy;W.z=k.z;vec3 X;X.x=k.x;X.y=j.y;X.z=k.z;vec3 Y;Y.x=j.x;Y.yz=k.yz;vec4 Z;Z.x=dot((K*R.x),W);Z.y=dot((L*R.z),X);Z.z=dot((M*R.y),Y);Z.w=dot((N*R.w),k);vec4 ba;ba=mix(V,Z,l.z);mediump vec4 bb;bb.w=0.4;bb.xyz=(vec3((2.2*mix(mix(ba.x,ba.z,l.y),mix(ba.y,ba.w,l.y),l.x)))+vColor);gl_FragColor=bb;}",Rn="attribute vec3 ve;attribute vec2 tc;uniform mat4 mv;uniform mat4 pm;uniform float t;uniform vec3 color;uniform float perlinSize;varying vec2 vTextureCoord;varying float vTime;varying vec3 vColor;varying float vPerlinSize;void main(){vec4 a;a.w=1.0;a.xyz=ve;gl_Position=(pm*(mv*a));vTextureCoord=tc;vTime=t;vColor=color;vPerlinSize=perlinSize;}",zn="attribute vec3 ve;attribute vec2 tc;uniform mat4 mv;uniform mat4 pm;uniform float lightPower;varying vec2 vTextureCoord;varying highp vec3 vLightWeighting;void main(){highp vec3 a;float b;highp vec4 c;vec4 d;d.w=1.0;d.xyz=ve;vec4 e;e=(mv*d);highp vec4 f;f=(pm*e);c=f;gl_Position=f;vTextureCoord=tc;float g;vec3 h;h=-(e.xyz);g=sqrt(dot(h,h));float i;i=(lightPower/(g*g));b=i;if((i>6.0)){b=6.0;}a=vec3(b);c.y=(f.y/1.777778);highp float j;highp vec2 k;k=-(c.xy);j=sqrt(dot(k,k));if(((j>30.0)&&(j<33.0))){a=(vec3(b)*((-0.3*j)+10.0));}else{if((j>33.0)){a=(a*0.1);}}vLightWeighting=a;}"}();</script></body></html>