<div style="perspective: 2000px;"><canvas style="transition: transform 1s ease;" id="p" width="1024" height="512"></canvas></div>
<img hidden id="g" src="sprite.png">
<input onclick="musicBox.muted=(musicBox.muted)?0:1; this.value=(musicBox.muted)?'unmute':'muted';" type="button" value="mute">
<script type="text/javascript" src="./sound.js"></script>
<script>
	for(s=0,ss=0,poutres=[],coins=[],interruptors=[],xinit=[2,1],yinit=[14,2],xpos=xinit[0],ypos=yinit[0],lvl=0,score=0,music={songData:[{i:[0,164,152,0,0,170,152,12,0,0,24,16,60,0,0,0,0,0,0,2,46,0,0,32,47,3,121,2],p:[1],c:[{n:[104,,,108,,,111,,113,,,,,,,,116,,,115,,,113,,111],f:[]}]},{i:[0,20,152,0,0,65,152,12,0,0,2,0,60,0,0,0,0,0,0,2,255,0,0,32,47,3,157,2],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,69,128,0,3,121,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]}],rowLen:11025,patternLen:32,endPattern:2},coinSound={songData:[{i:[0,164,152,0,0,170,152,12,0,0,24,16,60,0,0,0,0,0,0,2,46,0,0,32,47,3,121,2],p:[1],c:[{n:[120],f:[]}]},{i:[0,20,152,0,0,65,152,12,0,0,2,0,60,0,0,0,0,0,0,2,255,0,0,32,47,3,157,2],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,69,128,0,3,121,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]}],rowLen:6615,patternLen:6,endPattern:2},win={songData:[{i:[0,255,152,0,0,255,152,12,0,0,24,16,37,0,0,0,0,0,0,2,48,0,0,32,47,3,157,2],p:[1],c:[{n:[106,108,115],f:[]}]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]}],rowLen:5513,patternLen:10,endPattern:2},doorSound={songData:[{i:[0,255,152,0,0,255,152,12,0,0,2,0,60,0,0,0,0,0,0,2,255,0,0,32,47,3,157,2],p:[1],c:[{n:[125],f:[]}]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]}],rowLen:5513,patternLen:8,endPattern:2},moveSound={songData:[{i:[0,124,152,0,0,119,152,12,0,0,2,0,60,0,0,0,0,0,0,2,255,0,0,32,47,3,157,2],p:[1],c:[{n:[99],f:[]}]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]}],rowLen:5513,patternLen:4,endPattern:2},portalSound={songData:[{i:[0,95,152,0,0,116,152,12,0,0,47,17,79,0,0,0,0,0,0,2,255,0,0,32,47,3,157,2],p:[1],c:[{n:[111,114],f:[]}]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[],c:[]}],rowLen:5513,patternLen:12,endPattern:2},player=new CPlayer,player.init(music),player.generate(),wave=player.createWave(),musicBox=document.createElement("audio"),musicBox.src=URL.createObjectURL(new Blob([wave],{type:"audio/wav"})),musicBox.loop=!0,musicBox.play(),playSound=function(e){player.init(e),player.generate(),wave=player.createWave(),soundbox=document.createElement("audio"),soundbox.src=URL.createObjectURL(new Blob([wave],{type:"audio/wav"})),soundbox.play()},m=[[" eee                         eee"," e                             e","    eee                   eee   ","    e                       e   ","       eee            eee       ","       e                e       ","                                ","  m     m                  m    ","                       h        ","                                ","       e                    e   ","       eee                eee   ","    e                          e","    eee                      eee"," e    l      g               lfe"," eeeeee               eee    eee"],["                                ","             e                  ","             e                  "," eeeee       e    l      e      ","   e              l     fe      ","                 gl   eeee      ","                                ","  e                             ","  e                        e    ","  e                       ge    ","          eeeeeeeee        e    ","   e            h e             ","   eg       e                   ","   eeeeeeeeee   ee              ","                                ","                                "]],i=0;i<m.length;++i)for(poutres[i]=[],coins[i]=[],interruptors[i]=[],j=0;j<m[i].length;++j)for(m[i][j]=m[i][j].split(""),k=0;k<m[i][j].length;k++)"l"==m[i][j][k]&&poutres[i].push({x:k,y:j}),"g"==m[i][j][k]&&coins[i].push({x:k,y:j}),"h"==m[i][j][k]&&interruptors[i].push({x:k,y:j});c=p.getContext("2d"),d=function(e,i,l){c.drawImage(g,32*l,0,32,32,32*e,32*i,32,32)},onkeyup=function(e){e=e.keyCode,37==e&&0==s&&(s=4,ss=0),38==e&&0==s&&(s=2,ss=0),39==e&&0==s&&(s=3,ss=0),40==e&&0==s&&(s=1,ss=0)},a=function(e,l,o){if(void 0==m[lvl][ypos+l]||void 0==m[lvl][ypos+l][xpos+e]){for(s=0,ss=0,i=0;i<coins[lvl].length;++i)" "==m[lvl][coins[lvl][i].y][coins[lvl][i].x]&&(score--,m[lvl][coins[lvl][i].y][coins[lvl][i].x]="g");for(i=0;i<interruptors[lvl].length;++i)m[lvl][interruptors[lvl][i].y][interruptors[lvl][i].x]="h";for(i=0;i<poutres[lvl].length;++i)m[lvl][poutres[lvl][i].y][poutres[lvl][i].x]="l";ypos=yinit[lvl],xpos=xinit[lvl]}else if(" "==m[lvl][ypos+l][xpos+e])ypos+=l,xpos+=e;else if("f"==m[lvl][ypos+l][xpos+e])s=0,ss=0,lvl++,ypos=yinit[lvl],xpos=xinit[lvl],p.style.transform=null,playSound(win);else if("g"==m[lvl][ypos+l][xpos+e])score++,playSound(coinSound),m[lvl][ypos+l][xpos+e]=" ",ypos+=l,xpos+=e;else if("h"==m[lvl][ypos+l][xpos+e]){for(playSound(doorSound),i=0;i<poutres[lvl].length;++i)m[lvl][poutres[lvl][i].y][poutres[lvl][i].x]=" ";for(i=0;i<interruptors[lvl].length;++i)m[lvl][interruptors[lvl][i].y][interruptors[lvl][i].x]="i";ypos+=l,xpos+=e}else if("i"==m[lvl][ypos+l][xpos+e]){for(playSound(doorSound),i=0;i<poutres[lvl].length;++i)m[lvl][poutres[lvl][i].y][poutres[lvl][i].x]="l";for(i=0;i<interruptors[lvl].length;++i)m[lvl][interruptors[lvl][i].y][interruptors[lvl][i].x]="h";ypos+=l,xpos+=e}else if("m"==m[lvl][ypos+l][xpos+e])p.style.transform=p.style.transform?null:"rotateY(180deg)",playSound(portalSound),ypos+=l,xpos+=e;else if("e"!=m[lvl][ypos+l][xpos+e]&&"l"!=m[lvl][ypos+l][xpos+e]){for(s=0,ss=0,i=0;i<coins[lvl].length;++i)" "==m[lvl][coins[lvl][i].y][coins[lvl][i].x]&&(score--,m[lvl][coins[lvl][i].y][coins[lvl][i].x]="g");for(i=0;i<interruptors[lvl].length;++i)m[lvl][interruptors[lvl][i].y][interruptors[lvl][i].x]="h";for(i=0;i<poutres[lvl].length;++i)m[lvl][poutres[lvl][i].y][poutres[lvl][i].x]="l";ypos=yinit[lvl],xpos=xinit[lvl]}else s=0,ss=o,playSound(moveSound)},g.onload=function(){setInterval(function(){for(p.width=p.width,i=0;i<m[lvl].length;++i)for(j=0;j<m[lvl][i].length;++j)" "!=m[lvl][i][j]&&d(j,i,m[lvl][i][j].charCodeAt(0)-96);switch(s){case 0:break;case 1:a(0,1,1);break;case 2:a(0,-1,2);break;case 3:a(1,0,3);break;case 4:a(-1,0,4)}d(xpos,ypos,ss)},50)};
</script>
