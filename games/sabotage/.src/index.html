<!DOCTYPE html><html><head><meta charset="UTF-8"/></head><body><div style="width: 640px; height: 480px; margin: 0 auto;"><canvas width="640" height="480" style="background: #28292b;"></canvas></div><script src="kontra.js"></script><script>function GR(a,b){return Math.floor(Math.random()*(b-a+1))+a}var K=Q;K.init();for(var I=[0,0,0,0,0,0],i=0;i<I.length;i++)if(I[i]=new Image,1==i||3==i||4==i)I[i].src="s/tile"+i.toString()+".png";var si=[new Image,new Image,new Image];si[0].src="s/s.png";si[1].src="s/f.png";si[2].src="s/m.png";
  var ss=K.sprite({x:160,y:220,image:si[0]}),fs=K.sprite({x:160,y:220,image:si[1]}),ms=K.sprite({x:180,y:220,image:si[2]}),gS=0,L={l:[[1,1,1,1,1,5,5,5,5,5,5,5,5,5,5,3,3,3,3,3,1,1,1,1,1,1,5,5,5,5,5,5,5,5,3,3,0,1,1,3,1,1,1,1,1,1,1,5,5,5,5,5,0,3,3,1,1,1,1,3,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,4,1,1,1,4,0,1,5,5,5,5,5,1,1,1,1,1,1,1,1,4,1,1,1,4,0,5,5,5,5,5,5,5,1,1,1,1,1,1,1,4,4,1,4,4,5,5,5,5,5,5,5,5,5,5,1,1,1,1,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,1,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,1,5,5,1,1,1,1,1,
  1,5,5,5,5,5,5,5,5,5,1,1,1,1,1,1,1,4,4,1,1,1,5,5,5,5,5,5,5,1,1,0,4,0,1,1,4,4,4,1,1,5,5,5,5,5,5,5,5,1,1,4,4,4,1,1,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,4,0,1,1,4,1,1,4,4,1,1,5,5,5,5,5,5,5,1,0,4,0,1,1,4,4,4,4,4,0,0,1,5,5,5,5,5,5,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,5,5,5,1,1,1,1,1,1,0,0,0,1,1,0,0,0,1,1,1,1,5,5,5,1,1,1,1,1,0,4,4,1,1,4,4,0,1,1,5,5,5,5,5,5,1,1,1,1,0,4,1,1,1,1,4,0,1,1,1,5,5,5,5,5,5,1,1,1,0,4,1,1,1,1,4,4,1,1,1,1,5,5,5,5,1,1,1,1,0,4,1,1,1,1,4,0,1,1,1,5,5,5,1,1,1,1,1,1,0,4,4,1,1,4,4,0,
  1,1,1,1,1,5,1,1,3,0,3,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,3,3,3,3,3,3,3,3,1,1,1,1,3,3,3,3,3,3,3,3,4,1,0,3,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,4,4,1,1,0,1,1,1,1,1,4,4,1,1,1,0,3,0,1,1,4,4,0,3,0,3,1,1,1,0,4,4,0,1,1,3,4,3,1,1,4,4,1,1,0,1,1,1,4,4,1,1,4,4,1,0,3,0,1,1,4,4,1,0,3,1,1,1,4,4,1,1,4,4,1,1,1,1,1,1,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4],[1,1,1,1,1,1,1,4,4,4,4,4,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,4,4,1,1,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,0,4,4,1,1,4,4,4,4,4,4,1,1,1,1,0,3,0,1,1,1,0,4,5,5,4,0,
  1,1,0,0,1,1,1,1,3,3,3,1,1,1,0,4,5,5,4,1,1,1,0,1,1,1,1,1,0,3,0,1,1,1,0,4,5,4,4,1,1,1,3,3,3,1,1,1,1,1,1,1,1,4,4,4,5,4,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,4,1,5,5,4,0,1,1,1,1,1,1,4,4,4,4,4,4,4,4,4,1,5,5,4,4,1,1,1,3,1,1,4,4,4,1,1,1,1,4,4,1,5,5,5,4,0,1,1,3,1,1,0,4,0,1,1,1,1,4,4,1,5,5,5,4,4,1,1,3,1,1,1,1,1,1,1,1,1,4,1,1,5,5,5,5,4,0,1,3,1,0,4,4,0,1,1,4,4,4,1,1,5,5,5,5,4,4,0,1,1,4,4,4,4,1,0,4,1,1,1,5,5,5,5,5,5,4,4,4,4,4,4,4,4,4,4,4,1,1,1,5,5]],ap:[[32,384],[320,384],[480,320]],aI:new Image,a:null,f:0,rs:0,c:0,
  nv:0,lN:function(a,b){L.c<=L.l.length-1?(bd.splice(0,bd.length),T.t.splice(0,T.t.length),T.d.splice(0,T.d.length),T.v.splice(0,T.v.length),b||L.c++,T.f(),a.cId=0,P.s.x=0,P.s.y=0,L.f=0):0==L.nv&&(L.nv=setTimeout(function(){ad(0);gS=4},1E3))}};
  bu=function(a,b,d,c){this.sp=K.sprite({x:b,y:d,dx:0,width:GR(6,14),height:GR(6,14),color:bc[a]});a=1;1==GR(0,2)&&(a=-1);this.tx=b+a*GR(32,48);1==GR(0,2)&&(a=1);this.ty=d+a*GR(32,48);this.u=function(){this.sp.x<this.tx&&(this.sp.x+=8);this.sp.y<this.ty&&(this.sp.y+=8)}};var bd=[];bc=["#b7122b","#5b0613","#ea0211"];function Abd(a,b,d){bd.push(new bu(GR(0,2),a,b,d))}
  var T={t:[],v:[],d:[],cl:["#202e44","#8ea79f","#2d3a37","#265934"],f:function(){L.aI.src="s/an.png";L.a=K.sprite({x:L.ap[L.c][0],y:L.ap[L.c][1],dx:0,image:L.aI});for(var a=0,b=0,d=0,c=0;15>d;d++,b+=32){for(var f=0;20>f;f++,c++,a+=32)this.v.push(0),T.d[c]=L.l[L.c][c],T.t[c]=0!=T.d[c]&&5!=T.d[c]?K.sprite({x:a,y:b,dx:0,image:I[L.l[L.c][c]]}):0==T.d[c]?K.sprite({x:a,y:b,dx:0,width:32,height:32,color:"#212121"}):K.sprite({x:a,y:b,dx:0,width:32,height:32,color:"#41959a"}),T.t[c].x==L.a.x&&T.t[c].y==L.a.y&&
  (this.v[c]=1);a=0}a=P.rd.x;b=P.rd.y;for(d=0;16>d;d++)for(P.rd.x=GR(0,600),P.rd.y=GR(0,400),c=0;c<T.t.length;c++)T.t[c].collidesWith(P.rd)&&(T.v[c]=1);P.rd.x=a;P.rd.y=b;E.add()},R:function(){for(var a=0;a<T.t.length;a++)this.v[a]&&T.t[a].render()}},P={imgs:[],v:0,s:0,cf:0,cId:0,kf:0,flp:0,tps:{x:0,y:0},animIntv:0,cs:1,kn:K.sprite({x:0,y:0,width:96,height:96,color:"pink"}),rd:K.sprite({x:0,y:0,width:160,height:160,color:"#41959a"}),rev:function(){P.rd.x=P.s.x-64;P.rd.y=P.s.y-64;for(var a=0;a<T.t.length;a++)T.v[a]||
  P.rd.collidesWith(T.t[a])&&(T.v[a]=1)},init:function(){for(var a=0;4>a;a++)P.imgs[a]=new Image,P.imgs[a].src="s/pl"+a.toString()+".png";P.s=K.sprite({x:0,y:0,image:P.imgs[0]});P.rev()},smoothM:function(){P.s.x<P.tps.x&&(P.s.x+=1);P.s.x>P.tps.x&&--P.s.x;P.s.y<P.tps.y&&(P.s.y+=1);P.s.y>P.tps.y&&--P.s.y;P.s.image=P.imgs[P.cf];P.rev();P.kn.x=P.s.x-32;P.kn.y=P.s.y-32},M:function(a){P.kf||("l"==a?(0<P.cId&&3>T.d[P.cId-1]&&0<P.s.x&&P.cId--,P.cf=1):"r"==a&&(P.cId<T.d.length-1&&3>T.d[P.cId+1]&&608>P.s.x&&
  P.cId++,P.cf=0),"u"==a&&(0<=P.cId-20&&3>T.d[P.cId-20]&&(P.cId-=20),P.cf=2),"d"==a&&(P.cId+20<T.d.length-1&&3>T.d[P.cId+20]&&(P.cId+=20),P.cf=3),P.v=0==T.d[P.cId]?0:1,P.tps.x=T.t[P.cId].x,P.tps.y=T.t[P.cId].y,P.animIntv=setInterval(P.smoothM,10),P.kf=1,setTimeout(function(){P.kf=0;clearInterval(P.animIntv)},320),E.M())},at:function(){for(var a=0;a<E.m.length;a++){var b=E.m[a].id;if(E.m[a].ak&&(P.s.x==E.m[a].sp.x&&32==Math.abs(P.s.y-E.m[a].sp.y)||P.s.y==E.m[a].sp.y&&32==Math.abs(P.s.x-E.m[a].sp.x))){E.m[a].r.width=
  0;for(var d=GR(4,24),c=0;c<d;c++)Abd(E.m[a].sp.x,E.m[a].sp.y,E.m[a].cf);E.m.splice(a,1);for(d=0;d<bd.length;d++)bd[d].sp.id==b&&bd[d].sp.id--}}},cl:function(){for(var a=0;a<bd.length;a++)bd[a].sp.collidesWith(P.kn)&&bd.splice(a,1)}};
  function e(){var a=this;a.imgs=[];a.vsb=0;a.w=null;a.init=function(){for(var b=0;4>b;b++)a.imgs[b]=new Image,a.imgs[b].src="s/en"+b.toString()+".png";a.imgs.push(new Image);a.imgs[a.imgs.length-1].src="s/w.png";a.w=K.sprite({x:-400,y:-400,image:a.imgs[4],v:0})};a.init();a.sp=K.sprite({x:-32,y:-32,image:a.imgs[0]});a.cf=0;a.cId=0;a.kf=0;a.id=0;a.flp=0;a.tps={x:0,y:0};a.animIntv=0;a.p=[];a.cpi=0;a.invm=0;a.mIv=0;a.ak=0;a.r=K.sprite({x:-480,y:-480,width:160,height:160,color:"blue"});a.cs=1;a.smoothM=
  function(){a.sp.x<a.tps.x&&(a.sp.x+=1,a.cf=0);a.sp.x>a.tps.x&&(--a.sp.x,a.cf=1);a.sp.y<a.tps.y&&(a.sp.y+=1,a.cf=3);a.sp.y>a.tps.y&&(--a.sp.y,a.cf=2);a.w.x=a.sp.x+8;a.w.y=a.sp.y-24;a.sp.image=a.imgs[a.cf];0==a.cf&&(a.r.x=a.sp.x,a.r.y=a.sp.y-64);1==a.cf&&(a.r.x=a.sp.x-128,a.r.y=a.sp.y-64);2==a.cf&&(a.r.x=a.sp.x-64,a.r.y=a.sp.y-128);3==a.cf&&(a.r.x=a.sp.x-64,a.r.y=a.sp.y);for(var b=0;b<bd.length;b++)a.r.collidesWith(bd[b].sp)&&0==a.w.v&&(a.w.v=1,a.vsb=1,setTimeout(function(){gS=1;L.lN(P,1);L.rs=0},4E3),
  setTimeout(function(){ad(1);gS=2},1500))};a.M=function(){var b=a.cpi;a.invm||(a.cpi<a.p.length-1?a.cpi++:a.invm=1);a.invm&&(0<a.cpi?a.cpi--:a.invm=0);a.vsb=T.v[a.p[a.cpi]]?1:0;a.w.v&&(a.vsb=1);a.tps.x=T.t[a.p[a.cpi]].x;a.tps.y=T.t[a.p[a.cpi]].y;a.mIv=setInterval(function(){return a.smoothM()},10);var d=a.mIv;setTimeout(function(){clearInterval(d)},320);T.t[a.p[b]].x<T.t[a.p[a.cpi]].x?a.flp=0:T.t[a.p[b]].x>T.t[a.p[a.cpi]].x&&(a.flp=2)}}
  var enm=new e,E={m:[],id:0,setups:[[[288,96,69,69,69,69,68,67,66,65,64,63,62,61,81,101,102,122,122,122],[352,96,71,70,70,70,71,72,92,93,94,95,115,135,136,137,138,118,98,78,77,76,56],[416,384,253,254,274,294,295,296,297,298,278,258,238,218,198,197,196,176,176,196,195,194,214,234],[160,320,205,205,205,205,204,203,223,243,244,245,246,247,248,249,249,249,250,250,250]],[[544,32,37,37,37,37,36,35,55,75,76,96,97,97,97,96,116,136,137,138,138,138],[128,128,84,104,104,104,84,64,64],[256,96,68,69,70,71,91,111,
  110,130,150,150,150,149,129,109,108,88,68],[416,288,193,194,195,196,197,198,218,238,258,278,277,276,275,274,273,253,233,213,193],[32,320,201,221,241,261,281,282,283,284,285,286,287,288,288,288,287,286,266,246,226,225,205,204,203,202,201]],[[320,32,30,31,32,33,34,35,35,35,55,54,53,52,51,50,50],[288,192,129,130,131,111,91,71,70,69,89,109,129,129,129,129],[480,224,155,154,153,152,151,150,149,148,147,146,146,146],[128,128,84,85,105,125,145,165,185,184,183,163,143,123,124,104,103],[224,288,187,207,227,
  247,267,266,265,245,225,205,185,165,166,167,167],[384,352,232,232,232,231,230,230,230,229,228,228,228]]],add:function(){for(var a=0;a<E.setups[L.c].length;a++){E.id=a;E.m[E.id]=new e;E.m[E.id].init();E.m[E.id].sp.x=E.setups[L.c][E.id][0];E.m[E.id].sp.y=E.setups[L.c][E.id][1];for(var b=2;b<E.setups[L.c][E.id].length;b++)E.m[E.id].p[b-2]=E.setups[L.c][E.id][b]}},M:function(){for(var a=0;a<E.m.length;a++)E.m[a].M()},render:function(){for(var a=0;a<E.m.length;a++)E.m[a].vsb&&(E.m[a].sp.render(),E.m[a].w.v&&
  E.m[a].w.render(),E.m[a].r.collidesWith(P.s)&&P.v&&(E.m[a].w.v=1,L.rs||(L.rs=1,setTimeout(function(){gS=1;L.lN(P,1);L.rs=0},4E3),setTimeout(function(){gS=2;ad(1)},1E3))))}},loop=K.gameLoop({update:function(){if(1==gS){K.keys.pressed("a")&&!K.keys.pressed("p")?P.M("l"):K.keys.pressed("d")&&!K.keys.pressed("p")?P.M("r"):K.keys.pressed("w")&&!K.keys.pressed("p")?P.M("u"):K.keys.pressed("s")&&!K.keys.pressed("p")?P.M("d"):K.keys.pressed("p")&&P.cs?(P.cl(),E.M(),P.cs=0,setTimeout(function(){P.cs=1},500)):
  K.keys.pressed("l")&&P.cs&&(P.at(),P.cs=0,setTimeout(function(){P.cs=1},500));for(var a=0;a<E.m.length;a++)E.m[a].sp.collidesWith(P.kn)?E.m[a].ak=1:E.m[a].ak=0;P.s.x==L.a.x&&P.s.y==L.a.y&&1>L.f&&(L.c<L.l.length-1?(L.f=1,L.nv=setTimeout(function(){L.lN(P,0);L.f=0},2E3)):(L.f=2,L.nv=setTimeout(function(){gS=4;ad(0)},2E3)))}0==gS&&K.keys.pressed("space")&&(gS=1)},render:function(){if(1==gS){T.R();for(var a=0;a<bd.length;a++)bd[a].sp.render(),bd[a].u();P.s.render();E.render();L.a.render()}else 0==gS?
  ss.render():2==gS?fs.render():4==gS&&ms.render()}});T.f();P.init();loop.start();var cp=0;function ad(n){if(cp||n==0){D=[[13,,8,10,,13,,13,15,,,,13,,10,8,,13,,13,15,,15,,13,,10,8,10,13,,13,10,,,10,8,,13,10,8,10,8,,8,10,13,15,,15,,13],[25,,21,,20,19]];with(new AudioContext)
with(G=createGain())
for(i in D[n])
with(createOscillator())
if(D[n][i])
connect(G),G.connect(destination),start(i*.2),frequency.setValueAtTime(90*1.06**(13-D[n][i]),i*.2),type='square',gain.setValueAtTime(0.35,i*.2),gain.setTargetAtTime(.0001,i*.2+.18,.005),stop(i*.2+.19)}}ad(0);setTimeout(function(){cp=1},15000)</script></body></html>