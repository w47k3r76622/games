function e(e){return e&&e.__esModule?e.default:e}var t=globalThis,n={},r={},o=t.parcelRequiree214;null==o&&((o=function(e){if(e in n)return n[e].exports;if(e in r){var t=r[e];delete r[e];var o={id:e,exports:{}};return n[e]=o,t.call(o.exports,o,o.exports),o.exports}var a=Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(e,t){r[e]=t},t.parcelRequiree214=o),(0,o.register)("dRo73",function(e,t){Object.defineProperty(e.exports,"register",{get:()=>n,set:e=>n=e,enumerable:!0,configurable:!0});var n,r=new Map;n=function(e,t){for(var n=0;n<t.length-1;n+=2)r.set(t[n],{baseUrl:e,path:t[n+1]})}}),o("dRo73").register(new URL("",import.meta.url).toString(),JSON.parse('["50T4R","index.9eb8c4c8.js","jZRmt","wall.d41da7a3.png","c7odb","empty.9a15d676.png","8jqWw","flag.34fab48a.png","jMdeS","player0.c66f8377.png"]'));class a{map;position;finish;constructor(e){Object.assign(this,e)}_sinCos(e){switch(e){case 0:return[0,1];case 90:return[1,0];case 180:return[0,-1];case 270:return[-1,0];default:0()}}_isFree(e,t){return!(!this.map[t]||!this.map[t][e])}left(){this.position.d=(this.position.d+270)%360}right(){this.position.d=(this.position.d+90)%360}run(){let[e,t]=this._sinCos(this.position.d);if(!this.scanAhead())throw Error("JSK-13 broken down");this.position.y-=t,this.position.x+=e}_scan(e){let[t,n]=this._sinCos(e);return this._isFree(this.position.x+t,this.position.y-n)}scanLeft(){return this._scan((this.position.d+270)%360)}scanRight(){return this._scan((this.position.d+90)%360)}scanAhead(){return this._scan(this.position.d)}isFinish(){return this.position.x==this.finish.x&&this.position.y==this.finish.y}static deserialize(e){let t=e.indexOf(0);-1==t&&0();let n=e.subarray(0,t),r=e.subarray(t+1),o=new TextDecoder().decode(n);r.length<8&&0();let i=r[0],c=r[1],f={x:r[2],y:r[3],d:90*r[4]},l={x:r[5],y:r[6]},s=r[7];r.length!=8+Math.floor((i*c+(8-i*c%8)%8)/8)&&0();let d=[];for(let e=0;e<i;++e)d.push(Array(c).fill(!1));for(let e=8;e<r.length;++e){let t=r[e];for(let n=0;n<8;++n){let r=(e-8)*8+n;if(r>=i*c)break;d[Math.floor(r/c)][r%c]=!!(t&1<<7-n)}}return{tip:o,maxCommands:s,level:new a({map:d,position:f,finish:l})}}}function i(e,t){let n=Error(`unexpected ${e} at line ${t}`);return n.unexpected=e,n.line=t,n}function c(e){let t=/^((\w+)\b|\W)/,n=/^\s*/,r=[],o=0,a=1;for(;e;){let c=e.match(n);if(o+=c[0].length,a+=c[0].split("\n").length-1,!(e=e.substring(c[0].length)))break;let f=e.match(t);if(null===f)throw i(e[0],a);r.push({start:o,end:o+f[0].length,token:f[0],line:a}),e=e.substring(f[0].length),o+=f[0].length}return r}async function f(e,t){for(let n of e){if(t.beforeStep&&await t.beforeStep(),"if"==n.type)await t[n.cond]()?await f(n.body,t):null!==n.else&&await f(n.else,t);else if("move"==n.type)switch(n.action){case"left":await t.left();break;case"right":await t.right();break;case"run":await t.run()}else if("loop"==n.type)for(;!t.isFinish();)await f(n.body,t);t.afterStep&&await t.afterStep()}}const l=[function(){let e="3c68313e546865203c636f64653e72756e3c2f636f64653e20636f6d6d616e643c2f68313e3c703e55736520746865203c636f64653e72756e3c2f636f64653e20636f6d6d616e6420746f20726561636820746865207461726765742e3c2f703e3c703e436f6e736964657220616e206578616d706c653a3c2f703e3c7072653e3c636f64653e72756e3c2f636f64653e3c2f7072653e3c703e5761726e696e673a20747279206e6f7420746f20757365206d6f7265207468616e203220636f6d6d616e6473213c2f703e0003050101010301020380",t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),16));return Uint8Array.from(t)}(),function(){let e="3c68313e526f746174696f6e3c2f68313e3c703e55736520746865203c636f64653e6c6566743c2f636f64653e20636f6d6d616e6420746f207475726e204a534b2d3133206c6566742c20616e64203c636f64653e72696768743c2f636f64653e20636f6d6d616e6420746f207475726e204a534b2d31332072696768742c206c696b6520746869733a3c2f703e3c7072653e3c636f64653e72756e0a6c6566740a72756e3c2f636f64653e3c2f7072653e3c703e5761726e696e673a20747279206e6f7420746f20757365206d6f7265207468616e203620636f6d6d616e6473213c2f703e0005050103010301060188c000",t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),16));return Uint8Array.from(t)}(),function(){let e="3c68313e526570656174696e673c2f68313e3c703e496620796f752070757420736f6d657468696e6720696e203c636f64653e6c6f6f707b484552457d3c2f636f64653e2c204a534b2d31332077696c6c206578656375746520697420756e74696c2074686520656e6420686173206265656e20726561636865642e3c2f703e3c703e466f72206578616d706c652c2061667465722072756e6e696e672074686520636f64652062656c6f77204a534b2d31332077696c6c207475726e206c65667420616e642072756e20756e74696c2074686520656e642e3c2f703e3c7072653e3c636f64653e6c6566740a6c6f6f70207b0a2020202072756e0a7d3c2f636f64653e3c2f7072653e3c703e5761726e696e673a20747279206e6f7420746f20757365206d6f7265207468616e203320636f6d6d616e6473213c2f703e00040d0101020b02030002001ffc0000",t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),16));return Uint8Array.from(t)}(),function(){let e="3c68313e5265616368207468652066696e6973683c2f68313e3c703e5761726e696e673a20747279206e6f7420746f20757365206d6f7265207468616e203420636f6d6d616e6473213c2f703e000909010701070104000080c0c0c0c0c0c00000",t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),16));return Uint8Array.from(t)}(),function(){let e="3c68313e5265616368207468652066696e6973683c2f68313e3c703e5761726e696e673a20747279206e6f7420746f20757365206d6f7265207468616e203520636f6d6d616e6473213c2f703e00090a01070108010500006030180c060301800000",t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),16));return Uint8Array.from(t)}(),function(){let e="3c68313e5363616e6e696e673c2f68313e3c703e4a534b2d31332063616e20636865636b2069662069742063616e206d6f766520696e2061206365727461696e20646972656374696f6e202861686561642c206c656674206f722072696768742920616e6420646f20736f6d657468696e6720646570656e64696e67206f6e2074686520616e73776572213c2f703e3c703e4c6574277320636865636b206f757420746865206578616d706c653a3c2f703e3c7072653e3c636f64653e72756e0a6966207363616e5269676874207b0a2020202072696768740a2020202072756e0a7d3c2f636f64653e3c2f7072653e3c703e5761726e696e673a20747279206e6f7420746f20757365206d6f7265207468616e203620636f6d6d616e6473213c2f703e00090907070001010600221d028143e01c020000",t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),16));return Uint8Array.from(t)}(),function(){let e="3c68313e5265616368207468652066696e6973683c2f68313e3c703e5761726e696e673a20747279206e6f7420746f20757365206d6f7265207468616e203320636f6d6d616e6473213c2f703e00090a060503080103001fe4017e5097a409fe0000",t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),16));return Uint8Array.from(t)}(),function(){let e="3c68313e5265616368207468652066696e6973683c2f68313e3c703e5761726e696e673a20747279206e6f7420746f20757365206d6f7265207468616e203520636f6d6d616e6473213c2f703e000909010701010505003f904be502f804fe0000",t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),16));return Uint8Array.from(t)}(),function(){let e="3c68313e5265616368207468652066696e6973683c2f68313e3c703e5761726e696e673a20747279206e6f7420746f20757365206d6f7265207468616e203420636f6d6d616e6473213c2f703e000f08030d0006020400107e10101c141c10705070101000",t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),16));return Uint8Array.from(t)}(),function(){let e="3c68313e456c73653c2f68313e3c703e4966204a534b2d3133207363616e6e656420616e6420666f756e64206f75742074686174207468652070726f6772616d2063616e2774206d6f766520746f206365727461696e20646972656374696f6e2c2069742063616e2028627574206e6f74206d7573742920646f20736f6d657468696e67203c636f64653e656c73653c2f636f64653e213c2f703e3c703e436f6e736964657220616e206578616d706c653a3c2f703e3c7072653e3c636f64653e6966207363616e4c656674207b0a202020206c6566740a7d20656c7365207b0a2020202072696768740a7d3c2f636f64653e3c2f7072653e3c703e5761726e696e673a20747279206e6f7420746f20757365206d6f7265207468616e203320636f6d6d616e6473213c2f703e000809010102070103002a9d48a7d209fc00",t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),16));return Uint8Array.from(t)}(),function(){let e="3c68313e5265616368207468652066696e6973683c2f68313e3c703e5761726e696e673a20747279206e6f7420746f20757365206d6f7265207468616e203920636f6d6d616e6473213c2f703e00060a010401080409000301e0cc618000",t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),16));return Uint8Array.from(t)}(),function(){let e="3c68313e5265616368207468652066696e6973683c2f68313e3c703e5761726e696e673a20747279206e6f7420746f20757365206d6f7265207468616e203320636f6d6d616e6473213c2f703e000909030600070103003f954fe553f954fe0000",t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),16));return Uint8Array.from(t)}(),function(){let e="3c68313e5265616368207468652066696e6973683c2f68313e3c703e5761726e696e673a20747279206e6f7420746f20757365206d6f7265207468616e203820636f6d6d616e6473213c2f703e0011110101020f0f0800002ebf91444bbae51113efe84050beee44103fbe91144bfbe05053eee85150eeee000000",t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),16));return Uint8Array.from(t)}()];async function s(e,t){return new Promise(n=>{let r={};for(let e in t)r[e]=()=>n(t[e]());!function(e,t){let n=document.createElement("div");n.classList.add("modal-bg");let r=document.createElement("div");r.classList.add("modal"),r.innerHTML=e;let o=document.createElement("div");for(let e in o.classList.add("buttonPanel"),t){let r=t[e],a=document.createElement("button");a.innerText=e,a.addEventListener("click",()=>{n.remove(),null!==r&&r()}),o.appendChild(a)}r.appendChild(o),n.appendChild(r),document.body.appendChild(n)}(e,r)})}async function d(e){await new Promise(t=>setTimeout(t,e))}function h(e,t){return e.x==t.x&&e.y==t.y}class p{$;constructor(e){this.$=e}}var u={};u="<h1>Hello, future programmer!</h1>\n<p>You need to reach the flag. You have a robot JSK-13 to do this.</p>\n<p>Unfortunately, the robot has a triskadekaphobia. It means that it is afraid of thirteens and it will break down if he meet one.</p>\n<h2>Good luck!</h2>";var m={};m="<h1>Congratulations! You have solved all the tasks!</h1>\n<h2>Goodbye!</h2>";const g={commandCount:document.getElementById("commandCount"),commandTotal:document.getElementById("commandTotal")},b=document.getElementById("code");b.addEventListener("input",()=>{g.commandCount.innerText=x(c(b.value)).toString()}),b.addEventListener("keydown",e=>{if("Tab"==e.key&&(e.preventDefault(),b.selectionStart==b.selectionEnd)){let e=b.selectionStart+4;b.value=b.value.substring(0,b.selectionStart)+"    "+b.value.substring(b.selectionStart,b.value.length),b.selectionStart=e,b.selectionEnd=e}});const y=document.getElementById("field"),w=document.getElementById("level"),v={run:document.getElementById("runButton"),help:document.getElementById("helpButton"),story:document.getElementById("storyButton"),stop:document.getElementById("stopButton"),speed:document.getElementById("speedButton")};v.speed.innerText="SPEED: slow",v.stop.disabled=!0,v.stop.addEventListener("click",()=>{E.$=!0}),v.help.addEventListener("click",()=>s(_.$.tip,{OK:()=>void 0})),v.story.addEventListener("click",()=>s(e(u),{OK:()=>void 0})),v.run.addEventListener("click",()=>k()),v.speed.addEventListener("click",()=>{S.$?v.speed.innerText="SPEED: slow":v.speed.innerText="SPEED: fast",S.$=!S.$});const _=new p(null),E=new p(!1),S=new p(!1);function x(e){let t=0;for(let n of e)-1!=Array.of("left","right","run","scanLeft","scanRight","scanAhead").indexOf(n.token)&&t++;return t}async function k(){v.run.disabled=!0,v.stop.disabled=!1;let e="";try{e="JSK-13 does not understand you: ";let t=c(b.value),n=function(e){let t=[[]],n=[],r=[],o=[];for(let{token:a,line:c}of e)switch(a){case"left":case"right":case"run":if(n[n.length-1]&&"{"!=n[n.length-1])throw i(a,c);t[t.length-1].push({type:"move",action:a});break;case"scanAhead":case"scanLeft":case"scanRight":if("if_expr"==n[n.length-1])n.pop(),n.push("if_block"),o.push(a);else throw i(a,c);break;case"loop":if(n[n.length-1]&&"{"!=n[n.length-1])throw i(a,c);n.push("loop_block");break;case"if":if(n[n.length-1]&&"{"!=n[n.length-1])throw i(a,c);n.push("if_expr");break;case"else":{let e=t[t.length-1],r=e[e.length-1];if(!n[n.length-1]||"{"==n[n.length-1]&&r&&"if"==r.type&&null==r.else)n.push("else_block");else throw i(a,c);break}case"{":if("if_block"==n[n.length-1])t.push([]),n.pop(),n.push("if_body"),n.push("{");else if("else_block"==n[n.length-1]){let e=t[t.length-1],o=e[e.length-1];"if"!=o.type&&0(),t.push([]),n.pop(),r.push(o),n.push("else_body"),n.push("{")}else if("loop_block"==n[n.length-1])t.push([]),n.pop(),n.push("loop_body"),n.push("{");else throw i(a,c);break;case"}":if("{"==n[n.length-1])n.pop(),"if_body"==n[n.length-1]?(n.pop(),t[t.length-2].push({type:"if",cond:o.pop(),body:t.pop(),else:null})):"else_body"==n[n.length-1]?(n.pop(),r.pop().else=t.pop()):"loop_body"==n[n.length-1]&&(n.pop(),t[t.length-2].push({type:"loop",body:t.pop()}));else throw i(a,c);break;default:throw i(a,c)}if(n.length>0)throw Error("unexpected EOF");return t.flat()}(t),r=x(t);if(e="Pre-check failed: ",0==r)throw Error("your program doesn't do anything");if(e="Runtime error: ",await f(n,_.$.level),e="Post-check failed: ",!_.$.level.isFinish())throw Error("You have not reached the finish");if(r>_.$.maxCommands)throw Error("You have used too many commands, try again");v.stop.disabled=!0,v.run.disabled=!1,await d(500),void 0!=l[_.$.id+1]&&_.$.id+1!=13&&await s("<p>Congratulations, you have reached the flag! Proceed to the next level?</p>",{Go:()=>void 0}),await L(_.$.id+1)}catch(t){await s(e+t.message,{OK:()=>void 0}),function(){let e=_.$.id,t=a.deserialize(l[e]);_.$={id:e,...t},H(),A()}(),v.stop.disabled=!0,v.run.disabled=!1}}function A(){let e=_.$.level;e.beforeStep=async()=>await d(S.$?30:300),e.afterStep=()=>{if(H(),E.$)throw E.$=!1,Error("Program interrupted")}}async function L(t){if(b.value="",w.innerText="",y.innerText="",g.commandTotal.innerHTML="&infin;",g.commandCount.innerText="0",void 0===l[t]){await s(e(m),{});return}let n=a.deserialize(Uint8Array.from(l[t]));_.$={id:t,...n},g.commandTotal.innerText=n.maxCommands.toString(),t+1==13?await s("Do you have triskadekaphobia?",{Yes:()=>!0,No:()=>!1})?w.innerText="Level 12A":w.innerText="Level 13":w.innerText="Level "+(t+1),localStorage.setItem("thirteens_everywhere__level",t.toString()),await s(n.tip,{OK:()=>void 0}),H(),A()}var R={};R=new URL("wall.d41da7a3.png",import.meta.url).toString();var I={};I=new URL("empty.9a15d676.png",import.meta.url).toString();var T={};T=new URL("flag.34fab48a.png",import.meta.url).toString();var U={};U=new URL("player0.c66f8377.png",import.meta.url).toString();const $={Wall:new URL(R),Empty:new URL(I),Flag:new URL(T),Player0:new URL(U)};function H(){y.innerText="";let e=_.$.level;y.style.gridTemplateRows=`repeat(${e.map.length}, 1fr)`,y.style.gridTemplateColumns=`repeat(${e.map[0].length}, 1fr)`;for(let t=0;t<e.map.length;++t)for(let n=0;n<e.map[0].length;++n){let r={x:n,y:t},o=document.createElement("img");h(r,e.position)?(o.src=$.Player0.toString(),o.style.transform=`rotate(${e.position.d}deg)`):h(r,e.finish)?o.src=$.Flag.toString():o.src=(e.map[t][n]?$.Empty:$.Wall).toString(),y.append(o)}}document.body.onload=()=>{!async function(){localStorage.getItem("thirteens_everywhere__level")||await s(e(u),{OK:()=>void 0}),await L(parseInt(localStorage.getItem("thirteens_everywhere__level")??"0"))}()};