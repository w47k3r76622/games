!function(t){"use strict";function e(t,e){var n=Object.create(t);for(var s in e)n[s]=e[s];return e.toString!==Object.prototype.toString&&(n.toString=e.toString),n}var n=function(){};n.__name__="HxOverrides",n.remove=function(t,e){var n=t.indexOf(e);return-1!=n&&(t.splice(n,1),!0)},n.now=function(){return Date.now()};var s=function(){};s.__name__="Lambda",s.count=function(t,e){var n=0;if(null==e)for(var s=D(t);s.hasNext();){s.next();++n}else for(var i=D(t);i.hasNext();){e(i.next())&&++n}return n};var i=function(){this.session=new b,this.previousKeys={},this.keys={},this.lastTime=0,this.images=new k,i.instance=this,this.loadImages(),this.initHtml(),this.initGame(),this.loop(0)};i.__name__="Main",i.main=function(){window.onload=function(){return new i}},i.prototype={initHtml:function(){var t=this;this.canvas=window.document.getElementById("c"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=this.canvas.height=64,onkeydown=onkeyup=function(e){t.keys[e.key]="d"==e.type[3]}},initGame:function(){this.engine=new r,this.engine.addSystem(new y,0),this.engine.addSystem(new p,3),this.engine.addSystem(new C,4),this.engine.addSystem(new c,4),this.engine.addSystem(new f,5),this.engine.addSystem(new R,6),this.engine.addSystem(new _,9),this.engine.addSystem(new h,10),this.engine.addSystem(new x,100),this.engine.addSystem(new w,101)},loadImages:function(){this.loadImage("background")},loadImage:function(t){var e=new Image;e.src="./data/"+t+".png",this.images.h[t]=e},render:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(this.images.h.background,0,0)},loop:function(e){var n=(e-this.lastTime)/1e3;this.lastTime=e,this.render(),this.engine.update(n),this.previousKeys=Object.assign({},this.keys),window.requestAnimationFrame(function(e,n){if(null==n)return null;null==n.__id__&&(n.__id__=t.$haxeUID++);var s;null==e.hx__closures__?e.hx__closures__={}:s=e.hx__closures__[n.__id__];null==s&&(s=n.bind(e),e.hx__closures__[n.__id__]=s);return s}(this,this.loop))},draw:function(t,e,n){this.ctx.drawImage(this.images.h[t],e,n)},isPressed:function(t){return this.keys[t]},isJustPressed:function(t){return!this.previousKeys[t]&&this.keys[t]},countEntities:function(t,e){for(var n=this.engine.getMatchingEntities(e),s=0,i=0;i<n.length;){var o=n[i];++i,o.get(S).team==t&&++s}return s},getEntities:function(t,e){for(var n=this.engine.getMatchingEntities(e),s=[],i=0;i<n.length;){var o=n[i];++i,o.get(S).team==t&&s.push(o)}return s},getRandomInt:function(t,e){return(0|9999*(Math.sin(t++)+1))%e},win:function(t){console.log("src/Main.hx:122:",this.session.playerNames[t]+" has won!"),this.engine.suspendSystem(y),this.engine.suspendSystem(p),this.session.winner=t,this.session.gameFinished=!0,this.sfx(1.58,0,261.6256,.05,.25,.48,1,.36,.1,0,-50,.01,.01,.2,-1,-.1,.03,.3,.12,.23)},start:function(){this.engine.resumeSystem(y),this.engine.resumeSystem(p),this.session=new b;for(var t=this.engine.getMatchingEntities(S),e=0;e<t.length;){var n=t[e];++e,this.engine.removeEntity(n)}},sfx:function(){for(var t=arguments.length,e=new Array(t>0?t-0:0),n=0;n<t;++n)e[n-0]=arguments[n];var s=zzfx;s.apply(null,e)},__class__:i},Math.__name__="Math";var o=function(){};o.__name__="Std",o.random=function(t){return t<=0?0:Math.floor(Math.random()*t)};var r=function(){this.entities=[],this.suspended=[],this.systems=[]};r.__name__="ecs.Engine",r.prototype={addSystem:function(t,e,n){return this.systems.push(t),t.engine=this,t.onResume(),t},removeSystem:function(t){t.engine=null,n.remove(this.systems,t)},suspendSystem:function(t){for(var e=t.__name__,n=0,s=this.systems;n<s.length;){var i=s[n];if(++n,G.getClass(i).__name__==e){this.suspended.push(i),i.onSuspend();break}}},resumeSystem:function(t){for(var e=t.__name__,s=0,i=this.suspended;s<i.length;){var o=i[s];if(++s,G.getClass(o).__name__==e){n.remove(this.suspended,o),o.onResume();break}}},isActive:function(t){for(var e=t.__name__,n=0,s=this.systems;n<s.length;){var i=s[n];if(++n,G.getClass(i).__name__==e)return!0}return!1},update:function(t){for(var e=this.systems.slice(0),n=this.entities.slice(0),s=0;s<e.length;){var i=e[s];if(++s,-1==this.suspended.indexOf(i)){i.entities=[];for(var o=0;o<n.length;){var r=n[o];++o;for(var a=!0,l=0,u=i.classes;l<u.length;){var _=u[l];if(++l,null==r.components.h[_]){a=!1;break}}a&&i.entities.push(r)}i.update(t)}}},getMatchingEntities:function(t){for(var e=t.__name__,n=[],s=0,i=this.entities;s<i.length;){var o=i[s];++s,null!=o.components.h[e]&&n.push(o)}return n},addEntity:function(t){this.entities.push(t)},removeEntity:function(t){n.remove(this.entities,t)},__class__:r};var a=function(){this.components=new k};a.__name__="ecs.Entity",a.prototype={add:function(t,e){var n=this.components,s=G.getClass(t).__name__;n.h[s]=t},get:function(t){var e=this.components,n=t.__name__;return e.h[n]},remove:function(t){var e=this.components,n=t.__name__,s=e;Object.prototype.hasOwnProperty.call(s.h,n)&&delete s.h[n]},__class__:a};var l=function(){this.entities=[],this.classes=[]};l.__name__="ecs.System",l.prototype={addComponentClass:function(t){this.classes.push(t.__name__)},update:function(t){for(var e=0,n=this.entities;e<n.length;){var s=n[e];++e,this.updateSingle(t,s)}},updateSingle:function(t,e){},onResume:function(){},onSuspend:function(){},__class__:l};var u=function(){this.time=0};u.__name__="game.Blink",u.prototype={__class__:u};var _=function(){l.call(this),this.addComponentClass(A),this.addComponentClass(P),this.addComponentClass(u)};_.__name__="game.BlinkSystem",_.__super__=l,_.prototype=e(l.prototype,{updateSingle:function(t,e){var n=e.get(P),s=e.get(u);s.time+=t,n.alpha=.5+.5*Math.cos(50*s.time),s.time>.5&&(e.remove(u),this.engine.removeEntity(e),this.destroyPuyo(e))},destroyPuyo:function(t){var e=t.get(S),n=e.team;i.instance.session.setGrid(n,e.col,e.row,null);for(var s=0,o=_.deltas;s<o.length;){var r=o[s];++s;var a=e.getPosition(),l=q._new(a[0]+r[0],a[1]+r[1]),u=0|l[0],c=0|l[1];if(null!=(t=i.instance.session.getEntity(n,u,c)))t.get(S).garbage&&(i.instance.session.setGrid(n,u,c,null),this.engine.removeEntity(t))}},__class__:_});var c=function(){this.time=0,l.call(this)};c.__name__="game.BotSystem",c.__super__=l,c.prototype=e(l.prototype,{onResume:function(){this.time=0},update:function(t){var e=i.instance.session.controlRequests[1];this.time-=t,this.time<0?(e.left=o.random(10)<5?0:-1,-1==e.left&&(e.right=o.random(10)<7?0:-1),e.down=o.random(10)<5?0:-1,e.rotate=o.random(10)<5?0:-1,e.rotate2=o.random(10)<5?0:-1,this.time=.05+.05*o.random(5)):(e.left=-1,e.right=-1,e.down=-1,e.rotate=-1,e.rotate2=-1)},__class__:c});var h=function(){this.matchings=[!1,!1],l.call(this)};h.__name__="game.CheckSystem",h.__super__=l,h.prototype=e(l.prototype,{onResume:function(){},update:function(t){for(var e=i.instance,n=e.session,o=0;o<2;){var r=o++;if(0==i.instance.countEntities(r,m)){for(var a=[],l=0,_=n.width;l<_;)for(var c=l++,d=0,f=n.height;d<f;){var g=d++,p=n.getEntity(r,c,g);if(null!=p){for(var y=null,v=0;v<a.length;){var w=a[v];++v,w.h[p.__id__]&&(y=w)}if(null==y){var C=p.get(S);if(!C.garbage&&!C.matching){y=new M,a.push(y);var P=C.getPosition();y.set(p,!0),this.visit(r,y,P,C.color)}}}}for(var x=!1,R=0,E=0;E<a.length;){var b=a[E];++E;var k=s.count(b);if(k>=h.requiredMatchCount){e.session.currentMatchCounts[r]++;var F=k-h.requiredMatchCount;F>=0&&(R+=0|Math.ceil(F*F/2)),x=!0;for(var G=b.keys();G.hasNext();){var q=G.next();this.preDestroyPuyo(q)}}}x&&(this.matchings[r]=!0,e.session.preGarbages[r]+=R,e.sfx(1.2,.9,130,.09,.27,.45,1,1.34,-8.4,0,0,0,.13,0,0,0,0,.98,.23,.33))}if(this.matchings[r])if(0==e.countEntities(r,u)){for(var A=e.getEntities(r,S),D=0;D<A.length;){var O=A[D];++D;var I=O.get(S);e.session.setGrid(r,I.col,I.row,null),O.add(new m)}this.matchings[r]=!1}}},visit:function(t,e,n,s){for(var o=0,r=h.deltas;o<r.length;){var a=r[o];++o;var l=q._new(n[0]+a[0],n[1]+a[1]),u=i.instance.session.getEntity(t,0|l[0],0|l[1]);null!=u&&u.get(S).color==s&&(e.h[u.__id__]||(e.set(u,!0),this.visit(t,e,l,s)))}},preDestroyPuyo:function(t){var e=t.get(S);e.team;t.add(new u),e.matching=!0},__class__:h});var d=function(){this.second=!1,this.time2=0,this.time=0};d.__name__="game.Control",d.prototype={__class__:d};var f=function(){this.rotateRequesteds=[!1,!1],this.moveRequesteds=[!1,!1],l.call(this),this.addComponentClass(A),this.addComponentClass(S),this.addComponentClass(d)};f.__name__="game.ControlSystem",f.__super__=l,f.prototype=e(l.prototype,{update:function(t){this.moveRequesteds=[!1,!1],this.rotateRequesteds=[!1,!1],l.prototype.update.call(this,t);for(var e=i.instance,n=0;n<2;){var s=n++;if(2==e.countEntities(s,d)){for(var o=e.getEntities(s,d),r=!0,a=0;a<o.length;){var u=o[a];++a;var _=u.get(S);if(null==_.desiredCol||null==_.desiredRow||!i.instance.session.isFree(_.team,_.desiredCol,_.desiredRow)){r=!1;break}}if(r)for(var c=0;c<o.length;){var h=o[c];++c;var f=h.get(S);f.col==f.desiredCol&&f.row==f.desiredRow||e.sfx(.2,.05,1040,.05,.02,.04,0,1.97,0,0,-224,.05,.02,.1,1,.5,.01,.43,0,.01),f.col=f.desiredCol,f.row=f.desiredRow}}}},updateSingle:function(t,e){var n=e.get(S),s=e.get(d),o=0,r=0,a=i.instance,l=a.session.controlRequests[n.team];if(s.time+=t,s.time2+=t,n.desiredRow=n.row,n.desiredCol=n.col,!this.moveRequesteds[n.team]&&s.second){for(var u=0==l.rotate,_=0==l.rotate2,c=a.getEntities(n.team,d),h=null,f=0;f<c.length;){var g=c[f];++f,g.get(d).second||(h=g.get(S))}if(u||_){var m=u?1:-1;return h.col==n.col?(n.desiredRow=h.row,h.row==n.row+1?n.desiredCol=n.col-m:n.desiredCol=n.col+m,n.desiredCol<0?(n.desiredCol++,h.desiredCol++):n.desiredCol>=a.session.width&&(n.desiredCol--,h.desiredCol--)):(n.desiredCol=h.col,h.col==n.col+1?n.desiredRow=n.row+m:n.desiredRow=n.row-m),void(this.rotateRequesteds[n.team]=!0)}}this.rotateRequesteds[n.team]||(l.left>=0?(0==l.left&&(s.time=1),--o):l.right>=0&&(0==l.right&&(s.time=1),++o),l.down>=0&&(0==l.down&&(s.time2=1),--r),0!=o&&s.time>=.1&&(n.desiredCol=n.col+o,this.moveRequesteds[n.team]=!0,s.time=0),0!=r&&s.time2>=.1&&(n.desiredRow=n.row+r,this.moveRequesteds[n.team]=!0,s.time2=0))},__class__:f});var g=function(){};g.__name__="game.Factory",g.createPuyo=function(t){var e=new a;return e.add(new A),e.add(new S),e.get(S).color=t,e.add(new P),e.get(P).color=t,e},g.createPuyoDisplay=function(t){var e=new a;return e.add(new A),e.add(new P),e.get(P).color=t,e};var m=function(){};m.__name__="game.Fall",m.prototype={__class__:m};var p=function(){this.fallings=[!1,!1],this.timeLefts=[1,1],l.call(this),this.addComponentClass(A),this.addComponentClass(S),this.addComponentClass(m)};p.__name__="game.FallSystem",p.__super__=l,p.prototype=e(l.prototype,{update:function(t){for(var e=i.instance,n=0;n<2;){var s=n++,o=e.countEntities(s,d);e.countEntities(s,v),e.countEntities(s,m);if(!(e.countEntities(s,u)>0))for(0==o&&(this.timeLefts[s]-=12*t),this.timeLefts[s]-=t,this.fallings[s]=!1;this.timeLefts[s]<=0;){this.timeLefts[s]+=1,this.fallings[s]=!0;for(var r=e.getEntities(s,m),a=0;a<r.length;){var _=r[a];++a;var c=_.get(S);e.session.isFree(c.team,c.col,c.row-1)||this.land(c,s,_)}}}l.prototype.update.call(this,t)},updateSingle:function(t,e){var n=e.get(S),s=n.team,o=i.instance;this.fallings[s]&&(o.session.isFree(n.team,n.col,n.row-1)?n.row--:this.land(n,s,e))},land:function(t,e,n){var s=i.instance;s.sfx(.3,.05,410,0,.01,.13,4,2.65,-.1,5.1,-50,-.02,-.01,1.3,3,.1,.04,.32,.03,.02),s.session.setGrid(t.team,t.col,t.row,n),n.remove(m);for(var o=s.getEntities(e,d),r=0;r<o.length;){n=o[r];++r,n.remove(d)}12==t.row&&s.win(1-e)},__class__:p});var y=function(){this.previewPuyos=[],l.call(this)};y.__name__="game.GameSystem",y.__super__=l,y.prototype=e(l.prototype,{onResume:function(){i.instance.session;var t,e,n="red";(e=(t=g.createPuyoDisplay(n)).get(A).position)[0]=27,e[1]=12,this.engine.addEntity(t),this.previewPuyos[0]=[t],(e=(t=g.createPuyoDisplay(n)).get(A).position)[0]=27,e[1]=16,this.engine.addEntity(t),this.previewPuyos[0].push(t),(e=(t=g.createPuyoDisplay(n)).get(A).position)[0]=33,e[1]=12,this.engine.addEntity(t),this.previewPuyos[1]=[t],(e=(t=g.createPuyoDisplay(n)).get(A).position)[0]=33,e[1]=16,this.engine.addEntity(t),this.previewPuyos[1].push(t),this.updatePreview(0),this.updatePreview(1)},update:function(t){i.instance.session.gameStarted&&(this.checkForSpawn(0),this.checkForSpawn(1))},createRandomPuyo:function(t,e){var n=i.instance.session.getRandomColor(e),s=g.createPuyo(n);return s.add(new m),s.add(new d),s.get(S).team=t,s},createGarbagePuyo:function(t){var e=g.createPuyo("grey");return e.add(new m),e.add(new v),e.get(S).team=t,e.get(S).garbage=!0,e},spawnRandomDuo:function(t){var e=i.instance.session,n=this.createRandomPuyo(t,e.puyoCount[t]);e.puyoCount[t]++,this.engine.addEntity(n);n=this.createRandomPuyo(t,e.puyoCount[t]);e.puyoCount[t]++,this.engine.addEntity(n),n.get(S).row++,n.get(d).second=!0},checkForSpawn:function(t){var e=i.instance,n=e.session,s=e.countEntities(t,m),r=e.countEntities(t,u);if(0==s&&0==r){var a=n.garbages;if(a[t]>0){for(var l=0;a[t]>=6;){(y=this.createGarbagePuyo(t)).get(S).col=0,y.get(S).row+=l,this.engine.addEntity(y);var _=this.createGarbagePuyo(t);_.get(S).col=1,_.get(S).row+=l,this.engine.addEntity(_);var c=this.createGarbagePuyo(t);c.get(S).col=2,c.get(S).row+=l,this.engine.addEntity(c);var h=this.createGarbagePuyo(t);h.get(S).col=3,h.get(S).row+=l,this.engine.addEntity(h);var d=this.createGarbagePuyo(t);d.get(S).col=4,d.get(S).row+=l,this.engine.addEntity(d);var f=this.createGarbagePuyo(t);f.get(S).col=5,f.get(S).row+=l,this.engine.addEntity(f),a[t]-=6,++l}for(var g={};a[t]>0;){for(var p=o.random(6);g[p];)p=o.random(6);var y;g[p]=!0,(y=this.createGarbagePuyo(t)).get(S).col=p,y.get(S).row+=l,this.engine.addEntity(y),a[t]-=1}}else{this.spawnRandomDuo(t),this.updatePreview(t);var v=n.currentMatchCounts[t];if(v>=0){var w=n.preGarbages[t]+=v*(v*v+1);n.preGarbages[t]=0,n.garbages[1-t]+=w,n.currentMatchCounts[t]=0}}}},updatePreview:function(t){var e=i.instance.session,n=e.getRandomColor(e.puyoCount[t]);this.previewPuyos[t][0].get(P).color=n;n=e.getRandomColor(e.puyoCount[t]+1);this.previewPuyos[t][1].get(P).color=n},__class__:y});var v=function(){};v.__name__="game.Garbage",v.prototype={__class__:v};var w=function(){this.time=0,l.call(this)};w.__name__="game.HudSystem",w.__super__=l,w.prototype=e(l.prototype,{onResume:function(){},update:function(t){this.time+=t;var e=i.instance;e.session.gameFinished?this.endGame():e.session.gameStarted?(this.display(0),this.display(1)):this.mainMenu()},display:function(t){var e=i.instance,n=e.session,s=e.ctx;s.fillStyle="#AF8D8B";for(var o=0==t?2:38,r=0,a=n.garbages[t];r<a;){r++;s.fillRect(o,6,1,3),++o}},mainMenu:function(){var t=i.instance,e=t.session,n=t.ctx;n.fillStyle="#444",n.fillRect(2,6,60,52),n.fillStyle="#57e",n.font="12px pixel",n.textBaseline="top",n.fillText("MiniPuyo!",7,10),(0|this.time)%2==0&&(n.font="10px pixel",n.fillText("Press",20,38),n.fillText("Enter",20,47)),t.isJustPressed("Enter")&&(e.gameStarted=!0,t.sfx(.5,.05,543,.02,.28,.41,2,1.94,-1.3,0,316,.03,.05,0,0,0,0,.67,.17,.08))},endGame:function(){var t=i.instance,e=t.session,n=t.ctx;n.fillStyle="#444",n.fillRect(2,6,60,52),n.font="12px pixel",n.textBaseline="top",1==e.winner?(n.fillStyle="#d33",n.fillText(e.playerNames[e.winner],6,10),n.fillText("has won!",10,22)):(n.fillStyle="#e8e",n.fillText("You",20,10),n.fillText("win!",20,22)),(0|this.time)%2==0&&(n.fillStyle="#57e",n.font="10px pixel",n.fillText("Press",20,38),n.fillText("Enter",20,47)),t.isJustPressed("Enter")&&t.start()},__class__:w});var C=function(){l.call(this)};C.__name__="game.PlayerSystem",C.__super__=l,C.prototype=e(l.prototype,{onResume:function(){},update:function(t){var e=i.instance,n=e.session.controlRequests[0];e.isJustPressed("a")||e.isJustPressed("ArrowLeft")?n.left=0:e.isPressed("a")||e.isPressed("ArrowLeft")?n.left+=t:n.left=-1,e.isJustPressed("d")||e.isJustPressed("ArrowRight")?n.right=0:e.isPressed("d")||e.isPressed("ArrowRight")?n.right+=t:n.right=-1,e.isJustPressed("s")||e.isJustPressed("ArrowDown")?n.down=0:e.isPressed("s")||e.isPressed("ArrowDown")?n.down+=t:n.down=-1,n.rotate=e.isJustPressed("o")?0:-1,n.rotate2=e.isJustPressed("p")?0:-1},__class__:C});var S=function(){this.matching=!1,this.garbage=!1,this.color="red",this.col=2,this.row=12,this.team=0};S.__name__="game.Puyo",S.prototype={getPosition:function(){return[this.col,this.row]},__class__:S};var P=function(){this.eyeFlip=!1,this.time=0,this.alpha=1,this.color="red"};P.__name__="game.PuyoDisplay",P.prototype={__class__:P};var x=function(){l.call(this),this.addComponentClass(A),this.addComponentClass(P)};x.__name__="game.PuyoDisplaySystem",x.__super__=l,x.prototype=e(l.prototype,{update:function(t){l.prototype.update.call(this,t);i.instance;i.instance.ctx.globalAlpha=1},updateSingle:function(t,e){var n=e.get(P),s=e.get(S),r=e.get(A).position;n.time-=t,n.time<0&&(n.eyeFlip=1==o.random(2),n.time=.5+o.random(3));var a=i.instance.ctx;if(a.globalAlpha=n.alpha,a.fillStyle=n.color,a.fillRect(r[0]+1,r[1],2,4),a.fillRect(r[0],r[1]+1,4,2),null!=s&&null==e.get(m)&&!s.garbage){var l=i.instance.session;l.getColor(s.team,s.col-1,s.row)==s.color&&a.fillRect(r[0],r[1],1,4),l.getColor(s.team,s.col+1,s.row)==s.color&&a.fillRect(r[0]+3,r[1],1,4),l.getColor(s.team,s.col,s.row+1)==s.color&&a.fillRect(r[0],r[1],4,1),l.getColor(s.team,s.col,s.row-1)==s.color&&a.fillRect(r[0],r[1]+3,4,1)}null!=s&&s.garbage?(a.fillStyle="#444",a.fillRect(r[0]+1,r[1]+1,1,1)):(a.fillStyle=n.eyeFlip?"#55a":"#fff",a.fillRect(r[0]+1,r[1]+1,1,1),a.fillStyle=n.eyeFlip?"#fff":"#55a",a.fillRect(r[0]+2,r[1]+1,1,1))},__class__:x});var R=function(){l.call(this),this.addComponentClass(A),this.addComponentClass(S)};R.__name__="game.PuyoSystem",R.__super__=l,R.prototype=e(l.prototype,{updateSingle:function(t,e){var n=e.get(S),s=e.get(A).position;s[0]=2+4*n.col,s[1]=49-4*n.row+5,1==n.team&&(s[0]+=36),n.row>=12&&(s[1]=-64)},__class__:R});var E=function(){this.rotate2=-1,this.rotate=-1,this.down=-1,this.right=-1,this.left=-1};E.__name__="game.ControlRequest",E.prototype={__class__:E};var b=function(){var t;this.controlRequests=[new E,new E],this.gameFinished=!1,this.gameStarted=!1,this.colors=["#CC8497","#00C892","#7F87F1","#EEE8A9"],this.playerNames=["You","Computer"],this.preGarbages=[0,0],this.currentMatchCounts=[0,0],this.garbages=[0,0],this.puyoCount=[0,0],this.height=12,this.width=6,this.grids=[],(t=[])[0]=[],t[1]=[],t[2]=[],t[3]=[],t[4]=[],t[5]=[],t[6]=[],t[7]=[],t[8]=[],t[9]=[],t[10]=[],t[11]=[],t[12]=[],t[13]=[],this.grids[0]=t,(t=[])[0]=[],t[1]=[],t[2]=[],t[3]=[],t[4]=[],t[5]=[],t[6]=[],t[7]=[],t[8]=[],t[9]=[],t[10]=[],t[11]=[],t[12]=[],t[13]=[],this.grids[1]=t,this.rseed=o.random(1e3)};b.__name__="game.Session",b.prototype={isValid:function(t,e){return!(t<0||t>5)&&!(e<0)},isFree:function(t,e,n){return!!this.isValid(e,n)&&(n>=12||null==this.grids[t][n][e])},getEntity:function(t,e,n){return this.isValid(e,n)?this.grids[t][n][e]:null},setGrid:function(t,e,n,s){this.grids[t][n][e]=s},getColor:function(t,e,n){var s=this.getEntity(t,e,n);return null!=s?s.get(S).color:null},getRandomColor:function(t){var e=i.instance.getRandomInt(this.rseed+t,this.colors.length);return this.colors[e]},__class__:b};var M=function(){this.h={__keys__:{}}};M.__name__="haxe.ds.ObjectMap",M.prototype={set:function(e,n){var s=e.__id__;null==s&&(s=e.__id__=t.$haxeUID++),this.h[s]=n,this.h.__keys__[s]=e},keys:function(){var t=[];for(var e in this.h.__keys__)this.h.hasOwnProperty(e)&&t.push(this.h.__keys__[e]);return new F(t)},iterator:function(){return{ref:this.h,it:this.keys(),hasNext:function(){return this.it.hasNext()},next:function(){var t=this.it.next();return this.ref[t.__id__]}}},__class__:M};var k=function(){this.h=Object.create(null)};k.__name__="haxe.ds.StringMap",k.prototype={__class__:k};var F=function(t){this.current=0,this.array=t};F.__name__="haxe.iterators.ArrayIterator",F.prototype={hasNext:function(){return this.current<this.array.length},next:function(){return this.array[this.current++]},__class__:F};var G=function(){};G.__name__="js.Boot",G.getClass=function(t){if(null==t)return null;if(t instanceof Array)return Array;var e=t.__class__;if(null!=e)return e;var n=G.__nativeClassName(t);return null!=n?G.__resolveNativeClass(n):null},G.__nativeClassName=function(t){var e=G.__toStr.call(t).slice(8,-1);return"Object"==e||"Function"==e||"Math"==e||"JSON"==e?null:e},G.__resolveNativeClass=function(e){return t[e]};var q={_new:function(t,e){return null==e&&(e=0),null==t&&(t=0),[t,e]},get_x:function(t){return t[0]},set_x:function(t,e){return t[0]=e},get_y:function(t){return t[1]},set_y:function(t,e){return t[1]=e},mulOp:function(t,e){return q._new(t[0]*e,t[1]*e)},divOp:function(t,e){return q._new(t[0]/e,t[1]/e)},addOp:function(t,e){return q._new(t[0]+e[0],t[1]+e[1])},minOp:function(t,e){return q._new(t[0]-e[0],t[1]-e[1])},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]},getSquareDistance:function(t,e){var n=t[0]-e[0],s=t[1]-e[1];return n*n+s*s},normalize:function(t){var e=q.getLength(t);t[0]/=e,t[1]/=e},getAngle:function(t){return Math.atan2(t[1],t[0])},getLength:function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])},getSquareLength:function(t){return t[0]*t[0]+t[1]*t[1]},copyFrom:function(t,e){t[0]=e[0],t[1]=e[1]},set:function(t,e,n){t[0]=e,t[1]=n},setFromAngle:function(t,e){t[0]=Math.cos(e),t[1]=Math.sin(e)}},A=function(){this.position=[0,0]};function D(t){return t instanceof Array?new F(t):t.iterator()}A.__name__="math.Transform",A.prototype={copyFrom:function(t){q.copyFrom(this.position,t.position)},__class__:A},t.$haxeUID|=0,"undefined"!=typeof performance&&"function"==typeof performance.now&&(n.now=performance.now.bind(performance)),Object.defineProperty(String.prototype,"__class__",{value:String,enumerable:!1,writable:!0}),String.__name__="String",Array.__name__="Array",G.__toStr={}.toString,_.deltas=[[0,1],[0,-1],[1,0],[-1,0]],h.requiredMatchCount=4,h.deltas=[[0,1],[0,-1],[1,0],[-1,0]],i.main()}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);
