<!DOCTYPE html><html><head><title>Elum</title><style>body{background: #000;}#game{display: block;margin: 0 auto;}</style></head><body><canvas id="game" width="1200" height="500"></canvas><script>function Block(a,b,c){this.type=a,this.bS=b,this.iDy=!1,this.iD=!1,this.dT=S.BDT,this.h=this.mH=S.BH[a],this.sL=S.BSL[a],"undefined"!=typeof c&&"undefined"!=typeof c.sL&&(this.sL=c.sL),this.bR=Math.floor(.16*b),this.iBWD=Math.floor(.2*b),this.iBW=b-this.iBWD,this.iBO=Math.floor(this.iBWD/2),this.wER=Math.floor(.2*b),this.wEEndA=2*Math.PI,this.fEO=Math.floor(.3*b),this.eER=Math.floor(this.bR/2),this.eEWD=Math.floor(.6*b),this.eEW=b-this.eEWD,this.eEO=Math.floor(this.eEWD/2),this.wiEW=Math.floor(.6*b),this.wiEHeight=Math.floor(.1*b),this.wiEYO=Math.floor(.26*b),this.wiEXO=Math.floor(.2*b),this.wiESpace=Math.floor(.1*b),this.vEBarW=Math.floor(.7*b),this.vEBarHeight=Math.floor(.16*b),this.vEBarRo=Math.PI/4,this.vEXO=Math.floor(.3*b),this.vEYO=Math.floor(.2*b)}function G(a,b,c,d){this.pHCoords=null,this.game=a,this.width=b,this.height=c,this.grid=[],this.bS=d;for(var e=0;e<this.width;e++){this.grid[e]=[];for(var f=0;f<this.height;f++)this.grid[e][f]=null}this.pHR=Math.floor(.16*d),this.gls={},this.gls.bVCt=0,this.gls.erosionCt=0,this.gls.wiSFCt=0}function Game(a){this.canvas=a,this.context=a.getContext("2d"),this.canvasW=this.canvas.width,this.canvasHeight=this.canvas.height,this.uiW=Math.floor(.1666666666666667*this.canvasW),this.gridW=this.canvasW-this.uiW,this.bS=Math.floor(this.gridW/S.GW),this.reset()}function UserInterface(a,b,c,d,e){this.game=a,this.uiX=b,this.uiY=c,this.uiW=d,this.uiHeight=e,this.tSHeight=Math.floor(.1*this.uiHeight),this.nextBlockType=null,this.uiLeftMargin=this.uiX+Math.floor(.1*this.uiW),this.uiInnerLeftMargin=this.uiLeftMargin+Math.floor(this.uiW/2),this.uiTopMargin=this.uiY+Math.floor(.14*this.uiHeight),this.tSY=this.uiTopMargin+Math.floor(.06*this.uiHeight),this.tSTextY=this.tSY+Math.floor(.8*this.tSHeight),this.tSHighlightW=Math.floor(.05*this.uiW),this.toxicityTextY=Math.floor(.38*this.uiHeight),this.goalHeaderTextY=Math.floor(.84*this.uiHeight),this.goalTextY=Math.floor(.89*this.uiHeight)}var BT={N:0,W:1,E:2,F:3,WI:4,V:5,L:6};Block.prototype.k=function(){this.iDy=!0},Block.prototype.update=function(){this.iDy&&(this.dT--,this.dT<=0&&(this.iD=!0))},Block.prototype.draw=function(a,b,c){var d=1,e=Math.floor(this.h/this.mH*100);(this.type===BT.E||50>e)&&e%2==0&&(d=.9),this.iDy&&this.dT%2==0&&(d=.1);var f=b*this.bS,g=c*this.bS,h=this.bS/2,i=f+h,j=g+h;if(a.fillStyle=U.gRFS(S.BBC[this.type],d),U.dRS(a,f,g,this.bR,this.bS),a.fillStyle=U.gRFS(S.BIC[this.type],d),U.dRS(a,f+this.iBO,g+this.iBO,this.bR,this.iBW),a.fillStyle=U.gRFS(S.BBC[this.type],d),this.type===BT.W)return a.beginPath(),a.arc(i,j,this.wER,0,this.wEEndA,!0),void a.fill();if(this.type===BT.F)return a.beginPath(),a.moveTo(i,g+this.fEO),a.lineTo(f+this.fEO,g+this.bS-this.fEO),a.lineTo(f+this.bS-this.fEO,g+this.bS-this.fEO),void a.fill();if(this.type===BT.E)return void U.dRS(a,f+this.eEO,g+this.eEO,this.eER,this.eEW);if(this.type!==BT.WI)return this.type===BT.V?(a.save(),a.translate(f+this.vEXO,g+this.vEYO),a.rotate(this.vEBarRo),a.fillRect(0,0,this.vEBarW,this.vEBarHeight),a.restore(),a.save(),a.translate(f+this.vEYO,g+this.bS-this.vEXO),a.rotate(-this.vEBarRo),a.fillRect(0,0,this.vEBarW,this.vEBarHeight),void a.restore()):void 0;for(var k=f+this.wiEXO,l=g+this.wiEYO,m=0;3>m;m++)a.fillRect(k,l+m*this.wiESpace,this.wiEW,this.wiEHeight)};var ND={L:0,R:1,T:2,B:3};G.prototype.pB=function(a,b,c){this.grid[a][b]=c},G.prototype.rB=function(a,b){this.grid[a][b]=null},G.prototype.iVT=function(a,b){return a>=0&&a<this.width&&b>=0&&b<this.height},G.prototype.cPB=function(a,b){return this.iVT(a,b)&&null===this.grid[a][b]},G.prototype.gB=function(a,b){return this.iVT(a,b)?this.grid[a][b]:null},G.prototype.movePlaceholder=function(a,b){this.iVT(a,b)&&(this.pHCoords={x:a,y:b})},G.prototype.removePlaceholder=function(){this.pHCoords=null},G.prototype.eachNeighborBlock=function(a,b,c){var d=[],e=this.gB(a,b+1);d.push({x:a,y:b+1,block:e,direction:ND.B});var f=this.gB(a,b-1);d.push({x:a,y:b-1,block:f,direction:ND.T});var g=this.gB(a-1,b);d.push({x:a-1,y:b,block:g,direction:ND.L});var h=this.gB(a+1,b);d.push({x:a+1,y:b,block:h,direction:ND.R});for(var i=0;4>i;i++)if(null!=d[i].block){var j=d[i];c(j.x,j.y,j.block,j.direction)}},G.prototype.eachBlock=function(a){for(var b=[],c=0;c<this.width;c++)for(var d=0;d<this.height;d++)null!=this.grid[c][d]&&b.push({x:c,y:d,block:this.grid[c][d]});for(var e=b.length,f=0;e>f;f++){var g=b[f];a(g.x,g.y,g.block)}},G.prototype.getGCoordinates=function(a,b){return{x:Math.floor(a/this.bS),y:Math.floor(b/this.bS)}},G.prototype.draw=function(a){var b=this.bS;a.fillStyle=S.GBackgroundColor,a.fillRect(0,0,this.width*b,this.height*b),null!=this.pHCoords&&(a.fillStyle=S.PlaceholderColor,U.dRS(a,this.pHCoords.x*b,this.pHCoords.y*b,this.pHR,b)),this.eachBlock(function(b,c,d){d.draw(a,b,c)})},G.prototype.update=function(){var a=this,b={};return b.bC={},b.bC[BT.E]=0,b.bC[BT.F]=0,b.bC[BT.V]=0,b.bC[BT.W]=0,b.bC[BT.L]=0,this.eachBlock(function(c,d,e){if(e.update(),e.iD)return e.type===BT.E&&a.gls.erosionCt++,void a.rB(c,d);if(!e.iDy)if(b.bC[e.type]++,(e.type===BT.F||e.type===BT.WI||e.type===BT.W)&&e.h--,a.eachNeighborBlock(c,d,function(b,c,d,f){if(!d.iD&&!d.iDy){if(f===ND.B){if(e.type===BT.E&&(d.type===BT.WI||d.type===BT.F||d.type===BT.W||d.type===BT.L))return void d.k();if(e.type===BT.W&&d.type===BT.W)return void d.k()}return f!=ND.T&&e.type===BT.W&&d.type===BT.WI?void d.k():e.type===BT.W&&d.type===BT.F?void d.k():e.type===BT.F&&d.type===BT.WI?(a.gls.wiSFCt++,a.rB(b,c),void a.pB(b,c,new Block(BT.F,a.bS))):e.type===BT.V&&d.type===BT.W?(a.rB(b,c),void a.pB(b,c,new Block(BT.V,a.bS))):e.type===BT.V&&d.type===BT.F?(a.gls.bVCt++,e.k(),void d.k()):e.type===BT.E&&d.type===BT.W?void e.h--:e.type!==BT.L||d.type!==BT.F&&d.type!==BT.W&&d.type!==BT.V?void 0:void e.k()}}),e.h<=0&&e.k(),e.type===BT.WI&&e.sL>0){var f=e.sL-1;a.cPB(c,d-1)&&a.pB(c,d-1,new Block(BT.WI,a.bS,{sL:f})),a.cPB(c,d+1)&&a.pB(c,d+1,new Block(BT.WI,a.bS,{sL:f})),a.cPB(c+1,d)&&a.pB(c+1,d,new Block(BT.WI,a.bS,{sL:f})),a.cPB(c-1,d)&&a.pB(c-1,d,new Block(BT.WI,a.bS,{sL:f})),e.sL=0}else if(a.cPB(c,d+1))a.rB(c,d),a.pB(c,d+1,e);else if(e.sL>0){var f=e.sL-1;e.type===BT.W&&(a.cPB(c+1,d)&&a.pB(c+1,d,new Block(BT.W,a.bS,{sL:f})),a.cPB(c-1,d)&&a.pB(c-1,d,new Block(BT.W,a.bS,{sL:f}))),e.sL=0}}),b.bVCt=this.gls.bVCt,b.erosionCt=this.gls.erosionCt,b.wiSFCt=this.gls.wiSFCt,b};var GS={PL:1,P:2,G:3,W:4};Game.prototype.reset=function(){this.grid=new G(this,S.GW,S.GH,this.bS),this.ui=new UserInterface(this,this.gridW,0,this.uiW,this.canvasHeight),this.nextBlockType=null,this.pB=[BT.E],this.overrideBlock=null,this.vesEnabled=!1,this.vTimer=0,this.vDropInterval=S.VirusDropInterval,this.lifeEnabled=!1,this.lifeTimer=0,this.lifeDropInterval=S.LifeDropInterval,this.currentToxicity=0,this.currentTerraform=0,this.currentState=GS.PL,this.cL=0,this.cG=""},Game.prototype.update=function(){if(this.currentState==GS.PL){var a=this.grid.update();this.checkLevelProgress(a),this.updateVirusCt(a.bC[BT.V]),this.dropIntervalBlock(this.vesEnabled,++this.vTimer,this.vDropInterval,BT.V)&&(this.vTimer=0),this.dropIntervalBlock(this.lifeEnabled,++this.lifeTimer,this.lifeDropInterval,BT.L)&&(this.lifeTimer=0)}},Game.prototype.dropIntervalBlock=function(a,b,c,d){if(a&&b>c){var e=Math.floor(Math.random()*this.grid.width);if(this.grid.cPB(e,0))return this.grid.pB(e,0,new Block(d,this.bS)),!0}return!1},Game.prototype.draw=function(){this.currentState===GS.PL&&(this.grid.draw(this.context),this.ui.draw(this.context))},Game.prototype.start=function(){function a(){b.update(),b.draw()}var b=this;b.canvas.addEventListener("click",function(a){b.handleClick(b,a)},!1),b.canvas.addEventListener("mousemove",function(a){b.handleMouseMove(b,a)},!1),b.updateBlockType(),window.setInterval(a,100),a()},Game.prototype.handleClick=function(a,b){if(a.currentState===GS.P)return void(a.currentState=GS.PL);if(a.currentState!==GS.W&&a.currentState!==GS.G){var c=b.clientX-a.canvas.offsetLeft,d=b.clientY-a.canvas.offsetTop;if(c<=a.gridW){var e=a.grid.getGCoordinates(c,d);if(a.grid.cPB(e.x,e.y)){var f=new Block(a.nextBlockType,a.bS);a.grid.pB(e.x,e.y,f),a.updateBlockType()}}}},Game.prototype.handleMouseMove=function(a,b){if(a.currentState==GS.PL){var c=b.clientX-a.canvas.offsetLeft,d=b.clientY-a.canvas.offsetTop;if(c<=a.gridW){var e=a.grid.getGCoordinates(c,d);if(a.grid.cPB(e.x,e.y))return void a.grid.movePlaceholder(e.x,e.y)}a.grid.removePlaceholder()}},Game.prototype.updateBlockType=function(){var a;a=null!=this.overrideBlock?this.overrideBlock:1==this.pB.length?BT.E:this.pB[Math.floor(Math.random()*this.pB.length)],this.nextBlockType=this.ui.nextBlockType=a,this.overrideBlock=null},Game.prototype.updateVirusCt=function(a){this.currentToxicity=Math.floor(a/S.MaxVirusCt*100),this.currentToxicity>=100&&(this.displayGameOver(),this.currentState=GS.G)},Game.prototype.displayGameOver=function(){this.dM("MISSION FAILED","Planet has become too toxic")},Game.prototype.displayWin=function(){this.dM("MISSION SUCCESS","You have successfully populated your planet!")},Game.prototype.dM=function(a,b){this.currentState=GS.P,this.context.fillStyle="rgba(0, 0, 0, 0.5)",this.context.fillRect(0,0,1e3,500),this.context.fillStyle="#111",this.context.fillRect(0,150,1e3,200),this.context.fillStyle="#777",this.context.font="30px Arial, sans-serif",this.context.fillText(a,50,200),this.context.fillStyle="#FFF",this.context.font="20px Arial, sans-serif",this.context.fillText(b,50,240)},Game.prototype.checkLevelProgress=function(a){if(0==this.cL)return void this.cL++;if(1==this.cL)return this.cL++,this.cG="Place 10 EARTH",void this.dM("assignment 001","Place 10 EARTH blocks");if(2!=this.cL){if(3!=this.cL)4==this.cL&&a.bVCt>=5&&(this.cL++,this.cG="Erode 1 EARTH",this.dM("assignment 004","You've unlocked WATER! Use WATER to erode 1 EARTH block"),this.pB.push(BT.W),this.overrideBlock=BT.W),5==this.cL&&a.erosionCt>=1&&(this.cL++,this.cG="Spread 25 FIRE",this.dM("assignment 005","You've unlocked WIND! Use WIND to spread 25 FIRE blocks"),this.pB.push(BT.WI),this.pB.push(BT.WI),this.pB.push(BT.F),this.pB.push(BT.F),this.pB.push(BT.F),this.overrideBlock=BT.WI),6==this.cL&&a.wiSFCt>=25&&(this.cL++,this.cG="Support 3 LIFE",this.dM("final assignment","You can now support life! Support 3 LIFE"),this.lifeEnabled=!0),7==this.cL&&a.bC[BT.L]>=3&&this.displayWin();else if(a.bC[BT.F]>=5)return this.cL++,this.cG="Burn 5 VIRUS",this.dM("assignment 003","VIRUSES are invading! Burn 5 VIRUSES with FIRE!"),this.vesEnabled=!0,void(this.vTimer=this.vDropInterval+1)}else if(a.bC[BT.E]>=10)return this.cL++,this.cG="Place 5 FIRE",this.dM("assignment 002","You've unlocked FIRE! Get 5 fires burning at once"),this.pB.push(BT.F),void(this.overrideBlock=BT.F)};var S={GW:20,GH:10,BH:[],BDT:5,BSL:[],BBC:[],BIC:[],VirusDropInterval:40,LifeDropInterval:100,UiBackgroundColor:"#111",UiTextColor:"#FFF",UiTitleFontStyle:"40px Arial, sans-serif",UiFontStyle:"16px Arial, sans-serif",GBackgroundColor:"#FFF",PlaceholderColor:"#EEE",MaxVirusCt:20};S.BH[BT.F]=200,S.BH[BT.WI]=10,S.BH[BT.W]=200,S.BH[BT.E]=100,S.BH[BT.V]=100,S.BH[BT.L]=100,S.BSL[BT.F]=0,S.BSL[BT.WI]=2,S.BSL[BT.W]=4,S.BSL[BT.E]=0,S.BSL[BT.V]=0,S.BSL[BT.L]=0,S.BBC[BT.F]="214, 30, 30",S.BBC[BT.WI]="112, 208, 230",S.BBC[BT.W]="33, 104, 196",S.BBC[BT.E]="196, 107, 33",S.BBC[BT.V]="77, 168, 37",S.BBC[BT.L]="1, 1, 1",S.BIC[BT.F]="184, 26, 26",S.BIC[BT.WI]="123, 216, 237",S.BIC[BT.W]="29, 87, 163",S.BIC[BT.E]="168, 93, 30",S.BIC[BT.V]="64, 138, 32",S.BIC[BT.L]="1, 1, 1",UserInterface.prototype.draw=function(a){a.fillStyle=S.UiBackgroundColor,a.fillRect(this.uiX,this.uiY,this.uiW,this.uiHeight),a.fillStyle=S.UiTextColor,a.font=S.UiTitleFontStyle,a.fillText("elum",this.uiLeftMargin,this.uiTopMargin);var b;switch(this.nextBlockType){case BT.F:b="fire";break;case BT.E:b="earth";break;case BT.W:b="water";break;case BT.WI:b="wind"}a.fillStyle=U.gRFS(S.BBC[this.nextBlockType],1),a.fillRect(this.uiX,this.tSY,this.uiW,this.tSHeight),a.fillStyle="rgba(255, 255, 255, 0.1)",a.fillRect(this.uiX,this.tSY,this.tSHighlightW,this.tSHeight),a.fillStyle=S.UiTextColor,a.font=S.UiFontStyle,a.fillText(b,this.uiLeftMargin,this.tSTextY),a.fillText("toxicity",this.uiLeftMargin,this.toxicityTextY),a.fillText(this.game.currentToxicity+"%",this.uiInnerLeftMargin,this.toxicityTextY),a.fillText("goal",this.uiLeftMargin,this.goalHeaderTextY),a.fillText(this.game.cG,this.uiLeftMargin,this.goalTextY)};var U={gRFS:function(a,b){return"rgba("+a+", "+b+")"},dRS:function(a,b,c,d,e){a.beginPath(),a.moveTo(b,c+d),a.lineTo(b,c+e-d),a.quadraticCurveTo(b,c+e,b+d,c+e),a.lineTo(b+e-d,c+e),a.quadraticCurveTo(b+e,c+e,b+e,c+e-d),a.lineTo(b+e,c+d),a.quadraticCurveTo(b+e,c,b+e-d,c),a.lineTo(b+d,c),a.quadraticCurveTo(b,c,b,c+d),a.fill()}},game=new Game(document.getElementById("game"));game.start();</script></body></html>
