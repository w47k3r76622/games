!function t(e,n,i){function o(s,a){if(!n[s]){if(!e[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return o(n?n:t)},c,c.exports,t,e,n,i)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(t,e,n){"use strict";function i(t){if(null===t||void 0===t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}var o=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;e.exports=Object.assign||function(t,e){for(var n,s,a=i(t),l=1;l<arguments.length;l++){n=Object(arguments[l]);for(var u in n)o.call(n,u)&&(a[u]=n[u]);if(Object.getOwnPropertySymbols){s=Object.getOwnPropertySymbols(n);for(var c=0;c<s.length;c++)r.call(n,s[c])&&(a[s[c]]=n[s[c]])}}return a}},{}],2:[function(t,e,n){"use strict";var i=t("./mixins/ttl"),o=t("./mixins/movable"),r=t("./mixins/scalable"),s=t("./mixins/killable"),a=t("./mixins/strokable"),l=t("./mixins/colourable"),u=t("./mixins/collidable"),c=t("./mixins/renderable"),f=t("./mixins/transformer"),h=t("./mixins/subscribable"),m=t("object-assign"),d=new Path2D("M-2.5 0.5 l4 0"),p=10;e.exports=function(){var t=m({},h(),o,l,u,r,s,a,c,i,f,{init:function(){this.moveTo(0,0),this.setScale(1),this.setLineWidth(3),this.setPath(d),this.setColour("blue"),this.setTtl(3e3),this.birth()},update:function(t){this.movement(t),this.updateTtl(t),this.getTtl()<0&&this.die()},movement:function(t){this.move(t*p,0)},dead:function(){return this.ttl<=0}});return t.init(),t.setCollisionBounds([{x:-2.5,y:-1.5},{x:2.5,y:-1.5},{x:2.5,y:1.5},{x:-2.5,y:1.5}]),t}},{"./mixins/collidable":18,"./mixins/colourable":19,"./mixins/killable":25,"./mixins/movable":26,"./mixins/renderable":27,"./mixins/scalable":29,"./mixins/strokable":30,"./mixins/subscribable":31,"./mixins/transformer":32,"./mixins/ttl":33,"object-assign":1}],3:[function(t,e,n){"use strict";var i=new Map;e.exports=function(t){var e,n;return i.has(t)?i.get(t):(n=new Set,e={get:function(t,e){var i;return"function"!=typeof e&&(e=function(t){return t.values().next().value}),n.size>0?(i=e(n),i?n.delete(i):i=t()):i=t(),i},put:function(t){t&&n.add(t)},delete:function(t){n.delete(t)},size:function(){return n.size},clear:function(){return n.clear()}},e[Symbol.iterator]=function(){return n[Symbol.iterator]()},i.set(t,e),e)}},{}],4:[function(t,e,n){"use strict";function i(t,e,n){t.setCollisionBounds([{x:0,y:0},{x:e,y:0},{x:e,y:n},{x:0,y:n}])}var o=t("./mixins/movable"),r=t("./mixins/collidable"),s=t("./mixins/transformer"),a=t("object-assign");e.exports=function(t,e,n,l){var u=a({},o,r,s,{x:t,y:e,width:n,height:l,setSize:function(t,e){this.width=t,this.height=e,i(u,t,e)},getSize:function(){return{width:this.width,height:this.height}}});return u.setSize(n,l),u}},{"./mixins/collidable":18,"./mixins/movable":26,"./mixins/transformer":32,"object-assign":1}],5:[function(t,e,n){"use strict";function i(){var t=window,e=t.innerWidth,n=t.innerHeight;this.trigger("resize",e,n)}var o=t("./mixins/subscribable"),r=t("object-assign");e.exports=function(){var t;return r({},o(),{init:function(e){this.canvas=document.querySelector(e),this.context=this.canvas.getContext("2d"),this.on("resize",function(t,e){this.canvas.width=t,this.canvas.height=e}),t=i.bind(this),window.addEventListener("resize",t,!1),t()},delete:function(){window.removeEventListener("resize",t)},getContext:function(){return this.context},getWidth:function(){return this.canvas.width},getHeight:function(){return this.canvas.height}})}},{"./mixins/subscribable":31,"object-assign":1}],6:[function(t,e,n){"use strict";var i=t("./utils/async"),o=t("object-assign");e.exports=function(t){var e=[],n=[],r=o({onEveryCreated:function(){},onEveryDead:function(){},onCreated:function(){},onDeath:function(){}},t);if(!r.spawnInfo)throw new Error("Must provide opts.spawnInfo");if(!r.getEnemy)throw new Error("Must provide opts.getEnemy");if(!r.initEnemy)throw new Error("Must provide opts.initEnemy");for(var s=0;s<r.spawnInfo.count;s++)!function(t){var i,o;o=new Promise(function(n){i=new Promise(function(e){r.spawnInfo.timeouts.push(window.setTimeout(function(){r.initEnemy(t),r.spawnInfo.unsubs.push(t.onDeathOnce(function(){r.onDeath(t),n()})),r.onCreated(t),e()},r.spawnInfo.spawnSpeed*s))}),e.push(i)}),n.push(o)}(r.getEnemy(r.spawnInfo.type));return i.every(e,function(){r.onEveryCreated()}),i.every(n,function(){r.onEveryDead()}),r.spawnInfo.creationPromises=e,r.spawnInfo.deathPromises=n,r.spawnInfo}},{"./utils/async":44,"object-assign":1}],7:[function(t,e,n){"use strict";function i(t,e,n,i,o){var r=2*Math.PI,s=o*n*r/(60*e/1e3);return{when:t,func:"move",params:h(i,s,"middle","y"),loopFor:e}}function o(t,e,n,i){var o=2*Math.PI,r=i*o/(60*e/1e3);return{when:t,func:"move",params:m(n,r),loopFor:e}}function r(t,e,n,i){var o=2*Math.PI,r=i*o/(60*e/1e3)/2;return{when:t,func:"move",params:m(n,r),loopFor:e}}function s(t,e,n){return[o(t,e,n,-1),{when:t+e,reset:!0},o(t+e,e,n,1),{when:t+2*e,reset:!0}]}function a(t,e,n,i){return void 0===i&&(i=0),{when:t,func:"move",params:function(t){var e=t/(1e3/60);return[e*n,e*i]},loopFor:e}}var l=t("./enemy"),u=t("./random"),c=t("./cache-generator")("enemies"),f=t("./utils/for-of"),h=t("./keyframes/sin"),m=t("./keyframes/circle"),d=t("object-assign"),p=new Path2D("M-10.5 -4.5 l20 4 l-20 4 l5 -4 l-5 -4"),y=[{x:-10.5,y:-4.5},{x:10.5,y:.5},{x:-10.5,y:4.5}],x=[{path:p,collision:y,rotation:Math.PI,keyframes:[a(0,500,-2),i(500,12e3,3,200,-1),a(4500,-1,-1),a(8500,-1,3),a(12500,-1,-4)]},{path:p,collision:y,rotation:Math.PI,keyframes:[a(0,2e3,-2),a(2e3,1e3,2),r(2e3,1e3,120,-1),a(3e3,1e3,-2),a(4e3,1e3,2),r(4e3,1e3,120,1),a(5e3,-1,-4)]},{path:p,collision:y,rotation:Math.PI,keyframes:[a(0,2e3,-4),a(2e3,2e4,1),a(22e3,-1,-4)].concat(s(2e3,2e3,80),s(6e3,2e3,80),s(1e4,2e3,80),s(14e3,2e3,80),s(18e3,2e3,80))}],g={get:function(t){return"undefined"==typeof t&&(t=u.betweenInts(0,x.length)),c.get(function(){return l(d({type:t},x[t]))},function(e){var n;return f(e,function(e){return e.type===t?(n=e,!1):void 0}),n})},put:function(t){c.put(t)}};g[Symbol.iterator]=function(){return c[Symbol.iterator]()},e.exports=g},{"./cache-generator":3,"./enemy":8,"./keyframes/circle":13,"./keyframes/sin":14,"./random":39,"./utils/for-of":45,"object-assign":1}],8:[function(t,e,n){"use strict";var i=t("./mixins/movable"),o=t("./mixins/scalable"),r=t("./mixins/killable"),s=t("./mixins/strokable"),a=t("./mixins/rotatable"),l=t("./mixins/keyframed"),u=t("./mixins/colourable"),c=t("./mixins/collidable"),f=t("./mixins/renderable"),h=t("./mixins/transformer"),m=t("./mixins/subscribable"),d=t("object-assign");e.exports=function(t){if(!t.path||!t.collision)throw new Error("Must supply a path and collision hull");var e=d({},i,m(),r,l,u,c,a,o,s,f,h),n=d({},{pos:{x:0,y:0},colour:"yellow",scale:1,lineWidth:3,rotation:0,keyframes:[]},t);return"undefined"!=typeof n.type&&(e.type=n.type),e.setPath(n.path),e.setCollisionBounds(n.collision),e.rotateTo(n.rotation),e.moveTo(n.pos.x,n.pos.y),e.setColour(n.colour),e.setScale(n.scale),e.setLineWidth(n.lineWidth),e.setKeyframes(n.keyframes),e}},{"./mixins/collidable":18,"./mixins/colourable":19,"./mixins/keyframed":24,"./mixins/killable":25,"./mixins/movable":26,"./mixins/renderable":27,"./mixins/rotatable":28,"./mixins/scalable":29,"./mixins/strokable":30,"./mixins/subscribable":31,"./mixins/transformer":32,"object-assign":1}],9:[function(t,e,n){"use strict";e.exports=function(t){var e=[];return t=t||60,{time:function(n){return e.unshift(n),e.length>t&&e.pop(),e.length<=1?0:e[0]-e[1]},rate:function(){for(var t=e[0]-e[1],n=0;n<e.length-1;n++)t+=e[n]-e[n+1];return t/e.length}}}},{}],10:[function(t,e,n){"use strict";e.exports=function(){var t=Object.create(null);return{isKeyDown:function(e){return!!t[e]},isKeyPressed:function(e){return 1===t[e]},isKeyHeld:function(e){return 2===t[e]},handleKeyDown:function(e){t[e]||(t[e]=1)},handleKeyUp:function(e){delete t[e]},reset:function(){t=Object.create(null)},markDownAsHeld:function(){for(var e in t)t[e]=2},getAllNotUp:function(){var e=[];for(var n in t)t[n]&&e.push(n);return e}}}},{}],11:[function(t,e,n){"use strict";e.exports=function(t,e){return t*e}},{}],12:[function(t,e,n){"use strict";e.exports=function(t,e){return t=2*t,1>t?e/2*t*t:(t--,-e/2*(t*(t-2)-1))}},{}],13:[function(t,e,n){"use strict";e.exports=function(t,e){return function(n,i){var o,r,s,a=n/(1e3/60);return void 0===i.init&&(i.init=!0,i.radius=t,i.angle=e>0?Math.PI/2:-Math.PI/2,i.lastX=0,i.lastY=e>0?i.radius:-i.radius),i.angle+=a*e,i.angle>2*Math.PI?i.angle-=2*Math.PI:i.angle<0&&(i.angle+=2*Math.PI),r=i.radius*Math.cos(i.angle),s=i.radius*Math.sin(i.angle),o=[r-i.lastX,s-i.lastY],i.lastX=r,i.lastY=s,o}}},{}],14:[function(t,e,n){"use strict";e.exports=function(t,e,n,i){return function(o,r){var s,a,l,u=o/(1e3/60);if(r.amplitude=r.amplitude||t,void 0===r.init){if(r.init=!0,"bottom"===n?r.angle=-Math.PI/2:"top"===n?r.angle=Math.PI/2:r.angle=0,r.angleChangePerFrame=e,"x"===i){var c=0;"bottom"===n?c=-r.amplitude:"top"===n&&(c=r.amplitude),r.lastX=c}else r.lastX=0;if("y"===i){var c=0;"bottom"===n?c=-r.amplitude:"top"===n&&(c=r.amplitude),r.lastY=c}else r.lastY=0}return r.angle+=u*r.angleChangePerFrame,r.angle>Math.PI/2?(r.angleChangePerFrame*=-1,r.angle=Math.PI/2):r.angle<-Math.PI/2&&(r.angleChangePerFrame*=-1,r.angle=-Math.PI/2),"x"===i?(a=r.amplitude*Math.sin(r.angle),l=0):(a=0,l=r.amplitude*Math.sin(r.angle)),s=[a-r.lastX,l-r.lastY],r.lastX=a,r.lastY=l,s}}},{}],15:[function(t,e,n){"use strict";var i=t("../interpolators/linear");e.exports=function(t,e,n,o,r){var s,a,l,u=!1,c=!1,f=0;if(Array.isArray(t)!==Array.isArray(e)||t.length!==e.length)throw new Error("`tweenFrom` and `tweenTo` must be single values, or arrays with the same length");return r=r||i,Array.isArray(t)?(a=t.map(function(t,n){return e[n]-t}),l=function(e){return a.map(function(i,o){return t[o]+r(e/n,i)})}):(a=e-t,l=function(e){return[t+r(e/n,a)]}),o=o||function(t){return t},function(t,e){return f+=t,u?c?o(l(n)):(f>=n&&(c=!0,f=n),s=l(f),o(s)):(u=!0,o(l(0)))}}},{"../interpolators/linear":11}],16:[function(t,e,n){"use strict";var i=t("../interpolators/quadratic"),o=t("object-assign"),r=t("./tween");e.exports=function(t){var e=o({when:0,duration:1e3,interpolator:i,maxZoom:2,restZoom:1,startPos:[0,0],endPos:[100,100],modifier:function(t){return t}},t),n=e.duration/2;return[{when:e.when,func:"moveTo",params:function(){return e.startPos},loopFor:0},{when:e.when,func:"setFontSize",params:r(0,e.maxZoom,n,e.modifier,e.interpolator),loopFor:n},{when:e.when+n,func:"setFontSize",params:r(e.maxZoom,e.restZoom,n,e.modifier,e.interpolator),loopFor:n},{when:e.when+n,func:"moveTo",params:r(e.startPos,e.endPos,n,null,e.interpolator),loopFor:n}]}},{"../interpolators/quadratic":12,"./tween":15,"object-assign":1}],17:[function(t,e,n){"use strict";function i(){var t=v.getWidth()/2,e=[100,t/2,t-100].map(function(t,e){var n=p(),i=600;return n.moveTo(0,0),n.setFont("Sans-Serif"),n.setFontSize("0pt"),n.setFontStyle("bold"),n.setTextBaseline("middle"),n.setTextAlign("center"),n.setKeyframes(b({when:e*i,duration:i,startPos:[v.getWidth()/4,v.getHeight()/4],endPos:[t,20],maxZoom:40,restZoom:20,modifier:function(t){return[t[0]+"pt"]}})),n});h=e[0],f=e[1],m=e[2]}function o(){v.on("resize",x.trigger.bind(x,"resize")),v.init("canvas"),c=v.getContext()}function r(){x.on("score",function(t){m.setText("score: "+t)}),x.on("energy",function(t){h.setText("energy: "+t)}),x.on("lives",function(t){f.setText("lives: "+t)}),g.setState(x),g.init(v.getWidth(),v.getHeight())}function s(){o(),i(),w=!0,r(),u()}function a(t){h.updateKeyFrames(t),f.updateKeyFrames(t),m.updateKeyFrames(t)}function l(){h.render(c),f.render(c),m.render(c)}function u(){var t=Date.now(),e=y.time(t);g.update(e),c.clearRect(0,0,v.getWidth(),v.getHeight()),g.render(c),a(e),l(),requestAnimationFrame(u)}var c,f,h,m,d=t("./canvas"),p=t("./text"),y=t("./framerate")(60),x=t("./states/game"),g=t("./state-manager"),b=t("./keyframes/zoom-and-move"),v=d(),w=!1;s()},{"./canvas":5,"./framerate":9,"./keyframes/zoom-and-move":16,"./state-manager":41,"./states/game":42,"./text":43}],18:[function(t,e,n){"use strict";function i(t,e){return t.x*e.x+t.y*e.y}function o(t,e){return{x:e.y-t.y,y:-(e.x-t.x)}}function r(t,e,n,i){var o,r,s,a,l=[];return 0===e&&1===n&&0===i.x&&0===i.y?t:(0!==e&&(o=Math.cos(e),r=Math.sin(e)),t.forEach(function(t){s=t.x,a=t.y,0!==e&&(s=t.x*o-t.y*r,a=t.y*o+t.x*r),s*=n,a*=n,s+=i.x,a+=i.y,l.push({x:s,y:a})}),l)}function s(t){var e=[];return h(t,function(t,n){e.push(o(t,n))},!0),e}function a(t){var e,n,i={x:1/0,y:1/0},o={x:-(1/0),y:-(1/0)};return t.forEach(function(t){e=t.x,n=t.y,i.x=Math.min(e,i.x),i.y=Math.min(n,i.y),o.x=Math.max(e,o.x),o.y=Math.max(n,o.y)}),{x:i.x,y:i.y,w:o.x-i.x,h:o.y-i.y}}function l(t,e){return t.x<e.x+e.w&&t.x+t.w>e.x&&t.y<e.y+e.h&&t.h+t.y>e.y}function u(t,e){var n,o=1/0,r=-(1/0);return t.forEach(function(t){n=i(e,t),o=Math.min(n,o),r=Math.max(n,r)}),{min:o,max:r}}function c(t,e){return t.max>=e.min&&t.min<=e.max}function f(t,e,n,o,r){var s,a,l,f,h,m,d,p,y,x,g,b=1/0;return s=e.concat(o).every(function(e){return a=u(t,e),l=u(n,e),c(a,l)?r?(f=a.max-l.min,h=l.max-a.min,m=h>f?f:h,x=i(e,e),d=m/x,p={x:e.x*d,y:e.y*d},y=i(p,p),b>y&&(g=p,b=y),!0):!0:!1}),s?r?g:!0:!1}var h=t("../utils/for-pairs");e.exports={isCollidable:!0,setCollisionBounds:function(t){this.bounds=t,this.clearStaleCollisionData(),this.updateAllCollisionData()},updateAllCollisionData:function(){this.updateCommonCollisionData(),this.updateAABBCollisionData(),this.updateSATCollisionData()},updateCommonCollisionData:function(){this._calcTransformed||(this._calcTransformed=r(this.bounds,this._collisionAngleCache,this._collisionScaleCache,this._collisionPosCache))},updateAABBCollisionData:function(){this._calcAABB||(this._calcAABB=a(this._calcTransformed))},updateSATCollisionData:function(){this._calcNormals||(this._calcNormals=s(this._calcTransformed))},clearStaleCollisionData:function(){var t=this.isRotatable&&(void 0===this._collisionAngleCache||this.getRotation()!==this._collisionAngleCache);t=t||this.isScalable&&(void 0===this._collisionScaleCache||this.getScale()!==this._collisionScaleCache),t=t||this.isMovable&&(void 0===this._collisionPosCache||this.getPos().x!==this._collisionPosCache.x||this.getPos().y!==this._collisionPosCache.y),t&&(this._collisionAngleCache=this.isRotatable?this.getRotation()||0:0,this._collisionScaleCache=this.isScalable?this.getScale()||1:1,this._collisionPosCache=this.isMovable?this.getPos():{x:0,y:0},this._calcTransformed=null,this._calcAABB=null,this._calcNormals=null)},collidingWith:function(t,e,n){return this.clearStaleCollisionData(),this.updateCommonCollisionData(),this.updateAABBCollisionData(),t.clearStaleCollisionData(),t.updateCommonCollisionData(),t.updateAABBCollisionData(),l(this._calcAABB,t._calcAABB)?e?(this.updateSATCollisionData(),t.updateSATCollisionData(),f(this._calcTransformed,this._calcNormals,t._calcTransformed,t._calcNormals,n)):!0:!1}}},{"../utils/for-pairs":46}],19:[function(t,e,n){"use strict";e.exports={isColourable:!0,setColour:function(t){this.colour=t}}},{}],20:[function(t,e,n){"use strict";e.exports={isEnergised:!0,setEnergy:function(t){this.energy=t},changeEnergy:function(t){this.energy+=t},getEnergy:function(){return this.energy}}},{}],21:[function(t,e,n){"use strict";e.exports={isFillable:!0,fill:function(t){this.isColourable&&(t.fillStyle=this.colour)}}},{}],22:[function(t,e,n){"use strict";e.exports={isFont:!0,setFont:function(t){this.font=t},setText:function(t){this.text=t},setTextAlign:function(t){this.textAlign=t},setTextBaseline:function(t){this.textBaseline=t},setFontSize:function(t){this.fontSize=t},setFontStyle:function(t){this.fontStyle=t},getFontString:function(){return(this.fontStyle+" "+this.fontSize+" "+this.font).trim()},writeText:function(t){var e;e=this.isMovable?this.getPos():{x:0,y:0},t.font=this.getFontString(),t.textAlign=this.textAlign||"left",t.textBaseline=this.textBaseline||"bottom",t.fillText(this.text,e.x,e.y)}}},{}],23:[function(t,e,n){"use strict";e.exports={isIdentifiable:!0,setId:function(t){this.id=t},getId:function(){return this.id}}},{}],24:[function(t,e,n){"use strict";function i(){this._keyframeElapsedTime||(this._keyframeElapsedTime=0),this._keyframeState||(this._keyframeState=this.keyframes.map(function(){return{}}))}e.exports={isKeyframed:!0,setKeyframes:function(t){this.keyframes=t},updateKeyFrames:function(t){var e=this;i.call(this),this.keyframes.forEach(function(n,i){var o,r,s,a=e._keyframeState[i];if(!(a.complete||n.when>e._keyframeElapsedTime)){if(n.reset)return void(e._keyframeState[i]={complete:!0});a[n.func]=a[n.func]||{},o=t,r=n.when+n.loopFor,n.loopFor>=0&&r<=e._keyframeElapsedTime&&(a.complete=!0,o=e._keyframeElapsedTime-r),s=n.params.call(e,t,a[n.func]),e[n.func].apply(e,s)}}),this._keyframeElapsedTime+=t},resetKeyframes:function(){delete this._keyframeElapsedTime,delete this._keyframeState}}},{}],25:[function(t,e,n){"use strict";function i(){if(!this.isSubscribable)throw new Error("Killable requires Subscribable to be mixed in")}e.exports={isKillable:!0,isAlive:function(){return this.alive},birth:function(){this.alive=!0},die:function(){i.call(this),this.alive=!1,this.trigger("death")},onDeath:function(t){return i.call(this),this.on("death",t)},onDeathOnce:function(t){return i.call(this),this.once("death",t)}}},{}],26:[function(t,e,n){"use strict";e.exports={isMovable:!0,moveTo:function(t,e){this.x=t,this.y=e},move:function(t,e){this.x+=t,this.y+=e},getPos:function(){return{x:this.x,y:this.y}}}},{}],27:[function(t,e,n){"use strict";e.exports={isRenderable:!0,render:function(t){this.isTransformer&&this.setTransformations(t),this.isStrokable&&this.stroke(t),this.isFillable&&this.fill(t),this.isFont&&this.writeText(t),this.isTransformer&&this.resetTransformations(t)}}},{}],28:[function(t,e,n){"use strict";function i(t){function e(e){return Math.floor(t/o)*o}return t>o?t-=e(t):-o>t&&(t+=e(t)),t}var o=2*Math.PI;e.exports={isRotatable:!0,rotate:function(t){this.angle=i(this.angle+t)},rotateTo:function(t){this.angle=i(t)},getRotation:function(){return this.angle}}},{}],29:[function(t,e,n){"use strict";e.exports={isScalable:!0,setScale:function(t){this.scale=t},getScale:function(){return this.scale}}},{}],30:[function(t,e,n){"use strict";e.exports={isStrokable:!0,setLineWidth:function(t){this.lineWidth=t},setAbsoluteLineWidth:function(t){this.absoluteLineWidth=t},setPath:function(t){this.path=t},stroke:function(t){this.absoluteLineWidth?this.isScalable?t.lineWidth=this.absoluteLineWidth/this.getScale():t.lineWidth=this.absoluteLineWidth:t.lineWidth=this.lineWidth,t.lineCap="round",t.lineJoin="round",this.isColourable&&(t.strokeStyle=this.colour),t.stroke(this.path)}}},{}],31:[function(t,e,n){"use strict";var i=t("../utils/for-of");e.exports=function(){function t(t){var e;return n.has(t)?e=n.get(t):(e=new Set,n.set(t,e)),e}function e(e,n){var i=t(e);return function(){i.has(n)&&i.delete(n)}}var n=new Map;return{isSubscribable:!0,on:function(n,i){var o=t(n),r=i.bind(this);return o.add(r),e(n,r)},once:function(n,i){var o,r=t(n),s=this,a=function(){i.apply(s,Array.prototype.slice.call(arguments)),o()};return o=e(n,a),r.add(a),o},trigger:function(e){var n=t(e),o=Array.prototype.slice.call(arguments,1);i(n,function(t){t.apply(null,o)})}}}},{"../utils/for-of":45}],32:[function(t,e,n){"use strict";e.exports={isTransformer:!0,setTransformations:function(t,e){var n,i;t.save(),this.isMovable&&(n=this.getPos(),n.x=Math.floor(n.x),n.y=Math.floor(n.y),e?t.translate(-n.x,-n.y):t.translate(n.x,n.y)),this.isScalable&&(i=this.getScale(),t.scale(i,i)),this.isRotatable&&(e?t.rotate(this.getRotation()):t.rotate(this.getRotation()))},resetTransformations:function(t){t.restore()}}},{}],33:[function(t,e,n){"use strict";e.exports={isTtl:!0,setTtl:function(t){this.ttl=t},updateTtl:function(t){var e=1e3*t/60;this.ttl-=e},getTtl:function(){return this.ttl}}},{}],34:[function(t,e,n){"use strict";function i(){if(!this.isSubscribable)throw new Error("Updater requires Subscribable to be mixed in")}t("object-assign");e.exports={isUpdater:!0,registerUpdatable:function(t){return i(),this.on("update",t)}}},{"object-assign":1}],35:[function(t,e,n){"use strict";function i(t,e,n,i,o){var r,s,c,f=n.getSize().height,h=Math.floor(f/6),m=Math.floor(f/2);t.record=u(t.name,function(e){return e=e||0,c=a.betweenInts(h,m),r=i(c),s=a.betweenInts(c/2,2*c),t.nextX=e+c+s,{type:a.betweenInts(0,l.getTypes().length),x:e+r+s,y:t.y,scale:c,angle:o()}})}function o(t,e){t.obstacle=l.get(t.type),t.obstacle.moveTo(t.x,t.y),t.obstacle.rotateTo(t.angle),t.obstacle.setScale(t.scale),e.put(t.obstacle)}function r(t,e,n){var i;for(t.record.forOf(function(t){e.delete(t.obstacle),l.put(t.obstacle),delete t.obstacle}),t.iterator=t.record[Symbol.iterator]();;)if(i=t.iterator.next(t.nextX).value,o(i,e),!i.obstacle.collidingWith(n,!1))break;t.last=i,t.firstIterator=t.record[Symbol.iterator](),t.first=t.firstIterator.next().value}function s(t,e,n){for(var i;!t.first.obstacle.collidingWith(n,!1);)e.delete(t.first.obstacle),l.put(t.first.obstacle),delete t.first.obstacle,t.first=t.firstIterator.next().value;for(;t.last.obstacle.collidingWith(n,!1);)i=t.iterator.next(t.nextX).value,o(i,e),t.last=i,e.put(t.last.obstacle)}var a=(t("./utils/for-of"),t("./random")),l=t("./obstacles"),u=t("./recording"),c=t("./cache-generator");e.exports=function(t){var e={live:c("obstacles:live"),top:{name:"obstacles:top",y:0,nextX:0},bottom:{name:"obstacles:bottom",y:t.getSize().height,nextX:0},update:function(){s(this.top,this.live,t),s(this.bottom,this.live,t)},reset:function(){r(this.top,this.live,t),r(this.bottom,this.live,t)}};return i(e.top,e.live,t,function(t){return-t/2},function(){return 0}),i(e.bottom,e.live,t,function(t){return t/2},function(){return Math.PI}),e.reset(),e}},{"./cache-generator":3,"./obstacles":37,"./random":39,"./recording":40,"./utils/for-of":45}],36:[function(t,e,n){"use strict";var i=t("./mixins/movable"),o=t("./mixins/scalable"),r=t("./mixins/strokable"),s=t("./mixins/rotatable"),a=t("./mixins/colourable"),l=t("./mixins/collidable"),u=t("./mixins/renderable"),c=t("./mixins/transformer"),f=t("object-assign");e.exports=function(t){if(!t.path||!t.collision)throw new Error("Must supply a path and collision hull");var e=f({},i,a,l,s,o,r,u,c),n=f({},{pos:{x:0,y:0},colour:"red",scale:1,lineWidth:3,path:[],collision:[]},t);return"undefined"!=typeof n.type&&(e.type=n.type),e.setPath(n.path),e.setCollisionBounds(n.collision),e.moveTo(n.pos.x,n.pos.y),e.setColour(n.colour),e.setScale(n.scale),e.setAbsoluteLineWidth(n.lineWidth),e}},{"./mixins/collidable":18,"./mixins/colourable":19,"./mixins/movable":26,"./mixins/renderable":27,"./mixins/rotatable":28,"./mixins/scalable":29,"./mixins/strokable":30,"./mixins/transformer":32,"object-assign":1}],37:[function(t,e,n){"use strict";var i=t("./obstacle"),o=t("./random"),r=t("./cache-generator")("obstacles"),s=t("./utils/for-of"),a=[{path:new Path2D("M0 0 l0.37 0.74 l0.18 0.18 l0.37 -0.18 l0.07 -0.74"),collision:[{x:0,y:0},{x:.37,y:.74},{x:.55,y:.92},{x:.92,y:.74},{x:1,y:0}]},{path:new Path2D("M0 0 l0.25 1 l0.16 -0.66 l0.08 0.33 l0.25 -0.66"),collision:[{x:0,y:0},{x:.25,y:1},{x:.5,y:.66},{x:.75,y:0}]},{path:new Path2D("M0 0 l0.08 0.33 l0.12 -0.17 l0.05 0.25 l0.13 -0.3 l0.2 0.88 l0.33 -1"),collision:[{x:0,y:0},{x:.83,y:.33},{x:.25,y:.42},{x:.58,y:1},{x:.92,y:0}]},{path:new Path2D("M0.36 0 l-0.36 0.36 l0.54 0.18 l0.18 0.45 l0.18 -1"),collision:[{x:.36,y:0},{x:0,y:.36},{x:.73,y:1},{x:.91,y:0}]}],l={get:function(t){return"undefined"==typeof t&&(t=o.betweenInts(0,a.length)),r.get(function(){return i({type:t,path:a[t].path,collision:a[t].collision})},function(e){var n;return s(e,function(e){return e.type===t?(n=e,!1):void 0}),n})},put:function(t){r.put(t)},getTypes:function(){return a}};l[Symbol.iterator]=function(){return r[Symbol.iterator]()},e.exports=l},{"./cache-generator":3,"./obstacle":36,"./random":39,"./utils/for-of":45}],38:[function(t,e,n){"use strict";var i=t("./mixins/movable"),o=t("./mixins/scalable"),r=t("./mixins/strokable"),s=t("./mixins/energised"),a=t("./mixins/colourable"),l=t("./mixins/collidable"),u=t("./mixins/renderable"),c=t("./mixins/transformer"),f=t("./mixins/identifiable"),h=t("object-assign"),m=new Path2D("M-10.5 -4.5 l20 4 l-20 4 l5 -4 l-5 -4"),d=0;e.exports=function(){var t=h({},i,f,a,l,o,r,s,u,c);return t.setId(d),d++,t.setColour("blue"),t.setScale(5),t.setLineWidth(1),t.setPath(m),t.setCollisionBounds([{x:-10.5,y:-4.5},{x:10.5,y:.5},{x:-10.5,y:4.5}]),t}},{"./mixins/collidable":18,"./mixins/colourable":19,"./mixins/energised":20,"./mixins/identifiable":23,"./mixins/movable":26,"./mixins/renderable":27,"./mixins/scalable":29,"./mixins/strokable":30,"./mixins/transformer":32,"object-assign":1}],39:[function(t,e,n){"use strict";e.exports={betweenInts:function(t,e){return Math.floor(Math.random()*(e-t))+t}}},{}],40:[function(t,e,n){"use strict";var i=t("./utils/for-of"),o=t("./cache-generator");e.exports=function(t,e,n){if("string"!=typeof t||0===t.length)throw new Error("Must specifiy a name for this recording");if(e&&"function"!=typeof e)throw new Error("Optional `createNew` param must be a function");var r=t+":recording",s=o(r),a={put:s.put,forOf:function(t){i(s[Symbol.iterator](),t)}};return a[Symbol.iterator]=function(){var t,i,o,r,a=s[Symbol.iterator](),l=0,u=s.size();return{next:function(c){var f,h=s.size(),m=Array.prototype.slice.call(arguments);if("function"==typeof c?m=m.slice(1):c=void 0,h!==u){for(a=s[Symbol.iterator](),f=0;u>f&&h>f&&l>f;f++)a.next(),i=void 0;u=h}return t=i?i:a.next(),c&&(c(t.value)?i=void 0:(i=t,t={done:!1,value:n})),t.done&&e?(o=e.apply(this,m),s.put(o),r={done:!1,value:o}):r=t,l++,r}}},a}},{"./cache-generator":3,"./utils/for-of":45}],41:[function(t,e,n){"use strict";e.exports={setState:function(t){this.state=t},getState:function(){return this.state},init:function(){this.state.init.apply(this.state,Array.prototype.slice.call(arguments))},update:function(t){this.state.update(t)},render:function(t){this.state.render(t)}}},{}],42:[function(t,e,n){"use strict";function i(t){return t.preventDefault&&t.preventDefault(),Y.get(S).handleKeyDown(t.keyCode),G.get(S).recording.put({type:"keydown",keyCode:t.keyCode}),!1}function o(t){return t.preventDefault&&t.preventDefault(),Y.get(S).handleKeyUp(t.keyCode),G.get(S).recording.put({type:"keyup",keyCode:t.keyCode}),!1}function r(t){P(V,function(e){e!==S&&t(e)})}function s(t){P(V,t)}function a(){P(Y,function(t){t[1].markDownAsHeld()})}function l(){Y.get(S).getAllNotUp().forEach(function(t){o({keyCode:t})})}function u(t){P(G.get(S).recording,function(e){return e?void("undefined"==typeof e.whenHandled&&(e.whenHandled=t)):!1})}function c(t,e){var n,i,o=Y.get(t),r=this;o.isKeyDown(K)&&t.move(0,-nt*e),o.isKeyDown(L)&&t.move(0,nt*e),o.isKeyDown(B)&&t.move(-nt*e,0),o.isKeyDown(O)&&t.move(nt*e,0),o.isKeyPressed(q)&&t.getEnergy()>0&&(n=Q.get(M),n.init(),i=t.getPos(),n.moveTo(i.x,i.y),n.forPlayer=t,n.onDeathOnce(function(){t.changeEnergy(1),t===S&&r.trigger("energy",t.getEnergy())}),N.add(n),t.changeEnergy(-1),t===S&&r.trigger("energy",t.getEnergy()))}function f(t,e){t.forEach(function(n){n.update(e),n.dead()&&(t.delete(n),Q.put(n))})}function h(){var t,e=this;et.length>=rt.length||(ot.length>et.length?t=ot[et.length]:(t=rt[ot.length](),ot.push(t)),et.push(t),z({spawnInfo:t,getEnemy:k.get,initEnemy:function(e){e.resetKeyframes(),e.moveTo(w.right,t.yPos),e.birth()},onCreated:function(t){$.put(t)},onEveryDead:function(){H+=10,e.trigger("score",H),h.call(e)}}))}function m(){v=W(b)}function d(){P(Y,function(t){t[1].reset()})}function p(){P(N,function(t){Q.put(t)}),N.clear(),v.reset(),P(et,function(t){P(t.timeouts,function(t){window.clearTimeout(t)}),t.timeouts.length=0,t.unsubs.forEach(function(t){t()}),t.unsubs.length=0}),et.length=0,P($,function(t){t.resetKeyframes(),k.put(t)}),$.clear(),b.moveTo(0,0),P(U,function(t){V.put(t),U.delete(t)}),s(function(t){t.moveTo(200,J/2),t.setEnergy(10)}),h.call(this),tt=0,s(function(t){var e=G.get(t);e.iterator=e.recording[Symbol.iterator]()}),d()}function y(){var t,e;S&&S.setColour("#0000bb"),t=E(),e=D("player-"+t.getId()+"-keys"),S=t,t.setEnergy(10),t.moveTo(200,J/2),V.put(t),G.set(S,{recording:e,iterator:e[Symbol.iterator]()}),Y.set(S,j()),this.trigger("energy",t.getEnergy()),this.trigger("lives",X-R),this.trigger("score",H)}function x(){p.call(this),y.call(this)}function g(t){l(),u(t),R++,R>X?console.log("game over"):x.call(this)}var b,v,w,S,P=t("../utils/for-of"),C=t("../random"),T=t("../mixins/updater"),k=t("../enemies"),M=t("../bullet"),E=t("../player"),A=t("../camera"),D=t("../recording"),I=t("object-assign"),_=t("../mixins/subscribable"),F=t("../cache-generator"),j=t("../input-generator"),W=t("../obstacle-generator"),z=t("../create-enemy-sequence"),B=37,K=38,O=39,L=40,q=32,H=0,X=4,R=0,N=new Set,U=F("players"),Y=new Map,Z=0,J=0,G=new Map,Q=F("bullets"),V=F("players:live"),$=F("enemies:live"),tt=0,et=[],nt=5,it=1e3/60,ot=[],rt=[function(){return{yPos:C.betweenInts(J/4,3*J/4),type:0,count:10,spawnSpeed:300,timeouts:[],unsubs:[]}},function(){return{yPos:C.betweenInts(J/4,3*J/4),type:1,count:15,spawnSpeed:100,timeouts:[],unsubs:[]}},function(){return{yPos:C.betweenInts(J/4,3*J/4),type:2,count:20,spawnSpeed:200,timeouts:[],unsubs:[]}}];e.exports=I({},_(),T,{init:function(t,e){tt=0,y.call(this),b=A(0,0,t,e),m(),w={top:b.getPos().y,right:b.getPos().x+b.getSize().width,bottom:b.getPos().y+b.getSize().height,left:b.getPos().x},Z=t,J=e,this.on("resize",b.setSize.bind(b)),document.addEventListener("keydown",i,!1),document.addEventListener("keyup",o,!1),p.call(this)},update:function(t){var e=this,n=t/it;tt+=t,u(tt),b.move(1,0),w={top:b.getPos().y,right:b.getPos().x+b.getSize().width,bottom:b.getPos().y+b.getSize().height,left:b.getPos().x},v.update(),f(N,n),r(function(e){function n(){return G.get(e).iterator.next(function(e){return e&&e.whenHandled>=tt-t&&e.whenHandled<tt})}var i,o=Y.get(e);for(i=n();i.value;){switch(i.value.type){case"keydown":o.handleKeyDown(i.value.keyCode);break;case"keyup":o.handleKeyUp(i.value.keyCode)}i=n()}}),s(function(t){c.call(e,t,n),P(v.live,function(e){var n=t.collidingWith(e,!0,!0);n&&t.move(-n.x,-n.y)})}),P($,function(n){n.updateKeyFrames(t),P(V,function(t){if(n.collidingWith(t)){if(t===S)return g.call(e,tt),!1;V.delete(t),U.put(t),n.die(),$.delete(n),k.put(n)}})}),P(N,function(t){P($,function(n){t.collidingWith(n)&&(t.die(),N.delete(t),Q.put(t),n.die(),$.delete(n),k.put(n),H++,e.trigger("score",H))})}),a()},render:function(t){b.setTransformations(t,!0),P(V,function(e){e.collidingWith(b,!1)&&e.render(t)}),P($,function(e){e.collidingWith(b,!1)&&e.render(t)}),P(v.live,function(e){e.collidingWith(b,!1)&&e.render(t)}),N.forEach(function(e){e.dead()||e.collidingWith(b,!1)&&e.render(t)}),b.resetTransformations(t)}})},{"../bullet":2,"../cache-generator":3,"../camera":4,"../create-enemy-sequence":6,"../enemies":7,"../input-generator":10,"../mixins/subscribable":31,"../mixins/updater":34,"../obstacle-generator":35,"../player":38,"../random":39,"../recording":40,"../utils/for-of":45,"object-assign":1}],43:[function(t,e,n){"use strict";var i=t("./mixins/font"),o=t("./mixins/movable"),r=t("./mixins/scalable"),s=t("./mixins/fillable"),a=t("./mixins/keyframed"),l=t("./mixins/colourable"),u=t("./mixins/renderable"),c=t("./mixins/transformer"),f=t("object-assign");new Path2D("M-10.5 -4.5 l20 4 l-20 4 l5 -4 l-5 -4");e.exports=function(){var t=f({},i,o,s,l,r,a,u,c);return t.moveTo(0,0),t.setColour("white"),t.setScale(1),t.setFont("Sans-Serif"),t.setFontSize("20pt"),t.setFontStyle("bold"),t.setText("[text here]"),t.setTextBaseline("bottom"),t.setTextAlign("left"),t}},{"./mixins/colourable":19,"./mixins/fillable":21,"./mixins/font":22,"./mixins/keyframed":24,"./mixins/movable":26,"./mixins/renderable":27,"./mixins/scalable":29,"./mixins/transformer":32,
"object-assign":1}],44:[function(t,e,n){"use strict";e.exports={every:function(t,e){var n=[];if(!Array.isArray(t))throw new Error("Must pass an array of Promise objects");t.forEach(function(i,o){i.then(function(i){var r;n[o]=i,r=n.reduce(function(t){return t+1},0),r===t.length&&e(n)})})},some:function(t,e){var n=!1;if(!Array.isArray(t))throw new Error("Must pass an array of Promise objects");t.forEach(function(t,i){t.then(function(t){n||(n=!0,e())})})}}},{}],45:[function(t,e,n){"use strict";e.exports=function(t,e){for(var n=t[Symbol.iterator](),i=n.next();!i.done;){if(e(i.value,t)===!1)return;i=n.next()}}},{}],46:[function(t,e,n){"use strict";e.exports=function(t,e,n){for(var i=0;i<t.length-1;i++)if(e(t[i],t[i+1])===!1)return;n&&t.length>1&&e(t[t.length-1],t[0])}},{}]},{},[17]);
