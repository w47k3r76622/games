window.app={isTouch:!1,menu:!0,seconds:0,gravity:.1,mouseShift:{h:0,v:0},isGameOver:!1,pause:!0,timeoutBtwLevels:3,backgroundLayouts:{front:[{position:"bottom",color:"black",pointsCount:15,height:100,shift:30,hOut:100,vOut:100,width:1920,dragging:70},{position:"top",color:"black",pointsCount:15,height:50,shift:30,hOut:100,vOut:100,width:1920,dragging:70}],back:[{position:"bottom",color:"#444444",pointsCount:20,height:120,shift:30,hOut:100,vOut:100,width:1920,dragging:70},{position:"top",color:"#444444",
    pointsCount:20,height:120,shift:30,hOut:100,vOut:100,width:1920,dragging:70}]},mouse:{isClicked:!1,x:0,y:0,lastX:0,lastY:0},settings:{size:{x:1280,y:800},hPadding:200,bottomLine:0},level:-1,levelIsCompleted:!0,progress:50,levels:[{maxFruits:3,fruits:["apple"],sub:.07,points:13},{maxFruits:3,fruits:["pear"],sub:.07,points:13},{maxFruits:3,fruits:["apple","pear"],sub:.07,points:13},{maxFruits:3,fruits:["pineapple"],sub:.07,points:13},{maxFruits:5,fruits:["strawberry"],sub:.07,points:13},{maxFruits:5,
    fruits:["pear","strawberry"],sub:.1,points:13},{maxFruits:5,fruits:["apple","pineapple"],sub:.1,points:13},{maxFruits:5,fruits:["pear","melon"],sub:.1,points:13},{maxFruits:5,fruits:["apple","strawberry"],sub:.1,points:13},{maxFruits:5,fruits:["apple","melon"],sub:.1,points:13}],fruitTypes:["apple","pear","pineapple","strawberry","melon"],fruits:{apple:[{color:"#004400",data:[[50,40],[35,35],[10,53],[25,90],[52,80],[67,87],[85,50],[65,33],[50,40],[46,10],[56,10],[50,40],[53,20],[69,12],[88,14],[70,
    23],[53,20],[47,25],[33,20],[25,24],[36,29],[47,25],[53,20]]},{color:"white",data:[[28,65],[37,63],[43,52],[30,48],[28,65]]}],pear:[{color:"#db9e36",data:[[40,20],[30,45],[10,53],[25,90],[65,87],[87,53],[67,40],[54,17],[40,20],[47,20],[40,5],[50,3],[47,20]]},{color:"white",data:[[28,60],[37,63],[41,51],[37,48],[28,60]]}],pineapple:[{color:"#af7f35",data:[[40,20],[25,30],[20,53],[15,58],[18,70],[25,80],[27,90],[33,90],[35,85],[60,95],[67,86],[75,83],[78,75],[78,53],[74,51],[74,40],[67,30],[54,17],
    [40,20],[40,20],[30,3],[37,8],[42,5],[47,12],[63,2],[70,2],[62,20],[40,20]]},{color:"white",data:[[40,35],[35,45],[43,47],[47,36],[40,35]]},{color:"white",data:[[35,65],[43,63],[41,53],[37,54],[35,65]]},{color:"white",data:[[35,75],[43,73],[41,67],[37,68],[35,75]]}],strawberry:[{color:"#770000",data:[[40,27],[10,45],[45,90],[55,87],[90,50],[70,25],[40,27],[45,27],[30,24],[18,5],[43,21],[59,8],[75,13],[57,27],[45,27]]},{color:"white",data:[[35,45],[33,50],[44,49],[42,44],[35,45]]}],melon:[{color:"#003300",
    data:[[40,27],[10,52],[33,90],[63,90],[69,85],[90,80],[90,45],[58,27],[40,27],[49,27],[58,19],[52,8],[47,10],[51,3],[55,3],[60,19],[53,27],[49,27]]},{color:"white",data:[[50,35],[40,37],[27,51],[40,80],[53,85],[45,67],[50,35]]},{color:"white",data:[[60,37],[70,50],[67,55],[80,53],[65,35],[60,37]]}]}};
function Fruit(){this.type="apple";this.side=0;this.isFull=this.isDead=this.isConnected=this.isTouched=!1;this.moveIndex=0;this.directTo={active:!1,x:0,y:0,fruit:!1};this.rotation=0;this.size={x:50,y:100,bound:75};this.origPosition={x:0,y:0};this.position={x:0,y:0};this.angle=0;this.direction={x:0,y:0}}
Fruit.prototype={update:function(){this.isFull?this.down():this.isConnected?this.moveTo():(this.angle+=this.rotation,this.isTouched||(this.direction.y-=app.gravity,this.origPosition.x+=this.direction.x,this.origPosition.y+=this.direction.y,this.origPosition.y<=app.settings.bottomLine&&(this.isDead=!0),this.preparePosition()))},preparePosition:function(){this.position.x=this.origPosition.x;this.position.y=app.settings.size.y-this.origPosition.y},moveTo:function(){this.directTo.active&&(this.moveIndex++,
    10<=this.moveIndex?(this.isDead=!0,app.fruitManager.collectFruit()):(this.origPosition.x+=this.direction.x,this.origPosition.y+=this.direction.y,this.preparePosition()))},down:function(){this.directTo.active&&(this.moveIndex++,100<=this.moveIndex?this.isDead=!0:(this.origPosition.x+=this.direction.x,this.origPosition.y+=this.direction.y,this.preparePosition()))}};
app.fruitManager=function(){var d,c=[],b,a,e=function(){var a,b=new Fruit;b.type=d.fruits[parseInt(Math.random()*d.fruits.length)];b.rotation=Math.random()/20-.025;b.side=parseInt(2*Math.random());b.origPosition.x=app.settings.hPadding+parseInt(Math.random()*(app.settings.size.x-2*app.settings.hPadding+1));b.origPosition.y=0;b.preparePosition();a=Math.random()/2-.25+Math.PI/2;b.direction.y=8+6*Math.random();b.direction.x=b.direction.y*Math.cos(a);c.push(b)},h=function(c){c!=b&&c.type==b.type&&!c.isFull&&
Math.sqrt(Math.pow(c.position.x-app.mouse.x,2)+Math.pow(c.position.y-app.mouse.y,2))<c.size.bound&&(a=c,a.isConnected=!0,a.side!=b.side&&(a.isDiffSide=!0),b.isConnected=!0,b.directTo.active=!0,b.directTo.x=a.position.x,b.directTo.y=a.position.y,b.direction.x=(a.origPosition.x-b.origPosition.x)/10,b.direction.y=(a.origPosition.y-b.origPosition.y)/10,f())},f=function(){b&&(b.isTouched=!1,b=void 0,app.lineManager.end())},k=function(a){var b;a.sort(function(a,b){return b-a});for(b=0;b<a.length;b++)c.splice(a[b],
    1);a.length=0};return{changeLevel:function(){d=app.levelManager.getCurrentLevelInfo();c.length=0},update:function(){var a,g=[];app.levelIsCompleted&&!c.length&&(app.pause=!0,window.setTimeout(function(){app.levelManager.nextLevel()},1E3*app.timeoutBtwLevels));for(a=0;a<c.length;a++)c[a].update(),b&&h(c[a]),c[a].isDead&&g.push(a);g.length&&k(g);app.levelIsCompleted||c.length<=d.maxFruits&&e()},getFruits:function(){return c},checkTouches:function(){var a;if(!app.levelIsCompleted)for(a=0;a<c.length;a++)if(!c[a].isFull&&
    Math.sqrt(Math.pow(c[a].position.x-app.mouse.x,2)+Math.pow(c[a].position.y-app.mouse.y,2))<c[a].size.bound)return c[a].isTouched=!0,b=c[a],app.lineManager.start(),!0},unTouch:f,collectFruit:function(){a.side=0;a.directTo.active=!0;a.directTo.x=a.position.x;a.directTo.y=0;a.direction.x=(a.directTo.x-a.origPosition.x)/100;a.direction.y=(a.directTo.y-a.origPosition.y)/100;a.isFull=!0;app.progressManager.addFruitPoints(a.isDiffSide?2*d.points:d.points);a=void 0}}}();
app.lineManager=function(){var d=[],c=!1;return{start:function(b,a){c=!0;d.push({x:b,y:a})},update:function(){c&&d.push({x:app.mouse.x,y:app.mouse.y})},end:function(){c=!1;d.length=0},getLines:function(){return d}}}();
app.progressManager=function(){var d=0,c=[[0,0],[70,40],[700,29],[1800,42],[1780,5],[1080,11],[0,0]];return{addFruitPoints:function(b){app.progress+=b;100<=app.progress&&(app.levelIsCompleted=!0);d=30},reset:function(){app.progress=50},update:function(b){app.levelIsCompleted||(app.progress-=app.levelManager.getCurrentLevelInfo().sub,0>=app.progress&&(app.pause=!0,app.isGameOver=!0,app.levelManager.restart(),app.menuManager.show()))},draw:function(){var b,a=70*app.mouseShift.h,e=30*app.mouseShift.v,
    h=app.settings.size.x/1920;app.context.save();app.context.translate((app.settings.size.x-1800*h)/2+a,app.settings.size.y-60+e);app.context.scale(h,1);app.context.beginPath();app.context.moveTo(c[0][0],c[0][1]);for(b=1;b<c.length;b++)app.context.lineTo(c[b][0],c[b][1]);0!=d&&(d-=.5,0>=d&&(d=0),app.context.shadowColor="#eeeeee",app.context.shadowBlur=d);app.context.fillStyle="#ffffff";app.context.fill();app.context.restore();app.context.save();app.context.translate((app.settings.size.x-1800*h)/2+a,
    app.settings.size.y-60+e);app.context.scale(h,1);app.context.beginPath();app.context.rect(0,0,app.progress/100*1800,45);app.context.clip();app.context.beginPath();app.context.moveTo(c[0][0],c[0][1]);for(b=1;b<c.length;b++)app.context.lineTo(c[b][0],c[b][1]);app.context.fillStyle="darkorange";app.context.fill();app.context.restore();-1!=app.level&&(app.context.font="30pt Terminal",app.context.textAlign="center",app.context.fillStyle="white",app.context.fillText("Level "+(app.level+1),app.settings.size.x/
    2-50+a,app.settings.size.y-80+e))}}}();
app.levelManager=function(){var d;return{nextLevel:function(){app.pause=!1;app.level++;app.levelIsCompleted=!1;app.progressManager.reset();var c=2+parseInt((app.level-10)/4),b=13+parseInt((app.level-10)/10),b=7>b?7:b;if(c>=app.fruitTypes.length)c=app.fruitTypes;else{for(var a=[],e=0,h;e<c;)h=app.fruitTypes[parseInt(Math.random()*app.fruitTypes.length)],-1==a.indexOf(h)&&(a.push(h),e++);c=a}d=app.level<app.levels.length?app.levels[app.level]:{maxFruits:5+parseInt((app.level-10)/3),fruits:c,sub:.1+
(app.level-10)/100,points:b};app.fruitManager.changeLevel()},getCurrentLevelInfo:function(){return d},restart:function(){app.level=-1}}}();
app.backgroundManager=function(){var d=[],c=[{type:"apple",x:20,y:40,color:"#e5e6d4",rotation:-.001,angle:0},{type:"pear",x:100,y:680,color:"#e5e6d4",rotation:.003,angle:0},{type:"strawberry",x:200,y:450,color:"#e5e6d4",rotation:5E-4,angle:1},{type:"melon",x:500,y:100,color:"#e5e6d4",rotation:-.002,angle:0},{type:"pineapple",x:700,y:700,color:"#e5e6d4",rotation:.0015,angle:0},{type:"apple",x:750,y:250,color:"#e5e6d4",rotation:-.004,angle:1},{type:"strawberry",x:1700,y:300,color:"#e5e6d4",rotation:.004,
    angle:1},{type:"melon",x:1100,y:500,color:"#e5e6d4",rotation:.001,angle:1},{type:"pineapple",x:1300,y:100,color:"#e5e6d4",rotation:-.001,angle:1},{type:"apple",x:1800,y:750,color:"#e5e6d4",rotation:-.002,angle:1},{type:"pear",x:1350,y:630,color:"#e5e6d4",rotation:-.0015,angle:1}],b=[[0,150],[100,130],[180,170],[330,160],[500,180],[730,120],[850,150],[1010,180],[1270,140],[1480,170],[1730,130],[1970,140],[2200,170]];return{update:function(){},drawFront:function(){var a,c=70*app.mouseShift.h-50,d=30*
    app.mouseShift.v-120;app.context.beginPath();app.context.moveTo(c,d);for(a=0;a<b.length;a++)app.context.lineTo(b[a][0]+c,b[a][1]+d);app.context.lineTo(b[b.length-1][0]+c,d);app.context.closePath();app.context.fillStyle="#000000";app.context.fill();app.context.strokeStyle="#000000";app.context.lineWidth=15;app.context.lineJoin="miter";app.context.stroke();c=70*app.mouseShift.h-50;d=30*app.mouseShift.v+20;app.context.beginPath();app.context.moveTo(c,app.settings.size.y+d);for(a=0;a<b.length;a++)app.context.lineTo(b[a][0]+
    c,app.settings.size.y-b[a][1]+d);app.context.lineTo(b[b.length-1][0]+c,app.settings.size.y+d);app.context.closePath();app.context.fillStyle="#000000";app.context.fill();app.context.strokeStyle="#000000";app.context.lineWidth=15;app.context.lineJoin="miter";app.context.stroke()},drawBack:function(){var a;for(a=0;a<c.length;a++){c[a].angle+=c[a].rotation;app.context.save();app.context.translate(c[a].x,c[a].y);app.context.rotate(c[a].angle);app.context.scale(2.5,2.5);for(var b=c[a].color,d=void 0,f=
    void 0,k=app.fruits[c[a].type],d=0;d<k.length;d++){app.context.beginPath();app.context.moveTo(k[d].data[0][0]-50,k[d].data[0][1]-50);for(f=1;f<k[d].data.length;f++)app.context.lineTo(k[d].data[f][0]-50,k[d].data[f][1]-50);app.context.fillStyle="white"==k[d].color?"#f5f6d4":b;app.context.fill()}app.context.restore()}},generateLayouts:function(){var a,c,b,f,k,l,g;for(a=0;a<app.backgroundLayouts.front.length;a++){g=app.backgroundLayouts.front[a];b={color:g.color,dragging:g.dragging,data:[]};l=(g.width+
    2*g.hOut)/g.pointsCount;f=-g.hOut;k=-g.vOut;b.data.push([f,k]);b.data.push([f,g.height+(g.shift-parseInt(2*Math.random()*g.shift))]);for(c=0;c<g.pointsCount;c++)f=f+l+(g.shift-parseInt(2*Math.random()*g.shift)),k=g.height+(g.shift-parseInt(2*Math.random()*g.shift)),b.data.push([f,k]);b.data.push([f,-g.vOut]);b.data.push([-g.hOut,-g.vOut]);d.push(b)}}}}();
window.app.presenter=function(){return{update:function(){app.context.fillStyle="#f5f6d4";app.context.fillRect(0,0,app.settings.size.x,app.settings.size.y);app.backgroundManager.drawBack();var d,c=app.lineManager.getLines();if(2<=c.length){app.context.save();app.context.beginPath();app.context.moveTo(c[0].x,c[0].y);for(d=1;d<c.length;d+=2)app.context.lineTo(c[d].x,c[d].y);app.context.strokeStyle="#330000";app.context.lineWidth=5;app.context.lineJoin="miter";app.context.stroke();app.context.restore()}c=
    app.fruitManager.getFruits();for(d=0;d<c.length;d++){app.context.save();app.context.translate(parseInt(c[d].position.x),parseInt(c[d].position.y));app.context.rotate(c[d].angle);app.context.scale(1.5,1.5);var b=c[d].size,a=c[d].isFull,e=void 0,h=void 0,f=void 0,k=void 0,l=app.fruits[c[d].type],k=b.y/2,f=0==c[d].side?b.x/2:b.x+b.x/2;app.context.save();app.context.beginPath();app.context.rect(-(b.x/2),-(b.y/2),a?2*b.x:b.x,b.y);app.context.clip();for(e=0;e<l.length;e++){app.context.beginPath();app.context.moveTo(l[e].data[0][0]-
    f,l[e].data[0][1]-k);for(h=1;h<l[e].data.length;h++)app.context.lineTo(l[e].data[h][0]-f,l[e].data[h][1]-k);app.context.fillStyle=l[e].color;a&&(app.context.shadowColor="#000000",app.context.shadowBlur=5);app.context.fill()}app.context.restore();app.context.restore()}app.backgroundManager.drawFront();app.progressManager.draw();app.menu&&app.menuManager.draw()}}}();
app.menuManager=function(){var d=!1,c=[[0,0],[40,300],[5,500],[600,490],[1E3,570],[920,-40],[0,0]],b=[[0,0],[0,60],[70,55],[200,65],[170,0],[120,6],[0,0]],a=[0,0];return{show:function(){app.menu=!0},draw:function(){var e,h,f;h=(app.settings.size.x-1E3)/2;f=(app.settings.size.y-500)/2-100;0>f&&(f=(app.settings.size.y-500)/2);app.context.save();app.context.translate(h,f);app.context.beginPath();app.context.moveTo(c[0][0],c[0][1]);for(e=1;e<c.length;e++)app.context.lineTo(c[e][0],c[e][1]);app.context.fillStyle=
    "#000000";app.context.fill();a[0]=h;a[1]=f;app.isGameOver?(app.context.font="48px Arial",app.context.textBaseline="middle",app.context.textAlign="center",app.context.fillStyle="darkorange",app.context.fillText("Fruit rev.",500,64),app.context.font="160px Arial",app.context.textBaseline="middle",app.context.textAlign="center",app.context.fillStyle="darkred",app.context.fillText("Game Over",500,250)):(app.context.font="48px Arial",app.context.textBaseline="middle",app.context.textAlign="center",app.context.fillStyle=
    "darkorange",app.context.fillText("Fruit rev.",500,40),app.context.font="20px Arial",app.context.textBaseline="middle",app.context.textAlign="center",app.context.fillStyle="#f5f6d4",app.context.fillText("Have you ever thought where are all those sliced fruits after playing the well known game?",500,120),app.context.fillText("Now you will see some of them and you will be able to reverse slicing. So just try it!",500,150),app.context.fillStyle="darkorange",app.context.fillText("How you should do that?",
    500,210),app.context.fillStyle="#f5f6d4",app.context.fillText("Just click on half of fruit and move it to another one of certain fruit. And that`s all.",500,240),app.context.fillText("If you connect different halves of fruit you will get twice points.",500,270),app.context.fillText("Don`t forget about progress bar at the bottom of the screen.",500,300),app.context.fillText("When it runs out you will lose, in another case you will play next level.",500,330),app.context.fillStyle="darkorange",app.context.fillText("Enjoy it!",
    500,390),app.context.font="12px Arial",app.context.fillStyle="darkyellow",app.context.fillText("developed by Viktor Uhryn special for js13kGames",160,480));a[0]+=750;a[1]+=400;app.context.save();app.context.translate(750,400);app.context.beginPath();app.context.moveTo(b[0][0],b[0][1]);for(e=1;e<b.length;e++)app.context.lineTo(b[e][0],b[e][1]);app.context.fillStyle=d?"#f5f6d4":"#ffffff";app.context.fill();app.context.font="48px Arial";app.context.textBaseline="middle";app.context.textAlign="center";
    app.context.fillStyle="#000000";app.context.fillText("Play",100,30);app.context.restore();app.context.restore()},checkClick:function(b){d&&(d=!1,app.menu=!1,app.levelManager.nextLevel());b&&a[0]<=app.mouse.x&&a[0]+200>=app.mouse.x&&a[1]<=app.mouse.y&&a[1]+60>=app.mouse.y&&(d=!1,app.menu=!1,app.levelManager.nextLevel())},checkMove:function(){d=a[0]<=app.mouse.x&&a[0]+200>=app.mouse.x&&a[1]<=app.mouse.y&&a[1]+60>=app.mouse.y}}}();
(function(){var d=document.getElementById("presenter"),c=(new Date).getTime(),b=function(){app.settings.size.x=window.innerWidth;app.settings.size.y=window.innerHeight;d.setAttribute("width",app.settings.size.x+"px");d.setAttribute("height",app.settings.size.y+"px")},a=function(){app.mouse.isClicked=!0;app.fruitManager.checkTouches();app.menu&&app.menuManager.checkClick()},e=function(a){app.mouse.x=a.pageX;app.mouse.y=a.pageY;app.menu&&app.menuManager.checkMove()},h=function(){app.mouse.isClicked=
    !1;app.fruitManager.unTouch()},f=function(a){a.preventDefault();app.mouse.x=a.touches[0].pageX;app.mouse.y=a.touches[0].pageY;app.mouse.isClicked=!0;app.fruitManager.checkTouches();app.menu&&app.menuManager.checkClick(!0)},k=function(a){app.mouse.x=a.touches[0].pageX;app.mouse.y=a.touches[0].pageY;app.menu&&app.menuManager.checkMove()},l=function(){app.mouse.isClicked=!1;app.fruitManager.unTouch()};b();app.isTouch="ontouchstart"in document;app.context=d.getContext("2d");app.menuManager.show();app.isTouch?
    (document.addEventListener("touchstart",f),document.addEventListener("touchmove",k),document.addEventListener("touchend",l)):(document.addEventListener("mousedown",a),document.addEventListener("mousemove",e),document.addEventListener("mouseup",h));window.addEventListener("resize",function(){b()});window.requestAnimationFrame(function m(){var a=(new Date).getTime()-c;app.isTouch||(app.mouseShift.h=.5-app.mouse.x/app.settings.size.x,app.mouseShift.v=.5-app.mouse.y/app.settings.size.y);app.pause?app.backgroundManager.update(a):
    (app.fruitManager.update(a),app.lineManager.update(a),app.backgroundManager.update(a),app.progressManager.update(a));app.presenter.update();window.requestAnimationFrame(m)})})();