(()=>{"use strict";var t={};t.t=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var s;t.t.i&&(s=t.t.location+"");var i=t.t.document;if(!s&&i&&(i.currentScript&&(s=i.currentScript.src),!s)){var h=i.getElementsByTagName("script");h.length&&(s=h[h.length-1].src)}if(!s)throw new Error("Automatic publicPath is not supported in this browser");s=s.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.h=s})();const s=400,i=function(){const t=2*Math.PI*1/s,i=[];let h=0;for(let s=0;s<200;s++)i.push(h),h+=t*(1-h)/1;return i}();function h(t,s){if(s<=t)return t;const h=s-t,e=i[Math.floor(h)],n=i[Math.ceil(h)];return(1-(e+(h-Math.floor(h))*(n-e)))*s}const e=200/Math.PI;function n(t){return t/e%(2*Math.PI)}function r(t,s){return Math.hypot(t.x-s.x,t.y-s.y)}function a(t,s={x:0,y:0}){const i=n(t.x),h=t.y;return{x:s.x+h*Math.sin(i),y:s.y-h*Math.cos(i)}}let o;class c{constructor(t){this.o={x:0,y:0},this.children=[],this.rotate=0,this.scale=1,this.zIndex=0,this.width=0,this.height=0,this.anchor=0,this.u=t}async l(t){this.v=await t}get _(){return this.scale*(this.parent?this.parent._:1)}M(t){let s;return s=t?function(t,s){const{x:i,y:h}=t,e=Math.sin(s),n=Math.cos(s);return{x:i*n-h*e,y:i*e+h*n}}(t={x:t.x*this.scale,y:t.y*this.scale},-this.rotate):{x:0,y:0},s={x:s.x+this.o.x,y:s.y+this.o.y},this.parent?this.parent.M(s):s}p(){return this.parent?.p()}m(t={x:0,y:0}){return function(t,s){const i=t.x-s.x,h=-(t.y-s.y);let n=Math.atan2(i,h),r=Math.sqrt(i**2+h**2);return{x:(a=n,a%(2*Math.PI)*e),y:r};var a}(this.o,t)}removeChild(t){this.children=this.children.filter((s=>s!==t))}g(t){this.children.push(t),t.parent&&t.parent!==this&&t.parent.removeChild(t),t.parent=this,o||(o=Promise.resolve().then((()=>{o=void 0,this.children.sort((t=>t.zIndex))})))}S(t){this.v&&this.width*this.height==0&&(this.width=this.v.width/16,this.height=this.v.height/16),t.save(),this.D(t),this.u&&this.u(t),this.children.forEach((s=>s.S(t))),t.restore()}D(t){t.translate(this.width*this.anchor,this.height*this.anchor),t.rotate(this.rotate),t.translate(-this.width*this.anchor,-this.height*this.anchor),t.translate(this.o.x,this.o.y),t.scale(this.scale,this.scale)}P(){this.parent=void 0,this.children.forEach((t=>t.P())),this.children.length=0,this.v=void 0,this.u=void 0}}class u{constructor(t){this.A=!1,this.T=!0,this.C={all:[]},this.I=+new Date,this.$={x:0,y:0},this.k=0,this.R=0,this.G=this.j(),this.L=t,this.L.F.add(this)}q(t=this.m){return this.L.O(t.x,t.y-1)}j(t){const s=new c((t=>{t.save(),t.fillStyle="red",t.rotate(n(this.m.x));const i=this.G.v;if(i){this.A&&t.scale(-1,1);const h=this.m.y/(this.L?.r||50);t.translate(0,this.G.height+this.G.height/12),t.scale(h,h),t.drawImage(i,-s.width/2,-s.height/2,s.width,s.height)}else t.fillRect(-1,-2,1,2);if(null!=this.U&&null!=this.Z){t.save(),t.translate(0,-s.height/2-.4);const i=Math.min(this.U/100,3);t.translate(-i/2,0),t.fillStyle="#ccc",t.fillRect(0,0,i,.1),t.fillStyle="#f33",t.fillRect(0,0,i*this.Z/this.U,.1),t.restore()}t.restore(),this.update()}));return t&&s.l(t),s.S=t=>{this.update(),s.v&&s.width*s.height==0&&(s.width=s.v.width/16,s.height=s.v.height/16),t.save();{t.translate(0,1);const i=n(this.$.x);t.rotate(i);const e=h(this.$.y,this.L.r);t.translate(0,-e),t.rotate(-i),t.scale(s.scale,s.scale),t.translate(0,-s.height),s.u&&s.u(t),s.children.forEach((s=>s.S(t)))}t.restore()},s}addListener(t,s){t in this.C||(this.C[t]=[]),this.C[t].push(s)}H(t){if(t.N in this.C)for(const s of this.C[t.N])s(t)}get m(){return this.$}set m(t){this.$=t,this.G.o=a({x:t.x,y:h(t.y,this.L.r)-1})}move(t,i,h=!1){const e=this.m;let n=0,r=e.x+t,a=e.y+i;for(;this.L.O(r,a);)if(this.R=0,t=v(t-d(t)/10,t/2),i=v(i-d(i)/10,i/2),r=e.x+t,a=e.y+i,n++>20)return;for(;!h&&this.L.W(this,{x:r,y:a});)if(t=v(t-d(t)/10,t/2),i=v(i-d(i)/10,i/2),r=e.x+t,a=e.y+i,n++>5)return;const o={x:r%s,y:a};i<0&&this.q(o)&&(o.y=Math.round(o.y),this.k=0),this.m=o}B(t){this.k>-4&&!this.q()&&(this.k=Math.max(this.k-.1*t,-4)),this.q()&&(this.R=.9*this.R)}P(){this.L.F.delete(this),console.log("DESTROY")}}class f{constructor(t,s,i){this.N=t,this.target=s,this.K=i}}class l{constructor(t){this.V=[],this.X=t}instantiate(t,...s){let i=this.Y();return i||(i=this.X(s),this.V.push(i)),t&&t(i),i}Y(){return this.V.filter((t=>!t.T)).pop()}}function d(t){return Math.abs(t)<1e-4?0:t<0?-1:1}function v(t,s){return Math.abs(t)>Math.abs(s)?t:s}class _ extends u{constructor(t,s,i,h,e){super(t),this.J=20,this.tt=50,this.speed=2,this.G=new c((t=>{t.save(),t.fillStyle="orange",t.rotate(n(this.m.x)),t.fillRect(-.4,-.2,.4,.2),t.restore(),this.update()})),this.st=0,this.m=s,this.A=e,this.tt=h,this.J=i}move(t){this.A&&(t=-t);const s=this.m;this.m={...s,x:s.x+t},this.st+=Math.abs(t)}it(t){t.Z-=this.J,this.H(new f("bulletGG",this)),t.Z<=0&&t.H(new f("zombieDie",t))}static reload(t,s,i,h){return e=>{e.T=!0,e.m=t,e.I=+new Date,e.A=h,e.J=s,e.tt=i,e.st=0}}update(t=(+new Date-this.I)/60){this.T&&(this.st>=this.tt&&this.H(new f("bulletGG",this)),this.I=+new Date,this.move(this.speed*t))}P(){this.L.removeChild(this.G),this.L.F.delete(this)}}class w extends l{constructor(t){super((([s,i,h,e])=>new _(t.L,s,i,h,e))),this.ht=300,this.et=0,this.nt=50,this.J=20,this.rt=t}ot(){const t=+new Date;if(+new Date-this.et<this.ht)return;let s;this.et=t,s=this.rt.A?this.rt.m.x-.5:this.rt.m.x+1;const i={x:s,y:this.rt.m.y-.15};let h=this.instantiate(_.reload(i,this.J,this.nt,this.rt.A),i,this.J,this.nt,this.rt.A);this.rt.L.g(h.G),this.rt.ct.push(h),h.addListener("bulletGG",(t=>{const s=t.target;s.T=!1,this.rt.ct=this.rt.ct.filter((t=>t!==s)),s.P()}))}}const M=t.h+"cabc688095b253169e07ff9dc9ae3d32.png",p=t.h+"382abc71d8e06697e8e4abd915b5f12c.png",m=new Image,y=new Promise(((t,s)=>{m.onload=()=>t(m),m.onerror=s}));m.src=M;const g=new Image,x=new Promise(((t,s)=>{g.onload=()=>t(g),g.onerror=s}));async function b(){const t=document.createElement("canvas"),s=t.getContext("2d"),i=await y;return t.width=32,t.height=32,s.drawImage(i,0,32,32,32,0,0,32,32),t}async function S(t,s,i,h){const e=document.createElement("canvas"),n=e.getContext("2d"),r=await x;return e.width=i,e.height=h,n.drawImage(r,t,s,i,h,0,0,i,h),e}g.src=p;const D=S(0,2,10,15),P=S(0,18,10,14);class A extends u{constructor(t){super(t),this.A=!1,this.U=100,this.Z=100,this.ut="none",this.ft=0,this.lt=!1,this.ct=[],this.dt=new w(this),this.L=t,this.G=this.j(D),t.g(this.G),t.vt(this),this.m={x:0,y:this.L.r+1}}_t(){return this.m}wt(){return 10}async l(t){this.G.v=await t}Mt(){return this.L.r/this.m.y}yt(){return this.G.M()}gt(){return n(this.m.x)}xt(t){this.R=function(t,s,i){return Math.min(Math.max(t,-.2),.2)}(this.R+t)}bt(){0===this.k&&(this.k=.4)}St(){this.q()&&(this.L.Dt(Math.round(this.m.x),this.m.y),this.move(0,1),this.k=.1)}update(t=(+new Date-this.I)/60){this.Pt(),this.B(t),this.At(t),this.I=+new Date,this.move(this.R,this.k,!0)}At(t){this.lt&&(this.q()?(this.ft+=t,this.ft>=1&&(this.ft=0,this.L.Tt(Math.round(this.m.x),this.m.y-1))):this.ft=0)}Pt(){"left"===this.ut&&(this.A=!0,this.xt(-.03)),"right"===this.ut&&(this.A=!1,this.xt(.03))}Et(t,s){this.Z=Math.max(0,this.Z-t);const i=d(this.m.x-s.x);this.R+=.2*i,0===this.Z&&this.H({N:"die"})}}function T(t){const s=s=>{"ArrowLeft"===s.key&&(t.ut="left"),"ArrowRight"===s.key&&(t.ut="right"),"ArrowDown"===s.key&&(t.lt=!0)," "===s.key&&t.St(),"ArrowUp"===s.key&&t.bt(),"c"===s.key&&t.dt.ot()};return document.addEventListener("keydown",s),document.addEventListener("keyup",(s=>{"ArrowLeft"!==s.key&&"ArrowRight"!==s.key||(t.ut="none"),"ArrowDown"===s.key&&(t.lt=!1)})),()=>{document.removeEventListener("keydown",s),document.removeEventListener("keyup",s)}}const E=["VERTEX_SHADER","FRAGMENT_SHADER"];function C(t,{type:s,Ct:i},h,e){let n;if("vertex"===s)n=t.VERTEX_SHADER;else{if("fragment"!==s)throw"*** Error: unknown shader type";n=t.FRAGMENT_SHADER}return function(t,s,i,h){const e=h||console.error,n=t.createShader(i);return t.shaderSource(n,s),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(e("*** Error compiling shader '"+n+"':"+t.getShaderInfoLog(n)+"\n"+s.split("\n").map(((t,s)=>`${s+1}: ${t}`)).join("\n")),t.deleteShader(n),null)}(t,i,h||n,e)}const I={It:(t,s)=>[2/t,0,0,0,-2/s,0,-1,1,1],$t:(t,s,i)=>$(t,I.It(s,i)),kt:(t,s)=>[1,0,0,0,1,0,t,s,1],translate:(t,s,i)=>$(t,I.kt(s,i)),rotation(t){var s=Math.cos(t),i=Math.sin(t);return[s,-i,0,i,s,0,0,0,1]},rotate:(t,s)=>$(t,I.rotation(s)),Rt:(t,s)=>[t,0,0,0,s,0,0,0,1],scale:(t,s,i)=>$(t,I.Rt(s,i))};function $(t,s){var i=t[0],h=t[1],e=t[2],n=t[3],r=t[4],a=t[5],o=t[6],c=t[7],u=t[8],f=s[0],l=s[1],d=s[2],v=s[3],_=s[4],w=s[5],M=s[6],p=s[7],m=s[8];return[f*i+l*n+d*o,f*h+l*r+d*c,f*e+l*a+d*u,v*i+_*n+w*o,v*h+_*r+w*c,v*e+_*a+w*u,M*i+p*n+m*o,M*h+p*r+m*c,M*e+p*a+m*u]}function*k(t,s,i){if(t>s){i=i??-1;for(let h=t;h>s;h+=i)yield h}else{i=i??1;for(let h=t;h<s;h+=i)yield h}}function R(t,s,i){var h=t.getContext("webgl");if(!h)throw new Error;var e=function(t,s,i,h,e){const n=[];for(let i=0;i<s.length;++i)n.push(C(t,s[i],t[E[i]],e));return function(t,s,i,h,e){const n=console.error,r=t.createProgram();return s.forEach((function(s){t.attachShader(r,s)})),i&&i.forEach((function(s,i){t.bindAttribLocation(r,i,s)})),t.linkProgram(r),t.getProgramParameter(r,t.LINK_STATUS)?r:(n("Error in program linking:"+t.getProgramInfoLog(r)),t.deleteProgram(r),null)}(t,n,void 0)}(h,[{type:"vertex",Ct:`\nattribute vec2 a_position;\n\nuniform mat3 u_matrix;\nuniform vec2 u_center;\nuniform float u_radius;\nuniform float u_scale;\n\nvarying vec4 v_color;\nfloat PI = 3.14159265358979323846264;\n\nvoid main() {\n  ${s}\n}\n    `},{type:"fragment",Ct:"\nprecision mediump float;\n\nvarying vec4 v_color;\n\nvoid main() {\n  gl_FragColor = v_color;\n}  \n"}]),n=h.getAttribLocation(e,"a_position"),r=h.getUniformLocation(e,"u_matrix");const a=h.getUniformLocation(e,"u_center"),o=h.getUniformLocation(e,"u_radius");var c=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,c);const u=function(t,s,i){const h=t/2,e=[];for(let i of k(0,2*Math.PI,.05)){const n=i+.05;for(let r of k(.2*h,h,5)){const h=r+10,a=t/2,o=s/2,c=a+r*Math.sin(i),u=o-r*Math.cos(i),f=a+h*Math.sin(i),l=o-h*Math.cos(i),d=a+r*Math.sin(n),v=o-r*Math.cos(n),_=a+h*Math.sin(n),w=o-h*Math.cos(n);e.push([c,u,f,l,d,v]),e.push([f,l,d,v,_,w])}}return e}(t.width,t.height);!function(t,s){t.bufferData(t.ARRAY_BUFFER,new Float32Array(Array.prototype.concat(...s)),t.STATIC_DRAW)}(h,u);var f=[0,0],l=[1,1];h.viewport(0,0,h.canvas.width,h.canvas.height),h.clear(h.COLOR_BUFFER_BIT),h.useProgram(e),h.enableVertexAttribArray(n),h.bindBuffer(h.ARRAY_BUFFER,c);var d=h.FLOAT,v=0;h.vertexAttribPointer(n,2,d,!1,0,v);var _=I.It(h.canvas.width,h.canvas.height);_=I.translate(_,f[0],f[1]),_=I.rotate(_,0),_=I.scale(_,l[0],l[1]),h.uniformMatrix3fv(r,!1,_),h.uniform2f(a,h.canvas.width/2,h.canvas.height/2),h.uniform1f(o,i);for(let t=0;t<u.length;){const s=Math.min(u.length-t,100);var w=h.TRIANGLES,M=(v=3*t,3*s);h.drawArrays(w,v,M),t+=s}}function G(t=600,s=document.createElement("canvas"),i=0){return s.width=t,s.height=t,function(t,s,i){R(t,`\n  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1);\n  float dist = distance(u_center, a_position); \n  float angle = atan(a_position.x - u_center.x, -a_position.y + u_center.y);\n  float angleMatch = max(1.0 - abs(( angle / (2.0 * PI) ) - (${i.toFixed(10)} / 2.0 * PI)) * 3.0, 0.0);\n  float f_0 = u_radius * 0.8;\n  float f_1 = u_radius - 15.0;\n  float f_2 = u_radius * 1.1;\n  float f_3 = f_2 * 1.1;\n  float f_4 = f_3 * 1.1;\n  float blue_opacity = 0.6;\n  vec4 v_0 = vec4(0, 0, 0, 0);\n  vec4 v_1 = vec4(angleMatch * 0.9, angleMatch * 0.9, angleMatch, 0.7);\n  vec4 v_2 = vec4(0.1 * angleMatch, 0.1 * angleMatch, 0.5 * angleMatch + 0.2, 0.5);\n  vec4 v_3 = vec4(0.0, 0, 0.3 * angleMatch + 0.05, 0.5);\n  vec4 v_4 = vec4(0, 0, 0, 0);\n  if (dist < f_0) {\n    v_color = vec4(0, 0, 0, 0);\n  } else if (dist < f_1) {\n    float rate = (dist - f_0) / (f_1 - f_0);\n    v_color = v_0 + (v_1 - v_0) * rate;\n  } else if (dist < f_2){\n    float rate = ( dist - f_1 ) / ( f_2 - f_1 );\n    rate = sqrt(rate);\n    v_color = v_1 + ( v_2 - v_1 ) * rate;\n  } else if (dist < f_3){\n    float rate = ( dist - f_2 ) / ( f_3 - f_2 );\n    v_color = v_2 + ( v_3 - v_2 ) * rate;\n  } else if (dist < f_4){\n    float rate = ( dist - f_3 ) / ( f_4 - f_3 );\n    v_color = v_3 + ( v_4 - v_3 ) * rate;\n  } else {\n    v_color = vec4(0, 0, 0, 0);\n  }\n  `,s)}(s,t/1.4/2,i),s}class j{constructor(t){this.Gt=1e3,this.L=t,this.canvas=G(Math.max(300,t.r*t._||0))}jt(){const t=this.L.r*this.L._*2*1.4;if(!(this.Gt&&t>this.Gt)&&t>1.1*this.canvas.width){const s=this.canvas.width;try{G(t,this.canvas)}catch(t){this.Gt=this.canvas.width,console.error(t),G(s,this.canvas)}}}S(t){const s=1.4*this.L.r;t.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,-s,-s,2*s,2*s)}}function L(t=600,s=document.createElement("canvas"),i=0){return s.width=t,s.height=t,function(t,s,i){R(t,`\n  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1);\n  float dist = distance(u_center, a_position); \n  float angle = atan(a_position.x - u_center.x, -a_position.y + u_center.y);\n  float angleMatch = max(1.0 - abs(( angle / (2.0 * PI) ) - (${i.toFixed(10)} / 2.0 * PI)) * 3.0, 0.0);\n  float f_0 = u_radius * 0.5;\n  float f_1 = u_radius - 10.0;\n  float f_2 = u_radius * 1.1;\n  float blue_opacity = 0.6;\n  vec4 v_0 = vec4(0, 0, 0, 1);\n  vec4 v_1 = vec4(0, 0, 0, 1.0 - angleMatch * 0.8);\n  vec4 v_2 = vec4(0, 0, 0, 0);\n  if (dist < f_0) {\n    v_color = v_0;\n  } else if (dist < f_1) {\n    float rate = (dist - f_0) / (f_1 - f_0);\n    v_color = v_0 + (v_1 - v_0) * rate;\n  } else if (dist < f_2){\n    float rate = ( dist - f_1 ) / ( f_2 - f_1 );\n    rate = sqrt(rate);\n    v_color = v_1 + ( v_2 - v_1 ) * rate;\n  } else {\n    v_color = vec4(0, 0, 0, 0);\n  }\n  `,s)}(s,t/1.4/2,i),s}class F{constructor(t){this.canvas=document.createElement("canvas"),this.Lt=[],this.Gt=1e3,this.L=t,this.Ft=L(Math.max(300,t.r*t._||0)),this.qt()}jt(){const t=this.L.r*this.L._*2*1.4;if(this.Gt&&t>this.Gt)return this.Ft.width!==this.Gt&&this.zt(this.Gt),void this.qt();t>1.1*this.Ft.width&&this.zt(t),this.qt()}zt(t){const s=this.Ft.width;try{L(t,this.Ft)}catch(t){this.Gt=this.Ft.width,console.error(t),L(s,this.Ft)}}Ot(){return this.L.r*this.L._*2*1.4/this.canvas.width}qt(){this.canvas.width=this.Ft.width,this.canvas.height=this.Ft.height,this.canvas.getContext("2d").drawImage(this.Ft,0,0);for(const t of this.Lt)this.clearShadow(t._t(),t.wt())}clearShadow(t,s){s*=this.L._/this.Ot();const i=a({x:t.x,y:h(t.y,this.L.r)*this.L._/this.Ot()},{x:this.canvas.width/2,y:this.canvas.height/2}),e=this.canvas.getContext("2d");e.save(),e.translate(i.x,i.y);const n=e.createRadialGradient(0,0,0,0,0,s);n.addColorStop(0,"rgba(255, 255, 255, 1)"),n.addColorStop(1,"rgba(255, 255, 255, 0)"),e.globalCompositeOperation="destination-out",e.fillStyle=n,e.fillRect(-s,-s,2*s,2*s),e.restore()}S(t){const s=1.4*this.L.r;t.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,-s,-s,2*s,2*s)}}class q{constructor(){this.canvas=document.createElement("canvas"),this.Ut=!1,this.Zt=this.canvas.getContext("2d"),this.Ht={width:0,height:0},this.Nt=1,this.rotate=0,this.scale=1}setScale(t){this.Nt=t,this.update()}Wt(t,s){this.Ht={width:t,height:s},this.update()}update(){const t=Math.min(this.Ht.width*this.Nt,2e3);if((s=t)>(i=this.canvas.width)&&([s,i]=[i,s]),0===s||i/s>1.1){const s=this.Ht.height/this.Ht.width;this.canvas.width=t,this.canvas.height=this.canvas.width*s,this.scale=this.canvas.width/(this.Ht.width*this.Nt),this.Bt()}var s,i}S(t,s){this.Ut||(this.Zt.resetTransform(),this.Zt.clearRect(0,0,this.canvas.width,this.canvas.height),this.Zt.translate(this.canvas.width/2,this.canvas.height/2),this.Zt.scale(this.scale,this.scale),s(this.Zt),this.Zt.resetTransform()),t.save(),t.rotate(this.rotate),t.drawImage(this.canvas,-this.Ht.width/2,-this.Ht.height/2,this.Ht.width,this.Ht.height),t.restore(),this.Ut=!0}Bt(){this.Ut=!1}}var z,O,U=function(t,s,i,h,e){if("m"===h)throw new TypeError("Private method is not writable");if("a"===h&&!e)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof s?t!==s||!e:!s.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===h?e.call(t,i):e?e.value=i:s.set(t,i),i},Z=function(t,s,i,h){if("a"===i&&!h)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof s?t!==s||!h:!s.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?h:"a"===i?h.call(t):h?h.value:s.get(t)};class H{constructor(t,s){z.set(this,!1),O.set(this,[]),this.width=t,this.r=s,this.data=new Uint8Array(t*(s+1)),this.data.fill(1)}random(){let t=this.r;for(let s=0;s<this.width;s++){t+=Math.round(2*Math.random())-1,t=Math.max(Math.min(t,this.r),this.r-20);for(let i=t;i<=this.r;i++)this.data[this.Kt(s,i)]=0}}Kt(t,s){return s*this.width+(t+this.width)%this.width}Vt(t,s){return t=Math.round(t),(s=Math.round(s))>this.r?{type:0}:{type:this.data[this.Kt(t,s)]}}Xt(t,s,i){this.data[this.Kt(t,s)]=i.type,U(this,z,!1,"f")}Yt(t,s){return Z(this,z,"f")||this.jt(),t=t<0?(Math.round(t)+this.width)%this.width:Math.round(t)%this.width,s-Z(this,O,"f")[t]}jt(){U(this,z,!0,"f"),Z(this,O,"f").length=0;for(let t=0;t<this.width;t++){let s=this.r;for(s=this.r;s>Math.floor(this.r*N)&&0===this.Vt(t,s).type;s--);Z(this,O,"f")[t]=s??0}}}z=new WeakMap,O=new WeakMap;const N=.4;class W extends c{constructor(t,i){super((t=>{})),this.Jt=1,this.cache=new q,this.Qt=new j(this),this.ts=new F(this),this.F=new Set,this.ss=t=>{const s=this._;t.save(),t.scale(s,s);let i=this.r,e=1/0;for(const r of this.hs(s)){if(0===r.type)continue;t.save(),t.rotate(n(r.x)-Math.PI/2);let a=this.es*r.y/this.r/s;a<.6&&(a=.6);const o=a/32;let c=h(r.y,this.r)-1;s<16&&(r.y>=e?c=i:(e=r.y,c=i-a,i=c)),t.translate(c-a/2,-a/2),t.scale(o,o),W.v?(t.translate(16,16),t.rotate(Math.PI/2),t.translate(-16,-16),W.ns&&r.rs?t.drawImage(W.ns,0,0):t.drawImage(W.v,0,0)):(t.fillStyle=`rgba(${Math.cos(r.x)*r.x*r.y*929%255}, ${r.y*r.y*263%255}, 0, 1)`,t.fillRect(0,0,32,32)),r.y<=this.os&&(t.fillStyle="rgba(0, 0, 0, 0.4)",t.fillRect(0,0,32,32)),t.restore()}t.beginPath(),t.fillStyle="black",t.closePath(),t.fill(),t.restore()},this.o=t,this.r=i,this.os=Math.floor(i*N),this.cs=new H(s,i),this.height=this.width=2*this.r,this.anchor=.5,this.jt(),b().then((t=>{W.v=t,this.cache.Bt()})),async function(){const t=document.createElement("canvas"),s=t.getContext("2d"),i=await y;return t.width=32,t.height=32,s.drawImage(i,0,0,32,32,0,0,32,32),t}().then((t=>{W.ns=t,this.cache.Bt()}))}vt(t){this.ts.Lt.push(t)}jt(){this.Qt.jt(),this.ts.jt(),this._>=16&&"large"!==this.us&&(this.us="large",this.cache.Bt()),this.cache.Wt(this.width+100,this.height+100),this.cache.setScale(this._),this.cache.rotate=this.rotate}S(t){t.save(),t.translate(this.o.x,this.o.y),this.jt(),this.Qt.S(t),this.cache.S(t,this.ss),this.ts.S(t),t.restore(),t.save(),this.D(t),this.children.forEach((s=>s.S(t))),t.restore()}get es(){return this._>16?this._:16}Yt(t,s){return this.cs.Yt(t,s)}O(t,s){const i=this.cs.Vt(t,s);return!!i&&1===i.type}W(t,s){for(const i of this.F)if(t!==i&&B(s,i))return!0;return!1}Dt(t,s){Math.round(s)<=this.os||(this.cs.Xt(t,s,{type:1}),this.cache.Bt())}Tt(t,s){Math.round(s)<=this.os||(this.cs.Xt(t,s,{type:0}),this.cache.Bt())}*hs(t=1){const i=Math.max(this.es/Math.max(t,1),1);for(let t=this.r;t>=0;t-=i)for(let h=0;h<s;h+=i){const s=this.cs.Vt(h,t),i=this.cs.Yt(h,t);yield{x:h,y:t,fs:i,type:s.type,rs:1===s.type&&0===this.cs.Vt(h,t+1).type}}}}function B(t,s){return Math.round(t.x)===Math.round(s.m.x)&&Math.round(t.y)===Math.round(s.m.y)}class K{constructor(t,s){this.rotate=0,this.scale=1,this.zoom=1,this.width=t,this.height=s,this.o={x:t/2,y:s/2}}focus(t){this.target=t}update(){var t,s,i;this.target&&(this.zoom=this.target.Mt&&this.target.Mt()||1,this.o=(t=this.target.yt(),s={x:this.width/2,y:this.height/2},i=this.scale*this.zoom,{x:s.x-(t.x-s.x)*i,y:s.y-(t.y-s.y)*i}),this.rotate=-this.target.gt())}S(t,s){this.update(),t.resetTransform(),t.translate(.5*this.width,.5*this.height),t.rotate(this.rotate),t.translate(.5*-this.width,.5*-this.height),t.translate(this.o.x,this.o.y),t.scale(this.scale*this.zoom,this.scale*this.zoom),t.translate(.5*-this.width,.5*-this.height),s(t)}}class V extends c{constructor(t){if(super(),this.canvas=t,this.Zt=t.getContext("2d"),this.ls=new K(t.width,t.height),!this.Zt)throw new Error}S(){this.Zt.resetTransform(),this.Zt.fillStyle="black",this.Zt.fillRect(0,0,this.canvas.width,this.canvas.height),this.ls.width=this.canvas.width,this.ls.height=this.canvas.height,this.ls.S(this.Zt,super.S.bind(this))}get ds(){return!0}get _(){return this.scale*this.ls.scale}p(){return this.ls}}class X extends l{constructor(t,s){super((([])=>new Y(t))),this.vs=20,this._s=[],this.ws=[],this.rt=t,this.L=s,setInterval((()=>{if(this._s=this._s.filter((t=>t.T)),this._s.length>=this.vs)return;const t=this.L.r+10,s=Math.round(100*Math.random())+this.rt.m.x-50;this.instantiate((i=>{i.m={x:s,y:t},i.Z=i.U,i.T=!0,this.L.g(i.G),this._s.push(i),i.addListener("zombieDie",(()=>{this.ws.forEach((t=>t()))}))}))}),3e3)}Ms(t){this.ws.push(t)}}class Y extends u{constructor(t){super(t.L),this.ht=2,this.ps=.03,this.U=50,this.Z=50,this.J=10,this.et=0,this.nt=1,this.ys=20,this.A=!0,this.gs=0,this.xs=3e3*Math.random()+2e3,this.bs=Date.now(),this.k=0,this.Ss=0,this.rt=t,this.L=t.L,this.G=this.j(P),this.addListener("zombieDie",(t=>{this.Ds()})),this.ps+=.02*Math.random()-.01}Ds(){this.T=!1,this.rt.L.removeChild(this.G),this.P()}bt(){this.q()&&Date.now()-this.bs>1e3&&(this.k=.1,this.bs=Date.now())}update(t=(+new Date-this.I)/60){if(!this.T)return;this.B(t),this.I=+new Date;for(const t of this.rt.ct)r(t.m,this.m)>1||(t.it(this),this.Z<=0&&this.Ds());if(!this.T)return;const s=+new Date;s-this.gs>this.xs&&(this.A=!this.A,this.gs=s,this.xs=3e3*Math.random()+2e3);const i=r(this.rt.m,this.m);if(i>this.ys)this.A?this.move(-this.ps,this.k):this.move(this.ps,this.k);else{const t=this.rt.m.x-this.m.x;(this.L.O(Math.round(this.m.x)+d(t),this.m.y)||this.L.W(this,{x:Math.round(this.m.x)+d(t),y:this.m.y}))&&this.bt(),this.A=t>0,this.move(this.ps*d(t),this.k),i<1.2&&this.Ps()}}Ps(){if(Date.now()-this.Ss<500)return;const t=d(this.rt.m.x-this.m.x);this.move(.1*t,0,!0),this.Ss=Date.now(),this.rt.Et(5,this.m)}}let J=parseInt(localStorage.getItem("bestScore")||"0");const Q=document.createElement("canvas");document.body.style.height="100vh",document.body.style.width="100vw",document.body.style.margin="0",Q.width=Math.max(document.body.clientWidth,400),Q.height=Math.max(document.body.clientHeight,400),new class{constructor(t){this.end=!1,this.As=0,this.Ts=[],this.Es=()=>{this.end&&this.Cs()},this.canvas=t;const s=new V(t);this.Is=s;const i=new W({x:0,y:0},50);this.L=i,i.cs.Xt(0,50,{type:1}),i.cs.random();const h=new A(i),e=new X(h,i);this.$s=e,e.Ms((()=>{this.As+=10})),s.ls.focus(h),s.g(i),this.rt=h,b().then((()=>{requestAnimationFrame((()=>{s.S()}))})),this.Ts.push(T(this.rt)),this.rt.addListener("die",(()=>{this.end=!0,J=parseInt(localStorage.getItem("bestScore")||"0"),this.As>J&&localStorage.setItem("bestScore",this.As.toString())})),document.addEventListener("keydown",this.Es)}ks(){const t=this.canvas.getContext("2d");t.resetTransform(),this.end?(t.fillStyle="rgba(0, 0, 0, 0.3)",t.fillRect(0,0,this.canvas.width,this.canvas.height),t.fillStyle="#fff",t.font="30px serif",t.fillText("Game Over",this.canvas.width/2-100,this.canvas.height/2),t.fillText(`Score: ${this.As}`,this.canvas.width/2-100,this.canvas.height/2+30),t.font="20px serif",t.fillText("Press Any Key To Restart",this.canvas.width/2-100,this.canvas.height/2+60)):(t.fillStyle="#fff",t.font="16px serif",t.fillText(`Score: ${this.As}`,12,20),t.fillText(`Best Score: ${J}`,12,40),t.fillStyle="rgba(255, 255, 255, 0.7)",t.fillText("Move ↑←→     Dig ↓     Pile Space      Attack c",this.canvas.width-320,this.canvas.height-20))}start(){this.As=0;const t=this.Is,s=this.ks.bind(this);this.Is.ls.scale=30,requestAnimationFrame((function i(){t.S(),s(),requestAnimationFrame(i)}))}Cs(){this.As=0,this.end=!1,this.Is.children.length=0,this.Ts.forEach((t=>t())),this.Ts=[];const t=this.Is,s=new W({x:0,y:0},50);this.L=s,s.cs.Xt(0,50,{type:1}),s.cs.random();const i=new A(s),h=new X(i,s);this.$s=h,h.Ms((()=>{this.As+=10})),t.ls.focus(i),t.g(s),this.rt=i,this.Ts.push(T(this.rt)),this.rt.addListener("die",(()=>{this.end=!0}))}}(Q).start(),document.body.appendChild(Q)})();