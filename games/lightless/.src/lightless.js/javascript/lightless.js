(function(){var t=[17,31],C=window.innerWidth,D=window.innerHeight,E=15E3,p=2,r=[1,1],v=42E4,y=36E5,w=0,F=(new Date).getTime(),u=[0,0],x=[0,0],z=["1111111111111111111111111111111100000000000000000000000000000111101110111110101010000101111011010021010g0101010001100000d101101110100010100010011001011010110000010100010011101001100001011010111011000001b001011111100011010000001011001110101000410101101110100101000011010101111010110101011010100002100000100001g1101010100001110101011111011110110001000100000000100000001200011610111011010011000111010111001101000000001001001001001000110110101111101101110110101111110011e100000000000000000000000000011111111111111111111111111111111",
"111111111111111111111111111111110000000000000000000000000000011011110100111101110111011101101101c0101101041010000100100010011011010010101100010000111011101100001001010000111110000000010110111101100001001000011011101011012000100010100000000101510101101011000111010101101110001010110101001000001010010000011101011000001101011101101011101200001101101100100100000100100110111110100g1001011010111011101000001100010111102001010000a101111001101110100001111011101110100000110000000000000000000000000000011111111111111111111111111111111",
"11111111111111111111111111111111000000000000000000000003000001101011111001110111010101111110110120010000151002001010000000011011101011110101111101001171101100000100000010100000100100010110111111101111010111110010101011010000000100001000000001400101100011000010000001111110111110110100111101111010100000000000011011110100001001g10010101010001100000011110001111101010101010110100101111010000010101110101011011010000001301000010000000101101001111101111111011101101110110000000000000000000000000000011111111111111111111111111111111",
"1111111111111111111111111111111111111000000000000000000000000111000101011101111011110110111011104010131010000000001010000001110001011101001011110101011110111181100000101f010000100000010110000000111101101011110111101011011101010000010101000000500101101000101101011000101110111000110101010010101001110100001001011010111101010110000010110000001100013000021000011100001011010110101011011101100000000000001011010000100000100111113101111101101111110110110110011110100100110000000000000000000000000000011111111111111111111111111111111",
"11111111111111111111111111111111000000000000000000000011111111101011111011001011110101000001110151000100111101031010101110111000000011113010101100010141011101111101000001010000101010101110100010101110101010010100010111010101000000000001101011111011101010111111011100100100000001110101000000100011111011111111111010111111010101010000000000121101000000101010100011011111010110101111110101011101100010101011010100000010100010110131000001101010111111011101001111101010110000000000000000000000000001011111111111111111111111111111111"],
J=[{time:1,message:"kh........"},{time:2,message:"khkhkhhhh........"},{time:4,message:"My head....."},{time:5,message:"What...what is?"},{time:7,message:"WowwW.........!! Where am I?!"},{time:9,message:"Any body is here?!....."},{time:11,message:"Why here is so dark?"},{time:13,message:"I`m feeling soo cold..."},{time:14,message:"Seems i`m under ground......"},{time:16,message:"It`s definitely not my house..."},{time:18,message:"Hm... as I remembered, I went to bad early yesterday..."},{time:20,message:"What`s happened?!....wars....."},
{time:22,message:"I don`t think so..."},{time:23,message:"Stop to talk to myself and let`s get out of here..."},{time:60,message:"It`s a very strange...Everything are strange here..."},{time:80,message:"Here is too dry air..."},{time:85,message:"Water...hm...that`s interested. Shall I find some water."},{time:100,message:"AAAaaaa...what`s about food?! I don`t want to die here..."},{time:102,message:"I really hope that someone help me to find out..."},{time:105,message:"...and show me right way..."},
{time:180,message:"How is there my little doggy..."},{time:186,message:"If he was here, he will help me to get out in a few minutes..."},{time:190,message:"I missed him..."},{time:250,message:"I never find out from this place...."},{time:252,message:"I`m really scared now..."},{time:390,message:"My footwear is wet...I`m cold..."},{time:420,message:"Did You hear it?! What is that?"},{time:430,message:"And now again..."},{time:500,message:"Stop!!! Seems I`m hearing some voice behind me..."},{time:503,
message:"I should to check it!"},{time:550,message:"Hm......"},{time:552,message:"Interesting......"},{time:555,message:"I`m listening music in my head..."},{time:560,message:"Do You know what`s that?"},{time:565,message:"It`s a band, called Queen"},{time:600,message:".................."},{time:650,message:"I cannot thinking anymore...."},{time:655,message:"I`m really tired...."},{time:660,message:"I want to go home to my bed...."},{time:670,message:"I want to sleep...."},{time:800,message:"Did I talk to You about my dog?"},
{time:810,message:"He is nice dog!"}],K={a:["Wow, I found a bottle. I think I could use it to get water...","Hm, I`ve never though that I`ll find a bottle here. It could be very useful...","What is that?! Something similar to bottle for water. It`s really useful..."],b:["Old warder...Interesting, who is owner...Seems it`s very old. But anyway it`s useful","Amazing...I`ve just found that what I need. Warder...","Warder...I could use it to prevent trap into sands..."],c:["I found rope! Seems it`s the most useful thing!!! Now I can to move up and down easier through the underground...",
"It`s a rope! It`s very useful for me! Now I`m feeling the sun under my head..."],d:["It`s a some strange moon-like thing... Seems it`s a key...So, somewhere should be a door..."],e:["It`s a triangle-like key! I must find a door, which I can open..."],f:["It`s a rectangle-like key! I hope it helps me to get out of here!"],g:["I`m feeling some strange on the wall. Perhaps it`s an old pictures or...texts...","Now my mind is a great!","I feel I can fly....fly...fly...."]},G={1:"Ah, it`s just a wall;It`s a cold stone wall;I`m not sure that I could do that...;Are you sure?;I want to do that, but...;I don`t know how...;I want to go home...;Do You think it`s possible?;It`s just a stone;Never mind...;..................".split(";"),
2:["Water!!!","I found water! I`m feeling better myself now...","It`s a water...How I was waiting it...","Water is great, lets try to find out...","That`s great that I found water. Here is too dry air..."],3:["AAAaaaaa...it`s a quicksand... I`m falling down...","Quicksand...I should find something to prevent falling down each time...I`m falling down..."],"3-alt":["Quicksand again...But now I have warder...","I don`t scare a quicksand now."],4:["I feel a hole on the ceiling...","What`s that...Up..Seems that`s a hole.",
"Lets try to use hole on the ceiling."],5:["I feel a hole on the ground...It`s a hole in the ground. I could try to go down...","Here is the hole on the ground. I could try to go down, but I should have a rope for that.","Nice hole in the ground. Is it useful?"],6:["I feel some strange stone, not like others. Seems it`s a door...Here is the moon-like hole...","Wow...Good news...It`s a door with moon-like hole.","I could use this door, but firstly I need a moon-like key..."],7:["I feel some strange stone, not like others. Seems it`s a door...Here is the triangle-like hole...",
"Wow...Good news...It`s a door with triangle-like hole.","I could use this door, but firstly I need a triangle-like key..."],8:["I feel some strange stone, not like others. Seems it`s a door...Here is the rectangle-like hole...","Wow...Good news...It`s a door with rectangle-like hole.","I could use this door, but firstly I need a rectangle-like key..."]},L={0:["Here is too hard air...Too hard to breathe...I must go up ASAP!"],1:["I`m feeling many water places here...I should to find couple..."],2:["Seems, I woke up here...I felt my self like now..."],
3:["I`m feel myself fine, but I don`t think that out is somewhere here"],4:["I like this place, nice air, easy to breathe :)"],5:["I`M FREE!!!!!!!!!!"]},H={drink:["I`m really want to drink...","I should to find water...","I cannot live without water...","I`ll die soon, if I don`t find water!"],eat:"I need to hurry up...;I cannot think normally without food. I should to go out...;Show me right way!;I feel that i`ll die soon, if I don`t find out...;I`m hearing something...I`m scared...;I`m not sure that it`s a safe placed.".split(";")},
M={drink:["I`m not sure that You can live without water...He couldn`t live...He`s died...","In next time, firstly need to find water...He`s dead..."],food:["He`s died without food...","Should to be faster... He`s dead...","No food, No Live... He`s dead..."]},e=function(){var b=t[0]*t[1],d={0:{name:"Empty space",handler:"emptySpace"},1:{name:"Stone wall",handler:"stoneWall",isWall:!0},2:{name:"Water",handler:"water",dependency:"a",isWater:!0},3:{name:"Sands",handler:"sands",dependency:"b"},4:{name:"Hole in the ceiling",
handler:"holeUp",dependency:"c",isHole:!0,level:1},5:{name:"Hole in the ground",handler:"holeDown",dependency:"c",isHole:!0,level:-1},6:{name:"Door ( moon )",handler:"door",dependency:"d",isDoor:!0},7:{name:"Door ( triangle )",handler:"door",dependency:"e",isDoor:!0},8:{name:"Door ( rectangle )",handler:"door",dependency:"f",isDoor:!0},a:{name:"Bottle",handler:"pickUp",isBottle:!0,isEmpty:!0,isItem:!0},b:{name:"Warder",handler:"pickUp",isItem:!0},c:{name:"Rope",handler:"pickUp",isItem:!0},d:{name:"Key ( moon )",
handler:"pickUp",isItem:!0},e:{name:"Key ( triangle )",handler:"pickUp",isItem:!0},f:{name:"Key ( rectangle )",handler:"pickUp",isItem:!0},g:{name:"Engraving",handler:"memoryUp",amount:7E3}};return{getPlace:function(a){var m=a[1]*t[1]+a[0];0>m||m>=b?a=!1:(a=z[p].substr(a[1]*t[1]+a[0],1),a=d[a]);return a},getKey:function(a){return z[p].substr(a[1]*t[1]+a[0],1)},setZero:function(a){a=a[1]*t[1]+a[0];z[p]=z[p].substring(0,a)+"0"+z[p].substring(a+1)},getPlaceByKey:function(a){return d[a]}}}(),l=function(){var b,
d=0,a,m=(new Date).getTime(),g=(new Date).getTime(),h=function(k,d){a=document.createElement("div");a.setAttribute("class","note "+d);a.innerHTML="string"===typeof k?k:k[parseInt(Math.random()*k.length)];b.appendChild(a)};return{initialize:function(){b=document.getElementById("notes-wrapper")},updateGeneralThoughts:function(a){parseInt(a/1E3)!=d&&(d=parseInt(a/1E3),J.forEach(function(a){a.time==d&&h(a.message,"undefined"!==typeof a.isSystem?"system-thought":"thought")}))},updateNeedsWater:function(){var a=
Math.random();7E3<=(new Date).getTime()-g&&(a<1-v/42E4&&h(H.drink,"system-thought"),g=(new Date).getTime())},updateNeedsEat:function(){var a=Math.random();2E4<=(new Date).getTime()-g&&(a<1-y/36E5&&h(H.eat,"system-thought"),g=(new Date).getTime())},showItem:function(a){h(K[a],"item")},showPlace:function(a,b){1E3<=(new Date).getTime()-m&&(b?h(G[a+"-alt"],"place"):h(G[a],"place"),m=(new Date).getTime())},showLevel:function(){h(L[p],"level")},showEnd:function(a){h(M[a],"dead")},showWin:function(a){h("YEAH!!!!!!!!!!!!!! I did it!!!!!!!",
"win");h("Time is: "+parseInt(a/6E4)+" min. "+parseInt((a-6E4*parseInt(a/6E4))/1E3)+" sec.","win");h("It`s a great Time!!!","win")}}}(),q=function(){var b=[];return{put:function(d){b.push(d);this.updateList()},check:function(d){var a=!1;b.forEach(function(b){b==d&&(a=!0)});return a},checkBottle:function(){var d=!1;b.forEach(function(a){a.isBottle&&(d=a)});return d},updateList:function(){var d=document.createDocumentFragment(),a;b.forEach(function(b,g){a=document.createElement("span");a.setAttribute("class",
"inventory-item");a.innerText=b.isBottle?(g?", ":"")+b.name+(b.isEmpty?" ( empty )":" ( full )"):(g?", ":"")+b.name;d.appendChild(a)});document.getElementById("inventory-list").innerHTML="";document.getElementById("inventory-list").appendChild(d)}}}(),A=function(){var b,d=[],a=[],m=1,g=0,h=0,k=0.001,l=function(){document.getElementById("game").width=C;document.getElementById("game").height=D},p=function(a,c){d.filter(function(b){b.x==a&&b.y==c&&(b.startTime=(new Date).getTime());return!1})},s=function(a,
c,n,d,f){b.lineCap="round";b.lineWidth=7;b.strokeStyle="rgba( 170, 170, 170, "+f+" )";b.moveTo(a,c);b.lineTo(n,d);b.stroke()},c=function(a,c,n,d,f){b.lineCap="square";b.lineWidth=1;b.strokeStyle="rgba( 130, 130, 130, "+f+" )";b.moveTo(a,c);b.lineTo(n,d);b.stroke()},f=function(a,d){var n,f,h,k,g=C/2-20-40*r[0]-d[0],e=D/2-20-40*r[1]-d[1],m=((new Date).getTime()-a.startTime)/a.liveTime;a.edges.forEach(function(d){"left"==d[0]&&(b.beginPath(),n=40*a.x+a.dieWay.translation*m,f=40*a.y,h=n,k=f+40,"wall"==
d[1]?c(g+n,e+f,g+h,e+k,1-m):s(g+n,e+f,g+h,e+k,1-m));"top"==d[0]&&(b.beginPath(),n=40*a.x,f=40*a.y+a.dieWay.translation*m,h=n+40,k=f,"wall"==d[1]?c(g+n,e+f,g+h,e+k,1-m):s(g+n,e+f,g+h,e+k,1-m));"right"==d[0]&&(b.beginPath(),n=40*a.x+40+a.dieWay.translation*m,f=40*a.y,h=n,k=f+40,"wall"==d[1]?c(g+n,e+f,g+h,e+k,1-m):s(g+n,e+f,g+h,e+k,1-m));"down"==d[0]&&(b.beginPath(),n=40*a.x,f=40*a.y+40+a.dieWay.translation*m,h=n+40,k=f,"wall"==d[1]?c(g+n,e+f,g+h,e+k,1-m):s(g+n,e+f,g+h,e+k,1-m))})},q=function(){var c=
(new Date).getTime();a.length=0;d=d.filter(function(f){var b=c-f.startTime>=f.liveTime;b||a.push(f.x+"-"+f.y);return!b})};return{initialize:function(){try{b=document.getElementById("game").getContext("2d"),l()}catch(a){}},addWall:function(c){var f,b;if(-1!=a.indexOf(c[0]+"-"+c[1]))return p(c[0],c[1]),!1;f={x:c[0],y:c[1],dieWay:{rotation:-1,translation:40*Math.random()-20},edges:[],startTime:(new Date).getTime(),liveTime:E};b=e.getPlace([c[0]-1,c[1]]);(b.isWall||b.isDoor)&&f.edges.push(["left",b.isWall?
"wall":"door"]);b=e.getPlace([c[0],c[1]-1]);(b.isWall||b.isDoor)&&f.edges.push(["top",b.isWall?"wall":"door"]);b=e.getPlace([c[0]+1,c[1]]);(b.isWall||b.isDoor)&&f.edges.push(["right",b.isWall?"wall":"door"]);b=e.getPlace([c[0],c[1]+1]);(b.isWall||b.isDoor)&&f.edges.push(["down",b.isWall?"wall":"door"]);d.push(f);a.push(c[0]+"-"+c[1])},clearWalls:function(){d.length=0;a.length=0},update:function(){var a=[40*u[0],40*u[1]];b.fillStyle="rgba( 0, 0, 0, "+m+" )";b.fillRect(0,0,C,D);g+=k;m=1-0.9*w;if(0<
k&&g>=h||0>k&&g<=h)h=0.03*(0>h?1:-1)*w,k=h/30;b.save();b.rotate(g);d.forEach(function(c){f(c,a)});b.restore();q()},updateCanvas:function(){l()}}}(),B=function(){var b,d,a=!1,m=!1,g={emptySpace:function(a){k(a)},stoneWall:function(a){},water:function(a,b){l.showPlace(e.getKey(a));I(b);k(a)},sands:function(a,b){l.showPlace(e.getKey(a));q.check(e.getPlaceByKey(b.dependency))||t(-1);k(a)},holeUp:function(a,b){l.showPlace(e.getKey(a));k(a);q.check(e.getPlaceByKey(b.dependency))&&s()},holeDown:function(a,
b){l.showPlace(e.getKey(a));k(a);q.check(e.getPlaceByKey(b.dependency))&&s()},door:function(a,b){l.showPlace(e.getKey(a));q.check(e.getPlaceByKey(b.dependency))&&k(a)},pickUp:function(a,b){l.showItem(e.getKey(a));k(a);q.put(b);e.setZero(a)},memoryUp:function(a,b){l.showItem(e.getKey(a));k(a);E+=b.amount;e.setZero(a)}},h=function(a){a=[r[0]+a[0],r[1]+a[1]];var b=e.getPlace(a);!1!==b&&g[b.handler].call(g,a,b)},k=function(a){document.getElementById("use-link").style.display="none";m=!0;F=(new Date).getTime();
x[0]=a[0];x[1]=a[1];u[0]=0;u[1]=0},t=function(c){A.clearWalls();p=0>p+c?0:p+c;5==p?(a=!0,l.showWin((new Date).getTime()-b)):h([0,0]);l.showLevel()},I=function(a){var b=q.checkBottle();a&&a.isWater?(v=42E4,b&&b.isEmpty&&(b.isEmpty=!1,q.updateList(),document.getElementById("drink-link").style.display="inline")):b&&!b.isEmpty&&(b.isEmpty=!0,q.updateList(),v=42E4,document.getElementById("drink-link").style.display="none")},s=function(){document.getElementById("use-link").style.display="inline"};return{start:function(){d=
b=(new Date).getTime();l.initialize();h([0,0]);A.initialize()},update:function(c){var f=(new Date).getTime()-d;a||(l.updateGeneralThoughts((new Date).getTime()-b),y-=f,w=Math.min(1,Math.max(w,1-y/36E5)),0>=y&&(a=!0,l.showEnd("food")),l.updateNeedsEat(),v-=f,w=Math.min(1,Math.max(w,1-v/42E4)),0>=v&&(a=!0,l.showEnd("drink")),l.updateNeedsWater(),A.update(),m?(c=((new Date).getTime()-F)/600,1>c?(u[0]=(x[0]-r[0])*c,u[1]=(x[1]-r[1])*c):(u[0]=0,u[1]=0,r[0]=x[0],r[1]=x[1],A.addWall(r),m=!1)):(c[0]||c[1])&&
h(c));d=(new Date).getTime()},use:function(){var a,b=e.getPlace(r);!1!==b&&b.isHole&&(a=e.getPlaceByKey(b.dependency),q.check(a)&&t(b.level))},drink:function(){I()},resize:function(){A.updateCanvas()}}}();(function(){var b=!1,d=!1,a=!1,e=!1,g=!1,h=0,k=0,l,p,s,c=[0,0],f=function(c){37==c.keyCode&&(b=!0);38==c.keyCode&&(d=!0);39==c.keyCode&&(a=!0);40==c.keyCode&&(e=!0)},q=function(c){37==c.keyCode&&(b=!1);38==c.keyCode&&(d=!1);39==c.keyCode&&(a=!1);40==c.keyCode&&(e=!1)},r=function(a){a.preventDefault();
B.use()},t=function(a){a.preventDefault();B.drink()},n=function(a){a.preventDefault();document.getElementsByClassName("welcome-screen")[0].style.display="none";B.start();window.setInterval(v,30)},u=function(){C=window.innerWidth;D=window.innerHeight;B.resize()},v=function(){c[0]=0;c[1]=0;b?c[0]=-1:d?c[1]=-1:a?c[0]=1:e&&(c[1]=1);B.update(c)},w=function(){var c=Math.sqrt(Math.pow(h,2)+Math.pow(k,2)),f=h,g=k,l;e=a=d=b=!1;30<c&&(l=Math.atan2(g,f),l<=Math.PI/4&&l>-Math.PI/4?a=!0:l<=-Math.PI/4&&l>-3*Math.PI/
4?d=!0:l<=-3*Math.PI/4||l>3*Math.PI/4?b=!0:l<=3*Math.PI/4&&l>Math.PI/4&&(e=!0));50<c&&(f=50*(f/c),g=50*(g/c));s.style.left=f+"px";s.style.top=g+"px"},x=function(a){a.preventDefault();g=!0;l=a.touches[0].pageX;p=a.touches[0].pageY},y=function(a){g&&(a.preventDefault(),h=a.touches[0].pageX-l,k=a.touches[0].pageY-p,w())},z=function(){g&&(k=h=p=l=0,e=a=d=b=g=!1,w())};window.addEventListener("load",function(){"ontouchstart"in document&&(document.body.setAttribute("class","touches"),s=document.getElementById("ui-touch-handler"),
s.addEventListener("touchstart",x,!1),document.addEventListener("touchmove",y,!1),document.addEventListener("touchend",z,!1));document.addEventListener("keydown",f,!1);document.addEventListener("keyup",q,!1);document.getElementById("use-link").addEventListener("click",r,!0);document.getElementById("drink-link").addEventListener("click",t,!0);document.getElementById("start-game-link").addEventListener("click",n,!1);window.addEventListener("resize",u)},!1)})()})();