function Player(t,i,e){var s=new Image;s.src="./assets/imgs/player.png",this.sprite=kontra.sprite({x:i,y:e,velocity:1,actualDirection:0,nextDirection:0,image:s,update:function(){kontra.keys.pressed("left")?this.nextDirection=directions.LEFT:kontra.keys.pressed("right")?this.nextDirection=directions.RIGHT:kontra.keys.pressed("up")?this.nextDirection=directions.UP:kontra.keys.pressed("down")&&(this.nextDirection=directions.DOWN);var i=t.getNextTile(this.x,this.y,this.nextDirection);if(t.isTileInsideMap(i)){var e;if(t.getLight(t.getCurrentTile(this.x,this.y)).isOn||(alert('You have died!\n\nTIP: "'+tips[Math.floor(Math.random()*tips.length)]+'"\n\nScore: '+score),window.location.reload()),0===this.actualDirection)e=t.getLight(t.getNextTile(this.x,this.y,this.nextDirection)),void 0!==e&&e.isOn&&(this.actualDirection=this.nextDirection);else if(this.nextDirection===this.actualDirection)e=t.getLight(t.getNextTile(this.x,this.y,this.nextDirection)),void 0!==e&&e.isOn||!isCentered(this.x,this.y)?this.nextDirection=this.actualDirection:this.actualDirection=0;else if(isCentered(this.x,this.y))if(e=t.getLight(t.getNextTile(this.x,this.y,this.nextDirection)),void 0!==e&&e.isOn)this.actualDirection=this.nextDirection;else{var s=t.getLight(t.getNextTile(this.x,this.y,this.actualDirection));void 0!==s&&s.isOn||(this.actualDirection=0)}}else(this.nextDirection===this.actualDirection&&isCentered(this.x,this.y)||0===this.x&&0===this.y&&isCentered(this.x,this.y)||315===this.x&&0===this.y||315===this.x&&165===this.y||0===this.x&&165===this.y)&&(this.actualDirection=0);switch(this.nextDirection=this.actualDirection,this.actualDirection){case directions.UP:this.y-=this.velocity;break;case directions.LEFT:this.x-=this.velocity;break;case directions.RIGHT:this.x+=this.velocity;break;case directions.DOWN:this.y+=this.velocity}}})}function Battery(t,i,e){var s=new Image;s.src="./assets/imgs/battery.png";var n=kontra.spriteSheet({image:s,frameWidth:6,frameHeight:12,animations:{green:{frames:1}}});this.isActive=!0,this.x=i+3,this.y=e,this.sprite=kontra.sprite({x:i+3,y:e,animations:n.animations,update:function(){}}),this.sprite.playAnimation("green")}function Light(t,i){var e=new Image;e.src="./assets/imgs/lights.png";var s=kontra.spriteSheet({image:e,frameWidth:12,frameHeight:12,animations:{shine:{frames:[1,2,3],frameRate:2,loop:!0},blink:{frames:[1,2,4,1,2,4,1,2,4,1,2,4,1,2,4,1,2,4,1,2,4,1,4],frameRate:3.5,loop:!1}}});this.x=t,this.y=i,this.isOn=!0,this.sprite=kontra.sprite({x:this.x,y:this.y,animations:s.animations}),this.sprite.playAnimation("shine"),Light.prototype.turnOff=function(){this.sprite.playAnimation("blink");var t=this;setTimeout(function(){t.isOn=!1},6500)}}function LightMap(t,i){for(this.mapOfLights=[],this.mapTemplate=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,1,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,1],[1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,0,1],[1,0,1,0,0,0,1,0,1,0,0,0,0,1,0,1,0,0,0,1,0,1],[1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,1,0,0,0,0,1,1,1,1,0,0,0,0,1,0,0,0,1],[1,0,0,0,1,1,1,1,0,1,0,0,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,0,0,1,1,1,0,0,1,0,1,0,1,0,0,0,0,1],[1,0,1,0,0,0,0,1,0,1,0,0,1,0,1,0,1,0,0,0,0,1],[1,0,1,1,1,1,1,1,1,1,0,0,1,0,1,1,1,1,1,1,1,1],[1,0,1,0,0,1,0,0,0,1,1,1,1,0,1,0,1,0,0,1,0,1],[1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,1]],this.corners=[{x:0,y:0},{x:0,y:11},{x:21,y:0},{x:21,y:11}],this.offCorners=[],row=0;row<t;row++){var e=[];for(col=0;col<i;col++)1===this.mapTemplate[row][col]?e[col]=new Light(col*lightSize,row*lightSize):e[col]=void 0;this.mapOfLights[row]=e}}function Enemy(t,i,e,s,n){var r=new Image;r.src="./assets/imgs/enemy.png";var h=kontra.spriteSheet({image:r,frameWidth:11,frameHeight:12,animations:{move:{frames:[1,2],frameRate:6}}});this.sprite=kontra.sprite({x:s,y:n,last_x:s,last_y:n,velocity:1,actualDirection:0,nextDirection:1,animations:h.animations,update:function(){if(this.animations.move.update(),getDistance(t.sprite.x,t.sprite.y,this.x,this.y)<=10&&(alert('You have died!\n\nTIP: "'+tips[Math.floor(Math.random()*tips.length)]+'"\n\nScore: '+score),window.location.reload()),e.isACrossroad(this.x,this.y)&&(t.sprite.x>this.x&&e.getNextTile(this.x,this.y,2)?this.nextDirection=2:t.sprite.x<=this.x&&e.getNextTile(this.x,this.y,4)&&(this.nextDirection=4),t.sprite.y>this.y&&e.getNextTile(this.x,this.y,3)?this.nextDirection=3:t.sprite.y<this.y&&e.getNextTile(this.x,this.y,1)&&(this.nextDirection=1),this.last_x===this.x&&this.last_y===this.y))for(this.actualDirection=this.nextDirection;this.actualDirection===this.nextDirection;)this.nextDirection=Math.floor(3*Math.random())+1;this.last_x=this.x,this.last_y=this.y;var i=e.getNextTile(this.x,this.y,this.nextDirection);if(e.isTileInsideMap(i)){var s;if(0===this.actualDirection)s=e.getLight(e.getNextTile(this.x,this.y,this.nextDirection)),void 0!==s&&(this.actualDirection=this.nextDirection);else if(this.nextDirection===this.actualDirection)s=e.getLight(e.getNextTile(this.x,this.y,this.nextDirection)),void 0===s&&isCentered(this.x,this.y)?this.actualDirection=0:this.nextDirection=this.actualDirection;else if(isCentered(this.x,this.y))if(s=e.getLight(e.getNextTile(this.x,this.y,this.nextDirection)),void 0===s){var n=e.getLight(e.getNextTile(this.x,this.y,this.actualDirection));void 0===n&&(this.actualDirection=0)}else this.actualDirection=this.nextDirection}else(this.nextDirection===this.actualDirection&&isCentered(this.x,this.y)||0===this.x&&0===this.y&&isCentered(this.x,this.y)||315===this.x&&0===this.y||315===this.x&&165===this.y||0===this.x&&165===this.y)&&(this.actualDirection=0);switch(this.nextDirection=this.actualDirection,0===this.nextDirection&&(this.nextDirection=Math.floor(3*Math.random())+1),this.actualDirection){case directions.UP:this.y-=this.velocity;break;case directions.LEFT:this.x-=this.velocity;break;case directions.RIGHT:this.x+=this.velocity;break;case directions.DOWN:this.y+=this.velocity}},render:function(t,i){this.animations.move.render({x:t,y:i})}})}kontra.init(),isCentered=function(t,i){var e=map.getCurrentTile(t,i);return t===e.x*lightSize&&i===e.y*lightSize},Battery.prototype.hide=function(){this.isActive=!1,this.sprite.playAnimation("off")},Battery.prototype.appear=function(t,i){var e=map.getLight(map.getCurrentTile(t,i));e.isOn&&(this.isActive=!0,this.sprite.x=t+3,this.sprite.y=i,this.sprite.playAnimation("green"))};const directions={STOP:0,UP:1,RIGHT:2,DOWN:3,LEFT:4};Array.prototype.remove=function(t,i){var e=this.slice((i||t)+1||this.length);return this.length=t<0?this.length+t:t,this.push.apply(this,e)},Array.prototype.inArray=function(t){for(var i=0;i<this.length;i++)if(t(this[i]))return!0;return!1},Array.prototype.pushIfNotExist=function(t,i){this.inArray(i)||this.push(t)};var lightSize=15;LightMap.prototype.turnOff=function(){var t=this.corners.shift();console.log("CORNERS: "+this.corners.length),console.log("   Acual corner: {"+t.x+","+t.y+"}");for(var i=1;i<=4;i++){var e=this.getLight(t);for(e.turnOff(),e=this.getLight(this.getNextTile(e.x,e.y,i));void 0!==e&&e.isOn&&!this.isACrossroad(e.x,e.y);)e.turnOff(e.x,e.y),e=this.getLight(this.getNextTile(e.x,e.y,i));void 0!==e&&e.isOn&&this.corners.pushIfNotExist({x:Math.floor(e.x/lightSize),y:Math.floor(e.y/lightSize)},function(t){return t.x===Math.floor(e.x/lightSize)&&t.y===Math.floor(e.y/lightSize)})}this.offCorners.unshift(t)},LightMap.prototype.turnOffRandomCorner=function(){this.corners.length>0&&this.turnOff()},LightMap.prototype.isACrossroad=function(t,i){if(void 0===this.getCurrentTile(t,i))return!1;for(var e=0,s=1;s<=4;s++)this.tileExists(this.getNextTile(t,i,s))&&e++;return e>=3},LightMap.prototype.tileExists=function(t){return!!this.isTileInsideMap(t)&&void 0!==this.getLight(t)},LightMap.prototype.getCurrentTile=function(t,i){return{x:Math.floor(t/lightSize),y:Math.floor(i/lightSize)}},LightMap.prototype.getNextTile=function(t,i,e){var s=this.getCurrentTile(t,i),n={x:s.x,y:s.y};switch(e){case directions.UP:n.y-=1;break;case directions.LEFT:n.x-=1;break;case directions.RIGHT:n.x+=1;break;case directions.DOWN:n.y+=1}return n},LightMap.prototype.isTileInsideMap=function(t){return t.y in this.mapOfLights&&t.x in this.mapOfLights[0]},LightMap.prototype.getLight=function(t){if(this.isTileInsideMap(t))return this.mapOfLights[t.y][t.x]},isCentered=function(t,i){var e=map.getCurrentTile(t,i);return t===e.x*lightSize&&i===e.y*lightSize},getDistance=function(t,i,e,s){var n=t-e,r=i-s;return Math.sqrt(n*n+r*r)};