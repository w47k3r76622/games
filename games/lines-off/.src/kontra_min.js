this.kontra={init:function(t){var i=this.canvas=document.getElementById(t)||t||document.querySelector("canvas");if(!this._isCanvas(i))throw Error("You must provide a canvas element for the game");this.context=i.getContext("2d")},_noop:new Function,_isString:function(t){return""+t===t},_isNumber:function(t){return+t===t},_isFunc:function(t){return"function"==typeof t},_isImage:function(t){return!!t&&"IMG"===t.nodeName||this._isCanvas(t)},_isCanvas:function(t){return!!t&&"CANVAS"===t.nodeName},_tick:new Function},function(t,i,e){t.gameLoop=function(n){function r(){if(o=i(r),s=e.now(),c=s-a,a=s,!(c>1e3)){for(t._tick(),f+=c;f>=u;)l.update(d),f-=u;m(),l.render()}}if(n=n||{},!t._isFunc(n.update)||!t._isFunc(n.render))throw Error("You must provide update() and render() functions");var a,o,s,c,h=n.fps||60,f=0,u=1e3/h,d=1/h,m=n.clearCanvas===!1?t._noop:function(){t.context.clearRect(0,0,t.canvas.width,t.canvas.height)},l={update:n.update,render:n.render,isStopped:!0,start:function(){a=e.now(),this.isStopped=!1,i(r)},stop:function(){this.isStopped=!0,cancelAnimationFrame(o)},_frame:r,set _last(t){a=t}};return l}}(kontra,requestAnimationFrame,performance),function(){function t(t){var i=a[t.which];r[i]=!0,n[i]&&n[i](t)}function i(t){var i=a[t.which];r[i]=!1}function e(t){r={}}for(var n={},r={},a={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",91:"leftwindow",92:"rightwindow",93:"select",144:"numlock",145:"scrolllock",106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},o=0;o<26;o++)a[65+o]=(10+o).toString(36);for(o=0;o<10;o++)a[48+o]=""+o,a[96+o]="numpad"+o;for(o=1;o<20;o++)a[111+o]="f"+o;var s=window.addEventListener;s("keydown",t),s("keyup",i),s("blur",e),kontra.keys={bind:function(t,i){t=Array.isArray(t)?t:[t];for(var e,r=0;e=t[r];r++)n[e]=i},unbind:function(t){t=Array.isArray(t)?t:[t];for(var i,e=0;i=t[e];e++)n[i]=null},pressed:function(t){return!!r[t]}}}(),function(t,i,e,n){t.vector=function(i,e){var n=Object.create(t.vector.prototype);return n._init(i,e),n},t.vector.prototype={_init:function(t,i){this._x=t||0,this._y=i||0},add:function(t,i){this._x+=(t.x||0)*(i||1),this._y+=(t.y||0)*(i||1)},clamp:function(t,i,r,a){this._clamp=!0,this._xMin=t!==n?t:-e,this._yMin=i!==n?i:-e,this._xMax=r!==n?r:e,this._yMax=a!==n?a:e},get x(){return this._x},get y(){return this._y},set x(t){this._x=this._clamp?i.min(i.max(this._xMin,t),this._xMax):t},set y(t){this._y=this._clamp?i.min(i.max(this._yMin,t),this._yMax):t}},t.sprite=function(i){var e=Object.create(t.sprite.prototype);return e.init(i),e},t.sprite.prototype={init:function(i){var e,n,r,a=this;i=i||{},a.position=a.position||t.vector(),a.velocity=a.velocity||t.vector(),a.acceleration=a.acceleration||t.vector(),a.position._init(i.x,i.y),a.velocity._init(i.dx,i.dy),a.acceleration._init(i.ddx,i.ddy),a.width=a.height=0;for(var o in i)a[o]=i[o];if(a.ttl=i.ttl||0,a.context=i.context||t.context,a.advance=a._advance,a.draw=a._draw,t._isImage(e=i.image))a.image=e,a.width=e.width,a.height=e.height,a.draw=a._drawImg;else if(e=i.animations){a.animations={};for(var s in e)n=e[s],a.animations[s]=n.clone?n.clone():n,r||(r=a.animations[s]);a.currentAnimation=r,a.width=r.width,a.height=r.height,a.advance=a._advanceAnim,a.draw=a._drawAnim}},get x(){return this.position.x},get y(){return this.position.y},get dx(){return this.velocity.x},get dy(){return this.velocity.y},get ddx(){return this.acceleration.x},get ddy(){return this.acceleration.y},set x(t){this.position.x=t},set y(t){this.position.y=t},set dx(t){this.velocity.x=t},set dy(t){this.velocity.y=t},set ddx(t){this.acceleration.x=t},set ddy(t){this.acceleration.y=t},isAlive:function(){return this.ttl>0},collidesWith:function(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y},update:function(t){this.advance(t)},render:function(){this.draw()},playAnimation:function(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()},_advance:function(t){this.velocity.add(this.acceleration,t),this.position.add(this.velocity,t),this.ttl--},_advanceAnim:function(t){this._advance(t),this.currentAnimation.update(t)},_draw:function(){this.context.fillStyle=this.color,this.context.fillRect(this.x,this.y,this.width,this.height)},_drawImg:function(){this.context.drawImage(this.image,this.x,this.y)},_drawAnim:function(){this.currentAnimation.render({context:this.context,x:this.x,y:this.y})}}}(kontra,Math,1/0),function(t,e){t.animation=function(i){var e=Object.create(t.animation.prototype);return e._init(i),e},t.animation.prototype={_init:function(t){t=t||{},this.spriteSheet=t.spriteSheet,this.frames=t.frames,this.frameRate=t.frameRate,this.loop=t.loop===e||t.loop;var i=t.spriteSheet.frame;this.width=i.width,this.height=i.height,this.margin=i.margin||0,this._frame=0,this._accum=0},clone:function(){return t.animation(this)},reset:function(){this._frame=0,this._accum=0},update:function(t){if(this.loop||this._frame!=this.frames.length-1)for(t=t||1/60,this._accum+=t;this._accum*this.frameRate>=1;)this._frame=++this._frame%this.frames.length,this._accum-=1/this.frameRate},render:function(i){i=i||{};var e=i.context||t.context,n=this.frames[this._frame]/this.spriteSheet.framesPerRow|0,r=this.frames[this._frame]%this.spriteSheet.framesPerRow|0;e.drawImage(this.spriteSheet.image,r*this.width+(2*r+1)*this.margin,n*this.height+(2*n+1)*this.margin,this.width,this.height,i.x,i.y,this.width,this.height)}},t.spriteSheet=function(i){var e=Object.create(t.spriteSheet.prototype);return e._init(i),e},t.spriteSheet.prototype={_init:function(i){if(i=i||{},!t._isImage(i.image))throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=i.image,this.frame={width:i.frameWidth,height:i.frameHeight,margin:i.frameMargin},this.framesPerRow=i.image.width/i.frameWidth|0,this.createAnimations(i.animations)},createAnimations:function(i){var n,r,a,o;for(var s in i){if(n=i[s],r=n.frames,a=n.frameRate,o=[],r===e)throw Error("Animation "+s+" must provide a frames property");Array.isArray(r)||(r=[r]);for(var c,h=0;c=r[h];h++)o.push.apply(o,this._parse(c));this.animations[s]=t.animation({spriteSheet:this,frames:o,frameRate:a,loop:n.loop})}},_parse:function(e){if(t._isNumber(e))return[e];var n=[],r=e.split(".."),a=i=+r[0],o=+r[1];if(a<o)for(;i<=o;i++)n.push(i);else for(;i>=o;i--)n.push(i);return n}}}(kontra),function(t,i,e){t.tileEngine=function(n){function r(t){var i,e;return"undefined"!=typeof t.x&&"undefined"!=typeof t.y?(i=j.getRow(t.y),e=j.getCol(t.x)):(i=t.row,e=t.col),i<0||e<0||i>=f||e>=h?-1:e+i*h}function a(t){for(var i,e,n=0,r=j.tilesets.length-1;n<=r;){if(i=(n+r)/2|0,e=j.tilesets[i],t>=e.firstGrid&&t<=e.lastGrid)return e;e.lastGrid<t?n=i+1:r=i-1}}function o(){for(var t,i,e,n,r,o,s,c,f,m,l=0;m=j.layers[b[l]];l++)for(var p=0,g=m.data.length;p<g;p++)t=m.data[p],t&&(i=a(t),e=i.image,n=p%h*u,r=(p/h|0)*d,c=t-i.firstGrid,f=e.width/u,o=c%f*u,s=(c/f|0)*d,w.drawImage(e,o,s,u,d,n,r,u,d))}if(n=n||{},!n.width||!n.height)throw Error("You must provide width and height properties");var s,c,h=n.width,f=n.height,u=n.tileWidth||n.tilewidth||32,d=n.tileHeight||n.tileheight||32,m=h*u,l=f*d,p=n.context||t.context,g=p.canvas.width,y=p.canvas.height,v=document.createElement("canvas"),w=v.getContext("2d"),x=i.max(0,m-g),_=i.max(0,l-y),b=[],j={width:h,height:f,tileWidth:u,tileHeight:d,mapWidth:m,mapHeight:l,context:p,x:n.x||0,y:n.y||0,tilesets:[],layers:{},addTilesets:function(i){e.isArray(i)||(i=[i]),i.forEach(function(i){var e,n,r,a,o,s=i.image;if(t._isImage(s))e=s;else if(t._isString(s))for(var c=1/0;c>=0;){c=s.lastIndexOf("/",c);var h=c<0?s:s.substr(c);if(t.assets.images[h]){e=t.assets.images[h];break}c--}if(!e)throw Error("You must provide an Image for the tileset");n=i.firstGrid,r=(e.width/u|0||1)*(e.height/d|0||1),n||(j.tilesets.length>0?(a=j.tilesets[j.tilesets.length-1],o=(a.image.width/u|0)*(a.image.height/d|0),n=a.firstGrid+o):n=1),j.tilesets.push({firstGrid:n,lastGrid:n+r-1,image:e}),j.tilesets.sort(function(t,i){return t.firstGrid-i.firstGrid})})},addLayers:function(t){e.isArray(t)||(t=[t]),t.forEach(function(t){t.render=void 0===t.render||t.render;var i,n,r,a,o,s;if(e.isArray(t.data[0]))for(i=[],n=0;r=t.data[n];n++)for(a=0;a<h;a++)i.push(r[a]||0);else i=t.data;j.layers[t.name]={data:i,zIndex:t.zIndex||0,render:t.render};for(o in t.properties){s=t.properties[o];try{s=JSON.parse(s)}catch(c){}j.layers[t.name][o]=s}j.layers[t.name].render&&(b.push(t.name),b.sort(function(t,i){return j.layers[t].zIndex-j.layers[i].zIndex}))}),o()},layerCollidesWith:function(t,i){for(var e,n=j.getRow(i.y),a=j.getCol(i.x),o=j.getRow(i.y+i.height),s=j.getCol(i.x+i.width),c=n;c<=o;c++)for(var h=a;h<=s;h++)if(e=r({row:c,col:h}),j.layers[t].data[e])return!0;return!1},tileAtLayer:function(t,i){var e=r(i);if(e>=0)return j.layers[t].data[e]},render:function(){j.context.drawImage(v,j.sx,j.sy,g,y,j.x,j.y,g,y)},renderLayer:function(t){for(var e,n,o,s,c,m,l,p,v,w=j.layers[t],x=j.getRow(),_=j.getCol(),b=r({row:x,col:_}),A=_*u-j.sx,O=x*d-j.sy,S=i.min(i.ceil(g/u)+1,h),I=i.min(i.ceil(y/d)+1,f),k=S*I,R=0;R<k;)o=w.data[b],o&&(s=a(o),c=s.image,e=A+R%S*u,n=O+(R/S|0)*d,m=o-s.firstGrid,l=c.width/u,p=m%l*u,v=(m/l|0)*d,j.context.drawImage(c,p,v,u,d,e,n,u,d)),++R%S===0?b=_+ ++x*h:b++},getRow:function(t){return t=t||0,(j.sy+t)/d|0},getCol:function(t){return t=t||0,(j.sx+t)/u|0},get sx(){return s},get sy(){return c},set sx(t){s=i.min(i.max(0,t),x)},set sy(t){c=i.min(i.max(0,t),_)},_layerOrder:b};j.sx=n.sx||0,j.sy=n.sy||0,v.width=m,v.height=l;for(var A in n.properties){var O=n.properties[A];try{O=JSON.parse(O)}catch(S){}j[A]=j[A]||O}return n.tilesets&&j.addTilesets(n.tilesets),n.layers&&j.addLayers(n.layers),j}}(kontra,Math,Array);