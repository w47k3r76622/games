var tips=["The less energy you have the faster the lines will turn off.","You can't turn on lights again. Keep the power above 50%.","The haunter is as fast as you, but probably more stupid.","Those things that look like radioactive coins will give you energy, pick them up.","The hunter is not afraid of dark...","Night is dark and full of terrors, you can't walk for there.","If something blinks, it's about to break.","He is better, be more intelligent"],canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d");canvas.width=330,canvas.height=192;var map=new LightMap(12,22),player=new Player(map,0,0),battery=new Battery(map,0,0),enemy=new Enemy(player,battery,map,canvas.width-22,0),enemy2=new Enemy(player,battery,map,0,canvas.height-22),score=-50,power=40,toTakeOffTimer=0,toTakeOffLimit=0;setInterval(function(){power>0&&(power-=1)},900);var onLights=[];for(row in map.mapOfLights)for(col in map.mapOfLights[row])if(1===map.mapTemplate[row][col]){var tile={x:col*lightSize,y:row*lightSize};map.isACrossroad(col*lightSize,row*lightSize)&&onLights.push(tile)}var loop=kontra.gameLoop({render:function(){map.mapOfLights.forEach(function(e){e.forEach(function(e){null!=e&&e.sprite.render({x:e.x,y:e.y})})}),battery.sprite.render(battery.x,battery.y),player.sprite.render(player.sprite.x,player.sprite.y),enemy.sprite.render(enemy.sprite.x,enemy.sprite.y),enemy2.sprite.render(enemy2.sprite.x,enemy2.sprite.y),ctx.font="9px Arial",ctx.fillStyle="white",ctx.textAlign="right",ctx.fillText("Score: "+score+"   Power: "+power+" %",canvas.width-6,canvas.height)},update:function(){if(player.sprite.update(),enemy.sprite.update(),enemy2.sprite.update(),map.mapOfLights.forEach(function(e){e.forEach(function(e){null!=e&&e.sprite.update()})}),battery.sprite.update(),toTakeOffLimit>0&&toTakeOffTimer>=toTakeOffLimit&&(toTakeOffTimer=0,map.turnOffRandomCorner()),toTakeOffTimer+=1,power<=4?toTakeOffLimit=240:power<=10?toTakeOffLimit=480:power<=25?toTakeOffLimit=600:power<=50?toTakeOffLimit=1200:(toTakeOffLimit=0,toTakeOffTimer=0),map.getLight(map.getCurrentTile(battery.sprite.x,battery.sprite.y)).isOn||battery.hide(),battery.isActive)player.sprite.collidesWith(battery.sprite)&&(power<95?power+=5:power=100,score+=50,battery.hide());else{var e=onLights[Math.floor(Math.random()*onLights.length)];battery.appear(e.x,e.y)}}});window.onload=function(){window.location.hash||(window.location=window.location+"#loaded",window.location.reload())},loop.start();