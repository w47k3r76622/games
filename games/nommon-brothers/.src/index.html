<!doctype html>
<html>
<head>
<title>js13k</title>
<style>*{margin:0;padding:0;box-sizing:border-box}body{font:16px verdana,sans-serif;background:#000;color:#fff;cursor:default;font-weight:700}.rematch,.title{position:absolute;font-size:32px}.container{display:block;margin-left:auto;margin-right:auto;width:720px;animation:fadein 2s;-moz-animation:fadein 2s;-webkit-animation:fadein 2s;-o-animation:fadein 2s}#title_canvas{width:720px;height:640px}#game_canvas{background-color:#000;animation:fadein 1s;-moz-animation:fadein 1s;-webkit-animation:fadein 1s;-o-animation:fadein 1s}.pink{background:#FFBADD}.blue{background:#01FFDF}.brown{background:#FFBA41}.yellow{color:#FFFF01}.red{background:red}.purple{color:#431359}.green{color:rgba(50,217,92,.5);margin-bottom:20px}.green:hover{color:#34DC5A;cursor:pointer}.darkPink,.text-line{color:#F23869}.orange{background:#FF5A35}.title{top:450px}.rematch{top:-130px;margin-left:145px;width:285px}.host{margin-left:245px;font-size:38px!important}.game_name{margin-top:20px;margin-left:90px}.waiting{margin-left:100px;text-align:center}.btn{position:absolute;top:110px}.reverseValue,.upgradeValue{position:relative;z-index:-1}.shadow{text-shadow:8px 8px 0 rgba(255,0,180,.5)}.confirm{left:110px}.cancel{left:330px}.text-line{background-color:transparent;outline:0;outline-offset:0;border-top:none;border-left:none;border-right:none;border-bottom:solid #FFFF01 1px;padding:3px 10px;font-size:18px}.wrap{height:100px;display:table;padding:10px;background:#000;width:40%}.wrap p{display:table-cell;vertical-align:middle;text-transform:uppercase;font-weight:700;font-size:18px}.small{width:80px;height:80px}.clear{clear:both}ul{list-style:none;cursor:pointer;margin-left:250px}.reverseShell,.reverseValue,.upgradeShell,.upgradeValue{box-sizing:border-box;margin:0}.upgradeShell{width:330px;height:32px;background:rgba(0,0,0,.5);border:1px solid}.upgradeValue{width:40%;height:30px;background:rgba(50,217,92,.5)}.reverseShell{width:330px;height:32px;background:rgba(0,0,0,.5);border:1px solid}.reverseValue{width:40%;height:30px;background:rgba(255,255,255,.5)}.frame,.game_border{-webkit-box-sizing:border-box;-moz-box-sizing:border-box}.barText{float:left;margin:5px 0 0 20px}.upgrade{float:left;margin:0 0 15px}.reverse{float:right}.blink_me{-webkit-animation-name:blinker;-webkit-animation-duration:1.5s;-webkit-animation-timing-function:linear;-webkit-animation-iteration-count:infinite;-moz-animation-name:blinker;-moz-animation-duration:1.5s;-moz-animation-timing-function:linear;-moz-animation-iteration-count:infinite;animation-name:blinker;animation-duration:1.5s;animation-timing-function:linear;animation-iteration-count:infinite}@-moz-keyframes blinker{100%,15%{opacity:1}50%{opacity:.2}}@-webkit-keyframes blinker{100%,15%{opacity:1}50%{opacity:.2}}@keyframes blinker{100%,15%{opacity:1}50%{opacity:.2}}.frame{color:#431359;-webkit-animation:changes 5s infinite;-moz-animation:changes 5s forwords infinite}@-webkit-keyframes changes{10%,80%{color:#431359}20%{color:#32D95C}40%{color:#F23869}60%{color:#FF5A35}80%{color:#ECF230}}@-moz-keyframes changes{10%,90%{color:#431359}20%{color:#32D95C}40%{color:#FA6D13}60%{color:#FF5A35}80%{color:#ECF230}}.game_border{border:2px solid #431359;-webkit-animation:cycle 20s infinite;-moz-animation:cycle 20s forwords infinite}@-webkit-keyframes cycle{10%,80%{border:2px solid #431359}20%{border:2px solid #32D95C}40%{border:2px solid #F23869}60%{border:2px solid #FF5A35}80%{border:2px solid #ECF230}}@-moz-keyframes cycle{10%,90%{border:2px solid #431359}20%{border:2px solid #32D95C}40%{border:2px solid #FA6D13}60%{border:2px solid #FF5A35}80%{border:2px solid #ECF230}}@keyframes fadein{from{opacity:0}to{opacity:1}}@-moz-keyframes fadein{from{opacity:0}to{opacity:1}}@-webkit-keyframes fadein{from{opacity:0}to{opacity:1}}@-o-keyframes fadein{from{opacity:0}to{opacity:1}}</style>
<script type=text/javascript>Game={config:{canvas_id:"game_canvas",fps_counter_id:"fps_counter",fps:60}};</script>
</head>
<body><div class=container><div id=title width=720 height=640><canvas id=title_canvas width=720 height=640></canvas></div><div class="title host blink_me"><div id=host_game class="green shadow">HOST GAME</div><div id=join_game class="green shadow">JOIN GAME</div></div><div id=enter_game_name_overlay class="title yellow game_name frame">ENTER GAME NAME: <input class="text-line input" id=input_game_name name=game_name><div id=enter_game_name_overlay_cancel class="cancel green btn shadow">Cancel</div><div id=enter_game_name_overlay_confirm class="confirm green btn shadow">Confirm</div></div><div id=waiting_for_opponent class="title waiting darkPink">Waiting For Opponent...<div id=waiting_overlay_cancel class="cancel btn green shadow">Cancel</div></div><div id=games_to_join class="title waiting frame"><p id=no_games style=font-size:20px>No Games Hosted. Please wait, or host your own.</p><div id=games_to_join_cancel class="cancel btn green shadow">Cancel</div><ul id=list_of_games></ul></div><div id=rematch class="title waiting frame"><div id=game_results class=rematch></div><div id=rematch_cancel class="cancel btn green shadow">Cancel</div><div id=rematch_confirm class="confirm btn green shadow">Confirm</div></div><div id=HUD><center><div style="margin:10px 0 -40px" id=game_time class=frame>2:00:00</div></center><div id=score class=wrap style=float:left><p class=frame id=player_lv>lv 3</p><img id=player_nom style=margin-top:10px class="small"> <img id=player_mon class="small"><p id=player_score class=yellow>Score: 75</p></div><div id=opponent class=wrap style=float:right><p class=frame id=opponent_lv>lv 2</p><img id=opponent_nom class="small"> <img id=opponent_mon class="small"><p id=opponent_score class=darkPink>Opponent: 67</p></div><div class=clear><div class=upgrade><div id=upgrade_bar_back class="yellow upgradeShell"><span class="barText yellow">[U]PGRADE &nbsp;<p style=float:right id=upgrade_text>15/40</p></span><div id=upgrade_bar_fill class="blue upgradeValue"></div></div></div><div class=reverse><div id=reverse_bar_back class="darkPink reverseShell"><span class="barText darkPink">[R]EVERSE &nbsp;<p style=float:right id=reverse_text></p></span> <span><div id=reverse_bar_fill class="red reverseValue"></div></span></div></div></div><canvas id=game_canvas class=game_border width=720 height=640></canvas></div><script src=/socket.io/socket.io.js></script><script>function reverse_avatars(){Game.paused=!0,setTimeout(function(){var e=player.avatar;player.avatar=opponent.avatar,opponent.avatar=e,nom_icon_show=!(mon_icon_show=nom_icon_show),document.getElementById("player_nom").style.display=nom_icon_show?"block":"none",document.getElementById("player_mon").style.display=mon_icon_show?"block":"none",document.getElementById("opponent_nom").style.display=nom_icon_show?"none":"block",document.getElementById("opponent_mon").style.display=mon_icon_show?"none":"block"},500),setTimeout(function(){Game.paused=!1},1e3)}function add_to_reverse_meter(){Game.paused||(reverse_meter++,player.score-player.old_score<opponent.score-opponent.old_score&&reverse_meter++,player.old_score=player.score,opponent.old_score=opponent.score,reverse_meter>REVERSE_MAX&&(reverse_meter=REVERSE_MAX))}function SfxrParams(){this.setSettings=function(e){for(var t=0;24>t;t++)this[String.fromCharCode(97+t)]=e[t]||0;this.c<.01&&(this.c=.01);var a=this.b+this.c+this.e;if(.18>a){var n=.18/a;this.b*=n,this.c*=n,this.e*=n}}}function SfxrSynth(){this._params=new SfxrParams;var e,t,a,n,i,r,s,o,l,c,m,p;this.reset=function(){var e=this._params;n=100/(e.f*e.f+.001),i=100/(e.g*e.g+.001),r=1-e.h*e.h*e.h*.01,s=-e.i*e.i*e.i*1e-6,e.a||(m=.5-e.n/2,p=5e-5*-e.o),o=1+e.l*e.l*(e.l>0?-.9:10),l=0,c=1==e.m?0:(1-e.m)*(1-e.m)*2e4+32},this.totalReset=function(){this.reset();var n=this._params;return e=n.b*n.b*1e5,t=n.c*n.c*1e5,a=n.e*n.e*1e5+12,3*((e+t+a)/3|0)},this.synthWave=function(_,d){var h=this._params,y=1!=h.s||h.v,u=h.v*h.v*.1,v=1+3e-4*h.w,g=h.s*h.s*h.s*.1,f=1+1e-4*h.t,b=1!=h.s,E=h.x*h.x,w=h.g,x=h.q||h.r,I=h.r*h.r*h.r*.2,R=h.q*h.q*(h.q<0?-1020:1020),k=h.p?((1-h.p)*(1-h.p)*2e4|0)+32:0,M=h.d,A=h.j/2,T=h.k*h.k*.01,B=h.a,L=e,O=1/e,H=1/t,N=1/a,U=5/(1+h.u*h.u*20)*(.01+g);U>.8&&(U=.8),U=1-U;for(var F,C,G,S,D,j,z=!1,W=0,P=0,q=0,X=0,V=0,Y=0,J=0,K=0,Q=0,Z=0,$=new Array(1024),et=new Array(32),tt=$.length;tt--;)$[tt]=0;for(var tt=et.length;tt--;)et[tt]=2*Math.random()-1;for(var tt=0;d>tt;tt++){if(z)return tt;if(k&&++Q>=k&&(Q=0,this.reset()),c&&++l>=c&&(c=0,n*=o),r+=s,n*=r,n>i&&(n=i,w>0&&(z=!0)),C=n,A>0&&(Z+=T,C*=1+Math.sin(Z)*A),C|=0,8>C&&(C=8),B||(m+=p,0>m?m=0:m>.5&&(m=.5)),++P>L)switch(P=0,++W){case 1:L=t;break;case 2:L=a}switch(W){case 0:q=P*O;break;case 1:q=1+2*(1-P*H)*M;break;case 2:q=1-P*N;break;case 3:q=0,z=!0}x&&(R+=I,G=0|R,0>G?G=-G:G>1023&&(G=1023)),y&&v&&(u*=v,1e-5>u?u=1e-5:u>.1&&(u=.1)),j=0;for(var at=8;at--;){if(J++,J>=C&&(J%=C,3==B))for(var nt=et.length;nt--;)et[nt]=2*Math.random()-1;switch(B){case 0:D=m>J/C?.5:-.5;break;case 1:D=1-J/C*2;break;case 2:S=J/C,S=6.28318531*(S>.5?S-1:S),D=1.27323954*S+.405284735*S*S*(0>S?1:-1),D=.225*((0>D?-1:1)*D*D-D)+D;break;case 3:D=et[Math.abs(32*J/C|0)]}y&&(F=Y,g*=f,0>g?g=0:g>.1&&(g=.1),b?(V+=(D-Y)*g,V*=U):(Y=D,V=0),Y+=V,X+=Y-F,X*=1-u,D=X),x&&($[K%1024]=D,D+=$[(K-G+1024)%1024],K++),j+=D}j*=.125*q*E,_[tt]=j>=1?32767:-1>=j?-32768:32767*j|0}return d}}var utils,sc,nm,ga,graphics,sm,input,player,opponent,nom_icon_show,mon_icon_show,game_name,game_minutes,game_seconds,game_centa_seconds,is_host,reverse_meter=0,rolling_niblit_id=1,niblits_eaten=[],host_interval,spawn_interval,reverse_meter_interval,SCREEN_WIDTH=720,SCREEN_HEIGHT=640;ARENA_WIDTH=1200,ARENA_HEIGHT=1200,MAX_NIBLITS=200,REVERSE_MAX=100,DOMURL=window.URL||window.webkitURL||window,ART_COMMON='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.0" x="0px" y="0px" viewBox="0 0 150 150" enable-background="new 0 0 150 150" xml:space="preserve">',ART={nomHead:ART_COMMON+'<g><circle fill="#32D95C" cx="74" cy="75" r="71"/></g><circle fill="#ECF230" cx="74" cy="50" r="22"/><circle cx="74" cy="49" r="10"/></svg>',monHead:ART_COMMON+'<g><circle fill="#FF5A35" cx="72" cy="75" r="67"/></g><circle fill="#ECF230" cx="38" cy="50" r="12"/><circle fill="#ECF230" cx="73" cy="47" r="13"/><circle fill="#ECF230" cx="108" cy="50" r="13"/><circle cx="38" cy="50" r="5"/><circle cx="73" cy="47" r="5"/><circle cx="108" cy="50" r="5"/></svg>',nomMouth:ART_COMMON+'<ellipse cx="74" cy="108" rx="22" ry="22"/><path fill="#FFFFFF" d="M68.4 129.7l5.8-14.8l9.2 13.8C83.5 128 74 132 68 129.7z"/></svg>',monMouth:ART_COMMON+'<ellipse cx="73" cy="106" rx="21" ry="21"/><path fill="#FFFFFF" d="M63.3 87.6l9.4 13.1l7.2-14.8C79.9 85 72 82 63 87.6z"/></svg>',eat:ART_COMMON+'<path d="M97.2 103.4c0 12.5-9.7 1.9-22.1 1.9s-22.9 10.6-22.9-1.9s10.1-1.9 22.5-1.9S97.2 90.9 97.2 103.4z"/></svg>',title_art:'<svg xmlns="http://www.w3.org/2000/svg" version="1" x="0" y="0" viewBox="0 0 720 640" enable-background="new 0 0 720 640" xml:space="preserve"><text style="text-shadow: 10px 10px 0 rgba(1,255,223, 0.6), 20px 20px 0 rgba(255,0,0, 0.6), 30px 30px 0 rgba(1,255,223, 0.6), 40px 40px 0 rgba(255,0,0, 0.6),; font-weight: bold;" transform="matrix(1 0 0 1 98.3608 217.1597)"><tspan x="0" y="0" fill="#ECF230" font-family="\'Verdana\'" font-size="99">NOM</tspan><tspan x="262" y="0" fill="#F23869" font-family="\'Verdana\'" font-size="99">MON</tspan><tspan x="-40" y="119" fill="#F23869" font-family="\'Verdana\'" font-size="99">BROT</tspan><tspan x="265" y="119" fill="#ECF230" font-family="\'Verdana\'" font-size="99">HERS</tspan></text></svg>'},NIBLIT_COLOR_PALET=["","#0033CC","#431359","#FFBA41","#FF0000","#FFFF01"],ART.nom=ART.nomHead.replace("</svg>",ART.nomMouth.replace(ART_COMMON,"")),ART.mon=ART.monHead.replace("</svg>",ART.monMouth.replace(ART_COMMON,"")),window.onload=function(){utils=new Utils,graphics=new Graphics,sm=new SoundManager,input=new Input,sc=new ServerConnect,nm=new NiblitManager,input.init(),ga=new GameAdmin,ga.enter_menu()};var GameAdmin=function(){function e(){b.style.display="none",_.style.display="none",d.style.display="none",s.style.display="none",h.style.display="none",y.style.display="none",u.style.display="none",f.style.display="none"}function t(){e(),p.style.display="block",d.style.display="block",s.style.display="block"}function a(){e(),h.style.display="block"}function n(){game_name=document.getElementById("input_game_name").value,game_name=game_name.replace(/\W/g,""),""!=game_name&&(e(),y.style.display="block",sc.register_game())}function i(){sc.get_hosted_games()}function r(t){e(),u.style.display="block";for(var a="",n=0;n<t.length;n++)a+='<li id="game_id_'+t[n]+'" class="avalible_game">'+t[n]+"</li>";for(v.innerHTML=a,n=0;n<t.length;n++)!function(e){document.getElementById("game_id_"+t[e]).addEventListener("click",function(){sc.join_game(t[e])})}(n);g.style.display=t.length?"none":"block"}function s(){}function o(){p.style.display="none",is_host?(nom_icon_show=!(mon_icon_show=!1),player=new Player("nom"),opponent=new Player("mon"),host_interval=setInterval(function(){nm.ready_niblit_batch()},5e3)):(nom_icon_show=!(mon_icon_show=!0),player=new Player("mon"),opponent=new Player("nom")),document.getElementById("player_nom").style.display=nom_icon_show?"block":"none",document.getElementById("player_mon").style.display=mon_icon_show?"block":"none",document.getElementById("opponent_nom").style.display=nom_icon_show?"none":"block",document.getElementById("opponent_mon").style.display=mon_icon_show?"none":"block",nm.avatars.push(player.avatar),nm.avatars.push(opponent.avatar),is_host&&nm.ready_niblit_batch(),spawn_interval=setInterval(function(){nm.niblit_factory.make_niblit()},100),opponent_update_interval=setInterval(function(){sc.socket.emit("game_update",{opponent_pos:player.avatar.position,niblits_eaten:niblits_eaten}),niblits_eaten=[]},34),reverse_meter_interval=setInterval(add_to_reverse_meter,600),player.stop_moving=!1,Game.paused=!1,e(),b.style.display="block",_.style.display="block",game_minutes=1,game_seconds=30,game_centa_seconds=0,m=setInterval(function(){game_centa_seconds--,0>game_centa_seconds&&(game_centa_seconds+=100,game_seconds--,0>game_seconds&&(game_seconds+=60,game_minutes--,0>game_minutes&&(clearInterval(m),l())))},10)}function l(){Game.paused=!0,is_host&&clearInterval(host_interval),clearInterval(spawn_interval),clearInterval(reverse_meter_interval),clearInterval(opponent_update_interval),niblits_eaten=[],player.score<opponent.score;var t=document.getElementById("game_results");t.innerHTML="You "+(player.score<opponent.score?"Lose":"Win")+"!<br>Score: "+player.score+"<br>Opponent: "+opponent.score+"<br><br>Rematch?",e(),f.style.display="block"}function c(){Game.paused=!0,reverse_meter=0,rolling_niblit_id=1,nm.niblits=[],nm.pending_niblits=[],nm.avatars=[]}var m,p=document.getElementById("title"),_=document.getElementById("game_canvas"),d=document.getElementById("host_game"),s=document.getElementById("join_game"),h=document.getElementById("enter_game_name_overlay"),y=document.getElementById("waiting_for_opponent"),u=document.getElementById("games_to_join"),v=document.getElementById("list_of_games"),g=document.getElementById("no_games"),f=document.getElementById("rematch"),b=document.getElementById("HUD");d.addEventListener("click",a),document.getElementById("enter_game_name_overlay_confirm").addEventListener("click",n),document.getElementById("enter_game_name_overlay_cancel").addEventListener("click",t),document.getElementById("waiting_overlay_cancel").addEventListener("click",function(){sc.unregister_game(),t()}),s.addEventListener("click",i),document.getElementById("games_to_join_cancel").addEventListener("click",function(){sc.stop_browsing(),t()}),document.getElementById("rematch_cancel").addEventListener("click",function(){sc.socket.emit("left_game",{}),c(),t()}),document.getElementById("rematch_confirm").addEventListener("click",function(){c(),e(),y.style.display="block",sc.socket.emit("lets_rematch",{})}),this.enter_menu=t,this.show_hosted_games=r,this.start_match=o,this.end_match=l,this.clean_up_match=c},Player=function(e){this.score=0,this.old_score=0,this.upgrade_points=0,this.avatar=new Avatar(e)};Player.prototype.chomp=function(e){this.score+=e.points,this.upgrade_points+=e.points,this.avatar.chomps<3&&this.avatar.chomps++},Player.prototype.try_upgrade=function(){this.avatar.max_level||this.upgrade_points<this.avatar.level_up[this.avatar.level]||(this.upgrade_points-=this.avatar.level_up[this.avatar.level],this.avatar.do_upgrade(),sm.play("upgrade"),sc.socket.emit("game_update",{upgrade:!0}))},Player.prototype.try_reverse=function(){REVERSE_MAX>reverse_meter||(reverse_meter=0,sm.play("reverse"),sc.socket.emit("game_update_both",{reverse:!0}))};var Avatar=function(e){this.who=e,this.BITE_TIME_MAX=.2,this.bite_time=0,this.img_body=document.createElement("IMG"),this.img_open=document.createElement("IMG"),this.img_eat=document.createElement("IMG"),this.eye_x=0,this.eye_y=0,"nom"===e?(this.position={x:50,y:50},this.color="red",this.img_body.src=DOMURL.createObjectURL(new Blob([ART.nomHead],{type:"image/svg+xml;charset=utf-8"})),this.img_open.src=DOMURL.createObjectURL(new Blob([ART.nomMouth],{type:"image/svg+xml;charset=utf-8"}))):(this.position={x:150,y:50},this.color="blue",this.img_body.src=DOMURL.createObjectURL(new Blob([ART.monHead],{type:"image/svg+xml;charset=utf-8"})),this.img_open.src=DOMURL.createObjectURL(new Blob([ART.monMouth],{type:"image/svg+xml;charset=utf-8"}))),this.img_eat.src=DOMURL.createObjectURL(new Blob([ART.eat],{type:"image/svg+xml;charset=utf-8"})),this.img_mouth=this.img_open,this.radius=25,this.speed=150,this.level=1,this.rank=1,this.max_level=!1,this.level_up=[0,20,30,40,50,60,70,80,90,100],this.mouth_open=!0,this.chomps=0};Avatar.prototype.move=function(e){if(utils.proximity(player.avatar.position.x-graphics.camera.x,player.avatar.position.y-graphics.camera.y,input.mouse.x,input.mouse.y)>player.avatar.radius){var t=utils.normalize(player.avatar.position.x-graphics.camera.x,player.avatar.position.y-graphics.camera.y,input.mouse.x,input.mouse.y);player.avatar.position.x+=t[0]*player.avatar.speed*e,player.avatar.position.y+=t[1]*player.avatar.speed*e,player.avatar.position.x<player.avatar.radius?player.avatar.position.x=player.avatar.radius:player.avatar.position.x>ARENA_WIDTH-player.avatar.radius&&(player.avatar.position.x=ARENA_WIDTH-player.avatar.radius),player.avatar.position.y<player.avatar.radius?player.avatar.position.y=player.avatar.radius:player.avatar.position.y>ARENA_HEIGHT-player.avatar.radius&&(player.avatar.position.y=ARENA_HEIGHT-player.avatar.radius);for(var a=0;a<nm.niblits.length;a++)if(nm.niblits[a].points<=player.avatar.rank&&utils.proximity(player.avatar.position.x,player.avatar.position.y,nm.niblits[a].x,nm.niblits[a].y)<player.avatar.radius+nm.niblits[a].size){var n=nm.niblits.splice(a,1)[0];a--,niblits_eaten.push(n.n_id),player.chomp(n)}}"nom"==this.who&&(this.eye_x=this.position.x,this.eye_y=this.position.y-.3*this.radius)},Avatar.prototype.do_upgrade=function(){this.level++,this.level%2==0?this.speed+=50:(this.rank++,this.radius+=5),10==this.level&&(this.max_level=!0)},Avatar.prototype.animate=function(e,t){this.chomps&&(this.bite_time-=e,this.bite_time<0&&(this.bite_time+=this.BITE_TIME_MAX,this.mouth_open=!this.mouth_open,this.mouth_open?(this.img_mouth=this.img_open,this.chomps--):(t&&sm.play("eat"),this.img_mouth=this.img_eat)))};var Niblit=function(e){this.x=e.x,this.y=e.y,this.size=e.size,this.points=e.points,this.n_id=rolling_niblit_id,this.color=NIBLIT_COLOR_PALET[e.points],rolling_niblit_id++},NiblitManager=function(){this.niblits=[],this.niblit_factory=new NiblitFactory(this),this.avatars=[],this.pending_niblits=[]};NiblitManager.prototype.ready_niblit_batch=function(){var e,t,a,n,i;e=this.avatars[0].rank,t=e,this.avatars[1].level>t?t=this.avatars[1].rank:e=this.avatars[1].rank,niblit_batch=[];for(var r=0;20>r&&!(this.niblits.length+r>=MAX_NIBLITS);r++)a=Math.ceil(Math.random()*t),n=parseInt(Math.random()*(ARENA_WIDTH-50)+25),i=parseInt(Math.random()*(ARENA_HEIGHT-50)+25),niblit_batch.push({rank:a,x:n,y:i});sc.socket.emit("game_update_both",{niblit_batch:niblit_batch})};var NiblitFactory=function(e){var t=[0,4,7,10,14,18];this.make_niblit=function(){if(e.pending_niblits.length){var a=e.pending_niblits.shift(),n=new Niblit({x:a.x,y:a.y,size:t[a.rank],points:a.rank});e.niblits.push(n)}}},Utils=function(){};Utils.prototype.normalize=function(e,t,a,n){var i=a-e,r=n-t,s=i*i+r*r;return s=Math.sqrt(s),[i/s,r/s]},Utils.prototype.proximity=function(e,t,a,n){var i=a-e,r=n-t;return Math.sqrt(i*i+r*r)};var Graphics=function(){this.canvas=document.getElementById("game_canvas"),this.context=this.canvas.getContext("2d"),this.camera={x:0,y:0},this.game_time=document.getElementById("game_time"),this.hud={score:document.getElementById("player_score"),opponent:document.getElementById("opponent_score"),player_lv:document.getElementById("player_lv"),opponent_lv:document.getElementById("opponent_lv"),upgrade_text:document.getElementById("upgrade_text"),upgrade_bar_fill:document.getElementById("upgrade_bar_fill"),reverse_bar_fill:document.getElementById("reverse_bar_fill")};var e=document.getElementById("title_canvas").getContext("2d");e.clearRect(0,0,720,640);var t=document.createElement("IMG");t.src=DOMURL.createObjectURL(new Blob([ART.title_art],{type:"image/svg+xml;charset=utf-8"}));var a=document.createElement("IMG");a.src=DOMURL.createObjectURL(new Blob([ART.nom],{type:"image/svg+xml;charset=utf-8"}));var n=document.createElement("IMG");n.src=DOMURL.createObjectURL(new Blob([ART.mon],{type:"image/svg+xml;charset=utf-8"})),document.getElementById("player_nom").src=DOMURL.createObjectURL(new Blob([ART.nom],{type:"image/svg+xml;charset=utf-8"})),document.getElementById("player_mon").src=DOMURL.createObjectURL(new Blob([ART.mon],{type:"image/svg+xml;charset=utf-8"})),document.getElementById("opponent_nom").src=DOMURL.createObjectURL(new Blob([ART.nom],{type:"image/svg+xml;charset=utf-8"})),document.getElementById("opponent_mon").src=DOMURL.createObjectURL(new Blob([ART.mon],{type:"image/svg+xml;charset=utf-8"})),setTimeout(function(){e.drawImage(t,0,0,720,640),e.drawImage(a,184,138,85,85),e.drawImage(n,456,138,85,85)},100)};Graphics.prototype.draw=function(){var e=this.context;for(this.camera.x=player.avatar.position.x-SCREEN_WIDTH/2,this.camera.y=player.avatar.position.y-SCREEN_HEIGHT/2,this.camera.x<0&&(this.camera.x=0),this.camera.x>ARENA_WIDTH-SCREEN_WIDTH&&(this.camera.x=ARENA_WIDTH-SCREEN_WIDTH),this.camera.y<0&&(this.camera.y=0),this.camera.y>ARENA_HEIGHT-SCREEN_HEIGHT&&(this.camera.y=ARENA_HEIGHT-SCREEN_HEIGHT),e.clearRect(0,0,this.canvas.width,this.canvas.height),e.save(),i=0;i<nm.niblits.length;i++)e.lineWidth=1,e.strokeStyle="#BBBBBB",e.fillStyle=nm.niblits[i].color,e.beginPath(),e.arc(nm.niblits[i].x-this.camera.x,nm.niblits[i].y-this.camera.y,nm.niblits[i].size,0,2*Math.PI,!1),e.fill(),e.stroke();if(e.drawImage(opponent.avatar.img_body,opponent.avatar.position.x-this.camera.x-opponent.avatar.radius,opponent.avatar.position.y-this.camera.y-opponent.avatar.radius,2*opponent.avatar.radius,2*opponent.avatar.radius),e.drawImage(opponent.avatar.img_mouth,opponent.avatar.position.x-this.camera.x-opponent.avatar.radius,opponent.avatar.position.y-this.camera.y-opponent.avatar.radius,2*opponent.avatar.radius,2*opponent.avatar.radius),e.drawImage(player.avatar.img_body,player.avatar.position.x-this.camera.x-player.avatar.radius,player.avatar.position.y-this.camera.y-player.avatar.radius,2*player.avatar.radius,2*player.avatar.radius),e.drawImage(player.avatar.img_mouth,player.avatar.position.x-this.camera.x-player.avatar.radius,player.avatar.position.y-this.camera.y-player.avatar.radius,2*player.avatar.radius,2*player.avatar.radius),this.game_time.innerHTML="Time: "+game_minutes+":"+(10>game_seconds?"0"+game_seconds:game_seconds)+":"+(10>game_centa_seconds?"0"+game_centa_seconds:game_centa_seconds),this.hud.score.innerHTML=""+player.score,this.hud.opponent.innerHTML=""+opponent.score,this.hud.player_lv.innerHTML="lv "+player.avatar.level,this.hud.opponent_lv.innerHTML="lv "+opponent.avatar.level,player.avatar.max_level)this.hud.upgrade_text.innerHTML="MAX",this.hud.upgrade_bar_fill.style.width="100%";else{this.hud.upgrade_text.innerHTML=""+player.upgrade_points+"/"+player.avatar.level_up[player.avatar.level];var t=player.upgrade_points/player.avatar.level_up[player.avatar.level]*100;t>100&&(t=100),this.hud.upgrade_bar_fill.style.width=t+"%"}this.hud.reverse_bar_fill.style.width=reverse_meter/REVERSE_MAX*100+"%",e.restore()};var Input=function(){this.mouse={x:0,y:0}};Input.prototype.init=function(){var e=document.getElementById("game_canvas"),t=this.mouse;e.addEventListener("mousemove",function(a){t.x=a.x-e.offsetLeft,t.y=a.y-e.offsetTop}),window.addEventListener("keydown",function(e){try{"U+0055"==e.keyIdentifier?player.try_upgrade():"U+0052"==e.keyIdentifier?player.try_reverse():"U+0051"==e.keyIdentifier&&(game_name=0,game_minutes=0,game_seconds=0)}catch(t){}})};var ServerConnect=function(){this.socket=io.connect(document.location.href);this.lets_play=function(){this.socket.emit("lets_play",{})},this.register_game=function(){this.socket.emit("register_game",{name:game_name})},this.unregister_game=function(){this.socket.emit("unregister_game",{name:game_name})},this.get_hosted_games=function(){this.socket.emit("get_registered_games",{})},this.socket.on("registered_games",function(e){ga.show_hosted_games(e)}),this.stop_browsing=function(){this.socket.emit("stop_browsing",{})},this.join_game=function(e){this.socket.emit("join_game",{name:e})},this.socket.on("left_game",function(){alert("Opponent left the game or got disconnected."),ga.end_match(),ga.clean_up_match(),ga.enter_menu()}),this.socket.on("game_start",function(e){is_host=e.game_host,ga.start_match()}),this.socket.on("do_rematch",function(){ga.start_match()}),this.socket.on("game_update",function(e){if(e.opponent_pos){opponent.avatar.position=e.opponent_pos;for(var t=0;t<e.niblits_eaten.length;t++)for(var a=0;a<nm.niblits.length;a++)e.niblits_eaten[t]==nm.niblits[a].n_id&&(opponent.chomp(nm.niblits.splice(a,1)[0]),a--)}else e.niblit_batch?nm.pending_niblits=nm.pending_niblits.concat(e.niblit_batch):e.reverse?reverse_avatars():e.upgrade&&opponent.avatar.do_upgrade()})};Game.paused=!0,Game.update=function(e){Game.paused||(player.stop_moving||player.avatar.move(e),player.avatar.animate(e,!0),opponent.avatar.animate(e,!1))},Game.run=function(){var e=1e3/Game.config.fps;return start_tick=next_tick=last_tick=(new Date).getTime(),num_frames=0,function(){for(current_tick=(new Date).getTime();current_tick>next_tick;)delta=(current_tick-last_tick)/1e3,Game.update(delta),next_tick+=e,last_tick=(new Date).getTime();graphics&&player&&graphics.draw(),fps=num_frames/(current_tick-start_tick)*1e3,num_frames++}}(),window.each_frame=window.requestAnimationFrame?function(e){var t=function(){e(),requestAnimationFrame(t)};t()}:window.mozRequestAnimationFrame?function(e){var t=function(){e(),mozRequestAnimationFrame(t)};t()}:function(e){setInterval(e,1e3/Game.config.fps)},window.each_frame(Game.run);var SoundManager=function(){function e(e){if(t[e]){var a=new Audio;a.src=jsfxr(t[e]),a.play()}}var t={eat:[1,.07,.13,.21,.1103,.2668,,.1008,-.5,,,,,,,.5303,,,1,,,,,.23],reverse:[0,.62,.55,.47,.41,.3765,.16,.3364,,.18,.43,,,.63,,.7708,,,1,,.4,.15,,.39],upgrade:[2,.2,.19,.4,.71,2e-4,,.2907,-.006,.0047,.4222,-.1013,.1199,,-.029,-.7758,-.3556,.0208,.684,.7017,.8898,.054,.1546,.5],you_lose:[1,2e-4,.0567,.6069,.631,.5373,,.1016,-.7039,.0422,,.1501,,.6826,.0686,.4436,.0054,-.0157,.8327,.0966,-.0835,,,.5],you_win:[2,9e-4,.0591,.1952,.9899,.1754,,-5e-4,.2325,.1121,-.9388,.6123,-.3225,-.4815,.2289,-.0645,.5787,-.0038,.8952,.6302,-.0726,.0019,-.0082,.5]};this.play=e},synth=new SfxrSynth;window.jsfxr=function(e){synth._params.setSettings(e);var t=synth.totalReset(),a=new Uint8Array(4*((t+1)/2|0)+44),n=2*synth.synthWave(new Uint16Array(a.buffer,44),t),i=new Uint32Array(a.buffer,0,44);i[0]=1179011410,i[1]=n+36,i[2]=1163280727,i[3]=544501094,i[4]=16,i[5]=65537,i[6]=44100,i[7]=88200,i[8]=1048578,i[9]=1635017060,i[10]=n,n+=44;for(var r=0,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o="data:audio/wav;base64,";n>r;r+=3){var l=a[r]<<16|a[r+1]<<8|a[r+2];o+=s[l>>18]+s[l>>12&63]+s[l>>6&63]+s[63&l]}return o};</script>
</body>
</html>