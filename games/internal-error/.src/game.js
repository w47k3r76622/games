!function(t,e){function i(){this.active=!1,this.g=function(t,e){return!this.active&&(this.active=!0,this.h=e,this.i=t,this.x=S(e),this.y=S(t),this.arc=0,!0)},this.j=function(){this.active=!1},this.k=null,this.l=function(t){this.k=null;let e=M.atan2(bots[t].y-this.y,bots[t].x-this.x);if(bots[t].i===this.i&&bots[t].h===this.h)return void(this.k=t);if(d(e,m(this.arc+O),O)){let e=[],i=new a(bots[t].x-this.x,bots[t].y-this.y);for(let n of xt){let t=w(n,i,this);t&&e.push({m:t,o:n})}let o=k(bots[t],this);e.length?(e.sort((t,e)=>k(t.m,this)-k(e.m,this)),k(e[0].m,this)>o&&(this.k=t)):this.k=t}}}function n(t){wt=t/500}function o(t){let e=A(Zt),i=Jt.i,n=Jt.h;for(pt.push({i:i,h:n});0!=e[i][n].dir;){switch(e[i][n].dir){case 1:n--;break;case 2:i--;break;case 3:n++;break;case 4:i++}pt.push({i:i,h:n})}let o,s={};for(let i=0;i<t;i++)for(;;){s.i=~~(M.random()*Tt),s.h=~~(M.random()*Pt);let t=new r(s.i,s.h);if(o=q(t),o.p>2){bots.push(t);break}}pt=[]}function r(t,e){this.i=t,this.h=e,this.x=S(this.h),this.y=S(this.i),this.dir=0,this.q=!1,this.s=!1,this.t={i:this.i,h:this.h},this.u=function(){let t,e={};for(;;)if(e.i=~~(M.random()*Tt),e.h=~~(M.random()*Pt),this.i=e.i,this.h=e.h,t=q(this),t.p>2)break;this.x=S(this.h),this.y=S(this.i),this.dir=0,this.q=!1,this.s=!1}}function s(t){At=c(t/8*(lt/10))}function h(t,e){this.p=t,this.dir=e}function l(t,e,i){this.v=t,this.r=e,this.A=i}function a(t=0,e=0){this.x=t,this.y=e,this.B=function(t){return u(this.x,t.x)&&u(this.y,t.y)},this.rotate=function(t){let e=this.x,i=this.y,n=M.cos(t)*e-M.sin(t)*i,o=M.sin(t)*e+M.cos(t)*i;return new a(n,o)}}function f(t,e){this.a=t,this.b=e,this.B=function(t){return this.a.B(t.a)&&this.b.B(t.b)},this.vertical=function(){return u(this.a.x,this.b.x)},this.C=function(){return u(this.a.y,this.b.y)},this.concat=function(t){this.b=t.b},this.D=function(t){if(u(t.b.y,this.a.y)&&u(t.b.x,this.a.x)){if(u(t.a.x,t.b.x)&&u(this.a.x,this.b.x))return!0;if(u(t.a.y,t.b.y)&&u(this.a.y,this.b.y))return!0}return!1}}function c(t){return t+.5|0}function d(t,e,i){return m(m(t)-m(e))<i||m(m(e)-m(t))<i}function u(t,e){return M.abs(t-e)<rt}function y(t,e){if(e.vertical()){if(g(e.a.y,t.y,e.b.y))return M.abs(t.x-e.a.x)}else if(g(e.a.x,t.x,e.b.x))return M.abs(t.y-e.a.y);let i=M.min(k(t,e.a),k(t,e.b));return M.sqrt(i)}function b(t,e){for(let i of t)if(i.a===e.a&&i.b===e.b)return!1;return!0}function x(t){let e=[];for(let i=0;i<t.length;i++)e.some(e=>e.B(t[i].a))||e.push(t[i].a),e.some(e=>e.B(t[i].b))||e.push(t[i].b);return e}function p(t,e,i=true){gt=[];let n=x(t);n=n.filter(t=>k(e,t)<=ut);let o=[];for(let r of n){let t=new a(r.x-e.x,r.y-e.y),n=M.atan2(t.y,t.x);i&&d(n,Nt.angle,O)&&(o.push(t.rotate(.01)),o.push(t.rotate(-.01))),i||(o.push(t.rotate(.01)),o.push(t.rotate(-.01)))}let s=new a(Nt.x,Nt.y);o.push(s.rotate(O)),o.push(s.rotate(-O));let h=[];for(let l of o){h=[];for(let i of t){let t=w(i,l,e);t&&k(e,t)<=ut&&h.push({m:t,o:i})}h.length&&(h.sort((t,i)=>k(t.m,e)-k(i.m,e)),b(gt,h[0].o)&&gt.push(h[0].o))}}function g(t,e,i){return e>=t&&e<=i||e>=i&&e<=t}function w(t,e,i){if(t.vertical()){let n=(t.a.x-i.x)/e.x;if(n>0){let o=i.y+e.y*n;if(g(t.a.y,o,t.b.y))return{x:t.a.x,y:o}}}else{let n=(t.a.y-i.y)/e.y;if(n>0){let o=i.x+e.x*n;if(g(t.a.x,o,t.b.x))return{x:o,y:t.a.y}}}return null}function m(t){return t<0?t+=2*G:(t>=2*G&&(t%=2*G),t)}function k(t,e){return M.pow(t.x-e.x,2)+M.pow(t.y-e.y,2)}function v(t){return t.x*t.x+t.y*t.y}function P(t,e,i=Jt,n=D){let o=new a(t.x-e.x,t.y-e.y),r=M.sqrt(v(o));o.x/=r,o.y/=r;let s=new a(t.x+o.x,t.y+o.y),h=new a(e.x-o.x,e.y-o.y),l=M.sqrt(k(s,i)),f=M.sqrt(k(h,i)),c=M.abs(l-dt),d=M.abs(f-dt),y={x:(s.x-i.x)*(c/l),y:(s.y-i.y)*(c/l)},b={x:(h.x-i.x)*(d/f),y:(h.y-i.y)*(d/f)},x=0,p=0;u(s.x,h.x)?x=M.sign(y.x)*dt:p=M.sign(y.y)*dt,n.lineWidth=1,n.beginPath(),n.moveTo(s.x,s.y),n.lineTo(s.x+y.x,s.y+y.y),n.lineTo(s.x+y.x+x,s.y+y.y+p),n.lineTo(h.x+b.x+x,h.y+b.y+p),n.lineTo(h.x+b.x,h.y+b.y),n.lineTo(h.x,h.y),n.lineTo(s.x,s.y),n.fill(),n.closePath()}function T(t,e,i){for(let n of Lt[t])i[n].A=e,Lt[e].push(n);Lt[t]=[]}function S(t){return t*st+tt+st/2}function I(t){let e=document.getElementById("msg"),i=e.style.width=window.innerWidth/5,n=e.style.height=window.innerHeight/5;et=[{x:S(0),y:S(0)},{x:S(Pt-1)-i,y:S(0)},{x:S(Pt-1)-i,y:S(Tt-1)-n},{x:S(0),y:S(Tt-1)-n}];let o=k(Jt,et[0]),r=et[0];for(let s of et){let t=k(Jt,s);t>o&&(o=t,r=s)}return e.style.left=r.x+"px",e.style.top=r.y+"px",e.style.color="#1dfc81",e.style.font="20px monospace",e.style.textShadow="1px 1px 20px #fff",e.innerHTML=t,r}function A(t){let e=[];for(let i=0;i<Tt;i++)e.push(new Array);let i=parseInt(t.i),n=parseInt(t.h),o=["last"];e[i][n]=new h(0,0);do 1!=Mt[i][n].r&&(!e[i][n+1]||n+1<Pt&&e[i][n+1]&&e[i][n+1].p>e[i][n].p+1)?(e[i][n+1]=new h(e[i][n].p+1,1),o.push({a:i,b:n}),n+=1):1!=Mt[i][n].v&&(!e[i+1][n]||i+1<Tt&&e[i+1][n]&&e[i+1][n].p>e[i][n].p+1)?(e[i+1][n]=new h(e[i][n].p+1,2),o.push({a:i,b:n}),i+=1):n>0&&1!=Mt[i][n-1].r&&(!e[i][n-1]||n>0&&e[i][n-1]&&e[i][n-1].p>e[i][n].p+1)?(e[i][n-1]=new h(e[i][n].p+1,3),o.push({a:i,b:n}),n-=1):i>0&&1!=Mt[i-1][n].v&&(!e[i-1][n]||i>0&&e[i-1][n]&&e[i-1][n].p>e[i][n].p+1)?(e[i-1][n]=new h(e[i][n].p+1,4),o.push({a:i,b:n}),i-=1):o.length&&(St=o.pop(),i=St.a,n=St.b);while(o.length>0);return e}function C(t,e){let i=new a(e.x-t.x,e.y-t.y),n=M.sqrt(v(i));i.x/=n,i.y/=n;let o=i.rotate(L);z.strokeStyle="white",z.beginPath(),z.lineWidth=1,z.moveTo(t.x,t.y);let r=n/15;for(let s=1;s<r;s++){let e=20*M.random()-10;z.lineTo(t.x+i.x*(s/r)*n+o.x*e,t.y+i.y*(s/r)*n+o.y*e)}z.lineTo(e.x,e.y),z.stroke(),z.closePath(),z.beginPath(),z.lineWidth=2,z.moveTo(t.x,t.y);for(let s=1;s<r;s++){let e=10*M.random()-5;z.lineTo(t.x+i.x*(s/r)*n+o.x*e,t.y+i.y*(s/r)*n+o.y*e)}z.lineTo(e.x,e.y),z.stroke(),z.closePath()}function B(){let t=$t-pt.length+1;if(0==t){Jt.h==Zt.h&&Jt.i==Zt.i?(fixTip={x:S(0),y:40+Ft.width/2},tipWire=0,kt=!0):it=I("> you ran short of cable. <br>> find another way. <br>>");let t=pt[pt.length-2];t.h<Jt.h?Jt.stop=1:t.i<Jt.i?Jt.stop=2:t.h>Jt.h?Jt.stop=3:t.i>Jt.i&&(Jt.stop=4)}else Jt.stop=!1;Y.shadowColor="red",Y.shadowBlur=14,Y.beginPath(),Y.clearRect(420,0,70,50),Y.font="bold 20px monospace",Y.fillStyle="#bc0010",Y.fillText(t+"",440,20),Y.closePath(),Y.shadowBlur=0}function W(){Y.clearRect(700,0,100,st);let t=0;for(let e in It)It[e].active||Y.drawImage(Ft,c(700+33*t++),6,22,22);bt=!1}function R(){Y.clearRect(tt,40,st*Pt,st*(Tt+1)),Y.clearRect(tt,0,tt,tt),Y.drawImage(Ft,c(S(0)-Ft.width/2),40),Y.beginPath(),Y.moveTo(S(0),40+Ft.width);let t=0;for(mt=null;t<pt.length-1;t++){Y.lineTo(S(pt[t].h),S(pt[t].i));for(let e of bots)if(e.i==pt[t].i&&e.h==pt[t].h){mt=t;break}if(null!==mt)break}if(Y.shadowColor="#f00",Y.shadowBlur=st/5,Y.lineWidth=4,Y.strokeStyle="#680002",Y.stroke(),Y.lineWidth=1,Y.strokeStyle="#bc0010",Y.stroke(),Y.closePath(),Y.shadowBlur=0,t<pt.length-1){for(Y.beginPath(),Y.moveTo(S(pt[t].h),S(pt[t].i)),t++;t<pt.length-1;t++)Y.lineTo(S(pt[t].h),S(pt[t].i));Y.lineWidth=4,Y.strokeStyle="#330000",Y.stroke(),Y.lineWidth=1,Y.strokeStyle="#4d0000",Y.stroke(),Y.closePath()}for(let t in It)It[t].active&&Y.drawImage(Ft,M.round(It[t].x-Ft.width/2),M.round(It[t].y-Ft.width/2))}function F(){let t=A(Jt),e=new h(0,0);for(let i in t)for(let n in t[i])t[i][n].p>e.p&&(e=t[i][n],e.i=i,e.h=n);return e}function q(t){if(pt.length){t.F=A(t);let e=new h(1/0,0);for(let i of pt)t.F[i.i][i.h].p<e.p&&(e.dir=t.F[i.i][i.h].dir,e.p=t.F[i.i][i.h].p,e.i=i.i,e.h=i.h);let n=e.i,o=e.h,r=e.dir;for(t.F[n][o].dir=0;0!==r;)switch(r){case 1:o--,r=t.F[n][o].dir,t.F[n][o].dir=3;break;case 2:n--,r=t.F[n][o].dir,t.F[n][o].dir=4;break;case 3:o++,r=t.F[n][o].dir,t.F[n][o].dir=1;break;case 4:n++,r=t.F[n][o].dir,t.F[n][o].dir=2}return e}return t.F=A(Jt),Jt}function E(t){let e=document.createElement("canvas");e.width=t.width,e.height=t.height,glctx=e.getContext("2d");let i=e.width/20,n=()=>{return M.random()*t.height},o=e=>{return M.random()*(t.height-e)},r=()=>{return M.random()*i-i/2};for(let s=0;s<2;s++){let e=n(),i=o(e),s=r();glctx.drawImage(t,0,e,t.width,i,s,e,t.width,i)}return e}function H(t,e,n){function r(){j.beginPath(),V=D.createPattern(U,"repeat"),j.fillStyle=V,j.fillRect(tt,tt,Pt*st,Tt*st),j.closePath(),j.shadowColor="#fff",j.shadowBlur=st/2,j.strokeStyle="#1dfc81",j.fillStyle="#1dfc81",j.lineWidth=st/20,xt.map(t=>{j.beginPath(),j.moveTo(t.a.x,t.a.y),j.lineTo(t.b.x,t.b.y),j.stroke(),j.closePath()}),xt.map(t=>{j.beginPath(),j.fillRect(t.a.x-st/40,t.a.y-st/40,st/20,st/20),j.fillRect(t.b.x-st/40,t.b.y-st/40,st/20,st/20),j.closePath()}),j.shadowBlur=0,Y.shadowColor="white",Y.shadowBlur=20,Y.beginPath(),Y.font="20px monospace",Y.fillStyle="#1dfc81",Y.fillText("wire_left: ",300,20),Y.fillText("defenders_left: ",500,20),Y.fillText("internalness: "+ft,810,20),Y.closePath(),Y.shadowBlur=0}Pt=e,ft=t,at=n,D.clearRect(0,0,Z,$),j.clearRect(0,0,Z,$),Y.clearRect(0,0,Z,$),z.clearRect(0,0,Z,$),ot=!1,st=~~((Z-tt)/Pt),Tt=~~(($-tt)/st),rt=st/18,ht=st/2,lt=M.sqrt(st),ct=st/128,dt=2.5*st,ut=dt*dt,yt=2*st,bt=!0,xt=[],pt=[],gt=[],mt=null,kt=!1,oe=30,vt={G:st,H:st,I:st,J:st},It=[],bots=[];for(let s=0;s<at;s++)It.push(new i);At=2,Ct=document.createElement("canvas"),Ct.width=Ct.height=yt,Bt=Ct.getContext("2d"),Bt.beginPath(),Wt=new a(M.cos(O),M.sin(O)),Wt=Wt.rotate(L),Rt=Bt.createLinearGradient(0-Wt.x*yt,0-Wt.y*yt,0+Wt.x*yt,0+Wt.y*yt),Rt.addColorStop(0,"red"),Rt.addColorStop(1,"transparent"),Bt.fillStyle=Rt,Bt.moveTo(0,0),Bt.lineTo(yt,0),Bt.lineWidth=4,Bt.strokeStyle="red",Bt.stroke(),Bt.arc(0,0,yt,0,L),Bt.fill(),Bt.closePath(),Ft=document.createElement("canvas"),Ft.width=Ft.height=c(st/5),qt=Ft.getContext("2d"),qt.beginPath(),qt.fillStyle="#680002",qt.fillRect(c(Ft.width/2-st/10),c(Ft.width/2-st/10),c(st/5),c(st/5)),qt.fillStyle="#bc0010",qt.shadowBlur=0,qt.fillRect(Ft.width/2-st/14,Ft.width/2-st/14,st/7,st/7),qt.closePath(),Et=document.createElement("canvas"),Et.style.background="rgba(0,0,0,0)",Et.width=Et.height=c(st/3),Ht=Et.getContext("2d"),Ht.beginPath(),Ht.shadowColor=Q,Ht.shadowBlur=c(st/5),Ht.fillStyle=Q,Ht.fillRect(c(Et.width/2-st/10),c(Et.width/2-st/10),c(st/5),c(st/5)),Ht.shadowBlur=0,Ht.closePath(),Jt={i:0,h:0,x:tt+ht,y:tt+ht,step:3,stop:!1,K:!1,k:null,L(t){this.step=c(t/5*(lt/10))},l(){this.k=null;let t=1/0;for(let e in bots){let i=k(bots[e],this);if(bots[e].i===this.i&&bots[e].h===this.h)return void(this.k=e);let n=M.atan2(bots[e].y-this.y,bots[e].x-this.x);if(d(n,Nt.angle,G/16)){let n=[],o=new a(Ot.M-this.x,Ot.N-this.y);for(let r of xt){let t=w(r,o,this);t&&n.push({m:t,o:r})}n.length?(n.sort((t,e)=>k(t.m,this)-k(e.m,this)),k(n[0].m,this)>i&&i<t&&(this.k=e,t=i)):i<t&&(this.k=e,t=i)}}}},Mt=[],Gt=[],Lt=new Array(Pt),Ot={x:Jt.x,y:Jt.y},Nt={update(){for(let t in this)"function"!=typeof this[t]&&(this[t]=null);this.y=Ot.y-Jt.y,this.x=Ot.x-Jt.x,this.angle=M.atan2(this.y,this.x),this.angle<O&&this.angle>-O?this.right=!0:this.angle<3*O&&this.angle>O?this.O=!0:this.angle<-O&&this.angle>-3*O?this.P=!0:(this.angle<-3*O||this.angle>3*O)&&(this.left=!0)}};for(let h=0;h<Pt;h++){Gt.push(new l(0,0,h));let t=[h];Lt[h]=JSON.parse(JSON.stringify(t))}for(let s=0;s<Tt;s++){for(let t=0;t<Pt;t++){if(Gt[t].r=0,Gt[t].v){let e=Lt[Gt[t].A].indexOf(t);Lt[Gt[t].A].splice(e,1),Gt[t].A=-1}Gt[t].v=0}for(let t=0;t<Pt;t++)if(Gt[t].A==-1){Gt[t].A=0;for(let e=0;e<Pt;e++)e!=t&&Gt[e].A===Gt[t].A&&(Gt[t].A++,e=-1);Lt[Gt[t].A].push(t)}for(let t=0;t<Pt-1;t++)M.round(M.random())?Gt[t].r=1:Gt[t+1].A!=Gt[t].A&&T(Gt[t+1].A,Gt[t].A,Gt);Gt[Pt-1].r=1;let e=new Array(Pt).fill(0);for(let t=0;t<Pt;t++)e[Gt[t].A]++;for(let t=0;t<Pt;t++)M.round(M.random())&&e[Gt[t].A]>1&&(Gt[t].v=1,e[Gt[t].A]--);if(s===Tt-1){for(let t=0;t<Pt;t++)Gt[t].v=1,t+1<Pt&&Gt[t].A!=Gt[t+1].A&&(Gt[t].r=0,T(Gt[t+1].A,Gt[t].A,Gt));Gt[Pt-1].r=1}Mt.push(JSON.parse(JSON.stringify(Gt)))}Dt={key38:!1,key40:!1,key39:!1,key37:!1,key87:!1,key83:!1,key68:!1,key65:!1},Kt=64*ct,jt=0,Xt=0,Yt=0,_t=0,zt=0,Qt=0,Ut=0,Vt=0;let u,y;for(let b=0;b<2;b++)for(let s=0;s<Tt;s++)for(let h=0;h<Pt;h++)0===s&&0===b&&(u=tt+h*st,y=tt-Kt/2),0===h&&1===b&&(u=tt-Kt/2,y=tt+s*st-Kt/2),1===Mt[s][h].r&&1===b&&(u=tt+(h+1)*st-Kt/2,y=tt+s*st-Kt/2,h<Pt-1&&(Yt=_t=zt=Qt=Ut=Vt=0,0!==s&&1!==Mt[s-1][h].r||(Yt=Kt),s===Tt-1&&(_t=Kt),!Yt&&s>0&&Mt[s-1][h].v&&(zt=Kt),s+1<Tt&&Mt[s][h].v&&(Qt=Kt),!Yt&&s>0&&Mt[s-1][h+1].v&&(Ut=Kt),s+1<Tt&&Mt[s][h+1].v&&(Vt=Kt),xt.push(new f(new a(u,y+Yt+zt),new a(u,y+3*Kt-_t-Qt))),xt.push(new f(new a(u+Kt,y+Yt+Ut),new a(u+Kt,y+3*Kt-_t-Vt))),s>0&&!Mt[s-1][h].r&&xt.push(new f(new a(u,y),new a(u+Kt,y))),s+1<Tt&&!Mt[s+1][h].r&&xt.push(new f(new a(u,y+3*Kt),new a(u+Kt,y+3*Kt))))),1===Mt[s][h].v&&0===b&&(u=tt+h*st,y=tt+(s+1)*st-Kt/2,s<Tt-1&&(jt=Xt=0,(1===Mt[s][h].r||s+1<Tt&&1===Mt[s+1][h].r)&&(jt=Kt/2),(0===h||1===Mt[s][h-1].r||s+1<Tt&&1===Mt[s+1][h-1].r)&&(Xt=Kt/2),xt.push(new f(new a(u+Xt,y),new a(u-jt+2*Kt,y))),xt.push(new f(new a(u+Xt,y+Kt),new a(u-jt+2*Kt,y+Kt))),!jt&&h+1<Pt&&!Mt[s][h+1].v&&xt.push(new f(new a(u+2*Kt,y),new a(u+2*Kt,y+Kt))),!Xt&&h>0&&!Mt[s][h-1].v&&xt.push(new f(new a(u,y),new a(u,y+Kt)))));for(let s=0;s<xt.length;s++)if(xt[s])for(let h=0;h<xt.length;h++)xt[h]&&xt[h].D(xt[s])&&(xt[s].concat(xt[h]),xt[h]=null,h=-1);xt=xt.filter(t=>t),U.complete?r():U.onload=r,Zt=F(),o(at),$t=Zt.p,te=0,ee=2,ne=!0,D.fillStyle=Q,D.fillRect(0,0,Z,$),initMsg?mgsPos=I("> looks more internal. <br>> defenders++ <br>> bugs++? <br>>"):(it=I("> reached internals.<br>> internal error detected.<br>> viewing range limited due to power loss. <br>> provide fix supply.<br>> W to move.<br>> mouse to look around.<br>> "),initMsg=!0),B()}function J(t){if(!ot){if(ie){let e=t-ie;Jt.L(e),s(e),n(e),ie=t}else ie=t,nt=t;D.fillRect(Jt.x-dt,Jt.y-dt,2*dt,2*dt),z.clearRect(0,0,Z,$),Dt.key87&&(Nt.right&&1!=Mt[Jt.i][Jt.h].r&&vt.H>=st&&vt.G>=st&&vt.J>=st&&(!Jt.stop||3==Jt.stop)&&(vt.H-=st),Nt.P&&Jt.i>0&&1!=Mt[Jt.i-1][Jt.h].v&&vt.J>=st&&vt.H>=st&&vt.I>=st&&(!Jt.stop||2==Jt.stop)&&(vt.J-=st),Nt.O&&1!=Mt[Jt.i][Jt.h].v&&vt.G>=st&&vt.H>=st&&vt.I>=st&&(!Jt.stop||4==Jt.stop)&&(vt.G-=st),Nt.left&&Jt.h>0&&1!=Mt[Jt.i][Jt.h-1].r&&vt.I>=st&&vt.G>=st&&vt.J>=st&&(!Jt.stop||1==Jt.stop)&&(vt.I-=st),k(Jt,it)<ut&&I("")),vt.H<st?(Jt.x+=Jt.step,vt.H+=Jt.step,vt.H>=st&&Jt.h++):vt.I<st?(Jt.x-=Jt.step,vt.I+=Jt.step,vt.I>=st&&Jt.h--):vt.J<st?(Jt.y-=Jt.step,vt.J+=Jt.step,vt.J>=st&&Jt.i--):vt.G<st&&(Jt.y+=Jt.step,vt.G+=Jt.step,vt.G>=st&&Jt.i++);for(let e in bots)!re&&k(Jt,bots[e])<st*st-5&&(it=I("> LMB to exterminate minor bug. <br>> bugs block cable.<br>> cause signal glitches. <br>> SPACE to install defender.<br>>"),re=!0),!ne&&bots[e].F||q(bots[e]),1===bots[e].F[bots[e].i][bots[e].h].dir?bots[e].dir=1:2===bots[e].F[bots[e].i][bots[e].h].dir?bots[e].dir=2:3===bots[e].F[bots[e].i][bots[e].h].dir?bots[e].dir=3:4===bots[e].F[bots[e].i][bots[e].h].dir?bots[e].dir=4:0===bots[e].F[bots[e].i][bots[e].h].dir&&(bots[e].dir=0,bots[e].s||(nt=t,R(),bots[e].s=!0)),bots[e].q||(1===bots[e].dir?(bots[e].x-=At,ht+tt+bots[e].h*st-bots[e].x>=st&&bots[e].h--):2===bots[e].dir?(bots[e].y-=At,ht+tt+bots[e].i*st-bots[e].y>=st&&bots[e].i--):3===bots[e].dir?(bots[e].x+=At,bots[e].x-tt-bots[e].h*st-ht>=st&&bots[e].h++):4===bots[e].dir&&(bots[e].y+=At,bots[e].y-tt-bots[e].i*st-ht>=st&&bots[e].i++));D.globalCompositeOperation="destination-out",D.beginPath(),D.moveTo(Jt.x,Jt.y),D.arc(Jt.x,Jt.y,dt,Nt.angle-O,Nt.angle+O),D.fill(),D.closePath(),D.globalCompositeOperation="source-over",p(xt.filter(t=>y(Jt,t)<dt),Jt);for(let e of gt)P(e.a,e.b);if(Nt.update(),D.drawImage(Ft,c(Jt.x-Ft.width/2),c(Jt.y-Ft.width/2)),ne=!1,0===pt.length?pt.push({h:0,i:0}):Jt.h==pt[pt.length-1].h&&Jt.i==pt[pt.length-1].i||(pt.length>1&&Jt.h===pt[pt.length-2].h&&Jt.i===pt[pt.length-2].i?(pt.pop(),ne=!0,B(),R()):(pt.push({h:Jt.h,i:Jt.i}),ne=!0,B(),R())),!ne&&bt&&(R(),W()),D.beginPath(),pt.length>1){D.moveTo(S(pt[pt.length-2].h),S(pt[pt.length-2].i));let t=new a(Jt.x-S(pt[pt.length-2].h),Jt.y-S(pt[pt.length-2].i));t.x*=.9,t.y*=.9,D.lineTo(S(pt[pt.length-2].h)+t.x,S(pt[pt.length-2].i)+t.y)}else D.moveTo(S(0),40),D.lineTo(Jt.x,Jt.y-Ft.width/2);null===mt?(D.lineWidth=4,D.strokeStyle="#680002",D.stroke(),D.lineWidth=1,D.strokeStyle="#bc0010",D.stroke(),D.closePath()):(D.lineWidth=4,D.strokeStyle="#330000",D.stroke(),D.lineWidth=1,D.strokeStyle="#4d0000",D.stroke(),D.closePath()),z.beginPath(),z.arc(S(Zt.h),S(Zt.i),te,0,2*G),te+=ee,(te>st/2||te<2)&&(ee=-ee);let i=z.createRadialGradient(S(Zt.h),S(Zt.i),st/16,S(Zt.h),S(Zt.i),st/3);i.addColorStop(0,"#bc0010"),i.addColorStop(1,"transparent"),z.fillStyle=i,z.fill(),z.fillRect(S(Zt.h)-st/16,S(Zt.i)-st/16,st/8,st/8),z.closePath();for(let e in It)It[e].active&&(z.save(),z.translate(c(It[e].x),c(It[e].y)),z.rotate(It[e].arc),z.drawImage(Ct,0,0),It[e].arc-=wt,It[e].arc%=2*G,z.restore());for(let e in bots){let t=null,i=null;for(let n in It)if(It[n].active){if(It[n].k===e){t=e,i=n;break}if(!It[n].k&&k(It[n],{x:S(bots[e].h),y:S(bots[e].i)})<=yt*yt+1&&(It[n].l(e),It[n].k===e)){t=e,i=n;break}}if(bots[e].q||Jt.k==e||t==e)if(bots[e].q){z.beginPath(),z.fillStyle=Q;let t=bots[e].q*(st/5)/oe;z.fillRect(bots[e].x-t/2,bots[e].y-t/2,t,t),z.closePath(),bots[e].q--,1===bots[e].q&&(bots[e].q=!1,Jt.k===e&&(Jt.k=null),i&&It[i].k===e&&(It[i].k=null),bots[e].u(),R())}else bots[e].q=oe;else z.drawImage(Et,c(bots[e].x-Et.width/2),c(bots[e].y-Et.width/2))}if(Jt.K){let t,e;Jt.k?(t=bots[Jt.k].x,e=bots[Jt.k].y):(t=Ot.M,e=Ot.N),C(Jt,{x:t,y:e})}for(let o in It){let t=It[o].k;t&&It[o].active&&C(It[o],bots[t])}if(kt){let t=new a(S(pt[tipWire].h),S(pt[tipWire].i)),e=new a(t.x-fixTip.x,t.y-fixTip.y),i=M.sqrt(v(e));fixTip.x+=e.x/i*(st/8),fixTip.y+=e.y/i*(st/8),z.beginPath(),z.lineWidth=2,z.strokeStyle="#1dfc81",z.moveTo(S(0),40+Ft.width/2);for(let n=0;n<tipWire;n++)z.lineTo(S(pt[n].h),S(pt[n].i));z.lineTo(fixTip.x,fixTip.y),z.stroke(),z.closePath(),k(fixTip,t)<st*st/16&&(tipWire===mt?(it=I("> smth blocks fix supply.<br>>"),kt=!1):tipWire==pt.length-1?(kt=!1,3==at?(ot=!0,I("> good job. <br>> internal error fixed.<br>> "),setTimeout(function(){location.reload()},3e3)):H(ft+1,Pt+3,at+1)):(fixTip.x=t.x,fixTip.y=t.y,tipWire++))}}t-nt<500&&D.drawImage(E(N),0,0),requestAnimationFrame(J)}const M=Math,G=M.PI,L=G/2,O=G/4,N=document.getElementById("c"),D=N.getContext("2d"),K=document.getElementById("c2"),j=K.getContext("2d"),X=document.getElementById("c3"),Y=X.getContext("2d"),_=document.getElementById("c4"),z=_.getContext("2d");K.style.backgroundColor="#000";const Q="#000";let U=new Image;U.src="floor4.png";let V;const Z=N.width=K.width=X.width=_.width=window.innerWidth,$=(window.innerHeight/2,N.height=K.height=X.height=_.height=window.innerHeight),tt=100;let et,it,nt,ot,rt,st,ht,lt,at,ft,ct,dt,ut,yt,bt,xt,pt,gt,wt,mt,kt,vt,Pt,Tt,St,It,At,Ct,Bt,Wt,Rt,Ft,qt,Et,Ht,Jt,Mt,Gt,Lt,Ot,Nt,Dt,Kt,jt,Xt,Yt,_t,zt,Qt,Ut,Vt,Zt,$t,te,ee,ie,ne,oe,re=defMsg=initMsg=!1;U.onload=function(){function t(c){if(D.clearRect(0,0,Z,$),i?s||(c-i>500&&(r=!r,i=c),c-n>3e3&&(n=c,s=!0,f=!0,r=!1)):(i=c,n=c),r)D.beginPath(),D.shadowColor="white",D.shadowBlur=40,D.beginPath(),D.font="15px monospace",D.fillStyle="#1dfc81",D.fillText("> Internal error",10,30),D.closePath();else if(s){if(D.shadowBlur=0,c-n>2e3&&(o-=.005,o<.5))return H(1,10,2),document.addEventListener("mousemove",function(t){let e=N.getBoundingClientRect();Ot.M=t.pageX-e.left,Ot.N=t.pageY-e.top;let i=new a(t.pageX-e.left-Jt.x,t.pageY-e.top-Jt.y),n=v(i);n<ut/4?(n=M.sqrt(n),Ot.x=Jt.x+i.x*(.5*dt/n),Ot.y=Jt.y+i.y*(.5*dt/n)):(Ot.x=t.pageX-e.left,Ot.y=t.pageY-e.top)}),document.addEventListener("keydown",function(t){if(Dt["key"+t.keyCode]=!0,32===t.keyCode){t.preventDefault(),defMsg||(it=I("> defender exterminates bugs in its viewing range. <br>> bugs spawn randomly but keep distance from cable. <br>> install near crossroads or long dark dead-ends. <br>> try covering bigger cable areas. <br>> SPACE to pick up. <br>>"),defMsg=!0);let e=!1;bt=!0;for(let i in It)if(It[i].active&&It[i].i===Jt.i&&It[i].h===Jt.h){It[i].j(),e=!0;break}if(!e)for(let i in It)if(It[i].g(Jt.i,Jt.h))break}}),document.addEventListener("mousedown",function(t){t.preventDefault(),Jt.K=!0,Jt.l()}),document.addEventListener("mouseup",function(t){Jt.K=!1}),document.addEventListener("keyup",function(t){Dt["key"+t.keyCode]=!1}),void J();!f&&c-i>h&&(f=!0,h=2e3*M.random(),i=c),f?(D.drawImage(E(e),0,$/2-1/o*300,4*Z/o,600/o),c-i>l&&(f=!1,i=c,l=250*M.random())):D.drawImage(e,0,$/2-1/o*300,4*Z/o,600/o)}requestAnimationFrame(t)}V=D.createPattern(U,"repeat");let e=document.createElement("canvas");e.width=4*Z,e.height=600,ictx=e.getContext("2d"),ictx.beginPath(),ictx.beginPath(),ictx.fillStyle="#000",ictx.fillRect(0,0,e.R,e.height),ictx.font="500px monospace",ictx.strokeStyle="#1dfc81",ictx.lineWidth=4,ictx.fillStyle=V,ictx.fillText("Internal error",0,500),ictx.strokeText("Internal error",0,500),ictx.closePath();let i,n,o=3,r=!1,s=!1,h=1500*M.random(),l=500*M.random()+500,f=!1;t()},e.S=t}({},function(){return this}());