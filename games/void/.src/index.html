<!doctype html><html><head><meta charset=utf-8><style>#uie,.scanlines-overlay{width:100%;height:100%;pointer-events:none}#uie,#uie *,.scanlines-overlay{pointer-events:none}#message,.gm{padding:20px;box-sizing:border-box}#fps{color:red;font-weight:700}body{background:#06060C}body *{-webkit-user-select:none;-moz-user-select:none;user-select:none}.lwrC{text-transform:lowercase}e,f{display:block}#game-container{background:#1B1C29;background:radial-gradient(ellipse at center,#222333 0,#11111B 100%);border:1px solid #3b3d5d;margin:30px auto;width:90%;height:90%;text-transform:uppercase;font-family:monospace;color:#4FFD8A;font-size:1.2em;font-weight:700;position:fixed;left:5%}#uie,#uie .gauge,#uie .map,.canvas_layer,.devby,.gm,.gm .monnies,.scanlines-overlay{position:absolute}.canvas_layer{top:0;left:0}.scanlines-overlay{z-index:100;background:-webkit-repeating-linear-gradient(top,transparent 0,transparent 1px,rgba(0,0,0,.15) 1px,rgba(0,0,0,.15) 2px);-webkit-background-size:100% 2px}#uie .map{width:150px;height:150px;background:rgba(28,51,45,.29);bottom:20px;left:20px;border:1px solid #4ffd89}#message,#uie .gauge .bar,.gm{border:1px solid #4FFD8A}#uie .gauge{width:50%;right:20px}.hull.gauge{bottom:20px}.shields.gauge{bottom:40px}.fuel.gauge{bottom:60px}#uie .gauge .label{float:right}#uie .gauge .bar{width:50%;height:9pt;background:rgba(79,253,138,.07);float:right;margin:1px 0 0 10px;overflow:hidden}#uie .gauge .remaining{width:100%;height:100%;background:#4FFD8A}.glow{-webkit-filter:blur(3px);opacity:.7}#message{width:0;background:rgba(9,10,21,.9);margin:20px auto;text-align:center;display:none;color:rgba(79,253,138,0)}#message.open{display:block;animation:open-menu .5s linear;animation-fill-mode:forwards}#message .title{font-size:1.3em;line-height:0}@keyframes open-menu{0%{width:0;opacity:0}50%{width:25pc;color:rgba(79,253,138,0)}100%{width:25pc;opacity:1;color:rgba(79,253,138,1)}}.gm{background:#090a15;width:700px;height:500px;left:50%;margin:0 0 0 -350px;z-index:100;display:none}.gm.open{display:block;animation:station-menu-entry .5s linear;animation-fill-mode:forwards;top:20pc;height:0;opacity:0}@keyframes station-menu-entry{0%{height:0;opacity:0;top:20pc}100%{opacity:1;height:500px;top:50px}}.gm .station-title{margin:0 0 30px;padding:0}.gm .monnies{top:20px;right:20px}.tabs{margin:0 0 -1px}.tabs .tab{padding:5px 10px;display:inline-block;border:1px solid rgba(79,253,138,.4);border-bottom:none;cursor:pointer;color:rgba(79,253,138,.61)}.tabs .tab.active{border-bottom:1px solid #090A15;color:#4FFD8A}.tabs .tab:hover{color:#4FFD8A}.gm .warez{font-weight:400;border:1px solid rgba(79,253,138,.4);padding:10px;display:none}#inventoryTable,.gm .warez.active{display:block}.gm .warez table{width:100%;border:none}.gm .warez table th{text-align:left;padding:6px 3px}.gm .warez table td,.gm .warez table tr{border:none;margin:0;padding:6px 3px}.gm .warez table td{font-size:.9em}.gm .warez table tbody tr:nth-child(odd){background:rgba(79,253,138,.15)}.gm button{padding:2px 6px;border:1px solid rgba(79,253,138,.4);font-weight:700;cursor:pointer;background:0 0;color:#4FFD8A;outline:0}.gm button:hover{color:#05230F;background:#4FFD8A;border:1px solid #4FFD8A}.gm button.disable{cursor:default;opacity:.2}.gm button.disable:hover{cursor:default;opacity:.2;border:1px solid rgba(79,253,138,.4);background:0 0;color:#4FFD8A}.gm .exit-button{padding:5px 10px;position:absolute;bottom:20px;right:20px;border:1px solid rgba(79,253,138,.4);cursor:pointer}.gm .exit-button:hover{color:#05230F;background:#4FFD8A;border:1px solid #4FFD8A}#upgrades_table .lv{height:20px;width:8px;background:rgba(79,253,138,.31);margin:3px;float:left}#upgrades_table .lv.acquired{background:rgba(79,253,138,1)}.shake #uie,.shake .canvas_layer{animation:.1s linear}.shake .canvas_layer{animation:shake-horizontal .1s linear}.shake #uie .gauge .bar,.shake #uie .map{border:1px solid #ff4746}.shake #uie .gauge .label{color:#ff4746}.shake #uie .gauge .remaining{background:#ff4746}.shake #uie .map{background:rgba(130,13,12,.9)}#game-container.shake{background:radial-gradient(ellipse at center,#3a171d 0,#210b0f 100%)}@keyframes shake-horizontal{0%{transform:translate(0,0) rotate(0)}2%,34%{transform:translate(-7px,0) rotate(0)}4%{transform:translate(-3px,0) rotate(0)}36%{transform:translate(1px,0) rotate(0)}66%{transform:translate(-4px,0) rotate(0)}68%{transform:translate(6px,0) rotate(0)}98%{transform:translate(-5px,0) rotate(0)}}.devby{bottom:20px;left:20px}a{color:rgba(79,253,138,.5);text-decoration:none}a:hover{color:rgba(79,253,138,1)}input[type=range]{-webkit-appearance:none;width:140px;margin:10px}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;border:none;height:24px;width:8px;border-radius:0;background:#4FFD8A;cursor:pointer;margin-top:-9pt}input[type=range]::-webkit-slider-runnable-track{width:100%;height:2px;cursor:pointer;background:rgba(46,132,68,1);border-radius:0;border:none}input[type=range]:focus::-webkit-slider-runnable-track{background:rgba(46,132,68,1)}input[type=range]:focus{outline:0}input[type=range]:disabled{opacity:.3}</style></head><body id=Reversed onresize=$.resizeElements();><span id=fps></span><div id=game-container class=canvas-wrap><div class=scanlines-overlay></div><div id=start-screen class="gm open"><h1 class="station-title start">VOID</h1><p>Welcome Trader.</p><p>This is a cruel UNIVERSE and if you're to avoid assassination by pirates you must quickly seek refuge at a StarBase.</p><p>You must trade wisely between bases if you're to afford the upgrades you need to survive out here.</p><p>Good luck</p><b>Controls:</b><p>[Left Mouse] - Engage Thrusters</p><p>[Right Mouse] - Fire Weapons</p><p>[P] - Pause Game play</p><div class=devby>Developed for JS13k by PETER BIENEK - <a href=https://twitter.com/pbienek_>@pbienek_</a></div><span class="exit-button start" onclick=$.UI.startGame()>START</span></div><div id=station-menu class=gm><h3 class=station-title></h3><span class=monnies>credits: <span id=credits></span><span class=lwrC>c</span></span><div class=tabs><span id=marketTab onclick="$.UI.handleTabs('market');" class="tab active">Market</span> <span id=servicesTab onclick="$.UI.handleTabs('services');" class=tab>Services</span> <span id=upgradesTab onclick="$.UI.handleTabs('upgrades');" class=tab>Upgrades</span> <span id=inventoryTab onclick="$.UI.handleTabs('inventory');" class=tab>Inventory</span></div><div id=market class="warez active"><table cellspacing=0 cellpadding=0><thead><tr><th>QNT</th><th>ITEM</th><th>DESCRIPTION</th><th>PRICE</th></tr></thead><tbody id=market_stock></tbody></table></div><div id=inventory class=warez><table cellspacing=0 cellpadding=0><thead><tr><th>QNT</th><th>ITEM</th><th>NET VALUE</th><th>SALE PRICE</th><th>PROFIT</th></tr></thead><tbody id=cargobay></tbody></table></div><div id=services class=warez><table cellspacing=0 cellpadding=0><thead><tr><th>ITEM</th><th>AMOUNT</th><th>PRICE</th></tr></thead><tbody id=services-menu><tr id=fuel><td>REFUEL</td><td><input onchange="$.UI.servicesRange('fuel')" id=fuel_slider type=range min=0 max=1000 step=1 value=0></td><td class=amount>0<span class=lwrC>c</span></td><td><button class=button onclick="$.UI.buyService('fuel')">BUY</button></td></tr><tr id=hull><td>REPAIR HULL</td><td><input onchange="$.UI.servicesRange('hull')" id=hull_slider type=range min=0 max=1000 step=1 value=0></td><td class=amount>0.00<span class=lwrC>c</span></td><td><button class=button onclick="$.UI.buyService('hull')">BUY</button></td></tr></tbody></table></div><div id=upgrades class=warez><table cellspacing=0 cellpadding=0><thead><tr><th>NAME</th><th>DESCRIPTION</th><th>LEVEL</th><th>PRICE</th></tr></thead><tbody id=upgrades_table></tbody></table></div><span class=exit-button onclick=$.UI.closeStationMenu()>Exit</span></div><canvas id=unv class="canvas_layer main"></canvas><canvas id=objects class="canvas_layer main"></canvas><canvas id=sps class="canvas_layer main"></canvas><canvas id=projectiles class="canvas_layer main"></canvas><canvas id=pl class="canvas_layer main"></canvas><canvas id=pas class="canvas_layer main"></canvas><div id=uie><div class=hud><span class="gauge hull"><div class=bar><div class=remaining></div></div><span class=label>HULL</span></span> <span class="gauge shields"><div class=bar><div class=remaining></div></div><span class=label>SHIELDS</span></span><div class="gauge fuel"><div class=bar><div class=remaining></div></div><span class=label>FUEL</span></div><div class=ve-meter></div><div id=message></div><div class=map><canvas id=sp-map class=canvas_layer width=150 height=150></canvas></div></div></div></div><script>$ = {}</script><script>function speedLimit(t,e){return Math.abs(t)>e&&(t=t>0?e:0-e),t}function outOfBounds(t,e){return t>this.screenW||0>t||e>this.screenH||0>e}function getDistance(t,e,i,s){var a,n=0;return a=t-i,a*=a,n=e-s,n*=n,Math.sqrt(a+n)}function normalize(t){var e=Math.sqrt(t.x*t.x+t.y*t.y);return t.x/=e,t.y/=e,t}function truncate(t,e){var i=e/2;return i=1>i?1:i,{x:t.x*i,y:t.y*i}}function getRandomNum(t,e){return Math.floor(Math.random()*(e-t+1))+t}function getRandomNumFloat(t,e){return Math.random()*(e-t)+t}function getStationByID(t){for(var e=0;e<$.Unv.lns.length;e++)if($.Unv.lns[e].id===t)return $.Unv.lns[e]}function findCloseObjects(t,e,i){var s=[],a=[];s=$.Unv.sps.concat($.Unv.lns,$.Unv.objects);for(var n=s.length;n--;){var r=getDistance(t,e,s[n].x,s[n].y);i>=r&&a.push(s[n])}return a}function checkSpacing(t,e,i,s){for(var a=0,n=i.length;n--;){var r=getDistance(t,e,i[n].x,i[n].y);s>r&&a++}return!a}function fps(){}function warezListGenerator(){return[{name:"Food",price:getRandomNum(40,60),description:"Simple organic products",volume:1},{name:"Textiles",price:getRandomNum(60,80),description:"Unprocessed fabrics",volume:1},{name:"Radioactives",price:getRandomNum(200,280),description:"Ores and by-products",volume:1},{name:"Slaves",price:getRandomNum(80,110),description:"Usually humanoid",volume:1},{name:"Liquor/Wines",price:getRandomNum(250,320),description:"Exotic spirits from unearthy flora",volume:1},{name:"Luxuries",price:getRandomNum(800,1100),description:"Perfumes, Spices, Coffee",volume:1},{name:"Narcotics",price:getRandomNum(1100,1400),description:"Tobacco, Arcturan Megaweed",volume:1}]}Number.prototype.clamp=function(t,e){return Math.min(Math.max(this,t),e)};var intersectionCheck=function(t,e){var i={x:t.x,y:t.y},s={x:t.x+t.width,y:t.y+t.height},a={x:e.x,y:e.y},n={x:e.x+e.width,y:e.y+e.width};return!(s.y<a.y||i.y>n.y||s.x<a.x||i.x>n.x)};$.KM=function(){},$.KM.prototype={up:null,down:null,left:null,right:null,mousePos:0},$.KM.init=function(){this.up=!1,this.down=!1,this.left=!1,this.right=!1,this.mousePos={},this.mouseDown=!1,this.leftMouseDown=!1,this.rightMouseDown=!1,this.map={},window.addEventListener("keydown",this.getKey,!1),window.addEventListener("keyup",this.getKey,!1),window.addEventListener("keypress",function(t){112==t.charCode&&($.paused?($.UI.closeMessage(),$.paused=!1):($.paused=!0,$.UI.showMessage("GAME PAUSED")))},!1),window.addEventListener("mousemove",this.getMousePos,!1),window.oncontextmenu=function(){return!1},window.addEventListener("mousedown",function(t){this.mouseDown=!0,1===t.which&&(this.leftMouseDown=!0),3===t.which&&(t.preventDefault(),this.rightMouseDown=!0)}.bind(this),!1),window.addEventListener("mouseup",function(t){this.mouseDown=!1,1===t.which&&(this.leftMouseDown=!1),3===t.which&&(t.preventDefault(),this.rightMouseDown=!1)}.bind(this),!1),document.getElementById("game-container").addEventListener("mousemove",function(t){this.mousePos={x:t.offsetX||t.layerX,y:t.offsetY||t.layerY}}.bind(this))},$.KM.getKey=function(t){var e=t.keyCode;(87===e||83===e||65===e||68===e||32===e||70==e||80==e)&&($.KM.map[e]="keydown"==t.type)},$.Projectiles=function(){},$.Projectiles.init=function(){this.cs=$.projectilesCanvas,this.bullets=[]},$.Projectiles.add=function(t,e,i,s,a,n,r){var o={width:a,height:n,x:e.x,y:e.y,or:e,angle:t,speed:i,vel:{x:e.velX,y:e.velY},colour:s,hp:r,owner:"pl",rotation:t,spawnTime:$.gameTime};this.bullets.push(o)},$.Projectiles.process=function(t,e){t.x+=t.speed*Math.cos(t.angle)+t.vel.x,t.y+=t.speed*Math.sin(t.angle)+t.vel.y,this.drawX=$.Unv.offsetX+t.x,this.drawY=$.Unv.offsetY+t.y,$.gameTime-t.spawnTime>50?this.deleteMe(e):(this.hitCheck(t,e),this.draw(this.drawX,this.drawY,t.colour,t.width,t.height,t.rotation))},$.Projectiles.deleteMe=function(t){this.bullets.splice(t,1)},$.Projectiles.hitCheck=function(t,e){for(var i=$.Unv.sps.length;i--;){var s={width:$.Unv.sps[i].width,height:$.Unv.sps[i].height,x:$.Unv.sps[i].x,y:$.Unv.sps[i].y};t.or.faction!==$.Unv.sps[i].faction&&intersectionCheck(t,s)&&$.Unv.sps[i].faction!==t.or.faction&&($.Unv.sps[i].hit(t.hp),this.deleteMe(e))}"pl"!==t.or.faction&&intersectionCheck(t,$.Pl)&&($.Pl.hit(t.hp,t.or.id),this.deleteMe(e))},$.Projectiles.casualUpdate=function(){},$.Projectiles.update=function(){for(var t=this.bullets.length;t--;)this.process(this.bullets[t],t)},$.Projectiles.draw=function(t,e,i,s,a,n){var r=this.cs.createLinearGradient(0,0,s,0);r.addColorStop(0,"rgba("+i+",0)"),r.addColorStop(1,"rgba("+i+",1)"),this.cs.save(),this.cs.translate(t,e),this.cs.rotate(n),this.cs.beginPath(),this.cs.rect(0,0,s,a),this.cs.fillStyle=r,this.cs.fill(),this.cs.rotate(-1),this.cs.translate(-1*t,-1*e),this.cs.restore()},$.ParticleEmiter=function(){},$.ParticleEmiter.prototype={init:function(t,e,i,s){this.id=Math.floor(1e6*Math.random()),this.cs=$.projectilesCanvas,this.type=i,this.or={x:t,y:e,sp:s||null},this.startTime=$.gameTime,this.pas=[],"thrust"===i&&this.generateThrust(),"explosion"===i&&this.generateExplosion(),"shield"===i&&this.generateShield()},generateExplosion:function(){this.duration=100,this.volume=80;for(var t=360/this.volume*(180/Math.PI),e=0;e<this.volume;e++){Math.floor(10*Math.random())+2,Math.round(Math.random()*$.screenW+1),Math.round(Math.random()*$.screenH+1);t+=getRandomNumFloat(-.2,.2),this.pas.push({started:!1,x:this.or.x,y:this.or.y,vel:{x:0,y:0},ac:.2,friction:.01,opacity:1,width:getRandomNum(10,90),height:1,colour:"rgba(255,255,255,1)",colourCode:"255,255,255",angle:t*e,rotation:t*e,sp:this.or.sp,age:1})}setTimeout(function(){for(var t=$.paInstances.length;t--;)$.paInstances[t].id===this.id&&$.paInstances.splice(t,1);delete this}.bind(this),100*this.duration)},updateExplosionParticle:function(t){var e=t.angle,i=t.ac*(t.width/8);t.width=t.width,t.opacity=t.opacity-t.age++/8e3,t.colour="rgba("+t.colourCode+","+t.opacity+")",t.age++,t.started=!0,t.vel.x=i*Math.cos(e),t.vel.y=i*Math.sin(e),t.x+=t.vel.x,t.y+=t.vel.y},drawExplosionParticle:function(t){var e=$.Unv.offsetX+t.x,i=$.Unv.offsetY+t.y;this.cs.save(),this.cs.translate(e,i),this.cs.rotate(t.rotation),this.cs.beginPath(),this.cs.rect(0,0,t.width,t.height),this.cs.fillStyle=t.colour,this.cs.fill(),this.cs.rotate(-1*t.rotation),this.cs.translate(-1*e,-1*i),this.cs.restore()},generateThrust:function(){this.duration=3,this.volume=1;for(var t,e,i=0,s=0;s<this.volume;s++)t=Math.floor(10*Math.random())+2,e=Math.round(Math.random()*$.screenW+1),i=Math.round(Math.random()*$.screenH+1),this.pas.push({started:!1,x:this.or.x-=this.or.sp.width/2*Math.cos(this.or.sp.rotation),y:this.or.y-=this.or.sp.width/2*Math.sin(this.or.sp.rotation),vel:{x:0,y:0},ac:.2,friction:.01,opacity:1,size:t,colour:"rgba(79, 253, 138,1)",colourCode:"79, 253, 138",angle:getRandomNumFloat(this.or.sp.rotation-.5,this.or.sp.rotation+.5),dest:{x:e,y:i},rotation:Math.atan2(getRandomNumFloat(0,3),getRandomNumFloat(0,3)),sp:this.or.sp,age:1});setTimeout(function(){for(var t=$.paInstances.length;t--;)$.paInstances[t].id===this.id&&$.paInstances.splice(t,1);delete this}.bind(this),100*this.duration)},updateThrustParticle:function(t){var e=t.angle,i=t.ac*(t.size/4);t.size=1*t.age,t.opacity=t.opacity-t.age++/600,t.colour="rgba("+t.colourCode+","+t.opacity+")",t.age++,t.started=!0,t.vel.x=i*Math.cos(e),t.vel.y=i*Math.sin(e),t.x+=t.vel.x,t.y+=t.vel.y},drawThrustParticle:function(t){var e=$.Unv.offsetX+t.x,i=$.Unv.offsetY+t.y;this.cs.save(),this.cs.translate(e,i),this.cs.rotate(t.rotation),this.cs.beginPath(),this.cs.arc(0,0,t.size/2,0,2*Math.PI,!1),this.cs.fillStyle=t.colour,this.cs.fill(),this.cs.rotate(-1*t.rotation),this.cs.translate(-1*e,-1*i),this.cs.restore()},generateShield:function(){this.duration=3,this.volume=1;this.pas.push({started:!1,x:this.or.x,y:this.or.y,opacity:.2,size:this.or.sp.width,colour:"rgba(93, 215, 255,0.15)",colourCode:"93, 215, 255",sp:this.or.sp,age:1}),setTimeout(function(){for(var t=$.paInstances.length;t--;)$.paInstances[t].id===this.id&&$.paInstances.splice(t,1);delete this}.bind(this),500*this.duration)},updateShieldParticle:function(t){t.opacity=t.opacity-.01,t.colour="rgba("+t.colourCode+","+t.opacity+")",t.age++,t.started=!0,t.x=t.sp.x,t.y=t.sp.y},drawShieldParticle:function(t){var e=$.Unv.offsetX+t.x,i=$.Unv.offsetY+t.y;this.cs.save(),this.cs.translate(e,i),this.cs.beginPath(),this.cs.arc(0,0,t.size,0,2*Math.PI,!1),this.cs.fillStyle=t.colour,this.cs.fill(),this.cs.translate(-1*e,-1*i),this.cs.restore()},update:function(){if("thrust"===this.type)for(var t=this.pas.length;t--;)this.updateThrustParticle(this.pas[t]),this.drawThrustParticle(this.pas[t]);if("explosion"===this.type)for(var t=this.pas.length;t--;)this.updateExplosionParticle(this.pas[t]),this.drawExplosionParticle(this.pas[t]);if("shield"===this.type)for(var t=this.pas.length;t--;)this.updateShieldParticle(this.pas[t]),this.drawShieldParticle(this.pas[t])}},$.Pl=function(){},$.Pl.init=function(){this.id="PLAYER",this.cs=$.plCanvas,this.x=$.Unv.width/2,this.y=$.Unv.width/2,this.center={x:0,y:0},this.radius=40,this.width=60,this.height=30,this.spSVG=plShip,this.rotation=0,this.ve={x:0,y:0},this.topSpeed=7,this.friction=0,this.ac=.04,this.touching=!1,this.cargoBay={},this.hull={capacity:200,total:200},this.shield={capacity:200,total:200,regenerationRate:.1},this.fuel={capacity:200,total:200},this.laser={coolDown:5,hp:20,speed:8,width:40,height:2,colour:"223, 88, 235"},this.lastShot=0,this.closestStation={},this.dockingRange=!1,this.docked=!1,this.dead=!1,this.credits=1e3,this.faction="pl",this.closeObjects=[],this.radarRadius=4e3},$.Pl.movement=function(){function t(){var t=$.KM.mousePos.x-$.screenW/2,e=$.KM.mousePos.y-$.screenH/2,i=Math.atan2(e,t);return i}this.keyboardControls(),$.KM.leftMouseDown&&this.fuel.total>0&&!this.dead&&(this.ve.x+=this.ac*Math.cos(this.rotation),this.ve.y+=this.ac*Math.sin(this.rotation),this.fuel.total-=.1,this.thrustEffect()),this.ve.x=speedLimit(this.ve.x,this.topSpeed),this.ve.y=speedLimit(this.ve.y,this.topSpeed),this.collisionDetection(),this.x+=this.ve.x,this.y+=this.ve.y,this.rotation=t()},$.Pl.collisionDetection=function(){for(var t=!1,e=this.closeObjects.length;e--;){var i=getDistance(this.x,this.y,this.closeObjects[e].x,this.closeObjects[e].y);i<=this.radius+this.closeObjects[e].radius&&(this.touching||(this.ve.x*=-.5,this.ve.y*=-.5),this.touching=!0,t=!0)}this.touching=t},$.Pl.keyboardControls=function(){$.KM.map[70]&&this.dockingRange&&this.dock()},$.Pl.thrustEffect=function(){var t=new $.ParticleEmiter;t.init(this.x,this.y,"thrust",this),$.paInstances.push(t)},$.Pl.casualUpdate=function(){this.docked||($.KM.rightMouseDown&&this.fireWeapon(),this.dockingCheck(),this.closeObjects=findCloseObjects(this.x,this.y,1e3)),this.shield.total<this.shield.capacity&&(this.shield.total+=this.shield.regenerationRate)},$.Pl.dockingCheck=function(){for(var t=500,e=!0,i=$.Unv.lns.length;i--&&e;){var s=getDistance(this.x,this.y,$.Unv.lns[i].x,$.Unv.lns[i].y);t>=s?(this.closestStation=$.Unv.lns[i],this.dockingRange=!0,e=!1,$.UI.showMessage('<span class="title">'+$.Unv.lns[i].name+'</span><br /> Press "F" to dock with this Space Station.')):($.UI.messageIsOpen&&$.UI.closeMessage(),this.dockingRange=!1)}},$.Pl.dock=function(){this.docked=!0,this.ve.x=0,this.ve.Y=0,this.fuel.total=Math.round(this.fuel.total),this.fuel.hull=Math.round(this.hull.total),this.closestStation.dockedShips++,$.UI.showStationMenu(this.closestStation)},$.Pl.undock=function(){this.docked=!1,this.closestStation.dockedShips--,this.cleanInventory()},$.Pl.cleanInventory=function(){for(var t in this.cargoBay)this.cargoBay[t].qnt<=0&&delete this.cargoBay[t]},$.Pl.fireWeapon=function(){var t=Math.atan2($.KM.mousePos.y-$.screenH/2,$.KM.mousePos.x-$.screenW/2),e=(Math.sqrt(this.ve.x*this.ve.x+this.ve.y*this.ve.y)+this.laser.speed,{x:this.x,y:this.y});e={x:e.x+=40*Math.cos(t),y:e.y+=40*Math.sin(t),velX:this.ve.x,velY:this.ve.y,faction:this.faction,id:this.id},$.gameTime>this.lastShot+this.laser.coolDown&&($.Projectiles.add(t,e,this.laser.speed,this.laser.colour,this.laser.width,this.laser.height,this.laser.hp),this.lastShot=$.gameTime)},$.Pl.hit=function(t){if(!this.docked){if(this.shield.total>0){this.shield.total-=t;var e=new $.ParticleEmiter;e.init(this.x,this.y,"shield",this),$.paInstances.push(e)}else if(this.hull.total-=t,this.hull.total<=0){var e=new $.ParticleEmiter;e.init(this.x,this.y,"explosion",this),$.paInstances.push(e),this.ve.x=0,this.ve.y=0,this.dead=!0}$.UI.hit()}},$.shieldHit=function(){},$.Pl.update=function(){this.docked||this.movement(),this.draw()},$.Pl.draw=function(){if(!this.dead){this.cs.save(),this.cs.translate($.screenW/2,$.screenH/2),this.cs.rotate(this.rotation);for(var t in this.spSVG)this.cs.fillStyle=this.spSVG[t].colour,this.cs.fill(this.spSVG[t].shape);this.cs.restore()}},$.Location=function(){},$.Location.prototype={init:function(t,e){this.id=Math.floor(1e6*Math.random()),this.name="TERRAN STATION",this.cs=$.objectsCanvas,this.x=t,this.y=e,this.radius=200,this.size=this.radius,this.center={x:this.x+this.size,y:this.y+this.size},this.type="station",this.drawX=0,this.drawY=0,this.rotation=0,this.discovered=!1,this.spSVG=station,this.ve={x:0,y:0},this.stock=this.stockInventory(),this.lastStockUpdate=0,this.stockUpdateFrequency=600,this.dockedShips=0,this.services={fuel:{cost:.3},hull:{cost:1}},this.credits=1e4,this.fuzzShipsCount=0,this.tradeShipsCount=0},spawnShips:function(){if(0===this.fuzzShipsCount){var t=new $.FuzzShip;t.init(this),$.Unv.sps.push(t),this.fuzzShipsCount++}if(0===this.tradeShipsCount){var e=new $.TradingShip;e.init(this),$.Unv.sps.push(e),this.tradeShipsCount++}},stockInventory:function(){function t(t){a.hasOwnProperty(t.name)?a[t.name].qnt++:a[t.name]={price:t.price,rrp:t.price,qnt:1,description:t.description}}for(var e=1e5,i=warezListGenerator(),s=i.length-1,a={},n=1e7,r=0;r<i.length;r++)i[r].price<n&&(n=i[r].price);for(;e>=n;){var o=getRandomNum(0,s);i[o].price<=e&&(t(i[o]),e-=i[o].price)}return a},updateStockPrices:function(){if($.gameTime>=this.lastStockUpdate+this.stockUpdateFrequency&&0===this.dockedShips){for(var t in this.stock){var e=this.stock[t].rrp/1e3,i=50-this.stock[t].qnt;this.stock[t].price=this.stock[t].rrp+Math.round(e*i)}this.lastStockUpdate=$.gameTime}},buyItem:function(t,e){if(e.cargoBay.hasOwnProperty(t)){e.cargoBay[t].qnt++,e.cargoBay[t].paidValues.push(this.stock[t].price),e.cargoBay[t].netValue=0;for(var i=0;i<e.cargoBay[t].paidValues.length;i++)e.cargoBay[t].netValue+=e.cargoBay[t].paidValues[i];e.cargoBay[t].avgPrice=e.cargoBay[t].netValue/e.cargoBay[t].qnt||0}else e.cargoBay[t]={paidValues:[this.stock[t].price],netValue:this.stock[t].price,avgPrice:this.stock[t].price,name:t,qnt:1,description:this.stock[t].description};e.credits-=this.stock[t].price,this.stock[t].qnt--},sellItem:function(t,e){this.stock[t].qnt++,e.credits+=this.stock[t].price,this.stock[t].qnt++,e.cargoBay[t].qnt--,e.cargoBay[t].paidValues.pop(),e.cargoBay[t].netValue=0;for(var i=0;i<e.cargoBay[t].paidValues.length;i++)e.cargoBay[t].netValue+=e.cargoBay[t].paidValues[i];e.cargoBay[t].avgPrice=e.cargoBay[t].netValue/e.cargoBay[t].qnt||0},buyService:function(t,e,i){e[t].total+=parseInt(i),e.credits-=this.services[t].cost*i,this.credits+=this.services[t].cost*i},casualUpdate:function(){this.updateStockPrices(),this.spawnShips()},update:function(){this.drawX=$.Unv.offsetX+this.x,this.drawY=$.Unv.offsetY+this.y,this.rotation+=.002,this.draw()},draw:function(){this.cs.save(),this.cs.translate(this.drawX,this.drawY),this.cs.rotate(this.rotation);for(var t in this.spSVG)this.cs.fillStyle=this.spSVG[t].colour,this.cs.fill(this.spSVG[t].shape);this.cs.rotate(-1*this.rotation),this.cs.translate(-1*this.drawX,-1*this.drawY),this.cs.restore()}};var plShip={main:{shape:new Path2D("M 10,-15 -25,-15 -30,-11 -30,-5 -25,-5 -25,0 -25,5 -30,5 -30,11 -25,15 10,15 30,5 30,0 30,0 30,-5"),colour:"#fff"},shadow1:{shape:new Path2D("M 10.1,-15 -25,-15 -30,-11 -30,-11 4,-11"),colour:"#CFCFCF"},shadow2:{shape:new Path2D("M 10.1,15 -25,15 -30,11 -30,11 4,11"),colour:"#CFCFCF"}},pirateShip={main:{shape:new Path2D("M 29.8,0 9,-10 11,-15 0,-11 -11,-20 -2.2,-29.9 -30,-24.6 -21,-15 -26,0 -21,15.1 -30,24.7 -2.2,30 -11,20.1 0,11.1 11,15.1 9,10.1 	"),colour:"#fff"},shadow1:{shape:new Path2D("M -30,-24.6 -21,-15 0,-11 -11,-20"),colour:"#CFCFCF"},shadow2:{shape:new Path2D("M 0,-11 9,-10 11,-15"),colour:"#CFCFCF"},shadow3:{shape:new Path2D("M -30,24.7 -11,20.1 0,11.1 -21,15.1"),colour:"#CFCFCF"},shadow4:{shape:new Path2D("M 9,10.1 0,11.1 11,15.1"),colour:"#CFCFCF"}},cargoShip={main:{shape:new Path2D("M 50,-30 25,-30 25,-25 20,-25 20,-30 15,-30 15,-25 10,-25 10,-30 5,-30 5,-25 0,-25 0,-30 -5,-30 -5,-25 -10,-25 -10,-30 -15,-30 -15,-25 -20,-25 -20,-30 -25.1,-30 -25,-25 -30,-25 -30,-30 -50,-30 -60,-20 -60,-10 -50,-10 -50,0 -50,10 -60,10 -60,20 -50,30 -30,30 -30,25 -25,25 -25.1,30 -20,30 -20,25 -15,25 -15,30 -10,30 -10,25 -5,25 -5,30 0,30 0,25 5,25 5,30 10,30 10,25 15,25 15,30 20,30 20,25 25,25 25,30 50,30 60,7 60,0 60,-7"),colour:"#fff"}},fuzzShip={main:{shape:new Path2D("M 30,5 30,0 30,-5 0,-30 -30,-20 -30,-10 -25,-10 -25,0 -25,10 -30,10 -30,20 0,30"),colour:"#fff"},shadow1:{shape:new Path2D("M -25,-10 -25,10 0,0 30,-5 30,5 0,0"),colour:"#CFCFCF"},shadow2:{shape:new Path2D("M -30,-20 -30,-10 -25,-10 -0,-30"),colour:"#CFCFCF"},shadow3:{shape:new Path2D("M -30,20 -30,10 -25,10 -0,30"),colour:"#CFCFCF"}},station={main:{shape:new Path2D("M -200,0.3 -139,-140 0,-199 139,-140 200,0.3 139,139 0,200 -141,139"),colour:"#CFCFCF"},shadow1:{shape:new Path2D("M -200,0.3 0,-199 200,0.3 0.4,200"),colour:"#fff"},shadow2:{shape:new Path2D("M -69,-21 -69,20 0,20 70,20 70,-21 4,-21"),colour:"#CFCFCF"}};$.Ship=function(){},$.Ship.prototype={init:function(t){this.id=Math.floor(1e6*Math.random()),this.cs=$.spsCanvas,this.x=Math.floor(Math.random()*$.Unv.width)+1||0,this.y=Math.floor(Math.random()*$.Unv.height)+1||0,this.ve={x:0,y:0},this.topSpeed=0,this.friction=0,this.ac=0,this.mass=50,this.desiredRotation=0,this.rotation=0,this.home=t,this.potentialThreats=[],this.lastHit=0,this.td={x:0,y:0,ve:{x:0,y:0},distance:0,stoppingDistance:250},this.fleeTarget={x:0,y:0,ve:{x:0,y:0},distance:0,stoppingDistance:250},this.hitList={},this.hull={capacity:1e3,total:1e3},this.shield={capacity:200,total:200,regenerationRate:.1},this.fuel={capacity:1e3,total:1e3},this.station={},this.dockingRange=!1,this.docked=!1,this.finishedTrade=!1,this.timeDocked=0,this.dockDuration=50,this.bounty=0,this.mode="seek",this.firedAtBy="",this.closeObjects=[],this.create()},movement:function(){var t={},e={x:0,y:0},i=function(e){var i={x:e.x-this.x,y:e.y-this.y};i=normalize(i),e.distance=getDistance(this.x,this.y,e.x,e.y)-e.stoppingDistance;var s=Math.sqrt(this.ve.x*this.ve.x+this.ve.y*this.ve.y),a=s/this.ac*s*.5;a>=e.distance?(t={x:i.x*(this.topSpeed*(e.distance/a)),y:i.y*(this.topSpeed*(e.distance/a))},this.td.distance<=1&&(t={x:0,y:0})):t={x:i.x*this.topSpeed,y:i.y*this.topSpeed}}.bind(this),s=function(e){var i={x:this.x-e.x,y:this.y-e.y};i=normalize(i),t={x:i.x*this.topSpeed,y:i.y*this.topSpeed}}.bind(this),a=function(){var t=100,e=10,i={x:this.ve.x,y:this.ve.y},s=normalize(i),a={x:this.ve.x,y:this.ve.y};a=normalize(a),a={x:a.x*(.5*t*2/this.topSpeed),y:a.y*(.5*t*2/this.topSpeed)};var n=(this.ve.x+this.ve.y)/this.topSpeed,r={x:this.x+s.x*n,y:this.y+s.y*n},o=function(e){var i={x:this.x+s.x*t*.5,y:this.y+s.y*t*.5};return getDistance(e.x,e.y,r.x,r.y)<=e.size||getDistance(e.x,e.y,i.x,i.y)<=e.size||getDistance(e.x,e.y,this.x,this.y)<=e.size}.bind(this),h=function(){for(var t=null,e=$.Unv.lns.concat($.Unv.sps),i=0;i<e.length;i++){var s=e[i],a=o(s);a&&(null==t||getDistance(this.x,this.y,s.x,s.y)<getDistance(this.x,this.y,t.x,t.y))&&(t=s)}return t}.bind(this),c=h(),l={x:0,y:0};return null!=c?(l.x=r.x-c.center.x,l.y=r.y-c.center.y,l=normalize(l),l={x:l.x*e,y:l.y*e}):l={x:0,y:0},isNaN(l.x)&&isNaN(l.y)?{x:0,y:0}:l}.bind(this),n=function(){for(var t={x:0,y:0},e=80,i=0,s=5,a=0;a<this.closeObjects.length;a++){var n=this.closeObjects[a];n.id!=this.id&&getDistance(n.x,n.y,this.x,this.y)<=e&&(t.x+=n.x-this.x,t.y+=n.y-this.y,i++)}return 0!=i&&(t.x/=i,t.y/=i,t.x*=-1,t.y*=-1,t=normalize(t),t.x*=s,t.y*=s),t}.bind(this);"seek"===this.mode&&i(this.td),"flee"===this.mode&&s(this.td),"pursuit"===this.mode&&i(this.td),"evade"===this.mode&&evade(this.td);var r=a(),o=n();e={x:t.x-this.ve.x+r.x+o.x,y:t.y-this.ve.y+r.y+o.y},0!==e.x&&0!==e.y&&(e=truncate(e,this.ac),e.x=e.x/this.mass,e.y=e.y/this.mass);var h={x:this.ve.x+e.x,y:this.ve.y+e.y};if(h=truncate(h,this.ac),this.ve.x=h.x,this.ve.y=h.y,!this.docked){this.x+=this.ve.x,this.y+=this.ve.y;var c=function(){var t=this.td.x-this.x,e=this.td.y-this.y,i=Math.atan2(e,t);return i}.bind(this);this.rotation=c()}},combatMode:function(){this.potentialThreats.length>0?(this.fleeTarget.x=this.potentialThreats[0].x,this.fleeTarget.y=this.potentialThreats[0].y,this.fleeTarget.ve.x=this.potentialThreats[0].ve.x,this.fleeTarget.ve.y=this.potentialThreats[0].ve.y,this.mode="flee"):(this.mode="seek",this.td.x=this.potentialTargets[0].x,this.td.y=this.potentialTargets[0].y,this.td.ve.x=this.potentialTargets[0].ve.x,this.td.ve.y=this.potentialTargets[0].ve.y,this.td.distance<=this.fireRange&&this.fireAtTarget())},hit:function(t,e){if(!this.docked){this.shield.total>0?this.shield.total-=t:this.hull.total-=t;var i=new $.ParticleEmiter;i.init(this.x,this.y,"shield",this),$.paInstances.push(i),this.hitList[e]++,this.firedAtBy=e,this.lastHit=$.gameTime}this.hull.total<=0&&this.die()},die:function(){for(var t=$.Unv.sps.length;t--;)$.Unv.sps[t].id===this.id&&$.Unv.sps.splice(t,1);"police"===this.type&&this.home.fuzzShipsCount--,"cargo sp"===this.type&&this.home.tradeShipsCount--,"pirate"===this.type&&$.Unv.pirateShipCount--;var e=new $.ParticleEmiter;e.init(this.x,this.y,"explosion",this),$.paInstances.push(e),delete this},update:function(){this.drawX=$.Unv.offsetX+this.x,this.drawY=$.Unv.offsetY+this.y,this.movement(),this.draw()},casualUpdate:function(){this.ai(),this.shield.total<this.shield.capacity&&!this.dead&&(this.shield.total+=this.shield.regenerationRate)},draw:function(){if(!this.atHome){this.cs.save(),this.cs.translate(this.drawX,this.drawY),this.cs.rotate(this.rotation);for(var t in this.spSVG)this.cs.fillStyle=this.spSVG[t].colour,this.cs.fill(this.spSVG[t].shape);this.cs.rotate(-1*this.rotation),this.cs.translate(-1*this.drawX,-1*this.drawY),this.cs.restore()}}},$.PirateShip=function(){$.Ship.call(this)},$.PirateShip.prototype=new $.Ship,$.PirateShip.prototype.constructor=$.PirateShip,$.PirateShip.prototype.create=function(){this.spSVG=pirateShip,this.width=60,this.height=60,this.currentTarget=null,this.potentialTargets=[],this.targetRange=2e3,this.fireRange=800,this.lastShot=0,this.laser={coolDown:3,hp:10,speed:8,width:40,height:2,colour:"233,36,67"},this.topSpeed=11,this.ac=.05,this.faction="outlaw",this.type="pirate",this.bounty=40},$.PirateShip.prototype.ai=function(){this.closeObjects=findCloseObjects(this.x,this.y,2e3),getDistance(this.x,this.y,$.Pl.x,$.Pl.y)<=2e3&&this.closeObjects.push($.Pl),this.potentialTargets=[],this.potentialThreats=[];for(var t=this.closeObjects.length;t--;){var e=this.closeObjects[t];$.gameTime>this.lastHit+5&&!e.docked&&!e.dead&&"station"!==e.type&&"outlaw"!==e.faction&&(this.potentialTargets.push({id:e.id,x:e.x,y:e.y,ve:{x:e.ve.x,y:e.ve.y},faction:e.faction,priority:this.priority(e)}),"police"===e.type&&this.potentialThreats.push({id:e.id,x:e.x,y:e.y,ve:{x:e.ve.x,y:e.ve.y},faction:e.faction,priority:this.priority(e)}))}this.potentialTargets.sort(function(t,e){return t.priority<e.priority?1:t.priority>e.priority?-1:0}),this.potentialTargets.length>0?this.combatMode():(this.mode="seek",(this.td.distance<200||0===this.td.x&&0===this.td.y)&&(this.td.x=getRandomNum(0,$.Unv.width),this.td.y=getRandomNum(0,$.Unv.height),this.td.ve.x=0,this.td.ve.y=0))},$.PirateShip.prototype.priority=function(t){var e=0;return this.hitList[t.id]&&(e+=this.hitList[t.id]),e},$.PirateShip.prototype.fireAtTarget=function(){if($.gameTime>this.lastShot+this.laser.coolDown){var t=Math.atan2(this.potentialTargets[0].y-this.y,this.potentialTargets[0].x-this.x),e={x:this.x,y:this.y};e={x:e.x+=40*Math.cos(t),y:e.y+=40*Math.sin(t),velX:this.ve.x,velY:this.ve.y,faction:this.faction},$.Projectiles.add(t,e,this.laser.speed,this.laser.colour,this.laser.width,this.laser.height,this.laser.hp),this.lastShot=$.gameTime}},$.TradingShip=function(){$.Ship.call(this)},$.TradingShip.prototype=new $.Ship,$.TradingShip.prototype.constructor=$.TradingShip,$.TradingShip.prototype.create=function(){this.spSVG=cargoShip,this.width=120,this.height=60,this.radius=80,this.targetRange=2e3,this.topSpeed=5,this.ac=.05,this.faction="tradeAlliance",this.type="cargo sp",this.stationList=[],this.credits=1e3,this.cargoSpace=20,this.cargoBay={},this.x=this.home.x+400,this.y=this.home.y+400},$.TradingShip.prototype.ai=function(){var t=function(){if(0===this.stationList.length){for(var t in $.Unv.lns)$.Unv.lns[t].id!==this.station.id&&this.stationList.push({id:$.Unv.lns[t].id,x:$.Unv.lns[t].x,y:$.Unv.lns[t].y});this.stationList.sort(function(t,e){var i=getDistance(this.x,this.y,t.x,t.y),s=getDistance(this.x,this.y,e.x,e.y);return i>s?1:-1}.bind(this)),this.td.x=this.stationList[0].x,this.td.y=this.stationList[0].y,this.td.ve.x=0,this.td.ve.y=0}}.bind(this);t(),this.td.distance<200&&this.td.distance>0&&!this.docked&&(this.dockingRange=!0,this.docked=!0,this.station=getStationByID(this.stationList[0].id),this.timeDocked=$.gameTime,this.station.dockedShips++),this.docked&&(this.finishedTrade?$.gameTime>=this.timeDocked+this.dockDuration&&(this.stationList.splice(0,1),t(),this.td.x=this.stationList[0].x,this.td.y=this.stationList[0].y,this.td.ve.x=0,this.td.ve.y=0,this.docked=!1,this.finishedTrade=!1,this.station.dockedShips--):this.tradeGoods())},$.TradingShip.prototype.tradeGoods=function(){var t=[];for(var e in this.cargoBay)if(this.cargoBay[e].avgPrice<this.station.stock[e].price){for(var i=0;i<this.cargoBay[e].qnt;i++)this.station.sellItem(e,this);t.push(e)}var s=[];for(var e in this.station.stock)-1===t.indexOf(e)&&s.push(e);for(var a=1e7,n=0;n<s.length;n++)this.station.stock[s[n]].price<a&&(a=this.station.stock[s[n]].price);for(;this.credits>=a;){var e=getRandomNum(0,s.length-1);if(!(this.station.stock[s[e]].qnt>0))break;this.station.stock[s[e]].price<=this.credits&&this.station.buyItem(s[e],this)}this.finishedTrade=!0},$.FuzzShip=function(){$.Ship.call(this)},$.FuzzShip.prototype=new $.Ship,$.FuzzShip.prototype.constructor=$.FuzzShip,$.FuzzShip.prototype.create=function(){this.spSVG=fuzzShip,this.width=60,this.height=60,this.currentTarget=null,this.potentialTargets=[],this.targetRange=2e3,this.fireRange=800,this.lastShot=0,this.laser={coolDown:2,hp:20,speed:11,width:40,height:2,colour:"36,213,243"},this.topSpeed=9,this.ac=.05,this.faction="tradeAlliance",this.type="police",this.x=this.home.x,this.y=this.home.y,this.atHome=!1},$.FuzzShip.prototype.ai=function(){this.closeObjects=findCloseObjects(this.home.x,this.home.y,2e3),getDistance(this.home.x,this.home.y,$.Pl.x,$.Pl.y)<=2e3&&this.closeObjects.push($.Pl),this.potentialTargets=[];for(var t=this.closeObjects.length;t--;){var e=this.closeObjects[t];e.faction!==this.faction&&e.bounty>0&&this.potentialTargets.push({id:e.id,x:e.x,y:e.y,ve:{x:e.ve.x,y:e.ve.y},faction:e.faction,priority:this.priority})}this.potentialTargets.sort(function(t,e){return t.priority<e.priority?1:t.priority>e.priority?-1:0}),this.potentialTargets.length>0?this.attackMode():(this.mode="seek",this.td.x=this.home.x+250,this.td.y=this.home.y+250,this.td.ve.x=0,this.td.ve.y=0)},$.FuzzShip.prototype.priority=function(t){var e=0;return"pirate"===t.faction&&(e+=10),this.hitList[t.id]&&(e+=this.hitList[t.id]),e},$.FuzzShip.prototype.attackMode=function(){this.atHome=!1,this.combatMode()},$.FuzzShip.prototype.fireAtTarget=function(){if($.gameTime>this.lastShot+this.laser.coolDown){var t=Math.atan2(this.potentialTargets[0].y-this.y,this.potentialTargets[0].x-this.x),e={x:this.x,y:this.y};e={x:e.x+=40*Math.cos(t),y:e.y+=40*Math.sin(t),velX:this.ve.x,velY:this.ve.y,faction:this.faction},$.Projectiles.add(t,e,this.laser.speed,this.laser.colour,this.laser.width,this.laser.height,this.laser.hp),this.lastShot=$.gameTime}},$.Unv=function(){},$.Unv.init=function(){this.cs=$.unvCanvas,this.width=6e4,this.height=6e4,this.offsetX=0,this.offsetY=0,this.lns=[],this.sps=[],this.objects=[],this.starLayerWidth=$.screenW,this.starLayerHeight=$.screenH,this.starsLayers=[],this.spawnLocations(13),this.maxPirateShips=12,this.pirateShipCount=0,this.createStars()},$.Unv.spawnLocations=function(t){for(var e=this.width/t*2;t;){var i=Math.floor(Math.random()*$.Unv.width),s=Math.floor(Math.random()*$.Unv.height);if(checkSpacing(i,s,this.lns,e)){var a=new $.Location;a.init(i,s),this.lns.push(a),t--}}},$.Unv.spawnShips=function(){if(this.pirateShipCount<this.maxPirateShips){var t=new $.PirateShip;t.init(),this.sps.push(t),this.pirateShipCount++}},$.Unv.spawnAsteroids=function(){},$.Unv.createStars=function(){function t(t){for(var e=[],i=0;100>i;i++)e.push({radius:1,brightness:getRandomNumFloat(.1,1),x:getRandomNum(0,$.Unv.starLayerWidth),y:getRandomNum(0,$.Unv.starLayerHeight),depth:getRandomNum(1,10)});return e}for(var e=0;3>e;e++)this.starsLayers.push(t(e))},$.Unv.paintStars=function(){for(var t=this.starsLayers.length;t--;)for(var e=this.starsLayers[t].length;e--;){this.starsLayers[t][e].x<0&&(this.starsLayers[t][e].x+=$.screenW),this.starsLayers[t][e].x>$.screenW&&(this.starsLayers[t][e].x-=$.screenW),this.starsLayers[t][e].y<0&&(this.starsLayers[t][e].y+=$.screenH),this.starsLayers[t][e].y>$.screenH&&(this.starsLayers[t][e].y-=$.screenH);var i=this.starsLayers[t][e].x-=$.Pl.ve.x/(20*this.starsLayers[t][e].depth),s=this.starsLayers[t][e].y-=$.Pl.ve.y/(20*this.starsLayers[t][e].depth),a=this.starsLayers[t][e].radius,n=this.starsLayers[t][e].brightness;
this.cs.beginPath(),this.cs.rect(i,s,a,a),this.cs.fillStyle="rgba(255,255,255,"+n+")",this.cs.fill()}},$.Unv.update=function(){this.offsetX=-($.Pl.x-$.screenW/2),this.offsetY=-($.Pl.y-$.screenH/2);for(var t=0;t<this.lns.length;t++)this.lns[t].update();for(var e=0;e<this.sps.length;e++)this.sps[e].update();this.draw()},$.Unv.casualUpdate=function(){for(var t=0;t<this.sps.length;t++)this.sps[t].casualUpdate();for(var e=0;e<this.lns.length;e++)this.lns[e].casualUpdate();this.spawnShips()},$.Unv.draw=function(){this.cs.clearRect(0,0,$.screenW,$.screenH),$.Unv.paintStars()},$.Upgrades={hull:{currentLevel:0,description:"The fragile material separating you and the void.",lvs:{lv1:{total:500,price:500},lv2:{total:750,price:1e3},lv3:{total:1e3,price:1500},lv4:{total:1250,price:2e3},lv5:{total:1500,price:2500}}},shield:{currentLevel:0,description:"Your first layer of defence.",lvs:{lv1:{total:500,price:500,regenerationRate:.2},lv2:{total:750,price:1e3,regenerationRate:.3},lv3:{total:1e3,price:1500,regenerationRate:.5},lv4:{total:1250,price:2e3,regenerationRate:.7},lv5:{total:1500,price:2500,regenerationRate:1}}},engine:{currentLevel:0,description:"Increase top speed, ACCELERATION & fuel capacity",lvs:{lv1:{topSpeed:7,ac:.04,price:500},lv2:{topSpeed:8,ac:.05,total:750,price:1e3},lv3:{topSpeed:9,ac:.06,total:1e3,price:1500},lv4:{topSpeed:10,ac:.07,total:1250,price:2e3},lv5:{topSpeed:13,ac:.1,total:1500,price:2500}}},laser:{currentLevel:0,description:"Everyone could do with a more powerful laser",lvs:{lv1:{coolDown:4,hp:25,speed:9,width:40,height:2,price:500},lv2:{coolDown:3,hp:35,speed:10,width:50,height:3,price:1e3},lv3:{coolDown:2,hp:50,speed:10,width:80,height:4,price:1500},lv4:{coolDown:2,hp:70,speed:13,width:90,height:5,price:2e3},lv5:{coolDown:1,hp:90,speed:15,width:120,height:6,price:2500}}},radar:{currentLevel:0,description:"The sooner you can spot trouble, the better.",lvs:{lv1:{radius:6e3,price:500},lv2:{radius:9e3,price:1e3},lv3:{radius:15e3,price:1500},lv4:{radius:2e4,price:2e3},lv5:{radius:35e3,price:2500}}}},$.UI=function(){},$.UI.init=function(){var t=document.getElementById("sp-map");this.mapCanvas=t.getContext("2d"),this.mapCanvas.imageSmoothingEnabled=!0,this.plPos={x:0,y:0},this.messageIsOpen=!1,this.stationMenuIsOpen=!1},$.UI.plotMap=function(){var t=document.getElementById("sp-map").offsetWidth,e=$.Unv.width/t;this.plPos.x=$.Pl.x/e,this.plPos.y=$.Pl.y/e,this.mapCanvas.clearRect(0,0,t,t);for(var i=0;i<$.Unv.lns.length;i++)if($.Unv.lns[i].discovered||getDistance($.Pl.x,$.Pl.y,$.Unv.lns[i].x,$.Unv.lns[i].y)<=$.Pl.radarRadius){$.Unv.lns[i].discovered=!0;var s=$.Unv.lns[i].x/e,a=$.Unv.lns[i].y/e;this.mapCanvas.beginPath(),this.mapCanvas.arc(s,a,3,0,2*Math.PI,!1),this.mapCanvas.fillStyle="#fff",this.mapCanvas.fill()}for(var i=0;i<$.Unv.sps.length;i++)if(!$.Unv.sps[i].atHome&&getDistance($.Pl.x,$.Pl.y,$.Unv.sps[i].x,$.Unv.sps[i].y)<=$.Pl.radarRadius){var s=$.Unv.sps[i].x/e,a=$.Unv.sps[i].y/e;this.mapCanvas.beginPath(),this.mapCanvas.arc(s,a,2,0,2*Math.PI,!1),"outlaw"===$.Unv.sps[i].faction?this.mapCanvas.fillStyle="#fa2444":"police"===$.Unv.sps[i].type?this.mapCanvas.fillStyle="#24cdeb":this.mapCanvas.fillStyle="#a2a2a7",this.mapCanvas.fill()}var n=$.Pl.radarRadius/e;this.mapCanvas.beginPath(),this.mapCanvas.arc(this.plPos.x,this.plPos.y,n,0,n*Math.PI,!1),this.mapCanvas.fillStyle="rgba(79, 253, 138,0.1)",this.mapCanvas.fill(),this.mapCanvas.beginPath(),this.mapCanvas.arc(this.plPos.x,this.plPos.y,2,0,2*Math.PI,!1),this.mapCanvas.fillStyle="#4FFD8A",this.mapCanvas.fill()},$.UI.statusBars=function(){var t=$.Pl.fuel.total/$.Pl.fuel.capacity*100;document.querySelector(".fuel .bar .remaining").style.width=t+"%";var e=$.Pl.shield.total/$.Pl.shield.capacity*100;document.querySelector(".shields .bar .remaining").style.width=e+"%";var i=$.Pl.hull.total/$.Pl.shield.capacity*100;document.querySelector(".hull .bar .remaining").style.width=i+"%"},$.UI.showMessage=function(t){if(!this.messageIsOpen){var e=document.getElementById("message");e.innerHTML=t,e.className="open",this.messageIsOpen=!0}},$.UI.closeMessage=function(){if(this.messageIsOpen){var t=document.getElementById("message");t.innerHTML="",t.className="",this.messageIsOpen=!1}},$.UI.handleTabs=function(t){for(var e=document.querySelectorAll(".tab"),i=e.length;i--;)e[i].className="tab";for(var s=document.querySelectorAll(".warez"),a=s.length;a--;)s[a].className="warez";document.getElementById(t+"Tab").className="tab active",document.getElementById(t).className="warez active"},$.UI.showStationMenu=function(t){this.closeMessage(),this.stationMenuIsOpen=!0;var e=document.getElementById("station-menu"),i=e.getElementsByClassName("station-title")[0];i.innerHTML=t.name,document.getElementById("credits").innerHTML=$.Pl.credits.toFixed(2),this.render(),e.className="gm open",this.messageIsOpen=!1},$.UI.render=function(){this.renderMarketTable(),this.renderInventoryTable(),this.renderServices(),this.renderUpgrades()},$.UI.renderMarketTable=function(){var t=$.Pl.closestStation,e=document.getElementById("market_stock");e.innerHTML="";for(var i in t.stock){var s=e.rows.length,a=e.insertRow(s);a.className=i.replace(/\\/g,"");var n="";n=$.Pl.credits>=t.stock[i].price&&t.stock[i].qnt>0?'class="button" onclick="$.UI.buyItem(\''+i+"')\"":'class="button disable"',a.insertCell(0).innerHTML=t.stock[i].qnt,a.insertCell(1).innerHTML=i,a.insertCell(2).innerHTML=t.stock[i].description,a.insertCell(3).innerHTML=t.stock[i].price+'<span class="lwrC">c</span>',a.insertCell(4).innerHTML="<button "+n+">BUY</button>"}},$.UI.renderInventoryTable=function(){var t=$.Pl.closestStation,e=document.getElementById("cargobay");e.innerHTML="";for(var i in $.Pl.cargoBay){var s=e.rows.length,a=e.insertRow(s);a.className=i.replace(/\\/g,"");var n="",r=0;$.Pl.cargoBay[i].qnt>0?(r=t.stock[i].price-$.Pl.cargoBay[i].avgPrice,n='class="button" onclick="$.UI.sellItem(\''+i+"')\""):n='class="button disable"',a.insertCell(0).innerHTML=$.Pl.cargoBay[i].qnt,a.insertCell(1).innerHTML=i,a.insertCell(2).innerHTML=$.Pl.cargoBay[i].netValue+'<span class="lwrC">c<span></span>',a.insertCell(3).innerHTML=t.stock[i].price+'<span class="lwrC">c<span></span>',a.insertCell(4).innerHTML=r.toFixed(2)+'<span class="lwrC">c<span></span>',a.insertCell(5).innerHTML="<button "+n+'">SELL</button>'}},$.UI.renderServices=function(){document.querySelector("#hull .amount").innerHTML=0,document.querySelector("#fuel .amount").innerHTML=0;var t=document.getElementById("hull_slider");t.setAttribute("max",0);var e=$.Pl.hull.capacity-$.Pl.hull.total,i=$.Pl.credits/1;e>i&&(e=i),e>=1?(t.setAttribute("max",e),t.removeAttribute("disabled"),document.querySelector("#hull .button").className="button"):(t.setAttribute("disabled","true"),document.querySelector("#hull .button").className="button disable");var s=document.getElementById("fuel_slider");s.setAttribute("max",0);var a=$.Pl.fuel.capacity-$.Pl.fuel.total,n=$.Pl.credits/.3;a>n&&(a=n),a>=1?(s.setAttribute("max",a),s.removeAttribute("disabled"),document.querySelector("#fuel .button").className="button"):(s.setAttribute("disabled","true"),document.querySelector("#fuel .button").className="button disable")},$.UI.renderUpgrades=function(){document.getElementById("credits").innerHTML=$.Pl.credits.toFixed(2);var t=document.getElementById("upgrades_table");t.innerHTML="";for(var e in $.Upgrades){for(var i=t.rows.length,s=t.insertRow(i),a="",n=$.Upgrades[e].currentLevel,r=$.Upgrades[e].lvs["lv"+(n+1)].price,o="",h=1;5>=h;h++)o+=h>n?'<div class="lv"></div>':'<div class="lv acquired"></div>';a=$.Pl.credits>=r?'class="button" onclick="$.UI.buyUpgrade(\''+e+"')\"":'class="button disable"',s.insertCell(0).innerHTML=e,s.insertCell(1).innerHTML=$.Upgrades[e].description,s.insertCell(2).innerHTML=o,s.insertCell(3).innerHTML=r+'<span class="lwrC">c</span>',s.insertCell(4).innerHTML="<button "+a+">BUY</button>"}},$.UI.buyUpgrade=function(t){$.Upgrades[t].currentLevel++;var e=$.Upgrades[t].currentLevel,i=$.Upgrades[t].lvs["lv"+e].price,s=$.Upgrades[t].lvs["lv"+e];("hull"===t||"shield"===t)&&($.Pl[t].capacity=s.total,$.Pl[t].total=s.total),"shield"===t&&($.Pl[t].regenerationRate=s.regenerationRate),"engine"===t&&($.Pl.topSpeed=s.topSpeed,$.Pl.ac=s.ac),"laser"===t&&($.Pl.laser.coolDown=s.coolDown,$.Pl.laser.hp=s.hp,$.Pl.laser.speed=s.speed,$.Pl.laser.width=s.width,$.Pl.laser.height=s.height),"radar"===t&&(this.radarRadius=s.radius),$.Pl.credits-=i,this.render()},$.UI.buyItem=function(t){$.Pl.closestStation.buyItem(t,$.Pl),document.getElementById("credits").innerHTML=$.Pl.credits.toFixed(2),this.render()},$.UI.sellItem=function(t){$.Pl.closestStation.sellItem(t,$.Pl),document.getElementById("credits").innerHTML=$.Pl.credits.toFixed(2),this.render()},$.UI.buyService=function(t){var e=document.getElementById(t+"_slider").value;$.Pl.closestStation.buyService(t,$.Pl,e),document.getElementById("credits").innerHTML=$.Pl.credits.toFixed(2),this.render()},$.UI.servicesRange=function(t){var e=document.getElementById(t+"_slider").value,i=$.Pl.closestStation.services[t].cost,s=(e*i).toFixed(2)+'<span class="lwrC">c</span>';document.querySelector("#"+t+" .amount").innerHTML=s},$.UI.closeStationMenu=function(){this.stationMenuIsOpen=!1;var t=document.getElementById("station-menu");t.className="gm";var e=document.getElementById("market_stock");e.innerHTML="",$.Pl.undock()},$.UI.startGame=function(){$.paused=!1,document.getElementById("start-screen").className="gm"},$.UI.hit=function(){var t=document.getElementById("game-container");t.className="canvas-wrap shake",setTimeout(function(){t.className="canvas-wrap"},50)},$.UI.update=function(){this.plotMap(),$.UI.statusBars()},$.init=function(){function t(){$.paused||($.render(),$.update()),requestAnimationFrame(t)}this.resizeElements();var e=document.getElementById("pl"),i=document.getElementById("objects"),s=document.getElementById("sps"),a=document.getElementById("pas"),n=document.getElementById("projectiles"),r=document.getElementById("unv");$.plCanvas=e.getContext("2d"),$.plCanvas.imageSmoothingEnabled=!0,$.unvCanvas=r.getContext("2d"),$.unvCanvas.imageSmoothingEnabled=!0,$.objectsCanvas=i.getContext("2d"),$.objectsCanvas.imageSmoothingEnabled=!0,$.spsCanvas=s.getContext("2d"),$.spsCanvas.imageSmoothingEnabled=!0,$.pasCanvas=a.getContext("2d"),$.pasCanvas.imageSmoothingEnabled=!0,$.projectilesCanvas=n.getContext("2d"),$.projectilesCanvas.imageSmoothingEnabled=!0,$.gameTime=0,$.renderTime=0,$.score=0,$.paused=!0,$.paInstances=[],$.KM.init(),$.Unv.init(),$.Pl.init(),$.Projectiles.init(),$.UI.init();this.fps=0,t(),setInterval(function(){$.paused||$.casualUpdate()},100)},$.resizeElements=function(){$.screenW=document.getElementById("game-container").offsetWidth,$.screenH=document.getElementById("game-container").offsetHeight;for(var t=document.querySelectorAll(".canvas_layer.main"),e=t.length;e--;)t[e].width=$.screenW,t[e].height=$.screenH},$.casualUpdate=function(){this.gameTime++,$.Pl.casualUpdate(),$.UI.update(),$.Unv.casualUpdate()},$.update=function(){$.Pl.update(),$.Unv.update(),$.Projectiles.update()},$.render=function(){$.plCanvas.clearRect(0,0,this.screenW,this.screenH),$.objectsCanvas.clearRect(0,0,this.screenW,this.screenH),$.spsCanvas.clearRect(0,0,this.screenW,this.screenH),$.projectilesCanvas.clearRect(0,0,this.screenW,this.screenH);for(var t=this.paInstances.length;t--;)this.paInstances[t].update()},$.init();</script></body></html>