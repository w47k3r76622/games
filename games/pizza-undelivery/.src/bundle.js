!function(t){var s={};function i(h){if(s[h])return s[h].t;var e=s[h]={s:h,i:!1,t:{}};return t[h].call(e.t,e,e.t,i),e.i=!0,e.t}i.h=t,i.c=s,i.d=function(t,s,h){i.l(t,s)||Object.defineProperty(t,s,{o:!0,get:h})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"u",{value:!0})},i.M=function(t,s){if(1&s&&(t=i(t)),8&s)return t;if(4&s&&"object"==typeof t&&t&&t.u)return t;var h=Object.create(null);if(i.r(h),Object.defineProperty(h,"default",{o:!0,value:t}),2&s&&"string"!=typeof t)for(var e in t)i.d(h,e,function(s){return t[s]}.bind(null,e));return h},i.n=function(t){var s=t&&t.u?function(){return t.default}:function(){return t};return i.d(s,"a",s),s},i.l=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},i.m="",i(i.p=4)}([function(t,s,i){"use strict";i.r(s),i.d(s,"default",function(){return l}),i.d(s,"iterateQGrid",function(){return o}),i.d(s,"clamp",function(){return n});const h=[1,0,-1,0],e=[0,1,0,-1];class r{constructor(t,s){this.width=t,this.height=s,this.g={0:{0:{0:{0:{0:{0:{0:{0:{0:{j:1}}},1:{1:{1:{j:1}}}}},1:{0:{0:{0:{0:{j:-1}}}}}},1:{1:{1:{1:{1:{1:{j:-1}}}}}}},1:{0:{0:{1:{0:{0:{1:{j:1}}},1:{1:{1:{j:1}}}}}}}},1:{1:{0:{1:{1:{0:{1:{1:{j:-1}}}}}}}}},1:{0:{0:{1:{0:{0:{1:{0:{0:{j:1}},1:{1:{j:1}}}}}}}},1:{0:{1:{1:{0:{1:{1:{0:{j:-1}}}}}}},1:{0:{0:{0:{0:{0:{0:{j:1}}}},1:{0:{0:{1:{j:1}}}}}},1:{0:{0:{1:{0:{0:{j:1}}}},1:{1:{1:{1:{j:-1}}}}},1:{1:{0:{0:{0:{j:-1}}},1:{1:{1:{j:-1}}}}}}}}}},this.data=new Array(this.width*this.height),this.O=new Array(this.data.length),this.v()}$(){this.O.fill(0);const t=this.width,s=this.height;for(let i=0;i<t;i++)for(let h=0;h<s;h++){let e=[];for(let r=0;r<3;r++)for(let l=0;l<3;l++){let o=t*n(h+r,s)+n(i+l,t);e.push(this.data[o])}let r=this.A(e);if(0!=r)for(let e=0;e<3;e++)for(let l=0;l<3;l++){let o=t*n(h+e,s)+n(i+l,t);this.O[o]+=r}}for(let i=0;i<s;i++)for(let s=0;s<t;s++){let h=i*t+s,e=this.O[h]<=0;this.data[h]=e?this.S():this.data[h]}}C(){for(let t=0;t<this.width;t++)for(let s=0;s<this.height;s++){let i=0;for(let r=0;r<4;r++)i+=this.F(t+h[r],s+e[r]);i<2&&(this.data[s*this.width+t]=0)}}k(t,s,i){let r=[t,s],l=this.F(t,s);for(let o=0;o<49&&0!=r.length;o++){if(s=r.pop(),t=r.pop(),this.F(t,s)==i)return;this.L(t,s,i);for(let i=0;i<4;i++){this.F(t+h[i],s+e[i])==l&&r.push(t+h[i],s+e[i])}}}F(t,s){return this.data[n(s,this.height)*this.width+n(t,this.width)]}L(t,s,i){this.data[n(s,this.height)*this.width+n(t,this.width)]=i}A(t){let s=this.g;for(let i=0;i<t.length;i++){if(!s[t[i]])return 0;s=s[t[i]]}return s.j}v(){for(let t=0;t<this.height;t++)for(let s=0;s<this.width;s++){let i=t*this.width+s;this.data[i]=this.S()}}S(){return Math.random()<.5?1:0}}class l{constructor(t){this.size=t,this.T()}T(){let t=this.size,s=[1,1,1,1].map(s=>new r(s*t,s*t));for(let t of s){for(let s=0;s<100;s++)t.$();for(let s=0;s<16;s++)t.C()}for(let i of o(t,t)){let h=Math.min(i.x,t-1-i.x),e=Math.min(i.y,t-1-i.y),r=Math.min(h,e);0==r||1==h&&1==e?s[0].data[i.index]=0:1==r&&(s[0].data[i.index]=1)}for(let t=0;t<16;t++)s[0].C();this.D=s[0].data,this.G=[];for(let i of o(t,t)){let t=s.map(t=>1-t.data[i.index]).reduce((t,s)=>t+s);t=s[0].data[i.index]?0:t,this.G[i.index]=t}}I(t,s){return this.G[n(s,this.size)*this.size+n(t,this.size)]||this.P(t,s)}P(t,s){return 0+.2*(Math.sin(3.141569*s*.25)+Math.sin(3.141569*t*.25)+0)}H(t,s){return this.D[n(s,this.size)*this.size+n(t,this.size)]}}function*o(t,s){for(let i=0;i<t;i++)for(let h=0;h<s;h++)yield{x:i,y:h,index:h*t+i}}function n(t,s){return Math.min(Math.max(~~t,0),s-1)}},function(t,s,i){"use strict";i.r(s),i.d(s,"keyIsDown",function(){return r});var h={};function e(t,s){h[t]=!1,document.addEventListener("keydown",i=>{s.includes(i.keyCode)&&(i.preventDefault(),h[t]=!0)}),document.addEventListener("keyup",i=>{s.includes(i.keyCode)&&(i.preventDefault(),h[t]=!1)})}function r(t){return!!h[t]}e("left",[65,37]),e("right",[68,39]),e("up",[87,38]),e("down",[83,40]),e("exit",[27])},function(t,s,i){"use strict";i.r(s),i.d(s,"default",function(){return a});let h=Math.random,e=Math.sign,r=Math.sin,l=Math.max,o=Math.atan;const n=Math.PI;class a{constructor(){this.N=new AudioContext,this.R=this.N.createGain(),this.R.gain.setValueAtTime(.5,this.N.currentTime),this.R.connect(this.N.destination)}V(t=1){let s=this.N.createBuffer(1,8e3,8e3),i=s.getChannelData(0),e=90+64*h();for(let s=0;s<8e3;s++){let h=s,l=1-(s&=~(1<<~~(s/e)))/2e3,a=r((1-s/8e3)**32*95);i[h]=o(a*l**5)/(n/2)*t,s=h}let l=this.N.createBufferSource();l.buffer=s,l.connect(this.R),l.start()}_(t=1){let s=this.N.createBuffer(1,8e3,8e3),i=s.getChannelData(0),e=1+h();for(let s=0;s<8e3;s++){let h=s,l=1-s/8e3;i[h]=o(r(.02*s*e*(s>>9)*(s>>10)))/(n/2)*2*t*l**2,s=h}let l=this.N.createBufferSource();l.buffer=s,l.connect(this.R),l.start()}W(t=1){let s=this.N.createBuffer(1,16e3,8e3),i=s.getChannelData(0),e=1+h();for(let s=0;s<16e3;s++){let h=s,a=1-s/16e3;const c=1-s%1024/1024;i[h]=o(r(.05*s*e*2**((s>>10)%3))*r(c)**3*a**3+r(.05*s*e)*a**5)/(n/2)*2*t+.4*i[l(h-1e3,0)],s=h}let a=this.N.createBufferSource();a.buffer=s,a.connect(this.R),a.start()}start(){let t,s=this.N.createBuffer(1,1<<20,12e3),i=s.getChannelData(0),o=0;for(let t=0;t<5;t++)o|=~~(4*h()),o<<=2;let a=[773752,773752,773759,957758312,773752,773752,773759,957758312,792323628,792323628,957758312,957758312,1008437436,1008437436,773759,957758312];for(let s=0;s<1<<20;s++){const c=1-s%4096/4096,u=1-s%32768/32768,f=1-s%1024/1024;let d=(2*h()-1)*c**32*.5,M=(2*h()-1)*f**32*1.9,m=r(c**6*111)*c,p=(2*h()-1)*c**4;s%32768==0&&(t=~~(2048*h())),s%65536==0&&(o=a.shift());let w=s;s&=o,i[w]=[.4*[m,d,p,d][(s>>12)%4],.4*[m,p,d,M][(s>>12)%4]][l((s>>14)%4-2,0)]+.05*e(r(1/64*(s&(1<<5-(s>>14)%3+(s>>12)%6)-1)*n*(1+.25*u)))+.05*e(r(1/64*(s&t<<4)*n))+.4*i[l(0,s-2100)]+.4*i[l(0,s-2e3)],s=w}console.log(a.toString());let c=this.N.createBufferSource();c.buffer=s,c.loop=!0,c.connect(this.R),c.start()}update(){}}},function(t,s,i){"use strict";i.r(s),i.d(s,"Texture",function(){return e}),i.d(s,"default",function(){return l});var h=i(0);class e{constructor(t,s){this.data=new Array(t*s),this.width=t,this.height=s}static q(t){let s=t.width,i=t.height,h=t.getContext("2d").getImageData(0,0,s,i).data,r=new e(s,i);for(let t=0;t<s*i;t++)r.data[t]=[h[4*t],h[4*t+1],h[4*t+2]];return r}fill(t){this.data=this.data.fill(t)}B(t,s){return this.data[s*this.width+t]}L(t,s,i){this.data[s*this.width+t]=i}}const r=120;class l{constructor(t,s){this.J=t,this.canvas=s,this.x=0,this.y=.5,this.z=.35,this.angle=0,this.K=.1,this.U="",this.X="red",this.Y=0,this.Z=[],this.tt=null,this.st=1,this.it=null,this.ht=null}et(t,s){this.U=t.split("").join(" "),this.X=s}rt(t){this.lt=t,this.ot=r}async load(){this.ht=await this.nt("spritesheet"),this.at=[this.ct(0,0,32,16),this.ct(0,16,32,16),this.ct(0,0,32,16,!0)],this.ut=[],this.ut[0]=this.ct(32,0,32,32),this.ut[1]=this.ct(80,0,32,32),this.ft=e.q(await this.ct(64,0,16,16)),this.dt(),this.Mt()}async nt(t,s="png"){let i=document.createElement("img");return i.src=`images/${t}.${s}`,await new Promise(t=>{i.onload=t}),i}ct(t,s,i,h,e=!1){let r=document.createElement("canvas");r.width=i,r.height=h;let l=r.getContext("2d");return e&&l.scale(-1,1),l.drawImage(this.ht,-t-(e?i:0),-s),r}dt(){const t=this.ft.width,s=~~(t/2),i=this.ft.height;let h=new e(this.J.size*t,this.J.size*i);const r=[1,0,-1,0],l=[0,1,0,-1];let o=(s,h,e)=>{let o=r[e]*(s-=(t-1)/2)-l[e]*(h-=(i-1)/2);return h=l[e]*s+r[e]*h,s=o,{x:s+=(t-1)/2,y:h+=(i-1)/2}};for(let e=0;e<this.J.size;e++)for(let n=0;n<this.J.size;n++){let a=this.J.H(e,n);for(let c=0;c<4;c++){const u=(c+2)%4,f=2*a+this.J.H(e+r[u],n+l[u]);let d=0==a?(2+r[c])/5:1;for(let r=0;r<s;r++)for(let s=r;s<i-r-1;s++){const l=o(r,s,c),a=o(r,s,f);let u=this.ft.B(a.x,a.y);u&&h.L(e*t+l.x,n*i+l.y,u.map(t=>t*d))}}}this.pt=h}Mt(){let t=document.createElement("canvas"),s=t.getContext("2d");const i=this.J.size;t.width=t.height=i;let h=s.getImageData(0,0,i,i);for(let t=0;t<i;t++)for(let s=0;s<i;s++){const e=4*(s*i+t);h.data[e]=h.data[e+1]=h.data[e+2]=this.J.H(t,s)?0:128,h.data[e+3]=255}s.putImageData(h,0,0),this.wt=t}bt(t,s){return t=Object(h.clamp)(t*this.ft.width,this.pt.width),s=Object(h.clamp)(s*this.ft.height,this.pt.height),this.pt.B(t,s)}yt(){let t=Date.now();const s=this.canvas.width,i=this.canvas.height;let e=this.canvas.getContext("2d");e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,s,i);let l=e.getImageData(0,0,s,i);const o=Math.cos(this.angle),n=Math.sin(this.angle);let a=new Array(s).fill(0);for(let t=0;t<=180;t++){const h=(t/180)**2*12,e=h,r=1-h/12;for(let t=0;t<s;t++){const c=h*(t/s*2-1),u=this.x+o*e-n*c,f=this.y+n*e+o*c,d=(this.J.I(u,f)-this.z+h)/(2*h)+this.K,M=Math.min(~~(d*i),i),m=this.bt(u,f),p=a[t];for(let e=p;e<M;e++){const o=4*((i-e)*s+t),n=~~(1+~~((d*i-1-e)*h)%18*2/18);for(let t=0;t<3;t++)l.data[o+t]=34*(1-r)+r*(m[t]*n);l.data[o+3]=255}M>p&&(a[t]=M)}}if(e.putImageData(l,0,0),this.at){let t=this.at[this.st];e.drawImage(t,~~(s/2-t.width/2),~~(.8*i-t.height/2),t.width,t.height)}for(let t of this.Z){const h=(t.y-(this.y+n*(t.x-this.x)/o))/(n*n/o+o),r=(t.x-this.x+n*h)/o,l=(h/r+1)/2*s,a=180*Math.sqrt(r/12),c=1/r,u=~~(((this.J.I(t.x,t.y)-this.z+r)/(2*r)+this.K)*i);if(a>0){let s=this.ut[t.gt],h=s.width*c,r=s.height*c;e.drawImage(s,l-h/2,i-u-r/2,h,r)}}if(e.drawImage(this.wt,0,0),e.fillStyle="red",e.beginPath(),e.rect(Object(h.clamp)(this.x,this.J.size),Object(h.clamp)(this.y,this.J.size),1,1),e.fill(),t%250<125){e.beginPath(),e.fillStyle="#f5cc7a";for(let t of this.Z)e.rect(Object(h.clamp)(t.x,this.J.size),Object(h.clamp)(t.y,this.J.size),1,1);e.fill()}e.font="12px Arial",e.textAlign="right",e.strokeStyle="black",e.fillStyle="white";let c=`${~~(this.Y/60)}:${("0"+this.Y%60).substr(-2,2)}`;e.strokeText(c,s-2,12),e.fillText(c,s-2,12),e.font="8px Arial",e.textAlign="center";let u=t%100/100*Math.PI,f=s/2+Math.cos(u),d=i-5+Math.sin(u);if(e.strokeStyle="black",e.fillStyle=this.X,e.strokeText(this.U,f,d),e.fillText(this.U,f,d),this.ot--,this.ot>0){let t=Math.sin((this.ot/r)**8*Math.PI),h=.5*(1-this.ot/r);e.translate(s/2,i/2),e.rotate(h),e.scale(t,t),e.font="32px Arial",e.strokeStyle="2px solid red",e.fillStyle="white",e.strokeText(this.lt,0,0,.8*s),e.fillText(this.lt,0,0,.8*s)}let M=Date.now()-t;document.querySelector("footer>p").innerHTML=`render time: ${M}ms, \t${~~(1e3/M)}fps x: ${this.x} y: ${this.y}`}}},function(t,s,i){i(2),i(5),i(0),i(1),t.t=i(3)},function(t,s,i){"use strict";i.r(s);var h=i(0),e=i(3),r=i(1),l=i(2);const o=.25/30,n=2/30,a=.1,c=.1,u=.3,f=!1,d=32,M=60,m=50;class p{constructor(t,s){this.x=0,this.y=0,this.r=.03,this.jt=0,this.Ot=0,this.angle=0,this.vt=t,this.J=s}update(t){if(!t){let t,s,i;const h=(Object(r.keyIsDown)("up")-Object(r.keyIsDown)("down"))*o;let e=Object(r.keyIsDown)("right")-Object(r.keyIsDown)("left");this.vt.st=1-e,e*=n,t=Math.cos(this.angle),s=Math.sin(this.angle),i=Math.max(Math.min(60*(t*this.jt+s*this.Ot),1),-1),this.angle+=e*i,this.jt+=Math.cos(this.angle)*h,this.Ot+=Math.sin(this.angle)*h,this.x+=this.jt,this.y+=this.Ot,t=-Math.sin(this.angle),s=Math.cos(this.angle),i=(t*this.jt+s*this.Ot)*a,this.jt-=i*t,this.Ot-=i*s,t=Math.cos(this.angle),s=Math.sin(this.angle),i=t*this.jt+s*this.Ot,i*=i>0?c:u,this.jt-=i*t,this.Ot-=i*s,this.xt(this)}this.vt.x=this.x-.25*Math.cos(this.angle),this.vt.y=this.y-.25*Math.sin(this.angle),this.vt.z=.25+this.J.P(this.x,this.y),this.vt.angle=this.angle}xt(t){if(this.$t(t.x,t.y)){t.Ot*=-1,t.jt*=-1;let s=Math.sqrt(t.jt**2+t.Ot**2);s>.01&&w.St.At.V(20*(Math.abs(s)-.01))}const s=Math.round(t.x),i=Math.round(t.y),h=t.x-s,e=t.y-i,r=h>0?1:0,l=1-r,o=e>0?1:0,n=1-o,a=Math.sqrt(h*h+e*e),c=Math.abs(h)<t.r&&this.$t(s-r,i-n),u=Math.abs(e)<t.r&&this.$t(s-l,i-o);!c&&!u&&a<t.r&&this.$t(s-r,i-o)&&a>.01?(t.x=s+h*t.r/a,t.y=i+e*t.r/a):(c&&(t.x=s+Math.sign(h)*t.r,t.jt*=-1,Math.abs(t.jt)>.01&&w.St.At.V(20*(Math.abs(t.jt)-.01))),u&&(t.y=i+Math.sign(e)*t.r,t.Ot*=-1,Math.abs(t.Ot)>.01&&w.St.At.V(20*(Math.abs(t.jt)-.01))))}$t(t,s){return 1!=this.J.H(t,s)}}class w{constructor(t,s,i,h){this.level=1,this.Ct=0,this.Ft=0,this.vt=t,this.J=s,this.kt=i,this.At=h,this.zt=[],this.Lt=null,this.time=0,this.Tt=!1,this.Dt=null,w.St=this}Gt(){this.time=M,this.kt.angle=this.kt.Ot=this.kt.jt=0,this.Tt=!0,this.It("title-template"),this.Lt=null,this.Pt();let t=this.Dt.querySelectorAll("button");t[0].onclick=t=>{this.J.T(),this.vt.dt(),this.vt.Mt(),this.Lt=null,this.Pt()},t[1].onclick=t=>{this.level=Number(this.Dt.querySelector("input").value),this.Dt.remove(),this.Dt=null,this.Tt=!1,this.Pt()}}Pt(){this.Ft=this.level,this.Ct=0,this.Et(),this.vt.et("Collect the pizzas!","red")}Et(){this.zt=[];let t=[];for(let s of Object(h.iterateQGrid)(d,d))s.x+=.5,s.y+=.5,t.push(s);t=t.filter(t=>1==this.J.H(t.x,t.y));for(let s=0;s<this.Ft;s++){let s=t.splice(~~(Math.random()*t.length),1)[0];s.gt=0,this.zt.push(s)}this.Lt||(this.Lt=t.splice(~~(Math.random()*t.length),1)[0],this.Lt.gt=1,this.kt.x=this.Lt.x,this.kt.y=this.Lt.y),this.vt.Z=this.zt}update(){if(this.Tt||(this.time-=1/30),this.time=Math.max(this.time,0),this.vt.Y=Math.floor(this.time),0!=this.time&&!Object(r.keyIsDown)("exit")||this.Dt||(this.Tt=!0,this.It("game-over-template"),this.Dt.querySelector("#lnum").append(`${this.level}`),this.Dt.querySelector("button").onclick=()=>{this.Dt.remove(),this.Dt=null,this.Tt=!1,this.Gt()}),this.zt.length>0){for(let t of this.zt)(t.x-this.kt.x)**2+(t.y-this.kt.y)**2<.09&&(t.Ht=!0,this.At._(),this.Ct++,this.vt.rt(`${this.Ct} / ${this.Ft} pizzas\ncollected!!!`));this.zt=this.zt.filter(t=>!t.Ht),this.vt.Z=this.zt}else this.vt.et("Return to start!","yellow"),this.vt.Z=[this.Lt],(this.Lt.x-this.kt.x)**2+(this.Lt.y-this.kt.y)**2<.4**2&&(this.level++,this.vt.rt(`LEVEL ${this.level}`),this.time+=m,this.At.W(),this.Pt())}It(t){this.Dt=document.querySelector(`#${t}`).content.cloneNode(!0).firstElementChild;let s=document.querySelector("main");s.insertBefore(this.Dt,document.querySelector("main>.game"));let i=t=>{this.Dt.setAttribute("style",`width:${~~s.offsetWidth}px; height:${~~s.offsetHeight}px`)};window.onresize=i,i()}}window.addEventListener("load",()=>{!async function(){let t=new l.default;if(f)t.start();else{let s=document.querySelector("body");s.onkeydown=i=>{t.start(),s.onkeydown=null}}let s=new h.default(d),i=new e.default(s,document.querySelector("canvas.game"));await i.load();let r=new p(i,s),o=new w(i,s,r,t);o.Gt(),window.setInterval(()=>{o.update(),r.update(o.Tt),t.update(o.Tt),i.yt(o.Tt)},1e3/30)}()})}]);