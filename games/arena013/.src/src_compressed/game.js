Game.utils={};Game.utils.add_default=function(e,t){if(typeof e=="undefined"){e=t}};(function(){var e,t,n,r;Game.utils.point_to=function(r,i,s,o){e=s-r;t=o-i;n=Math.atan2(t,e);return n};Game.utils.normalize=function(n,i,s,o){e=s-n;t=o-i;r=e*e+t*t;r=Math.sqrt(r);return[e/r,t/r]};Game.utils.randomize_direction=function(){return Game.utils.normalize(0,0,Math.random()*10-5,Math.random()*10-5)};Game.utils.proximity=function(n,r){e=r.transform.position.x-n.transform.position.x;t=r.transform.position.y-n.transform.position.y;return Math.sqrt(e*e+t*t)};Game.utils.collision=function(e,t){return Game.utils.proximity(e,t)<e.col+t.col}})();(function(){var e=0;Game.utils.assign_id=function(){return e++}})();Game.utils.count_down=function(e,t,n){e[t]-=n*1e3;e[t]=e[t]<0?0:e[t]};Game.utils.damage=function(e,t){e.hp-=t;if(e.hp<=0){e.hp=0}else if(e.hp>e.max_hp){e.hp=e.max_hp}};Game.utils.clone=function(e){if(null==e||"object"!=typeof e)return e;var t=e.constructor();for(var n in e){if(e.hasOwnProperty(n))t[n]=e[n]}return t};(function(){Game.graphics={};Game.graphics.canvas=document.getElementById(Game.config.canvas_id);Game.graphics.fps_counter=document.getElementById(Game.config.fps_counter_id);Game.graphics.context=Game.graphics.canvas.getContext("2d");Game.graphics.draw_list=[[],[],[]];Game.graphics.image=document.createElement("img");Game.graphics.image.src="sprites.png";Game.graphics.camera={x:0,y:0};var e=false;Game.graphics.draw=function(t){if(!e){if(Game.graphics.image.width){e=true}}t.clearRect(0,0,Game.graphics.canvas.width,Game.graphics.canvas.height);if(!Game.paused){for(var n=0;n<24;n++){for(var r=0;r<32;r++){if(n==0||n==23||r==0||r==31){t.drawImage(Game.graphics.image,0,93,56,56,r*40-Game.graphics.camera.x,n*40-Game.graphics.camera.y,40,40)}else{t.drawImage(Game.graphics.image,420,0,40,40,r*40-Game.graphics.camera.x,n*40-Game.graphics.camera.y,40,40)}}}var i,s,o;Game.graphics.draw_list.map(function(e){e=e.filter(function(e){if(!e.visible){return false}t.save();i=e.position.x-Game.graphics.camera.x;s=e.position.y-Game.graphics.camera.y;o=e.rotation.z+e.offset.r*-1.570796327;t.translate(i,s);t.rotate(o);t.translate(-i,-s);t.drawImage(Game.graphics.image,e.offset.x,e.offset.y,e.width,e.height,e.position.x-e.width/2-Game.graphics.camera.x,e.position.y-e.height/2-Game.graphics.camera.y,e.width,e.height);t.restore();return true})});(function(e){if(e.active){t.fillStyle="rgba(95,232,232,0.7)";t.beginPath();t.arc(e.transform.position.x-Game.graphics.camera.x,e.transform.position.y-Game.graphics.camera.y,e.col-e.duration_left/e.duration*e.col,0,Math.PI*2,true);t.closePath();t.fill()}})(Game.player.bomb);t.save();t.strokeStyle="#555555 4px solid";t.font="bold 20px sans-serif";t.fillStyle="#F2392C";t.fillRect(50,10,Game.player.hp/Game.player.max_hp*200,20);t.strokeRect(50,10,200,20);t.fillStyle="rgba(0,0,0,0.5)";t.fillText("HEALTH:   "+Game.player.hp,85,27);t.fillStyle="#968E59";if(Game.player.ranged.reload_time_left){t.fillRect(300,10,200-Game.player.ranged.reload_time_left/Game.player.ranged.reload_time*200,20);t.fillStyle="rgba(0,0,0,0.5)";t.fillText("RELOADING...",335,27)}else{t.fillRect(300,10,Game.player.ranged.ammo/Game.player.ranged.max_ammo*200,20);t.fillStyle="rgba(0,0,0,0.5)";t.fillText("AMMO:   "+Game.player.ranged.ammo,335,27)}t.strokeRect(300,10,200,20);t.fillStyle="#5FE8E8";t.fillRect(50,40,200-Game.player.bomb.cooldown_left/Game.player.bomb.cooldown*200,20);t.fillStyle="rgba(0,0,0,0.5)";t.fillText("MANA BURST",85,57);t.strokeRect(50,40,200,20);t.fillStyle="#46A343";t.fillRect(300,40,200,20);t.fillStyle="rgba(0,0,0,0.5)";t.fillText("Score: "+Math.floor(Game.player.exp.total),335,57);t.strokeRect(300,40,200,20);t.fillStyle="#7EF280";t.fillRect(570,210-Game.bm.luck*2,20,Game.bm.luck*2);t.fillStyle="rgba(0,0,0,0.5)";t.fillText("L",573,40);t.fillText("U",573,80);t.fillText("C",573,120);t.fillText("K",573,160);t.strokeRect(570,10,20,200);t.fillStyle="#BEF27E";t.fillRect(600,210-Game.bm.wave_time_left/Game.bm.wave_time*200,20,Game.bm.wave_time_left/Game.bm.wave_time*200);t.fillStyle="rgba(0,0,0,0.5)";t.fillText("W",600,40);t.fillText("A",603,70);t.fillText("V",603,100);t.fillText("E",603,130);var u=Game.bm.wave.toString();for(var a=0;a<u.length;a++){t.fillText(u[a],605,165+20*a)}t.strokeRect(600,10,20,200);if(Game.player.isDead){t.fillStyle="#BE0000";t.font="bold 120px sans-serif";t.fillText("DEAD!",160,300);t.font="bold 40px sans-serif";t.fillText("Press 'R' to replay!",160,400)}t.restore()}else{t.save();t.strokeStyle="#555555 4px solid";t.font="20px sans-serif";t.fillStyle="#DDD";t.fillText("==CONTROLES==",200,25);t.font="14px sans-serif";t.fillText("A: Move Left",10,50);t.fillText("S: Move Down",10,69);t.fillText("D: Move Right",10,88);t.fillText("W: Move Up",10,107);t.fillText("Left Click: Melee Attack",125,50);t.fillText("Right Click: Ranged Attack",125,69);t.fillText("Space Bar: Mana Burst",125,88);t.fillText("R: Manual Reload",125,107);t.fillText("1: Develop Melee",325,50);t.fillText("2: Develop Ranged",325,69);t.fillText("3: Develop Mana Burst",325,88);t.fillStyle="#E77";t.fillText("P: Pause / Unpause / Start Game",325,107);t.font="20px sans-serif";t.fillStyle="#DDD";t.fillText("==HERO STATS==",200,130);t.font="14px sans-serif";t.fillText("HEALTH:   "+Game.player.hp,70,149);t.fillText("SPEED:   "+Game.player.speed/10,70,168);t.fillText("HP REGEN: "+Game.player.health_regen+" per 5 sec",70,187);t.fillText("MELEE DAMAGE:   "+Game.player.melee.damage,70,210);t.fillText("MANA BURST DAMAGE:   "+Game.player.bomb.damage,70,229);t.fillText("MANA BURST RANGE:   "+Game.player.bomb.col/10,70,248);t.fillText("RANGED DAMAGE:   "+Game.player.ranged.damage,360,149);t.fillText("RANGED RANGE:   "+Game.player.ranged.range/10,360,168);t.fillText("FIRE RATE: "+1e3/Game.player.ranged.cooldown+" per sec",360,187);t.fillText("RELOAD TIME:   "+Game.player.ranged.reload_time/1e3+" sec",360,210);t.fillText("CLIP SIZE:   "+Game.player.ranged.max_ammo,360,229);t.font="20px sans-serif";t.fillStyle="#DDD";t.fillText("==HERO DEVELOPMENT==",160,275);t.font="12px sans-serif";if(Game.player.exp.selected=="melee"){t.fillStyle="#7E7"}else{t.fillStyle="#DDD"}t.fillText("MELEE: Improves your melee damage and health per level.",10,294);t.fillText("Level: "+Game.player.exp.melee.level,10,310);t.fillText("Level Progress: "+Math.floor(Game.player.exp.melee.xp)+"/"+Game.player.exp.melee.next,10,326);t.fillText("PERKS: Level 30: Bigger Sword,   Level 60: Biggest Sword",10,342);if(Game.player.exp.selected=="ranged"){t.fillStyle="#7E7"}else{t.fillStyle="#DDD"}t.fillText("RANGE: Improves your ranged damage, movement speed, and fire rate per level.",10,363);t.fillText("Level: "+Game.player.exp.ranged.level,10,379);t.fillText("Level Progress: "+Math.floor(Game.player.exp.ranged.xp)+"/"+Math.floor(Game.player.exp.ranged.next),10,395);t.fillText("PERKS: Level 20: x2 Clip,  Level 40: 1/2 reload time,  Level 60: clip x4 (base),  Level 80: x2 range.",10,412);if(Game.player.exp.selected=="bomb"){t.fillStyle="#7E7"}else{t.fillStyle="#DDD"}t.fillText("MANA BURST: Improves your Mana Burst damage, and health regeneration per level.",10,432);t.fillText("Level: "+Game.player.exp.bomb.level,10,448);t.fillText("Level Progress: "+Math.floor(Game.player.exp.bomb.xp)+"/"+Game.player.exp.bomb.next,10,463);t.fillText("PERKS: Level 20: x2 Clip,  Level 40: 1/2 reload time,  Level 60: clip x4 (base),  Level 80: x2 range.",10,478);t.restore()}}})();Game.input={};Game.input.keyboard={};Game.input.keyboard.a=false;Game.input.keyboard.s=false;Game.input.keyboard.d=false;Game.input.keyboard.w=false;Game.input.keyboard.r=false;Game.input.keyboard.space=false;Game.input.mouse={};Game.input.mouse.x=0;Game.input.mouse.y=0;Game.input.mouse.left=false;Game.input.mouse.right=false;Game.input.keyboard.id_to_key={"U+0041":"a","U+0053":"s","U+0044":"d","U+0057":"w","U+0020":"space","U+0052":"r"};Game.graphics.canvas.addEventListener("mousedown",function(e){if(!e.which&&e.button){if(e.button&1)e.which=1;else if(e.button&4)e.which=2;else if(e.button&2)e.which=3}switch(e.button||e.which){case 1:Game.input.mouse.left=true;break;case 2:Game.input.mouse.right=true;break}e.preventDefault()});window.addEventListener("mouseup",function(e){if(!e.which&&e.button){if(e.button&1)e.which=1;else if(e.button&4)e.which=2;else if(e.button&2)e.which=3}switch(e.button||e.which){case 1:Game.input.mouse.left=false;break;case 2:Game.input.mouse.right=false;break}});Game.graphics.canvas.addEventListener("mousemove",function(e){Game.input.mouse.x=e.x-Game.graphics.canvas.offsetLeft;Game.input.mouse.y=e.y-Game.graphics.canvas.offsetTop});window.addEventListener("keydown",function(e){Game.input.keyboard[Game.input.keyboard.id_to_key[e.keyIdentifier]]=true});window.addEventListener("keyup",function(e){Game.input.keyboard[Game.input.keyboard.id_to_key[e.keyIdentifier]]=false;if(e.keyIdentifier=="U+0050"){Game.paused=!Game.paused}else if(e.keyIdentifier=="U+0031"){Game.player.exp.selected="melee"}else if(e.keyIdentifier=="U+0032"){Game.player.exp.selected="ranged"}else if(e.keyIdentifier=="U+0033"){Game.player.exp.selected="bomb"}});(function(){Game.player={hp:10,max_hp:10,health_regen:1,health_regen_time:5e3,speed:200,col:12,melee:{active:false,damage:4,reach:25,cooldown:500,cooldown_left:0,duration:200,duration_left:0,movement:0},ranged:{damage:3,speed:750,cooldown:500,cooldown_left:0,ammo:6,max_ammo:6,reload_time:5e3,reload_time_left:0,movement:0,range:200},bomb:{active:false,damage:10,col:100,cooldown:1e4,cooldown_left:0,duration:200,duration_left:0},transform:{visible:true,position:{x:100,y:100,z:1},rotation:{x:0,y:0,z:.5},scale:{x:4,y:4},offset:{x:322,y:111,r:1},width:28,height:28},isDead:false};Game.graphics.draw_list[1].push(Game.player.transform);Game.player.die=function(){if(!Game.player.isDead){Game.player.isDead=true;Game.player.transform.width=32;Game.player.transform.height=32;Game.player.transform.offset.x=286;Game.player.transform.offset.y=106}if(Game.input.keyboard.r){Game.reset_game()}};Game.update_player=function(e,t){if(e.hp==0){e.die();return}if(Game.input.keyboard.a){e.transform.position.x-=e.speed*t}if(Game.input.keyboard.d){e.transform.position.x+=e.speed*t}if(Game.input.keyboard.w){e.transform.position.y-=e.speed*t}if(Game.input.keyboard.s){e.transform.position.y+=e.speed*t}e.transform.rotation.z=Game.utils.point_to(e.transform.position.x-Game.graphics.camera.x,e.transform.position.y-Game.graphics.camera.y,Game.input.mouse.x,Game.input.mouse.y);if(e.transform.position.x<40+e.col){e.transform.position.x=40+e.col}if(e.transform.position.x>1240-e.col){e.transform.position.x=1240-e.col}if(e.transform.position.y<40+e.col){e.transform.position.y=40+e.col}if(e.transform.position.y>920-e.col){e.transform.position.y=920-e.col}if(e.transform.position.x>320&&e.transform.position.x<960){Game.graphics.camera.x=e.transform.position.x-320}if(e.transform.position.y>240&&e.transform.position.y<720){Game.graphics.camera.y=e.transform.position.y-240}Game.utils.count_down(e.melee,"cooldown_left",t);Game.utils.count_down(e.ranged,"cooldown_left",t);Game.utils.count_down(e.bomb,"cooldown_left",t);if(!e.ranged.reload_time_left){if(Game.input.keyboard.r&&e.ranged.ammo<e.ranged.max_ammo){e.ranged.ammo=e.ranged.max_ammo;e.ranged.reload_time_left=e.ranged.reload_time}if(Game.input.mouse.right){e.do_ranged(e)}}else{e.ranged.reload_time_left-=t*1e3;if(e.ranged.reload_time_left<0){e.ranged.reload_time_left=0}}if(Game.input.mouse.left&&!e.melee.cooldown_left){e.melee.cooldown_left=e.melee.cooldown;e.do_melee(e)}if(e.melee.active){e.update_melee(e,e.melee,t)}if(Game.input.keyboard.space&&!e.bomb.cooldown_left){e.bomb.cooldown_left=e.bomb.cooldown;e.do_bomb(e)}if(e.bomb.active){e.update_bomb(e.bomb,t)}if(e.hp<e.max_hp){if((e.health_regen_time-=t*1e3)<0){Game.utils.damage(e,-1);e.health_regen_time+=5e3/e.health_regen}}};Game.player.do_melee=function(e){e.melee.active=true;e.melee.transform.visible=true;e.melee.duration_left=e.melee.duration;Game.graphics.draw_list[2].push(Game.player.melee.transform)};var e,t;Game.player.update_melee=function(r,i,s){Game.utils.count_down(i,"duration_left",s);if(i.duration_left){i.transform.rotation.z=r.transform.rotation.z;i.transform.position.x=n.transform.position.x=r.transform.position.x;i.transform.position.y=n.transform.position.y=r.transform.position.y;e=Math.cos(i.transform.rotation.z);t=Math.sin(i.transform.rotation.z);i.transform.position.x+=e*i.transform.width/1.35;i.transform.position.y+=t*i.transform.width/1.35;n.transform.position.x+=e*i.reach;n.transform.position.y+=t*i.reach;Game.enemies.map(function(e){if(Game.utils.collision(e,n)){if(!e.melee_hit){Game.enemy_functions.do_damage.call(e,i.damage);e.melee_hit=true}}})}else{Game.enemies.map(function(e){e.melee_hit=false});i.active=false;i.transform.visible=false}};Game.player.do_ranged=function(e){if(e.ranged.cooldown_left==0){e.ranged.ammo--;Game.projectiles.push({source:e,damage:e.ranged.damage,type:"vector",speed:e.ranged.speed,vol:Game.utils.normalize(e.transform.position.x-Game.graphics.camera.x,e.transform.position.y-Game.graphics.camera.y,Game.input.mouse.x,Game.input.mouse.y),range:e.ranged.range,transform:{visible:true,position:{x:e.transform.position.x,y:e.transform.position.y,z:2},rotation:{x:0,y:0,z:.5},scale:{x:4,y:4},offset:{x:300,y:22,r:1},width:12,height:12},col:6});Game.graphics.draw_list[2].push(Game.projectiles[Game.projectiles.length-1].transform);if(e.ranged.ammo==0){e.ranged.ammo=e.ranged.max_ammo;e.ranged.reload_time_left=e.ranged.reload_time}e.ranged.cooldown_left=e.ranged.cooldown}};Game.player.do_bomb=function(e){e.bomb.active=true;e.bomb.duration_left=e.bomb.duration;e.bomb.transform.position.x=e.transform.position.x;e.bomb.transform.position.y=e.transform.position.y};Game.player.update_bomb=function(e,t){Game.utils.count_down(e,"duration_left",t);if(!e.duration_left){e.active=false;Game.enemies.map(function(t){if(Game.utils.collision(t,e)){Game.enemy_functions.do_damage.call(t,e.damage)}})}};Game.player.melee.transform={visible:true,position:{x:100,y:100,z:2},rotation:{x:0,y:0,z:0},scale:{x:4,y:4},offset:{x:188,y:104,r:0},width:31,height:15};Game.player.bomb.transform={visible:true,position:{x:100,y:100,z:2},rotation:{x:0,y:0,z:0},scale:{x:4,y:4},offset:{x:8,y:364,r:0},width:24,height:10};var n={col:10,transform:{visible:true,position:{x:100,y:100,z:2},rotation:{x:0,y:0,z:0},scale:{x:4,y:4},offset:{x:292,y:46,r:0},height:20,width:20}};Game.player.exp={};var r=Game.player.exp;r.total=0;r.selected="melee";r.melee={xp:25,next:10,level:0,perk_levels:[30,60,100],perk_names:["sword_2","sword_3","swipe"]};r.ranged={xp:0,next:10,level:0,perk_levels:[20,40,60,80,100],perk_names:["clip_x2","reload_half","clip_x4","range_x2","spread_shot"]};r.bomb={xp:0,next:10,level:0,perk_levels:[20,40,60,80,100],perk_names:["radius_150","cooldown_75","radius_200","cooldown_40","panic_bomb"]};var i=10;Game.player.add_xp=function(e,t){e.total+=t;if(e[e.selected].level<100){e[e.selected].xp+=t;if(e[e.selected].xp>=e[e.selected].next){e[e.selected].xp-=e[e.selected].next;e[e.selected].level++;e["level_"+e.selected]();for(var n=0;n<e[e.selected].perk_levels.length;n++){if(e[e.selected].perk_levels[n]==e[e.selected].level){e["perk_"+e[e.selected].perk_names[n]]()}}Game.player.hp=Game.player.max_hp;Game.player.ranged.reload_time_left=0;Game.player.ranged.ammo=Game.player.ranged.max_ammo;Game.player.bomb.cooldown_left=0;e[e.selected].next=Math.floor(i*Math.pow(1.05,e[e.selected].level)+5*e[e.selected].level)}}};(function(e){e.exp.level_melee=function(){e.melee.damage+=1;e.melee.movement+=1;e.max_hp+=2};e.exp.level_ranged=function(){e.ranged.damage+=.75;e.ranged.movement+=1;e.ranged.cooldown-=2.5;e.speed+=1.5};e.exp.level_bomb=function(){e.bomb.damage+=4;e.health_regen+=.5};e.exp.perk_sword_2=function(){e.melee.transform.width=37;e.melee.transform.height=16;e.melee.transform.offset.x=183;e.melee.transform.offset.y=118;e.melee.reach=40};e.exp.perk_sword_3=function(){e.melee.transform.width=45;e.melee.transform.height=15;e.melee.transform.offset.x=176;e.melee.transform.offset.y=134;e.melee.reach=45};e.exp.perk_swipe=function(){};e.exp.perk_clip_x2=function(){e.ranged.max_ammo*=2};e.exp.perk_reload_half=function(){e.ranged.reload_time/=2};e.exp.perk_clip_x4=function(){e.ranged.max_ammo*=2};e.exp.perk_range_x2=function(){e.ranged.range*=2};e.exp.perk_spread_shot=function(){};e.exp.perk_radius_150=function(){e.bomb.col=150};e.exp.perk_cooldown_75=function(){e.bomb.cooldown=1e4*.75};e.exp.perk_radius_200=function(){e.bomb.col=200};e.exp.perk_cooldown_40=function(){e.bomb.cooldown=1e4*.4};e.exp.perk_panic_bomb=function(){};e._reset=function(){e.hp=e.max_hp=10;e.health_regen=1;e.speed=200;e.melee.damage=4;e.melee.reach=25;e.melee.cooldown_left=0;e.ranged.damage=3;e.ranged.cooldown=500;e.ranged.cooldown_left=0;e.ranged.ammo=e.ranged.max_ammo=6;e.ranged.reload_time=5e3;e.ranged.reload_time_left=0;e.ranged.range=200;e.bomb.active=false;e.bomb.damage=10;e.bomb.col=100;e.bomb.cooldown=1e4;e.bomb.cooldown_left=0;e.transform={visible:true,position:{x:100,y:100,z:1},rotation:{x:0,y:0,z:.5},scale:{x:4,y:4},offset:{x:322,y:111,r:1},width:28,height:28};e.isDead=false;Game.player.melee.transform={visible:true,position:{x:100,y:100,z:2},rotation:{x:0,y:0,z:0},scale:{x:4,y:4},offset:{x:188,y:104,r:0},width:31,height:15};e.exp.total=0;e.exp.melee.xp=0;e.exp.melee.next=10;e.exp.melee.level=0;e.exp.ranged.xp=0;e.exp.ranged.next=10;e.exp.ranged.level=0;e.exp.bomb.xp=0;e.exp.bomb.next=10;e.exp.bomb.level=0;Game.graphics.draw_list[1].push(Game.player.transform)}})(Game.player)})();(function(){Game.enemies=[];Game.enemy_functions={};Game.update_enemies=function(e){Game.enemies=Game.enemies.filter(function(t){return Game.enemy_functions["update_"+t.type](t,Game.player,e)})};Game.enemy_functions.update_lame_brain=function(e,t,n){if(!e.active){return false}if(e.animator.death_count_left){Game.animator.mob_update(e,n);return true}e.chasing=Game.utils.proximity(e,t)<200;if(e.chasing){e.animator.paused=false;e.transform.rotation.z=Game.utils.point_to(e.transform.position.x,e.transform.position.y,t.transform.position.x,t.transform.position.y);if(Game.utils.proximity(e,t)<35){e.vol=[0,0];Game.utils.count_down(e,"attack_wind_up_left",n);if(!e.attack_wind_up_left){Game.utils.damage(t,e.damage);e.attack_wind_up_left=e.attack_wind_up}}else{e.vol=Game.utils.normalize(e.transform.position.x,e.transform.position.y,t.transform.position.x,t.transform.position.y)}}else if(e.standing){Game.utils.count_down(e,"standing",n);if(!e.standing){e.vol=Game.utils.randomize_direction();Game.enemy_functions.point_walk(e);e.wonder=Math.random()*275+75;e.animator.paused=false}}else if(e.wonder){e.wonder-=e.speed*n;if(e.wonder<=0){e.wonder=0;e.vol=[0,0];e.standing=Math.random()*250+500;e.animator.paused=true}}Game.enemy_functions.move(e,n);Game.animator.mob_update(e,n);return true};Game.enemy_functions.update_stand_n_shoot=function(e,t,n){if(!e.active){return false}if(e.animator.death_count_left){Game.animator.mob_update(e,n);return true}if(e.spread_out){if(e.vol[0]||e.vol[1]){e.spread_out-=e.speed*n;if(e.spread_out<0){e.spread_out=0}}else{e.vol=Game.utils.randomize_direction();Game.enemy_functions.point_walk(e)}}else{e.vol=Game.utils.normalize(e.transform.position.x,e.transform.position.y,t.transform.position.x,t.transform.position.y);Game.enemy_functions.point_walk(e);e.animator.paused=false;if(Game.utils.proximity(e,t)<250){e.animator.paused=true;e.vol=[0,0];Game.utils.count_down(e,"cooldown_left",n);if(!e.cooldown_left){e.cooldown_left=e.cooldown;Game.projectiles.push({source:e,damage:e.damage,type:"vector",speed:e.range_speed,vol:Game.utils.normalize(e.transform.position.x,e.transform.position.y,t.transform.position.x,t.transform.position.y),range:700,transform:{visible:true,position:{x:e.transform.position.x,y:e.transform.position.y,z:2},rotation:{x:0,y:0,z:.5},scale:{x:4,y:4},offset:{x:312,y:22,r:0},width:12,height:12},col:10});Game.graphics.draw_list[2].push(Game.projectiles[Game.projectiles.length-1].transform)}}}Game.enemy_functions.move(e,n);Game.animator.mob_update(e,n);return true};(function(){var e=Math.PI*2;var t,n,r,i;Game.enemy_functions.update_back_stabber=function(s,o){if(!s.active){return false}if(s.animator.death_count_left){Game.animator.mob_update(s,delta);return true}if(s.spread_out){if(s.vol[0]||s.vol[1]){s.spread_out-=s.speed*delta;if(s.spread_out<0){s.spread_out=0}}else{s.vol=Game.utils.randomize_direction();Game.enemy_functions.point_walk(s)}}else{Game.utils.count_down(s,"cooldown_left",delta);s.transform.rotation.z=Game.utils.point_to(s.transform.position.x,s.transform.position.y,o.transform.position.x,o.transform.position.y);s.animator.paused=false;t=(o.transform.rotation.z+e)%e;n=(s.transform.rotation.z+e)%e;r=Math.abs(t-n)%e;i=r>Math.PI?e-r:r;if(i<Math.PI/2){if(Game.utils.proximity(s,o)<35){s.vol=[0,0];if(!s.cooldown_left){Game.utils.count_down(s,"attack_wind_up_left",delta)}if(!s.attack_wind_up_left){Game.utils.damage(o,s.damage);s.attack_wind_up_left=s.attack_wind_up;s.cooldown_left=s.cooldown}}else{s.vol=Game.utils.normalize(s.transform.position.x,s.transform.position.y,o.transform.position.x,o.transform.position.y)}}else{s.vol=[0,0];s.animator.paused=true}}Game.enemy_functions.move(s,delta);Game.animator.mob_update(s,delta);return true}})();Game.enemy_functions.update_big_n_heavy=function(e,t){if(!e.active){return false}if(e.animator.death_count_left){Game.animator.mob_update(e,delta);return true}if(e.spread_out){if(e.vol[0]||e.vol[1]){e.spread_out-=e.speed*delta;if(e.spread_out<0){e.spread_out=0}}else{e.vol=Game.utils.randomize_direction()}}else{Game.utils.count_down(e,"cooldown_left",delta);if(Game.utils.proximity(e,t)<35){e.vol=[0,0];if(!e.cooldown_left){Game.utils.count_down(e,"attack_wind_up_left",delta)}if(!e.attack_wind_up_left){Game.utils.damage(t,e.damage);e.attack_wind_up_left=e.attack_wind_up;e.cooldown_left=e.cooldown}}else{e.vol=Game.utils.normalize(e.transform.position.x,e.transform.position.y,t.transform.position.x,t.transform.position.y)}}Game.enemy_functions.move(e,delta);Game.animator.mob_update(e,delta);return true};Game.enemy_functions.move=function(e,t){e.transform.position.x+=e.vol[0]*e.speed*t;e.transform.position.y+=e.vol[1]*e.speed*t;if(e.transform.position.x<40+e.col){e.transform.position.x=40+e.col;e.vol[0]*=-1;Game.enemy_functions.point_walk(e)}if(e.transform.position.x>1240-e.col){e.transform.position.x=1240-e.col;e.vol[0]*=-1;Game.enemy_functions.point_walk(e)}if(e.transform.position.y<40+e.col){e.transform.position.y=40+e.col;e.vol[1]*=-1;Game.enemy_functions.point_walk(e)}if(e.transform.position.y>920-e.col){e.transform.position.y=920-e.col;e.vol[1]*=-1;Game.enemy_functions.point_walk(e)}if(e.type=="big_n_heavy"){e.transform.rotation.z=0}};Game.enemy_functions.point_walk=function(e){e.transform.rotation.z=Game.utils.point_to(e.transform.position.x,e.transform.position.y,e.transform.position.x+e.vol[0],e.transform.position.y+e.vol[1])};Game.enemy_functions.do_damage=function(e){Game.utils.damage(this,e);if(!this.hp){Game.enemy_functions.die.call(this)}else{this.animator.hurt_count_left=this.animator.hurt_count}};Game.enemy_functions.die=function(){Game.player.add_xp(Game.player.exp,this.points);Game.bm.enemy_count--;this.animator.death_count_left=4;for(var e=0;e<Game.graphics.draw_list[1].length;e++){if(this.transform===Game.graphics.draw_list[1][e]){Game.graphics.draw_list[1].splice(e,1);Game.graphics.draw_list[0].push(this.transform)}}};Game.enemy_functions.destroy=function(){this.active=false;this.transform.visible=false}})();(function(){Game.projectiles=[];var e;Game.update_projectiles=function(t){Game.projectiles=Game.projectiles.filter(function(n){e=true;switch(n.type){case"vector":n.transform.position.x+=n.vol[0]*n.speed*t;n.transform.position.y+=n.vol[1]*n.speed*t;n.range-=n.speed*t;break}if(n.source==Game.player){for(var r=0;r<Game.enemies.length;r++){if(!Game.enemies[r].animator.death_count_left&&Game.utils.collision(n,Game.enemies[r])){Game.enemy_functions.do_damage.call(Game.enemies[r],n.damage);e=false;break}}}else{if(Game.utils.collision(n,Game.player)){Game.utils.damage(Game.player,n.damage);e=false}}if(n.range<0){e=false}return n.transform.visible=e})}})();(function(){Game.bm={};Game.enemy_stats=[{type:"lame_brain",hp:6,speed:70,damage:1,graphic:[0,73,24,20,0]},{type:"stand_n_shoot",hp:6,speed:90,damage:1,graphic:[28,0,28,22,1]},{type:"back_stabber",hp:6,speed:120,damage:2,graphic:[0,22,20,18,1]},{type:"big_n_heavy",hp:12,speed:45,damage:3,graphic:[64,40,32,32,0]}];Game.bm.wave_time=Game.bm.wave_time_left=3e3;var e=750;Game.bm.spawn_cooldown_left=0;Game.update_battle_master=function(n,r){if(t){Game.utils.count_down(n,"spawn_cooldown_left",r);if(!n.spawn_cooldown_left){n.spawn_cooldown_left=e;for(var i=0;i<l.length;i++){if(l[i].length){var s=l[i].splice(Math.floor(Math.random()*l[i].length),1);Game.spawn_enemy(u[s],c[i].position.x,c[i].position.y);t--}}}}else if(!n.enemy_count){n.luck+=Math.round(n.wave_time_left/n.wave_time*100);if(n.luck>100){n.luck=100}n.do_wave()}else{Game.utils.count_down(n,"wave_time_left",r);if(!n.wave_time_left){n.luck-=Math.round(n.enemy_count/n.enemy_count_total*100);if(n.luck<0){n.luck=0}n.do_wave()}}};var t=0;Game.spawn_enemy=function(e,t,n){var r=Game.utils.clone(e);r.active=true;r.transform={visible:true,position:{x:t,y:n,z:1},rotation:{x:0,y:0,z:0},scale:{x:4,y:4},offset:{x:r.graphic[0],y:r.graphic[1],r:r.graphic[4]},width:r.graphic[2],height:r.graphic[3]};r.max_hp=r.hp;r.vol=[0,0];r.chasing=false;r.animator=Game.animator.setup_animation(r);switch(r.type){case"lame_brain":r.col=14;r.wonder=0;r.standing=500;r.attack_wind_up=400;r.attack_wind_up_left=400;break;case"stand_n_shoot":r.col=14;r.spread_out=200;r.cooldown=1500;r.cooldown_left=0;r.range_speed=200;break;case"back_stabber":r.col=14;r.spread_out=200;r.attack_wind_up=200;r.attack_wind_up_left=200;r.cooldown=400;r.cooldown_left=400;break;case"big_n_heavy":r.col=20;r.spread_out=200;r.attack_wind_up=400;r.attack_wind_up_left=400;r.cooldown=600;r.cooldown_left=600;break}r.destroy=Game.enemy_functions.destroy;r.die=Game.enemy_functions.die;r.melee_hit=false;Game.enemies.push(r);Game.graphics.draw_list[1].push(r.transform)};var n=[.45,.2,.15,.1];var r=[10,4,2,1];var i=20;var s=Game.bm;s.wave=4;s.enemy_count=0;s.enemy_count_total=0;var o;Game.bm.craft_enemy=function(e,t){if(t>50){e.tier=3}else if(t>30){e.tier=2}else if(t>15){e.tier=1}else{e.tier=0}var n=Game.utils.clone(e);switch(e.type){case"lame_brain":case"stand_n_shoot":n.hp+=Math.round(t*.5/3);n.speed+=Math.round(t*.5/3);n.damage+=Math.round(t*.34/3);break;case"back_stabber":n.hp+=Math.round(t*.3/3);n.speed+=Math.round(t*.8/3);n.damage+=Math.round(t*.7/3);break;case"big_n_heavy":n.hp+=Math.round(t*1/3);n.speed+=Math.round(t*.25/3);n.damage+=Math.round(t*1/3);break}n.points=t;return n};var u=[];var a=[];Game.bm.do_wave=function(){s.wave++;i*=1.08;var e=100-Game.bm.luck;if(e<0){e=0}e/=100;e*=4;e+=1;var o=i*e;var f=[];t=0;var c=0;n.map(function(e){var t=Math.random()*100*e;c+=t;f.push(t)});for(var h=0;h<f.length;h++){f[h]=f[h]/c*o;a[h]=Math.round(f[h]/o/n[h]*r[h]);if(a[h]){u[h]=Game.bm.craft_enemy(Game.enemy_stats[h],f[h]/a[h])}t+=a[h];for(var p=0;p<a[h];p++){l[Math.floor(Math.random()*l.length)].push(h)}}s.enemy_count_total=s.enemy_count+=t;s.wave_time_left=s.wave_time=s.enemy_count_total*1500};var f=[];f[3]=[1,2];f[4]=[2,2];f[5]=[2,1,2];f[6]=[2,2,2];f[7]=[2,3,2];f[8]=[3,2,3];f[9]=[3,3,3];f[10]=[3,4,3];f[11]=[4,3,4];f[12]=[4,4,4];f[13]=[3,4,3,3];f[14]=[3,4,3,4];f[15]=[4,4,4,3];f[16]=[4,4,4,4];var l=[];var c=[];for(var h=0;h<16;h++){c.push({visible:true,position:{x:100,y:100,z:0},rotation:{x:0,y:0,z:0},scale:{x:1,y:1},offset:{x:57,y:110,r:0},width:38,height:38})}var p=5;Game.bm.set_portals=function(e){l=[];for(var t=0;t<c.length;t++){c[t].visible=false}Game.graphics.draw_list[0]=[];var n=[];var r=880/(f[e].length+1);f[e].map(function(e){n.push(1200/(e+1))});var i=0;for(var t=0;t<f[e].length;t++){for(var s=0;s<f[e][t];s++){c[i].visible=true;c[i].position.x=n[t]*(s+1);c[i].position.y=r*(t+1);c[i].position.x+=Math.random()*n[t]-n[t]/2;c[i].position.y+=Math.random()*r-r/2;Game.graphics.draw_list[0].push(c[i]);l.push([]);i++}}};Game.bm.luck=100;Game.bm._reset=function(){Game.bm.luck=100;p=5;i=20;Game.bm.wave=0;Game.bm.enemy_count=0;Game.bm.enemy_count_total=0;r=[10,4,2,1];Game.bm.set_portals(p);Game.bm.do_wave()};Game.bm.set_portals(p);Game.bm.do_wave()})();(function(){Game.animator={};Game.animator.setup_animation=function(e){var t={};if(e.type){switch(e.type){case"lame_brain":t.looping=true;t.loop_tiers=[];t.base_loop=[[0,73],[24,73],[0,73],[48,73]];t.tier_width=72;t.frame_rate=240;t.frame_rate_left=96;break;case"stand_n_shoot":t.looping=true;t.loop_tiers=[];t.base_loop=[[0,0],[28,0],[0,0],[56,0]];t.tier_width=84;t.frame_rate=80;t.frame_rate_left=80;break;case"back_stabber":t.looping=true;t.loop_tiers=[];t.base_loop=[[0,22],[20,22],[0,22],[40,22]];t.tier_width=60;t.frame_rate=60;t.frame_rate_left=60;break;case"big_n_heavy":t.looping=true;t.loop_tiers=[];t.base_loop=[[64,40],[32,40],[0,40]];t.tier_width=96;t.frame_rate=70;t.frame_rate_left=50;break}}t.tier=0;t.tier_base=e.tier;t.loop_index=0;t.paused=false;t.hurt_count=8;t.hurt_count_left=0;t.hurt_frame=34;t.hurt_frame_left=0;t.death_count_left=0;t.death_frame_left=0;return t};Game.animator.mob_update=function(e,t){if(e.animator.death_count_left){Game.utils.count_down(e.animator,"death_frame_left",t);if(!e.animator.death_frame_left){if(e.animator.death_count_left==4){e.transform.width=e.transform.height=32;e.transform.offset.x=222;e.transform.offset.y=106;e.animator.death_frame_left=34;e.animator.death_count_left--}else if(e.animator.death_count_left==3){e.transform.offset.x=254;e.transform.offset.y=106;e.animator.death_frame_left=34;e.animator.death_count_left--}else if(e.animator.death_count_left==2){e.transform.offset.x=286;e.transform.offset.y=106;e.animator.death_frame_left=2250;e.animator.death_count_left--}else{e.destroy()}}return}if(e.animator.hurt_count_left){Game.utils.count_down(e.animator,"hurt_frame_left",t);if(!e.animator.hurt_frame_left){e.animator.hurt_frame_left=e.animator.hurt_frame;e.animator.hurt_count_left--;if(e.animator.hurt_count_left%2==1){e.animator.tier=4}else{e.animator.tier=e.animator.tier_base}}}if(e.animator.looping){if(!e.animator.paused){Game.utils.count_down(e.animator,"frame_rate_left",t)}if(!e.animator.frame_rate_left){e.animator.frame_rate_left=e.animator.frame_rate;e.animator.loop_index++;if(e.animator.loop_index>=e.animator.base_loop.length){e.animator.loop_index=0}}}e.transform.offset.x=e.animator.base_loop[e.animator.loop_index][0]+e.animator.tier*e.animator.tier_width;e.transform.offset.y=e.animator.base_loop[e.animator.loop_index][1]}})();window.onload=function(e){document.oncontextmenu=document.body.oncontextmenu=function(){return false};Game.utils.add_default(Game.config,{});Game.utils.add_default(Game.config.fps,60);Game.utils.add_default(Game.config.canvas_id,"game_canvas");Game.utils.add_default(Game.config.fps_counter_id,"fps_counter");Game.paused=false;Game.update=function(e){if(!Game.paused){Game.update_player(Game.player,e);if(!Game.player.isDead){Game.update_projectiles(e);Game.update_enemies(e);Game.update_battle_master(Game.bm,e)}}};Game.run=function(){var e=1e3/Game.config.fps;start_tick=next_tick=last_tick=(new Date).getTime();num_frames=0;return function(){current_tick=(new Date).getTime();while(current_tick>next_tick){delta=(current_tick-last_tick)/1e3;Game.update(delta);next_tick+=e;last_tick=(new Date).getTime()}Game.graphics.draw(Game.graphics.context);fps=num_frames/(current_tick-start_tick)*1e3;Game.graphics.fps_counter.textContent=Math.round(fps);num_frames++}}();if(window.webkitRequestAnimationFrame){window.each_frame=function(e){var t=function(){e();webkitRequestAnimationFrame(t)};t()}}else if(window.mozRequestAnimationFrame){window.each_frame=function(e){var t=function(){e();mozRequestAnimationFrame(t)};t()}}else{window.each_frame=function(e){setInterval(e,1e3/Game.config.fps)}}window.each_frame(Game.run);Game.reset_game=function(){if(Game.player.isDead){Game.enemies=[];Game.projectiles=[];Game.graphics.draw_list=[[],[],[]];Game.bm._reset();Game.player._reset();Game.graphics.camera={x:0,y:0}}}}