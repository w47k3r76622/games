function clearRect(e,n,t,i,o,c){context.beginPath(),context.rect(n,t,i,o),c?(context.lineWidth=4,context.strokeStyle=e,context.stroke()):(context.fillStyle=e,context.fillRect(n,t,i,o)),context.closePath()}function drawRect(e,n,t,i,o,c){context.beginPath(),context.rect(n,t,i,o),context.lineWidth=4,context.strokeStyle=e,context.stroke(),context.closePath()}function drawElement(e,n,t,i,o,c,r,S,l,E){context.beginPath(),context.lineWidth=3,context.strokeStyle=n,"FIRE"===e?drawFireSymbol(n,t,i,o,c):"WATER"===e?drawWaterSymbol(n,t,i,o,c):"AIR"===e&&drawAirSymbol(n,t,i,o,c),"EARTH"===e&&drawEarthSymbol(n,t,i,o,c),drawHealth(t,i-c/4,o,c,S,l,E),context.closePath()}function drawFire(e,n,t,i,o,c,r,S,l){drawElement("FIRE",e,n,t,i,o,c,r,S,l)}function drawWater(e,n,t,i,o,c,r,S,l){drawElement("WATER",e,n,t,i,o,c,r,S,l)}function drawEarth(e,n,t,i,o,c,r,S,l){drawElement("EARTH",e,n,t,i,o,c,r,S,l)}function drawAir(e,n,t,i,o,c,r,S,l){drawElement("AIR",e,n,t,i,o,c,r,S,l)}function drawFireSymbol(e,n,t,i,o){context.strokeStyle=e,context.moveTo(n+i/2,t),context.lineTo(n+i,t+o),context.moveTo(n+i/2,t),context.lineTo(n,t+o),context.moveTo(n,t+o),context.lineTo(n+i,t+o),context.stroke()}function drawWaterSymbol(e,n,t,i,o){context.strokeStyle=e,context.moveTo(n,t),context.lineTo(n+i/2,t+o),context.moveTo(n+i,t),context.lineTo(n+i/2,t+o),context.moveTo(n,t),context.lineTo(n+i,t),context.stroke()}function drawAirSymbol(e,n,t,i,o){context.strokeStyle=e,context.moveTo(n+i/2,t),context.lineTo(n+i,t+o),context.moveTo(n+i/2,t),context.lineTo(n,t+o),context.moveTo(n,t+o),context.lineTo(n+i,t+o),context.moveTo(n,t+o/3),context.lineTo(n+i,t+o/3),context.stroke()}function drawEarthSymbol(e,n,t,i,o){context.moveTo(n,t),context.lineTo(n+i/2,t+o),context.moveTo(n+i,t),context.lineTo(n+i/2,t+o),context.moveTo(n,t),context.lineTo(n+i,t);var c=t+o;context.moveTo(n,c-o/3),context.lineTo(n+i,c-o/3),context.stroke()}function drawPlayer(e,n,t,i,o,c,r,S){context.beginPath(),context.fillStyle=selectedSkill===SKILL_NONE?e:"#000000",context.fill(),selectedSkill===SKILL_FIRE?(context.strokeStyle="#FF1000",context.arc(n,t,i,0,2*Math.PI,!1),drawFireSymbol("#FF1000",n-i/2,t-o/2,i,o)):selectedSkill===SKILL_WATER?(context.strokeStyle="#007BFF",context.arc(n,t,i,0,2*Math.PI,!1),drawWaterSymbol("#007BFF",n-i/2,t-o/2,i,o)):selectedSkill===SKILL_AIR?(context.strokeStyle="#FFFF07",context.arc(n,t,i,0,2*Math.PI,!1),drawAirSymbol("#FFFF07",n-i/2,t-o/2,i,o)):selectedSkill===SKILL_EARTH&&(context.strokeStyle="#0CFF00",context.arc(n,t,i,0,2*Math.PI,!1),drawEarthSymbol("#0CFF00",n-i/2,t-o/2,i,o)),context.stroke(),drawHealth(n-i,t-i-i/4,2*i,o,r,S,playerTakingDamage),context.closePath()}function drawText(e,n,t,i,o){context.beginPath(),context.fillStyle="#"+n,context.font=o,context.fillText(e,t-4.5*e.length,i),context.closePath()}function drawHealth(e,n,t,i,o,c,r){if(0!==o){var S=100*(o/c);context.fillStyle="#404040",context.fillRect(e,n,t,5),context.fillStyle=r===HEALTH_EFFECT_DAMAGE?"#FF1500":r===HEALTH_EFFECT_HEAL?"#00A5FF":"#1CFF60",context.fillRect(e,n,t/100*S,5)}}function main(){lastTime=Date.now(),ENEMY_TIMER_MAX=2,newEnemyTimer=ENEMY_TIMER_MAX,MAX_ENEMY_COUNT=100,width=1200,height=700;var e=width/8-10;selectedSkill=SKILL_NONE,playerScore=0,scenes=[[[0,"Alchemist's",drawRect,"FFFFFF",width/2-100,-1100,200,50,!1,width/2-100-70,60,0,!1,null,3,!0,!1,"bold 42px Arial",200,50,0,0,3,!1,0],[0,"NIGHT",drawRect,"FF0000",width/2-100-8e3,200,200,50,!1,width/2-100-130,120,0,!1,null,3,!0,!1,"bold 50px Times New Roman",200,50,0,0,3,!1,0],[0,"MARE",drawRect,"FF0000",width/2-100+8e3,200,200,50,!1,width/2-100+35,120,0,!1,null,3,!0,!1,"bold 50px Times New Roman",200,50,0,0,3,!1,0],[0,"Fire",drawFire,"FF1000",1*e-400,350,50,50,!1,1*e,350,0,!1,null,3,!0,!0,"bold 16px Arial",50,50,0,0,3,!1,0],[0,"Water",drawWater,"007BFF",3*e+1e3,350,50,50,!1,3*e,350,0,!1,null,3,!0,!0,"bold 16px Arial",50,50,0,0,3,!1,0],[0,"Air",drawAir,"FFFF07",5*e,-650,50,50,!1,5*e,350,0,!1,null,3,!0,!0,"bold 16px Arial",50,50,0,0,3,!1,0],[0,"Earth",drawEarth,"0CFF00",7*e,1350,50,50,!1,7*e,350,0,!1,null,3,!0,!0,14,50,50,0,0,3,!1,0],[0,"Start Game",drawRect,"FFFFFF",width/2-100,height+200,200,50,!1,width/2-100,height-100,0,!1,"startGame",3,!0,!0,"bold 16px Arial",200,50,0,0,3,!1,0]],[[0,"Player",drawPlayer,"727272",width/2,height/2,0,0,!1,width/2,height/2,0,!1,null,1,!1,!0,"bold 16px Arial",40,40,1e3,1e3,3,!0,0],[0,"The large symbol above is you!",drawPlayer,"E8FFFB",width/2+20,height/2+20,0,0,!1,width/2+20,height/2+20,6,!1,null,1,!0,!1,"italic 14px Arial",40,40,0,1e3,10,!0,0],[0,"Right clicking moves; Q, W, E, R switches element and left click shoots the current element.",drawPlayer,"E8FFFB",width/2+100,height/2+45,0,0,!1,width/2+100,height/2+45,6,!1,null,1,!0,!1,"italic 14px Arial",40,40,0,1e3,10,!0,0],[0,"Fire",drawFire,"A0A0A0",width-400,height+100,30,30,!1,width-320,height-80,0,!1,null,3,!0,!0,"bold 16px Arial",30,30,0,0,3,!1,0],[0,"Fire_ACTIVE",drawFire,"FF1000",width-400,height+100,30,30,!1,width-320,height-80,0,!1,null,3,!1,!1,"bold 16px Arial",30,30,0,0,3,!1,0],[0,"Water",drawWater,"A0A0A0",width-300,height+100,30,30,!1,width-240,height-80,0,!1,null,3,!0,!0,"bold 16px Arial",30,30,0,0,3,!1,!1],[0,"Water_ACTIVE",drawWater,"007BFF",width-300,height+100,30,30,!1,width-240,height-80,0,!1,null,3,!1,!1,"bold 16px Arial",30,30,0,0,3,!1,0],[0,"Air",drawAir,"A0A0A0",width-200,height+100,30,30,!1,width-160,height-80,0,!1,null,3,!0,!0,"bold 16px Arial",30,30,0,0,3,!1,0],[0,"Air_ACTIVE",drawAir,"FFFF07",width-200,height+100,30,30,!1,width-160,height-80,0,!1,null,3,!1,!1,"bold 16px Arial",30,30,0,0,3,!1,0],[0,"Earth",drawEarth,"A0A0A0",width-100,height+100,30,30,!1,width-80,height-80,0,!1,null,3,!0,!0,"bold 16px Arial",30,30,0,0,3,!1,0],[0,"Earth_ACTIVE",drawEarth,"0CFF00",width-100,height+100,30,30,!1,width-80,height-80,0,!1,null,3,!1,!1,"bold 16px Arial",30,30,0,0,3,!1,0],[0,"End Game",drawRect,"FFFFFF",width-110,-110,100,50,!1,width-110,10,0,!1,"endCurrentGame",3,!0,!0,"bold 16px Arial",100,50,0,0,3,!1,0]],[[0,"GAME",drawRect,"FF0000",width/2-100-32e3,450,250,50,!1,width/2-100-130,250,0,!1,null,3,!0,!1,"bold 50px Times New Roman",200,50,0,0,3,!1,0],[0,"OVER",drawRect,"FF0000",width/2-100+32e3,450,250,50,!1,width/2-100+40,250,0,!1,null,3,!0,!1,"bold 50px Times New Roman",200,50,0,0,3,!1,0],[0,"Score: ",drawRect,"FFFFFF",width/2-100-60,200,120,50,!1,width/2-100-60,120,0,!1,null,3,!0,!1,"bold 50px Times New Roman",200,50,0,0,3,!1,0],[0,"Thanks for playing!",drawPlayer,"FFFFF",width/2,height/2+45,0,0,!1,width/2,height/2+45,0,!1,null,1,!0,!1,"italic 16px Arial",40,40,0,1e3,10,!0,0],[0,"Restart",drawRect,"FFFFFF",width/2-100,height+200,200,50,!1,width/2-100,height-100,0,!1,"restartGame",3,!0,!0,"bold 16px Arial",200,50,0,0,3,!1,0]]],changeScene(SCENE_MENU),activeObject=null,c=document.getElementById("canvas"),context=c.getContext("2d"),c.width=width,c.height=height,boundingBoxes=!1,mousePosition={x:0,y:0},setupInput(),function n(){var e=Date.now(),t=(e-lastTime)/1e3;requestAnimationFrame(n),update(t),render(),lastTime=e}()}function changeScene(e){currentScene=e,workingScene=[];for(var n=0;scenes[currentScene].length>n;n++)addToWorkingScene(scenes[currentScene][n].slice(0))}function addToWorkingScene(e){25!==e.length&&console.log(e[SO_NAME]+" is not the right length"),workingScene.push(e),updateSceneIDs()}function updateSceneIDs(){for(var e=0;workingScene.length>e;e++)workingScene[e][SO_ID]=e}function setupInput(){function e(e){e=e||window.event,mousePosition.x=e.pageX-canvas.getBoundingClientRect().left,mousePosition.y=e.pageY-canvas.getBoundingClientRect().top}function n(e){0===e.button&&(currentScene===SCENE_GAME&&useSkill(),leftClick())}function t(e){2===e.button&&rightClick(),e.preventDefault()}function i(e){var n=e.keyCode||e.charCode;49===n&&(boundingBoxes=!boundingBoxes),currentScene===SCENE_GAME&&(113===n?selectedSkill===SKILL_FIRE||(selectedSkill=SKILL_FIRE):119===n?selectedSkill===SKILL_WATER||(selectedSkill=SKILL_WATER):114===n?selectedSkill===SKILL_EARTH||(selectedSkill=SKILL_EARTH):101===n&&(selectedSkill===SKILL_AIR||(selectedSkill=SKILL_AIR)))}window.onmousemove=e,window.onclick=n;var o=document.getElementsByTagName("html")[0];o.oncontextmenu=t,window.onkeypress=i}function useSkill(){if(selectedSkill!==SKILL_NONE){var e,n,t=findSceneObject("Player");selectedSkill===SKILL_FIRE?(e=findSceneObject("Fire_ACTIVE"),n=findSceneObject("Fire")):selectedSkill===SKILL_WATER?(e=findSceneObject("Water_ACTIVE"),n=findSceneObject("Water")):selectedSkill===SKILL_EARTH?(e=findSceneObject("Earth_ACTIVE"),n=findSceneObject("Earth")):selectedSkill===SKILL_AIR&&(e=findSceneObject("Air_ACTIVE"),n=findSceneObject("Air"));var i=15;addToWorkingScene([0,n[SO_NAME].toUpperCase()+"_PROJECTILE",n[SO_TYPE],e[SO_COLOUR],t[SO_X],t[SO_Y],i/4,i/4,!1,mousePosition.x-i/2,mousePosition.y-i/2,5,!1,null,8,!1,!0,"bold 16px Arial",i,i,0,0,3,!0,0])}}function startGame(){ENEMY_TIMER_MAX=2,newEnemyTimer=ENEMY_TIMER_MAX,selectedSkill=SKILL_FIRE,playerScore=0,changeScene(SCENE_GAME)}function endCurrentGame(){changeScene(SCENE_SCORE)}function restartGame(){selectedSkill=SKILL_NONE,changeScene(SCENE_MENU)}function pointInRectangle(e,n){return e[0]>=n[0]&&n[0]+n[2]>=e[0]&&e[1]>=n[1]&&n[1]+n[3]>=e[1]}function leftClick(){activeObject=null;for(var e=0;workingScene.length>e;e++)if(pointInRectangle([mousePosition.x,mousePosition.y],getObjectRectangle(workingScene[e]))&&(workingScene[e][SO_CLICKABLE]&&(activeObject=e),null!==workingScene[e][SO_CLICK_EVENT])){var n=window[workingScene[e][SO_CLICK_EVENT]];"function"==typeof n&&n()}}function rightClick(){if(null!=activeObject){var e=20;addToWorkingScene([0,workingScene[activeObject][SO_NAME],workingScene[activeObject][SO_TYPE],workingScene[activeObject][SO_COLOUR],workingScene[activeObject][SO_X],workingScene[activeObject][SO_Y],e/6,e/6,!1,mousePosition.x-e/2,mousePosition.y-e/2,5,!1,null,8,!0,!0,"bold 16px Arial",e,e,0,0,3,!1,0])}else currentScene===SCENE_GAME&&(workingScene[0][SO_TARGET_X]=mousePosition.x,workingScene[0][SO_TARGET_Y]=mousePosition.y)}function checkInput(){if(currentScene===SCENE_GAME){var e=findSceneObject("Fire_ACTIVE"),n=findSceneObject("Water_ACTIVE"),t=findSceneObject("Air_ACTIVE"),i=findSceneObject("Earth_ACTIVE"),o=findSceneObject("Fire"),c=findSceneObject("Water"),r=findSceneObject("Air"),S=findSceneObject("Earth");e&&n&&t&&i&&(e[SO_SHOWGRAPHIC]=!1,n[SO_SHOWGRAPHIC]=!1,t[SO_SHOWGRAPHIC]=!1,i[SO_SHOWGRAPHIC]=!1,o[SO_COLOUR]="A0A0A0",c[SO_COLOUR]="A0A0A0",r[SO_COLOUR]="A0A0A0",S[SO_COLOUR]="A0A0A0",selectedSkill===SKILL_FIRE?(e[SO_SHOWGRAPHIC]=!0,o[SO_COLOUR]=e[SO_COLOUR]):selectedSkill===SKILL_WATER?(n[SO_SHOWGRAPHIC]=!0,c[SO_COLOUR]=n[SO_COLOUR]):selectedSkill===SKILL_AIR?(t[SO_SHOWGRAPHIC]=!0,r[SO_COLOUR]=t[SO_COLOUR]):selectedSkill===SKILL_EARTH&&(i[SO_SHOWGRAPHIC]=!0,S[SO_COLOUR]=i[SO_COLOUR]))}}function findSceneObject(e){for(var n=null,t=0;workingScene.length>t;t++)e===workingScene[t][SO_NAME]&&(n=workingScene[t]);return n}function findSceneObjects(e){for(var n=[],t=0;workingScene.length>t;t++)e===workingScene[t][SO_NAME]&&n.push(workingScene[t]);return n}function checkHover(){for(var e=0;workingScene.length>e;e++)workingScene[e][SO_CLICKABLE]&&(workingScene[e][SO_HOVER]=pointInRectangle([mousePosition.x,mousePosition.y],getObjectRectangle(workingScene[e]))?!0:!1)}function checkLifetimes(e){for(var n=[],t=0;workingScene.length>t;t++)0!==workingScene[t][SO_LIFETIME]&&(workingScene[t][SO_LIFETIME]-=e,0>workingScene[t][SO_LIFETIME]&&n.push(workingScene[t]));for(var t=0;n.length>t;t++)removeSceneObject(n[t][SO_ID])}function update(e){checkInput(),checkHover(),checkLifetimes(e),moveObjects(e),sizeObjects(e),pruneProjectiles(),playerScore>50?ENEMY_TIMER_MAX=.15:playerScore>35?ENEMY_TIMER_MAX=.2:playerScore>25?ENEMY_TIMER_MAX=.5:playerScore>15?ENEMY_TIMER_MAX=.75:playerScore>10?ENEMY_TIMER_MAX=1:playerScore>5&&(ENEMY_TIMER_MAX=1.5),currentScene===SCENE_GAME?(enemyGeneration(e),enemyMovement(),checkCollisions(e)):currentScene===SCENE_SCORE&&(workingScene[2][SO_NAME]="Score: "+playerScore)}function pruneProjectiles(){for(var e=0;workingScene.length>e;e++)if(-1!==workingScene[e][SO_NAME].indexOf("PROJECTILE")){var n=workingScene[e][SO_X],t=workingScene[e][SO_Y],i=workingScene[e][SO_TARGET_X],o=workingScene[e][SO_TARGET_Y],c=Math.sqrt(Math.pow(n-i,2)+Math.pow(t-o,2));1>c&&removeSceneObject(workingScene[e][SO_ID])}}function getCollidables(){for(var e=[],n=0;workingScene.length>n;n++)workingScene[n][SO_COLLIDEABLE]&&e.push(workingScene[n]);return e}function getBoundingBox(e){var n=[];return n="Player"===e[SO_NAME]?[[e[SO_X]-e[SO_WIDTH],e[SO_Y]-e[SO_HEIGHT]],[e[SO_X]+e[SO_WIDTH],e[SO_Y]-e[SO_HEIGHT]],[e[SO_X]-e[SO_WIDTH],e[SO_Y]+e[SO_HEIGHT]],[e[SO_X]+e[SO_WIDTH],e[SO_Y]+e[SO_HEIGHT]]]:[[e[SO_X],e[SO_Y]],[e[SO_X]+e[SO_WIDTH],e[SO_Y]],[e[SO_X],e[SO_Y]+e[SO_HEIGHT]],[e[SO_X]+e[SO_WIDTH],e[SO_Y]+e[SO_HEIGHT]]]}function checkCollidingObjects(e,n,t){for(var i=!1,o=0;e.length>o;o++)t?e[o][SO_NAME]===n&&(i=e[o]):-1!==e[o][SO_NAME].indexOf(n)&&(i=e[o]);return i}function getCollidingObject(e,n){for(var t,i=0;e>i;i++)e[i][SO_NAME]===n&&(t=e[i]);return t}function getPlayerCurrentType(){var e="";return selectedSkill===SKILL_FIRE?e="FIRE":selectedSkill===SKILL_WATER?e="WATER":selectedSkill===SKILL_AIR?e="AIR":selectedSkill===SKILL_EARTH&&(e="EARTH"),e}function checkCollisions(e){var n=getCollidables();playerTakingDamage=HEALTH_EFFECT_NONE;for(var t=[],i=0;n.length>i;i++)for(var o=0;n.length>o;o++)if(i!==o){n[i][SO_TAKING_DAMAGE]=HEALTH_EFFECT_NONE,n[o][SO_TAKING_DAMAGE]=HEALTH_EFFECT_NONE;for(var c=getBoundingBox(n[i]),r=getObjectRectangle(n[o]),S=0;c.length>S;S++)if(pointInRectangle(c[S],r)){var l=[n[i],n[o]];if(checkCollidingObjects(l,"Player",!0)&&checkCollidingObjects(l,"ENEMY",!1)){var E=checkCollidingObjects(l,"ENEMY",!1),a=E[SO_NAME].split("_")[0],_=getPlayerCurrentType();a===_?addPlayerHealth(e):removePlayerHealth(e)}if(checkCollidingObjects(l,"PROJECTILE",!1)&&checkCollidingObjects(l,"ENEMY",!1)){var O=checkCollidingObjects(l,"PROJECTILE",!1),E=checkCollidingObjects(l,"ENEMY",!1),d=projectileHitEnemy(O,E,e);d&&-1===t.indexOf(d)&&t.push(d)}}}for(var i=0;t.length>i;i++){var E=workingScene[t[i]];void 0!==E&&removeSceneObject(E[SO_ID]),addToPlayerScore(E)}}function addToPlayerScore(e){var n=[0,"+1",drawFire,"FFF37A",e[SO_X],e[SO_Y],0,0,!1,e[SO_X],e[SO_Y]-100,1,!1,null,5,!0,!1,"bold 16px Arial",25,25,100,100,10,!0,0];addToWorkingScene(n),playerScore++}function projectileHitEnemy(e,n,t){var i=e[SO_NAME].split("_")[0],o=n[SO_NAME].split("_")[0];return n[SO_HEALTH]>0?("FIRE"===o?"WATER"===i&&(n[SO_HEALTH]-=100*t,n[SO_TAKING_DAMAGE]=HEALTH_EFFECT_DAMAGE):"WATER"===o?"FIRE"===i&&(n[SO_HEALTH]-=100*t,n[SO_TAKING_DAMAGE]=HEALTH_EFFECT_DAMAGE):"AIR"===o?"EARTH"===i&&(n[SO_HEALTH]-=100*t,n[SO_TAKING_DAMAGE]=HEALTH_EFFECT_DAMAGE):"EARTH"===o&&"AIR"===i&&(n[SO_HEALTH]-=100*t,n[SO_TAKING_DAMAGE]=HEALTH_EFFECT_DAMAGE),i===o&&(100>n[SO_HEALTH]&&(n[SO_HEALTH]+=n[SO_HEALTH_MAX]*t),n[SO_TAKING_DAMAGE]=HEALTH_EFFECT_HEAL),!1):n[SO_ID]}function removeSceneObject(e){void 0!==workingScene[e]&&(-1!==workingScene[e][SO_NAME].indexOf("ENEMY")?0>=workingScene[e][SO_HEALTH]&&(workingScene.splice(e,1),updateSceneIDs()):(workingScene.splice(e,1),updateSceneIDs()))}function removePlayerHealth(e){var n=workingScene[0];n[SO_HEALTH]>0?n[SO_HEALTH]-=100*e:changeScene(SCENE_SCORE),playerTakingDamage=HEALTH_EFFECT_DAMAGE}function addPlayerHealth(e){var n=workingScene[0];n[SO_HEALTH_MAX]>n[SO_HEALTH]&&(n[SO_HEALTH]+=100*e),playerTakingDamage=HEALTH_EFFECT_HEAL}function enemyGeneration(e){newEnemyTimer-=e;var n=findSceneObjects("FIRE_ENEMY").concat(findSceneObjects("WATER_ENEMY").concat(findSceneObjects("AIR_ENEMY").concat(findSceneObjects("EARTH_ENEMY"))));0>newEnemyTimer&&n.length!==MAX_ENEMY_COUNT&&(createNewEnemy(),newEnemyTimer=ENEMY_TIMER_MAX)}function createNewEnemy(){var e=25,n=Math.floor(Math.random()*width),t=Math.floor(Math.random()*height),i=Math.random(),o=Math.floor(4*Math.random());1===o?addToWorkingScene([0,"FIRE_ENEMY",drawFire,"FF1000",n,t,0,0,!1,n,t,0,!1,null,i,!1,!0,"bold 16px Arial",e,e,100,100,5,!0,0]):2===o?addToWorkingScene([0,"WATER_ENEMY",drawWater,"007BFF",n,t,0,0,!1,n,t,0,!1,null,i,!1,!0,"bold 16px Arial",e,e,100,100,5,!0,0]):3===o?addToWorkingScene([0,"AIR_ENEMY",drawAir,"FFFF07",n,t,0,0,!1,n,t,0,!1,null,i,!1,!0,"bold 16px Arial",e,e,100,100,5,!0,0]):4===o&&addToWorkingScene([0,"EARTH_ENEMY",drawEarth,"0CFF00",n,t,0,0,!1,n,t,0,!1,null,i,!1,!0,"bold 16px Arial",e,e,100,100,5,!0,0])}function enemyMovement(){var e=findSceneObject("Player"),n=findSceneObjects("FIRE_ENEMY").concat(findSceneObjects("WATER_ENEMY").concat(findSceneObjects("AIR_ENEMY").concat(findSceneObjects("EARTH_ENEMY"))));if(0!==n.length)for(var t=0;n.length>t;t++)n[t][SO_TARGET_X]=e[SO_X],n[t][SO_TARGET_Y]=e[SO_Y]}function getObjectRectangle(e){var n=[];return n="Player"===e[SO_NAME]?[e[SO_X]-e[SO_WIDTH],e[SO_Y]-e[SO_WIDTH],2*e[SO_WIDTH],2*e[SO_HEIGHT]]:[e[SO_X],e[SO_Y],e[SO_WIDTH],e[SO_HEIGHT]]}function moveObjects(e){for(var n=0;workingScene.length>n;n++){var t=workingScene[n],i=t[SO_X],o=t[SO_Y],c=t[SO_TARGET_X],r=t[SO_TARGET_Y],S=c-i,l=r-o;workingScene[n][SO_X]+=S*workingScene[n][SO_MOVESPEED]*e,workingScene[n][SO_Y]+=l*workingScene[n][SO_MOVESPEED]*e}}function sizeObjects(e){for(var n=0;workingScene.length>n;n++){var t=workingScene[n],i=t[SO_WIDTH],o=t[SO_HEIGHT],c=t[SO_TARGET_WIDTH],r=t[SO_TARGET_HEIGHT],S=c-i,l=r-o;1>e&&(workingScene[n][SO_WIDTH]+=S*workingScene[n][SO_SIZE_SPEED]*e,workingScene[n][SO_HEIGHT]+=l*workingScene[n][SO_SIZE_SPEED]*e)}}function doMove(){moveX=9,moveY=4,workingScene[0][SO_X]+=moveX,workingScene[0][SO_Y]+=moveY,workingScene[0][SO_X]+workingScene[0][SO_WIDTH]>width&&(workingScene[0][SO_X]-=moveX),workingScene[0][SO_Y]+workingScene[0][SO_HEIGHT]>height&&(workingScene[0][SO_Y]-=moveY)}function render(){clearRect("#000",0,0,width,height,!1);for(var e=0;workingScene.length>e;e++){var n=workingScene[e][SO_TYPE];workingScene[e][SO_SHOWGRAPHIC]&&n("#"+workingScene[e][SO_COLOUR],workingScene[e][SO_X],workingScene[e][SO_Y],workingScene[e][SO_WIDTH],workingScene[e][SO_HEIGHT],!1,workingScene[e][SO_HEALTH],workingScene[e][SO_HEALTH_MAX],workingScene[e][SO_TAKING_DAMAGE]);var t=workingScene[e][SO_HOVER]?"red":"green";null!=activeObject&&activeObject===e&&(t="purple"),"green"!==t&&drawRect(t,workingScene[e][SO_X]-10,workingScene[e][SO_Y]-10,workingScene[e][SO_WIDTH]+20,workingScene[e][SO_HEIGHT]+45,!0);var i=0!==workingScene[e][SO_LIFETIME]?workingScene[e][SO_NAME]:workingScene[e][SO_NAME];if(workingScene[e][SO_SHOWNAME]&&(workingScene[e][SO_TYPE]===drawRect?drawText(i,workingScene[e][SO_COLOUR],workingScene[e][SO_X]+workingScene[e][SO_WIDTH]/2,workingScene[e][SO_Y]+workingScene[e][SO_HEIGHT]-20,workingScene[e][SO_TEXTSTYLE]):drawText(i,workingScene[e][SO_COLOUR],workingScene[e][SO_X]+workingScene[e][SO_WIDTH]/2,workingScene[e][SO_Y]+workingScene[e][SO_HEIGHT]+25,workingScene[e][SO_TEXTSTYLE])),boundingBoxes){for(var o=getBoundingBox(workingScene[e]),c=0;o.length>c;c++)drawRect("#ffe",o[c][0]-6,o[c][1]-6,12,12);var r=getObjectRectangle(workingScene[e]);drawRect("#14FF0C",r[0],r[1],r[2],r[3],!0)}currentScene===SCENE_GAME&&drawText("Score: "+playerScore,"FFFFFF",70,40,"bold 30px Arial")}}window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();var SO_ID=0,SO_NAME=1,SO_TYPE=2,SO_COLOUR=3,SO_X=4,SO_Y=5,SO_WIDTH=6,SO_HEIGHT=7,SO_HOVER=8,SO_TARGET_X=9,SO_TARGET_Y=10,SO_LIFETIME=11,SO_CLICKABLE=12,SO_CLICK_EVENT=13,SO_MOVESPEED=14,SO_SHOWNAME=15,SO_SHOWGRAPHIC=16,SO_TEXTSTYLE=17,SO_TARGET_WIDTH=18,SO_TARGET_HEIGHT=19,SO_HEALTH=20,SO_HEALTH_MAX=21,SO_SIZE_SPEED=22,SO_COLLIDEABLE=23,SO_TAKING_DAMAGE=24,SCENE_MENU=0,SCENE_GAME=1,SCENE_SCORE=2,SKILL_NONE=0,SKILL_FIRE=1,SKILL_WATER=2,SKILL_EARTH=3,SKILL_AIR=4,HEALTH_EFFECT_NONE=0,HEALTH_EFFECT_DAMAGE=1,HEALTH_EFFECT_HEAL=2,playerTakingDamage=HEALTH_EFFECT_NONE;main();