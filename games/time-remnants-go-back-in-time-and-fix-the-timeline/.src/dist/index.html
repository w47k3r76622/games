<div id="help"> To move use WSAD - to go back in time use U. <br> Pressing U to go back in time, become creative and survive longer using time remnants misleading the enemies.
</div><div id="tickCounter"></div><canvas id="app"></canvas><script>function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function t(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(i,!0).forEach(function(e){r(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(i).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(e){return a(e)||y(e)||i()}function i(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function a(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function c(e){return l(e)||y(e)||o()}function o(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function y(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function l(e){if(Array.isArray(e))return e}var s=document.getElementById("app"),u=document.getElementById("tickCounter");s.style.zoom="10",s.style.imageRendering="pixelated";var f=50,p=1;s.width=f,s.height=f;var d=s.getContext("2d");d.fillRect(0,0,f,f);var v={tick:0,players:[[{x:0,y:0}]],enemies:[]},x=f-p,k=0,m=[{x:k,y:k},{x:k,y:x},{x:x,y:k},{x:x,y:x}],b=5,h=0,g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return function(){return e=(e+1)%m.length,m[e]}}(),O=function(){u.textContent="You survived "+v.tick+" ticks so far.",d.fillStyle="black",d.fillRect(0,0,f,f),c(v.players).slice(1).forEach(function(e){if(void 0!==e[v.tick]){var t=e[v.tick],r=t.x,n=t.y;d.fillStyle="gray",d.fillRect(r,n,p,p)}}),v.enemies.forEach(function(e){if(void 0!==e[v.tick]){var t=e[v.tick],r=t.x,n=t.y;d.fillStyle="red",d.fillRect(r,n,p,p)}}),d.fillStyle="green";var e=v.players[0];if(void 0!==e[v.tick]){var t=e[v.tick],r=t.x,n=t.y;d.fillRect(r,n,p,p)}};document.body.addEventListener("keyup",function(e){if("KeyU"===e.code&&v.tick>0)return v.tick=v.tick-1,void O();v.tick<v.players[0].length-1&&(v.players=[v.players[0].slice(0,v.tick+1)].concat(n(v.players)));var i=v.tick+1;if(void 0!==v.players[0][v.tick]){var a={x:0,y:0};switch(e.code){case"KeyD":a.x=1;break;case"KeyS":a.y=1;break;case"KeyA":a.x=-1;break;case"KeyW":a.y=-1}var c=v.players[0][v.tick],o=c.x,y=c.y;v.players[0][i]={x:Math.min(Math.max(k,o+a.x),x),y:Math.min(Math.max(k,y+a.y),x)},v.enemies.forEach(function(e){if(e[v.tick]){var n=e[v.tick],a=v.players.map(function(e){return e[i]}).filter(Boolean).map(function(e){return t({},e,{distance:Math.abs(n.x-e.x)+Math.abs(n.y-e.y)})});if(0!==a.length){var c=a.reduce(function(e,t){return e.distance<t.distance?t:e}),o=n.x-c.x,y=n.y-c.y,l=Math.abs(o)===Math.abs(y)?r({x:0,y:0},["x","y"][Math.floor(2*Math.random())],-Math.sign(o)):Math.abs(o)<Math.abs(y)?{x:0,y:-Math.sign(y)}:{x:-Math.sign(o),y:0},s={x:n.x+l.x,y:n.y+l.y};v.enemies.some(function(e){return!(!e[i]||e[i].x!==s.x||e[i].y!==s.y)||!(!e[v.tick]||e[v.tick].x!==s.x||e[v.tick].y!==s.y)})?e[i]=n:e[i]=s}}}),h<v.tick&&v.tick%b==0&&(v.enemies=[[].concat(n(new Array(v.tick+1)),[g()])].concat(n(v.enemies)));var l=v.players[0][i];v.enemies.some(function(e){var t=e[i];return void 0!==t&&(l.x===t.x&&l.y===t.y)})&&(v.players[0][i]=void 0,setTimeout(function(){return alert("Game Over - you survived "+i+' ticks - try pressing "u" to go back in time and fix it')},0)),v.tick=i,O()}}),O();</script>