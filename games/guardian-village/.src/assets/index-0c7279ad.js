var H=Object.defineProperty;var Q=(i,e,t)=>e in i?H(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var g=(i,e,t)=>(Q(i,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(n){if(n.ep)return;n.ep=!0;const a=t(n);fetch(n.href,a)}})();class S{constructor(e){const t=document.createElement("div");t.innerHTML=e,this.html=t.firstChild}}const d=[15,20],c=d[0]*d[1],Y=[0],K=[5,6,7,8,9],h=[{},{name:"soil",introduction:"a natural medium for plant growth",c:3},{name:"river",introduction:"a natural flowing watercourse"},{name:"tree",introduction:"a tall plant with a trunk and branches",hardness:2,result:()=>({0:1})},{name:"stone",hardness:5,introduction:"a hard, solid mineral material",result:()=>({2:6})},{name:"Workers' Home",hardness:4,introduction:"Can accommodate 4 workers",material:{1:2,0:3,2:5},result:()=>({1:1,2:3}),c:4},{name:"Villagers' Home",hardness:4,introduction:"Can accommodate 6 Villagers",material:{1:2,0:2},result:()=>({1:1,2:2}),c:6},{name:"Barracks",hardness:4,introduction:"Train Soldiers (Capacity of 10 Soldiers)",material:{1:3,2:5,0:3},result:()=>({1:2,2:2,0:2}),c:10},{name:"Hospital",hardness:4,introduction:"Treating the injured",material:{1:5,2:10,0:6},result:()=>({1:2,2:2,0:3})},{name:"Bartizan",hardness:5,introduction:"Archers shooting from above",material:{1:5,0:3},result:()=>({1:2}),c:1},{name:"Wall",hardness:5,introduction:"a Hard wall",material:{2:1},result:()=>({2:1})},{name:"Stable",hardness:2,introduction:"Farmers can raise horses inside",material:{2:1},result:()=>({1:5})}],D=[5,6,7,8,9,10,11],B=["wood","leaf","stone","seed"],V=()=>{const i=t=>{let s=t%d[1];return s>d[0]/2&&s<d[0]/2+2&&Math.floor(t/d[1])!=5?2:1},e=t=>l.mapData[t-c]==2?-1:Math.random()<.05?3:Math.random()<.1?4:-1;l.mapData=new Array(c*2).fill(-1),l.mapData=new Proxy(l.mapData,Z);for(const t in l.mapData)l.mapData[t]=t>=c?e(t):i(t)},Z={set(i,e,t){let s=e%c;return l.mapObject[s].setImage(t,Math.floor(e/c)),Reflect.set(i,e,t)}},l={mapObject:[],mapData:[],select:null,disableSelect:!1};let m=new Proxy(new Array(B.length).fill(0),{set(i,e,t){let s=Reflect.set(i,e,t);return U(),s}}),C={},A=[];const J=()=>{C=document.getElementById("bag"),m[0]=100,m[1]=100,m[2]=100,m[3]=100},U=()=>{let i="";for(const e in m)!A.includes(e)&&m[e]>0&&A.push(e),A.includes(e)&&(i+=B[e]+"*"+m[e]+`
`);C.innerText=i},N=i=>{for(const e in i)m[e]+=i[e]},R=i=>{for(const e in i)m[e]-=i[e]},w="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHIAAAAICAYAAAAlZKvaAAAAAXNSR0IArs4c6QAABQlJREFUSEull39M21UQwO+7idj9Kj+UUkBpO8rGNkAzJCbgZkiAaKCLSzbDjKkR40yQhMSYJZpI2B9Lli2ROElcspg1EkEWSRhkBiRGtnURx8ZAN5WO0szSdWgpDTJAGM/cwb18W750nd4/7/t99969633u7n2rBDKyBKxIsve2go/quaRvJlitOZo/uQrrZ8fggc4sR/VCT+s2somSHHiZzgokfyvnohpfUdbX14uRkRHIzs6mGX5uaGiQdmwF2cKSkkB698QUnB8YeaQzcN/x9Uby78iDuzHvraurk/Hj3+J2u+XPCrlugOfPkObPND2lh75f70Q9y9V6Msx+lvkodF5aBPeSkWz2DxbSqCA0Bhh5GupCp6bAnPYPqcZ8j696jgSJ69RQGeQzvoNhDt1Ja4spWBgovV4vAeIDAw2FQtDY2KggRK1IxQKzpqZGeDweMJlMUHW6m8y0HC4HnmtqaiI/T3/wljh84gvpM7+jfzk5OTA0NLTKBa/XCzGCFIeKdsJXzpurYhIJ8vtrt+ickt07aMT3H7yzDwcZrSIRbOnZZgLHElmdCNJ4uVzEWZZhsCy4Q3C3uJscx4rjeXWV4ZzNZiOdxWIJ289Z7791jeZTEzaCf2pm1fNPt8cVDLbL5SJYKAjJarVSEjQcKBZPtI9CkbIxzL5TzMDc/q1Qf+6yBNl3pR+2pSXB775JSDQYoam9V0H/MjIyyKZa8KyBgQHQTfthKDce4q0JMO+aovHvPi9s2psB29vvQcmuTLKHogWytmID/f7Sd1qhsrISjh7cA8GZebin30oJrdPpwO/3w0OrQvRvEVqVyE5jRaolEuS6qvdhNnmBlsQlxNO4MDVPoy4QB29c3y0hGY1GcDqd0hxDbTjwombF1Z+7pKylYyO4BkFOXP2OIKBg4FKeLyWQ3R++Jno+66H5V+8n04gQUZ49sgfKj30tY4Rn8Zk44prCwkJRUFAgKzg/Px86OjooaRjkb/sNEh5CjEvbREARJLZWtIs+rQUy3/wYVH8ags7OThj88gT5trSjhK4Yg8EAqampsYHkoKzVWlG/1j0ZK8i5uTnw+XwSKlZgb28vIEwMdli2rLxgkNU6R98vpLHv3SWX4xqHwyE8XWfgBWsazf/o8oGp4m2w2+2032M/BSZHLdw4flEC5DkGeahop1AHmt8RZHV1tYSHBrgtM8iBlURG3WJgbjmJc5+E/J/nJUhOMK748clp0p2p3UK/PaW0Oawi7R8tQp8zBIM3iyExMfH/tVY8IOtYW9idqNVaLR0V5AxXJlYiintfl4JtFaHFAhIBoDAQNcimnkFQf+zUlD1Ha2MBef7pCrD90QVcmWXvlQHPMUiuRs4Qfo+ltWJFcltVt9eCQJz82MHEQHjpSZsBRxSu1o/bLoKiKLIzCCGE+h3XPtLHjlZlMkjWaYFknePdVwio/fMLYS1dfUeq70K8B9UVGby/3KITNywnAgYZA4pgtUAieHVrlWWKGb7SWnk/VVJmCQwPD4NN/5esXNxfVVUl3jQvhbVZrOSzY+tgdHQUsLVqCVakYTGoqePJzusuioU6UbSeGV5kQrEdAskv0f5+qNuq2jO+IxlgpNf81Xry9ZdEbqaB1P7J6VUweZ/Whw+3z/8KMlprxUrgu3MiJQ/y8vLA39tM7qjvLYQ5Pj4O6enpwGNLS4titVoFtjYtCQaDsH1zVI4QC0iuyLUg4gn/AmyYWH+G3698AAAAAElFTkSuQmCC";class _ extends S{constructor(e){super('<div class="building-card"><img class="build-icon image"/><p></p></div>'),this.element={img:this.html.querySelector("img"),label:this.html.querySelector("p"),Building:this.html},this.buildingType=e,this.initElem(),this.updateImage(),this.element.Building.addEventListener("click",this.click.bind(this))}click(){y.selectedBuilding&&y.selectedBuilding.deSelect(),this.select()}updateImage(){this.element.img.style.setProperty("--start-x",this.buildingType)}initElem(){this.element.img.src=w;let e="",t=h[this.buildingType].material;for(const s in t)e+=B[s]+"*"+t[s]+",";e=e.substring(0,e.length-1),this.element.label.innerText=h[this.buildingType].name+`
`+h[this.buildingType].introduction+`
`+e}select(){y.selectedBuilding=this,this.element.Building.classList.add("selected-card")}deSelect(){this.element.Building.classList.remove("selected-card")}}function E(i){const e=i.querySelectorAll("[id]"),t={};return e.forEach(s=>t[s.id.replace(/-/g,"_")]=s),t}async function W(i,e,t,s,n){const a=i%t,r=Math.floor(i/t),o=e%t,p=Math.floor(e/t),f=[],b=new Array(t*s).fill(!1),P=[1,-1,0,0],j=[0,0,1,-1];for(f.push({x:a,y:r,path:[]}),b[i]=!0;f.length>0;){const{x:k,y:M,path:O}=f.shift();if(k===o&&M===p)return O;for(let v=0;v<4;v++){const x=k+P[v],T=M+j[v],I=T*t+x;x>=0&&x<t&&T>=0&&T<s&&!b[I]&&(n(I)||(f.push({x,y:T,path:[...O,I]}),b[I]=!0))}}return[]}const z=(i,e,t)=>new Promise((s,n)=>{let a=0,r=setInterval(async()=>{a+=1,await t(a/i),a>i&&(clearInterval(r),s())},e)}),L=(i,e,t,s)=>{let n=0,a=i,r;function o(){n+=a,n>=e?(clearInterval(r),s()):t(n/e),console.log(n)}function p(){r=setInterval(o,50)}function f(b){a+=b}return{start:p,addSpeed:f}};class X extends S{constructor(e){super('<div class="move"><img class="entity clip"/></div>'),this.element={img:this.html.querySelector("img"),entity:this.html},this.entityManager=e,this.tileX=0,this.tileY=0,this.offsetX=0,this.offsetY=0,this.moveSpeed=0,this.canSelect=!0,this.initElem(),this.moveToTile(0,0),this.setEntitysOnTile(!0),this.setOffset(),this.moveToTile(0,0),this.element.entity.addEventListener("click",()=>{this.entityManager.selectEntity(this)})}setOffset(){this.offsetX=Math.max(this.entityManager.entitysOnTile[this.getIndex()].indexOf(this),0)*10,this.moveTo(this.x,this.y)}initElem(){this.element.img.src=w}getIndex(){return this.tileX+this.tileY*d[1]}select(){this.element.entity.classList.add("selected-entity")}deSelect(){this.element.entity.classList.remove("selected-entity")}setEntitysOnTile(e){let t=this.entityManager.entitysOnTile[this.getIndex()];e?t.push(this):t.splice(t.indexOf(this),1)}async findPathAndMove(e){this.setEntitysOnTile(!1);const t=a=>a!=e&&l.mapData[a+c]!=-1||l.mapData[a]!=1,s=async(a,r)=>{if(a.length>0){for(const o of a){let p=o%d[1],f=Math.floor(o/d[1]);await this.moveToTileTwen(p,f)}this.setEntitysOnTile(!0),this.setOffset(),r()}};return{path:await W(this.getIndex(),e,d[1],d[0],t),move:s.bind(this)}}async moveToTileTwen(e,t){if(this.tileX==e&&this.tileY==t)return;this.tileX=e,this.tileY=t,this.startx=this.x,this.starty=this.y;const s=async n=>{this.moveTo(this.startx+(e*40-this.startx)*n,this.starty+(t*40-this.starty)*n)};await z(60,this.moveSpeed,s.bind(this)),this.moveToTile(e,t)}moveToTile(e,t){this.element.entity.style.display=K.includes(l.mapData[this.getIndex()+c])?"none":"block",this.tileX=e,this.tileY=t,this.moveTo(e*40,t*40)}moveTo(e,t){e=Math.floor(e),t=Math.floor(t),this.x=e,this.y=t,this.element.entity.style.setProperty("--x",e+this.offsetX+"px"),this.element.entity.style.setProperty("--y",t+this.offsetY+"px")}setClip(e){let t=["--start-x","--start-y","--width","--height"];for(let s in t)this.element.img.style.setProperty(t[s],e[s]+"px")}}class q extends X{constructor(e){super(e),this.setClip([104,0,2,5]),this.name="villager"}changeJob(e){this.setClip([104+e*2,0,2,5])}}class G extends S{constructor(e,t){super('<div class="person-card"><button id="x">x</button><button id="job">job</button><p id="lable"></p><div class="jobs" id="job-bar" style="display:none"><button id="d">doctor 100ðŸ’°</button><button id="s">soldier 25ðŸ’°</button><button id="f">worker 10ðŸ’°</button></div></div>'),this.element=E(this.html),console.log(this.element),this.element.x.addEventListener("click",this.click.bind(this)),this.element.job.addEventListener("click",this.jobClick.bind(this)),this.entity=e,this.entityManager=t,this.initElem()}click(){y.selectedBuilding&&y.selectedBuilding.deSelect(),this.select()}jobClick(){this.element.job_bar.style.display=this.element.job_bar.style.display=="none"?"block":"none"}initElem(){let e=this.entityManager.selectedEntity.includes(this.entity),t=e?"[selected]":"";this.element.x.innerText=e?"deselect":"select",this.element.lable.innerText=this.entity.name+t}select(){this.entityManager.selectEntity(this.entity)}}class F{constructor(){this.entityPool=[],this.selectedEntity=[],this.entitysOnTile=Array.from({length:c},()=>[]),this.baseElem=document.getElementById("entity-bar"),this.elem=E(this.baseElem)}setList(e,t){e.innerHTML="";for(const s of t){let n=new G(s,this);e.appendChild(n.html)}}updateSelected(){this.setList(this.elem.select_entity_list,this.selectedEntity),y.selectedTile&&this.updateTileEntity(y.selectedTile.index)}updateTileEntity(e){this.setList(this.elem.tile_entity_list,this.entitysOnTile[e])}setOffset(){for(const e of this.selectedEntity)e.setOffset()}addEntity(){let e=new q(this);this.entityPool.push(e),ne.appendEntityChild(e)}cleanSelect(){this.selectEntity.forEach(e=>{e.deSelect()}),this.selectedEntity=[],this.updateSelected()}selectEntity(e){return this.selectedEntity.includes(e)?(e.deSelect(),this.selectedEntity.splice(this.selectedEntity.indexOf(e),1),this.updateSelected(),!1):(e.select(),this.selectedEntity.push(e),this.updateSelected(),!0)}}let u=new F;class ${constructor(){g(this,"initBuilding",()=>{for(let e of D){let t=new _(e);this.elem.building_list.appendChild(t.html)}});g(this,"setInfo",e=>{this.elem.info_name.innerText=h[e].info_name,this.elem.info_intro.innerText=h[e].introduction});g(this,"selectTile",e=>{if(!e){this.elem.btn_remove.disabled=!0,this.elem.btn_build.disabled=!0,this.elem.btn_move.disabled=!0,this.elem.info_name.innerText="...",this.elem.info_intro.innerText="...";return}this.selectedTile=e;let t=e.getIndex(),s=Y.includes(t);this.setInfo(t),this.elem.btn_remove.disabled=s||e.imageIndexs[1]==-1,this.elem.btn_build.disabled=s&&e.imageIndexs[1]==-1,this.elem.btn_move.disabled=s&&e.imageIndexs[1]==-1,u.updateTileEntity(e.index)});g(this,"moveClick",async()=>{this.elem.obtg.style.display="none",await this.move(l.select.index),this.elem.obtg.style.display="block"});g(this,"removeClick",async()=>{let e=l.select.getIndex();this.selectedTile.remove(!0,()=>{N(h[e].result()),u.entitysOnTile[this.selectedTile.index].forEach(t=>{t.moveToTile(t.tileX,t.tileY)})}),await this.move(l.select.index,()=>{this.selectedTile.addSpeed()})});g(this,"buildClick",async()=>{let e=h[this.selectedBuilding.buildingType].material;for(const t in e)if(m[t]<e[t]){alert("Insufficient materials"),this.tileDeSelect();return}this.selectedTile.build(this.selectedBuilding.buildingType,()=>{R(e),u.selectedEntity.forEach(t=>{t.moveToTile(t.tileX,t.tileY)})}),await this.move(l.select.index,()=>{this.selectedTile.addSpeed()})});g(this,"tileDeSelect",()=>{l.select&&l.select.deSelect()});this.elem={},this.selectedTile=null,this.selectedBuilding=null,this.coin=100,this.day=0,this.elem=E(document.getElementById("info-bar")),this.botbarelem=E(document.getElementById("bot-bar")),this.elem.btn_remove.disabled=!0,this.elem.btn_build.disabled=!0,this.elem.btn_move.disabled=!0,this.elem.btn_remove.addEventListener("click",this.removeClick),this.elem.btn_build.addEventListener("click",this.buildClick),this.elem.btn_move.addEventListener("click",this.moveClick),this.botbarelem.next_day.addEventListener("click",this.nextDay.bind(this)),this.updateBotBar(),this.initBuilding()}nextDay(){l.mapData.forEach(e=>{D.includes(e)&&(this.coin+=10)}),this.day+=1,this.updateBotBar()}updateBotBar(){this.botbarelem.text.innerText=`Day ${this.day} | coinðŸ’°:${this.coin}`}async move(e,t=()=>{}){let s=u.entitysOnTile[e].length,n=h[l.mapData[e]].c;l.mapData[e+c]!=-1&&(n=h[l.mapData[e+c]].c);let a=[...u.selectedEntity.filter(o=>o.getIndex()!==e)];if(s+a.length>n){alert(`This tile can only accommodate ${n} person`);return}a=u.selectedEntity;let r=[];for(const o of a)if(o.getIndex()!==e){let p=await o.findPathAndMove(e);if(r.push(p),p.path.length==0)return alert("Unable to reach the destination"),!1}else r.push(null);for(const o of r)o==null?t():o.move(o.path,t);return!0}}let ee=new $;const y=ee;class te extends S{constructor(){super('<div class="tile"><img class="tile-image image"/><img class="tile-image image"/></div>'),this.element={img:this.html.querySelectorAll("img"),tile:this.html},this.imageIndexs=[-1,-1],this.initImage(),this.updateImage(),this.element.tile.addEventListener("click",this.click.bind(this))}updateImage(){for(const e in this.imageIndexs)this.element.img[e].style.setProperty("--show",this.imageIndexs[e]==-1?"none":"block"),this.element.img[e].style.setProperty("--start-x",this.imageIndexs[e])}initImage(){for(let e=0;e<2;e++)this.element.img[e].src=w}setImage(e,t){this.imageIndexs[t]=e,this.updateImage()}click(){l.disableSelect||(l.select&&l.select.deSelect(),this.select())}select(){l.select=this,y.selectTile(l.select),this.element.tile.classList.add("selected-tile")}deSelect(){this.element.tile.classList.remove("selected-tile")}getIndex(){return this.imageIndexs[this.imageIndexs[1]==-1?0:1]}removeData(){this.element.tile.style.setProperty("--r",0),l.mapData[this.index+c]=-1}changeing(e){this.element.tile.style.setProperty("--r",e)}async remove(e,t){this.speed=0,l.disableSelect=!0;const s=()=>{this.removeData(),t(),l.disableSelect=!1};this.timer=L(0,h[this.getIndex()].hardness,this.changeing.bind(this),s),this.timer.start()}async addSpeed(e=.1){this.timer.addSpeed(e)}buildData(e){this.element.tile.style.setProperty("--r",0),y.selectTile(null),l.mapData[this.index+c]=e}async build(e,t){this.speed=0,l.disableSelect=!0;const s=()=>{this.buildData(e),t(),l.disableSelect=!1};this.timer=L(0,5,this.changeing.bind(this),s),this.timer.start()}}class ie{constructor(){document.documentElement.style.setProperty("--map-heigh",d[0]),document.documentElement.style.setProperty("--map-width",d[1]),this.baseElem=document.getElementById("map"),this.elem=E(this.baseElem);for(let e=0;e<c;e++){let t=new te;l.mapObject.push(t),t.index=e,this.baseElem.appendChild(t.html)}}appendEntityChild(e){this.baseElem.appendChild(e.html)}}let se=new ie;const ne=se;J();V();u.addEntity();u.addEntity();u.addEntity();
