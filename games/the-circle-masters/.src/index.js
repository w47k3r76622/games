const t={width:640,height:360,t:document.querySelector("canvas"),s:document.querySelector("canvas").getContext("2d"),e:io({upgrade:!1,autoConnect:!1,transports:["websocket"]})};t.t.width=t.width,t.t.height=t.height;const s={clear:()=>{t.s.beginPath(),t.s.clearRect(0,0,t.width,t.height)},i:(s,e,i,h)=>{t.s.beginPath(),t.s.fillStyle=h,t.s.arc(s,e,i,0,2*Math.PI),t.s.fill()},h:(s,e,i,h,n)=>{t.s.fillStyle=n,t.s.fillRect(s,e,i,h)},n:(s,e,i,h,n)=>{t.s.strokeStyle=n,t.s.beginPath(),t.s.moveTo(s,e),t.s.lineTo(i,h),t.s.stroke()},c:(s,e,i,h,n,c)=>{t.s.font=h,t.s.textAlign=n,t.s.fillStyle=i,t.s.fillText(c,s,e)}},e={r:()=>t.e.open(),emit:(s,...e)=>t.e.emit(s,...e),on:(s,e)=>t.e.on(s,e),off:(...s)=>t.e.off(...s),a:()=>t.e.close()};class i{static o(t){i.u(),i.d=(()=>t.d()),i.update=(()=>t.update()),i.fixedUpdate=(()=>t.fixedUpdate()),i.u=(()=>t.u()),i.d()}static d(){}static update(){}static fixedUpdate(){}static u(){}}i.p=localStorage,i.l=[{name:"Speedy",f:"#ffa",w:1.1,x:60},{name:"Norman",f:"#aff",w:1,x:100},{name:"Faf",f:"#faf",w:1.05,x:90},{name:"Tanky",f:"#aaa",w:.8,x:200}];class h{static input(t,s){s?this.m(t):this.I(t)}}h.m=(t=>{}),h.I=(t=>{});class n{constructor(t=0,s=0){this.y=t,this.g=s}static add(t,s){return new n(t.y+s.y,t.g+s.g)}static sub(t,s){return new n(t.y-s.y,t.g-s.g)}static M(t,s){return new n(t*s.y,t*s.g)}static S(t,s){return new n(t.y/s,t.g/s)}static U(t){return new n(-t.y,-t.g)}static k(t,s){return t.y*s.y+t.g*s.g}static F(t){return 0!=t.y&&0!=t.g}static b(t,s){return n.k(t,s)/(t.v()*s.v())}v(){return Math.hypot(this.y,this.g)}O(t){return n.sub(this,t).v()}T(){return n.S(this,this.v())}A(t){return n.sub(n.M(2*n.k(this,t),t),this)}C(){return new n(this.y,this.g)}N(t){let s=n.k(this,t)/t.v();return new n(s,Math.sqrt(this.v()*this.v()-s*s))}}class c{static input(t,s,e){let i=new n(t,s);1==e?this.B=i:-1==e?(this.L?this.D(n.sub(this.B,i)):this.P(i),this.L=!1,this.B=new n(-1,-1)):-1!=this.B.y&&n.sub(this.B,i).v()>2&&(this.D(n.sub(this.B,i)),this.B=i,this.L=!0),c.Y(i)}}c.B=new n(-1,-1),c.L=!1,c.D=(t=>{}),c.P=(t=>{}),c.Y=(t=>{});class r{d(){}update(){}fixedUpdate(){}u(){}j(t,s,e){}q(t,s){}}class a{constructor(t=0,s=0){this.H=new n(t,s),this.J=1}draw(t){s.clear();for(const s of t)s.draw&&s.draw(this.H,this.J)}}class o{constructor(){this.K=null}}class u extends o{constructor(t=0,s=0,e=1,i=!1){super(),this.H=new n(t,s),this.W=new n(0,0),this.Z=new n(0,0),this.z=e,this.G=i,this.Q=this.H.C()}}class d extends o{constructor(t=null,s=.2){super(),this.R=t,this.Z=s}V(t,s=.2){return this.R=t,this.Z=s,this}X(){return this.R}fixedUpdate(){if(!this.K||!this.K.$||!this.R)return;const t=n.sub(this.K.$.H,this.R);this.K.$.Z=n.M(this.Z,n.U(t.T())),t.v()<1&&(this.R=null,this.K.$.Z=new n)}}const p=400;class l extends o{constructor(t="red",s=100,e=!0){super(),this.f=t,this._=e,this.x=s,this.tt=s}draw(t,e){if(!this.K)return;let{H:i,st:h}=this.K.$;this._&&s.h((t.y+i.y-h)*e,(t.g+i.g-h-7)*e,2*h*this.x/this.tt*e,3*e,this.f)}fixedUpdate(){this.x>0?this._||(this.K.$.H=this.K.$.Q.C(),this.K.$.W=new n,this.K.$.Z=new n,this.K.et.get(d.name).V(null),this._=!0,this.x=this.tt):this._?(this._=!1,this.x=-p):this.x++}}class f extends u{constructor(t=0,s=0,e=1,i=1,h="#ccc",n=1){super(t,s,i),this.st=e,this.f=h,this.it=n}draw(t,e){this.K.et.get(l.name)&&!this.K.et.get(l.name)._||s.i((t.y+this.H.y)*e,(t.g+this.H.g)*e,this.st*e,this.f)}}class w extends u{constructor(t=0,s=0,e=1,i=1,h=1,c="#555"){super(t,s,h),this.ht=new n(e,i),this.f=c}draw(t,e){this.K.et.get(l.name)&&!this.K.et.get(l.name)._||s.n((t.y+this.H.y)*e,(t.g+this.H.g)*e,(t.y+this.ht.y)*e,(t.g+this.ht.g)*e,this.f)}}class x extends o{constructor(t="none"){super(),this.name=t}draw(t,e){if(!this.K)return;if(this.K.et.get(l.name)&&!this.K.et.get(l.name)._)return;let{H:i,st:h}=this.K.$;s.c((t.y+i.y)*e,(t.g+i.g+h+10)*e,"#ccc","11px Impact","center",this.name)}}const m=1,I=1.2,y=3,g=.01;class M{nt(t){for(const s of t.values())s.$.Z=n.S(s.$.Z,m),s.$.Z.v()<g&&(s.$.Z=new n),s.$.W=n.add(n.S(s.$.W,I),s.$.Z),s.$.W.v()>y&&(s.$.W=n.M(y*s.$.it,s.$.W.T())),s.$.W.v()<g&&(s.$.W=new n),s.$.H=n.add(s.$.H,s.$.W)}ct(t,s){for(let e=0;e<t.length;e++)for(let i=e+1;i<t.length;i++)this.rt(t[e].$,t[i].$,t=>s(t))}rt(t,s,e){if(t.constructor.name===f.name&&s.constructor.name===f.name){if(n.sub(t.H,s.H).v()<=t.st+s.st){e(t.K),e(s.K);const i=n.sub(t.H,s.H),h=new n(i.g,-i.y),c=h.g/h.v(),r=h.y/h.v(),a=2*c*r,o=r*r-c*c;t.W=new n(t.W.y*o+t.W.g*a,t.W.y*a-t.W.g*o),s.W=new n(s.W.y*o+s.W.g*a,s.W.y*a-s.W.g*o),t.Z=new n(t.Z.y*o+t.Z.g*a,t.Z.y*a-t.Z.g*o),s.Z=new n(s.Z.y*o+s.Z.g*a,s.Z.y*a-s.Z.g*o),t.K.et.get(d.name)&&t.K.et.get(d.name).V(null),s.K.et.get(d.name)&&s.K.et.get(d.name).V(null)}}else if(t.constructor.name===f.name&&s.constructor.name===w.name){const i=n.sub(s.H,s.ht),h=i.v(),c=n.sub(s.H,t.H).v(),r=n.sub(s.ht,t.H).v();if(t.st>Math.sqrt(c**2-((c**2-r**2+h**2)/(2*h))**2)){e(t.K),e(s.K);let c=i.g/h,r=i.y/h,a=2*c*r,o=r*r-c*c;t.W=new n(t.W.y*o+t.W.g*a,t.W.y*a-t.W.g*o),t.Z=new n(t.Z.y*o+t.Z.g*a,t.Z.y*a-t.Z.g*o)}}else t.constructor.name===w.name&&s.constructor.name===f.name?this.rt(s,t,e):t.constructor.name===w.name&&(s.constructor.name,w.name)}}class S{constructor(){this.at=S.ot++,this.ut=!0,this.et=new Map,this.$=null;const t=t=>(...s)=>{if(this.ut)for(const e of this.et.values())e[t]&&e[t](...s)};["draw","update","fixedUpdate"].map(s=>this[s]=t(s))}add(t){t.K=this,this.et.set(t.constructor.name,t)}}S.ot=0;class U extends Map{constructor(t=1,s=1){super(),this.dt=t,this.pt=s}add(t){if(Array.isArray(t))for(const s of t)this.set(s.at,s);else this.set(t.at,t);return this}}class k extends r{constructor(t,s){super(),this.lt=s-1,this.ft=t}d(){this.wt=this.lt%2?new a(-300,-285):new a(350,350),this.xt=new M,this.mt=6099,this.lt%2?(this.It=this.yt(-270,-270,1),this.gt=this.yt(870,570,0)):(this.It=this.yt(870,570,1),this.gt=this.yt(-270,-270,0)),this.Mt=(new U).add([...this.ft.map((t,s)=>this.St(t,s)),...this.Ut(),this.It,this.gt]),c.D=(t=>{this.wt.H=n.sub(this.wt.H,t)}),c.P=(t=>{if(t.y>=280&&t.y<=298&&t.g>=337&&t.g<=355)this.kt("off");else if(t.y>=342&&t.y<=360&&t.g>=337&&t.g<=355)this.kt("center");else{const s=n.sub(t,this.wt.H);e.emit("target",s.y,s.g)}}),h.m=(t=>{49===t?this.kt("off"):50===t?this.kt("1"):51===t?this.kt("2"):67===t&&this.kt("center")}),e.on("target",(t,s,e)=>{[...this.Mt.values()][t].et.get(d.name).V(new n(s,e))}),e.on("power",(t,s)=>{this.Ft(t,s)}),e.on("disconnect",()=>{i.o(new F)}),e.on("end",t=>{e.a(),this.bt(t)})}St(t,s){let e=s%2?800:-200,h=s%2?500:-200;s>1?(e-=20,h+=20):(e+=20,h-=20);const n=i.l.filter(s=>s.name===t[1]).pop(),c=new S,r=s===this.lt?"#afa":s%2==this.lt%2?"#aaf":"#faa";return s==this.lt&&(this.vt=c),c.$=new f(e,h,10,1,n.f,n.w),c.add(c.$),c.add(new l(r,n.x)),c.add(new d),c.add(new x(t[0])),c}yt(t,s,e){const i=new S;return i.$=new f(t,s,30),i.add(i.$),i.add(new l(e?"#faa":"#afa",300)),i}Ut(){const t=[];return t.push(this.Ot(-300,-300,-300,600)),t.push(this.Ot(-300,600,900,600)),t.push(this.Ot(900,600,900,-300)),t.push(this.Ot(900,-300,-300,-300)),t}Ot(t,s,e,i){const h=new S;return h.$=new w(t,s,e,i),h.add(h.$),h}kt(t){"center"===t?this.wt.H=n.add(n.U(this.vt.$.H),new n(320,180)):e.emit("power",t)}Ft(t,s){e.a()}update(){for(const t of this.Mt.values())t.update&&t.update();this.wt.draw(this.Mt.values()),this.Tt()}Tt(){s.c(320,20,"#fff","12px Impact","center",.01*this.mt|0);const t=this.vt.et.get(l.name);t._?(s.h(280,330,t.x/t.tt*80,4,"#afa"),s.h(280,337,18,18,"#dde"),s.c(289,354,"#333","12px Impact","center","OFF"),s.h(300,337,18,18,"#ded"),s.c(309,354,"#333","12px Impact","center","2"),s.h(320,337,18,18,"#edd"),s.c(329,354,"#333","12px Impact","center","3"),s.h(342,337,18,18,"#ddd"),s.c(351,354,"#333","12px Impact","center","c")):(s.h(0,0,640,360,"rgba(0,0,0,.3)"),s.c(320,330,"#eee","20px Impact","center","Your hero's OFFLINE!"))}fixedUpdate(){for(const t of this.Mt.values())t.fixedUpdate&&t.fixedUpdate();this.xt.nt(this.Mt),this.xt.ct([...this.Mt.values()].filter(t=>!t.et.has(l.name)||t.et.get(l.name).At),t=>{t.et.has(l.name)&&(t.et.get(l.name).x-=10)}),this.mt--,this.mt<0&&(e.emit("end",-1),this.bt(-1))}bt(t){i.o(new b(t,this.ft))}u(){s.clear(),this.Mt.clear(),c.D=(t=>{}),c.P=(t=>{}),e.off()}}class F extends r{d(){s.clear(),s.c(30,70,"#fff","20px Impact","left","You're OFFLINE. Click to go back to the menu!"),h.m=(t=>this.bt()),c.P=(t=>this.bt())}u(){h.m=(t=>{}),c.P=(t=>{})}bt(){i.o(new T)}}class b extends r{constructor(t,s){super(),this.Ct=t,this.ft=s}d(){h.m=(t=>this.bt()),c.P=(t=>this.bt()),s.clear(),s.c(70,170,"#fff","40px Impact","left",-1===this.Ct?"There is no winner":"The winner is: "+this.ft[this.Ct][0]),s.i(580,300,40,i.l.filter(t=>t.name===this.ft[this.Ct][1]).pop().f),s.c(70,300,"#fff","20px Impact","left","Click to return to the menu")}u(){h.m=(t=>{}),c.P=(t=>{})}bt(){i.o(new T)}}const v=2;class O extends r{constructor(t,s){super(),this.vt=[t,s]}d(){this.ft=[],s.clear(),e.r(),e.on("disconnect",()=>{i.o(new F)}),e.on("connect",()=>{e.emit("hello",...this.vt)}),e.on("prepare",(t,s)=>{this.ft.push(...JSON.parse(s),this.vt),this.lt=this.ft.length}),e.on("hello",(t,s)=>{this.ft.push([t,s])}),e.on("start",()=>{i.o(new k(this.ft,this.lt))})}update(){s.clear();this.ft.forEach((t,e)=>{const h=i.l.filter(s=>s.name===t[1]).pop();s.c(120+120*e,100+e%2*120-30-10,h.f,"14px Impact","center",t[0]),s.i(120+120*e,100+e%2*120,30,h.f),s.c(120+120*e,100+e%2*120+30+20,h.f,"14px Impact","center",h.name)});const t=2*v-this.ft.length;t>0?s.c(50,340,"#ccc","14px Impact","left","Waiting for "+t+" player"+(t>1?"s":"")):s.c(50,340,"#ccc","18px Impact","left","Prepare!")}u(){e.off()}}class T extends r{d(){this.name="AEIOU".charAt(5*Math.random())+Math.random().toString(36).slice(2,7).replace(/[\.0-9]/g,""),this.blink=0,this.Et=!1,this.Nt=!1,h.m=(t=>{13==t?i.o(new O(this.name,i.l[0].name)):8==t?this.name=this.name.slice(0,-1):16==t?this.Et=!0:t>64&&t<91?this.name+=String.fromCharCode(t+32*+!this.Et):t>47&&t<58&&(this.name+=t-48)}),h.I=(t=>{16==t&&(this.Et=!1)}),c.P=(t=>{const s=t=>this.Nt===t?33:30;i.l.forEach((e,h)=>{(t.y-(120+100*h))**2+(t.g-210)**2<=s(h)**2&&i.o(new O(this.name,e.name))})}),c.Y=(t=>{this.Nt=!1;const s=t=>this.Nt===t?33:30;i.l.forEach((e,i)=>{(t.y-(120+100*i))**2+(t.g-210)**2<=s(i)**2&&(this.Nt=i)})})}update(){s.clear(),s.c(50,60,"#ccc","20px Impact","left","Enter your name and then choose class"),s.c(90,140,"#ccc","20px Impact","left",this.name+(this.blink>30?"|":""));const t=t=>this.Nt===t?33:30;i.l.forEach((e,i)=>{s.i(120+100*i,210,t(i),e.f),s.c(120+100*i,260,e.f,"14px Impact","center",e.name)}),this.blink=(this.blink+1)%60}u(){h.m=(t=>{}),h.I=(t=>{}),c.P=(t=>{}),c.Y=(t=>{})}}const A=((t=0)=>(s=0,e=s-t)=>{for(;e>0;)i.fixedUpdate(),e-=10;t=s-e,setTimeout(()=>A(performance.now()),10)})();["mouseup","mousemove","mousedown"].forEach((s,e)=>t.t.addEventListener(s,s=>c.input(s.offsetX/t.t.offsetWidth*t.width,s.offsetY/t.t.offsetHeight*t.height,e-1),!0)),["keyup","keydown"].forEach((t,s)=>document.addEventListener(t,t=>h.input(t.keyCode,s),!0)),i.o(new class extends r{d(){this.Bt=500,h.m=(t=>this.bt()),c.P=(t=>this.bt())}update(){s.clear(),s.i(2*(400-this.Bt),200,60-(500-this.Bt)/500*60,"#ccc"),s.c(320,170,"#fff","60px Impact","center","The Circle Masters")}fixedUpdate(){--this.Bt<0&&this.bt()}u(){h.m=(t=>{}),c.P=(t=>{})}bt(){i.o(new T)}}),function t(){i.update(),requestAnimationFrame(t)}(),A();
