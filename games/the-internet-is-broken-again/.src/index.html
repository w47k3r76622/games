<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<canvas id=main width=1000 height=1000></canvas>
<style>
    #main {position:fixed;width:99.5vmin;top:49.9%;left:49.9%;transform:translateX(-50%)translateY(-50%);}
</style>
<script>var getNextWholeDivisor=(a,b)=>0==a%b?b:getNextWholeDivisor(a,b-1),setNoSmoothing=a=>{a.imageSmoothingEnabled=!1,a.webkitImageSmoothingEnabled=!1,a.mozImageSmoothingEnabled=!1,a.msImageSmoothingEnabled=!1,a.oImageSmoothingEnabled=!1},colorBlue="0,0,255",colorBlueAlph="0,0,255,0.5",colorRed="255,0,0",colorRedAlph="255,0,0,0.5",colorYellow="255,255,0",colorYellowAlph="255,255,0,0.5",colorPink="255,0,255",colorLightPink="255,100,255",colorGray="126,126,126",colorGreen="0,255,0",colorGreenAlph="0,255,0,0.5",colorLightBlue="0,100,255",COLORED_SPRITE_SHEETS=[],SOLID_COLORS=[colorRed,colorBlue,colorPink,colorGreen,colorYellow],ALPHA_COLORS=[colorRedAlph,colorBlueAlph,colorYellowAlph,colorGreenAlph],loadColoredSpriteSheets=()=>{let a=SOLID_COLORS.concat(ALPHA_COLORS);it(a.length,b=>{let c=document.createElement("canvas");c.width=132,c.height=61;let d=c.getContext("2d");setNoSmoothing(d),d.clearRect(0,0,132,61);let e=a[b],f=e.split(",");4>f.length&&(e+=",1"),d.fillStyle="rgba("+e+")",d.drawImage(SPRITE_SHEET,0,0),d.globalCompositeOperation="source-atop",d.fillRect(0,0,132,61),COLORED_SPRITE_SHEETS[a[b]]=c})};function TextPrinter(){let a=this;a.sSheet=SPRITE_SHEET;let b=0,c=0;a.characterArray=[];for(let d=97;123>d;d++)26<=c&&(c=0,b=1),a.characterArray[String.fromCharCode(d)]={x:5*c,y:5*b},c++;it(10,b=>{a.characterArray[b+""]={x:30+5*b,y:5}}),a.characterArray["("]={x:80,y:5},a.characterArray[")"]={x:85,y:5},a.characterArray[" "]={x:90,y:5},a.characterArray["?"]={x:0,y:5},a.characterArray["!"]={x:25,y:5},a.characterArray["."]={x:5,y:5},a.characterArray[","]={x:10,y:5},a.drawText=(b,d,e,f,g)=>{let h=SPRITE_SHEET;g&&(h=COLORED_SPRITE_SHEETS[g]),c=0,it(b.length,g=>{ctx.drawImage(h,a.characterArray[b[g]].x,51+a.characterArray[b[g]].y,5,5,d+6*c*f,e,5*f,5*f),c+=[" ",".","!"].includes(b[g])?.4:1})},a.getStrLength=(a,b)=>{let c=0;return it(a.length,d=>{c+=" "==a[d]?3*b:6*b}),c}}var probDist=a=>{let b=[],c=a.length,d=100;0!=d%c&&(d-=d%c);let e=d/c,f=e,g=0;return it(100,c=>{b.push(a[g]),c>f&&(g++,f+=e)}),b},randomPer=()=>{let a=Math.random();return Math.round(100*a)},it=(a,b)=>{for(let c=0;c<a;c++)b(c)},TIME_BEFORE_FALL=50,FALL_FRAMES_HALVED=30;function Hitbox(a,b,c,d){return{mag:0,ang:0,x:a,y:b,w:c,h:d,spawnPoint:null,fallTimer:0,cX(){return this.x+this.w/2},cY(){return this.y+this.h/2},center(){let a=this;return{x:a.cX(),y:a.cY()}},move(c,d){let e=this,f=c?c:Math.cos(e.ang)*e.mag,g=d?d:Math.sin(e.ang)*e.mag,h=Hitbox(e.x,e.y,e.w,e.h),a=Hitbox(e.x,e.y,e.w,e.h);h.x+=f,a.y+=g,10<h.x&&990>h.x+e.w&&1>stage.solidBodies.filter(a=>h.checkColission(a)).length&&(e.x+=f),10<a.y&&990>a.y+e.h&&1>stage.solidBodies.filter(b=>a.checkColission(b)).length&&(e.y+=g)},getDist(a,b=0){let c=this,d=c.cX()-a.x,e=c.cY()-a.y,f=Math.hypot(d,e),g=(b-f)/f,h=Math.atan2(e,d)||0;return g=0<g||isNaN(g)?0:g,{dist:f,angle:h,translateX:.5*d*g,translateY:.5*e*g,normalX:d/f,normalY:e/f}},checkColission(a){let b=this;return!(b.y+b.h<=a.y)&&!(b.y>=a.y+a.h)&&!(b.x+b.w<=a.x)&&b.x<a.x+a.w},checkFall(){let a=this;if(stage.holes&&"falling"!=a.state){let b=!1,c=stage.getHoles();it(c.length,d=>{a.x>=c[d].x&&a.x+a.w<=c[d].x+c[d].w&&a.y>=c[d].y&&a.y+a.h<=c[d].y+c[d].h&&(b=!0)}),b?a.fallTimer?Date.now()-a.fallTimer>=TIME_BEFORE_FALL&&a.triggerFall():a.fallTimer=Date.now():a.fallTimer=0}},getClosestLink(a,b){let c=this,d=a;return b.child?(c.getDist(b.child).dist<c.getDist(d).dist&&(d=b.child),c.getClosestLink(d,b.child)):d},goToSpawn(){let a=this;a.x=a.spawnPoint.x,a.y=a.spawnPoint.y},setVals(a,b,c,d){let e=this;e.spawnPoint={x:a,y:b},e.x=a,e.y=b,e.w=c,e.h=d}}}var BYTER_WIDTH=30,BYTER_HEIGHT=30,idleAnimLengthProbDist=probDist([60,120,180]);function Byter([a,b,d="sleeper",c]){let e=this;e.food=null,e.state="idle",e.animState="idle",e.altPoint=c,e.direction=Math.round(Math.random()),e.type=d,"sleeper"==d?e.color=colorYellowAlph:"active"==d?e.color=colorRedAlph:"trooper"==d&&(e.color=colorBlueAlph),e.eatingFrameConter=0,e.frameCounter=0,e.setVals(a,b,BYTER_WIDTH,BYTER_HEIGHT),e.animation=new Anim({exp:genAnim([0],180),walking:genAnim([0,12],60),idle:genAnim([0,0,1,0,1,0,0],idleAnimLengthProbDist[randomPer()]),attack:genAnim([6,7,8],10,1),eating:genAnim([12,13,14],10,1),cd:genAnim([6],180),falling:genAnim([6],180),sleep:genAnim([2],180)},3.5,10,0,e.color),e.update=()=>{let a=1,b=0,c="";0<e.frameCounter&&e.frameCounter--;let f=e.getDist(PLAYER.center()),g=.75,h=3;"trooper"==d&&(g=.8,h=5),e.mag-=e.mag*mouseAcc/(maxVel*g),ctx.font="40px Extrabold sans-serif";let i=0;switch(e.state){case"idle":let d=e.getDist(e.spawnPoint);if(0<e.frameCounter)e.animState="exp",c="?";else if(2<d.dist)i=e.cX()-e.spawnPoint.x,"trooper"!=e.type&&(c="..."),e.animState="walking",h>d.dist&&(h=1),e.x-=d.normalX*h,e.y-=d.normalY*h;else if(2>=d.dist&&"trooper"==e.type){let a=e.altPoint;e.altPoint=e.spawnPoint,e.spawnPoint=a,e.changeState("idle")}else e.animState="idle",0==e.animation.anim.idle.counter&&(e.direction=Math.abs(e.direction-1));150>f.dist&&e.changeState("attack");break;case"attack":0<e.frameCounter&&(c="!!"),15<=e.frameCounter?e.animState="exp":(i=e.cX()-PLAYER.cX(),e.animState="attack",e.mag-=mouseAcc,e.ang=f.angle,250<f.dist&&e.changeState("idle"));break;case"eating":if(0<e.frameCounter)c="\uD83C\uDF57",e.animState="exp";else{e.food=e.getClosestLink(e.food,e.food.getParent());let a=e.getDist(e.food);30<a.dist?(i=e.cX()-e.food.x,e.animState="walking",e.x-=a.normalX,e.y-=a.normalY):(e.animState="eating",e.eatingFrameCounter?(e.eatingFrameCounter--,!e.eatingFrameCounter&&("sleeper"==e.type?e.changeState("sleep"):e.changeState("idle"),e.food.consume(),e.food=null)):e.eatingFrameCounter=180,c="byte")}break;case"sleep":c="z",e.animState="sleep";break;case"cooldown":e.animState="cd",e.frameCounter||(e.state="attack");break;case"falling":e.animState="falling",e.frameCounter>=FALL_FRAMES_HALVED?a=(e.frameCounter-FALL_FRAMES_HALVED)/FALL_FRAMES_HALVED:(e.goToSpawn(),b=e.frameCounter/FALL_FRAMES_HALVED),e.frameCounter||e.changeState("idle");}e.checkFall();let j=(PLAYER.w+e.w)/2;"falling"!=PLAYER.state&&f.dist<=j&&(PLAYER.impact(f.angle),"eating"!=e.state&&"sleep"!=e.state&&(e.mag=3,e.changeState("cooldown"))),e.move(),"\uD83C\uDF57"==c?ctx.fillText(c,e.x-e.w+10,e.y-e.h/2-10):textProc.drawText(c,e.x,e.y-e.h-30,6,e.color),i>e.w/2?e.direction=1:i<-e.w/2&&(e.direction=0),e.animation.animate(e.x-e.w*a/2,e.y-e.h*a/2-b*e.y,e.animState,a,e.direction),debugMode&&(ctx.strokeStyle="rgb("+e.color+")",ctx.lineWidth=2,ctx.strokeRect(e.x,e.y-b*e.y,e.w*a,e.h*a))},e.triggerFood=a=>{let b=this;"idle"!=b.state||b.frameCounter||(b.food=a,b.changeState("eating"))},e.triggerFall=()=>{e.changeState("falling")},e.changeState=a=>{let b=this;b.frameCounter="cooldown"==a?30:"falling"==a?2*FALL_FRAMES_HALVED:"idle"==a&&"trooper"==b.type?90:45,b.state=a}}Byter.prototype=Hitbox();var SPRITE_WIDTH=22,SPRITE_HEIGHT=17;function Anim(a,b,c,d,e){let f=this;for(key in f.anim=a,f.spriteData=[],f.sSheet=e?COLORED_SPRITE_SHEETS[e]:SPRITE_SHEET,it(3,a=>{it(6,b=>{f.spriteData.push([SPRITE_WIDTH*b,SPRITE_HEIGHT*a])})}),f.anim){let a=f.anim[key],b=Math.round(a.duration/a.sprites.length),c=b,d=0;a.spriteArray=[],it(a.duration,e=>{e>c&&(d++,c+=b),a.spriteArray.push(a.sprites[d])})}f.animate=(a,e,g,h,i,j=0)=>{f.color&&ctx.drawImage(f.sSheet,100,100);let k=f.anim[g],l=f.spriteData[k.spriteArray[k.counter]],m=1;1&i?(m=-1,a=-a-SPRITE_WIDTH*b+c):a-=c,e-=d,ctx.save(),ctx.scale(m,1),ctx.drawImage(f.sSheet,l[0],l[1],SPRITE_WIDTH,SPRITE_HEIGHT,a,e,SPRITE_WIDTH*b*h,SPRITE_HEIGHT*b*h),ctx.restore(),k.counter+=Math.round(k.add+j),k.counter>=k.duration?1&k.reverse?(k.add=-1,k.counter--):k.counter=0:0>=k.counter&&(k.add=1)}}var genAnim=(a,b,c=0)=>({sprites:a,duration:b,counter:0,reverse:c,yOffset:0,add:1});function optBox(a,b,c,d,e,f){let g=this,h=textProc.getStrLength(d,(c-20)/5)+10;g.setVals(a,b,h,c),g.draw=()=>{ctx.strokeStyle=f?"rgb("+f+")":"#00c745",ctx.lineWidth=10,ctx.strokeRect(a,b,h,c),textProc.drawText(d,a+10,b+10,(c-20)/5,f)},g.executeCallback=()=>{e()}}optBox.prototype=Hitbox();function Stage(a){let b=this;b.enemies=[],b.sockets=[],b.holes=[],b.ropes=[],b.solidBodies=[],b.winFrameCounter=0,b.wins=[],b.signs=[[1,1,1],[1,1,1],[1,1,1],[1,1,1]],b.colors=[[50,0,0],[80,15,40],[110,30,80],[140,45,120]],b.ranges=[{min:50,max:140},{min:0,max:45},{min:0,max:120}],b.stops=[0,.17,.33,.5,.67,.83,1],b.update=()=>{b.loaded||b.setup(),b.holes&&b.drawHoles(),b.sockets.forEach(a=>a.update()),b.ropes.forEach(a=>a.attached?null:a.update()),b.enemies.forEach(a=>a.update());let a=!0;it(b.wins.length,c=>{b.wins[c].rope||(a=!1)}),a?(b.winFrameCounter++,b.winFrameCounter>WIN_FRAMES&&!b.enemies.filter(a=>"eating"==a.state).length&&triggerWin()):b.winFrameCounter=0},b.getHoles=()=>{let a=[];return it(b.holes.length,c=>{b.holes[c].active&&(a=a.concat(b.holes[c].holes))}),a},b.drawHoles=()=>{let a=document.createElement("canvas");a.width=60,a.height=60;let c=[];ctx.save(),ctx.beginPath(),it(b.getHoles().length,a=>{ctx.moveTo(b.getHoles()[a].x,b.getHoles()[a].y),it(b.getHoles()[a].points.length,c=>{ctx.lineTo(b.getHoles()[a].points[c][0],b.getHoles()[a].points[c][1])})}),ctx.clip("nonzero");let d=a.getContext("2d");d.clearRect(0,0,d.canvas.width,d.canvas.height),ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height);let e=[[0,0],[60,0],[0,60],[60,60]];it(4,a=>{c.push(d.createLinearGradient(e[a][0],e[a][1],30,30))});let f=[0,1,2,3,2,1,0];it(4,a=>{it(3,c=>{(b.colors[a][c]<b.ranges[c].min||b.colors[a][c]>b.ranges[c].max)&&(b.signs[a][c]*=-1),b.colors[a][c]+=b.signs[a][c]})}),it(4,a=>{let g=c[a];it(f.length,a=>{g.addColorStop(b.stops[a],"rgb("+b.colors[f[a]][0]+", "+b.colors[f[a]][1]+", "+b.colors[f[a]][2]+")")}),d.fillStyle=g,d.fillRect(e[a][0]/2,e[a][1]/2,30,30)});let g=ctx.createPattern(a,"repeat");ctx.fillStyle=g,ctx.fillRect(0,0,ctx.canvas.width,ctx.canvas.height),ctx.restore()},b.trigger=()=>{it(b.holes.length,a=>{b.holes[a].active=!b.holes[a].active})},b.setup=()=>{a(b),PLAYER.goToSpawn(),PLAYER.state="normal",PLAYER.frameCounter=0,PLAYER.health=3,PLAYER.rope=null,PLAYER.dashAfterImg=[],b.loaded=!0}}var stage1Data=[[[480,10,"origin","up",90,colorBlue],[480,950,"win","down"]],[],[],[100,200]],stage2Data=[[[950,700,"origin","right",40,colorBlue],[480,950,"win","down"]],[[[[0,300,375,75],[300,-10,75,385]]]],[],[100,200]],stage3Data=[[[480,10,"origin","up",45,colorBlue],[10,480,"con","left"],[950,480,"con","right"],[480,950,"win","down"]],[],[],[100,200]],stage4Data=[[[10,465,"origin","left",50,colorRed],[950,465,"end","right",0,colorRed],[480,10,"origin","up",75,colorBlue],[480,950,"win","down"]],[],[[900,200]],[100,200]],stage5Data=[[[480,10,"origin","up",45,colorBlue],[10,480,"con","left"],[950,480,"con","right"],[480,950,"win","down"]],[],[[500,900]],[100,200]],stage6Data=[[[480,10,"origin","up",45,colorBlue],[10,425,"con","left"],[950,505,"con","right"],[425,950,"win","down"]],[[[[0,510,600,100],[400,390,600,100]]]],[[810,810,"active"]],[100,850]],stage7Data=[[[950,100,"origin","right",70,colorBlue],[600,950,"win","down"],[750,10,"origin","up",15,colorRed],[950,250,"end","right",0,colorRed],[500,950,"origin","down",50,colorYellow],[10,500,"trigger","left"]],[[[[0,300,365,75],[300,-10,75,385]]],[[[635,300,365,75],[625,-10,75,385]],!1]],[[100,100,"active"]],[100,850]],stage8Data=[[[250,10,"origin","up",50,colorBlue],[950,300,"con","right"],[10,450,"con","left"],[950,800,"win","right"],[500,950,"origin","down",50,colorYellow],[10,600,"trigger","left"]],[[[[175,-10,200,200],[810,225,200,200]]],[[[0,375,200,200],[810,725,200,200]],!1]],[[900,650],[100,200]],[300,750]],stage9Data=[[[10,300,"origin","left",30,colorBlue],[10,400,"win","left",0,colorPink],[950,550,"origin","right",30,colorPink],[950,700,"win","right"],[300,10,"con","up"],[700,950,"con","down"],[700,10,"con","up"],[300,950,"con","down"],[10,150,"con","left"],[950,150,"con","right"],[10,850,"con","left"],[950,850,"con","right"]],[],[],[300,750]],stage11Data=[[[10,200,"origin","left",40,colorBlue],[950,450,"win","right"],[850,950,"origin","down",40,colorPink],[950,200,"win","right",0,colorPink],[10,600,"origin","left",40,colorYellow],[450,950,"trigger","down"],[100,950,"trigger","down"],[650,950,"con","down"],[250,10,"con","up"],[10,400,"con","left"],[950,700,"con","right"],[250,950,"con","down"],[550,10,"con","up"]],[[[[175,-10,200,200],[575,810,200,200],[810,125,200,200]]],[[[25,810,200,200],[0,325,200,200],[810,375,200,200]],!1]],[[525,450,"active"]],[300,750]],stage12Data=[[[950,200,"origin","right",40,colorBlue],[500,10,"origin","up",40,colorPink],[350,10,"win","up"],[10,700,"win","left",0,colorPink],[10,200,"con","left"],[950,550,"con","right"],[600,950,"con","down"],[650,10,"con","up"],[10,400,"con","left"],[300,950,"con","down"]],[[[[300,300,350,350]]]],[[100,700,"trooper",{x:850,y:700}]],[800,200]],stage10Data=[[[10,650,"origin","left",40,colorBlue],[600,10,"origin","up",30,colorPink],[400,10,"win","up"],[950,500,"win","right",0,colorPink],[950,700,"origin","right",40,colorYellow],[600,950,"trigger","down"],[300,950,"con","down"],[10,150,"con","left"],[950,300,"con","right"],[700,950,"con","down"],[10,500,"origin","left",45,colorRed],[500,950,"end","down",0,colorRed],[10,400,"origin","left",30,colorRed],[300,10,"end","up",0,colorRed]],[[[[800,-10,75,200],[800,115,200,75],[0,75,200,200]]],[[[0,800,200,75],[125,800,75,200]],!1]],[[60,940,"active"],[950,50]],[450,450]],genStage=a=>{let b=[],c=[],d=[],e=[],f=[],g=[],h=null,j=null;return it(a[0].length,d=>{let e=new Socket(a[0][d]);"con"==e.type&&(h?(h.setConnection(e),h=null):h=e),"origin"==e.type?e.color==colorRed?!j&&(j=e.rope):c.push(e.rope):"win"==e.type?g.push(e):e.color==colorRed&&(j.attach(e,e.conPt),j=null),f=f.concat(e.hitboxes),b.push(e)}),it(a[1].length,b=>{let c=genHoles([],a[1][b][1]);it(a[1][b][0].length,d=>{let e=a[1][b][0][d];c.holes.push(new Hole(e))}),d.push(c)}),it(a[2].length,b=>{e.push(new Byter(a[2][b]))}),new Stage(function(h){h.sockets=b,h.ropes=c,h.holes=d,h.enemies=e,PLAYER.spawnPoint={x:a[3][0],y:a[3][1]},h.solidBodies=f,h.wins=g})},genHoles=(a,b=!0)=>({holes:a,active:b});function Hole([a,b,c,d]){let e=this;e.setVals(a,b,c,d),e.points=[];let f=10,g=10,h=getNextWholeDivisor(e.w,g),i=e.w/h,j=10;it(i,a=>{e.points.push([e.x+h*(a+1),e.y+f+j]),j=Math.abs(j-10)}),h=getNextWholeDivisor(e.h,g),i=e.h/h,j=10,it(i,a=>{e.points.push([e.x+e.w-j,e.y+h*(a+1)+f]),j=Math.abs(j-10)}),h=getNextWholeDivisor(e.w,g),i=e.w/h,j=10,it(i,a=>{e.points.push([e.x+e.w-h*(a+1),e.y+e.h-j+f]),j=Math.abs(j-10)}),h=getNextWholeDivisor(e.h,g),i=e.h/h,j=10,it(i,a=>{e.points.push([e.x+j,e.y+e.h-h*(a+1)+f]),j=Math.abs(j-10)})}Hole.prototype=Hitbox();var PLAYER_WIDTH=20,PLAYER_HEIGHT=20,HOLD_RADIUS=30,AFTER_DASH_CD=10,TOTAL_DASH_CD=50,TOTAL_DASH_FRAMES=10;function Player(a,b){let c=this;c.setVals(a,b,PLAYER_WIDTH,PLAYER_HEIGHT),c.dashFrames=0,c.dashCoolDown=0,c.state="normal",c.animState="idle",c.frameCounter=0,c.direction=0,c.health=3,c.rope=null,c.dashAfterImg=[],c.animation=new Anim({walking:genAnim([3,4,5,9,10,11,15],60),idle:genAnim([3,16,3,3],240),falling:genAnim([3],180),recoil:genAnim([3],180)},4,20,22),c.update=()=>{let a=1,b=0,d=1,e=null;if(!c.frameCounter){if(!RESOLVE_SHORT_CLICK||c.dashFrames){let a=0;if(-1>c.mag&&(c.mag*=-1,c.ang-=Math.PI),c.mag-=c.dashFrames?c.mag*dashAcc/dashMaxVel:c.mag*mouseAcc/maxVel,!c.dashFrames&&c.dashCoolDown<TOTAL_DASH_CD-AFTER_DASH_CD&&isMousePressed){a=c.cX()-mousePos.x;let b=c.getDist(mousePos);c.mag+=100<b.dist?mouseAcc:b.dist/100*mouseAcc,c.ang=b.angle-Math.PI}c.dashFrames&&(c.mag+=dashAcc),c.rope&&(e=c.getHoldPoint(),c.rope.update(e)),c.move(),a>c.w/2?c.direction=1:a<-c.w/2&&(c.direction=0),.2<c.mag?(c.animState="walking",d=c.mag/maxVel):(c.animState="idle",0==c.animation.anim.idle.counter&&(c.direction=Math.abs(c.direction-1)))}else if(c.rope){let a=!1;if(soc=stage.sockets.find(a=>50>c.getDist({x:a.conPt[0],y:a.conPt[1]}).dist&&!a.rope)){let b=c.cX()-soc.conPt[0],d=c.cY()-soc.conPt[1],e=!1,f=!1;it(stage.ropes.length,a=>{let g=c.getClosestLink(stage.ropes[a],stage.ropes[a]);if(stage.ropes[a]!==c.rope&&50>c.getDist(g).dist){let a=c.cX()-g.x,h=c.cY()-g.y;(0<b&&0<a&&a<b||0>b&&0>a&&a>b)&&(e=!0),(0<d&&0<h&&h<d||0>d&&0>h&&h>d)&&(f=!0)}}),soc.color!==colorGray&&(soc.color!==c.rope.color||e||f)||(c.rope.attach(soc,soc.conPt),a=!0)}a||c.rope.detach()}else if(rop=stage.ropes.find(a=>50>c.getDist(a).dist))20>rop.getDist(mousePos).dist&&"destroy"!=rop.state&&rop.color!=colorRed&&rop.attach(c,rop);else if(!c.dashCoolDown&&270>Date.now()-lastMouseUp){let a=c.getDist(mousePos);c.state="dashing",c.ang=a.angle-Math.PI,c.dashFrames=TOTAL_DASH_FRAMES}if(RESOLVE_SHORT_CLICK=!1,c.dashFrames){if(0==c.dashFrames%2&&"dashing"==c.state){let a=COLORED_SPRITE_SHEETS[SOLID_COLORS[c.dashFrames/2-1]];c.dashAfterImg.push([a,c.x,c.y,10])}c.dashFrames--,c.dashFrames||(c.state="normal",c.dashCoolDown=TOTAL_DASH_CD)}c.checkFall()}else c.frameCounter>FALL_FRAMES_HALVED?a=(c.frameCounter-FALL_FRAMES_HALVED)/FALL_FRAMES_HALVED:c.frameCounter==FALL_FRAMES_HALVED?flashFrames=3:(c.goToSpawn(),b=c.frameCounter/FALL_FRAMES_HALVED),c.frameCounter--,c.animState="falling",c.frameCounter||(c.state="normal");c.dashCoolDown&&c.dashCoolDown--,c.rope&&e&&(ctx.save(),ctx.scale(1,1),ctx.drawImage(SPRITE_SHEET,110,34,SPRITE_WIDTH,SPRITE_HEIGHT,e.x-11,e.y-SPRITE_HEIGHT/2,33,1.5*SPRITE_HEIGHT),ctx.restore());let f,g;c.direction?(f=c.x-c.w-32+2*(c.w*a),g=c.y-2*(c.h*a)+27):(f=c.x+c.w+8-2*(c.w*a),g=c.y+c.h+8-2*(c.h*a));let h=null;it(c.dashAfterImg.length,a=>{let b=c.dashAfterImg[a][1]+Math.cos(c.ang)*c.mag,d=c.dashAfterImg[a][2]+Math.sin(c.ang)*c.mag,e=1;1&c.direction?(e=-1,b=-b-88+20):b-=20,d-=22,ctx.save(),ctx.scale(e,1),ctx.globalAlpha=c.dashAfterImg[a][3]/7,ctx.drawImage(c.dashAfterImg[a][0],88,17,22,17,b,d,88,68),ctx.restore(),c.dashAfterImg[a][3]--,0>c.dashAfterImg[a][3]&&(h=c.dashAfterImg[a])}),h&&(c.dashAfterImg=c.dashAfterImg.filter(a=>a!==h)),c.animation.animate(f,g-b*c.y,c.animState,a,c.direction,d),debugMode&&(ctx.lineWidth=1,ctx.strokeStyle="orange",ctx.strokeRect(c.x,c.y-b*c.y,c.w*a,c.h*a),ctx.strokeStyle="red",ctx.strokeRect(c.cX(),c.cY()-b*c.cY(),1,1),ctx.beginPath(),ctx.arc(c.cX(),c.cY()-b*c.cY(),HOLD_RADIUS,0,2*Math.PI,!1),ctx.strokeStyle="purple",ctx.stroke())},c.getHoldPoint=()=>{let a=c.getDist(c.rope);return{x:c.cX()-a.normalX*HOLD_RADIUS,y:c.cY()-a.normalY*HOLD_RADIUS}},c.impact=a=>{c.deductHealth(),c.state="recoiling",flashFrames=3,c.ang=a-Math.PI,c.dashFrames=TOTAL_DASH_FRAMES/2},c.triggerFall=()=>{c.state="falling",c.deductHealth(),c.dashFrames=0,c.rope&&(c.rope.detach(),c.rope=null),c.frameCounter=2*FALL_FRAMES_HALVED,c.mag=0},c.deductHealth=()=>{c.health--,1>c.health&&(gameState="game_over")}}Player.prototype=Hitbox();var LINK_DIST_CONSTRAINT=10,ROPE_ANIMATION_FRAMES=100,ROPE_RECOLECTION_FRAMES=180,ROPE_SECTION_WIDTH=5,PLAYER_MIN_DIST=17,PLAYER_MAX_DIST=31,ROPE_SECTION_HEIGHT=5,WIN_FRAMES=180;function RopeSection(a,b,c,d,e=null){let f=this;f.attached=null,f.fixedX=a,f.fixedY=b,f.amount=c,f.color=d,f.child=0<c?new RopeSection(a,b,c-1,d):null,f.origin=e,f.animationFrameCounter=0,f.ropeAnimationFrames=ROPE_ANIMATION_FRAMES,f.state="normal",f.currentOutlineDelay=0,f.recolecting=!1,f.recolectionFrameCounter=0,f.parent=null,f.setVals(a,b,0,0),f.update=a=>{f.recolecting&&f.checkInOrigin()&&f.stopRecolection();let b=21;do a&&(f.x=a.x,f.y=a.y),b--;while(!f.solve(!0)&&0<b);if(f.attached===PLAYER){let a=f.getDist(PLAYER.center());a.dist>PLAYER_MAX_DIST&&PLAYER.move(a.normalX*(a.dist-PLAYER_MAX_DIST),a.normalY*(a.dist-PLAYER_MAX_DIST))}f.attached&&f.checkEnemyProximity(),0<f.recolectionFrameCounter&&(f.recolectionFrameCounter--,!f.recolectionFrameCounter&&f.triggerRecolection()),f.draw()},f.solve=a=>{let b=LINK_DIST_CONSTRAINT;f.recolecting&&"destroy"!=f.state&&(b=0);let c=[PLAYER];if(c=c.concat(stage.enemies),it(c.length,b=>{let d=f.getDist(c[b].center()),e=15;if((c[b]instanceof Player||c[b]instanceof Byter)&&(e=PLAYER_MIN_DIST),d.dist<=e){a=!1;let e=d.dist/PLAYER_MIN_DIST,g=1-e;f.child&&(f.x+=3*d.normalX*e,f.y+=3*d.normalY*e),c[b].move(3*-d.normalX*g,3*-d.normalY*g),c[b]instanceof Player&&c[b].dashFrames&&(c[b].mag=-dashMaxVel/8)}}),c=null,f.child){f.child.parent||(f.child.parent=f);let c=f.getDist(f.child,b);return c.dist>b&&(a=!1,f.x+=c.translateX,f.y+=c.translateY,f.child.x-=c.translateX,f.child.y-=c.translateY),f.child.solve(a)}return f.x=f.fixedX,f.y=f.fixedY,a},f.attach=(a,b)=>{f.detach(),f.attached=a,a.rope=f,f.recolectionFrameCounter=0,f.stopRecolection(),a instanceof Socket?(a.color=f.color,f.color!=colorRed&&f.setOutlineAnimDelay(0,10*Math.round(f.amount/5))):f.resetOutlineAnim(),f.update(b)},f.setOutlineAnimDelay=(a,b)=>{a?a--:(f.state="connected",a=5,f.currentOutlineDelay=b,b-=10),f.child&&f.child.setOutlineAnimDelay(a,b)},f.resetOutlineAnim=()=>{f.state="normal",f.currentOutlineDelay=0,f.animationFrameCounter=0,f.child&&f.child.resetOutlineAnim()},f.detach=()=>{f.attached&&(f.attached.rope=null,f.attached=null,f.recolectionFrameCounter=ROPE_RECOLECTION_FRAMES)},f.triggerRecolection=()=>{f.recolecting=!0,f.child&&f.child.triggerRecolection()},f.stopRecolection=()=>{f.recolecting=!1,f.child&&f.child.stopRecolection()},f.getParent=()=>f.parent?f.parent.getParent():f,f.checkInOrigin=()=>!f.child||!!(.1>f.getDist(f.child).dist)&&f.child.checkInOrigin(),f.assignOrigin=a=>{f.origin=a,a.rope=f},f.consume=()=>{f.child.parent=null,f.child.setForDestroy(5),f.child.assignOrigin(f.getParent().origin),f.getParent().origin=null,stage.ropes=stage.ropes.filter(a=>a!==f.getParent()).concat([f,f.child]),f.reverse(),f.setForDestroy(5)},f.setForDestroy=a=>{f.state="destroy",f.currentOutlineDelay=a,f.ropeAnimationFrames=5,f.animationFrameCounter=0,f.child&&f.child.setForDestroy(a+5)},f.destroy=()=>{stage.ropes=stage.ropes.filter(a=>a!==f),f.child&&!f.checkInOrigin()?(f.child.parent=null,f.origin&&f.child.assignOrigin(f.origin),stage.ropes.push(f.child)):f.origin&&(f.origin.rope=null,f.origin=null)},f.reverse=()=>{f.child=f.parent,f.child?f.child.reverse():(f.attached&&(f.attached.rope=null,f.attached=null),f.fixedX=f.x,f.fixedY=f.y)},f.checkEnemyProximity=()=>{"destroy"!=f.state&&((byter=stage.enemies.find(a=>(f.color!=colorBlue||"trooper"!=a.type)&&"idle"==a.state&&175>f.getDist(a.center()).dist))?byter.triggerFood(f):f.child&&f.child.checkEnemyProximity())},f.checkProximity=a=>"destroy"!=f.state&&(!!(50>f.getDist(a.center()).dist)||!!f.child&&f.child.checkProximity(a)),f.draw=()=>{"normal"!=f.state&&f.currentOutlineDelay&&f.currentOutlineDelay--,(f.parent||f.attached)&&"normal"==f.state||f.currentOutlineDelay||f.drawOutline("destroy"==f.state?"255,255,255":null),f.child&&(ctx.lineWidth=15,ctx.strokeStyle="rgb("+("destroy"!=f.state||f.currentOutlineDelay?d:"255,255,255")+")",ctx.lineCap="round",ctx.beginPath(),ctx.moveTo(f.x,f.y),ctx.lineTo(f.child.x,f.child.y),ctx.stroke(),f.child.draw()),debugMode&&(ctx.lineWidth=1,ctx.strokeStyle="#003300",ctx.strokeRect(f.x-ROPE_SECTION_WIDTH/2,f.y-ROPE_SECTION_HEIGHT/2,5,5))},f.drawOutline=a=>{ctx.beginPath();let b=f.animationFrameCounter/f.ropeAnimationFrames,c=1-b;ctx.arc(f.x,f.y,40*b,0,2*Math.PI,!1),ctx.lineWidth=25*c,ctx.strokeStyle="rgba("+(a?a:f.color)+", "+c+")",ctx.stroke(),f.animationFrameCounter++,f.animationFrameCounter>f.ropeAnimationFrames&&("destroy"==f.state?f.destroy():f.animationFrameCounter=0)}}RopeSection.prototype=Hitbox();var SOCKET_ANIMATION_FRAMES=180,SOCKET_WIDTH=40,SOCKET_HEIGHT=50;function Socket([a,b,c,d,e,f]){let g=this;g.outer=[],g.hbData=[],g.hitboxes=[],g.inner=null;let h=0;"win"==c&&(h=10),"left"==d&&(g.outer=[[a,b,SOCKET_HEIGHT,15],[a,b+35,SOCKET_HEIGHT,15]],g.inner=[a,b+15,SOCKET_WIDTH+h,20],g.conPt=[a+38,b+25]),"right"==d&&(g.outer=[[a-10,b,SOCKET_HEIGHT,15],[a-10,b+35,SOCKET_HEIGHT,15]],g.inner=[a-h,b+15,SOCKET_WIDTH+h,20],g.conPt=[a+2,b+25]),"up"==d&&(g.outer=[[a,b,15,SOCKET_HEIGHT],[a+35,b,15,SOCKET_HEIGHT]],g.inner=[a+15,b,20,SOCKET_WIDTH+h],g.conPt=[a+25,b+38]),"down"==d&&(g.outer=[[a,b-10,15,SOCKET_HEIGHT],[a+35,b-10,15,SOCKET_HEIGHT]],g.inner=[a+15,b-h,20,SOCKET_WIDTH+h],g.conPt=[a+25,b]),g.triggered=!1,g.type=c,g.connection=null,g.color=f?f:"win"==c?colorBlue:"trigger"==c?colorYellow:colorGray,g.animationFrameCounter=90,g.amount=e,g.rope="origin"==c&&0<e?new RopeSection(g.conPt[0],g.conPt[1],g.amount,f,g):null,it(g.outer.length,a=>{g.hitboxes.push(new Hitbox(g.outer[a][0],g.outer[a][1],g.outer[a][2],g.outer[a][3]))}),g.update=()=>{if("origin"==g.type?!g.rope&&g.color!=colorRed&&(g.rope=new RopeSection(g.conPt[0],g.conPt[1],g.amount,g.color,g),stage.ropes.push(g.rope)):g.rope&&"destroy"!=g.rope.state?(g.connection&&!g.connection.rope?(g.connection.color=g.color,g.connection.amount=g.rope.amount,g.connection.rope=new RopeSection(g.connection.conPt[0],g.connection.conPt[1],g.rope.amount,g.color,g.connection),stage.ropes.push(g.connection.rope),g.connection.type="origin"):"trigger"==g.type&&!g.triggered&&(g.triggered=!0,stage.trigger()),g.rope.update({x:g.conPt[0],y:g.conPt[1]})):"con"==g.type&&"origin"==g.connection.type?(g.color=colorGray,g.connection.color=g.color,g.connection.rope.consume(),g.connection.type="con"):"trigger"==g.type&&g.triggered&&(g.triggered=!1,stage.trigger()),ctx.fillStyle="#00c745",it(g.outer.length,a=>{ctx.fillRect(g.outer[a][0],g.outer[a][1],g.outer[a][2],g.outer[a][3])}),ctx.fillStyle="rgb("+g.color+")",ctx.fillRect(g.inner[0],g.inner[1],g.inner[2],g.inner[3]),debugMode&&(ctx.strokeStyle="pink",ctx.lineWidth=2,it(g.hitboxes.length,a=>{ctx.strokeRect(g.hitboxes[a].x,g.hitboxes[a].y,g.hitboxes[a].w,g.hitboxes[a].h)})),"win"==g.type){ctx.beginPath();let a=g.animationFrameCounter/SOCKET_ANIMATION_FRAMES;ctx.arc(g.conPt[0],g.conPt[1],40*(1-a),0,2*Math.PI,!1),ctx.lineWidth=15;let b;b=g.color==colorBlue?colorLightBlue:colorLightPink,ctx.strokeStyle="rgba("+b+", "+a+")",ctx.stroke(),g.animationFrameCounter++,g.animationFrameCounter>SOCKET_ANIMATION_FRAMES&&(g.animationFrameCounter=0)}},g.setConnection=a=>{g.connection=a,a.connection=g}}Socket.prototype=Hitbox();function genBackground(){let a=27;return{rows:[],init:!1,update(){let b=this;b.init||(it(a,a=>{b.rows.push(b.row(60+35*a))}),b.init=!0);let c=Math.random(),d=!0;it(a,a=>{!b.rows[a].update()&&d&&(d=!b.rows[a].attemptActivate(c))})},row(a){let b=38;return{numbers:[],animationFrameCounter:0,animationFrames:0,activationProb:.1,active:!1,animCounter:0,xPosCounter:0,init:!1,update(){let c=this;if(c.active){if(c.init||(c.numbers.push(c.number(17+25*c.xPosCounter,a,6*c.animationFrames)),c.init=!0),ctx.font="45px monospace",c.animCounter<b&&c.animationFrameCounter>c.animationFrames){c.animationFrameCounter=0,c.animCounter++,c.xPosCounter++,c.xPosCounter>b&&(c.xPosCounter=0);let d=17+25*c.xPosCounter;c.numbers.push(c.number(d,a,24*c.animationFrames))}c.animationFrameCounter++,c.numbers=c.numbers.filter(a=>a.draw()),c.numbers.length||(c.active=!1)}return c.active},attemptActivate(a){let b=this;return a<b.activationProb?(b.active=!0,b.animationFrames=5+Math.round(15*Math.random()),b.xPosCounter=Math.round(19*Math.random()),b.animCounter=0,b.animationFrameCounter=0,b.init=!1,b.activationProb=.1):b.activationProb+=.1,b.active},number(a,b,c){return{currentFrames:0,animNumber:Math.round(Math.random()),draw(){let d=this,e=d.currentFrames/c;return 10<d.currentFrames&&0==c%d.currentFrames&&(d.animNumber=Math.round(Math.random())),ctx.fillStyle="rgba(3, 252, 90, "+.4*(1-e)+")",ctx.fillText(d.animNumber,a,b),d.currentFrames++,d.currentFrames<c}}}}}}}var PLAYER,stages,stage,textProc,main=document.getElementById("main"),ctx=main.getContext("2d"),mousePos={x:0,y:0,w:0,h:0},isMousePressed=!1,lastMouseUp=0,lastMouseDown=0,RESOLVE_SHORT_CLICK=!1,mouseAcc=1,dashAcc=4,dashMaxVel=32,maxVel=6,gameState="menu",flashFrames=0,currentStage=0,debugMode=!1,background=genBackground(),menuOBox=[],triggerWin=()=>{currentStage++,11>currentStage&&(gameState="champion"),gameState="win"};function loadVars(){loadColoredSpriteSheets(),setNoSmoothing(ctx),ctx.strokeStyle="red",ctx.fillStyle="green",ctx.lineWidth=5,main.addEventListener("mousedown",a=>{isMousePressed=!0,mousePos.x=1e3*a.offsetX/main.getBoundingClientRect().width,mousePos.y=1e3*a.offsetY/main.getBoundingClientRect().bottom,lastMouseDown=Date.now()}),main.addEventListener("mouseup",()=>{isMousePressed=!1,"playing"==gameState?117>Date.now()-lastMouseDown?RESOLVE_SHORT_CLICK=!0:lastMouseUp=Date.now():menuOBox[gameState].checkColission(mousePos)&&menuOBox[gameState].executeCallback()}),main.addEventListener("mousemove",a=>{isMousePressed&&(mousePos.x=1e3*a.offsetX/main.getBoundingClientRect().width,mousePos.y=1e3*a.offsetY/main.getBoundingClientRect().bottom)}),PLAYER=new Player(0,0),textProc=new TextPrinter,stages=[stage1Data,stage2Data,stage3Data,stage4Data,stage5Data,stage6Data,stage7Data,stage8Data,stage9Data,stage10Data,stage11Data,stage12Data],menuOBox={menu:new optBox(700,600,60,"play",function(){stage=genStage(stages[currentStage]),gameState="playing"},colorBlue),game_over:new optBox(50,550,60,"try again?",function(){stage=genStage(stages[currentStage]),gameState="playing"}),win:new optBox(350,600,50,"continue",function(){stage=genStage(stages[currentStage]),gameState="playing"})},stage=genStage(stages[0]),stage=genStage(stages[currentStage]),lastTime=Date.now()}function gameIteration(){if(ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height),ctx.fillStyle="#2e072b",ctx.fillRect(0,0,ctx.canvas.width,ctx.canvas.height),menuOBox[gameState]&&menuOBox[gameState].draw(),"menu"==gameState&&(textProc.drawText("the internet is",25,200,10),textProc.drawText("broken",75,300,25,colorRed),textProc.drawText("(",650,447,9),textProc.drawText("again",685,450,7),textProc.drawText(")",880,447,9),ctx.save(),ctx.rotate(.21),ctx.drawImage(SPRITE_SHEET,74,2,7,8,150,450,560,640),ctx.restore()),"playing"==gameState){background.update(),stage.update(),PLAYER.update(),ctx.fillStyle="rgb(27,207,45)",ctx.lineWidth=5,ctx.strokeStyle="rgb(27,207,45)";let a=30,b=40,c=50,d=50;textProc.drawText("life",75,20,4),textProc.drawText("level "+currentStage,800,25,4,colorGreenAlph);for(let e=1;e<=3;e++)ctx.strokeRect(d,c,a,b),PLAYER.health>=e&&ctx.fillRect(d+5,c+5,a-10,b-10),d+=20+a;0<flashFrames&&(ctx.fillStyle="rgb(255,255,60)",ctx.fillRect(0,0,ctx.canvas.width,ctx.canvas.height),flashFrames--)}"game_over"==gameState&&(textProc.drawText("game",25,250,18),textProc.drawText("over",250,370,18,colorRed),ctx.save(),ctx.rotate(5.6),ctx.drawImage(COLORED_SPRITE_SHEETS[colorRedAlph],0,0,22,16,-400,800,990,720),ctx.restore()),"win"==gameState&&(textProc.drawText("you restored",150,200,10,colorBlue),textProc.drawText("level "+(currentStage-1),100,300,20,colorPink),textProc.drawText("links! awesome!",200,450,7),0==currentStage-1&&textProc.drawText("(yes, the internet starts at 0)",150,510,4),ctx.save(),ctx.rotate(5.6),ctx.drawImage(COLORED_SPRITE_SHEETS[colorGreenAlph],110,34,22,17,-100,950,550,400),ctx.scale(-1,1),ctx.rotate(4.9),ctx.drawImage(COLORED_SPRITE_SHEETS[colorGreenAlph],110,34,22,17,-890,300,550,400),ctx.restore()),"champion"==gameState&&(textProc.drawText("congratulations!",25,200,10,colorBlue),textProc.drawText("all cleared ",50,300,15,colorPink),textProc.drawText("you saved the internet!",25,450,7),textProc.drawText("(for now at least)",150,510,4),ctx.save(),ctx.rotate(5.6),ctx.drawImage(COLORED_SPRITE_SHEETS[colorGreenAlph],110,34,22,17,-100,950,550,400),ctx.scale(-1,1),ctx.rotate(4.9),ctx.drawImage(COLORED_SPRITE_SHEETS[colorGreenAlph],110,34,22,17,-890,300,550,400),ctx.restore()),ctx.strokeStyle="#00c745",ctx.lineWidth=20,ctx.strokeRect(0,0,1e3,1e3),requestAnimationFrame(gameIteration)}var SPRITE_SHEET=new Image;SPRITE_SHEET.src="sprite_with_font_colored_alpha-min.png",SPRITE_SHEET.onload=function(){loadVars(),gameIteration()};</script>

</body>
</html>