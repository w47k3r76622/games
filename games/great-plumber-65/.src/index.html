<!doctype html><title>Great plumber 65</title><link rel=icon href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🧑‍🔧</text></svg>"><head><style>#b,#pri{overflow:hidden}#letter div,#pri{transition:opacity 1s}#b,#content{background:#000;position:absolute;height:100%}#b,#load,.dpad div{text-align:center}@font-face{font-family:m;src:url(m.woff2)}@font-face{font-family:l;src:url(l.woff2)}@font-face{font-family:emoji;src:url(//xem.github.io/unicode13/Twemoji.ttf)}*{-webkit-tap-highlight-color:transparent;-webkit-user-select:none;-ms-user-select:none;user-select:none}#b{margin:0;color:#fff;font:3vmin l;cursor:pointer;width:100%}#load{margin:45vh 0 0}.r{color:#f23}.g{color:#2e2}.b{color:#57d}.y{color:#ff3}#letter,.dpad{color:#000;text-align:left}.title{transform:scale(.001);transition:.2s;margin:40vh auto 0;letter-spacing:-.7vmin}.title span{font-family:m,arial;-webkit-text-stroke:.5px #732;text-shadow:0 1px #952,0 2px #842,0 3px #731,0 4px #621,0 5px #510}.title sup{-webkit-text-stroke:.5px #cc0;letter-spacing:-1.5vmin}.title div{transform:scale(1.15,1.2)}#letter{width:40vmin;height:55vmin;font:5vmin l;background:#fed;padding:5vmin;margin:15vmin 0 0 -45vmin;position:absolute;top:0;left:50%}#letter div{color:pink;font-size:12vmin;text-align:right;margin:6vmin 0 0;transform:rotate(-25deg)}#pri{font:70vmin emoji;position:absolute;left:50%;margin:15vmin 0 0 -15vmin;height:40vmin;padding:20vmin 0 0;transform:rotateX(20deg)}#pri div.a{transform:rotate(15deg)}#pri div.b{font:23vmin emoji;position:relative;top:-88vmin;left:3vmin}[hidden]{display:none}#content{width:100%;transition:background .5s}#toad{font:30vmin emoji;margin:40vmin 0 0 -50vmin;position:absolute;top:0;left:50%}#eyes,#mouth{font:9vmin emoji;top:0;left:50%;position:absolute}#letter.large{width:55vmin;height:auto;left:75%}#eyes{margin:55vmin 0 0 -39vmin}#mouth{margin:63vmin 0 0 -39vmin}.dpad{position:fixed;width:100%;bottom:45px;left:10px;z-index:2;transition:opacity .5s}.dpad div{display:inline-block;font-size:35px;pointer-events:all;margin:10px;width:50px;height:50px;border-radius:5px;background:linear-gradient(45deg,#ddd,#888);box-shadow:2px 2px 5px #000;font-weight:700;padding:4px 0 0;vertical-align:bottom}#bjump{position:absolute;right:20px;bottom:0;display:block;font-family:emoji}.uu{opacity:0}</style></head><body id=b><div id=content><h2 id=load>loading...<span style='font:1px emoji;opacity:0'>🌳</span><span style='font:1px m;opacity:0'>G</h2></div><div id=canvas><canvas id=c></canvas></div><div id=textures hidden><canvas id=px></canvas><img id=grass><img id=sand><img id=brick><img id=brick2><img id=roof><img id=water><img id=treec><img id=door1><img id=door2><img id=flag><img id=princess><img id=pie><img id=fenc><img id=sky><img id=wood><img id=gr></div><div class="dpad uu" id=dpad><div class=uu>a</div><div ontouchstart=K.u=1 ontouchend=K.u=0>▲</div><br><div ontouchstart=K.l=1 ontouchend=K.l=0>◀︎</div><div ontouchstart=K.d=1 ontouchend=K.d=0>▼</div><div ontouchstart=K.r=1 ontouchend=K.r=0>▶︎</div><div id=bjump ontouchstart=K.s=1 ontouchend=K.s=jumpdone=0>🏃</div></div></body><script>female=/Female|Google US English|Susan|Hazel|Zira|Shelley|Grandma|Sandy|Martha|Aria|Priya|Heather|Hayley|Samantha|Catherine|Karen|Tessa|Moira|Kathy|Rishi|Libby/,male=/Male|George|Rocko|Daniel|Grandpa|Eddy|Reed|Fred|Ralph|Mark|David|Arthur|Guy|Aaron|Albert|Jester/,oncontextmenu=e=>{e.preventDefault()},transparent=[];var e,r,o,a,n,l=0;W={models:{},reset:e=>{var t;W.canvas=e,W.objs=0,W.current={},W.next={},W.textures={},W.gl=e.getContext("webgl2"),W.gl.blendFunc(770,771),W.gl.activeTexture(33984),W.program=W.gl.createProgram(),W.gl.enable(2884),W.gl.shaderSource(t=W.gl.createShader(35633),"#version 300 es\nprecision highp float;in vec4 pos,col,uv,normal;uniform mat4 pv,eye,m,im;uniform vec4 bb;out vec4 P,C,U,N;void main(){gl_Position=pv*(P=bb.z>0.?m[3]+eye*(pos*bb):m*pos);C=col;U=uv;N=transpose(inverse(m))*normal;}"),W.gl.compileShader(t),W.gl.attachShader(W.program,t),W.gl.shaderSource(t=W.gl.createShader(35632),"#version 300 es\nprecision highp float;in vec4 P,C,U,N;uniform vec3 light;uniform vec4 o,bb;uniform sampler2D sampler;out vec4 c;void main(){c=mix(texture(sampler,U.xy),C,o[3]);if(o[1]==1.){c=vec4(c.rgb*(max(0.,dot(normalize(light-P.xyz),-normalize(o[0]>0.?vec3(N.xyz):cross(dFdx(P.xyz),dFdy(P.xyz)))))+o[2]),c.a);}c=c*vec4(1.1,1.1,1.1,1);}"),W.gl.compileShader(t),W.gl.attachShader(W.program,t),W.gl.linkProgram(W.program),W.gl.useProgram(W.program),W.gl.clearColor(1,1,1,1),W.clearColor=e=>W.gl.clearColor(...W.col(e)),W.clearColor("fff"),W.gl.enable(2929),W.light({y:-1}),W.camera({fov:30}),setInterval(W.draw,16)},setState:(e,t,r,o,a=[],n,i,l,s,h,c,x,m)=>{e.n||="o"+W.objs++,e.size&&(e.w=e.h=e.d=e.size),e.t&&e.t.width&&!W.textures[e.t.id]&&(r=W.gl.createTexture(),W.gl.pixelStorei(37441,!0),W.gl.bindTexture(3553,r),W.gl.pixelStorei(37440,1),W.gl.texImage2D(3553,0,6408,6408,5121,e.t),W.gl.generateMipmap(3553),W.textures[e.t.id]=r),e.fov&&(W.projection=new DOMMatrix([1/Math.tan(e.fov*Math.PI/180)/(W.canvas.width/W.canvas.height),0,0,0,0,1/Math.tan(e.fov*Math.PI/180),0,0,0,0,-1.001,-1,0,0,-.2,0])),e={type:t,...W.current[e.n]=W.next[e.n]||{w:1,h:1,d:1,x:0,y:0,z:0,rx:0,ry:0,rz:0,b:"888",mode:4,mix:0},...e,f:0},W.models[e.type]?.vt&&!W.models?.[e.type].vtBuffer&&(W.gl.bindBuffer(34962,W.models[e.type].vtBuffer=W.gl.createBuffer()),W.gl.bufferData(34962,new Float32Array(W.models[e.type].vt),35044),!W.models[e.type].normals&&W.smooth&&W.smooth(e),W.models[e.type].normals&&(W.gl.bindBuffer(34962,W.models[e.type].normalsBuffer=W.gl.createBuffer()),W.gl.bufferData(34962,new Float32Array(W.models[e.type].normals.flat()),35044))),W.models[e.type]?.uv&&!W.models[e.type].uvBuffer&&(W.gl.bindBuffer(34962,W.models[e.type].uvBuffer=W.gl.createBuffer()),W.gl.bufferData(34962,new Float32Array(W.models[e.type].uv),35044)),W.models[e.type]?.ic&&!W.models[e.type].icBuffer&&(W.gl.bindBuffer(34963,W.models[e.type].icBuffer=W.gl.createBuffer()),W.gl.bufferData(34963,new Uint16Array(W.models[e.type].ic),35044)),e.t?e.t&&!e.mix&&(e.mix=0):e.mix=1,W.next[e.n]=e,"bbd"!==e.type&&"plane"!==e.type||transparent.push(W.next[e.n])},draw:(e,t,r,o)=>{for(o in W.lastFrame=e,W.next.camera.g&&W.render(W.next[W.next.camera.g],16,1),r=W.animation("camera"),W.next?.camera?.g&&r.preMultiplySelf(W.next[W.next.camera.g].M||W.next[W.next.camera.g].m),W.gl.uniformMatrix4fv(W.gl.getUniformLocation(W.program,"eye"),!1,r.toFloat32Array()),r.invertSelf(),r.preMultiplySelf(W.projection),W.gl.uniformMatrix4fv(W.gl.getUniformLocation(W.program,"pv"),!1,r.toFloat32Array()),W.gl.clear(16640),W.next)"bbd"!=W.next[o].type&&"plane"!=W.next[o].type&&W.render(W.next[o],16);for(o of(frame%60==0&&transparent.sort(((e,t)=>W.dist(t)-W.dist(e))),W.gl.enable(3042),transparent))["plane","bbd"].includes(o.type)&&W.gl.depthMask(0),W.render(o,16),W.gl.depthMask(1);W.gl.disable(3042),W.gl.uniform3f(W.gl.getUniformLocation(W.program,"light"),W.lerp("light","x"),W.lerp("light","y"),W.lerp("light","z"))},render:(e,t,r=["camera","light","group"].includes(e.type),o)=>{e.t&&(W.gl.bindTexture(3553,W.textures[e.t.id]),W.gl.uniform1i(W.gl.getUniformLocation(W.program,"sampler"),0)),e.f<e.a&&(e.f+=t),e.f>=e.a&&e.f<e.a+16&&(e.f=e.a+17,"H"!==e.n&&"pipe"!==e.n||intro()),W.next[e.n].m=W.animation(e.n),W.next[e.g]&&W.next[e.n].m.preMultiplySelf(W.next[e.g].M||W.next[e.g].m),W.gl.uniformMatrix4fv(W.gl.getUniformLocation(W.program,"m"),!1,(W.next[e.n].M||W.next[e.n].m).toFloat32Array()),W.gl.uniformMatrix4fv(W.gl.getUniformLocation(W.program,"im"),!1,new DOMMatrix(W.next[e.n].M||W.next[e.n].m).invertSelf().toFloat32Array()),r||(W.gl.bindBuffer(34962,W.models[e.type].vtBuffer),W.gl.vertexAttribPointer(o=W.gl.getAttribLocation(W.program,"pos"),3,5126,!1,0,0),W.gl.enableVertexAttribArray(o),W.models[e.type].uvBuffer&&(W.gl.bindBuffer(34962,W.models[e.type].uvBuffer),W.gl.vertexAttribPointer(o=W.gl.getAttribLocation(W.program,"uv"),2,5126,!1,0,0),W.gl.enableVertexAttribArray(o)),(e.s||W.models[e.type].customNormals)&&W.models[e.type].normalsBuffer&&(W.gl.bindBuffer(34962,W.models[e.type].normalsBuffer),W.gl.vertexAttribPointer(o=W.gl.getAttribLocation(W.program,"normal"),3,5126,!1,0,0),W.gl.enableVertexAttribArray(o)),W.gl.uniform4f(W.gl.getUniformLocation(W.program,"o"),e.s,(e.mode>3||W.gl[e.mode]>3)&&!e.ns?1:0,W.ambientLight||.2,e.mix),W.gl.uniform4f(W.gl.getUniformLocation(W.program,"bb"),e.w,e.h,"bbd"===e.type,0),W.models[e.type].icBuffer&&W.gl.bindBuffer(34963,W.models[e.type].icBuffer),W.gl.vertexAttrib4fv(W.gl.getAttribLocation(W.program,"col"),W.col(e.b)),W.models[e.type].icBuffer?W.gl.drawElements(+e.mode||W.gl[e.mode],W.models[e.type].ic.length,5123,0):W.gl.drawArrays(+e.mode||W.gl[e.mode],0,W.models[e.type].vt.length/3))},lerp:(e,t)=>W.next[e]?.a?W.current[e][t]+(W.next[e][t]-W.current[e][t])*(W.next[e].f/W.next[e].a):W.next[e][t],animation:(e,t=new DOMMatrix)=>W.next[e]?t.translateSelf(W.lerp(e,"x"),W.lerp(e,"y"),W.lerp(e,"z")).rotateSelf(W.lerp(e,"rx"),W.lerp(e,"ry"),W.lerp(e,"rz")).scaleSelf(W.lerp(e,"w"),W.lerp(e,"h"),W.lerp(e,"d")):t,dist:(e,t=W.next.camera)=>e?.m&&t?.m?(t.m.m41-e.m.m41)**2+(t.m.m42-e.m.m42)**2+(t.m.m43-e.m.m43)**2:0,ambient:e=>W.ambientLight=e,col:e=>[...e.replace("#","").match(e.length<5?/./g:/../g).map((t=>("0x"+t)/(e.length<5?15:255))),1],add:(e,t)=>{W.models[e]=t,t.normals&&(W.models[e].customNormals=1),W[e]=t=>W.setState(t,e)},group:e=>W.setState(e,"group"),move:(e,t)=>setTimeout((()=>{W.setState(e)}),t||1),delete:(e,t)=>setTimeout((()=>{delete W.next[e]}),t||1),camera:(e,t)=>setTimeout((()=>{W.setState(e,e.n="camera")}),t||1),light:(e,t)=>t?setTimeout((()=>{W.setState(e,e.n="light")}),t):W.setState(e,e.n="light")},W.add("plane",{vt:[.5,.5,0,-.5,.5,0,-.5,-.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0],uv:[1,1,0,1,0,0,1,1,0,0,1,0]}),W.add("bbd",W.models.plane),W.add("cube",{vt:[.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5],uv:[1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0]}),W.add("slope",{vt:[.5,.5,-.5,-.5,.5,-.5,-.5,-.5,.5,.5,.5,-.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5],uv:[1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,0,0,1,0,1,0,0,1,1,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0]}),W.add("pyramid",{vt:[-.5,-.5,.5,.5,-.5,.5,0,.5,0,.5,-.5,.5,.5,-.5,-.5,0,.5,0,.5,-.5,-.5,-.5,-.5,-.5,0,.5,0,-.5,-.5,-.5,-.5,-.5,.5,0,.5,0,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5],uv:[0,0,1,0,.5,1,0,0,1,0,.5,1,0,0,1,0,.5,1,0,0,1,0,.5,1,1,1,0,1,0,0,1,1,0,0,1,0]}),((e,t,r,o,a,n,i=[],l=[],s=[],h=15)=>{for(r=0;r<=h;r++)for(o=r*Math.PI/h,e=0;e<=h;e++)t=2*e*Math.PI/h,i.push(+(Math.sin(t)*Math.sin(o)/2).toFixed(6),+(Math.cos(o)/2).toFixed(6),+(Math.cos(t)*Math.sin(o)/2).toFixed(6)),s.push(3.5*Math.sin(e/h),-Math.sin(r/h)),e<h&&r<h&&l.push(a=r*(h+1)+e,a+1,n=a+(h+1),a+1,n+1,n);W.add("sphere",{vt:i,uv:s,ic:l})})(),s=speechSynthesis,V=s.getVoices(),state=0,pxtex=(e,t,r,o,a=10,n=10,i=10,l=e.getContext`2d`,s,h,c=Math.random)=>{for(e.width=n,e.height=i,s=n;s--;)for(h=i;h--;)l.fillStyle=`hsl(${t+(c()-.5)*a},${r+(c()-.5)*a}%,${o+(c()-.5)*a}%)`,l.fillRect(s,h,1,1);return e.toDataURL()},K=[],onkeydown=onkeyup=(e,t="s****lurd************************l**r************l*d***u**u")=>{K[t[e.which-32]]=+!!e.type[5],"keyup"===e.type&&"s"===t[e.which-32]&&(jumpdone=0)},voice=(e,t,r,o=window.orientation>-1?1.2:1.5)=>{s=speechSynthesis,foundvoice=0,V=s.getVoices(),setTimeout(((r,a)=>{for(r in V=s.getVoices().filter((e=>e.lang.startsWith("en"))),V)if(V[r].name.match(t)){(a=new SpeechSynthesisUtterance(e)).voice=V[r],a.rate=o,a.pitch=2,s.speak(a),foundvoice=1;break}if(!foundvoice)for(r in V){(a=new SpeechSynthesisUtterance(e)).voice=V[r],a.rate=o,a.pitch=2,s.speak(a);break}}),r)},t=(e,t)=>(t-e)/t,fx=e=>{var t,r,o,a;for(r=(a=(t=new AudioContext).createBuffer(1,96e3,48e3)).getChannelData(0),i=96e3;i--;)r[i]=e(i);(o=t.createBufferSource()).buffer=a,o.connect(t.destination),o.start()},step=e=>{fx(((e,r,o)=>2*(e>3800?null:(o=t(e,3800),Math.sin(.01*e*Math.sin(.001*e+Math.sin(e/200))+Math.sin(e/200))*o*o/9))))},splash=e=>{fx((e=>{var r=2e5;if(e>r)return null;var o=t(e,r);return(e<6e4?Math.sin(.03*-e*Math.sin(.09*e+Math.sin(e/200))+Math.sin(e/100))/o/(e>3e3?e/2e3:6):0)/3}))},waterjump=e=>{fx((e=>{if(e>11e3)return null;var r=t(e+1e4,11e3);return Math.sin(.03*-e*Math.sin(.09*e+Math.sin(e/200))+Math.sin(e/100))*r/3}))},ssd=e=>{fx((e=>{if(e>11e3)return null;var r=t(e+1e4,11e3);return Math.sin(.03*-e*Math.sin(.09*e+Math.sin(e/200))+Math.sin(e/100))*r/30}))},piano=(e,t=1,r,o,a)=>{var n,i,l,s,h;for(n=(e,t,r,o)=>Math.sin(e/t*6.28*r+o),i=(e,t)=>Math.sin(e/44100*t*6.28+n(e,44100,t,0)**2+.75*n(e,44100,t,.25)+.1*n(e,44100,t,.5)),h=[],l=0;l<44100*t;l++)h[l]=(l<58?l/88.2*i(l,e):(1-(l-88.2)/(44100*(t-.002)))**((.5*Math.log(1e4*e/44100))**2)*i(l,e))*a;r.getChannelData(0).set(h),(s=o.createBufferSource()).buffer=r,s.connect(o.destination),s.start()},tk=[1,,,,,,64,,,,,67,69,67,60,,,,,,65,,,,69,71,69,63,,,,,,67,,,,72,74,72,79,,,77,,72,67,65,76,,,72,,69,65,64,63],track2=[1,,,,,,64,,64,,,,64,64,64,64,65,,65,,,,65,65,65,65,67,,67,,,,67,67,67,67,65,,65,,,,65,65,65,65,64,,64,,,64,64,64,64,65,,65,,,65,65,65,65,65,,65,,,65,65,65,65,66,,66,,,66,66,66,66,67,,67,,,67,67,67,67,67,,67,,,67,67,67,67,65,,65,,,65,65,65,65],po=(e,t)=>{for(var r in e)setTimeout("piano(440*1.06**(tk["+r+"]-68),3,m,A,.30)",+r*+t)},po2=(e,t)=>{for(var r in e)setTimeout("piano(440*1.06**(track2["+r+"]-82),.8,m2,A2,.20)",+r*+t)},music=()=>{A=new AudioContext,A2=new AudioContext,m=A.createBuffer(1,1e6,44100),m2=A2.createBuffer(1,1e6,44100),po2(track2,240),setTimeout((()=>{po(tk,300)}),9200)},frame=0,walkframe=0,walking=0,jumpdone=0,lastjump=99,nthjump=0,G=.11,hero={x:11,y:20,z:-1,ry:0,rcamera:0,vx:0,vy:0,vz:0,grounded:0},map={w:25,h:20,layers:["    ((((((((((((((((((   ((((((((((((   (((,,((($$   (((((((($     $$(((((((((((((($      $(((((($$     $(((($     $(((($     $$(((($$     $$$$$$$$$$$$$$$\t\t$$       $$$$$$$$$$$$$$\t\t$        $$                     $$                     $$         $$$        $$$ $$$$   $Z$       $$$$$$$$  $$$     $$$$$$$$        $$$$$$$         $$$$$                  ","0000((((((((((((((((((   ###(((###((((((###(((##1#####(###(##(###(###1#####(###(####(###(####13#####(((((####(((((####13#########(####(########13##########(##(#########13##########(##(#########13####(##(###13#######################13#####################13#######################13##########13#######13############13#########13############13#########13############13##########3############13##########3###########13##########3############13##########               ##########","####((((((((((((((((((000####(((###((((((###(((#########(###(####(###(###########(##((####(###(###########(((((####(((((###############(####(##############################################################################################################################################################################################################################################################################################################################################222222222222222","####((((((((((((((((((#######(((############(((#########(####((((####(###########(####((((####(###########((((#(((((((((###########\b#\b#((((((\b#\b","####((((((((((((((((((#######(((############(((#########(############(###########(############(###########(((((####(((((###############((((((#####################((","####((((((((((((((((((#######(((############(((#########(############(###########(############(###########(((((####(((((###########\b#\b#((((((\b#\b##################((#######################","#####(((((((((((((((#######################################################################################<<<,####,<<<################<<<<<<#####################9;","###########((((###################################################################<<<,,,,,,<<<################<<<<<<","####|######((((#####|###############(##(#####################((((################|###########|","###########((((#####################(##(#####################((((","###########((((#####################(##(#####################((((######################\b","###########,##,#####################,##,#####################<<<<","############((#######################((","############((#######################((","############((#######################((#######################\b","","","############|"]},bigmap=[],collision=(e,t,r,o,a)=>{var n=Math.floor(t),i=Math.floor(e),l=Math.floor(r);if(o=bigmap[n]?.[l*map.w+i],t<0)return 0;if(o||(n=Math.floor(t),i=Math.floor(e),l=Math.floor(r),o=bigmap[n]?.[l*map.w+i]),!o)return null;if("cube"===o.type)return n+1;if("fence"===o.type)return r-l>.9?n+.8:n-1;if("tree"===o.type)return n+1;if("water"===o.type)return n+.7;if("slope"===o.type){if(0===o.angle)return n+1-(r-l);if(2===o.angle)return n+(r-l);if(3===o.angle)return n+1-(e-i);if(1===o.angle)return n+(e-i)}return null},onload=()=>{setTimeout((()=>{for(grass.src=pxtex(px,105,65,50,10,20,20),sand.src=pxtex(px,45,85,75,10,20,20),roof.src=pxtex(px,10,85,55,10,50,50),water.src=pxtex(px,200,90,35,5,20,20),brick2.src=pxtex(px,75,0,90,10,40,40),px.width=200,px.height=200,ctx=px.getContext("2d"),ctx.font="180px emoji",ctx.fillText("🌳",10,160),treec.src=px.toDataURL(),px.width=200,px.height=200,ctx=px.getContext("2d"),ctx.scale(-1,1),ctx.font="130px emoji",ctx.fillText("🚪",-225,180),door1.src=px.toDataURL(),px.width=200,px.height=200,ctx=px.getContext("2d"),ctx.font="130px emoji",ctx.fillText("🚪",-25,180),door2.src=px.toDataURL(),px.width=100,px.height=100,ctx=px.getContext("2d"),ctx.scale(.8,1),ctx.rotate(Math.PI/4),ctx.font="100px emoji",ctx.fillText("🫓",30,30),pie.src=px.toDataURL(),px.width=200,px.height=200,ctx=px.getContext("2d"),ctx.font="100px emoji",ctx.fillText("🚩",70,190),flag.src=px.toDataURL(),px.width=40,px.height=40,ctx=px.getContext("2d"),ctx.fillStyle="#000",ctx.fillRect(0,0,40,40),ctx.beginPath(),ctx.fillStyle="#04e",ctx.arc(20,20,18,0,7),ctx.fill(),ctx.beginPath(),ctx.fillStyle="#000",ctx.arc(20,20,12,0,7),ctx.fill(),ctx.fillStyle="#355",i=0;i<40;i+=5)ctx.fillRect(0,i,40,2),ctx.fillRect(i,0,2,40);gr.src=px.toDataURL(),px.width=200,px.height=200,ctx=px.getContext("2d"),ctx.fillStyle="#c82",ctx.fillRect(0,80,200,20),ctx.fillRect(0,130,200,20),(n=ctx.createLinearGradient(0,0,100,0)).addColorStop(0,"#940"),n.addColorStop(1,"#eb6"),ctx.fillStyle=n,ctx.fillRect(25,40,50,180);var n=ctx.createLinearGradient(100,0,200,0);ctx.fillStyle=n,n.addColorStop(0,"#940"),n.addColorStop(1,"#eb6"),ctx.fillRect(125,40,50,180),fenc.src=px.toDataURL(),px.width=200,px.height=200,ctx=px.getContext("2d");n=ctx.createLinearGradient(0,0,100,0);ctx.fillStyle=n,n.addColorStop(0,"#b80"),n.addColorStop(1,"#db3"),ctx.fillRect(0,0,100,200);n=ctx.createLinearGradient(100,0,200,0);ctx.fillStyle=n,n.addColorStop(0,"#b80"),n.addColorStop(1,"#db3"),ctx.fillRect(100,0,100,200),wood.src=px.toDataURL(),ctx=px.getContext("2d"),pxtex(px,200,90,35,2,512,512),(n=ctx.createLinearGradient(0,150,0,260)).addColorStop(0,"#08D"),n.addColorStop(1,"#6CF"),ctx.fillStyle=n,ctx.fillRect(0,0,512,250),ctx.font="25px emoji",ctx.fillText("☁️",20,210),ctx.fillText("☁️",140,220),ctx.fillText("☁️",260,200),ctx.fillText("☁️",380,220),ctx.fillText("☁️",460,230),sky.src=px.toDataURL(),ctx=px.getContext("2d"),pxtex(px,75,0,90,10,40,40),ctx.fillStyle="#f2f2f2",ctx.fillRect(0,9,40,1),ctx.fillRect(0,19,40,1),ctx.fillRect(0,29,40,1),ctx.fillRect(0,39,40,1),ctx.fillRect(13,0,1,9),ctx.fillRect(26,0,1,9),ctx.fillRect(39,0,1,9),ctx.fillRect(13,20,1,9),ctx.fillRect(26,20,1,9),ctx.fillRect(39,20,1,9),ctx.fillRect(7,10,1,9),ctx.fillRect(20,10,1,9),ctx.fillRect(33,10,1,9),ctx.fillRect(7,30,1,9),ctx.fillRect(20,30,1,9),ctx.fillRect(33,30,1,9),brick.src=px.toDataURL(),px.width=200,px.height=200,ctx=px.getContext("2d"),ctx.ellipse(100,100,70,90,0,0,7),ctx.clip(),ctx.fillStyle="#008",ctx.strokeStyle="#fb1",ctx.lineWidth=10,ctx.fill(),ctx.stroke(),ctx.font="230px emoji",ctx.scale(.95,1),ctx.fillText("🧎‍♀️",-10,230),ctx.font="30px emoji",ctx.fillText("👑",95,45),ctx.font="60px emoji",ctx.translate(40,120),ctx.rotate(.8),ctx.fillText("💐",0,0),princess.src=px.toDataURL(),load.innerHTML="Start",onclick=()=>{if(0===state){for(c.width=innerWidth,c.height=innerHeight,W.reset(c),W.ambient(.4),W.light({x:-3,y:-10,z:-5}),y=map.layers.length;y--;)for(bigmap[y]=[],x=map.w;x--;)for(z=map.h;z--;)if(bigmap[y][z*map.w+x]={type:null},map.layers[y][z*map.w+x]){if(e=map.layers[y][z*map.w+x]?.codePointAt(0),35===e)continue;1===e?(W.cube({w:1,h:0===x?1:.85,d:1,x:x+.5,y:y+.5,z:z+.5,t:water,ns:1}),bigmap[y][z*map.w+x]={type:"water"}):2===e?(W.bbd({size:1.5,x:x+.4,y:y+.75,z:z+.5,t:treec,ns:1}),bigmap[y][z*map.w+x]={type:"tree"}):3===e?(W.plane({w:1,h:1,x:x+.5,y:y+.5,z:z+1,t:fenc}),W.plane({w:1,h:1,x:x+.5,y:y+.5,z:z+1,t:fenc,ry:180}),bigmap[y][z*map.w+x]={type:"fence"}):4===e?(W.plane({w:2.5,h:2.5,x:x+1,y:y+.25,z:z-.59,t:princess}),bigmap[y][z*map.w+x]={type:"princess"}):6===e?(W.plane({w:2,h:2,x:x,y:y+1,z:z+.1,t:door1}),bigmap[y][z*map.w+x]={type:"door1"}):7===e?(W.plane({w:2,h:2,x:x+1,y:y+1,z:z+.1,t:door2}),bigmap[y][z*map.w+x]={type:"door2"}):8===e?(W.plane({w:1,h:1,x:x+1,y:y,z:z+.01+(y>5&&z<6?.2:0)+(y>2&&z>=6?-.6:0)+(y>10?.2:0)+(y>14?.2:0),t:pie}),bigmap[y][z*map.w+x]={type:"window"}):9===e?(W.cube({w:1,h:1,x:x+.5,y:y+.5,z:z+.5,t:wood}),bigmap[y][z*map.w+x]={type:"wood"}):90===e?(W.cube({w:1,h:1,x:x+.5,y:y+.5,z:z+.5,t:gr}),bigmap[y][z*map.w+x]={type:"grid"}):e>31&&(a=3&e,o=e>>2&3,r=e>>4&7,W[["","","cube","slope","cube","cube","cube","pyramid"][r]]({w:7===r?2.5:1,h:[1,1,x>0&&x<24&&z>0&&z<19&&0===o?1.2:1,1,1,1,1,2][r],d:7===r?2.5:1,x:x+.5+.5*(7===r),y:y+.5+-1.5*(7===r)+.1*(0==x&&z>3&&z<19||24==x&&z>0),z:z+.5+.2*(7===r)+(y>5&&z<6?.2:0)+(y>2&&z>=6?-.6:0)+(y>10?.2:0)+(y>14?.2:0),ry:-90*a,t:[grass,sand,[0,0,brick,brick2][r],roof][o]}),bigmap[y][z*map.w+x]={type:["","","cube","slope","cube","cube","cube","pyramid"][r],angle:a},"pyramid"===bigmap[y][z*map.w+x].type&&y<12&&W.bbd({size:2,x:x+1,y:y+.65,z:z+1,t:flag,ns:1}))}W.group({n:"H",size:1,x:hero.x,y:hero.y,z:hero.z}),W.group({n:"R",g:"H",size:1}),W.group({n:"M",g:"H",y:-9.6}),W.cube({g:"M",n:"pipe",w:1,h:1.5,d:1,b:"090"}),W.cube({g:"pipe",w:1.1,h:.3,d:1.1,y:.5,b:"090"}),W.cube({g:"M",w:.25,h:.1,d:.2,y:.7-.4,b:"c10"}),W.cube({g:"M",w:.28,h:.01,d:.2,y:.25,b:"c10"}),W.cube({g:"M",w:.2,h:.1,d:.2,y:.6-.4,b:"ec6"}),W.cube({n:"a1",g:"M",w:.05,h:.15,d:.1,y:.45-.4,b:"c10",x:-.12,z:.1}),W.cube({n:"a2",g:"M",w:.05,h:.15,d:.1,y:.45-.4,b:"c10",x:.12,z:.1}),W.cube({g:"M",w:.2,h:.2,d:.2,y:0,b:"00F"}),W.cube({n:"l1",g:"M",w:.1,h:.2,d:.1,y:.3-.4,b:"00F",x:-.07,z:-.05}),W.cube({n:"l2",g:"M",w:.1,h:.2,d:.1,y:.3-.4,b:"00F",x:.06,z:-.05}),W.cube({n:"f1",g:"M",w:.1,h:.1,d:.2,y:-.25,b:"810",x:-.07,z:.02}),W.cube({n:"f2",g:"M",w:.1,h:.1,d:.2,y:-.25,b:"810",x:.06,z:.02}),W.camera({g:"H",z:2,y:1.2,rx:20,ry:-90,fov:42}),W.sphere({size:200,t:sky,ns:1}),W.clearColor("8Af"),state=1,content.innerHTML="<center><h1 class=title id=h><span class=r>G<span class=b>R<span class=y>E<span class=b>A<span class=g>T</span> <sup class=r>6 5</sup><div class=b>P<span class=g>L<span class=r>U<span class=y>M<span class=b>B<span class=r>E<span class=g>R</h1>",setTimeout((()=>h.style.transform="scale(2.1)"),100),setTimeout((()=>h.style.transform="scale(1.9)"),300),setTimeout((()=>h.style.transform="scale(2)"),500),fx((e=>{var r=16e3,o=r/7;if(e>r)return null;var a=Math.pow(t(e,r),2.1);return(e<o?e+10*Math.sin(-e/900)&16:13&e)?a:-a})),voice("It's er meee... the great plumber!",male,1e3),setTimeout((()=>{content.innerHTML=""}),3500),setTimeout((()=>{content.innerHTML="<div id=pri><div class=a>🤱</div><div class=b>👑</div></div><div id=letter>Dear plumber:<br>Please come to the castle.<br>I... have a &nbsp;leak.<br>Yours truly --<br>Princess Frogchair<br><div>Pitch",content.style.background="transparent",voice(letter.innerText,female,500),K={u:0,l:0,r:0,d:0,s:0}}),4e3),setTimeout(music,14e3),setTimeout(intro,15e3)}}}),100)},introstep=-1,intro=()=>{introstep++,0===introstep?(pri.style.opacity=letter.style.opacity=0,hero.y=12,hero.z=-.5,hero.x=10,W.move({n:"H",x:hero.x,y:hero.y,z:hero.z,a:5e3}),W.move({n:"camera",y:1.2,rx:0,a:2500})):1===introstep?(hero.x=13,hero.y=4,hero.z=6.5,W.move({n:"H",x:hero.x,y:hero.y,z:hero.z,a:5e3}),W.move({n:"camera",rx:0,ry:0,a:2500})):2===introstep?(hero.x=14,hero.y=4,hero.z=8,W.move({n:"H",x:hero.x,y:hero.y,z:hero.z,a:3e3}),W.move({n:"camera",rx:0,ry:5,a:1500})):3===introstep?(hero.x=26,hero.y=5,hero.z=8,W.move({n:"H",x:hero.x,y:hero.y,z:hero.z,a:5e3}),W.move({n:"camera",rx:-25,ry:80,a:2500})):4===introstep?(hero.x=26,hero.y=4,hero.z=7,W.move({n:"H",x:hero.x,y:hero.y,z:hero.z,a:2e3}),W.move({n:"camera",rx:-25,ry:90,a:1e3})):5===introstep?(hero.x=22,hero.y=3,hero.z=6,W.move({n:"H",x:hero.x,y:hero.y,z:hero.z,a:2e3}),W.move({n:"camera",rx:-15,ry:100,a:1e3})):6===introstep?(hero.x=6,hero.y=5,hero.z=4,W.move({n:"H",x:hero.x,y:hero.y,z:hero.z,a:7e3}),W.move({n:"camera",rx:-10,ry:180,a:3500})):7===introstep?(hero.x=4,hero.y=4,hero.z=15,W.move({n:"H",x:hero.x,y:hero.y,z:hero.z,a:5e3}),W.move({n:"camera",rx:-15,ry:270,a:2500})):8===introstep?(hero.x=8,hero.y=3,hero.z=17,W.move({n:"H",x:hero.x,y:hero.y,z:hero.z,a:5e3}),W.move({n:"camera",rx:-15,ry:340,a:2500})):9===introstep?(hero.x=10,hero.y=1.4,hero.z=16,W.move({n:"H",x:hero.x,y:hero.y,z:hero.z,a:3e3}),W.move({n:"camera",rx:-10,ry:360,a:1500}),W.group({n:"M",y:-3.4,a:1e3}),(window.orientation>-1)&&dpad.classList.remove("uu")):10===introstep?(hero.y=.4,W.move({n:"M",y:.4,a:2e3}),W.move({n:"pipe",y:-.2,a:2e3})):11===introstep?(W.move({n:"pipe",y:-3.4,a:2e3}),hero.y=1.5,W.move({n:"H",x:hero.x,y:hero.y,z:hero.z,a:2e3}),fx((e=>{if(e>3e4)return null;var r=t(e,3e4);return Math.sin(.001*e*Math.sin(.009*e+Math.sin(e/200))+Math.sin(e/100))*r*r}))):12===introstep&&(W.move({n:"pipe",y:-100,size:.01,a:1}),setTimeout((()=>{setInterval((()=>{var e,r,o,a,i,s,h,c,x;frame++,x=hero.y,(K.r||K.l)&&(hero.rcamera+=2*(-K.l+K.r)),W.move({n:"R",rz:hero.rcamera}),W.move({n:"H",x:hero.x,y:hero.y,z:hero.z,ry:hero.ry-hero.rcamera}),o=(collision(hero.x-.15,hero.y,hero.z-.15)||hero.y)+.02,a=(collision(hero.x+.15,hero.y,hero.z-.15)||hero.y)+.02,i=(collision(hero.x-.15,hero.y,hero.z+.15)||hero.y)+.02,s=(collision(hero.x+.15,hero.y,hero.z+.15)||hero.y)+.02,hero.grounded=0,(o||a||i||s)&&(hero.y=Math.max(o,a,i,s)),o=collision(hero.x-.15,hero.y-.2,hero.z-.15),a=collision(hero.x+.15,hero.y-.2,hero.z-.15),i=collision(hero.x-.15,hero.y-.2,hero.z+.15),s=collision(hero.x+.15,hero.y-.2,hero.z+.15),(o>hero.y-.2||a>hero.y-.2||i>hero.y-.2||s>hero.y-.2)&&(hero.grounded=1),o>hero.y&&a>hero.y&&i>hero.y&&s>hero.y&&o<hero.y-.2&&a<hero.y-.2&&i<hero.y-.2&&s<hero.y-.2&&(hero.y+=.1,hero.grounded=1),lastjump++,hero.grounded&&K.s&&!jumpdone&&(lastjump<60&&1===nthjump?(hero.vy+=1.5,voice("hoohoo",male,1)):lastjump<70&&2===nthjump?(hero.vy=1.8,voice("yahoooo",male,1)):(hero.vy+=n?1:1.1,nthjump=0,n?waterjump():voice("woo",male,1)),jumpdone=1,lastjump=0,nthjump++),3===nthjump&&18===lastjump&&W.move({n:"M",rx:-360,a:400}),3===nthjump&&90===lastjump&&W.move({n:"M",rx:0,a:1}),hero.vy-=G,hero.vy<-G&&(hero.vy=-G),hero.y+=hero.vy,collision(hero.x,hero.y+.5,hero.z)>0&&(hero.y-=hero.vy,hero.vy=0),3===nthjump?hero.y>x+.2&&(hero.y=x+.2):hero.y>x+.1&&(hero.y=x+.1),hero.y<1&&(block="water"!=bigmap[Math.floor(hero.y)]?.[Math.floor(hero.z)*map.w+Math.floor(hero.x)].type)&&(hero.y=1,W.move({n:"M",rx:0,a:1})),hero.y<.85&&-70!=W.next.M.rx&&(lastjump>20||1===nthjump)?(W.move({n:"M",z:.1,y:.2,rx:-70,a:200}),nthjump=-1,n=1,splash()):hero.y>.85&&0!=W.next.M.rx&&(lastjump>120||1===nthjump)&&(W.move({n:"M",z:0,y:.4,rx:0,a:200}),n=0),h=hero.x,c=hero.z,K.u||K.d?(walking=1,walkframe++,hero.grounded&&(W.move({n:"a1",z:.1+.02*Math.cos(walkframe/2)}),W.move({n:"a2",z:.1-.02*Math.cos(walkframe/2)}),W.move({n:"l1",z:-.05-.02*Math.cos(walkframe/2)}),W.move({n:"l2",z:.02*Math.cos(walkframe/2)-.05}),W.move({n:"f1",z:.01-.02*Math.cos(walkframe/2)}),W.move({n:"f2",z:.01+.02*Math.cos(walkframe/2)}),walkframe%10==0&&(n?ssd():step())),r=(-K.u+K.d)*Math.cos(-hero.rcamera*Math.PI/180)/(n?40:20),e=(-K.u+K.d)*Math.sin(-hero.rcamera*Math.PI/180)/(n?40:20),hero.x+=e,o=collision(hero.x-.15,hero.y,hero.z-.15),a=collision(hero.x+.15,hero.y,hero.z-.15),i=collision(hero.x-.15,hero.y,hero.z+.15),s=collision(hero.x+.15,hero.y,hero.z+.15),nw2=collision(hero.x-.15,hero.y+.5,hero.z-.15),ne2=collision(hero.x+.15,hero.y+.5,hero.z-.15),sw2=collision(hero.x-.15,hero.y+.5,hero.z+.15),se2=collision(hero.x+.15,hero.y+.5,hero.z+.15),(o>hero.y+.2||a>hero.y+.2||i>hero.y+.2||s>hero.y+.2||nw2>hero.y+.5||ne2>hero.y+.5||sw2>hero.y+.5||se2>hero.y+.5)&&(hero.x=h),hero.z+=r,o=collision(hero.x-.15,hero.y,hero.z-.15),a=collision(hero.x+.15,hero.y,hero.z-.15),i=collision(hero.x-.15,hero.y,hero.z+.15),s=collision(hero.x+.15,hero.y,hero.z+.15),nw2=collision(hero.x-.15,hero.y+.5,hero.z-.15),ne2=collision(hero.x+.15,hero.y+.5,hero.z-.15),sw2=collision(hero.x-.15,hero.y+.5,hero.z+.15),se2=collision(hero.x+.15,hero.y+.5,hero.z+.15),(o>hero.y+.2||a>hero.y+.2||i>hero.y+.2||s>hero.y+.2||nw2>hero.y+.5||ne2>hero.y+.5||sw2>hero.y+.5||se2>hero.y+.5)&&(hero.z=c)):(walking=0,walkframe=0),hero.x<0&&(hero.x=0),hero.x>25&&(hero.x=25),hero.z<0&&(hero.z=0),hero.z>20&&(hero.z=20),!hero.grounded&&lastjump<50?W.move({n:"a2",y:.2,rz:180,a:200},50):W.move({n:"a2",y:.05,rz:0,a:0}),!l&&hero.x>=12&&hero.x<=14&&hero.z<3&&(l=1,content.innerHTML="",content.style.background="#000",fx((e=>{if(e>3e4)return null;var r=t(e,3e4);return Math.sin(.001*e*Math.sin(.009*e+Math.sin(e/200))+Math.sin(e/100))*r*r})),setTimeout((()=>{content.innerHTML="<div id=toad>🍄</div><div id=eyes>👀</div><div id=mouth>👅</div><div id=letter class=large>Hello plumber, I am a speaking mushroom NPC...<br>I'm afraid you can't go further in this demo because we reached 13kb and we have strikanintendokaphobia, the fear of being striked by Nintendo! The princess is in another entry...",A3=new AudioContext,m3=A3.createBuffer(1,1e6,44100),track3=[1,,,67,,69,,67,,66,67,72,76,,,,65,,67,,65,,64,65,71,74,,,,64,,65,,64,,63,64,69,72,,,,72,74,76,74,72,69,66,,64,63,62,60,57,54,50,,,,,67,,69,,67,,66,67,72,76,,,,65,,67,,65,,64,65,71,74,,,,64,,65,,64,,63,64,69,72,,,,69,71,72,74,72,74,69,,71,69,71,72,,72,,,72,72,72,,55,54,55,52,55,60,64,,60,59,60,59,57,57,57,,57,56,57,53,57,64,65,,64,62,65,60,59,59,59,,59,58,59,55,59,64,67,,65,64,67,65,64,64,64,,62,60,64,62,60,62,57,,62,60,64,62,60,62,57,,62,60,64,62,60,62,55,,55,60,67,67,65,65,64,64,62,57,59,52,55,60,64,,60,59,60,59,57,57,57,,57,56,57,53,57,64,65,,64,62,65,60,59,59,59,,59,58,59,55,59,64,67,,65,64,67,65,64,64,64,,62,60,64,62,60,62,57,,62,60,64,62,60,62,57,,59,57,59,60,,60,,,60,60,60],po3=(e,t)=>{for(var r in e)setTimeout("piano(440*1.06**(track3["+r+"]-82),1.5,m3,A3,.20)",+r*+t)},voice(letter.innerText,female,100,window.orientation>-1?.5:3),setTimeout((()=>{po3(track3,300)}),10500)}),1e3))}),16)}),10))}</script>