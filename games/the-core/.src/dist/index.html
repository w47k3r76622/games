<html>
    <body style="background-color:black;">
    <div class="wrapper" style="border:1px solid white;width:768px;height:768px;position:fixed;top:calc(50% - 384px);left:calc(50% - 384px);padding:0;cursor:none">
        <canvas id="canvas"></canvas>
    </div>
    <script type="text/javascript">!function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=15)}([function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return l});var r=n(25),o=n(26),a=n(27),s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u={},c=window.location.href.replace("index.html","")+"src/res/",l=function(){function t(e,n){i(this,t),u[e]=this,this.name=e,this.path=n,this.width=SPRITE_SIZE,this.height=SPRITE_SIZE,this.sheet=new a.a(o.a.loadImage(this.path)),this.anim={}}return s(t,[{key:"addAnimation",value:function(t,e){this.anim[t]=e}}],[{key:"getAssets",value:function(t){return u[t]}}]),t}(),f=function(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=[],o=[],a=0!=n,s=function(t,e){return h.sheet.crop(SPRITE_SIZE*e,SPRITE_SIZE*t,SPRITE_SIZE,SPRITE_SIZE)},u=0;u<2;u++)i.push({frame:s(e,u)}),a&&o.push({frame:s(n,u)});h.addAnimation(t+"right",new r.a(i)),h.addAnimation(t+"left",new r.a(o))},h=new l("all",c+"all.png");f("p",0,1),f("g",2,3),f("w",4),f("p_key",5),f("g_key",6),f("y_key",7),f("b_key",8),f("p_m",9),f("g_m",10),f("y_m",11),f("b_m",12),f("s",13),f("prop1",14,15),f("prop2",16,17),f("ma",18),f("desk",19),f("grass",20)},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}n.d(e,"a",function(){return u});var a=n(9),s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=function(t){function e(t,n,o){i(this,e);var a=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,o));return a.assets={},a.b.x=0,a.b.y=0,a.b.s=TILE_SIZE,a}return o(e,t),s(e,[{key:"tick",value:function(){}},{key:"render",value:function(t){t.myDrawImage(this.assets[this.myFrame()](),this.x,this.y,TILE_SIZE,TILE_SIZE)}},{key:"myFrame",value:function(){return this.pacified?"getStillFrame":"getCurrentFrame"}}]),e}(a.a)},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}n.d(e,"a",function(){return l});var a=n(0),s=n(9),u=n(4),c=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=function(t){function e(t,n,o){i(this,e);var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,o,TILE_SIZE,TILE_SIZE));return s.xMove=0,s.yMove=0,s.type="g",s.handler=t,s.a=a.a.getAssets("all"),s.lastAnim=s.type+"right",s.state=1,s.setBox(),s.dirs={1:{mod:-4,y:11*TILE_SIZE},2:{mod:1,x:.5*TILE_SIZE},3:{mod:4,y:.5*TILE_SIZE},4:{mod:-1,x:11*TILE_SIZE}},s}return o(e,t),c(e,[{key:"setBox",value:function(){this.b.x=16,this.b.y=32,this.b.s=32}},{key:"tick",value:function(){}},{key:"move",value:function(){if(this.moveThrough)return this.moveX(),void this.moveY();var t=this.isOffScreen();if(t&&"p"==this.type)try{this.handler.getWorld().changeRooms(t)}catch(t){this.x=576,this.y=128}else t&&"g"==this.type&&(this.offScreen=!0,this.changeDirection()),(Math.abs(this.xMove)>0||Math.abs(this.yMove)>0)&&(this.handler.getWorld().getSpatialGrid().remove(new u.a(this.x+this.b.x,this.y+this.b.y,this.b.s,this.b.s),this),this.checkEntityCollisions(this.xMove,0)||this.moveX(),this.checkEntityCollisions(0,this.yMove)||this.moveY(),this.handler.getWorld().getSpatialGrid().insert(new u.a(this.x+this.b.x,this.y+this.b.y,this.b.s,this.b.s),this))}},{key:"moveX",value:function(){var t=this.xMove>0?parseInt((this.x+this.xMove+this.b.x+this.b.s)/TILE_SIZE):parseInt((this.x+this.xMove+this.b.x)/TILE_SIZE),e=parseInt((this.y+this.b.y)/TILE_SIZE),n=parseInt((this.y+this.b.y+this.b.s)/TILE_SIZE),i=this.xMove>0?t*TILE_SIZE-this.b.x-this.b.s-1:t*TILE_SIZE+TILE_SIZE-this.b.x;if(this.moveThrough)return void(this.x+=this.xMove);this.collisionWithTile(t,e)||this.collisionWithTile(t,n)?("g"==this.type&&this.changeDirection(),this.x=i):this.x+=this.xMove}},{key:"moveY",value:function(){var t=this.yMove>0?parseInt((this.y+this.yMove+this.b.y+this.b.s)/TILE_SIZE):parseInt((this.y+this.yMove+this.b.y)/TILE_SIZE),e=parseInt((this.x+this.b.x)/TILE_SIZE),n=parseInt((this.x+this.b.x+this.b.s)/TILE_SIZE),i=this.yMove>0?t*TILE_SIZE-this.b.y-this.b.s-1:t*TILE_SIZE+TILE_SIZE-this.b.y;if(this.moveThrough)return void(this.y+=this.yMove);this.collisionWithTile(e,t)||this.collisionWithTile(n,t)?("g"==this.type&&this.changeDirection(),this.y=i):this.y+=this.yMove}},{key:"collisionWithTile",value:function(t,e){try{return this.handler.getWorld().getTile(t,e).isSolid}catch(t){}}},{key:"isOffScreen",value:function(){var t=TILE_SIZE;return this.y+t<0?this.dirs[1]:this.x>GAME_SIZE?this.dirs[2]:this.y>GAME_SIZE?this.dirs[3]:this.x+t<0?this.dirs[4]:0}},{key:"frame",value:function(t){return this.lastAnim=this.xMove<0?t+"left":t+"right",this.a.anim[this.lastAnim].getCurrentFrame()}},{key:"speak",value:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Worker: ")+rndIndex(["You did it!","Noice!"])}}]),e}(s.a)},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return o});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(){function t(e,n){i(this,t),this.anim=!1,this.isSolid=!1,this.texture=n,this.id=e}return r(t,[{key:"render",value:function(t,e,n,i){var r=this.anim?this.texture.getCurrentFrame():this.texture;t.myDrawImage(r,e,n,i)}},{key:"getId",value:function(){return this.id}}]),t}()},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return o});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(){function t(e,n,r,o){i(this,t),this.x=e,this.y=n,this.width=r,this.height=o}return r(t,[{key:"intersects",value:function(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y}}]),t}()},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}n.d(e,"a",function(){return c});var a=(n(6),n(40)),s=n(41),u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=function(t){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new s.a(t);return i(this,e),r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n))}return o(e,t),u(e,[{key:"tick",value:function(t){this.world.tick(t)}},{key:"render",value:function(t){this.world.render(t)}}]),e}(a.a)},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return o});var r=(n(7),function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}()),o=function(){function t(e,n){i(this,t),this.handler=e,this.world=n}return r(t,[{key:"tick",value:function(t){this.world.tick(t)}},{key:"render",value:function(t){this.world.render(t)}}]),t}()},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return d});var r=n(8),o=n(10),a=n(11),s=n(12),u=n(32),c=n(39),l=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),f=0,h=-1,y=!1,p=!1,d=function(){function t(e){i(this,t),this.handler=e,this.entityManager=new r.a(e,new o.a(e,4,6)),this.spatialGrid=new a.a(GAME_SIZE,GAME_SIZE,TILE_SIZE),this.playerDied=!1,this.machineFilled=!1,this.start=rndIndex([5,6,9,10]),this.rooms=Object(u.a)(e,this.start),this.room=this.rooms[this.start],this.sm=this.handler.getSoundManager(),e.setWorld(this),this.loadWorld()}return l(t,[{key:"tick",value:function(t){this.room.tick(),this.machineFilled||this.entityManager.tick(t)}},{key:"render",value:function(t){if(this.room.render(t),this.entityManager.render(t),this.playerDied&&(f+=3.5,t.fillStyle="black",t.fillRect(0,0,f,GAME_SIZE),t.fillRect(GAME_SIZE-f,0,GAME_SIZE,GAME_SIZE)),this.machineFilled){if(h>=1){if(this.machineFilled=!1,this.entityManager.pacifyAll(),ANIMATION_TIMER.stop=!1,ANIMATION_TIMER.keyAdded(),ANIMATION_TIMER.speed=460,!y){this.createFinalExit();var e=this.entityManager.findEntitiesByType("w")[0],n=["Worker: Such a loud explosion!","Sounds like the exit to the outside is open!","Let's get out of this place!"];this.entityManager.addSpeech(e,n)}return}p||(this.sm.play("boom"),p=!0),h+=.006,t.shakeScreen(),t.fillStyle="white",t.globalAlpha=h>0?h:0,t.fillRect(0,0,GAME_SIZE,GAME_SIZE),t.globalAlpha=1}}},{key:"startAgain",value:function(){f=0;var t=this.entityManager.getPlayer();this.playerDied=!1,this.machineFilled=!1,t.setBox(),t.item&&t.item.type&&(this.room.removeEntity(t.item),t.item.target=null,this.rooms[t.item.start.room].addEntity(t.item),t.item.resetMe(),t.item=null),this.changeRooms(null,this.start,!0),this.loadWorld(),t.state=1}},{key:"createFinalExit",value:function(){var t=rndIndex([0,3,12,15]),e=this.rooms[t],n=5*TILE_SIZE,i=0==t||3==t?0:GAME_SIZE-TILE_SIZE;e.tileSet[11][5]=e.tileSet[11][6]=0,e.tileSet[0][5]=e.tileSet[0][6]=0,e.addEntity(new c.a(this.handler,n/TILE_SIZE,i/TILE_SIZE)),e.addEntity(new c.a(this.handler,(n+TILE_SIZE)/TILE_SIZE,i/TILE_SIZE)),y=!0}},{key:"setPlayerSpawn",value:function(t){var e=this.entityManager.getPlayer();e.x=t.x||e.x,e.y=t.y||e.y}},{key:"changeRooms",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.changeRoom=!0;var i=this.room;this.room=e?this.rooms[e]:this.rooms[this.room.id+t.mod],t&&this.setPlayerSpawn(t),this.loadWorld(i,n),this.changeRoom=!1}},{key:"loadWorld",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.spatialGrid.reset(),this.entityManager.newRoom(t,this.room,e)}},{key:"getTile",value:function(t,e){return s.a.getTiles()[this.room.tiles()[e][t]]}},{key:"getEntityManager",value:function(){return this.entityManager}},{key:"getSpatialGrid",value:function(){return this.spatialGrid}}]),t}()},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return f});var r=n(4),o=n(24),a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=void 0,u=void 0,c=void 0,l=void 0,f=function(){function t(e,n){i(this,t),s=e,u=n,l={x:u.x,y:u.y},c=new Array(u)}return a(t,[{key:"tick",value:function(t){for(var e=0;e<c.length;e++)c[e].tick(t)}},{key:"render",value:function(t){for(var e=0;e<c.length;e++)c[e].render(t)}},{key:"getPlayer",value:function(){return u}},{key:"getHandler",value:function(){return s}},{key:"getEntities",value:function(){return c}},{key:"findEntitiesByType",value:function(t){return c.filter(function(e){return e.type==t})}},{key:"addEntity",value:function(t){c.push(t),s.getWorld().getSpatialGrid().insert(new r.a(t.x+t.b.x,t.y+t.b.y,t.b.s,t.b.s),t)}},{key:"newRoom",value:function(t,e){var n=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];c=[],i&&this.respawn(),this.addEntity(u),u.item&&null!=t&&"siren"!=u.item.type&&(t.removeEntity(u.item),e.addEntity(u.item)),e.entities.forEach(function(t){n.addEntity(t),"g"===t.type&&t.resetPos()})}},{key:"removeEntity",value:function(t){var e=c.indexOf(t);s.getWorld().getSpatialGrid().remove(new r.a(t.x+t.b.x,t.y+t.b.y,t.b.s,t.b.s),t),c.splice(e,1)}},{key:"removeEntitiesByType",value:function(t){c=c.filter(function(e){return e.type===t?(s.getWorld().getSpatialGrid().remove(new r.a(e.x+e.b.x,e.y+e.b.y,e.b.s,e.b.s),e),!1):e})}},{key:"pacifyAll",value:function(){var t=s.getWorld().rooms,e=Object.keys(t);u.pacified=!0;for(var n=0;n<e.length;n++)for(var i=0;i<t[n].entities.length;i++){var r=t[n].entities[i];r.pacified=!0,"g"==r.type&&(r.speed=40)}}},{key:"addSpeech",value:function(t,e){this.addEntity(new o.a(s,t,e))}},{key:"respawn",value:function(){u.x=l.x,u.y=l.y}}]),t}()},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return a});var r=n(4),o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=function(){function t(e,n,o){i(this,t),this.x=n*TILE_SIZE,this.y=o*TILE_SIZE,this.handler=e,this.b=new r.a(0,0,TILE_SIZE,TILE_SIZE),this.pacified=!1}return o(t,[{key:"getX",value:function(){return this.x}},{key:"getY",value:function(){return this.y}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getCollisionBounds",value:function(t,e){return new r.a(parseInt(this.x+this.b.x+t),parseInt(this.y+this.b.y+e),this.b.s,this.b.s)}},{key:"checkEntityCollisions",value:function(t,e){for(var n=this.handler.getWorld().getSpatialGrid().retrieve(new r.a(this.x+this.b.x,this.y+this.b.y,this.b.s,this.b.s),this),i=0;i<n.length;i++){var o=n[i];if(o.getCollisionBounds(0,0).intersects(this.getCollisionBounds(t,e)))return this.checkForCollisionEvents(this,o),!0}return!1}},{key:"checkForCollisionEvents",value:function(t,e){t.pacified||e.pacified?this.endingEvents(t,e):this.gameEvents(t,e)}},{key:"gameEvents",value:function(t,e){var n=this.handler,i=n.getWorld(),r="p"===t.type?t:e;if(this.checkCollidingTypes(t,e,"p","g")){r.state=2,r.b={x:0,y:0,s:0},i.playerDied=!0;("g"==t.type?t:e).state=3}if(this.checkCollidingTypes(t,e,"p","key")){var o="key"===t.type?t:e;if(r.item||o.locked)return;o.prop||n.getSoundManager().play("pickup"),r.setItem(o),o.setTarget(r)}if(this.checkCollidingTypes(t,e,"p","m")){if(!r.item)return;var a="m"===t.type?t:e,s=r.item;n.getSoundManager().play("place"),s.setTarget(a),s.locked=!0,a.addKey(s),r.dropItem(s)}}},{key:"endingEvents",value:function(t,e){var n=this.handler.getWorld().getEntityManager();if(this.checkCollidingTypes(t,e,"p","g")){var i="g"==t.type?t:e;if(!!n.findEntitiesByType("speech").find(function(t){return t.entity==i}))return;var r="p"==t.type?t:e,o=["Guard: Thank you for saving us!"];r.item&&"siren"==r.item.type||(o.push("Please take this siren hat!"),r.setItem({type:"siren"})),n.addSpeech(i,o)}if(this.checkCollidingTypes(t,e,"p","w")){var a="w"==t.type?t:e;if(!!n.findEntitiesByType("speech").find(function(t){return t.entity==a}))return;var s=[a.getRndSpeech()];n.addSpeech(a,s)}if(this.checkCollidingTypes(t,e,"p","exit")){var u="p"===t.type?t:e;this.handler.getWorld().changeRooms(null,16),u.x=2*TILE_SIZE,u.y=2*TILE_SIZE}}},{key:"checkCollidingTypes",value:function(t,e,n,i){return t.type===n&&e.type===i||t.type===i&&e.type===n}}]),t}()},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}n.d(e,"a",function(){return f});var a=n(2),s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},c=0,l=0,f=function(t){function e(t,n,o){i(this,e);var a=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,o));return a.item=null,a.lastAnim="pright",a.type="p",a.speed=200,a.moveThrough=!1,a.state=1,a.sm=a.handler.getSoundManager(),a}return o(e,t),s(e,[{key:"tick",value:function(t){switch(u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"tick",this).call(this,t),this.state){case 1:this.xMove=this.yMove=0,this.getInput(t),this.move();break;case 2:this.xMove=this.yMove=0,c++>120&&(c=0,this.handler.getWorld().startAgain())}}},{key:"render",value:function(t){switch(this.state){case 1:t.myDrawImage(this.frame("p"),this.x,this.y,TILE_SIZE,TILE_SIZE),this.item&&"siren"==this.item.type&&(t.myDrawImage(this.a.anim.sright.getCurrentFrame(),this.x,this.y-16,TILE_SIZE,TILE_SIZE),l++>20&&(this.sm.play("siren"),l=0));break;case 2:t.globalAlpha=1,t.myDrawImage(this.frame("p"),this.x,this.y,TILE_SIZE,TILE_SIZE),t.globalAlpha=1}}},{key:"setItem",value:function(t){this.item=t}},{key:"dropItem",value:function(){this.item=null}},{key:"getInput",value:function(t){var e=this.handler.getKeyManager();(e.up||e.w||e.z)&&(this.yMove=-this.speed*t),(e.down||e.s)&&(this.yMove=this.speed*t),(e.left||e.a||e.q)&&(this.xMove=-this.speed*t),(e.right||e.d)&&(this.xMove=this.speed*t)}}]),e}(a.a)},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return o});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(){function t(e,n,r){i(this,t),this.width=parseInt(e/r),this.height=parseInt(n/r),this.size=r,this.grid=[];for(var o=0;o<=this.width;o++){this.grid[o]=[];for(var a=0;a<=this.height;a++)this.grid[o][a]=[]}}return r(t,[{key:"insert",value:function(t,e){for(var n=Math.max(0,parseInt(t.x/this.size)),i=Math.max(0,parseInt(t.y/this.size)),r=Math.min(this.width,parseInt((t.x+t.width)/this.size)),o=Math.min(this.height,parseInt((t.y+t.height)/this.size)),a=i;a<=o;a++)for(var s=n;s<=r;s++)-1===this.grid[s][a].indexOf(e)&&this.grid[s][a].push(e)}},{key:"retrieve",value:function(t,e){for(var n=Math.max(0,parseInt(t.x/this.size)),i=Math.max(0,parseInt(t.y/this.size)),r=Math.min(this.width,parseInt((t.x+t.width)/this.size)),o=Math.min(this.height,parseInt((t.y+t.height)/this.size)),a=[],s=i;s<=o;s++)for(var u=n;u<=r;u++)this.grid[u][s].forEach(function(t){t!==e&&-1===a.indexOf(t)&&a.push(t)});return a}},{key:"remove",value:function(t,e){for(var n=Math.max(0,parseInt(t.x/this.size)),i=Math.max(0,parseInt(t.y/this.size)),r=Math.min(this.width,parseInt((t.x+t.width)/this.size)),o=Math.min(this.height,parseInt((t.y+t.height)/this.size)),a=i;a<=o;a++)for(var s=n;s<=r;s++)for(var u=0;u<this.grid[s][a].length;u++)this.grid[s][a][u]===e&&this.grid[s][a].splice(u,1)}},{key:"reset",value:function(){for(var t=0;t<=this.width;t++){this.grid[t]=[];for(var e=0;e<=this.height;e++)this.grid[t][e]=[]}}},{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getSize",value:function(){return this.size}}]),t}()},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return l});var r=n(28),o=n(29),a=n(30),s=n(31),u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=[];c[0]=new r.a(0),c[1]=new o.a(1),c[2]=new a.a(2),c[3]=new s.a(3);var l=function(){function t(){i(this,t)}return u(t,null,[{key:"getAssets",value:function(){return assets}},{key:"getTiles",value:function(){return c}}]),t}()},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return a});var r=n(12),o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:TILE_SIZE,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:TILE_COUNT,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{p:0,w:1};i(this,t),this.id=e,this.tileSet=[],this.items=[],this.traits=n,this.entities=r,this.tileSize=o,this.tileCount=a,this.text=null,this.init(s),this.apply(n)}return o(t,[{key:"addEntity",value:function(t){this.entities.push(t)}},{key:"removeEntity",value:function(t){var e=this.entities.indexOf(t);this.entities.splice(e,1)}},{key:"init",value:function(t){var e=t.p,n=t.w;this.tileSet=[[n,n,n,n,n,e,e,n,n,n,n,n],[n,e,e,e,e,e,e,e,e,e,e,n],[n,e,e,e,e,e,e,e,e,e,e,n],[n,e,e,e,e,e,e,e,e,e,e,n],[n,e,e,e,e,e,e,e,e,e,e,n],[e,e,e,e,e,e,e,e,e,e,e,e],[e,e,e,e,e,e,e,e,e,e,e,e],[n,e,e,e,e,e,e,e,e,e,e,n],[n,e,e,e,e,e,e,e,e,e,e,n],[n,e,e,e,e,e,e,e,e,e,e,n],[n,e,e,e,e,e,e,e,e,e,e,n],[n,n,n,n,n,e,e,n,n,n,n,n]]}},{key:"apply",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=0;e<t.length;e++)this.tileSet=t[e](this.tileSet)}},{key:"tiles",value:function(){return this.tileSet}},{key:"tick",value:function(){}},{key:"render",value:function(t){for(var e=this.tileCount,n=this.tileSize,i=0;i<e;i++)for(var o=0;o<e;o++)r.a.getTiles()[this.tileSet[i][o]].render(t,o*n,i*n,n);this.text&&(t.fillStyle="white",t.fillRect(220,80,340,100),t.fillStyle="black",t.fillRect(230,90,320,80),t.drawText(this.text,240,150,"white","64"))}}]),t}()},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=n(1),s=n(0),u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=function(t){function e(t,n,o,a){var u=arguments.length>4&&void 0!==arguments[4]&&arguments[4];i(this,e);var c=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,o));return c.start={x:c.x,y:c.y},c.type="key",c.target=null,c.color=a,c.locked=!1,c.assets=s.a.getAssets("all").anim[c.color+"_"+c.type+"right"],c.prop=u,c.moveR=!0,c.moveL=!1,c.moveCnt=0,c.typePos={p:{x:4,y:-64},m:{p:{},g:{x:64},y:{x:64,y:64},b:{y:64}}},c}return o(e,t),u(e,[{key:"tick",value:function(){var t=this.target?this.target.type:this.target,e=this.typePos;t?(this.x=this.target.x+this.xOffset(t,e),this.y=this.target.y+this.yOffset(t,e)):(this.moveR&&this.moveCnt++,this.moveL&&this.moveCnt--,this.moveCnt>5&&(this.moveR=!1,this.moveL=!0),this.moveCnt<-5&&(this.moveR=!0,this.moveL=!1),this.moveCnt%2==0&&(this.y+=this.moveCnt))}},{key:"xOffset",value:function(t,e){return{p:e.p.x,m:e.m[this.color].x||0}[t]}},{key:"yOffset",value:function(t,e){return{p:e.p.y,m:e.m[this.color].y||0}[t]}},{key:"setTarget",value:function(t){this.target=t,this.b={x:0,y:0,s:0}}},{key:"resetMe",value:function(){this.x=this.start.x,this.y=this.start.y,this.b.x=0,this.b.y=0,this.b.s=TILE_SIZE}}]),e}(a.a);e.a=c},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});n(16),n(18)},function(t,e,n){"use strict";var i=n(17);window.GAME_SIZE=768,window.SPRITE_SIZE=8,window.ANIMATION_TIMER=new i.a,window.TILE_SIZE=64,window.TILE_COUNT=12,window.rndIndex=function(t){return t[Math.floor(Math.random()*t.length)]},window.rndInt=function(t,e){return Math.floor(Math.random()*(e-t+1))+t}},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return s});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=0,a=null,s=function(){function t(){i(this,t),this.frames=2,this.index=0,this.lastTime=Date.now(),this.timer=0,this.speed=240,this.keys=0,this.stop=!1,this.beats={1:[],2:[{name:"steamLow",condition:function(t){return!0}},{name:"bassC",condition:function(t){return t<=3}},{name:"endBassC",condition:function(t){return t>4}}],3:[{name:"arpFsG",condition:function(t){return 0==t}}],4:[{name:"bassDs",condition:function(t){return t<=1}},{name:"stabFACD",condition:function(t){return t>4}}],5:[{name:"arpAsC",condition:function(t){return 0==t}}],6:[{name:"steamHigh",condition:function(){return!0}},{name:"bassDs",condition:function(t){return t>1&&t<3}},{name:"bassFs",condition:function(t){return t<=1}},{name:"endBassF",condition:function(t){return t>4}}],7:[],8:[{name:"bassDs",condition:function(t){return t<=2}}]}}return r(t,[{key:"init",value:function(t){this.sounds=t.getSoundManager()}},{key:"tick",value:function(){this.stop||(a&&(a=this.handler.getMachine()),this.timer+=Date.now()-this.lastTime,this.lastTime=Date.now(),this.timer>=this.speed&&(this.sounds&&this.factoryNoise(),this.index++,this.timer=0,this.index>=this.frames&&(this.index=0)))}},{key:"factoryNoise",value:function(){o++,this.playAll(this.beats[o]),8==o&&(o=0)}},{key:"playAll",value:function(t){for(var e=this.sounds,n=this.keys,i=0;i<t.length;i++)t[i].condition(n)&&(e.load(t[i].name),e.play(t[i].name))}},{key:"keyAdded",value:function(){this.keys++,this.speed+=20}}]),t}()},function(t,e,n){"use strict";(new(n(19).a)).run()},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return d});var r=n(20),o=n(21),a=n(22),s=n(23),u=(n(5),n(42)),c=n(43),l=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),f=void 0,h=void 0,y=void 0,p=void 0,d=function(){function t(){i(this,t)}return l(t,[{key:"run",value:function(){var t=this;this.init();var e=0,n=0,i=Date.now(),r=Date.now(),o=0;!function a(){i=Date.now(),e=i-r,o+=e,r=i,o>=1e3/60&&(n=o/1e3,t.tick(n),t.render(),o=0),window.requestAnimationFrame(a)}()}},{key:"getKeyManager",value:function(){return y}},{key:"getDisplay",value:function(){return f}},{key:"getGameState",value:function(){return p}},{key:"init",value:function(){var t=new o.a(this);f=new r.a,y=new a.a,h=f.getGraphics(),p=new u.a;var e=new c.a;t.setSoundManager(e);var n=new s.a(t,y);p.setState(n)}},{key:"tick",value:function(t){y.tick(),ANIMATION_TIMER.tick(),p.getState().tick(t)}},{key:"render",value:function(){h.clearRect(0,0,GAME_SIZE,GAME_SIZE),p.getState().render(h)}}]),t}()},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return u});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=void 0,a=void 0,s=CanvasRenderingContext2D.prototype,u=function(){function t(){i(this,t),a=document.getElementById("canvas"),a.setAttribute("height",GAME_SIZE),a.setAttribute("width",GAME_SIZE),o=a.getContext("2d"),o.webkitImageSmoothingEnabled=!1,o.imageSmoothingEnabled=!1}return r(t,[{key:"getGraphics",value:function(){return o}}]),t}();s.myDrawImage=function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:TILE_SIZE;o.drawImage(t.sheet,t.x,t.y,t.width,t.height,e,n,i,i)},s.drawText=function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"white",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"28";o.font=r+"px Arial",o.fillStyle=i,o.fillText(t,e,n)},s.shakeScreen=function(){var t=rndInt(-15,15),e=rndInt(-15,15);try{var n=o.getImageData(0,0,GAME_SIZE,GAME_SIZE);o.putImageData(n,t,e)}catch(t){}}},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return a});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=void 0,a=function(){function t(e){i(this,t),this.game=e,this.machine=null}return r(t,[{key:"getWidth",value:function(){return this.game.getWidth()}},{key:"getHeight",value:function(){return this.game.getHeight()}},{key:"getKeyManager",value:function(){return this.game.getKeyManager()}},{key:"getMachine",value:function(){return this.machine}},{key:"getWorld",value:function(){return this.world}},{key:"setWorld",value:function(t){this.world=t}},{key:"getGame",value:function(){return this.game}},{key:"getSoundManager",value:function(){return o}},{key:"setSoundManager",value:function(t){o=t}}]),t}()},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return a});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=[],a=function(){function t(){i(this,t)}return r(t,[{key:"tick",value:function(){this.a=o[65],this.w=o[87],this.s=o[83],this.d=o[68],this.z=o[90],this.q=o[81]}}]),t}();window.onkeydown=function(t){o[t.keyCode]=!0},window.onkeyup=function(t){o[t.keyCode]=!1}},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return s});var r=n(5),o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=200,s=function(){function t(e,n){i(this,t),this.km=n,this.h=e}return o(t,[{key:"tick",value:function(){this.km.w&&(ANIMATION_TIMER.init(this.h),this.h.getGame().getGameState().setState(new r.a(this.h)))}},{key:"render",value:function(t){var e=0;["Find the four keys!","Use them on the machine!","Press [w] to resist!"].forEach(function(n){t.drawText(n,100,100+90*e),e++}),t.fillStyle="black";var n=.25;for(a-=2,e=0;e<22;e++)e%2&&(n+=.25),t.globalAlpha=n,t.fillRect(0,50*e-a,768,100)}}]),t}()},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=n(1),s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=0,c=function(t){function e(t,n,o){i(this,e);var a=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n.x,n.y));return a.text=o,a.type="speech",a.hideAt=40*a.text.length,a.entity=n,a.b={x:0,y:0,s:0},a}return o(e,t),s(e,[{key:"tick",value:function(){var t=this.handler.getWorld().getEntityManager(),e=t.getPlayer();u<this.hideAt&&u++,(0!=e.xMove||0!=e.yMove)&&u>=this.hideAt&&(u=0,t.removeEntity(this))}},{key:"render",value:function(t){var e=3*TILE_SIZE;t.fillStyle="#ffec27",t.fillRect(0,GAME_SIZE-e,GAME_SIZE,e),t.fillStyle="black",t.fillRect(16,GAME_SIZE-e+16,GAME_SIZE-32,e-32);for(var n=0;n<this.text.length;n++)t.drawText(this.text[n],TILE_SIZE,10*TILE_SIZE+40*n)}}]),e}(a.a);e.a=c},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return o});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(){function t(e){i(this,t),this.frames=e}return r(t,[{key:"getCurrentFrame",value:function(){var t=ANIMATION_TIMER;return this.frames[t.index].frame}},{key:"getStillFrame",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.frames[t].frame}}]),t}()},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return o});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(){function t(){i(this,t)}return r(t,null,[{key:"loadImage",value:function(t){var e=new Image;return e.src=t,e}}]),t}()},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return o});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(){function t(e){i(this,t),this.sheet=e}return r(t,[{key:"crop",value:function(t,e,n,i){return{sheet:this.sheet,x:t,y:e,width:n,height:i}}}]),t}()},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}n.d(e,"a",function(){return u});var a=n(3),s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=function(t){function e(t){i(this,e);var n=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.isSolid=!1,n}return o(e,t),s(e,[{key:"render",value:function(){}}]),e}(a.a)},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}n.d(e,"a",function(){return u});var a=n(0),s=n(3),u=function(t){function e(t){i(this,e);var n=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,a.a.getAssets("all").anim.wright));return n.anim=!0,n.isSolid=!0,n}return o(e,t),e}(s.a)},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}n.d(e,"a",function(){return c});var a=n(3),s=n(0),u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=function(t){function e(t){i(this,e);var n=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.isSolid=!1,n.assets=s.a.getAssets("all").anim.grassright,n}return o(e,t),u(e,[{key:"render",value:function(t,e,n,i){t.myDrawImage(this.assets.getStillFrame(0),e,n,i,i)}}]),e}(a.a)},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}n.d(e,"a",function(){return c});var a=n(3),s=n(0),u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=function(t){function e(t){i(this,e);var n=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.isSolid=!0,n.assets=s.a.getAssets("all").anim.grassright,n}return o(e,t),u(e,[{key:"render",value:function(t,e,n,i){t.myDrawImage(this.assets.getStillFrame(1),e,n,i,i)}}]),e}(a.a)},function(t,e,n){"use strict";var i=n(13),r=n(33),o=n(14),a=n(34),s=n(35),u=n(36),c=n(37),l=n(38),f={},h=[3,8],y=[3,8],p=void 0,d=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],v=[new o.a(p,rndIndex(y),rndIndex(y),"p"),new o.a(p,rndIndex(y),rndIndex(y),"g"),new o.a(p,rndIndex(y),rndIndex(y),"y"),new o.a(p,rndIndex(y),rndIndex(y),"b")],b=function(){var t=rndIndex(d);return d=d.filter(function(e){return e!=t}),t},g=function(t){return t[0][5]=t[0][6]=1,t},m=function(t){return t[5][11]=t[6][11]=1,t},w=function(t){return t[11][5]=t[11][6]=1,t},E=function(t){return t[5][0]=t[6][0]=1,t},I=function(t){return t.entities.push(new u.a(p,4,5)),t.entities.push(new u.a(p,7,5,"pleft")),t.entities.push(new u.a(p,7,6,"pleft")),f=t.id,d=d.filter(function(e){return e!=t.id}),t},k=function(t){for(var e=0;e<4;e++){var n=b();v[0].start.room=n,t[n].entities.push(v[0]),v.shift()}return t},_=function(t){var e=new a.a(p,5,5);return p.machine=e,t[f].entities.push(e),t},S=function(t){return d.forEach(function(e){return t[e].entities.push(new r.a(p,rndIndex(h),rndIndex(h)))}),t},x=function(t){return!!t.entities.find(function(t){return"m"==t.type})},T=function(t){return!!t.entities.find(function(t){return"key"==t.type})},O=function(t){return Object.keys(t).forEach(function(e){var n=t[e];if(!x(n)&&!T(n)){var i=Math.random()<=.5?1:2;n.entities.push(new s.a(p,5,5,i)),n.entities.push(new u.a(p,4,5)),n.entities.push(new u.a(p,7,5,"pleft"))}}),t},M=function(t){return Object.keys(t).forEach(function(e){var n=t[e];if(!x(n)&&T(n)){var i=new c.a(p,5,5);n.entities.push(i),n.entities.push(new l.a(p,i))}}),t},j=function(t){t[16].text="THE END!",t[16].entities=[],t[16].tileSet[0][5]=t[16].tileSet[0][6]=3,t[16].tileSet[5][11]=t[16].tileSet[6][11]=3,t[16].tileSet[11][5]=t[16].tileSet[11][6]=3,t[16].tileSet[5][0]=t[16].tileSet[6][0]=3;for(var e=5;e<10;e++)for(var n=2;n<10;n++){var i=rndInt(1,7),o=void 0;i<6&&(o=new u.a(p,n,e)),6==i&&(o=new r.a(p,n,e),o.speed=0),7==i&&(o=new c.a(p,n,e)),o.pacified=!0,t[16].addEntity(o)}return t[16].addEntity(new r.a(p,2,9)),t};e.a=function(t,e){p=t;var n={0:new i.a(0,[g,E]),1:new i.a(1,[g]),2:new i.a(2,[g]),3:new i.a(3,[g,m]),4:new i.a(4,[E]),5:new i.a(5,[m]),6:new i.a(6,[E]),7:new i.a(7,[m]),8:new i.a(8,[E]),9:new i.a(9,[m]),10:new i.a(10,[E]),11:new i.a(11,[m]),12:new i.a(12,[w,E]),13:new i.a(13,[w]),14:new i.a(14,[w]),15:new i.a(15,[m,w]),16:new i.a(16,[],[],TILE_SIZE,TILE_COUNT,{p:2,w:3})},r=I(n[e]);return n[e]=new i.a(r.id,r.traits,r.entities),n=k(n),n=_(n),n=S(n),n=O(n),n=M(n),n=j(n)}},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}n.d(e,"a",function(){return d});var a=n(2),s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},c={e:"w",w:"e",n:"s",s:"n"},l=0,f=0,h=null,y=0,p=0,d=function(t){function e(t,n,o){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;i(this,e);var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,o));return s.lastAnim="gleft",s.state=a,s.speed=80,s.start={x:s.x,y:s.y},s.last={},s.patrolDirs=["n","s","w","e"],s.patrolDir=rndIndex(s.patrolDirs),s.dir={},s.offScreen=!1,s.sm=s.handler.getSoundManager(),s.resetDir(),s}return o(e,t),s(e,[{key:"tick",value:function(t){switch(u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"tick",this).call(this,t),this.target||(this.target=this.handler.getWorld().getEntityManager().getPlayer()),this.xMove=this.yMove=0,this.state){case 1:this.patrolState(t);break;case 2:this.speed=120,this.persue(),this.checkStuck(),this.patrol(t),this.move(),this.resetDir();break;case 3:f=0,this.speed=50,this.x+=this.speed*t,this.target.x=this.x+16,this.target.y=this.y+16}}},{key:"render",value:function(t){t.myDrawImage(this.frame("g"),this.x,this.y,TILE_SIZE,TILE_SIZE),2==this.state&&(t.myDrawImage(this.a.anim.sright.getCurrentFrame(),this.x,this.y-16,TILE_SIZE,TILE_SIZE),p++>20&&(this.sm.play("siren"),p=0))}},{key:"patrolState",value:function(t){f<40&&f++;var e=h||this.patrolDir;this.dir[e]=!0,this.patrolDir,this.patrol(t),f>=40&&!this.pacified&&(h=null,this.checkStuck(),this.checkForTarget()),this.move()}},{key:"checkForTarget",value:function(){var t=this.target,e=this;Math.abs(t.x-e.x)<5*TILE_SIZE&&Math.abs(t.y-e.y)<5*TILE_SIZE&&(this.state=2)}},{key:"persue",value:function(){var t=this.target,e=Math.abs(t.x-this.x)<8,n=Math.abs(t.y-this.y)<8;this.dir.n=t.y<this.y&&!n,this.dir.e=t.x>this.x&&!e,this.dir.s=t.y>this.y&&!n,this.dir.w=t.x<this.x&&!e}},{key:"checkStuck",value:function(){var t=this,e=this.last.x==this.x,n=this.last.y==this.y;e&&n&&++l>15&&(h=Object.keys(this.dir).find(function(e){return t.dir[e]}),this.changeDirection(),this.resetDir(),this.patrolDir=c[h],l=0,f=0,this.state=1),this.last.x=this.x,this.last.y=this.y}},{key:"resetPos",value:function(){var t=this.start;this.x=t.x,this.y=t.y,f=0,this.patrolDir=rndIndex(this.patrolDirs),this.stuckAt=null,this.resetDir(),this.state=1}},{key:"resetDir",value:function(){this.dir={n:!1,e:!1,s:!1,w:!1}}},{key:"patrol",value:function(t){var e=this.dir;e.n&&(this.yMove=-this.speed*t),e.e&&(this.xMove=this.speed*t),e.s&&(this.yMove=this.speed*t),e.w&&(this.xMove=-this.speed*t)}},{key:"changeDirection",value:function(){if(this.offScreen&&y++,y>30||!this.offScreen){var t=this.dir,e=Object.keys(t).find(function(e){return t[e]});t[e]=!1,t[c[e]]=!0,this.patrolDir=this.patrolDirs.filter(function(t){return t!==e})[0],this.offScreen=!1,y=0}}}]),e}(a.a)},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=n(1),s=n(0),u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=function(t){function e(t,n,o){i(this,e);var a=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,o));return a.type="m",a.keys=[],a.assets.p=s.a.getAssets("all").anim.p_mright,a.assets.g=s.a.getAssets("all").anim.g_mright,a.assets.y=s.a.getAssets("all").anim.y_mright,a.assets.b=s.a.getAssets("all").anim.b_mright,a.b.x=-1,a.b.y=0,a.b.s=130,a}return o(e,t),u(e,[{key:"tick",value:function(){this.keys.length>3&&(ANIMATION_TIMER.stop=!0,this.handler.getWorld().machineFilled=!0)}},{key:"render",value:function(t){var e=this.myFrame();t.myDrawImage(this.assets.p[e](),this.x,this.y,TILE_SIZE,TILE_SIZE),t.myDrawImage(this.assets.g[e](),this.x+TILE_SIZE,this.y,TILE_SIZE,TILE_SIZE),t.myDrawImage(this.assets.y[e](),this.x+TILE_SIZE,this.y+TILE_SIZE,TILE_SIZE,TILE_SIZE),t.myDrawImage(this.assets.b[e](),this.x,this.y+TILE_SIZE,TILE_SIZE,TILE_SIZE)}},{key:"addKey",value:function(t){this.keys.push(t),ANIMATION_TIMER.keyAdded()}}]),e}(a.a);e.a=c},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=n(1),s=n(0),u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=function(t){function e(t,n,o,a){i(this,e);var u=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,o));return u.num=a,u.assets.left=s.a.getAssets("all").anim["prop"+u.num+"left"],u.assets.right=s.a.getAssets("all").anim["prop"+u.num+"right"],u.b.x=32,u.b.y=0,u.b.s=64,u}return o(e,t),u(e,[{key:"tick",value:function(){}},{key:"render",value:function(t){var e=this.myFrame();t.myDrawImage(this.assets.left[e](),this.x,this.y,TILE_SIZE,TILE_SIZE),t.myDrawImage(this.assets.right[e](),this.x+TILE_SIZE,this.y,TILE_SIZE,TILE_SIZE)}}]),e}(a.a);e.a=c},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}n.d(e,"a",function(){return u});var a=n(2),s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=function(t){function e(t,n,o){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"pright";i(this,e);var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,o));return s.lastAnim=a,s.type="w",s.speed=100,s.moveThrough=!1,s}return o(e,t),s(e,[{key:"tick",value:function(){}},{key:"render",value:function(t){t.myDrawImage(this.frame("p"),this.x,this.y,TILE_SIZE,TILE_SIZE)}},{key:"getRndSpeech",value:function(){return this.speak("Worker: ")}}]),e}(a.a)},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}n.d(e,"a",function(){return l});var a=n(2),s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=function t(e,n,i){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,n);if(void 0===r){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,i)}if("value"in r)return r.value;var a=r.get;if(void 0!==a)return a.call(i)},c=0,l=function(t){function e(t,n,o){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"maright";i(this,e);var s=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,o));return s.lastAnim=a,s.type="w",s.speed=100,s.moveThrough=!1,s}return o(e,t),s(e,[{key:"tick",value:function(t){u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"tick",this).call(this,t)}},{key:"render",value:function(t){if(this.pacified)return void t.myDrawImage(this.frame("ma"),this.x,this.y,TILE_SIZE,TILE_SIZE);t.myDrawImage(this.a.anim[this.lastAnim].getStillFrame(1),this.x,this.y,TILE_SIZE,TILE_SIZE),t.fillStyle="white",t.fillRect(this.x+16,this.y+16,24,8);var e="";c++>30&&(e="Zzz",c>60&&(c=0)),t.drawText(e,this.x+8,this.y)}},{key:"getRndSpeech",value:function(){return this.speak("Manager: ")}}]),e}(a.a)},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=n(1),s=n(0),u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=function(t){function e(t,n){i(this,e);var o=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n.x,n.y));return o.x=n.x,o.y=n.y,o.assets=s.a.getAssets("all").anim.deskright,o.b.x=64,o.b.y=0,o.b.s=64,o}return o(e,t),u(e,[{key:"tick",value:function(){}},{key:"render",value:function(t){t.myDrawImage(this.assets.getStillFrame(),this.x,this.y,TILE_SIZE,TILE_SIZE),t.myDrawImage(this.assets.getStillFrame(1),this.x+TILE_SIZE,this.y,TILE_SIZE,TILE_SIZE)}}]),e}(a.a);e.a=c},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}n.d(e,"a",function(){return u});var a=n(1),s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),u=function(t){function e(t,n,o){i(this,e);var a=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,o));return a.type="exit",a.b.x=0,a.b.y=0,a.b.s=TILE_SIZE,a}return o(e,t),s(e,[{key:"tick",value:function(){}},{key:"render",value:function(t){for(var e=0;e<2;e++)t.fillStyle=0==e?"#ffec27":"white",t.globalAlpha=.4,t.fillRect(this.x,this.y,this.b.s,this.b.s),t.globalAlpha=.3,t.fillRect(this.x,this.y-TILE_SIZE,this.b.s,this.b.s),t.fillRect(this.x,this.y+TILE_SIZE,this.b.s,this.b.s),t.globalAlpha=.2,t.fillRect(this.x,this.y-2*TILE_SIZE,this.b.s,this.b.s),t.fillRect(this.x,this.y+2*TILE_SIZE,this.b.s,this.b.s);t.globalAlpha=1}}]),e}(a.a)},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return o});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(){function t(e,n){i(this,t),this.handler=e,this.world=n}return r(t,[{key:"tick",value:function(t){this.world&&this.world.tick(t),this.getInput()}},{key:"render",value:function(t){this.world&&this.world.render(t)}}]),t}()},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return p});var r=n(8),o=n(10),a=n(11),s=n(13),u=n(6),c=n(7),l=n(14),f=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),h=199,y=!1,p=function(){function t(e){i(this,t),this.handler=e,this.keyManager=e.getKeyManager(),this.room=new s.a(0,[],[],32,24),this.entityManager=new r.a(e,new o.a(e,9,2)),this.spatialGrid=new a.a(GAME_SIZE,GAME_SIZE,TILE_SIZE),e.setWorld(this),this.state=1,this.init()}return f(t,[{key:"tick",value:function(t){var e=this.entityManager;switch(this.state){case 1:this.room.tick(),e.tick(t),e.getPlayer().item&&(this.handler.getSoundManager().play("place"),this.state=2);break;case 2:if(h--,y){var n=new u.a(this.handler,new c.a(this.handler));this.handler.getGame().getGameState().setState(n)}}}},{key:"render",value:function(t){t.globalAlpha=119==h?1:h/119,0==h&&(t.globalAlpha=1,y=!0),this.room.render(t),this.entityManager.render(t),t.drawText("Move with WASD or ZQSD !",210,548),t.drawText("GRAB THE KEYS !",264,600)}},{key:"init",value:function(){var t=this.handler,e=this.room;this.setTiles(),[new l.a(t,1,10,"p",!0),new l.a(t,3,10,"g",!0),new l.a(t,8,10,"b",!0),new l.a(t,10,10,"y",!0)].forEach(function(t){e.addEntity(t)}),this.entityManager.newRoom(null,this.room)}},{key:"setTiles",value:function(){this.room.tileSet=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,1,1,1,0,0,1,0,1,0,0,1,1,1,0,0,0,0,0,0,0,1],[1,0,0,0,1,0,0,0,1,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,1,0,0,0,1,1,1,0,0,1,1,0,0,0,0,0,0,0,0,1],[1,0,0,0,1,0,0,0,1,0,1,0,0,1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,1,0,0,0,1,0,1,0,0,1,1,1,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,1,1,0,0,0,1,0,0,0,1,1,1,0,0,1,1,1,0,0,1],[1,0,0,1,0,0,0,0,1,0,1,0,0,1,0,1,0,0,1,0,0,0,0,1],[1,0,0,1,0,0,0,0,1,0,1,0,0,1,1,1,0,0,1,1,0,0,0,1],[1,0,0,1,0,0,0,0,1,0,1,0,0,1,1,0,0,0,1,0,0,0,0,1],[1,0,0,0,1,1,0,0,0,1,0,0,0,1,0,1,0,0,1,1,1,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]]}},{key:"getSpatialGrid",value:function(){return this.spatialGrid}}]),t}()},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return o});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(){function t(e){i(this,t),this.currentState=null,this.handler=e}return r(t,[{key:"getState",value:function(){return this.currentState}},{key:"setState",value:function(t){this.currentState=t}}]),t}()},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",function(){return E});var r=n(44),o=n(45),a=n(46),s=n(47),u=n(48),c=n(49),l=n(50),f=n(51),h=n(52),y=n(53),p=n(54),d=n(55),v=n(56),b=n(57),g=n(58),m=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),w={},E=function(){function t(){i(this,t),this.init()}return m(t,[{key:"init",value:function(){w={pickup:this.create(.15,"pickup",h.a),place:this.create(.3,"place",f.a),steamHigh:this.create(.2,"steamHigh",o.a),steamLow:this.create(.4,"steamLow",a.a),bassC:this.create(.2,"bassC",s.a),bassDs:this.create(.2,"bassDs",u.a),bassFs:this.create(.2,"bassFs",l.a),endBassC:this.create(.2,"endBassC",v.a),endBassF:this.create(.2,"endBassF",b.a),stabFACD:this.create(.2,"stabFACD",d.a),arpFsG:this.create(.2,"arpFsG",y.a),arpAsC:this.create(.2,"arpAsC",p.a),siren:this.create(1,"siren",c.a),boom:this.create(.8,"boom",g.a)}}},{key:"play",value:function(t){w[t].play()}},{key:"load",value:function(t){w[t].load()}},{key:"create",value:function(t,e,n){var i=new r.a;i.init(n);var o=!1,a=setInterval(function(e){if(!o&&(o=i.generate()>=1)){var n=i.createWave(),r=document.createElement("audio");r.src=URL.createObjectURL(new Blob([n],{type:"audio/wav"})),r.volume=t,w[e]=r,clearInterval(a)}},0,e,t)}}]),t}()},function(t,e,n){"use strict";n.d(e,"a",function(){return i});var i=function(){var t,e,n,i,r,o=function(t){return Math.sin(6.283184*t)},a=function(t){return t%1*2-1},s=function(t){return t%1<.5?1:-1},u=function(t){var e=t%1*4;return e<2?e-1:3-e},c=function(t){return.003959503758*Math.pow(2,(t-128)/12)},l=function(t,e,n){var i,r,o,a,s,u,l,h=f[t.i[0]],y=t.i[1],p=t.i[3],d=f[t.i[4]],v=t.i[5],b=t.i[8],g=t.i[9],m=t.i[10]*t.i[10]*4,w=t.i[11]*t.i[11]*4,E=t.i[12]*t.i[12]*4,I=1/E,k=t.i[13],_=n*Math.pow(2,2-t.i[14]),S=new Int32Array(m+w+E),x=0,T=0;for(i=0,r=0;i<m+w+E;i++,r++)r>=0&&(k=k>>8|(255&k)<<4,r-=_,u=c(e+(15&k)+t.i[2]-128),l=c(e+(15&k)+t.i[6]-128)*(1+8e-4*t.i[7])),o=1,i<m?o=i/m:i>=m+w&&(o-=(i-m-w)*I),a=u,p&&(a*=o*o),x+=a,s=h(x)*y,a=l,b&&(a*=o*o),T+=a,s+=d(T)*v,g&&(s+=(2*Math.random()-1)*g),S[i]=80*s*o|0;return S},f=[o,s,a,u];this.init=function(o){t=o,e=o.endPattern,n=0,i=o.rowLen*o.patternLen*(e+1)*2,r=new Int32Array(i)},this.generate=function(){var a,s,u,c,h,y,p,d,v,b,g,m,w,E,I=new Int32Array(i),k=t.songData[n],_=t.rowLen,S=t.patternLen,x=0,T=0,O=!1,M=[];for(u=0;u<=e;++u)for(p=k.p[u],c=0;c<S;++c){var j=p?k.c[p-1].f[c]:0;j&&(k.i[j-1]=k.c[p-1].f[c+S]||0,j<16&&(M=[]));var P=f[k.i[15]],L=k.i[16]/512,Z=Math.pow(2,k.i[17]-9)/_,A=k.i[18],C=k.i[19],D=43.23529*k.i[20]*3.141592/44100,R=1-k.i[21]/255,G=1e-5*k.i[22],F=k.i[23]/32,W=k.i[24]/512,N=6.283184*Math.pow(2,k.i[25]-9)/_,z=k.i[26]/255,B=k.i[27]*_&-2;for(g=(u*S+c)*_,h=0;h<4;++h)if(y=p?k.c[p-1].n[c+h*S]:0){M[y]||(M[y]=l(k,y,_));var H=M[y];for(s=0,a=2*g;s<H.length;s++,a+=2)I[a]+=H[s]}for(s=0;s<_;s++)d=2*(g+s),b=I[d],b||O?(m=D,A&&(m*=P(Z*d)*L+.5),m=1.5*Math.sin(m),x+=m*T,w=R*(b-T)-x,T+=m*w,b=3==C?T:1==C?w:x,G&&(b*=G,b=b<1?b>-1?o(.25*b):-1:1,b/=G),b*=F,O=b*b>1e-5,v=Math.sin(N*d)*W+.5,E=b*(1-v),b*=v):E=0,d>=B&&(E+=I[d-B+1]*z,b+=I[d-B]*z),I[d]=0|E,I[d+1]=0|b,r[d]+=0|E,r[d+1]+=0|b}return++n/t.numChannels},this.createWave=function(){var t=44+2*i-8,e=t-36,n=new Uint8Array(44+2*i);n.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var o=0,a=44;o<i;++o){var s=r[o];s=s<-32767?-32767:s>32767?32767:s,n[a++]=255&s,n[a++]=s>>8&255}return n},this.getData=function(t,e){for(var n=2*Math.floor(44100*t),i=new Array(e),o=0;o<2*e;o+=1){var a=n+o;i[o]=t>0&&a<r.length?r[a]/32768:0}return i}}},function(t,e,n){"use strict";e.a={songData:[{i:[2,40,140,1,0,0,140,0,0,255,5,0,48,0,0,0,0,0,0,2,161,192,0,32,0,0,71,1],p:[1],c:[{n:[164],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1}},function(t,e,n){"use strict";e.a={songData:[{i:[2,40,140,1,0,0,140,0,0,255,5,0,48,0,0,0,0,0,0,3,17,48,0,32,0,11,71,1],p:[1],c:[{n:[140],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1}},function(t,e,n){"use strict";e.a={songData:[{i:[2,192,128,0,2,191,116,9,0,0,6,33,75,0,0,0,69,3,1,1,23,167,0,32,77,6,0,0],p:[1],c:[{n:[123],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1}},function(t,e,n){"use strict";e.a={songData:[{i:[2,192,128,0,2,191,116,9,0,0,6,33,75,0,0,0,69,3,1,1,23,167,0,32,77,6,0,0],p:[1],c:[{n:[126],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1}},function(t,e,n){"use strict";e.a={songData:[{i:[0,227,128,0,0,227,128,0,0,255,3,104,132,0,0,3,67,4,1,2,57,254,85,171,88,1,20,2],p:[1],c:[{n:[99],f:[]}]}],rowLen:2756,patternLen:32,endPattern:0,numChannels:1}},function(t,e,n){"use strict";e.a={songData:[{i:[2,192,128,0,2,191,116,9,0,0,6,33,75,0,0,0,69,3,1,1,23,167,0,32,77,6,0,0],p:[1],c:[{n:[129],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1}},function(t,e,n){"use strict";e.a={songData:[{i:[2,138,116,0,2,138,128,4,0,0,47,48,75,124,3,0,139,4,1,3,64,160,3,32,147,4,91,4],p:[1],c:[{n:[162],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1}},function(t,e,n){"use strict";e.a={songData:[{i:[1,192,128,0,1,191,116,9,0,255,6,16,20,0,0,0,69,3,1,1,35,125,0,32,0,12,0,0],p:[1],c:[{n:[137,139,140],f:[]}]}],rowLen:1378,patternLen:32,endPattern:0,numChannels:1}},function(t,e,n){"use strict";e.a={songData:[{i:[2,192,128,0,2,191,116,9,0,0,6,22,34,0,0,0,69,3,1,1,23,167,0,32,77,6,25,6],p:[3],c:[{n:[123,123,123,123,,,,,,,,,,,,,126,126,126,126],f:[]},{n:[123,123,123,123,,,,,126,,123,,121,,123,,126,126,126,126,,,,,129,,126,,131,,133],f:[]},{n:[141,142],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1}},function(t,e,n){"use strict";e.a={songData:[{i:[2,192,128,0,2,191,116,9,0,0,6,22,34,0,0,0,69,3,1,1,23,167,0,32,77,6,25,6],p:[3],c:[{n:[123,123,123,123,,,,,,,,,,,,,126,126,126,126],f:[]},{n:[123,123,123,123,,,,,126,,123,,121,,123,,126,126,126,126,,,,,129,,126,,131,,133],f:[]},{n:[145,147],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1}},function(t,e,n){"use strict";e.a={songData:[{i:[3,55,128,0,3,95,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,255,6,121,6],p:[1],c:[{n:[152,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,156,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,159,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,161],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1}},function(t,e,n){"use strict";e.a={songData:[{i:[3,55,128,0,3,95,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,255,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,48,105,0,0,0,0,3,1,2,135,0,0,32,0,6,0,6],p:[2],c:[{n:[],f:[]},{n:[123],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:2}},function(t,e,n){"use strict";e.a={songData:[{i:[3,55,128,0,3,95,128,0,0,0,5,6,58,0,0,0,195,6,1,2,135,0,0,32,255,6,121,6],p:[],c:[]},{i:[2,100,128,0,3,201,128,0,0,0,5,48,105,0,0,0,0,3,1,2,135,0,0,32,0,6,0,6],p:[2],c:[{n:[],f:[]},{n:[128],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:2}},function(t,e,n){"use strict";e.a={songData:[{i:[0,59,131,1,0,61,131,0,0,159,5,180,215,0,0,0,0,0,0,2,33,28,0,25,0,0,91,4],p:[1],c:[{n:[111,,,,,,,,,,,,,,,,111],f:[]}]}],rowLen:11025,patternLen:32,endPattern:0,numChannels:1}}]);</script></body>
</html>