<body style="display:flex;flex-direction:column;align-items:center;margin:0;background:#333;margin-top:15vh">
    <canvas id="g" width="512" height="256"></canvas>
    <div style="display:flex; justify-content:space-between; width:512px;">
        <canvas id="d" width="256" height="256" style="background:#fff;border:5px #C3C7CB solid"></canvas>
        <div style="width:256px;height:256px;background:#fff;position:relative;border:5px #C3C7CB solid">
            <br><b><===Draw here</b> <hr>
            <h5 id="i1"></h5><hr>
            <h5 id="i2"></h5>
            <button id="s" style="position:absolute; bottom:0; left:0; right:0;">Submit</button>
        </div>
    </div>
    
</body>
<script>
    class AudioManager{constructor(){this.context=new(window.AudioContext||window.webkitAudioContext),this.gainNode=this.context.createGain(),this.gainNode.connect(this.context.destination),this.melodies={1:"a b n b o b c",2:"a".repeat(4),3:"za",4:"o"}}playMelody(t,e=!1,a=.15,i=1){this.play(this.melodies[t],e,a,i)}play(t,e=!1,a,i=1){const s=n=>{if(n>=t.length)return e&&setTimeout((()=>s(0)),950*a),void(a>.09&&(a-=.005));const r=this.context.createOscillator(),c=this.context.createGain();r.type="square",r.connect(c),c.connect(this.gainNode),r.frequency.setValueAtTime(220+t.charCodeAt(n)%88*10,this.context.currentTime),c.gain.setValueAtTime(0,this.context.currentTime),c.gain.linearRampToValueAtTime(i,this.context.currentTime+.05),c.gain.exponentialRampToValueAtTime(.001,this.context.currentTime+a),r.start(),r.stop(this.context.currentTime+a),r.onended=()=>{setTimeout((()=>s(n+1)),1e3*a)}};s(0)}}function drawRectangle(t,e,a,i,s,n="black"){t.fillStyle=n,t.fillRect(e,a,i,s)}function drawCircle(t,e,a,i,s="black"){t.beginPath(),t.arc(e,a,i,0,2*Math.PI),t.fillStyle=s,t.fill()}function drawLightning(t,e,a,i,s,n=6,r=50){0!==n&&(t.strokeStyle="white",t.lineWidth=2,t.beginPath(),t.moveTo(e,a),t.lineTo((e+i)/2+(Math.random()*r-r/2),(a+s)/2+(Math.random()*r-r/2)),t.lineTo(i,s),t.stroke(),drawLightning(t,e,a,(e+i)/2+(Math.random()*r-r/2),(a+s)/2+(Math.random()*r-r/2),n-1,r/1.5),drawLightning(t,(e+i)/2+(Math.random()*r-r/2),(a+s)/2+(Math.random()*r-r/2),i,s,n-1,r/1.5))}const healthColor=(t,e)=>`#${Math.floor(e/t*255).toString(16).padStart(2,"0").repeat(3)}`;class Compressor{constructor(t,e){this.matrix=t,this.targetSize=e,this.matSize=t.length}compress(t=.25,e=!1){const a=this.createMatrix(this.targetSize),i=this.matSize/this.targetSize;for(let e=0;e<this.targetSize;e++)for(let s=0;s<this.targetSize;s++){let n=0,r=0;for(let t=Math.floor(e*i);t<Math.floor((e+1)*i);t++)for(let e=Math.floor(s*i);e<Math.floor((s+1)*i);e++)t<this.matSize&&e<this.matSize&&(n+=this.matrix[t][e],r++);const c=n/r;a[e][s]=c>t?1:0}return e?this.compareWithTemplates(a):a}compareWithTemplates(t){const e={0:["0000000000000000","0005911111180000","0591111111111000","0711115491111100","2911520000911140","7111000000071190","7112000000008190","7112000000008190","7112000000008190","7112000000001190","7911000000021190","5811140000411190","0781115445111100","0088881111111500","0005555888855000","0000055555500000"],13:["0000000000000000","0000000000000000","0111199997777760","0111111111111192","0333333333333322","0000000000000000","0099900000055500","0999900000069820","0911900000079820","0911006982279820","0911227997229770","0911111111119770","0711111111111870","0057888377765500","0000000000000000","0000000000000000"]};let a={},i=null,s=0;return Object.keys(e).forEach((n=>{const r=compareMatrices(t,applyReverseMappingToMatrix(convertTemplateToMatrix(e[n])));if(a[n]=r,console.log(`Similarity with template ${n}: ${r}%`),r>50){const t=100*(r-50)/50;console.log(`Similarity altered = ${t}%`),t>s&&(s=t,i=n)}})),console.log("Topmost similarity key:",i),document.getElementById("i2").innerHTML="Top Prediction : "+i+"<br>Accuracy :"+s,i}createMatrix(t){return Array(t).fill(null).map((()=>Array(t).fill(0)))}}function convertTemplateToMatrix(t){return t.map((t=>t.split("").map(Number)))}function applyReverseMappingToMatrix(t){return t.map((t=>t.map(reverseMapToAverage)))}function reverseMapToAverage(t){return 1===t?1:t>=0&&t<=9?t/10:0}function compareMatrices(t,e){let a=0,i=0,s=0;for(let n=0;n<16;n++)for(let r=0;r<16;r++)e[n][r]>.5?(i++,1===t[n][r]?a++:a-=1.5):e[n][r]>=.3&&1===t[n][r]&&(a+=.3),1===t[n][r]&&s++;return(Math.max(0,a*i/Math.max(s,1))/i*100).toFixed(2)}class Sprite{constructor(t,e,a,i,s=1,n=0,r=1,c=150,o=25){this.x=t,this.y=e,this.img=a,this.ctx=i,this.scale=s,this.rot=n,this.vibInt=r,this.vibFreq=c,this.vibOff={x:0,y:0},this.lastVib=0,this.health=o}vibrate(){Date.now()-this.lastVib>=this.vibFreq&&(this.vibOff={x:(Math.random()-.25)*this.vibInt,y:(Math.random()-.25)*this.vibInt},this.lastVib=Date.now())}moveTo(t,e){this.y+=e,this.x+=t}draw(){this.vibrate(),this.ctx.save(),this.ctx.translate(this.x+this.vibOff.x+this.img.width*this.scale/2,this.y+this.vibOff.y+this.img.height*this.scale/2),this.ctx.rotate(this.rot),this.ctx.drawImage(this.img,-this.img.width*this.scale/2,-this.img.height*this.scale/2,this.img.width*this.scale,this.img.height*this.scale),this.ctx.restore()}}class EnemySprite extends Sprite{constructor(t,e,a,i,s=1,n=0,r=1,c=150,o="rectangle",l){super(t,e,a,i,s,n,r,c),this.shape=o,this.health=l,this.maxHealth=10}vibrate(){super.vibrate()}moveTo(t,e){super.moveTo(t,e)}draw(){this.vibrate(),this.ctx.save(),this.ctx.translate(this.x+this.vibOff.x,this.y+this.vibOff.y),"rectangle"===this.shape?drawRectangle(this.ctx,-50,-50,12*this.scale,12*this.scale):drawCircle(this.ctx,0,0,12*this.scale),"rectangle"===this.shape?drawRectangle(this.ctx,-50,-50,11*this.scale,11*this.scale,healthColor(this.maxHealth,this.health)):drawCircle(this.ctx,0,0,11*this.scale,healthColor(this.maxHealth,this.health)),this.ctx.restore()}}class Particle{constructor(t,e,a,i,s){this.x=t+100*(Math.random()-.5),this.y=e+100*(Math.random()-.5),this.ctx=a,this.speedX=i*Math.cos(s),this.speedY=i*Math.sin(s),this.color="red",this.size=5,this.lifespan=3e3,this.creationTime=Date.now()}draw(){const t=(Date.now()-this.creationTime)/this.lifespan;return!(t>=1)&&(this.x+=this.speedX,this.y+=this.speedY,this.ctx.globalAlpha=1-t,this.ctx.fillStyle=this.color,this.ctx.fillRect(this.x,this.y,this.size,this.size),!0)}}const audioManager=new AudioManager,gamecanvas=document.getElementById("g"),gcanvas=gamecanvas.getContext("2d");gcanvas.canvas.height=256,gcanvas.canvas.width=2*gcanvas.canvas.height;let topKey=!1,maxHealth=50;const color_C3C7CB="#C3C7CB";let score=0,particles=[];const canvas1=document.getElementById("d"),ctx1=canvas1.getContext("2d"),size=256,brushSize=30;canvas1.width=256,canvas1.height=256;let matrix=Array(256).fill(null).map((()=>Array(256).fill(0))),painting=!1;canvas1.addEventListener("mousedown",(()=>painting=!0)),canvas1.addEventListener("mouseup",(()=>painting=!1)),canvas1.addEventListener("mousemove",draw);const Player=new Image;Player.src="./public/compressed2.png";const Sword=new Image;let Psprite,Ssprite;function drawStartScreen(){const[t,e,a,i]=[190,100,120,50];drawRectangle(gcanvas,0,0,512,256,"white"),gcanvas.fillStyle=color_C3C7CB,gcanvas.fillRect(t,e,a,i),gcanvas.fillStyle="#FFF",gcanvas.fillRect(t,e,a,2),gcanvas.fillRect(t,e,2,i),gcanvas.fillStyle="#000",gcanvas.fillRect(t+a-2,e,2,i),gcanvas.fillRect(t,e+i-2,a,2),gcanvas.font="16px Arial",gcanvas.textAlign="center",gcanvas.fillStyle="#000",gcanvas.fillText("Play",t+a/2,e+i/2+5),DrawBorder(color_C3C7CB)}function DrawBorder(t){for(let e of[[0,gcanvas.canvas.height-30,gcanvas.canvas.width,50,t],[0,-20,gcanvas.canvas.width,50,t],[0,0,20,gcanvas.canvas.height,t],[gcanvas.canvas.width-20,0,20,gcanvas.canvas.height,t]])drawRectangle(gcanvas,...e)}function ResetPos(){Psprite.y=180,Ssprite.y=Psprite.y}function startGameLoop(){Psprite.health<=0?location.reload():(gcanvas.save(),gcanvas.clearRect(0,0,gcanvas.canvas.width,gcanvas.canvas.height),drawRectangle(gcanvas,0,0,512,256,healthColor(maxHealth,Psprite.health)),drawEnemies(gcanvas),Psprite.draw(),Ssprite.draw(),"13"==topKey?(audioManager.playMelody("2",!1,.05),Ssprite.y=128,Psprite.y=-999,drawLightning(gcanvas,Ssprite.x+45,Ssprite.y+10,Math.random()*gcanvas.canvas.width,Math.random()*gcanvas.canvas.width)):ResetPos(),particles=particles.filter((t=>t.draw())),gcanvas.restore(),DrawBorder(color_C3C7CB))}function gameLoop(){startGameLoop(),requestAnimationFrame(gameLoop)}Sword.src="./public/compresseds1.png",Sword.onload=()=>{Psprite=new Sprite(50,180,Player,gcanvas,.5),Ssprite=new Sprite(85,180,Sword,gcanvas,1,Math.PI/1.6)};let Sinterval=5e3;function onClick(){audioManager.playMelody("1",!0,.2,.025),gameLoop(),setInterval(spawnEnemy,Sinterval),Sinterval>2e3&&(Sinterval-=20),gamecanvas.removeEventListener("click",onClick)}function draw(t){if(!painting)return;const e=canvas1.getBoundingClientRect();ctx1.beginPath(),ctx1.arc(t.clientX-e.left,t.clientY-e.top,15,0,2*Math.PI),ctx1.fillStyle="black",ctx1.fill();const a=Math.floor(t.clientX-e.left),i=Math.floor(t.clientY-e.top);for(let t=a-15;t<a+15;t++)for(let e=i-15;e<i+15;e++)t>=0&&t<256&&e>=0&&e<256&&(matrix[t][e]=1)}function removeClosestEnemy(){let t=null,e=1/0;if(enemies.forEach(((a,i)=>{let s=Math.abs(a.x-Psprite.x);s<e&&(e=s,t=i)})),null!==t){let e=enemies[t];enemies.splice(t,1),score+=1,ScoreManager(Psprite.health);for(var a=30;a;)particles.push(new Particle(e.x,e.y,gcanvas,2,Math.random()*Math.PI*2)),a--}}gamecanvas.addEventListener("click",onClick),document.getElementById("s").addEventListener("click",(async()=>{ctx1.clearRect(0,0,canvas1.width,canvas1.height);let t=matrix;return[128,64,32,16].forEach((e=>{t=new Compressor(t,e).compress(.1)})),topKey=await new Compressor(t,16).compress(.1,!0),"13"===topKey&&0!=enemies.length?(score+=3,matrix=Array(256).fill(null).map((()=>Array(256).fill(0))),enemies.forEach((t=>{t.health-=5})),void setTimeout((()=>{topKey=!1}),1e3)):"0"===topKey&&0!=enemies.length?(removeClosestEnemy(),matrix=Array(256).fill(null).map((()=>Array(256).fill(0))),void(score+=1)):(score-=1,RemovePhealth(1),ScoreManager(),void audioManager.playMelody("3",!1,.3))}));let enemies=[];const enemySpeed=.25;function spawnEnemy(){const t=Math.random()<.5?85:215,e=new EnemySprite(512,t,null,gcanvas,1,0,1,150,85===t?"rectangle":"circle",10);enemies.push(e)}function drawEnemies(){enemies.forEach(((t,e)=>{if(t.moveTo(-enemySpeed,0),t.draw(),t.y<0&&(enemies.splice(e,1),RemovePhealth(1)),t.health<=0){enemies.splice(e,1),score+=1,ScoreManager();for(var a=10;a;)particles.push(new Particle(t.x,t.y,gcanvas,2,Math.random()*Math.PI*2)),a--}}))}function ScoreManager(){document.getElementById("i1").innerHTML=" Score : "+score}function RemovePhealth(t){Psprite.health-=t}ScoreManager(),drawStartScreen();
</script>