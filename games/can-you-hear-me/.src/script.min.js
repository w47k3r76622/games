!function(e){var t=440*Math.pow(Math.pow(2,1/12),-9),a=/^[0-9.]+$/,n=/\s+/,r=/(\d+)/,i={};function o(e){var t=e.split(n);this.frequency=o.getFrequency(t[0])||0,this.duration=o.getDuration(t[1])||0}function s(e,t,a){this.ac=e||new AudioContext,this.createFxNodes(),this.tempo=t||120,this.loop=!0,this.smoothing=0,this.staccato=0,this.notes=[],this.push.apply(this,a||[])}"B#-C|C#-Db|D|D#-Eb|E-Fb|E#-F|F#-Gb|G|G#-Ab|A|A#-Bb|B-Cb".split("|").forEach(function(e,t){e.split("-").forEach(function(e){i[e]=t})}),o.getFrequency=function(e){var a=e.split(r),n=i[a[0]],o=(a[1]||4)-4;return t*Math.pow(Math.pow(2,1/12),n)*Math.pow(2,o)},o.getDuration=function(e){return a.test(e)?parseFloat(e):e.toLowerCase().split("").reduce(function(e,t){return e+("w"===t?4:"h"===t?2:"q"===t?1:"e"===t?.5:"s"===t?.25:0)},0)},s.prototype.createFxNodes=function(){var e=this.gain=this.ac.createGain();return[["bass",100],["mid",1e3],["treble",2500]].forEach(function(t,a){(a=this[t[0]]=this.ac.createBiquadFilter()).type="peaking",a.frequency.value=t[1],e.connect(e=a)}.bind(this)),e.connect(this.ac.destination),this},s.prototype.push=function(){return Array.prototype.forEach.call(arguments,function(e){this.notes.push(e instanceof o?e:new o(e))}.bind(this)),this},s.prototype.createCustomWave=function(e,t){t||(t=e),this.waveType="custom",this.customWave=[new Float32Array(e),new Float32Array(t)]},s.prototype.createOscillator=function(){return this.stop(),this.osc=this.ac.createOscillator(),this.customWave?this.osc.setPeriodicWave(this.ac.createPeriodicWave.apply(this.ac,this.customWave)):this.osc.type=this.waveType||"square",this.osc.connect(this.gain),this},s.prototype.scheduleNote=function(e,t){var a=60/this.tempo*this.notes[e].duration,n=a*(1-(this.staccato||0));return this.setFrequency(this.notes[e].frequency,t),this.smoothing&&this.notes[e].frequency&&this.slide(e,t,n),this.setFrequency(0,t+n),t+a},s.prototype.getNextNote=function(e){return this.notes[e<this.notes.length-1?e+1:0]},s.prototype.getSlideStartDelay=function(e){return e-Math.min(e,60/this.tempo*this.smoothing)},s.prototype.slide=function(e,t,a){var n=this.getNextNote(e),r=this.getSlideStartDelay(a);return this.setFrequency(this.notes[e].frequency,t+r),this.rampFrequency(n.frequency,t+a),this},s.prototype.setFrequency=function(e,t){return this.osc.frequency.setValueAtTime(e,t),this},s.prototype.rampFrequency=function(e,t){return this.osc.frequency.linearRampToValueAtTime(e,t),this},s.prototype.play=function(e){return e="number"==typeof e?e:this.ac.currentTime,this.createOscillator(),this.osc.start(e),this.notes.forEach(function(t,a){e=this.scheduleNote(a,e)}.bind(this)),this.osc.stop(e),this.osc.onended=this.loop?this.play.bind(this,e):null,this},s.prototype.stop=function(){return this.osc&&(this.osc.onended=null,this.osc.disconnect(),this.osc=null),this},e.Note=o,e.Sequence=s}(TinyMusic={});var sequenceIntro,sequence1,sequence2,sequence3,coinTake,s_dash,ac="undefined"!=typeof AudioContext?new AudioContext:new webkitAudioContext,tempo=136,cc=["E5 e","E6 q"],lu=["E4 e","E3 q"],ee=["E2 q","E5 q"],introLoop=["- e","G4 e","C4 e","F4 e","-  e","F4 e","G4 e","C4 e","- e","C5 e","F4 e","G4 e","- e","F4 e","C5 e","F4 e"],lead=["- e","G4 e","C4 e","F4 e","- e","F4 e","G4 e","C4 e","- e","C5 e","F4 e","G4 e","- e","F4 e","C5 e","F4 e","- e","F4 e","G4 e","F4 e","- e","E4 e","C4 e","C4 e","- e","E4 e","F4 e","C4 e","- e","F4 e","G4 e","F4 e"],harmony=["C5 e","- e","G5 e","- e","F5 e","- e","C5 e","- e","F5 e","- e","C5 e","- e","G5 e","- e","F5 e","- e","E5 e","- e","G5 e","- e","C6 e","- e","F5 e","- e","A5 e","- e","C5 e","- e","G5 e","- e","F5 e","- e"],bass=["C3 e","F2 q","- e","G2 e","F2 q","- e","F2 e","C3 q","-  e","C3 e","F2 q","-  e","A2 e","F2 q","-  e","C3 e","E2 q","- e","G2 e","F2 q","- e","A2 e","F2 q","- e"];function coinSound(){coinTake.play(ac.currentTime)}function levelUpSound(){levelUp.play(ac.currentTime)}function dashSound(){s_dash.play(ac.currentTime)}function playIntro(){sequenceIntro.stop(),sequenceIntro.play(ac.currentTime)}function playMainTheme(){sequenceIntro.stop(),[sequence1,sequence2,sequence3].forEach(e=>{e.stop(),e.play(ac.currentTime)})}function setLevels(e){sequenceIntro.gain.gain.value=sequence1.gain.gain.value=sequence2.gain.gain.value=e||.2,sequence3.gain.gain.value=e||.15,coinTake.gain.gain.value=levelUp.gain.gain.value=s_dash.gain.gain.value=e||.3,isMuted=0===e}function muteSound(){setLevels(0)}sequenceIntro=new TinyMusic.Sequence(ac,tempo,introLoop),sequence1=new TinyMusic.Sequence(ac,tempo,lead),sequence2=new TinyMusic.Sequence(ac,tempo,harmony),sequence3=new TinyMusic.Sequence(ac,tempo,bass),(coinTake=new TinyMusic.Sequence(ac,100,cc)).loop=!1,coinTake.tempo=300,coinTake.staccato=.55,levelUp=new TinyMusic.Sequence(ac,100,lu),levelUp.loop=!1,levelUp.tempo=300,levelUp.staccato=.55,(s_dash=new TinyMusic.Sequence(ac,100,ee)).loop=!1,s_dash.tempo=300,s_dash.smoothing=1,sequenceIntro.staccato=.3,sequence1.staccato=.3,sequence2.staccato=.1,sequence3.staccato=.5,setLevels();var GA=GA||{};GA.VERSION="0.0.1",GA.plugins=void 0,GA.custom=void 0,GA.create=function(e,t,a,n,r){var i,o={};if(o.canvas=document.createElement("canvas"),o.canvas.setAttribute("width",1*e),o.canvas.setAttribute("height",1*t),o.canvas.style.backgroundColor="black",document.body.appendChild(o.canvas),o.canvas.ctx=o.canvas.getContext("2d"),o.stage=(d(i={}),i.stage=!0,i.width=o.canvas.width,i.height=o.canvas.height,i.x=0,i.y=0,i.parent=void 0,i),o.pointer=function(){var e={_x:0,_y:0};return Object.defineProperties(e,{x:{get:function(){return e._x/o.scale},enumerable:!0,configurable:!0},y:{get:function(){return e._y/o.scale},enumerable:!0,configurable:!0},centerX:{get:function(){return e.x},enumerable:!0,configurable:!0},centerY:{get:function(){return e.y},enumerable:!0,configurable:!0},position:{get:function(){return{x:e.x,y:e.y}},enumerable:!0,configurable:!0}}),e.isDown=!1,e.isUp=!0,e.tapped=!1,e.downTime=0,e.elapsedTime=0,e.press=void 0,e.release=void 0,e.tap=void 0,e.dragSprite=null,e.dragOffsetX=0,e.dragOffsetY=0,e.moveHandler=function(t){e._x=t.pageX-t.target.offsetLeft,e._y=t.pageY-t.target.offsetTop,t.preventDefault()},e.touchmoveHandler=function(t){e._x=t.targetTouches[0].pageX-o.canvas.offsetLeft,e._y=t.targetTouches[0].pageY-o.canvas.offsetTop,t.preventDefault()},e.downHandler=function(t){e._x=t.pageX-t.target.offsetLeft,e._y=t.pageY-t.target.offsetTop,e.isDown=!0,e.isUp=!1,e.tapped=!1,e.downTime=Date.now(),e.press&&e.press(),t.preventDefault()},e.touchstartHandler=function(t){e._x=t.targetTouches[0].pageX-o.canvas.offsetLeft,e._y=t.targetTouches[0].pageY-o.canvas.offsetTop,e.isDown=!0,e.isUp=!1,e.tapped=!1,e.downTime=Date.now(),e.press&&e.press(),t.preventDefault()},e.upHandler=function(t){e.elapsedTime=Math.abs(e.downTime-Date.now()),e.elapsedTime<=200&&(e.tapped=!0,e.tap&&e.tap()),e.isUp=!0,e.isDown=!1,e.release&&e.release(),t.preventDefault()},o.canvas.addEventListener("mousemove",e.moveHandler.bind(e),!1),o.canvas.addEventListener("mousedown",e.downHandler.bind(e),!1),window.addEventListener("mouseup",e.upHandler.bind(e),!1),o.canvas.addEventListener("touchmove",e.touchmoveHandler.bind(e),!1),o.canvas.addEventListener("touchstart",e.touchstartHandler.bind(e),!1),window.addEventListener("touchend",e.upHandler.bind(e),!1),o.canvas.style.touchAction="none",e.hitTestSprite=function(t){var a=!1;if(t.circular){var n=e.x-(t.gx+t.halfWidth),r=e.y-(t.gy+t.halfHeight);a=Math.sqrt(n*n+r*r)<t.radius}else{var i=t.gx,o=t.gx+t.width,s=t.gy,c=t.gy+t.height;a=e.x>i&&e.x<o&&e.y>s&&e.y<c}return a},e.updateDragAndDrop=function(){if(e.isDown)if(null===e.dragSprite)for(var t=o.draggableSprites.length-1;t>-1;t--){var a=o.draggableSprites[t];if(a.draggable&&e.hitTestSprite(a)){e.dragOffsetX=e.x-a.gx,e.dragOffsetY=e.y-a.gy,e.dragSprite=a;var n=a.parent.children;n.splice(n.indexOf(a),1),n.push(a),o.draggableSprites.splice(o.draggableSprites.indexOf(a),1),o.draggableSprites.push(a);break}}else e.dragSprite.x=e.x-e.dragOffsetX,e.dragSprite.y=e.y-e.dragOffsetY;e.isUp&&(e.dragSprite=null),o.draggableSprites.some(function(t){return t.draggable&&e.hitTestSprite(t)?(o.canvas.style.cursor="pointer",!0):(o.canvas.style.cursor="auto",!1)})},e}(),o.key=function(){var e={};return e.leftArrow=h(37),e.upArrow=h(38),e.rightArrow=h(39),e.downArrow=h(40),e.space=h(32),e}(),o.buttons=[],o.dragAndDrop=!1,o.draggableSprites=[],o.tweens=[],o.state=void 0,o.load=r||void 0,o.setup=a||void 0,void 0===o.setup)throw new Error("Please supply the setup function in the constructor");function s(){if(requestAnimationFrame(s,o.canvas),void 0===o._fps)l(),o.render(o.canvas,0);else{var e=Date.now(),t=e-o._startTime;for(t>1e3&&(t=o._frameDuration),o._startTime=e,o._lag+=t;o._lag>=o._frameDuration;)c(),l(),o._lag-=o._frameDuration;var a=o._lag/o._frameDuration;o.render(o.canvas,a)}}function c(){o.stage.children.forEach(function(e){!function e(t){t._previousX=t.x;t._previousY=t.y;t.children&&t.children.length>0&&t.children.forEach(function(t){e(t)})}(e)})}function l(){if(o.buttons.length>0){o.canvas.style.cursor="auto";for(var e=o.buttons.length-1;e>=0;e--){var t=o.buttons[e];t.update(o.pointer,o.canvas),"over"!==t.state&&"down"!==t.state||t.stage||(o.canvas.style.cursor="pointer")}}if(o.dragAndDrop&&o.pointer.updateDragAndDrop(),o.state&&!o.paused&&o.state(),0!==o.updateFunctions.length)for(var a=0;a<o.updateFunctions.length;a++){(0,o.updateFunctions[a])()}}function d(e){e.x=0,e.y=0,e.vx=0,e.vy=0,e.width=0,e.height=0,e.scaleX=1,e.scaleY=1,e.pivotX=.5,e.pivotY=.5,e.rotation=0,e.visible=!0,e.parent=void 0,e.stage=!1,e.shadow=!1,e.shadowColor="rgba(100, 100, 100, 0.5)",e.shadowOffsetX=3,e.shadowOffsetY=3,e.shadowBlur=3,e.blendMode=void 0,e._alpha=1,e._draggable=void 0,e._layer=0,e._circular=!1,e._interactive=!1,e._previousX=void 0,e._previousY=void 0,e.children=[],e.addChild=function(t){t.parent&&t.parent.removeChild(t),t.parent=e,e.children.push(t)},e.removeChild=function(t){if(t.parent!==e)throw new Error(t+"is not a child of "+e);e.children.splice(e.children.indexOf(t),1)},e.swapChildren=function(t,a){var n=e.children.indexOf(t),r=e.children.indexOf(a);if(-1===n||-1===r)throw new Error(child+" Both objects must be a child of the caller "+e);t.childIndex=r,a.childIndex=n,e.children[n]=a,e.children[r]=t},e.add=function(t){var a=Array.prototype.slice.call(arguments);a.length>1?a.forEach(function(t){e.addChild(t)}):e.addChild(a[0])},e.remove=function(t){var a=Array.prototype.slice.call(arguments);a.length>1?a.forEach(function(t){e.removeChild(t)}):e.removeChild(a[0])},e.setPosition=function(t,a){e.x=t,e.y=a};var t=e;e.putCenter=function(a,n,r){n=n||0,r=r||0,a.x=t.x+t.halfWidth-a.halfWidth+n,a.y=t.y+t.halfHeight-a.halfHeight+r,e.compensateForParentPosition(t,a)},e.putTop=function(a,n,r){n=n||0,r=r||0,a.x=t.x+t.halfWidth-a.halfWidth+n,a.y=t.y-a.height+r,e.compensateForParentPosition(t,a)},e.putRight=function(a,n,r){n=n||0,r=r||0,a.x=t.x+t.width+n,a.y=t.y+t.halfHeight-a.halfHeight+r,e.compensateForParentPosition(t,a)},e.putBottom=function(a,n,r){n=n||0,r=r||0,a.x=t.x+t.halfWidth-a.halfWidth+n,a.y=t.y+t.height+r,e.compensateForParentPosition(t,a)},e.putLeft=function(a,n,r){n=n||0,r=r||0,a.x=t.x-a.width+n,a.y=t.y+t.halfHeight-a.halfHeight+r,e.compensateForParentPosition(t,a)},e.compensateForParentPosition=function(e,t){0===t.parent.gx&&0===t.parent.gy||(t.x-=e.gx,t.y-=e.gy)},Object.defineProperties(e,{gx:{get:function(){return this.parent?this.x+this.parent.gx:this.x},enumerable:!0,configurable:!0},gy:{get:function(){return this.parent?this.y+this.parent.gy:this.y},enumerable:!0,configurable:!0},position:{get:function(){return{x:e.x,y:e.y}},enumerable:!0,configurable:!0},alpha:{get:function(){return e.parent._alpha*e._alpha},set:function(t){e._alpha=t},enumerable:!0,configurable:!0},halfWidth:{get:function(){return e.width/2},enumerable:!0,configurable:!0},halfHeight:{get:function(){return e.height/2},enumerable:!0,configurable:!0},centerX:{get:function(){return e.x+e.halfWidth},enumerable:!0,configurable:!0},centerY:{get:function(){return e.y+e.halfHeight},enumerable:!0,configurable:!0},layer:{get:function(){return e._layer},set:function(t){e._layer=t,e.parent.children.sort(u)},enumerable:!0,configurable:!0},circular:{get:function(){return e._circular},set:function(t){!0===t&&!1===e._circular&&(makeCircular(e),e._circular=!0),!1===t&&!0===e._circular&&(delete e.diameter,delete e.radius,e._circular=!1)},enumerable:!0,configurable:!0},draggable:{get:function(){return e._draggable},set:function(t){!0===t&&(o.draggableSprites.push(e),e._draggable=!0,!1===o.dragAndDrop&&(o.dragAndDrop=!0)),!1===t&&o.draggableSprites.splice(o.draggableSprites.indexOf(e),1)},enumerable:!0,configurable:!0},interactive:{get:function(){return e._interactive},set:function(t){!0===t&&(!function(e){e.press=e.press||void 0,e.release=e.release||void 0,e.over=e.over||void 0,e.out=e.out||void 0,e.tap=e.tap||void 0,e.state="up",e.action="",e.pressed=!1,e.enabled=!0,e.hoverOver=!1,o.buttons.push(e),e.update=function(t,a){if(e.enabled){var n=o.pointer.hitTestSprite(e);t.isUp&&(e.state="up","button"===e.subtype&&e.show(0)),n&&(e.state="over",e.frames&&3===e.frames.length&&"button"===e.subtype&&e.show(1),t.isDown&&(e.state="down","button"===e.subtype&&(3===e.frames.length?e.show(2):e.show(1)))),"down"===e.state&&(e.pressed||(e.press&&e.press(),e.pressed=!0,e.action="pressed")),"over"===e.state&&(e.pressed&&(e.release&&e.release(),e.pressed=!1,e.action="released",o.pointer.tapped&&e.tap&&e.tap()),e.hoverOver||(e.over&&e.over(),e.hoverOver=!0)),"up"===e.state&&(e.pressed&&(e.release&&e.release(),e.pressed=!1,e.action="released"),e.hoverOver&&(e.out&&e.out(),e.hoverOver=!1))}}}(e),e._interactive=!0),!1===t&&(o.buttons.splice(o.buttons.indexOf(e),1),e._interactive=!1)},enumerable:!0,configurable:!0},localBounds:{get:function(){return{x:0,y:0,width:e.width,height:e.height}},enumerable:!0,configurable:!0},globalBounds:{get:function(){return rectangle={x:e.gx,y:e.gy,width:e.gx+e.width,height:e.gy+e.height},rectangle},enumerable:!0,configurable:!0},empty:{get:function(){return 0===e.children.length},enumerable:!0,configurable:!0}})}function h(e){var t={};return t.code=e,t.isDown=!1,t.isUp=!0,t.press=void 0,t.release=void 0,t.downHandler=function(e){e.keyCode===t.code&&(t.isUp&&t.press&&t.press(),t.isDown=!0,t.isUp=!1),e.preventDefault()},t.upHandler=function(e){e.keyCode===t.code&&(t.isDown&&t.release&&t.release(),t.isDown=!1,t.isUp=!0),e.preventDefault()},window.addEventListener("keydown",t.downHandler.bind(t),!1),window.addEventListener("keyup",t.upHandler.bind(t),!1),t}function u(e,t){return e.layer<t.layer?-1:(e.layer,t.layer,1)}return o.assetFilePaths=n||void 0,o.paused=!1,o._fps=60,o._startTime=Date.now(),o._frameDuration=1e3/o._fps,o._lag=0,o.interpolate=!0,o.updateFunctions=[],o.scale=1,o.start=function(){o.assetFilePaths?(o.assets.whenLoaded=function(){o.state=void 0,o.setup()},o.assets.load(o.assetFilePaths),o.load&&(o.state=o.load)):o.setup(),s()},o.pause=function(){o.paused=!0},o.resume=function(){o.paused=!1},o.hidePointer=function(){o.canvas.style.cursor="none"},o.showPointer=function(){o.canvas.style.cursor="auto"},Object.defineProperties(o,{fps:{get:function(){return o._fps},set:function(e){o._fps=e,o._startTime=Date.now(),o._frameDuration=1e3/o._fps},enumerable:!0,configurable:!0},backgroundColor:{set:function(e){o.canvas.style.backgroundColor=e},enumerable:!0,configurable:!0}}),o.remove=function(e){var t=Array.prototype.slice.call(arguments);if(t[0]instanceof Array){var a=t[0];if(a.length>0)for(var n=a.length-1;n>=0;n--){var r=a[n];r.parent.removeChild(r),a.splice(a.indexOf(r),1)}}else t.length>1?t.forEach(function(e){e.parent.removeChild(e)}):t[0].parent.removeChild(t[0])},o.group=function(e){var t={};(d(t),t.addChild=function(e){e.parent&&e.parent.removeChild(e),e.parent=t,t.children.push(e),t.calculateSize()},t.removeChild=function(e){if(e.parent!==t)throw new Error(e+"is not a child of "+t);t.children.splice(t.children.indexOf(e),1),t.calculateSize()},t.calculateSize=function(){t.children.length>0&&(t._newWidth=0,t._newHeight=0,t.children.forEach(function(e){e.x+e.width>t._newWidth&&(t._newWidth=e.x+e.width),e.y+e.height>t._newHeight&&(t._newHeight=e.y+e.height)}),t.width=t._newWidth,t.height=t._newHeight)},o.stage.addChild(t),e)&&Array.prototype.slice.call(arguments).forEach(function(e){t.addChild(e)});return t},o.rectangle=function(e,t,a,n,r,i,s){var c={};return d(c),c.mask=!1,c.width=e||32,c.height=t||32,c.fillStyle=a||"red",c.strokeStyle=n||"none",c.lineWidth=r||0,c.x=i||0,c.y=s||0,o.stage.addChild(c),c.render=function(e){e.strokeStyle=c.strokeStyle,e.lineWidth=c.lineWidth,e.fillStyle=c.fillStyle,e.beginPath(),e.rect(-c.width*c.pivotX,-c.height*c.pivotY,c.width,c.height),!0===c.mask?e.clip():("none"!==c.strokeStyle&&e.stroke(),"none"!==c.fillStyle&&e.fill())},c},o.text=function(e,t,a,n,r){var i={};return d(i),i.content=e||"Hello!",i.font=t||"12px sans-serif",i.fillStyle=a||"red",i.textBaseline="top",Object.defineProperties(i,{width:{get:function(){return o.canvas.ctx.measureText(i.content).width},enumerable:!0,configurable:!0},height:{get:function(){return o.canvas.ctx.measureText("M").width},enumerable:!0,configurable:!0}}),o.stage.addChild(i),i.x=n||0,i.y=r||0,i.render=function(e){e.strokeStyle=i.strokeStyle,e.lineWidth=i.lineWidth,e.fillStyle=i.fillStyle,0===i.width&&(i.width=e.measureText(i.content).width),0===i.height&&(i.height=e.measureText("M").width),e.translate(-i.width*i.pivotX,-i.height*i.pivotY),e.font=i.font,e.textBaseline=i.textBaseline,e.fillText(i.content,0,0)},i},o.frame=function(e,t,a,n,r){var i={};return i.image=e,i.x=t,i.y=a,i.width=n,i.height=r,i},o.frames=function(e,t,a,n){var r={};return r.image=e,r.data=t,r.width=a,r.height=n,r},o.filmstrip=function(e,t,a,n){for(var r=o.assets[e].source,i=[],s=r.width/t,c=s*(r.height/a),l=0;l<c;l++){var d,h;d=l%s*t,h=Math.floor(l/s)*a,n&&n>0&&(d+=n+n*l%s,h+=n+n*Math.floor(l/s)),i.push([d,h])}return o.frames(e,i,t,a)},o.sprite=function(e){var t={};if(void 0===e)throw new Error("Sprites require a source");return d(t),t.frames=[],t.loop=!0,t._currentFrame=0,t.setTexture=function(e){if(e.image)if(e.image&&!e.data){if(!(o.assets[e.image].source instanceof Image))throw new Error(e.image+" is not an image file");t.source=o.assets[e.image].source,t.sourceX=e.x,t.sourceY=e.y,t.width=e.width,t.height=e.height,t.sourceWidth=e.width,t.sourceHeight=e.height}else e.image&&e.data&&(t.source=o.assets[e.image].source,t.frames=e.data,t.sourceX=t.frames[0][0],t.sourceY=t.frames[0][1],t.width=e.width,t.height=e.height,t.sourceWidth=e.width,t.sourceHeight=e.height);else e instanceof Array?(t.frames=e,t.source=o.assets[e[0]].source,t.sourceX=o.assets[e[0]].frame.x,t.sourceY=o.assets[e[0]].frame.y,t.width=o.assets[e[0]].frame.w,t.height=o.assets[e[0]].frame.h,t.sourceWidth=o.assets[e[0]].frame.w,t.sourceHeight=o.assets[e[0]].frame.h):(t.tilesetFrame=o.assets[e],t.source=t.tilesetFrame.source,t.sourceX=t.tilesetFrame.frame.x,t.sourceY=t.tilesetFrame.frame.y,t.width=t.tilesetFrame.frame.w,t.height=t.tilesetFrame.frame.h,t.sourceWidth=t.tilesetFrame.frame.w,t.sourceHeight=t.tilesetFrame.frame.h)},t.setTexture(e),t.gotoAndStop=function(e){if(!(t.frames.length>0))throw new Error("Frame number "+e+"doesn't exist");t.frames[0]instanceof Array?(t.sourceX=t.frames[e][0],t.sourceY=t.frames[e][1]):o.assets[t.frames[e]].frame&&(t.source=o.assets[t.frames[e]].source,t.sourceX=o.assets[t.frames[e]].frame.x,t.sourceY=o.assets[t.frames[e]].frame.y,t.sourceWidth=o.assets[t.frames[e]].frame.w,t.sourceHeight=o.assets[t.frames[e]].frame.h,t.width=o.assets[t.frames[e]].frame.w,t.height=o.assets[t.frames[e]].frame.h),t._currentFrame=e},t.x=0,t.y=0,t.frames.length>0&&(o.addStatePlayer(t),Object.defineProperty(t,"currentFrame",{get:function(){return t._currentFrame},enumerable:!1,configurable:!1})),o.stage.addChild(t),t.render=function(e){e.drawImage(t.source,t.sourceX,t.sourceY,t.sourceWidth,t.sourceHeight,-t.width*t.pivotX,-t.height*t.pivotY,t.width,t.height)},t},o.image=function(e){return o.assets[e]},o.json=function(e){return o.assets[e]},o.addStatePlayer=function(e){var t=0,a=0,n=0,r=0,i=void 0,o=!1;function s(s){c(),n=s[0],r=s[1],a=r-n,0===n&&(a+=1,t+=1),1===a&&(a=2,t+=1),e.fps||(e.fps=12);var l=1e3/e.fps;e.gotoAndStop(n),o||(i=setInterval(function(){t<a?(e.gotoAndStop(e.currentFrame+1),t+=1):e.loop&&(e.gotoAndStop(n),t=1)}.bind(this),l),o=!0)}function c(){void 0!==i&&!0===o&&(o=!1,t=0,n=0,r=0,a=0,clearInterval(i))}e.show=function(t){c(),"string"!=typeof t?e.gotoAndStop(t):e.gotoAndStop(e.frames.indexOf(t))},e.play=function(){s([0,e.frames.length-1])},e.stop=function(){c(),e.gotoAndStop(e.currentFrame)},e.playing=o,e.playSequence=s},o.render=function(e,t){var a=e.ctx;a.clearRect(0,0,e.width,e.height);for(var n=0;n<o.stage.children.length;n++){r(o.stage.children[n])}function r(n){if(n.visible&&n.gx<e.width+n.width&&n.gx+n.width>=-n.width&&n.gy<e.height+n.height&&n.gy+n.height>=-n.height){if(a.save(),o.interpolate?(void 0!==n._previousX?n.renderX=(n.x-n._previousX)*t+n._previousX:n.renderX=n.x,void 0!==n._previousY?n.renderY=(n.y-n._previousY)*t+n._previousY:n.renderY=n.y):(n.renderX=n.x,n.renderY=n.y),a.translate(n.renderX+n.width*n.pivotX,n.renderY+n.height*n.pivotY),a.globalAlpha=n.alpha,a.rotate(n.rotation),a.scale(n.scaleX,n.scaleY),n.shadow&&(a.shadowColor=n.shadowColor,a.shadowOffsetX=n.shadowOffsetX,a.shadowOffsetY=n.shadowOffsetY,a.shadowBlur=n.shadowBlur),n.blendMode&&(a.globalCompositeOperation=n.blendMode),n.render&&n.render(a),n.children&&n.children.length>0){a.translate(-n.width*n.pivotX,-n.height*n.pivotY);for(var i=0;i<n.children.length;i++){r(n.children[i])}}a.restore()}}},o.assets={toLoad:0,loaded:0,imageExtensions:["png","jpg","gif","webp","svg"],fontExtensions:["ttf","otf","ttc","woff"],audioExtensions:["mp3","ogg","wav","webm"],jsonExtensions:["json"],whenLoaded:void 0,load:function(e){console.log("Loading assets...");var t=this;t.toLoad=e.length,e.forEach(function(e){var a=e.split(".").pop();if(-1!==t.imageExtensions.indexOf(a)){var n=new Image;n.addEventListener("load",function(){n.name=e,t[n.name]={source:n,frame:{x:0,y:0,w:n.width,h:n.height}},t.loadHandler()},!1),n.src=e}else if(-1!==t.fontExtensions.indexOf(a)){var r=e.split("/").pop().split(".")[0],i=document.createElement("style"),s="@font-face {font-family: '"+r+"'; src: url('"+e+"');}";i.appendChild(document.createTextNode(s)),document.head.appendChild(i),t.loadHandler()}else if(-1!==t.audioExtensions.indexOf(a)){var c=o.makeSound(e,t.loadHandler.bind(t));c.name=e,t[c.name]=c}else if(-1!==t.jsonExtensions.indexOf(a)){var l=new XMLHttpRequest,d={};l.open("GET",e,!0),l.addEventListener("readystatechange",function(){200===l.status&&4===l.readyState&&((d=JSON.parse(l.responseText)).name=e,t[d.name]=d,d.frames?t.createTilesetFrames(d,e):t.loadHandler())}),l.send()}else console.log("File type not recognized: "+e)})},createTilesetFrames:function(e,t){var a=this,n=t.replace(/[^\/]*$/,""),r=new Image;r.addEventListener("load",function(){a[n+e.meta.image]={source:r,frame:{x:0,y:0,w:r.width,h:r.height}},Object.keys(e.frames).forEach(function(t){a[t]=e.frames[t],a[t].source=r}),a.loadHandler()},!1),r.src=n+e.meta.image},loadHandler:function(){this.loaded+=1,console.log(this.loaded),this.toLoad===this.loaded&&(this.toLoad=0,this.loaded=0,this.whenLoaded())}},o.keyboard=h,o.makeDisplayObject=d,void 0!==GA.plugins&&GA.plugins(o),void 0!==GA.custom&&GA.custom(o),o},window.ga=GA.create,GA.plugins=function(e){function t(e){e.x+=0|e.vx,e.y+=0|e.vy}e.move=function(e){if(e instanceof Array==!1)t(e);else for(var a=0;a<e.length;a++)t(e[a])},e.randomInt=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},e.randomFloat=function(e,t){return e+Math.random()*(t-e)},e.contain=function(e,t,a,n){var r,i=t.x,o=t.y,s=t.width,c=t.height;return a=a||!1,e.x<i&&(a&&(e.vx*=-1),e.mass&&(e.vx/=e.mass),e.x=i,r="left"),e.y<o&&(a&&(e.vy*=-1),e.mass&&(e.vy/=e.mass),e.y=o,r="top"),e.x+e.width>s&&(a&&(e.vx*=-1),e.mass&&(e.vx/=e.mass),e.x=s-e.width,r="right"),e.y+e.height>c&&(a&&(e.vy*=-1),e.mass&&(e.vy/=e.mass),e.y=c-e.height,r="bottom"),r&&n&&n(r),r},e.hitTestCircle=function(e,t,a){var n,r;return void 0===a&&(a=!1),a?(n=t.gx+t.radius-(e.gx+e.radius),r=t.gy+t.radius-(e.gy+e.radius)):(n=t.centerX-e.centerX,r=t.centerY-e.centerY),Math.sqrt(n*n+r*r)<e.radius+t.radius},e.hitTestRectangle=function(e,t,a){var n,r,i,o;return void 0===a&&(a=!1),!1,a?(i=e.gx+e.halfWidth-(t.gx+t.halfWidth),o=e.gy+e.halfHeight-(t.gy+t.halfHeight)):(i=e.centerX-t.centerX,o=e.centerY-t.centerY),n=e.halfWidth+t.halfWidth,r=e.halfHeight+t.halfHeight,Math.abs(i)<n&&Math.abs(o)<r},e.hitTestCircleRectangle=function(t,a,n){var r,i,o,s,c,l;if(void 0===n&&(n=!1),n?(o=t.gx,s=t.gy,c=a.gx,l=a.gy):(o=t.x,s=t.y,c=a.x,l=a.y),"topMiddle"===(r=s<l-a.halfHeight?o<c-1-a.halfWidth?"topLeft":o>c+1+a.halfWidth?"topRight":"topMiddle":s>l+a.halfHeight?o<c-1-a.halfWidth?"bottomLeft":o>c+1+a.halfWidth?"bottomRight":"bottomMiddle":o<c-a.halfWidth?"leftMiddle":"rightMiddle")||"bottomMiddle"===r||"leftMiddle"===r||"rightMiddle"===r)i=e.hitTestRectangle(t,a,n);else{var d={};switch(r){case"topLeft":d.x=c,d.y=l;break;case"topRight":d.x=c+a.width,d.y=l;break;case"bottomLeft":d.x=c,d.y=l+a.height;break;case"bottomRight":d.x=c+a.width,d.y=l+a.height}i=e.hitTestCirclePoint(t,d,n)}return i?r:i},e.hitTestCirclePoint=function(t,a,n){return void 0===n&&(n=!1),a.diameter=1,a.radius=.5,a.centerX=a.x,a.centerY=a.y,a.gx=a.x,a.gy=a.y,e.hitTestCircle(t,a,n)},e.scaleToWindow=function(t){var a,n,r,i,o;t=t||"#2C3539",a=window.innerWidth/e.canvas.width,n=window.innerHeight/e.canvas.height,r=Math.min(a,n),e.canvas.style.transformOrigin="0 0",e.canvas.style.transform="scale("+r+")","horizontally"===(i=e.canvas.width>e.canvas.height?e.canvas.width*r<window.innerWidth?"horizontally":"vertically":e.canvas.height*r<window.innerHeight?"vertically":"horizontally")&&(o=(window.innerWidth-e.canvas.width*r)/2,e.canvas.style.marginLeft=o+"px",e.canvas.style.marginRight=o+"px"),"vertically"===i&&(o=(window.innerHeight-e.canvas.height*r)/2,e.canvas.style.marginTop=o+"px",e.canvas.style.marginBottom=o+"px"),e.canvas.style.paddingLeft=0,e.canvas.style.paddingRight=0,e.canvas.style.paddingTop=0,e.canvas.style.paddingBottom=0,e.canvas.style.display="block",document.body.style.backgroundColor=t,e.pointer.scale=r,e.scale=r,e.canvas.scaled=!0;var s=navigator.userAgent.toLowerCase();-1!=s.indexOf("safari")&&(s.indexOf("chrome")>-1||(e.canvas.style.maxHeight="100%",e.canvas.style.minHeight="100%"))}};var player,message,introScene,gameOverScene,scoreDisplay,levelDisplay,totalScore,finalLevel,healthBar,signalIndicator,gameScene,carsGroup,initialTime,lastTime,signals=[],cars=[],g=ga(300,300,setup,["images/bob.png","images/cars.png"]),canvasW=g.canvas.width,canvasH=g.canvas.height,blurred=!1,score=0,level=1,playerVelocity=2,levelTime=15e3,signalSpeed=1,signalIterval=2e3,fieldDecayTime=2500,numberOfSignals=6,numberOfCars=1,carHitPenalty=.15;function getDirection(){return g.randomFloat(-1,1)}function drawSprite(e,t=1){var a=g.group(),n=0,r=0;return e.forEach(e=>{e.forEach(e=>{let i=g.rectangle(t,t,e,"",0,n,r);a.addChild(i),n+=t}),r+=t,n=0}),a}function createHealthBar(){var e="transparent",t="black",a="red",n="white",r=drawSprite([[e,t,t,t,t,e,t,t,t,t],[t,a,a,a,a,t,a,a,a,a,t],[t,a,a,a,a,a,a,a,n,a,t],[t,a,a,a,a,a,a,a,n,a,t],[e,t,a,a,a,a,a,n,a,t],[e,e,t,a,a,a,a,a,t],[e,e,e,t,a,a,a,t],[e,e,e,e,t,a,t],[e,e,e,e,e,t]],1);innerBar=g.rectangle(40,15,"seaGreen","",0,15,0),outerBar=g.rectangle(40,15,"rgba(0,0,0,0.5)","",0,15,0),r.y=3,(healthBar=g.group(r,outerBar,innerBar)).inner=innerBar,healthBar.x=60,healthBar.y=5,gameScene.addChild(healthBar)}function createBackground(){var e=g.group(),t=8;g.backgroundColor="gray",[[2,"#484848"],[2,"#a7a7a7"],[1,"#969696"],[1,"#584e47"],[1,"#63564e"],[3,"#7e6d61"],[8,"#917c6f"],[30,"#7e6d61"],[8,"#63554c"],[2,"#645a54"],[1,"#707070"],[1,"#414141"]].forEach(a=>{t+=a[0],e.add(g.rectangle(canvasW-2*t,canvasH,a[1],"",0,t,0))});for(let t=0;t<300;t++){let t=g.randomInt(50,90);e.add(g.rectangle(3,3,`rgb(${t}, ${t}, ${t})`,"",0,g.randomInt(71,canvasW-71),g.randomInt(0,canvasH)))}for(let t=0;t<6;t++)e.add(g.rectangle(4,30,"white","",0,(canvasW-4)/2,10+50*t))}function makeSignal(e){var t="transparent",a="LightSkyBlue",n="Turquoise",r="SteelBlue",i=drawSprite([[t,t,t,t,a,t,t,t,t,t,t,a],[t,t,a,a,t,t,t,t,t,t,t,t,a,a],[t,a,a,t,t,n,t,t,t,t,n,t,t,a,a],[t,a,t,t,n,n,t,t,t,t,n,n,t,t,a],[a,t,t,n,t,t,t,t,t,t,t,t,n,t,t,a],[a,t,n,n,t,r,r,t,t,r,t,t,n,n,t,a],[a,t,n,t,r,r,t,r,r,t,r,r,t,n,t,a],[a,t,n,t,r,r,t,r,r,t,r,r,t,n,t,a],[a,t,n,t,r,r,t,r,r,t,r,r,t,n,t,a],[a,t,n,t,t,r,t,t,t,t,r,t,n,n,t,a],[a,t,n,n,t,r,r,t,t,r,t,t,n,n,t,a],[a,t,t,n,t,t,t,t,t,t,t,t,n,t,t,a],[t,a,t,t,n,n,t,t,t,t,n,n,t,t,a],[t,a,a,t,t,n,t,t,t,t,n,t,t,a,a],[t,t,a,a,t,t,t,t,t,t,t,t,a,a],[t,t,t,t,a,t,t,t,t,t,t,a]]);i.speed=e,i.x=g.randomInt(0,g.canvas.width),i.y=g.randomInt(0,g.canvas.height),i.vy=i.speed*getDirection(),i.vx=i.speed*getDirection(),setInterval(()=>{1===i.scaleX?i.scaleX=i.scaleY=.5:i.scaleX=i.scaleY=1},100),signals.push(i),gameScene.addChild(i)}function createSignalIndicator(){var e=g.rectangle(5,5,"red","",0,17,10),t=g.rectangle(5,7.5,"red","",0,24.5,7.5),a=g.rectangle(5,10,"red","",0,32,5),n=g.rectangle(5,12.5,"red","",0,39.5,2.5),r="red",i="transparent",o=drawSprite([[r,i,i,r,i,i,r],[i,r,i,r,i,r],[i,i,r,r,r],[i,i,i,r],[i,i,i,r],[i,i,i,r]],1.5);o.x=5,o.y=6,(signalIndicator=g.group(o,e,t,a,n)).x=5,signalIndicator.y=4,signalIndicator.bar1=e,signalIndicator.bar2=t,signalIndicator.bar3=a,signalIndicator.bar4=n,signalIndicator.strength=4,signalIndicator.setSignalStrength=function(e){signalIndicator.strength=Math.min(4,Math.max(0,signalIndicator.strength+e));for(let e=1;e<=4;e++)signalIndicator[`bar${e}`].fillStyle=e<=signalIndicator.strength?"red":"transparent"},gameScene.addChild(signalIndicator)}function createSignals(){g.remove(signals),signals=[];var e=setInterval(function(){lastTime||(lastTime=Date.now()),makeSignal(signalSpeed),signals.length>=numberOfSignals&&clearInterval(e)},signalIterval)}function restartSignal(e){e.x=g.randomInt(0,canvasW),e.y=g.randomInt(0,canvasH),e.vx=e.speed*getDirection(),e.vy=e.speed*getDirection()}function createCar(e){var t=e%2,a=g.sprite(t?g.frame("images/cars.png",51,0,50,72):g.frame("images/cars.png",0,0,50,72)),n=a.height,r=t?-n:canvasH+n,i=e>1&&Math.floor(e/2)*n+.4*canvasH||0;a.x=t?75:175,a.y=i,a.vx=0,a.vy=t?2:-2,a.originalY=r,cars.push(a),carsGroup.addChild(a)}function createCars(){g.remove(cars),cars=[];for(let e=0;e<numberOfCars;e++)createCar(e)}function increaseLevel(){var e=levelDisplay.x,t=levelDisplay.y;switch(level++,levelDisplay.content="level: "+level,signalIterval=0,levelDisplay.scaleY=levelDisplay.scaleX=5,g.stage.putCenter(levelDisplay,0,0),setTimeout(()=>{levelDisplay.scaleY=levelDisplay.scaleX=1,levelDisplay.x=e,levelDisplay.y=t},1e3),level){case 2:case 5:case 6:numberOfCars++,createCars();break;case 3:case 7:case 9:--numberOfSignals,createSignals();break;case 4:signalSpeed=2,createSignals();break;case 8:carHitPenalty=.1;break;default:level%2==0?fieldDecayTime*=.8:(signalSpeed+=1,createSignals())}}function setup(){createBackground(),introScene=g.group(g.rectangle(canvasW-80,canvasH-80,"rgba(255,255,255,0.5)","black",3,40,40),g.text("Can you hear me?","18px impact","black",50,50),g.text("You bought the cheapest phone on the","11px impact","black",50,80),g.text("market and you subscribed the cheapest","11px impact","black",50,95),g.text("contract you could find...","11px impact","black",50,110),g.text("now you have to run after the signal","11px impact","black",50,125),g.text("to prevent going offline...","11px impact","black",50,140),g.text("but pay attention not to be","11px impact","black",50,155),g.text("knocked down by a car! Good luck!","11px impact","black",50,170),g.text("Click or press any key to start","11px impact","black",50,200)),g.state=intro,playIntro()}function startGame(){playMainTheme();var e=g.filmstrip("images/bob.png",32,32,0);window.onclick=window.onkeyup=null,introScene.visible=!1,gameScene=g.group(),carsGroup=g.group(),createCars(),(player=g.sprite(e)).setPosition(0,100),player.states={up:7,left:15,down:3,right:11,walkUp:[4,7],walkLeft:[12,15],walkDown:[0,3],walkRight:[8,11]},player.show(player.states.right),["Left","Right"].forEach(e=>{let t="Left"===e?"Right":"Left";g.key[`${e.toLowerCase()}Arrow`].press=function(){player.playSequence(player.states[`walk${e}`]),player.vx="Left"===e?-playerVelocity:playerVelocity,player.vy=0},g.key[`${e.toLowerCase()}Arrow`].release=function(){g.key[`${t.toLowerCase()}Arrow`].isDown||0!==player.vy||(player.vx=0,player.show(player.states[e.toLowerCase()]))}}),["Up","Down"].forEach(e=>{let t="Up"===e?"Down":"Up";g.key[`${e.toLowerCase()}Arrow`].press=function(){player.playSequence(player.states[`walk${e}`]),player.vy="Up"===e?-playerVelocity:playerVelocity,player.vx=0},g.key[`${e.toLowerCase()}Arrow`].release=function(){g.key[`${t.toLowerCase()}Arrow`].isDown||0!==player.vx||(player.vy=0,player.show(player.states[e.toLowerCase()]))}}),scoreDisplay=g.text("score: "+score,"10px impact","white",130,6),levelDisplay=g.text("level: "+level,"10px impact","white",200,6),gameScene.add(player,carsGroup,g.rectangle(canvasW,25,"rgba(0,0,0,0.3)","",0,0,0),scoreDisplay,levelDisplay),createSignals(),createHealthBar(),createSignalIndicator(),message=g.text("Game Over!","30px impact","black",85,g.canvas.height/2-64),totalScore=g.text("","15px impact","black",110,g.canvas.height/2-10),finalLevel=g.text("","15px impact","black",130,g.canvas.height/2+10),(gameOverScene=g.group(g.rectangle(canvasW-80,canvasH-80,"rgba(255,255,255,0.5)","black",3,40,40),message,totalScore,finalLevel,g.text("click or enter to replay","15px impact","black",85,g.canvas.height/2+40))).visible=!1,initialTime=Date.now(),g.state=play}function intro(){introScene.visible=!0,window.onclick=startGame,window.onkeyup=window.onclick}function play(){1==blurred&&(sequence1.gain.gain.value=.1,sequence2.gain.gain.value=.05),g.move(player),g.contain(player,{x:9,y:0,width:canvasW-9,height:canvasH});var e=!1;cars.forEach(function(t){var a=t.originalY<0&&t.y>canvasH||t.y<-t.height;t.visible=!a,t.y=a?t.originalY:t.y+=t.vy,g.hitTestRectangle(player,t)&&(e=!0)}),e?(player.alpha=.3,dashSound(),healthBar.inner.width-=carHitPenalty):player.alpha=1;var t=!1;signals.forEach(function(e){e.x+=e.vx,e.y+=e.vy;var a=g.contain(e,g.stage.localBounds);"top"===a||"bottom"===a?e.vy*=-1:"right"!==a&&"left"!==a||(e.vx*=-1),g.hitTestCircleRectangle(e,player)&&(t=!0,signalIndicator.setSignalStrength(1),score+=10,coinSound(),scoreDisplay.content="score: "+score,restartSignal(e))});var a=Date.now();a-lastTime>fieldDecayTime&&(t||signalIndicator.setSignalStrength(-1),lastTime=a),Math.floor((a-initialTime)/levelTime)>level&&(levelUpSound(),increaseLevel()),(healthBar.inner.width<0||!signalIndicator.strength)&&(g.state=end)}function end(){finalLevel.content="level: "+level,totalScore.content="total score: "+score,gameScene.visible=!1,gameOverScene.visible=!0,window.onclick=function(){window.location.reload()},window.onkeyup=function(e){13===e.keyCode&&window.location.reload()}}window.onblur=muteSound,window.onfocus=setLevels,g.start(),g.scaleToWindow(),window.addEventListener("resize",()=>g.scaleToWindow);