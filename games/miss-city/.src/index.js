"use strict";function id(e){return document.getElementById(e)}function getRandomInt(e,o){return Math.floor(Math.random()*(o-e))+e}function write(e,o){ctx.fillStyle="rgb(0,0,255)",ctx.fillRect(3*box,3*box,18*box,4*box),ctx.font="16px Arial",ctx.fillStyle="black";for(var t=ctx.measureText(e).width,i=[e];t>15*box;){var a=e.length/2;i.push(e.substr(0,a)),i.push(e.substr(a,e.length)),i.shift(),t=ctx.measureText(i[i.length-1])}for(var n=0;n<i.length;n++)ctx.fillText(i[n],3*box,box*(4+n));lock=!0;var c=setInterval(function(){lock||(clearInterval(c),o())},100)}function calculateRandomRoad(){for(var e=city.filter(function(e){return 1===e?!0:!1}),o=getRandomInt(0,e.length),t=0,i=0;o>t;)"1"==city[i]&&t++,i++;var a=i/25>>0,n=i%25;return[n,a]}function key(e,o){if(e.key)switch(e.key){case"w":keys[0]=o;break;case"s":keys[1]=o;break;case"a":keys[2]=o;break;case"d":keys[3]=o}else switch(e.keyCode){case 87:keys[0]=o;break;case 83:keys[1]=o;break;case 65:keys[2]=o;break;case 68:keys[3]=o}}function z1(){actionRadio={prop:30,show:!0,radius:3*box,color:"white",current:0,speed:.25,x:guyX,y:guyY,price:2e3}}function z2(){actionRadio={prop:20,show:!0,radius:4*box,color:"purple",current:0,speed:.15,x:guyX,y:guyY,price:1500}}function z3(){actionRadio={prop:60,show:!0,radius:2*box,color:"orange",current:0,speed:.07,x:guyX,y:guyY,price:4e3}}function z4(){actionRadio={prop:5,show:!0,radius:7*box,color:"brown",current:0,speed:.4,x:guyX,y:guyY,price:2500}}function loop(){if(lock)return void requestAnimationFrame(loop);var e=3*box,o=((new Date).getTime()-lastCalledTime)/1e3;lastCalledTime=Date.now(),ctx.fillStyle="rgb(91, 196, 124)",ctx.fillRect(0,0,id("a").width,3*id("a").width/4);var i=city.map(function(e){switch(e){case 0:return"rgba(91,196,124,1)";case 1:return"rgb(76, 77, 76)";case 2:return{img:house};case 3:return{img:shop};case 4:return{img:factory}}}),a=0,n=0;if(i.forEach(function(e){"object"==typeof e?ctx.drawImage(e.img,a,n,box,box):(ctx.fillStyle=e,ctx.fillRect(a,n,box,box)),a+=box,a+box>id("a").width&&(a=0,n+=box)}),keys[0]&&guyY-1>0&&(guyY-=e*o),keys[1]&&guyY+1<id("a").height&&(guyY+=e*o),keys[2]&&guyX-1>0&&(guyX-=e*o),keys[3]&&guyX+1<id("a").width&&(guyX+=e*o),getRandomInt(0,101)<3){DEBUG_GENERATE_PEOPLE=!1;var c=people.filter(function(e){return!e.show}),r=getRandomInt(0,c.length);if(r>0){c[r].show=!0;var l=calculateRandomRoad(),s=calculateRandomRoad();easystar.findPath(l[0],l[1],s[0],s[1],function(e){c[r].path=e,c[r].pos=0,null==e||void 0==e[0]?(c[r].path=[],c[r].show=!1):(c[r].x=e[0].x,c[r].y=e[0].y)})}}if(easystar.calculate(),people.forEach(function(e){e.show&&(ctx.drawImage(e.img,box*e.x,box*e.y,2*box/3,2*box/3),e.voteChanged&&(ctx.fillStyle="rgba(255,255,0,0.5)",ctx.fillRect(box*e.x,box*e.y,2*box/3,2*box/3)))}),ctx.drawImage(dron,guyX,guyY,2*box/3,2*box/3),actionRadio.show&&(ctx.strokeStyle=actionRadio.color,ctx.lineWidth=1*box/3,ctx.beginPath(),ctx.arc(actionRadio.x,actionRadio.y,actionRadio.current,0,2*Math.PI,!0),ctx.closePath(),ctx.stroke(),actionRadio.current+=actionRadio.speed*box,actionRadio.current>actionRadio.radius)){actionRadio.show=!1,money-=actionRadio.price,0>money&&(write("You have wasted all the money!",function(){window.location.reload()}),gameOver=!0,clearInterval(time));var x=people.map(function(e){return e.show&&actionRadio.x-actionRadio.radius<e.x*box&&e.x*box<actionRadio.x+actionRadio.radius&&actionRadio.y-actionRadio.radius<e.y*box&&e.y*box<actionRadio.y+actionRadio.radius?!0:!1});x.forEach(function(e,o){e===!0&&getRandomInt(0,101)<actionRadio.prop&&1!==people[o].vote&&(people[o].vote=1,people[o].voteChanged=!0)})}var d=people.reduce(function(e,o){return e+o.vote},0);d>50&&(gameOver=!0,write("Yeah!! You have more than a half votes. You can be the next mayor of the city. You have scored: "+money+" points",function(){window.location.reload()}),clearInterval(time)),v=d,ctx.lineWidth=1*box/10,ctx.fillStyle="green",ctx.strokeStyle="black",ctx.strokeRect(0,18*box,5*box,3*box/4),ctx.fillRect(0,18*box,5*box*t/120,3*box/4),ctx.fillStyle="black",ctx.fillText("Time",0,18*box),ctx.fillStyle="red",ctx.strokeStyle="black",ctx.strokeRect(5*box,18*box,5*box,3*box/4),ctx.fillRect(5*box,18*box,5*box*v/51,3*box/4),ctx.fillStyle="black",ctx.fillText("Votes",5*box,18*box),ctx.fillStyle="pink",ctx.strokeStyle="black",ctx.strokeRect(10*box,18*box,5*box,3*box/4),ctx.fillRect(10*box,18*box,5*box*money/2e5,3*box/4),ctx.fillStyle="black",ctx.fillText("Money",10*box,18*box),"ontouchend"in window?(ctx.fillStyle="white",ctx.fillRect(15*box,17*box,2*box,2*box),ctx.fillStyle="purple",ctx.fillRect(17*box,17*box,2*box,2*box),ctx.fillStyle="orange",ctx.fillRect(19*box,17*box,2*box,2*box),ctx.fillStyle="brown",ctx.fillRect(21*box,17*box,2*box,2*box)):ctx.fillText("WASD - Move, VBNM - Different attacks",15*box,18*box+10),gameOver||requestAnimationFrame(loop)}function main(){if(ctx=id("a").getContext("2d"),window.innerHeight/.75%25===0)id("a").height=window.innerHeight,id("a").width=window.innerHeight/.75;else{var e=0;do e++;while(25*e<window.innerHeight);for(;25*(e-1)/.75%25!==0;)e--;id("a").height=25*(e-1),id("a").width=25*(e-1)/.75}box=id("a").width/25,guyX=box,guyY=box,keys[0]=0,keys[1]=0,keys[2]=0,keys[3]=0,ctx.fillStyle="rgb(91, 196, 124)",ctx.fillRect(0,0,id("a").width,3*id("a").width/4),write("Welcome to MissCity - The reversed SsimCity - js13k",function(){write("Look! It's Euralia. It's like the perfect city. Darío Paz is the perfect mayor... but not for us",function(){write("Our company, Encisa, is trying to build a super mall in an old house. ",function(){write("The mayor however has promised that if he wins the elections, he will do a library",function(){write("We must stop it! You have a week (2 minutes) to win the elections. Use our dron!!",function(){})})})})}),time=setInterval(function(){t+=1,120==t&&(write("Elections day! - Darío Paz continues as mayor. You have lost!! Maybe trying again...",function(){window.location.reload()}),gameOver=!0,clearInterval(time))},1e3),window.onkeyup=function(e){lock&&(lock=!1),key(e,0)},window.onkeydown=function(e){if(key(e,1),e.key)switch(e.key){case"v":z1();break;case"b":z2();break;case"n":z3();break;case"m":z4()}else switch(e.keyCode){case 86:z1();break;case 66:z2();break;case 78:z3();break;case 77:z4()}};for(var o=[],i=-1,a=0;a<city.length;a++)a%25==0&&(o.push(new Array),i++),o[i].push(city[a]);easystar.setGrid(o),easystar.setAcceptableTiles([1]);for(var n=0;100>n;n++)people.push({img:boy,vote:0,path:[],pos:0,x:0,y:0,voteChanged:!1});people.forEach(function(e){getRandomInt(1,101)>20?e.vote=0:e.vote=1,1==getRandomInt(1,3)?e.img=boy:e.img=girl}),lastCalledTime=Date.now(),requestAnimationFrame(loop),setInterval(function(){people.forEach(function(e){e.path.length-1>e.pos&&(e.pos++,e.x=e.path[e.pos].x,e.y=e.path[e.pos].y),e.path.length-1==e.pos&&(e.show=!1),e.voteChanged&&(e.voteChanged=!1)})},1e3)}function manageOrientation(){var e=screen.orientation||screen.mozOrientation||screen.msOrientation;e.startsWith("landscape")&&window.location.reload()}var keys=[0,0,0,0],money=2e5,gameOver=!1,time,t=0,v=0,lock=!0,box,ctx,guyX,guyY,lastCalledTime,rotation=0,people=[],actionRadio={show:!1,color:"white",radius:0},DEBUG_GENERATE_PEOPLE=!1,easystar=new EasyStar.js,dron=new Image;dron.src="dron.gif";var boy=new Image,girl=new Image,shop=new Image,factory=new Image,house=new Image;boy.src="boy.gif",girl.src="girl.gif",shop.src="shop.gif",factory.src="factory.gif",house.src="house.gif";var city=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,3,1,2,2,2,2,2,2,2,2,3,3,4,4,4,4,1,4,4,4,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,3,3,4,4,4,4,1,4,4,4,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,3,3,3,3,3,3,1,4,4,4,1,1,1,1,1,1,1,2,2,2,3,3,3,3,1,3,3,3,3,3,3,1,4,4,4,2,2,2,2,2,2,1,2,2,2,3,3,3,3,1,1,1,1,1,1,1,1,4,4,4,2,2,3,3,2,2,1,1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,1,0,1,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,4,1,0,1,2,2,2,1,3,3,3,3,1,2,2,2,2,1,4,4,4,4,4,4,4,4,1,1,1,2,2,1,1,3,3,3,3,1,2,2,2,2,1,4,4,4,4,4,4,4,4,3,1,2,2,2,1,2,2,2,1,1,1,1,1,1,1,1,4,4,4,4,4,4,4,4,3,1,2,2,2,1,2,2,2,1,2,2,2,2,2,2,2,4,4,4,4,4,4,4,4,3,1,1,1,1,1,2,2,2,1,2,2,2,2,2,2,2,4,4,3,3,1,1,1,1,1,1,2,2,2,1,1,1,1,1,2,2,4,4,4,4,4,4,4,4,4,1,2,2,2,2,3,2,2,2,4,4,4,4,1,2,2,4,4,4,4,4,4,4,3,3,1,2,2,2,2,3,0,0,0,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,3,0,0,0,0,0,0,0,1,4,4,4,4,4,4,4,4,4];window.onload=main,window.onorientationchange=manageOrientation,window.screen.onorientationchange=manageOrientation,window.screen.onmozorientationchange=manageOrientation,window.ondevicemotion=function(e){keys[0]=!1,keys[1]=!1,keys[2]=!1,keys[3]=!1,e.accelerationIncludingGravity.x<-4&&(keys[1]=!0),e.accelerationIncludingGravity.x>-2&&(keys[0]=!0),e.accelerationIncludingGravity.y>3&&(keys[2]=!0),e.accelerationIncludingGravity.y<-3&&(keys[3]=!0)},window.onclick=function(){lock&&(lock=!1)},window.ontouchstart=function(e){var o=e.touches[0].clientX,t=e.touches[0].clientY;t>17*box&&(o>15*box&&17*box>o&&z1(),o>17*box&&19*box>o&&z2(),o>19*box&&21*box>o&&z3(),o>21*box&&23*box>o&&z4())},"function"==typeof window.screen.lockOrientation&&window.screen.lockOrientation("landscape"),"function"==typeof window.screen.orientation.lock&&window.screen.orientation.lock("landscape");