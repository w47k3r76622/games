<style> body { background:black; padding:0; margin:0; } #gW { position: relative; max-width: 400px; margin: auto; margin-top: 25px; } #gC { position: absolute; width: 100%; border: 1px solid white; } #gosd { position: absolute; top: 190px; left: 130px; color: white; font-size: 27px; font-family: "papyrus"; } #gosi { background: #4dff88; }</style><body> <div id="gW"> <canvas id="gC" height="420px" width="420px"> </canvas> <div id="gosd" style="display:none"> <span id="gaa" style="font-size:24px">Map Size </span> <input id="gosi" type:"text" value="5" style="width:50px"></input> <br> <span style="font-size:18px; margin-left:35px">(4-20) </span> </div> </div></body>

<script>
var Player=function(){var t=new Actor(0,0,null),s=GAME.gameInstance,l=s.world,r=GAME.canvas,o=GAME.UI.game;t.width=10,t.height=10,t.fillColor="green",t.strokeColor="black",t.alive=!0,t.type="Player",t.moveSpeed=2.5,t.sprintSpeed=3.7,t.HPstart=100,t.HPactual=t.HPstart,t.staminaStart=100,t.staminaActual=t.staminaStart,t.staminaRegenRate=1,t.staminaOverloadTime=20,t.staminaOverloadCounter=0,t.staminaOverload=!1,t.attackCounter=0,t.respawnCounter=0,t.respawnLimit=140,t.disguise=!1,t.disguiseStaminaCost=1,t.atkLevel=1,t.atkEffectCounter=200,t.onInit=function(){t.enableControls(),t.spawnPlayer()};var n=t.update;return t.update=function(){return t.HPactual>t.HPstart&&(t.HPactual=t.HPstart),t.disguise?t.playerDisguise():t.fillColor="green",n(),!1==t.alive?(t.respawnCounter++,10>=t.respawnCounter%20&&t.draw(),void(0==t.respawnCounter%t.respawnLimit&&t.playerRespawn())):void(0>=t.HPactual&&t.playerDeath(),0>=s.map.mobsNumber&&t.checkMapExits(),t.pressingMouseLeft&&0==t.attackCounter%10&&0<t.staminaActual&&(t.performAttack(),t.disguise=!1),0>=t.staminaActual&&t.playerStaminaOverload(),t.staminaActual>=t.staminaStart&&(t.staminaActual=t.staminaStart),t.attackCounter++,0==s.frameCount%t.staminaRegenRate&&!1==t.staminaOverload&&(t.staminaActual+=0.7),0>=t.atkEffectCounter?(t.atkLevel--,t.atkEffectCounter=200):1<t.atkLevel&&t.atkEffectCounter--,1>=t.atkLevel&&(t.atkLevel=1),3<=t.atkLevel&&(t.atkLevel=3))},t.playerDisguise=function(){t.staminaActual-=t.disguiseStaminaCost,t.fillColor="#ff0080"},t.playerRespawn=function(){t.HPactual=t.HPstart,t.staminaActual=t.staminaStart,t.alive=!0,t.respawnCounter=0},t.playerDeath=function(){GAME.mp3.playSound("playerDeath"),t.alive=!1,t.HPactual=0,s.livesNumber--,0>=s.livesNumber&&setTimeout(function(){s.gameOver=!0,o.drawGameOverUI()},1600)},t.playerStaminaOverload=function(){!0==t.disguise&&(t.disguise=!1),t.staminaActual=0,t.staminaOverload=!0,t.staminaOverloadCounter++,0==t.staminaOverloadCounter%t.staminaOverloadTime&&(t.staminaOverload=!1)},t.spawnPlayer=function(){for(var p=0;p<s.world.maps.length;p++)for(var g,m=0;m<s.world.maps[p].length;m++)g=s.world.maps[m][p],g.spawnPlayer&&(s.map=g);var d=s.map.roomsList,h=d[0];do{var u=(h.x1+h.x2)/2,c=(h.y1+h.y2)/2;t.x=u,t.y=c}while(!0==t.isOutWalkableArea())},t.enableControls=function(){document.onmousedown=function(p){1===p.which?t.pressingMouseLeft=!0:t.pressingMouseRight=!0},document.onmouseup=function(p){1===p.which?t.pressingMouseLeft=!1:t.pressingMouseRight=!1},document.oncontextmenu=function(p){p.preventDefault()},document.onmousemove=function(p){var m=r.getBoundingClientRect(),g=r.width/m.width,d=r.height/m.height,h=(p.clientX-r.getBoundingClientRect().left)*g,u=(p.clientY-r.getBoundingClientRect().top)*d;h-=t.x,u-=t.y,t.aimAngle=180*(Math.atan2(u,h)/Math.PI)},document.onkeypress=function(p){s.finished||s.gameOver||(("m"==p.key||"M"==p.key)&&s.miniMap.open(),32==p.keyCode&&(!0==t.disguise?t.disguise=!1:!1==t.disguise&&20<=t.staminaActual&&t.alive&&(t.disguise=!0)))},document.onkeydown=function(p){return GAME.states.on_menu?void 0:s.finished||s.gameOver?void GAME.changeState("on_menu"):void(68===p.keyCode?t.pressingRight=!0:83===p.keyCode?t.pressingDown=!0:65===p.keyCode?t.pressingLeft=!0:87===p.keyCode?t.pressingUp=!0:16===p.keyCode&&(t.pressingShift=!0))},document.onkeyup=function(){68===event.keyCode?t.pressingRight=!1:83===event.keyCode?t.pressingDown=!1:65===event.keyCode?t.pressingLeft=!1:87===event.keyCode?t.pressingUp=!1:16===event.keyCode&&(t.pressingShift=!1)}},t.checkMapExits=function(){var p=t.getBody();if(!1!=m){var m=JSON.parse(JSON.stringify(s.map.passages.upperPassage));m.y-=9,testCollisionRectRect(p,m)&&l.changeMap("top")}if(!1!=g){var g=JSON.parse(JSON.stringify(s.map.passages.leftPassage));g.x-=9,testCollisionRectRect(p,g)&&l.changeMap("left")}if(!1!=d){var d=JSON.parse(JSON.stringify(s.map.passages.bottomPassage));d.y+=29,testCollisionRectRect(p,d)&&l.changeMap("bottom")}if(!1!=h){var h=JSON.parse(JSON.stringify(s.map.passages.rightPassage));h.x+=29,testCollisionRectRect(p,h)&&l.changeMap("right")}},t.performAttack=function(){t.staminaActual-=7.7;var p=5*Math.cos(t.aimAngle/180*Math.PI),m=5*Math.sin(t.aimAngle/180*Math.PI),g=new PlayerBullet(t.x,t.y,p,m,s.map.id,t.atkLevel);t.attackCounter=0},t.isOutWalkableArea=function(){var p=t.getBodyBumpers();return 0!=s.map.isWalkablePosition(p.right)||0!=s.map.isWalkablePosition(p.left)||0!=s.map.isWalkablePosition(p.top)||0!=s.map.isWalkablePosition(p.bot)?!1:!0},t},MiniMap=function(){var t=GAME.canvas,s=GAME.ctx,l=GAME.gameInstance,r=l.world,o=r.maps,n={width:t.width,height:t.height,mapSize:null,tileSize:null,offSet:10};return n.mapSize=n.width/o.length,n.tileSize=l.tileSize*n.mapSize/n.width,n.sizeIncrease=o.length/1.5,n.open=function(){if(!(0<l.mapActualCD)){!0==l.paused&&(l.mapActualCD=l.mapStartCD),l.paused=!l.paused,s.save(),s.fillStyle="#b3ffec",s.fillRect(0,0,n.width,n.height);for(var m,p=0;p<o.length;p++){m=n.tileSize*p;for(var d,g=0;g<o[p].length;g++){d=o[p][g].mapArray;for(var h=0;h<d.length;h++)for(var u=0;u<d[h].length;u++)s.fillStyle="#33ccff","0"==d[h][u]?s.fillRect(g*n.mapSize+u*n.tileSize,p*n.mapSize+h*n.tileSize-m+n.offSet,n.tileSize,n.tileSize):(s.fillStyle="white",s.fillRect(g*n.mapSize+u*n.tileSize,p*n.mapSize+h*n.tileSize-m+n.offSet,n.tileSize,n.tileSize));s.strokeRect(g*n.mapSize,p*n.mapSize-m+n.offSet,n.mapSize,n.mapSize-n.tileSize)}}for(var m,c=l.player,f=c.width*n.mapSize/n.width,w=r.collectibles,S=15*n.mapSize/n.width,C=r.finish,P=30*n.mapSize/n.width,p=0;p<o.length;p++){m=n.tileSize*p;for(var g=0;g<o[p].length;g++){if(o[p][g].id==l.map.id){var z={x:g,y:p};s.fillStyle="green",s.fillRect(z.x*n.mapSize+c.x*n.mapSize/n.width,z.y*n.mapSize+c.y*n.mapSize/n.height-m+n.offSet,f*n.sizeIncrease,f*n.sizeIncrease)}if(o[p][g].id==l.finish.mapId){var I={x:g,y:p},C=l.finish;s.fillStyle="#004d00",s.fillRect(I.x*n.mapSize+C.x*n.mapSize/n.width,I.y*n.mapSize+C.y*n.mapSize/n.height-m+n.offSet,P*n.sizeIncrease,P*n.sizeIncrease)}for(var A in Collectible.list)if(o[p][g].id==Collectible.list[A].mapId){var v=Collectible.list[A];if(v.collected)continue;var R={x:g,y:p};s.fillStyle="#ffcc00",s.fillRect(R.x*n.mapSize+v.x*n.mapSize/n.width,R.y*n.mapSize+v.y*n.mapSize/n.height-m+n.offSet,S*n.sizeIncrease,S*n.sizeIncrease)}}}s.restore()}},n},MenuUI=function(){var t=GAME.canvas,s=GAME.ctx,l=GAME.images;return self.draw=function(){s.save(),self.drawBackground(),self.drawTitle(),self.drawMapSizeOption(),self.drawPlayButton(),s.restore()},self.drawBackground=function(){for(var r=t.width/30,o=t.height/30,n=0;n<o;n++)for(var p=0;p<r;p++)n==o-1||0==n?(6==p||7==p)&&n==o-1?s.drawImage(l.terrain,30*p,30*n):s.drawImage(l.wall,30*p,30*n):s.drawImage(l.water,30*p,30*n);s.globalAlpha=0.7,s.fillStyle="green",s.fillRect(180,t.height-6,60,6),s.globalAlpha=1},self.drawTitle=function(){s.font="56px papyrus",s.fillStyle="white",s.fillText("Forgotten island",12,100),s.font="24px papyrus",s.fillText("- by PhasedEvolution",57,140)},self.drawMapSizeOption=function(){document.getElementById("gosd").style.display="block"},self.drawPlayButton=function(){s.fillStyle="#ff1a1a",s.fillRect((t.width-200)/2,307,200,50),s.font="30px Arial",s.fillStyle="white",s.fillText("Play",(t.width-200)/2+70,344)},self},GameUI=function(){var t=GAME.canvas,s=GAME.ctx,l=GAME.gameInstance,r=GAME.images,o={playTime:{parseGametime:function(n){var p=Math.floor(n/60),m=Math.floor(p/60);n%=60,p%=60;var g=(m?9<m?m:"0"+m:"00")+":"+(p?9<p?p:"0"+p:"00")+":"+(9<n?n:"0"+n);return g}}};return o.draw=function(){s.save(),o.drawBottomContainer(),o.drawHp(),o.drawStamina(),o.drawMapIcon(),o.drawLivesStats(),o.drawCollectiblesStats(),o.drawGameTime(),o.drawAtkEffect(),s.restore()},o.drawBottomContainer=function(){s.fillStyle="brown",s.fillRect(0,t.height-l.tileSize,t.width,l.tileSize),s.strokeRect(0,t.height-l.tileSize,t.width,l.tileSize)},o.drawHp=function(){var n=l.player;s.fillStyle="white",s.fillRect(5,t.height-26,150,9),s.fillStyle="red",s.fillRect(5,t.height-26,150*(n.HPactual/n.HPstart),9),s.strokeRect(5,t.height-26,150,9)},o.drawStamina=function(){var n=l.player;s.fillStyle="white",s.fillRect(5,t.height-12,150,9),s.fillStyle="green",s.fillRect(5,t.height-12,150*(n.staminaActual/n.staminaStart),9),s.strokeRect(5,t.height-12,150*(n.staminaActual/n.staminaStart),9)},o.drawLivesStats=function(){var n,p;10<=l.livesNumber?(p=175,n=p-4):(p=165,n=p+11);var m=r.heart;s.drawImage(m,165,t.height-30,1.1*m.width,1.1*m.height),s.font="15px Arial",s.fillStyle="white",s.fillText(l.livesNumber,n,t.height-30+20)},o.drawMapIcon=function(){s.fillStyle="#b3ffff",s.fillRect(300,t.height-27,24,24),s.strokeColor="black",s.strokeRect(300,t.height-27,24,24),s.font="24px Arial",s.fillStyle="#ffcc00",s.fillText("M",302,t.height-27+20);var n=24*(l.mapActualCD/l.mapStartCD);s.save(),s.globalAlpha="0.8",s.fillStyle="#ff6666",s.fillRect(300,t.height-27,n,24),s.restore()},o.drawCollectiblesStats=function(){var n,p;10<=l.startCollectiblesNumber?(p=385,n=p-43):(p=385,n=p-33),s.fillStyle="#ffcc00",s.fillRect(p,t.height-24,18,18),s.strokeStyle="black",s.strokeRect(p,t.height-24,18,18),s.font="20px Arial",s.fillStyle="white";var m=l.startCollectiblesNumber-l.actualCollectiblesNumber;s.fillText("x "+m,n,t.height-24+15.5)},o.drawGameTime=function(){var n=o.playTime;s.font="26px Arial",s.fillStyle="white",s.fillText(n.parseGametime(l.gameTime),160,33)},o.drawFinishUI=function(){s.fillStyle="#4d88ff",s.fillRect((t.width-300)/2,130,300,120),s.font="40px papyrus",s.fillStyle="#ffd11a",s.fillText("Congratulations!",(t.width-300)/2+5,168),s.fillStyle="black",s.font="25px papyrus",s.fillText("Press any key...",(t.width-300)/2+63,230)},o.drawGameOverUI=function(){s.fillStyle="#888844",s.fillRect((t.width-300)/2,130,300,120),s.font="40px papyrus",s.fillStyle="#ff0000",s.fillText("Game Over!",(t.width-300)/2+40,168),s.fillStyle="white",s.font="25px papyrus",s.fillText("Press any key...",(t.width-300)/2+63,230)},o.drawAtkEffect=function(){var n=l.player;s.font="15px papyrus",s.fillStyle="white",s.fillText("ATK",210,t.height-11),s.font="23px papyrus",s.fillText("x"+n.atkLevel,260,t.height-11+2)},o};function HandleCanvasClicks(){var t=GAME.canvas,s=t.getBoundingClientRect(),l=GAME.UI.menu,r=l.playButton,o=t.width/s.width,n=t.height/s.height;t.onclick=function(p){var m=(p.clientX-s.left)*o,g=(p.clientY-s.top)*n;!0==GAME.states.on_menu&&m>=(t.width-200)/2&&m<=(t.width-200)/2+200&&307<=g&&g<=357&&GAME.changeState("on_game")}}var World=function(t){var s=GAME.gameInstance,l={maps:[],worldSize:t,changeMapFlag:!0,changeMapCounter:0};return l.update=function(){l.updateMap()},l.createMaps=function(){for(var r=l.randSpecialMaps(),o=0;o<l.worldSize;o++){l.maps.push([]);for(var n=0;n<l.worldSize;n++){for(var p=!1,m=!1,g=0;g<r.length;g++)r[g].y==o&&r[g].x==n&&(r[g].finish&&(m=!0),r[g].collectible&&(p=!0));if(0<o){var d=JSON.parse(JSON.stringify(l.maps[o-1][n].passages.bottomPassage));d.y=0}else var d=!1;if(0<n){var h=JSON.parse(JSON.stringify(l.maps[o][n-1].passages.rightPassage));h.x=0}else var h=!1;if(o+1==l.worldSize)var u=!1;else var u=!0;if(n+1==l.worldSize)var c=!1;else var c=!0;var w=new _Map({upperPassage:d,leftPassage:h,bottomPassage:u,rightPassage:c},p,m);w.onInit(),l.maps[o].push(w)}}},l.updateMap=function(){s.map.update(),l.changeMapCounter++,!1==l.changeMapFlag&&10<=l.changeMapCounter&&(l.changeMapFlag=!0)},l.changeMap=function(r){for(var o=0;o<l.maps.length;o++)for(var n=0;n<l.maps[o].length;n++)if(l.maps[o][n].id==s.map.id){if(!1==l.changeMapFlag)break;var p={x:n,y:o};"top"==r?(s.map=l.maps[p.y-1][n],s.player.y=s.map.passages.bottomPassage.y+s.player.height,!0==s.player.isOutWalkableArea()&&(s.player.x=s.map.passages.bottomPassage.x)):"bottom"==r?(s.map=l.maps[p.y+1][n],s.player.y=s.map.passages.upperPassage.y,!0==s.player.isOutWalkableArea()&&(s.player.x=s.map.passages.upperPassage.x)):"left"==r?(s.map=l.maps[p.y][n-1],s.player.x=s.map.passages.rightPassage.x+s.player.width+5,!0==s.player.isOutWalkableArea()&&(s.player.y=s.map.passages.rightPassage.y)):"right"==r&&(s.map=l.maps[p.y][n+1],s.player.x=s.map.passages.leftPassage.x,!0==s.player.isOutWalkableArea()&&(s.player.y=s.map.passages.leftPassage.y)),l.changeMapFlag=!1,l.changeMapCounter=0}},l.randSpecialMaps=function(){var r=[];do{var o=getRandomInt(0,l.worldSize-1),n=getRandomInt(0,l.worldSize-1),p={y:o,x:n};r.length==l.worldSize?p.finish=!0:p.collectible=!0,!1==checkArrayHasMap(r,p)&&r.push(p)}while(r.length<=l.worldSize);return r},l};function checkArrayHasMap(t,s){for(var l=0;l<t.length;l++)if(t[l].x==s.x&&t[l].y==s.y)return!0;return!1}var TurretBullet=function(t,s,l,r,o,n){var p=GAME.gameInstance,m=GAME.canvas,g=new Bullet(t,s,n);return g.width=6,g.height=6,g.speedX=r,g.speedY=o,g.orientation=l,g.damage=20,g.fillColor="red",g.strokeColor="black",g.type="TurretBullet",g.update(),TurretBullet.list[g.id]=g,g};TurretBullet.list={};var PlayerBullet=function(t,s,l,r,o,n){var p=new Bullet(t,s,o),m=GAME.gameInstance;if(1==n)var g="#666699",d=3,h=5;else if(2==n)var g="#6600cc",d=6,h=7;else if(3==n)var g="#9900ff",d=9,h=9;p.type="PlayerBullet",p.orientation="angle",p.speedX=l,p.speedY=r,p.fillColor=g,p.strokeColor="black",p.width=h,p.height=h,p.damage=d,p.impactEffect=5;var u=p.update;return p.update=function(){u(),p.checkCollisionMobs(),p.checkCollisionTurrets()},p.checkCollisionMobs=function(){for(var c in Mob.list){var f=Mob.list[c];f.mapId==p.mapId&&testCollisionRectRect(f.getBody(),p.getBody())&&(f.hp-=p.damage,f.state="rage",p.impactMob(f))}},p.checkCollisionTurrets=function(){for(var c in TerrainTurret.list){var f=TerrainTurret.list[c];f.mapId==p.mapId&&testCollisionRectRect(f.getBody(),p.getBody())&&(f.HPactual-=p.damage,p.toRemove=!0)}},p.impactMob=function(c){var f=c.getBodyBumpers();0!=m.map.isWalkablePosition(f.right)&&p.x<=c.x&&(c.x+=p.impactEffect),0!=m.map.isWalkablePosition(f.left)&&p.x>=c.x+c.width/2&&(c.x-=p.impactEffect),0!=m.map.isWalkablePosition(f.bot)&&p.y<=c.y&&(c.y+=p.impactEffect),0!=m.map.isWalkablePosition(f.top)&&p.y>=c.y&&(c.y-=p.impactEffect),p.toRemove=!0},PlayerBullet.list[p.id]=p,p};PlayerBullet.list={};var Collectible=function(t,s,l){var r=new Entity(t,s,l);r.fillColor="#ffcc00",r.strokeColor="black",r.width=15,r.height=15,r.type="Collectible",r.collected=!1;var o=r.update;return r.update=function(){o()},Collectible.list[r.id]=r,r};Collectible.list={};var Boost=function(t,s,l,r){var o=new Entity(t,s,l);"HP"==r?(o.fillColor="green",o.HPeffect=6,o.type="HPCollectible"):"ATK"==r&&(o.fillColor="#66ffff",o.strokeColor="black",o.type="AtkCollectible"),o.strokeColor="black",o.width=5,o.height=5;var n=o.update;return o.update=function(){n()},Boost.list[o.id]=o,o};Boost.list={};var Mob=function(t,s,l,r){var o=new Actor(t,s,l),n=GAME.gameInstance,p=getRandomInt(11,18);o.width=p,o.height=p,o.hp=1.5*p,o.damage=0.3*p,o.moveSpeed=18/p,o.fillColor="red",o.strokeColor="black",o.room=r,o.moveLimits=getRandomInt(3,150),o.moveCount=0,o.moveCountReset=getRandomInt(30,80),o.state="neutral",o.type="Mob",o.rageCounter=0;var m=o.update;return o.update=function(){m(),0==n.frameCount%20&&o.checkCollisionPlayer(),0>=o.hp&&o.mobDeath(),o.move(),o.moveCount++},o.mobDeath=function(){GAME.mp3.playSound("enemyDeath"),o.toRemove=!0,n.map.mobsNumber--;var g=getRandomInt(0,4);if(0==g)new Boost(o.x,o.y,o.mapId,"HP");else if(1==g)new Boost(o.x,o.y,o.mapId,"ATK")},o.move=function(){var g=n.player;if("rage"==o.state?(o.rageCounter++,0==o.rageCounter%300&&(o.state="neutral")):80<getDistanceBetween(g,o)?o.state="neutral":o.state="chase",g.disguise&&(o.state="neutral"),"neutral"==o.state){if(0==o.moveCount%o.moveCountReset){var d=getRandomInt(0,2),h=getRandomInt(0,2);o.pressingDown=!1,o.pressingUp=!1,o.pressingLeft=!1,o.pressingRight=!1,0==d&&(o.pressingDown=!0),1==d&&(o.pressingUp=!0),0==h&&(o.pressingLeft=!0),1==h&&(o.pressingRight=!0),o.moveCount=0,o.moveCountReset=getRandomInt(30,80),o.moveLimits=getRandomInt(3,150)}}else if("chase"==o.state||"rage"==o.state){var u=g.x-o.x,c=g.y-o.y;o.pressingRight=3<u,o.pressingLeft=-3>u,o.pressingDown=3<c,o.pressingUp=-3>c}},Mob.list[o.id]=o,o};Mob.list={};var TerrainTurret=function(t,s,l,r,o){var n=new Turret(t,s,l),p=GAME.gameInstance;n.bulletsSpeed=1,n.fireRate=getRandomInt(20,70),n.specialFireRate=getRandomInt(5,15),n.room=o,n.aimAngle=0,n.fillColor="#b30000",n.strokeColor="black",n.width=25,n.height=25,n.HPstart=getRandomInt(30,40),n.HPactual=n.HPstart,n.type="TerrainTurret";var m=n.update;return n.update=function(){m();p.player;0>=n.HPactual&&n.turretDestruction()},n.turretDestruction=function(){n.toRemove=!0,GAME.mp3.playSound("enemyDeath")},n.shoot=function(){var g=p.player,d=g.x-g.width-n.x,h=g.y-g.height-n.y;n.aimAngle=180*(Math.atan2(h,d)/Math.PI),0>n.aimAngle&&(n.aimAngle=360+n.aimAngle);var u=0.4*(5*Math.cos(n.aimAngle/180*Math.PI)*n.bulletsSpeed),c=0.4*(5*Math.sin(n.aimAngle/180*Math.PI)*n.bulletsSpeed),f=new TurretBullet(n.x+n.width/2,n.y+n.height/2,"angle",u,c,n.mapId)},n.specialShoot=function(){for(var g=0;360>g;g+=360/n.specialFireRate){var d=0.4*(5*Math.cos(g/180*Math.PI)*n.bulletsSpeed),h=0.4*(5*Math.sin(g/180*Math.PI)*n.bulletsSpeed),u=new TurretBullet(n.x+n.width/2,n.y+n.height/2,"angle",d,h,n.mapId);n.specialFireRate=getRandomInt(5,15)}},n.getDistanceRoomLimits=function(){var g={x:n.room.x1,y:n.room.y1},d=getDistanceBetween(n,g);return d},TerrainTurret.list[n.id]=n,n};TerrainTurret.list={};var WallTurret=function(t,s,l,r){var n=GAME.gameInstance,p=new Turret(t,s,r);p.orientation=l,p.bulletsSpeed=getRandomInt(1,2),p.fireRate=getRandomInt(70,100),p.fillColor="black",p.strokeColor="grey",p.type="WallTurret","top"==p.orientation||"bot"==p.orientation?(p.height=3,p.width=15,p.x+=(p.tileSize-p.width)/2,"bot"==p.orientation&&(p.y+=p.tileSize-p.height),"top"==p.orientation&&(p.y-=p.tileSize/3)):("left"==p.orientation||"right"==p.orientation)&&(p.height=15,p.width=3,p.y+=(p.tileSize-p.height)/2,"right"==p.orientation&&(p.x+=p.tileSize-p.width));var m=p.update;return p.update=function(){m()},p.shoot=function(){if("bot"==p.orientation||"top"==p.orientation){var d,g=(2*p.x+p.width-5)/2;d="top"==p.orientation?p.y+10:p.y;var h=new TurretBullet(g,d,p.orientation,0,p.bulletsSpeed,p.mapId)}else if("right"==p.orientation||"left"==p.orientation)var g=(2*p.y+p.height-5)/2,h=new TurretBullet(p.x,g,p.orientation,p.bulletsSpeed,0,p.mapId)},WallTurret.list[p.id]=p,p};WallTurret.list={};var Entity=function(t,s,l){var r=GAME.ctx,o=GAME.gameInstance,n={id:Math.random(),mapId:l,tileSize:o.tileSize,x:t,y:s};return n.update=function(){n.draw(),("Finish"==n.type||"Collectible"==n.type||"HPCollectible"==n.type||"AtkCollectible"==n.type)&&n.checkCollisionPlayer()},n.draw=function(){r.save(),r.fillStyle=n.fillColor,r.fillRect(n.x,n.y,n.width,n.height),r.strokeStyle=n.strokeColor,r.strokeRect(n.x,n.y,n.width,n.height),r.restore()},n.getBody=function(){var p={x:n.x,y:n.y,width:n.width,height:n.height};return p},n.checkCollisionPlayer=function(){var p=o.player;if(testCollisionRectRect(p.getBody(),n.getBody())&&!1!=p.alive){if("Finish"==n.type)return void(o.actualCollectiblesNumber==o.startCollectiblesNumber&&setTimeout(function(){o.finished=!0,GAME.UI.game.drawFinishUI()},1400));if("TurretBullet"==n.type||"Mob"==n.type){if(p.disguise&&"Mob"==n.type)return;if(p.HPactual-=n.damage,"Mob"==n.type)return}else"HPCollectible"==n.type?(p.HPactual+=n.HPeffect,GAME.mp3.playSound("powerUp")):"AtkCollectible"==n.type&&(p.atkLevel++,GAME.mp3.playSound("powerUp"));n.toRemove=!0}},n};Entity.update=function(t){var s=GAME.gameInstance;for(var l in t.list)t.list[l].mapId==s.map.id&&t.list[l].update();for(var l in t.list)t.list[l].toRemove&&(delete t.list[l],t==TerrainTurret&&s.turretsDestroyed++,t==Mob&&s.mobsKilled++,t==Collectible&&s.actualCollectiblesNumber++)};var Bullet=function(t,s,l){var r=new Entity(t,s,l),o=GAME.canvas,n=GAME.gameInstance,p=r.update;return r.update=function(){p();var m=n.player;!1==m.alive||("PlayerBullet"!=r.type&&r.checkCollisionPlayer(),r.updatePosition(),r.checkCollisionMap())},r.updatePosition=function(){"top"==r.orientation?r.y+=r.speedY:"right"==r.orientation?r.x-=r.speedX:"bot"==r.orientation?r.y-=r.speedY:"left"==r.orientation?r.x+=r.speedX:"angle"==r.orientation&&(r.y+=r.speedY,r.x+=r.speedX)},r.checkCollisionMap=function(){var m={x:r.x+r.width/2,y:r.y+r.height/2};(r.x>=o.width||0>=r.x||r.y>=n.mapHeight||0>=r.y||0==n.map.isWalkablePosition(m))&&(r.toRemove=!0)},r},Actor=function(t,s,l){var r=new Entity(t,s,l),o=GAME.gameInstance,n=r.update;return r.update=function(){var p=o.player;return!1==p.alive?("Mob"!=r.type&&r.updatePosition(),void("Player"!=r.type&&n())):void(n(),r.updatePosition())},r.updatePosition=function(){var p=r.getBodyBumpers(),m=r.moveSpeed;"Player"==r.type&&r.pressingShift&&0<r.staminaActual&&!0==r.alive&&(m=r.sprintSpeed,r.staminaActual-=1),0!=o.map.isWalkablePosition(p.right)&&r.pressingRight&&(r.x+=m),0!=o.map.isWalkablePosition(p.left)&&r.pressingLeft&&(r.x-=m),0!=o.map.isWalkablePosition(p.top)&&r.pressingUp&&(r.y-=m),0!=o.map.isWalkablePosition(p.bot)&&r.pressingDown&&(r.y+=m)},r.getBodyBumpers=function(){var p={x:r.x+r.width/2,y:r.y},m={x:r.x+r.width/2,y:r.y+r.height},g={x:r.x,y:r.y+r.height/2},d={x:r.x+r.width,y:r.y+r.height/2};return{top:p,bot:m,left:g,right:d}},r},Turret=function(t,s,l){var r=new Entity(t,s,l),o=GAME.gameInstance,n=r.update;return r.update=function(){var p=o.player;!1!=p.alive&&!1==p.disguise&&r.checkShoot(p),n()},r.checkShoot=function(p){0==o.frameCount%r.fireRate&&!1!=p.alive&&("WallTurret"==r.type?r.shoot():getDistanceBetween(p,r)<=r.getDistanceRoomLimits()&&"TerrainTurret"==r.type&&(0==getRandomInt(0,5)?r.specialShoot():r.shoot()))},r},Finish=function(t,s,l){var r=GAME.gameInstance,o=new Entity(t,s,l);o.fillColor="#004d00",o.strokeColor="white",o.width=30,o.height=30,o.type="Finish";var n=o.update;return o.update=function(){r.map.id==o.mapId&&n()},o},_Map=function(t,s,l,r){var o=GAME.canvas,n=GAME.ctx,p=GAME.gameInstance,m=GAME.images,g=p.world,d=g.maps,h={id:Math.random(),tileSize:p.tileSize,roomsNumber:getRandomInt(1,10),wallTurretsNumber:null,mobsNumber:null,roomsList:[],mapArray:[],numWalkTiles:null,wallsIndexes:[],passages:t,collectible:s,finish:l,spawnPlayer:!1,passagesSound:!1};return h.tileNumberX=p.mapWidth/h.tileSize,h.tileNumberY=p.mapHeight/h.tileSize,h.onInit=function(){h.fillTerrain(),h.createRooms();var u=new Corridors(h);u.createCorridors(),h.assignWallIndexes(),!0==r||(h.getWalkTilesNumber(),h.assignPlayerSpawnMap(),!h.spawnPlayer&&(6>=getRandomInt(0,10)&&h.createWallTurrets(),5>=getRandomInt(0,10)&&h.createMobs(),10>=getRandomInt(0,10)&&h.createTerrainTurrets(),h.collectible&&h.spawnCollectible(),h.finish&&h.spawnFinish()))},h.update=function(){h.drawRestrictedArea(),h.drawWallsWalkableArea(),h.drawPassageSigns()},h.assignPlayerSpawnMap=function(){if(!0!=h.collectible&&!0!=h.finish){h.spawnPlayer=!0;for(var u=0;u<d.length;u++)for(var c=0;c<d[u].length;c++)!0==d[u][c].spawnPlayer&&(h.spawnPlayer=!1)}},h.fillTerrain=function(){for(var u=0;u<h.tileNumberY;u++){h.mapArray.push([]);for(var c=0;c<h.tileNumberX;c++)h.mapArray[u].push("0")}},h.createRooms=function(){var u=0;do{for(var c=h.getRoomValues(),f=!1,w=new Room(c,h.tileSize,h.mapArray),S=0;S<h.roomsList.length;S++)if(w.checkRoomIntersection(h.roomsList[S])){f=!0;break}!1==f?(w.addToMapArray(),h.roomsList.push(w),u=0):(u++,console.log(u))}while(h.roomsList.length<h.roomsNumber&&2e3<=u)},h.getRoomValues=function(){var u=30*getRandomInt(2,8),c=30*getRandomInt(2,8);do var f=getRandomInt(0,p.mapWidth-h.tileSize);while(0!=f%30||u+f>o.width);do var w=getRandomInt(0,p.mapHeight-h.tileSize);while(0!=w%30||c+w>p.mapHeight);return{x:f,y:w,width:u,height:c}},h.drawRestrictedArea=function(){for(var u=0;u<h.mapArray.length;u++)for(var c=0;c<h.mapArray[u].length;c++)"0"==h.mapArray[u][c]&&n.drawImage(m.water,c*h.tileSize,u*h.tileSize)},h.drawWallsWalkableArea=function(){for(var c=h.tileSize,f=h.mapArray,w=0;w<f.length;w++)for(var S=0;S<f[w].length;S++)"0"!=f[w][S]&&(n.drawImage(m.terrain,S*c,w*c),0<=w-1&&0<=S-1&&w+1<f.length&&S+1<f[w].length&&("1.1"==f[w][S]&&"0"==f[w][S-1]&&"0"==f[w][S+1]&&DrawWall(m.wall,(S-1)*c,w*c),"1.0"==f[w][S]&&"0"==f[w-1][S]&&"0"==f[w+1][S]&&DrawWall(m.wall,S*c,(w+1)*c),"1.0"==f[w][S]&&"0"==f[w-1][S]?("0"==f[w][S-1]?(DrawWall(m.wall,(S-1)*c,w*c),DrawWall(m.wall,(S-1)*c,(w-1)*c)):"0"==f[w][S+1]&&(DrawWall(m.wall,(S+1)*c,w*c),DrawWall(m.wall,(S+1)*c,(w-1)*c)),DrawWall(m.wall,S*c,(w-1)*c)):"1.2"==f[w][S]&&"0"==f[w+1][S]&&("0"==f[w][S-1]?(DrawWall(m.wall,(S-1)*c,w*c),DrawWall(m.wall,(S-1)*c,(w+1)*c)):"0"==f[w][S+1]&&(DrawWall(m.wall,(S+1)*c,w*c),DrawWall(m.wall,(S+1)*c,(w+1)*c)),DrawWall(m.wall,S*c,(w+1)*c))),"1.0"==f[w][S]&&DrawWall(m.wall,S*c,(w-1)*c),"1.1"==f[w][S]&&DrawWall(m.wall,(S+1)*c,w*c),"1.2"==f[w][S]&&DrawWall(m.wall,S*c,(w+1)*c),"1.3"==f[w][S]&&DrawWall(m.wall,(S-1)*c,w*c))},h.isWalkablePosition=function(u){var c=Math.floor(u.x/h.tileSize),f=Math.floor(u.y/h.tileSize);return isNaN(c)||isNaN(f)?!1:0>c||c>=h.mapArray[0].length?!1:0>f||f>=h.mapArray.length?!1:h.mapArray[f][c]},h.assignWallIndexes=function(){for(var u=0;u<h.mapArray.length;u++)for(var c=0;c<h.mapArray[u].length;c++)if("2.0"==h.mapArray[u][c]){var f=!1;if(0==u||"0"==h.mapArray[u-1][c]){var w="top";h.mapArray[u][c]="1.0",f=!0}else if(u==h.mapArray.length-1||"0"==h.mapArray[u+1][c]){var w="bot";h.mapArray[u][c]="1.2",f=!0}else if(c==h.mapArray[u].length-1||"0"==h.mapArray[u][c+1]){var w="right";h.mapArray[u][c]="1.1",f=!0}else if(0==c||"0"==h.mapArray[u][c-1]){var w="left";h.mapArray[u][c]="1.3",f=!0}!0==f&&0!=c&&c!=h.mapArray[u].length-1&&0!=u&&u!=h.mapArray.length-1&&!1==h.isPassagePosition(c,u)&&h.wallsIndexes.push({x:c,y:u,orientation:w,turret:!1})}},h.isPassagePosition=function(u,c){for(var f in h.passages){var w=h.passages[f];if(!1!=w&&(w.x==u||w.y==c))return!0}return!1},h.drawPassageSigns=function(){n.save(),0>=h.mobsNumber?(n.fillStyle="green",!0!=h.passagesSound&&null!=h.mobsNumber&&(GAME.mp3.playSound("passagesUnlocked"),h.passagesSound=!0)):n.fillStyle="red",n.globalAlpha=0.7;var u=h.passages;!1!=u.upperPassage&&n.fillRect(u.upperPassage.x,u.upperPassage.y,h.tileSize,h.tileSize/5),!1!=u.bottomPassage&&n.fillRect(u.bottomPassage.x,u.bottomPassage.y+(h.tileSize-h.tileSize/5),h.tileSize,h.tileSize/5),!1!=u.leftPassage&&n.fillRect(u.leftPassage.x,u.leftPassage.y,h.tileSize/5,h.tileSize),!1!=u.rightPassage&&n.fillRect(u.rightPassage.x+(h.tileSize-h.tileSize/5),u.rightPassage.y,h.tileSize/5,h.tileSize),n.restore()},h.getWalkTilesNumber=function(){for(var u=0;u<h.mapArray.length;u++)for(var c=0;c<h.mapArray[u].length;c++)"0"!=h.mapArray[u][c]&&h.numWalkTiles++},h.createWallTurrets=function(){for(var u=Math.floor(h.wallsIndexes.length/5),c=0;c<u;c++){var f=getRandomInt(0,h.wallsIndexes.length-1),w=h.wallsIndexes[f];if(!0!=h.wallsIndexes[f].turret){h.wallsIndexes[f].turret=!0;var S=w.x*h.tileSize,C=w.y*h.tileSize,P=w.orientation,z=new WallTurret(S,C,P,h.id,h.tileSize)}}},h.createTerrainTurrets=function(){for(var u=[],c=0;c<h.roomsList.length;c++)80<=h.roomsList[c].width&&80<=h.roomsList[c].height&&u.push(h.roomsList[c]);if(0!=u.length)var f=getRandomInt(0,u.length-1),w=u[f],S=(w.x1+w.x2)/2,C=(w.y1+w.y2)/2,P=new TerrainTurret(S,C,h.id,h.tileSize,w)},h.createMobs=function(){for(var u=0;u<h.roomsList.length;u++){var c=h.roomsList[u],f=c.width*c.height,w=0.4*Math.sqrt(f/30);h.mobsNumber+=w;for(var S=0;S<w;S++)var C=getRandomInt(c.x1+30,c.x2-30),P=getRandomInt(c.y1+30,c.y2-30),z=new Mob(C,P,h.id,c)}},h.spawnCollectible=function(){var u=getRandomInt(0,h.roomsList.length-1),c=h.roomsList[u],f=getRandomInt(c.x1+15,c.x2-15),w=getRandomInt(c.y1+15,c.y2-15),S=new Collectible(f,w,h.id);h.collectible=S},h.spawnFinish=function(){var u=getRandomInt(0,h.roomsList.length-1),c=h.roomsList[u],f=(c.x1+c.x2)/2+10,w=(c.y1+c.y2)/2+10,S=new Finish(f,w,h.id);h.finish=S,p.finish=S},h},Corridors=function(t){var s=GAME.canvas,l=GAME.gameInstance,r=l.world.maps;this.createCorridors=function(){this.createRoomCorridors(t.roomsList),this.createPassageCorridors()},this.createRoomCorridors=function(o){for(var n=1;n<o.length;n++){var p=o[n-1].corridorExit,m=o[n].corridorEntry;this.positionCorridors(p,m)}},this.createPassageCorridors=function(){if(!0==t.passages.rightPassage){var o=this.getRandPassagePosition("right");t.passages.rightPassage=o,t.passages.rightPassage.width=l.passagesSize,t.passages.rightPassage.height=l.tileSize;var n=getRandomInt(0,t.roomsList.length-1),p=t.roomsList[n];this.positionCorridors(o,p.corridorEntry)}if(!0==t.passages.bottomPassage){var m=this.getRandPassagePosition("bottom");t.passages.bottomPassage=m,t.passages.bottomPassage.width=l.tileSize,t.passages.bottomPassage.height=l.passagesSize;var n=getRandomInt(0,t.roomsList.length-1),p=t.roomsList[n];this.positionCorridors(m,p.corridorEntry)}if(!1!=t.passages.leftPassage){var g=t.passages.leftPassage,n=getRandomInt(0,t.roomsList.length-1),p=t.roomsList[n];this.positionCorridors(g,p.corridorEntry)}if(!1!=t.passages.upperPassage){var d=t.passages.upperPassage,n=getRandomInt(0,t.roomsList.length-1),p=t.roomsList[n];this.positionCorridors(d,p.corridorEntry)}},this.positionCorridors=function(o,n){0==getRandomInt(0,1)?(this.createHCorridor(o.x,n.x,o.y),this.createVCorridor(o.y,n.y,n.x)):(this.createVCorridor(o.y,n.y,o.x),this.createHCorridor(o.x,n.x,n.y))},this.getRandPassagePosition=function(o){if("right"==o){var n=s.width-t.tileSize;do var p=getRandomInt(0,l.mapHeight-t.tileSize);while(0!=p%t.tileSize);return{x:n,y:p}}if("bottom"==o){var p=l.mapHeight-l.tileSize;do var n=getRandomInt(0,s.width-t.tileSize);while(0!=n%t.tileSize);return{x:n,y:p}}},this.createHCorridor=function(o,n,p){var m=t.tileSize,g=o/m,d=n/m,h=p/m;if(g>d)var u=d,c=g;else var u=g,c=d;for(var f=u;f<=c&&!(t.mapArray[h]==void 0);f++)t.mapArray[h][f]="2.0"},this.createVCorridor=function(o,n,p){var m=t.tileSize,g=o/m,d=n/m;if(g>d)var u=d,c=g;else var u=g,c=d;for(var f=u;f<=c&&!(t.mapArray[f]==void 0);f++)t.mapArray[f][p/m]="2.0"}},Room=function(t,s,l){var r=GAME.gameInstance,o=GAME.canvas,n=GAME.ctx,p={width:t.width,height:t.height,x1:t.x,x2:t.x+t.width,y1:t.y,y2:t.y+t.height,corridorEntry:{}};return p.corridorEntry={x:p.x1+30,y:p.y1+30},p.corridorExit={x:p.x1+60,y:p.y1+30},p.checkRoomIntersection=function(m){return p.x1<=m.x2&&p.x2>=m.x1&&p.y1<=m.y2&&p.y2>=m.y1},p.addToMapArray=function(){for(var m=p.x1/s,g=p.x2/s,d=p.y1/s,h=p.y2/s,u=d;u<h;u++)for(var c=m;c<g;c++)l[u][c]="2.0"},p};function DrawWall(t,s,l){var r=GAME.ctx;r.drawImage(t,s,l)}var GAME,IMGS={};for(var i in IMGS.loaded=0,IMGS.ready=!1,IMGS.checkLoad=function(){IMGS.loaded++,IMGS.loaded==Object.keys(IMGS.images).length&&(IMGS.ready=!0)},IMGS.images={water:new Image,terrain:new Image,wall:new Image,heart:new Image},IMGS.images.water.src="assets/water.png",IMGS.images.terrain.src="assets/terrain.png",IMGS.images.wall.src="assets/wall.png",IMGS.images.heart.src="assets/heart.png",IMGS.images)IMGS.images[i].addEventListener("load",IMGS.checkLoad,!1);function CreateGAME(t){GAME=new _GAME,GAME.canvas=t,GAME.ctx=t.getContext("2d"),GAME.width=t.width,GAME.height=t.height,GAME.mp3=new musicPlayer,GAME.UI={menu:new MenuUI,game:new GameUI},HandleCanvasClicks(),GAME.changeState("on_menu")}var interval=setInterval(function(){var t=document.getElementById("gC");t!=void 0&&IMGS.ready&&(CreateGAME(t),clearInterval(interval))},1e3),_startingGameOptions=function(){var s={frameRate:60,loopTimer:!1,loop:GameLoop,frameCount:0,gameTime:0,mapStartCD:5,mapActualCD:0,paused:!1,gameOver:!1,finished:!1,passagesSize:10,tileSize:30,map:null,mapMaxSize:20,mapMinSize:4,worldSize:null,startCollectiblesNumber:null,livesNumber:null,startMobsNumber:null,startTurretsNumber:null};return s.copy=JSON.parse(JSON.stringify(s)),s.resetProps=function(l,r){for(var o in r)for(var n in l)o==n&&(l[o]=r[o])},s.resetEntities=function(){TurretBullet.list={},PlayerBullet.list={},Collectible.list={},Mob.list={},WallTurret.list={},TerrainTurret.list={}},s.changeConfigValues=function(){var l=document.getElementById("gosi").value;isNaN(l)&&(alert("Map size was not a number. Map size was set to 4"),l=this.mapMinSize),l>this.mapMaxSize?l=this.mapMaxSize:l<this.mapMinSize&&(l=this.mapMinSize),s.worldSize=l,s.startCollectiblesNumber=s.worldSize,s.actualCollectiblesNumber=0,s.livesNumber=s.worldSize},s},_GAME=function(){this.canvas,this.ctx,this.width,this.height,this.images=IMGS.images,this.states={on_boot:!0,on_menu:!1,on_game:!1},this.UI={menu:!1,game:!1},this.gameInstance=_startingGameOptions(),this.changeState=function(t){for(var s in this.states)"on_game"==s&&!0==this.states[s]&&(clearInterval(this.gameInstance.loopTimer),this.gameInstance.resetProps(this.gameInstance,this.gameInstance.copy),this.gameInstance.resetEntities());for(var s in this.states)if(s!=t)this.states[s]=!1;else if(this.states[s]=!0,this.ctx.clearRect(0,0,this.width,this.height),"on_menu"==t)this.UI.menu.draw();else if("on_game"==t){this.gameInstance.changeConfigValues();var l=document.getElementById("gosd");l.style.display="none";var r=this.gameInstance;generateGame(),this.gameInstance.loopTimer=setInterval(function(){r.loop()},1e3/this.gameInstance.frameRate)}}};function generateGame(){var t=GAME.gameInstance;t.mapWidth=GAME.canvas.width,t.mapHeight=GAME.canvas.height-t.tileSize,t.world=new World(t.worldSize),t.world.createMaps(),t.startMobsNumber=Object.keys(Mob.list).length,t.mobsKilled=0,t.startTurretsNumber=Object.keys(TerrainTurret.list).length,t.turretsDestroyed=0,t.player=new Player,t.player.onInit(),t.miniMap=new MiniMap}function GameLoop(){var t=GAME.ctx,s=GAME.width,l=GAME.height,r=GAME.gameInstance,o=r.world,n=r.player,p=r.finish,m=GAME.UI.game;r.paused||r.gameOver||r.finished||(t.clearRect(0,0,s,l),0==r.frameCount%60&&r.gameTime++,o.update(),p.update(),Entity.update(WallTurret),Entity.update(TerrainTurret),Entity.update(TurretBullet),Entity.update(Mob),Entity.update(Collectible),Entity.update(PlayerBullet),Entity.update(Boost),n.update(),m.draw(),r.frameCount++,0==r.frameCount%60&&r.mapActualCD--,0>=r.mapActualCD&&(r.mapActualCD=0))}function getRandomInt(t,s){return Math.floor(Math.random()*(s-t+1))+t}function testCollisionRectRect(t,s){return t.x<=s.x+s.width&&s.x<=t.x+t.width&&t.y<=s.y+s.height&&s.y<=t.y+t.height}function getDistanceBetween(t,s){var l=t.x-s.x,r=t.y-s.y;return Math.sqrt(l*l+r*r)}window.onload=function(){var t=document.getElementById("gosi");t.oninput=function(){var l=parseInt(this.value),r=GAME.gameInstance.mapMaxSize,o=GAME.gameInstance.mapMinSize;this.style.background=isNaN(l)?"red":l<o||l>r?"red":"#4dff88"}};

var musicPlayer = function() {
 var self = {
 soundCtx: new AudioContext(),
 }
 self.playSound = function(name) {
 if (self.soundCtx != undefined && self.soundCtx != null) {
 self.soundCtx.close();
 self.soundCtx = new AudioContext();
 }
 var sound;
 if (name == "enemyDeath") {
 with(self.soundCtx) for (i in D = [16]) with(createOscillator()) if (D[i]) connect(destination), frequency.value = 300 * 1.06 ** (13 - D[i]), type = 'triangle', start(i * .04), stop(i * .04 + .04)
 } else if (name == "playerDeath") {
 with(self.soundCtx) for (i in D = [3, 9]) with(createOscillator()) if (D[i]) G = createGain(), connect(G), G.connect(destination), frequency.value = 130 * 1.06 ** (13 - D[i]), G.gain.value = 0.5, type = 'sawtooth', start(i * .1), stop(i * .1 + .1)
 } else if (name == "powerUp") {
 with(self.soundCtx) for (i in D = [12, 7]) with(createOscillator()) if (D[i]) G = createGain(), connect(G), G.connect(destination), frequency.value = 200 * 1.06 ** (13 - D[i]), G.gain.value = 0.2, type = 'square', start(i * .1), stop(i * .1 + .1)
 } else if (name == "passagesUnlocked") {
 with(self.soundCtx) for (i in D = [10, 9]) with(createOscillator()) if (D[i]) G = createGain(), connect(G), G.connect(destination), frequency.value = 440 * 1.06 ** (13 - D[i]), G.gain.value = 0.3, type = 'square', start(i * .1), stop(i * .1 + .1)
 }
 }
 return self;
}
</script>



