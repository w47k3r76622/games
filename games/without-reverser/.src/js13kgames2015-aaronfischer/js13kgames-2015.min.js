"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),Helper=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"random_number",value:function(e,t){return Math.floor(Math.random()*t+e)}}]),e}(),_slicedToArray=function(){function e(e,t){var n=[],i=!0,o=!1,s=void 0;try{for(var a,r=e[Symbol.iterator]();!(i=(a=r.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(c){o=!0,s=c}finally{try{!i&&r["return"]&&r["return"]()}finally{if(o)throw s}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),MINI=require("minified"),_=MINI._,$=MINI.$,$$=MINI.$$,EE=MINI.EE,HTML=MINI.HTML,Engine=function(){function e(){_classCallCheck(this,e),this.ticks=0,this.current_asteroid=new Asteroid,this.station=new Station,this.ship=new Ship(this.current_asteroid,this.station),this.asteroids=[this.current_asteroid],this.game_running=!0,this.init_sequence_run=!0}return _createClass(e,[{key:"tick",value:function(){this.ticks++}},{key:"update",value:function(){var e=this;return this.game_running?this.init_sequence_run?($("#ship, #asteroid, #station, #endgame, nav").hide(),void $("#startgame").show()):(_.eachObj(this.ship.resources,function(e,t){$("nav .res-"+e).fill(t)}),$("nav .cbtc").fill(this.ship.cbtc),$("#active-tool").fill(this.ship.active_tool),_.keys(engine.ship.equipment).length!=$("#ship-equipment > li").length&&($("#ship-equipment").fill(),_.eachObj(engine.ship.equipment,function(t){var n=e.ship.equipment[t].type;if("tool"==n){var i=EE("a",{"@href":"#","%tool":t},"mount").onClick(function(e){engine.ship.active_tool=t,engine.update()});$("#ship-equipment").add(EE("li",t+" ").add(i))}if("bot"==n){var o=EE("a",{"@href":"#"},"deploy").onClick(function(e){if(engine.ship.docked_to instanceof Asteroid){var n=new Bot(t,engine.ship.equipment[t].capability);engine.ship.docked_to.deploy_bot(n),delete engine.ship.equipment[t],engine.update()}else alert("You need to land on an asteroid first.")});$("#ship-equipment").add(EE("li",t+" ").add(o))}})),this.ship.docked_to instanceof Station&&($("#asteroid").hide(),$("#station").show()),void(this.ship.docked_to instanceof Asteroid&&($("#station").hide(),$("#asteroid").show(),$("#time").fill(this.ticks-this.current_asteroid.landed_on+" hours"),$("#asteroid-classification").fill(this.current_asteroid.classification),$("#bots").fill(),_.eachObj(this.current_asteroid.bots,function(e,t){var n=EE("a",{"@href":"#"},"destroy").onClick(function(n){t.docked_to.bots.splice(e,1),engine.update()});$("#bots").add(EE("li",t.model+" ").add(n))})))):($("#ship, #asteroid, #station, #startgame, nav").hide(),void $("#endgame").show())}}]),e}(),Ship=function(){function e(t,n){_classCallCheck(this,e),this.docked_to=t,this.active_tool="probe",this.equipment={probe:n.inventory.probe},this.upgrades={},this.resources={dust:0,stone:0,carbon:0,metal:0},this.cbtc=430}return _createClass(e,[{key:"mount",value:function(e){this.active_tool=e}},{key:"equip",value:function(e,t){this.equipment[e]=t}},{key:"mine",value:function(){if(this.docked_to instanceof Asteroid){var e=this.docked_to.harvest(this.equipment[this.active_tool]),t=_slicedToArray(e,2),n=t[0],i=t[1];this.resources[n]+=i}}}]),e}(),Bot=function(){function e(t){_classCallCheck(this,e),this.model=t,this.tool={name:"probe",capability:engine.station.inventory.probe},this.docked_to=!1}return _createClass(e,[{key:"mount",value:function(e,t){this.tool={name:e,capability:t}}},{key:"mine",value:function(){if(this.docked_to instanceof Asteroid&&engine.ship.docked_to==this.docked_to){var e=this.docked_to.harvest(this.tool.capability),t=_slicedToArray(e,2),n=t[0],i=t[1];engine.ship.resources[n]+=i}}}]),e}(),Asteroid=function(){function e(){_classCallCheck(this,e),this.landed_on=0,this.bots=[],this.classification=["A","C","S","X"][Helper.random_number(0,4)]}return _createClass(e,[{key:"harvest",value:function(e){var t={A:["dust","dust","stone"],C:["dust","carbon","carbon","carbon"],S:["dust","stone","stone"],X:["metal"]}[this.classification],n=t[Helper.random_number(0,t.length)],i=e.capability[this.classification];return[n,i]}},{key:"deploy_bot",value:function(e){e.docked_to=this,this.bots.push(e)}}]),e}(),Station=function(){function e(){_classCallCheck(this,e),this.inventory={probe:{price:10,type:"tool",capability:{A:1,C:1,S:1,X:1}},conveyor:{price:500,type:"tool",capability:{A:2,C:8,S:4,X:1}},"pipe-drill":{price:3e3,type:"tool",capability:{A:3,C:15,S:12,X:2}},magnet:{price:4500,type:"tool",capability:{A:3,C:1,S:1,X:20}},vaporizer:{price:4e3,type:"tool",capability:{A:4,C:7,S:6,X:5}},"mining-bot":{price:2e4,type:"bot",capability:{A:8,C:8,S:8,X:8}},reverser:{price:9e4,type:"part",capability:{}}},this.market={dust:1,stone:3,carbon:20,metal:45}}return _createClass(e,[{key:"sell",value:function(e,t){if(!_.keys(this.inventory).contains(t)||_.keys(e.equipment).contains(t))return void alert("You already own this tool.");var n=this.inventory[t].price;return n>e.cbtc?void alert("You have not enough cBTC!"):("reverser"==t&&(engine.game_running=!1),e.equip(t,this.inventory[t]),void(e.cbtc-=n))}},{key:"buy",value:function(e,t,n){if(e.resources[t]<n||0>n)return void alert("You have not enough resources loaded");var i=this.market[t];e.cbtc+=i*n,e.resources[t]-=n}}]),e}(),engine=new Engine;$(function(){$("#btn-mine").onClick(function(){engine.ship.mine(),engine.update()}),$("#btn-to-station").onClick(function(){engine.ship.docked_to=engine.station,engine.current_asteroid=null,_.eachObj(engine.ship.resources,function(e,t){$("#ship-inventory .res-"+e).set("value",t)}),engine.update()}),$("#btn-to-asteroid").onClick(function(){engine.ship.docked_to=engine.asteroids[0],engine.current_asteroid=engine.asteroids[0],engine.current_asteroid.landed_on=engine.ticks,engine.update()}),_.eachObj(engine.station.inventory,function(e,t){var n=EE("a",{"@href":"#","%tool":e}," buy for "+t.price+" cBTC").onClick(function(e){var t=$(e.target).get("%tool");engine.station.sell(engine.ship,t),engine.update()});$("#station-inventory").add(EE("li",e).add(n))}),$("#ship-inventory a").onClick(function(e){var t=$(e.target).get("%res"),n=$('#ship-inventory input[name="sell-res-'+t+'"]'),i=n.get("value"),o=engine.ship.resources[t]-i;0>o&&(o=engine.ship.resources[t]),n.set("value",o),engine.station.buy(engine.ship,t,i),engine.update()}),$("#startgame button").onClick(function(e){$("#startgame").hide(),$("#ship, nav").show(),engine.init_sequence_run=!1,engine.update(),setInterval(function(){engine.tick(),_.each(engine.asteroids,function(e){_.each(e.bots,function(e){e.mine()})}),engine.update()},1e3)}),engine.update()});
