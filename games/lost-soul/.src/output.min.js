(function(){
'use strict';for(var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,c){b!=Array.prototype&&b!=Object.prototype&&(b[a]=c.value)},d="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this,k=["Array","prototype","fill"],m=0;m<k.length-1;m++){var n=k[m];n in d||(d[n]={});d=d[n]}
var p=k[k.length-1],q=d[p],r=q?q:function(b,a,c){var e=this.length||0;0>a&&(a=Math.max(0,e+a));if(null==c||c>e)c=e;c=Number(c);0>c&&(c=Math.max(0,e+c));for(a=Number(a||0);a<c;a++)this[a]=b;return this};r!=q&&null!=r&&aa(d,p,{configurable:!0,writable:!0,value:r});var t,u,v,w=[];
function x(){3<v&&(v=0,u++);if(u>=w.length)alert("well done ! You've beaten the arcade mode ! Each run has different levels, so why not try it again?");else{var b=Math.floor(Math.random()*w[u].length),a=w[u][b];w[u].splice(b,1);y(a)}};var z=0,A=[],B;function C(){for(var b=[],a=0;a<A.length;a++)b=b.concat(ba(A[a]));B=btoa(String.fromCharCode.apply(null,new Uint8Array(b)));document.getElementById("code").value=B}
function ca(){if(!(z>=A.length)){var b=function(a){return document.getElementById(a)},a=A[z];a.x=b("posX").value;0>a.x&&(a.x=0);1024<a.x&&(a.x=1024);b("posX").value=a.x;a.y=b("posY").value;0>a.y&&(a.y=0);1024<a.y&&(a.y=1024);b("posY").value=a.y;a.target=b("target").value;a.f=b("firstMult").value;a.g=b("secondMult").value;a.h=b("fireRate").value;a.b=b("bulletType").value;a.j=b("movement").value;a.l=b("movementType").value;a.speed=b("speed").value;a.start=b("start").value;0>a.start&&(a.start=0);a.start>
Math.pow(2,16)-8&&(a.start=Math.pow(2,16)-8);b("start").value=a.start;a.duration=b("duration").value;0>a.duration&&(a.duration=0);a.duration>Math.pow(2,16)-8&&(a.duration=Math.pow(2,16)-8);b("duration").value=a.duration;C()}}function da(){A.push(new D);ea()}function fa(){y(B)}
function ha(b){function a(a){return document.getElementById(a)}z=b;b=A[z];a("posX").value=b.x;a("posY").value=b.y;a("target").value=b.target;a("firstMult").value=b.f;a("secondMult").value=b.g;a("fireRate").value=b.h;a("bulletType").value=b.b;a("movement").value=b.j;a("movementType").value=b.l;a("speed").value=b.speed;a("start").value=b.start;a("duration").value=b.duration}
function ia(){var b=document.getElementById("load").value;try{var a=ja(b);A=[];for(b=0;b<a.length/8;b++)A.push(new D(a.subarray(8*b,8*b+8)));ea();ha(0);C()}catch(c){alert("invalid Data. Please check it.")}}function ea(){for(var b="",a=0;a<A.length;a++)b+="<li onclick='editorDisplay("+a+")'>Ennemy "+a+"<span onclick='editorDeleteEnnemy("+a+")'>X</span></li>";document.getElementById("list").innerHTML=b}
function ka(b){A[z].x=Math.floor((b.clientX-E.offsetLeft)/E.offsetHeight*1E3);A[z].y=Math.floor((b.clientY-E.offsetTop)/E.offsetHeight*1E3);ha(z)};function D(b,a,c,e,l,g,I,J,h,f,va){4==arguments.length?(this.x=b,this.y=a,this.duration=va,this.target=c,this.h=e,this.f=l,this.g=g,this.b=I,this.j=J,this.l=0,this.speed=h):1==arguments.length?(this.x=b[0]<<2,this.y=b[1]<<2,this.target=(b[2]&253)>>2,this.h=b[2]&3,this.f=(b[3]&224)>>5,this.g=(b[3]&28)>>2,this.b=b[3]&3,this.j=(b[4]&240)>>4,this.l=(b[4]&12)>>2,this.speed=b[4]&3,this.start=(b[5]<<8)+(b[6]&240),this.duration=((b[6]&15)<<8)+b[7]<<4):this.duration=this.start=this.speed=this.l=this.j=this.b=
this.g=this.f=this.h=this.target=this.y=this.x=0;this.m=this.y;this.i=this.frame=this.c=this.a=0}function ba(b){var a=[];a.push(Math.floor(b.x>>2));a.push(Math.floor(b.y>>2));a.push((+b.target<<2)+ +b.h);a.push((b.f<<5)+(b.g<<2)+ +b.b);a.push((+b.j<<4)+(b.l<<2)+ +b.speed);a.push((b.start&65280)>>8);a.push((b.start&240)+Math.floor(b.duration>>12));a.push((b.duration&4080)>>4);return a}function la(b,a,c,e,l){this.x=b;this.y=a;this.type=0;this.direction=e;this.size=c;this.speed=l}var F=[],G=[],ma="";
function ja(b){try{return new Uint8Array(atob(b).split("").map(function(a){return a.charCodeAt(0)}))}catch(a){console.log("error decoding "+b)}}function y(b,a){0!=a&&(H=K=500);ma=b;F=[];G=[];b=ja(b);for(a=0;a<b.length/8;a++)F.push(new D(b.subarray(8*a,8*a+8)))}
function L(){for(var b=0;b<F.length;b++){var a=F[b];a.i++;if(a.i>a.start&&a.i<a.start+a.duration){a.frame++;var c=void 0;switch(a.j){case 1:c=Math.atan2(H-a.y,K-a.x);break;case 2:c=3*Math.PI/2;break;case 3:c=Math.PI;break;case 4:c=0;break;case 5:c=Math.PI/2;break;case 6:var e=c=a.m;if(0==a.c||1==a.c)c=1E3-c;if(1==a.c||2==a.c)e=1E3-e;1>Math.abs(a.x-c)&&1>Math.abs(a.y-e)&&a.c++;3<a.c&&(a.c=0);c=Math.atan2(e-a.y,c-a.x);break;case 7:c=Math.atan2(1E3-H-a.y,1E3-K-a.x)}switch(a.l){case 1:c+=Math.sin(a.frame/
40);break;case 2:a.a=(a.a+2*Math.PI)%(2*Math.PI);c=(c+2*Math.PI)%(2*Math.PI);e=a.a-c;e=e>Math.PI?a.a<c?-1:1:a.a<c?1:-1;e=.03>Math.abs(a.a-c)?e*Math.abs(a.a-c):.03*e;c=a.a+e;a.a=c;break;case 3:c+=Math.sin(a.frame/10)/10}void 0!=c&&(a.x+=Math.cos(c)*(a.speed+1)/2,a.y+=Math.sin(c)*(a.speed+1)/2);if(1==a.frame%(72/(a.h+1))){c=[];switch(a.target){case 0:c.push(Math.atan2(H-a.y,K-a.x));break;case 1:c.push(a.frame/72);break;case 2:c.push(3*Math.PI/2);break;case 3:c.push(Math.PI);break;case 4:c.push(0);break;
case 5:c.push(Math.PI/2);break;case 6:b=(Math.atan2(H-a.y,K-a.x)-Math.PI/4+2*Math.PI)%(2*Math.PI);b=Math.floor(b/(Math.PI/2))*Math.PI/2+Math.PI/2;c.push(b);break;case 7:b=(Math.atan2(H-a.y,K-a.x)-3*Math.PI/8+2*Math.PI)%(2*Math.PI),b=Math.floor(b/(Math.PI/4))*Math.PI/4+Math.PI/2,c.push(b)}for(var l=0;2>l;l++){var g=[];Array.prototype.forEach.call(c,function(b){switch(0==l?a.f:a.g){case 0:g.push(b);break;case 1:for(var c=-.1;.15>c;c+=.1)g.push(b+c);break;case 2:for(c=-.3;.35>c;c+=.3)g.push(b+c);break;
case 3:for(c=-.2;.25>c;c+=.1)g.push(b+c);break;case 4:for(c=-.6;.65>c;c+=.3)g.push(b+c);break;case 5:for(c=0;c<Math.PI+1;c+=Math.PI)g.push(b+c);break;case 6:for(c=0;c<2*Math.PI;c+=Math.PI/2)g.push(b+c);break;case 7:for(c=0;c<2*Math.PI;c+=Math.PI/4)g.push(b+c)}});c=g}c.sort();for(b=0;b<c.length;b++)c[b]==c[(b+1)%c.length]&&1!=c.length||G.push(new la(a.x,a.y,5+a.b%2*5,c[b],2-1*Math.floor(a.b/2)))}}}for(b=0;b<G.length;b++)c=G[b],-50>c.x||1050<c.x||-50>c.y||1050<c.y?(G.splice(b,1),b--):0==c.type&&(c.x+=
Math.cos(c.direction)*c.speed,c.y+=Math.sin(c.direction)*c.speed)}function na(){for(var b=0;b<F.length;b++){var a=F[b];if(a.i<a.start+a.duration)return!1}return 0<G.length?!1:!0}
function oa(){M("blue",10);N.strokeStyle="red";N.lineWidth=5;N.beginPath();for(var b=0;b<G.length;b++)-999!=G[b].x&&(N.moveTo(G[b].x,G[b].y),N.arc(G[b].x,G[b].y,G[b].size,0,2*Math.PI));N.stroke();N.fillStyle="red";N.beginPath();for(b=0;b<F.length;b++){var a=F[b];a.i>a.start-60&&a.i<a.start+a.duration&&(N.moveTo(a.x,a.y),N.arc(a.x,a.y,10,0,2*Math.PI))}N.fill()};var O=[];window.onkeyup=function(b){O[b.keyCode]=!1};window.onkeydown=function(b){O[b.keyCode]=!0};function M(b,a){N.shadowColor=b;N.shadowBlur=a;N.shadowOffsetX=0;N.shadowOffsetY=0}var P="M 0 6 L 2 0 L 4 6 L 3 3 L 1 3;M 0 6 L 0 0 A 1 1 0 1 1 0 3 A 1.5 1 0 0 1 0 6 L 0 3;M 3 0 Q 0 0 0 4 Q 0 6 3 6 ;M 0 6 L 0 0 A 1 1 0 1 1 0 6 ;M 3 6 L 0 6 L 0 3 L 2 3 L 0 3 L 0 0 L 3 0 ;M 1 6 L 1 3 L 3 3 L 1 3 L 1 0 L 4 0;M 2 4 L 4 4 A 2 3 0 1 1 4 2 ;M 0 0 L 0 6 L 0 3 L 3 3 L 3 0 L 3 6 ;M 1 6 L 3 6 L 2 6 L 2 0 L 1 0 L 3 0 ;M 0 5 C 0 7 2 7 2 5 L 2 1 L 1 1 L 3 1 ;M 0 6 L 0 0 L 0 3 L 2 1 L 0 3 L 3 6;M 0 0 L 0 6 L 3 6 ;M 0 6 L 0 0 L 2 2 L 4 0 L 4 6 ;M 0 6 L 0 0 L 4 6 L 4 0 ;M 2 6 A 0.5 1 0 1 1 2 0 A 0.5 1 0 1 1 2 6 ;M 0 6 L 0 0 A 1.5 1 0 1 1 0 3 ;M 3 4 L 4 6 A 1 1 0 1 1 2 1 A 1 1 0 1 1 4 6 ;M 0 6 L 0 0 A 1 1 0 1 1 0 3 L 2 6 ;M 0 6 C 4 7 4 3 2 3 C 0 3 0 -1 3 0 ;M 2 6 L 2 0 L 0 0 L 4 0 ;M 0 0 Q 0 6 1.5 6 Q 3 6 3 0;M 0 0 L 2 6 L 4 0;M 0 0 L 1 6 L 2 0 L 3 6 L 4 0 ;M 0 0 L 4 6 L 2 3 L 0 6 L 4 0 ;M 0 0 L 2 3 L 0 6 L 4 0;M 0 0 L 4 0 L 0 6 L 4 6 ;M 1 0 C 3 0 5 2 3 3 C 1 3.5 2.5 4 2.5 5 ;M 2 6 L 2.01 6;M 2 0 L 1.5 2;M 2 0 L 2 4;M 2 2 L 2 2.3;M 2 6 L 1.5 6.5".split(";");
function Q(b,a,c,e,l){if(!(0>e||e>8*c.length+l)){if(null==l||void 0==l)l=8*c.length+180;c=c.toLowerCase();N.save();N.lineWidth=.8;N.lineCap="round";N.lineJoin="round";N.translate(b,a);N.scale(3,3);M("white",5);for(a=b=0;a<c.length;a++){N.globalAlpha=e>8*a?Math.min((e-8*a)/30,1):0;e>l+8*a&&(N.globalAlpha=Math.max(0,Math.min(1-(e-(l+8*a))/30,1)));var g=c.charCodeAt(a);63==g?g=26:46==g?g=27:39==g?g=28:33==g?g=29:42==g?g=30:44==g?g=31:32==g?g=-1:10==g?(g=-1,N.translate(-5*(b+1),12),b=0):g-=97;-1!=g&&
N.stroke(P[g]);N.translate(5,0);b++}N.restore()}};var N,E,pa=1E3/60,R=0,S,T=4;
function qa(b){switch(b){case 0:F=[];G=[];K=250;H=500;break;case 1:v=u=t=0;H=K=500;w=["fX0DkAAAYD4= fX0HkAAAYD4= cHAbkWAAYD4= fX0H5gAAYD4= fX0D5wAAYD4= Pj4DAAAAYD67uwMAAABgPg==".split(" "),"fX0DcAAAYD4= Pj4DAAAAYD67uwMAAABgPj67AwAAAGA+uz4DAAAAYD4= fX0H8gAAYD4= V1cD5WMAYD4= V1cH4GMAYD4= fX0H5QMAYD4=".split(" "),"V1cH5GMAYD4= fX0HfAAAYD4= fX0HnwAAYD4= fX0HnAAAYD4= fX0HeQAAYD4= Pj4COAAAYD4+uwLEAABgPrs+AsQAAGA+u7sCxAAAYD4=".split(" "),"Pj4COGIAYD4+uwLEYgBgPrs+AsRiAGA+u7sCxGIAYD4= Pj4HxGIAYD67uwfEYgBgPg== GRkGWGIAYD7h4QbEYgBgPg fX0H7AIAYD4 fX0HxBkAYD4= fX0HyxkAYD4=".split(" "),"fX0HGBsAYD4 fX0H5gAAYD59fQUcEABgPg Pj4H4GAAYD67uwfgYABgPg Pj4G82MAYD4= Pj4DPGMAYD67uwM8YwBgPg== Pj4DIGMAYD67uwMgYwBgPn19BjwAAGA9".split(" "),
"Pj4G5GAAYD67uwbkYABgPg Pj4DjWMAYD4= fX0Dj3MAYD67uwY8YwBgPg Pj4CwBIAYD67uwLAEgBgPj67AsASAGA+uz4CwBIAYD4= Pj4GwGIAYD67uwbAYgBgPj67A8ASAGA GRkDcAIAYD7h4QNwAgBgPg".split(" "),"fX0H5BoAYD4= GRkGPGIAYD7h4QbkYgBgPg GRkGXGIAYD7h4QboYgBgPg V1cH62MAYD4= fX0HfwAAYD4= GRkGxGoAYD5kZAZYYgBgPuHhBsRiAGA9".split(" "),"fX0HOBsAYD4= Pj4G7GAAYD67uwbsYABgPg fX0HfwsAYD4= Pj4HPAsAYD67uwc8CwBgPg Pj4HPHsAYD67uwc8GQBgPg Pj4D8HMAYD67uwOccwBgPg==".split(" ")];x();b=T=5;break;case 2:var a=prompt("please enter the level code",
"Should look like b5cH5GEAbIE=");if(null==a||""==a){O[32]=!1;return}y(a);S=Date.now();break;case 3:F=[];G=[];document.getElementById("editor").style.display="flex";document.getElementById("canvas").classList.add("canvasEdit");a="at the player;rotating;top;left;right;bottom;4 direction where player is;8 direction where player is".split(";");for(var c=["very slow","slow","medium","fast"],e="simple bullet;triple bullet close;triple bullet wide;5 bullet close;5 bullet wide;2 bullet in opposite direction;4 bullet in opposite direction;8 bullet in opposite direction".split(";"),
l=["quick and small","quick and big","slow and small","slow and big"],g="fixed;go to player;top;left;right;bottom;rectangle centered in 500,500;opposite to the player".split(";"),I=["straight","sine wave","slow turn"],J=["slow","normal","fast","very fast"],h="",f=0;f<a.length;f++)h+="<option value="+f+">"+a[f]+"</option>";document.getElementById("target").innerHTML=h;h="";for(f=0;f<e.length;f++)h+="<option value="+f+">"+e[f]+"</option>";document.getElementById("firstMult").innerHTML=h;document.getElementById("secondMult").innerHTML=
h;h="";for(f=0;f<c.length;f++)h+="<option value="+f+">"+c[f]+"</option>";document.getElementById("fireRate").innerHTML=h;h="";for(f=0;f<l.length;f++)h+="<option value="+f+">"+l[f]+"</option>";document.getElementById("bulletType").innerHTML=h;h="";for(f=0;f<g.length;f++)h+="<option value="+f+">"+g[f]+"</option>";document.getElementById("movement").innerHTML=h;h="";for(f=0;f<I.length;f++)h+="<option value="+f+">"+I[f]+"</option>";document.getElementById("movementType").innerHTML=h;h="";for(f=0;f<J.length;f++)h+=
"<option value="+f+">"+J[f]+"</option>";document.getElementById("speed").innerHTML=h;da();break;case 4:y("u7sG5AAAD/8="),K=-999}T=b}
function ra(){var b=Date.now();R+=b-S;for(S=b;R>=pa;){switch(T){case 0:case 1:0==T&&(U+=3);case 2:case 3:L();sa();break;case 4:V++;O[38]?(W&&X--,W=!1):O[40]?(W&&X++,W=!1):W=!0;X=(X+4)%4;O[32]&&qa(X);L();break;case 5:L(),sa(),na()&&(t++,v++,x())}R-=pa}M("transparent",0);N.fillStyle="rgba(0,0,0,0.25)";N.rect(0,0,1E3,1E3);N.fill();N.fillStyle="rgba(0,0,0,1)";switch(T){case 0:case 1:if(0==T){b=[];var a=[],c=!1;switch(Y){case 0:b=["where am i ?","welcome to hell.","Wait... This isn't Diagon Alley?"];a=
[0,600,1E3];c=!0;break;case 1:b=["This must be a mistake..","    Well kid, i don't care.\nYou're a lost soul. I'm charon.\n      and This is my job","your job kinda sucks"];a=[0,600,1800];c=!0;break;case 2:b=["So you will just try forever?\nEven if I ressurect everytime?"," Well, once you've\nabandonned, I'm done","You underestimate my stubbornness"];a=[0,600,1300];c=!0;break;case 3:b=["        Just give up.\nIt will be easier for everyone","Well, I'm just starting to have fun..\n             So no.",
"Darn kid"];a=[0,600,1800];c=!1;break;case 4:b=["Could you please give up?\nI need to go to the toilet.","You're already stopping?\nBUt we just started !","Urg... Why is this\nsoul so annoying ??"];a=[0,600,1300];c=!1;break;case 5:b=["So, you wanna send me to my destination?","I can't ! A soul that comes\nin the limbo must stay in it !","So you want me to stay?"];a=[0,600,1300];c=!0;break;case 6:b=["   If I let you go,\nyou won't tell anyone?","hum... Yeah sure.","ok, because I could\n get in trouble..."];
a=[0,600,1300];c=!1;break;case 7:b="Fine, I'll let you go.\nBut don't tell anyone !;Really?;Yeah. I'm tired of you;well, you'll be even more tired of me.;what do you mean?;Inspector soulomon grundy, You're coming\n      with me for corruption and\n    potentially letting a soul escape !;What??? NO ! How ?".split(";");a=[0,800,1300,2E3,2800,3500,4500];c=!1;break;case 8:b=["Congratulation !","","   You've finished the story mode !"],a=[0,0,500],c=!1}for(var e=0;e<b.length;e++){var l=b[e].split("\n").length-
0;c?Q(K-8*(b[e].length+0)/l,H-60-40*l,b[e],U-a[e]):(N.scale(2,2),Q(250-8*(b[e].length+0)/l,140-40*l,b[e],U-a[e]),N.scale(.5,.5));c=!c}2500<U&&7>Y&&(T=1,y("fX0HwgAAMMj6GRZAMQGQPvrhCUAxAyBX+ksCADQHAD76fQQ4MAjwPg== fX0AQngAYLsMDAXBYwMgfX19HkAABdA+ZGQYgGAH0D4= fX0GwBAAYJwAAAIAYwHwfX19GIAABdA+ Pj4FOmAAMPoyAAXAUAHwPsj6BcAgAfA+fQAGjAAH0Bl9+geMAAogGQ== fX0AjgAAYNoAABAoUAJQXQAAFChAAlBd+voccAAIkD4= AAAAIgAAYJz6AAAiAABgnAD6ACIAAGCc+voAIgAAYJwAABIAUgHwPvoADgBSAfA+AAAFOGAF0D76+gU4YAXQPg== fX0HcwAAYJx9ABUgAAHwPgB9ESAAAfA+".split(" ")[Y],
!1));7==Y&&6E3<U&&(U=0,Y++,T=0)}else na()&&(U=0,Y++,T=0);case 2:case 3:case 5:oa();b=Z;M(ta?"blue":"white",10);N.lineWidth=4;N.strokeStyle="white";N.beginPath();N.arc(K,H,5,0,2*Math.PI);N.stroke();for(a=1;5>a;a++)N.globalAlpha=1/(a+1),N.beginPath(),0<5+a*b/5&&N.arc(K,H,5+a*b/5,0,2*Math.PI),N.stroke();N.globalAlpha=1;break;case 4:oa();b=["Story","Arcade","Custom","Editor"];N.save();N.scale(5,5);N.strokeStyle="black";Q(40,20,"Lost Soul",V,V+1);N.restore();N.save();N.scale(2,2);for(a=0;4>a;a++)N.strokeStyle=
a==X?"rgba(255,255,255,"+(Math.sin(V/40)/8+.6)+")":"black",Q(100,200+50*a,b[a],V,V+1);N.restore()}requestAnimationFrame(ra)}
window.onload=function(){document.getElementById("canvas").addEventListener("click",ka);document.getElementById("formEditor").addEventListener("change",ca);document.getElementById("buttonStart").addEventListener("click",fa);document.getElementById("buttonAdd").addEventListener("click",da);document.getElementById("buttonLoad").addEventListener("click",ia);for(var b=0;b<P.length;b++)P[b]=new Path2D(P[b]);E=document.getElementById("canvas");E.width=1E3;E.height=1E3;N=E.getContext("2d");S=Date.now();
ra();qa(4)};var V=0,X=0,W=!0;var K=120,H=500,ua=0,Z=10,wa=0,ta=!1;function sa(){var b=2;O[17]&&(b=1);O[38]&&(H-=b);O[40]&&(H+=b);O[37]&&(K-=b);O[39]&&(K+=b);wa++;1E3<K&&(K=1E3);0>K&&(K=0);1E3<H&&(H=1E3);0>H&&(H=0);0==T&&(Z=ua&&10>Z?Z+.2:Z+Math.sin(wa/60)/15);1<=T&&0<Z&&(Z-=.2,ua=!0);ta=!1;a:{b=K;for(var a=H,c=0;c<G.length;c++)if(-999!=G[c].x&&(G[c].x-b)*(G[c].x-b)+(G[c].y-a)*(G[c].y-a)<25+G[c].size*G[c].size){b=!0;break a}b=void 0}b&&y(ma)};var U=0,Y=0;
}).call(this)
