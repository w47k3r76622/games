function SfxrParams(){this.setSettings=function(e){for(var t=0;24>t;t++)this[String.fromCharCode(97+t)]=e[t]||0;this.c<.01&&(this.c=.01);var a=this.b+this.c+this.e;if(.18>a){var i=.18/a;this.b*=i,this.c*=i,this.e*=i}}}function SfxrSynth(){this._params=new SfxrParams;var e,t,a,i,m,g,r,s,n,o,c,l;this.reset=function(){var e=this._params;i=100/(e.f*e.f+.001),m=100/(e.g*e.g+.001),g=1-e.h*e.h*e.h*.01,r=-e.i*e.i*e.i*1e-6,e.a||(c=.5-e.n/2,l=5e-5*-e.o),s=1+e.l*e.l*(e.l>0?-.9:10),n=0,o=1==e.m?0:(1-e.m)*(1-e.m)*2e4+32},this.totalReset=function(){this.reset();var i=this._params;return e=i.b*i.b*1e5,t=i.c*i.c*1e5,a=i.e*i.e*1e5+12,3*((e+t+a)/3|0)},this.synthWave=function(h,d){var u=this._params,p=1!=u.s||u.v,f=u.v*u.v*.1,b=1+3e-4*u.w,y=u.s*u.s*u.s*.1,k=1+1e-4*u.t,v=1!=u.s,w=u.x*u.x,x=u.g,R=u.q||u.r,W=u.r*u.r*u.r*.2,E=u.q*u.q*(u.q<0?-1020:1020),A=u.p?((1-u.p)*(1-u.p)*2e4|0)+32:0,T=u.d,H=u.j/2,I=u.k*u.k*.01,C=u.a,M=e,S=1/e,B=1/t,F=1/a,L=5/(1+u.u*u.u*20)*(.01+y);L>.8&&(L=.8),L=1-L;for(var D,P,q,K,O,U,N=!1,j=0,z=0,_=0,G=0,V=0,X=0,J=0,Q=0,Y=0,Z=0,$=new Array(1024),et=new Array(32),tt=$.length;tt--;)$[tt]=0;for(var tt=et.length;tt--;)et[tt]=2*Math.random()-1;for(var tt=0;d>tt;tt++){if(N)return tt;if(A&&++Y>=A&&(Y=0,this.reset()),o&&++n>=o&&(o=0,i*=s),g+=r,i*=g,i>m&&(i=m,x>0&&(N=!0)),P=i,H>0&&(Z+=I,P*=1+Math.sin(Z)*H),P|=0,8>P&&(P=8),C||(c+=l,0>c?c=0:c>.5&&(c=.5)),++z>M)switch(z=0,++j){case 1:M=t;break;case 2:M=a}switch(j){case 0:_=z*S;break;case 1:_=1+2*(1-z*B)*T;break;case 2:_=1-z*F;break;case 3:_=0,N=!0}R&&(E+=W,q=0|E,0>q?q=-q:q>1023&&(q=1023)),p&&b&&(f*=b,1e-5>f?f=1e-5:f>.1&&(f=.1)),U=0;for(var at=8;at--;){if(J++,J>=P&&(J%=P,3==C))for(var it=et.length;it--;)et[it]=2*Math.random()-1;switch(C){case 0:O=c>J/P?.5:-.5;break;case 1:O=1-J/P*2;break;case 2:K=J/P,K=6.28318531*(K>.5?K-1:K),O=1.27323954*K+.405284735*K*K*(0>K?1:-1),O=.225*((0>O?-1:1)*O*O-O)+O;break;case 3:O=et[Math.abs(32*J/P|0)]}p&&(D=X,y*=k,0>y?y=0:y>.1&&(y=.1),v?(V+=(O-X)*y,V*=L):(X=O,V=0),X+=V,G+=X-D,G*=1-f,O=G),R&&($[Q%1024]=O,O+=$[(Q-q+1024)%1024],Q++),U+=O}U*=.125*_*w,h[tt]=U>=1?32767:-1>=U?-32768:32767*U|0}return d}}!function(){for(var e=0,t=["webkit","moz","o","ms"],a=0;a<t.length&&!window.requestAnimationFrame;++a)window.requestAnimationFrame=window[t[a]+"RequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var a=(new Date).getTime(),i=Math.max(0,16-(a-e)),m=window.setTimeout(function(){t(a+i)},i);return e=a+i,m})}();var get=function(e){return document.getElementById(e)},create=function(e){return document.createElement(e)},game={ww:window.innerWidth,wh:window.innerHeight,columns:8,gap:2,level:1,score:0,speed:.1,gravity:.3,paused:!1,hud:{level:get("lv"),score:get("sc")},cnt:get("cnt"),msg:get("msg"),mnu:get("mnu"),hlp:get("hlp"),crd:get("crd"),re:get("re"),ng:get("ng"),hl:get("hl"),cr:get("cr"),f:get("f"),stage:get("c"),bg:get("b"),bgs:[{b:get("b1"),c:0},{b:get("b2"),c:0},{b:get("b3"),c:0}],moveBg:!0,rumble:{body:get("r"),x:0,y:0,level:0,decay:.4},starAmount:400,starColors:["#ffffff","#ffe9c4","#d4fbff"],elements:{FIRE:{color:"#ff3824",latency:50,against:{FIRE:200,EARTH:50,WATER:10,AIR:100},bricks:{empty:{energy:100},filled:{energy:150},special:{energy:200}},desc:"The Fire element, most effective against fire bricks, but least effective against water bricks.",spec:"Fire special brick explodes the whole column of bricks."},EARTH:{color:"#44db5e",latency:60,against:{FIRE:100,EARTH:200,WATER:50,AIR:10},bricks:{empty:{energy:100},filled:{energy:150},special:{energy:200}},desc:"The Earth element, most effective against earth bricks, but least effective against air bricks.",spec:"Earth special brick explodes surrounding bricks."},WATER:{color:"#54c7fc",latency:70,against:{FIRE:10,EARTH:50,WATER:200,AIR:100},bricks:{empty:{energy:100},filled:{energy:150},special:{energy:200}},desc:"The Water element, most effective against water bricks, but least effective against fire bricks.",spec:"Water special brick explodes the whole row of bricks."},AIR:{color:"#ffcd00",latency:40,against:{FIRE:100,EARTH:10,WATER:50,AIR:200},bricks:{empty:{energy:100},filled:{energy:150},special:{energy:200}},desc:"The Air element, most effective against air bricks, but least effective against earth bricks.",spec:"Air special brick explodes all the weak(stroked) air bricks."}}};game.ctx=game.stage.getContext("2d"),game.bg.ctx=game.bg.getContext("2d"),game.vendor={prefixes:["","ms","webkit","moz","o"],get:function(e){var t,a;for(a=0;a<this.prefixes.length;a++)if(t=this.prefixes[a]+(""===this.prefixes[a]?e:e.charAt(0).toUpperCase()+e.slice(1)),"undefined"!=typeof document.body.style[t])return t;return null}},game.arr={create:function(e,t){for(var a,i=[];e--;)a="undefined"==typeof t?[]:t,i.push(a);return i},move:function(e,t,a){e[t]=e.splice(a,1,e[t])[0]}},game.rand={intg:function(e){return Math.random()*(e||268435455)|0},flot:function(){return Math.random()},bool:function(){return Math.random()>.5},range:function(e,t){return game.rand.intg(t-e)+e},rangef:function(e,t){return game.rand.flot()*(t-e)+e},select:function(e){return e[game.rand.range(0,e.length)]}},game.PI2=2*Math.PI,game.RAD=Math.PI/180,game.DEG=180/Math.PI,game.noop=function(){},game.rect=function(e,t,a,i,m,g,r,s,n,o){t+=s,i-=2*s,a+=s,m-=2*s,e.beginPath(),e.strokeStyle=r,e.lineWidth=s,e.moveTo(t+g,a),e.lineTo(t+i-g,a),e.quadraticCurveTo(t+i,a,t+i,a+g),e.lineTo(t+i,a+m-g),e.quadraticCurveTo(t+i,a+m,t+i-g,a+m),e.lineTo(t+g,a+m),e.quadraticCurveTo(t,a+m,t,a+m-g),e.lineTo(t,a+g),e.quadraticCurveTo(t,a,t+g,a),e.closePath(),e.stroke(),n&&(e.fillStyle=n,e.fill()),o&&game.rect(e,t-s,a-s,i+2*s,m+2*s,1.2*g,o,s/2)},game.sine=function(e,t,a,i,m,g,r){var s=(t+i)/2,n=(a+m)/2;e.strokeStyle=g,e.lineWidth=r,e.beginPath(),e.moveTo(t,a),e.bezierCurveTo(t,a,s/2,1.5*n,s,n),e.bezierCurveTo(1.5*s,n/2,i,m,i,m),e.stroke()},game.line=function(e,t,a,i,m,g,r){e.strokeStyle=g,e.lineWidth=r,e.beginPath(),e.moveTo(t,a),e.lineTo(i,m),e.stroke()},game.sprite={items:{},create:function(e,t,a,i){if(!this.get(e)){var m=document.createElement("canvas");m.width=t,m.height=a;var g=m.getContext("2d");g.save(),i(g),g.restore(),this.set(e,m)}return this.get(e)},set:function(e,t){this.items[e]=t},get:function(e){return this.items[e]},show:function(){var e=0;for(var t in this.items)game.ctx.save(),game.ctx.translate(e*game.brickWidth,100),game.ctx.drawImage(this.items[t],0,0),game.ctx.restore(),e+=1.1},factory:function(){var e=game.brickWidth/10,t=game.brickWidth/2,a=game.brickHeight/2,i=game.brickWidth/10,m=e,g="rgba(255,255,255,0.8)",r="rgba(255,255,0,0.5)";this.create("AIR",game.brickWidth,game.brickWidth,function(e){var t=(game.brickWidth-2*i)/4;game.rect(e,0,0,game.brickWidth,game.brickWidth,m,game.elements.AIR.color,i,null,g),e.lineWidth=i,e.strokeStyle=game.elements.AIR.color,e.translate(i,0);for(var a=0;3>a;a++)e.beginPath(),e.moveTo(t,i),e.lineTo(t,game.brickWidth-i),e.stroke(),e.translate(t,0)}),this.create("AIR-SHOT",game.brickWidth,game.brickHeight,function(a){game.rect(a,t-e,0,2*e,game.brickHeight,2,game.elements.AIR.color,i,game.elements.AIR.color,r)}),this.create("AIR-BRICK-empty",game.brickWidth,game.brickHeight,function(e){game.rect(e,0,0,game.brickWidth,game.brickHeight,m,game.elements.AIR.color,i,null,g)}),this.create("AIR-BRICK-filled",game.brickWidth,game.brickHeight,function(e){game.rect(e,0,0,game.brickWidth,game.brickHeight,m,game.elements.AIR.color,i,game.elements.AIR.color,g)}),this.create("AIR-BRICK-special",game.brickWidth,game.brickHeight,function(e){e.fillStyle=game.elements.AIR.color,e.fillRect(t-a/2,i,a,game.brickHeight-2*i),game.rect(e,0,0,game.brickWidth,game.brickHeight,m,game.elements.AIR.color,i,null,g)}),this.create("EARTH",game.brickWidth,game.brickWidth,function(e){var t=(game.brickWidth-2*i)/4;game.rect(e,0,0,game.brickWidth,game.brickWidth,m,game.elements.EARTH.color,i,null,g),e.lineWidth=i,e.strokeStyle=game.elements.EARTH.color,e.translate(0,i);for(var a=0;3>a;a++)e.beginPath(),e.moveTo(i,t),e.lineTo(game.brickWidth-i,t),e.stroke(),e.translate(0,t)}),this.create("EARTH-SHOT",game.brickWidth,game.brickHeight,function(a){game.rect(a,t-e,0,2*e,game.brickHeight,2,game.elements.EARTH.color,i,game.elements.EARTH.color,r)}),this.create("EARTH-BRICK-empty",game.brickWidth,game.brickHeight,function(e){game.rect(e,0,0,game.brickWidth,game.brickHeight,m,game.elements.EARTH.color,i,null,g)}),this.create("EARTH-BRICK-filled",game.brickWidth,game.brickHeight,function(e){game.rect(e,0,0,game.brickWidth,game.brickHeight,m,game.elements.EARTH.color,i,game.elements.EARTH.color,g)}),this.create("EARTH-BRICK-special",game.brickWidth,game.brickHeight,function(e){e.fillStyle=game.elements.EARTH.color,e.fillRect(t-a/2,i,a,game.brickHeight-2*i),game.rect(e,0,0,game.brickWidth,game.brickHeight,m,game.elements.EARTH.color,i,null,g)}),this.create("WATER",game.brickWidth,game.brickWidth,function(e){var t=(game.brickWidth-2*i)/4;game.rect(e,0,0,game.brickWidth,game.brickWidth,m,game.elements.WATER.color,i,null,g),e.lineWidth=i,e.strokeStyle=game.elements.WATER.color,e.translate(0,i);for(var a=0;3>a;a++)game.sine(e,i,t,game.brickWidth-i,t),e.translate(0,t)}),this.create("WATER-SHOT",game.brickWidth,game.brickHeight,function(a){game.rect(a,t-e,0,2*e,game.brickHeight,2,game.elements.WATER.color,i,game.elements.WATER.color,r)}),this.create("WATER-BRICK-empty",game.brickWidth,game.brickHeight,function(e){game.rect(e,0,0,game.brickWidth,game.brickHeight,m,game.elements.WATER.color,i,null,g)}),this.create("WATER-BRICK-filled",game.brickWidth,game.brickHeight,function(e){game.rect(e,0,0,game.brickWidth,game.brickHeight,m,game.elements.WATER.color,i,game.elements.WATER.color,g)}),this.create("WATER-BRICK-special",game.brickWidth,game.brickHeight,function(e){game.line(e,2*i,a,game.brickWidth-2*i,a,game.elements.WATER.color,i),game.rect(e,0,0,game.brickWidth,game.brickHeight,m,game.elements.WATER.color,i,null,g)}),this.create("FIRE",game.brickWidth,game.brickWidth,function(e){var t=(game.brickWidth-2*i)/4;game.rect(e,0,0,game.brickWidth,game.brickWidth,m,game.elements.FIRE.color,i,null,g),e.lineWidth=i,e.strokeStyle=game.elements.FIRE.color,e.translate(-i,0),e.translate(game.brickWidth/2,game.brickWidth/2),e.rotate(90*game.RAD),e.translate(-game.brickWidth/2,-game.brickWidth/2);for(var a=0;3>a;a++)game.sine(e,i,t,game.brickWidth-i,t),e.translate(0,t)}),this.create("FIRE-SHOT",game.brickWidth,game.brickHeight,function(a){game.rect(a,t-e,0,2*e,game.brickHeight,2,game.elements.FIRE.color,i,game.elements.FIRE.color,r)}),this.create("FIRE-BRICK-empty",game.brickWidth,game.brickHeight,function(e){game.rect(e,0,0,game.brickWidth,game.brickHeight,m,game.elements.FIRE.color,i,null,g)}),this.create("FIRE-BRICK-filled",game.brickWidth,game.brickHeight,function(e){game.rect(e,0,0,game.brickWidth,game.brickHeight,m,game.elements.FIRE.color,i,game.elements.FIRE.color,g)}),this.create("FIRE-BRICK-special",game.brickWidth,game.brickHeight,function(e){game.line(e,t,2*i,t,game.brickHeight-2*i,game.elements.FIRE.color,i),game.rect(e,0,0,game.brickWidth,game.brickHeight,m,game.elements.FIRE.color,i,null,g)})}};var synth=new SfxrSynth;window.jsfxr=function(e){synth._params.setSettings(e);var t=synth.totalReset(),a=new Uint8Array(4*((t+1)/2|0)+44),i=2*synth.synthWave(new Uint16Array(a.buffer,44),t),m=new Uint32Array(a.buffer,0,44);m[0]=1179011410,m[1]=i+36,m[2]=1163280727,m[3]=544501094,m[4]=16,m[5]=65537,m[6]=44100,m[7]=88200,m[8]=1048578,m[9]=1635017060,m[10]=i,i+=44;for(var g=0,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s="data:audio/wav;base64,";i>g;g+=3){var n=a[g]<<16|a[g+1]<<8|a[g+2];s+=r[n>>18]+r[n>>12&63]+r[n>>6&63]+r[63&n]}return s},game.fx={click:{count:4,params:[[2,,.06,,.61,.58,,.0092,-.0248,.0059,.9077,-1,-.855,,-1,,-.24,-.4599,.9991,-.647,-.5371,,-1,.33]]},hover:{count:4,params:[[2,.46,.01,.0058,,.29,,-.06,-.02,,,-.7,.5,,-1,,-.5125,-.2453,.4399,-.7,,.0058,-1,.51]]},select:{count:4,params:[[2,,.0138,,.86,.52,,.04,-.04,,,-1,,,-1,,-1,-.56,.63,-.4,.35,,-1,.16]]},move:{count:4,params:[[2,.18,.01,,.3702,.14,,-.0799,.26,.41,.67,-1,,,-1,,-.1999,-.3199,.46,-.0799,,,-1,.4]]},hit:{count:18,params:[[2,.16,.18,,,.4,,-.3199,-.4399,,,-1,,,-1,,-1,-1,.74,-1,,.54,-1,.55]]},explosion:{count:4,params:[[3,,.11,.81,.4543,.11,,-1,-1,,,.36,.21,.45,-.6599,,-.04,.72,.26,-.4399,,,-.64,.34]]},explosionBig:{count:4,params:[[3,,.87,,,.22,,,-.14,,,-1,,,-1,,.08,-.28,.44,-.3399,,,-1,.17]]},levelup:{count:1,params:[[3,.0061,.1462,.0048,.9138,.5027,,.065,,,.6737,.1527,,,-.9567,,.081,-.0307,.071,.0945,,2e-4,,.26]]},death:{count:1,params:[[0,1e-4,.7618,.1376,.81,.1,,.3358,3e-4,,,.3006,,,.048,.6803,-1,-.76,.9985,.6463,.3453,,-1,.27]]}},game.audio={sounds:{},references:[],mute:!1,play:function(e){if(!game.audio.mute){var t=game.audio.sounds[e];t=t.length>1?game.audio.sounds[e][game.rand.range(0,t.length)]:game.audio.sounds[e][0],t.pool[t.tick].play(),t.tick<t.count-1?t.tick++:t.tick=0}}};for(var k in game.fx)game.fx.hasOwnProperty(k)&&(game.audio.sounds[k]=[],game.fx[k].params.forEach(function(e,t){game.audio.sounds[k].push({tick:0,count:game.fx[k].count,pool:[]});for(var a=0;a<game.fx[k].count;a++){var i=new Audio;"undefined"!=typeof jsfxr&&(i.src=jsfxr(e)),game.audio.references.push(i),game.audio.sounds[k][t].pool.push(i)}}));game.entity=function(e){e&&(this.x=e.x,this.y=e.y,this.width=e.w,this.height=e.h,this.col=e.col,this.removed=!1,this.sprite=game.sprite.get(e.name),this.sprite||game.sprite.create(e.name,this.width,this.height,function(t){t.fillStyle=e.col,t.fillRect(0,0,e.w,e.h)}),this.sprite=game.sprite.get(e.name))},game.entity.prototype.destroy=function(){this.removed=!0},game.entity.prototype.draw=function(){game.ctx.translate(this.x,this.y),this.rotate&&game.ctx.rotate(this.rotate*game.RAD),game.ctx.drawImage(this.sprite,-this.width/2,-this.height/2,this.width,this.height)},game.particle=function(e){game.entity.apply(this,arguments),this.dir=game.rand.bool()?-1:1,this.vx=5*Math.random()-2,this.vy=-10*Math.random()-1,this.move=e.speed+game.rand.rangef(-.5,.5),this.distance=0,this.maxDistance=(e.dist||200)+game.rand.range(-30,30),this.delta=this.width/this.maxDistance},game.particle.prototype=new game.entity,game.particle.prototype.constructor=game.particle,game.particle.prototype.update=function(){this.width-=this.delta,this.height-=this.delta,this.vy+=game.gravity,this.y+=this.vy,this.x+=this.vx,this.distance+=Math.sqrt(Math.pow(this.vx,2)+Math.pow(this.vy,2)),this.distance>this.maxDistance&&(this.distance=this.maxDistance,this.destroy())},game.particle.prototype.draw=function(){game.ctx.save(),game.ctx.globalAlpha=1-this.distance/this.maxDistance,game.entity.prototype.draw.call(this),game.ctx.restore()},game.explosion=function(e){game.entity.apply(this,arguments),this.distance=0,this.rotate=game.rand.range(0,360),this.rot=e.rot||game.rand.range(-5,5),this.delta=e.delta||.1,this.maxDistance=game.rand.range(8*this.delta,15*this.delta)},game.explosion.prototype=new game.entity,game.explosion.prototype.constructor=game.explosion,game.explosion.prototype.update=function(){this.distance+=this.delta,this.width+=this.delta,this.height+=this.delta,this.rotate+=this.rot,this.distance>this.maxDistance&&(this.distance=this.maxDistance,this.removed=!0)},game.explosion.prototype.draw=function(){game.ctx.save(),game.ctx.globalAlpha=1-this.distance/this.maxDistance,game.entity.prototype.draw.call(this),game.ctx.restore()},game.bullet=function(e){this.column=e.column,this.type=e.type,this.speed=5,this.width=game.brickWidth,this.height=game.brickHeight,this.x=this.column*this.width+game.gap*(this.column+1),this.y=game.stage.height-game.brickWidth,this.hw=this.width/2,this.hh=this.height/2,this.rad=1,this.removed=!1,this.power=100,this.sprite=game.sprite.get(this.type+"-SHOT")},game.bullet.prototype.destroy=function(){game.explosions.push(new game.explosion({name:"explosion#ffffff",x:this.x+this.hw,y:this.y,w:this.power/4,h:this.power/4,col:"#ffffff",delta:2,rot:0})),game.explosions.push(new game.explosion({name:"explosion#ed8500",x:this.x+this.hw,y:this.y,w:this.power/7,h:this.power/7,col:"#ed8500",delta:1.5,rot:-5})),game.explosions.push(new game.explosion({name:"explosion#ffff00",x:this.x+this.hw,y:this.y,w:this.power/8,h:this.power/8,col:"#ffff00",delta:1,rot:4})),this.removed=!0},game.bullet.prototype.update=function(){this.y-=this.speed*game.timer.delta;for(var e=game.bricks[this.column],t=e.length;t--;)null!==e[t]&&e[t].y>this.y-game.brickHeight&&(this.power=game.elements[this.type].against[e[t].type],this.type===e[t].type&&(game.rumble.level=1),this.destroy(),e[t].hit(this.power,this.type))},game.bullet.prototype.draw=function(){game.ctx.save(),game.ctx.translate(this.x,this.y),game.ctx.drawImage(this.sprite,0,0),game.ctx.restore()},game.tower=function(e){this.type=e.type,this.width=game.brickWidth,this.height=game.brickWidth,this.setColumn(e.column),this.y=game.stage.height-this.height,this.col=game.elements[this.type].color,this.hw=this.width/2,this.hh=this.height/2,this.rad=Math.round(this.width/10),this.removed=!1,this.sprite=game.sprite.get(this.type),this.shootDelay=this.latency=game.elements[this.type].latency},game.tower.prototype.setColumn=function(e){this.column=e,this.x=this.column*this.width+game.gap*(this.column+1)},game.tower.prototype.destroy=function(){this.removed=!0;var e,t,a=this.width/6,i=this.height/6;for(game.rumble.level=10,e=1;6>e;e++)for(t=1;6>t;t++)game.particles.push(new game.particle({name:"particle"+this.col,x:this.x+e*a,y:this.y+t*i,w:a,h:i,col:this.col,speed:game.rand.range(1,5),dist:100*game.rand.range(3,5)}));game.audio.play("explosion")},game.tower.prototype.shoot=function(){0!==game.s&&game.bullets.push(new game.bullet({column:this.column,type:this.type}))},game.tower.prototype.update=function(){this.shootDelay-=game.timer.delta,this.shootDelay<0&&(this.shoot(),this.shootDelay=this.latency)},game.tower.prototype.draw=function(){game.ctx.save(),game.ctx.translate(this.x,this.y),game.ctx.drawImage(this.sprite,0,0),game.ctx.restore()},game.brick=function(e){if(this.column=e.column,this.type=e.type,this.width=game.brickWidth,this.height=game.brickHeight,this.x=this.column*this.width+game.gap*(this.column+1),this.y=-this.height,this.hw=this.width/2,this.hh=this.height/2,this.rad=Math.round(this.width/10),this.removed=!1,this.col=game.elements[this.type].color,this.add=0,this.explode=game.noop,this.sprite=game.sprite.get(this.type+"-BRICK-"+e.item),this.val=this.energy=game.elements[this.type].bricks[e.item].energy,"special"===e.item)switch(e.type){case"FIRE":this.explode=function(){game.rumble.level=10;for(var e=game.bricks[this.column],t=e.length;t--;)e[t]&&!e[t].removed&&(e[t].hitType=e[t].type,e[t].destroy());game.audio.play("explosionBig")};break;case"EARTH":this.explode=function(){game.rumble.level=10;for(var e,t,a=game.columns;a--;)for(e=game.bricks[a].length;e--;)t=game.bricks[a][e],t&&!t.removed&&t.row>=this.row-1&&t.row<=this.row+1&&t.column>=this.column-1&&t.column<=this.column+1&&(t.hitType=t.type,t.destroy());game.audio.play("explosionBig")};break;case"WATER":this.explode=function(){game.rumble.level=10;for(var e,t=game.columns;t--;)if(t!==this.column)for(e=game.bricks[t].length;e--;)game.bricks[t][e]&&!game.bricks[t][e].removed&&game.bricks[t][e].row===this.row&&(game.bricks[t][e].hitType=game.bricks[t][e].type,game.bricks[t][e].destroy());game.audio.play("explosionBig")};break;case"AIR":this.explode=function(){game.rumble.level=10;for(var e,t,a=game.columns;a--;)for(e=game.bricks[a].length;e--;)t=game.bricks[a][e],t&&!t.removed&&t.type===this.type&&50===t.val&&(t.hitType=t.type,t.destroy());game.audio.play("explosionBig")}}},game.brick.prototype.destroy=function(e){this.removed=!0,this.type===this.hitType&&(this.explode(),game.flash=8),game.rumble.level=5;for(var t=12,a=10;a--;)game.particles.push(new game.particle({name:"particle"+this.col,x:this.x+this.width/2,y:this.y+this.height,w:this.width/t,h:this.height/(t/2),col:this.col,speed:game.rand.range(1,5),dist:100*game.rand.range(3,5)}));e||game.countScore(this.val),game.audio.play("explosion")},game.brick.prototype.hit=function(e,t){this.hitType=t,this.energy-=e,this.energy<=0&&!this.removed&&this.destroy(),game.audio.play("hit")},game.brick.prototype.update=function(){this.y+=game.timer.move+this.add,0===this.add?0!==game.s&&this.y>game.stage.height-this.height-game.brickWidth&&game.over():this.add-=game.gravity},game.brick.prototype.draw=function(){game.ctx.save(),game.ctx.translate(this.x,this.y),game.ctx.drawImage(this.sprite,0,0),game.ctx.restore()},game.star=function(e){this.x=game.rand.flot()*game.bg.ctx.canvas.width,this.y=game.rand.flot()*game.bg.ctx.canvas.height,this.brightness=15*e+game.rand.range(14*e,18*e)/100,this.radius=game.rand.flot()/e*4,this.color=game.starColors[game.rand.range(0,game.starColors.length)],this.draw()},game.star.prototype.update=function(){},game.star.prototype.draw=function(){game.bg.ctx.save(),game.bg.ctx.beginPath(),game.bg.ctx.globalAlpha=this.brightness,game.bg.ctx.fillStyle=this.color,game.bg.ctx.arc(this.x,this.y,this.radius,0,game.PI2),game.bg.ctx.fill(),game.bg.ctx.closePath(),game.bg.ctx.restore()},game.timer={date:new Date,curr:null,timestamp:Date.now(),delta:1,msec:0,move:0,t:1e3/60,tick:function(){game.timer.curr=Date.now(),game.timer.d=game.timer.curr-game.timer.timestamp,game.timer.delta=game.timer.d/game.timer.t,game.timer.delta=game.timer.delta<0?.001:game.timer.delta,game.timer.delta=game.timer.delta>10?10:game.timer.delta,game.timer.msec+=game.timer.delta,game.timer.timestamp=game.timer.curr,game.timer.move=game.s*game.timer.delta}},game.emitter={sum:0,row:0,emit:function(){if(game.emitter.sum>game.brickHeight+game.gap||0===game.emitter.sum){game.emitter.sum=0;for(var e,t,a,i=game.columns;i--;)t=game.rand.select(game.elementTypes),a=game.rand.select(Object.keys(game.elements[t].bricks)),e=new game.brick({column:i,type:t,item:a}),e.row=game.emitter.row,game.bricks[i].unshift(e);game.emitter.row++,game.s+=.001}game.emitter.sum+=game.timer.move}},game.init=function(){game.flash=0,game.elementTypes=Object.keys(game.elements),game.transformName=game.vendor.get("transform"),game.brickWidth=game.stage.width/game.columns-game.gap-game.gap/game.columns,game.brickHeight=game.brickWidth/2+game.gap,game.prevLevel=game.level,game.sprite.factory(),game.initBackground(),game.controls(),game.stats(),game.menu()},game.message=function(e,t,a){var i,m=game.msg.style;game.mnu.style.display="none",e?("object"==typeof e?(game.msg.innerHTML="",e.style.display="block",game.msg.appendChild(e)):game.msg.innerHTML=e,a&&(i=create("em"),i.innerHTML=a,game.msg.appendChild(i)),m.opacity=0,m.display="block",m.marginTop=-game.msg.offsetHeight/2+"px",m.opacity=1):m.display="none",t&&setTimeout(function(){m.display="none"},t)},game.newgame=function(){game.bricks=game.arr.create(game.columns),game.towers=[],game.bullets=[],game.particles=[],game.explosions=[],game.activeColumn=null,game.hoverColumn=null;var e,t=game.elementTypes.concat(game.arr.create(game.columns-4,0)).sort(function(){return.5-Math.random()});for(e=0;e<t.length;e++)game.towers[e]=t[e]?new game.tower({column:e,type:t[e]}):{};game.score=0,game.s=game.speed,game.countScore(0),game.paused=!1,game.msg.style.display="none"},game.over=function(){var e=600;game.s=0,game.message("GAME OVER",0,"MAIN MENU"),game.audio.play("death"),game.towers.forEach(function(e,t){setTimeout(function(){e&&e.x&&e.destroy()},100*t)}),game.bricks.forEach(function(t){setTimeout(function(){t.forEach(function(e){e&&!e.removed&&(e.add=-.001)})},e),e+=100})},game.pause=function(){game.paused?(game.paused=!1,game.message()):(game.paused=!0,game.message("PAUSE"))},game.mute=function(){game.audio.mute=!game.audio.mute},game.noBg=function(){game.moveBg=!game.moveBg},game.menu=function(e){game.paused=!0,e&&game.bricks&&(game.re.style.display="block"),game.mnu.style.display="block",game.msg.style.display="none"},game.help=function(){if(!game.buildHelp){for(var e in game.elements)if(game.elements.hasOwnProperty(e)){var t=e,a=game.elements[e],i=create("div"),m=create("h2"),g=create("p"),r=create("p");m.innerHTML=t+"<br />",g.innerHTML=a.desc,r.innerHTML=a.spec,i.appendChild(m),g.insertBefore(game.sprite.get(t),g.firstChild),i.appendChild(g),r.insertBefore(game.sprite.get(t+"-BRICK-special"),r.firstChild),i.appendChild(r),game.hlp.appendChild(i)}game.buildHelp=!0}game.message(game.hlp,0,"MAIN MENU")},game.credits=function(){game.message(game.crd,0,"MAIN MENU")},game.countScore=function(e){game.score+=e,game.level=Math.ceil(game.s/.12),game.hud.score.innerHTML=game.score,game.hud.level.innerHTML=game.level,game.level>game.prevLevel&&(game.prevLevel=game.level,game.message("LEVEL UP",2e3),game.audio.play("levelup"))},game.stats=function(){var e;"function"==typeof Stats?(e=new Stats,e.setMode(0),e.domElement.style.position="absolute",e.domElement.style.left="0px",e.domElement.style.top="0px",document.body.appendChild(e.domElement),game.stats=e):game.stats={begin:game.noop,end:game.noop}},game.update=function(){for(var e,t=game.bricks.length;t--;)for(e=game.bricks[t].length;e--;)game.bricks[t][e]&&(game.bricks[t][e].removed?game.bricks[t].splice(e,1):game.bricks[t][e].update());for(e=game.towers.length;e--;)game.towers[e].width&&(game.towers[e].removed?game.towers.splice(e,1):game.towers[e].update());for(e=game.bullets.length;e--;)game.bullets[e]&&(game.bullets[e].removed?game.bullets.splice(e,1):game.bullets[e].update());for(e=game.particles.length;e--;)game.particles[e]&&(game.particles[e].removed?game.particles.splice(e,1):game.particles[e].update());for(e=game.explosions.length;e--;)game.explosions[e]&&(game.explosions[e].removed?game.explosions.splice(e,1):game.explosions[e].update());game.rumble.update()},game.draw=function(){game.ctx.save(),game.ctx.clearRect(0,0,game.ctx.canvas.width,game.ctx.canvas.height);var e,t=game.bricks.length;for(game.drawFlash();t--;)for(e=game.bricks[t].length;e--;)null!==game.bricks[t][e]&&game.bricks[t][e].draw();for(e=game.towers.length;e--;)game.towers[e].width&&game.towers[e].draw();for(e=game.bullets.length;e--;)game.bullets[e].width&&game.bullets[e].draw();for(e=game.particles.length;e--;)null!==game.particles[e]&&game.particles[e].draw();for(e=game.explosions.length;e--;)null!==game.explosions[e]&&game.explosions[e].draw();game.rumble.draw(),game.drawSelection()},game.initBackground=function(){for(var e,t=null,a=game.bgs.length;a--;){for(game.bg.ctx.clearRect(0,0,game.bg.ctx.canvas.width,game.bg.ctx.canvas.height),e=game.starAmount;e--;)t=new game.star(game.bgs.length-a+1),t.draw();game.bgs[a].b.style.backgroundImage="url("+game.bg.toDataURL()+")"}},game.updateBackground=function(){if(game.moveBg)for(var e=game.bgs.length;e--;)game.bgs[e].c+=e+1,game.bgs[e].b.style.backgroundPosition="0px "+game.bgs[e].c/3+"px"},game.rumble.update=function(){game.rumble.level>0?(game.rumble.level-=game.rumble.decay,game.rumble.level=game.rumble.level<0?0:game.rumble.level,game.rumble.x=game.rand.rangef(-game.rumble.level,game.rumble.level),game.rumble.y=game.rand.rangef(-game.rumble.level,game.rumble.level)):(game.rumble.x=0,game.rumble.y=0)},game.rumble.draw=function(){(0!==game.rumble.x||0!==game.rumble.y)&&(game.stage.style[game.transformName]="translate("+game.rumble.x+"px,"+game.rumble.y+"px)")},game.drawSelection=function(){var e,t;if(null!==game.activeColumn&&(e=game.towers[game.activeColumn],e&&e.x&&(game.ctx.save(),game.ctx.translate(e.x,0),game.ctx.lineWidth=2,game.ctx.fillStyle=game.elements[e.type].color,game.ctx.globalAlpha=.2,game.ctx.fillRect(0,0,game.brickWidth,game.stage.height),game.ctx.restore())),null!==game.hoverColumn){e=game.towers[game.activeColumn],t=game.towers[game.hoverColumn];var a="#ffffff";t&&t.x&&(a=game.elements[t.type].color),e&&e.x&&(a=game.elements[e.type].color),game.ctx.save(),game.ctx.translate(game.gap+game.hoverColumn*(game.brickWidth+game.gap),0),game.ctx.lineWidth=2,game.ctx.fillStyle=a,game.ctx.globalAlpha=.2,game.ctx.fillRect(0,0,game.brickWidth,game.stage.height),game.ctx.restore()}},game.drawFlash=function(){game.flash>0&&(game.flash--,f.style.opacity=game.flash/10)},game.controls=function(){window.addEventListener("keyup",function(e){switch(console.log(e.keyCode),e.keyCode){case 27:game.menu(!0);break;case 80:game.pause();break;case 77:game.mute();break;case 66:game.noBg()}},!1),game.ng.addEventListener("click",function(){game.newgame(),game.audio.play("click"),game.mnu.style.display="none"},!1),game.hl.addEventListener("click",function(){game.help(),game.audio.play("click")},!1),game.re.addEventListener("click",function(){game.pause()},!1),["hlp","msg","crd"].forEach(function(e){game[e].addEventListener("click",function(){game.menu()},!1)}),game.cr.addEventListener("click",function(){game.credits(),game.audio.play("click")},!1),["ng","hl","cr","re"].forEach(function(e){game[e].addEventListener("mouseover",function(){game.audio.play("hover")},!1)}),game.cnt.addEventListener("mousemove",function(e){if(!game.paused&&game.s>0){var t=e.pageX-this.offsetLeft,a=Math.floor(t/(game.brickWidth+game.gap+game.gap/game.columns));game.hoverColumn=a}else game.hoverColumn=null},!1),game.cnt.addEventListener("click",function(e){if(!game.paused&&game.s>0){var t=e.pageX-this.offsetLeft,a=Math.floor(t/(game.brickWidth+game.gap+game.gap/game.columns));game.towers[a]&&game.towers[a].width?null===game.activeColumn?(game.activeColumn=a,game.audio.play("select")):(game.towers[game.activeColumn].setColumn(a),game.towers[a].setColumn(game.activeColumn),game.arr.move(game.towers,game.activeColumn,a),game.activeColumn=null,game.audio.play("move")):(null!==game.activeColumn&&(game.towers[game.activeColumn].setColumn(a),game.arr.move(game.towers,game.activeColumn,a),game.audio.play("move")),game.activeColumn=null)}else game.activeColumn=null},!1)},window.onload=function(){game.stage.width=game.wh/2,game.stage.height=game.wh-30,game.cnt.style.height=game.wh+"px",game.cnt.style.width=game.stage.width+"px",game.bg.width=game.ww,game.bg.height=game.wh;for(var e=0;3>e;e++)game.bgs[e].width=game.ww,game.bgs[e].height=game.wh;game.init(),function t(){game.timer.tick(),window.requestAnimationFrame(t,game.stage),game.stats.begin(),game.updateBackground(),game.paused||(game.emitter.emit(),game.update(),game.draw()),game.stats.end()}()};