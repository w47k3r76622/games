let t,i,s={};function e(t,i){s[t]=s[t]||[],s[t].push(i)}function h(t,...i){(s[t]||[]).map(t=>t(...i))}function n(){return i}function r(t){return t*Math.PI/180}function a(t,i,s){return Math.min(Math.max(t,s),i)}function l(t,i){return t.rotation||i.rotation?null:([t,i]=[t,i].map(t=>o(t)),t.x<i.x+i.width&&t.x+t.width>i.x&&t.y<i.y+i.height&&t.y+t.height>i.y)}function o(t){let{x:i=0,y:s=0,width:e,height:h}=t.world||t;return t.mapwidth&&(e=t.mapwidth,h=t.mapheight),t.anchor&&(i-=e*t.anchor.x,s-=h*t.anchor.y),e<0&&(i+=e,e*=-1),h<0&&(s+=h,h*=-1),{x:i,y:s,width:e,height:h}}class d{constructor(t=0,i=0,s={}){this.x=t,this.y=i,s._c&&(this.clamp(s._a,s._b,s._d,s._e),this.x=t,this.y=i)}add(t){return new d(this.x+t.x,this.y+t.y,this)}subtract(t){return new d(this.x-t.x,this.y-t.y,this)}scale(t){return new d(this.x*t,this.y*t)}normalize(t=this.length()){return new d(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}clamp(t,i,s,e){this._c=!0,this._a=t,this._b=i,this._d=s,this._e=e}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?a(this._a,this._d,t):t}set y(t){this._y=this._c?a(this._b,this._e,t):t}}function c(){return new d(...arguments)}c.prototype=d.prototype,c.class=d;let u=()=>{};function p(t,i){let s=i.parentNode;if(t.setAttribute("data-kontra",""),s){let e=s.querySelector("[data-kontra]:last-of-type")||i;s.insertBefore(t,e.nextSibling)}else document.body.appendChild(t)}class y extends class{constructor(t){return this.init(t)}init(t={}){this.position=c(),this.velocity=c(),this.acceleration=c(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let i=this.acceleration;t&&(i=i.scale(t)),this.velocity=this.velocity.add(i);let s=this.velocity;t&&(s=s.scale(t)),this.position=this.position.add(s),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}{init({width:t=0,height:i=0,context:s=n(),render:e=this.draw,update:h=this.advance,children:r=[],anchor:a={x:0,y:0},sx:l=0,sy:o=0,opacity:d=1,rotation:c=0,scaleX:u=1,scaleY:p=1,...y}={}){this.children=[],super.init({width:t,height:i,context:s,anchor:a,sx:l,sy:o,opacity:d,rotation:c,scaleX:u,scaleY:p,...y}),this._di=!0,this._uw(),r.map(t=>this.addChild(t)),this._rf=e,this._uf=h}update(t){this._uf(t),this.children.map(i=>i.update&&i.update(t))}render(t){let i=this.context;i.save(),(this.x||this.y)&&i.translate(this.x,this.y),this.rotation&&i.rotate(this.rotation),(this.sx||this.sy)&&i.translate(-this.sx,-this.sy),1==this.scaleX&&1==this.scaleY||i.scale(this.scaleX,this.scaleY);let s=-this.width*this.anchor.x,e=-this.height*this.anchor.y;(s||e)&&i.translate(s,e),this.context.globalAlpha=this.opacity,this._rf(),(s||e)&&i.translate(-s,-e);let h=this.children;t&&(h=h.filter(t)),h.map(t=>t.render&&t.render()),i.restore()}draw(){}_pc(t,i){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:i=0,_wo:s=1,_wr:e=0,_wsx:h=1,_wsy:n=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=s*this.opacity,this._wr=e+this.rotation;let{x:r,y:a}=function(t,i){let s=Math.sin(i),e=Math.cos(i);return{x:t.x*e-t.y*s,y:t.x*s+t.y*e}}({x:this.x,y:this.y},e);this._wx=r,this._wy=a,this._wsx=h*this.scaleX,this._wsy=n*this.scaleY,this._wx=this.x*h,this._wy=this.y*n,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wx+=t,this._wy+=i}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}addChild(t,{absolute:i=!1}={}){this.children.push(t),t.parent=this,t._pc=t._pc||u,t._pc()}removeChild(t){let i=this.children.indexOf(t);-1!==i&&(this.children.splice(i,1),t.parent=null,t._pc())}get opacity(){return this._opa}set opacity(t){this._opa=t,this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,i=t){this.scaleX=t,this.scaleY=i}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}function x(){return new y(...arguments)}x.prototype=y.prototype,x.class=y;class w extends x.class{init({image:t,width:i=(t?t.width:void 0),height:s=(t?t.height:void 0),...e}={}){super.init({image:t,width:i,height:s,...e})}get animations(){return this._a}set animations(t){let i,s;for(i in this._a={},t)this._a[i]=t[i].clone(),s=s||this._a[i];this.currentAnimation=s,this.width=this.width||s.width,this.height=this.height||s.height}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){super.advance(t),this.currentAnimation&&this.currentAnimation.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}function f(){return new w(...arguments)}f.prototype=w.prototype,f.class=w;let g=/(\d+)(\w+)/;class _ extends x.class{init({text:t="",textAlign:i="",lineHeight:s=1,font:e=n().font,...h}={}){super.init({text:t=""+t,textAlign:i,lineHeight:s,font:e,...h}),this._p()}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=function(t){let i=t.match(g),s=+i[1];return{size:s,unit:i[2],computed:s}}(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context;if(t.font=this.font,!this._s.length&&this._fw){let i=this.text.split(" "),s=0,e=2;for(;e<=i.length;e++){let h=i.slice(s,e).join(" ");t.measureText(h).width>this._fw&&(this._s.push(i.slice(s,e-1).join(" ")),s=e-1)}this._s.push(i.slice(s,e).join(" "))}if(!this._s.length&&this.text.includes("\n")){let i=0;this.text.split("\n").map(s=>{this._s.push(s),i=Math.max(i,t.measureText(s).width)}),this._w=this._fw||i}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,i=this.textAlign,s=this.context;i=this.textAlign||("rtl"===s.canvas.dir?"right":"left"),t="right"===i?this.width:"center"===i?this.width/2|0:0,this._s.map((e,h)=>{s.textBaseline="top",s.textAlign=i,s.fillStyle=this.color,s.font=this.font,s.fillText(e,t,this._fs*this.lineHeight*h)})}}function m(){return new _(...arguments)}function v(t){let i=t.canvas;t.clearRect(0,0,i.width,i.height)}m.prototype=_.prototype,m.class=_;let b={},S={},A={},M={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"left",ArrowUp:"up",ArrowRight:"right",ArrowDown:"down"};function E(t=u,i){t._pd&&i.preventDefault(),t(i)}function j(t){let i=M[t.code],s=b[i];A[i]=!0,E(s,t)}function T(t){let i=M[t.code],s=S[i];A[i]=!1,E(s,t)}function C(){A={}}function D(t){return!!A[t]}class F{constructor({create:t,maxSize:i=1024}={}){let s;if(!t||!(s=t())||!(s.update&&s.init&&s.isAlive&&s.render))throw Error("Must provide create() function which returns an object with init(), update(), render(), and isAlive() functions");this._c=t,this.objects=[t()],this.size=0,this.maxSize=i}get(t={}){if(this.size===this.objects.length){if(this.size===this.maxSize)return;for(let t=0;t<this.size&&this.objects.length<this.maxSize;t++)this.objects.push(this._c())}let i=this.objects[this.size];return this.size++,i.init(t),i}getAliveObjects(){return this.objects.slice(0,this.size)}clear(){this.size=this.objects.length=0,this.objects.push(this._c())}update(t){let i,s=!1;for(let e=this.size;e--;)i=this.objects[e],i.update(t),i.isAlive()||(s=!0,this.size--);s&&this.objects.sort((t,i)=>i.isAlive()-t.isAlive())}render(){for(let t=this.size;t--;)this.objects[t].render()}}function z(){return new F(...arguments)}function P(t,i){let s=[],e=i.x+i.width/2,h=i.y+i.height/2,n=(o(t),t.y<h),r=t.y+t.height>=h;return t.x<e&&(n&&s.push(0),r&&s.push(2)),t.x+t.width>=e&&(n&&s.push(1),r&&s.push(3)),s}z.prototype=F.prototype,z.class=F;class L{constructor({maxDepth:i=3,maxObjects:s=25,bounds:e}={}){this.maxDepth=i,this.maxObjects=s,this.bounds=e||{x:0,y:0,width:t.width,height:t.height},this._b=!1,this._d=0,this._o=[],this._s=[],this._p=null}clear(){this._s.map((function(t){t.clear()})),this._b=!1,this._o.length=0}get(t){let i=new Set;for(;this._s.length&&this._b;)return P(t,this.bounds).map(s=>{this._s[s].get(t).map(t=>i.add(t))}),Array.from(i);return this._o.filter(i=>i!==t)}add(...t){t.map(t=>{Array.isArray(t)?this.add.apply(this,t):this._b?this._a(t):(this._o.push(t),this._o.length>this.maxObjects&&this._d<this.maxDepth&&(this._sp(),this._o.map(t=>this._a(t)),this._o.length=0))})}_a(t){P(t,this.bounds).map(i=>{this._s[i].add(t)})}_sp(t,i,s){if(this._b=!0,!this._s.length)for(t=this.bounds.width/2|0,i=this.bounds.height/2|0,s=0;s<4;s++)this._s[s]=new L({bounds:{x:this.bounds.x+(s%2==1?t:0),y:this.bounds.y+(s>=2?i:0),width:t,height:i},maxDepth:this.maxDepth,maxObjects:this.maxObjects}),this._s[s]._d=this._d+1,this._s[s]._p=this}}function k(){return new L(...arguments)}function B(t){let i=[];return t._dn?i.push(t._dn):t.children&&t.children.map(t=>{i=i.concat(B(t))}),i}k.prototype=L.prototype,k.class=L;class H extends x.class{init({id:t,name:i=t,cullObjects:s=!0,cullFunction:e=l,...h}){const n=this._dn=document.createElement("section");n.tabIndex=-1,n.style="position:absolute;width:1px;height:1px;overflow:hidden;",n.id=t,n.setAttribute("aria-label",i),super.init({id:t,name:i,cullObjects:s,cullFunction:e,...h}),p(n,this.context.canvas);let r=this.context.canvas;this.camera=x({x:r.width/2,y:r.height/2,width:r.width,height:r.height,anchor:{x:.5,y:.5}}),this.camera._pc=()=>{super._pc.call(this.camera),this.camera._wx=this.camera.x*this.scaleX,this.camera._wy=this.camera.y*this.scaleY}}show(){this.hidden=this._dn.hidden=!1;let t=this.children.find(t=>t.focus);t?t.focus():this._dn.focus(),this.onShow()}hide(){this.hidden=this._dn.hidden=!0,this.onHide()}addChild(t,i){super.addChild(t,i),B(t).map(t=>{this._dn.appendChild(t)})}removeChild(t){super.removeChild(t),B(t).map(t=>{p(t,this.context.canvas)})}destroy(){this._dn.remove(),this.children.map(t=>t.destroy&&t.destroy())}update(t){this.hidden||super.update(t)}lookAt(t){let i=(t=t.world||t).x,s=t.y;t.scaleX&&(i/=t.scaleX,s/=t.scaleY),this.camera.x=i,this.camera.y=s,this._pc()}_pc(){super._pc(),this.camera&&this.camera._pc()}render(){let{x:t,y:i,width:s,height:e}=this.camera;this.sx=t*this.scaleX-s/2,this.sy=i*this.scaleY-e/2,this.hidden||super.render(t=>!this.cullObjects||this.cullFunction(t,this.camera))}onShow(){}onHide(){}}function I(){return new H(...arguments)}I.prototype=H.prototype,I.class=H;class O extends x.class{constructor(t){super(t),this.anchor={x:.5,y:.5},this.x=150,this.y=250,this.width=32,this.height=26,this.dx=0,this.dy=0,this.bullets=[],this.dt=0,this.hitted=!1,this.hitDt=0,this.lives=3,this.power=1,this.spawning=!1,this.spawningT=0,this.spawn()}hit(){this.spawning||(this.hitted=!0,this.hitDt=0,this.lives-=1,0==this.lives&&h("gameover"),h("explode",this.x,this.y,70,4),this.spawn())}spawn(){this.spawning=!0,this.spawningT=0,this.x=16,this.y=this.context.canvas.height/2-16,this.dy=0,this.dx=1,this.ddx=0,this.ddy=0,this.rotation=0}fire(){this.dt=0,this.bullets.push(new Y({x:this.x+16,y:this.y+8,dx:10,dy:Math.random()-.5,rotation:this.rotation}))}update(t){super.update(t);const{context:i}=this;if(this.spawning&&this.spawningT++,this.spawningT>100&&(this.spawning=!1),this.spawning)return this.advance(),this.bullets=this.bullets.filter(t=>t.isAlive()),void this.bullets.forEach(t=>t.update());this.dt+=1/60,this.ddx=0,this.ddy=0,D("left")&&this.dx>-3&&(this.ddx=-.2),D("right")&&this.dx<3&&(this.ddx=.2),D("up")&&this.dy>-3&&(this.ddy=-.2),D("down")&&this.dy<3&&(this.ddy=.2),D("space")&&this.dt>.05&&this.fire(),this.dx>0?(this.dx-=.05,this.dx<.05&&(this.dx=0)):this.dx<0&&(this.dx+=.05,this.dx>.05&&(this.dx=0)),this.dy>0?(this.dy-=.05,this.dy<.05&&(this.dy=0)):this.dy<0&&(this.dy+=.05,this.dy>.05&&(this.dy=0)),this.x<0&&(this.x=0,this.dx=0),this.x>i.canvas.width&&(this.x=i.canvas.width,this.dx=0),this.y<0&&(this.y=0,this.dy=0),this.y>i.canvas.height&&(this.y=i.canvas.height,this.dy=0),this.advance(),this.bullets=this.bullets.filter(t=>t.isAlive()),this.bullets.forEach(t=>t.update())}draw(){const{context:t}=this;function i(t,i,s,e){const h=new Path2D(i);s&&(t.fillStyle=s),e&&(t.strokeStyle=e),t.fill(h),t.stroke(h)}function s(t,i,s,e,h,n){t.beginPath(),t.fillStyle=h,t.strokeStyle=n,t.arc(i,s,e,0,Math.PI/180*360),h&&t.fill(),n&&t.stroke()}this.spawning&&this.spawningT%5&&(t.beginPath(),t.fillStyle="rgba(255, 255, 0, 0.25)",t.arc(16,16,32,0,Math.PI/180*360),t.fill()),t.save(),t.scale(.5,.5),t.globalAlpha=.3,i(t,"m59 34-2 10c-1 2-3 3-6 4H12l-5-4c-2-2-2-5-2-10C5 16 17 1 32 1s27 15 27 33Z","#3FAEFF","#000"),t.globalAlpha=1,i(t,"m51 34-5 2 1-3 4 1ZM53 31l-6-4 1 5 5-1Z","#FFA63D","#000"),i(t,"m33 13-2-5 5 5 2 3-6-1-5-4 4 2-2-3c1-1 4 3 4 3Z","#000","#000"),i(t,"M44 19c-4-6-24-4-29 0-4 5-3 15 0 18 4 4 25 3 29 0s4-12 0-18Z","#3FAEFF","#000"),s(t,37.9,27.4,5.6,"#fff","#000"),s(t,39.4,27.4,2.3,"#000"),s(t,40,26.6,.8,"#fff"),i(t,"M32 34c-4-2-19-4-19-4l1 4 3 4 8 1h11s1-3-4-5Z","#fff"),i(t,"m40 20-6-1-1 2h7v-1Z","#000"),t.globalAlpha=.3,i(t,"m59 34-2 10c-1 2-3 3-6 4H12l-5-4c-2-2-2-5-2-10C5 16 17 1 32 1s27 15 27 33Z","#3FAEFF","#000"),t.globalAlpha=1,function(t,i,s,e,h,n,r){t.fillStyle="#FFA63D",t.strokeStyle="#000",t.rect(.5,34.6,63,15.9),t.fill(),t.stroke()}(t),t.restore()}render(){super.render(),this.bullets.forEach(t=>t.render())}}class Y extends x.class{constructor(t){super(t),this.id="bullet",this.ttl=t.ttl||1e3,this.type=t.type||0,this.entityType="bullet",this.radius=2,this.width=2,this.height=2}update(t){super.update(t),(this.x<0||this.x>this.context.canvas.width||this.y<0||this.y>this.context.canvas.height)&&(this.ttl=0)}draw(){const{context:t,type:i}=this;t.save(),t.globalCompositeOperation="lighter",0==i?(t.fillStyle="white",t.fillRect(-2,-2,4,4),t.fillStyle="yellow",t.fillRect(-6,-2,4,4),t.fillStyle="red",t.fillRect(-8,-2,4,4)):1==i&&(t.beginPath(),t.fillStyle="rgba(255, 0, 0, 0.5)",t.arc(0,0,4,0,Math.PI/180*360),t.fill(),t.beginPath(),t.fillStyle="red",t.arc(0,0,2,0,Math.PI/180*360),t.fill()),t.restore()}}class X extends x.class{constructor(t){super(t),this.anchor={x:.5,y:.5},this.x=t.x||650,this.y=t.y||100,this.dir=t.dir||1,this.dx=0,this.dy=0,this.bullets=[],this.dt=0,this.dt2=0,this.width=64,this.height=64,this.fired=!1,this.hitted=!1,this.hitDt=0,this.damage=0,this.energy=1e3,this.slots=[{x:0,y:-64},{x:0,y:-128},{x:-64,y:16},{x:64,y:16},{x:-32,y:64},{x:32,y:64},{x:-160,y:128},{x:160,y:128}],this.modulesLength=0,this.statusBar=null,this.debug=m({text:"Hello World!\nI can even be multiline!",font:"18px Monospace",color:"white",x:20,y:40,anchor:{x:0,y:0}})}addStatusBar(){const t=f({energy:0,total:0,updateBar(t,i){this.energy=t,this.total=i},render(){const{context:t}=this;t.strokeStyle="white",t.lineWidth=1,t.strokeRect(-48,-64,96,10),t.fillStyle=this.energy<this.total/3?"red":"green",t.fillRect(-46,-62,92*this.energy/this.total,6)}});this.addChild(t),this.statusBar=t}addModule(t){this.addChild(t),this.modulesLength++,t.slot=this.modulesLength,t.x=this.slots[t.slot-1].x,t.y=this.slots[t.slot-1].y,t.sx=this.slots[t.slot-1].x,t.sy=this.slots[t.slot-1].y}hit(t){this.hitted=!0,this.hitDt=0,this.damage++,this.energy-=t||10,h("score",2),this.energy<0&&(h("score",2e3),h("explode",this.x,this.y,100,5),this.children.map(t=>{t.slot&&h("explode",this.x+t.x,this.y+t.y)}),this.ttl=1)}update(t){super.update(t),this.rotation=0,this.statusBar&&this.statusBar.updateBar(this.energy,1e3),this.energy<=0&&(this.ttl=0),this.dt+=t,this.dt2+=t,this.dx=Math.cos(this.dt2)*this.dir,this.dy=Math.sin(this.dt2/2)*this.dir,(this.x<40||this.x>this.context.canvas.width-40)&&(this.dx=0),(this.y<40||this.y>this.context.canvas.height-40)&&(this.dy=0),this.dt>1.5+Math.random()&&(this.dt=0,this.fired=!1),this.hitted&&(this.hitDt+=1,this.hitDt>4&&(this.hitted=!1)),this.advance();let i=!1,s=!0;this.children.forEach(t=>{!t.isAlive()&&t.slot&&(s=t.slot%2==1,i=!0,console.log(t.slot,s,i)),i&&t.slot&&t.slot%2==1===s&&(t.ttl=0)}),this.children=this.children.filter(t=>t.isAlive())}draw(){const{context:t}=this;let i=4*Math.random()-2,s=4*Math.random()-2;t.save(),this.hitted&&t.translate(i,s),t.beginPath(),t.fillStyle="rgba(255, 0, 0, 0.5)",this.hitted&&(t.fillStyle="rgba(255, 255, 255, 0.5)"),t.arc(32,32,32,0,Math.PI/180*360),t.fill(),t.beginPath(),t.fillStyle="red",this.hitted&&(t.fillStyle="white"),t.arc(32,32,16,0,Math.PI/180*360),t.fill(),t.restore()}render(){super.render()}}class R extends x.class{constructor(t){super(t),this.type=t.type||0,this.anchor={x:.5,y:.5},this.width=64,this.height=64,this.dt=0,this.hitted=!1,this.hitDt=0,this.energy=200,this.fireStatus=0,this.fireT=0,this.maxBullets=1==t.type?18:36}hit(t){this.hitted=!0,this.hitDt=0,this.energy-=t||10,this.parent.hit(1),h("score",1),this.energy<0&&(h("score",100),h("explode",this.parent.x+this.x,this.parent.y+this.y),this.ttl=0)}update(t){super.update(t),this.dt+=t,this.hitted&&(this.hitDt++,this.hitDt>10&&(this.hitted=!1)),2!==this.type&&(this.fireT+=t,this.fireT>3+40*Math.random()&&0===this.fireStatus&&(this.fireStatus=1,this.fireT=0),this.fireT>1+1*Math.random()&&2===this.fireStatus&&(this.fireStatus=0,this.fireT=0),this.fireT>1+1*Math.random()&&1===this.fireStatus&&(this.fireStatus=2,this.fireT=0,h("fire",this.parent.x+this.x,this.parent.y+this.y,this.rotation,this.maxBullets))),0===this.fireStatus&&(this.rotation=r(100*this.dt%360)),this.exploding&&(this.explodingT+=t),this.advance()}draw(){const{context:t}=this;let i=4*Math.random()-2,s=4*Math.random()-2;this.hitted&&t.translate(i,s),t.save(),t.translate(this.x,this.y),t.beginPath(),t.fillStyle="#990",this.hitted&&(t.fillStyle="rgba(255,255,255,0.5)"),t.arc(32,32,32,0,Math.PI/180*360),t.fill(),t.fillStyle="#fff";var e=new Path2D("M30 0v4h1v12.03c-2.188.136-4.257.71-6.12 1.638L18.866 7.25l.866-.5-2-3.464-3.464 2 2 3.464.866-.5 6.015 10.418a16.087 16.087 0 0 0-4.48 4.48L8.251 17.134l.5-.866-3.464-2-2 3.464 3.464 2 .5-.866 10.417 6.014A15.906 15.906 0 0 0 16.03 31H4v-1H0v4h4v-1h12.03c.136 2.188.71 4.257 1.638 6.12L7.25 45.134l-.5-.866-3.464 2 2 3.464 3.464-2-.5-.866 10.418-6.015a16.087 16.087 0 0 0 4.48 4.48l-6.015 10.418-.866-.5-2 3.464 3.464 2 2-3.464-.866-.5 6.014-10.417A15.908 15.908 0 0 0 31 47.97V60h-1v4h4v-4h-1V47.97a15.907 15.907 0 0 0 6.12-1.638l6.014 10.417-.866.5 2 3.464 3.464-2-2-3.464-.866.5-6.015-10.418a16.086 16.086 0 0 0 4.48-4.48l10.418 6.015-.5.866 3.464 2 2-3.464-3.464-2-.5.866-10.417-6.014A15.906 15.906 0 0 0 47.97 33H60v1h4v-4h-4v1H47.97a15.906 15.906 0 0 0-1.638-6.12l10.417-6.014.5.866 3.464-2-2-3.464-3.464 2 .5.866-10.418 6.015a16.086 16.086 0 0 0-4.48-4.48l6.015-10.418.866.5 2-3.464-3.464-2-2 3.464.866.5-6.014 10.417A15.908 15.908 0 0 0 33 16.03V4h1V0h-4Z");t.fill(e),t.restore()}render(){super.render()}}class Z extends x.class{constructor(t){super(t)}init(t){super.init(t);let i=360*Math.random(),s=t&&t.magnitude||2,e=Math.random()*s+s;this.dx=Math.cos(r(i))*e,this.dy=Math.sin(r(i))*e,this.width=4,this.height=4,this.anchor={x:.5,y:.5},this.ttl=30*s,this.maxTTL=30*s,this.dt=0}update(t){this.dt+=t,this.advance()}draw(){const{context:t}=this;t.fillStyle="rgba(255,255,255,"+(1-60*this.dt/this.maxTTL)+")",t.fillRect(0,0,4,4)}}var V=t=>{const i=new O,s=new X({x:650}),h=k(),n=k();s.addModule(new R({type:0})),s.addModule(new R({type:0})),s.addModule(new R({type:1})),s.addModule(new R({type:1})),s.addModule(new R({type:2})),s.addModule(new R({type:2})),s.addStatusBar();const a=m({font:"18px Monospace",color:"white",x:20,y:20,anchor:{x:0,y:0},text:"LIVES:"+i.lives});function l(t,i){i.forEach(i=>{var s,e;"bullet"==i.entityType&&(s=i,e=t,[s,e]=[s,e].map(t=>o(t)),s.x<e.x+e.width&&s.x+s.width>e.x&&s.y<e.y+e.height&&s.y+s.height>e.y)&&(console.log("hit"),i.ttl=0,t.hit&&t.hit())})}const d=I({...t,id:"game",children:[i,s,a],update(t){this.children=this.children.filter(t=>t.isAlive()),a.text="LIVES:"+i.lives,s.isAlive()&&(h.clear(),h.add(s,s.children,i.bullets),l(s,h.get(s)),h.clear(),h.add(s.children,i.bullets),s.children.forEach(t=>{l(t,h.get(t))})),n.clear(),n.add(i,this.children.filter(t=>"bullet"==t.id)),l(i,n.get(i))}});return e("fire",(t,i,s,e)=>{for(let h=0;h<e;h++){let n=new Y({x:t,y:i,dx:100*Math.cos(s+r(h*(360/e))),dy:100*Math.sin(s+r(h*(360/e))),rotation:s,ttl:2e3,type:1});d.addChild(n)}}),d},q=t=>{const i=m({x:20,y:200,text:"Press Enter to start game",font:"18px monospace",color:"white"}),s=m({x:20,y:100,text:"Use arrow keys to move Barry's ship and space to shoot.\nGame by Marco Fernandes",font:"18px monospace",color:"white"});return I({...t,id:"menu",children:[m({x:20,y:20,text:"Barry In Space",font:"32px monospace",color:"yellow"}),s,i],update(t){this.children=this.children.filter(t=>t.isAlive()),D("enter")&&h("startgame")}})};(async()=>{const{context:s}=function(s){if(t=document.getElementById("c")||"c",!t)throw Error("You must provide a canvas element for the game");return i=t.getContext("2d"),i.imageSmoothingEnabled=!1,h("init"),{canvas:t,context:i}}();let r=V();const a=q(),l=z({maxSize:300,create:t=>new Z(t)});let o=0,d=a;const c=m({x:600,y:20,text:"SCORE:"+o,font:"18px Monospace",color:"white"});s.imageSmoothingEnabled=!1,function(){let t;for(t=0;t<26;t++)M[t+65]=M["Key"+String.fromCharCode(t+65)]=String.fromCharCode(t+97);for(t=0;t<10;t++)M[48+t]=M["Digit"+t]=""+t;window.addEventListener("keydown",j),window.addEventListener("keyup",T),window.addEventListener("blur",C)}(),function({fps:t=60,clearCanvas:i=!0,update:s=u,render:e,context:r=n(),blur:a=!1}={}){if(!e)throw Error("You must provide a render() function");let l,o,d,c,p,y=0,x=1e3/t,w=1/t,f=i?v:u,g=!0;function _(){if(o=requestAnimationFrame(_),g&&(d=performance.now(),c=d-l,l=d,!(c>1e3))){for(h("tick"),y+=c;y>=x;)p.update(w),y-=x;f(r),p.render()}}return a||(window.addEventListener("focus",()=>{g=!0}),window.addEventListener("blur",()=>{g=!1})),p={update:s,render:e,isStopped:!0,start(){l=performance.now(),this.isStopped=!1,requestAnimationFrame(_)},stop(){this.isStopped=!0,cancelAnimationFrame(o)},_frame:_,set _last(t){l=t}},p}({update:function(t){d.update(t),l.update(t),c.text="SCORE:"+o,c.update(t)},render:function(){d.children.forEach(t=>{t.render()}),l.render(),c.render()}}).start(),e("explode",(t,i,s=50,e=3)=>{for(let h=0;h<s;h++)l.get({x:t,y:i,magnitude:e})}),e("gameover",()=>{d=a}),e("startgame",()=>{r=V(),d=r}),e("score",t=>{o+=t})})();
