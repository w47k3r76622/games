function random(t,e){return(Math.random()*e|0)+t}function mouseClicked(t){hasClicked=!0,lostLevel||win||nextLevelState||levels[currentLevel].eventMouseClicked(t)}function mouseMove(t){xMouse=t.clientX,yMouse=t.clientY}function nextHitSong(){currentHit+1==audioHit.length&&(currentHit=-1),audioHit[++currentHit].play()}function randomColor(){var t=Math.round(Math.random()*(colors.length-1));return colors[t]}function Level(t,e,o,s,i){this.goal=t,this.ballsPlaced=0,this.generation=e,this.logic=o,this.draw=s,this.eventMouseClicked=i}function nextLevel(){if(reset(),currentLevel!=levels.length-1)currentLevel>-1?nextLevelState=!0:levels[++currentLevel].generation();else{win=!0;for(var t=0;120>t;t++)points.push(new Point(random(1,WIDTH),random(1,HEIGHT)))}}function reset(){points=[],pointsTouched=[],mousePoints=[],flashBall=[]}function lost(){lostLevel=!0}function Message(t,e,o,s,i){this.msg=t,this.x=e,this.y=o,this.time=s,this.animation=i,this.logic=function(){return this.startTime+this.time<Date.now()?void messages.splice(messages.indexOf(this),1):void(null!=this.animation&&animations[this.animation].logic())},this.draw=function(){ctx.font="30px serif",ctx.fillText(this.msg,this.x,this.y)},this.startTime=Date.now(),messages.push(this)}function Animation(t,e,o){this.start=t,this.sens=1,this.step=t,this.bearing=o,this.end=e,this.logic=function(){this.step>this.end-1?this.sens*=-1:this.step<this.start&&(this.sens*=-1),this.step+=this.bearing*this.sens}}function loop(t){if(lastFrameTimeMs+1e3/maxFPS>t)return void requestAnimationFrame(loop);delta+=t-lastFrameTimeMs,lastFrameTimeMs=t,t>lastFpsUpdate+1e3&&(fps=.25*framesThisSecond+.75*fps,lastFpsUpdate=t,framesThisSecond=0),framesThisSecond++;for(var e=0;delta>=timestep;)if(update(timestep),delta-=timestep,++e>=240){panic();break}draw(),requestAnimationFrame(loop)}function draw(){if(ctx.fillStyle="black",ctx.fillRect(0,0,WIDTH,HEIGHT),ctx.save(),levels[currentLevel].draw(),ctx.fillStyle="white",ctx.shadowBlur=0,ctx.font="24px serif",ctx.fillText(levels[currentLevel].goal,22,30),ctx.fillText("balls captured: "+pointsTouched.length,22,60),lostLevel?(ctx.fillStyle="white",ctx.shadowOffsetX=0,ctx.shadowOffsetY=0,ctx.shadowColor="white",ctx.shadowBlur=animations.lost.step,ctx.font="30px serif",ctx.fillText("CLICK TO",WIDTH/2-42,HEIGHT/2-30),ctx.font="42px serif",ctx.fillText("RETRY",WIDTH/2-42,HEIGHT/2)):win&&(ctx.fillStyle="white",ctx.font="42px serif",ctx.shadowOffsetX=0,ctx.shadowOffsetY=0,ctx.shadowColor="white",ctx.shadowBlur=animations.win.step,ctx.font="72px serif",ctx.fillText("Good Game !",WIDTH/2-200,HEIGHT/2)),nextLevelState)return ctx.fillStyle="white",ctx.shadowOffsetX=0,ctx.shadowOffsetY=0,ctx.shadowColor="white",ctx.shadowBlur=animations.lost.step,ctx.font="30px serif",ctx.fillText("CLICK TO",WIDTH/2-42,HEIGHT/2-30),ctx.font="42px serif",void ctx.fillText("NEXT LEVEL",WIDTH/2-92,HEIGHT/2);ctx.translate(WIDTH/2,HEIGHT/2),ctx.rotate(alpha),ctx.translate(-WIDTH/2,-HEIGHT/2),ctx.beginPath(),flashBall.length>0&&(ctx.fillStyle=flashBall[0].color,ctx.globalAlpha=.4,ctx.shadowBlur=10,ctx.shadowColor=flashBall[0].color);for(var t=0;t<flashBall.length;t++)ctx.moveTo(flashBall[t].x,flashBall[t].y),ctx.arc(flashBall[t].x,flashBall[t].y,flashBall[t].radius,0,2*Math.PI,!1);ctx.fill(),ctx.globalAlpha=1;for(var e=0;e<points.length;e++)ctx.beginPath(),ctx.fillStyle=points[e].color,ctx.shadowBlur=16,ctx.shadowColor=points[e].color,ctx.arc(points[e].x,points[e].y,points[e].radius,0,2*Math.PI,!1),ctx.fill();ctx.beginPath(),ctx.fillStyle="white",ctx.shadowOffsetX=0,ctx.shadowOffsetY=0,ctx.shadowBlur=20,ctx.shadowColor="white";for(var e=0;e<mousePoints.length;e++)ctx.moveTo(mousePoints[e].x,mousePoints[e].y),ctx.arc(mousePoints[e].x,mousePoints[e].y,mousePoints[e].radius,0,2*Math.PI,!1);ctx.fill();for(var o=0;o<messages.length;o++)messages[o].draw();ctx.beginPath(),ctx.fillStyle="white",ctx.shadowBlur=1,ctx.lineWidth=2,ctx.arc(xMouse,yMouse,11,0,2*Math.PI,!1),ctx.fill(),ctx.beginPath(),ctx.arc(xMouse,yMouse,8,0,2*Math.PI,!1),ctx.stroke(),ctx.restore()}function panic(){delta=0,ctx.clearRect(0,0,WIDTH,HEIGHT)}function update(){for(var t=0;t<messages.length;t++)messages[t].logic();for(var e=0;e<flashBall.length;e++)flashBall[e].radius+=.8,flashBall[e].radius>70&&(flashBall.splice(e,1),e--);if(4>currentLevel){for(var o=-1,s=0;s<mousePoints.length;s++)mousePoints[s].radius+=.1,mousePoints[s].radius>=28&&(o=s);o>=0&&mousePoints.splice(o,1)}for(var s=0;s<points.length;s++)points[s].x+points[s].speedX*points[s].dx>=WIDTH?points[s].dx*=-1:points[s].x+points[s].speedX*points[s].dx<=0&&(points[s].dx*=-1),points[s].y+points[s].speedY*points[s].dy>=HEIGHT?points[s].dy*=-1:points[s].y+points[s].speedY*points[s].dy<=0&&(points[s].dy*=-1),points[s].x+=points[s].speedX*points[s].dx,points[s].y+=points[s].speedY*points[s].dy,points[s].x=parseInt(100*points[s].x)/100,points[s].y=parseInt(100*points[s].y)/100;return nextLevelState?(animations.win.logic(),void(hasClicked&&(levels[++currentLevel].generation(),nextLevelState=!1))):(lostLevel?(animations.lost.logic(),hasClicked&&(reset(),levels[currentLevel].generation(),lostLevel=!1)):win?win&&animations.win.logic():levels[currentLevel].logic(),void(hasClicked=!1))}var lastFrameTimeMs=0,maxFPS=120,delta=0,timestep=1e3/120,fps=120,framesThisSecond=0,lastFpsUpdate=0;window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),Date.now||(Date.now=function(){return(new Date).getTime()});var elem=document.getElementById("canvasGame"),ctx=elem.getContext("2d"),xMouse=0,yMouse=0,w=window,e=document.documentElement,g=document.getElementsByTagName("body")[0],heightW=w.innerHeight||e.clientHeight||g.clientHeight,widthW=w.innerWidth||e.clientWidth||g.clientWidth;ctx.canvas.width=widthW-0,ctx.canvas.height=heightW-4;var WIDTH=widthW,HEIGHT=heightW-4,hasClicked=!1,alpha=0,audioHit=[];audioHit.push(new Audio("sound/select.wav")),audioHit.push(new Audio("sound/hit.wav")),audioHit.push(new Audio("sound/hitSine.wav"));var currentHit=0,Point=function(t,e,o,s,i,n,l){if(this.x=t,this.y=e,void 0==s){this.dx=parseInt(100*Math.random())/100;var a=random(1,2);1==a&&(this.dx*=-1)}else this.dx=s;if(void 0==i){this.dy=parseInt(100*Math.random())/100;var a=random(1,2);1==a&&(this.dy*=-1)}else this.dy=i;this.color=void 0==o?randomColor():o,this.speedX=void 0==n?random(2,7):n,this.speedY=void 0==l?random(2,7):l,this.radius=4,this.inCollision=function(t){var e=Math.sqrt((this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y));return e<this.radius+t.radius?!0:!1}},colors=["#b543de","#FF4B47","#40E64F","#E0C93B","#F58F39","#39BAC5","#e63192"],points=[],pointsTouched=[],mousePoints=[],currentLevel=-1,levels=[],flashBall=[];levels.push(new Level("Place one ball and capture 10 other with the first !",function(){for(var t=0;72>t;t++)points.push(new Point(WIDTH/2,HEIGHT/2));this.ready=!1,this.step=0,this.next=!1},function(){if(this.ready)this.next&&this.step<3&&(this.ready=!1,this.step++);else{if(!hasClicked)return;this.ready=!0,this.next=!1}for(var t=0;t<points.length;t++)for(var e=0;e<mousePoints.length;e++)if(points[t].inCollision(mousePoints[e])&&-1==pointsTouched.indexOf(points[t])){points[t].color="white",pointsTouched.push(points[t]);var o=new Point(points[t].x,points[t].y);o.color="white",flashBall.push(o),nextHitSong(),1==this.step&&this.ready&&(this.next=!0)}pointsTouched.length>=10&&nextLevel()},function(){if(!this.ready)if(0==this.step)ctx.font="23px serif",ctx.fillStyle="white",ctx.strokeStyle="white",ctx.lineWidth="10",ctx.moveTo(200,55),ctx.lineTo(200,.42*HEIGHT),ctx.moveTo(202,55),ctx.lineTo(150,100),ctx.moveTo(198,55),ctx.lineTo(250,100),ctx.stroke(),ctx.fillText("LEVEL INSTRUCTION",100,.42*HEIGHT+25),ctx.font="42px serif",ctx.shadowColor=randomColor(),ctx.shadowBlur="50",ctx.fillText("Mouse Left: Put one ball",WIDTH/2-160,HEIGHT/2-20),ctx.fillText("Mouse Right: Reverse the balls",WIDTH/2-185,HEIGHT/2+22),ctx.fillText("Click to start.",WIDTH/2-50,HEIGHT/2+62);else if(1==this.step){mousePoints[0].radius=20,ctx.fillStyle="white",ctx.shadowColor=randomColor(),ctx.shadowBlur="50",ctx.font="42px serif";var t=HEIGHT/2+(HEIGHT/2-mousePoints[0].y);ctx.fillText("This ball should be collided with one other..",WIDTH/2-200,t)}else 2==this.step&&(ctx.shadowColor=randomColor(),ctx.shadowBlur="50",ctx.font="42px serif",ctx.fillStyle="white",ctx.fillText("You see, one other ball was collided with the first",WIDTH/2-200,HEIGHT/2),ctx.fillText("Continue to do that, to capture 10 balls !",WIDTH/2-200,HEIGHT/2+40))},function(t){if(this.ready)if(t.button>0)for(var e=0;e<points.length;e++)points[e].speedX*=-1,points[e].speedY*=-1;else mousePoints.push(new Point(t.clientX,t.clientY)),this.ready&&0==this.step&&(this.next=!0)})),levels.push(new Level("3 balls this time !",function(){for(var t=0;15>t;t++)points.push(new Point(random(1,WIDTH),random(1,HEIGHT)));this.ballsPlaced=0},function(){for(var t=0;t<points.length;t++)for(var e=0;e<mousePoints.length;e++)if(points[t].inCollision(mousePoints[e])&&-1==pointsTouched.indexOf(points[t])){points[t].color="white",pointsTouched.push(points[t]),nextHitSong();var o=new Point(points[t].x,points[t].y);o.color="white",flashBall.push(o)}return this.ballsPlaced>3&&0==mousePoints.length?void lost():void(pointsTouched.length>=3&&nextLevel())},function(){},function(t){if(t.button>0)for(var e=0;e<points.length;e++)points[e].speedX*=-1,points[e].speedY*=-1;else this.ballsPlaced<5&&(mousePoints.push(new Point(t.clientX,t.clientY)),this.ballsPlaced++)})),levels.push(new Level("Try 3 red balls !",function(){for(var t=0;10>t;t++){for(var e=randomColor();"#FF4B47"==e;)e=randomColor();points.push(new Point(random(1,WIDTH),random(1,HEIGHT),e))}for(var t=points.length;20>t;t++)points.push(new Point(random(1,WIDTH),random(1,HEIGHT),"#FF4B47"));this.ballsPlaced=0,this.ballsGoal=3,this.pointsMouseToLose=3,this.colorGoal="#FF4B47"},function(){if(alpha<Math.PI)return alpha+=.02,animations.win.logic(),void(alpha+.5>=Math.PI&&(alpha=Math.PI));for(var t=0;t<points.length;t++)for(var e=0;e<mousePoints.length;e++)if(points[t].inCollision(mousePoints[e])&&-1==pointsTouched.indexOf(points[t])&&points[t].color==this.colorGoal){points[t].color="white",pointsTouched.push(points[t]),nextHitSong();var o=new Point(points[t].x,points[t].y);o.color=this.colorGoal,flashBall.push(o)}return this.ballsPlaced>=this.pointsMouseToLose&&0==mousePoints.length?void lost():void(pointsTouched.length>=this.ballsGoal&&nextLevel())},function(){alpha<Math.PI&&(ctx.fillStyle="white",ctx.shadowColor="white",ctx.shadowBlur=animations.win.step,ctx.font="42px serif",ctx.fillText("LOADING",WIDTH/2-55,HEIGHT/2))},function(t){if(!(alpha<Math.PI))if(t.button>0)for(var e=0;e<points.length;e++)points[e].speedX*=-1,points[e].speedY*=-1;else this.ballsPlaced<this.pointsMouseToLose+1&&(mousePoints.push(new Point(t.clientX,t.clientY)),this.ballsPlaced++)})),levels.push(new Level("Try 3 green balls !",function(){for(var t=0;10>t;t++){for(var e=randomColor();"#40E64F"==e;)e=randomColor();points.push(new Point(WIDTH/2,HEIGHT/2,e))}for(var t=points.length;15>t;t++)points.push(new Point(WIDTH/2,HEIGHT/2,"#40E64F"));levels[currentLevel-1].ballsPlaced=0,levels[currentLevel-1].pointsMouseToLose=2,levels[currentLevel-1].colorGoal="#40E64F"},function(){levels[currentLevel-1].logic()},function(){alpha<Math.PI&&(ctx.fillStyle="white",ctx.shadowColor="white",ctx.shadowBlur=animations.win.step,ctx.font="42px serif",ctx.fillText("LOADING",WIDTH/2-55,HEIGHT/2))},function(t){if(!(alpha<Math.PI))if(t.button>0)for(var e=0;e<points.length;e++)points[e].speedX*=-1,points[e].speedY*=-1;else levels[currentLevel-1].ballsPlaced<3&&(mousePoints.push(new Point(t.clientX,t.clientY)),levels[currentLevel-1].ballsPlaced++)})),levels.push(new Level("You have a new spell, place two balls to try. After that capture 5 balls with those line.",function(){for(var t=0;11>t;t++)points.push(new Point(random(1,WIDTH),random(1,HEIGHT),randomColor(),void 0,void 0,random(1,4),random(1,4)));this.ballsPlaced=0,this.ballsGoal=5,this.pointsMouseToLose=4},function(){if(alpha<2*Math.PI)return alpha+=.1,animations.win.logic(),void(parseFloat(alpha)>6.1&&(alpha=2*Math.PI));for(var t=0;t<mousePoints.length;t++)mousePoints[t].radius<14&&(mousePoints[t].radius+=.1);for(var e=0;e<mousePoints.length;e++)if(e%2!=0)for(var o=(mousePoints[e-1].y-mousePoints[e].y)/(mousePoints[e-1].x-mousePoints[e].x),s=-(o*mousePoints[e].x-mousePoints[e].y),t=0;t<points.length;t++)if(points[t].x>(mousePoints[e].x<mousePoints[e-1].x?mousePoints[e].x:mousePoints[e-1].x)&&points[t].x<(mousePoints[e].x>mousePoints[e-1].x?mousePoints[e].x:mousePoints[e-1].x)){var i=points[t].dy/points[t].dx,n=-(i*points[t].x-points[t].y),l=(n-s)/(o-i),a=Math.sqrt((points[t].x-l)*(points[t].x-l)+(points[t].y-(o*l+s))*(points[t].y-(o*l+s)));if(10>a)if("white"!=points[t].color||points[t].touched){if(!points[t].touched&&"white"!=points[t].color){points[t].lastColor=points[t].color,points[t].color="white",points[t].touched=!0,nextHitSong();var r=new Point(l,o*l+s);r.color="white",flashBall.push(r),pointsTouched.push(points[t])}}else points[t].color=points[t].lastColor,points[t].touched=!0;else points[t].touched=!1}return this.ballsPlaced>this.pointsMouseToLose&&0==mousePoints.length?void lost():void(pointsTouched.length>=this.ballsGoal&&nextLevel())},function(){if(alpha<2*Math.PI)ctx.fillStyle="white",ctx.shadowColor="white",ctx.shadowBlur=animations.win.step,ctx.font="42px serif",ctx.fillText("LOADING",WIDTH/2-55,HEIGHT/2);else{ctx.beginPath(),ctx.lineWidth=4,ctx.strokeStyle="white";for(var t=0;t<mousePoints.length;t++)t%2!=0&&(ctx.moveTo(mousePoints[t-1].x,mousePoints[t-1].y),ctx.lineTo(mousePoints[t].x,mousePoints[t].y));ctx.stroke()}},function(t){if(!(alpha<2*Math.PI)){for(var e=0;e<points.length;e++)points[e].speedX*=-1,points[e].speedY*=-1;if(0==t.button){if(!(this.ballsPlaced<6))return lost(),void(hasClicked=!1);mousePoints.push(new Point(t.clientX,t.clientY)),this.ballsPlaced++}}})),levels.push(new Level("Ok you have understand, now get 7 balls.",function(){for(var t=0;2>t;t++)points.push(new Point(WIDTH/2+t,HEIGHT/2,randomColor()));levels[currentLevel-1].ballsPlaced=0,levels[currentLevel-1].ballsGoal=7,levels[currentLevel-1].pointsMouseToLose=2},function(){levels[currentLevel-1].logic()},function(){if(alpha<2*Math.PI)ctx.fillStyle="white",ctx.shadowColor="white",ctx.shadowBlur=animations.win.step,ctx.font="42px serif",ctx.fillText("LOADING",WIDTH/2-55,HEIGHT/2);else{ctx.beginPath(),ctx.lineWidth=4,ctx.strokeStyle="white";for(var t=0;t<mousePoints.length;t++)t%2!=0&&(ctx.moveTo(mousePoints[t-1].x,mousePoints[t-1].y),ctx.lineTo(mousePoints[t].x,mousePoints[t].y));ctx.stroke()}},function(t){if(!(alpha<2*Math.PI)){for(var e=0;e<points.length;e++)points[e].speedX*=-1,points[e].speedY*=-1;if(0==t.button){if(!(this.ballsPlaced<6))return lost(),void(hasClicked=!1);mousePoints.push(new Point(t.clientX,t.clientY)),this.ballsPlaced++}}}));var lostLevel=!1,win=!1,messages=[],animations=[];animations.lost=new Animation(0,16,.15),animations.win=animations.lost,nextLevel();var nextLevelState=!1;requestAnimationFrame(loop);
