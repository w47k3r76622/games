(()=>{"use strict";class t{constructor(){this.zIndex=0}t(t){}update(t){}}class s{constructor(){this.i=0,this.h=0,this.o=0,this.u=0,this.l=0,this.p=0,document.addEventListener("keydown",(t=>{const s=t.key.toLowerCase();"a"===s?this.i=1:"d"===s?this.h=1:"e"===s?this.o=1:"q"===s?this.u=1:"s"===s?this.l=1:" "===s&&(this.p=1)})),document.addEventListener("keyup",(t=>{const s=t.key.toLowerCase();"a"===s?this.i=0:"d"===s?this.h=0:"e"===s?this.o=0:"q"===s?this.u=0:"s"===s?this.l=0:" "===s&&(this.p=0)}))}}class i extends t{constructor(t){super(),this.m=t}}class h extends t{constructor(t){super(),this.parent=t,this.M=0,this.v=[],this.S=null}update(t){this.animate(t)}animate(t){if(null!==this.S){const{loop:s,g:i,F:h}=this.S;this.M>1e3/h?(s&&(this.M=0),this.k<i?this.k++:s&&(this.k=0)):this.k<=i&&(this.M+=t)}}}class e extends t{constructor(t){super(),this.width=64,this.height=64,this.A=32,this.D=32,this.G=new n(this,t.O.B.q,32)}t(t,s,i){this.G.t(t,s,i)}update(t){this.G.update(t)}}class n extends h{constructor(t,s,i,h){super(t),this.C=s,this.A=i,this.D=h||i,this.k=0,this.I=0,this.v=[{X:0,Y:0,g:4,F:2,loop:!0}],this.S=this.v[0]}t(t,s,i){t.drawImage(this.C,this.k*this.A,this.I*this.D,this.A,this.D,s,i,this.parent.width,this.parent.height)}}class o extends t{constructor(t){super(),this.loop=t,this.q=new e(t.m)}t(t,s,i){t.save(),t.fillStyle="#9DB2BF",t.fillRect(s,i,this.loop.j*this.loop.H,this.loop.j*this.loop.J),t.globalCompositeOperation="source-atop",t.fillStyle="#526D82",t.beginPath(),t.arc(s+6.5*this.loop.j,i+6*this.loop.j,10*this.loop.j,0,2*Math.PI),t.fill(),t.fillStyle="#27374D",t.beginPath(),t.arc(s+7*this.loop.j,i+6*this.loop.j,9*this.loop.j,0,2*Math.PI),t.fill(),t.globalCompositeOperation="source-over",t.restore(),this.loop.K.forEach(((h,e)=>{const n=s+this.loop.j*(this.loop.H+2+e),o=i+this.loop.j*(this.loop.J-13);h.t(t,n,o)})),this.q.t(t,s+this.loop.j*(this.loop.H+2),i+this.loop.j*(this.loop.J-12))}update(t){this.q.update(t)}}const r=[[0,0],[0,1],[0,2],[1,0],[1,1],[1,2],[2,0],[2,1],[2,2]],c=[0,1,2];class a extends t{constructor(t,s,i){super(),this.loop=t,this.type=s,this.index=i,this.L=null,this.N=!0,this.A=32,this.D=32}t(t,s,i){this.N&&t.drawImage(this.P,this.type*this.A,0,this.A,this.D,s,i,this.loop.j,this.loop.j)}R(t){this.L=t}}class u extends a{constructor(t,s,i){super(t,s,i),this.P=this.loop.m.O.B.T}}class d extends a{constructor(t,s,i){super(t,s,i),this.P=this.loop.m.O.B.U}}function l(t){const s=r[Math.floor(Math.random()*r.length)],i=new u(t,s[0],t.V),h=new u(t,s[1],t.W);return i.R(h),h.R(i),[i,h]}function p(t,s){let i=[!1,!1];return t.forEach(((t,h)=>{i[h]=function(t,s){const i=Math.floor(t/s.H)===s.J;if(i)return!1;return!w(t,s.Z())}(t.index+s.H,s)})),i[0]&&i[1]&&t.forEach((t=>{t.index+=s.H})),i}function w(t,s){return s.some((s=>s.index===t))}class f extends i{constructor(t,s=1){super(t),this.H=8,this.J=16,this.V=3+this.H,this.W=4+this.H,this.level=s,this.j=32,this.$=new o(this),this.speed=1,this._=0,this.tt=!1,this.st=!1,this.it=l(this),this.K=l(this),this.T=[],this.U=function(t,s){const i=[],h=[];for(let t=3*s.H;t<s.H*s.J;t++)h.push(t);for(let e=0;e<t;e++){const t=h[Math.floor(Math.random()*h.length)],e=Math.floor(Math.random()*c.length);i.push(new d(s,e,t)),h.splice(h.indexOf(t),1)}return i}(3*this.level,this)}t(t){const s=this.m.width/2-this.j*this.H/2,i=this.m.height/2-this.j*this.J/2;this.$.t(t,s,i),this.U.forEach((h=>{const e=h.index%this.H*this.j+s,n=Math.floor(h.index/this.H)*this.j+i;h.t(t,e,n)})),this.T.forEach((h=>{if(h.N){const e=h.index%this.H*this.j+s,n=Math.floor(h.index/this.H)*this.j+i;h.t(t,e,n)}})),this.it.forEach((h=>{const e=h.index%this.H*this.j+s,n=Math.floor(h.index/this.H)*this.j+i;h.t(t,e,n)}))}update(t){this.tt||(this.st?this._+=12*t:this.ht(this.m.input),this._>1e3/this.speed?(this.et(),this._=0):this._+=t),this.$.update(t)}ht(t){1===t.i?(this.nt(-1),t.i++):1===t.h?(this.nt(1),t.h++):1===t.o?(this.ot(1),t.o++):1===t.u?(this.ot(-1),t.u++):1===t.l?(this.et(),t.l++):1===t.p&&(this.st=!0,t.p++)}et(){const t=p(this.it,this);t[0]&&t[1]||(this.rt()?this.tt=!0:this.ct())}nt(t){const s=Math.max(...this.it.map((t=>t.index))),i=Math.min(...this.it.map((t=>t.index)));if(this.Z().some((h=>h.index===s+t||h.index===i+t)))return;const h=i%this.H!=0,e=s%this.H!=this.H-1;(t<0&&h||t>0&&e)&&this.it.forEach((s=>{s.index+=t}))}ot(t){if(null===this.it)return;const s=this.it[0],i=s.index,h=this.it[1].index,e=t=>t>=0&&t<this.H*this.J&&!w(t,this.Z()),n=t=>{e(t)&&(s.index=t)};t>0?i===h-1&&h-this.H>0?n(h-this.H):i===h-this.H&&h%this.H!=this.H-1?n(h+1):i===h+1&&Math.floor((h+this.H)/this.H)<=this.J-1?n(h+this.H):i===h+this.H&&i%this.H!=0&&n(h-1):t<0&&(i===h-1&&Math.floor((h+this.H)/this.H)<=this.J-1?n(h+this.H):i===h-this.H&&i%this.H!=0?n(h-1):i===h+1&&h-this.H>0?n(h-this.H):i===h+this.H&&h%this.H!=this.H-1&&n(h+1))}ct(){const t=[];this.it.forEach((s=>{const i=function(t,s){const i=[t],h=s.Z();for(let e=t.index-1;e%s.H!=0;e--)i.push(...h.filter((s=>t.type===s.type&&s.index===e)));for(let e=t.index+1;e%s.H!=s.H-1;e++)i.push(...h.filter((s=>t.type===s.type&&s.index===e)));return i}(s,this);i.length>=4&&t.push(...i)})),this.st=!1,this.T.push(...this.it),this.it=this.K,this.K=l(this)}Z(){return[...this.U,...this.T]}rt(){return this.it.some((t=>t.index===this.V&&t.L.index===this.W))}}class m extends t{constructor(t,i,h){super(),this.O=h,this.width=t,this.height=i,this.input=new s,this.ut={loop:new f(this)},this.dt="loop",this.lt=[this.wt()],this.ft=[this.wt()]}t(t){t.clearRect(0,0,this.width,this.height),t.save(),this.lt.forEach((s=>{s.t(t)})),t.restore()}update(t){this.ft.forEach((s=>{s.update(t)}))}wt(){return this.ut[this.dt]}}window.addEventListener("load",(()=>{const t=document.querySelector("#game--last-viking"),s=t.getContext("2d");t.width=960,t.height=544,s.imageSmoothingEnabled=!1;const i={B:{q:document.querySelector("#sprite--viking"),T:document.querySelector("#sprite--player-stones"),U:document.querySelector("#sprite--foe-stones")}},h=new m(t.width,t.height,i);let e=0;!function t(i){const n=i-e;e=i,h.update(n),h.t(s),requestAnimationFrame(t)}(0)}))})();