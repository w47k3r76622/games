<!DOCTYPE html><html style="background:black;"><head><title>Bubba's Back Room</title></head><body><canvas id="sceneCanvas"></canvas><canvas id="hudCanvas"></canvas><script>!function(){function e(e,t,o,n){let i=e.getContext("2d");return e.width=t*n,e.height=o*n,e.style.width=t+"px",e.style.height=o+"px",e.style.position="fixed",e.style.top=0,e.style.left=0,1!==n&&i.scale(n,n),i}let t={position:[-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1],normal:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0],texture:[0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1],index:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]},o=!0;function n(){De&&Ue&&(T=!0,Oe++)}function i(){T=!0,c=K,Pt(yt)}function a(){var e,t;Se=(new Date).getTime(),0!==Te&&(Ee=Se-Te),2===Oe?($e(),S||S||(e=C,(t=P.createBufferSource()).buffer=e,t.loop=!0,t.connect(P.destination),t.start(),S=!0),Oe++):4===Oe?($e(),Oe++):6===Oe?(i(),Pt(pt),Oe++):7===Oe&&Fe.x>-55?(ut(0),Oe++):8===Oe&&Fe.x>-55?(at(0),Oe++):9===Oe&&Fe.x>=57&&Fe.x<=60&&Fe.z>=-2&&Fe.z<=2?($e(),Oe++):11===Oe?(i(),Oe++):Oe>=9&&Oe<=12&&E>=4?(io(60,60,0,7,-2,2),Pt(kt),Oe=13):13===Oe&&Fe.x>=61?(ut(1),Oe++):14===Oe&&Fe.z<-22?($e(),Oe++):16===Oe?(i(),Oe++):Oe>=14&&Oe<=17&&E>=10?(io(78,82,7,14,-25,-25),Pt(kt),Oe=18):18===Oe&&Fe.z<-25&&Fe.x>61?(ut(2),Oe++):19===Oe&&Fe.z<-25?(at(1),Oe++):20===Oe&&Fe.z<-182&&Fe.x>70?($e(),Oe++):22===Oe?(i(),Oe++):Oe>=20&&Oe<=23&&E>=22?(io(78,82,7,17,-185,-185),Pt(kt),Oe=24):24===Oe&&Fe.y<-40&&(ut(3),Oe++),Ze>0&&(Ze-=Ee)<=0&&(Ze=0,T=!0),c===K&&(Fe.health<=0&&(T=!0,document.exitPointerLock(),c=ee,Ze=500),function(){if(0!==Fe.straightMovement){let e=(1===Fe.straightMovement?-1:1)*H*Ee/1e3;so(Fe,e*Math.sin(Fe.yaw),0,e*Math.cos(Fe.yaw))}if(0!==Fe.sideMovement){let e=(1===Fe.sideMovement?1:-1)*H*Ee/1e3;so(Fe,e*Math.sin(Fe.yaw+Math.PI/2),0,e*Math.cos(Fe.yaw+Math.PI/2))}Fe.isAirborne||!Fe.straightMovement&&!Fe.sideMovement||(Le+=Ee,Be=se*Math.sin(Le/1e3*le),(Xe-=Ee)<0&&(Xe=Z,Pt(xt))),Fe.upVelocity+=ce*Ee/1e3;let e=Fe.upVelocity*Ee/1e3;so(Fe,0,e,0),0!==_&&(_-=Ee)<0&&(_=0),Ve&&(Ye-=Ee)<0&&(Ye=be,p<6&&(p++,Pt(bt,.5)),6===p&&(Ve=!1)),25===Oe&&Fe.y<-99&&0===He&&(He=J,Fe.health-=1,T=!0,Pt(Et,.5)),He>0&&(He-=Ee/1e3)<0&&(He=0)}(),Ge.forEach(function(e){let t=(e.isBoss?3:4.5)*Ee/1e3,o=e.isBoss?2*L:L,n=e.x-Fe.x,i=e.isBoss?0:e.y-Fe.y,a=e.z-Fe.z,r=Math.atan2(a,n),s=e.yaw-r,l=e.yaw-s;l+=.5*Math.sin(Se*e.turnFrequency);let c=Math.sqrt(n*n+i*i+a*a);if(!e.isAirborne&&Math.random()<.05&&(e.upVelocity=20,e.isAirborne=!0,e.isBoss?Pt(Ft):Pt(St,.5*o/c)),c>o){let o=-1*t*Math.cos(l);e.upVelocity+=ce*Ee/1e3;let n=e.upVelocity*Ee/1e3,i=-1*t*Math.sin(l);e.isBoss?(so(e,0,n,0),e.x+=o,e.z+=i):so(e,o,n,i)}else 0===e.attackCooldown&&((function(e){for(let t=0;t<Ge.length;t++){let o=Ge[t];if(o.id===e)return o}return-1}(e.id)).attackCooldown=B,He=J,Fe.health-=1,T=!0,Pt(Et,.5));e.yaw=l,e.attackCooldown>0&&(e.attackCooldown-=Ee/1e3,e.attackCooldown<0&&(e.attackCooldown=0))}),Ge.forEach(function(e,t){e.painFlash>0&&(e.painFlash-=Ee,e.painFlash<=0&&(e.painFlash=0,e.health<=0&&(Pt(gt),Ge.splice(t,1),E++,e.isBoss&&(T=!0,setTimeout(function(){T=!0,document.exitPointerLock(),c=te,Ze=500},1e3)))))}),A.forEach(function(e,t){e.y=e.startY+.5*Math.sin(.001*Se),e.yaw=.001*Se;let o=e.x-Fe.x,n=e.y-Fe.y,i=e.z-Fe.z;Math.sqrt(o*o+n*n+i*i)<3&&(Fe.health=6,A.splice(t,1),Pt(At))})),function(){if(c===K){if(We){let e=ie*Ee/1e3;l.y-=e,l.y<ge&&(l.y=ge,We=!1)}Fe.isAirborne||!Fe.straightMovement&&!Fe.sideMovement?(qe=0,Ie=0):(ze+=Ee,qe=me*Math.cos(ze/1e3*pe),Ie=Math.abs(me*Math.sin(ze/1e3*pe))),T=!0}}(),function(){if(c===K||!Je&&je){let e=45,t=.1,o=150;uo.perspective(e,f.width/f.height,t,o,d),uo.identity(h),Ot(f,u),Ot(w,M),uo.rotate(h,-Fe.pitch,[1,0,0]),uo.rotate(h,-Fe.yaw,[0,1,0]),uo.translate(h,[-2*Fe.x,-2*(Fe.y+j),-2*Fe.z]),uo.translate(h,[0,Be,0]),function(){for(let e in Me)Me[e].forEach(function(t){dt(t,Pe[e].glTexture)});for(let e in Re)Re[e].forEach(function(e){Ke(e)})}(),Ge.forEach(function(e){let t=e.painFlash>0?Y:N;rt(),uo.translate(h,[2*e.x,2*e.y,2*e.z]),uo.rotate(h,-e.yaw,[0,1,0]),dt(e.buffers,Pe[t].glTexture),Ke(e.hitBuffers),st()}),A.forEach(function(e){rt(),uo.translate(h,[2*e.x,2*e.y,2*e.z]),uo.rotate(h,-e.yaw,[0,1,0]),dt(e.buffers,Pe[e.texture].glTexture),st()});let n=R+50*He*Math.sin(.1*Se);f.style.marginLeft=n+"px",r.style.marginLeft=n+"px",Je=!0}T&&je&&(s.clearRect(0,0,Ae,ke),s.save(),s.scale(g,g),_>0&&(s.save(),s.translate(l.x-100,l.y-300),Ct(s,300,0,200,200),s.restore()),s.save(),s.translate(l.x-70+qe,l.y-200+Ie+me),Ct(s,31,0,140,200),s.restore(),!Ve&&p<=0||p>0&&(s.fillStyle="rgba(255, 255, 255, 0.3)",s.fillRect(xe/2-14-1,ge/2-1,14,2),s.fillRect(xe/2+1,ge/2-1,14,2),s.fillRect(xe/2-1,ge/2-14-1,2,14),s.fillRect(xe/2-1,ge/2+1,2,14)),function(){let e=xe-50;for(let t=0;t<p;t++)s.save(),s.translate(e,ge-90),Ct(s,245,0,30,80),s.restore(),e-=40}(),function(){let e=0;for(let t=0;t<Fe.health;t++)s.save(),s.translate(e,0),Ct(s,160,0,80,120),s.restore(),e+=70}(),He>0&&(s.save(),s.scale(10,10),s.fillStyle=s.createPattern(Pe[Y].image,"repeat"),s.globalAlpha=.2*He/J,s.fillRect(0,0,xe,ge),s.restore()),function(){let e=ge-180;c===Q?(tt(),0===Oe?(Bt("bubbas back room",75,160,0),Bt("created by @ericdrowell",30,280,0),Bt("loading...",30,e,0)):1===Oe?(Bt("bubbas back room",75,160,0),Bt("created by @ericdrowell",30,280,0),Bt("click to continue",30,e,0)):3===Oe?(Bt("ring. ring. ring.",30,170,0),Bt("welcome to bubbas gas station.",30,260,0),Bt("im bubba your new boss.",30,300,0),Bt("my son bubba junior cant wait to eat you.",30,340,0),Bt("i mean...meet you...",30,380,0),Bt("hes in the back room.",30,420,0),Bt("click to continue",30,e,0)):5===Oe?(Bt("controls",75,150,0),Qe(),Bt("click to continue",30,e,0)):10!==Oe&&15!==Oe&&21!==Oe||(Bt("wait a minute.i should kill the zombies",30,260,0),Bt("in case they escape into the gas station.",30,300,0),Bt("i dont want my boss to fire me.",30,340,0),Bt("click to continue",30,e,0))):c===$?(tt(),Bt("paused",75,150,0),Qe(),Bt("click to resume",30,e,0)):c===ee?(tt(),Bt("you died",75,150,0),Bt("click to try again",30,e,0)):c===te&&(tt(),Bt("you did it",75,150,0),Bt("i defeated bubba junior.",30,300,0),Bt("evil will no longer lurk here",30,340,0),Bt("so yeah.screw this job.i quit.",30,380,0),Bt("click to play again",30,e,0))}(),s.restore(),T=!1)}(),Te=Se,window.requestAnimationFrame(a)}setTimeout(function(){!function(){(function(){let e=window.innerWidth,t=window.innerHeight;(x=e/t)>_e?(ke=t,Ae=t*_e):(Ae=e,ke=e/_e),g=Ae/xe})(),document.querySelector("html").style.height="100%";let o=document.querySelector("body");var E;o.style.overflow="hidden",o.style.padding=0,o.style.margin=0,o.style.backgroundColor="black",o.style.height="100%",r=document.getElementById("hudCanvas"),s=e(r,Ae,ke,ae),x>_e?(r.style.left="50%",r.style.marginLeft="-"+Ae/2+"px",R=Ae/2*-1):(r.style.top="50%",r.style.marginTop="-"+ke/2+"px",R=0),b=document.createElement("canvas"),(y=e(b,xe,ge,ae)).webkitImageSmoothingEnabled=!1,y.imageSmoothingEnabled=!1,(k=document.createElement("canvas")).width=16,k.height=16,F=k.getContext("2d"),h=uo.create(),d=uo.create(),f=document.getElementById("sceneCanvas"),u=f.getContext("webgl"),Nt(f),Yt(v=u.createProgram(),u,mo,xo),Ht(v,u,"ve"),Ht(v,u,"no"),Ht(v,u,"tc"),Xt(v,u,"pm"),Xt(v,u,"mv"),Xt(v,u,"sa"),Xt(v,u,"nm"),Xt(v,u,"fl"),u.enable(u.DEPTH_TEST),w=document.createElement("canvas"),M=w.getContext("webgl",{preserveDrawingBuffer:!0,antialias:!1}),Nt(w),Yt(m=M.createProgram(),M,po,_o),Ht(m,M,"ve"),Ht(m,M,"aVertexColor"),Xt(m,M,"pm"),Xt(m,M,"mv"),M.enable(M.DEPTH_TEST),l={x:xe/2,y:ge},T=!0,document.addEventListener("keydown",function(e){!function(e){switch(e.which||e.keyCode){case 65:c===K&&(Fe.sideMovement=-1);break;case 87:c===K&&(Fe.straightMovement=1);break;case 68:c===K&&(Fe.sideMovement=1);break;case 83:c===K&&(Fe.straightMovement=-1);break;case 32:Fe.isAirborne||(Fe.upVelocity=fe,Fe.isAirborne=!0,Pt(wt));break;case 82:T=!0,!Ve&&p<6&&(Pt(_t),Ve=!0,Ye=be)}}(e)},!1),document.addEventListener("keyup",function(e){!function(e){if(c===K)switch(e.which||e.keyCode){case 65:Fe.sideMovement=0;break;case 87:Fe.straightMovement=0;break;case 68:Fe.sideMovement=0;break;case 83:Fe.straightMovement=0}}(e)},!1),document.addEventListener("mousemove",function(e){!function(e){c===K&&Dt()&&(Fe.pitch+=e.movementY*Math.PI*.001*-1,Fe.pitch>Math.PI/2&&(Fe.pitch=Math.PI/2),Fe.pitch<-1*Math.PI/2&&(Fe.pitch=-1*Math.PI/2),Fe.yaw+=e.movementX*Math.PI*.001*-1)}(e)},!1),r.addEventListener("mousedown",function(e){0===Ze&&(c===K?function(){if(p>0){Ve=!1,qe=0,Ie=0,_=ue,p-=1;let t=function(e,t){if(e=Math.round(e),t=Math.round(t),e<0||t<0||e>Ae||t>ke)return-1;let o=new Uint8Array(4);return M.readPixels(e,ke-t-1,1,1,M.RGBA,M.UNSIGNED_BYTE,o),o}(Ae/2,ke/2);if(Pt(Mt),255===t[0]){let o=t[1];e=o,Ge.forEach(function(t){if(t.id===e){t.painFlash=oe,t.health-=1;let e=t.x-Fe.x,o=t.z-Fe.z,n=Math.sqrt(e*e+o*o);t.isBoss||so(t,5*e/n,0,5*o/n),Pt(Et,.3)}})}l.y=ge+ne,We=!0}else Pt(Rt);var e}():c!==Q||1!==Oe&&3!==Oe&&5!==Oe&&10!==Oe&&15!==Oe&&21!==Oe?c===$?(r.requestPointerLock(),T=!0,i()):c!==ee&&c!==te||(T=!0,ht(),ct(),nt(),c=Q,Oe=1):(r.requestPointerLock(),Oe++))},!1),document.addEventListener("pointerlockchange",function(e){Dt()||c!==K||(T=!0,T=!0,c=$,Pt(yt))},!1),function(){to(-290,-241,26,36,-10,50),jt(-241,31,-3),Jt(-289,-285,27,28,-8,12),Jt(-289,-285,29,32,-8,12),Jt(-274,-270,27,28,-8,12),Jt(-274,-270,29,32,-8,12),Jt(-289,-285,27,28,19,45),Jt(-289,-285,29,32,19,45),Jt(-274,-270,27,28,19,45),Jt(-274,-270,29,32,19,45),Jt(-262,-242,27,28,3,7),Jt(-262,-242,29,32,3,7),Jt(-262,-242,27,28,18,22),Jt(-262,-242,29,32,18,22),oo(-253,-248,27,34,50,50,U),oo(-252,-249,27,33,50,50,W),no(-252,27+Math.round(3),50,X),eo(-241,-141,26,16,-3,5),eo(-140,-101,16,11,5,-5),eo(-100,-82,11,19,-5,5),eo(-81,-61,19,9,5,0),eo(-60,-51,9,9,0,0),oo(-50,-31,10,10,-2,2,z),oo(-61,-51,10,10,-2,2,G),oo(-50,-16,11,18,3,3,D),oo(-50,-16,11,18,-3,-3,D),oo(-50,-50,11,18,-4,-4,D),oo(-50,-50,11,18,4,4,D),oo(-50,-15,18,18,-2,2,U),to(-20,60,-1,10,-30,30),function(e,t,o,n,i,a){for(let e=0;e<60;e+=20)for(let t=-10;t<30;t+=20)Zt(e,0,t,9)}(),io(-20,-20,0,10,-2,2),io(-20,-15,10,10,-2,2),Qt(-30,-20,10,-2,2),Qt(-22,-14,18,-2,2),oo(-30,-20,0,10,-3,-3,D),oo(-30,-20,0,10,3,3,D),Jt(20,30,0,2,-29,-26),to(69,100,-10,17,-20,20),oo(60,60,0,8,-3,3,U),oo(60,60,0,7,-2,2,q),Qt(60,68,-1,-2,2),oo(61,68,-9,7,-3,-3,D),oo(61,68,-9,7,3,3,D),oo(61,69,7,7,-3,3,U),io(69,69,-9,6,-2,2),Zt(92,-9,-15,3),Zt(95,-9,-3,6),Zt(90,-9,9,9),Zt(80,-9,5,12),Zt(77,-9,-5,14),Zt(80,-9,-19,15),to(77,83,6,15,-220,-20),oo(77,83,7,15,-20,-20,U),io(78,82,7,14,-20,-20),oo(78,82,7,17,-25,-25,q),oo(78,82,7,17,-185,-185,q),Jt(78,82,7,9,-219,-217),jt(77,10,-200),eo(72,77,5,5,-200,-200),eo(20,72,0,5,-220,-200),eo(-20,20,-5,0,-230,-220),eo(-40,-20,-10,-5,-230,-230),eo(-80,-40,-14,-10,-226,-230),to(-110,-85,-15,0,-240,-210),eo(-85,-80,-15,-14,-226,-226),jt(-85,-10,-226),oo(-103,-96,-14,-14,-229,-222,I),Zt(-108,-14,-238,13),Zt(-108,-14,-212,13),Zt(-87,-14,-238,13),Zt(-87,-14,-212,13),io(-102,-97,-15,-14,-228,-223),oo(-200,0,-100,-100,-326,-126,Y);for(let e=-2;e<=2;e++)for(let t=-2;t<=2;t++){let o=5*Math.random()-2.5,n=5*Math.random()-2.5,i=5*Math.random()-2.5;0===e&&0===t&&(o=0,n=0),Zt(Math.round(12*e-100+o),-101,Math.round(12*t-225+n),Math.round(9+i))}}(),function(){let e={};for(let o in we)for(let n in we[o])for(let i in we[o][n]){let a=we[o][n][i].texture;if(a===q)continue;void 0===e[a]&&(e[a]=[{position:[],color:[],normal:[],texture:[],index:[],numBlocks:0}]);let r=e[a][e[a].length-1],s=a===G?0:.1*(Math.random()-.5);for(let e=0;e<t.position.length;e+=3)r.position.push(t.position[e]+2*parseInt(o)+s),r.position.push(t.position[e+1]+2*parseInt(n)+s),r.position.push(t.position[e+2]+2*parseInt(i)+s);for(let e=0;e<t.position.length;e+=3)r.color.push(0),r.color.push(0),r.color.push(1);Ut(r.normal,t.normal),Ut(r.texture,t.texture);for(let e=0;e<t.index.length;e++)r.index.push(t.index[e]+24*r.numBlocks);r.numBlocks>=re?e[a].push({position:[],color:[],normal:[],texture:[],index:[],numBlocks:0}):r.numBlocks++}for(let t in e)Me[t]=[],Re[t]=[],e[t].forEach(function(e){Me[t].push({position:Vt(u,e.position),normal:Vt(u,e.normal),texture:Vt(u,e.texture),index:Wt(u,e.index)}),Re[t].push({position:Vt(M,e.position),color:Vt(M,e.color),index:Wt(M,e.index)})})}(),ht(),ct(),nt(),c=Q,Oe=0,function(e){var t;Pe=[{encoding:Lt(["3d3527","4a493b","534e3e","524534","46433b","443e2b","271c10"])},{encoding:qt(["464339","282e26","303e1a","444b31","393c2c","33352f","333435","2c2e23","3d3f36","3d3a30","514938","6a6554","2c2e20"])},{encoding:It(["6a6554","464339","282e26","303e1a","444b31","393c2c","33352f","333435","2c2e23","3d3f36","3d3a30","514938","2c2e20"])},{encoding:Lt(["434343","2f2f2f","232323","131313","272727","1b1b1b","0b0b0b"])},{encoding:Lt(["f6a675","170503","a41800","ac300e","dbbaa7","7d1e18","621a0e"])},{encoding:qt(["6c6a69","6a5a4b","665f5f","3b3534","645444","292322"])},{encoding:qt(["4f4131","2c2822","353636","4a443a","2d2d2c","4a3c26","31271f","120c09"])},{encoding:Lt(["c3c3c3","bbbbbb","bfbfbf","c0c0c0","b1b1b1"])},{encoding:Lt(["6c6a69","6a5a4b","665f5f","3b3534","645444","292322"])},{encoding:(t=["6c6a69","6a5a4b","665f5f","3b3534","645444","292322"],Lt(t),F.fillStyle="#"+t[t.length-1],F.fillRect(5,4,6,8),F.fillRect(4,5,8,6),k.toDataURL())},{encoding:zt(["c0c0c0","c41c21","941618","a81a1a","7f1414"])}];let o=0,i=0;Pe.forEach(function(e){!function(){i++;let t=e.glTexture=u.createTexture(),a=e.image=new Image;a.onload=function(){!function(e,t){u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,!0),u.bindTexture(u.TEXTURE_2D,e),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,t),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.NEAREST),u.generateMipmap(u.TEXTURE_2D)}(t,a),++o>=i&&(je=!0,function(e){(function(){let e=y.createPattern(Pe[V].image,"repeat"),t=y.createLinearGradient(-10,0,10,0);t.addColorStop(0,"#9d170e"),t.addColorStop(.4,"#c81818"),t.addColorStop(1,"#190b02"),y.save(),y.translate(200,70),y.save(),y.beginPath(),y.translate(0,42),y.scale(1,.5),y.arc(0,0,14,0,2*Math.PI,!1),y.fillStyle=t,y.fill(),y.restore(),y.save(),y.translate(0,32),y.beginPath(),y.rect(-14,-10,28,20),y.fillStyle=t,y.fill(),y.restore(),y.save(),y.beginPath(),y.translate(0,22),y.scale(1,.5),y.arc(0,0,20,0,2*Math.PI,!1),y.fillStyle=t,y.fill(),y.restore(),y.save(),y.scale(2,2),y.fillStyle=t,y.fill(),y.restore(),y.beginPath(),y.moveTo(-25,-20),y.lineTo(25,-20),y.lineTo(20,20),y.lineTo(-20,20),y.save(),y.scale(2,2),y.fillStyle=t,y.fill(),y.restore(),y.save(),y.beginPath(),y.translate(0,-20),y.scale(1,.5),y.arc(0,0,25,0,2*Math.PI,!1),function(e,t,o){e.save(),e.scale(2,2),e.fillStyle=o,e.fill(),e.restore()}(y,0,e),y.restore(),y.save(),y.strokeStyle="#999",y.lineWidth=2,y.translate(0,-20),y.beginPath(),y.moveTo(-6,-3),y.lineTo(6,3),y.stroke(),y.beginPath(),y.moveTo(-6,3),y.lineTo(6,-3),y.stroke(),y.restore(),y.save(),y.beginPath(),y.translate(-5,-38),y.rotate(-.3),y.fillStyle="#9d170e",y.fillRect(-2,-20,4,40),y.restore(),y.restore()})(),function(){let e;y.save(),y.beginPath(),y.translate(100,250),y.moveTo(-80,0),y.lineTo(-30,-230),y.quadraticCurveTo(-15,-240,0,-230),y.lineTo(0,0),(e=y.createLinearGradient(-70,-115,5,-107)).addColorStop(0,"#535c57"),e.addColorStop(.3,"#555d5f"),e.addColorStop(.5,"#8a918a"),e.addColorStop(.7,"#3b3d38"),e.addColorStop(1,"#090909"),y.fillStyle=e,y.fill(),y.restore(),y.save(),y.beginPath(),y.translate(100,250),y.moveTo(0,0),y.lineTo(0,-230),y.quadraticCurveTo(15,-240,30,-230),y.lineTo(80,0),(e=y.createLinearGradient(-10,-105,60,-110)).addColorStop(0,"#535c57"),e.addColorStop(.3,"#555d5f"),e.addColorStop(.5,"#8a918a"),e.addColorStop(.7,"#3b3d38"),e.addColorStop(1,"#090909"),y.fillStyle=e,y.fill(),y.restore()}(),function(){let e;y.save(),y.translate(250,80),y.save(),y.beginPath(),y.moveTo(0,0),(e=y.createLinearGradient(0,0,20,0)).addColorStop(0,"#9d170e"),e.addColorStop(.2,"#c81818"),e.addColorStop(.4,"#591816"),e.addColorStop(.6,"#3f0805"),e.addColorStop(1,"#190b02"),y.fillStyle=e,y.fillRect(0,-66,20,51),y.save(),y.beginPath(),y.scale(1,.5),y.arc(10,-130,10,0,Math.PI,!0),y.fill(),y.restore(),(e=y.createLinearGradient(0,0,20,0)).addColorStop(0,"#936623"),e.addColorStop(.2,"#b3784c"),e.addColorStop(.4,"#3f2317"),e.addColorStop(.6,"#312111"),e.addColorStop(1,"#201408"),y.fillStyle=e,y.fillRect(0,-25,20,10),y.fillRect(-2,-15,24,10),y.save(),y.beginPath(),y.scale(1,.5),y.arc(10,-30,12,0,2*Math.PI,!1),y.fill(),y.restore(),y.save(),y.beginPath(),y.scale(1,.5),y.arc(10,-10,12,0,2*Math.PI,!1),y.fillStyle="#140c08",y.fill(),y.restore(),y.restore(),y.restore()}(),function(){y.beginPath(),y.save(),y.translate(400,100),y.moveTo(0,0);let e=2*Math.PI/12;for(let t=0;t<12;t++)y.rotate(e),y.quadraticCurveTo(-20,50,0,100),y.quadraticCurveTo(20,50,0,0);y.lineJoin="round";let t=y.createRadialGradient(0,0,0,0,0,100);t.addColorStop(0,"rgba(255, 255, 255, 1)"),t.addColorStop(.9,"rgba(253, 254, 206, 1)"),t.addColorStop(1,"rgba(166, 82, 40, 1)"),y.fillStyle=t,y.fill(),y.restore()}();let t=new Image;t.onload=function(){y.save(),y.translate(0,270),y.scale(15,15),y.drawImage(t,0,0),y.restore(),T=!0,De=!0,n()},t.src="alphabet-tiny.gif"}())},a.src=e.encoding}()})}(),E=function(){Ue=!0,n()},P=new(window.webkitAudioContext||window.AudioContext),lo(P,vt,function(e){C=e,E()}),a()}()},50);let r,s,l,c,f,u,h,d,v,m,p,_,x,g,b,y,w,M,R,E,T,S,A,k,F,P,C,B=1,L=4,q=-1,I=5,z=1,D=2,U=6,G=0,N=3,Y=4,V=7,W=8,O=10,X=9,H=20,j=4,Z=300,J=1,K=0,Q=1,$=2,ee=3,te=4,oe=200,ne=200,ie=400,ae=window&&window.devicePixelRatio||1,re=2666,se=1,le=10,ce=-100,fe=30,ue=100,he=15,de=75,ve=45,me=30,pe=10,_e=16/9,xe=1300,ge=xe/_e,be=350,ye=.3,we=[],Me={},Re={},Ee=0,Te=0,Se=0,Ae=0,ke=0,Fe={},Pe={},Ce=[],Be=0,Le=0,qe=0,Ie=0,ze=0,De=!1,Ue=!1,Ge=[],Ne=0,Ye=0,Ve=!1,We=!1,Oe=0,Xe=0,He=0,je=!1,Ze=0,Je=!1;function Ke(e){M.bindBuffer(M.ARRAY_BUFFER,e.position),M.vertexAttribPointer(m.ve,3,M.FLOAT,!1,0,0),M.bindBuffer(M.ARRAY_BUFFER,e.color),M.vertexAttribPointer(m.aVertexColor,3,M.FLOAT,!1,0,0),M.bindBuffer(M.ELEMENT_ARRAY_BUFFER,e.index),M.uniform1i(m.samplerUniform,0),M.uniformMatrix4fv(m.pm,!1,d),M.uniformMatrix4fv(m.mv,!1,h),M.drawElements(M.TRIANGLES,e.index.numElements,M.UNSIGNED_SHORT,0)}function Qe(){Bt("wasd",30,260,-1),Bt("mouse move",30,300,-1),Bt("mouse click",30,340,-1),Bt("r",30,380,-1),Bt("space",30,420,-1),Bt("esc",30,460,-1),Bt("..move",30,260,1),Bt("..look",30,300,1),Bt("..shoot",30,340,1),Bt("..reload",30,380,1),Bt("..jump",30,420,1),Bt("..pause",30,460,1)}function $e(){Fe.straightMovement=0,Fe.sideMovement=0,document.exitPointerLock(),T=!0,c=Q,Pt(yt)}function et(e,t){s.save(),s.strokeStyle="#958e77",s.lineWidth=5,s.strokeRect(e,t,20,20),s.restore()}function tt(){let e=100,t=100,o=xe-200,n=ge-200;s.beginPath(),s.moveTo(e,t),s.lineTo(e+o,t),s.lineTo(e+o,t+n),s.lineTo(e,t+n),s.save(),s.scale(10,10),s.fillStyle=s.createPattern(Pe[N].image,"repeat"),s.globalAlpha=.9,s.fill(),s.restore(),s.lineWidth=5,s.strokeStyle="#958e77",s.strokeRect(e,t,o,n),et(80,80),et(e+o,80),et(e+o,t+n),et(80,t+n)}let ot=[0,0,0,.5,.8,.5,0,.8,0,.8,1,.8,0,1.6,0,.1,1,.1];function nt(){A=[]}function it(e,t,o){A.push({x:e,y:t,z:o,startY:t,yaw:0,texture:O,id:Gt()})}function at(e){0===e?it(25,3.5,-27):1===e&&it(80,10.5,-219),A.forEach(function(e){let o=[],n=[],i=[],a=[],r=0;for(let s=0;s<ot.length;s+=6){let l=ot[s],c=ot[s+1],f=ot[s+2],h=ot[s+3],d=ot[s+4],v=ot[s+5];for(let e=0;e<t.position.length;e+=3)o.push(t.position[e]*h+2*l),o.push(t.position[e+1]*d+2*c),o.push(t.position[e+2]*v+2*f);Ut(n,t.normal),Ut(i,t.texture);for(let e=0;e<t.index.length;e++)a.push(t.index[e]+24*r);e.buffers={position:Vt(u,o),normal:Vt(u,n),texture:Vt(u,i),index:Wt(u,a)},r++}})}function rt(){var e=uo.create();uo.set(h,e),Ce.push(e)}function st(){h=Ce.pop()}let lt=[0,1.3,.3,.5,2,.5,0,1.3,-.3,.5,2,.5,-.2,.1,.3,.8,.3,.5,-.2,.1,-.3,.8,.3,.5,0,2.7,0,.7,1.4,1,0,3.3,0,.4,.4,.4,0,3.9,0,.8,.6,.8,0,3.9,0,.6,.8,.6,-.8,3,.65,1.8,.35,.35,-.8,3,-.65,1.8,.35,.35,-1.8,3,.8,.3,.35,.1,-1.8,3,-.8,.3,.35,.1,-1.8,3.1,.6,.3,.1,.1,-1.8,3.1,-.6,.3,.1,.1];function ct(){Ge=[],E=0}function ft(e,t,o,n){Ge.push({x:e,y:t,z:o,startY:t,painFlash:0,health:n?60:4,yaw:0,attackCooldown:0,turnFrequency:.001+.001*Math.random(),bobbleOffset:2*Math.random()*Math.PI,bobble:0,upVelocity:0,isAirborne:!1,stepPending:!1,isBoss:!!n,id:Gt()})}function ut(e){if(o){if(0==e)ft(-10,0,-28,!1),ft(-10,0,28,!1),ft(58,0,-28,!1),ft(58,0,28,!1);else if(1===e)ft(85,-9,15,!1),ft(85,-9,-15,!1),ft(75,-9,15,!1),ft(75,-9,-15,!1),ft(95,-9,15,!1),ft(95,-9,-15,!1);else if(2===e)for(let e=0;e<12;e++)ft(80+2*Math.random(),7,20*Math.random()-140,!1);else 3===e&&ft(-170,-98,-230,!0);Ge.forEach(function(e){let o=[],n=[],i=[],a=[],r=[],s=0,l=e.isBoss?10:1;for(let c=0;c<lt.length;c+=6){let f=lt[c]*l,h=lt[c+1]*l,d=lt[c+2]*l,v=lt[c+3]*l,m=lt[c+4]*l,p=lt[c+5]*l;for(let e=0;e<t.position.length;e+=3)o.push(t.position[e]*v+2*f),o.push(t.position[e+1]*m+2*h),o.push(t.position[e+2]*p+2*d);for(let o=0;o<t.index.length;o++)n.push(1),n.push(e.id/255),n.push(0);Ut(i,t.normal),Ut(a,t.texture);for(let e=0;e<t.index.length;e++)r.push(t.index[e]+24*s);e.buffers={position:Vt(u,o),normal:Vt(u,i),texture:Vt(u,a),index:Wt(u,r)},e.hitBuffers={position:Vt(M,o),color:Vt(M,n),index:Wt(M,r)},s++}})}Pt(Tt)}function ht(){Fe={health:6,isAirborne:!1,pitch:-.12,sideMovement:0,straightMovement:0,upVelocity:0,x:-251.9,y:26.5,yaw:6.3,z:45},He=0,_=0,p=6,Ye=0,Ve=!1}function dt(e,t){u.bindBuffer(u.ARRAY_BUFFER,e.position),u.vertexAttribPointer(v.ve,3,u.FLOAT,!1,0,0),u.bindBuffer(u.ARRAY_BUFFER,e.texture),u.vertexAttribPointer(v.tc,2,u.FLOAT,!1,0,0),u.activeTexture(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,t),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,e.index),u.bindBuffer(u.ARRAY_BUFFER,e.normal),u.vertexAttribPointer(v.no,3,u.FLOAT,!1,0,0),function(){u.uniform1i(v.sa,0),u.uniformMatrix4fv(v.pm,!1,d),u.uniformMatrix4fv(v.mv,!1,h);let e=fo.create();uo.toInverseMat3(h,e),fo.transpose(e),u.uniformMatrix3fv(v.nm,!1,e),u.uniform1i(v.fl,_>0)}(),u.drawElements(u.TRIANGLES,e.index.numElements,u.UNSIGNED_SHORT,0)}let vt={songLen:95,songData:[{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:255,osc1_waveform:0,osc2_oct:7,osc2_det:0,osc2_detune:0,osc2_xenv:1,osc2_vol:255,osc2_waveform:0,noise_fader:0,env_attack:50,env_sustain:150,env_release:4800,env_master:124,fx_filter:2,fx_freq:600,fx_resonance:254,fx_delay_time:0,fx_delay_amt:0,fx_pan_freq:0,fx_pan_amt:0,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[,,,,,2,1,1,1,1,1,1,3,2,1,1,1,1,1,2,1,1,1,1],c:[{n:[147,,,,,,147,,,,147,,,,147,,147,,,,,,147,,,,147,,,,147,0]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,147,,147,0]},{n:[144,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0]}]},{osc1_oct:8,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:0,osc1_waveform:0,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:0,osc2_waveform:0,noise_fader:60,env_attack:50,env_sustain:419,env_release:4607,env_master:130,fx_filter:1,fx_freq:10332,fx_resonance:120,fx_delay_time:4,fx_delay_amt:16,fx_pan_freq:5,fx_pan_amt:108,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:5,lfo_amt:187,lfo_waveform:0,p:[,,1,1,1,1,1,2,1,1,1,1,3,2,1,1,1,1,1,1,1,1,1,1],c:[{n:[147,,,147,147,,147,147,,,147,,147,,147,147,147,,,147,147,,147,147,,,147,147,,147,147,147]},{n:[,,,,,,,,,,,,,,,,147,,,,,,,,147,,147,,147,147,147,147]},{n:[147,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:2,osc2_oct:8,osc2_det:0,osc2_detune:18,osc2_xenv:0,osc2_vol:255,osc2_waveform:2,noise_fader:117,env_attack:30021,env_sustain:75047,env_release:81599,env_master:192,fx_filter:2,fx_freq:200,fx_resonance:254,fx_delay_time:8,fx_delay_amt:72,fx_pan_freq:2,fx_pan_amt:142,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[1,1,2,3,1,1,2,3,1,1,2,3,1,1,2,3,1,1,2,3,1,,2,3,1],c:[{n:[111,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0]},{n:[118,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0]},{n:[114,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,0]}]},{osc1_oct:5,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:214,osc1_waveform:0,osc2_oct:5,osc2_det:0,osc2_detune:0,osc2_xenv:1,osc2_vol:204,osc2_waveform:0,noise_fader:229,env_attack:50,env_sustain:5268,env_release:1818,env_master:130,fx_filter:3,fx_freq:7924,fx_resonance:240,fx_delay_time:6,fx_delay_amt:74,fx_pan_freq:4,fx_pan_amt:232,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:6,lfo_amt:231,lfo_waveform:0,p:[,,,,,,,,,,,,,,1,1,2,2,2,2,1,2,1,2],c:[{n:[,,,,147,,,,,,,,147,,,,,,,,147,,,,,,,,147,,,0]},{n:[,,147,,147,,,,,,,,147,,,,,,147,,147,,,,,,,,147,,147,0]}]}],rowLen:5011,endPattern:26},mt=[31963,32987,45902,73712,40892,68219,97356,[9372,78981],77166,63716,15311,13826,5171,84557,39023],pt=0,_t=1,xt=2,gt=3,bt=4,yt=5,wt=6,Mt=7,Rt=8,Et=9,Tt=10,St=11,At=12,kt=13,Ft=14;function Pt(e,t){let o=mt[e];if((!t||t<=0)&&(t=1),t>1&&(t=1),o)if(Array.isArray(o))for(let e=0;e<o.length;e++)vo.z(o[e],{volume:t});else vo.z(o,{volume:t})}function Ct(e,t,o,n,i){e.drawImage(b,t*ae+1,o*ae,n*ae-2,i*ae,0,0,n,i)}function Bt(e,t,o,n){let i,a=t/de,r=function(e,t){return(ve+he)*(t/de)*e.length}(e,t);-1===n?i=xe/2-r-5:0===n&&(i=xe/2-r/2),1===n&&(i=xe/2+5);let l=i;s.save(),s.translate(0,0);for(let t=0;t<e.length;t++){let n=e[t],i=n.charCodeAt(0);if(" "===n)l+=ve*a;else{let e,t;"."===n?(e=420,t=ve/3):"@"===n?(e=1170,t=ve):(e=(i-97)*ve,t=ve),s.save(),s.translate(Math.floor(l),Math.floor(o)),s.scale(a,a),Ct(s,Math.floor(e),270,t,de),s.restore(),l+=(ve+he)*a}}s.restore()}function Lt(e){for(let o=0;o<16;o++)for(let n=0;n<16;n++)F.save(),F.fillStyle="#"+(t=e)[Math.floor(Math.random()*t.length)],F.fillRect(o,n,1,1),F.restore();var t;return k.toDataURL()}function qt(e){return Lt(e),F.fillStyle="#"+e[0],F.fillRect(0,0,16,1),F.fillRect(0,0,1,15),F.fillStyle="#"+e[e.length-1],F.fillRect(0,15,16,1),F.fillRect(15,1,1,16),k.toDataURL()}function It(e){let t=e.slice(0);return t.pop(),t.shift(),Lt(t),F.fillStyle="#"+e[0],F.fillRect(0,0,16,1),F.fillRect(0,8,16,1),F.fillRect(1,0,1,8),F.fillRect(8,7,1,8),F.fillStyle="#"+e[e.length-1],F.fillRect(0,7,16,1),F.fillRect(0,15,16,1),F.fillRect(0,0,1,7),F.fillRect(7,7,1,8),k.toDataURL()}function zt(e){let t=e.slice(0);return t.shift(),Lt(t),F.fillStyle="#"+e[0],F.fillRect(0,0,16,1),k.toDataURL()}function Dt(){return document.pointerLockElement===r}function Ut(e,t){e.push.apply(e,t)}function Gt(){return Ne++}function Nt(e){e.width=Ae,e.height=ke,e.style.position="fixed",e.style.top=0,e.style.left=0,x>_e?(e.style.left="50%",e.style.marginLeft="-"+Ae/2+"px"):(e.style.top="50%",e.style.marginTop="-"+ke/2+"px")}function Yt(e,t,o,n){let i;i=t.createShader(t.FRAGMENT_SHADER),t.shaderSource(i,o),t.compileShader(i),t.attachShader(e,i),i=t.createShader(t.VERTEX_SHADER),t.shaderSource(i,n),t.compileShader(i),t.attachShader(e,i),t.linkProgram(e),t.useProgram(e)}function Vt(e,t){let o=e.createBuffer();return o.numElements=t.length,e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,new Float32Array(t),e.STATIC_DRAW),o}function Wt(e,t){let o=e.createBuffer();return o.numElements=t.length,e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,o),e.bufferData(e.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),e.STATIC_DRAW),o}function Ot(e,t){t.viewport(0,0,e.width,e.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}function Xt(e,t,o){e[o]=t.getUniformLocation(e,o)}function Ht(e,t,o){e[o]=t.getAttribLocation(e,o),t.enableVertexAttribArray(e[o])}function jt(e,t,o){io(e,e,t-4,t+4,o-3,o+3),io(e,e,t-3,t+3,o-4,o+4)}function Zt(e,t,o,n){Kt(e-1,t,o,n),Kt(e+1,t,o,n),Kt(e,t,o-1,n),Kt(e,t,o+1,n)}function Jt(e,t,o,n,i,a){oo(e,t,o,n,i,a,q),oo(e,e,o,n-1,i,i,I),oo(t,t,o,n-1,i,i,I),oo(e,e,o,n-1,a,a,I),oo(t,t,o,n-1,a,a,I),oo(e,t,n,n,i,a,U)}function Kt(e,t,o,n){oo(e-1,e+1,t,t,o-1,o+1,I),oo(e,e,t,t+n,o,o,I),oo(e-1,e+1,t+n,t+n,o-1,o+1,I)}function Qt(e,t,o,n,i){let a=o;for(let o=e;o<=t;o++)oo(o,o,a,a,n,i,U),a--}function $t(e,t,o){oo(e,e,t,t,o-2,o+2,G),oo(e,e,t+3,t+7,o-5,o-5,G),oo(e,e,t+10,t+10,o-2,o+2,G),oo(e,e,t+3,t+7,o+5,o+5,G),no(e,t+1,o-3,G),no(e,t+2,o-4,G),no(e,t+1,o+3,G),no(e,t+2,o+4,G),no(e,t+8,o-4,G),no(e,t+9,o-3,G),no(e,t+8,o+4,G),no(e,t+9,o+3,G)}function eo(e,t,o,n,i,a){let r=t-e,s=n-o,l=a-i;for(let n=e;n<=t;n++)$t(n,Math.round(o+(n-e)/r*s),Math.round(i+(n-e)/r*l))}function to(e,t,o,n,i,a){oo(e,t,o,o,i,a,z),oo(e,t,n,n,i,a,U),oo(e,t,o,n,a,a,D),oo(e,t,o,n,i,i,D),oo(e,e,o,n,i,a,D),oo(t,t,o,n,i,a,D)}function oo(e,t,o,n,i,a,r){for(let s=e;s<=t;s++)for(let e=o;e<=n;e++)for(let t=i;t<=a;t++)no(s,e,t,r)}function no(e,t,o,n){void 0===we[e]&&(we[e]=[]),void 0===we[e][t]&&(we[e][t]=[]),we[e][t][o]={texture:n}}function io(e,t,o,n,i,a){for(let r=e;r<=t;r++)for(let e=o;e<=n;e++)for(let t=i;t<=a;t++)ao(r,e,t)}function ao(e,t,o){we[e]&&we[e][t]&&we[e][t][o]&&delete we[e][t][o]}function ro(e,t,o){e=Math.round(e),t=Math.round(t),o=Math.round(o);let n=we[e]&&we[e][t]&&we[e][t][o];return n?{x:e,y:t,z:o,texture:n.texture}:null}function so(e,t,o,n){let i=e.x,a=e.y,r=e.z,s=Math.abs(o),l=Math.sign(o),c=o>0?j:0;for(let t=0;t<s+ye;t+=ye){if(t>s&&(t=s),ro(e.x,e.y+t*l+c,e.z)){e.upVelocity=0,o<0&&(e.isAirborne=!1);break}a=e.y+t*l}let f=Math.abs(t),u=Math.sign(t);for(let t=0;t<f+ye;t+=ye){if(t>f&&(t=f),ro(e.x+t*u+.5*u,a,e.z)){ro(e.x+t*u+.5*u,a+1,e.z)||(a+=1);break}i=e.x+t*u}let h=Math.abs(n),d=Math.sign(n);for(let t=0;t<h+ye;t+=ye){if(t>h&&(t=h),ro(i,a,e.z+t*d+.5*d)){ro(i,a+1,e.z+t*d+.5*d)||(a+=1);break}r=e.z+t*d}e.x=i,e.y=a,e.z=r}var lo,co="undefined"!=typeof Float32Array?Float32Array:"undefined"!=typeof WebGLFloatArray?WebGLFloatArray:Array,fo={create:function(e){return new co(9)},transpose:function(e,t){if(!t||e==t){var o=e[1],n=e[2],i=e[5];return e[1]=e[3],e[2]=e[6],e[3]=o,e[5]=e[7],e[6]=n,e[7]=i,e}}},uo={};function ho(){this.x=new AudioContext,this.r=Date.now(),this.buffer=0,this.volume=.5,this.randomness=.1}uo.create=function(e){return new co(16)},uo.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},uo.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},uo.toInverseMat3=function(e,t){var o=e[0],n=e[1],i=e[2],a=e[4],r=e[5],s=e[6],l=e[8],c=e[9],f=e[10],u=f*r-s*c,h=-f*a+s*l,d=c*a-r*l,v=o*u+n*h+i*d;return v?(v=1/v,t||(t=fo.create()),t[0]=u*v,t[1]=(-f*n+i*c)*v,t[2]=(s*n-i*r)*v,t[3]=h*v,t[4]=(f*o-i*l)*v,t[5]=(-s*o+i*a)*v,t[6]=d*v,t[7]=(-c*o+n*l)*v,t[8]=(r*o-n*a)*v,t):null},uo.translate=function(e,t,o){var n=t[0],i=t[1];if(t=t[2],!o||e==o)return e[12]=e[0]*n+e[4]*i+e[8]*t+e[12],e[13]=e[1]*n+e[5]*i+e[9]*t+e[13],e[14]=e[2]*n+e[6]*i+e[10]*t+e[14],e[15]=e[3]*n+e[7]*i+e[11]*t+e[15],e},uo.rotate=function(e,t,o,n){var i=o[0],a=o[1];o=o[2];var r=Math.sqrt(i*i+a*a+o*o);if(!r)return null;1!=r&&(i*=r=1/r,a*=r,o*=r);var s=Math.sin(t),l=Math.cos(t),c=1-l;t=e[0],r=e[1];var f=e[2],u=e[3],h=e[4],d=e[5],v=e[6],m=e[7],p=e[8],_=e[9],x=e[10],g=e[11],b=i*i*c+l,y=a*i*c+o*s,w=o*i*c-a*s,M=i*a*c-o*s,R=a*a*c+l,E=o*a*c+i*s,T=i*o*c+a*s;return i=a*o*c-i*s,a=o*o*c+l,(n=e)[0]=t*b+h*y+p*w,n[1]=r*b+d*y+_*w,n[2]=f*b+v*y+x*w,n[3]=u*b+m*y+g*w,n[4]=t*M+h*R+p*E,n[5]=r*M+d*R+_*E,n[6]=f*M+v*R+x*E,n[7]=u*M+m*R+g*E,n[8]=t*T+h*i+p*a,n[9]=r*T+d*i+_*a,n[10]=f*T+v*i+x*a,n[11]=u*T+m*i+g*a,n},uo.frustum=function(e,t,o,n,i,a,r){r||(r=uo.create());var s=t-e,l=n-o,c=a-i;return r[0]=2*i/s,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=2*i/l,r[6]=0,r[7]=0,r[8]=(t+e)/s,r[9]=(n+o)/l,r[10]=-(a+i)/c,r[11]=-1,r[12]=0,r[13]=0,r[14]=-a*i*2/c,r[15]=0,r},uo.perspective=function(e,t,o,n,i){return t*=e=o*Math.tan(e*Math.PI/360),uo.frustum(-t,t,-e,e,o,n,i)},function(){function e(e){return Math.sin(6.283184*e)}var t=[e,function(t){return e(t)<0?-1:1},function(e){return e%1-.5},function(e){var t=e%1*4;return t<2?t-1:3-t}];function o(e){return.00390625*Math.pow(1.059463094,e-128)}function n(e){return{left:new Float32Array(e),right:new Float32Array(e)}}var i=function(e,o,n){this.ctx=e,this.instr=o,this.rowLen=n||5605,this.osc_lfo=t[o.lfo_waveform],this.osc1=t[o.osc1_waveform],this.osc2=t[o.osc2_waveform],this.attack=o.env_attack,this.sustain=o.env_sustain,this.release=o.env_release,this.panFreq=Math.pow(2,o.fx_pan_freq-8)/this.rowLen,this.lfoFreq=Math.pow(2,o.lfo_freq-8)/this.rowLen};i.prototype._genSound=function(t,n,i){for(var a=0,r=0,s=o(t+12*(this.instr.osc1_oct-8)+this.instr.osc1_det)*(1+8e-4*this.instr.osc1_detune),l=o(t+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),c=this.instr.fx_resonance/255,f=0,u=0,h=n.left.length,d=this.attack+this.sustain+this.release-1;d>=0;--d){var v=d+i,m=this.osc_lfo(v*this.lfoFreq)*this.instr.lfo_amt/512+.5,p=1;d<this.attack?p=d/this.attack:d>=this.attack+this.sustain&&(p-=(d-this.attack-this.sustain)/this.release);var _=s;this.instr.lfo_osc1_freq&&(_+=m),this.instr.osc1_xenv&&(_*=p*p),a+=_;var x=this.osc1(a)*this.instr.osc1_vol;_=l,this.instr.osc2_xenv&&(_*=p*p),r+=_,x+=this.osc2(r)*this.instr.osc2_vol,this.instr.noise_fader&&(x+=(2*Math.random()-1)*this.instr.noise_fader*p),x*=p/255;var g=this.instr.fx_freq;this.instr.lfo_fx_freq&&(g*=m);var b=c*(x-u)-(f+=(g=1.5*Math.sin(3.141592*g/44100))*u);switch(u+=g*b,this.instr.fx_filter){case 1:x=b;break;case 2:x=f;break;case 3:x=u;break;case 4:x=f+b}_=e(v*this.panFreq)*this.instr.fx_pan_amt/512+.5,x*=.00476*this.instr.env_master,v<h&&(n.left[v]+=x*(1-_),n.right[v]+=x*_)}};var a=function(e,t){this.ctx=e,this.song=t,this.waveSize=44100*t.songLen};a.prototype._generateTrack=function(e,t,o){var a=n(this.waveSize),r=this.waveSize,s=this.song.rowLen,l=this.song.endPattern,c=new i(this.ctx,e,s),f=0,u=0,h=0,d=function(){for(var t=Date.now();;)if(32!==h){if(u===l-1)return v();var o=e.p[u];if(o){var n=e.c[o-1].n[h];n&&c._genSound(n,a,f)}if(f+=s,h+=1,Date.now()-t>33)return void setTimeout(d,0)}else h=0,u+=1},v=function(){!function(e,t,o,n){for(var i=o.fx_delay_time*n>>1,a=o.fx_delay_amt/255,r=0;r<t-i;){var s=r,l=r+i;e.left[l]+=e.right[s]*a,e.right[l]+=e.left[s]*a,r++}}(a,r,e,s);for(var n=0;n<r;n++)t.left[n]+=a.left[n];for(n=0;n<r;n++)t.right[n]+=a.right[n];o()};d()},a.prototype._createAudioBuffer=function(e){var t=this,o=n(this.waveSize),i=0,a=function(){i<t.song.songData.length?(i+=1,t._generateTrack(t.song.songData[i-1],o,a)):e(function(e,t){var o=e.createBuffer(2,t.left.length,44100);return o.getChannelData(0).set(t.left),o.getChannelData(1).set(t.right),o}(t.ctx,o))};a()},lo=function(e,t,o){new a(e,t)._createAudioBuffer(o)}}(),ho.prototype.z=function(e,t){var o,n=this.Generate(e);for(o in t)n[o]=t[o];return this.Z(n.volume,n.randomness,n.frequency,n.length,n.attack,n.slide,n.noise,n.modulation,n.modulationPhase)},ho.prototype.Z=function(e,t,o,n,i,a,r,s,l){n=void 0===n?1:n,i=void 0===i?.1:i,a=void 0===a?0:a,r=void 0===r?0:r,s=void 0===s?0:s,l=void 0===l?0:l,e*=this.volume,o*=2*Math.PI/44100,o*=1+t*(2*this.R()-1),a*=1e3*Math.PI/Math.pow(44100,2),i*=0|(n=0<n?44100*(10<n?10:n)|0:1),s*=2*Math.PI/44100,l*=Math.PI,t=[];for(var c=0,f=0,u=0;u<n;++u)t[u]=e*Math.cos(c*o*Math.cos(f*s+l))*(u<i?u/i:1-(u-i)/(n-i)),c+=1+r*(2*this.R()-1),f+=1+r*(2*this.R()-1),o+=a;return this.buffer=t,e=this.x.createBuffer(1,t.length,44100),o=this.x.createBufferSource(),e.getChannelData(0).set(t),o.buffer=e,o.connect(this.x.destination),o.start(),o},ho.prototype.Generate=function(e){var t=this.r;this.r=e;for(var o=9;o--;)this.R();return(o={}).seed=e,o.volume=1,o.randomness=e?this.randomness:0,o.frequency=e?2e3*Math.pow(this.R(),2)|0:220,o.slide=e?parseFloat((10*Math.pow(this.R(),3)).toFixed(1)):0,o.length=e?parseFloat((.1+this.R()).toFixed(1)):1,o.attack=e?parseFloat(this.R().toFixed(2)):.1,o.noise=e?parseFloat((5*Math.pow(this.R(),3)).toFixed(1)):0,o.modulation=e?parseFloat((99*Math.pow(this.R(),5)).toFixed(1)):0,o.modulationPhase=e?parseFloat(this.R().toFixed(2)):0,this.r=t,o},ho.prototype.Note=function(e,t){return e*Math.pow(2,t/12)},ho.prototype.R=function(){return this.r^=this.r<<13,this.r^=this.r>>7,this.r^=this.r<<17,Math.abs(this.r)%1e9/1e9};var vo=new ho;const mo="precision highp float;varying vec2 vTextureCoord;varying vec3 vLightWeighting;uniform sampler2D sa;void main(){lowp vec4 a;a=texture2D(sa,vTextureCoord);lowp vec4 b;b.xyz=(a.xyz*vLightWeighting);b.w=a.w;gl_FragColor=b;}",po="precision highp float;varying vec4 co;void main(){gl_FragColor=co;}",_o="attribute vec3 ve;attribute vec3 aVertexColor;uniform mat4 mv;uniform mat4 pm;varying vec4 co;void main(){vec4 a;a.w=1.0;a.xyz=ve;gl_Position=(pm*(mv*a));vec4 b;b.w=1.0;b.xyz=aVertexColor;co=b;}",xo="attribute vec3 ve;attribute vec2 tc;uniform mat4 mv;uniform mat4 pm;uniform bool fl;varying vec2 vTextureCoord;varying vec3 vLightWeighting;void main(){float a;vec4 b;b.w=1.0;b.xyz=ve;vec4 c;c=(mv*b);gl_Position=(pm*c);vTextureCoord=tc;float d;vec3 e;e=-(c.xyz);d=sqrt(dot(e,e));if(fl){a=(3.0*pow(0.99,d));}else{a=(3.0*pow(0.97,d));}vLightWeighting=vec3(a);}"}();</script></body></html>