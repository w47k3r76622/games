!function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function t(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],r=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function e(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var r,o,n=i.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=n.next()).done;)s.push(r.value)}catch(t){o={error:t}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(o)throw o.error}}return s}function i(t,e){for(var i=0,r=e.length,o=t.length;i<r;i++,o++)t[o]=e[i];return t}var r=function(){function t(t,e,i,r){void 0===r&&(r=!1),this.direction=0,this.x=t,this.y=e,this.char=i,this.isDestroyable=r}return t.prototype.getChar=function(){return this.char},t.prototype.setPosition=function(t,e){this.x=t,this.y=e},t.prototype.getPosition=function(){return[this.x,this.y]},t.prototype.getAngledPosition=function(t){return[this.x+t*Math.cos(this.direction),this.y-t*Math.sin(this.direction)]},t.prototype.addX=function(t){this.x+=t},t.prototype.addY=function(t){this.y+=t},t}(),o=16,n=Math.PI/16;function s(t){return Math.floor(Math.random()*t)}var a={BLACK:"#000000",DGREY:"#626262",GREY:"#898989",LGREY:"#adadad",WHITE:"#ffffff",RED:"#9f4e44",LRED:"#cb7e75",BROWN:"#6d5412",LBROWN:"#a1683c",YELLOW:"#c9d487",LGREEN:"#9ae29b",GREEN:"#5cab5e",BLUE:"#5abfc6",LPURPLE:"#887ecb",PURPLE:"#50459b",PINK:"#a057a3"};function h(){var t=Object.values(a);return t[s(t.length+1)]}var c=function(){function t(t,e,i){this.charsetCoordinates=t,this.color=e,this.backgroundColor=i}return Object.defineProperty(t.prototype,"coords",{get:function(){return this.charsetCoordinates},enumerable:!1,configurable:!0}),t}(),l=function(){function t(t,e,i){this.actor=new r(t,e,new c([7,0],a.YELLOW)),this.direction=i}return t.prototype.travel=function(){var t=e(this.actor.getPosition(),2),i=t[0],r=t[1],o=e([7*Math.cos(this.direction),7*Math.sin(this.direction)],2),n=o[0],s=o[1];this.actor.setPosition(i+n,r-s)},t}(),u=function(){function t(t){var e=this;this.player=t,this.keyState={up:!1,down:!1,left:!1,right:!1,x:!1,z:!1,c:!1},this.shootLock=!1,this.angleLock=!1,window.addEventListener("keydown",(function(t){e.toggleFunction(!0)(t)})),window.addEventListener("keyup",(function(t){e.toggleFunction(!1)(t)}))}return t.prototype.toggleFunction=function(t){var e=this;return function(i){switch(i.key){case"ArrowUp":e.keyState.up=t;break;case"ArrowDown":e.keyState.down=t;break;case"ArrowLeft":e.keyState.left=t;break;case"ArrowRight":e.keyState.right=t;break;case"x":e.keyState.x=t;break;case"z":e.keyState.z=t;break;case"c":e.keyState.c=t}}},t.prototype.handle=function(t){var r=this,o=e(this.player.getPosition(),2),s=o[0],a=o[1];this.keyState.up&&!(a-5<0)&&this.player.addY(-5),this.keyState.down&&!(a+5>288)&&this.player.addY(5),this.keyState.left&&!(s-5<0)&&this.player.addX(-5),this.keyState.right&&!(s+5>392)&&this.player.addX(5),this.angleLock||!this.keyState.z&&!this.keyState.c||(this.keyState.z&&(this.player.direction+=n,this.player.direction>=2*Math.PI&&(this.player.direction-=2*Math.PI)),this.keyState.c&&(this.player.direction-=n,this.player.direction<0&&(this.player.direction+=2*Math.PI)),this.angleLock=!0,setTimeout((function(){return r.angleLock=!1}),50)),this.keyState.x&&!this.shootLock?(t(new(l.bind.apply(l,i(i([void 0],e(this.player.getAngledPosition(10))),[this.player.direction])))),this.shootLock=!0,setTimeout((function(){return r.shootLock=!1}),200)):t(null)},t}(),f=function(){function i(t){this.canvas=document.getElementById("c"),this.context=this.canvas.getContext("2d"),this.context.imageSmoothingEnabled=!1,this.buffer=document.getElementById("buffer"),this.bufferContext=this.buffer.getContext("2d"),this.charset=t}return i.prototype.paintBackground=function(){this.context.fillStyle=a.BLACK,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)},i.prototype.setCharColor=function(t,e){this.bufferContext.save(),this.bufferContext.clearRect(0,0,this.buffer.width,this.buffer.height),this.bufferContext.drawImage(this.charset,0,0),this.bufferContext.fillStyle=t,this.bufferContext.globalCompositeOperation="source-in",this.bufferContext.fillRect(0,0,this.buffer.width,this.buffer.width),this.bufferContext.restore(),e&&(this.bufferContext.fillStyle=h(),this.bufferContext.globalCompositeOperation="destination-over",this.bufferContext.fillRect(0,0,this.buffer.width,this.buffer.height),this.bufferContext.restore())},i.prototype.clear=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},i.prototype.renderHUD=function(t,e){this.context.font="16px 'Fira Mono', 'Lucida Console', monospace, sans-serif",this.context.fillStyle=a.WHITE,this.context.fillText("FREED SPACE: "+t+"kb",10,20),this.context.fillStyle=a.RED,this.context.fillText("CORRUPTED DATA: "+e+"kb",10,42)},i.prototype.render=function(){for(var i,r,n=[],s=0;s<arguments.length;s++)n[s]=arguments[s];this.clear(),this.paintBackground();try{for(var a=t(n),h=a.next();!h.done;h=a.next()){var c=h.value,l=e(c.getPosition(),2),u=l[0],f=l[1];this.setCharColor(c.getChar().color,c.getChar().backgroundColor||null),this.context.drawImage(this.buffer,8*c.getChar().coords[0],c.getChar().coords[1]*o,8,o,2*u,2*f,16,32)}}catch(t){i={error:t}}finally{try{h&&!h.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}},i}(),d=function(){function n(){var t=this;this.enemyList=new Set,this.bulletList=new Set,this.counter=0,this.shouldGenerateEnemies=!1,this.score=0,this.corrupted=0,this.player=new r(8,150,new c([0,2],a.WHITE)),this.aim=new r(0,0,new c([7,0],a.WHITE)),this.control=new u(this.player),setInterval((function(){t.shouldGenerateEnemies=!0}),500),new Promise((function(t,e){var i=new Image;i.src="./assets/cp437_8x16.png",i.addEventListener("load",(function(){t(i)}),!1)})).then((function(e){t.renderer=new f(e),t.gameLoop()}))}return n.prototype.getRandomChar=function(){var t=s(31),e=s(7);return 0==t&&0==e||0==t&&1==e||31==t&&7==e?this.getRandomChar():[t,e]},n.prototype.generateRandomEnemy=function(){if(this.counter<100){var t=s(284);if(s(100)>70){var e=new c(this.getRandomChar(),a.WHITE);this.enemyList.add(new r(408,t,e)),this.shouldGenerateEnemies=!1}else{e=new c([s(31),s(16)],h(),a.RED);this.enemyList.add(new r(408,t,e,!0)),this.shouldGenerateEnemies=!1}}},n.prototype.winGame=function(){alert("Task succeeded. Freed "+this.score+"kb on disk.");var t=localStorage.getItem("filepurge-score");t?this.score>Number(t)&&localStorage.setItem("filepurge-score",String(this.score)):localStorage.setItem("filepurge-score",String(this.score)),location.reload()},n.prototype.updateEnemies=function(){var e,i;try{for(var r=t(this.enemyList),o=r.next();!o.done;o=r.next()){var n=o.value;n.addX(-2),n.getPosition()[0]<-8&&(this.enemyList.delete(n),100==this.counter&&this.winGame())}}catch(t){e={error:t}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}},n.prototype.updateBullets=function(){var i,r,n,s,a,h;try{for(var c=t(this.bulletList),l=c.next();!l.done;l=c.next()){var u=l.value,f=e(u.actor.getPosition(),2),d=f[0],y=f[1];if(u.travel(),u.actor.getPosition()[0]>400)this.bulletList.delete(u);else try{for(var p=(n=void 0,t(this.enemyList)),g=p.next();!g.done;g=p.next()){var m=g.value,b=e(m.getPosition(),2),v=b[0],w=b[1];(a=[d,y,8,o])[0]<(h=[v,w,8,o])[0]+h[2]&&a[0]+a[2]>h[0]&&a[1]<h[1]+h[3]&&a[1]+a[3]>h[1]&&(this.enemyList.delete(m),this.bulletList.delete(u),m.isDestroyable?(this.score+=250,100==this.counter&&this.winGame()):(this.corrupted+=250,this.corrupted>=5e3&&(alert("Filesystem corrupted. Aborting..."),location.reload())))}}catch(t){n={error:t}}finally{try{g&&!g.done&&(s=p.return)&&s.call(p)}finally{if(n)throw n.error}}}}catch(t){i={error:t}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(i)throw i.error}}},n.prototype.setAimPosition=function(t){var r;void 0===t&&(t=10),(r=this.aim).setPosition.apply(r,i([],e(this.player.getAngledPosition(t))))},n.prototype.drawHUD=function(){var t;null===(t=this.renderer)||void 0===t||t.renderHUD(this.score,this.corrupted)},n.prototype.gameLoop=function(){var t,r=this;this.shouldGenerateEnemies&&this.generateRandomEnemy(),this.setAimPosition(),this.control.handle((function(t){t&&(r.bulletList.add(t),r.setAimPosition(7))})),this.updateEnemies(),this.updateBullets(),(t=this.renderer).render.apply(t,i(i([this.player,this.aim],e(this.enemyList)),e(Array.from(this.bulletList).map((function(t){return t.actor}))))),this.drawHUD(),requestAnimationFrame((function(){return r.gameLoop()}))},n}(),y=localStorage.getItem("filepurge-score");y&&(document.getElementById("score").innerHTML=y),new d}();
