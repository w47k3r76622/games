<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>JS13k 2023</title></head><body><main><div id=resG><div class=g id=wG></div><div class=g id=sG></div><div class=g id=iG></div><div class=g id=tG></div><div class=g id=mG></div><div class=g id=aG></div><div id=atk hidden><div><span>🎯 Attack Incoming</span><span id=atkTimer>01:20</span></div><div id=atkArmy class=atkArmy></div></div><div id=saved class=hide>Game Saved</div></div><pre id=actP><span>     __/\__
. _  \\''//
-( )-/_||_\
 .'. \_()_/
  |   | . \
  |mrf| .  \
 .'. ,\_____'.
</span></pre><pre hidden id=bldP><span>       _
     _|=|__________
    /              \
   /                \
  /__________________\
   ||  || /--\ ||  ||
   ||[]|| | .| ||[]||
   ||__||_|__|_||__||</span></pre><pre hidden id=tskP><span>               .---.
     |________/     \________
()===|_______( () () )_______&gt;
     | VK     \  M  /
               |HHH|
               `---'
</span></pre><div id=actG><h2>Actions</h2></div><div id=bldG><h2 hidden id=bldT>Buildings</h2></div><div id=tskG><h2 hidden id=tskT>Tasks</h2></div><div id=tskInpG><div hidden id=tskInpT><h2>&nbsp;</h2><div id=pop></div></div></div></main><style>*{box-sizing:border-box}[hidden]{visibility:hidden!important}body,html{font:18px arial;margin:0;color:#222;background:#fdfdfd}main{display:grid;grid-template-columns:1fr 1fr 0.5fr 0.5fr;grid-template-areas:"resources resources resources resources" "actP bldP tskP tskP"}#resG{grid-area:resources;display:flex;gap:1.25rem;background:#222;color:#fdfdfd;padding:1rem;position:relative}.g{display:flex;flex-direction:column;align-items:start;gap:.75rem;width:6rem}.g>div{display:flex;align-items:center;gap:.25rem}.g>div[hidden]{display:none}#saved{position:absolute;right:1.5rem;bottom:1rem;opacity:1}#saved.hide{opacity:0;transition:opacity 2s linear}#atk{position:absolute;top:1rem;right:1.5rem;color:#ff4242}#atk .cost{color:#fdfdfd;margin-top:.5rem}h2{margin:0}main>div:not(#resG){display:flex;flex-direction:column;gap:.5rem;padding:1rem}pre{font-size:.6rem;display:flex;align-items:center;justify-content:center;margin:0;padding:1rem 0 0}button{display:flex;align-items:center;padding:.25rem .5rem;background:#e9e9ed;border:1px solid;border-radius:4px;height:2rem;font-size:1rem}button:hover{background:#c8c8c8}button[aria-disabled=true],button[aria-disabled=true]:focus,button[aria-disabled=true]:hover{background:rgba(233,233,237,.5);color:rgba(0,0,0,.5);border-color:rgba(0,0,0,.5)}.btn-r{margin-left:auto;display:inline-flex}.cost{display:inline-flex;gap:.75rem}.cost>span{display:inline-flex;align-items:center;gap:.25rem}.lock{background:#e62200;border-radius:50%;display:flex;align-items:center;justify-content:center;border:1px solid #000;z-index:2;aspect-ratio:1/1;height:100%}.Research:not(.icon){margin-left:-.65rem;border:1px solid #000;padding:0 .25rem 0 .75rem;margin-right:.5rem;background:#fdfdfd;display:inline-flex;align-items:center;gap:.25rem}#tskP{grid-area:tskP}.win{font-size:2rem;margin:2rem}.cooldown{position:absolute;top:0;left:0;bottom:0;background:rgba(0,0,0,.5)}#actG .btn-r{min-width:3rem}#bldG .locked .btn-r{display:none}input{width:50%;padding:0;font-size:1rem}input:focus{outline:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{opacity:1}#tskG>div,#tskInpG input{height:2rem;display:flex;align-items:center;border:0}#tskG>div{padding:.5rem}#tskInpG>div{display:flex;align-items:center;gap:.75rem}#tskInpT .icon{width:auto;height:auto}#pop{position:absolute}.max{white-space:nowrap}.atkArmy .cost-icon,.icon{width:1.25rem;height:1.25rem;margin-right:.35rem;display:inline-flex;align-items:center;text-shadow:1px 0 0 #fdfdfd,0 1px 0 #fdfdfd,0 -1px 0 #fdfdfd,-1px 0 0 #fdfdfd}.atkArmy .cost-icon{margin:0}.cost-icon,.lock,p span{text-shadow:1px 0 0 #222,0 1px 0 #222,0 -1px 0 #222,-1px 0 0 #222}.icon.Archers,:is(.skeletons,.Archers) .cost-icon{text-shadow:none}.Archers{display:inline-flex;align-items:center;gap:.25rem}img{filter:drop-shadow(1px 0 #fdfdfd) drop-shadow(-1px 0 #fdfdfd) drop-shadow(0 1px #fdfdfd) drop-shadow(0 -1px #fdfdfd);width:1rem;height:auto;vertical-align:text-bottom}.tipC{position:relative}.tip{position:absolute;z-index:5;left:0;background:#fdfdfd;box-shadow:-3px 5px 6px #222;border:1px solid #222;border-radius:4px;padding:.5rem .5rem;min-width:100%;bottom:140%;display:inline-flex;align-items:start;flex-direction:column;gap:.5rem;visibility:hidden;font-size:.9rem;opacity:1;color:#222;font-weight:400}:is(.tipC:hover,.tipC:focus-visible) .tip:not(:hover){visibility:visible}.tip.b{top:140%;bottom:unset}.tip.res{display:block;width:auto;white-space:nowrap}.tip.unit{display:inline-grid;grid-template-columns:2;grid-template-rows:auto;gap:.5rem 1.5rem;grid-template-areas:'header header'}.tip.unit>b{grid-area:header}b{font-size:1rem}p{margin:.5rem 0;font-size:.9rem;text-align:left}p span{margin:0 .15rem}dialog{all:unset;box-shadow:-3px 5px 6px #222;border-radius:4px;background:#fdfdfd;border:.15rem solid;padding:1rem;opacity:0;display:block;position:absolute;top:50%;right:50%;transform:translate(50%,-50%);max-width:50vw;visibility:hidden;transition:opacity .25s;overflow:hidden}dialog[open]{visibility:visible;opacity:1}dialog::backdrop{background-color:rgba(0,0,0,.2)}dialog.to-tr{animation:fadeout .75s ease-out,to-tr .5s ease-out forwards;transition:none}dialog button{justify-content:center}.head:not(:empty){margin-bottom:1rem}.body .Research{all:unset;font:18px arial}.foot{display:flex;justify-content:end;gap:.5rem;margin-top:1rem}.ok{background:#0073e6;color:#fff;border-color:#004a94}.ok:hover{background:#004a94}@keyframes to-tr{0%{top:50%;right:50%;transform:translate(50%,-50%);max-width:50vw;max-height:50vw}100%{top:0;right:0;transform:translate(0,0);max-width:12rem;max-height:1rem}}@keyframes fadeout{0%{opacity:1}100%{opacity:0}}</style><script>(()=>{var n=600,e="straker-2023-state",t=()=>{},a={};function s(n){let e=n.canvas;n.clearRect(0,0,e.width,e.height)}var o=[];function r(n,e){nn(o,n).push(e)}function i(n,...e){nn(o,n).map((n=>n(...e)))}window.callbacks=o;var l,d=1,A=3,c=4,p=0,u=[],h=u,m=[],f=m,g=0,k=1,v=2,S=5,b=6,y=0,w=1,C=2,R=3,V=4,M=5,T=6,E=7,$=8,B=9,I=10,Y=11,U=12,N=13,G=14,Q=15,W=16,Z=17,j=18,x=[],H=x,X=2,J=3,L=4,F=5,D=0,O=1,q=2,z=3,K=[],P=K,_=[[0,0,,0,1]];function nn(n,e){let t=n;return e.map((n=>{t[n]=t[n]??[],t=t[n]})),t}function en(n,e,t,a,s,o,i){const l=n[e]??[],d=l.map((()=>0));l.map(((n,e)=>{const l=[...n],A=l.pop();r(l,(n=>{A>n||(d[e]=1,d.every((n=>n))&&(t.hidden=0,fn.set([a,s,o,1]),i&&i()))}))}))}function tn(n){const e=document.createElement("div");return e.innerHTML=n,e.children[0]}function an(n){return 1e3>n?0|n:1e6>n?(n/1e3).toFixed(1)+"K":(n/1e6).toFixed(1)+"M"}function sn(n,e,t=""){return`<span class="${n[g]}"><span class="cost-icon">${n[k]}</span> ${t}${an(e)}</span>`}function on(n){const e={[D]:H[Q],[q]:H[W],[O]:H[Z],[z]:H[j]};return`\n    <div class="cost">\n      ${n.map(((n,t)=>{const a=e[t];return`<span class="${a[g]}"><span class="cost-icon">${a[k]}</span> ${an(n)}</span>`})).join("")}\n    </div>\n  `}function rn(n){return n.every((([n,e])=>fn.get([cn,n,S])>=e))}var ln={rand(){l=2654435769+(l|=0)|0,fn.set([hn,0,2,l]);let n=l^l>>>16;return n=Math.imul(n,569420461),n^=n>>>15,n=Math.imul(n,1935289751),((n^=n>>>15)>>>0)/4294967296},randInt(n,e,t=this.rand){return(t()*(e-n+1)|0)+n},getSeed(){return l},seed(n=Date.now()){l=n,fn.set([hn,0,2,l])}};window.random=ln,window.generateArmy=(n,e)=>{const t=[0,0,0,0];for(;n>0;){const a=e[ln.randInt(0,e.length-1)],s=fn.get([un,a,6]),o=Math.ceil(n*s),r=ln.randInt(0,o,(()=>ln.rand()**2));t[a]+=r,n-=r/s}return t};var dn=[],An=dn,cn=0,pn=3,un=4,hn=5,mn={get(n,e){const t=[...n],a=t.pop();return nn(this._state,t)[a]??e},add(n,e){const t=[...n],{obj:a,value:s,index:o}=gn(t);return a[o]=Math.min((a[o]??0)+s,e??1/0),i([...t,o],a[o],s),a[o]},set(n){const e=[...n],{obj:t,value:a,index:s}=gn(e);t[s]=a,i([...e,s],t[s],a)},save(){const n=[kn(H,[v,4,S,b]),kn(In,[yn,wn,Cn,Rn,Vn]),kn(f,[6,8,7,9]),kn(h,[A,c,5]),kn(P,[8]),_];var t,a;t=e,null==(a=n)?localStorage.removeItem(t):localStorage.setItem(t,JSON.stringify(a))},load(n){const t=(n=>{let e=localStorage.getItem(n);try{e=JSON.parse(e)}catch(n){}return e})(e);return t?(t.map(((e,t)=>{e.map(((e,a)=>{Object.entries(e).map((([e,s])=>{n[t]?.[a]?n[t][a][e]=s:console.info("State missing:",t,a,e)}))}))})),n):n}},fn=mn;function gn(n){const e=n.pop(),t=n.pop();return{obj:mn.get(n),value:e,index:t}}function kn(n,e){return n.map((n=>n.reduce(((n,t,a)=>(e.includes(a)&&(n[a]=t),n)),{})))}window.state=mn;var vn=2,Sn=3,bn=5,yn=7,wn=8,Cn=9,Rn=10,Vn=11,Mn=9,Tn=10,En=11,$n=12,Bn=[],In=Bn;function Yn(n,e){const t=tn('<div class="tipC"></div>');Un(t,n,e),t.hidden=!n[4],en(n,3,t,cn,e,4),r([cn,e,S],(()=>{Un(t,n,e)})),r([cn,e,v],(()=>{Un(t,n,e)})),r([cn,e,b],(()=>{Un(t,n,e)})),([y,M].includes(e)?wG:[w,E].includes(e)?sG:[$,B,I].includes(e)?iG:[Y,U,N,G].includes(e)?tG:[Q,W,Z,j].includes(e)?aG:e==V?pop:mG).appendChild(t)}function Un(e,t,a){const s={[Q]:P[D],[W]:P[q],[Z]:P[O],[j]:P[z]},o=[Q,W,Z,j].includes(a);let r=`\n    <span class="icon ${t[g]}">${t[k]}</span>\n    <span class="amount">\n      ${an(t[S]??0)}${t[v]?"/"+an(t[v]):""}\n    </span>\n    ${a!==V?`\n        <span class="tip res b${o?"  unit":""}${a==V?" r":""}">\n          <b>${t[g]}</b>${o?"":`: ${t[b]>0?"+":""}${t[b]??0} per ${n/60}s`}\n          ${[Q,W,Z,j].includes(a)?(i=s[a],`\n    <span>${i[X]} HP</span>\n    <span>${i[J]} DEF</span>\n    <span>${i[L]} ATK</span>\n  `):""}\n        </span>`:""}\n  `;var i;e.innerHTML=r}var Nn,Gn=0,Qn=1,Wn=2,Zn=3;function jn(n,e){n=xn(n),e=xn(e);for(let t=0;6>t&&n.length&&e.length;t++)Hn(n),Hn(e),Xn(n,e),Xn(e,n),n=n.filter((n=>n[Qn]>0)),e=e.filter((n=>n[Qn]>0));const t=[0,0,0,0],a=[0,0,0,0];return n.map((([n])=>{t[n]++})),e.map((([n])=>{a[n]++})),{attackers:t,defenders:a}}function xn(n){return n.map(((n,e)=>{const t=[];for(let a=0;n>a;a++)t.push([e,P[e][X],P[e][J],P[e][L]]);return t})).flat()}function Hn(n){n.map((n=>{n[Wn]=P[n[Gn]][J]}))}function Xn(n,e){n.map((n=>{const t=ln.randInt(0,e.length-1);let a,s=e[t];for(Jn(n,s);a=P[n[Gn]][F][s[Gn]];){if(ln.rand()>=a)return;const t=ln.randInt(0,e.length-1);s=e[t],Jn(n,s)}}))}function Jn(n,e){if(n[Zn]<=e[Wn])return void(e[Wn]=e[Wn]-n[Zn]);e[Qn]-=n[Zn]-e[Wn],e[Wn]=0;const t=P[e[Gn]][X];.7>e[Qn]/t&&1-e[Qn]/t>ln.rand()&&(e[Qn]=0)}window.resolveBattle=jn,r(["timer-tick"],(n=>{const e=fn.add([hn,0,3,-n]),t=fn.get([hn,0,5]);if(t?.length&&0>e){const n=[Q,W,Z,j].map((n=>fn.get([cn,n,S],0))),{attackers:e,defenders:a}=jn(t,n);fn.set([hn,0,5,[]]);const s={[D]:Q,[q]:W,[O]:Z,[z]:j},o=[];if(a.map(((n,e)=>{const t=fn.get([cn,s[e],S],0)-n;fn.set([cn,s[e],S,n]),t>0&&o.push([s[e],t])})),Nn.head.innerHTML="<b>Battle Results</b>",Nn.body.innerHTML=`\n      <p>You were successfully able to repel the enemy army. You lost the following troops.</p>\n      <span class="cost">${o.map((([n,e])=>sn(H[n],e))).join("")}</span>\n    `,Nn.onClose=n=>{Nn.close(n)},a.every((n=>!n))&&e.some((n=>n))){fn.set([pn,p,c,0]);const n=H.map(((n,e)=>[C,R,V,T,Q,Z,W,j].includes(e)?void 0:n));let t=e.reduce(((n,e,t)=>n+e*fn.get([un,t,7])),0);const a=[];for(let e=0;e<n.length&&t>0;e++){if(!n[e])continue;const s=fn.get([cn,e,S]);if(!s)continue;const o=0|Math.min(t,s/2);a.push([e,o]),t-=o,fn.set([cn,e,S,s-o])}Nn.body.innerHTML=`\n        <p>You failed to repel the invaders. You lost all your army, all Idle Skeletons, and the following resources were pillaged:</p>\n        <span class="cost">${a.map((([n,e])=>sn(H[n],e))).join("")}</span>\n      `}Nn.open()}}));var Ln=0,Fn=0,Dn=function({fps:n=60,clearCanvas:e=1,update:o=t,render:r,context:i,blur:l=0}={}){if(!r)throw Error("You must provide a render() function");let d,A,c,p,u,h=0,m=1e3/n,f=1/n,g=e?s:t,k=1;var v,S;function b(){if(A=requestAnimationFrame(b),k&&(c=performance.now(),p=c-d,d=c,1e3>=p)){for(((n,...e)=>{(a.tick||[]).map((n=>n(...e)))})(),h+=p;h>=m;)u.update(f),h-=m;g(u.context),u.render()}}return l||(window.addEventListener("focus",(()=>{k=1})),window.addEventListener("blur",(()=>{k=0}))),S=()=>{u.context??=void 0},a[v="init"]=a[v]||[],a[v].push(S),u={update:o,render:r,isStopped:1,context:i,start(){d=performance.now(),this.isStopped=0,requestAnimationFrame(b)},stop(){this.isStopped=1,cancelAnimationFrame(A)},_frame:b,set _last(n){d=n}},u}({clearCanvas:0,blur:1,update(e){i(["timer-tick"],e),++Ln<n||(Ln=0,(()=>{const n=h.map((n=>n[c]));let e;do{e=0,h.map(((t,a)=>{const s=n[a],o=t[d];if(!s)return;const r=o.filter((([,n])=>0>n)),i=o.filter((([,n])=>n>0));let l=s;r.every((([n,e])=>{const t=-e*s;return l=Math.min(t+(fn.get([cn,n,S])-t),t,l*-e)/-e|0,l>0}))&&i.every((([n,e])=>(l=Math.ceil(Math.min(fn.get([cn,n,v],1/0)-fn.get([cn,n,S],0),l)/e),l>0)))&&o.map((([t,o])=>{const r=fn.get([cn,t,v]);o>0&&fn.get([cn,t,S])>=r||(fn.add([cn,t,S,o*l],r),e=1,n[a]=s-l)}))}))}while(e)})(),(n=>{Nn||(Nn=new On({confirm:"OK"})),Nn.onClose=n=>{Nn.dialog.classList.add("to-tr"),Nn.dialog.addEventListener("animationend",(e=>{if("to-tr"==e.animationName)return fn.set([hn,0,3,60]);Nn.dialog.classList.remove("to-tr"),Nn.close(n)}))};const e=fn.add([hn,0,0,n]),t=(fn.get([hn,0,1],0),[V,Q,W,Z,j].reduce(((n,e)=>n+fn.get([cn,e,S],0)),0));if(36e3>e)return;fn.set([hn,0,0,0]),fn.set([hn,0,1,t]);const a=fn.add([hn,0,4,1])**1.25-2.17,s=[D];2>a||s.push(O),4>a||s.push(q),8>a||s.push(z);const o=generateArmy(a,s);fn.set([hn,0,5,o]),Nn.head.innerHTML="<b>🎯 Attack Incoming</b>",Nn.body.innerHTML=`<p>The local population does not like you taking the bodies of their loved ones. They are gathering an army to attack you.<p><p>${on(o)}</p>`,Nn.open()})(n)),3600>++Fn||(Fn=0,fn.save(),console.log("saved"),saved.classList.remove("hide"),setTimeout((()=>saved.classList.add("hide"))))},render(){}}),On=class{constructor({confirm:n,cancel:e}={}){const t=this.dialog=tn('\n      <dialog>\n        <div class="head"></div>\n        <div class="body"></div>\n        <div class="foot"></div>\n      </dialog>\n    '),a=t.querySelector(".foot");if(this.head=t.querySelector(".head"),this.body=t.querySelector(".body"),e){const n=tn(`<button>${e}</button>`);n.addEventListener("click",(()=>this.onClose(0))),a.appendChild(n)}if(n){const e=tn(`<button class="ok">${n}</button>`);e.addEventListener("click",(()=>this.onClose(1))),a.appendChild(e)}document.body.appendChild(t)}open(n,e){Dn.stop(),this.prevElm=document.activeElement,n&&(this.body.innerHTML=`<p>${n}</p>`),this.dialog.showModal(),this._callback=e}close(n){Dn.start(),this.dialog.close(),this.prevElm.focus(),n&&this._callback?.()}onClose(n){this.close(n)}};window.Dialog=On;var qn=new On({confirm:"OK"}),zn=new On({confirm:"OK",cancel:"Cancel"}),Kn=class{constructor(n,e,t,a,s,o,i,l,d,A,c,p){n[o]??=[];const u=n[a];let h=n[d]&&!n[A];const m=tn(`\n      <button class="tipC ${h?"locked":""}">\n        ${h?'<span class="lock">🔒</span>'+sn(H[T],n[d]):""}\n        <span>${u}</span>\n        <span class="tip">\n          <b>${u}</b>\n          <span class="cost">\n            ${n[o].map((([n,e])=>sn(H[n],e))).join("")}\n          </span>\n          <p>${n[s]}</p>\n          ${h?`<em>Requires ${n[d]} Research to unlock</em>`:""}\n        </span>\n      </button>\n    `);return m.hidden=!n[c],m.setAttribute("aria-disabled",!!n[p]),en(n,l,m,t,e,c,(()=>{h||fn.set([t,e,p,!this.canAfford(n)])})),r([t,e,p],(n=>{m.setAttribute("aria-disabled",!!n)})),m.addEventListener("click",(a=>h?fn.get([cn,T,S],0)<n[d]?void qn.open(`Not enough <span class="cost-icon">${H[T][k]}</span> to unlock ${u}`):void zn.open(`Unlock ${u} for ${sn(H[T],n[d])}?`,(()=>{h=0,m.querySelector(".lock").remove(),m.querySelector(".Research").remove(),m.classList.remove("locked"),fn.add([cn,T,S,-n[d]]),fn.set([t,e,A,1]),fn.add([t,e,p,!this.canAfford(n)]),this.enableWhenCanAfford(n,e)})):n[p]?a.preventDefault():(n[o].map((([n,e])=>{fn.add([cn,n,S,-e])})),void this.whenClicked(n,e)))),h?fn.set([t,e,p,0]):this.enableWhenCanAfford(n,e),m}};function Pn(n,e){n[9]??=1;const t=new _n(n,e,2,0,1,2,3,4,5,6,7,9),a=tn(`<span class="btn-r">${n[8]??0}</span>`);t.appendChild(a),0===e&&(bldP.hidden=bldT.hidden=!n[7],r([2,0,7],(n=>{bldP.hidden=bldT.hidden=!n}))),r([2,e,8],(n=>{a.textContent=n})),bldG.appendChild(t)}var _n=class extends Kn{constructor(...n){super(...n)}whenClicked(n,e){fn.add([2,e,8,1]),n[3].map((n=>fn.add(n)))}canAfford(n){return rn(n[2])}enableWhenCanAfford(n,e){n[2].map((([t])=>{r([cn,t,S],(()=>{if(!n[7])return;let t=1;rn(n[2])&&(t=0),fn.set([2,e,9,t])}))}))}};function ne(n){let e=n[7];if(e)return e;const t=[];for(let e=0;4>e;e++){const e=[0,0,0,0],a=n[6];let s=ln.rand()**.5*n[5];for(n[5];s>0;){const n=a[ln.randInt(0,a.length-1)],t=fn.get([un,n,6]),o=Math.ceil(s*t),r=ln.randInt(0,o);e[n]+=r,s-=r/t}t.push(e)}return t}window.generateLocations=ne;var ee=new class extends On{constructor(){super({cancel:"Cancel"})}open(n,e){const t=ne(n);this.head.innerHTML=`Select a ${n[0]} to attack`,this.body.innerHTML=`\n      <div>Enemy Army</div>\n      <div>Reward</div>\n      <div></div>\n      ${t.map((n=>`\n            <div>\n              ${n.map((n=>n?`<div class="unit">${n}</div>`:"")).join("")}\n            </div>\n            <div></div>\n            <button class="ok">Attack</button>\n          `)).join("")}\n    `,super.open()}};function te(n,e){const t=new ae(n,e,1,0,1,bn,Sn,4,6,yn,wn,Rn),a=tn('<span class="cooldown"></span>'),s=tn(`\n    <span class="btn-r">\n      ${n[Sn].map((([n,e])=>sn(H[n],e,"+"))).join("")}\n    </span>\n  `);t.appendChild(a),t.appendChild(s),se(n,a),r(["timer-tick"],(t=>{n[Vn]>0&&(fn.add([1,e,Vn,-t]),se(n,a),oe(n)&&fn.set([1,e,Rn,0]))})),actG.appendChild(t)}window.settlementDialog=ee;var ae=class extends Kn{constructor(...n){super(...n)}whenClicked(n,e){[Mn,Tn,En,$n].includes(e)||(fn.add([1,e,Cn,1]),n[Sn].map((([n,e])=>{fn.add([cn,n,S,e],fn.get([cn,n,v]))})),fn.set([1,e,Rn,1]),fn.set([1,e,Vn,n[vn]]))}canAfford(n){return oe(n)}enableWhenCanAfford(n,e){n[Sn].map((([t])=>{r([cn,t,S],(()=>{n[wn]&&fn.set([1,e,Rn,!oe(n)])})),r([cn,t,v],(()=>{n[wn]&&fn.set([1,e,Rn,!oe(n)])}))})),n[bn].map((([t])=>{r([cn,t,S],(()=>{n[wn]&&fn.set([1,e,Rn,!oe(n)])}))}))}};function se(n,e){const t=n[Vn]>0?n[Vn]/n[vn]*100+"%":0;e.style.width=t}function oe(n){return 0>=(n[Vn]??0)&&rn(n[bn])&&((n[Sn]??[]).length?n[Sn].some((([n])=>fn.get([cn,n,S],0)<fn.get([cn,n,v],1/0))):1)}function re(n,e){const t=tn(`\n    <div class="tipC" ${n[5]?"":"hidden"}>\n      ${n[0]}\n      ${e!==p?`<span class="tip">${ie(n,n[c]??0)}</span>`:""}\n    </div>\n  `);tskG.appendChild(t);const a=tn(`\n    <div class="tipC">\n      <input type="number" min="0" max="0" value="${n[c]??0}">\n      <div class="max"></div>\n      ${e!==p?`<span class="tip">${ie(n,n[c]??0)}</span>`:""}\n    </div>\n  `),s=a.querySelector("input"),o=a.querySelector(".max");a.hidden=!n[5],en(n,2,a,pn,e,5),0===e&&(tskP.hidden=tskT.hidden=tskInpT.hidden=!n[5],r([pn,0,5],(n=>{tskP.hidden=tskT.hidden=tskInpT.hidden=!n}))),r([pn,e,5],(n=>{t.hidden=!n})),s.addEventListener("keydown",(n=>n.preventDefault())),e===p?(s.setAttribute("readonly",1),s.setAttribute("type","text"),r([cn,V,S],((n,t)=>{fn.add([pn,e,c,t])})),r([pn,e,c],(n=>{s.value=n}))):(le(n,s),r([pn,p,c],(()=>{le(n,s)})),r([pn,e,A],(()=>{le(n,s)})),o.textContent="/ "+n[A],r([pn,e,A],(n=>{o.textContent="/ "+n})),r([pn,e,c],((s,o)=>{if(e!==p){const e=ie(n,s);t.querySelector(".tip").innerHTML=e,a.querySelector(".tip").innerHTML=e}n[d].map((([n,e])=>{fn.add([cn,n,b,o*e])}))})),s.addEventListener("change",(()=>{const t=n[c]??0,a=+s.value-t;fn.add([pn,e,c,a]),fn.add([pn,p,c,-a])}))),tskInpG.appendChild(a)}function ie(e,t){return e[d].map((([e,a])=>`\n      <div>\n        <span>${H[e][k]}</span>\n        <span>\n          ${a>0?"+":0===t?"-":""}${t*a} per ${n/60}s\n        </span>\n      </div>`)).join("")}function le(n,e){e.setAttribute("max",Math.min(fn.get([pn,p,c],0)+(n[c]??0),n[A]??0))}x.push(["Wood","🪵",100,,1],["Stone","🪨",100,[[1,1,wn,1]]],["Corpses","⚰️",2,[[1,2,wn,1]]],["Mana","✨",25,[[1,3,wn,1]],0,5],["skeletons","Skeletons",0,[[2,0,8,1]]],["Planks",'<img width=20 height=20 src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAC6V+0/AAAA1VBMVEUAAABfRC9mSTN6WD53VjxvUThMNyZnSzVGMyN4VjxhRjFQOiddQy5NNyZNNyVQOShpTDVINSRZQCxGMyNkSTRbQS11VDpqTjZxUjiBXUFUPClUPClZQCxsTzZfRDBMNyVzUzloTDZxUjl5Vz6DX0FYPytwUThGMyNlSTRKNiV1VDpqTjZ7WT55Vz6LZUZxUjhmSjVdQy92VTuDYENhRzJfRDFbQS1pTTZnSzVXPipjSDNdQy9ZQCxlSTRSOihzUzlwUThrTzZOOCZVPCluUDdMNiVINSQdqybDAAAANHRSTlMABhgQ/vvz4NfWv6x9Y0o0KyIL+vn59vLo5ubl187GwLesqZ6WlpKQhXh0aGRZUE1COTYjpoa/KQAAAMhJREFUGNNdkFcWgjAQRVHsghR7770rPZEu+1+SCXgYdP5yz7vJmzCZydVqnJBjfmenqBoe1Hkpw24tBWmm7UcVYPmypSJs2u9mA+D8RWwz8KMtsKNOIQlW5JSJXcNSEA78kpAyeawbFg36e5A3HrERuXEKPa/Fb7AkQZteSIK0Dw/rzVyPBnFQB/nguEmfYT5ljw4NEhvDKmzVCfXYXkObpeN6sT1iU3YuEGiQt9t3CPYLiY04Boa9rKpFQ1En/1/+PC3KYub8AcxzI3LKXt/zAAAAAElFTkSuQmCC"/>',25,[[2,2,8,1]]],["Research","📜",,[[2,3,8,1]]],["Blocks",'<img width=20 height=20 src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAC6V+0/AAABC1BMVEUAAABQUFBVVVVaWlpfX19ycnJLS0t3d3dCQkJoaGhtbW09PT1HR0dkZGR8fHxOTk5kZGR8fHw4ODhubm5HR0dVVVVnZ2dhYWF6enpjY2NXV1dbW1s4ODhHR0dCQkJHR0c9PT1oaGg2NjZHR0dtbW1ubm4/Pz9/f388PDxlZWU6Ojo9PT1MTEw9PT1CQkJjY2M0NDRtbW1fX193d3dfX19DQ0OAgIA+Pj5ycnJjY2N8fHxMTExsbGx3d3djY2OAgIBpaWlxcXFnZ2c0NDR7e3t7e3s5OTlISEhaWlpzc3M4ODgzMzNLS0tHR0d7e3tkZGQ1NTVwcHBNTU1kZGRERERISEg1NTVubm5ERETvjnbTAAAAWXRSTlMA4NvX0r/luu7IxPPqzbUtKRz4JGJYU0MvLQ4H8ebk2NewqaNsY1FGQDYK69XOycXCt7a0s7Kxr6ynpqGgnZ2VkIqFgn57e3Z1cm1kW1NOSkVAQD8nJR4YE1wr3S4AAADRSURBVBjTfckFc8JAEAXgV0tLuDQhLlCKS93dBXf9/7+EC3dkwjDwzey83bfYKIYV9se9XSgsPWK/h8zzX5s/vNzNfsibX/ce98Jq9pcG18leidyrNtGyoqhBiXyXzFRkLvWZM2koUCRJerccSxmYndKTdEFPWu4uXFssbz04OwGDRRWQtwMGTxnyVsDgSUuBeum7+qnQFBhaEkKSCZLU3Uork0kQaoTp0QFznofu73dDAMWHk+hZ1HfsTx5csZyOq6paV+P/ZYR43Z/LRnqM9WYTABfQPE+RQQAAAABJRU5ErkJggg=="/>',25,[[2,5,8,1]]],["Charcoal",'<img width=20 height=20 src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAC6V+0/AAAAY1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABmaHTeAAAAIHRSTlMA+w4Hr4nw7MJ4ajs19tDHloJTSi4eF+Xh1bSfcGFXREQlbggAAAB+SURBVBjTtY9HDoMwEEXHuJdQA+nJv/8pI9sgjFgi3mI0eppKZ/Lje9fhIcVro4YnIqwqnMNMN4RxkT1Wbnn2JFDikgzYcE+l18JcgCZt84DRAET7sQxQbyIuGaCtrIHW5sMC0dfEhOVuHaNJQ/1Ik1RQjee9qF3xQjXnx/kDVJoPEo9nyBsAAAAASUVORK5CYII="/>',50,[[2,6,8,1]]],["Iron ore",'<img width=20 height=20 src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAC6V+0/AAABO1BMVEUAAABVcGhJZl1rhX4zUEd0jodGYlo6V052kIljf3ZyjYVXc2tXcmpceG9yjIV9l5B1j4heenJ5k4xSbmZ8lY6Ko5xlgHiOp6BXc2tAXVRVcWh/mJE2U0p8lo92kIlYc2tshn82U0p3kYlLZ19/mZF0jodQbGMqSD9OamEmRDp7lY5mgXk5Vk1jfnZYdGuLo5xkfndzjYaKo5wrSD9HZFs+W1I2U0qOp6BRbWVge3NGYlqSqqRkf3eDnJVwioJVcGguTEJIZFuFnpd5kotfenJbdm5/mZE2U0pbdm6Npp9rhX5uiIBEYFdbd298lo99lo9ZdWxfenJDX1YiQDdOamGJoptjfXVqhX1SbmU/W1JOamJ7lI1wioJuiIFog3phfHRJZV1FYVhDX1c5V01mgXlkf3dMaF9/mZJceG/+v/fDAAAAV3RSTlMA/u9jKP779vDr3aeYgnl2YV9VPisTB/37+vj06efm4NTT0tHQ0NDOzc3JwsLBvr23srGrpaGcmJSSioaGhYBxcGxraGhoZFxaV1VQSklIOTk4LS0dGg9l5XaaAAAAzUlEQVQY02MgB5hbo4uI+IkaiYuiCapGS9vqe6KKMcewRqc7haIKaofHcGipIIuI2XMLpoTHCPC7IQkqRzAGcKaE28lF8yMETdIiuHnjOb34lITE4II+bGkWPBnxcQp8HLIicNEgx5AICV7duFguZ3+4oGmSlUYET6ANMzOXAFxQJzKJKSpC3tcgLpZVCCbIwh6ZlBDFqGeZGh5rCFfqnhyZCBT1iE8N94YLspiBRYVdXcIQLlV3UASKMqlJCSLEgjWNWWTYJdmYhPEENwD8bCNnidwV9QAAAABJRU5ErkJggg=="/>',50,[[2,7,8,1]]],["Iron",'<img width=20 height=20 src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAC6V+0/AAABXFBMVEUAAABQbWR4k4tbdm5CX1YsSUBTb2cyUEdifXVuiIFYc2uFn5c4VUw5Vk0sSkE/XFMoRjx0joY8WVBwi4OOp6CTq6QtSkErSD5NaWGUraZshn8sSkGLpJ2Wr6gpRz5jfnZGYlmRqqM5Vk0nRTuDnJVqhH17lI1HY1uOp6BJZVx0jodRbWR9lo9BXlVTb2ZGYlllgHg5Vk2Sq6RzjoYqRz5CX1Y/XFNifXUvTUOVraZyjYVIZFsxTkUsSUCXr6g1UkmZsauKo5w+W1KEnpaMpZ5deHBNaWB+l5A/XFOXsKklQzmRqqNbdm50joc3VEtqhHxYc2the3RSbmUuS0IqRz6Bm5N8l49qhXxdeHCRqqONpp9vioJLZ1+HoJmFnpd2kYp0j4dyjIVmgXlkgHdge3NXc2pWcWlSbmZPamJHY1s7WE8xTkWVrqeKo5yIoZp6k4xth4BjfXVhfHREYFeC0x4tAAAAVXRSTlMANP7+5cvHw7mvmZKSinFoZDYrIBUMCAT38e/r5+Xi39/V1dLOzcrHxMC/u7qzsrGtp6SkoaCZl5aRj42LhXpnZWVhX1lQUEdHREI+PTk4Ly4pHA8Oo3Yj3wAAANhJREFUGNNjoB5wUbQUQRNyV4mNipS0E0USEtRiCguNy42KlHWACQUahEcnxgNF86IiczzBQkFcESnJ4QWJCflhobEy3kYgMWuJ9DTmiMKk8OgEoBHODBpAYz1YMmMy0lIjipLDOa3i1RgYuB0ZGAyFdBViMtJTmTnkhaWifQV1uEUYgtl5ePmLM2O0GblczZNUOY2FgSYKSNvYZ2WZ6jMw6gVEpHD4g632UjbJzuYVMmPQZGRj84G5UVxAjlXcj4efRd0N2YNifKwW7EpO6EERYssnRr2ABQASwSfinWYMXwAAAABJRU5ErkJggg=="/>',25,[[2,8,8,1]]],["Tools","🔨",20,[[2,9,8,1]]],["Weapons","⚔️",10,[[2,10,8,1]]],["Armor","🛡️",10,[[2,11,8,1]]],["Bows","🏹",10,[[2,12,8,1]]],["Militia","💀",,[[1,5,wn,1]]],["Infantry","🎚️",,[[1,7,wn,1]]],["Archers","𓀎",,[[1,6,wn,1]]],["Cavalry","🐴",,[[1,8,wn,1]]]),Bn.push(["Chop Wood","Chop wood from a tree",5,[[y,20]]],["Gather Stones","Gather stones from the ground",5,[[w,15]],[[1,0,Cn,2]]],["Steal Corpse","Sneak into a graveyard and snatch a corpse for reanimating as a Skeleton",6.666666666666667,[[C,1]],[[1,1,Cn,2]]],["Reanimate Skeleton","Reanimate a corpse as a Skeleton to perform various tasks",10,[[V,1]],[[2,0,8,1]],[[R,5],[C,1]]],["Recover Mana","Meditate on your evil acts",20,[[R,10]],[[1,3,Cn,1]]],["Reanimate Militia","Reanimate a group of corpses to fight for you as unarmed Militia.<br/><br/>Militia are cheap but weak vs Infantry, Archers, and Cavalry",10,[[Q,10]],[[2,3,8,1]],[[R,50],[C,10]],30],["Reanimate Archers","Reanimate a group of corpses to fight for you as Archers.<br/><br/>Archers are strong vs Infantry",10,[[Z,6]],[[2,3,8,1]],[[R,100],[C,6],[G,6]],150],["Reanimate Infantry","Reanimate a group of corpses to fight for you as armed Infantry.<br/><br/>Infantry are strong vs Cavalry",10,[[W,5]],[[2,3,8,1]],[[R,175],[C,5],[U,5],[N,5]],300],["Reanimate Cavalry","Reanimate a group of corpses to fight for you as Cavalry.<br/><br/>Cavalry are strong vs Archers",10,[[j,4]],[[2,3,8,1]],[[R,250],[C,8],[U,4],[N,8]],450]),Bn[0][wn]=1,m.push(["Ritual Circle","Allows reanimating Skeletons and increases max Skeletons by 4",[[y,50],[w,25]],[[cn,V,v,4]],[[cn,C,S,1]]],["Woodcutters Camp",`Allows 3 Skeletons to gather <span>${H[y][k]}</span>`,[[y,25]],[[pn,1,A,3]],[[cn,V,S,1]]],["Lumber Mill",`Allows 3 Skeletons to craft <span>${H[M][k]}</span> from <span>${H[y][k]}</span>`,[[y,100],[w,10]],[[pn,2,A,3]],[[2,1,8,1]]],["Laboratory",`Allows 1 Skeleton to generate <span>${H[T][k]}</span>`,[[w,50],[M,25]],[[pn,3,A,1]],[[2,2,8,1]]],["Quarry",`Allows 5 Skeletons to gather <span>${H[w][k]}</span>`,[[y,50]],[[pn,4,A,5]],[[2,3,8,1]],25],["Masons Workshop",`Allows 2 Skeletons to craft <span>${H[E][k]}</span> from <span>${H[w][k]}</span>`,[[y,50]],[[pn,5,A,2]],[[2,3,8,1]],40],["Burners Camp",`Allows 3 Skeletons to craft <span>${H[$][k]}</span> from <span>${H[y][k]}</span>`,[[y,25]],[[pn,6,A,3]],[[2,3,8,1]],60],["Mine",`Allows 5 Skeletons to gather <span>${H[B][k]}</span>`,[[w,25],[M,50]],[[pn,7,A,5]],[[2,3,8,1]],80],["Furnace",`Allows 2 Skeletons to craft <span>${H[I][k]}</span> from <span>${H[B][k]}</span> and <span>${H[$][k]}</span>`,[[y,25],[E,75]],[[pn,8,A,2]],[[2,3,8,1]],125],["Smithy",`Allows 2 Skeletons to craft <span>${H[Y][k]}</span> from <span>${H[I][k]}</span> and <span>${H[$][k]}</span>`,[[M,100],[E,80]],[[pn,9,A,2]],[[2,3,8,1]],150],["Weapons Workshop",`Allows 2 Skeletons to craft <span>${H[U][k]}</span> from <span>${H[I][k]}</span> and <span>${H[$][k]}</span>`,[[M,120],[I,50],[Y,20]],[[pn,10,A,2]],[[2,3,8,1]],250],["Armorers Workshop",`Allows 2 Skeletons to craft <span>${H[N][k]}</span> from <span>${H[I][k]}</span> and <span>${H[$][k]}</span>`,[[M,120],[I,50],[Y,20]],[[pn,11,A,2]],[[2,3,8,1]],250],["Bowyers Workshop",`Allows 2 Skeletons to craft <span>${H[G][k]}</span> from <span>${H[y][k]}</span> and <span>${H[M][k]}</span>`,[[M,200],[Y,40]],[[pn,12,A,2]],[[2,3,8,1]],300],["Alchemy Lab",`Allows 4 Skeletons to generate greater amounts of <span>${H[T][k]}</span>`,[[M,125],[I,75],[Y,35]],[[pn,13,A,4]],[[2,3,8,1]],400],["Outpost",`Allows 2 Skeletons to gather <span>${H[C][k]}</span>`,[[M,75],[E,100]],[[pn,14,A,2]],[[2,3,8,1]],100],["Mana Pillar",`Allows 3 Skeletons to gather <span>${H[R][k]}</span> and increases max <span>${H[R][k]}</span> by 25`,[[w,100],[I,25]],[[cn,R,v,25],[pn,15,A,3]],[[2,3,8,1]],40],["Morgue",`Increases max <span>${H[C][k]}</span> by 3`,[[y,150],[w,150]],[[cn,C,v,3]],[[2,3,8,1]],25],["Warehouse","Increases max Wood, Stone, and Iron products by 50",[[y,60],[M,25],[E,25]],[[cn,y,v,50],[cn,M,v,50],[cn,w,v,50],[cn,E,v,50],[cn,$,v,50],[cn,B,v,50],[cn,I,v,50]],[[2,3,8,1]],30],["Armory","Increases max Tools, Weapons, and Bows by 10",[[M,25],[E,75],[I,50]],[[cn,Y,v,10],[cn,U,v,10],[cn,G,v,10]],[[2,3,8,1]],50],["Necropolis","The ultimate Necromancer structure. Build to reign supreme and win the game",[[M,1e3],[w,1500],[I,500]],[["win-game"]],[[2,3,8,1]],2e3]),u.push(["Idle",[],[[2,0,8,1]]],["Woodcutters",[[y,1]],[[2,1,8,1]]],["Carpenters",[[y,-1],[M,1]],[[2,2,8,1]]],["Researchers",[[T,1]],[[2,3,8,1]]],["Quarriers",[[w,1]],[[2,4,8,1]]],["Masons",[[w,-1],[E,1]],[[2,5,8,1]]],["Burners",[[y,-1],[$,2]],[[2,6,8,1]]],["Miners",[[B,1]],[[2,7,8,1]]],["Smelters",[[$,-1],[B,-2],[I,1]],[[2,8,8,1]]],["Blacksmiths",[[I,-1],[$,-1],[Y,1]],[[2,9,8,1]]],["Weaponsmiths",[[I,-1],[$,-1],[U,1]],[[2,10,8,1]]],["Armorsmiths",[[I,-1],[$,-1],[N,1]],[[2,11,8,1]]],["Bowyers",[[y,-2],[M,-1],[G,1]],[[2,12,8,1]]],["Alchemists",[[T,10]],[[2,13,8,1]]],["Snatchers",[[C,.5]],[[2,14,8,1]]],["Channelers",[[R,3]],[[2,15,8,1]]]),K.push(["Militia","Unarmed and unarmored Skeletons. Weak vs everything.",40,0,5,[],22,1],["Archers","Skeletons with Bows. Good vs Infantry.",75,14,9,[.25,.75],11,2],["Infantry","Armed and armored Skeletons. Good vs Cavalry.",100,25,15,[.25,,,.5],6,4],["Cavalry","Skeletons on horses. Good vs Archers.",150,40,25,[.25,,.5],4,8]),dn.push(["Hamlet","",10,[y,w,C],[25,50],1,[D,O]],["Village","",13.333333333333334,[M,E,C],[25,75],2,[D,O,q]],["Iron Mine","",20,[$,B,C],[50,100],4,[O,q]],["City","",40,[I,Y,C],[75,125],8,[O,q,z]]),(()=>{const n=[H,In,f,h,P,_,An];mn._state=mn.load(n),ln.seed(n[hn][0][2])})(),(()=>{fn.get([cn]).map(Yn),fn.get([1]).map(te),fn.get([2]).map(Pn),fn.get([pn]).map(re);const n=fn.get([hn,0,5]);n?.length&&(atkArmy.innerHTML=on(n)),r([hn,0,3],(n=>{if(atk.hidden=0>n,0>n)return;const e=n/60|0,t=n-60*e|0;atkTimer.innerHTML=`${e}:${(""+t).padStart(2,0)}`})),r([hn,0,5],(n=>{atkArmy.innerHTML=on(n)}))})(),Dn.start(),r([2,19,8],(()=>{const n=new On;n.head.innerHTML='<b class="win">You Win!</b>',n.open()}))})()</script></body></html>