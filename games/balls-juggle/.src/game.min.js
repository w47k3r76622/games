function init(){canvas=document.createElement("canvas"),context=canvas.getContext("2d"),canvasW=canvas.width=640,canvasH=canvas.height=960,canvasCX=canvasW/2,canvasCY=canvasH/2,canvas.style.width="320px",canvas.style.height="480px",canvas.style.background=game.background,spike.count=canvasW/spike.width-1,document.body.appendChild(canvas),ballPositionSpawn(),canvas.addEventListener("mousedown",function(a){cursorData=getCursorPosition(this,a),updateGameState(),handleJuggle(cursorData)}),game.state="ready",animate()}function animate(){var a=Date.now(),e=a-lastUpdate;lastUpdate=a,render(e),requestAnimationFrame(animate)}function render(a){renderClear(),scoreBoardRender(),drawSpikes(a),drawBall(a),game.ballHit&&game.tries>0&&game.tries<game.triesInitial&&popupRender("hit"),"ready"==game.state&&popupRender("start"),"over"==game.state&&popupRender("restart")}function gameReset(){setDayNight("day"),ballPositionSpawn(),triesReset(),jugglesReset(),highscoreReset(),game.scoreRight=0,game.scoreLeft=0}function setSpikeInterval(){spikeInterval=setInterval(function(){game.emittActive&&(game.emittSpike=!0,spike.falling=!0)},spike.tick)}function handleJuggle(a){if(ballData.posX-ballData.radius<a.x&&ballData.posX+ballData.radius>a.x&&ballData.posY-ballData.radius<a.y&&ballData.posY+ballData.radius>a.y){jugglesIncrement(),game.floorTouched=!1;var e=getTouchPoint(a);e.x<0?(ballData.velX=0,ballData.velX+=-(.1*e.x)):e.x>0?(ballData.velX=0,ballData.velX+=-(.1*e.x)):ballData.velX=0,ballData.velY-=game.gravity+20}}function updateGameState(){"ready"==game.state&&(game.state="first_half",setSpikeInterval(),game.emittActive=!0),"halftime"==game.state&&(game.state="second_half",setSpikeInterval(),game.ballHit=!1,game.emittActive=!0),"over"==game.state&&(gameReset(),game.state="ready",game.emittActive=!1)}function ball(a,e,t,l){context.fillStyle=l,context.beginPath(),context.arc(a,e,t,0,2*Math.PI,!0),context.closePath(),context.fill()}function drawBall(a){ballData.velX<0?(ballData.velX+=.1*game.friction*a,ballData.velX>-ballData.stopPointTreshold&&(ballData.velX=0)):ballData.velX>0?(ballData.velX-=.1*game.friction*a,ballData.velX<ballData.stopPointTreshold&&(ballData.velX=0)):ballData.velX=0,ballData.posX-ballData.radius<0?ballData.velX=-ballData.velX:ballData.posX+ballData.radius>canvasW&&(ballData.velX=-ballData.velX),ballData.posX+=ballData.velX,ballData.posY-ballData.radius<game.ceiling&&(ballData.velY=-ballData.velY,ballHitStateUpdate()),ballData.velY<ballData.velMax&&(ballData.velY+=game.gravity),ballData.posY+ballData.velY+ballData.radius<canvasH?ballData.posY+=ballData.velY+.1*a:(jugglesReset(),game.floorTouched||(game.floorTouched=!0,ballHitStateUpdate()),ballData.posY=canvasH-ballData.radius,ballData.velY*=-ballData.bounceFactor),ball(ballData.posX,ballData.posY,ballData.radius,ballData.color)}function ballHitStateUpdate(){("first_half"==game.state||"second_half"==game.state)&&(game.ballHit=!0,ballWasHit(),"first_half"==game.state?game.state="halftime":"second_half"==game.state&&(game.state="over"))}function ballWasHit(){triesDecrement(),spike.falling=!1,game.emittActive=!1,clearInterval(spikeInterval),spike.velY=0,spike.posYFalling=spike.posYStart}function drawSpikes(a){!spike.falling||"first_half"!=game.state&&"second_half"!=game.state||(spike.velY+=game.gravity/spike.speedModifier*.1*a),!game.emittSpike||"first_half"!=game.state&&"second_half"!=game.state||(game.emittSpike=!1,spike.falling=!0,spike.randomNum=Math.floor(ballData.posX/spike.width));for(var e=0;e<=spike.count;e++)if(e!=spike.randomNum)spikeDrawStatic(e,spike.color);else{var t=ballData.radius,l=spike.posXFalling,o=spike.posYFalling;o<canvasH-spike.height&&(l<ballData.posX-t||l>ballData.posX+t||o<ballData.posY-t||o>ballData.posY+t)?spike.posYFalling="first_half"==game.state||"second_half"==game.state?o+spike.velY:spike.posYStart:(("first_half"==game.state||"second_half"==game.state)&&o>ballData.posY-t&&o<ballData.posY+t&&o<canvasH-spike.height&&(game.ballHit=!0,jugglesReset(),ballWasHit(),"first_half"==game.state?game.state="halftime":"second_half"==game.state&&(game.state="over")),spike.posYFalling=spike.posYStart,spike.velY=0,spike.falling=!1),spikeDrawFalling(e,spike.posYFalling,spike.color)}}function ballPositionSpawn(){ballData.velX=0,ballData.velY=0,ballData.posX=canvasCX,ballData.posY=canvasH-ballData.radius}function bounce(){ballData.posY=canvasH-ballData.radius,ballData.velY*=-ballData.bounceFactor}function jugglesRender(){context.font="20px Sans-Serif",context.fillStyle=game.scoreBoard.color,context.textAlign="left",context.fillText("JUGGLES: "+game.juggles,10,25)}function jugglesIncrement(){game.juggles+=1,game.firstTry?game.scoreRight+=1:game.scoreLeft+=1}function jugglesReset(){game.juggles>game.highscore&&(game.highscore=game.juggles),game.juggles>game.highscoreEver&&(game.highscoreEver=game.juggles),game.juggles=0}function triesRender(){context.font="20px Sans-Serif",context.textAlign="right",context.fillStyle=game.scoreBoard.color;var a=1!=game.tries?"RIGHT BALL":"LEFT BALL";context.fillText(a,canvasW-10,25)}function triesDecrement(){game.tries>1?game.tries-=1:game.tries=0}function triesReset(){game.tries=game.triesInitial}function highscoreRender(){context.font="20px Sans-Serif",context.textAlign="center",context.fillStyle=game.scoreBoard.color,context.fillText("BEST: "+game.highscoreEver,canvasCX,25)}function highscoreReset(){game.highscore=0}function scoreBoardRender(){context.fillStyle=game.scoreBoard.background,context.fillRect(0,0,canvasW,40),jugglesRender(),triesRender(),highscoreRender()}function popupRender(a){switch(a){case"start":popupDrawStart();break;case"restart":popupDrawRestart();break;case"hit":popupDrawNextTry()}}function popupDrawStart(){setDayNight("day"),context.fillStyle=game.dayColor,context.fillRect(0,0,canvasW,canvasH),context.font="bold 52px Sans-Serif",context.fillStyle=game.nightColor,context.textAlign="center",context.fillText("BALLS JUGGLE!",canvasCX,canvasCY-120),context.font="bold 20px Sans-Serif",context.fillText("FIND YOUR LUCKY BALL!",canvasCX,canvasCY-80),context.fillText("CLICK TO START",canvasCX,canvasCY+250)}function popupDrawRestart(){game.scoreLeft>game.scoreRight?game.luckyBall="LEFT IS YOUR LUCKY BALL!":game.scoreLeft===game.scoreRight&&(game.luckyBall="YOUR BALLS ARE EQUALLY LUCKY."),context.fillStyle=game.nightColor,context.fillRect(0,0,canvasW,canvasH),context.font="20px Sans-Serif",context.fillStyle=game.dayColor,context.textAlign="center",context.fillText("YOUR LUCKY BALL DID",canvasCX,canvasCY-120),context.font="bold 36px Sans-Serif";var a=1===game.highscore?"":"S";context.fillText(game.highscore+" JUGGLE"+a+"!",canvasCX,canvasCY-80),context.font="32px Sans-Serif",context.fillText(game.luckyBall,canvasCX,canvasCY),context.font="20px Sans-Serif",context.fillText("GAME IS OVER.",canvasCX,canvasCY+100),context.fillText("CLICK TO RETRY.",canvasCX,canvasCY+140),game.firstTry=!0,game.luckyBall="RIGHT IS YOUR LUCKY BALL!"}function popupDrawNextTry(){game.firstTry=!1,setDayNight("night"),context.font="24px Sans-Serif",context.fillStyle=game.dayColor,context.textAlign="center",context.fillText("OUCH! LOST RIGHT BALL.",canvasCX,250),context.fillText("TIME FOR LEFT BALL.",canvasCX,280),context.fillText("KEEP CLICKING YOUR BALL!!!",canvasCX,310)}function setDayNight(a){"night"==a?(document.body.style.background=game.nightColor,document.getElementsByTagName("canvas")[0].style.borderColor=game.dayColor,game.scoreBoard.color=game.nightColor,game.scoreBoard.background=game.dayColor,ballData.color=game.dayColor,spike.color=game.dayColor):(document.body.style.background=game.dayColor,document.getElementsByTagName("canvas")[0].style.borderColor=game.nightColor,game.scoreBoard.color=game.dayColor,game.scoreBoard.background=game.nightColor,ballData.color=game.nightColor,spike.color=game.nightColor)}function spikeDrawStatic(a,e){context.fillStyle=e,context.beginPath(),context.moveTo(0+spike.width*a,40),context.lineTo(20+spike.width*a,60),context.lineTo(40+spike.width*a,40),context.fill()}function spikeDrawFalling(a,e,t){spike.posXFalling=20+spike.width*a,context.fillStyle=t,context.beginPath(),context.moveTo(0+spike.width*a,40+spike.posYFalling),context.lineTo(20+spike.width*a,60+spike.posYFalling),context.lineTo(40+spike.width*a,40+spike.posYFalling),context.fill()}function getCursorPosition(a,e){var t=a.getBoundingClientRect(),l=2*(e.pageX-t.left),o=2*(e.pageY-t.top);return{x:l,y:o}}function getTouchPoint(a){var e=Math.floor(-(ballData.posX-a.x)),t=Math.floor(-(ballData.posY-a.y));return{x:e,y:t}}function getRandomInt(a,e){return Math.floor(Math.random()*(e-a+1))+a}function renderClear(){context.clearRect(0,0,canvasW,canvasH)}!function(){for(var a=0,e=["ms","moz","webkit","o"],t=0;t<e.length&&!window.requestAnimationFrame;++t)window.requestAnimationFrame=window[e[t]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[t]+"CancelAnimationFrame"]||window[e[t]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var t=(new Date).getTime(),l=Math.max(0,16-(t-a)),o=window.setTimeout(function(){e(t+l)},l);return a=t+l,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}();var canvas,context,canvasW,canvasH,canvasCX,canvasCY,cursorData,lastUpdate=Date.now(),spikeInterval=0,game={state:"loading",background:"transparent",dayColor:"white",nightColor:"black",gravity:.4,friction:.01,juggles:0,scoreRight:0,scoreLeft:0,highscore:0,highscoreEver:0,triesInitial:2,tries:2,firstTry:!0,floorTouched:!1,ballHit:!1,emittActive:!1,emittSpike:!1,scoreBoard:{color:"white",background:"black"},popup:{color:"white",background:"black"},luckyBall:"RIGHT IS YOUR LUCKY BALL.",ceiling:80},spike={color:game.nightColor,width:40,height:20,count:0,randomNum:4,posYStart:0,posYFalling:0,falling:!1,speedModifier:5,tick:3300},ballData={posX:0,posY:0,velX:0,velY:0,velMin:0,velMax:20,stopPointTreshold:.1,bounceFactor:.5,radius:60,color:game.nightColor};