(()=>{var t={538:t=>{t.exports={},t.exports.pick=(...e)=>e[t.exports.int(0,e.length-1)],t.exports.int=(t,e)=>Math.floor(Math.random()*(e+1-t)+t)}},e={};function i(s){var a=e[s];if(void 0!==a)return a.exports;var n=e[s]={exports:{}};return t[s](n,n.exports,i),n.exports}i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";var t={};i.r(t),i.d(t,{annoying:()=>b,boastful:()=>d,boring:()=>a,clumsy:()=>f,gossip:()=>l,humble:()=>c,hyperactive:()=>n,impatient:()=>u,organised:()=>w,patient:()=>p,playful:()=>h,serious:()=>o,smart:()=>r});var e=i(538);class s{constructor(t,e){this.name=t,this.mood=e,this.likedTraits=[],this.dislikedTraits=[],this.incompatibileTraits=[]}addLikes(...t){this.likedTraits.push(...t)}addDislikes(...t){this.dislikedTraits.push(...t)}addIncompatibles(...t){this.incompatibileTraits=t}likes(t){return!!this.likedTraits.find((e=>e===t))}dislikes(t){return!!this.dislikedTraits.find((e=>e===t))}incompatibleWith(t){return this.incompatibileTraits.includes(t)}}const a=new s("Boring","neutral"),n=new s("Hyperactive","talkative"),h=new s("Playful","positive"),o=new s("Serious","negative"),l=new s("Gossip","talkative"),r=new s("Smart",(0,e.pick)("positive","neutral")),c=new s("Humble","neutral"),d=new s("Boastful","talkative"),p=new s("Patient","positive"),u=new s("Impatient","negative"),f=new s("Clumsy",(0,e.pick)("positive","neutral")),w=new s("Organised","neutral"),b=new s("Annoying","talkative");a.addDislikes(n,h),a.addLikes(o,a,c,w),a.addIncompatibles(n,h,r,l,d,f),n.addDislikes(o,b),n.addLikes(h,d),n.addIncompatibles(a,c),h.addDislikes(a,b),h.addLikes(h,p,r,l),h.addIncompatibles(o),o.addDislikes(h,d,l,f,b),o.addLikes(r,w),o.addIncompatibles(h,l),l.addDislikes(a,b),l.addLikes(l,d),l.addIncompatibles(r,u),r.addDislikes(a,l,d,b),r.addLikes(r,c),r.addIncompatibles(l,a),c.addDislikes(d,l,b),c.addLikes(c,f),c.addIncompatibles(d,l),d.addDislikes(d,n,b),d.addLikes(c,p),d.addIncompatibles(c,a),p.addLikes(r,c),p.addIncompatibles(u,n),u.addDislikes(u,n,h,l,d,f,b),u.addLikes(c,a,o),u.addIncompatibles(p,l),f.addDislikes(w,u,b),f.addLikes(p),f.addIncompatibles(w),w.addDislikes(f,n,b),w.addLikes(w,o,r),w.addIncompatibles(f),b.addDislikes(b),b.addLikes(p);const m={"#fce3c2":["#313131","#bdbdbd","#adb4b5","#2c1b00","#000000","#c17700","#d84100","#5e0000"],"#f8be73":["#313131","#bdbdbd","#adb4b5","#2c1b00","#000000","#c17700","#d84100","#5e0000"],"#dd820b":["#313131","#bdbdbd","#adb4b5","#2c1b00","#000000","#ffb595","#d84100","#5e0000"],"#7b4806":["#313131","#bdbdbd","#adb4b5","#2c1b00","#000000","#c17700","#d84100","#5e0000"],"#4f2e04":["#313131","#bdbdbd","#adb4b5","#2c1b00","#000000","#c17700","#d84100","#ffc56a","#5e0000"],"#f8cf7d":["#313131","#bdbdbd","#adb4b5","#2c1b00","#000000","#c17700","#ffb595","#d84100","#5e0000"],"#fbbea7":["#313131","#bdbdbd","#adb4b5","#2c1b00","#000000","#c17700","#d84100","#ffc56a","#5e0000"],"#f89f7d":["#313131","#bdbdbd","#adb4b5","#2c1b00","#000000","#c17700","#d84100","#ffc56a","#5e0000"],"#9e4828":["#313131","#bdbdbd","#adb4b5","#2c1b00","#000000","#c17700","#ffb595","#d84100","#ffc56a","#5e0000"]},g={"#24682c":["#d4ffd4","#102e13","#2b2b2b","#868ca0"],"#51bad2":["#d4f1ff","#002f46","#2b2b2b","#868ca0"],"#800102":["#ffd4d4","#4d0101","#2b2b2b","#868ca0"],"#c70203":["#fe9192","#6f0001","#2b2b2b","#868ca0"],"#ea87b0":["#f5c4d8","#5e1031","#2b2b2b","#868ca0"],"#c30165":["#ffafd9","#4d0028","#2b2b2b","#868ca0"],"#760086":["#dbaaff","#4d1a45","#2b2b2b","#868ca0"],"#ffdd1f":["#ffeb7c","#b29700","#2b2b2b","#868ca0"],"#636edd":["#aab0ed","#0f1444","#2b2b2b","#868ca0"]},y={male:["#e5bc89","#d4903b"],female:[...Object.keys(g),"#15002b"]},v={male:{neutral:["M 95,180 h 15 c 0,-3 -2,-5 -5,-5 H 90 c 0,3 2,5 5,5 z"],positive:["M 105,175 c -1,-1 -4,-1 -8,0 -4,1 -4,-2 -7,-5 1,5 2,6 3,7 2,2 4,3 7,3 5,0 7,-3 5,-5 z"],negative:["M 95,180 c 1,1 4,1 8,0 4,-1 4,2 7,5 -1,-5 -2,-6 -3,-7 -2,-2 -4,-3 -7,-3 -5,0 -7,3 -5,5 z"],talkative:["M 90,180 c 3,2 17,2 20,0 3,-2 1,-4 0,-5 -5,-4 -15,-4 -20,0 -1,1 -3,3 0,5 z"]},female:{neutral:["M 96,172 c -1,0 -4,2 -6,4 2,2 4,4 6,5 2,1 6,1 8,0 2,-1 4,-3 6,-5 -2,-2 -5,-4 -6,-4 -1,0 -2,0 -3,1 -1,1 -1,1 -2,0 -1,-1 -2,-1 -3,-1 z","M 103,169 c -2,0 -2,1 -3,1 -1,0 -1,-1 -3,-1 -4,0 -6,7 -8,7 0,0 2,4 5,4 4,0 4,-4 7,-4 h -6 c 2,-1 2,-1 3,-2 0,0 1,1 2,1 1,0 2,-1 2,-1 1,1 1,1 3,2 h -4 c 2,0 3,2 6,2 4,0 4,-2 4,-2 -2,0 -4,-7 -8,-7 z"],positive:["M 96,172 c -3,0 -4,4 -7,3 2,2 5,4 7,5 2,1 6,1 8,0 2,-1 7,-2 8,-10 -3,8 -5,2 -8,2 -1,0 -2,0 -3,1 -1,1 -1,1 -2,0 -1,-1 -2,-1 -3,-1 z"],negative:["M 98,180 c 6,1 10,0 12,-1 -1,0 -3,-3 -3,-3 -2,-3 -5,-2 -7,1 -1,-3 -4,-4 -7,-1 -3,3 -3,5 -3,9 0,0 3,-6 8,-5 z"],talkative:["M 106,171 c -1,-2 -4,-3 -6,-1 -2,-2 -5,-1 -6,1 -1,2 -2,6 -6,7 3,1 4,4 5,6 2,4 12,4 14,0 1,-2 2,-5 5,-6 -4,-1 -5,-5 -6,-7 z m -6,10 c 0,-1 -3,-3 -4,-3 2,-1 4,-2 4,-3 0,1 2,2 4,3 -1,0 -4,2 -4,3 z"]}},x={male:["M 100,95 c 5,5 10,5 10,5 20,10 30,10 35,25 5,10 20,5 15,-5 -5,-20 -20,-65 -45,-65 -5,0 -10,5 -10,5 C 100,50 95,50 90,50 60,50 45,95 40,120 c 0,10 10,15 15,5 10,-15 10,-15 35,-25 0,0 5,0 10,-5 z","M 43,112 c -10,10 -5,20 5,15 10,-5 15,-15 20,-25 5,-5 15,-5 20,0 5,10 15,10 20,5 5,-5 5,-10 10,-10 20,0 10,15 20,25 10,10 25,5 25,-5 C 163,102 153,67 133,57 123,27 88,37 73,47 58,57 38,52 28,37 c 0,20 5,35 20,40 -10,10 -25,15 -35,5 0,15 10,30 30,30 z","M 100,65 c -45,0 -55,30 -55,60 0,5 10,10 10,5 0,-10 5,-20 10,-25 5,15 20,20 35,20 15,0 30,-5 35,-20 5,5 10,15 10,25 0,5 10,0 10,-5 0,-30 -10,-60 -55,-60 z","M 100,105 c 15,15 5,25 15,35 10,10 35,15 45,-5 5,-20 5,-45 -15,-65 C 130,55 110,40 95,55 90,60 90,65 80,60 55,45 10,125 60,155 c -10,-20 5,-40 20,-40 10,0 15,-5 20,-10 z"],female:["M 155,135 V 100 C 155,80 130,65 100,65 70,65 45,80 45,100 v 35 c 25,0 55,-5 55,-30 0,25 30,30 55,30 z","M 155,135 V 100 C 155,80 130,65 100,65 70,65 45,80 45,100 v 35 z","M 100,105 c 15,15 5,25 15,35 10,10 35,15 45,-5 5,-20 5,-45 -15,-65 C 130,55 110,40 95,55 90,60 90,65 80,60 55,45 10,125 60,155 c -10,-20 5,-40 20,-40 10,0 15,-5 20,-10 z"]},T=["M 135,65 C 135,45 115,25 95,25 75,25 60,45 60,65 c 0,20 20,20 45,20 25,0 30,0 30,-20 z"],k=["M 100,185 c 15,0 20,10 30,10 20,0 35,-40 35,-75 C 165,85 150,55 130,55 110,55 110,75 100,75 90,75 90,55 70,55 50,55 35,85 35,120 c 0,35 15,75 35,75 10,0 15,-10 30,-10 z","M 100,185 c 15,0 20,10 30,10 20,0 35,-40 35,-75 0,-35 -15,-30 -35,-30 -20,0 -20,20 -30,20 -10,0 -10,-20 -30,-20 -20,0 -35,-5 -35,30 0,35 15,75 35,75 10,0 15,-10 30,-10 z","M 130,230 c 20,-10 35,-75 35,-110 0,-35 -20,-25 -35,-30 -15,-5 -45,-5 -60,0 -15,5 -35,-5 -35,30 0,35 15,100 35,110 20,10 40,10 60,0 z","M 150,180 c 10,-10 10,-25 0,-35 l -20,-25 c -10,10 -10,25 0,35 -10,10 -10,25 0,35 -10,10 -10,25 0,35 -10,10 -10,25 0,35 l 20,25 c 10,-10 10,-25 0,-35 10,-10 10,-25 0,-35 10,-10 10,-25 0,-35 z"],S={male:["M 20,245 c 0,0 25,65 25,80 5,15 15,20 25,20 h 60 c 10,0 20,-5 25,-20 0,-15 25,-80 25,-80 0,-40 -30,-50 -80,-50 -50,0 -80,5 -80,50 z"],female:["m 150,310 10,-35 c 25,-5 35,-30 30,-55 l -55,-20 c 0,0 -15,5 -35,5 -20,0 -35,-5 -35,-5 l -55,20 c -5,25 5,50 30,55 l 10,35 c 0,45 100,45 100,0 z","M 35,285 c 5,25 11,60 30,60 h 35 35 c 19,0 25,-35 30,-60 15,-10 30,-15 40,-35 0,-35 -10,-40 -35,-55 -10,-5 -40,-5 -40,15 -5,10 -15,0 -15,10 -10,5 -5,0 -15,0 -10,0 -5,5 -15,0 0,-10 -10,0 -15,-10 0,-20 -30,-20 -40,-15 -25,15 -35,20 -35,55 10,20 25,25 40,35 z"]},M="M 130,210 c 0,-15 -5,-15 -30,-15 -25,0 -30,0 -30,15 5,20 25,20 30,40 5,-20 20,-20 30,-40 z",I="M 120,190 c -10,5 -30,5 -40,0 v 6 c 10,5 30,5 40,0 z",P=["M 65,200 c 5,5 5,5 5,10 5,10 10,15 10,25 15,5 10,10 20,10 10,0 5,-5 20,-10 0,-10 5,-15 10,-25 0,-5 0,-5 5,-10 z","M 80,195 h 40 c -10,25 -30,25 -40,0 z","M 65,200 c 25,-10 45,-10 70,0 25,40 -20,5 -35,53 C 85,205 40,240 65,200 Z","M 70,210 c 25,5 35,5 60,0 25,35 -25,10 -30,43 -5,-33 -55,-8 -30,-43 z"],D=(t,i)=>{const s=[];return"female"===t&&(0,e.pick)(!0,!1)&&s.push({path:T,colour:i}),"female"===t&&(0,e.pick)(!0,!0,!1)&&s.push({path:(0,e.pick)(...k),colour:i}),s},C=(t,e)=>e.x<=t.x&&t.x<=e.x+e.width&&e.y<=t.y&&t.y<=e.y+e.height,L=(t,e,i,s,a,n)=>{t.beginPath(),t.arc(e,i,s,0,2*Math.PI),a&&(t[`${n}Style`]=a),t[n]()},E=(t,e,i,s,a,n,h)=>{t.beginPath(),t.arc(e,i,s,h*Math.PI/2,3*h*Math.PI/2),a&&(t[`${n}Style`]=a),t[n]()};let z=null;const B=window.AudioContext||window.webkitAudioContext,A="undefined"!=typeof InstallTrigger,H=(t,e,i,s,a)=>{z||(z=new B);const n=s||.1,h=A?1e3*n:i||1e3*n,o=e||440,l=z.createGain(),r=z.createOscillator();r.connect(l),l.connect(z.destination),l.gain.value=a||1,A?l.gain.setValueCurveAtTime([l.gain.value,l.gain.value/2,l.gain.value/4,l.gain.value/8,1e-5,0],z.currentTime,n):l.gain.exponentialRampToValueAtTime(1e-5,z.currentTime+n),r.type=t||"sine",r.frequency.value=o,r.start(),h&&setTimeout((()=>{r.stop()}),h)},R={male:.85,female:2.2},F={exclamation:{start:[],ending:[125,150,175,1,1],rate:.9},calm:{start:[],ending:[1,1],rate:1.2}},W={"C#":17.32,"D#":19.45,E:20.6,"F#":23.12,"G#":25.96,"A#":29.14,B:30.87};class G{constructor(t,e,i,s,a){this.frequency=t,this.trail=e,this.duration=i,this.octave=s,this.name=a}play(t,e){H(t,this.frequency,this.duration,this.trail,e)}static create=(t,e,i,s)=>new G(W[t]*Math.pow(2,e),i,s,e,t)}class _{constructor(t,e,i,s,a){this.type=e,this.tempo=i||1,this.volume=s,this.noteIndex=0,this.loop=null!=a,this.waitBeforeLoop=a||0,this.notes=[...t,...new Array(this.waitBeforeLoop).fill(null)],this.lastTime=0}playNextNote(t,e){t-this.lastTime>=e*this.tempo&&(this.notes[this.noteIndex]&&this.notes[this.noteIndex].play(this.type,this.volume),this.noteIndex++,this.loop&&this.noteIndex>=this.notes.length&&(this.noteIndex=0),this.lastTime=t)}}const $=e=>Object.values(t).filter((t=>t!==e&&!t.incompatibleWith(e)&&!e.incompatibleWith(t))),O=t=>t>=20?"#1e8e3e":t>=10?"#5fc53d":t>=0?"#ffeb00":t>=-10?"#f3931c":"#ad0000",N=["#d43333","#3ebd62"];class j{constructor(t,e){this.name=t,this.gender=e,this.traits=[],this.mood=null,this.image=null,this.cardDimensions={width:234,height:380,border:8},this.personToMatch=null,this._happiness=10,this.showHappinessChange=!1,this.changeType=0,this.speechBubbleScale=1,this.speechBubbleIsGrowing=null,this.speechBubbleIsDisappearing=null,this.framesShown=0}set happiness(t){this.changeType=this._happiness>t?0:1,this.showHappinessChange=this._happiness!==t&&(0,e.pick)(!0,!1),this._happiness=Math.max(Math.min(t,50),-50),this.showHappinessChange&&window.speechSound&&((t,i,s,a,n)=>{const h=F[a.toLowerCase()]||senteceTypes.normal;[...h.start.map((t=>t*(0,e.int)(.8,1.3))),...new Array(Math.max(4-h.ending.length,0)).fill(0).map((t=>(0,e.int)(80,200))),...h.ending.map((t=>t*(0,e.int)(.8,1)))].forEach(((t,e)=>{setTimeout((()=>{H(s,t*R[i||"female"],100*h.rate,.1*h.rate,.05)}),100*h.rate*e)}))})(0,this.gender,"triangle",this.changeType?"calm":"exclamation"),this.speechBubbleScale=.8,this.speechBubbleIsGrowing=this.showHappinessChange}get happiness(){return Math.max(Math.min(this._happiness,50),-50)}get shortName(){return`${this.name.split(" ")[0][0]}. ${this.name.split(" ").slice(1).join(" ")}`}get happinessName(){return(t=this.happiness)>=20?"🟢 Ecstatic":t>=10?"🟢 Happy":t>=0?"🟡 Neutral":t>=-10?"🟠 Angry":"🔴 Furious";var t}get cardInfoDimensions(){return{width:this.cardDimensions.width,height:this.cardDimensions.height/3.8}}hasTrait(t){return!!this.traits.find((e=>e.name.toLowerCase()===t.toLowerCase()))}scorePerson(t){return this.traits.map((e=>t.traits.map((t=>e.likes(t)?10:0+e.dislikes(t)?-10:0)))).flat().reduce(((t,e)=>t+e),0)}generateTraits(){const i=(0,e.pick)(...Object.values(t));this.traits=[i,(0,e.pick)(!0,!0,!1)&&(0,e.pick)(...$(i))].filter((t=>!!t))}init(){return this.generateTraits(),this.mood=(0,e.pick)(...this.traits).mood,this.image=((t,i)=>{const s=(0,e.pick)(...Object.keys(m)),a=(0,e.pick)(...m[s]),n=(0,e.pick)(...y[t]),h=[...D(t,a)];return h.push({path:"M 50,105 c 0,5.3484 0,10 5,20 -5,-5 -15,-5 -15,5 l 5,25 c 0,5 5,10 10,5 5,15 10,25 25,30 v 10 c -15,0 -15,0 -19.546443,3.40433 C 60.453557,260 80,260 99.999999,260 120,260 139.54788,260 139.54788,203.40435 135,200 135,200 120,200 v -10 c 15,-5 20,-15 25,-30 5,5 10,0 10,-5 l 5,-25 c 0,-10 -10,-10 -15,-5 5,-10 5,-14.65458 5,-20 0,-45 -100,-45 -100,0 z",colour:s}),h.push(...((t,i)=>{const s=[];return(0,e.pick)(!0,!0,"female"===t)&&s.push({path:(0,e.pick)(...x[t]),colour:i}),s})(t,a)),h.push({path:(0,e.pick)(...v[t][i]),colour:n}),h.push(...((t,i,s)=>{const a="male"===t||(0,e.pick)(!0,!1)?(0,e.pick)(...Object.keys(g)):s,n=g[a]?a:(0,e.pick)(...Object.keys(g)),h="male"===t?(0,e.pick)(...g[n].slice(1)):(0,e.pick)(...g[n]),o=g[n][0],l=(0,e.pick)(a,...Object.keys(g)),r=[{path:(0,e.pick)(...S[t]),colour:h}],c="male"===t&&(0,e.pick)(!0,!1),d="male"===t&&c&&(0,e.pick)(!0,!1),p="male"===t&&(0,e.pick)(!0,!1),u="male"===t&&!p&&(0,e.pick)(!0,!1),f="female"===t&&(0,e.pick)(!0,!1,!1),w="female"===t&&(0,e.pick)(!0,!1),b="female"===t&&(0,e.pick)(!0,!1);return c?r.push({path:M,colour:o}):"male"===t&&r.push({path:M,colour:i}),d&&r.push({path:"M 100,312 c -10,0 -15,33 -15,33 h 30 c 0,0 -5,-33 -15,-33 z",colour:o}),p&&(r.push({path:I,colour:l}),r.push({path:c?"M 100,250 c 6,-15 7,-12 7,-20 0,-18 -2,-35 -2,-35 H 95 c 0,0 -5,25 -5,35 0,8 5,5 10,20 z":"M 110,275 c 0,-45 -5,-80 -5,-80 H 95 c 0,0 -10,65 -10,75 5,5 25,5 25,5 z",colour:l})),u&&r.push({path:"M 125,180 c -5,0 -15,10 -23,13 -2,1 1,-1 -2,-1 -3,0 0,2 -2,1 -8,-3 -18,-13 -23,-13 -5,5 -5,25 0,30 5,0 15,-5 23,-9 2,-1 -1,1 2,1 3,0 0,-2 2,-1 8,4 18,9 23,9 5,-5 5,-25 0,-30 z",colour:l}),w&&(r.push({path:(0,e.pick)(...P),colour:i}),b&&r.push({path:"M 124,243 c 0,-5 -3,-11 -7,-10 -4,1 -9,5 -12,9 -1,-2 -3,-2 -5,-2 -2,0 -4,0 -5,2 -3,-4 -8,-8 -12,-9 -4,-1 -7,5 -7,10 v 5 c 1,5 2,10 7,10 3,0 8,-4 12,-7 0,6 -8,12 -15,12 0,1 3,4 4,4 -1,1 -4,2 -4,4 10,-1 15,-4 20,-11 5,7 10,10 20,11 0,-2 -3,-3 -4,-4 1,0 4,-3 4,-4 -7,0 -15,-6 -15,-12 4,3 9,7 12,7 4,0 6,-5 7,-10 z m -38,7 c -3,0 -5,-1 -5,-4 0,-3 2,-4 5,-4 3,0 8,3 8,4 0.0493,0 -5,4 -8,4 z m 28,0 c -3,0 -8,-4 -8,-4 0,-1 5,-4 8,-4 3,0 5,1 5,4 0,3 -2,4 -5,4 z",colour:n})),f&&r.push({path:I,colour:n}),r})(t,s,n)),h})(this.gender,this.mood),this}updateBubbleAnimation(){this.showHappinessChange&&(this.speechBubbleIsGrowing&&(this.speechBubbleScale+=.03,this.speechBubbleScale>1.2&&(this.speechBubbleIsGrowing=!1)),this.speechBubbleIsGrowing||this.speechBubbleIsDisappearing||(this.speechBubbleScale-=.05,this.speechBubbleScale<=1&&(this.speechBubbleScale=1,this.framesShown++)),60!==this.framesShown||this.speechBubbleIsDisappearing||(this.speechBubbleIsDisappearing=!0,this.speechBubbleIsGrowing=!0)),this.speechBubbleIsDisappearing&&!this.speechBubbleIsGrowing&&(this.speechBubbleScale-=.1,this.speechBubbleScale<=0&&(this.speechBubbleScale=0,this.showHappinessChange=!1,this.speechBubbleIsDisappearing=!1,this.speechBubbleIsGrowing=!1,this.framesShown=0))}drawSpeechBubble(t,e){t.translate(10*this.speechBubbleScale-10,10*this.speechBubbleScale-10),t.scale(this.speechBubbleScale,this.speechBubbleScale),t.translate(0,40),t.fillStyle=e,t.beginPath(),t.ellipse(0,0,75,50,0,0,2*Math.PI),t.fill(),t.beginPath(),t.moveTo(25,40),t.lineTo(50,75),t.lineTo(50,25),t.fill()}drawSpikySpeechBubble(t,e){t.save(),this.drawSpeechBubble(t,e);for(let e=0;e<16;e++)t.save(),t.translate(45*Math.cos(e*Math.PI/8),25*Math.sin(e*Math.PI/8)),t.rotate(e*Math.PI/8),t.beginPath(),t.moveTo(20,-15),t.lineTo(20,15),t.lineTo(35,0),t.fill(),t.restore();t.restore()}draw(t,e,i){const s=e||{x:1,y:1};t.save(),t.translate(16,-6),t.scale(s.x,s.y),t.scale(1.04,1.04);const a=new Path2D;if(this.image.forEach((t=>{a.addPath(new Path2D(t.path))})),t.filter="blur(4px)",t.fillStyle=`${O(this.happiness)}70`,t.fill(a),t.fillStyle="#00000060",t.fill(a),t.filter="none",t.restore(),t.save(),t.translate(15,0),t.scale(s.x,s.y),this.image.forEach((e=>{const i=new Path2D(e.path);t.fillStyle=e.colour,t.fill(i)})),!i){if(this.personToMatch&&this!==this.personToMatch){const e=this.scorePerson(this.personToMatch);L(t,j.dimensions.width/2-15,0,30,O(e),"fill")}this.showHappinessChange&&(this.updateBubbleAnimation(),this.changeType?this.drawSpeechBubble(t,N[this.changeType]):this.drawSpikySpeechBubble(t,N[this.changeType]))}t.restore()}drawTraitBox(t){const e=this.cardDimensions.border/2,i=this.cardDimensions.border/2+(this.cardDimensions.height-this.cardInfoDimensions.height);t.translate(e,i),t.fillStyle="#cdc8c4f0",t.fillRect(0,0,this.cardInfoDimensions.width,this.cardInfoDimensions.height),t.lineWidth=this.cardDimensions.border,t.strokeStyle="#9a8472",t.stroke(new Path2D(`M 0,0 h ${this.cardInfoDimensions.width}`)),t.font="32px monospace",t.fillStyle="#000000",this.traits.forEach(((e,i)=>{t.fillText(e.name,20,40+40*i)})),t.translate(-e,-i)}drawNameBox(t){const e=this.cardDimensions.border/2;t.translate(e,0),t.fillStyle="#cdc8c4f0",t.fillRect(0,0,this.cardDimensions.width,50),t.lineWidth=this.cardDimensions.border,t.strokeStyle="#9a8472",t.stroke(new Path2D(`M 0,50 h ${this.cardInfoDimensions.width}`)),t.font="bold 32px monospace",t.fillStyle="#000000",t.fillText(this.shortName,10,40),t.translate(-e,-0)}drawCard(t,e,i){t.save();const s=i||{x:1,y:1};t.scale(s.x,s.y),t.translate(e.x,e.y);const a=t.createLinearGradient(0,0,0,256);a.addColorStop(0,O(this.happiness)),a.addColorStop(.2,O(this.happiness)),a.addColorStop(.9,"#f1dbbb"),t.fillStyle=a,t.fillRect(0,0,this.cardDimensions.width,this.cardDimensions.height),this.draw(t,null,!0),this.drawTraitBox(t),this.drawNameBox(t),t.strokeStyle="#9a8472",t.lineWidth=this.cardDimensions.border,t.strokeRect(0,0,this.cardDimensions.width,this.cardDimensions.height),t.font="12px monospace",t.lineWidth=1,t.fillStyle="transparent",t.strokeStyle="transparent",t.restore()}}j.dimensions={width:210,height:345};const q={width:234,height:380,border:8};class J{constructor(t,e,i){this.shape="rectangular",this.size=t,this.spaces=[],this.unit=.25*j.dimensions.width,this._x=Math.min(window.cWidth-80-(this.unit*(this.size/2)-this.unit),Math.max(80,e)),this._y=Math.min(window.cHeight-100-2.2*this.unit,Math.max(80,i)),this.areas=new Map}get moreThanOneFurious(){return this.spaces.filter((t=>t.happiness<=-50)).length>1}get isFull(){return this.spaces.length===this.size}get cardDimensions(){return q}get happiness(){return this.spaces.reduce(((t,e)=>t+e.happiness),0)}get totalHappiness(){return this.spaces.reduce(((t,e)=>t+this.spaces.reduce(((t,i)=>i===e?0:t+e.scorePerson(i)),0)),0)}get dimensions(){return{x:this._x-this.unit/2,y:this.y,width:this.width+this.unit,height:this.height}}get centre(){const t=this.dimensions;return{x:t.width/2+t.x,y:t.height/2+t.y}}get width(){return this.unit*(this.size/2)}get _width(){return this.width-this.unit}get height(){return 2.2*this.unit}set x(t){this._x=Math.min(window.cWidth-80-this.width,Math.max(80,t))}get x(){return-this.unit/2}set y(t){this._y=Math.min(window.cHeight-100-this.height,Math.max(80,t))}get y(){return this._y}add(t){return!(this.spaces.length>=this.size||(this.spaces.push(t),this.spaces=[...new Set(this.spaces)],0))}remove(t){this.spaces=this.spaces.filter((e=>e!==t))}checkClicked(t){let e=null;return[...this.areas.keys()].forEach((i=>{const s=this.areas.get(i);C({x:t.x,y:t.y},{x:s.x,y:s.y,width:s.width,height:s.height})&&(e=i)})),e}updateHappiness(){return this.spaces.forEach((t=>{const i=.1*this.spaces.reduce(((e,i)=>i===t?0:e+t.scorePerson(i)),0);(0,e.pick)(!0,!0,!0,!1)&&(t.happiness=t.happiness+i)}))}drawTopRowPeople(t){t.save();const e=this.width/(this.size/2);t.translate(-.3*this.unit,-15-this.height/2),this.spaces.slice(0,this.size/2).forEach(((i,s)=>{i.draw(t,{x:.25,y:.25}),t.translate(e,0);const a={x:this._x+e*s,y:this.y-(15+this.height/2)};this.areas.set(i,{x:a.x,y:a.y,width:e,height:.25*j.dimensions.height})})),t.restore()}drawBottomRowPeople(t){t.save();const e=this.width/(this.size/2);t.translate(-.3*this.unit,15+this.height/2),this.spaces.slice(this.size/2).forEach(((i,s)=>{i.draw(t,{x:.25,y:.25}),t.translate(e,0);const a={x:this._x+e*s,y:this.y+(15+this.height/2)};this.areas.set(i,{x:a.x,y:a.y,width:e,height:.25*j.dimensions.height})})),t.restore()}drawHappiness(t){t.save(),t.fillStyle="#f1dbbb",t.strokeStyle="#9a8472",t.translate(this.width/2-30,45),t.fillRect(0,0,60,24),t.strokeRect(0,0,60,24),t.font="22px monospace",t.fillStyle="#000000",t.fillText(this.happiness,5,20),t.font="12px monospace",t.restore()}drawTable(t,e){this.drawPositionedTable(t,e)}drawPositionedTable(t,e){t.save();const i=e||{x:1,y:1};t.filter="blur(4px)",t.translate(4,4),this._drawTableTop(t,i,"#00000060"),t.filter="blur(0px)",t.translate(-4,-4),this._drawTableTop(t,i,"#4f402e"),t.translate((this.width-.9*this.width)/2,(this.height-.9*this.height)/2),this._drawTableTop(t,{x:.9*i.x,y:.9*i.y},"#ffe5d8"),t.restore()}_drawTableTop(t,e,i){t.save();const s=e||{x:1,y:1};t.scale(s.x,s.y),t.fillStyle=i,t.fillRect(this.unit/2,0,this.width-this.unit,this.height),E(t,(this.unit+1)/2,this.height/2,this.height/2,null,"fill",1),E(t,this._width+(this.unit-1)/2,this.height/2,this.height/2,null,"fill",-1),t.restore()}drawTableSeats(t,e){return this.drawPositionedTableSeats(t,e)}drawPositionedTableSeats(t){t.save();const e=this.width+this.unit,i=this.width/(this.size/2);t.translate(e/2-i*(this.size/2)/2-.3*this.unit,0);for(let e=0;e<this.size/2;e++){const s=i*e;this.drawSeatPosition(t,{x:s,y:10}),this.drawSeatPosition(t,{x:s,y:this.height-37})}t.restore()}drawSeatPosition(t,e){t.save(),t.translate(e.x,e.y),t.scale(1.5,1.5),t.fillStyle="#eae5e2",t.strokeStyle="#ffffff",t.fill(new Path2D("M 0,9 9,18 18,9 9,0 Z")),t.stroke(new Path2D("M 0,9 9,18 18,9 9,0 Z")),L(t,9,9,6,"#fffaf3","fill"),L(t,9,9,4,"#ffffff","fill"),L(t,9,9,6,"#b3a899","stroke"),L(t,9,9,4,"#eae6e2","stroke"),t.restore()}draw(t){this.areas=new Map,t.translate(this._x,this.y),this.drawTopRowPeople(t),this.drawTable(t),this.drawTableSeats(t),this.drawHappiness(t),this.drawBottomRowPeople(t),t.translate(-this._x,-this.y)}drawShadow(t){this.drawTable(t)}drawCard(t,e,i){t.save();const s=i||{x:1,y:1};t.scale(s.x,s.y),t.translate(e.x,e.y),t.fillStyle="#f1dbbb",t.fillRect(0,0,q.width,q.height),t.strokeStyle="#9a8472",t.lineWidth=q.border,t.strokeRect(q.border/2,q.border/2,q.width-q.border,q.height-q.border),t.translate(q.width/2-this.width/2,q.height/2-this.height/2);const a=this.width/2,n=this.height/2;t.translate(a,n),t.rotate(Math.PI/2),t.translate(-a,-n),this.drawPositionedTable(t),this.drawPositionedTableSeats(t),t.lineWidth=1,t.restore()}}class V{constructor(t){this.execute=t}}const Y=["🞂","🞂🞂","🞂🞂🞂"],Z=[2,-1,-6],K={male:["Aaron","Adin","Ahmed","Andrej","Artyom","Ben","Biel","Charlie","Connor","Daan","Damjan","Daniel","David","Dmitry","Edvin","Enzo","Eric","Filipe","Finn","George","Goran","Harry","Hugo","Ibai","Ivan","Jack","Jonas","João","Jules","Jon","Lazar","Leo","Liam","Logan","Lucas","Luis","Marko","Martin","Mikhail","Milan","Milos","Mat","Nathan","Neil","Nik","Oliver","Oskar","Pablo","Petar","Ralfs","Raphael","Rayan","Roberts","Rodrigo","Roman","Samuel","Sem","Sergei","Sean","Stefan","Szymon","Theo","Tobias","Tomas","Viktor","Vuk","William","Wout","Zach","Zoran"],female:["Aada","Alice","Alisa","Alma","Alva","Amelia","Ana","Asja","Aurora","Aya","Beatriz","Chloe","Daisy","Daria","Dunja","Eevi","Elena","Eliza","Ellen","Elsa","Ema","Emilija","Emily","Eva","Gabija","Grace","Hanna","Ida","Ioana","Irati","Irina","Isa","Isla","Ivana","Jade","Jana","Jelena","Jovana","June","Jazmin","Julia","Klea","Lamija","Lara","Lena","Leonor","Liepa","Lili","Lina","Louise","Lucia","Lea","Mae","Maja","Margret","Maria","Melisa","Mia","Milena","Nahia","Nela","Nina","Nora","Olga","Olivia","Paula","Sara","Sofia","Stella","Tatjana","Tereza","Vesna","Vicky","Yasmine","Yelena","Zala","Zoe"]},X=["Alievi","Andov","Bauer","Boyko","Campbell","Crown","Davies","Dubois","Esposito","Fontana","Garcia","Gruber","Hansen","Huber","Ivanov","Jones","Kaya","Kovacs","Larsen","Lindholm","Maric","Magi","Nagy","Novak","O'Connor","Patel","Pop","Rohr","Rusu","Santos","Schmidt","Smith","Tamm","Virtanen","Wagner","Walsh","de Vries"],Q=t=>{let i=(0,e.pick)(...X).split("/");return`${(0,e.pick)(...K[t])} ${"female"===t&&i[1]?i[1]:i[0]}`},U=document.querySelector("[game_area]");U.width=window.innerWidth-5,U.height=window.innerHeight-5,window.cWidth=window.innerWidth-5,window.cHeight=window.innerHeight-5;const tt=U.getContext("2d");U.oncontextmenu=t=>{t.preventDefault(),t.stopPropagation()};const et=new class{constructor(t,e,i){this.ctx=t,this.width=e,this.height=i,this.areas=new Map,this.hand=[],this.handLimit=5,this.tooltipInfo={x:0,y:0,content:null},this.pings={},this.options={playMusic:!0,speechSound:!0,pingSound:!0}}get atHandLimit(){return this.hand.length>=this.handLimit}addToHand(...t){this.hand.push(...t)}removeFromHand(t){this.hand=this.hand.filter((e=>t!==e))}checkClicked(t){let e=null;return[...this.areas.keys()].forEach((i=>{C(t,this.areas.get(i))&&(e=i)})),e}resetDetectionAreas(){this.areas=new Map}drawHand(){const t=this.hand.length%2==0?this.hand.length/2-.5:Math.floor(this.hand.length/2);this.ctx.save(),this.hand.forEach(((e,i)=>{const s={x:this.width-58.5+234*(i-t),y:2*this.height-380};e.drawCard(this.ctx,s,{x:.5,y:.5}),this.areas.set(e,{x:.5*s.x,y:.5*s.y,width:117,height:190})})),this.ctx.restore()}drawTooltip(){if(this.tooltipInfo.content){this.ctx.save(),this.ctx.translate(this.tooltipInfo.x,this.tooltipInfo.y),this.ctx.fillStyle="#f1dbbb";const t=16,e=20+this.tooltipInfo.content.reduce(((t,e)=>Math.max(t,e.length)),0)*(.5625*t);this.ctx.fillRect(0,0,e,20*this.tooltipInfo.content.length+20),this.ctx.strokeStyle="#9a8472",this.ctx.strokeRect(0,0,e,20*this.tooltipInfo.content.length+20),this.ctx.fillStyle="#000000",this.tooltipInfo.content.forEach(((e,i)=>{this.ctx.font=i>0?t-2+"px monospace":`bold ${t}px monospace`,this.ctx.fillText(e,10,20+20*i)})),this.ctx.fillStyle="transparent",this.ctx.restore()}}drawScore(t){this.ctx.save(),this.ctx.fillStyle="#f1dbbb",this.ctx.strokeStyle="#9a8472",this.ctx.translate(10,10),this.ctx.fillRect(0,0,200,24),this.ctx.strokeRect(0,0,200,24),this.ctx.font="20px monospace",this.ctx.fillStyle="#000000",this.ctx.fillText(`Happiness: ${t}`,5,20),this.ctx.font="12px monospace",this.ctx.restore()}drawOption(t,e,i,s){this.ctx.save(),this.ctx.fillStyle="#f1dbbb",this.ctx.strokeStyle="#9a8472",this.ctx.fillRect(0,0,30,30),this.ctx.strokeRect(0,0,30,30),this.ctx.font="16px monospace",this.ctx.fillStyle="#000000",this.ctx.fillText(t,8+(i||0),21+(s||0)),e&&(this.ctx.beginPath(),this.ctx.moveTo(25,5),this.ctx.lineTo(5,25),this.lineWidth=2,this.ctx.strokeStyle="#f1dbbb",this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(25,5),this.ctx.lineTo(5,25),this.lineWidth=1,this.ctx.strokeStyle="#000000",this.ctx.stroke()),this.ctx.restore()}drawOptions(){this.ctx.save(),this.ctx.translate(10,50),this.drawOption("♫",!this.options.playMusic,1),this.areas.set(new V((()=>{this.options.playMusic=!this.options.playMusic,H("triangle",150,null,.08,.3)})),{x:10,y:50,width:32,height:32}),this.ctx.translate(35,0),this.drawOption("🗪",!this.options.speechSound,-2),this.areas.set(new V((()=>{this.options.speechSound=!this.options.speechSound,window.speechSound=this.options.speechSound,H("triangle",150,null,.08,.3)})),{x:45,y:50,width:32,height:32}),this.ctx.translate(35,0),this.drawOption("⊚",!this.options.pingSound,-1,-2),this.areas.set(new V((()=>{this.options.pingSound=!this.options.pingSound,H("triangle",150,null,.08,.3)})),{x:80,y:50,width:32,height:32}),this.ctx.translate(60,0),this.drawOption(Y[window.speed-1],null,Z[window.speed-1],0),this.areas.set(new V((()=>{window.speed++,window.speed>=4&&(window.speed=1),setTimeout((()=>{H("triangle",100,null,.2,.5)}),0/window.speed),setTimeout((()=>{H("triangle",150,null,.2,.5)}),200/window.speed),setTimeout((()=>{H("triangle",200,null,.2,.5)}),400/window.speed)})),{x:140,y:50,width:32,height:32}),this.ctx.restore()}ping(t,e,i,s){this.pings[`${t.x}|${t.y}|${e}`]=3,this.options.pingSound&&(setTimeout((()=>{H(null,s?100:50,null,1,.5)}),0),setTimeout((()=>{H(null,s?50:100,null,1,.5)}),300)),setTimeout((()=>{delete this.pings[`${t.x}|${t.y}|${e}`]}),i)}drawPings(){Object.keys(this.pings).forEach((t=>{this.ctx.save(),this.ctx.translate(parseInt(t.split("|")[0]),parseInt(t.split("|")[1]));const e=(255-this.pings[t]).toString(16).padStart(2,0);L(this.ctx,0,0,this.pings[t]*(.05*this.pings[t])*.1,`${t.split("|")[2]}${e}`,"stroke"),L(this.ctx,0,0,this.pings[t]*(.05*this.pings[t])*.5,`${t.split("|")[2]}${e}`,"stroke"),L(this.ctx,0,0,this.pings[t]*(.05*this.pings[t]),`${t.split("|")[2]}${e}`,"stroke"),L(this.ctx,0,0,this.pings[t]*(.05*this.pings[t])*1.5,`${t.split("|")[2]}${e}`,"stroke"),L(this.ctx,0,0,this.pings[t]*(.05*this.pings[t])*2,`${t.split("|")[2]}${e}`,"stroke"),this.pings[t]+=1,this.ctx.restore()}))}}(tt,U.width,U.height);window.ui=et;const it=new Array(et.handLimit-1).fill(0).map((t=>{const i=(0,e.pick)("female","male");return new j(Q(i),i).init()}));et.addToHand(...it,new J(4));const st=new class{constructor(){this.tables=[]}get tablesAreFull(){return!this.tables.find((t=>!t.isFull))}get totalScore(){return this.tables.reduce(((t,e)=>t+e.happiness),0)}addTable(t){if(t instanceof J)return this.tables.push(t),this.tables=[...new Set(this.tables)],!0}checkClickedTable(t){let e=null;return[...this.tables].forEach((i=>{C(t,i.dimensions)&&(e=i)})),e}checkClickedPerson(t){let e=null;return[...this.tables].forEach((i=>{const s=i.checkClicked(t);s&&(e=s)})),e}checkClicked(t){return this.checkClickedPerson(t)||this.checkClickedTable(t)}drawFloorSection(t){t.fillStyle="#f3f0e9",t.beginPath(),t.moveTo(45,45),t.arcTo(5,45,5,5,10),t.arcTo(5,5,45,5,10),t.arcTo(45,5,45,45,10),t.arcTo(45,45,5,45,10),t.fill(),t.fillStyle="#fffaf4",t.beginPath(),t.moveTo(25,10),t.quadraticCurveTo(25,25,40,25),t.quadraticCurveTo(25,25,25,40),t.quadraticCurveTo(25,25,10,25),t.quadraticCurveTo(25,25,25,10),t.fill()}drawFloor(t){t.save();const e=t.canvas.width/50,i=t.canvas.height/50;t.fillStyle="#e3e0d9",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.translate(50,50);for(let s=0;s<i;s++){let i=0;for(let s=0;s<e;s++)this.drawFloorSection(t),i+=50,t.translate(50,0);t.translate(-i,0),t.translate(0,50)}t.restore()}drawWalls(t){t.save(),t.strokeStyle="#d5d5d5",t.lineWidth=100,t.strokeRect(0,0,t.canvas.width,t.canvas.height),t.strokeStyle="#847766",t.lineWidth=30,t.strokeRect(0,0,t.canvas.width,t.canvas.height),t.strokeStyle="#847766",t.lineWidth=2,t.strokeRect(50,50,t.canvas.width-100,t.canvas.height-100),t.lineWidth=1,t.beginPath(),t.moveTo(0,0),t.lineTo(50,50),t.stroke(),t.beginPath(),t.moveTo(t.canvas.width,0),t.lineTo(t.canvas.width-50,50),t.stroke(),t.beginPath(),t.moveTo(t.canvas.width,t.canvas.height),t.lineTo(t.canvas.width-50,t.canvas.height-50),t.stroke(),t.beginPath(),t.moveTo(0,t.canvas.height),t.lineTo(50,t.canvas.height-50),t.stroke(),t.restore()}drawDoor(t){t.save(),t.translate(0,t.canvas.height/2-100),t.beginPath(),t.moveTo(5,0),t.lineTo(40,50),t.lineTo(40,150),t.lineTo(5,200),t.fillStyle="#90641f",t.fill(),t.beginPath(),t.moveTo(10,15),t.lineTo(35,50),t.lineTo(35,150),t.lineTo(10,185),t.fillStyle="#fffaf4",t.fill(),t.beginPath(),t.moveTo(5,93),t.lineTo(50,95),t.lineTo(50,105),t.lineTo(5,108),t.fillStyle="#90641f",t.fill(),t.beginPath(),t.moveTo(5,0),t.lineTo(15,0),t.lineTo(51,50),t.lineTo(40,50),t.fillStyle="#c5c5c5",t.fill(),t.beginPath(),t.moveTo(51,150),t.lineTo(40,150),t.lineTo(5,200),t.lineTo(15,200),t.fillStyle="#f5f5f5",t.fill(),t.fillStyle="#e3e0d9",t.fillRect(40,50,11,100),t.beginPath(),t.moveTo(51,150),t.lineTo(40,150),t.strokeStyle="#847766",t.lineWidth=2,t.stroke(),t.beginPath(),t.moveTo(51,50),t.lineTo(40,50),t.stroke(),t.restore()}drawWindow(t){t.save(),t.beginPath(),t.moveTo(50,5),t.lineTo(t.canvas.width-50,5),t.lineTo(t.canvas.width-75,40),t.lineTo(75,40),t.fillStyle="#e0f9fe",t.fill(),t.beginPath(),t.moveTo(50,5),t.lineTo(75,40),t.lineTo(75,51),t.lineTo(50,16),t.fillStyle="#f5f5f5",t.fill(),t.beginPath(),t.moveTo(t.canvas.width-50,5),t.lineTo(t.canvas.width-75,40),t.lineTo(t.canvas.width-75,51),t.lineTo(t.canvas.width-50,16),t.fillStyle="#f5f5f5",t.fill(),t.beginPath(),t.moveTo(75,40),t.lineTo(75,51),t.strokeStyle="#847766",t.lineWidth=2,t.stroke(),t.beginPath(),t.moveTo(t.canvas.width-75,40),t.lineTo(t.canvas.width-75,51),t.stroke(),t.fillStyle="#e3e0d9",t.fillRect(75,40,t.canvas.width-150,11),t.restore()}drawLighting(t){t.save(),this._drawWindowShadows(t),this._drawLights(t,"#ffff8810","#00000000"),t.translate(0,t.canvas.height/2),this._drawShadow(t),this._drawLights(t,"#fff70010","#00000030"),t.restore()}_drawLights(t,e,i){t.save(),t.translate((t.canvas.width-2*t.canvas.height)/4,0),t.translate(-(5+t.canvas.height/4),t.canvas.height/4);for(let s=0;s<4;s++){t.translate(5+t.canvas.height/2,0);const s=t.createRadialGradient(0,0,Math.max(5,t.canvas.height/4-100),0,0,t.canvas.height/4);s.addColorStop(0,e),s.addColorStop(.7,i),s.addColorStop(1,i),L(t,0,0,t.canvas.height/4,s,"fill")}t.restore()}_drawWindowShadows(t){const e=t.createLinearGradient(0,t.canvas.height/2-300,0,t.canvas.height/2);e.addColorStop(0,"#ddddff10"),e.addColorStop(1,"#00000030"),t.fillStyle=e,t.fillRect(0,t.canvas.height/2-300,t.canvas.width,300);const i=t.createLinearGradient(0,0,0,t.canvas.height/2);i.addColorStop(0,"#00000030"),i.addColorStop(.5,"#00000000"),i.addColorStop(1,"#00000000"),t.fillStyle=i,t.moveTo(0,0),t.lineTo(50,0),t.lineTo(50,15),t.lineTo(75,51),t.lineTo(51,t.canvas.height/2),t.lineTo(0,t.canvas.height/2),t.fill(),t.moveTo(t.canvas.width,0),t.lineTo(t.canvas.width-50,0),t.lineTo(t.canvas.width-50,15),t.lineTo(t.canvas.width-75,51),t.lineTo(t.canvas.width-51,t.canvas.height/2),t.lineTo(t.canvas.width,t.canvas.height/2),t.fill()}_drawShadow(t){t.save(),t.beginPath(),t.moveTo(0,0),t.lineTo(t.canvas.width,0),t.lineTo(t.canvas.width,t.canvas.height/2),t.lineTo(0,t.canvas.height/2),t.closePath(),t.translate((t.canvas.width-2*t.canvas.height)/4,0);for(let e=0;e<4;e++)t.arc(t.canvas.height/4+e*(5+t.canvas.height/2),t.canvas.height/4,t.canvas.height/4,-Math.PI/2,2*Math.PI);t.closePath(),t.fillStyle="#00000030",t.fill("evenodd"),t.restore()}draw(t){this.drawFloor(t),this.drawWalls(t),this.drawDoor(t),this.drawWindow(t),this.tables.forEach((e=>e.draw(t))),this.drawLighting(t)}},at=new J(6);at.x=window.innerWidth/2-at.width/2,at.y=window.innerHeight/2-at.height/2,st.addTable(at);let nt=!1,ht=0;const ot=["You kept your guests waiting for too long.","You had at least two furious people at a table."],lt=["Tip: Guests in your hand grow angry as time passes.","Tip: Shift guests from table to table to balance out their happiness."];let rt=6,ct=!1,dt=0,pt=null,ut=null;const ft={x:0,y:0},wt={x:null,y:null};let bt,mt,gt=!1,yt=!1;function vt(){new Date-mt<200?setTimeout(vt,200):(yt=!1,U.width=window.innerWidth-5,U.height=window.innerHeight-5,et.width=window.innerWidth-5,et.height=window.innerHeight-5,window.cWidth=window.innerWidth-5,window.cHeight=window.innerHeight-5)}function xt(t){nt||(ft.x=t.touches?t.touches[0].clientX:t.clientX,ft.y=t.touches?t.touches[0].clientY:t.clientY,ut=st.checkClicked(ft))}function Tt(t){nt||(xt(t),wt.x=ft.x,wt.y=ft.y,(0===t.button||t.touches)&&(pt=et.checkClicked(ft)||st.checkClicked(ft),et.tooltipInfo.content=null))}function kt(t){if(!nt){if(wt.x=null,wt.y=null,(0===t.button||!gt&&t.touches)&&pt){if(pt instanceof j){const t=st.checkClicked(ft);t&&t instanceof J&&(st.tables.forEach((t=>{t.remove(pt)})),t.add(pt)&&et.removeFromHand(pt))}pt instanceof J&&!et.checkClicked(ft)&&!st.checkClicked(ft)&&(pt.x=ft.x,pt.y=ft.y,st.addTable(pt)&&et.removeFromHand(pt)),pt instanceof V&&pt.execute()}if(2===t.button||gt){const t=st.checkClicked(ft);t instanceof j&&(et.tooltipInfo.content=[t.name,t.happinessName,...t.traits.map((t=>t.name))],et.tooltipInfo.x=ft.x,et.tooltipInfo.y=ft.y),t||(et.tooltipInfo.content=null)}pt=null,st.tables.forEach((t=>t.spaces.forEach((t=>t.personToMatch=null))))}}window.addEventListener("resize",(function(){mt=new Date,!1===yt&&(yt=!0,setTimeout(vt,200))}),!0),document.addEventListener("mousemove",xt),document.addEventListener("touchmove",xt),document.addEventListener("touchmove",(()=>{bt&&clearTimeout(bt),gt=!1})),document.addEventListener("mousedown",Tt),document.addEventListener("touchstart",Tt),document.addEventListener("touchstart",(function(t){bt=setTimeout((()=>gt=!0),500)})),document.addEventListener("mouseup",kt),document.addEventListener("touchend",kt),document.addEventListener("touchcancel",kt),document.addEventListener("touchend",(()=>{bt&&clearTimeout(bt),gt=!1})),document.addEventListener("touchcancel",(()=>{bt&&clearTimeout(bt),gt=!1})),document.monetization&&document.monetization.addEventListener("monetizationstart",(()=>{et.handLimit=6,rt=5,document.querySelector("[monetization]").innerHTML="Looks like you had a bit more money. You can invite an extra guest and can find tables a bit quicker."}));const St=new _([G.create("D#",2,3),null,G.create("F#",2,3),null,G.create("A#",2,5),null,null,G.create("G#",2,3),G.create("G#",2,.5),G.create("B",2,1.5),G.create("D#",3,3)],"sine",1,.03,0),Mt=new class{constructor(t,e,i,s){this.type=e,this.tempo=i||1,this.volume=s,this.notePool=t,this.lastTime=0,this.toneLength=0,this.noteIndex=0,this.lastNote=null}playNextNote(t,i){if(t-this.lastTime>=i*this.tempo){let i=this.noteIndex+1;i>=this.notePool.length&&(i=0);const s=(0,e.pick)(...this.notePool[this.noteIndex]),a=(0,e.pick)(.5,1,2);!s||!this.lastNote&&this.noteIndex%2||G.create(s[0],s[1],a,1e3*Math.max(1,a)).play(this.type,this.volume),this.lastNote=s,this.noteIndex=i,this.lastTime=t}}}([[["D#",4],["F#",4],["A#",4],null,null,null],[["D#",4],["F#",4],["A#",4],null],[["D#",4],["F#",4],["A#",4],null],[["D#",4],["F#",4],["A#",4],null],[["D#",4],["F#",4],["A#",4]],[["D#",4],["F#",4],["A#",4],null,null,null],[["E",4],["G#",4],["B",4],null],[["E",4],["G#",4],["B",4],null],[["E",4],["G#",4],["B",4],null],[["E",4],["G#",4],["B",4]],[["E",4],["G#",4],["B",4]],[["E",4],["G#",4],["B",4],null,null,null],[["F#",4],["A#",4],null],[["F#",4],["A#",4],null],[["F#",4],["A#",4],null],[["F#",4],["A#",4]],[["F#",4],["A#",4]],[["F#",4],["A#",4],null,null,null],[["C#",4],["E",4],null],[["C#",4],["E",4],null],[["C#",4],["E",4],null],[["C#",4],["E",4]],[["C#",4],["E",4]],[["C#",4],["E",4],null,null,null]],"sine",.5,.08),It=[new _([G.create("D#",3,.5),G.create("D#",3,2),null,G.create("E",3,.5),G.create("E",3,2),null,G.create("F#",3,.5),G.create("F#",3,2),null,G.create("C#",3,.5),G.create("C#",3,2)],"triangle",1,.05,1),new _([G.create("F#",3,.5),G.create("F#",3,2),null,G.create("G#",3,.5),G.create("G#",3,2),null,G.create("A#",3,.5),G.create("A#",3,2),null,G.create("E",3,.5),G.create("E",3,2)],"triangle",1,.05,1),new _([G.create("A#",3,.5),G.create("A#",3,2),null,G.create("B",3,.5),G.create("B",3,2),null,G.create("C#",4,.5),G.create("C#",4,2),null,G.create("G#",3,.5),G.create("G#",3,2)],"triangle",1,.03,1)],Pt=new class{constructor(t,e){this.bpm=e,this.tracks=t}get msPerBeat(){return 6e4/this.bpm}play(t){this.tracks.forEach((e=>{e.playNextNote(t,this.msPerBeat)}))}}([St,...It,Mt],120);let Dt=0,Ct=0;window.speed=1,window.speechSound=!0,window.main=function(t){et.options.playMusic&&Pt.play(t);const i=t||0;if(i-Dt>=1/window.speed*1e3*5){if(!nt){st.tables.forEach((t=>t.updateHappiness()));const t=st.tables.find((t=>t.moreThanOneFurious));if(t&&(et.ping(t.centre,"#ff0000",8e3,!0),nt=!0,ht=1),et.hand.forEach((t=>{t instanceof j&&(t.happiness-=t.hasTrait("impatient")?(0,e.int)(3,6):t.hasTrait("patient")?(0,e.int)(0,2):(0,e.int)(1,4),t.happiness<=-50&&(nt=!0,ht=0))})),(0,e.pick)(!0,!1)&&!et.atHandLimit)if(et.hand.filter((t=>t instanceof J)).length<=1&&(st.tablesAreFull&&et.hand.length===et.handLimit-1||(0,e.pick)(!0,...new Array(rt).fill(!1))))et.addToHand(new J((0,e.pick)(2,4,6,8),0,0));else{const t=(0,e.pick)("female","male");et.addToHand(new j(Q(t),t).init())}if(et.atHandLimit&&!st.tablesAreFull&&i-Ct>=1e3*window.speed*15){const t=st.tables.find((t=>!t.isFull));et.ping(t.centre,"#0088ff",2e3),Ct=i}}Dt=i}if(tt.clearRect(0,0,U.width,U.height),st.draw(tt),et.resetDetectionAreas(),et.drawTooltip(),et.drawHand(),et.drawScore(st.totalScore),et.drawOptions(),pt&&(tt.save(),tt.globalAlpha=.7,pt instanceof j?(tt.translate(ft.x,ft.y),tt.scale(.3,.3),tt.translate(-30,-50)):pt instanceof J&&(pt.x=ft.x,pt.y=ft.y),pt.draw&&pt.draw(tt),tt.restore(),pt instanceof j&&ut&&ut instanceof J&&ut.spaces.forEach((t=>t.personToMatch=pt))),et.drawPings(),nt){ct||(ct=!0,dt=parseInt(localStorage.getItem("dosaki-seating-space-planner-high-score"))||0,localStorage.setItem("dosaki-seating-space-planner-high-score",Math.max(dt,st.totalScore))),tt.fillStyle="#050000aa",tt.fillRect(0,0,U.width,U.height),tt.fillStyle="#ffffff";const t=[["Your reception is ruined!",42],[ot[ht],32],["",5],[`Happiness: ${st.totalScore}`,44],[dt<st.totalScore?"New high score!":`Highest: ${dt}`,38],["",10],[lt[ht],26],["",40],["Refresh to start a new game.",32]],e=.5625*t.reduce(((t,e)=>t+e[1]),0);t.forEach(((t,i)=>{tt.font=`${t[1]}px monospace`,tt.fillText(t[0],U.width/2-t[0].length*t[1]*.5625/2,U.height/2-e+(40*i+.5625*t[1]))}))}window.requestAnimationFrame(main)},window.start=()=>{document.querySelector("[intro]").classList.add("hidden"),document.querySelector("[game_area]").classList.remove("hidden"),main()}})()})();
//# sourceMappingURL=game.js.map