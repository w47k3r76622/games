var gameState=0,HARD_MODE=!1,ENDLESS=!1,LVL_SIZE=22,canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d"),lv1=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,1,1],[1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,1,0,1],[1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,1],[1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,1,1,0,0,0,1],[1,1,1,1,1,0,1,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1],[1,0,0,0,0,0,0,1,0,0,0,1,0,1,1,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,1,0,0,0,1,1,1,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,3,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,1,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,1],[1,0,0,1,1,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0,1],[1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,1],[1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0,1],[1,0,0,0,0,0,0,1,0,0,0,1,1,1,1,1,1,1,1,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],lv2=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1],[1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1],[1,0,0,0,0,0,1,0,0,0,3,0,0,0,1,0,0,0,0,1,0,1],[1,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,1],[1,0,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,0,1,0,1],[1,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,1,0,1],[1,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,1,0,1],[1,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,1,0,1],[1,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,1,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],lv3=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1],[1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1],[1,0,0,1,0,0,0,0,0,0,1,3,0,0,0,0,0,0,1,0,0,1],[1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1],[1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1],[1,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,1,0,1,0,1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1],[1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1],[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1],[1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,1,1,0,0,1],[1,1,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,1],[1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],lv4=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,1,0,3,0,1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,1],[1,0,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,1,0,1],[1,0,1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0,1],[1,0,1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0,1],[1,0,1,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0,1],[1,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,1,0,1],[1,0,1,0,0,0,1,1,0,0,0,0,1,0,0,0,0,1,0,1,0,1],[1,0,1,0,0,1,1,0,1,0,0,0,1,0,0,0,1,1,0,1,0,1],[1,0,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,0,0,1,0,1],[1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],lv5=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],[1,0,0,1,1,1,1,1,0,0,0,0,0,0,0,1,0,0,0,0,0,1],[1,0,0,0,0,1,0,0,0,0,0,1,1,1,1,1,1,0,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,1,0,0,0,0,0,1],[1,1,0,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],[1,1,0,1,0,1,0,1,0,1,0,1,1,0,1,1,1,1,1,1,0,1],[1,1,0,0,0,1,0,3,0,1,0,1,0,0,0,0,0,0,0,1,0,1],[1,1,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,0,0,1,0,1],[1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,1],[1,0,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,0,1],[1,0,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0,1],[1,0,1,0,0,0,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0,1],[1,0,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0,1],[1,0,1,0,1,1,1,0,1,1,0,1,0,0,0,0,0,0,0,1,0,1],[1,0,1,0,0,1,0,0,0,1,0,1,1,1,1,1,1,1,0,1,0,1],[1,0,1,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],[1,0,1,1,1,1,1,1,0,1,0,0,0,0,0,1,0,0,0,0,0,1],[1,0,0,0,0,1,0,0,0,0,1,1,1,1,0,1,0,1,1,1,1,1],[1,0,0,0,0,1,1,1,0,1,1,0,0,0,0,1,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],lv6=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],[1,0,1,1,1,1,1,1,1,1,0,0,0,0,0,1,0,0,0,0,0,1],[1,0,1,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,1,1],[1,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],[1,0,1,0,0,0,0,0,0,1,0,0,0,0,1,1,1,0,0,0,0,1],[1,0,1,0,0,0,0,0,0,1,0,0,0,0,1,1,1,0,0,0,0,1],[1,0,1,0,0,0,0,0,0,1,0,0,0,0,1,1,1,0,0,0,0,1],[1,0,1,0,0,0,0,0,0,1,0,0,0,0,1,1,1,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,1,0,0,0,0,1],[1,0,1,1,1,1,0,1,1,1,0,0,0,0,1,1,1,0,0,0,0,1],[1,0,1,0,0,0,0,0,0,1,0,0,0,1,0,1,0,1,0,0,0,1],[1,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1],[1,0,1,0,0,0,0,0,0,1,0,0,0,1,0,1,0,1,0,0,0,1],[1,0,1,0,0,0,0,0,0,1,0,0,1,3,0,1,0,0,1,0,0,1],[1,0,1,0,0,0,0,0,0,1,0,0,1,1,1,1,1,1,1,0,0,1],[1,0,1,0,0,0,0,0,0,1,0,1,1,0,0,1,0,0,1,1,0,1],[1,0,1,0,0,0,0,0,0,1,0,1,0,0,0,1,0,0,0,1,0,1],[1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],lv7=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],[1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],[1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,1],[1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,0,1],[1,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,0,0,1,0,1],[1,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,1,0,1,1,0,1,0,0,1,0,0,0,0,0,0,0,1,0,1],[1,0,1,0,3,1,0,0,1,0,0,1,0,0,0,0,0,0,0,1,0,1],[1,0,1,0,0,1,0,0,1,0,0,1,0,0,0,0,0,0,0,1,0,1],[1,0,1,1,1,1,1,1,1,0,0,1,1,1,1,1,1,1,1,1,0,1],[1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],[1,0,0,0,0,1,0,0,0,0,0,0,1,1,0,1,0,1,0,0,0,1],[1,0,0,0,1,1,1,0,0,0,0,0,1,0,0,1,0,1,1,0,0,1],[1,0,0,0,1,1,1,0,0,0,0,1,1,0,0,1,0,0,1,1,0,1],[1,0,0,1,0,1,0,1,0,0,1,1,0,0,0,1,0,0,0,1,0,1],[1,0,1,0,0,0,0,0,1,0,0,0,0,1,0,1,0,0,0,0,0,1],[1,1,0,0,0,1,0,0,0,1,0,0,0,1,1,1,0,0,0,0,0,1],[1,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],lv8=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,0,1],[1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1],[1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1],[1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],[1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1],[1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,0,1],[1,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1],[1,1,1,0,0,0,1,0,0,0,3,0,0,0,0,0,1,1,0,0,0,1],[1,0,0,0,0,0,0,1,1,0,0,0,0,1,1,1,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,1,0,1,1,0,0,0,1,1,0,1,0,0,0,0,0,1],[1,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],lv9=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,1],[1,0,0,1,1,1,1,1,0,0,1,1,1,1,1,1,1,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,1],[1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,1,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],[1,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,1,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1],[1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,3,0,0,1],[1,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1],[1,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,0,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,1],[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,0,1,0,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],lvlBoss=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,0,0,0,0,0,0,0,0,2,2,2,0,0,0,0,0,0,0,1,1],[1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1],[1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,4,1,0,1,1],[1,1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1],[1,1,0,1,0,1,0,0,0,1,0,0,0,1,0,0,0,0,1,0,1,1],[1,1,0,1,0,1,0,1,0,0,0,1,0,0,0,1,1,0,1,0,1,1],[1,1,0,1,0,1,0,1,1,1,1,1,1,1,1,1,0,0,1,0,1,1],[1,1,0,1,0,1,0,1,4,1,5,1,2,1,0,0,0,1,1,0,1,1],[1,1,0,1,0,1,0,1,0,1,3,1,0,1,0,1,1,1,1,0,1,1],[1,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,0,1,0,1,1],[1,1,0,1,0,1,0,1,0,1,0,1,0,1,1,1,0,5,1,0,1,1],[1,1,0,1,0,1,0,1,0,0,0,0,0,1,0,5,1,2,1,0,1,1],[1,1,0,1,0,1,0,1,1,1,0,1,1,1,0,1,0,1,1,0,1,1],[1,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,2,1,0,1,1],[1,1,0,1,0,1,1,1,1,1,0,1,1,1,1,1,1,1,1,0,1,1],[1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,1,1],[1,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,0,1,1],[1,1,0,0,0,0,0,0,5,1,0,1,2,0,0,0,0,0,0,0,1,1],[1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],maps=[lv1,lv2,lv3,lv4,lv5,lv6,lv7,lv8,lv9,lvlBoss],mapsDone=[],level,FLOOR,TILE_SIZE=80,Battle,Boss,Char,Enemy,Item,ItemAbout,Maze,Player,StartScreen,battle,enemies=[],maze,player,startScreen,Store,addEnemies,addSpecialTiles,checkMove,checkTile,createBoss,getNewLevel,getTileLoc,moveEnemies,resetLevel,startGame,store;addEnemies=function(){enemies=[];var t,e,s=ENDLESS||HARD_MODE?Math.floor(FLOOR/maps.length):0;maze.numBosses=s;for(var i=0;i<10+s;i++){do{t=Math.floor(Math.random()*(LVL_SIZE-1)+1),e=Math.floor(Math.random()*(LVL_SIZE-1)+1)}while(!checkMove(t,e)||1===t&&1===e);i<10?enemies.push(new Enemy(FLOOR,t,e)):enemies.push(new Boss(FLOOR+5,t,e))}},checkMove=function(t,e){return 1!==maps[level][e][t]},checkTile=function(t,e){switch(maps[level][e][t]){case 0:break;case 2:player.coins+=50*FLOOR,maps[level][e][t]=0,maze.state=4,maze.msgs=["You found "+50*FLOOR+" coins"];break;case 4:player.hp+=5,maps[level][e][t]=0,maze.state=3,maze.msgs=["Found a potion. Recovered 5 hp."];break;case 5:player.hp-=3,maps[level][e][t]=0,maze.state=2,maze.msgs=["Stepped on a trap. lost 3 hp."],player.coins=Math.floor(player.coins/2),player.hp<=0&&maze.msgs.push("You died and lost half your coins.")}},createBoss=function(){enemies.push(new Boss(15,10,11))},getNewLevel=function(){ENDLESS&&FLOOR>0&&resetLevel(),level++,FLOOR++,addEnemies(),ENDLESS&&(level%=maps.length-1),level===maps.length-1?(player.startBoss(),createBoss(),maze.state=5,maze.msgs=["You sense danger is near."]):(player.getNewStart(),addSpecialTiles())},resetLevel=function(){for(var t,e=1;e<LVL_SIZE-2;e++)for(var s=1;s<LVL_SIZE-2;s++)2!==(t=maps[level][e][s])&&4!==t&&5!==t||(maps[level][e][s]=0)},addSpecialTiles=function(){var t,e,s=Math.floor(3*Math.random()),i=Math.floor(3*Math.random()),l=Math.floor(Math.random()*(FLOOR/3)),a=[l,5,i,2,s,4];maze.numHeal=s,maze.numCoins=i,maze.numTrap=l;for(var r=0;r<a.length;r+=2)for(var c=0;c<a[r];c++){do{t=Math.floor(Math.random()*(LVL_SIZE-2)+1),e=Math.floor(Math.random()*(LVL_SIZE-2)+1)}while(0!==maps[level][e][t]);maps[level][e][t]=a[r+1]}},getTileLoc=function(t,e){return-(t-2*TILE_SIZE)/TILE_SIZE},moveEnemies=function(){for(var t=0;t<enemies.length;t++)enemies[t].move()},startGame=function(t){gameState=1,level=-1,FLOOR=0,player=new Player,store=new Store,maze=new Maze,1===t?HARD_MODE=!0:2===t&&(ENDLESS=!0),getNewLevel(),playMaze()},Array.prototype.contains=function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return!0;return!1},Array.prototype.getIndex=function(t){for(var e=0;e<this.length;e++)if(this[e].equals(t))return e;return-1},(Battle=function(t,e,s){this.isBoss=t instanceof Boss,this.playerStart=s,this.state=0,this.isBoss?(playBoss(),this.msgs=["It's a Dragon!"]):s?(this.msgs=["A challenger appeared"],playBattle()):(this.msgs=["Ambushed!"],playBattle()),this.animationTime=60,this.enemy=t,e<0&&(e=enemies.getIndex(t)),this.index=e,gameState=2,this.selected=0,this.actions=["Fight","Run"],this.dmgE=null,this.dmgP=null}).prototype.draw=function(){ctx.beginPath(),ctx.fillStyle="rgb(92, 92, 92)",ctx.rect(0,0,400,400),ctx.fill(),ctx.stroke(),ctx.font="20px Arial",ctx.beginPath(),ctx.fillStyle="rgb(0, 0, 255)",ctx.rect(0,0,80,90),ctx.fill(),ctx.stroke(),ctx.beginPath(),ctx.fillStyle="rgb(255, 0, 0)",ctx.rect(320,0,80,90),ctx.fill(),ctx.stroke(),ctx.fillStyle="rgb(255, 255, 255)",ctx.fillText("Player",10,20),ctx.fillText("HP: "+player.hp,10,40),ctx.fillText("Atk: "+player.atk,10,60),ctx.fillText("Def: "+player.def,10,80),ctx.fillText("Enemy",330,20),ctx.fillText("HP: "+this.enemy.hp,330,40),ctx.fillText("Atk: "+this.enemy.atk,330,60),ctx.fillText("Def: "+this.enemy.def,330,80),player.drawBattle(100,200),this.enemy.drawBattle(300,200),ctx.fillStyle="rgb(0, 0, 0)",ctx.textAlign="center",null!==this.dmgP&&ctx.fillText("-"+this.dmgP,100,205),null!==this.dmgE&&ctx.fillText("-"+this.dmgE,300,205),ctx.textAlign="left",ctx.beginPath(),ctx.fillStyle="rgb(0, 0, 255",ctx.rect(160,325,65,60),ctx.fill(),ctx.stroke();for(t=0;t<this.actions.length;t++)t===this.selected&&(ctx.beginPath(),ctx.fillStyle="rgb(99, 102, 0)",ctx.rect(165,330+25*t,55,25),ctx.fill(),ctx.stroke()),ctx.fillStyle="rgb(255, 255, 255)",ctx.fillText(this.actions[t],170,350+25*t);if(this.msgs.length>0){ctx.beginPath(),ctx.fillStyle="rgb(0, 0, 0)",ctx.rect(0,300,400,100),ctx.fill(),ctx.stroke(),ctx.textAlign="center",ctx.fillStyle="rgb(255, 255, 255)";for(var t=0;t<this.msgs.length;t++)ctx.fillText(this.msgs[t],200,330+20*t);ctx.fillText("Press F",350,380),ctx.textAlign="left"}},Battle.prototype.handleKeyPressed=function(t){if(0===this.msgs.length)switch(t.keyCode){case 70:switch(this.selected){case 0:this.dmgE=this.enemy.hurt(player.attack()),this.msgs=["Enemy took "+this.dmgE+" damage."],this.state=1;break;case 1:this.isBoss?(this.msgs=["Unable to run."],this.state=6):(this.msgs=["You managed to run away."],this.state=5)}break;case 38:--this.selected<0&&(this.selected=this.actions.length-1);break;case 40:this.selected=(this.selected+1)%this.actions.length}else if(70===t.keyCode)switch(this.msgs=[],this.state){case 0:this.playerStart||this.isBoss?this.state=1:(this.dmgE=null,this.dmgP=player.hurt(this.enemy.attack()),this.msgs=["You recieved "+this.dmgP+" damage"],this.state=2);break;case 1:this.enemy.dead?(this.isBoss?this.msgs=["You defeated the dragon."]:this.msgs=["You defeated the enemy."],this.msgs.push("Earned "+this.enemy.prize+" coins."),this.state=3):(this.dmgE=null,this.dmgP=player.hurt(this.enemy.attack()),this.msgs=["You recieved "+this.dmgP+" damage"],this.state=2);break;case 2:this.dmgP=null,player.dead?(this.state=4,player.coins=Math.floor(player.coins/2),this.msgs=["You died and lost half your coins."]):this.state=1;break;case 3:this.win();break;case 4:this.lose();break;case 5:this.run()}},Battle.prototype.lose=function(){gameState=5,player.coins/=2,battle=null,playLose()},Battle.prototype.win=function(){gameState=1,player.coins+=this.enemy.prize,enemies.splice(this.index,1),battle=null,playMaze()},Battle.prototype.run=function(){gameState=1,player.run(),battle=null,playMaze()},(Char=function(t,e,s,i,l){this.hp=t,this.maxHP=t,this.atk=e,this.def=s,this.x=i,this.y=l,this.moveCounter=0,this.moveRate=TILE_SIZE/8,this.dead=!1}).prototype.attack=function(){for(var t=0,e=0;e<this.atk;e++)100*Math.random()<=80&&(t+=1);return t},Char.prototype.hurt=function(t){for(var e=0;e<this.def;e++)100*Math.random()<=33&&t--;return t<=0?0:(this.hp-=t,this.hp<=0&&(this.dead=!0),t)},(Enemy=function(t,e,s){this.levelUp(t),Char.call(this,this.hp,this.atk,this.def,160-e*TILE_SIZE,160-s*TILE_SIZE),this.moving=!1,this.dir="",this.dirs=["u","d","l","r",""]}).prototype=Object.create(Char.prototype),Enemy.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},Enemy.prototype.move=function(){var t=Math.floor(Math.random()*this.dirs.length),e=getTileLoc(this.x,!0),s=getTileLoc(this.y,!1);do{this.dir=this.dirs[t],t=(t+1)%this.dirs.length}while(!this.canMove(this.dir,e,s))},Enemy.prototype.canMove=function(t,e,s){switch(t){case"u":return checkMove(e,s-1);case"d":return checkMove(e,s+1);case"r":return checkMove(e+1,s);case"l":return checkMove(e-1,s);case"":return!0}},Enemy.prototype.levelUp=function(t){var e=HARD_MODE?5:3,s=HARD_MODE?1.5:2,i=HARD_MODE?2:2.5;this.hp=t;for(var l=0;l<t;l++)this.hp+=Math.floor(Math.random()*e);this.atk=Math.floor(t/s),this.def=Math.floor(t/i),this.prize=100*t},Enemy.prototype.draw=function(){if(ctx.beginPath(),ctx.fillStyle=this instanceof Boss?"rgb(71, 0, 0)":"rgb(222, 0, 0)",ctx.arc(200-this.x+player.x,200-this.y+player.y,40,0,2*Math.PI),ctx.fill(),ctx.stroke(),""!==this.dir)if(this.moveCounter<8)switch(this.moveCounter++,this.dir){case"r":this.x-=this.moveRate;break;case"l":this.x+=this.moveRate;break;case"u":this.y+=this.moveRate;break;case"d":this.y-=this.moveRate}else this.dir="",this.moveCounter=0,player.x===this.x&&player.y===this.y&&(battle=new Battle(this,-1,!1))},Enemy.prototype.drawBattle=function(t,e){ctx.beginPath(),ctx.fillStyle="rgb(176, 0, 0)",ctx.arc(t,e,40,0,2*Math.PI),ctx.fill(),ctx.stroke()},(Boss=function(t,e,s){Enemy.call(this,t,e,s),this.dirs=[""],this.prize=200*t}).prototype=Object.create(Enemy.prototype),Boss.prototype.move=function(){player.x===this.x&&player.y===this.y&&(battle=new Battle(this,-1,!1))},(Item=function(t,e,s,i,l){this.name=t,this.desc=e,this.qty=s,this.price=i,this.func=l,this.use=function(){this.func(),this.qty--,player.coins-=this.price}}).prototype.canBuy=function(){return this.price<=player.coins},(Maze=function(){this.state=0,this.selected=0,this.msgs="",this.flashCount=0,this.flashTime=10,this.flashes=["rgba(255, 0, 0, .4)","rgba(0, 255, 255, .4)","rgba(0, 255, 0, .4)","rgba(255, 255, 0, .4)"],this.numHeal=0,this.numCoins=0,this.numTrap=0,this.numBosses=0}).prototype.exit=function(){this.state=1},Maze.prototype.handleKeyPressed=function(t){if(0===this.state)player.handleKeyPressed(t);else if(1===this.state)switch(t.keyCode){case 70:0===this.selected&&(level===maps.length-1?(gameState=4,playVictory()):store.enter()),this.state=0;break;case 38:--this.selected<0&&(this.selected=1);break;case 40:this.selected=(this.selected+1)%2}else 70===t.keyCode&&this.flashCount>this.flashTime&&(this.msgs=[],this.state=0,this.flashCount=0,player.hp<=0&&(gameState=5,player.coins/=2,playLose()))},Maze.prototype.draw=function(){ctx.beginPath(),ctx.fillStyle="rgb(0, 0, 0)",ctx.rect(0,0,400,400),ctx.fill(),ctx.stroke(),this.drawBackground(player.x,player.y),this.state>1&&++this.flashCount<this.flashTime&&(ctx.beginPath(),ctx.fillStyle=this.flashes[this.state-2],ctx.rect(0,0,400,400),ctx.fill(),ctx.stroke());for(t=0;t<enemies.length;t++)enemies[t].draw();if(ctx.font="20px Arial",player.draw(),ctx.beginPath(),ctx.fillStyle="rgba(120, 120, 120, .6)",ctx.rect(125,0,135,53),ctx.fill(),ctx.stroke(),ctx.fillStyle="rgb(255, 255, 255)",ctx.fillText("Coins: "+player.coins,130,20),ctx.fillText("Floor: "+FLOOR,160,45),ctx.beginPath(),ctx.fillStyle="rgba(255, 0, 0, .8)",ctx.rect(280,0,120,30),ctx.fill(),ctx.stroke(),ctx.fillStyle="rgb(255, 255, 255)",ctx.fillText("Enemies: "+enemies.length,285,20),1===this.state&&(ctx.beginPath(),ctx.fillStyle="rgb(0, 0, 0)",ctx.rect(0,300,400,100),ctx.fill(),ctx.stroke(),ctx.beginPath(),ctx.fillStyle="rgb(140, 140, 0)",ctx.rect(180,335+25*this.selected,40,25),ctx.fill(),ctx.stroke(),ctx.textAlign="center",ctx.fillStyle="rgb(255, 255, 255)",ctx.fillText("Proceed to next floor?",200,330),ctx.fillText("Yes",200,355),ctx.fillText("No",200,380),ctx.textAlign="left"),this.state>1&&this.flashCount>this.flashTime){ctx.beginPath(),ctx.fillStyle="rgb(0, 0, 0)",ctx.rect(0,300,400,100),ctx.fill(),ctx.stroke(),ctx.textAlign="center",ctx.fillStyle="rgb(255, 255, 255)";for(var t=0;t<this.msgs.length;t++)ctx.fillText(this.msgs[t],200,350+20*t);ctx.textAlign="left"}},Maze.prototype.drawBackground=function(t,e){for(var s=Math.round(getTileLoc(t,!0)),i=Math.round(getTileLoc(e,!1)),l=i-3;l<=i+3;l++)for(var a=s-3;a<=s+3;a++)if(l>=0&&l<LVL_SIZE&&a>=0&&a<LVL_SIZE){switch(ctx.beginPath(),maps[level][l][a]){case 1:ctx.fillStyle="rgb(69, 69, 69)";break;case 0:case 2:ctx.fillStyle="rgb(201, 201, 201)";break;case 3:ctx.fillStyle="rgb(255, 255, 0)";break;case 4:case 5:ctx.fillStyle="rgb(201, 201, 201)"}ctx.rect(t+80*a,e+80*l,80,80),ctx.fill(),ctx.stroke()}},(Player=function(){Char.call(this,15,2,1,80,80),this.moveCounter=0,this.moveRate=TILE_SIZE/8,this.startX=80,this.startY=80,this.moving=!1,this.dir="",this.coins=0,this.tx=0,this.ty=0}).prototype=Object.create(Char.prototype),Player.prototype.getNewStart=function(){var t=Math.round(Math.random()),e=Math.round(Math.random());this.x=t?160-80*(LVL_SIZE-2):80,this.y=e?160-80*(LVL_SIZE-2):80,this.startX=this.x,this.startY=this.y},Player.prototype.startBoss=function(){this.x=-640,this.y=-1440,this.startX=this.x,this.startY=this.y},Player.prototype.run=function(){this.x=this.startX,this.y=this.startY},Player.prototype.handleKeyPressed=function(t){if(""===this.dir){var e=getTileLoc(this.x,!0),s=getTileLoc(this.y,!1);switch(t.keyCode){case 39:checkMove(e+1,s)&&(this.dir="r");break;case 37:checkMove(e-1,s)&&(this.dir="l");break;case 38:checkMove(e,s-1)&&(this.dir="u");break;case 40:checkMove(e,s+1)&&(this.dir="d")}}},Player.prototype.draw=function(){if(ctx.beginPath(),ctx.arc(200,200,40,0,2*Math.PI),ctx.fillStyle="rgb(29, 25, 153)",ctx.fill(),ctx.stroke(),ctx.beginPath(),ctx.fillStyle="rgb(0, 0, 255, 150)",ctx.rect(0,0,105,65),ctx.fill(),ctx.stroke(),ctx.fillStyle="rgb(255, 255, 255)",ctx.fillText("HP: "+this.hp+"/"+this.maxHP,10,20),ctx.fillText("Atk:  "+this.atk,10,40),ctx.fillText("Def:  "+this.def,10,60),""!==this.dir)if(this.moveCounter<8)switch(this.moveCounter++,this.dir){case"r":this.x-=this.moveRate;break;case"l":this.x+=this.moveRate;break;case"u":this.y+=this.moveRate;break;case"d":this.y-=this.moveRate}else if(this.dir="",this.moveCounter=0,this.tx=getTileLoc(this.x,!0),this.ty=getTileLoc(this.y,!1),3===maps[level][this.ty][this.tx])maze.exit();else{checkTile(this.tx,this.ty);for(var t=0;t<enemies.length;t++)enemies[t].x===this.x&&enemies[t].y===this.y&&(battle=new Battle(enemies[t],t,!0),t=enemies.length);moveEnemies()}},Player.prototype.drawBattle=function(t,e){ctx.beginPath(),ctx.arc(t,e,40,0,2*Math.PI),ctx.fillStyle="rgb(29, 25, 153)",ctx.fill(),ctx.stroke()},(StartScreen=function(){this.actions=["New Game","Hard Mode","Endless","Story"],this.selected=0,this.story=!1,this.storyText=["Welcome, Challenger, ","to the maze of riches.","To the one who conquers the maze,","glory and honour await.","Many have attempted the maze and","many still aim to conquer it.","From those who have gone before, you","have learned these things about the maze.","1. It is filled with treasure hunters","who get stronger the deeper you go.","2. There is a rest area between levels","of the maze where a merchant dwells.","3. There are left over riches and potions","from warriors who have gone before.","4. Rumours speak of a terrible challenge","before the reward may be claimed."]}).prototype.draw=function(){if(ctx.beginPath(),ctx.fillStyle="rgb(92, 92, 92)",ctx.rect(0,0,400,400),ctx.fill(),ctx.stroke(),this.story){ctx.beginPath(),ctx.fillStyle="rgb(0, 0, 255)",ctx.rect(20,0,360,400),ctx.fill(),ctx.stroke(),ctx.fillStyle="rgb(255, 255, 255)",ctx.font="18px Arial";for(t=0;t<this.storyText.length;t+=2)ctx.fillText(this.storyText[t],30,20+25*t),ctx.fillText(this.storyText[t+1],30,40+25*t)}else{ctx.fillStyle="rgb(255,255,255)",ctx.textAlign="center",ctx.font="40px Arial",ctx.fillText("Greedy Circles",200,100),ctx.font="30px Arial",ctx.fillText("The maze of riches",200,150),ctx.font="20px Arial",ctx.fillText("Use arrow keys to move",200,230),ctx.fillText("and f to confirm action",200,250),ctx.font="12px Arial",ctx.beginPath(),ctx.fillStyle="rgb(0, 0, 255)",ctx.rect(160,275,80,110),ctx.fill(),ctx.stroke();for(var t=0;t<this.actions.length;t++)t===this.selected&&(ctx.beginPath(),ctx.fillStyle="rgb(99, 102, 0)",ctx.rect(165,280+25*t,70,25),ctx.fill(),ctx.stroke()),ctx.fillStyle="rgb(255, 255, 255)",ctx.fillText(this.actions[t],200,298+25*t);ctx.textAlign="left"}},StartScreen.prototype.handleKeyPressed=function(t){switch(t.keyCode){case 70:this.story?this.story=!1:3!==this.selected?startGame(this.selected):this.story=!0;break;case 38:if(this.story)return;--this.selected<0&&(this.selected=this.actions.length-1);break;case 40:if(this.story)return;this.selected=(this.selected+1)%this.actions.length}},(Store=function(){this.selected=0,this.confirm=!1,this.confirmSel=0,this.warning=!1,this.state=0,this.items=[new Item("HP +5","Raise max HP by 5",5,1e3,function(){player.maxHP+=5,player.hp+=5}),new Item("Attack +1","Raise attack by 1",4,1200,function(){player.atk+=1}),new Item("Attack +2","Raise attack by 2",3,2200,function(){player.atk+=2}),new Item("Defence +1","Raise defence by 1",4,800,function(){player.def+=1}),new Item("Defence +2","Raise defence by 2",3,1800,function(){player.def+=2})],this.msgs=["Welcome."]}).prototype.close=function(){gameState=1,playMaze()},Store.prototype.enter=function(){getNewLevel(),this.msgs=["Welcome."],this.state=0,this.selected=0,this.items.length>1&&"Info"===this.items[1].name&&this.items.splice(1,1),this.items.length>0&&("HP refill"===this.items[0].name||"Info"===this.items[0].name)&&this.items.splice(0,1),this.items.unshift(new Item("Info","Get info about the next level",1,300,function(){store.explainLvl()})),this.items.unshift(new Item("HP refill","Restore all HP (costs half your coins)",1,Math.floor(player.coins/2),function(){player.hp=player.maxHP})),gameState=3,playShop()},Store.prototype.explainLvl=function(){this.state=1,level!==maps.length-1?(this.msgs=["The next level contains:"],this.msgs.push(maze.numHeal+" potions"),this.msgs.push(maze.numCoins+" coin stashes"),maze.numBosses>0&&this.msgs.push(maze.numBosses+" monsters"),maze.numTrap>0&&this.msgs.push("And a few suprises. heheheh")):(this.msgs=["You are near the end, yes... "],this.msgs.push("But will you survive? hehehe"))},Store.prototype.draw=function(){if(ctx.beginPath(),ctx.fillStyle="rgb(99, 99, 99)",ctx.rect(0,0,400,400),ctx.fill(),ctx.stroke(),ctx.textAlign="center",ctx.font="20px Arial",ctx.fillStyle="rgb(255, 255, 255)",ctx.fillText("Coins: "+player.coins,200,30),ctx.textAlign="left",ctx.font="14px Arial",this.items.length>0){ctx.beginPath(),ctx.fillStyle="rgb(0, 0, 255)",ctx.rect(50,50,300,40*this.items.length),ctx.fill(),ctx.stroke(),ctx.beginPath(),ctx.fillStyle="rgb(99, 102, 0)",ctx.rect(50,50+40*this.selected,300,42),ctx.fill(),ctx.stroke();for(t=0;t<this.items.length;t++)ctx.fillStyle="rgb(255, 255, 255)",ctx.fillText(this.items[t].name,60,70+40*t),ctx.fillText("qty: "+this.items[t].qty,180,70+40*t),ctx.fillText("Price: "+this.items[t].price,250,70+40*t),ctx.fillText(this.items[t].desc,80,85+40*t)}else ctx.beginPath(),ctx.fillStyle="rgba(74, 74, 74, .9)",ctx.rect(50,150,300,100),ctx.fill(),ctx.stroke(),ctx.font="26px Arial",ctx.fillStyle="rgb(255, 255, 255)",ctx.fillText("I have nothing left to sell.",60,200),this.selected=7,ctx.beginPath(),ctx.fillStyle="rgb(99, 102, 0)",ctx.rect(50,50+40*this.selected,300,42),ctx.fill(),ctx.stroke();if(ctx.fillStyle="rgb(255, 255, 255)",ctx.textAlign="center",ctx.font="30px Arial",ctx.fillText("Finish Shopping",200,360),this.confirm?(ctx.beginPath(),ctx.fillStyle="rgba(74, 74, 74, 0.9)",ctx.rect(50,150,300,100),ctx.fill(),ctx.stroke(),ctx.beginPath(),ctx.fillStyle="rgb(135, 135, 0)",ctx.rect(175,188+30*this.confirmSel,50,25),ctx.fill(),ctx.stroke(),ctx.font="26px Arial",ctx.fillStyle="rgb(255, 255, 255)",ctx.fillText("Purchase "+this.items[this.selected].name+"?",200,180),ctx.fillText("Yes",200,210),ctx.fillText("No",200,240)):this.warning&&(ctx.beginPath(),ctx.fillStyle="rgb(74, 74, 74)",ctx.rect(30,150,340,100),ctx.fill(),ctx.stroke(),ctx.font="26px Arial",ctx.fillStyle="rgb(255, 0, 0)",ctx.fillText("Funds are too low to buy",200,180),ctx.fillText(this.items[this.selected].name,200,200)),this.msgs.length>0){ctx.beginPath(),ctx.fillStyle="rgb(74, 74, 74)",ctx.rect(30,50,340,300),ctx.fill(),ctx.stroke(),ctx.beginPath(),ctx.fillStyle="rgb(0, 255, 0)",ctx.arc(80,100,40,0,2*Math.PI),ctx.fill(),ctx.stroke(),ctx.font="26px Arial",ctx.fillStyle="rgb(255, 255, 255)";for(var t=0;t<this.msgs.length;t++)ctx.fillText(this.msgs[t],200,170+26*t)}ctx.textAlign="left"},Store.prototype.handleKeyPressed=function(t){switch(t.keyCode){case 70:if(this.msgs.length>0)return 2===this.state?this.close():this.state=1,void(this.msgs=[]);7===this.selected?(this.state=2,this.msgs=["Thanks for coming."]):this.warning?this.warning=!1:this.confirm?(0===this.confirmSel&&(this.items[this.selected].use(),0===this.items[this.selected].qty&&(this.items.splice(this.selected,1),this.selected=0)),this.confirm=!1):this.items[this.selected].canBuy()?this.confirm=!0:this.warning=!0;break;case 38:if(0===this.items.length)return;this.confirm?0===this.confirmSel?this.confirmSel=1:this.confirmSel=0:7===this.selected?this.selected=this.items.length-1:--this.selected<0&&(this.selected=7);break;case 40:if(0===this.items.length)return;this.confirm?0===this.confirmSel?this.confirmSel=1:this.confirmSel=0:7===this.selected?this.selected=0:this.selected===this.items.length-1?this.selected=7:this.selected++}},player=new Player,startScreen=new StartScreen,store=new Store,maze=new Maze;var moveCounter=0,moveX=10,moving=!1,kPressed=function(t){0===gameState?startScreen.handleKeyPressed(t):2===gameState?battle.handleKeyPressed(t):3===gameState?store.handleKeyPressed(t):4===gameState||5===gameState?70===t.keyCode&&(gameState=0,playTitle()):maze.handleKeyPressed(t)},draw=function(){if(0===gameState&&startScreen.draw(),1===gameState&&maze.draw(),2===gameState&&battle.draw(),3===gameState&&store.draw(),4===gameState){ctx.beginPath(),ctx.fillStyle="rgb(145, 145, 145)",ctx.rect(0,0,400,400),ctx.fill(),ctx.stroke(),ctx.fillStyle="rgb(255, 255, 0)",ctx.font="50px Arial",ctx.fillText("Congratulations",30,150),ctx.font="40px Arial",ctx.fillStyle="rgb(255, 255, 255)",ctx.fillText("Your coins",100,210),ctx.textAlign="center",ctx.fillText(player.coins,200,250),ctx.textAlign="left",ctx.font="20px Arial";var t;HARD_MODE?player.coins<1e4?t=["Get over 10000 coins to unlock","a secret message."]:(t=["The maze features the japanese words"]).push("北, 南, 東, 西, 電車,","日本, 東京, 夏, 二千二十年"):ENDLESS?player.coins>2e4?((t=["The words in the maze translate to"]).push("North, South, East, West, Train,","Japan, Tokyo, Summer, Year 2020."),t.push("Don't miss the Tokyo, Japan","2020 Summer Olympics!")):t=["Get a over 20000 coins to unlock","a secret message."]:t=["Awesome job. Now try Hard Mode."];for(var e=0;e<t.length;e++)ctx.fillText(t[e],20,300+20*e)}5===gameState&&(ctx.beginPath(),ctx.fillStyle="rgb(0, 0, 0)",ctx.rect(0,0,400,400),ctx.fill(),ctx.stroke(),ctx.fillStyle="rgb(255, 0, 0)",ctx.font="50px Arial",ctx.fillText("Game Over",65,150),ctx.font="40px Arial",ctx.fillStyle="rgb(255, 255, 255)",ctx.fillText("Your coins",100,250),ctx.textAlign="center",ctx.fillText(player.coins,200,300),ctx.textAlign="left")};playTitle(),setInterval(function(){draw()},16);