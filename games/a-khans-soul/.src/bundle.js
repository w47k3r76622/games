(()=>{"use strict";var t={823:(t,e,s)=>{s.r(e)},607:function(t,e,s){var n=this&&this.__awaiter||function(t,e,s,n){return new(s||(s=Promise))((function(i,o){function a(t){try{l(n.next(t))}catch(t){o(t)}}function r(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(a,r)}l((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});class i{constructor(t,e){this.eType="",this.ID=Math.random().toString(36).substr(2,9),this.stage=t,this.components=e.reduce(((t,e)=>Object.assign(Object.assign({},t),{[e.type]:[e]})),{})}initComponent(t){const e=this;this.components[t].forEach((t=>{t.onInit&&t.onInit(e)}))}componentList(){return Object.keys(this.components).map((t=>this.components[t]))}getComponent(t){var e;return(null===(e=this.components[t])||void 0===e?void 0:e[0])||null}addComponents(t){t.forEach((t=>this.addComponent(t)))}addComponent(t){this.components[t.type]||(this.components[t.type]=[]),this.components[t.type].push(t)}replaceComponent(t){this.components[t.type]=[t]}render(t,e=[0,0]){this.componentList().forEach((s=>s.forEach((s=>s.onRender?s.onRender(this,t,e):null))))}onUpdateStart(t,e){}onUpdateEnd(t,e){}update(t,e){null==this||this.onUpdateStart(t,e),this.componentList().forEach((s=>{s.forEach((s=>s.onUpdate?s.onUpdate(this,t,e):null))})),null==this||this.onUpdateStart(t,e)}onCollide(t){throw new Error("Method not implemented.")}destroy(){this.componentList().forEach((t=>t.forEach((t=>(null==t?void 0:t.onTerminate)&&(null==t?void 0:t.onTerminate(this))))))}init(){this.componentList().forEach((t=>t.forEach((t=>this.initComponent(t.type)))))}}class o{constructor(t,e=[0,0]){this.type="pos",this.p=t,this.direction=1}}class a{constructor(t,e=[0,0],s=[200,200],n=1){this.a=[0,0],this.maxA=[10,10],this.collisionSensors=[null,null,null,null],this.type="pos",this.p=t,this.lp=t,this.v=e,this.direction=n,this.maxSpeed=s}accelerate(t){this.a=f(this.a,t)}stopDir(t){this.a[0]=t[0]?0:this.a[0],this.a[1]=t[1]?0:this.a[1]}onUpdate(t,e,s){const{solid:n}=t.getComponent("coll"),i=this.maxSpeed;let{p:[o,a],v:[r,l],a:[h,d]}=this;this.lp[0]=o,this.lp[1]=a,r+=h,l+=d,r=Math.abs(r)>i[0]?i[0]*Math.sign(r):r,l=Math.abs(l)>i[1]?i[1]*Math.sign(l):l;const[c,p,m,g]=this.collisionSensors,f={d:null},[{d:v},{d:_},{d:b},{d:C}]=[null!=c?c:f,null!=p?p:f,null!=m?m:f,null!=g?g:f];let y=u(l,e),w=u(r,e);const x=(t,e)=>null!==t&&Math.abs(e)>Math.abs(t);n&&(y>0&&x(b,y)?(y=b*Math.sign(y),l=0):y<0&&x(v,y)&&(y=v*Math.sign(y),l=0),w>0&&x(_,w)?(w=_*Math.sign(w),r=0):w<0&&x(C,w)&&(w=C*Math.sign(w),r=0)),this.a=[0,0],this.v=[r,l],this.p=[o+w,a+y]}}class r{constructor(t,e){this.posModifiers=[0,0],this.collisions=[],this.solid=!0,this.type="coll",this.box=t,this.trigger=!0,this.onCollideFn=e,this.isColliding=!1}onInit(t){var e;this.onCollide=(null===(e=this.onCollideFn)||void 0===e?void 0:e.bind(t))||null,this.boxPos=t.getComponent("pos").p}onUpdate(t,e,s){const[n,i]=t.getComponent("pos").p;this.boxPos=[n+this.posModifiers[0],i+this.posModifiers[1]]}}class l{constructor(t,e,s=0){this.imgPos=[0,0],this.type="rnd",this.sprite=t,this.renderPriority=s,this.sAnim(e)}onInit(t){this.stage=t.stage}sAnim(t){this.time=0,this.currentFrame=0,this.cA=t}onRender(t,e,s){const n=t.getComponent("pos").p;if(!n)throw new Error("PositionComponent not found");const[i,o]=n,a=this.sprite[this.cA];this.time+=e,this.time>a.changeTime&&(this.time=0,this.currentFrame=(this.currentFrame+1)%a.frames.length);const r=this.stage.ctx;r.beginPath(),r.drawImage(a.frames[this.currentFrame],i+s[0]+this.imgPos[0],o+s[1]+this.imgPos[1],a.frames[this.currentFrame].width,a.frames[this.currentFrame].height),r.closePath()}}class h{constructor(t,e=99){this.type="rnd",this.image=t,this.renderPriority=e}onInit(t){this.stage=t.stage}onRender(t,e,s){const n=t.getComponent("pos").p;this.stage.ctx.drawImage(this.image,n[0]+s[0],n[1]+s[1])}}class d{constructor(t=1,e=null){this.type="grv",this.gravity=9.8*t,this.ev=e||100*t}onUpdate(t,e){t.getComponent("pos").accelerate([0,this.gravity])}}class c{constructor(t){this.behavior={},this.removers={},this.type="menu",this.selector=t,this.el=document.querySelector(t)}addListener(t,e,s="click"){this.behavior[t]={cb:e,t:s}}onInit(t){for(let t of Object.keys(this.behavior)){const e=this.el.querySelector(t),s=this.behavior[t];e&&e.addEventListener(s.t,s.cb)}this.show()}show(){this.el.classList.remove("h")}hide(){this.el.classList.add("h")}onTerminate(){this.hide()}}class p{constructor(t){this.type="html",this.selector=t}onInit(t){if(this.el=document.querySelector(this.selector),!this.el)throw new Error(`Element ${this.selector} not found`)}show(){this.el.classList.remove("h")}hide(){this.el.classList.add("h")}}class m{constructor(t={},e={}){this.type="ctl",this.downListener=t,this.upListener=e}onInit(t){document.addEventListener("keydown",(t=>{for(let e of Object.keys(this.downListener))e===t.key&&this.downListener[e](t)})),document.addEventListener("keyup",(t=>{for(let e of Object.keys(this.upListener))e===t.key&&this.upListener[e](t)}))}}const u=(t,e)=>Math.round(t*(e/1e3)),g=(t,e)=>t.map((t=>t*e)),f=(t,e)=>t.map(((t,s)=>t+e[s])),v=(t,e,s)=>{var n;const[i,o]=e,a=null===(n=t.getComponent("pos"))||void 0===n?void 0:n.p;if(!a)return!0;const r=[a[0]+i,a[1]+o],l=200,{width:h,height:d}=s;return!(r[0]<-200||r[0]>h+l||r[1]<-200||r[1]>d+l)};class _{constructor(t){this._lastCall=t,this._limit=t}call(t,e){this._lastCall+=t,this._lastCall>this._limit&&(this._lastCall=0,e())}update(t){this._lastCall+=t}}class b{constructor(t,e){this._lived=0,this._ttl=t,this._onExpire=e}update(t){this._lived+=t,this._lived>this._ttl&&this._onExpire()}}const C=t=>Math.floor((t-400)/100),y="#f6f4f1",w="#CF9FFF",x="#9F2B68",E="#3098c1",k="#187194",L="#642209",T={idle_1:[[0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,2,2,0,0,0,0,2,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,1,0,0,0,2,2,2,2,0,0,2,2,0,0,2,2,0,0,2,2,0,0,0],[0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,2,2,0,0,2,0,0,2,0,0,2,2,0,0,0,0],[0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,2,2,3,3,3,3,3,3,2,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,3,3,3,3,4,4,4,4,3,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,3,3,5,3,3,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,0,3,3,5,5,3,4,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,3,2,2,2,2,3,4,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,2,2,5,5,5,3,4,3,3,4,4,3,3,2,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,3,4,4,4,4,4,4,3,0,2,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,2,2,2,3,4,4,4,4,3,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,2,2,5,5,3,4,4,4,4,3,4,3,2,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,3,3,3,5,5,5,3,4,4,4,4,3,4,3,0,2,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,3,3,3,5,5,5,5,5,3,4,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,3,3,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,3,3,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,6,3,3,4,4,3,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,6,5,3,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,5,5,5,5,5,5,5,6,6,5,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,5,5,5,5,5,5,5,5,6,2,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,5,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,0,0,0,3,5,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0]],idle_2:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,2,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,0,0,0,0,0,2,2,0,0,0,2,2,0,0,2,2,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,2,2,0,0,0,2,0,0,2,0,0,0,2,2,0,0,0],[0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,2,2,0,0,2,0,0,2,0,0,2,2,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,2,2,3,3,3,3,3,3,2,2,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,3,3,3,3,7,7,8,8,3,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,3,3,5,3,3,7,8,8,8,8,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,2,3,3,5,5,3,8,7,8,4,8,8,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,2,2,2,2,2,3,8,7,8,8,8,8,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,3,8,3,3,8,8,3,3,2,2,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,3,8,8,8,8,8,8,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,2,2,2,2,3,8,8,8,7,3,8,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,3,8,8,8,7,3,8,3,2,2,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,3,3,3,3,3,5,5,5,3,8,8,8,7,3,8,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,3,8,8,8,8,8,8,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,3,3,8,8,8,8,8,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,3,3,8,8,8,8,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,6,3,3,8,8,3,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,6,5,3,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,5,5,5,5,5,5,5,6,6,5,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,5,5,5,5,5,5,5,5,6,2,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,5,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,5,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0]],run_1:[[0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,2,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,1,1,2,2,0,0,2,2,2,0,0,0,2,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,2,0,0,0,2,0,0,2,2,0,0,2,2,2,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,2,2,0,3,3,3,3,3,3,2,2,2,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,3,3,3,3,4,4,4,4,3,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,3,3,5,3,3,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,1,0,0,3,3,5,5,3,4,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,1,0,0,3,5,2,2,2,3,4,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,1,0,3,5,2,2,5,5,3,4,3,3,4,4,3,3,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,1,0,0,3,5,2,5,5,5,3,4,4,4,4,4,4,3,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,1,0,0,3,5,5,5,5,2,3,4,4,4,4,3,4,3,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,0,0,0,3,5,5,5,2,2,3,4,4,4,4,3,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,1,0,0,3,3,3,3,2,2,5,3,4,4,4,4,3,4,3,2,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,3,3,3,5,5,2,5,5,3,4,4,4,4,4,4,3,2,2,0,0,0,0],[0,0,0,0,0,0,1,1,0,0,0,0,3,5,5,5,5,5,3,3,4,4,4,4,4,3,0,2,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,3,5,5,5,5,5,5,3,3,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,1,1,0,0,0,0,0,3,5,5,5,5,5,5,6,3,3,4,4,3,3,0,0,0,0,0,0],[0,0,0,0,0,1,0,0,0,0,0,0,3,5,5,5,5,5,5,6,5,3,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,1,1,0,0,0,0,0,3,5,5,5,5,5,5,5,6,6,2,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,1,0,0,0,0,0,0,3,5,5,5,5,5,5,5,5,5,5,3,0,3,3,3,0,0,0,0,0],[0,0,0,1,1,0,0,0,0,0,0,3,5,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0],[0,0,0,1,0,0,0,0,0,0,0,3,5,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0],[0,0,1,1,0,0,0,0,0,0,0,3,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,3,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0,0],[0,1,1,0,0,0,0,0,0,0,0,3,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0,0],[0,1,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0],[0,1,0,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,3,3,3,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0]],fire:[[0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,2,2,0,0,0,0,2,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,1,0,0,0,2,2,2,2,0,0,2,2,0,0,2,2,0,0,2,2,0,0,0],[0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,2,2,0,0,2,0,0,2,0,0,2,2,0,0,0,0],[0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,2,2,3,3,3,3,3,3,2,2,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,3,3,3,3,4,4,4,4,3,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,3,3,5,3,3,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,0,3,3,5,5,3,4,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,0,3,2,2,2,2,3,4,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,2,2,5,5,5,3,4,3,3,4,4,3,3,2,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,3,4,4,4,4,4,4,3,0,2,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,2,2,2,3,4,4,4,4,3,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,2,2,5,5,3,4,4,4,4,3,4,3,2,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,3,3,3,5,5,5,3,4,4,4,4,3,4,3,0,2,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,3,3,3,5,5,5,5,5,3,4,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,3,3,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,3,3,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,6,3,3,4,4,3,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,6,5,3,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,5,5,5,5,5,5,5,6,6,5,3,3,0,0,3,3,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,5,5,5,5,5,5,5,5,6,2,3,3,3,3,3,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0,0,3,5,5,5,5,5,5,5,5,5,5,3,0,0,0,3,3,0,0,0,0],[0,0,0,0,0,0,1,1,0,0,0,3,5,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,3,5,5,5,5,5,5,5,5,5,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0]],roll_1:[[0,0,0,0,0,0,0,0,0,0,0,2,2,0,0,0,0,2,2,0,0,0,0],[0,0,0,0,0,0,0,2,2,2,0,0,2,2,0,0,2,2,0,0,1,1,1],[0,0,0,0,0,0,0,0,0,2,2,0,0,2,0,0,2,0,0,2,1,0,1],[0,0,0,0,0,0,0,0,0,0,2,2,3,3,3,3,3,3,2,1,1,1,1],[0,0,0,0,0,0,0,0,0,3,3,3,3,4,4,4,4,1,1,1,0,0,0],[0,0,0,0,0,0,0,0,3,3,5,3,3,4,4,4,1,1,1,0,0,0,0],[0,0,0,0,0,0,3,3,3,5,5,3,4,4,4,1,1,4,3,0,0,0,0],[0,0,0,0,0,3,3,3,2,2,2,3,4,4,1,1,4,4,3,0,0,0,0],[0,0,0,0,0,3,2,2,5,5,5,3,4,1,1,4,4,3,3,2,0,0,0],[0,0,0,0,0,3,5,5,5,5,5,3,1,1,4,4,4,4,3,0,2,0,0],[0,0,0,0,0,3,5,5,2,2,2,1,1,4,4,4,3,4,3,0,0,0,0],[0,0,0,0,0,3,3,5,5,5,1,1,4,4,4,4,3,4,3,2,0,0,0],[0,0,0,0,0,3,3,3,5,1,1,3,4,4,4,4,3,4,3,0,2,0,0],[0,0,0,0,0,3,5,3,3,1,5,3,4,4,4,4,4,4,3,0,0,0,0],[0,0,0,0,0,3,5,1,3,5,5,3,3,4,4,4,4,4,3,0,0,0,0],[0,0,0,0,0,3,1,1,5,5,5,5,3,3,4,4,4,4,3,0,0,0,0],[0,0,0,0,1,3,1,5,5,5,5,5,6,3,3,4,4,3,3,0,0,0,0],[0,0,0,1,1,3,5,5,5,5,5,3,6,5,3,3,3,3,0,0,0,0,0],[0,0,1,1,0,3,3,5,5,5,5,5,5,5,3,3,3,0,0,0,0,0,0],[0,1,1,0,0,0,3,3,5,5,5,5,5,3,3,0,0,0,0,0,0,0,0],[1,1,0,0,0,0,0,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],bolt_1:[[0,0,0,0,0,0,9,9,9,0],[0,0,0,0,0,9,10,10,10,9],[0,0,0,0,9,10,10,10,10,9],[0,0,9,9,10,10,10,11,11,9],[0,9,10,10,10,10,10,11,11,9],[0,9,10,10,10,10,10,11,11,9],[0,0,9,9,10,10,10,11,11,9],[0,0,0,0,9,10,10,10,10,9],[0,0,0,0,0,9,10,10,10,9],[0,0,0,0,0,0,9,9,9,0]],bolt_2:[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,9,9,9,9,0],[0,0,0,0,9,10,10,10,10,9],[0,0,0,9,10,10,10,11,11,9],[0,0,9,10,10,10,10,11,11,9],[0,0,9,10,10,10,10,11,11,9],[0,0,0,9,10,10,10,11,11,9],[0,0,0,0,9,10,10,10,10,9],[0,0,0,0,0,9,9,9,9,0],[0,0,0,0,0,0,0,0,0,0]],en_idle_1:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,12,12,12,12,0,0,0,0,0,12,12,12,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,12,12,12,12,0,0,0,0,0,12,12,12,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,12,12,12,12,0,0,0,0,0,0,12,12,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,12,12,0,0,0,0,0,12,12,12,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,12,12,0,0,0,0,0,12,12,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,12,3,3,3,3,3,3,12,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,13,13,13,13,3,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,14,3,3,13,13,13,13,13,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,14,14,3,13,13,13,13,13,13,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,3,14,14,14,14,3,13,13,13,13,13,13,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,14,14,14,14,14,3,13,3,3,13,13,3,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,14,14,14,14,14,3,13,13,13,13,13,13,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,14,14,14,14,14,3,13,13,13,13,13,13,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,14,14,14,14,14,3,13,13,13,13,13,13,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,14,14,3,3,14,3,13,13,13,13,13,13,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,14,3,3,14,14,3,13,13,13,13,13,13,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,14,3,14,14,14,3,3,13,13,13,13,13,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,14,3,14,14,14,14,3,3,13,13,13,13,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,14,3,14,3,3,14,14,3,3,13,13,3,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,14,3,3,3,14,14,14,14,3,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,14,14,14,14,3,3,14,14,14,14,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,14,14,14,14,14,14,14,14,14,14,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,14,14,14,14,14,14,14,14,14,14,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,14,14,14,14,14,14,14,14,14,14,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,14,14,14,14,14,14,14,14,14,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,14,14,14,14,14,14,14,14,14,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,14,14,14,14,14,14,14,14,14,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0]],en_idle_2:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,12,12,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,12,12,12,12,12,12,0,0,0,0,12,12,12,12,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,12,12,12,12,12,12,0,0,0,0,0,12,12,12,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,12,12,0,0,0,0,12,12,12,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,12,3,3,3,3,3,3,12,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,13,13,13,13,3,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,14,3,3,13,13,13,13,13,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,14,14,3,13,13,13,13,13,13,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,3,14,14,14,14,3,13,13,13,13,13,13,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,14,14,14,14,14,3,13,3,3,13,13,3,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,14,14,14,14,14,3,13,13,13,13,13,13,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,14,14,14,14,14,3,13,13,13,13,13,13,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,14,14,14,14,14,3,13,13,13,13,13,13,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,14,14,3,3,14,3,13,13,13,13,13,13,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,14,3,3,14,14,3,13,13,13,13,13,13,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,14,3,14,14,14,3,3,13,13,13,13,13,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,14,3,14,14,14,14,3,3,13,13,13,13,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,14,3,14,14,14,14,14,3,3,13,13,3,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,14,3,14,14,14,14,14,14,3,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,14,14,3,14,3,3,14,14,14,14,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,14,14,3,3,3,14,14,14,14,14,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,14,14,14,14,3,3,14,14,14,14,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,14,14,14,14,14,14,14,14,14,14,3,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,14,14,14,14,14,14,14,14,14,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,14,14,14,14,14,14,14,14,14,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,14,14,14,14,14,14,14,14,14,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0]],bolt_exp_1:[[0,0,0,9,9,9,9,9,0,0,0],[0,9,9,10,10,10,10,10,9,9,0],[0,9,10,10,10,10,10,10,10,9,0],[9,10,10,10,11,11,11,10,10,10,9],[9,10,10,11,11,11,11,11,10,10,9],[9,10,10,11,11,11,11,11,10,10,9],[9,10,10,11,11,11,11,11,10,10,9],[9,10,10,10,11,11,11,10,10,10,9],[0,9,10,10,10,10,10,10,10,9,0],[0,9,9,10,10,10,10,10,9,9,0],[0,0,0,9,9,9,9,9,0,0,0]],bolt_exp_3:[[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,9,9,9,9,9,0,0,0],[0,0,9,10,10,10,10,10,9,0,0],[0,0,9,10,10,10,10,10,9,0,0],[0,0,9,10,10,11,10,10,9,0,0],[0,0,9,10,10,10,10,10,9,0,0],[0,0,9,10,10,10,10,10,9,0,0],[0,0,0,9,9,9,9,9,0,0,0],[0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0]],life:[[0,0,0,3,3,3,3,3,0,0,0,0,3,3,3,3,3,0,0,0],[0,0,3,2,2,2,2,2,3,0,0,3,2,2,2,2,2,3,0,0],[0,3,2,2,2,2,2,2,2,3,3,2,2,2,2,2,2,2,3,0],[3,2,2,2,2,2,2,2,2,2,2,2,2,2,4,4,2,2,2,3],[3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,4,2,2,3],[3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,2,2,3],[3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3],[3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3],[3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3],[3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3],[3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3],[0,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,0],[0,0,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,0,0],[0,0,0,3,2,2,2,2,2,2,2,2,2,2,2,2,3,0,0,0],[0,0,0,0,3,2,2,2,2,2,2,2,2,2,2,3,0,0,0,0],[0,0,0,0,0,3,2,2,2,2,2,2,2,2,3,0,0,0,0,0],[0,0,0,0,0,0,3,2,2,2,2,2,2,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,2,2,2,2,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,3,2,2,3,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,0,0]],dem_1:[[0,0,0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,3,4,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,3,4,4,4,4,4,4,4,4,3,0,0,0,0,0],[0,0,0,0,3,4,4,4,4,4,4,4,4,4,4,3,0,0,0,0],[0,0,0,3,4,4,4,4,4,4,4,4,4,4,4,4,3,0,0,0],[0,0,0,3,4,4,3,4,4,4,4,3,4,4,4,4,3,0,0,0],[0,0,0,3,4,4,3,4,4,4,4,3,4,4,4,4,3,0,0,0],[0,0,0,3,4,4,3,4,4,4,4,3,4,4,4,4,3,0,0,0],[0,0,0,3,4,4,4,4,3,4,4,4,4,4,4,4,3,0,0,0],[0,0,0,3,4,4,4,4,3,4,4,4,4,4,3,3,3,0,0,0],[0,0,0,0,3,4,4,4,4,4,4,4,4,4,3,0,0,0,0,0],[0,0,0,0,3,4,3,4,3,4,3,4,4,4,3,0,0,0,0,0],[0,0,0,0,3,4,3,3,3,3,3,4,4,3,3,0,0,0,0,0],[0,0,0,0,3,4,3,4,3,4,3,4,4,3,0,0,0,0,0,0],[0,0,0,0,3,3,4,4,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],dem_3:[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,3,3,3,3,3,3,0,0,0,0,0,0,0],[0,0,0,0,0,0,3,4,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,3,4,4,4,4,4,4,4,4,3,0,0,0,0,0],[0,0,0,0,3,4,4,4,4,4,4,4,4,4,4,3,0,0,0,0],[0,0,0,3,4,4,4,4,4,4,4,4,4,4,4,4,3,0,0,0],[0,0,0,3,4,4,3,4,4,4,4,3,4,4,4,4,3,0,0,0],[0,0,0,3,4,4,3,4,4,4,4,3,4,4,4,4,3,0,0,0],[0,0,0,3,4,4,3,4,4,4,4,3,4,4,4,4,3,0,0,0],[0,0,0,3,4,4,4,4,3,4,4,4,4,4,4,4,3,0,0,0],[0,0,0,3,4,4,4,4,3,4,4,4,4,4,3,3,3,0,0,0],[0,0,0,0,3,4,4,4,4,4,4,4,4,4,3,0,0,0,0,0],[0,0,0,0,3,4,3,4,3,4,3,4,4,4,3,0,0,0,0,0],[0,0,0,0,3,4,3,3,3,3,3,4,4,3,3,0,0,0,0,0],[0,0,0,0,3,4,3,4,3,4,3,4,4,3,0,0,0,0,0,0],[0,0,0,0,3,3,4,4,4,4,4,4,4,3,0,0,0,0,0,0],[0,0,0,0,0,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],colors:[null,L,"#e31937","#000000",y,"#006f46","#ffe417","#ffffff","#f9f7f5",E,k,"#aad1e7",w,"#606060","#313866"]};class M extends i{constructor(t,e,s,n,i={}){var o,h;const{stage:d}=t;super(d,[]),this.h=null,this.data={dmg:10};const c=new a(e,s,[400,600]);c.direction=s[0]>0?-1:1;const p=c.direction;this.gs=t,this.c=n,this.data=Object.assign(Object.assign({},this.data),i),this.expire=new b((null===(o=this.data)||void 0===o?void 0:o.exp)||1e3,this.endTime.bind(this));const m=new l((t=>{const e=t.shaman,s=t.bolt;return{bolt:{frames:[e.bolt_1,e.bolt_2],changeTime:50},boltExplode:{frames:[e.bolt_exp_1,e.bolt_exp_3],changeTime:75},boltL:{frames:[e.bolt_1_left,e.bolt_2_left],changeTime:50},enhBolt:{frames:[s.bolt_1,s.bolt_2],changeTime:50},enhBoltExplode:{frames:[s.bolt_exp_1,s.bolt_exp_3],changeTime:75},enhBoltL:{frames:[s.bolt_1_left,s.bolt_2_left],changeTime:50}}})(t.images),"bolt"),u=new r([8,8],((t,e)=>{var s,n;t.ID!==this.c&&this.c!==(null==t?void 0:t.c)&&("Ground"===t.eType?(null===(s=this.data)||void 0===s?void 0:s.player)&&t.takeDamage((null===(n=this.data)||void 0===n?void 0:n.en)?100:50,this.ID):"Enemy"===t.eType&&"Enemy"!==this.c||"LittleDemon"===t.eType?t.takeDamage(this.data.dmg,this.ID):"Player"===t.eType&&this.c!==t.ID&&(this.c=t.ID,null==t||t.takeDamage(this.data.dmg)),this.onDestroy())}));u.solid=!1,u.posModifiers=[2,2],this.addComponent(c),this.addComponent(m),this.addComponent(u),(null===(h=this.data)||void 0===h?void 0:h.en)?-1===p&&"enhBolt"!==m.cA?m.sAnim("enhBolt"):1===p&&"enhBoltL"!==m.cA&&m.sAnim("enhBoltL"):-1===p&&"bolt"!==m.cA?m.sAnim("bolt"):1===p&&"boltL"!==m.cA&&m.sAnim("boltL")}endTime(){this.onDestroy()}update(t,e){this.expire.update(t),super.update(t,e)}render(t,e){super.render(t,e)}onDestroy(){var t;const e=this.getComponent("rnd");(null===(t=this.data)||void 0===t?void 0:t.en)?"enhBoltExplode"!==e.cA&&e.sAnim("enhBoltExplode"):"boltExplode"!==e.cA&&e.sAnim("boltExplode"),this.getComponent("pos").v=[0,0],this.getComponent("coll").onCollide=null,setTimeout((()=>{this.gs.scene.removeEntity(this)}),150)}}const A=(t,e)=>{let s=t.enemy;return 1===e&&(s=t.enemy2),2===e&&(s=t.enemy3),{idle:{frames:[s.en_idle_1,s.en_idle_2],changeTime:500},idleL:{frames:[s.en_idle_1_left,s.en_idle_2_left],changeTime:500},dmg:{frames:[s.dmg_1,s.en_idle_1],changeTime:50},dmgL:{frames:[s.dmg_1_left,s.en_idle_1_left],changeTime:50}}},j=new _(100);class I extends i{constructor(t,e,s,n={}){const{stage:i}=t;super(i,[]),this.fireCharge=new Tt(1e3,1e3),this.firing=!1,this.data={},this.eType="Enemy",this.energy=50,this.hits=new Set;const o=new a(s),h=new l(e,"idle"),c=new r([48,48],((t,e)=>{})),p=new d;this.gs=t,this.data=n,this.addComponent(o),this.addComponent(h),this.addComponent(c),this.addComponent(p)}update(t,e){this.action(t,e),this.fireCharge.recharge(t);const s=this.getComponent("pos"),n=this.getComponent("rnd");1===s.direction&&"idleL"!==n.cA&&n.sAnim("idleL"),-1===s.direction&&"idle"!==n.cA&&n.sAnim("idle"),super.update(t,e)}action(t,e){const s=e.scene.getEntities().find((t=>"Player"===t.eType));if(!s)return;const[n,i]=s.getComponent("pos").p,[o,a]=s.getComponent("coll").box,r=this.getComponent("pos"),{p:[l,h],direction:d}=r,[c,p]=this.getComponent("coll").box,[[m,u],[g,f]]=[[n+o/2,i+a/2],[l+c/2,h+p/2]],v=Math.sqrt(Math.pow(m-g,2)+Math.pow(u-f,2)),_=Math.sqrt(Math.pow(u-f,2));n<l&&1!==d?r.direction=1:n>l&&-1!==d&&(r.direction=-1),this.fireCharge.current<350&&(this.firing=!1);const b=this.firing||this.fireCharge.isFull;v<600&&_<100&&b&&(this.firing=!0,j.call(t,(()=>{this.magicBolt()})))}magicBolt(){var t;const e=(null===(t=null==this?void 0:this.data)||void 0===t?void 0:t.boltCost)||550;if(this.fireCharge.current<e)return;const s=this.getComponent("pos"),n=-400*s.direction,i=1===s.direction?s.p[0]-5:s.p[0]+40,o=new M(this.gs,[i,s.p[1]+25],[n,0],this.eType);this.gs.scene.addEntity(o),this.fireCharge.use(e)}takeDamage(t,e){if(this.hits.has(e))return;this.hits.add(e);const s=this.getComponent("rnd");"dmg"!==s.cA&&(s.sAnim("dmg"),setTimeout((()=>s.sAnim("idle")),100)),this.energy-=t,this.energy<=0&&this.gs.scene.removeEntity(this)}}const P=(t,e)=>{let s=t.demon;return 1===e&&(s=t.demon2),2===e&&(s=t.demon3),{idle:{frames:[s.dem_1,s.dem_3],changeTime:300},dmg:{frames:[s.dmg_1,s.dem_1],changeTime:50},dmgL:{frames:[s.dmg_1_left,s.dem_1],changeTime:50}}};class S extends i{constructor(t,e,s,n={}){const{stage:i}=t;super(i,[]),this.triggered=!1,this.data={},this.energy=50,this.speed=100,this.maxDist=500,this.eType="LittleDemon",this.hits=new Set;const o=new a(s,[0,0],[400,400]),h=new l(e,"idle"),c=new r([30,30],((e,s)=>{"Player"!==e.eType||this.triggered||(this.triggered=!0,t.scene.removeEntity(this),null==e||e.takeDamage(50))}));c.posModifiers=[5,5];const p=new d;this.gs=t,this.speed=(null==n?void 0:n.speed)||this.speed,this.maxDist=(null==n?void 0:n.maxDist)||this.maxDist,this.data=n,this.addComponent(o),this.addComponent(h),this.addComponent(c),this.addComponent(p)}update(t,e){this.action(t,e),super.update(t,e)}action(t,e){const s=e.scene.getEntities().find((t=>"Player"===t.eType));if(!s)return;const[n,i]=s.getComponent("pos").p,[o,a]=s.getComponent("coll").box,r=this.getComponent("pos"),{p:[l,h],direction:d}=r,[c,p]=this.getComponent("coll").box,[[m,u],[g,f]]=[[n+o/2,i+a/2],[l+c/2,h+p/2]],v=Math.sqrt(Math.pow(m-g,2)+Math.pow(u-f,2));Math.sqrt(Math.pow(u-f,2))>20||(n<l&&1!==d?r.direction=1:n>l&&-1!==d&&(r.direction=-1),v<this.maxDist&&r.accelerate([this.speed*-r.direction,0]))}takeDamage(t,e){if(this.hits.has(e))return;this.hits.add(e);const s=this.getComponent("pos").v;this.getComponent("pos").accelerate([-10*s[0],-50]);const n=this.getComponent("rnd");"dmg"!==(null==n?void 0:n.cA)&&(null==n||n.sAnim("dmg"),setTimeout((()=>n.sAnim("idle")),100)),this.energy-=t,this.energy<=0&&this.gs.scene.removeEntity(this)}}class D extends p{onInit(t){super.onInit(t),this.show()}onUpdate(t,e,s){const n=t.life,i=Math.floor(n/10);this.el.innerHTML="";for(let t=0;t<i;t++)this.el.innerHTML+='<div class="bar"></div>'}}class O{constructor(t,e=!1){this.type="rnd",this.en=!1,this.stage=t,this.en=e}onRender(t,e,s){const{p:n,direction:i}=t.getComponent("pos"),o=t.fireCharge;if(!n)throw new Error("PositionComponent not found");const[a,r]=n,l=o.current/o.max,h=this.stage.ctx;h.beginPath();let d=-30*l,c=3,p=k;this.en&&(d=-40*l,c=5,p="#e31937"),-1===i?h.rect(a+s[0]-3,r+s[1]+40,c,d):h.rect(a+s[0]+48,r+s[1]+40,c,d),h.fillStyle=p,h.fill(),h.closePath()}}const F=new _(150);class B extends i{constructor(t,e,s,n,i){const{stage:o}=t;super(o,[]),this.status="idle",this.speed=200,this.maxRun=300,this.jumpSpeed=-300,this.onTheGround=!1,this.fireCharge=new Tt(1e3,500),this.rollCharge=new Tt(150,150),this.rolling=0,this.firing=!1,this.life=100,this.chargeUsage=200,this.eType="Player",this.lives=3,this.jumps=0,this.maxJumps=1,this.jumping=!1;const h=new a(s,[0,0],[400,400],-1),c=new l(e,"idle"),p={ArrowLeft:()=>{this.status="walk-left"},ArrowRight:()=>{this.status="walk-right"},ArrowUp:()=>{this.jumping||(this.jumping=!0,this.jump())},ArrowDown:()=>{this.rollCharge.isFull&&(this.rolling=300,this.duck(),this.rollCharge.useAll())},Shift:()=>{this.firing=!0}},u={ArrowLeft:()=>{this.status="idle"},ArrowRight:()=>{this.status="idle"},ArrowUp:()=>{this.jumping=!1},Shift:()=>{this.firing=!1}};this.lives=n,n<=2&&(this.chargeUsage=75),1===n&&(this.maxJumps=3);const g=new m(p,u),f=new D("#life"),v=new r([36,48],((t,e)=>{}));v.posModifiers=[8,0];const _=new d;this.gs=t,this.onEnd=i,this.addComponent(h),this.addComponent(c),this.addComponent(g),this.addComponent(v),this.addComponent(_),this.addComponent(f),this.addComponent(new O(o,n<=2))}get invulnerable(){return this.rolling>0}update(t,e){var s;const n=this.getComponent("pos");n.p[1]>800&&this.destroy(),e.session.pos=n.p,0===(null===(s=n.collisionSensors[2])||void 0===s?void 0:s.d)?(this.onTheGround=!0,this.jumps=this.maxJumps):this.onTheGround=!1,this.rolling>0?this.rolling-=t:(this.rollCharge.recharge(t),this._resetBox(),"walk-left"===this.status?this.walkL():"walk-right"===this.status?this.walkRight():"duck"===this.status?this.duck():"idle"===this.status&&this.stand()),this.firing?F.call(t,(()=>this.magicBolt())):(F.update(t),this.fireCharge.recharge(t)),super.update(t,e)}_resetBox(){this.rolling=0,this.getComponent("coll").posModifiers=[8,0],this.getComponent("rnd").imgPos=[0,0],this.getComponent("coll").box=[36,48]}walkL(){const t=this.getComponent("pos"),e=this.getComponent("rnd");"runL"!==e.cA&&e.sAnim("runL");let s=-this.speed;const n=Math.abs(t.v[0]-this.speed)-this.maxRun;n>=0&&(s=-this.speed+n),this.onTheGround,t.accelerate([s,0]),t.direction=1}walkRight(){const t=this.getComponent("pos"),e=this.getComponent("rnd");"run"!==e.cA&&e.sAnim("run");let s=this.speed;const n=Math.abs(t.v[0]+this.speed)-this.maxRun;n>=0&&(s=this.speed-n),this.onTheGround,t.accelerate([s,0]),t.direction=-1}jump(){const t=this.getComponent("pos");this.jumps>0&&(this.jumps--,t.v=[t.v[0],0],t.accelerate([0,this.jumpSpeed]))}stand(){const t=this.getComponent("pos"),e=this.getComponent("rnd");if(1===t.direction&&"idleL"!==e.cA&&e.sAnim("idleL"),-1===t.direction&&"idle"!==e.cA&&e.sAnim("idle"),this.onTheGround)t.v=[0,t.v[1]],t.a=[0,t.a[1]];else{const e=.03*-t.v[0];t.a=[e,t.a[1]]}}duck(){const t=this.getComponent("pos"),e=this.getComponent("rnd"),s=t.direction;-1===s&&"duck"!==e.cA?e.sAnim("duck"):1===s&&"duckL"!==e.cA&&e.sAnim("duckL"),t.v=[0,t.v[1]],t.a=[300*-t.direction,t.a[1]],this.getComponent("coll").box=[36,20],this.getComponent("coll").posModifiers=[0,28],this.getComponent("rnd").imgPos=[0,8]}magicBolt(){if(this.fireCharge.current<75||this.rolling)return;const t=this.getComponent("pos"),e=-400*t.direction,s=1===t.direction?t.p[0]-5:t.p[0]+32,n=this.lives<=2,i=new M(this.gs,[s,t.p[1]+25],[e,0],this.ID,{en:n,player:!0,dmg:n?50:25});this.gs.scene.addEntity(i),this.fireCharge.use(this.chargeUsage)}destroy(){super.destroy(),this.onEnd()}takeDamage(t){if(this.invulnerable)return;const e=this.getComponent("rnd");"dmg"!==e.cA&&e.sAnim("dmg"),this.life-=t,this.life<=0&&this.destroy()}}const U=(t,e,s,n)=>{const[[i,o],[a,r],[l,h],[d,c]]=[t,e,s,n];return i<l+d&&i+a>l&&o<h+c&&o+r>h},R=document,$=window.requestAnimationFrame,q="running";class G{constructor(t){this.uFps=1e3/70,this.state="init",this.stage=t,this.lastRenderCall=0,this.lastUpdateCall=0,this.renderFps=0,this.updateFps=0}onStart(t){this.startCb=t}onPause(t){this.pauseCb=t}onResume(t){this.resumeCb=t}onUpdate(t){t&&(this.updateCb=t)}onRender(t){t&&(this.renderCb=t)}start(){this.state=q,this.startCb&&this.startCb(),this.mainLoop()}pause(){this.state="paused",this.pauseCb&&this.pauseCb()}resume(){this.state=q,this.resumeCb&&this.resumeCb()}renderLoop(){$((t=>{const e=this.stage;e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height);const s=t-this.lastRenderCall;this.renderFps=Math.floor(1e3/s),this.lastRenderCall=t,this.renderCb&&this.renderCb(s),this.renderLoop()}))}updateLoop(){setTimeout((()=>{if(this.state===q){const t=+new Date,e=t-this.lastUpdateCall;this.updateFps=Math.floor(1e3/e),this.lastUpdateCall=t,this.updateCb&&this.updateCb(e)}this.updateLoop()}),this.uFps)}mainLoop(){this.lastUpdateCall=+new Date,this.updateLoop(),this.renderLoop()}}class J{constructor(t){this._entities=[],this.cameraPos=[0,0],this.content=t}run(t){return n(this,void 0,void 0,(function*(){return yield this.content(t,this)}))}addEntity(t){this._entities[t.ID]=t,this._entities[t.ID].init()}removeEntity(t){var e;null===(e=this._entities[t.ID])||void 0===e||e.destroy(),delete this._entities[t.ID]}getEntities(){return Object.values(this._entities)}}class H{constructor(){this.images={},this.session={},this.status="init",this._glbEntities=[],this.scene=null,this.stage=new z,this.gl=new G(this.stage)}runScene(){var t;return n(this,void 0,void 0,(function*(){return null===(t=this.scene)||void 0===t?void 0:t.run(this)}))}getImg(t){if(!this.images[t])throw new Error(`Image ${t} not found`);return this.images[t]}addEntity(t){this._glbEntities[t.ID]=t,this._glbEntities[t.ID].init()}removeEntity(t){var e;null===(e=this._glbEntities[t.ID])||void 0===e||e.destroy(),delete this._glbEntities[t.ID]}getEntities(){return Object.values(this._glbEntities)}}const N=(t,e)=>{const s=document.createElement("canvas"),[n,i]=t;s.width=n,s.height=i;e(s.getContext("2d"),[s.width/2,s.height/2]);const o=s.toDataURL("image/png"),a=document.createElement("img");return a.src=o,a};function Y(t,e=2){return(s,n)=>{let[i,o]=n;i-=t[0].length*e/2,o-=t.length*e/2;for(let n=0;n<t.length;n++)for(let a=0;a<t[n].length;a++)if(null!==t[n][a]){const r=i+a*e,l=o+n*e;s.beginPath(),s.fillStyle=t[n][a],s.fillRect(r,l,e,e),s.closePath()}}}const K=(t,e)=>t[e].map((e=>e.map((e=>t.colors[e]))));function W(t){return JSON.parse(JSON.stringify(t))}const Q=(t,e)=>{let s=W(e);s.colors=[...e.colors,...Object.keys(t)];for(let e of Object.keys(t))for(let n of t[e]){const t=s.colors.indexOf(n),i=s.colors.indexOf(e);for(let e in s)"colors"!==e&&(s[e]=s[e].map((e=>e.map((e=>e===t?i:e)))))}return s};class z{constructor(){this.canvas=R.querySelector("#stage"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=1200,this.canvas.height=800}}class V extends i{constructor(t){super(t,[new p("#loading")]),this.loadedImages={static:{}}}init(){super.init(),this.loadPxImages(Lt),this.loadImages(kt)}loadImages(t){for(const e of Object.keys(t)){const s=N(g(t[e].d,2),t[e].f);this.loadedImages.static[e]=s}}loadPxImages(t){for(const e of t){const[t,s,n]=e;for(const e of Object.keys(n)){if("colors"===e)continue;const i=K(n,e),o=W(i).map((t=>t.reverse())),a=N([i.length*s,i[0].length*s],Y(i,s)),r=N([i.length*s,i[0].length*s],Y(o,s));this.loadedImages[t]||(this.loadedImages[t]={}),this.loadedImages[t][e]=a,this.loadedImages[t][e+"_left"]=r}}}destroy(){super.destroy();this.getComponent("html").hide()}}class X extends i{constructor(t,e){const{stage:s}=t;super(s,[]),this.eType="Ground",this.life=100,this.hits=new Set,this.gs=t;const n=new o(e),i=new h(t.images.static.groundBlock),a=new r([32,32]);this.addComponent(n),this.addComponent(i),this.addComponent(a)}takeDamage(t,e){this.hits.has(e)||(this.hits.add(e),this.life-=t,this.replaceComponent(new h(this.gs.images.static.dmgGroundBlock)),this.getComponent("rnd").onInit(this),this.life<=0&&this.gs.scene.removeEntity(this))}}class Z extends i{constructor(t,e,s){const{stage:n}=t;super(n,[]),this.eType="End",this.gs=t;const i=new o(e),a=new h(t.images.static.endBlock),l=new r([32,32],(t=>{"Player"===t.eType&&(null==s||s())}));this.addComponent(i),this.addComponent(a),this.addComponent(l)}}class tt extends p{constructor(t,e){super(t),this.img=e.images.life.life,this.gs=e}onInit(t){super.onInit(t),this.el.innerHTML="";for(let t=0;t<this.gs.session.lives;t++)this.el.appendChild(this.img.cloneNode(!0));this.show()}onUpdate(t,e,s){}}class et extends i{constructor(t){const{stage:e}=t;super(e,[]);const s=new tt("#lives",t);this.addComponent(s)}}class st{constructor(t){this.raw=t,this._parse()}_expand(t){const[e,s]=t.replace(/([0-9]*)(.*)/,"$1 $2").split(" "),n=[];for(let t=0;t<parseInt(e);t++)n.push(s);return n}_parse(){const t=this.raw.split(",");let e=[];for(let s of t)e=e.concat(this._expand(s));this._parsed=e}get length(){return this._parsed.length}tile(t){return this._parsed[t]}}const nt=(t,e,s=null,n=null)=>{const i=["4.","1|","10."],o=["30.","2_","3.","3_",...i],a=["10.","1b"],r=[...a,...i],l=[...a,...a,...a,...i],h=["10.","1a"],d=[...h,...i],c=[...h,...h,...h,...i],p=["5.","3_","10.","5_","10.","10_","5.",...i],m=["5.","3_","3.","3_","5."],u=[...m,"10_","5.",...m,"15_","5.",...i],g=[...r,...r,...d,...d,...r,...p,...l,...c,...p,...l.map((t=>t.replace("1b","2b"))),...u,...d.map((t=>t.replace("1a","1a,1.,1a"))),...u],f=[...o,...g,...g.map((t=>t.replace(/a/g,"aa").replace(/b/g,"bb"))),...g.map((t=>t.replace(/a/g,"aaa").replace(/b/g,"bbb")))];n&&f.push("1e");const v=new st(s?s.raw+","+f.join(","):f.join(","));let _=Math.floor(t.stage.canvas.height/2);for(let s=0;s<v.length;s++){const i=v.tile(s);if("|"===i&&(e.addEntity(new X(t,[32*s,_])),_-=32),"*"===i&&(_-=32,e.addEntity(new X(t,[32*s,_])),_+=32),i.startsWith("b")){const n={};let o=0;"b"===i?n.speed=10:"bb"===i?(n.speed=50,o=1):(n.speed=100,o=2),e.addEntity(new S(t,P(t.images,o),[32*s,_-64],n))}if(i.startsWith("a")){const n={};let o=0;"a"===i?n.boltCost=800:"aa"===i?(n.boltCost=550,o=1):(n.boltCost=300,o=2),e.addEntity(new I(t,A(t.images,o),[32*s,_-64],n))}"e"===i&&e.addEntity(new Z(t,[32*s,_-64],n)),"_"!==i&&e.addEntity(new X(t,[32*s,_]))}return v},it=(t=!1)=>new J(((e,s)=>n(void 0,void 0,void 0,(function*(){return new Promise((n=>{const{gl:i}=e,o=new B(e,(t=>{const e=t.shaman;return{idle:{frames:[e.idle_1,e.idle_1,e.idle_2,e.idle_2,e.idle_1],changeTime:250},idleL:{frames:[e.idle_1_left,e.idle_2_left],changeTime:500},run:{frames:[e.run_1,e.idle_1],changeTime:150},runL:{frames:[e.run_1_left,e.idle_1_left],changeTime:150},duck:{frames:[e.roll_1,e.roll_2,e.roll_3,e.roll_4],changeTime:50},duckL:{frames:[e.roll_1_left,e.roll_2_left,e.roll_3_left,e.roll_4_left],changeTime:50},dmg:{frames:[e.dmg_1,e.idle_1],changeTime:50},dmgL:{frames:[e.dmg_1_left,e.idle_1],changeTime:50}}})(e.images),[400,-10],e.session.lives,(()=>{n({gs:e,scene:s,win:!1})}));s.addEntity(o),s.addEntity(new et(e));let a=nt(e,s,null,t?null:()=>n({gs:e,scene:s,win:!0}));i.onUpdate((n=>{if(e.getEntities().filter((t=>"function"==typeof t.update)).forEach((t=>t.update(n,e))),"running"!==e.status)return;const[i,r]=o.getComponent("pos").p,l=e.stage.canvas.width/2-i,h=e.stage.canvas.height/2-r;t&&Math.round(i/32)>=a.length-100&&(a=nt(e,s,a));const d=s.getEntities().filter((t=>v(t,[l,h],e.stage.canvas)));d.filter((t=>"function"==typeof t.update)).forEach((t=>t.update(n,e))),(t=>{const e=t.filter((t=>!!t.getComponent("coll").onCollide));for(let s=0;s<e.length;s++){const n=e[s],i=n.getComponent("coll");i.isColliding=!1,i.collisions=[];let{box:o,onCollide:a,boxPos:[r,l]}=n.getComponent("coll");n.getComponent("pos").collisionSensors=[null,null,null,null];let h=null,d=null,c=null,p=null;for(let e=0;e<t.length;e++){const s=t[e];if(s.ID!==n.ID){const t=s.eType,{box:e,boxPos:[n,i]}=s.getComponent("coll"),m=10;for(let d=0;d<m;d++)if(U([r,l+o[1]+d],[o[0],1],[n,i],e)&&(0===d&&a(s,"bottom"),d<((null==h?void 0:h.d)||1/0))){null===h&&(h={d:0,t:""}),h.d=d,h.t=t;break}for(let h=0;h<m;h++)if(U([r,l-h-1],[o[0],1],[n,i],e)&&(0===h&&a(s,"top"),-h<((null==d?void 0:d.d)||0))){null===d&&(d={d:0,t:""}),d.d=h,d.t=t;break}for(let h=0;h<m;h++)if(U([r+o[0]+h,l],[1,o[1]],[n,i],e)){if(0===h&&a(s,"right"),h<((null==p?void 0:p.d)||1/0)){null===p&&(p={d:0,t:""}),p.d=h,p.t=t;break}break}for(let h=0;h<m;h++)if(U([r-h-1,l],[o[0],o[1]],[n,i],e)&&(0===h&&a(s,"left"),h<((null==c?void 0:c.d)||1/0))){null===c&&(c={d:0,t:""}),c.d=h,c.t=t;break}}}n.getComponent("pos").collisionSensors=[d,p,h,c]}})(d.filter((t=>!!t.components.coll)))})),i.onRender((t=>{const[n,i]=o.getComponent("pos").p,a=e.stage.canvas.width/2-n,r=e.stage.canvas.height/2-i;let l=s.getEntities().filter((t=>!!t.components.rnd&&v(t,[a,r],e.stage.canvas)));l.sort(((t,e)=>e.getComponent("rnd").renderPriority-t.getComponent("rnd").renderPriority)),l.forEach((e=>e.render(t,[a,r])))}))}))}))));class ot extends i{constructor(t){const{stage:e}=t;super(e,[]);const s=new c("#main-menu");this.addComponent(s)}init(){const t="menu-item",e=[{class:t,text:"Tutorial",id:"new-game"},{class:t,text:"Quick",id:"quick-game"},{class:t,text:"Infinite",id:"infinite-game"}];this.getComponent("menu").el.querySelector("ul").innerHTML=e.map((t=>`<li><button class="${t.class}" id="${t.id}">${t.text}</button></li>`)).join(""),super.init()}btnClick(t,e){this.getComponent("menu").addListener(t,e)}}const at={red:[L,"#e31937","#000000",y,"#006f46","#ffe417","#ffffff","#f9f7f5","#3098c1",k,"#aad1e7",w,"#606060","#313866"]},rt={red:[k],pink:["#aad1e7"],purple:["#3098c1"]},lt=Q({red:[y]},T),ht=Q(rt,T),dt=Q(at,T);let ct={};ct[y]=[w];const pt=Q(ct,T),mt=Q(at,pt);ct={},ct[x]=[w];const ut=Q(ct,T),gt=Q(at,ut),ft={};ft[w]=[y];const vt={};vt[x]=[y];const _t=Q(ft,T),bt=Q({red:[w]},_t),Ct=Q(vt,T),yt=Q({red:[x]},Ct);function wt(t){const e=t.length;for(let n=0;n<Math.round(e/2);n++)for(let i=n;i<e-n-1;i++){var s=t[n][i];t[n][i]=t[e-1-i][n],t[e-1-i][n]=t[e-1-n][e-1-i],t[e-1-n][e-1-i]=t[i][e-1-n],t[i][e-1-n]=s}}const xt=(t,e=1)=>{const s=JSON.parse(JSON.stringify(t));for(let t=0;t<e;t++)wt(s);return s},Et=(t="#DFA878")=>(e,s)=>{let[n,i]=s;n=Math.round(n),i=Math.round(i);e.fillStyle=t,e.beginPath(),e.rect(n-32,i-32,32,10),e.rect(n-32,i-10,32,10),e.rect(n-32,i-32,10,32),e.rect(n,i-32,10,32),e.closePath(),e.fill(),e.stroke()},kt={groundBlock:{d:[32,32],f:Et()},endBlock:{d:[32,64],f:(t,e)=>{let[s,n]=e;s=Math.round(s),n=Math.round(n);t.fillStyle=E,t.beginPath(),t.rect(s-32,n-64,32,64),t.closePath(),t.lineWidth=14,t.strokeStyle=k,t.fill(),t.stroke()}},dmgGroundBlock:{d:[32,32],f:Et("#3e250f")}},Lt=[["enemy",1.5,Object.assign(Object.assign({},pt),{dmg_1:mt.en_idle_1,colors:mt.colors})],["enemy2",1.5,Object.assign(Object.assign({},T),{dmg_1:dt.en_idle_1,colors:dt.colors})],["enemy3",1.5,Object.assign(Object.assign({},ut),{dmg_1:gt.en_idle_1,colors:gt.colors})],["demon",1.5,Object.assign(Object.assign({},T),{dmg_1:lt.dem_1,colors:lt.colors})],["demon2",1.5,Object.assign(Object.assign({},_t),{dmg_1:bt.dem_1,colors:bt.colors})],["demon3",1.5,Object.assign(Object.assign({},Ct),{dmg_1:yt.dem_1,colors:yt.colors})],["shaman",1.5,Object.assign(Object.assign({},T),{dmg_1:dt.idle_1,roll_2:xt(T.roll_1,1),roll_3:xt(T.roll_1,2),roll_4:xt(T.roll_1,3),colors:dt.colors})],["bolt",2,Object.assign({},ht)],["life",1,Object.assign(Object.assign({},T),{colors:T.colors})]];class Tt{constructor(t,e){this.max=t,this.current=e}recharge(t){this.current=Math.min(this.current+t,this.max)}use(t){this.current=Math.max(this.current-t,0)}useAll(){this.current=0}get isFull(){return this.current>=this.max}get isEmpty(){return this.current<this.max}}s(823);class Mt extends i{constructor(t){const{stage:e}=t;super(e,[]),this.gs=t;const s=new c("#main-menu");this.addComponent(s)}init(){const t=[];t.push({class:"menu-item",text:"continue",id:"continue"});const e=this.getComponent("menu");e.el.querySelector("ul").innerHTML=t.map((t=>`<li><button class="${t.class}" id="${t.id}">${t.text}</button></li>`)).join(""),document.addEventListener("keydown",(t=>{"Escape"===t.key&&(e.show(),this.gs.status="paused",this.gs.stage.canvas.classList.add("paused"))})),e.addListener("#continue",(()=>{this.gs.stage.canvas.classList.remove("paused"),e.hide(),this.gs.status="running"})),super.init(),e.hide()}btnClick(t,e){this.getComponent("menu").addListener(t,e)}}const At=t=>`<div>\n<div class="tip_container">\n<div class="col_1">\n<p>\nYear <span class='hl-1'>1215 CE</span>,\nthe Great Khan lies in front of you, mortally would by an enemy arrow. \n</p>\n<p>\nOnly you, his shaman, can save him from the land of the spirits.\n</p>\n\n</div>\n<div class="col_2">\n${(t=>`<table>\n<tr><td>Mana</td><td><img style="border-left:4px solid ${k}; display: inline" src="${t.images.shaman.idle_1.src}" /></td></tr>\n<tr><td>Jump</td><td>↑</td></tr>\n<tr><td>Double Jump</td><td>↑↑</td></tr>\n<tr><td>Move</td><td>← →</td></tr>\n<tr><td>Roll</td><td>↓</td></tr>\n<tr><td>Magic Bolt</td><td>Shift</td></tr>\n<tr><td>Pause</td><td>Esc</td></tr>\n</table>`)(t)}\n</div>\n</div>\n<div class="tip_container">\n<button id="skip">Continue</button>\n</div>\n</div>`,jt=t=>{var e;return`<div>\n<p>\nYou failed to save the Great Khan after ${C(null===(e=null==t?void 0:t.session)||void 0===e?void 0:e.pos[0])} steps.\n</p>\n<p>\n\n<button id="skip">Play Again</button>\n</div>`},It=t=>'<div>\n<p>\nYou completed the journey and saved the Great Khan.\n</p>\n<p>\n\n<button id="skip">Play Again</button>\n</div>',Pt=t=>{var e;const s=t.session.lives;let n="";return s>1?n='The spirits will grant you another chance, gifting you with <span class="hl-1"> increased Magic Power<span>.':1===s&&(n='The spirits may grant you one last chance, gifting you with <span class="hl-1"> supernatural jump<span>.'),`<div>\n  <div class="tip_container fd">\n  <p>\n  Your journey ended after <span class="hl-1">${C(null===(e=null==t?void 0:t.session)||void 0===e?void 0:e.pos[0])} steps</span>.\n  </p>\n  <p>\n  ${n}\n  </p>\n  </div>\n  <div class="tip_container">\n  <button id="skip">continue</button>\n  </div>\n  </div>`};class St extends i{constructor(t,e){const{stage:s}=t;super(s,[]),this.gs=t,this.onSkip=e;const n=new c("#ingame-msg");this.addComponent(n)}setContent(t){this.getComponent("menu").el.innerHTML=t}init(){const t=this.getComponent("menu");t.addListener("#skip",(()=>{this.gs.stage.canvas.classList.remove("paused"),t.hide(),this.gs.status="running",this.onSkip()})),super.init(),t.show(),this.gs.status="paused",this.gs.stage.canvas.classList.add("paused")}btnClick(t,e){this.getComponent("menu").addListener(t,e)}}class Dt extends i{constructor(t){const{stage:e}=t;super(e,[]),this.gs=t;const s=new p("#stage");this.addComponent(s)}update(t,e){e.stage.canvas.style.backgroundImage="linear-gradient(0deg, #141729, #313866 30%, #505ba5"}}const Ot=(t,e,s=(()=>{}))=>n(void 0,void 0,void 0,(function*(){return new Promise((n=>{const i=new St(t,(()=>{n(null),s()}));i.setContent(e(t)),t.addEntity(i)}))}));n(void 0,void 0,void 0,(function*(){const t=new H;t.session.lives=3,t.addEntity(new Dt(t)),t.scene=new J(((t,e)=>n(void 0,void 0,void 0,(function*(){return new Promise((s=>{const{stage:n,gl:i}=t,o=new V(n);e.addEntity(o),setTimeout((()=>{t.images=o.loadedImages,o.destroy(),s({gs:t,scene:e})}),1e3),i.start()}))})))),yield t.runScene(),t.scene=new J(((t,e)=>n(void 0,void 0,void 0,(function*(){return new Promise((s=>{const n=new ot(t);["new-game","quick-game","infinite-game"].forEach((t=>{n.btnClick(`#${t}`,(()=>{n.destroy(),s(t)}))})),e.addEntity(n)}))}))));const e=yield t.runScene();t.status="running";const s=new Mt(t);t.addEntity(s);let i="new-game"===e,o=!1;for(t.session.lives="infinite-game"===e?1:3;t.session.lives>0;){t.scene=it("infinite-game"===e),setTimeout((()=>n(void 0,void 0,void 0,(function*(){i&&(yield Ot(t,At),i=!1)}))),300);const s=yield t.runScene();if(null==s?void 0:s.win){o=!0;break}t.session.lives--,Ot(t,Pt)}Ot(t,o?It:jt,(()=>window.location.reload()))}))}},e={};function s(n){var i=e[n];if(void 0!==i)return i.exports;var o=e[n]={exports:{}};return t[n].call(o.exports,o,o.exports,s),o.exports}s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};s(607)})();