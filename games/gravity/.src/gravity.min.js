!function(){"use strict";var t,e,a=Math.abs,r=Math.sin,n=Math.cos,o=Math.PI,i=2*o,l=function(t){return t>255?255:0>t?0:t},s=function(t){return(Math.random()-.5)*(t||1)};!function(){var a;!function(){var t={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encLookup:[],Init:function(){for(var t=0;4096>t;t++)this.encLookup[t]=this.chars[t>>6]+this.chars[63&t]},Encode:function(t){for(var e=t.length,a="",r=0;e>2;){var n=t[r]<<16|t[r+1]<<8|t[r+2];a+=this.encLookup[n>>12]+this.encLookup[4095&n],e-=3,r+=3}if(e>0){var o=(252&t[r])>>2,i=(3&t[r])<<4;if(e>1&&(i|=(240&t[++r])>>4),a+=this.chars[o],a+=this.chars[i],2==e){var l=(15&t[r++])<<2;l|=(192&t[r])>>6,a+=this.chars[l]}1==e&&(a+="="),a+="="}return a}};t.Init(),a=function(e,a){function r(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]}function n(t){return[255&t,t>>8&255]}function o(t){for(var e=[],a=0,r=t.length,n=0;r>n;n++)e[a++]=255&t[n],e[a++]=t[n]>>8&255;return e}if(this.data=[],this.wav=[],this.dataURI="",this.header={chunkId:[82,73,70,70],chunkSize:0,format:[87,65,86,69],subChunk1Id:[102,109,116,32],subChunk1Size:16,audioFormat:1,numChannels:1,sampleRate:8e3,byteRate:0,blockAlign:0,bitsPerSample:8,subChunk2Id:[100,97,116,97],subChunk2Size:0},a)for(var i in a)this.header[i]=a[i];this.Make=function(e){e instanceof Array&&(this.data=e),this.header.blockAlign=this.header.numChannels*this.header.bitsPerSample>>3,this.header.byteRate=this.header.blockAlign*this.sampleRate,this.header.subChunk2Size=this.data.length*(this.header.bitsPerSample>>3),this.header.chunkSize=36+this.header.subChunk2Size,this.wav=this.header.chunkId.concat(r(this.header.chunkSize),this.header.format,this.header.subChunk1Id,r(this.header.subChunk1Size),n(this.header.audioFormat),n(this.header.numChannels),r(this.header.sampleRate),r(this.header.byteRate),n(this.header.blockAlign),n(this.header.bitsPerSample),this.header.subChunk2Id,r(this.header.subChunk2Size),16==this.header.bitsPerSample?o(this.data):this.data),this.dataURI="data:audio/wav;base64,"+t.Encode(this.wav)},e instanceof Array&&this.Make(e)}}();var n=window.makeAudio=function(t,e,n,i,c,d){c||(c=1),d={line:function(t,e){return 1-t/e},triangle:function(t,e){return e/3>t?t/(e/3):1-(t-e/3)/(2*e/3)}}[d||"line"];for(var u=n-e,h=[],f=0;t>f;f++)h.push(l(127*r(f*(e+u*(f/t))/800+i*s(o))*d(f,t)*c+127));var p=new a(h),y=document.createElement("audio");return y.src=p.dataURI,y},i=window.makeMusic=function(t,e,n,i){for(var c=function(t,e){return(e/4>t?t/(e/4):1-(t-e/4)/(3*e/4))*n},s=[],d=0;d<i.length;d+=3){var u=Math.pow(2,parseInt(i.charAt(d)))*(t/32)*120/e;if("-"==i.charAt(d+1))var h=0;else var f=i.charCodeAt(d+1)-78,h=440*Math.pow(2,f/12);for(var p=0;u>p;p++)s.push(l(127*r(p*o*h/t)*c(p,u)+127))}var y=new a(s,{sampleRate:t}),b=document.createElement("audio");return b.src=y.dataURI,b};e=function(t){S&&e[t].play()},e.nearExplosion=n(1e4,150,50,1,1),e.distantExplosion=n(1e4,150,50,.3,1),e.landing=n(1e3,150,150,0,.9,"triangle"),e.gun=n(4e3,1500,600,.2,1,"triangle"),e.win=i(2e3,200,1,"3N 3N 3N 4P 2- 3P 3P 3P 4R 2- 3R 3R 3R 6T"),setTimeout(function(){for(var e,a="4L 3L 3E 3L 5L 1- 4Q 4L 5E 1- 4L 3L 3E 3L 5L 1- 4Q 3P 5P ",r=6;r>3;r--)for(var n=0;3*r>n;n++)e+="3G 2D "+r+"- ";for(var o="4D 4D 3G 3G 3- 4I 4J 3K 3L 3- 4D 4D 3G 3G 3- 4N 4M 3K 3J 3- ",l="4E 4F 4G 3E 3F 3G 2E 2F 2G 1- 2H 2I 2J 1- 2K 2L 2M 1- ",c="3W 3Z 3Y 3X 3W 2- 2N 2N 2N 2- 2M 2M 2M 2- 2L 2L 2L 2- 3P 3O ",s="2- ",n="O".charCodeAt(0);n>"B".charCodeAt(0);n-=4)s+="4"+String.fromCharCode(n+1)+" 4"+String.fromCharCode(n+1)+" 3"+String.fromCharCode(n)+" 3"+String.fromCharCode(n)+" 3"+String.fromCharCode(n)+" 3"+String.fromCharCode(n)+" 3- ";t=i(2e3,180,.7,e+o+l+c+s+e+a),t.loop=!0,t.play()},100)}();var d=function(t,e,a,r,n,o){var i=Math.round(t+s(e)),c=Math.round(a+s(r)),d=Math.round(n+s(o)),u=Math.round(2.8*i),h=Math.round(2.8*c),f=Math.round(2.8*d),p=Math.round(3.6*i),y=Math.round(3.6*c),b=Math.round(3.6*d);return l(u),l(h),l(f),l(p),l(y),l(b),[[i,c,d].join(","),[u,h,f].join(","),[p,y,b].join(",")]},u=function(t,e){var a=t.x-e.x,r=t.y-e.y,n=Math.sqrt(a*a+r*r),o=a/n,i=r/n;return{x:o,y:i,d:n}},h=c.getContext("2d"),f=bg.getContext("2d"),p=0,y=0,b=map.getContext("2d"),m=document,v=m.documentElement,g=m.body,w=!1,k=1,x=!0,S=!0,C=!0,T=r,M=encodeURIComponent("http://js13kgames.com/entries/gravity"),R="https://twitter.com/intent/tweet?original_referer="+M+"&url="+M+"&text=",P=function(t){return 1e3*t},L={sun:{m:200,c:["255,180,0","255,255,10","255,255,80"],r:150+s(10)},p1a:{m:40,c:d(100,60,80,80,0,120),r:35+s(10),d:500+s(20),v:.002,a:s()},p1b:{m:40,c:d(100,60,80,80,0,120),r:35+s(10),d:500+s(20),v:.002,a:2+s()},p1c:{m:40,c:d(100,60,80,80,0,120),r:35+s(10),d:500+s(20),v:.002,a:4+s()},p2a:{m:30,c:["0,100,180","0,180,220","50,220,255"],r:40,d:900+s(50),v:.001,a:0+.8*s()},m2a1:{m:20,c:["100,100,100","200,200,200","250,250,250"],r:25,d:130+s(10),v:.006,a:s(7),p:"p2a"},p2b:{m:30,c:d(100,60,80,80,0,120),r:35+s(10),d:900+s(50),v:.001,a:1.5+.8*s()},p2c:{m:30,c:d(100,60,80,80,0,120),r:45+s(10),d:900+s(50),v:.001,a:3+.8*s()},p2d:{m:30,c:d(100,60,80,80,0,120),r:35+s(10),d:900+s(50),v:.001,a:4.5+.8*s()},p3a:{m:50,c:d(100,60,80,80,0,120),r:70+s(15),d:1400+s(20),v:5e-4,a:2+s()},p3b:{m:50,c:d(100,60,80,80,0,120),r:80+s(15),d:1400+s(20),v:5e-4,a:4+s()},m3b1:{m:20,c:d(100,60,80,80,0,120),r:20+s(2),d:160+s(10),v:.003,a:s(7),p:"p3b"},m3b2:{m:20,c:d(100,60,80,80,0,120),r:18+s(3),d:230+s(10),v:.0015,a:s(),p:"p3b"},m3b3:{m:20,c:d(100,60,80,80,0,120),r:18+s(3),d:230+s(10),v:.0015,a:3+s(),p:"p3b"},p3c:{m:50,c:d(100,60,80,80,0,120),r:70+s(15),d:1400+s(20),v:5e-4,a:0+s()},p4a:{m:50,c:d(100,60,80,80,0,120),r:50+s(20),d:1900+s(50),v:2e-4,a:0+.8*s()},p4b:{m:50,c:d(100,60,80,80,0,120),r:50+s(20),d:1900+s(50),v:2e-4,a:1.5+.8*s()},p4c:{m:50,c:d(100,60,80,80,0,120),r:50+s(20),d:1900+s(50),v:2e-4,a:3+.8*s()},p4d:{m:50,c:d(100,60,80,80,0,120),r:50+s(20),d:1900+s(50),v:2e-4,a:4.5+.8*s()}},E=1900,I=[],F=[],G=[],N=L.sun,A=null,z=null,U=0,B=0,Y=0,W=0,D=0,V=0,O=.1,H=1,j=null,Q=!1,J={},K=[],q=j,X=.01,Z=window.devicePixelRatio,_=Date.now,$=_();viewport.setAttribute("content","width=device-width, user-scalable=no, initial-scale="+(1/Z+1)/2),Z>=2?g.className+=" pix20":Z>1&&(g.className+=" pix15");try{document.createEvent("TouchEvent")&&(g.className+=" touchable",w=!0)}catch(t){}var te=function(t,e,a){return j.life-=t,j.life<=0?(j.life=0,Ce(j,!0,20),ee(e),!1):void(a&&a())},ee=function(t,a){if(Q||a){if(e("nearExplosion"),Q=!1,!a)return setTimeout(function(){ee(t,!0)},500);q=N,H=V/E/2,t||(t="You die.");var r=Pe(_()-$);deadMsg.innerHTML+=t+'<p/> Notify your allies: <a href="'+R+encodeURIComponent("Check out Gravity, at @js13kGames compo! I died in "+r+" trying to purge the reddish threat.")+'" target="_blank">Twitt</a>, '+winFB.outerHTML+' <a class="bt" onclick="document.location.reload()">Restart</a>',T=function(){document.location.reload()},deadMsg.style.display="block"}};ctrl.onclick=function(){C=!0,T=function(){ctrlClose.click()},ctrlBox.style.display="block"},ctrlClose.onclick=function(){C=!1,ctrlBox.style.display="none"};var ae=900,re=Math.round(2.9*ae),ne=2*ae;!function(){var t=function(t,e){var a,r,n=.52;t/=ae,e/=ae;for(var o=1;255>=o;o++){var i=t*t,l=e*e;if(i+l>4)break;a=i-l+-n,r=2*t*e+n,t=a,e=r}return o},e=function(t,e,a){return(a||1)>(t*e+$)%((t+1e4)/(e+1e3)%77+13)},a=function(t,e){var a=re*(e+ne/2)+t+re/2;return 0>a&&(a=0),a},r=function(t,e,r,n){var o=a(e,r);t[4*o+0]=255*n,t[4*o+1]=400*n,t[4*o+2]=600*n,t[4*o+3]=255*n},n=function(t,e,a,n){r(t,e,a,n),r(t,e,a+1,.6*n),r(t,e+1,a,.6*n),r(t,e+1,a+1,.6*n),n>.5&&(r(t,e-1,a+1,n/2),r(t,e+2,a,n/2),r(t,e,a-1,n/2),r(t,e+1,a+2,n/2))};window.onload=function(){for(var a=f.createImageData(re,ne),r=a.data,o=-re;re>o;o++)for(var i=-ne;ne>i;i++){var l=t(o,i)/255;l>.6&&e(o,i,1.5)&&n(r,o,i,.4*l),l>.4&&e(o,i,.7)&&n(r,o,i,.5*l),e(o,i,.2)&&n(r,o,i,l)}bg.style.width=(bg.width=re)+"px",bg.style.height=(bg.height=ne)+"px",f.clearRect(0,0,re,ne),f.putImageData(a,0,0),window.introNext(),setTimeout(function(){T=window.introNext,introNextBt.style.display="inline-block"},P(2))}}(),(window.onresize=function(){null==A&&(A=L.p2a.d/2,z=L.p2a.d/2),Y=(c.width=D=v.clientWidth)/2,W=(c.height=V=v.clientHeight)/2,map.cx=(map.width=mapBox.clientWidth-10)/2,map.cy=(map.height=mapBox.clientHeight-10)/2})();var oe=function(t){if(!t)return[];var e=[];return I.forEach(function(a){a.planet==t&&e.push(a)}),e},ie=function(t){var e=oe(t);if(0==e.length)return-1;var a=e[0].o;return e.forEach(function(t){a=(a+t.o)/2}),a},le=function(){var t,e={greens:[],reddish:[],conflict:[],total:0};for(var a in L)t=L[a],t!=N&&(e.total++,0==ie(t)?e.greens.push(t):1==ie(t)?e.reddish.push(t):e.conflict.push(t));return e};Array.prototype.remove=function(t){var e=[];return this.forEach(function(a){a!=t&&e.push(a)}),e};var ce,se,de=function(t,e){return{x:e.x+n(t.rotate)*(e.r+t.r),y:e.y+r(t.rotate)*(e.r+t.r)}},ue=function(t,e,a){var o=t.planet;if(o)t.vx=t.vy=0,t.rotateV=.99*(t.rotateV||0),t.rotate=(t.rotate||0)+t.rotateV,t.x=o.x+n(t.rotate||0)*(o.r+t.r),t.y=o.y+r(t.rotate||0)*(o.r+t.r),e&&e(o);else for(var l in L){var o=L[l],c=u(o,t),s=c.d<999?X*o.m/c.d:X*o.m/999;t.vx=(t.vx||0)+s*c.x,t.vy=(t.vy||0)+s*c.y;var d=c.d-o.r-t.r;if(a)for(var h in a)d<=parseInt(h)&&a[h](o,d)}t.rotate%=i,t.rotate<0&&(t.rotate+=i),t.x+=t.vx,t.y+=t.vy},he=function(t,e){var a=u(t,e),r=Math.acos(a.x),n=Math.asin(a.y),o=n>0?r:i-r;return o%i},fe=function(t){j.crew.push(t),I=I.remove(t),t.shipIO=_(),t.planet&&Re("addToShip",t.planet),t.planet=null},pe=0,ye=0,be=function(){var t=j.crew[0];t&&_()-ye>P(1)&&ye>t.shipIO&&_()-pe>P(.5)&&(pe=_(),t.shipIO=_(),t.planet=j.planet,t.rotate=j.rotate+s(.5),I.push(t),j.crew=j.crew.remove(t),Re("playerLanding",t.planet))},me=function(t,e){var a={o:1,planet:t,rotate:e||s(i),r:10,build:0,lastShot:0};return G.push(a),a},ve=function(t){for(var e,a=0;e=G[a];a++)if(e.planet==t)return e;return!1},ge=function(t){var e=7,a=le();a.greens.length>.5*a.total&&(e=5),a.greens.length>.8*a.total&&(e=3),1==ie(t)&&oe(t).length>e&&!ve(t)&&me(t)},we=function(t){return t?(Ce(t,!0,20),1==ie(t.planet)?t.build=-5:G=G.remove(t),!0):!1},ke=function(t,e,a,r,n){var o={o:t,x:e,y:a,r:4,vx:r,vy:n};return F.push(o),o},xe=function(t,e,a,r,n,o,l,c,u){var h=40,f=-40;s()<0&&(h*=-1,f*=-1);var p={o:t,r:e||1+s(),x:a||0,y:r||0,vx:n||0,vy:o||0,planet:c,rotate:l||s(i),rotateV:s(.01),shipIO:_()-P(5),color:0==t?d(h/2,40,90,50,f,50):d(110,50,40,50,0,10)};return u!==!1&&I.push(p),c&&Re("born",c),p},Se=function(t){I=I.remove(t),t.planet&&Re("die",t.planet)},Ce=function(t,a,r,n){if(t instanceof Array){var o=t[1].planet?t[1].planet:t[1];t=t[0]}else var o=t.planet?t.planet:t;K.push({x:t.x,y:t.y,vx:o.vx,vy:o.vy,r:r||10,inc:n||1}),a&&e(u(j,t).d<D/O/3?"nearExplosion":"distantExplosion")},Te=_(),Me=function(){Te=_();var t=Math.round(Math.random()*arguments.length);t==arguments.length&&(t=0),msgBox.innerHTML=arguments[t],msgBox.className="visible",setTimeout(function(){msgBox.className=""},P(1))},Re=function(e,a){var r=ie(a);switch(0==r?we(ve(a)):ge(a),e){case"born":break;case"die":break;case"conflict":Me("A green died with honor.","A green died, but he took a reddish with him.");break;case"addToShip":Te<_()-P(6)&&Me("","A green enlistment to the crew.","","A new green enter in the ship.","","Today is a good day to die.","");break;case"playerLanding":Te<_()-P(6)&&Me("","It's always a great day when a green lands a planet.","","A new green land the planet.","","We will rule this planet!","");break;case"enemyLanding":1==r?Te<_()-P(6)&&Me("","Our radar detects a reddish has landed a planet.","","Reddish reinforcements was landed on a <b>non green</b> planet.",""):Te<_()-P(2)&&Me("Our radar detects a reddish has landed a green planet!","Reddish reinforcements was landed on a conflicting planet.","WARNING! WARNING! Reddish landing on one of our planets!")}var n=le();n.greens.length==n.total&&(t.pause(),setTimeout(Le,P(.5))),0==n.greens.length&&0==n.conflict.length&&ee("You lose all your planets")},Pe=function(t){var e=new Date(t),a=e.getUTCHours(),r=e.getUTCMinutes(),n="";return 1==a?n+="one hour":a>0&&(n+=a+" hours"),a>0&&r>0&&(n+=" and "),1==r?n+="one minute":r>0&&(n+=r+" minutes"),""==n&&(n=e.getUTCSeconds()+" seconds"),n},Le=function(){e("win"),C=!0;var t=Pe(_()-$);finishTime.innerHTML=t,playerWin.style.display="block",winTwitt.href=R+encodeURIComponent("Check out Gravity, at @js13kGames compo! I purged the reddish threat from my star system in "+t+"."),winFB.onclick=winTwitt.onclick=winBMGoogle.onclick=function(){breakingNewsBt.style.display="inline-block"}},Ee=0,Ie=30,Fe=_();setInterval(function(){ce=Math.round(1e3/(_()-Fe)),20>ce&&20>se&&Ee>10*Ie&&(3>k||x)&&Q&&!C&&Me("Your framerate is too low!<br>You may try tho disble some graphic features at the config dialog."),se=ce,Fe=_(),function(){if(!(Ee>0&&C)){Ee++;var t,l;if(j&&(life.style.width=Math.round(j.life)+"%",Q)){Q&&(j.life+=.01),0==ie(j.planet)&&(j.life+=.02),j.life>100&&(j.life=100);var c=a(j.vx)+a(j.vx);H=c>1?2/c:2,.5>H&&(H=.5)}for(var d in L)if(t=L[d],t.d){t.a+=t.v;var h=t.x,f=t.y;t.x=n(t.a)*t.d+L[t.p||"sun"].x,t.y=r(t.a)*t.d+L[t.p||"sun"].y,t.vx=t.x-h,t.vy=t.y-f}else t.x=t.y=0;if(t=L,0==I.length){for(var p=0;13>p;p++)xe(0,1+s(),0,0,0,0,null,t.p2a);xe(1,3,0,0,0,0,null,t.p3a),xe(1,3,0,0,0,0,null,t.p3b),xe(1,3,0,0,0,0,null,t.p3c)}Ee%(10*Ie)==0&&xe(1,2,(j.x>0?-1.2:1.2)*E,s(4e3),0,s(10)),j||(Q=!0,j={crew:[xe(0,2,0,0,0,0,null,null,!1)],weapon:!0,planet:t.p2a,rotate:-o/2,r:10,life:100},q=j),Q&&(Te<_()-P(10)&&(j.planet?0==ie(j.planet)?j.crew.length<3?Me("","C'mon folks! Enter on the ship.","Full this ship and let's get another planet!"):Me("You can takeoff, boss.","Let's get another planet!","The ship is full! Let's get another planet!!!"):ie(j.planet)>0?0==j.crew.length&&Me("This reddish can attack the our landed ship.","They can attack the ship, boss.","What are you waiting for? Takeoff!"):0==j.crew.length&&Me("Takeoff and come back with some crew.","If you had taken some crew, we could owned this planet..."):u(j,N).d<450?Me("DANGER!!! DANGER!!!","I hate the sun lower orbit!!!","Boss! The sun can destroy us!","oOooww daddy... Let's go back home... pleezzz?"):u(j,N).d>1.1*E?Me("Where are you going?","We are too far away, boss!","oOooww daddy... Let's go back home... pleezzz?"):0==j.crew.length?Me("","Let's take some crew, so we can own another planet.","","Hey! Let's take a crew, so you can own some planet.","","Bud... You need to take some crew.","","Boss, where is your green ones?",""):Me("","Let's take another planet?","","Uninhabited planets are easier to take.","","Hey pally, let's rule some reddish planet?","","Boss, you can let the autopilot to land us.","","You only need to gently approach the planet. The autopilot land us.","Hey bud, let's fire our missiles against a reddish planet?")),ue(j,function(t){j.rotateV=0,oe(t).length<7?be():ie(t)>.3&&Me("Are you crazy? We will die!")},{15:function(t){var e=he(j,t);o/2>e&&j.rotate>1.5*o&&(j.rotate-=i),e>1.5*o&&j.rotate<o/2&&(j.rotate+=i),e-j.rotate>.2?j.rotate+=.1:e-j.rotate>.1&&(j.rotate+=.03),e-j.rotate<-.2?j.rotate-=.1:e-j.rotate<-.1&&(j.rotate-=.03)},0:function(t,a){if(t==N)te(1e5,"You crash in the sun before colonize all start system.");else{if(-1.5>a){var r=Math.round(-100*a)+"uF.</strong> Maximum is 150uF.";te(90,"You crash in a planet before colonize all start system.<p/><strong>Impact: "+r,function(){Ce([j,t],!0,10),Me("Slow down! The <strong>impact was "+r+"You was just about to explode.")})}else u(j,de(j,t)).d>20&&te(50,"You crash in a planet before colonize all start system.<p/><strong>Bad angle.</strong>",function(){Ce([j,t],!0,10),Me("Trust on your landing autopilot.","The landing autopilot needs your collaboration.")});j.planet=t,j.rotate=he(j,t),e("landing")}}}),J.btU&&(j.planet?(j.vx=.2*n(j.rotate)+j.planet.vx,j.vy=.2*r(j.rotate)+j.planet.vy,j.planet=!1):(j.vx+=.1*n(j.rotate),j.vy+=.1*r(j.rotate))),j.rotateJet=J.btL?-.01:J.btR?.01:0,j.rotateV+=j.rotateJet,j.rotate+=j.rotateV,j.rotateV*=.99),G.forEach(function(t){if(ue(t),t.build<10&&(t.build+=.02),t.build>=10&&u(t,j).d<800&&Q&&j.planet!=t.planet){var l=he(j,t.planet);o/2>l&&t.rotate>1.5*o&&(t.rotate-=i),l>1.5*o&&t.rotate<o/2&&(t.rotate+=i),l-t.rotate>.1?t.rotate+=.03:l-t.rotate>.02?t.rotate+=.01:l-t.rotate>.01?t.rotate+=.003:l-t.rotate<-.1?t.rotate-=.03:l-t.rotate<-.02?t.rotate-=.01:l-t.rotate<-.01&&(t.rotate-=.003),a(l-t.rotate)<.2&&_()-t.lastShot>P(3)&&(t.lastShot=_(),ke(1,t.x,t.y,t.planet.vx+4*n(t.rotate),t.planet.vy+4*r(t.rotate)),e("gun"))}}),F.forEach(function(t){ue(t,function(){},{2:function(e){t.planet=e,Ce(t,!0,25),F=F.remove(t);var a=0,r=ve(e);r&&u(t,r).d<40&&(we(r),a++),I.forEach(function(e){u(t,e).d<40&&(a+=0==e.o?-99:1,Ce(e,!1,2,.2),Se(e)),0>a?0==t.o?Me("OMG! You killed Kenny. You bastard!","Ops... You shot a green one.","Do you know who is your team?"):Me("","OMG! You killed Kenny. You bastard!","","FUUUUU!!! Reddish are shoting us!","","Tel my wife... I... love... guacamole.",""):0==a?0==t.o&&Me("","How can you miss that!?","Thank you, for the lost missile.","Did you know how much that missile costs to our economy?"):Me("","Suck it!","Suck it reddish!","A reddish cleaner missile.","This is MY planet!")})}}),t.t=(t.t||0)+1,t.t>1e3&&(F=F.remove(t),Ce(t,!1,4)),0!=t.o&&u(j,t).d<j.r+t.r&&(F=F.remove(t),Ce([t,j],!0,20),te(25,"Your shields was not enough for this missile."))}),K.forEach(function(t){ue(t),t.t=t.t?t.t+1:.5,t.t>19&&(K=K.remove(t)),t.inc||(t.inc=1)}),I.forEach(function(t){ue(t,function(e){j.planet==e?(t.rotateV+=(oe(e).length<4||_()-t.shipIO<P(5))&&a(j.rotate-t.rotate)<o/2?t.rotate<j.rotate?-2e-4:2e-4:oe(e).length>3?t.rotate<j.rotate?1e-4:-1e-4:t.rotate<j.rotate?-1e-5:1e-5,a(j.rotate-t.rotate)<.01&&j.crew.length<3&&_()-t.shipIO>P(3)&&Q&&(0==t.o?fe(t):(Ce([t,j],!1,2,.2),te(1,"Enemy boids has destroyed your ship.",function(){Me("Enemy boids are attacking the ship!")})))):(0==(t.rotateV||0)&&(t.rotateV=.01),a(t.rotateV)<.002&&(s()<-.49&&(t.rotateV*=-1),t.rotateV*=1.5)),t.r<=2?t.r+=0==t.o?.004:.002:oe(e).length<e.r/6&&(t.r<=3?t.r+=.003:s()<-.49&&(t.r=1.5,xe(t.o,1+s(.5),0,0,0,0,t.rotate+s(.001),e)))},{0:function(e){e==N?(Se(t),Ce([t,N],!1,2,.3)):(t.planet=e,t.rotate=he(t,e),0==t.o?Re("playerLanding",t.planet):Re("enemyLanding",t.planet))}}),I.forEach(function(e){if(e!=t&&(l=u(e,t),l.d-t.r-e.r<0))if(t.o!=e.o)Se(t),Se(e),t.planet&&Re("conflict",t.planet),Ce(t,!1,2,.2),Ce(e,!1,2,.2);else if(t.planet){var a=t.r/5e3*(t.rotate<e.rotate?1:-1);t.rotateV-=a,e.rotateV+=a}else t.vx+=(1-l.x)/100,t.vy+=(1-l.y)/100,e.vx-=(1-l.x)/100,e.vy-=(1-l.y)/100})})}}(),function(){var t=(H+9*O)/10;Q&&a(t-O)>.005?O+=.005*(0>t-O?-1:1):O=t,U=Y-q.x*O,B=W-q.y*O,1>O?(A=(U+10*A)/11,z=(B+10*z)/11):(A=(U+5*A)/6,z=(B+5*z)/6),x&&(p=(-q.x+5*p)/6,y=(-q.y+5*y)/6,bg.style.transform=bg.style.oTransform=bg.style.msTransform=bg.style.mozTransform=bg.style.webkitTransform="translate("+(.5*p/(re/D)-(re-D)/2)+"px,"+(.5*y/(ne/V)-(ne-V)/2)+"px) rotate(13deg)");var e,o=map.height/E/2.2;for(var l in h)CanvasRenderingContext2D.prototype[l.replace(/(.)[a-z]+/g,"$1")]=h[l];h.clearRect(0,0,D,V),b.clearRect(0,0,map.width,map.height),F.forEach(function(t){h.fillStyle="rgb(255,"+Math.round(127*(r(Ee/2)+1))+",0)",h.strokeStyle="rgb(255,"+Math.round(127*(n(Ee/2)+1))+",0)",h.bP(),h.arc(O*t.x+A,O*t.y+z,O*(t.r-1),0,7),h.fill(),h.lineWidth=1.5*O,h.stroke(),b.fillStyle=h.fillStyle,b.bP(),b.arc(o*t.x+map.cx,o*t.y+map.cy,o*t.r*4,0,7),b.cP(),b.fill()}),G.forEach(function(t){h.save(),h.translate(O*t.x+A,O*t.y+z),h.rotate(t.rotate),3>k?(e=h.createLinearGradient(-15*O,0,(t.build-17)*O*.6,0),e.addColorStop(0,"#800"),e.addColorStop(1,"#D60")):e="#D60",h.fillStyle=e,h.bP(),h.lT(-20*O,-10*O),h.lT((t.build-20)*O*.6,-10*O),h.lT((t.build-17)*O*.6,-8*O),h.lT((t.build-17)*O*.6,8*O),h.lT((t.build-20)*O*.6,10*O),h.lT(-20*O,10*O),h.cP(),h.fill(),3>k?(e=h.createLinearGradient(0,-5*O,0,5*O),e.addColorStop(0,"#920"),e.addColorStop(.45,"#C50"),e.addColorStop(.55,"#C50"),e.addColorStop(1,"#920")):e="#B40",h.fillStyle=e,h.fillRect(-15*O,-5*O,2.6*(t.build-5)*O,10*O),h.restore()});var c=O>.5?.45+O/10:O,d=c*N.r*3;3>k?(e=h.createRadialGradient(A,z,0,A,z,d),e.addColorStop(0,"rgb("+N.c[0]+")"),e.addColorStop(.2,"rgba("+N.c[0]+",0.5)"),e.addColorStop(1,"rgba("+N.c[0]+",0)"),h.fillStyle=e):(d=c*N.r*2,h.fillStyle="#FC0"),h.bP();for(var u=(_()-$)/16e3,f=u;u+7>f;f+=.628)h.arc(A,z,d,f,f+.314),h.lT(A,z);h.cP(),h.fill();for(var m in L){var v=L[m];1==k&&(e=h.createRadialGradient(O*v.x+A,O*v.y+z,0,O*v.x+A,O*v.y+z,O*v.r*2),e.addColorStop(0,"rgb("+v.c[1]+")"),e.addColorStop(.48,"rgb("+v.c[1]+")"),e.addColorStop(.48,"rgba("+v.c[2]+","+(v==N?.6:.3*(O>.5?O:.5))+")"),e.addColorStop(1,"rgba(0,0,0,0)"),h.fillStyle=e,h.bP(),h.arc(O*v.x+A,O*v.y+z,O*v.r*(v==N?3:2),0,7),h.cP(),h.fill()),2==k&&(h.fillStyle="rgb("+v.c[1]+")",h.bP(),h.arc(O*v.x+A,O*v.y+z,O*v.r*.99,0,7),h.cP(),h.fill()),3>k?(e=h.createRadialGradient(O*v.x+A,O*v.y+z,0,O*v.x+A,O*v.y+z,O*v.r),e.addColorStop(0,"rgba("+v.c[1]+",0)"),e.addColorStop(1,"rgb("+v.c[0]+")"),h.fillStyle=e):h.fillStyle="rgb("+v.c[0]+")",h.bP(),h.arc(O*v.x+A,O*v.y+z,O*v.r,0,7),h.cP(),h.fill();var g,w=ie(v);g=-1==w?"rgb(220,220,220)":0==w?"rgb(50,240,50)":1==w?"rgb(240,100,50)":"rgb(255,0,255)",b.fillStyle=v==N?"#FF7":g,b.bP(),b.arc(o*v.x+map.cx,o*v.y+map.cy,o*v.r,0,7),b.cP(),b.fill()}if(I.forEach(function(t){h.strokeStyle="rgba("+t.color[1]+",0.6)",h.bP(),h.mT(O*t.x+A,O*t.y+z),h.lT(O*t.vx*-10+O*t.x+A,O*t.vy*-10+O*t.y+z),h.cP(),h.stroke(),h.bP(),h.strokeStyle="rgb("+t.color[0]+")",h.fillStyle="rgb("+t.color[1]+")",h.arc(O*t.x+A,O*t.y+z,O*t.r,0,7),h.cP(),h.fill(),h.lineWidth=.8*O,h.stroke()}),Q){b.strokeStyle="rgba(0,200,200,0.5)",h.bP(),b.mT(o*j.x+map.cx,o*j.y+map.cy),b.arc(o*j.x+map.cx,o*j.y+map.cy,2,j.rotate,j.rotate+i),b.arc(o*j.x+map.cx,o*j.y+map.cy,9,j.rotate,j.rotate+i),b.cP(),b.stroke(),h.save(),h.translate(O*j.x+A,O*j.y+z),h.rotate(j.rotate);var S=1>O?(O+1)/2:O;h.scale(S,S),J.btU&&(e=h.createRadialGradient(-9+s(1),0,1,-11,0,4),e.addColorStop(0,"#FF0"),e.addColorStop(1,"#F00"),h.fillStyle=e,h.bP(),h.mT(-7.5,0),h.bCT(-11,-7.5,-13,-.5,-20+s(2),0),h.bCT(-13,1,-11,7.5,-7.5,0),h.fill()),J.btR&&(e=h.createRadialGradient(7.5,-5,0,7.5,-6,2),e.addColorStop(0,"#FF0"),e.addColorStop(1,"#F00"),h.fillStyle=e,h.bP(),h.mT(7.5,-4),h.bCT(10,-6.5,8,-6.5,7.5,-11+s(2)),h.bCT(7,-6.5,5,-6.5,7.5,-4),h.fill()),J.btL&&(e=h.createRadialGradient(7.5,5,0,7.5,6,2),e.addColorStop(0,"#FF0"),e.addColorStop(1,"#F00"),h.fillStyle=e,h.bP(),h.mT(7.5,4),h.bCT(10,6.5,8,6.5,7.5,11+s(2)),h.bCT(7,6.5,5,6.5,7.5,4),h.fill()),h.fillStyle="#599",h.bP(),h.mT(-2.5,-9.5),h.bCT(7.5,-12.5,7.5,12.5,-2.5,9.5),h.cP(),h.fill(),3>k?(e=h.createRadialGradient(1,0,0,1,0,10),e.addColorStop(0,"#F0F8F8"),e.addColorStop(1,"#799"),h.fillStyle=e):h.fillStyle="#ACC",h.bP(),h.mT(-9,-4.5),h.bCT(0,-10,9.5,-4,10,0),h.bCT(10,4,0,10,-9,4.5),h.lT(-8,0),h.fill(),h.lineWidth=1/(O+.5),h.strokeStyle="#181";var C=function(t){var e=j.crew;h.bP(),h.fillStyle=e[t]?"rgb("+e[t].color[1]+")":"#888",h.arc(-4+4*t,0,2,0,7),h.cP(),h.fill(),h.stroke()};C(0),C(1),C(2),h.restore()}K.forEach(function(t){h.fillStyle="rgba(255,255,255,"+(20-t.t)/20+")",h.bP(),h.arc(O*t.x+A,O*t.y+z,O*(t.r+t.t*t.inc),0,7),h.fill()})}()},1e3/Ie),m.onclick=function(){m.fullScreenEnabled&&g.requestFullscreen(),m.mozFullScreenEnabled&&g.mozRequestFullScreen(),m.webkitFullscreenEnabled&&v.webkitRequestFullScreen()};var Ge=function(t,e){ye=_(),J[t]=e,window[t].className=e?"pressed":""},Ne=function(){j.weapon&&(btW.className="empty",j.weapon=!1,ke(0,j.x,j.y,(j.planet?j.planet.vx:j.vx)+4*n(j.rotate),(j.planet?j.planet.vy:j.vy)+4*r(j.rotate)),e("gun"),setTimeout(function(){btW.className="",j.weapon=!0},P(4)))},Ae=0;window.introNext=function(){Ae>3||(window["introTxt"+Ae++].style.display="none",3>=Ae&&(window["introTxt"+Ae].style.display="block"),3==Ae&&(introNextBt.innerHTML="Close"),4==Ae&&(intro.style.display="none",C=!1))},m.onkeydown=function(t){switch(t.keyCode){case 38:Ge("btU",!0);break;case 37:Ge("btL",!0);break;case 39:Ge("btR",!0);break;case 32:Ne();break;case 80:C=!C,Me(C?"Paused":"Playing")}},m.onkeyup=function(t){switch(t.keyCode){case 38:Ge("btU",!1);break;case 37:Ge("btL",!1);break;case 39:Ge("btR",!1);break;case 13:T()}};var ze=function(t){window[t].addEventListener("touchstart",function(){Ge(t,!0)}),window[t].addEventListener("touchend",function(){Ge(t,!1)})};ze("btL"),ze("btR"),ze("btU"),btW.addEventListener("touchstart",function(){Ne()}),ctrlQ1.onclick=function(){k=1},ctrlQ2.onclick=function(){k=2},ctrlQ3.onclick=function(){k=3},toggleStars.onclick=function(){x=!x,bg.style.display=x?"block":"none"},ctrlM.onclick=function(){this.checked?t.play():t.pause()},ctrlS.onclick=function(){S=this.checked},ctrlQ1.click(),toggleStars.checked=!0,ctrlM.checked=!0,ctrlS.checked=!0}();