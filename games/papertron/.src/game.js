!function(){var a="undefined"==typeof module?window:module;a.exports=function(){function a(a,b,c,d,e){this.x=a,this.y=b,this.vec=c,this.id=d,this.bot=!e,this.nick=e||"Robot",this.time=0,this.data=[],this.stuck=!1,this.crash=!1,this.add()}function b(a,c){this.timer=30,this.rubber=5,this.distance=80,this.start=(new Date).getTime()+5e3,this.motors=[],this.bots=[],this.mode=parseInt(a)||0,this.pos=b.maps[parseInt(c)||0]}return a.U=0,a.R=1,a.D=2,a.L=3,a.prototype.add=function(){this.data.unshift([this.x,this.y,this.vec,this.time])},a.prototype.move=function(b){var c=this.data[0][3],d=this.stuck?this.stuck-c:b-c;switch(this.x=this.data[0][0],this.y=this.data[0][1],this.vec=this.data[0][2],this.vec){case a.L:this.x-=d;break;case a.R:this.x+=d;break;case a.U:this.y-=d;break;case a.D:this.y+=d}this.time=b},a.prototype.turn=function(b){if(!this.crash)switch(b){case a.L:--this.vec<a.U&&(this.vec=a.L),this.add(),this.stuck=!1;break;case a.R:++this.vec>a.L&&(this.vec=a.U),this.add(),this.stuck=!1}},a.prototype.back=function(){this.x=this.data[0][0],this.y=this.data[0][1],this.vec=this.data[0][2],this.time=this.data[0][3],this.data.shift()},a.prototype.check=function(b,c,d,e){var f,g,h,i,j,k=this.x,l=this.y,m=this.data[0][0],n=this.data[0][1];if(k!==m||l!==n){if(f=(d-b)*(n-l)-(e-c)*(m-k),g=(c-l)*(m-k)-(b-k)*(n-l),h=(c-l)*(d-b)-(b-k)*(e-c),0!==f)return i=g/f,j=h/f,i>=0&&1>=i&&j>=0&&1>=j;if(0===g&&0===h)switch(this.vec){case a.L:case a.R:return b>=m&&m>=d||d>=m&&m>=b||b>=k&&k>=d||d>=k&&k>=b;case a.U:case a.D:return c>=n&&n>=e||e>=n&&n>=c||c>=l&&l>=e||e>=l&&l>=c}}return!1},a.prototype.wall=function(a){return this.x>a||this.x<-a||this.y>a||this.y<-a},a.prototype.ai=function(b){var c=this,d=c.time,e=Math.random()*c.id,f=e-Math.floor(e),g=f>=.5,h=d+10+Math.round(10*f),i=!1;return c.stuck||(c.move(h),(b.check(c)||f>.998)&&(i=g?a.R:a.L,c.move(d),c.turn(i),c.move(h),b.check(c)&&(i=g?a.L:a.R,c.back(),c.turn(i),c.move(h),b.check(c)&&(c.back(),i=!1))),c.move(d)),i},b.maps=[[[0,10,2],[0,-10,0],[-10,0,3],[10,0,1]],[[0,40,0],[0,-40,2],[-40,0,1],[40,0,3]],[[40,40,0],[-40,-40,2],[-40,40,1],[40,-40,3]]],b.prototype.save=function(){return{time:this.getTime(),data:this.motors}},b.prototype.load=function(a){var b,c,d,e;for(b=0;b<a.data.length;b++){c=a.data[b],d=this.motors[b]||this.add(c.nick);for(e in c)d[e]=c[e]}},b.prototype.setTime=function(a){this.start=(new Date).getTime()-a*this.timer},b.prototype.getTime=function(a){var b=((new Date).getTime()-this.start)/this.timer;return a?b:Math.round(b)},b.prototype.add=function(b){var c=null,d=this.motors.length;if(d<this.pos.length)c=new a(this.pos[d][0],this.pos[d][1],this.pos[d][2],d,b),this.motors.push(c);else for(d=0;d<this.motors.length;d++)if(this.motors[d].bot){c=this.motors[d],c.bot=!1,c.nick=b;break}return c},b.prototype.check=function(b){var c=b.wall(this.distance);return c||this.motors.forEach(function(d){for(var e,f=d.x,g=d.y,h=0;!c&&h<d.data.length;){switch(e=d.data[h],e[2]){case a.L:f++;break;case a.R:f--;break;case a.U:g++;break;case a.D:g--}(h>0||d!==b)&&(c=b.check(f,g,e[0],e[1])),f=e[0],g=e[1],h++}}),c},b.prototype.ai=function(a){var b,c,d,e=this.getTime();for(b=0;b<this.motors.length;b++)d=this.motors[b],d.bot&&(c=d.ai(this),c&&a&&a.call(this,c,e,b))},b.prototype.run=function(a){var b,c,d,e=this.getTime(!a),f=0,g=0;if(e>0){for(d=0;d<this.motors.length;d++)c=this.motors[d],c.move(e);for(d=0;d<this.motors.length;d++)c=this.motors[d],!c.stuck&&this.check(c)&&(c.stuck=e-1,c.move()),c.stuck&&!c.crash&&(c.crash=e-c.stuck>this.rubber,c.crash&&a&&a.call(this,d,e)),c.crash?f++:(c.bot||g++,b=d);if(f>=d-1&&f>0||0===g)return b||0}return!1},{Motor:a,Match:b}}()}();