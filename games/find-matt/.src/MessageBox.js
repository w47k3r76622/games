class MessageBox{constructor(t,s,i,e={width:60,height:25},a){this.scene=t,this.canvas=document.createElement("canvas"),this.cameraPosition=i,this.size=e,this.pages=void 0,this.pageCursor=0,this.options=a,this.camera=s,this.starshipPosition=i;const o=new THREE.Raycaster;o.setFromCamera({x:0,y:0},s);let n=new THREE.Vector3;o.ray.at(45,n),this.boxPosition={x:n.x,y:n.y,z:n.z};const{x:h,y:r,z:p}=this.boxPosition,{width:l,height:c}=this.size;let x=new THREE.PlaneGeometry(l,c);this.material=new THREE.MeshBasicMaterial,this.material.map=new THREE.CanvasTexture(this.canvas),this.plane=new THREE.Mesh(x,this.material),this.plane.position.x=h,this.plane.position.y=r-50,this.plane.position.z=p,this.plane.kind="message",this.plane.lookAt(i),this.scene.add(this.plane)}updateText(t){const s=t||this.pages[this.pageCursor],i=this.canvas.getContext("2d"),e=i.canvas.width,a=i.canvas.height;if(i.clearRect(0,0,e,a),i.fillStyle="#222222",i.fillRect(0,0,e,a),i.font=`${this.options&&this.options.fontSize||"20px"} Lucida Console`,i.fillStyle="white",s){s.split("\n").forEach((t,s)=>{i.fillText(t,5,50+24*s,e)})}this.material.map.needsUpdate=!0}render(t){this.pages||(this.pages="string"==typeof t?[t]:t),this.pages&&"string"==typeof t&&(this.pages=[t]),this.updateText()}followCamera(){if(this.options&&this.options.static){const t=new THREE.Raycaster;t.setFromCamera({x:0,y:0},this.camera);let s=new THREE.Vector3;t.ray.at(this.options&&this.options.distance||100,s),this.boxPosition={x:s.x,y:s.y,z:s.z};const{x:i,y:e,z:a}=this.boxPosition;this.plane.position.x=i,this.plane.position.y=e-(this.options&&this.options.yOffset||30),this.plane.position.z=a,this.plane.lookAt(this.starshipPosition)}}autoNext(t){return new Promise(s=>{const i=setInterval(()=>{this.next()||(clearInterval(i),s())},t||2e3)})}next(){if(this.pages)return this.pageCursor+=1,this.pageCursor===this.pages.length?(this.destroy(),!1):(this.render(),!0)}reset(){this.pages=void 0,this.pageCursor=0}destroy(){this.reset(),this.scene.remove(this.plane)}}
