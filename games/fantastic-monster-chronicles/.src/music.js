!function(t){function e(t){var s=t.split(a);this.frequency=e.getFrequency(s[0])||0,this.duration=e.getDuration(s[1])||0}function s(t,e,s){t&&(this.ac=t,this.createFxNodes(),this.tempo=e||120,this.loop=!0,this.smoothing=0,this.staccato=0,this.notes=[],this.push.apply(this,s||[]))}var i="B#-C|C#-Db|D|D#-Eb|E-Fb|E#-F|F#-Gb|G|G#-Ab|A|A#-Bb|B-Cb",o=440*Math.pow(Math.pow(2,1/12),-9),n=/^[0-9.]+$/,c=4,a=/\s+/,h=/(\d+)/,r={};i.split("|").forEach(function(t,e){t.split("-").forEach(function(t){r[t]=e})}),e.getFrequency=function(t){var e=t.split(h),s=r[e[0]],i=(e[1]||c)-c,n=o*Math.pow(Math.pow(2,1/12),s);return n*Math.pow(2,i)},e.getDuration=function(t){return n.test(t)?parseFloat(t):t.toLowerCase().split("").reduce(function(t,e){return t+("w"===e?4:"h"===e?2:"q"===e?1:"e"===e?.5:"s"===e?.25:0)},0)},"undefined"!=typeof module&&(module.exports=e),s.prototype.createFxNodes=function(){var t=[["bass",100],["mid",1e3],["treble",2500]],e=this.gain=this.ac.createGain();return this.wet=this.ac.createGain(),this.dry=this.ac.createGain(),t.forEach(function(t,s){s=this[t[0]]=this.ac.createBiquadFilter(),s.type="peaking",s.frequency.value=t[1],e.connect(e=s)}.bind(this)),e.connect(this.wet),e.connect(this.dry),this},s.prototype.push=function(){return Array.prototype.forEach.call(arguments,function(t){this.notes.push(t instanceof e?t:new e(t))}.bind(this)),this},s.prototype.createOscillator=function(){return this.stop(),this.osc=this.ac.createOscillator(),this.osc.type=this.waveType||"square",this.osc.connect(this.gain),this},s.prototype.scheduleNote=function(t,e){var s=60/this.tempo*this.notes[t].duration,i=s*(1-(this.staccato||1e-11));return this.setFrequency(this.notes[t].frequency,e),this.smoothing&&this.notes[t].frequency&&this.slide(t,e,i),this.setFrequency(0,e+i),e+s},s.prototype.getNextNote=function(t){return this.notes[t<this.notes.length-1?t+1:0]},s.prototype.getSlideStartDelay=function(t){return t-Math.min(t,60/this.tempo*this.smoothing)},s.prototype.slide=function(t,e,s){var i=this.getNextNote(t),o=this.getSlideStartDelay(s);return this.setFrequency(this.notes[t].frequency,e+o),this.rampFrequency(i.frequency,e+s),this},s.prototype.setFrequency=function(t,e){return this.osc.frequency.setValueAtTime(t,e),this},s.prototype.rampFrequency=function(t,e){return this.osc.frequency.linearRampToValueAtTime(t,e),this},s.prototype.play=function(t){return t="number"==typeof t?t:this.ac.currentTime,this.createOscillator(),this.osc.start(t),this.notes.forEach(function(e,s){t=this.scheduleNote(s,t)}.bind(this)),this.osc.stop(t),this.osc.onended=this.loop?this.play.bind(this,t):null,this},s.prototype.stop=function(){return this.osc&&(this.osc.onended=null,this.osc.stop(0),this.osc.frequency.cancelScheduledValues(0),this.osc=null),this},"undefined"!=typeof module&&(module.exports=s),t.Note=e,t.Sequence=s}("undefined"!=typeof window?window:this);var ac,tempo=80,volume=.2;(window.AudioContext||window.webkitAudioContext)&&(ac=new(window.AudioContext||window.webkitAudioContext));var Music={init:function(){ac&&(this.ac=ac,this.osc=this.ac.createOscillator(),this.compressor=this.ac.createDynamicsCompressor(),this.output=this.ac.createGain(),this.output.connect(this.ac.destination),this.output.gain.value=volume,this.reverb=this.ac.createConvolver(),this.reverb.buffer=this.createReverb(2),this.reverb.connect(this.compressor),this.collision1.dry.connect(this.output),this.collision1.gain.gain.value=.4,this.collision1.loop=!1,this.collision2.dry.connect(this.output),this.collision2.gain.gain.value=.4,this.collision2.loop=!1,this.osc.frequency.value=0,this.osc.connect(this.compressor),this.osc.start(),this.bass.wet.connect(this.reverb),this.lead.wet.connect(this.reverb),this.bass.dry.connect(this.compressor),this.lead.dry.connect(this.compressor),this.compressor.ratio.value=4,this.compressor.threshold.value=-12,this.compressor.connect(this.output),this.bass.staccato=.25,this.bass.waveType="sawtooth",this.bass.treble.type="lowpass",this.bass.treble.frequency.value=1e3,this.bass.mid.gain.value=-5,this.lead.smoothing=0,this.lead.gain.gain.value=.35,this.lead.wet.gain.value=1.5)},play:function(){var t,e;this.ac&&(t=this.ac.currentTime,e=t+60/tempo*16,this.lead.play(t),this.bass.play(t))},stop:function(){this.ac&&(this.lead.stop(),this.bass.stop())},createReverb:function(t,e){var s=ac.sampleRate,i=s*t,o=this.ac.createBuffer(2,i,s),n=o.getChannelData(0),c=o.getChannelData(1),a=0;for(e||(e=2);i>a;++a)n[a]=(2*Math.random()-1)*Math.pow(1-a/i,e),c[a]=(2*Math.random()-1)*Math.pow(1-a/i,e);return o},bass:new Sequence(ac,tempo,["C2  h","C2  h","G2  h","G2  h","E2  h","E2  h","D2  h","D2  h"]),lead:new Sequence(ac,tempo,["B3 q","D3 q","G3 q","A4 q","B3 q","D3 q","G3 q","A4 q","B3 q","D4 q","C4 q","b3 q","A4 q","G3 q","A4 q","B3 q","C4 q","G3 q","A4 q","B3 q","D4 e","D4 e","D4 e","B4 e","A4 s","B4 s","G3 e","A4 e","D4 e","C4 e","B4 h","A4 e","E3 e","G3 q","B4 e","D4 q","G3 e","C4 e","E4 e","F4 e","E4 e","C4 q","B4 e","C4 e","A4 e","D3 e","C4 e","B4 e","G3 e","D3 e","B4 e","F3 q","E3 q","D3 q","- e","D3 e","C4 q","B4 e","A4 q","D3 q","C4 e","B4 e","A4 e","G3 e","A4 q","E3 e","G3 q","B4 e","D4 q","G3 e","C4 e","E4 e","F4 e","E4 e","C4 q","B4 e","C4 e","A4 e","D3 e","C4 e","B4 e","G3 e","D3 e","B4 e","F3 q","F3 q","G3 q","- e"]),collision1:new Sequence(ac,220,["G3 s","D4 s","G4 s"]),collision2:new Sequence(ac,220,["G4 s","D4 s","G3 s"])};