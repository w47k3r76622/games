Game=function(){var a={canvas:null,canvasEl:null,updateInterval:null,drawRequest:null,events:{},entities:[],beforeUpdate:[],afterUpdate:[],beforeDraw:[],afterDraw:[],beforeAddEntity:[],afterAddEntity:[],beforeRemoveEntity:[],afterRemoveEntity:[],onClick:[],onKeyDown:[],onKeyUp:[],onKeyPress:[],beforeRun:[],afterRun:[],utils:{},plugins:{},config:{},winGame:function(){},gameOver:function(){},addEntity:function(b){b.beforeDraw=[];b.afterDraw=[];b.beforeUpdate=[];b.afterUpdate=[];for(var c in a.beforeAddEntity)a.beforeAddEntity[c](b);
a.entities.push(b);for(c in a.afterAddEntity)a.afterAddEntity[c](b)},removeEntity:function(b){for(var c in a.beforeRemoveEntity)a.beforeRemoveEntity[c](b);var d=a.entities.slice(),e=d.length;for(c=0;c<e;c++)d[c].name==b.name&&delete d[c];a.entities=d.filter(function(a){return"undefined"!=typeof a});for(c in a.afterRemoveEntity)a.afterRemoveEntity[c](b)},getEntity:function(b){for(var c=a.entities.slice(),d=c.length,e=0;e<d;e++)if(c[e].name==b)return c[e]},draw:function(){a.canvas.clearRect(0,0,a.canvas.width,
a.canvas.height);for(var b in a.beforeDraw)a.beforeDraw[b](a.canvas);var c=a.entities.slice();for(b=0;b<c.length;b++){for(var d in c[b].beforeDraw)c[b].beforeDraw[d](a.canvas,c[b],a);c[b].draw&&c[b].draw(a.canvas,c[b],a);for(d in c[b].afterDraw)c[b].afterDraw[d](a.canvas,c[b],a)}for(b in a.afterDraw)a.afterDraw[b](a.canvas);a.drawRequest=requestAnimationFrame(function(){a.draw()})},update:function(){for(var b in a.beforeUpdate)a.beforeUpdate[b](a.events);var c=a.entities.slice();for(b=0;b<c.length;b++){for(var d in c[b].beforeUpdate)c[b].beforeUpdate[d](a.events,
c[b],a);if(c[b]&&(c[b].update&&c[b].update(a.events,c[b],a),c[b]))for(d in c[b].afterUpdate)c[b].afterUpdate[d](a.events,c[b],a)}for(b in a.afterUpdate)a.afterUpdate[b](a.events);a.events={}},bindEvents:function(){a.canvasEl.addEventListener("click",function(b){a.events.click={evt:b};for(var c in a.onClick)a.onClick[c](a.events.click)},!1);window.addEventListener("keydown",function(b){a.events.keydown={evt:b};for(var c in a.onKeyDown)a.onKeyDown[c](a.events.keydown);a.events.keydown[b.keyCode]=!0});
window.addEventListener("keypress",function(b){a.events.keypress={evt:b};for(var c in a.onKeyPress)a.onKeyPress[c](a.events.keypress);a.events.keypress[b.charCode]=!0});window.addEventListener("keyup",function(b){a.events.keyup={};for(var c in a.onKeyUp)a.onKeyUp[c](a.events.keyup);a.events.keyup[b.keyCode]=!0})},run:function(b){for(var c in a.beforeRun)a.beforeRun[c](b);a.canvasEl=document.getElementById(b.id);a.canvas=a.canvasEl.getContext("2d");a.canvas.width=b.width;a.canvas.height=b.height;a.canvasEl.setAttribute("width",
b.width);a.canvasEl.setAttribute("height",b.height);if(b.entities)for(c in b.entities)a.addEntity(b.entities[c]);a.updateInterval=setInterval(function(){a.update()},1E3/24);a.drawRequest=requestAnimationFrame(function(){a.draw()});a.bindEvents();a.config=b;for(c in a.afterRun)a.afterRun[c](b)}};return a}();
(function(d){var e=0;d.utils.addButton=function(f,g){var h=e+1;e++;d.addEntity({name:f,type:"button",i:h+0,draw:function(a,b,c){c=a.width/2-200;b=65*b.i;a.beginPath();a.rect(c,b,400,50);a.fillStyle="grey";a.fill();a.strokeStyle="black";a.lineWidth=3;a.stroke();a.fillStyle="green";a.font="bold 24px sans-serif";a.fillText(f,c+25,b+35)},update:function(a,b,c){if(a.click){var d=a.click.evt.layerX;a=a.click.evt.layerY;d>c.canvas.width/2-200&&d<c.canvas.width/2-200+400&&a>65*b.i&&a<50+65*b.i&&g()&&c.removeEntity(b)}}})}})(Game);
(function(b){b.messages=[];b.utils.showMessage=function(a,c){b.messages.push(a);setTimeout(function(){for(var c in b.messages)b.messages[c]==a&&delete b.messages[c];b.messages=b.messages.filter(function(a){return"undefined"!=typeof a})},c||3E3)};b.afterDraw.push(function(a){for(var c=0;c<b.messages.length&&5>c;c++){var e=a.width-20,d=a.height-30*(c+1);a.beginPath();a.rect(10,d,e,22);a.fillStyle="rgba(0,0,0,0.8)";a.fill();a.lineWidth=1;a.strokeStyle="black";a.stroke();a.fillStyle="green";a.font="bold 16px sans-serif";
a.fillText(b.messages[c],14,d+16)}})})(Game);
(function(a){a.sprites={size:1};a.config.scale=1;a.config.diffX=0;a.config.diffY=0;a.config.quest=null;a.gameOver=function(){var b=a.config.quest.badEnding.reverse(),c;for(c in b)a.utils.showMessage(b[c],1E4*b.length)};a.winGame=function(){var b=a.config.quest.ending.reverse(),c;for(c in b)a.utils.showMessage(b[c],1E4*b.length)};a.utils.getTileX=function(b){return Math.floor(b.x/a.sprites.size)};a.utils.getTileY=function(b){return Math.floor(b.y/a.sprites.size)};a.utils.near=function(a,c,d){return a.x>=
c.x-d&&a.x<=c.x+d&&a.y>=c.y-d&&a.y<=c.y+d};a.utils.nearTile=function(b,c){return a.utils.near(b,c,a.sprites.size)};a.utils.eventNearTile=function(b,c){return a.utils.nearTile(b,{x:c.x*a.sprites.size,y:c.y*a.sprites.size})};a.utils.getEntityAt=function(b,c){var d=null,e=a.entities.slice(),f;for(f in e){var g=Math.floor(e[f].y/a.sprites.size);Math.floor(e[f].x/a.sprites.size)==c&&g==b&&(d=e[f])}return d};a.utils.loadSprite=function(b,c){var d=new Image;d.size=c;d.onload=function(){a.sprites=d};d.src=
b};a.beforeAddEntity.push(function(a){a.autoDraw&&(a.draw=function(a,b,e){var f=e.sprites;a.drawImage(f,b.sprite.x*f.size,b.sprite.y*f.size,f.size,f.size,b.x*e.config.scale+e.config.diffX,b.y*e.config.scale+e.config.diffY,f.size*e.config.scale,f.size*e.config.scale)})});a.onClick.push(function(b){var c,d;a.sprites?(c=Math.floor((b.evt.layerY-a.config.diffY)/(a.sprites.size*a.config.scale)),d=Math.floor((b.evt.layerX-a.config.diffX)/(a.sprites.size*a.config.scale))):(c=b.evt.layerY,d=b.evt.layerX);
b.x=d;b.y=c;try{var e=a.utils.getEntityAt(c,d);null!=e&&(b.tile=e)}catch(f){}});a.beforeRun.push(function(b){b.scale&&(a.config.scale=b.scale);b.sprite&&a.utils.loadSprite(b.sprite.file,b.sprite.size)})})(Game);
(function(a){a.utils.loadMap=function(b){a.config.map=b;var f=a.entities.slice();a.entities=[];var c,d;for(c=0;c<b.tiles.length;c++)for(d=0;d<b.tiles[c].length;d++){var g=b.tiles[c][d],h={name:"-map-r:"+c+"-c:"+d,x:d*a.sprites.size,y:c*a.sprites.size,autoDraw:!0,sprite:{y:g[0],x:g[1]}};try{var e=a.config.map.sprite.config[g[0]][g[1]];"string"==typeof e&&(e={type:e});"floor"==e.type&&(e.walkable=!0);for(var k in e)h[k]=e[k]}catch(l){}a.addEntity(h)}a.config.diffY=a.canvas.height/2-c*a.sprites.size;
a.config.diffX=a.canvas.width/2-d*a.sprites.size;if(b.entities)for(c=0;c<b.entities.length;c++)a.addEntity(b.entities[c]);for(b=0;b<f.length;b++)f[b].name.match(/^-map-/)||a.entities.push(f[b])};a.utils.switchMap=function(b){var f=a.config.quest.maps[b.map],c=a.entities.slice(),d;for(d in c)a.removeEntity(c[d]);a.config.map=f;a.utils.loadMap(f);a.addEntity(a.config.hero);a.config.hero.x=b.x*a.sprites.size;a.config.hero.y=b.y*a.sprites.size}})(Game);
(function(e){e.utils.saveGame=function(b){window.localStorage.setItem("save",JSON.stringify({hero:b,quest:e.config.quest,map:{map:e.config.map.name,x:b.x/e.sprites.size,y:b.y/e.sprites.size}}));e.utils.showMessage("Game saved.")};e.utils.loadGame=function(){};var l=function(b,a,c){if(!(0>=a.life)){var f=c.sprites.size*c.config.scale*(100*a.life/a.maxLife/100);b.beginPath();b.rect(a.x*c.config.scale+c.config.diffX,(a.y-2)*c.config.scale+c.config.diffY,f,5);b.fillStyle="green";b.fill();b.lineWidth=
1;b.strokeStyle="black";b.stroke()}},h=function(b,a){var c=!1,f;for(f in b.items)b.items[f].name==a&&(c=!0);return c},k=function(b,a){if(!(0>=a.life)){var c=b.attack+(Math.floor(6*Math.random())+1)-a.defense;0>=c&&(c=0);if(b._last_attack){if(b._last_attack<=(new Date).getTime()/1E3-1){a.life-=c;b._last_attack=(new Date).getTime()/1E3;e.utils.showMessage(b.name+" delt "+c+" damage to "+a.name+".");var f={name:"-hit-"+(new Date).getTime(),type:"fx",hit:c,p2:a,p1:b,draw:function(a,b,c){var f=c.sprites.size*
c.config.scale,e=b.p2.x*c.config.scale+c.config.diffX,g=b.p2.y*c.config.scale+c.config.diffY;a.strokeStyle=0<b.hit?"red":"gray";a.beginPath();a.moveTo(e+4,g+4);a.lineTo(e+f-4,g+f-4);a.moveTo(e+f-4,g+4);a.lineTo(e+4,g+f-4);a.lineWidth=1*c.config.scale;a.stroke()}};e.addEntity(f);setTimeout(function(){e.removeEntity(f)},500)}}else b._last_attack=(new Date).getTime()/1E3}},m=function(b,a,c){if(0>=a.life)return c.gameOver();a.life>a.maxLife&&(a.life=a.maxLife);if(b.keydown){to={x:a.x,y:a.y};if(b.keydown[39]||
b.keydown[68])to.x+=c.sprites.size;else if(b.keydown[37]||b.keydown[65])to.x-=c.sprites.size;else if(b.keydown[38]||b.keydown[87])to.y-=c.sprites.size;else if(b.keydown[40]||b.keydown[83])to.y+=c.sprites.size;a.moveTo=to}if(b.click&&b.click.tile){var f=c.sprites.size,d=b.click.tile;d.walkable&&(a.moveTo={x:b.click.x*f,y:b.click.y*f});"door"==d.type&&c.utils.nearTile(a,d)&&(d.locked&&h(a,d.locked)?c.utils.switchMap(d.goTo):d.locked?c.utils.showMessage("This door is locked!"):c.utils.switchMap(d.goTo));
"chest"==d.type&&c.utils.nearTile(a,d)&&!d.open&&(d.open=!0,d.sprite=d.opened,d.item.autoDraw=!0,d.item.x=-1*c.sprites.size,d.item.y=c.sprites.size*(a.items.length+1),a.items.push(d.item),c.addEntity(d.item));if("potion"==d.type){var f=!1,e;for(e in a.items)a.items[e].name==d.name?(delete a.items[e],f=!0):f&&(a.items[e].y-=c.sprites.size);a.items=a.items.filter(function(a){return"undefined"!=typeof a});a.life+=6;c.utils.showMessage("You recovered 6 life points.");c.removeEntity(d)}if(c.utils.nearTile(a,
d)){"monster"==d.type&&k(a,d);d.message&&c.utils.showMessage(d.message);if("trap"==d.type||d.trap)a.life-=1,c.utils.showMessage("Ouch! Hero took damage.");if("fake-floor"==d.type||d.fake_floor)a.x=b.click.tile.x,a.y=b.click.tile.y;("save"==d.type||d.save)&&c.utils.saveGame(a);if("exit"==d.type||d.exit)h(a,d.item)?c.winGame():c.utils.showMessage("Hey, go get that "+d.item+"!")}}},n=function(b,a,c){0>=a.life?(delete a.moveTo,a.update=null,a.afterDraw=null,a.sprite=a.dead,a.type="floor"):(b=c.getEntity("hero"),
c.utils.nearTile(b,a)&&k(a,b),a.moveTo={x:b.x,y:b.y})};e.beforeAddEntity.push(function(b){"monster"==b.type&&(b.beforeUpdate.push(n),b.isChar=!0);if("hero"==b.type){b.beforeUpdate.push(m);b.isChar=!0;var a=0,c;for(c in b.items){a++;var f=b.items[c];f.autoDraw=!0;f.x=-1*e.sprites.size;f.y=e.sprites.size*a;e.addEntity(f)}}b.isChar&&0<b.life&&b.afterDraw.push(l)})})(Game);
var Graph=function(s){var u=function(a,b){return parseFloat(a)-parseFloat(b)},c=function(a,b){for(var d=b.shift(),r,e,c=[];b.length;){r=b.shift();e=a;var q=r,g={},k={0:[d]},h={},l=void 0;for(g[d]=0;k;){var d=k,l=[],m=void 0;for(m in d)Object.prototype.hasOwnProperty.call(d,m)&&l.push(m);if(!l.length)break;l.sort(u);var f=l[0],n=k[f],d=n.shift(),l=parseFloat(f),m=e[d]||{};n.length||delete k[f];for(var p in m)Object.prototype.hasOwnProperty.call(m,p)&&(f=m[p]+l,n=g[p],n===s||n>f)&&(g[p]=f,n=p,f=""+
f,k[f]||(k[f]=[]),k[f].push(n),h[p]=d)}if(e=g[q]===s?null:h){q=[];for(g=r;g;)q.push(g),predecessor=e[g],g=e[g];q.reverse();e=q;if(b.length)c.push.apply(c,e.slice(0,-1));else return c.concat(e)}else return null;d=r}},t=function(a,b){try{return Array.prototype.slice.call(a,b)}catch(d){for(var c=[],e=b||0,h=a.length;e<h;++e)c.push(a[e]);return c}},h=function(a){this.map=a};h.prototype.findShortestPath=function(a,b){return"[object Array]"===Object.prototype.toString.call(a)?c(this.map,a):2===arguments.length?
c(this.map,[a,b]):c(this.map,t(arguments))};h.findShortestPath=function(a,b,d){return"[object Array]"===Object.prototype.toString.call(b)?c(a,b):3===arguments.length?c(a,[b,d]):c(a,t(arguments,1))};return h}();
(function(b){b.graph={};b.beforeUpdate.push(function(e){e=b.entities;for(var d in e)if(e[d].walkable){var a=b.utils.getTileY(e[d]),c=b.utils.getTileX(e[d]);b.graph[a+"x"+c]={}}for(d in e)e[d].walkable&&(a=b.utils.getTileY(e[d]),c=b.utils.getTileX(e[d]),b.graph[a+1+"x"+c]&&(b.graph[a+1+"x"+c][a+"x"+c]=1),b.graph[a-1+"x"+c]&&(b.graph[a-1+"x"+c][a+"x"+c]=1),b.graph[a+"x"+(c-1)]&&(b.graph[a+"x"+(c-1)][a+"x"+c]=1),b.graph[a+"x"+(c+1)]&&(b.graph[a+"x"+(c+1)][a+"x"+c]=1));for(d in e)if(!e[d].walkable&&!e[d].isChar){var a=
b.utils.getTileY(e[d]),c=b.utils.getTileX(e[d]),k;for(k in b.graph)b.graph[k][a+"x"+c]&&delete b.graph[k][a+"x"+c];delete b.graph[a+"x"+c]}});b.beforeAddEntity.push(function(b){b.isChar&&b.afterUpdate.push(function(d,a,c){if(a.moveTo){d=c.utils.getTileY(a);var b=c.utils.getTileX(a),e=c.utils.getTileY(a.moveTo),q=c.utils.getTileX(a.moveTo),f={},g;for(g in c.graph)f[g]=c.graph[g];g={};var h=d+"x"+b,l=d-1+"x"+b,m=d+1+"x"+b,n=d+"x"+(b-1),p=d+"x"+(b+1);f[l]&&(g[l]=1,f[l][h]=1);f[m]&&(g[m]=1,f[m][h]=1);
f[p]&&(g[p]=1,f[p][h]=1);f[n]&&(g[n]=1,f[n][h]=1);f[h]=g;d=(new Graph(f)).findShortestPath(d+"x"+b,e+"x"+q);if(!d||a.x==a.moveTo.x&&a.y==a.moveTo.y)delete a.moveTo;else{b=[a.x,a.y];b=d[1]?d[1].split("x").map(function(a){return a*c.sprites.size}):d[0].split("x").map(function(a){return a*c.sprites.size});e=c.utils.getEntityAt(b[0]/c.sprites.size,b[1]/c.sprites.size);if(!e||!e.walkable&&e.name!=a.name)if(d[1])b=d[0].split("x").map(function(a){return a*c.sprites.size});else{delete a.moveTo;return}a._to||
(a._to="y");"y"==a._to?b[0]>a.y?a.y+=2:b[0]<a.y?a.y-=2:a._to="x":b[1]>a.x?a.x+=2:b[1]<a.x?a.x-=2:a._to="y"}}})})})(Game);
var quest={intro:["Hello, rookie...","I see you were sent to become a hero, huh? Too bad for you, Ha!","Well, prove your self usefull, if you can.","Go down the Gathor dungeon, get back the amulet he stole and we will see..."],ending:["Congratulations, boy!","How 'luck' we are to have yet another hero now...","Hooray!","Hooray!","Hooray!"],badEnding:["Sorry boy, you are dead!"],start:{map:"entrance",x:1,y:1},maps:{entrance:{name:"entrance",sprite:{config:{1:{2:"wall",9:"floor"}}},tiles:[[[1,2],[1,
2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2]]],entities:[{name:"entrance-door",autoDraw:!0,type:"exit",item:"amulet",x:0,y:16,sprite:{x:6,y:0}},{name:"hall-door",autoDraw:!0,type:"door",x:112,y:16,sprite:{x:2,y:0},goTo:{map:"hall",x:1,y:2}}]},hall:{name:"hall",sprite:{config:{1:{2:"wall",9:"floor"}}},tiles:[[[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],
[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2]]],entities:[{name:"entrance-door",type:"door",sprite:{y:0,x:2},autoDraw:!0,y:32,x:0,goTo:{map:"entrance",
x:6,y:1}},{name:"bookcase",type:"message",message:"Hello, adventurer!",sprite:{y:4,x:8},autoDraw:!0,y:16,x:48,goTo:{map:"entrance",x:1,y:6}},{name:"bed",type:"save",sprite:{y:4,x:9},autoDraw:!0,y:32,x:96},{name:"goblin-door",type:"door",sprite:{y:0,x:2},autoDraw:!0,y:128,x:112,goTo:{map:"goblin-room-1",x:1,y:8}}]},"goblin-room-1":{name:"goblin-room-1",sprite:{config:{1:{2:"wall",9:"floor"}}},tiles:[[[1,2],[1,2],[1,2],[1,2],[1,2],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],
[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,2],[1,2],[1,2],[1,2],[1,2]]],entities:[{name:"hall-door",type:"door",sprite:{y:0,x:2},autoDraw:!0,y:128,x:0,goTo:{map:"hall",x:6,y:8}},{name:"chest-1",type:"chest",sprite:{y:4,x:4},opened:{y:4,x:5},item:{name:"potion-1",type:"potion",sprite:{y:5,x:7}},
autoDraw:!0,x:32,y:16},{name:"bad-door",type:"door",sprite:{y:0,x:2},autoDraw:!0,y:16,x:80,goTo:{map:"bad-room",x:1,y:1}},{name:"goblin-1",type:"monster",life:5,maxLife:5,attack:2,defense:1,sprite:{x:1,y:3},dead:{x:5,y:5},x:48,y:32,autoDraw:!0}]},"bad-room":{name:"bad-room",sprite:{config:{1:{2:"wall",9:"floor"}}},tiles:[[[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,
9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],
[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2]]],entities:[{name:"goblin-door",type:"door",sprite:{y:0,x:2},autoDraw:!0,y:16,x:0,goTo:{map:"goblin-room-1",x:4,y:1}},{name:"locked-door",type:"door",locked:"a-key",sprite:{y:0,x:8},autoDraw:!0,y:32,x:128,goTo:{map:"corridor",x:1,y:2}},{name:"key-room-door",type:"door",sprite:{y:0,x:2},
autoDraw:!0,y:240,x:48,goTo:{map:"key-room",x:3,y:1}},{name:"goblin-2",type:"monster",life:5,maxLife:5,attack:2,defense:1,sprite:{x:1,y:3},dead:{x:5,y:5},x:48,y:32,autoDraw:!0},{name:"goblin-3",type:"monster",life:5,maxLife:5,attack:2,defense:1,sprite:{x:1,y:3},dead:{x:5,y:5},x:96,y:128,autoDraw:!0}]},"key-room":{name:"key-room",sprite:{config:{1:{2:"wall",9:"floor"}}},tiles:[[[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,
9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2]]],entities:[{name:"bad-door",type:"door",sprite:{y:0,x:2},autoDraw:!0,y:0,x:16,goTo:{map:"bad-room",x:3,y:14}},{name:"minotaur-1",type:"monster",life:10,maxLife:10,attack:4,defense:3,
sprite:{x:3,y:3},dead:{x:5,y:5},x:80,y:80,autoDraw:!0},{name:"chest-2",type:"chest",sprite:{y:4,x:4},opened:{y:4,x:5},item:{name:"a-key",type:"key",sprite:{y:4,x:0}},autoDraw:!0,x:96,y:80}]},corridor:{name:"corridor",sprite:{config:{1:{2:"wall",9:"floor"}}},tiles:[[[1,2],[1,2],[1,2],[1,2],[1,2],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,
9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,2],[1,2],[1,2],[1,2],[1,2]]],entities:[{name:"bad-door",type:"door",sprite:{y:0,x:2},autoDraw:!0,y:32,x:0,goTo:{map:"bad-room",x:7,y:2}},{name:"somebooks0",type:"message",message:"It is known that this dungeon was not Gathor's original.",sprite:{y:4,x:8},y:64,x:16,autoDraw:!0},{name:"somebooks1",type:"message",
message:"This was build by some crazy boy, an 'analyst', for whatever that means...",sprite:{y:4,x:8},y:96,x:16,autoDraw:!0},{name:"somebooks2",type:"message",message:"The boy talked some code.",sprite:{y:4,x:8},y:128,x:16,autoDraw:!0},{name:"somebooks3",type:"message",message:"If you follow his 'coded' direction, you may be able to pass.",sprite:{y:4,x:8},y:160,x:16,autoDraw:!0},{name:"pit-door",type:"door",goTo:{map:"pit",x:1,y:14},sprite:{y:0,x:2},autoDraw:!0,y:160,x:80}]},pit:{name:"pit",sprite:{config:{1:{2:"wall",
8:"trap",9:"floor"}}},tiles:[[[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2]],[[1,2],[1,9],[1,9],[1,8],[1,8],[1,8],[1,8],[1,8],[1,8],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,8],[1,8],[1,8],[1,8],[1,8],[1,8],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,8],[1,8],[1,8],[1,8],[1,8],[1,8],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,8],[1,8],[1,8],[1,8],[1,8],[1,8],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,8],[1,8],[1,8],[1,8],[1,8],[1,8],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,8],[1,
8],[1,8],[1,8],[1,8],[1,8],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,8],[1,8],[1,8],[1,8],[1,8],[1,8],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,8],[1,8],[1,8],[1,8],[1,8],[1,8],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,8],[1,8],[1,8],[1,8],[1,8],[1,8],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,8],[1,8],[1,8],[1,8],[1,8],[1,8],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,8],[1,8],[1,8],[1,8],[1,8],[1,8],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,8],[1,8],[1,8],[1,8],[1,8],[1,8],[1,9],[1,9],[1,2]],[[1,2],[1,9],
[1,9],[1,8],[1,8],[1,8],[1,8],[1,8],[1,8],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,8],[1,8],[1,8],[1,8],[1,8],[1,8],[1,9],[1,9],[1,2]],[[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2]]],entities:[{name:"corridor-door",type:"door",sprite:{y:0,x:2},autoDraw:!0,y:224,x:0,goTo:{map:"corridor",x:4,y:10}},{name:"the-sign",type:"message",message:"DDRRDDRRDDRR",autoDraw:!0,x:32,y:16,sprite:{x:8,y:4}},{name:"p1",type:"fake-floor",autoDraw:!0,sprite:{x:1,y:8},x:48,y:64},{name:"p2",type:"fake-floor",
autoDraw:!0,sprite:{x:1,y:8},x:64,y:64},{name:"p3",type:"fake-floor",autoDraw:!0,sprite:{x:1,y:8},x:64,y:80},{name:"p4",type:"fake-floor",autoDraw:!0,sprite:{x:1,y:8},x:64,y:96},{name:"p5",type:"fake-floor",autoDraw:!0,sprite:{x:1,y:8},x:80,y:96},{name:"p6",type:"fake-floor",autoDraw:!0,sprite:{x:1,y:8},x:96,y:96},{name:"p7",type:"fake-floor",autoDraw:!0,sprite:{x:1,y:8},x:96,y:112},{name:"p8",type:"fake-floor",autoDraw:!0,sprite:{x:1,y:8},x:96,y:128},{name:"p8",type:"fake-floor",autoDraw:!0,sprite:{x:1,
y:8},x:112,y:128},{name:"p10",type:"fake-floor",autoDraw:!0,sprite:{x:1,y:8},x:128,y:128},{name:"stair-down",type:"door",autoDraw:!0,goTo:{map:"damn-room",x:1,y:2},sprite:{x:3,y:1},x:160,y:32}]},"damn-room":{name:"damn-room",sprite:{config:{1:{2:"wall",9:"floor"}}},tiles:[[[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,
2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2]]],entities:[{name:"stair-up",type:"door",goTo:{map:"pit",x:10,y:3},autoDraw:!0,sprite:{x:4,y:1},x:16,y:16},{name:"gran-room-door",type:"door",goTo:{map:"gran-room",x:1,y:8},
autoDraw:!0,sprite:{x:6,y:0},x:128,y:128},{name:"bed",type:"save",sprite:{y:4,x:9},autoDraw:!0,y:128,x:32},{name:"chest-2",type:"chest",sprite:{y:4,x:4},opened:{y:4,x:5},item:{name:"potion-2",type:"potion",sprite:{y:5,x:7}},autoDraw:!0,x:112,y:48},{name:"chest-3",type:"chest",sprite:{y:4,x:4},opened:{y:4,x:5},item:{name:"potion-3",type:"potion",sprite:{y:5,x:7}},autoDraw:!0,x:112,y:64},{name:"chest-4",type:"chest",sprite:{y:4,x:4},opened:{y:4,x:5},item:{name:"potion-4",type:"potion",sprite:{y:5,x:7}},
autoDraw:!0,x:112,y:80},{name:"chest-5",type:"chest",sprite:{y:4,x:4},opened:{y:4,x:5},item:{name:"potion-5",type:"potion",sprite:{y:5,x:7}},autoDraw:!0,x:112,y:96},{name:"bookcase",type:"message",message:"Dear diary: I Just stole a nice amulet. Gathor.",sprite:{y:4,x:8},autoDraw:!0,y:16,x:48}]},"gran-room":{name:"gran-room",sprite:{config:{1:{2:"wall",9:"floor"}}},tiles:[[[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,
9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,9],[1,2]],[[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2],[1,2]]],entities:[{name:"back-to-damn-room",type:"door",goTo:{map:"damn-room",
x:7,y:8},autoDraw:!0,sprite:{x:6,y:0},x:0,y:128},{name:"chest-last",type:"chest",sprite:{y:4,x:4},opened:{y:4,x:5},item:{name:"amulet",type:"amulet",sprite:{y:5,x:4}},autoDraw:!0,x:112,y:16},{name:"minotaur-2",type:"monster",life:10,maxLife:10,attack:4,defense:3,sprite:{x:3,y:3},dead:{x:5,y:5},x:80,y:80,autoDraw:!0},{name:"goblin-2",type:"monster",life:5,maxLife:5,attack:2,defense:1,sprite:{x:1,y:3},dead:{x:5,y:5},x:48,y:32,autoDraw:!0},{name:"boss",type:"monster",life:20,maxLife:20,attack:5,defense:5,
sprite:{x:6,y:3},dead:{x:5,y:5},x:48,y:64,autoDraw:!0}]}}};
var HeroGame=function(){HeroGame={};var d={id:"game",width:860,height:640,scale:2,sprite:{file:"assets/sprites-16x16.png",size:16}},e={name:"hero",type:"hero",autoDraw:!0,sprite:{y:2,x:0},life:20,attack:5,defense:5,maxLife:20,items:[]};HeroGame.intro=function(a){a.utils.addButton("New Game",function(){a.config.quest=quest;a.config.hero=e;a.utils.switchMap(a.config.quest.start);var b=a.config.quest.intro.reverse(),c;for(c in b)a.utils.showMessage(b[c],5E3*b.length);return!0});a.utils.addButton("Load Game",
function(){var b=window.localStorage.getItem("save");if(b)return b=JSON.parse(b),a.config.quest=b.quest,a.config.hero=b.hero,a.utils.switchMap(b.map),!0;a.utils.showMessage("Sorry, no saved game available.");return!1});a.utils.addButton("About & Credits",function(){window.open("README.html","README","toolbar=no,width=640,height=480");return!1});a.utils.showMessage("Click to move.");a.utils.showMessage("Click to interact.");a.utils.showMessage("Click to attack.");a.utils.showMessage("Click to survive.")};
HeroGame.start=function(){Game.afterRun.push(function(){HeroGame.intro(Game)});Game.run(d)};return HeroGame}();
