"use strict";!function(){let e,t={waveNum:1,teamScore:0};function s(e){let t="#"==e.charAt(0)?e.substring(1):e;return 3==t.length&&(t+=t),[parseInt(t.substring(0,2),16),parseInt(t.substring(2,4),16),parseInt(t.substring(4,6),16)]}const o={osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:255,osc1_waveform:0,osc2_oct:7,osc2_det:0,osc2_detune:0,osc2_xenv:1,osc2_vol:255,osc2_waveform:0,noise_fader:0,env_attack:50,env_sustain:150,env_release:4800,env_master:200,fx_filter:2,fx_freq:600,fx_resonance:254,fx_delay_time:0,fx_delay_amt:0,fx_pan_freq:0,fx_pan_amt:0,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0},n={osc1_oct:6,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:29,osc1_waveform:0,osc2_oct:7,osc2_det:0,osc2_detune:0,osc2_xenv:1,osc2_vol:0,osc2_waveform:1,noise_fader:125,env_attack:197,env_sustain:8772,env_release:10137,env_master:172,fx_filter:2,fx_freq:2558,fx_resonance:51,fx_delay_time:0,fx_delay_amt:0,fx_pan_freq:0,fx_pan_amt:0,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:1},i={songLen:123,songData:[{osc1_oct:9,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:161,osc1_waveform:0,osc2_oct:9,osc2_det:0,osc2_detune:4,osc2_xenv:0,osc2_vol:182,osc2_waveform:0,noise_fader:0,env_attack:100,env_sustain:1818,env_release:18181,env_master:192,fx_filter:0,fx_freq:0,fx_resonance:254,fx_delay_time:6,fx_delay_amt:108,fx_pan_freq:3,fx_pan_amt:61,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:3,lfo_amt:94,lfo_waveform:2,p:[1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,0,2,3,4,1,2,3,4,5,6,7,8,5],c:[{n:[142,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,140,0,0,0,0,0,0,0,138,0,0,0,0,0,0,0]},{n:[135,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,135,0,0,0,138,0,0,0]},{n:[140,0,138,0,135,0,0,0,0,0,0,0,0,0,130,0,142,0,140,0,135,0,0,0,0,0,0,0,138,0,0,0]},{n:[135,0,0,0,0,0,0,0,0,0,0,0,0,0,130,0,142,0,0,0,0,0,0,0,135,0,0,0,138,0,0,0]},{n:[123,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[130,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[119,131,0,0,0,0,0,0,0,0,0,0,0,0,0,0,126,114,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:8,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:0,osc1_waveform:0,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:0,osc2_waveform:0,noise_fader:19,env_attack:100,env_sustain:0,env_release:3636,env_master:192,fx_filter:1,fx_freq:8100,fx_resonance:156,fx_delay_time:2,fx_delay_amt:22,fx_pan_freq:3,fx_pan_amt:43,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[0,0,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2],c:[{n:[135,0,135,0,0,135,0,135,135,0,135,0,0,135,0,135,135,0,135,0,0,135,0,135,135,0,135,0,0,135,0,135]},{n:[135,0,135,0,0,135,0,135,135,0,135,0,0,135,0,135,135,0,135,0,0,135,0,135,135,0,135,0,135,0,135,135]}]},{osc1_oct:6,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:1,osc2_oct:8,osc2_det:0,osc2_detune:8,osc2_xenv:0,osc2_vol:82,osc2_waveform:2,noise_fader:0,env_attack:100,env_sustain:4545,env_release:2727,env_master:192,fx_filter:3,fx_freq:2700,fx_resonance:85,fx_delay_time:6,fx_delay_amt:60,fx_pan_freq:6,fx_pan_amt:86,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:7,lfo_amt:106,lfo_waveform:0,p:[0,0,0,0,1,1,2,3,1,1,2,3,1,1,2,3,1,1,2,3,1,1,2,3],c:[{n:[135,135,147,135,0,135,147,135,135,135,147,135,0,135,147,135,135,135,147,135,0,135,147,135,135,135,147,135,0,135,147,135]},{n:[140,140,152,140,0,140,152,140,140,140,152,140,0,140,152,140,140,140,152,140,0,140,152,140,140,140,152,140,0,140,152,142]},{n:[131,131,143,131,0,131,143,131,131,131,143,131,0,131,143,131,138,138,150,138,0,138,150,138,138,138,150,138,0,138,150,137]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:187,osc1_waveform:2,osc2_oct:5,osc2_det:0,osc2_detune:2,osc2_xenv:1,osc2_vol:161,osc2_waveform:2,noise_fader:0,env_attack:100,env_sustain:1818,env_release:2727,env_master:123,fx_filter:1,fx_freq:1900,fx_resonance:162,fx_delay_time:2,fx_delay_amt:153,fx_pan_freq:6,fx_pan_amt:61,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:2,lfo_amt:196,lfo_waveform:3,p:[0,0,0,0,0,0,0,0,1,1,1,2,1,1,1,2,1,1,1,2,1,1,1,2,1,1,1,2,3],c:[{n:[135,135,138,135,142,135,140,138,135,135,138,135,142,135,140,138,135,135,138,135,142,135,140,138,135,135,138,135,142,135,140,138]},{n:[143,143,155,143,0,143,155,143,143,143,150,143,147,143,140,143,138,138,143,138,143,140,138,140,138,138,143,138,142,140,138,140]},{n:[135,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:8,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:192,osc1_waveform:0,osc2_oct:7,osc2_det:0,osc2_detune:0,osc2_xenv:1,osc2_vol:70,osc2_waveform:2,noise_fader:8,env_attack:100,env_sustain:0,env_release:9090,env_master:164,fx_filter:2,fx_freq:5500,fx_resonance:240,fx_delay_time:6,fx_delay_amt:51,fx_pan_freq:3,fx_pan_amt:66,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1],c:[{n:[135,0,0,0,0,0,135,0,0,0,135,0,0,0,0,0,135,0,0,0,0,0,135,0,0,0,135,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:2,osc2_oct:8,osc2_det:0,osc2_detune:6,osc2_xenv:0,osc2_vol:184,osc2_waveform:2,noise_fader:21,env_attack:4e4,env_sustain:25454,env_release:90909,env_master:77,fx_filter:2,fx_freq:7100,fx_resonance:188,fx_delay_time:8,fx_delay_amt:147,fx_pan_freq:4,fx_pan_amt:69,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:7,lfo_amt:176,lfo_waveform:1,p:[0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,5],c:[{n:[135,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[142,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[143,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[135,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:8,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:0,osc1_waveform:0,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:0,osc2_waveform:0,noise_fader:148,env_attack:3636,env_sustain:4545,env_release:39090,env_master:136,fx_filter:2,fx_freq:3100,fx_resonance:122,fx_delay_time:5,fx_delay_amt:132,fx_pan_freq:0,fx_pan_amt:0,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:5,lfo_amt:147,lfo_waveform:0,p:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,1,3,1,2,1,3,4],c:[{n:[0,0,0,0,0,0,135,0,0,0,0,0,0,0,0,0,0,0,135,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,135,0,0,0,0,0,0,0,162,0,135,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,135,0,0,0,0,0,0,0,0,0,0,0,151,0,0,0,0,0,135,0,135,0,0,0,0,0]},{n:[135,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]}],rowLen:5606,endPattern:30};let r,c;!function(){const e=44100;function t(e){return Math.sin(6.283184*e)}const s=[t,function(e){return t(e)<0?-1:1},function(e){return e%1-.5},function(e){const t=e%1*4;return t<2?t-1:3-t}];function o(e){return.00390625*Math.pow(1.059463094,e-128)}function n(e){return{left:new Float32Array(e),right:new Float32Array(e)}}function i(e,t,s,o){const n=s.fx_delay_time*o>>1,i=s.fx_delay_amt/255;let r=0;for(;r<t-n;){const t=r,s=r+n;e.left[s]+=e.right[t]*i,e.right[s]+=e.left[t]*i,r++}}function a(t,s){const o=t.createBuffer(2,s.left.length,e);return o.getChannelData(0).set(s.left),o.getChannelData(1).set(s.right),o}const l=function(e,t,o){this.ctx=e,this.instr=t,this.rowLen=o||5605,this.osc_lfo=s[t.lfo_waveform],this.osc1=s[t.osc1_waveform],this.osc2=s[t.osc2_waveform],this.attack=t.env_attack,this.sustain=t.env_sustain,this.release=t.env_release,this.panFreq=Math.pow(2,t.fx_pan_freq-8)/this.rowLen,this.lfoFreq=Math.pow(2,t.lfo_freq-8)/this.rowLen};l.prototype._genSound=function(s,n,i){let r=0,c=0;const a=o(s+12*(this.instr.osc1_oct-8)+this.instr.osc1_det)*(1+8e-4*this.instr.osc1_detune),l=o(s+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),_=this.instr.fx_resonance/255;let f=0,h=0;const d=n.left.length;for(let s=this.attack+this.sustain+this.release-1;s>=0;--s){let o=s+i;const m=this.osc_lfo(o*this.lfoFreq)*this.instr.lfo_amt/512+.5;let u=1;s<this.attack?u=s/this.attack:s>=this.attack+this.sustain&&(u-=(s-this.attack-this.sustain)/this.release);let x=a;this.instr.lfo_osc1_freq&&(x+=m),this.instr.osc1_xenv&&(x*=u*u),r+=x;let p=this.osc1(r)*this.instr.osc1_vol;x=l,this.instr.osc2_xenv&&(x*=u*u),c+=x,p+=this.osc2(c)*this.instr.osc2_vol,this.instr.noise_fader&&(p+=(2*Math.random()-1)*this.instr.noise_fader*u),p*=u/255;let v=this.instr.fx_freq;this.instr.lfo_fx_freq&&(v*=m);const w=_*(p-h)-(f+=(v=1.5*Math.sin(3.141592*v/e))*h);switch(h+=v*w,this.instr.fx_filter){case 1:p=w;break;case 2:p=f;break;case 3:p=h;break;case 4:p=f+w}x=t(o*this.panFreq)*this.instr.fx_pan_amt/512+.5,p*=.00476*this.instr.env_master,o<d&&(n.left[o]+=p*(1-x),n.right[o]+=p*x)}},l.prototype._createAudioBuffer=function(e,t){const s=this.attack+this.sustain+this.release-1+32*this.rowLen,o=n(s);this._genSound(e,o,0),i(o,s,this.instr,this.rowLen),t(a(this.ctx,o))};const _=function(t,s){this.ctx=t,this.song=s,this.waveSize=e*s.songLen};_.prototype._generateTrack=function(e,t,s){var o=n(this.waveSize),r=this.waveSize,c=this.song.rowLen,a=this.song.endPattern,_=new l(this.ctx,e,c),f=0,h=0,d=0,m=function(){for(var t=Date.now();;)if(32!==d){if(h===a-1)return u();var s=e.p[h];if(s){var n=e.c[s-1].n[d];n&&_._genSound(n,o,f)}if(f+=c,d+=1,Date.now()-t>33)return void setTimeout(m,0)}else d=0,h+=1},u=function(){i(o,r,e,c);for(var n=0;n<r;n++)t.left[n]+=o.left[n];for(n=0;n<r;n++)t.right[n]+=o.right[n];s()};m()},_.prototype._createAudioBuffer=function(e){var t=this,s=n(this.waveSize),o=0,i=function(){o<t.song.songData.length?(o+=1,t._generateTrack(t.song.songData[o-1],s,i)):e(a(t.ctx,s))};i()},r=function(e,t,s){new _(e,t)._createAudioBuffer(s)},c=function(e,t,s,o){new l(e,t)._createAudioBuffer(s,o)}}();let a,l,_=new(window.webkitAudioContext||window.AudioContext);let f=!1;function h(e,t){if(!f){var s=_.createBufferSource();s.buffer=e,s.loop=t,s.connect(_.destination),s.start()}}class d{constructor(e){for(const t in e)this[t]=e[t]}}const m=document.querySelector("canvas#ctx");d.context=m.getContext("2d");class u extends d{constructor(e){super(e),this.type="player",this.deathAnimationFrame=0,this.deathAnimationTotalFrames=30,this.rgbColorsArr=s(this.color),this.render=function(){if(this.diedAt)d.context.fillStyle=`rgba(${this.rgbColorsArr[0]}, ${this.rgbColorsArr[1]}, ${this.rgbColorsArr[2]}, ${1-1/this.deathAnimationTotalFrames*this.deathAnimationFrame})`,d.context.fillRect(this.x,this.y,this.width+this.deathAnimationFrame,this.height+this.deathAnimationFrame);else{d.context.fillStyle=this.color,d.context.fillRect(this.x,this.y,this.width,this.height);const e=1.1*this.width,t=(this.width-e)/2,s=-10,o=this.x+t,n=this.y+s,i=5,r=e*(this.hp/this.hpMax);d.context.fillRect(o,n,r,i),d.context.fillStyle="grey",d.context.fillRect(o+r,n,e-r,i)}},u.sprites[this.id]=this}}u.sprites={};class x extends d{constructor(e){super(e),this.type="enemy",this.dead=!1,this.deathAnimationFrame=0,this.deathAnimationTotalFrames=30,this.rgbColorsArr=s(this.color),this.render=function(){d.context.beginPath(),this.dead?(d.context.arc(this.x+this.width/2,this.y+this.height/2,this.width/2+this.deathAnimationFrame,0,2*Math.PI),d.context.strokeStyle=`rgba(${this.rgbColorsArr[0]}, ${this.rgbColorsArr[1]}, ${this.rgbColorsArr[2]}, ${1-1/this.deathAnimationTotalFrames*this.deathAnimationFrame})`):(d.context.arc(this.x+this.width/2,this.y+this.height/2,this.width/2,0,2*Math.PI),d.context.strokeStyle=this.color),d.context.stroke()},x.sprites[this.id]=this}}x.sprites={};class p extends d{constructor(e){super(e),this.type="bullet",this.render=function(){"enemy"===this.parentType?(d.context.beginPath(),d.context.arc(this.x+this.width/2,this.y+this.height/2,this.width/2,0,2*Math.PI),d.context.strokeStyle=this.color,d.context.stroke()):(d.context.fillStyle=this.color,d.context.fillRect(this.x,this.y,this.width,this.height))},p.sprites[this.id]=this}}p.sprites={};class v extends d{constructor(e){super(e),this.type="obstacle",this.render=function(){d.context.fillStyle=this.color,d.context.fillRect(this.x,this.y,this.width,this.height)},v.sprites[this.id]=this}}v.sprites={};class w extends d{constructor(e){super(e),this.type="item",this.render=function(){d.context.fillStyle=this.color,d.context.fillRect(this.x,this.y,this.width,this.height),d.context.fillStyle="white";const e=this.width/2,t=this.x+e,s=this.y+-5;d.context.fillText(this.name,t,s)},w.sprites[this.id]=this}}w.sprites={},r(_,i,function(e){h(e,!0)}),c(_,o,160,function(e){a=e}),c(_,n,120,function(e){l=e}),window.addEventListener("load",function(){function s(){return{width:Math.min(window.innerWidth,document.body.clientWidth),height:Math.min(window.innerHeight,document.body.clientHeight)}}e=io({upgrade:!1,transports:["websocket"]});const o=document.querySelector("#startScreen"),n=document.querySelector("#gameOverScreen"),i=document.querySelector("#gameUi");document.querySelector("#btnStartGame").onclick=(()=>{t={waveNum:1,teamScore:0};const o=s();e.emit("startGame",o),window.requestAnimationFrame(k),setTimeout(()=>{q()},2e3)}),btnPlayAgain.onclick=(()=>{o.classList.remove("hidden"),n.classList.add("hidden")});const r=document.querySelector("canvas#ctx"),c=r.getContext("2d");function d(e){r.width=e.width,r.height=e.height,c.font="12px Courier New",c.textAlign="center"}window.onresize=(()=>{const t=s();d(t),e.emit("viewportResize",t)}),d(s()),document.fullscreenElement=document.fullscreenElement||document.mozFullscreenElement||document.msFullscreenElement||document.webkitFullscreenDocument,document.exitFullscreen=document.exitFullscreen||document.mozExitFullscreen||document.msExitFullscreen||document.webkitExitFullscreen,e.on("newPlayer",e=>{new u(e)});let m=null;e.on("init",e=>{o.classList.add("hidden"),i.classList.remove("hidden"),e.selfId&&(m=e.selfId);for(let t=0;t<e.players.length;t++){const s=e.players[t];s.id===m&&(document.querySelector(".hud").style.color=s.color),new u(e.players[t])}for(let t=0;t<e.enemies.length;t++)new x(e.enemies[t]);for(let t=0;t<e.bullets.length;t++){const s=e.bullets[t];s.parentId==m&&h(a),new p(s)}for(let t=0;t<e.obstacles.length;t++)new v(e.obstacles[t]);for(let t=0;t<e.items.length;t++)new w(e.items[t])}),e.on("update",e=>{const t=e.players;for(let e=0;e<t.length;e++){let s=t[e];u.sprites[s.id].x=s.x,u.sprites[s.id].y=s.y,s.id==m&&u.sprites[s.id].hp>s.hp&&h(l),u.sprites[s.id].hp=s.hp,u.sprites[s.id].score=s.score,u.sprites[s.id].lives=s.lives,u.sprites[s.id].weaponName=s.weaponName,u.sprites[s.id].weaponAmmo=s.weaponAmmo,u.sprites[s.id].diedAt=s.diedAt}const s=e.enemies;for(let e=0;e<s.length;e++){let t=s[e];x.sprites[t.id].x=t.x,x.sprites[t.id].y=t.y,x.sprites[t.id].hp=t.hp}const o=e.bullets;for(let e=0;e<o.length;e++){let t=o[e];p.sprites[t.id].x=t.x,p.sprites[t.id].y=t.y}const n=e.obstacles;for(let e=0;e<n.length;e++){let t=n[e];v.sprites[t.id].x=t.x,v.sprites[t.id].y=t.y}const i=e.items;for(let e=0;e<i.length;e++){let t=i[e];w.sprites[t.id].x=t.x,w.sprites[t.id].y=t.y}}),e.on("remove",e=>{for(let t=0;t<e.players.length;t++)delete u.sprites[e.players[t]];for(let t=0;t<e.enemies.length;t++)x.sprites[e.enemies[t]].dead=!0;for(let t=0;t<e.bullets.length;t++)delete p.sprites[e.bullets[t]];for(let t=0;t<e.obstacles.length;t++)delete v.sprites[e.obstacles[t]];for(let t=0;t<e.items.length;t++)delete w.sprites[e.items[t]]});const y=document.querySelector(".toast#wave-toast"),g=document.querySelector("span#wave-num-toast");function q(){g.textContent=t.waveNum,y.classList.add("show"),setTimeout(()=>{y.classList.remove("show")},4e3)}e.on("state",e=>{t.totalEnemies=e.totalEnemies,t.waveKills=e.waveKills,e.waveNum!==t.waveNum&&(t.waveNum=e.waveNum,q())}),e.on("gameOver",()=>{t.gameOver=!0;const e=document.querySelector("#stats-team-score"),s=document.querySelector("#stats-player-score"),o=document.querySelector("#stats-wave-reached");e.textContent=t.teamScore,s.textContent=u.sprites[m].score,o.textContent=t.waveNum,n.classList.remove("hidden"),i.classList.add("hidden");for(let e in u.sprites)delete u.sprites[e];for(let e in x.sprites)delete x.sprites[e];for(let e in p.sprites)delete p.sprites[e];for(let e in v.sprites)delete v.sprites[e];for(let e in w.sprites)delete w.sprites[e]});const k=()=>{if(t.gameOver)return;const e=t.totalEnemies-t.waveKills;document.querySelector("span#enemies-remaining").textContent=e,document.querySelector("span#wave-num").textContent=t.waveNum;let s=0;const o=document.querySelector("span#team-score"),n=document.querySelector("span#player-score"),i=document.querySelector("span#player-lives"),a=document.querySelector("span#player-ammo"),l=document.querySelector("span#player-weapon");for(let e in u.sprites){const o=u.sprites[e];o.id===m&&(n.textContent=o.score,i.textContent=o.lives>=0?o.lives:0,a.textContent=o.weaponAmmo,l.textContent=o.weaponName,a.textContent=Math.min(o.weaponAmmo,99999)),s+=o.score,t.teamScore=s}o.textContent=s,c.fillStyle="black",c.fillRect(0,0,r.width,r.height);for(let e in v.sprites)v.sprites[e].render();for(let e in u.sprites){const t=u.sprites[e];t.diedAt?t.deathAnimationFrame+=1:t.deathAnimationFrame=0,t.render()}for(let e in x.sprites){const t=x.sprites[e];t.dead&&(t.deathAnimationFrame+=1),t.render(),t.deathAnimationFrame>=t.deathAnimationTotalFrames&&delete x.sprites[t.id]}for(let e in w.sprites)w.sprites[e].render();for(let e in p.sprites)p.sprites[e].render();window.requestAnimationFrame(k)},A={68:"right",65:"left",87:"up",83:"down",70:"fullscreen",77:"mute"};document.onkeydown=(t=>{"fullscreen"!==A[t.keyCode]?"mute"!==A[t.keyCode]?e.emit("keyPress",{inputId:A[t.keyCode],state:!0}):"running"===_.state?(f=!0,_.suspend()):"suspended"===_.state&&(f=!1,_.resume()):function(){const e=document.querySelector("body");e.requestFullscreen=e.requestFullscreen||e.mozRequestFullscreen||e.msRequestFullscreen||e.webkitRequestFullscreen,document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():e.requestFullscreen().then({}).catch(e=>{alert(`Error attempting to enable full-screen mode: ${e.message} (${e.name})`)})}()}),document.onkeyup=(t=>{e.emit("keyPress",{inputId:A[t.keyCode],state:!1})}),document.onmousedown=(t=>{e.emit("keyPress",{inputId:"shoot",state:!0})}),document.onmouseup=(t=>{e.emit("keyPress",{inputId:"shoot",state:!1})}),document.onmousemove=(t=>{const s={x:t.clientX,y:t.clientY};e.emit("keyPress",{inputId:"mouseAngle",state:s})})},!1)}();