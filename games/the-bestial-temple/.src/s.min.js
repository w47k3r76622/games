window.onload=function(){function e(e){for(var t=0;t<J.length;t++)"t"==J[t][6]&&e(J[t])}function t(){if(1==C){for(k.x-5<b.x+b.w/2&&b.x+b.w/2<k.x+5&&(b.mx=0),k.y-5<b.y+b.h&&b.y+b.h<k.y+5&&(b.my=0),b.mx<0?b.x-=1.5:b.mx>0&&(b.x+=1.5),b.my<0?b.y-=1.5:b.my>0&&(b.y+=1.5),q=0;q<4;q++)qq=I[X[M][A]][q],E={X:b.x+b.w/2,Y:b.y+b.h},E.X>qq.x&&E.Y>qq.y&&E.X<qq.x+qq.w&&E.Y<qq.y+qq.h&&(M+=qq.i,A+=qq.j,b.mx=b.my=0,b.x=qq.rx,b.y=qq.ry);U<=0&&(C=3,O[6]="t",B="Try to beat this labyrinth. I got lost on the room "+X[M][A]+". ",J[1][6]=J[2][6]="t"),X[M][A]==D-1&&(C=2,O[6]="t",B="I clear the labyrinth with "+U+" seconds remaining! ",J[1][6]=J[2][6]="t",G=Math.floor(100*Math.random())<=10?"You went back to the ship, reunited with the demigod and went back to home.":"You can go back to your family and continue your life young one."),(0!=b.mx||0!=b.my)&&R>=5&&(1==b.f?b.f=0:b.f=1,R=0),0==b.mx&&0==b.my&&(b.f=2)}}function o(){if(R++,Y.fillStyle="#101010",Y.fillRect(0,0,s,m),0==C){for(q=0;q<15;q++)for(qq=0;qq<15;qq++)n(q*s/15,qq*m/15,s/15,m/15,3,"#aa9a5a","#9a8a4a",.25,.45);f(0,0,"l"),f(1,0,"l"),f(2,0,"l"),f(3,0,"l"),Y.fillStyle="#FFFFFF",Y.font="60px Monospace",Y.fillText("The bestial temple",110,100),Y.font="25px Monospace",Y.fillStyle="#000000",Y.fillText("Use the mouse to move the tribute on the maze, you must ",10,410),Y.fillText("find an exit to escape. Pay attention to the environment ",10,430),Y.fillText("to recongise areas you already visited.",10,450),Y.fillText("Check out the time limit on the upper right.",10,470)}if(1==C){for(q=0;q<30;q++)for(qq=0;qq<30;qq++)Y.drawImage(g,q*s/30,qq*m/30,s/30,m/30);for(qq=I[X[M][A]],q=0;q<8;q++)(3!=q&&4!=q||!qq[0].s)&&f(q,0),(3!=q&&4!=q||!qq[1].s)&&n(q*s/8,m/7*6,s/8,m/7,3,"#aa9a5a","#9a8a4a",.25,.45);for(q=6;q>=0;q--)3==q&&qq[2].s||n(0,m/7*q,s/8,m/7,3,"#aa9a5a","#9a8a4a",.3,.45),2==q&&qq[2].s&&f(0,q),3==q&&qq[3].s||n(s/8*7,m/7*q,s/8,m/7,3,"#aa9a5a","#9a8a4a",.2,.45),2==q&&qq[3].s&&f(7,q);for(q=0;q<3;q++)if(0!=Q[X[M][A]][q][0]){switch(a=Q[X[M][A]][q],img=new Image,a[2]){case 1:img=p;break;case 2:img=F;break;case 3:img=w}Y.drawImage(img,s/8*a[1],m/7*a[2],30,30)}Y.drawImage(b.i,15*b.f,0,15,20,b.x,b.y,b.w,b.h),Y.fillStyle="#ffc3a0",Y.fillRect(s/8*7,0,s/8*2,30),Y.fillStyle="#222222",Y.font="20px Monospace",Y.fillText(U+" sec.",s/20*18,20)}C>1&&(Y.fillStyle="#DDDDDD",Y.font="30px Monospace",Y.fillText("Share it",s/40*17,420),Y.font="20px Monospace",2==C&&(Y.fillText("You managed to escape... and better than that... Survive!",s/20*2,150),Y.fillText(G,s/20*1,200)),3==C&&(Y.fillText("You got caugth...",s/20*8,150),Y.fillText('"I..am...c.ounting on you .. Te..."',s/4,200))),e(function(e){""!=e[7]&&(Y.fillStyle=e[7],Y.fillRect(e[0],e[1],e[2],e[3])),Y.fillStyle=e[9],Y.font="30px Monospace",Y.fillText(e[4],e[0],e[1]+20)}),Y.drawImage(y[4],y[0],y[1],y[2],y[3])}function n(e,t,a,o,n,r,f,i,l){Y.beginPath(),Y.lineWidth=n,Y.strokeStyle=r,Y.fillStyle=f,Y.fillRect(e,t,a,o),Y.rect(e,t,a,o),r&&Y.stroke(),Y.globalAlpha=i,l&&Y.drawImage(g,1-l,0,g.width*l,g.height*l,e,t,a,o),Y.globalAlpha=1}function f(e,t,a){var o=s/8,f=m/7;for(a&&(o=s/4,f=m/3.5),n(e*o,t*f,o,f,"6","#bfaf6f","#bfaf6f",.3,1),i(2,4,"#aaaaaa",e,t,o,f,12),Y.beginPath(),r=0;r<v[0].length;r++)Y.lineWidth=1,Y.fillStyle=Y.strokeStyle="#bb7c77",Y.lineTo(e*o+o/8*v[0][r],t*f+f/8*v[1][r]);Y.stroke(),Y.fill(),i(3,6,"#ab6c67",e,t,o,f,4),i(2,4,"#444444",e,t,o,f,7),i(5,7,"#444444",e,t,o,f,15),i(5,7,"#eecd4f",e,t,o,f,11),i(5,7,"#444444",e,t,o,f,6)}function i(e,t,a,o,n,f,i,l){for(Y.beginPath(),Y.strokeStyle=a,Y.lineWidth=l,r=e;r<t;r++)Y.lineTo(o*f+f/8*v[0][r],n*i+i/8*v[1][r]);Y.stroke(),Y.closePath()}function l(){for(1==Math.floor(2*Math.random())?b.i=u:b.i=x,I=[],j=[],S=[],M=0;M<D;M++)I.push([{s:!1},{s:!1},{s:!1},{s:!1},!1]),j.push(["","",""]);for(M=0;M<21;M++)S.push([".",".",".",".",".",".",".",".",".",".",".",".",".",".","."]),X.push([".",".",".",".",".",".",".",".",".",".",".",".",".",".","."]);A=4,S[M=10][A]="1"}function h(){l();for(var e,t=!0,a=1,o=0;o<D;o++){j[o][0]=M,j[o][1]=A,X[M][A]=o,t=!1,e=0;var n;if(0==o)A++,S[M][A]="0",I[o][1]=W[1],I[o][4]=!0,a=1;else{for(I[o][a-1]=W[a-1];0==t;){switch(e++,n=Math.floor(4*Math.random())+0){case 0:A-1!=0&&0==t&&"."==S[M][A-1]&&(A-=1,S[M][A]="0",t=!0,I[o][n]=W[0],a=2);break;case 1:A+1!=12&&0==t&&"."==S[M][A+1]&&(A+=1,S[M][A]="0",t=!0,I[o][n]=W[1],a=1);break;case 2:M-1!=0&&0==t&&"."==S[M-1][A]&&(S[M-=1][A]="0",t=!0,I[o][n]=W[2],a=4);break;case 3:M+1!=12&&0==t&&"."==S[M+1][A]&&(S[M+=1][A]="0",t=!0,I[o][n]=W[3],a=3)}e>20&&(l(),t=!0,o=-1)}o!=D-1&&Q.push([[Math.floor(3*Math.random())+0,Math.floor(6*Math.random())+1,Math.floor(5*Math.random())+1],[Math.floor(3*Math.random())+0,Math.floor(6*Math.random())+1,Math.floor(5*Math.random())+1],[Math.floor(3*Math.random())+0,Math.floor(6*Math.random())+1,Math.floor(5*Math.random())+1]])}o==D-1&&(S[M][A]=".",I[o][n]={s:!1})}M=j[99][0],A=j[99][1];for(var r=M-1,f=A-1,i=0;i<3;i++)for(var q=0;q<3;q++)if(r+q>=0&&r+q<=20&&"."!=S[r+q][f+i])for(h=0;h<D;h++)r+q==j[h][0]&&f+i==j[h][1]&&(I[h][4]=!0,S[j[h][0]][j[h][1]]="1");for(var h=0;h<D;h++)if(!I[h][4]){if(Math.floor(100*Math.random())+0<60&&"0"==S[j[h][0]][j[h][1]-1]){I[h][0]=W[0];s=X[j[h][0]][j[h][1]-1];I[s][1]=W[1]}if(Math.floor(100*Math.random())+0<60&&"0"==S[j[h][0]-1][j[h][1]]){I[h][2]=W[2];var s=X[j[h][0]-1][j[h][1]];I[s][3]=W[3]}}for(var m=0,c=100,y=98;y>=0;y--){d=j[y];i="";I[y][0].s&&(i=X[d[0]][d[1]-1])<c&&(c=i),I[y][1].s&&(i=X[d[0]][d[1]+1])<c&&(c=i),I[y][2].s&&(i=X[d[0]-1][d[1]])<c&&(c=i),I[y][3].s&&(i=X[d[0]+1][d[1]])<c&&(c=i),c<y&&(y=c+1),m++}for(var g=0,x=0,y=1;y<D-1;y++){d=j[y];i="";I[y][0].s&&(i=X[d[0]][d[1]-1])>x&&(x=i),I[y][1].s&&(i=X[d[0]][d[1]+1])>x&&(x=i),I[y][2].s&&(i=X[d[0]-1][d[1]])>x&&(x=i),I[y][3].s&&(i=X[d[0]+1][d[1]])>x&&(x=i),x>y&&(y=x-1),g++}g<m&&(m=g),V=Math.floor(2*m)}document.oncontextmenu=function(e){e.preventDefault()};var s=800,m=602,c=new Image;c.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAOCAYAAAAWo42rAAAAYElEQVQoU2NkQAJ1VVX/m9raGJHFYGy4IEhRY2srQ311NQM2xQOtEOQ+kKNhbkT3DMjNjMiegClEp0Ea4QqxBQlMDBQSNFAIMh7mTlzWg62GScJ8jk0x2NckmYjPNJgNACXBVybPjlGRAAAAAElFTkSuQmCC";var y=[0,0,15,15,c],g=new Image;g.src="floor.png";var x=new Image;x.src="player.png";var u=new Image;u.src="player1.png";var p=new Image;p.src="footprint.png";var w=new Image;w.src="table.png";var F=new Image;F.src="skull.png";var M,A,v=[[2,3,3,5,5,6,2],[0,1,8,8,1,0,0]],b={x:400,y:300,w:s/17,h:m/12,ff:2,f:2,i:"",mx:0,my:0},k={x:0,y:0},T=document.getElementById("c"),Y=T.getContext("2d"),I=[],S=[],X=[],D=100,j=[],Q=[],C=0,R=0,N=0,P=90,U=P,B="",G="",V=0,W=[{s:!0,x:s/8*3,y:0,w:s/8*2,h:m/7,i:0,j:-1,rx:s/8*4,ry:m/7*6-b.h-20},{s:!0,x:s/8*3,y:m/7*6,w:s/8*2,h:m/7,i:0,j:1,rx:s/8*4,ry:m/7+20},{s:!0,x:0,y:m/7*3,w:s/8,h:m/7,i:-1,j:0,rx:s/7*6-20,ry:m/7*3},{s:!0,x:s/8*7,y:m/7*3,w:s/8,h:m/7,i:1,j:0,rx:s/7+20,ry:m/7*3}],J=[],O=[360,300,80,20,"Start",function(){h(),U=P=3*V,O[6]="f",C=1,M=10,A=4,O[4]="Play Again",O[0]=330,O[9]="#FFFFFF",O[12]="#FFFFFF",O[2]=160,J[1][6]=J[2][6]="f"},"t","","","#000000","#AA2255","","#000000"];J.push(O);var z=[200,450,112,20,"Twitter",function(){window.open("https://twitter.com/home?status="+encodeURIComponent(B+"http://js13kgames.com/entries/the-bestial-temple"))},"f","","","#FFFFFF","#22AA55","","#FFFFFF"];J.push(z);var K=[480,450,112,20,"Facebook",function(){window.open("https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent("http://js13kgames.com/entries/the-bestial-temple")+"&description="+encodeURIComponent(B))},"f","","","#FFFFFF","#22AA55","","#FFFFFF"];J.push(K);var H,L;setInterval(function(){void 0===H&&(H=new Date),void 0===L&&(L=new Date),(new Date).getTime()>=H.getTime()+1e3/60&&(o(),H=new Date),(new Date).getTime()>=L.getTime()+1e3&&(N++,1==C&&U--,L=new Date),t()},10),T.onmousemove=function(t){y[0]=t.offsetX,y[1]=t.offsetY,e(function(e){t.offsetX>e[0]&&t.offsetX<e[0]+e[2]&&t.offsetY>e[1]&&t.offsetY<e[1]+e[3]?(e[9]=e[10],e[7]=e[8]):(e[9]=e[12],e[7]=e[11])})},T.onmousedown=function(t){var a={X:t.offsetX,Y:t.offsetY};e(function(e){a.X>e[0]&&a.X<e[0]+e[2]&&a.Y>e[1]&&a.Y<e[1]+e[3]&&e[5]()});var o=!1;if(1==C)for(q=0;q<4;q++)qq=I[X[M][A]][q],qq.s&&a.X>qq.x&&a.Y>qq.y&&a.X<qq.x+qq.w&&a.Y<qq.y+qq.h&&(o=!0);(a.X>s/8&&a.Y>m/7||o)&&(a.X<s/8*7&&a.Y<m/7*6||o)&&(b.mx=Math.floor((k.x=a.X)-(b.x+b.w/2)),b.my=Math.floor((k.y=a.Y)-(b.y+b.h)))}};