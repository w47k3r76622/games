!function(e){var t=e.canvas=document.getElementById("game"),n=(e.ctx=t.getContext("2d"),t.width/t.height),r=t.width,i=t.height;e.ratio=1,e.player={};var o=function(){"mainScreen"===e.currentState?(e.backgroundDraw(),e.mainScreenDraw()):(e.backgroundDraw(),e.playerDraw(),e.particleDraw(),e.enemyDraw(),"endScreen"===e.currentState&&e.endScreenDraw()),e.controlsDraw(),requestAnimationFrame(o)},s=function(){e.backgroundLogic(),e.particleLogic(),e.enemyLogic(),setTimeout(s,100/6)},a=function(){r>window.innerWidth||i>window.innerHeight?(window.innerWidth>window.innerHeight*n?(e.ratio=window.innerHeight/i,t.width*=window.innerHeight/t.height,t.height=window.innerHeight):(e.ratio=window.innerWidth/r,t.height*=window.innerWidth/t.width,t.width=window.innerWidth),document.body.style.margin=0):(t.width=r,t.height=i,e.ratio=1),e.smallerDimension=Math.min(t.width,t.height),e.cx=t.width/2,e.cy=t.height/2,e.initBackground&&e.initBackground()},c=function(){o(),s()};a(),window.addEventListener("load",c,!1),window.addEventListener("resize",a),window.addEventListener("orientationchange",a)}(window.game),function(e){var t=e.ctx,n=e.player;n.time=0,n.dist=40,n.halfBase=10,n.halfHeight=10,n.angle=0,n.canMove=!0,n.pos=0,n.alpha=1,n.DEFAULT_NUM_SHIELDS=1,n.numShields=n.DEFAULT_NUM_SHIELDS,n.score=0;var r=20,i=n.dist+2*n.halfHeight,o=8,s=50;n.hidePlayer=function(){n.alpha=0,setTimeout(function(){n.color=n.skins.default},1e3)},n.isColliding=function(e){return n.numShields<=0&&e<=n.dist||n.numShields>0&&e<=n.numShields*r+i?!0:!1};var a=function(){t.fillStyle="rgb("+e.SHIELD_COLOR+")";for(var a=1;a<=n.numShields;a++)t.fillRect(i+a*r,-s/2,o,s)};e.playerDraw=function(){var r=e.cx,i=e.cy,o=n.halfBase,s=n.halfHeight;t.save(),t.translate(r,i),t.rotate(n.angle),a(),t.translate(n.dist+s,0),t.beginPath(),t.moveTo(-s,-o),t.lineTo(-s,o),t.lineTo(s,0),t.closePath(),t.restore(),t.fillStyle="rgba("+n.color+", 1)",t.fill()},e.turnPlayer=function(t){n.pos+=t,n.pos>=e.sides&&(n.pos%=e.sides),n.pos<0&&(n.pos=e.sides+n.pos),n.angle=e.turnStep*n.pos,n.restAngle=n.angle},e.setPlayerDirection=function(t){e.playerDirection=t,e.ctx.globalCompositeOperation=e.playerDirection>0?"source-over":"xor"}}(window.game),function(e){var t=function(e,t){var n=e.split(","),r=0>t?0:255,i=0>t?-1*t:t,o=parseInt(n[0].slice(4)),s=parseInt(n[1]),a=parseInt(n[2]);return"rgb("+(Math.round((r-o)*i)+o)+","+(Math.round((r-s)*i)+s)+","+(Math.round((r-a)*i)+a)+")"},n=function(e,t){var n=parseInt(e.slice(1),16),r=0>t?0:255,i=0>t?-1*t:t,o=n>>16,s=n>>8&255,a=255&n;return"#"+(16777216+65536*(Math.round((r-o)*i)+o)+256*(Math.round((r-s)*i)+s)+(Math.round((r-a)*i)+a)).toString(16).slice(1)},r=(e.shade=function(e,r){return e.length>7?t(e,r):n(e,r)},function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(Math.random()*(t+1)),r=e[t];e[t]=e[n],e[n]=r}return e});e.SHIELD_COLOR="0, 225, 172",e.player.skins={"default":"255,255,255",flashColor:"255, 184, 253"},e.player.color=e.player.skins.default,e.bgIndex=0,e.BACKGROUND_COLORS_LIST=r([["#B83564"],["#FF6A5A"],["#FFB350"],["#83B8AA"],["#490A3D"],["#BD1550"],["#E97F02"],["#F8CA00"],["#8F293D"],["#C75233"],["#C78933"],["#D6CEAA"],["#79B5AC"],["#5E2F46"],["#FF003C"],["#FF8A00"],["#FABE28"],["#88C100"],["#00C176"],["#FAF577"],["#67DAD4"],["#24AFA8"],["#28716D"],["#EF434B"],["#482344"],["#429867"],["#2B5166"],["#FAB243"],["#E02130"],["#efefef"]]),e.INDICATOR_COLOR="#1B9171",e.HIT_PARTICLE_COLORS=["red","white"],e.NORMAL_ENEMY_COLOR="white",e.REVERSER_ENEMY_COLOR="#FD0251",e.MAIN_OVERLAY_RGBA="0, 0, 0, 0.5",e.MAIN_TEXT_COLOR="white",e.END_OVERLAY_COLOR="0, 0, 0",e.END_TEXT_COLOR="255, 255, 255",e.MUSIC_ENABLED_COLOR="white",e.MUSIC_DISABLED_COLOR="gray"}(window.game),function(e,t){"function"==typeof define&&define.amd?define(["exports"],t):"object"==typeof exports&&"string"!=typeof exports.nodeName?t(exports):t(e.TinyMusic={})}(this,function(e){function t(e){var n=e.split(a);this.frequency=t.getFrequency(n[0])||0,this.duration=t.getDuration(n[1])||0}function n(e,t,n){this.ac=e||new AudioContext,this.createFxNodes(),this.tempo=t||120,this.loop=!0,this.smoothing=0,this.staccato=0,this.notes=[],this.push.apply(this,n||[])}var r="B#-C|C#-Db|D|D#-Eb|E-Fb|E#-F|F#-Gb|G|G#-Ab|A|A#-Bb|B-Cb",i=440*Math.pow(Math.pow(2,1/12),-9),o=/^[0-9.]+$/,s=4,a=/\s+/,c=/(\d+)/,p={};r.split("|").forEach(function(e,t){e.split("-").forEach(function(e){p[e]=t})}),t.getFrequency=function(e){var t=e.split(c),n=p[t[0]],r=(t[1]||s)-s,o=i*Math.pow(Math.pow(2,1/12),n);return o*Math.pow(2,r)},t.getDuration=function(e){return o.test(e)?parseFloat(e):e.toLowerCase().split("").reduce(function(e,t){return e+("w"===t?4:"h"===t?2:"q"===t?1:"e"===t?.5:"s"===t?.25:0)},0)},n.prototype.createFxNodes=function(){var e=[["bass",100],["mid",1e3],["treble",2500]],t=this.gain=this.ac.createGain();return e.forEach(function(e,n){n=this[e[0]]=this.ac.createBiquadFilter(),n.type="peaking",n.frequency.value=e[1],t.connect(t=n)}.bind(this)),t.connect(this.ac.destination),this},n.prototype.push=function(){return Array.prototype.forEach.call(arguments,function(e){this.notes.push(e instanceof t?e:new t(e))}.bind(this)),this},n.prototype.createCustomWave=function(e,t){t||(t=e),this.waveType="custom",this.customWave=[new Float32Array(e),new Float32Array(t)]},n.prototype.createOscillator=function(){return this.stop(),this.osc=this.ac.createOscillator(),this.customWave?this.osc.setPeriodicWave(this.ac.createPeriodicWave.apply(this.ac,this.customWave)):this.osc.type=this.waveType||"square",this.osc.connect(this.gain),this},n.prototype.scheduleNote=function(e,t){var n=60/this.tempo*this.notes[e].duration,r=n*(1-(this.staccato||0));return this.setFrequency(this.notes[e].frequency,t),this.smoothing&&this.notes[e].frequency&&this.slide(e,t,r),this.setFrequency(0,t+r),t+n},n.prototype.getNextNote=function(e){return this.notes[e<this.notes.length-1?e+1:0]},n.prototype.getSlideStartDelay=function(e){return e-Math.min(e,60/this.tempo*this.smoothing)},n.prototype.slide=function(e,t,n){var r=this.getNextNote(e),i=this.getSlideStartDelay(n);return this.setFrequency(this.notes[e].frequency,t+i),this.rampFrequency(r.frequency,t+n),this},n.prototype.setFrequency=function(e,t){return this.osc.frequency.setValueAtTime(e,t),this},n.prototype.rampFrequency=function(e,t){return this.osc.frequency.linearRampToValueAtTime(e,t),this},n.prototype.play=function(e){return e="number"==typeof e?e:this.ac.currentTime,this.createOscillator(),this.osc.start(e),this.notes.forEach(function(t,n){e=this.scheduleNote(n,e)}.bind(this)),this.osc.stop(e),this.osc.onended=this.loop?this.play.bind(this,e):null,this},n.prototype.stop=function(){return this.osc&&(this.osc.onended=null,this.osc.disconnect(),this.osc=null),this},e.Note=t,e.Sequence=n}),function(e){var t=new AudioContext,n=120,r=new TinyMusic.Sequence(t,n,["C1 s","C1 e"]);r.loop=!1,r.gain.gain.value=1,r.smoothing=.3,r.staccato=.3,r.waveType="square";var i=new TinyMusic.Sequence(t,n,["C3 s","C3 e"]);i.loop=!1,i.gain.gain.value=.8,i.smoothing=.3,i.staccato=.3,i.waveType="sine",e.sfxDamage=function(){e.musicEnabled&&r.play()},e.sfxShield=function(){e.musicEnabled&&i.play()}}(window.game),function(e){e.musicEnabled="musicEnabled"in localStorage?"true"===localStorage.musicEnabled:!0,e.currentTrack=0,e.TOTAL_TRACKS=8;var t=function(e,t){var n,r=[],i=0;return r=e.map(function(e){return n=e,i=Number(e.match(/\d/)),e.replace(i,i+t)})},n="undefined"!=typeof AudioContext?new AudioContext:new webkitAudioContext,r=e.audio={};r.tempo=120;var i=[];i[0]=[],i[0][0]=["D5  s","D5  s","D5  e","D5  e","D5  s","D5  s","D5  s","D5  s","D5  e","D5  s","D5  s","D5  s","D5  s","G5  s","G5  s","G5  e","G5  e","G5  s","G5  s","G5  s","G5  s","G5  e","G5  s","G5  s","G5  s","G5  s","A4  s","A4  s","A4  e","A4  e","A4  s","A4  s","A4  s","A4  s","A4  e","A4  s","A4  s","A4  s","A4  s","C5  s","C5  s","C5  e","C5  e","C5  s","C5  s","C5  s","C5  s","C5  e","C5  s","C5  s","C5  s","C5  s"],i[0][1]=t(i[0][0],-1),i[0][2]=i[0][0],i[0][3]=t(i[0][0],1),i[0][4]=i[0][0],i[0][5]=t(i[0][0],-2),i[0][6]=t(i[0][0],1),i[0][7]=t(i[0][0],-2),i[1]=[],i[1][0]=["-  w","-  w","-  w","-  w"],i[1][1]=["G4  q","G4  q","G4  q","G4  q","F4  q","F4  q","F4  q","F4  q","B4  q","B4  q","B4  q","B4  q","F4  q","F4  q","F4  q","F4  q"],i[1][2]=i[1][0],i[1][3]=["B5  q","B5  q","B5  q","B5  q","A5  q","A5  q","A5  q","A5  q","G5  q","G5  q","G5  q","G5  q","E5  h","A5  h"],i[1][4]=i[1][0],i[1][5]=t(i[1][1],-1),i[1][6]=i[1][0],i[1][7]=t(i[1][3],-1),i[2]=[],i[2][0]=["-  w","-  w","-  w","-  w"],i[2][1]=["G5  e","G5  e","G5  e","B5  e","B5  e","A5  e","G5  e","G5  e","F5  e","F5  e","F5  e","F5  e","F5  e","F5  e","A5  e","B5  e","B5  e","B5  e","B5  e","D6  e","D6  e","A5  e","B5  e","B5  e","F5  e","A5  e","A5  e","F5  e","F5  e","F5  e","F5  e","A5  e"],i[2][2]=i[2][0],i[2][3]=t(i[2][1],-1),i[2][4]=i[2][0],i[2][5]=t(i[2][1],1),i[2][6]=i[2][0],i[2][7]=i[2][1];var o=[];o[0]=new TinyMusic.Sequence(n,r.tempo,[]),o[1]=new TinyMusic.Sequence(n,r.tempo,[]),o[2]=new TinyMusic.Sequence(n,r.tempo,[]),o[0].gain.gain.value=.15,o[1].gain.gain.value=.35,o[2].gain.gain.value=.3,o[0].smoothing=.5,o[1].smoothing=.2,o[2].smoothing=.8,o[0].staccato=.4,o[1].staccato=.2,o[2].staccato=.1,o[0].waveType="sawtooth",o[1].waveType="triangle",o[2].waveType="square",e.audioStart=function(){e.musicEnabled===!0&&(o[0].play(),o[1].play(),o[2].play())},e.audioStop=function(){o[0].stop(),o[1].stop(),o[2].stop()},e.toggleMusic=function(){e.musicEnabled=!e.musicEnabled,localStorage.musicEnabled=e.musicEnabled,e.musicEnabled?e.audioStart():e.audioStop()},e.audioAddPreset=function(){},e.audioAddLoop=function(e,t,n){o[e].push.apply(o[e],i[t][n])},e.audioAddLoop(0,0,0),e.audioAddLoop(1,1,0),e.audioAddLoop(2,2,0),e.audioStart()}(window.game),function(e){{var t={A:[[,1],[1,,1],[1,,1],[1,1,1],[1,,1]],B:[[1,1],[1,,1],[1,1,1],[1,,1],[1,1]],C:[[1,1,1],[1],[1],[1],[1,1,1]],D:[[1,1],[1,,1],[1,,1],[1,,1],[1,1]],E:[[1,1,1],[1],[1,1,1],[1],[1,1,1]],F:[[1,1,1],[1],[1,1],[1],[1]],G:[[,1,1],[1],[1,,1,1],[1,,,1],[,1,1]],H:[[1,,1],[1,,1],[1,1,1],[1,,1],[1,,1]],I:[[1,1,1],[,1],[,1],[,1],[1,1,1]],J:[[1,1,1],[,,1],[,,1],[1,,1],[1,1,1]],K:[[1,,,1],[1,,1],[1,1],[1,,1],[1,,,1]],L:[[1],[1],[1],[1],[1,1,1]],M:[[1,1,1,1,1],[1,,1,,1],[1,,1,,1],[1,,,,1],[1,,,,1]],N:[[1,,,1],[1,1,,1],[1,,1,1],[1,,,1],[1,,,1]],O:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],P:[[1,1,1],[1,,1],[1,1,1],[1],[1]],Q:[[0,1,1],[1,,,1],[1,,,1],[1,,1,1],[1,1,1,1]],R:[[1,1],[1,,1],[1,,1],[1,1],[1,,1]],S:[[1,1,1],[1],[1,1,1],[,,1],[1,1,1]],T:[[1,1,1],[,1],[,1],[,1],[,1]],U:[[1,,1],[1,,1],[1,,1],[1,,1],[1,1,1]],V:[[1,,,,1],[1,,,,1],[,1,,1],[,1,,1],[,,1]],W:[[1,,,,1],[1,,,,1],[1,,,,1],[1,,1,,1],[1,1,1,1,1]],X:[[1,,,,1],[,1,,1],[,,1],[,1,,1],[1,,,,1]],Y:[[1,,1],[1,,1],[,1],[,1],[,1]],Z:[[1,1,1,1,1],[,,,1],[,,1],[,1],[1,1,1,1,1]],0:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],1:[[1],[1],[1],[1],[1]],2:[[1,1,1],[,,1],[1,1,1],[1,,],[1,1,1]],3:[[1,1,1],[,,1],[,1,1],[,,1],[1,1,1]],4:[[1,,1],[1,,1],[1,1,1,1],[,,1],[,,1]],5:[[1,1,1],[1,,,],[1,1,1],[,,1],[1,1,1]],6:[[1,1,1],[1,,,],[1,1,1],[1,,1],[1,1,1]],7:[[1,1,1],[,,1],[,,1],[,,1],[,,1]],8:[[1,1,1],[1,,1],[1,1,1],[1,,1],[1,1,1]],9:[[1,1,1],[1,,1],[1,1,1],[,,1],[1,1,1]],"-":[[],[],[1,1],[],[]]," ":[[,,],[,,],[,,],[,,],[,,]],":":[[,,],[,1],[,,],[,,],[,1]],"@":[[0,1,1],[1,0,0,1],[1,0,1,1],[1,0,1,1],[1,,],[1,1,1,1]],"#":[[,1,1,1,1],[,1,,,1],[,1,,,1],[1,1,,1,1],[1,1,,1,1]],"!":[[,1],[,1],[,1],[,],[,1]]},n=e.ctx;e.canvas}e.write=function(r,i,o,s,a){s=Math.floor(s*e.ratio);var c=[];r=r.toUpperCase();for(var p=0;p<r.length;p++){var l=t[r.charAt(p)];l&&c.push(l)}n.fillStyle=a||"black";var u,d,h,E=i;if("center"===i){d=0;for(var p=0;p<c.length;p++)l=c[p],h=l.map(function(e){return e.length}),d+=Math.max.apply(void 0,h);u=d*s+(c.length-1)*s,E=Math.floor(e.cx-u/2)}for("center"===o&&(u=l.length*s,o=Math.floor(e.cy-u/2)),p=0;p<c.length;p++){l=c[p];for(var S=o,f=0,y=0;y<l.length;y++){for(var g=l[y],m=0;m<g.length;m++)g[m]&&n.fillRect(E+m*s,S,s,s);f=Math.max(f,g.length*s),S+=s}E+=s+f}}}(window.game),function(e){e.keys={},e.playerDirection=1;var t=function(t){e.player.canMove&&("left"===t?e.turnPlayer(-e.playerDirection):"right"===t&&e.turnPlayer(e.playerDirection))};document.body.addEventListener("keydown",function(n){e.keys[n.keyCode]=!0,39===n.keyCode?t("right"):37===n.keyCode?t("left"):32!==n.keyCode||"endScreen"!==e.currentState&&"mainScreen"!==e.currentState?77===n.keyCode&&e.toggleMusic():e.reset()}),document.body.addEventListener("keyup",function(t){e.keys[t.keyCode]=!1}),document.body.addEventListener("touchstart",function(n){n.changedTouches[0].pageX<e.cx?t("left"):t("right")}),e.canvas.addEventListener("click",function(t){t.pageX>e.musicX&&t.pageY<e.musicY&&e.toggleMusic(),("endScreen"===e.currentState||"mainScreen"===e.currentState)&&e.reset()})}(window.game);var exports=window.game;exports.sides=4;var ticks=0,maxWait=20,spinAmount=2,enemies=[],enemyPositions=[],ENEMY_HEIGHT=50,ENEMY_WIDTH=20,DEFAULT_ENEMY_SPEED=10,SPEED_LIMIT=20,ENEMY_CENTER_DIST=500,MIN_ENEMIES=1,MIN_EMPTY_SPOTS=1,crusherEnemyIndex=-1,ODDS_OF_REVERSER=.15,difficultyLevel=1,numCrossed=0,enemySpeed=DEFAULT_ENEMY_SPEED,spinPlayer=!1,LAST_STAGE=5,FIRST_STAGE=4,progressionDirection=1,WAIT_DIST=.35*exports.smallerDimension,MOVE_IN_SPEED=5,CRUSH_SPEED=1,NUM_PARTICLES=5,PARTICLE_SPEED_FOR_SHIELD=1,PARTICLE_SPEED_FOR_PLAYER=.3,PARTICLE_OFFSET=Math.PI/2,PARTICLE_RANGE=.4,SHAKE_INTENSITY=4,DEC_RATE_FOR_SHIELD_PARTICLES=.02,DEC_RATE_FOR_PLAYER_PARTICLES=.005,MAX_SHIELDS=3,WAVE_CROSSED_SCORE=10,LEVEL_CHANGE_SCORE=100,SHAPE_CHANGE_SCORE=300,SHIELD_LOST_SCORE=-30;exports.turnStep=2*Math.PI/exports.sides,exports.currentState="mainScreen",exports.reset=function(){exports.changeSides(FIRST_STAGE),exports.endAlpha=0,enemies=[],numCrossed=0,difficultyLevel=1,spinPlayer=!1,progressionDirection=1,exports.setPlayerDirection(1),exports.player.alpha=1,exports.player.numShields=exports.player.DEFAULT_NUM_SHIELDS,exports.player.score=0,exports.currentState="complete"},exports.changeSides=function(e){enemies=[],exports.currentState="complete",exports.sides=e,exports.turnStep=2*Math.PI/exports.sides,exports.player.pos=0,exports.player.angle=0,exports.player.restAngle=0,exports.initBackground()},exports.enemyDraw=function(){for(var e,t=exports.ctx,n=0;n<enemies.length;n++)e=enemies[n],t.save(),t.translate(exports.cx,exports.cy),t.rotate(e.angle),t.fillStyle=e.reverser?exports.REVERSER_ENEMY_COLOR:exports.NORMAL_ENEMY_COLOR,t.fillRect(e.centerDist,-ENEMY_HEIGHT/2,ENEMY_WIDTH,ENEMY_HEIGHT),t.restore()};var addEnemy=function(e){var t={};t.angle=e||0,t.centerDist=ENEMY_CENTER_DIST,t.reverser=1===progressionDirection?Math.random()<ODDS_OF_REVERSER:!1,t.time=0,enemies.push(t)},range=function(e,t){for(var n=[],r=e;t>r;r++)n.push(r);return n},makeEnemyWave=function(){for(var e=range(0,exports.sides),t=MIN_ENEMIES+Math.floor(Math.random()*(exports.sides-MIN_EMPTY_SPOTS-1)),n=0;t>n;n++)e.splice(Math.floor(Math.random()*e.length),1);for(n=0;n<e.length;n++)addEnemy(exports.turnStep*e[n]);return exports.currentState="movingIn",e},playerInTheWay=function(){return crusherEnemyIndex=enemyPositions.indexOf(exports.player.pos),-1!=crusherEnemyIndex?!0:!1},animateEnemies=function(e,t,n,r){for(var i=!0,o=0;o<enemies.length;o++)enemy=enemies[o],enemy.centerDist-=t||5,enemy.centerDist<=e?enemy.centerDist=e:i=!1;i?n():r&&r()},updateIndicator=function(){exports.indicatorObj.numSides=numCrossed},makePlayerSpin=function(e){exports.spinAnimate(exports.player,function(){exports.turnPlayer(exports.steps),exports.spinning=!1,e()})},resetNumCrossed=function(){numCrossed=1===progressionDirection?0:exports.sides},afterDifficultySpin=function(){resetNumCrossed(),updateIndicator(),exports.currentState="complete"},addShield=function(){exports.player.numShields<MAX_SHIELDS&&exports.player.numShields++},playerHit=function(){if(!(0>crusherEnemyIndex)){if(enemies[crusherEnemyIndex].reverser&&exports.setPlayerDirection(-exports.playerDirection),resetNumCrossed(),updateIndicator(),exports.player.numShields>0)return exports.sfxShield(),exports.player.numShields--,exports.player.score+=SHIELD_LOST_SCORE,exports.createParticles(Math.random()*NUM_PARTICLES+1,exports.cx,exports.cy,exports.HIT_PARTICLE_COLORS,PARTICLE_SPEED_FOR_SHIELD,exports.player.angle+Math.PI,PARTICLE_RANGE,DEC_RATE_FOR_SHIELD_PARTICLES),exports.currentState="complete",exports.shakeScreen(SHAKE_INTENSITY),void 0;exports.sfxDamage(),exports.currentState="crushing",exports.player.color=exports.player.skins.flashColor,setTimeout(function(){exports.player.color=exports.player.skins.default},100),exports.createParticles(Math.random()*NUM_PARTICLES+1,exports.cx,exports.cy,exports.HIT_PARTICLE_COLORS,PARTICLE_SPEED_FOR_PLAYER,exports.player.angle+PARTICLE_OFFSET,PARTICLE_RANGE,DEC_RATE_FOR_PLAYER_PARTICLES),exports.createParticles(Math.random()*NUM_PARTICLES+1,exports.cx,exports.cy,exports.HIT_PARTICLE_COLORS,PARTICLE_SPEED_FOR_PLAYER,exports.player.angle-PARTICLE_OFFSET,PARTICLE_RANGE,DEC_RATE_FOR_PLAYER_PARTICLES),exports.shakeScreen(SHAKE_INTENSITY)}},increaseDifficulty=function(){switch(numCrossed+=progressionDirection,exports.player.score+=WAVE_CROSSED_SCORE*difficultyLevel,(numCrossed>exports.sides||0>numCrossed)&&(exports.player.score+=LEVEL_CHANGE_SCORE,difficultyLevel+=progressionDirection,exports.triggerSpin(exports.sides*progressionDirection),exports.bgIndex++,exports.bgIndex>=exports.BACKGROUND_COLORS_LIST.length&&(exports.bgIndex=0),exports.changeColors(exports.BACKGROUND_COLORS_LIST[exports.bgIndex]),enemies=[],exports.player.time=2*exports.NUM_SHAPES,exports.currentState="increasingDifficulty",addShield(),exports.currentTrack++,exports.currentTrack<exports.TOTAL_TRACKS&&(exports.audioAddLoop(0,0,exports.currentTrack),exports.audioAddLoop(1,1,exports.currentTrack),exports.audioAddLoop(2,2,exports.currentTrack)),console.log("Difficulty:",difficultyLevel)),updateIndicator(),difficultyLevel){case 1:spinPlayer=!1,enemySpeed+=progressionDirection*(SPEED_LIMIT-DEFAULT_ENEMY_SPEED)/exports.sides,enemySpeed>SPEED_LIMIT&&(enemySpeed=SPEED_LIMIT),DEFAULT_ENEMY_SPEED>enemySpeed&&(enemySpeed=DEFAULT_ENEMY_SPEED);break;case 2:spinPlayer=!0;break;case 0:case 3:exports.player.score+=SHAPE_CHANGE_SCORE,(exports.sides>=LAST_STAGE&&3===difficultyLevel||exports.sides<=FIRST_STAGE&&0===difficultyLevel)&&(progressionDirection*=-1,exports.sides-=progressionDirection,exports.setPlayerDirection(progressionDirection)),exports.changeSides(exports.sides+progressionDirection),exports.currentState="increasingDifficulty",exports.triggerSpin(exports.sides*progressionDirection),1===progressionDirection?(difficultyLevel=1,enemySpeed=DEFAULT_ENEMY_SPEED,spinPlayer=!1):(difficultyLevel=2,enemySpeed=SPEED_LIMIT,spinPlayer=!0)}};exports.enemyLogic=function(){switch(exports.currentState){case"complete":exports.player.canMove=!0,enemies=[],enemyPositions=makeEnemyWave();break;case"movingIn":animateEnemies(WAIT_DIST,MOVE_IN_SPEED,function(){exports.currentState="waiting"});break;case"waiting":ticks++,ticks>maxWait&&(ticks=0,exports.currentState="attacking",spinPlayer&&(exports.triggerSpin(progressionDirection*spinAmount),exports.player.time=2*exports.NUM_SHAPES,exports.currentState="spinning",exports.player.canMove=!1));break;case"spinning":exports.spinning&&makePlayerSpin(function(){exports.currentState="attacking"});break;case"attacking":exports.player.canMove=!0,animateEnemies(exports.player.dist+exports.player.halfHeight,enemySpeed,function(){playerInTheWay()?playerHit():(exports.currentState="complete",increaseDifficulty())},function(){return playerInTheWay()&&exports.player.isColliding(enemies[0].centerDist)?(playerHit(),void 0):void 0});break;case"crushing":exports.player.canMove=!1,animateEnemies(exports.player.dist,CRUSH_SPEED,function(){exports.player.hidePlayer(),exports.currentState="endScreen",1===exports.playerDirection&&(exports.ctx.globalCompositeOperation="xor")});break;case"increasingDifficulty":exports.player.canMove=!1,makePlayerSpin(afterDifficultySpin),exports.allShapesDoneSpinning&&afterDifficultySpin()}},function(e){e.shakeScreen=function(){var t=function(){return Math.random()>.5?1:-1},n=0,r=0;return function(i){var o=e.ctx;0===n&&o.save(),i||(i=2);var s=Math.random()*i*t(),a=Math.random()*i*t();return n+=s,r+=a,.2>i%2&&(o.translate(-n,-r),n=r=0,.15>=i)?(o.restore(),!0):(o.translate(s,a),setTimeout(function(){e.shakeScreen(i-.1)},5),void 0)}}(),e.createParticles=function(){var t=[],n=7,r=7,i=.02;e.particleDraw=function(){for(var e=0;e<t.length;e++)t[e].draw()},e.particleLogic=function(){for(var e=t.length;e--;)t[e].logic(),t[e].alive===!1&&t.splice(e,1)};var o=function(o,s,a,c,p,l){var u={};u.x=o,u.y=s,u.speed=a||5,u.color=c||"black",u.angle=p||0,u.rotAngle=e.player.angle,u.opacity=1,u.decRate=l||i,u.dx=Math.cos(u.angle)*u.speed,u.dy=Math.sin(u.angle)*u.speed;var d=e.ctx;u.draw=function(){d.save(),d.globalAlpha=this.opacity,d.globalCompositeOperation="lighter",d.translate(this.x,this.y),d.rotate(this.rotAngle),d.fillStyle=this.color||"red",d.fillRect(e.player.dist,0,n,r),d.restore()},u.logic=function(){this.x+=this.dx,this.y+=this.dy,this.opacity-=this.decRate,this.opacity<=0&&(this.opacity=0,this.alive=!1)},t.push(u)};return function(e,t,n,r,i,s,a,c){for(var p=0;e>p;p++)o(t,n,i,r[Math.floor(Math.random()*r.length)],s-a+2*Math.random()*a,c)}}()}(window.game),function(e){var t=[],n=e.ctx,r=2*e.player.dist,i=90;e.NUM_SHAPES=12,e.steps=1,e.allShapesDoneSpinning=!0,e.indicatorObj={};var o=function(e,t,n,r){return e/=r/2,1>e?n/2*e*e+t:(e--,-n/2*(e*(e-2)-1)+t)},s=function(t,r,i,o,s,a){var c=i/(2*Math.cos(e.turnStep/2));if(!(0>=a)){a=a||e.sides,n.beginPath(),n.moveTo(t+c*Math.cos(o),r+c*Math.sin(o));for(var p=1;a>=p;p++)n.lineTo(t+c*Math.cos(o+p*e.turnStep),r+c*Math.sin(o+p*e.turnStep));n.lineTo(t,r),n.closePath(),n.fillStyle=s||"green",n.fill()}},a=70;e.spinAnimate=function(t,n){t.time++,"undefined"==typeof t.restAngle&&(t.restAngle=t.angle);var r=Math.abs(e.steps);t.angle=o(t.time,t.restAngle,e.steps*e.turnStep,r*a),t.time>a*r&&(t.angle=(t.restAngle+e.turnStep*e.steps)%(2*Math.PI),t.time=0,t.spinning=!1,t===e.indicatorObj,n&&n())};var c=function(t,n,r,i){var o={};return o.x=t,o.y=n,o.side=r,o.restAngle=Math.PI/e.sides,o.angle=o.restAngle,o.color=i,o.time=0,o.draw=function(){s(o.x,o.y,o.side,o.angle,o.color,o.numSides)},o.logic=function(){e.spinAnimate(o)},o};e.initBackground=function(){t=[];for(var n=e.BACKGROUND_COLORS_LIST[e.bgIndex],o=e.NUM_SHAPES-1;o>=0;o--)t.push(c(e.cx,e.cy,r+o*i,n[o%n.length]));e.changeColors(n),e.indicatorObj=c(e.cx,e.cy,r,e.INDICATOR_COLOR),e.indicatorObj.numSides=0},e.changeColors=function(n){for(var r=e.NUM_SHAPES-1;r>=0;r--)t[r].color=e.shade(n[0],-.1*r/2),e.INDICATOR_COLOR=n[0],e.indicatorObj.color=n[0]},e.triggerSpin=function(n){var r;e.steps=n,e.spinning=!0;for(var i=0;i<t.length;i++)r=t[i],r.spinning=!0,r.time=2*i;e.indicatorObj.spinning=!0,e.indicatorObj.time=2*(i-1),e.indicatorObj.restAngle=e.indicatorObj.angle},e.backgroundDraw=function(){for(var n=0;n<t.length;n++)t[n].draw();e.indicatorObj.draw()},e.backgroundLogic=function(){e.allShapesDoneSpinning=!0;for(var n=0;n<t.length;n++)t[n].spinning&&(e.allShapesDoneSpinning=!1,t[n].logic());e.indicatorObj.spinning&&e.indicatorObj.logic()},e.initBackground()}(window.game),function(e){var t=e.ctx,n=e.canvas;e.endAlpha=0;var r=.01,i=.5,o="";e.musicX=n.width-40,e.musicY=60;var s=50;e.controlsDraw=function(){o=e.musicEnabled?e.MUSIC_ENABLED_COLOR:e.MUSIC_DISABLED_COLOR,e.write("#",e.musicX,e.musicY-s,5,o)},e.mainScreenDraw=function(){t.fillStyle="rgba("+e.MAIN_OVERLAY_RGBA+")",t.fillRect(0,0,n.width,n.height),e.controlsDraw(),o=e.MAIN_TEXT_COLOR,e.write("Turnometry","center",30,8,o),e.write("Press space to play","center","center",8,o),e.write("Seizure warning!","center",e.cy+50,4,o),e.write("A game by @AmaanC and @mikedidthis","center",n.height-40,3,o),e.allShapesDoneSpinning&&e.triggerSpin(e.sides)},e.endScreenDraw=function(){t.fillStyle="rgba("+e.END_OVERLAY_COLOR+", "+e.endAlpha+")",t.fillRect(0,0,n.width,n.height),e.endAlpha+=r,o="rgba("+e.END_TEXT_COLOR+", "+2*e.endAlpha+")",e.write("Score: "+e.player.score,"center","center",5,o),e.write("Press space to restart","center",e.cy+50,5,o),e.endAlpha>=i&&(e.endAlpha=i)}}(window.game);