var t=Object.defineProperty,i=(i,e,s)=>(((i,e,s)=>{e in i?t(i,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[e]=s})(i,"symbol"!=typeof e?e+"":e,s),s);!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver((t=>{for(const e of t)if("childList"===e.type)for(const t of e.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&i(t)})).observe(document,{childList:!0,subtree:!0})}function i(t){if(t.ep)return;t.ep=!0;const i=function(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?i.credentials="include":"anonymous"===t.crossOrigin?i.credentials="omit":i.credentials="same-origin",i}(t);fetch(t.href,i)}}();
/**
 * @preserve
 * Kontra.js v9.0.0
 */
let e=()=>{},s={};function h(t,i){s[t]=s[t]||[],s[t].push(i)}function n(t,...i){(s[t]||[]).map((t=>t(...i)))}let o,r,a={get:(t,i)=>"_proxy"==i||e};function c(){return r}class l{constructor({spriteSheet:t,frames:i,frameRate:e,loop:s=!0,name:h}){let{width:n,height:o,margin:r=0}=t.frame;Object.assign(this,{spriteSheet:t,frames:i,frameRate:e,loop:s,name:h,width:n,height:o,margin:r,isStopped:!1,_f:0,_a:0})}clone(){return new l(this)}start(){this.isStopped=!1,this.loop||this.reset()}stop(){this.isStopped=!0}reset(){this._f=0,this._a=0}update(t=1/60){if(!this.isStopped){if(!this.loop&&this._f==this.frames.length-1)return void this.stop();for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}}render({x:t,y:i,width:e=this.width,height:s=this.height,context:h=c()}){let n=this.frames[this._f]/this.spriteSheet._f|0,o=this.frames[this._f]%this.spriteSheet._f|0;h.drawImage(this.spriteSheet.image,o*this.width+(2*o+1)*this.margin,n*this.height+(2*n+1)*this.margin,this.width,this.height,t,i,e,s)}}function d(){return new l(...arguments)}class u{constructor(t=0,i=0,e={}){null!=t.x?(this.x=t.x,this.y=t.y):(this.x=t,this.y=i)}set(t){this.x=t.x,this.y=t.y}add(t){return new u(this.x+t.x,this.y+t.y,this)}}function g(){return new u(...arguments)}class f{constructor(t){return this.init(t)}init(t={}){this.position=g(),this.velocity=g(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let i=this.velocity;this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}isAlive(){return this.ttl>0}_pc(){}}class p extends f{init({width:t=0,height:i=0,context:e=c(),render:s=this.draw,update:n=this.advance,anchor:o={x:0,y:0},scaleX:r=1,scaleY:a=1,...l}={}){super.init({width:t,height:i,context:e,anchor:o,scaleX:r,scaleY:a,...l}),this._di=!0,this._uw(),this._rf=s,this._uf=n,h("init",(()=>{this.context??(this.context=c())}))}update(t){this._uf(t)}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),(1!=this.scaleX||1!=this.scaleY)&&t.scale(this.scaleX,this.scaleY);let i=-this.width*this.anchor.x,e=-this.height*this.anchor.y;(i||e)&&t.translate(i,e),this._rf(),(i||e)&&t.translate(-i,-e),t.restore()}draw(){}_pc(){this._uw()}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:i=0,_wsx:e=1,_wsy:s=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wsx=e*this.scaleX,this._wsy=s*this.scaleY,this._wx=this._wx*e,this._wy=this._wy*s,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,scaleX:this._wsx,scaleY:this._wsy}}setScale(t,i=t){this.scaleX=t,this.scaleY=i}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class x extends p{init({image:t,width:i=(t?t.width:void 0),height:e=(t?t.height:void 0),...s}={}){super.init({image:t,width:i,height:e,...s})}get animations(){return this._a}set animations(t){let i,e;for(i in this._a={},t)this._a[i]=t[i].clone(),e=e||this._a[i];this.currentAnimation=e,this.width=this.width||e.width,this.height=this.height||e.height}playAnimation(t){var i;null==(i=this.currentAnimation)||i.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){var i;super.advance(t),null==(i=this.currentAnimation)||i.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}function m(){return new x(...arguments)}function y(t){let i=t.canvas;t.clearRect(0,0,i.width,i.height)}function w(t){if(+t==t)return t;let i=[],e=t.split(".."),s=+e[0],h=+e[1],n=s;if(s<h)for(;n<=h;n++)i.push(n);else for(;n>=h;n--)i.push(n);return i}class v{constructor({image:t,frameWidth:i,frameHeight:e,frameMargin:s,animations:h}={}){this.animations={},this.image=t,this.frame={width:i,height:e,margin:s},this._f=t.width/i|0,this.createAnimations(h)}createAnimations(t){let i,e;for(e in t){let{frames:s,frameRate:h,loop:n}=t[e];i=[],[].concat(s).map((t=>{i=i.concat(w(t))})),this.animations[e]=d({spriteSheet:this,frames:i,frameRate:h,loop:n,name:e})}}}function S(){return new v(...arguments)}function b(){return(t="t.png",new Promise(((i,e)=>{const s=new Image;s.onload=()=>i(s),s.onerror=t=>e(t),s.src=t}))).then((t=>Promise.all([C(t,0,0,96,32),C(t,0,32,240,22)])));var t}function C(t,i,e,s,h){return new Promise((n=>{const o=document.createElement("canvas"),r=o.getContext("2d");o.width=s,o.height=h,r.drawImage(t,i,e,s,h,0,0,s,h);const a=new Image;a.onload=()=>n(a),a.src=o.toDataURL()}))}const T={" ":!1,e:!1,q:!1};function M(t){return!!T[t]}document.addEventListener("keydown",(t=>{T[t.key]=!0})),document.addEventListener("keyup",(t=>{T[t.key]=!1}));const I=16;function P(t,i,e){if(void 0===e)return!1;const s=t.x,h=t.y;for(const t of e){if(E({x:s,y:h,radius:i},{left:t.x,right:t.x+I,top:t.y,bottom:t.y+I}))return!0}return!1}function E(t,i){const e=Math.max(i.left,Math.min(t.x,i.right)),s=Math.max(i.top,Math.min(t.y,i.bottom)),h=t.x-e,n=t.y-s;return h*h+n*n<t.radius*t.radius}function z(...t){return _.play(...t)}const _={volume:.3,sampleRate:44100,x:new AudioContext,play:function(...t){return this.playSamples(this.buildSamples(...t))},playSamples:function(...t){const i=this.x.createBuffer(t.length,t[0].length,this.sampleRate),e=this.x.createBufferSource();return t.map(((t,e)=>i.getChannelData(e).set(t))),e.buffer=i,e.connect(this.x.destination),e.start(),e},buildSamples:function(t=1,i=.05,e=220,s=0,h=0,n=.1,o=0,r=1,a=0,c=0,l=0,d=0,u=0,g=0,f=0,p=0,x=0,m=1,y=0,w=0){let v,S,b=2*Math.PI,C=this.sampleRate,T=a*=500*b/C/C,M=e*=(1+2*i*Math.random()-i)*b/C,I=[],P=0,E=0,z=0,_=1,k=0,O=0,R=0;for(c*=500*b/C**3,f*=b/C,l*=b/C,d*=C,u=u*C|0,S=(s=s*C+9)+(y*=C)+(h*=C)+(n*=C)+(x*=C)|0;z<S;I[z++]=R)++O%(100*p|0)||(R=o?o>1?o>2?o>3?Math.sin((P%b)**3):Math.max(Math.min(Math.tan(P),1),-1):1-(2*P/b%2+2)%2:1-4*Math.abs(Math.round(P/b)-P/b):Math.sin(P),R=(u?1-w+w*Math.sin(b*z/u):1)*(R>0?1:-1)*Math.abs(R)**r*t*this.volume*(z<s?z/s:z<s+y?1-(z-s)/y*(1-m):z<s+y+h?m:z<S-x?(S-z-x)/n*m:0),R=x?R/2+(x>z?0:(z<S-x?1:(S-z)/x)*I[z-x|0]/2):R),v=(e+=a+=c)*Math.cos(f*E++),P+=v-v*g*(1-1e9*(Math.sin(z)+1)%2),_&&++_>d&&(e+=l,M+=l,_=0),u&&!(++k%u)&&(e=M,a=T,_||(_=1));return I},getNote:function(t=0,i=440){return i*2**(t/12)}};function k(t,i,e,s,h,n,o,r){return m({x:t,y:i,gx:e,gy:s,animations:h,radius:n,mx:0,my:0,anchor:{x:.5,y:.7},speed:o,normalSpeed:o,health:r,maxHealth:r,boundingObstacles:[],cooldowns:[0,0,0,0,0,0],moveX:0,moveY:0,score:0,isTakingDamage:!1,moveUnit(t){this.setMovement(t),P({x:this.gx+this.moveX,y:this.gy},this.radius,this.boundingObstacles)||(this.gx+=this.moveX),P({x:this.gx,y:this.gy+this.moveY},this.radius,this.boundingObstacles)||(this.gy+=this.moveY)},setMovement(t){if(void 0===t)return;const i=this.speed*t;this.moveX=i*this.mx,this.moveY=i*this.my},getBounds(){return{left:this.gx-this.radius,right:this.gx+this.radius,top:this.gy-this.radius,bottom:this.gy+this.radius}},getExtendedBounds(t){let i=this.getBounds();return{left:i.left-t,right:i.right+t,top:i.top-t,bottom:i.bottom+t}},setBoundingObstacles(t){this.boundingObstacles=t},setAnimation(){this.moveX<0?this.setScale(-1,1):this.moveX>0&&this.setScale(1,1),this.isTakingDamage?this.playAnimation(this.hurt):0!=this.moveX||0!=this.moveY?this.playAnimation(this.walk):this.playAnimation(this.idle)},getPosition(){return{x:this.gx,y:this.gy}},getScreenPosition(){return{x:this.x,y:this.y}},takeDamage(t){this.health-=t,this.isTakingDamage=!0,this.cooldowns[4]=.5,this.cooldowns[5]=1,z(.4,0,816,.03,void 0,.19,2,.39,void 0,void 0,void 0,void 0,void 0,1.5,void 0,1,void 0,.2,.18,.4)},updateCooldowns(t){for(let i=0;i<this.cooldowns.length;i++)this.cooldowns[i]>0?this.cooldowns[i]-=t:this.cooldowns[i]=0}})}function O(t,i,e,s,h,n){const o=k(t,i,t,i,n,5,h,100);return o.canvas=s,o.target=e,o.isTarget=!1,o.damage=5,o.onCooldown=!1,o.cooldownTime=1,o.cooldownCounter=0,o.isInViewPort=!1,o.idle="zI",o.walk="zombieWalk",o.hurt="zH",o.getDistanceToTarget=function(){return Math.sqrt(Math.pow(this.gx-this.target.gx,2)+Math.pow(this.gy-this.target.gy,2))},o.setMovement=function(t){if(void 0===t)return;const i=this.target.gx-this.gx,e=this.target.gy-this.gy,s=Math.sqrt(i*i+e*e);this.moveX=i/s*this.speed*t,this.moveY=e/s*this.speed*t},o.setScreenPosition=function(){this.x=this.gx-this.target.gx+s.width/2,this.y=this.gy-this.target.gy+s.height/2},o.drawTargetMark=function(){this.context.strokeStyle="#ff0000",this.context.lineWidth=2,this.context.beginPath(),this.context.arc(this.x,this.y,2*this.radius,0,2*Math.PI),this.context.stroke()},o.checkIfWithinViewport=function(){this.isInViewPort=this.x+this.radius>=0&&this.x-this.radius<s.width&&this.y+this.radius>=0&&this.y-this.radius<s.height},o.isPointInside=function(t,i){return Math.sqrt(Math.pow(t-this.x,2)+Math.pow(i-(this.y-4),2))<this.radius+4},o}function R(t){return m({x:0,y:0,animations:t,anchor:{x:.5,y:.5}})}function W(t,i,e){return t.filter((t=>{let s={left:t.x,right:t.x+e,top:t.y,bottom:t.y+e};return G(i,s)}))}function G(t,i){return!(i.left>t.right||i.right<t.left||i.top>t.bottom||i.bottom<t.top)}function A(t,i,e,s){return Math.abs(t-e.gx)<s&&Math.abs(i-e.gy)<s}function B(t,i,e,s){for(let h of e)if(t+7>h.x&&t<h.x+s&&i+7>h.y&&i<h.y+s)return!0;return!1}function D(t,i){const e=t.position.x-i.position.x,s=t.position.y-i.position.y;return Math.sqrt(e*e+s*s)<t.radius+i.radius}function Y(t){return{position:{x:t.gx,y:t.gy},radius:t.radius}}class N{constructor(t,e,s){i(this,"tileSize"),i(this,"tileSheet"),i(this,"tiles"),i(this,"actualTileSize"),this.tileSize=t,this.tileSheet=e,this.tiles=s,this.actualTileSize=16}drawTile(t,i,e,s,h,n=0){if(!t)return;const o=this.tiles[e];if(o&&(o.background&&(t.fillStyle=o.background,t.fillRect(s*this.tileSize,h*this.tileSize,this.tileSize,this.tileSize)),void 0!==o.x&&void 0!==o.y)){const r=o.x*this.tileSize,a=o.y*this.tileSize;if(0!==n)this.drawRotatedTile(t,{x:o.x,y:o.y},s,h,n);else if("t"===e){let e=1,n=1;t.drawImage(this.tileSheet,64,19,2*this.tileSize,13,(s-e)*this.tileSize+this.tileSize/2,(h-n)*this.tileSize+19,2*this.tileSize,13),null==i||i.drawImage(this.tileSheet,64,0,32,19,(s-e)*this.tileSize+this.tileSize/2,(h-n)*this.tileSize,32,19)}else t.drawImage(this.tileSheet,r,a,this.tileSize,this.tileSize,s*this.tileSize,h*this.tileSize,this.tileSize,this.tileSize)}}drawRotatedTile(t,i,e,s,h=0){if(!t)return console.error("No context provided.");const n=e*this.actualTileSize,o=s*this.actualTileSize,r=i.x*this.actualTileSize,a=i.y*this.actualTileSize;t.save(),t.translate(n+this.actualTileSize/2,o+this.actualTileSize/2),t.rotate(h*Math.PI/180),t.drawImage(this.tileSheet,r,a,this.actualTileSize,this.actualTileSize,-this.actualTileSize/2,-this.actualTileSize/2,this.actualTileSize,this.actualTileSize),t.restore()}}const L={g:"#2b4432",w:"#374952",s:"#9d7e6a",uG:"#41772f",uY:"#edc06d",uO:"#db6136",uR:"#ae3b2f",uP:"#7f417c",uW:"#c8cdcc",uCd:"#000000dd"};function X(t,i,e){return[{x:1,y:1},{x:-1,y:1},{x:1,y:-1},{x:-1,y:-1}].map((s=>function(t,i,e,s){return m({x:0,y:0,gx:t.x,gy:t.y,dx:i.x,dy:i.y,radius:1,color:L.uY,speed:200,ttl:5,isColliding:!1,render(){this.context.fillStyle=this.color,this.context.beginPath(),this.context.arc(0,0,this.radius,0,2*Math.PI),this.context.fill()},update(t){void 0!==t&&(this.gx+=this.dx?this.dx*this.speed*t:0,this.gy+=this.dy?this.dy*this.speed*t:0,this.x=this.gx-s.gx+e.width/2,this.y=this.gy-s.gy+e.height/2,this.radius*=.8,this.advance())}})}(t,s,i,e)))}function q(t,i,e){return m({x:0,y:0,gx:t.x,gy:t.y,radius:40,color:L.uP+"77",render(){this.context.fillStyle=this.color,this.context.beginPath(),this.context.arc(0,0,this.radius,0,2*Math.PI),this.context.fill()},update(t){void 0!==t&&(this.x=this.gx-e.gx+i.width/2,this.y=this.gy-e.gy+i.height/2,this.advance())},setPos(t){this.gx=t.x+e.gx-i.width/2,this.gy=t.y+e.gy-i.height/2},explode(t){return z(1.2,0,127,.01,.22,.41,3,3.28,1,.6,void 0,void 0,void 0,.5,void 0,.7,.23,.42,.15),t.forEach((t=>{D(Y(t),Y(this))&&t.takeDamage(100)})),function(t,i,e){const s=[];for(let h=0;h<20;h++)s.push(m({x:0,y:0,gx:t.x,gy:t.y,duration:.5,radius:5,color:L.uP,render(){this.context.fillStyle=this.color,this.context.beginPath(),this.context.arc(0,0,this.radius,0,2*Math.PI),this.context.fill()},update(t){void 0!==t&&(this.gx+=20*Math.random()-10,this.gy+=20*Math.random()-10,this.x=this.gx-e.gx+i.width/2,this.y=this.gy-e.gy+i.height/2,this.radius*=.9,this.duration-=t)}}));return s}({x:this.gx,y:this.gy},i,e)},getBounds(){return{left:this.gx-this.radius,right:this.gx+this.radius,top:this.gy-this.radius,bottom:this.gy+this.radius}}})}function H(t,i,e){const s=q(t,i,e);return s.color=L.uY+"55",s.radius=40,s.explode=function(t){return z(.6,0,413,.01,.06,.05,void 0,1.02,1.4,-.1,void 0,void 0,void 0,1.2,void 0,void 0,.17,.96,.08),function(t,i,e,s){const h=[];return h.push(m({x:0,y:0,gx:t.x,gy:t.y,duration:10,radius:40,color:L.uY+"44",lighterColor:L.uY+"99",grow:!0,bubbles:[],player:e,render(){this.context.fillStyle=this.color,this.context.beginPath(),this.context.arc(0,0,this.radius,0,2*Math.PI),this.context.fill(),this.bubbles.forEach((t=>{this.context.fillStyle=t.color,this.context.beginPath(),this.context.arc(t.x-this.x,t.y-this.y,t.radius,0,2*Math.PI),this.context.fill()}))},update(t){void 0!==t&&(this.x=this.gx-e.gx+i.width/2,this.y=this.gy-e.gy+i.height/2,this.duration-=t,this.bubbles.length<60&&this.gB(),this.bubbles.forEach((s=>{s.gy-=10*t,s.x=s.gx-e.gx+i.width/2,s.y=s.gy-e.gy+i.height/2,s.radius*=.95,s.duration-=t,s.duration<=0&&this.bubbles.splice(this.bubbles.indexOf(s),1),s.color=this.lighterColor})),s.forEach((t=>{D(Y(t),Y(this))&&(t.speed=.25*t.normalSpeed)})))},gB(){const t=this.gx+Math.random()*this.radius*2-this.radius,i=this.gy+Math.random()*this.radius*2-this.radius;for(let e=this.bubbles.length;e<20;e++)this.bubbles.push({x:0,y:0,gx:t,gy:i,radius:5*Math.random(),color:this.lighterColor,duration:5*Math.random()})}})),h}({x:this.gx,y:this.gy},i,e,t)},s}const U=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]];function $(t,i,e){return(1-e)*t+e*i}function V(t,i){return(t%i+i)%i}function j(t,i,e,s,h){const n=V(t,h.length),o=V(i,h.length);let r=V(h[n]+o,h.length),a=U[r%12],c=s-i;return(e-t)*a[0]+c*a[1]}function F(t,i,e){let s,h,n,o,r,a=Math.floor(t),c=a+1,l=Math.floor(i),d=l+1,u=t-a,g=i-l;return s=j(a,l,t,i,e),h=j(c,l,t,i,e),n=$(s,h,u),s=j(a,d,t,i,e),h=j(c,d,t,i,e),o=$(s,h,u),r=$(n,o,g),r}class K{constructor(t,e,s){i(this,"width"),i(this,"height"),i(this,"tileset"),i(this,"offscreenCanvas"),i(this,"offscreenCtx"),i(this,"secondOffscreenCanvas"),i(this,"secondOffscreenCtx"),i(this,"shorelines"),i(this,"obstacles"),i(this,"trees"),i(this,"mapGrid"),i(this,"directions"),this.width=t,this.height=e,this.tileset=s,this.offscreenCanvas=new OffscreenCanvas(t,e),this.offscreenCtx=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0}),this.offscreenCtx&&(this.offscreenCtx.imageSmoothingEnabled=!1),this.secondOffscreenCanvas=new OffscreenCanvas(t,e),this.secondOffscreenCtx=this.secondOffscreenCanvas.getContext("2d",{willReadFrequently:!0}),this.secondOffscreenCtx&&(this.secondOffscreenCtx.imageSmoothingEnabled=!1),this.mapGrid=[],this.directions=["N","E","S","W"],this.shorelines=[],this.obstacles=[],this.trees=[]}generateMap(t,i){return new Promise(((e,s)=>{if(!this.offscreenCtx)return s("No context provided.");const h=Math.floor(this.width/this.tileset.tileSize),n=Math.floor(this.height/this.tileset.tileSize);for(let e=0;e<n;e++){this.mapGrid[e]=[];for(let s=0;s<h;s++){let o=(F(.1*s,.1*e,t)+1)/2;const r=s-h/2,a=e-n/2;o-=Math.sqrt(r*r+a*a)/Math.sqrt(Math.pow(h/2,2)+Math.pow(n/2,2))*i,o<.32?(this.mapGrid[e][s]={x:s,y:e,type:"wv"},this.tileset.drawTile(this.offscreenCtx,this.secondOffscreenCtx,"w",s,e)):o<.45?(this.mapGrid[e][s]={x:s,y:e,type:"s"},this.tileset.drawTile(this.offscreenCtx,this.secondOffscreenCtx,"s",s,e)):o<.6?(this.mapGrid[e][s]={x:s,y:e,type:"g"},this.tileset.drawTile(this.offscreenCtx,this.secondOffscreenCtx,"g",s,e)):(this.tileset.drawTile(this.offscreenCtx,this.secondOffscreenCtx,"g",s,e),this.mapGrid[e][s]={x:s,y:e,type:"t"})}}this.cSDP(),this.cSTP(),this.nWTT(),this.cCM(),this.rST(),this.cSDP(),this.rST();const{cornerOuter:o,cornerInner:r,border:a,grass:c}=this.fTP(this.mapGrid);o.forEach((t=>{this.tileset.drawTile(this.offscreenCtx,this.secondOffscreenCtx,"oC",t.x,t.y,t.rotation)})),r.forEach((t=>{this.tileset.drawTile(this.offscreenCtx,this.secondOffscreenCtx,"iC",t.x,t.y,t.rotation)})),a.forEach((t=>{this.tileset.drawTile(this.offscreenCtx,this.secondOffscreenCtx,"b",t.x,t.y,t.rotation)})),c.forEach((t=>{this.tileset.drawTile(this.offscreenCtx,this.secondOffscreenCtx,Math.random()>.7?"f":"g",t.x,t.y)})),this.mapGrid.forEach((t=>{t.forEach((t=>{"t"===t.type&&this.tileset.drawTile(this.offscreenCtx,this.secondOffscreenCtx,t.type,t.x,t.y),"wv"===t.type&&Math.random()>.9&&!this.shorelines.find((i=>i.x===t.x&&i.y===t.y))&&this.tileset.drawTile(this.offscreenCtx,this.secondOffscreenCtx,"wv",t.x,t.y),"s"===t.type&&(this.tileset.drawTile(this.offscreenCtx,this.secondOffscreenCtx,t.type,t.x,t.y),Math.random()>.9&&this.tileset.drawTile(this.offscreenCtx,this.secondOffscreenCtx,"r",t.x,t.y))}))}));for(let t=0;t<this.mapGrid.length;t++)for(let i=0;i<this.mapGrid[0].length;i++){const e=this.mapGrid[t][i];"wv"===e.type&&this.obstacles.push({x:i*this.tileset.tileSize,y:t*this.tileset.tileSize}),"t"===e.type&&(this.obstacles.push({x:i*this.tileset.tileSize,y:t*this.tileset.tileSize}),this.trees.push(m({gx:i*this.tileset.tileSize+this.tileset.tileSize/2,gy:t*this.tileset.tileSize+this.tileset.tileSize/2,radius:this.tileset.tileSize/2,takeDamage:t=>t,getBounds(){return{left:this.gx-this.radius,right:this.gx+this.radius,top:this.gy-this.radius,bottom:this.gy+this.radius}}})))}return e(this)}))}cCM(){for(let t=0;t<this.mapGrid.length;t++)for(let i=0;i<this.mapGrid[0].length;i++){const e=this.mapGrid[t][i],s=this.cD(i,t,this.mapGrid,e.type);2==s.length&&s.forEach((s=>{switch(s){case"NW":case"NE":case"SE":case"SW":this.cCS(i,t,s,e.type)&&(this.mapGrid[t][i].type="g"===e.type?"s":"g")}}))}}cCS(t,i,e,s){var h,n;let o=[];switch(e){case"NW":o.push([t-1,i]),o.push([t,i-1]),o.push([t+1,i-1]),o.push([t+1,i]);break;case"NE":o.push([t-1,i-1]),o.push([t,i-1]),o.push([t+1,i]),o.push([t+1,i+1]);break;case"SE":o.push([t+1,i-1]),o.push([t+1,i]),o.push([t,i+1]),o.push([t-1,i+1]);break;case"SW":o.push([t+1,i+1]),o.push([t+1,i]),o.push([t-1,i]),o.push([t-1,i-1])}for(let t=0;t<o.length;t++)if((null==(n=null==(h=this.mapGrid[o[t][1]])?void 0:h[o[t][0]])?void 0:n.type)===s)return!1;return!0}cA(t,i,e,s){var h,n,o,r;const a=[];return(null==(h=e[i][t-1])?void 0:h.type)===s&&a.push("N"),(null==(n=e[i][t+1])?void 0:n.type)===s&&a.push("S"),(null==(o=e[i+1])?void 0:o[t].type)===s&&a.push("E"),(null==(r=e[i-1])?void 0:r[t].type)===s&&a.push("W"),a}cD(t,i,e,s){var h,n,o,r,a,c,l,d;const u=[];return(null==(n=null==(h=e[i+1])?void 0:h[t-1])?void 0:n.type)===s&&u.push("NE"),(null==(r=null==(o=e[i-1])?void 0:o[t-1])?void 0:r.type)===s&&u.push("NW"),(null==(c=null==(a=e[i+1])?void 0:a[t+1])?void 0:c.type)===s&&u.push("SE"),(null==(d=null==(l=e[i-1])?void 0:l[t+1])?void 0:d.type)===s&&u.push("SW"),u}fTP(t){const i=[],e=[],s=[],h=[],n=t.length,o=t[0].length;for(let r=0;r<n;r++)for(let n=0;n<o;n++){const o=t[r][n];if("g"===o.type||"wv"===o.type){const a=this.cA(n,r,t,"s"),c=this.cD(n,r,t,"s");let l=0;if(1===c.length&&0===a.length){switch("wv"===o.type&&this.sWTSL(n,r),c[0]){case"NE":l=0;break;case"NW":l=90;break;case"SW":l=180;break;case"SE":l=270}e.push({x:n,y:r,rotation:l})}else c.length>0&&2===a.length?("wv"===o.type&&this.sWTSL(n,r),a.includes("N")&&a.includes("E")&&c.includes("NE")?l=0:a.includes("N")&&a.includes("W")&&c.includes("NW")?l=90:a.includes("S")&&a.includes("W")&&c.includes("SW")?l=180:a.includes("S")&&a.includes("E")&&c.includes("SE")&&(l=270),i.push({x:n,y:r,rotation:l})):a.length>0?("wv"===o.type&&this.sWTSL(n,r),a.includes("N")?l=0:a.includes("E")?l=270:a.includes("S")?l=180:a.includes("W")&&(l=90),s.push({x:n,y:r,rotation:l})):(l=0,"wv"!==o.type&&h.push({x:n,y:r,rotation:l}))}}return{cornerOuter:i,cornerInner:e,border:s,grass:h}}sWTSL(t,i){this.shorelines.push({x:t,y:i})}rST(){for(let t=0;t<this.mapGrid.length;t++)for(let i=0;i<this.mapGrid[0].length;i++){const e=this.mapGrid[t][i];("g"===e.type||"s"===e.type||"wv"===e.type)&&this.directions.forEach((s=>{this.cISPT(i,t,e.type,s)&&(this.mapGrid[t][i].type="g"===e.type||"wv"===e.type?"s":"g")}))}}nWTT(){for(let t=0;t<this.mapGrid.length;t++)for(let i=0;i<this.mapGrid[0].length;i++){const e=this.mapGrid[t][i];("g"===e.type||"s"===e.type)&&this.cNB(i,t,e.type)&&(this.mapGrid[t][i].type="g"===e.type?"s":"g")}}cNB(t,i,e){const s="g"===e?"wv":"t",h=this.cA(t,i,this.mapGrid,s),n=this.cD(t,i,this.mapGrid,s);return h.length>0||n.length>0}cSTP(){for(let t=0;t<this.mapGrid.length;t++)for(let i=0;i<this.mapGrid[0].length;i++){const e=this.mapGrid[t][i];if("g"===e.type||"wv"===e.type){const s=this.cA(i,t,this.mapGrid,e.type);2===s.length&&(s.includes("N")&&s.includes("S")&&(this.mapGrid[t][i].type="s"),s.includes("E")&&s.includes("W")&&(this.mapGrid[t][i].type="s"))}}}cSDP(){for(let t=0;t<this.mapGrid.length;t++)for(let i=0;i<this.mapGrid[0].length;i++){const e=this.mapGrid[t][i];if("g"===e.type||"wv"===e.type){const s=this.cD(i,t,this.mapGrid,e.type),h=this.cD(i,t,this.mapGrid,"s");2===s.length&&(s.includes("NE")&&s.includes("SW")?h.includes("NW")&&h.includes("SE")&&(this.mapGrid[t][i].type="s"):s.includes("NW")&&s.includes("SE")&&h.includes("NE")&&h.includes("SW")&&(this.mapGrid[t][i].type="s"))}}}cISPT(t,i,e,s){var h,n;const o=[];switch(s){case"N":o.push([t-1,i]),o.push([t-1,i-1]),o.push([t,i-1]),o.push([t+1,i-1]),o.push([t+1,i]);break;case"E":o.push([t,i-1]),o.push([t+1,i-1]),o.push([t+1,i]),o.push([t+1,i+1]),o.push([t,i+1]);break;case"S":o.push([t-1,i]),o.push([t-1,i+1]),o.push([t,i+1]),o.push([t+1,i+1]),o.push([t+1,i]);break;case"W":o.push([t,i-1]),o.push([t-1,i-1]),o.push([t-1,i]),o.push([t-1,i+1]),o.push([t,i+1])}for(let t=0;t<o.length;t++)if((null==(n=null==(h=this.mapGrid[o[t][1]])?void 0:h[o[t][0]])?void 0:n.type)===e)return!1;return!0}getMapSection(t,i,e,s){if(!this.offscreenCtx)throw new Error("No context provided.");return this.offscreenCtx.getImageData(t,i,e,s)}getWorldMap(){if(!this.offscreenCtx)throw new Error("No context provided.");return this.offscreenCtx.getImageData(0,0,this.width,this.height)}getTreeTops(){if(!this.secondOffscreenCtx)throw new Error("No context provided.");return this.secondOffscreenCtx.getImageData(0,0,this.width,this.height)}}function J(t){const i=function(t){function i(){return(t=(1103515245*t+12345)%2147483648)/2147483648}return t=t||Math.floor(2147483648*Math.random()),{next:i}}(t),e=Array.from({length:256},((t,i)=>i));for(let t=e.length-1;t>0;t--){const s=Math.floor(i.next()*(t+1));[e[t],e[s]]=[e[s],e[t]]}const s=[];for(let t=0;t<512;t++)s[t]=e[255&t];return s}function Q(t){return m({x:0,y:0,w:t.canvas.width,h:20,tC:t.context,s:t.sc,p:t.p,gameState:t,render:function(){this.drawTopBar(),this.drawRectangle(1,2,60),this.drawHealthBar(),this.drawRectangle(65,2,44);for(let t=0;t<this.p.cooldowns.length-3;t++)this.drawRectangle(67+14*t,4,12,12),0===t&&this.drawGingerShotIcon(73+14*t,10),1===t&&this.drawVitamineCBombIcon(73+14*t,10),2===t&&this.drawLavenderCloudIcon(73+14*t,10),this.p.cooldowns[t]>0&&(this.drawCooldownOverlay(67+14*t,2),this.drawCooldownText(73+14*t,10,t));this.drawRectangle(this.w/2/this.s-15,2,30),this.drawTimerText(this.w/2,10),this.drawRectangle(this.w/this.s-26*this.s,2,26*this.s),this.drawScoreText(this.w/this.s-13*this.s,10)},drawTopBar(){this.context.fillStyle="#000",this.context.fillRect(0,0,this.w,this.h)},drawRectangle(t,i,e,s=16){this.tC.strokeStyle=L.uW,this.tC.lineWidth=1*this.s,this.tC.strokeRect(t*this.s,i*this.s,e*this.s,s*this.s)},drawHealthBar(){let t=this.p.health>0?this.p.health:0,i=this.p.maxHealth;this.tC.fillStyle=t/i<.25?L.uR:t/i<.5?L.uO:t/i<.75?L.uY:L.uG,this.tC.fillRect(3*this.s,4*this.s,Math.floor(t/i*56*this.s),(this.h-8)*this.s)},drawGingerShotIcon(t,i){this.context.fillStyle=L.uY,this.context.beginPath(),this.context.arc(t,i,3,0,2*Math.PI),this.context.fill()},drawVitamineCBombIcon(t,i){this.context.fillStyle=L.uP,this.context.fillRect(t-1,i-3,2,6),this.context.fillRect(t-3,i-3,6,2),this.context.fillRect(t-2,i-1,4,1)},drawLavenderCloudIcon(t,i){this.context.fillStyle=L.uY,this.context.beginPath(),this.context.arc(t,i,2,0,2*Math.PI),this.context.fill(),this.context.beginPath(),this.context.arc(t+2,i,2,0,2*Math.PI),this.context.fill(),this.context.beginPath(),this.context.arc(t-2,i,2,0,2*Math.PI),this.context.fill(),this.context.beginPath(),this.context.arc(t,i+2,2,0,2*Math.PI),this.context.fill(),this.context.beginPath(),this.context.arc(t,i-2,2,0,2*Math.PI),this.context.fill()},drawCooldownOverlay(t,i){this.context.fillStyle=L.uCd,this.context.fillRect(t,i,12,12)},drawCooldownText(t,i,e){this.tC.fillStyle=L.uW,this.tC.font=8*this.s+"px Impact",this.tC.textAlign="center",this.tC.textBaseline="middle",this.tC.fillText(`${Math.ceil(this.p.cooldowns[e])}`,t*this.s,i*this.s)},drawTimerText(t,i){this.tC.fillStyle=L.uW,this.tC.font=8*this.s+"px Impact",this.tC.textAlign="center",this.tC.textBaseline="middle",this.tC.fillText(`${this.gameState.getTimerText()}`,t,i*this.s)},drawScoreText(t,i){this.tC.fillStyle=L.uW,this.tC.font=8*this.s+"px Impact",this.tC.textAlign="center",this.tC.textBaseline="middle",this.tC.fillText(`${this.gameState.getScoreText()}`,t*this.s,i*this.s)}})}class Z{constructor(t,e,s,h,n,o){i(this,"lt"),i(this,"tp"),i(this,"s"),i(this,"p"),i(this,"uiItems"),i(this,"canvas"),i(this,"context"),i(this,"sc"),i(this,"winner"),i(this,"zombies"),i(this,"trees"),this.lt=t,this.tp=0,this.s=0,this.p=e,this.uiItems=[],this.canvas=s,this.context=s.getContext("2d"),this.sc=h,this.winner=!1,this.zombies=n,this.trees=o}update(t){1===this.s&&(this.tp+=t,this.tp>=this.lt&&(this.winner||(this.p.score*=2,this.winner=!0),this.setState(3))),this.uiItems.forEach((t=>t.update()))}renderUI(){if(this.context){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);for(let t=0;t<this.uiItems.length;t++)this.uiItems[t].render()}}getTimerText(){let t=Math.floor(this.lt-this.tp),i=Math.floor(t/60),e=t-60*i;return`${i}:${e<10?`0${e}`:`${e}`}`}getScoreText(){let t=this.p.score.toString();for(;t.length<6;)t="0"+t;return`Score: ${t}`}setState(t){if(null!==this.context)switch(this.s=t,this.uiItems=[],this.canvas.height=.75*this.canvas.width,t){case 1:this.canvas.height=80,this.tp=0,this.p.resetLevel(),this.uiItems.push(Q(this));break;case 2:this.uiItems.push(m({x:0,y:0,canvas:(i=this).canvas,tC:i.context,scale:i.sc,p:i.p,render:function(){this.tC.fillStyle="#000",this.tC.fillRect(0,0,this.canvas.width,this.canvas.height),this.tC.fillStyle=L.uW,this.tC.font=15*this.scale+"px Impact",this.tC.textAlign="center",this.tC.textBaseline="middle",this.tC.fillText("Game Over!",this.canvas.width/2,this.canvas.height/3),this.tC.font=10*this.scale+"px Impact",this.tC.fillText(`Your score: ${i.p.score}`,this.canvas.width/2,this.canvas.height/2.2),this.tC.fillText("Press space to try again",this.canvas.width/2,this.canvas.height/1.8)}}));break;case 3:this.uiItems.push(function(t){return m({x:0,y:0,canvas:t.canvas,tC:t.context,s:t.sc,p:t.p,render:function(){this.tC.fillStyle="#000",this.tC.fillRect(0,0,this.canvas.width,this.canvas.height),this.tC.fillStyle=L.uW,this.tC.font=15*this.s+"px Impact",this.tC.textAlign="center",this.tC.textBaseline="middle",this.tC.fillText("Congratulations! You made it!",this.canvas.width/2,this.canvas.height/3),this.tC.font=10*this.s+"px Impact",this.tC.fillText(`Your score: ${this.p.score}`,this.canvas.width/2,this.canvas.height/2.2),this.tC.fillText("Press space to play again",this.canvas.width/2,this.canvas.height/1.8)}})}(this));break;default:this.uiItems.push(function(t){return m({x:0,y:0,canvas:t.canvas,tC:t.context,s:t.sc,gameState:t,update:function(){t.p.playAnimation("splash"),t.p.setScale(-.7*this.s,.7*this.s),t.p.x=this.canvas.width/2.1/this.s,t.p.y=this.canvas.height/1.4/this.s,t.zombies[0].playAnimation("zS1"),t.zombies[0].setScale(-.6*this.s,.6*this.s),t.zombies[0].x=this.canvas.width/1.7/this.s,t.zombies[0].y=this.canvas.height/1.42/this.s,t.zombies[1].playAnimation("zS2"),t.zombies[1].setScale(.5*this.s,.5*this.s),t.zombies[1].x=this.canvas.width/2.7/this.s,t.zombies[1].y=this.canvas.height/1.45/this.s,t.trees[0].setScale(.5*this.s,.5*this.s),t.trees[0].x=this.canvas.width/1.6/this.s,t.trees[0].y=this.canvas.height/1.7/this.s,t.trees[1].setScale(.36*this.s,.36*this.s),t.trees[1].x=this.canvas.width/2.7/this.s,t.trees[1].y=this.canvas.height/1.7/this.s},render:function(){this.context.fillStyle="#000",this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.tC.fillStyle=L.uW,this.tC.font=20*this.s+"px Impact",this.tC.textAlign="center",this.tC.textBaseline="middle",this.tC.fillText("To Health With You!",this.canvas.width/2,this.canvas.height/4),this.tC.font=8*this.s+"px Impact",this.tC.fillText("Press space to start",this.canvas.width/2,this.canvas.height/2.7),t.trees[0].render(),t.trees[1].render(),t.zombies[0].render(),t.zombies[1].render(),t.p.render()}})}(this))}var i}reloadUI(){null!==this.context&&(this.uiItems=[],1===this.s&&this.uiItems.push(Q(this)))}}function tt(t){const i=document.createElement("canvas");i.width=t.width,i.height=t.height;const e=i.getContext("2d");null==e||e.putImageData(t,0,0);const s=new Image;return s.src=i.toDataURL(),s}function it(t,i,e){return m({x:0,y:0,player:i,image:t,anchor:{x:0,y:0},drawImage:function(){var t;null==(t=this.context)||t.drawImage(this.image,Math.round(this.player.gx-e.width/2),Math.round(this.player.gy-e.height/2),e.width,e.height,0,0,e.width,e.height)}})}!async function(){const[t,i]=await b(),s=function(t){return S({image:t,frameWidth:16,frameHeight:22,animations:{idle:{frames:"0..1",frameRate:2},walk:{frames:"2..5",frameRate:8},hurt:{frames:"5..6",frameRate:8},splash:{frames:"4",frameRate:0,loop:!1},zI:{frames:"6..7",frameRate:2},zombieWalk:{frames:"8..11",frameRate:8},zH:{frames:"12..13",frameRate:8},zS1:{frames:"10",frameRate:0,loop:!1},zS2:{frames:"11",frameRate:0,loop:!1}}})}(i);let{canvas:l}=function(t,{contextless:i=!1}={}){return o=document.getElementById(t)||t||document.querySelector("canvas"),i&&(o=o||new Proxy({},a)),r=o.getContext("2d")||new Proxy({},a),r.imageSmoothingEnabled=!1,n("init"),{canvas:o,context:r}}();const d=document.getElementById("t"),u=16,g=function(t,i,e){return new N(t,i,{g:{background:e.g},w:{background:e.w},f:{x:2,y:1},iC:{x:0,y:0},oC:{x:1,y:0},b:{x:2,y:0},s:{background:e.s},r:{x:1,y:1},wv:{x:0,y:1},t:{x:4,y:0}})}(u,t,L),f={},p={x:0,y:0};l.addEventListener("mousemove",(t=>{const i=l.getBoundingClientRect(),e=l.width/i.width,s=l.height/i.height;p.x=(t.clientX-i.left)*e,p.y=(t.clientY-i.top)*s})),l.addEventListener("mousedown",(t=>{f[t.button]=!0})),l.addEventListener("mouseup",(t=>{f[t.button]=!1}));const x=8*l.width,w=11*l.height,v=function(t,i,e,s){const h=k(e.width/2,e.height/2,t-4,i-5,s,5,60,100);return h.idle="idle",h.walk="walk",h.hurt="hurt",h.initialPosition={x:t,y:i},h.vcb=!1,h.tc=!1,h.getScreenBounds=function(){return{left:this.gx-e.width/2,right:this.gx+e.width/2,top:this.gy-e.height/2,bottom:this.gy+e.height/2}},h.reduceSpeedIfTakingDamage=function(){this.cooldowns[5]>0&&(this.speed=.7*this.normalSpeed)},h.reset=function(){0===this.cooldowns[5]&&this.speed!==this.normalSpeed&&(this.speed=this.normalSpeed,this.isTakingDamage=!1)},h.resetLevel=function(){this.x=e.width/2,this.y=e.height/2,this.setScale(1,1),this.gx=this.initialPosition.x,this.gy=this.initialPosition.y,this.health=this.maxHealth,this.isTakingDamage=!1,this.speed=this.normalSpeed,this.cooldowns=[0,0,0,.5,0,0],this.score=0},h}(x/2,w/2,l,s.animations),C=[],I=[],P=[],E=[],_=[],U=await function(t,i,e,s,h){const n=J(t);return new K(Math.floor(e),Math.floor(s),h).generateMap(n,i)}(8,.5,x,w,g),$=[O(0,0,v,l,0,s.animations),O(0,0,v,l,0,s.animations)],V=S({image:t,frameWidth:32,frameHeight:32,animations:{splash:{frames:"2",frameRate:0,loop:!1}}});d.width=l.offsetWidth;const j=new Z(180,v,d,d.width/l.width,$,[R(V.animations),R(V.animations)]);window.addEventListener("resize",(()=>{d.width=l.offsetWidth,j.sc=d.width/l.width,j.reloadUI()})),j.setState(0);const F=function(t,i,e){const s=tt(t.getWorldMap());return it(s,i,e)}(U,v,l),Q=function(t,i,e){const s=tt(t.getTreeTops());return it(s,i,e)}(U,v,l);let et=0;function st(){return p}(function({fps:t=60,clearCanvas:i=!0,update:s=e,render:o,context:r=c(),blur:a=!1}={}){let l,d,u,g,f,p=0,x=1e3/t,m=1/t,w=i?y:e,v=!0;function S(){if(d=requestAnimationFrame(S),v&&(u=performance.now(),g=u-l,l=u,!(g>1e3))){for(n("tick"),p+=g;p>=x;)f.update(m),p-=x;w(f.context),f.render()}}return a||(window.addEventListener("focus",(()=>{v=!0})),window.addEventListener("blur",(()=>{v=!1}))),h("init",(()=>{f.context??(f.context=c())})),f={update:s,render:o,isStopped:!0,context:r,start(){l=performance.now(),this.isStopped=!1,requestAnimationFrame(S)},stop(){this.isStopped=!0,cancelAnimationFrame(d)}},f})({update:function(t){if(0===j.s||2===j.s||3===j.s)C.forEach((t=>{t.health=0})),E.splice(0,1),M(" ")&&0===v.cooldowns[3]&&j.setState(1);else if(1===j.s){const i=W(U.obstacles,v.getScreenBounds(),u),e=function(t,i){return t.filter((t=>{let e=t.getBounds();return G(i,e)}))}(U.trees,v.getScreenBounds());if(et+=t,et>=4*(1-j.tp/j.lt)+1&&(C.push(function(t,i,e,s,h){const n=2*e,o=t.gx-i.width/2+n,r=t.gx+i.width/2-n,a=t.gy-i.height/2+n,c=t.gy+i.height/2-n;let l=40*Math.random()+30,d=Math.random()*(r-o)+o,u=Math.random()*(c-a)+a;do{d=Math.random()*(r-o)+o,u=Math.random()*(c-a)+a}while(A(d,u,t,n)||B(d,u,s,e));return O(d,u,t,i,l,h)}(v,l,32,i,s.animations)),et=0),function(t){let i={x:0,y:0};(M("ArrowDown")||M("s"))&&(i.y+=1),(M("ArrowUp")||M("w"))&&(i.y-=1),(M("ArrowLeft")||M("a"))&&(i.x-=1),(M("ArrowRight")||M("d"))&&(i.x+=1),i=function(t){return 0!==t.x&&0!==t.y&&(t.x*=.7,t.y*=.7),t}(i),t.mx=i.x,t.my=i.y}(v),M("e")||M(" ")||M("q")){const t=Object.fromEntries(Object.entries(T).filter((([t])=>" "===t||"e"===t||"q"===t)));t[" "]&&0===v.cooldowns[1]&&(0===E.length&&0===v.cooldowns[3]?(E[0]=function(t,i,e){return q(t,i,e)}(st(),l,v),v.cooldowns[3]=.5,v.vcb=!0):v.vcb&&0===v.cooldowns[3]&&(E.splice(0,1),v.vcb=!1,v.cooldowns[3]=.5)),(t.e||t.q)&&0===v.cooldowns[2]&&(0===E.length&&0===v.cooldowns[3]?(E[0]=H(st(),l,v),v.cooldowns[3]=.5,v.tc=!0):v.tc&&0===v.cooldowns[3]&&(E.splice(0,1),v.tc=!1,v.cooldowns[3]=.5))}if(function(t){return!!f[t]}(0))if(0!==v.cooldowns[0]||v.vcb||v.tc||0!==v.cooldowns[3])v.vcb&&E.length>0?(_.push(...E[0].explode(C)),E.splice(0,1),v.vcb=!1,v.cooldowns[3]=.5,v.cooldowns[1]=15):v.tc&&E.length>0&&(_.push(...E[0].explode(C)),E.splice(0,1),v.tc=!1,v.cooldowns[3]=.5,v.cooldowns[2]=15);else{v.cooldowns[3]=.5,v.cooldowns[0]=.5;const t=function(t,i){const e=i.x-t.x,s=i.y-t.y,h=Math.sqrt(e*e+s*s);return{x:e/h,y:s/h}}(v.getScreenPosition(),st());I.push(function(t,i,e,s){return m({x:0,y:0,gx:t.x,gy:t.y,dx:i.x,dy:i.y,radius:2,color:L.uY,damage:20,speed:200,moveX:0,moveY:0,isColliding:!1,ttl:60,render(){this.context.fillStyle=this.color,this.context.beginPath(),this.context.arc(0,0,this.radius,0,2*Math.PI),this.context.fill()},update(t){void 0!==t&&(this.gx+=this.moveX,this.gy+=this.moveY,this.x=this.gx-s.gx+e.width/2,this.y=this.gy-s.gy+e.height/2,this.advance())},setMovement(t,i){void 0!==t&&(null==i||i.forEach((i=>{if(D({position:this.nextPosition(),radius:this.radius},Y(i))){const e=i.x-this.gx,s=i.y-this.gy,h=Math.sqrt(e*e+s*s);this.moveX=e/h*this.speed*t,this.moveY=s/h*this.speed*t,this.isColliding=!0,i.takeDamage(this.damage)}})),this.isColliding||(this.moveX=this.dx?this.dx*this.speed*t:0,this.moveY=this.dy?this.dy*this.speed*t:0))},nextPosition(t){return void 0===t?{x:this.gx,y:this.gy}:{x:this.gx+(this.dx?this.dx*this.speed*t:0),y:this.gy+(this.dy?this.dy*this.speed*t:0)}},getPosition(){return{x:this.gx,y:this.gy}},getBounds(){return{left:this.gx-this.radius,right:this.gx+this.radius,top:this.gy-this.radius,bottom:this.gy+this.radius}},getExtendedBounds(t){if(void 0===t)return;let i=this.getBounds();return{left:i.left-this.speed*t,right:i.right+this.speed*t,top:i.top-this.speed*t,bottom:i.bottom+this.speed*t}}})}(v.getPosition(),t,l,v)),z(1.4,0,406,.06,.02,.04,void 0,.6,void 0,void 0,void 0,void 0,.01,void 0,void 0,void 0,.06,.52,.01,.49)}P.forEach((i=>{i.update(t),i.ttl<=0&&P.splice(P.indexOf(i),1)})),I.forEach((i=>{i.setMovement(t,[...e,...C]),i.update(t),i.isColliding&&(i.ttl=0),i.ttl<=0&&(I.splice(I.indexOf(i),1),P.push(...X(i.getPosition(),l,v)))})),E.forEach((i=>{i.setPos(st()),i.update(t)})),_.forEach((i=>{i.update(t),i.duration<=0&&_.splice(_.indexOf(i),1)})),v.setBoundingObstacles(W(U.obstacles,v.getExtendedBounds(u),u)),v.reduceSpeedIfTakingDamage(),v.update(t),v.moveUnit(t),v.setAnimation();let h=0;C.forEach(((i,e)=>{if(i.getDistanceToTarget()>1.5*l.width&&(i.health=0),i.getDistanceToTarget()<v.radius&&0===i.cooldowns[0]&&(v.takeDamage(i.damage),i.cooldowns[0]=1),i.health<=0)return C.splice(e,1),void h++;let s=W(U.obstacles,i.getExtendedBounds(u),u);i.updateCooldowns(t),i.setBoundingObstacles(s),i.setScreenPosition(),i.checkIfWithinViewport(),i.update(t),i.moveUnit(t),i.setAnimation(),0===i.cooldowns[4]&&(i.isTakingDamage=!1),i.speed=i.normalSpeed})),v.health<=0&&(E.splice(0,1),et=0,C.forEach((t=>{t.health=0})),j.setState(2)),v.score+=10*h*(1+.5*h),v.reset()}v.updateCooldowns(t),j.update(t)},render:function(){1===j.s&&(F.drawImage(),E.forEach((t=>{t.render()})),v.render(),C.forEach((t=>{t.isInViewPort&&(t.isTarget&&t.drawTargetMark(),t.render())})),_.forEach((t=>{t.render()})),I.forEach((t=>{t.render()})),P.forEach((t=>{t.render()})),Q.drawImage()),j.renderUI()}}).start()}();