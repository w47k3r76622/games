<!DOCTYPE html>
<html>
  <head>    
    <meta name = "viewport" content = "user-scalable=no,width=device-width"> 
    <title>Don't Shoot BACK!</title>
  </head>
  <body>    
    <style>*{box-sizing:border-box;margin:0;padding:0}html{height:100%;width:100%}body{align-content:center;align-items:space-around;background-color:#7b7c7e;display:grid;justify-items:center;height:100%;width:100%}canvas{image-rendering:pixelated}</style>
    <canvas> </canvas>    
    <script>
      const WIDTH=window.innerWidth;const HEIGHT=window.innerHeight;const FPS=60;const EXPLODE_TIME=Math.ceil(0.12*FPS);const DSMS_HIGH_SCORES="dsms_highscores";const DSMS_TIME_TRIAL="dsms_timetrial";const ASTEROID_NUMBER=5;const ENEMY_NUMBER=1;const RANDOM_X=Math.round(Math.random()*WIDTH);const RANDOM_Y=Math.round(Math.random()*HEIGHT);const PLAYER_WIDTH=10;const PLAYER_HEIGHT=10;const PLAYER_SPEED=0.07*FPS;const PLAYER_ROTATE_SPEED=5*FPS;const INVUL_TIME=2;const BLINK_TIME=4;const ENEMY_WIDTH=30;const ENEMY_HEIGHT=10;const ENEMY_SPEED=1.5*FPS;const ENEMY_RANGE=350;const LASER_WIDTH=4;const LASER_HEIGHT=4;const LASER_MAX=10;const LASER_SPEED=300;const FIRE_RATE=0.03*FPS;const AS_WIDTH=40;const AS_HEIGHT=40;const AS_SPEED=1.3*FPS;const AS_ROTATE_SPEED=0.1*FPS;const VERTICES=10;const AS_RIDGE=0.3;const TEXT_SIZE=25;const RESPAWN_TIME=5
      window.addEventListener("load",function(){"use strict";let keyDownUp=function(event){controller.keyDownUp(event.type,event.keyCode)};let render=function(){display.fill(game.world.background_color);for(let object of game.gameEngine.gameObjects){switch(object.tag){case 'Player':display.drawTriangle(object);break;case 'Planet':display.drawCircle(object,!0);break;case 'Laser':case 'Debris':display.drawCircle(object,!0);break;case 'Asteroid':display.drawPolygon(object,!1);break;case 'Meteor':display.drawPolygon(object,!0);break;case 'Enemy':case 'Froggy':display.drawRectangle(object);break;case 'Boss':display.drawBoss(object);break;default:console.log(object.tag+" :has no shape")}}
      display.render()};let update=function(){if(controller.left.active){game.world.player.moveLeft()}
      if(controller.right.active){game.world.player.moveRight()}
      if(controller.up.active){game.world.player.forward()}
      if(controller.power.active){display.context.globalAlpha=0.2;game.world.fps=80;game.world.background_color='#ffffff00'}else{display.context.globalAlpha=1;game.world.fps=FPS;game.world.background_color='#000000'}
      if(game.gameEngine.toBeRemoved.length>0){for(let sub of game.gameEngine.toBeRemoved){let object=sub;if(object!==undefined){display.context.clearRect(object.x,object.y,object.width,object.height);game.gameEngine.toBeRemoved.delete(object)}}}
      if(!controller.paused&&game.world.start_game&&!game.world.win){game.update()}};let resize=function(){display.resize(document.documentElement.clientWidth-32,document.documentElement.clientHeight-32,game.world.height/game.world.width);display.render()};let engine=new Engine(1000/FPS,render,update);let game=new Game(engine);let controller=new Controller(game);let display=new Display(document.querySelector("canvas"),game,controller);display.buffer.canvas.width=game.world.width;display.buffer.canvas.height=game.world.height;window.addEventListener("resize",resize);window.addEventListener("keydown",keyDownUp);window.addEventListener("keyup",keyDownUp);resize();engine.start()})
      const Engine=function(delta,update,render){this.animationFrameRequest=undefined,this.elapsedTime=0;this.clock=undefined,this.delta=delta,this.updated=!1;this.update=update;this.render=render;this.run=function(time){this.animationFrameRequest=window.requestAnimationFrame(this.handleRun);this.elapsedTime+=time-this.clock;this.clock=time;if(this.elapsedTime>=this.delta*3){this.elapsedTime=this.delta};while(this.elapsedTime>=this.delta){this.elapsedTime-=this.delta;this.update(time);this.updated=!0};if(this.updated){this.updated=!1;this.render(time)}};this.handleRun=(delta)=>{this.run(delta)}};Engine.prototype={constructor:Engine,start:function(){this.elapsedTime=this.delta;this.clock=window.performance.now();this.animationFrameRequest=window.requestAnimationFrame(this.handleRun)},stop:function(){window.cancelAnimationFrame(this.animationFrameRequest)}}
      const Game=function(engine){this.gameEngine=new GameEngine();this.spaceEngine=engine;this.world=new World(this);this.audio=new AudioContext();this.gameAudio=new GameAudio(this.audio);this.colorPicker=function(colors){return colors[getRandomInt(colors.length)]},this.setAsteroidBelt=function(){let x,y;for(let i=this.world.number_asteroids;i>this.world.asteroids.size;i--){do{x=Math.floor(Math.random()*this.world.width);y=Math.floor(Math.random()*this.world.height)}while(this.gameEngine.distanceBetweenPoints(this.world.player.x,this.world.player.y,x,y)<this.world.player.width+200);this.world.asteroids.add(new Asteroid(this,x,y,AS_WIDTH,AS_HEIGHT))}},this.splitObject=function(object){for(let i=0;i<3;i++){if(object.width/3>5&&object.height/3>5){new Asteroid(this,object.x,object.y,object.width/3,object.height/3)}else{this.gameEngine.removeObject(object)}}},this.setEnemies=function(){let x,y;for(let i=this.world.number_enemies;i>this.world.enemies.size;i--){do{x=Math.floor(Math.random()*this.world.width);y=Math.floor(Math.random()*this.world.height)}while(this.gameEngine.distanceBetweenPoints(this.world.player.x,this.world.player.y,x,y)<this.world.player.width+200);this.world.enemies.add(new Enemy(this,x,y,ENEMY_WIDTH,ENEMY_HEIGHT,Math.round(Math.random()*3)))}},this.setMeteorShower=function(){let x,y;for(let i=Math.round(this.world.asteroids.size/2);i>this.world.meteor_shower.size;i--){do{x=Math.floor(Math.random()*this.world.width);y=Math.floor(Math.random()*this.world.height)}while(this.gameEngine.distanceBetweenPoints(this.world.width/2,this.world.height/2,x,y)<700);this.world.meteor_shower.add(new Meteor(this,x,y))}},this.setPlanets=function(){for(let i=1;i>this.world.planets.size;i--){this.world.planets.add(new Planet(this))}},this.scoreAndObjectHandler=function(object){localStorage.setItem(DSMS_HIGH_SCORES,localStorage.getItem(DSMS_HIGH_SCORES)!==null?localStorage.getItem(DSMS_HIGH_SCORES):0);if(this.world.score>parseInt(localStorage.getItem(DSMS_HIGH_SCORES))){localStorage.setItem(DSMS_HIGH_SCORES,this.world.score)}
      if(object.tag!=='Debris'){if(object.explode_time<=0){switch(object.tag){case "Asteroid":this.world.asteroids.delete(object);this.splitObject(object);this.gameEngine.removeObject(object);this.world.score+=(object.width+object.height)*Math.ceil(this.world.time_keeper/10);this.gameAudio.play(280,0.2,"sine",0.1).stop(0.2);this.gameAudio.play(260,0.2,"sine",0.2).stop(0.3);this.gameAudio.play(200,0.2,"sine",0.4).stop(0.6);break;case "Enemy":this.world.enemies.delete(object);this.gameEngine.removeObject(object);this.world.score+=(object.width+object.height)*Math.ceil(this.world.time_keeper/10);this.gameAudio.play(280,0.2,"sine",0.1).stop(0.2);this.gameAudio.play(260,0.2,"sine",0.2).stop(0.3);this.gameAudio.play(200,0.2,"sine",0.4).stop(0.6);break;case "Laser":this.gameEngine.removeObject(object);break;case "Froggy":this.world.time_trial=0;this.world.froggy=null;this.gameEngine.removeObject(object);break;case "Meteor":this.world.meteor_shower.delete(object);this.gameEngine.removeObject(object);this.world.score+=1000;this.gameAudio.play(580,0.2,"sine",0.1).stop(0.2);this.gameAudio.play(560,0.2,"sine",0.2).stop(0.3);this.gameAudio.play(500,0.2,"sine",0.4).stop(0.6);break;case "Planet":this.splitObject(object);this.gameEngine.removeObject(object);this.world.score-=5000;this.gameAudio.play(780,0.2,"sine",0.1).stop(0.2);this.gameAudio.play(760,0.2,"sine",0.2).stop(0.3);this.gameAudio.play(700,0.2,"sine",0.4).stop(0.6);this.gameAudio.play(680,0.2,"sine",0.7).stop(0.9);this.gameAudio.play(660,0.2,"sine",1.0).stop(1.2);this.gameAudio.play(600,0.2,"sine",1.4).stop(1.6);break;case "Boss":this.world.boss=null;this.world.win=!0;this.gameEngine.removeObject(object);break}}}},this.update=function(){this.world.update();this.gameEngine.update();if(this.world.player!==null){this.setAsteroidBelt();this.setEnemies()}}};Game.prototype={constructor:Game};function getRandomInt(max){return Math.floor(Math.random()*Math.floor(max))}
      const Display=function(canvas,game,controller){this.buffer=document.createElement("canvas").getContext("2d");this.context=canvas.getContext("2d");this.game=game;this.control=controller};Display.prototype={constructor:Display,message_time:0,counter:0,score_message_time:0,current_score:0,stars:[],drawRectangle:function(object){this.buffer.fillStyle=object.color;this.buffer.fillRect(object.x,object.y,object.width,object.height);this.buffer.fillRect(object.x+object.width/6,object.y+object.height,object.width/1.5,object.height/3);this.buffer.fillRect(object.x+object.width/2.5,object.y-object.height/3,object.width/5,object.height/2)},drawTriangle:function(object){this.buffer.strokeStyle=object.color;this.buffer.lineWidth=object.width/7;this.buffer.beginPath();this.buffer.moveTo(object.x+(4/3*object.width)*Math.cos(object.angle),object.y-(4/3*object.height)*Math.sin(object.angle),);this.buffer.lineTo(object.x-object.width*(2/3*Math.cos(object.angle)+Math.sin(object.angle)),object.y+object.height*(2/3*Math.sin(object.angle)-Math.cos(object.angle)),);this.buffer.lineTo(object.x-object.width*(2/3*Math.cos(object.angle)-Math.sin(object.angle)),object.y+object.height*(2/3*Math.sin(object.angle)+Math.cos(object.angle)),);this.buffer.closePath();this.buffer.stroke()},drawPolygon:function(object,filled){if(!filled){this.buffer.strokeStyle=object.color;this.buffer.lineWidth=object.width/7}else{this.buffer.fillStyle=object.color}
      let vertices=object.vertices;let offset=object.offset;this.buffer.beginPath();this.buffer.moveTo(object.x+object.width*offset[0]*Math.cos(object.angle),object.y+object.height*offset[0]*Math.sin(object.angle));for(let i=vertices;i>0;i--){this.buffer.lineTo(object.x+object.width*offset[i]*Math.cos(object.angle+i*Math.PI*2/vertices),object.y+object.height*offset[i]*Math.sin(object.angle+i*Math.PI*2/vertices))}
      this.buffer.closePath();if(!filled){this.buffer.stroke()}else{this.buffer.fill()}},drawCircle:function(object,filled){if(filled){this.buffer.fillStyle=object.color;this.buffer.beginPath();this.buffer.arc(object.x,object.y,object.height,0,Math.PI*2,!1);this.buffer.fill()}else{this.buffer.strokeStyle=object.color;this.buffer.beginPath();this.buffer.arc(object.x,object.y,object.height,0,Math.PI*2,!1);this.buffer.stroke()}},drawBoss:function(object){this.buffer.fillStyle='grey';this.buffer.fillRect(object.x,object.y,object.width,object.height);this.buffer.fillStyle='rgb(169,71,18)';this.buffer.fillRect(object.x+object.width/6,object.y+object.height,object.width/6,object.height/2);this.buffer.fillRect(object.x+((object.width/6)*4),object.y+object.height,object.width/6,object.height/2);this.buffer.fillStyle='pink';this.buffer.fillRect(object.x+((object.width/6)+5),object.y-object.height/3,object.width/2,object.height/1.5);this.buffer.fillStyle='red';this.buffer.fillRect(object.x+object.width/2.5,object.y+object.height/3,object.width/5,object.height/2.5)},fill:function(color){this.buffer.fillStyle=color;this.buffer.fillRect(0,0,this.buffer.canvas.width,this.buffer.canvas.height)},drawInfo:function(fill_style,text_size,text_align,x,y,width,message){this.buffer.fillStyle=fill_style;this.buffer.font="small-caps bold "+text_size+"px Segoe UI";this.buffer.textAlign=text_align;this.buffer.fillText(message,x,y,width)},showGameInfo:function(clock){this.drawInfo("#FFA500",TEXT_SIZE,'left',30,this.game.world.height-65,150,"Time: "+Math.round(this.game.world.time_keeper));this.drawInfo("#FFA500",TEXT_SIZE,'left',30,this.game.world.height-45,150,"Health: "+Math.round(this.game.world.player.health));this.drawInfo("#FFA500",TEXT_SIZE,'left',30,this.game.world.height-25,150,"Score: "+Math.round(this.game.world.score));if(this.game.world.score>this.current_score){this.drawInfo("#65DF3A",TEXT_SIZE,'left',180,this.game.world.height-25,150,"+"+Math.round(this.game.world.score-this.current_score))}
      else if(this.game.world.score<this.current_score){this.drawInfo("#f60a0a",TEXT_SIZE,'left',180,this.game.world.height-25,150,"-"+Math.round(this.game.world.score-this.current_score))}
      if(this.score_message_time===0){this.score_message_time=clock}
      if(clock-this.score_message_time>=1.2){this.current_score=this.game.world.score;this.score_message_time=0}
      if(this.game.world.froggy!==null){if(this.game.world.froggy.following){this.drawInfo("#FFA500",TEXT_SIZE,'left',30,this.game.world.height-90,150,"Time Trial: "+Math.round(this.game.world.time_trial))}
      this.drawInfo("#FFA500",TEXT_SIZE*1.2,'left',30,45,250,"Time Trial Best: "+Math.round(this.game.world.time_trial_high)+" seconds");this.drawInfo("#FFA500",TEXT_SIZE*1.2,'left',30,70,250,"Earn extra points")}},showHighScore:function(){this.drawInfo("#FFA500",TEXT_SIZE*2.5,'center',this.game.world.width/2,50,this.game.world.width,"High Score: "+Math.round(localStorage.getItem(DSMS_HIGH_SCORES)));this.drawInfo("rgba(194,47,3, 0.5)",TEXT_SIZE,'center',this.game.world.width/2,80,this.game.world.width,"Survival Time: "+Math.round(localStorage.getItem(DSMS_TIME_TRIAL)))},showGameOver:function(){this.drawInfo("#e3e3e3",TEXT_SIZE*4,'center',this.game.world.width/2,this.game.world.height/2,this.game.world.width,"GAME OVER");this.drawInfo("rgba(194,47,3, 1)",TEXT_SIZE*2.5,'center',this.game.world.width/2,this.game.world.height/2+100,this.game.world.width,"High Score: "+Math.round(localStorage.getItem(DSMS_HIGH_SCORES)));this.drawInfo("rgba(194,47,3, 1)",TEXT_SIZE,'center',this.game.world.width/2,this.game.world.height/2+200,this.game.world.width,"Survival Time: "+Math.round(localStorage.getItem(DSMS_TIME_TRIAL)))},render:function(){if(this.game.world.start_game){if(!this.control.paused&&!this.game.world.win){let clock=(this.game.spaceEngine.clock/1000);if(this.game.world.player!==null){if(this.game.world.player.health>0){this.counter=0;this.showGameInfo(clock);this.showHighScore();this.drawInfo("#CBCCCE",TEXT_SIZE/2,'right',this.game.world.width-32,this.game.world.height-50,this.game.world.width,"P to PAUSE");this.drawInfo("#CBCCCE",TEXT_SIZE/2,'right',this.game.world.width-32,this.game.world.height-25,this.game.world.width,"BACKSPACE to RESTART");this.drawInfo("#CBCCCE",TEXT_SIZE/2,'right',this.game.world.width-32,this.game.world.height-75,this.game.world.width,"Hold SHIFT to DREAM")}else{this.showGameOver();if(this.counter===0){this.counter=clock}
      this.drawInfo("#e3e3e3",TEXT_SIZE*4,'center',this.game.world.width/2,this.game.world.height/3.5,this.game.world.width,"Continue: "+Math.round(RESPAWN_TIME-(clock-this.counter)))}}
      this.buffer.textAlign='center';for(let[message,object]of this.game.world.messages){if(!this.game.gameEngine.toBeRemoved.has(object)){if(message!==null){if(object instanceof WorldMessage){this.drawInfo(this.getGradient(),TEXT_SIZE*2,'center',object.x,object.y-object.height/2,this.game.world.width,message)}else{this.drawInfo("rgba(142,222,131)",TEXT_SIZE/2,'center',object.x,object.y-object.height/2,300,message)}}
      if(this.message_time===0){this.message_time=clock}
      if(clock-this.message_time>=3){this.game.world.messages.delete(message,object);object.send_message=!1;this.message_time=0}}}
      if(this.game.world.end_game){this.buffer.fillStyle='red';if(this.game.world.boss!==null){this.buffer.fillRect(this.game.world.width/2-this.game.world.boss.health/8,this.game.world.height-50,this.game.world.boss.health/4,20)}}}else if(this.control.paused){if(Math.round(this.game.spaceEngine.clock/1000)%2===1){this.drawInfo("#ffffff",TEXT_SIZE*3,'center',this.game.world.width/2,100,500,"PAUSED")}
      this.drawInfo("#FFA500",TEXT_SIZE*3.5,'center',this.game.world.width/2,225,this.game.world.width,"Time: "+Math.round(this.game.world.time_keeper));this.drawInfo("#FFA500",TEXT_SIZE*3.5,'center',this.game.world.width/2,this.game.world.height/2,this.game.world.width,"Health: "+Math.round(this.game.world.player.health));this.drawInfo("#FFA500",TEXT_SIZE*3.5,'center',this.game.world.width/2,this.game.world.height-225,this.game.world.width,"Score: "+Math.round(this.game.world.score));this.drawInfo("#cbccce",TEXT_SIZE/2,'center',this.game.world.width/2,this.game.world.height-25,300,"Press Escape to Unpause")}else if(this.game.world.win){this.winScreen()}}else{this.startScreen()}
      this.context.drawImage(this.buffer.canvas,0,0,this.buffer.canvas.width,this.buffer.canvas.height,0,0,this.context.canvas.width,this.context.canvas.height)},resize:function(width,height,height_width_ratio){if(height/width>height_width_ratio){this.context.canvas.height=width*height_width_ratio;this.context.canvas.width=width}else{this.context.canvas.height=height;this.context.canvas.width=height/height_width_ratio}
      this.context.imageSmoothingEnabled=!1},getGradient:function(){let gradient=this.buffer.createLinearGradient(0,0,this.game.world.width,this.game.world.height);gradient.addColorStop(0.3,"rgb(194,47,3)");gradient.addColorStop(0.5,"rgb(255,167,0)");gradient.addColorStop(0.7,"rgb(127,191,251)");return gradient},startScreen:function(){this.drawShipAnimation();this.drawInfo("rgba(255,255,255, 0.7)",TEXT_SIZE/2,'center',this.game.world.width/2,this.game.world.height/2+120,this.game.world.width,"A '5 minute break' game. Get focused and energized and then... BACK to work!");this.drawInfo("rgba(255,255,255, 0.2)",TEXT_SIZE/2,'left',32,this.game.world.height-32,this.game.world.width,"David Damian === github.com/wisekrakr");this.drawInfo("#ffffff",TEXT_SIZE,'left',this.game.world.width/2-400,this.game.world.height/2-90,this.game.world.width,"Wisekrakr Games Presents:");this.drawInfo(this.getGradient(),TEXT_SIZE*4,'center',this.game.world.width/2,this.game.world.height/2,this.game.world.width,"Don't Shoot Back");this.drawInfo(this.getGradient(),TEXT_SIZE*2,'center',this.game.world.width/2,this.game.world.height/2+90,this.game.world.width,"A Space Passivist's Saga");if(Math.round(this.game.spaceEngine.clock/1000)%2===1){this.drawInfo("#ffffff",TEXT_SIZE*2,'center',this.game.world.width/2,this.game.world.height-100,500,"Press SPACE to Enter SPACE")}},winScreen:function(){this.drawInfo(this.getGradient(),TEXT_SIZE*4,'center',this.game.world.width/2,this.game.world.height/4,this.game.world.width,"You Win!");this.drawInfo(this.getGradient(),TEXT_SIZE*3,'center',this.game.world.width/2,this.game.world.height/2,this.game.world.width,"Score: "+Math.round(this.game.world.score));this.drawInfo(this.game.colorPicker(["red","white","blue"]),TEXT_SIZE*2,'center',this.game.world.width/2,this.game.world.height-100,this.game.world.width,"Press BACKSPACE to Go BACK to SPACE")},drawShipAnimation:function(){this.buffer.strokeStyle="rgb(255,77,0)";this.buffer.lineWidth=20;this.buffer.beginPath();this.buffer.moveTo((this.game.world.width-200)+(4/3*60)*Math.cos(5),(this.game.world.height-200)-(4/3*60)*Math.sin(5),);this.buffer.lineTo((this.game.world.width-200)-60*(2/3*Math.cos(5)+Math.sin(5)),(this.game.world.height-200)+60*(2/3*Math.sin(5)-Math.cos(5)),);this.buffer.lineTo((this.game.world.width-200)-60*(2/3*Math.cos(5)-Math.sin(5)),(this.game.world.height-200)+60*(2/3*Math.sin(5)+Math.cos(5)),);this.buffer.closePath();this.buffer.stroke();this.buffer.fillStyle=this.game.colorPicker(['rgb(255,0,0)','rgb(255,153,0)','rgb(255,255,102)']);this.buffer.beginPath();for(let i=0;i<5;i++){this.buffer.arc((this.game.world.width-200)-60*(i*0.33),(this.game.world.height-200)-60*i,20,0,i*Math.PI*2,!1)}
      this.buffer.fill();this.buffer.fillStyle=this.game.colorPicker(['rgb(255,0,0)','rgb(255,153,0)','rgb(255,255,102)']);this.buffer.beginPath();for(let i=0;i<5;i++){this.buffer.arc((this.game.world.width-200)-80*(i*0.66),(this.game.world.height-200)-80*i,20,0,i*Math.PI*2,!1)}
      this.buffer.fill();this.buffer.fillStyle=this.game.colorPicker(['rgb(255,0,0)','rgb(255,153,0)','rgb(255,255,102)']);this.buffer.beginPath();for(let i=0;i<5;i++){this.buffer.arc((this.game.world.width-200)-100*(i*0.50),(this.game.world.height-200)-100*i,20,0,i*Math.PI*2,!1)}
      this.buffer.fill()}}
      const Controller=function(game){this.game=game;this.left=new Controller.ButtonInput();this.right=new Controller.ButtonInput();this.up=new Controller.ButtonInput();this.power=new Controller.ButtonInput();this.paused=!1;this.keyDownUp=function(type,key_code){let down=(type=="keydown")?!0:!1;switch(key_code){case 65:case 37:this.left.getInput(down);break;case 87:case 38:this.up.getInput(down);break;case 68:case 39:this.right.getInput(down);break;case 80:if(this.game.world.start_game&&!this.game.world.win){this.paused=!0;this.game.gameAudio.play(700,0.3,"sine").setFrequency(550,0.3).stop(0.8)}
      break;case 27:if(this.game.world.start_game&&!this.game.world.win){this.paused=!1;this.game.gameAudio.play(550,0.3,"sine").setFrequency(700,0.3).stop(0.8)}
      break;case 32:if(!this.game.world.start_game){this.game.world.start_game=!0}
      break;case 8:this.game.world.start_game=!1;this.game.world.win=!1;this.game.world.destroyWorld();break;case 16:this.power.getInput(down);break;default:console.error(key_code+": This key is not yet defined")}}};Controller.prototype={constructor:Controller};Controller.ButtonInput=function(){this.active=this.down=!1};Controller.ButtonInput.prototype={constructor:Controller.ButtonInput,getInput:function(down){if(this.down!=down)this.active=down;this.down=down}}
      const GameAudio=function(audioContext){this.context=audioContext;this.gainNode=null;this.oscillator=null;this.compressor=audioContext.createDynamicsCompressor();this.compressor.connect(audioContext.destination)}
      GameAudio.prototype.setFrequency=function(val,when){if(when){this.oscillator.frequency.setValueAtTime(val,this.context.currentTime+when)}else{this.oscillator.frequency.setValueAtTime(val,this.context.currentTime)}
      return this};GameAudio.prototype.setVolume=function(val,when){if(when){this.gainNode.gain.exponentialRampToValueAtTime(val,this.context.currentTime+when)}else{this.gainNode.gain.setValueAtTime(val,this.context.currentTime)}
      return this};GameAudio.prototype.setWaveType=function(waveType){this.oscillator.type=waveType;return this};GameAudio.prototype.play=function(freq,vol,wave,when){this.oscillator=this.context.createOscillator();this.oscillator.connect(this.compressor);this.gainNode=this.context.createGain();this.gainNode.connect(this.compressor);this.setFrequency(freq);if(wave){this.setWaveType(wave)}
      this.setVolume(1/1000);if(when){this.setVolume(1/1000,when-0.02);this.oscillator.start(when-0.02);this.setVolume(vol,when)}else{this.oscillator.start();this.setVolume(vol,0.02)}
      return this},GameAudio.prototype.stop=function(when){this.gainNode.connect(this.compressor);if(when){this.gainNode.gain.setTargetAtTime(1/1000,this.context.currentTime+when-0.05,0.02);this.oscillator.stop(this.context.currentTime+when)}else{this.gainNode.gain.setTargetAtTime(1/1000,this.context.currentTime,0.02);this.oscillator.stop(this.context.currentTime+0.05)}
      return this}
      const GameEngine=function(){}
      GameEngine.prototype={constructor:GameEngine,gameObjects:new Set(),toBeRemoved:new Set(),addObject:function(object){this.gameObjects.add(object,object.tag_nr)},removeObject:function(object){this.gameObjects.delete(object,object.tag_nr);this.toBeRemoved.add(object,object.tag_nr)},distanceBetweenObjects:function(object1,object2){let attackDistanceX=object1.x-object2.x;let attackDistanceY=object1.y-object2.y;return Math.hypot(attackDistanceX,attackDistanceY)},distanceBetweenPoints:function(x1,y1,x2,y2){return Math.sqrt(Math.pow(x2-x1,2)+Math.pow(y2-y1,2))},angleBetweenObjects:function(object1,object2){let attackDistanceX=object1.x-object2.x;let attackDistanceY=object1.y-object2.y;return Math.atan2(attackDistanceY,attackDistanceX)},explode:function(object,game,bits){if(object!==null&&object.explode_time>0){let debrisParts=[];for(let i=debrisParts.length;i<bits;i++){debrisParts[i]=new Debris(game,object.x,object.y,object.width/i+1,object.height/i+1,object.color)}
      object.explode_time--}},collision:function(object){for(let sub of this.gameObjects){if(sub!==object&&sub.tag!=='Debris'){if(this.distanceBetweenObjects(object,sub)<object.height+sub.height||this.distanceBetweenObjects(object,sub)<object.width+sub.width){return!0}else{return!1}}}},collisionObject:function(object){let collisionObject;for(let sub of this.gameObjects){if(sub!==object&&sub.tag!=='Debris'){if(this.distanceBetweenPoints(object.x,object.y,sub.x,sub.y)<object.width+sub.width&&object.height+sub.height){collisionObject=sub}}}
      return collisionObject},subtractFromLive:function(object){let damage=(object.collided_with.width+object.collided_with.height)/2;object.health-=damage},update:function(){for(let object of this.gameObjects){object.update()}}}
      const World=function(game){this.tag="World";this.fps=FPS;this.background_color="#000000"
      this.friction=0.9;this.width=WIDTH;this.height=HEIGHT;this.time_keeper=0;this.death_time=0;this.score=0;this.time_trial=0;this.time_trial_high=0;this.counter=0;this.number_asteroids=ASTEROID_NUMBER;this.number_enemies=ENEMY_NUMBER;this.player=new Player(game,this.width/2,this.height/2);this.asteroids=new Set();this.enemies=new Set();this.meteor_shower=new Set();this.planets=new Set();this.let_it_rain=!1;this.planet=!1;this.froggy=null;this.boss=null;this.messages=new Map();this.worldMessage=new WorldMessage(this);this.game=game;this.start_game=!1;this.end_game=!1;this.win=!1}
      World.prototype={constructor:World,distance:0,changePerspective:function(object){let new_distance=this.game.gameEngine.distanceBetweenPoints(object.x,object.y,this.width/2,this.height/2);if(new_distance>this.distance){let diff=new_distance-this.distance;if(object.width>=object.init_width/2&&object.height>=object.init_height/2){object.width-=(diff/5000)*(this.fps/10);object.height-=(diff/5000)*(this.fps/10)}
      this.distance=new_distance}else{let diff=this.distance-new_distance;if(object.width<=object.init_width&&object.height<=object.init_height){object.width+=(diff/5000)*(this.fps/10);object.height+=(diff/5000)*(this.fps/10)}
      this.distance=new_distance}},outOfBounds:function(object){if(object.x<0-object.width){object.x=this.width+object.width}else if(object.x>this.width+object.width){object.x=0-object.width}
      if(object.y<0-object.height){object.y=this.height+object.height}else if(object.y>this.height+object.height){object.y=0-object.height}},messenger:function(message,object){this.messages.set(message,object);object.send_message=!0},levelProgression:function(){localStorage.setItem(DSMS_TIME_TRIAL,localStorage.getItem(DSMS_TIME_TRIAL)!==null?localStorage.getItem(DSMS_TIME_TRIAL):0);if(this.time_keeper>parseInt(localStorage.getItem(DSMS_TIME_TRIAL))){localStorage.setItem(DSMS_TIME_TRIAL,this.time_keeper)}
      switch(Math.round(this.time_keeper)){case 1:case 4:newGameSound(this.game.gameAudio);this.messenger("W,A,D or Arrows to move, DODGE the ASTEROIDS",this.worldMessage);break;case 8:case 11:this.messenger("ENEMIES destroy ASTEROIDS, and VICE VERSA",this.worldMessage);break;case 17:case 20:this.messenger("SURVIVE for 300 seconds and get the Highest Score",this.worldMessage);break;case 30:this.let_it_rain=!0;this.messenger("Protect the Planet from falling Asteroids",this.worldMessage);newStageSound(this.game.gameAudio);break;case 70:this.let_it_rain=!1;if(this.froggy===null){this.froggy=new Froggy(this.game,0,Math.random()*this.height);this.messenger("Time Trail: A New Escort Mission!",this.worldMessage);newStageSound(this.game.gameAudio)}
      break;case 120:this.number_enemies=ENEMY_NUMBER*2;break;case 130:if(this.froggy===null){this.froggy=new Froggy(this.game,0,Math.random()*this.height);this.messenger("Time Trail: Escort Mission Strikes Again!",this.worldMessage);newStageSound(this.game.gameAudio)}
      break;case 180:this.number_asteroids=ASTEROID_NUMBER*2;this.let_it_rain=!0;this.messenger("Protect the Planet from falling Asteroids",this.worldMessage);newStageSound(this.game.gameAudio);break;case 215:this.let_it_rain=!1;break;case 220:if(this.froggy===null){this.froggy=new Froggy(this.game,0,Math.random()*this.height);this.messenger("Time Trail: Return of the Escort Mission!",this.worldMessage);newStageSound(this.game.gameAudio)}
      break;case 260:this.number_asteroids=ASTEROID_NUMBER*3;this.number_enemies=ENEMY_NUMBER*3;break;case 300:this.end_game=!0;newStageSound(this.game.gameAudio);break}},update:function(){if(!this.win&&this.start_game){if(this.player===null){this.player=new Player(this.game,this.width/2,this.height/2);this.score=0}else{let delta=this.game.spaceEngine.delta/1000;let clock=this.game.spaceEngine.clock/1000;this.time_keeper+=delta;if(this.player.health<=0){this.game.gameEngine.removeObject(this.player);if(this.death_time===0){this.death_time=clock;this.game.gameAudio.play(750,0.1,"triangle").stop(0.3);this.game.gameAudio.play(500,0.1,"triangle",0.3).stop(0.6);this.game.gameAudio.play(380,0.1,"triangle",0.6).stop(0.9);this.game.gameAudio.play(210,0.1,"triangle",0.9).stop(1.2)}
      if(clock-this.death_time>=RESPAWN_TIME){this.destroyWorld()}}else{this.levelProgression();if(this.let_it_rain){this.game.setPlanets();if(this.counter===0){this.counter=clock}
      if(clock-this.counter>=RESPAWN_TIME){this.game.setMeteorShower();this.counter=0}}else{for(let met of this.meteor_shower){this.game.gameEngine.removeObject(met)}
      this.meteor_shower.clear();for(let planet of this.planets){let distance=this.game.gameEngine.distanceBetweenPoints(planet.x,planet.y,this.width,this.height/2);if(distance>10){planet.x+=planet.speed}else{this.planets.clear();this.game.gameEngine.removeObject(planet)}}}
      if(this.froggy!==null){if(this.froggy.following){this.time_trial+=1/this.fps}else{if(this.time_trial>0){this.score+=this.time_trial*10;if(this.time_trial>this.time_trial_high){this.time_trial_high=this.time_trial}
      this.time_trial=0}}}
      if(this.end_game){for(let e of this.enemies){this.game.gameEngine.removeObject(e)}
      this.enemies.clear();this.number_enemies=0;if(this.boss===null){this.boss=new Boss(this.game,0,0,60,35);this.messenger("The Boss of Space!",this.worldMessage)}}
      for(let object of this.game.gameEngine.gameObjects){this.outOfBounds(object);this.game.scoreAndObjectHandler(object);this.changePerspective(object)}}}}else{this.destroyWorld()}
      if(this.win){this.game.gameAudio.play(327.3,0.1,"sine",0.2).setFrequency(589.3,0.4).stop(1.6);this.game.gameAudio.play(327.3,0.1,"sine",0.6).setFrequency(489.3,0.8).stop(1.0);this.game.gameAudio.play(327.3,0.1,"sine",1.0).setFrequency(589.3,1.2).stop(1.4);this.game.gameAudio.play(689.3,0.1,"sine ",1.6).setFrequency(527.3,1.8).stop(2.0);this.game.gameAudio.play(689.3,0.1,"sine ",2.2).stop(2.4)}},destroyWorld:function(){for(let object of this.game.gameEngine.gameObjects){this.game.gameEngine.removeObject(object)}
      this.player=null;this.number_asteroids=ASTEROID_NUMBER;this.number_enemies=ENEMY_NUMBER;this.enemies.clear();this.asteroids.clear();this.meteor_shower.clear();this.planets.clear();this.froggy=null;this.boss=null;this.time_keeper=0;this.death_time=0;this.counter=0;this.time_trial=0;this.let_it_rain=!1;this.end_game=!1;this.win=!1;another_timer=Math.ceil(0.12*60)},};let timer=Math.ceil(0.12*60);function newStageSound(gameAudio){timer--;if(timer>0){gameAudio.play(587.3,0.1,"sine").stop(0.25);gameAudio.play(587.3,0.1,"sine",0.3).stop(0.35);gameAudio.play(659.3,0.1,"sine",0.4).stop(0.55);gameAudio.play(587.3,0.1,"sine",0.6).stop(0.75);gameAudio.play(784.0,0.1,"sine",0.8).stop(0.95);gameAudio.play(740.0,0.1,"sine",1.0).stop(1.40);timer=0}};let another_timer=Math.ceil(0.12*60);function newGameSound(gameAudio){another_timer--;if(another_timer>0){gameAudio.play(527.3,0.1,"triangle").setFrequency(689.3,0.2).stop(0.4);gameAudio.play(527.3,0.1,"triangle",0.4).setFrequency(689.3,0.2).stop(0.8);gameAudio.play(689.3,0.1,"triangle",0.8).setFrequency(527.3,1.0).stop(1.2);gameAudio.play(527.3,0.1,"triangle",1.2).setFrequency(689.3,1.4).stop(1.6);gameAudio.play(527.3,0.1,"triangle",1.6).setFrequency(689.3,1.8).stop(2.0);gameAudio.play(689.3,0.1,"triangle",2.0).setFrequency(527.3,2.2).stop(2.4);another_timer=0}};const WorldMessage=function(world){this.width=world.width/2;this.height=world.height/2;this.x=world.width/2;this.y=world.height/2};WorldMessage.prototype={constructor:WorldMessage,}
      const Asteroid=function(game,x,y,w,h){this.tag="Asteroid";this.tag_nr=Math.random();this.color="rgba(255,255,255,0.3)";this.width=w;this.height=h;this.init_width=w;this.init_height=h;this.velocity_x=Math.random()*AS_SPEED/FPS*(Math.random()<0.5?1:-1);this.velocity_y=Math.random()*AS_SPEED/FPS*(Math.random()<0.5?1:-1);this.angle=Math.random()*Math.PI*2;this.speed=AS_SPEED;this.rotate_speed=Math.random()*AS_ROTATE_SPEED;this.x=x;this.y=y;this.vertices=Math.floor(Math.random()*(VERTICES+1)+VERTICES/2);this.offset=[];this.game=game;this.game.gameEngine.addObject(this);for(let i=0;i<this.vertices;i++){this.offset.push(Math.random()*AS_RIDGE*2+1-AS_RIDGE)}};Asteroid.prototype={constructor:Asteroid,explode_time:EXPLODE_TIME,collided_with:null,collide:function(){if(this.game.gameEngine.collisionObject(this)instanceof Enemy||this.game.gameEngine.collisionObject(this)instanceof Player||this.game.gameEngine.collisionObject(this)instanceof Laser||this.game.gameEngine.collisionObject(this)instanceof Boss){this.collided_with=this.game.gameEngine.collisionObject(this);return!0}
      return!1},update:function(){if(this.collide()){this.game.gameEngine.explode(this,this.game,3)}else{this.x+=this.velocity_x;this.y+=this.velocity_y}
      this.angle+=this.rotate_speed/this.game.world.fps},}
      const Boss=function(game,x,y,w,h){this.tag="Boss";this.tag_nr=Math.random();this.color="#657a87";this.width=w;this.height=h;this.init_width=w;this.init_height=h;this.velocity_x=(ENEMY_SPEED*6)/FPS;this.velocity_y=(ENEMY_SPEED*6)/FPS;this.x=x;this.y=y;this.angle=0;this.game=game;this.game.gameEngine.addObject(this)};Boss.prototype={constructor:Boss,explode_time:EXPLODE_TIME,last_movement:0,my_messages:["Space Boss!","My name is Zeep Xanflorp, you killed my father, prepare to die","Call me The Micro-Manager","0010011001110011111","I'm missing golf for this?!?!","Oy Oy OY OY","I've no idea what I'm talking about","I bought these engines with my bonus"],send_message:!1,health:2000,behavior:function(){for(let target of this.game.gameEngine.gameObjects){if(target instanceof Player){if(this.target!==null){if(this.game.gameEngine.distanceBetweenObjects(this,target)<1000){this.angle=this.game.gameEngine.angleBetweenObjects(this,target)}}}}},erratic:function(){let time=this.game.spaceEngine.clock/1000;if(this.last_movement===0){this.last_movement=time}
      if(time-this.last_movement>=0.04*FPS){this.game.gameAudio.play(440,0.1,"sine").stop(0.1);this.game.gameAudio.play(523.25,0.25,"sine",0.1).stop(0.2);this.game.gameAudio.play(698.46,0.3,"sine",0.2).stop(0.3);this.behavior();this.last_movement=time}},collide:function(){if(this.game.gameEngine.collisionObject(this)instanceof Asteroid){return!0}
      return!1},update:function(){this.x-=this.velocity_x*Math.cos(this.angle);this.y-=this.velocity_y*Math.sin(this.angle);if(!this.collide()){this.erratic();if(!this.send_message){this.game.world.messenger(this.my_messages[Math.floor(Math.random()*this.my_messages.length)],this)}}else{this.health-=5}
      if(this.health<=0){this.game.gameEngine.explode(this,this.game,6)}},}
      const Debris=function(game,x,y,w,h,color){this.tag="Debris";this.color=color;this.width=w;this.height=h;this.init_width=w;this.init_height=h;this.velocity_x=Math.random()*60/FPS;this.velocity_y=Math.random()*60/FPS;this.x=x;this.y=y;this.angle=Math.random()*180/Math.PI;this.lifeTime=0.8*FPS;this.game=game;this.game.gameEngine.addObject(this)};Debris.prototype={constructor:Debris,update:function(){this.x+=this.velocity_x*Math.cos(this.angle);this.y+=this.velocity_y*Math.sin(this.angle);if(this.lifeTime>0){this.lifeTime--}else{this.game.gameEngine.removeObject(this)}},}
      const Enemy=function(game,x,y,w,h,mark){this.tag="Enemy";this.mark=mark;this.tag_nr=Math.random();this.color=game.colorPicker(["#e03e69","#20b3a2","#657a87","#935f7b","#b5c68a"]);this.width=w;this.height=h;this.init_width=w;this.init_height=h;this.velocity_x=Math.random()*ENEMY_SPEED/FPS;this.velocity_y=Math.random()*ENEMY_SPEED/FPS;this.x=x;this.y=y;this.angle=0;this.game=game;this.game.gameEngine.addObject(this)};Enemy.prototype={constructor:Enemy,explode_time:EXPLODE_TIME,can_shoot:!1,last_shot:0,my_messages:["I will shoot you!","come BACK here!","bleep blorp zorg","shinde kudasai","amaré tu muerte","Where's your Multipass","By Grabthar’s hammer","...I've seen things...","weehoo!","To infinity and beyond","dodge this","js13kGames made me do it!","don't get cocky","do a barrel role","You may call me Hal"],send_message:!1,behavior:function(attack_range){for(let target of this.game.gameEngine.gameObjects){if(target instanceof Player){if(this.target!==null){if(this.game.gameEngine.distanceBetweenObjects(this,target)<attack_range&&this.game.gameEngine.distanceBetweenObjects(this,target)>target.width*2){this.angle=this.game.gameEngine.angleBetweenObjects(this,target);this.can_shoot=!0}else{this.can_shoot=!1}}}else if(target instanceof Asteroid){if(this.target!==null){if(this.game.gameEngine.distanceBetweenObjects(this,target)<(this.width+target.width)+20){this.angle=-this.game.gameEngine.angleBetweenObjects(this,target)}}}}},shootLaser:function(fire_rate){let time=this.game.spaceEngine.clock/1000;if(this.last_shot===0){this.last_shot=time}
      if(this.can_shoot){if(time-this.last_shot>=fire_rate){new Laser(this.game,this.x+this.width/4*Math.cos(this.angle),this.y+this.height*Math.sin(this.angle),this.angle,this);this.last_shot=time;this.game.gameAudio.play(200,0.1,"square").stop(0.1);this.game.gameAudio.play(350,0.1,"square",0.1).stop(0.2)}}},collide:function(){if(this.game.gameEngine.collisionObject(this)instanceof Asteroid||this.game.gameEngine.collisionObject(this)instanceof Player||this.game.gameEngine.collisionObject(this)instanceof Meteor){return!0}
      return!1},update:function(){if(!this.collide()){this.x-=this.velocity_x*Math.cos(this.angle);this.y-=this.velocity_y*Math.sin(this.angle);switch(this.mark){case 1:this.behavior(ENEMY_RANGE/2);this.shootLaser(FIRE_RATE*2);break;case 2:this.behavior(ENEMY_RANGE);this.shootLaser(FIRE_RATE);break;case 3:this.behavior(ENEMY_RANGE*2);this.shootLaser(FIRE_RATE/2);break}
      if(this.can_shoot){if(!this.send_message){this.game.world.messenger(this.my_messages[Math.floor(Math.random()*this.my_messages.length)],this)}}}else{this.game.gameEngine.explode(this,this.game,2)}},}
      const Froggy=function(game,x,y){this.tag="Froggy";this.tag_nr=Math.random();this.color="#ffffff";this.width=PLAYER_WIDTH;this.height=PLAYER_HEIGHT;this.init_width=PLAYER_WIDTH;this.init_height=PLAYER_HEIGHT;this.velocity_x=ENEMY_SPEED/FPS;this.velocity_y=ENEMY_SPEED/FPS;this.x=x;this.y=y;this.angle=0;this.rotation=0;this.game=game;this.game.gameEngine.addObject(this)};Froggy.prototype={constructor:Froggy,collided_with:null,explode_time:EXPLODE_TIME,my_messages:[fail=["they got me!","you failed me!","why??!?!?!?!","tell my wife that I....","blurghhh"],win=["thank you kind person","you're doing it!","i'm happy now","what a wonderful day","you're the best around..."]],send_message:!1,following:!1,collide:function(){if(this.following){if(this.game.gameEngine.collisionObject(this)instanceof Laser||this.game.gameEngine.collisionObject(this)instanceof Asteroid){this.collided_with=this.game.gameEngine.collisionObject(this);return!0}}
      return!1},behavior:function(){for(let target of this.game.gameEngine.gameObjects){if(target instanceof Player){if(this.target!==null){if(this.game.gameEngine.distanceBetweenObjects(this,target)<250){this.angle=this.game.gameEngine.angleBetweenObjects(this,target);this.following=!0;if(this.game.gameEngine.distanceBetweenObjects(this,target)<target.width*3){this.x+=this.velocity_x*Math.cos(-this.angle);this.y+=this.velocity_y*Math.sin(-this.angle)}}else{this.following=!1;this.game.world.messenger("HELP ME!",this)}}}else if(target instanceof Enemy){if(this.target!==null){if(this.game.gameEngine.distanceBetweenObjects(this,target)<(this.width+target.width)+20){this.angle=-this.game.gameEngine.angleBetweenObjects(this,target)}}}}},update:function(){this.x-=this.velocity_x*Math.cos(this.angle);this.y-=this.velocity_y*Math.sin(this.angle);if(this.collide()){if(this.collided_with instanceof Asteroid||this.collided_with instanceof Laser){if(!this.send_message){this.game.world.messenger(this.my_messages[0][Math.floor(Math.random()*this.my_messages[0].length)],this)}
      this.game.gameEngine.explode(this,this.game,2)}}else{this.behavior();switch(Math.round(this.game.world.time_trial)){case 15:case 28:case 42:case 66:case 99:if(!this.send_message){this.game.world.messenger(this.my_messages[1][Math.floor(Math.random()*this.my_messages[1].length)],this)}
      break}}},}
      const Laser=function(game,x,y,a,parent){this.tag="Laser";this.tag_nr=Math.random();this.color="rgb(255,165,0)";this.width=LASER_WIDTH;this.height=LASER_HEIGHT;this.init_width=LASER_WIDTH;this.init_height=LASER_HEIGHT;this.velocity_x=LASER_SPEED/FPS;this.velocity_y=LASER_SPEED/FPS;this.angle=a;this.x=x;this.y=y;this.lifeTime=1.3*FPS;this.parent=parent;this.game=game;this.game.gameEngine.addObject(this)};Laser.prototype={constructor:Laser,collide:function(){if(this.game.gameEngine.collisionObject(this)instanceof Asteroid||this.game.gameEngine.collisionObject(this)instanceof Player){return!0}
      return!1},update:function(){this.color=this.game.colorPicker(["rgb(255,165,0)","rgb(255,215,0)","rgb(237,26,38)"]);if(this.collide()){this.game.gameEngine.explode(this,this.game,2)}else{this.x-=this.velocity_x*Math.cos(this.angle);this.y-=this.velocity_y*Math.sin(this.angle);if(this.lifeTime>0){this.lifeTime--}else{this.game.gameEngine.removeObject(this)}}},}
      const Meteor=function(game,x,y){this.tag="Meteor";this.tag_nr=Math.random();this.color="rgb(180,230,245,0.6)";this.width=AS_WIDTH/2.5;this.height=AS_HEIGHT/2.5;this.init_width=AS_WIDTH/2.5;this.init_height=AS_HEIGHT/2.5;this.velocity_x=Math.random()*(AS_SPEED*2)/FPS;this.velocity_y=Math.random()*(AS_SPEED*2)/FPS;this.angle=Math.random();this.speed=AS_SPEED*2;this.x=x;this.y=y;this.vertices=Math.floor(Math.random()*(VERTICES+1)+VERTICES/2);this.offset=[];this.game=game;this.game.gameEngine.addObject(this);for(let i=0;i<this.vertices;i++){this.offset.push(Math.random()*AS_RIDGE*2+1-AS_RIDGE)}};Meteor.prototype={constructor:Meteor,collided_with:null,send_message:!1,explode_time:EXPLODE_TIME,my_messages:["Got em","Yup","Cya","No more","ya busted","too fast","splat","zzzzip","whack","pow!"],collide:function(){if(this.game.gameEngine.collisionObject(this)instanceof Enemy||this.game.gameEngine.collisionObject(this)instanceof Player||this.game.gameEngine.collisionObject(this)instanceof Laser||this.game.gameEngine.collisionObject(this)instanceof Planet){this.collided_with=this.game.gameEngine.collisionObject(this);return!0}
      return!1},behavior:function(){for(let target of this.game.gameEngine.gameObjects){if(target instanceof Planet){if(this.target!==null){if(this.game.gameEngine.distanceBetweenObjects(this,target)<800){this.angle=this.game.gameEngine.angleBetweenObjects(this,target)}}}}},update:function(){this.behavior();if(this.collide()){if(this.collided_with instanceof Planet){this.game.gameEngine.explode(this,this.game,2);this.game.world.score-=20}else if(this.collided_with instanceof Player){this.game.gameEngine.explode(this,this.game,2);this.velocity_x=0;this.velocity_y=0;if(!this.send_message){this.game.world.messenger(this.my_messages[Math.floor(Math.random()*this.my_messages.length)],this)}}}else{this.x-=this.velocity_x*Math.cos(this.angle);this.y-=this.velocity_y*Math.sin(this.angle);this.color=this.game.colorPicker(["rgba(221,51,9, 0.7)","rgba(227,158,3, 0.7)","rgba(225,231,5, 0.7)","rgba(200,250,189, 0.7)"])}},}
      const Planet=function(game){this.tag="Planet";this.tag_nr=Math.random();this.color="#000000";this.width=AS_WIDTH*2;this.height=AS_HEIGHT*2;this.init_width=AS_WIDTH*2;this.init_height=AS_HEIGHT*2;this.x=0;this.y=HEIGHT/2;this.angle=0;this.speed=100/FPS;this.velocity_x=100/FPS;this.velocity_y=0;this.health=800;this.game=game;this.game.gameEngine.addObject(this);this.color=this.game.colorPicker(["#a2eeec","#b8c7ff","#f9b5c6","#f9e796","#fdd8c4"])};Planet.prototype={constructor:Planet,collided_with:null,send_message:!1,explode_time:EXPLODE_TIME*2,my_messages:[fail=["ow this hurts","why? Flubelie! WHY?!?!","awww too bad"],win=["our world thanks you","hail to our champion","you're so sexy!"]],blink_time:Math.ceil(BLINK_TIME*FPS),hit:!1,collide:function(){if(this.game.gameEngine.collisionObject(this)instanceof Meteor){this.collided_with=this.game.gameEngine.collisionObject(this);return!0}
      return!1},blinking:function(){if(this.hit){this.blink_time--;this.color=this.game.colorPicker(["#a2eeec","#b8c7ff","#f9b5c6","#f9e796","#fdd8c4"]);if(this.blink_time===0){this.blink_time=Math.ceil(BLINK_TIME*FPS);this.hit=!1}}},update:function(){if(this.health<=0){this.game.gameEngine.explode(this,this.game,5);this.game.world.let_it_rain=!1}else{let distance=this.game.gameEngine.distanceBetweenPoints(this.x,this.y,this.game.world.width/2,this.game.world.height/2);if(distance>10){this.x+=this.velocity_x}
      if(this.collide()){if(!this.send_message){this.game.world.messenger(this.my_messages[0][Math.floor(Math.random()*this.my_messages[0].length)]+" -80",this)}
      this.game.gameEngine.subtractFromLive(this);this.hit=!0}
      this.blinking()}}}
      const Player=function(game,x,y){this.tag="Player";this.tag_nr=Math.random();this.color="rgb(255,77,0)";this.width=PLAYER_WIDTH;this.height=PLAYER_HEIGHT;this.init_width=PLAYER_WIDTH;this.init_height=PLAYER_HEIGHT;this.x=x;this.y=y;this.angle=0;this.speed=PLAYER_SPEED;this.rotate_speed=PLAYER_ROTATE_SPEED;this.rotation=90/180*Math.PI;this.velocity_x=0;this.velocity_y=0;this.health=100;this.acc=!1;this.invul=!1;this.audio=new AudioContext();this.game=game;this.game.gameEngine.addObject(this)};Player.prototype={constructor:Player,explode_time:EXPLODE_TIME,blink_time:Math.ceil(BLINK_TIME*FPS),invul_colors:['rgb(0,255,255)','rgb(218,165,32)'],collided_with:null,my_messages:[],send_message:!1,forward:function(){this.acc=!0},moveLeft:function(){this.rotation=this.rotate_speed/180*Math.PI/this.game.world.fps},moveRight:function(){this.rotation=-this.rotate_speed/180*Math.PI/this.game.world.fps},collide:function(){if(!this.invul){if(this.game.gameEngine.collisionObject(this)instanceof Asteroid||this.game.gameEngine.collisionObject(this)instanceof Enemy||this.game.gameEngine.collisionObject(this)instanceof Laser||this.game.gameEngine.collisionObject(this)instanceof Boss){this.collided_with=this.game.gameEngine.collisionObject(this);return!0}}
      return!1},invulnerable:function(){if(this.invul){this.blink_time--;this.color=this.game.colorPicker(this.invul_colors);if(this.blink_time===0){this.color="rgb(255,77,0)";this.blink_time=Math.ceil(BLINK_TIME*FPS);this.invul=!1}}},boosting:function(){let debrisParts=[];for(let i=debrisParts.length;i<2;i++){debrisParts[i]=new Debris(this.game,this.x-this.width*Math.cos(-this.angle),this.y+this.height*Math.sin(this.angle),(this.width/3)/i+1,(this.height/3)/i+1,this.game.colorPicker(['rgb(255,0,0)','rgb(255,153,0)','rgb(255,255,102)']))}},update:function(){if(this.health>0){if(!this.collide()){this.angle+=this.rotation*=this.game.world.friction;if(this.acc){this.velocity_x+=this.speed*Math.cos(this.angle)/this.game.world.fps;this.velocity_y+=this.speed*Math.sin(this.angle)/this.game.world.fps;this.boosting();this.acc=!1}else{this.velocity_x-=this.game.world.friction*this.velocity_x/this.game.world.fps;this.velocity_y-=this.game.world.friction*this.velocity_y/this.game.world.fps}
      this.x+=this.velocity_x;this.y-=this.velocity_y}else{this.velocity_x=0;this.velocity_y=0;this.game.gameEngine.subtractFromLive(this);this.game.gameEngine.explode(this,this.game,5);this.invul=!0}
      this.invulnerable()}}}
    </script>
  

</body>

</html>
