import{m as t,e}from"./vendor.8f8e4986.js";let i=0,n=0;function s(t){var e;i=t,n=+(null!=(e=localStorage.getItem("jacksonfrankland.js13k2021.score"))?e:0),i>n&&(n=i,localStorage.setItem("jacksonfrankland.js13k2021.score",`${i}`)),document.querySelector("#score").innerHTML=`High Score: ${n} <br /> Score: ${i}`}class o{constructor(t,e){this.x=t,this.y=e}add(t,e){let i=t instanceof o?t:new o(t,null!=e?e:0);return new o(this.x+i.x,this.y+i.y)}subtract(t,e){let i=t instanceof o?t:new o(t,null!=e?e:0);return new o(this.x-i.x,this.y-i.y)}scaleBy(t){return new o(this.x*t,this.y*t)}max(t){if(this.magnitudeSquared<t*t)return this;let e=this.magnitude;return new o(this.x/e*t,this.y/e*t)}clamp(t,e){let i=this.copy;return i.x<t.x&&i.x<e.x&&(i.x=Math.min(t.x,e.x)),i.x>t.x&&i.x>e.x&&(i.x=Math.max(t.x,e.x)),i.y<t.y&&i.y<e.y&&(i.y=Math.min(t.y,e.y)),i.y>t.y&&i.y>e.y&&(i.y=Math.max(t.y,e.y)),i}get magnitudeSquared(){return this.x*this.x+this.y*this.y}get magnitude(){return Math.sqrt(this.magnitudeSquared)}get copy(){return new o(this.x,this.y)}get angle(){return Math.PI/2-Math.atan2(-1*this.y,this.x)}static fromAngle(t){let e=-1*t+Math.PI/2;return new o(Math.cos(e),-1*Math.sin(e))}}function r(t,e){return new o(t,e)}class a{constructor(t=r(0,0),e=r(0,0)){this.velocity=t,this.acceleration=e}addForce(t,e){let i=t instanceof o?t:new o(t,null!=e?e:0);this.acceleration=this.acceleration.add(i)}}class h{constructor(t=r(0,0)){this.position=t}get unit(){return h.unit()}static unit(){return Math.floor(Math.min(window.innerWidth,window.innerHeight)/10)}static screenWidth(){return window.innerWidth/h.unit()}static screenHeight(){return window.innerHeight/h.unit()}get left(){return this.position.x-h.screenWidth()/2}get right(){return this.position.x+h.screenWidth()/2}get top(){return this.position.y-h.screenHeight()/2}get bottom(){return this.position.y+h.screenHeight()/2}screenPosition(t){return t.scaleBy(this.unit).subtract(this.position.scaleBy(this.unit)).add(window.innerWidth/2,window.innerHeight/2)}worldPosition(t){return t.scaleBy(1/this.unit).add(this.position).subtract(window.innerWidth/2/this.unit,window.innerHeight/2/this.unit)}}class c{constructor(t=r(0,0),e=0){this.position=t,this.rotation=e}}class l{constructor(t=1){this.value=t}}class d{}class w{constructor(t=1e3){this.totalLife=t,this.timeLeft=t}}class g{constructor(t,e,i=!0){this.interval=t,this.generateComponents=e,this.enabled=i,this.tillNextSpawn=t}}class u{constructor(t="#ffffff",e=1){this.color=t,this.size=e}}class y{}class x{constructor(t=5,e=1e3){this.position=t,this.buildUp=e,this.time=0,this.spawnedCrystal=!1}}let m=new Map;function p(t){return new Promise((e=>{let i=new Image;addEventListener("load",(()=>{m.set(t,i),e(!0)}),!1),i.src=t}))}function f(t,i,n,s,o=0){var r;if(m.has(i)&&(null==(r=m.get(i))?void 0:r.complete)){let r;e.select(h).iterate((t=>r=t.get(h)));let a=r.unit,c=r.screenPosition(n);t.save(),t.translate(c.x,c.y),t.rotate(o),t.drawImage(m.get(i),s.x*a/-2,-1*s.y*a,s.x*a,s.y*a),t.restore()}}var v,P;(P=v||(v={}))[P.NOT_PLAYINNG=0]="NOT_PLAYINNG",P[P.PLAYING=1]="PLAYING",P[P.DYING=2]="DYING";const M={state:0,started:!1,controlsEnabled:!0};let S,N=b("#starfield"),I=b("#particles"),H=b("#rocket"),L=b("#sun"),A=b("#ui");function b(t){const e=document.querySelector(t);let i=e.getBoundingClientRect();e.width=i.width*devicePixelRatio,e.height=i.height*devicePixelRatio;let n=e.getContext("2d");return n.scale(devicePixelRatio,devicePixelRatio),e.style.width=i.width+"px",e.style.height=i.height+"px",window.addEventListener("resize",(()=>{let t=document.querySelector("#app").getBoundingClientRect();e.width=t.width*devicePixelRatio,e.height=t.height*devicePixelRatio,n.scale(devicePixelRatio,devicePixelRatio),e.style.width=t.width+"px",e.style.height=t.height+"px"})),n}s(0),e.register(h,a,c,class{constructor(t=1){this.size=t}},y,l,w,g,u,x,d),e.process(new class{constructor(){this.camera=e.create(),this.camera.add(new h(r(5,5)))}update(t){}},new class{constructor(){this.selector=e.select(a,c),this.maxSpeedSelector=e.select(a,l)}update(t){this.selector.iterate((e=>{let i=e.get(a),n=e.get(c);i.velocity=i.velocity.add(i.acceleration),n.position=n.position.add(i.velocity.scaleBy(t)),i.acceleration=r(0,0)})),this.maxSpeedSelector.iterate((t=>{let e=t.get(l).value,i=t.get(a);i.velocity=i.velocity.max(e)}))}},new class{constructor(t){this.ctx=t,this.draw(),window.addEventListener("resize",(()=>{this.draw()}))}draw(){this.ctx.fillStyle="#3D0038",this.ctx.fillRect(0,0,window.innerWidth,window.innerHeight);for(let t=0;t<500;t++){let t=r(Math.floor(Math.random()*window.innerWidth),Math.floor(Math.random()*window.innerHeight)),e=.125*Math.random();this.ctx.fillStyle="#F9A8D4",this.ctx.beginPath(),this.ctx.arc(t.x,t.y,10*e,0,2*Math.PI),this.ctx.fill()}}update(t){}}(N),new class{constructor(e){this.ctx=e,this.noise=t.makeNoise2D(),this.time=0,this.pointCount=75,this.ctx.fillStyle="#EF4444",this.ctx.fillRect(0,.9*window.innerHeight,window.innerWidth,.1*window.innerHeight)}update(t){this.time+=t,this.ctx.clearRect(0,0,window.innerWidth,window.innerHeight);let e=[];for(let n=0;n<this.pointCount;n++)e.push(this.noise(n,this.time/1e3));this.ctx.fillStyle="#EF4444",this.ctx.beginPath(),this.ctx.moveTo(0,.9*window.innerHeight-e[0]*window.innerHeight*.02);for(let n=1;n<e.length;n++){let t=window.innerWidth/(this.pointCount-1)*(n+1),i=.9*window.innerHeight-e[n]*window.innerHeight*.015,s=.9*window.innerHeight-e[n-1]*window.innerHeight*.02,o=window.innerWidth/(this.pointCount-1)/3;this.ctx.bezierCurveTo(t-2*o,s,t-o,i,t,i)}this.ctx.lineTo(window.innerWidth,window.innerHeight),this.ctx.lineTo(0,window.innerHeight),this.ctx.fill();let i=this.ctx.createLinearGradient(0,0,0,window.innerHeight);i.addColorStop(0,"transparent"),i.addColorStop(.15+this.noise(0,this.time/1e3)/10,"transparent"),i.addColorStop(1,"#EF4444"),this.ctx.fillStyle=i,this.ctx.fillRect(0,0,window.innerWidth,window.innerHeight)}}(L),new class{constructor(t){this.ctx=t,this.selector=e.select(d,c,a),this.rockets=e.select(y,c),p("crystal.svg")}update(t){this.ctx.clearRect(0,0,window.innerWidth,window.innerHeight),this.selector.iterate((e=>{e.get(a).addForce(0,t/12e5),f(this.ctx,"crystal.svg",e.get(c).position,r(.5,.5)),this.rockets.iterate((t=>{t.get(c).position.subtract(e.get(c).position).magnitudeSquared<1&&(e.get(d).follow||s(i+1),e.get(d).follow=t,e.get(w).timeLeft=Math.min(e.get(w).timeLeft,200))})),e.get(d).follow&&(e.get(a).addForce(e.get(a).velocity.scaleBy(-1)),e.get(a).addForce(e.get(d).follow.get(c).position.subtract(e.get(c).position).scaleBy(t/1e3)))}))}}(H),new class{constructor(t,i){this.ctx=t,this.uiCtx=i,this.keys=new Set;let n=r(5,6);this.entity=e.create(),this.entity.add(new y,new c(n,0),new a,new l(.005)),this.particleEmmiter=e.create(),this.particleEmmiter.add(new g(20,(()=>[new u("#075985",.2),new w(1e3),new c(this.entity.get(c).position),new a(o.fromAngle(this.entity.get(c).rotation).scaleBy(-.001))]))),p("rocket.svg"),p("arrow.svg"),window.addEventListener("keydown",(t=>{M.state!==v.DYING&&this.keys.add(t.code)})),window.addEventListener("keyup",(t=>{this.keys.delete(t.code)}))}update(t){M.state!==v.PLAYING&&M.state!==v.DYING||this.entity.get(a).addForce(0,t/2e5),this.particleEmmiter.get(g).enabled=this.keys.has("Space");let i=Math.min(Math.max(["KeyD","ArrowRight"].filter((t=>this.keys.has(t))).length-["KeyA","ArrowLeft"].filter((t=>this.keys.has(t))).length,-1),1);this.entity.get(c).rotation+=i*t/700;let n,l=this.entity.get(c).rotation;if(this.entity.get(c).rotation=Math.min(Math.max(l,-1),1),M.state!==v.DYING&&this.keys.has("Space")){M.state===v.NOT_PLAYINNG&&(s(0),M.state=v.PLAYING),M.started=!0;let e=o.fromAngle(this.entity.get(c).rotation);this.entity.get(a).addForce(e.scaleBy(t/1e5))}this.uiCtx.clearRect(0,0,window.innerWidth,window.innerHeight),f(this.ctx,"rocket.svg",this.entity.get(c).position,r(1.2,1.2),this.entity.get(c).rotation),e.select(h).iterate((t=>n=t.get(h)));let d=this.entity.get(c).position;if(d.x>(null==n?void 0:n.right)+.5||d.x<(null==n?void 0:n.left)-.5||d.y<(null==n?void 0:n.top)-.5){let t=d.clamp(r(n.left+1,n.top+1),r(n.right-1,n.bottom-1));f(this.uiCtx,"arrow.svg",t,r(1,1),d.subtract(t).angle)}M.state===v.PLAYING&&(null==n?void 0:n.screenPosition(r(0,d.y-.5)).y)>.9*window.innerHeight&&(M.state=v.DYING,e.create().add(new w(3e3),new g(50,(()=>[new u("gray",.3),new w(3e3),new c(r(this.entity.get(c).position.x,n.worldPosition(r(0,.9*window.innerHeight)).y)),new a(o.fromAngle(Math.PI/-4+Math.random()*Math.PI/2).scaleBy(5e-4))]))),setTimeout((()=>{this.entity.get(c).position=r(5,6),this.entity.get(a).acceleration=r(0,0),this.entity.get(a).velocity=r(0,0),this.entity.get(c).rotation=0,M.state=v.NOT_PLAYINNG}),3e3))}}(H,A),new class{constructor(){this.selector=e.select(w)}update(t){this.selector.iterate((e=>{e.get(w).timeLeft-=t,e.get(w).timeLeft<=0&&e.eject()}))}},new class{constructor(){this.selector=e.select(g)}update(t){this.selector.iterate((i=>{let n=i.get(g);n.tillNextSpawn-=t,n.enabled&&n.tillNextSpawn<=0&&(e.create().add(...n.generateComponents()),n.tillNextSpawn=n.interval)}))}},new class{constructor(t){this.ctx=t,this.selecter=e.select(u,w,c)}update(t){let i;this.ctx.clearRect(0,0,window.innerWidth,window.innerHeight),e.select(h).iterate((t=>i=t.get(h))),this.selecter.iterate((t=>{let e=i.screenPosition(t.get(c).position),n=t.get(u),s=t.get(w);this.ctx.save(),this.ctx.fillStyle=n.color,this.ctx.beginPath(),this.ctx.arc(e.x,e.y,i.unit*n.size*s.timeLeft/s.totalLife,0,2*Math.PI),this.ctx.fill(),this.ctx.restore()}))}}(I),new class{constructor(t){this.ctx=t,e.select(h).iterate((t=>this.camera=t.get(h))),this.selector=e.select(x,w),this.rocketSelector=e.select(y,c);let i=e.create();i.add(new g(3e3,(()=>[new w(3e3),new x(this.camera.left+Math.random()*(this.camera.right-this.camera.left),2e3)]))),this.spawner=i.get(g)}update(t){this.spawner.enabled=M.state===v.PLAYING,this.selector.iterate((i=>{if(0===i.get(x).time){let t=i.get(x).position;e.create().add(new w(i.get(w).timeLeft),new g(50,(()=>[new u("#EF4444",.3),new w(3e3),new c(r(t-.5+Math.random(),this.camera.worldPosition(r(0,.9*window.innerHeight)).y+.1)),new a(o.fromAngle(Math.PI/-4+Math.random()*Math.PI/2).scaleBy(5e-4))])))}if(i.get(x).time+=t,i.get(x).time>i.get(x).buildUp){i.get(x).spawnedCrystal||(e.create().add(new d,new c(r(i.get(x).position,1)),new a,new w(1e4)),i.get(x).spawnedCrystal=!0);let t=i.get(w).totalLife,n=i.get(x).buildUp,s=i.get(x).time,h=n+(t-n)/2;console.log(t,n,s,h);let l=((t-n)/2-Math.abs(h-s))/(t-n)/2;l=Math.sin(l*Math.PI),this.ctx.save(),this.ctx.fillStyle="#EF4444";let y=this.camera.screenPosition(r(i.get(x).position-l/2,0)).x;this.ctx.fillRect(y,0,l*this.camera.unit,window.innerHeight);let m=y+l/2*this.camera.unit-12*l*this.camera.unit,p=l*this.camera.unit*24,f=this.ctx.createLinearGradient(m,0,m+p,0);f.addColorStop(.9,"transparent"),f.addColorStop(.5,"#EF4444BB"),f.addColorStop(.1,"transparent"),this.ctx.fillStyle=f,this.ctx.fillRect(m,0,p,window.innerHeight),this.ctx.restore(),this.rocketSelector.iterate((t=>{M.state===v.PLAYING&&Math.abs(t.get(c).position.x-i.get(x).position)<l&&(M.state=v.DYING,e.create().add(new w(3e3),new g(50,(()=>[new u("gray",.3),new w(3e3),new c(t.get(c).position),new a(o.fromAngle(Math.random()*Math.PI*2).scaleBy(5e-4))]))),setTimeout((()=>{t.get(c).position=r(5,6),t.get(a).acceleration=r(0,0),t.get(a).velocity=r(0,0),t.get(c).rotation=0,M.state=v.NOT_PLAYINNG}),3e3))}))}}))}}(H)),requestAnimationFrame((function t(i){S||(S=i);let n=i-S;S=i,e.update(Math.min(n,100)),requestAnimationFrame(t)}));
