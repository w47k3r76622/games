var aa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)},ba="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function ca(a){if(a){for(var b=ba,c=["Array","prototype","fill"],d=0;d<c.length-1;d++){var e=c[d];e in b||(b[e]={});b=b[e]}c=c[c.length-1];d=b[c];a=a(d);a!=d&&null!=a&&aa(b,c,{configurable:!0,writable:!0,value:a})}}
ca(function(a){return a?a:function(a,c,d){var b=this.length||0;0>c&&(c=Math.max(0,b+c));if(null==d||d>b)d=b;d=Number(d);0>d&&(d=Math.max(0,b+d));for(c=Number(c||0);c<d;c++)this[c]=a;return this}});
var g=function(){var a=document.documentElement.style,b=void 0!==a.WebkitTransform&&"-webkit-"||void 0!==a.MozTransform&&"-moz-"||void 0!==a.msTransform&&"-ms-"||"";return{translate:function(a,d,e,f,r,m){return b+"transform:translate3d("+a+"px,"+d+"px,"+e+"px)rotateX("+f+"deg)rotateY("+r+"deg)rotateZ("+m+"deg);"},origin:function(a,d,e){return b+"transform-origin:"+a+"px "+d+"px "+e+"px;"},w:function(a){return"background:"+a+";"}}}(),h=[];function n(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0}
function da(){this.m=null;this.a=new n(0,0,0);this.b=new n(0,0,0)}da.prototype={};function ea(a){a.m&&(a.m.node.style.cssText=g.origin(-a.a.x,-a.a.y,-a.a.z)+g.translate(a.a.x,a.a.y,700,a.b.x,a.b.y,a.b.z),h.forEach(function(b){b.active&&(b.node.style.cssText=g.translate(b.x,b.y,-b.z,270,90+180*-Math.atan2(-a.a.y-b.y,-a.a.x-b.x)/Math.PI,180)+"width:"+b.width+"px;height:"+b.height+"px;")}))}
function p(a,b,c,d,e,f,r,m,V){"div"==a?(this.node=document.createElement("div"),this.node.className="plane wall"):"ceil"==a?(this.node=document.createElement("div"),this.node.className="plane ceil"):"floor"==a?(this.node=document.createElement("div"),this.node.className="plane floor"):"background"==a?(this.node=document.createElement("canvas"),this.node.className="plane background",this.node.height=c/4,this.node.width=b/4):"glitch"==a?(this.node=document.createElement("canvas"),this.node.className=
"plane glitch"):"data"==a?(this.node=document.createElement("canvas"),this.node.className="plane data"):"shockwave"==a?(this.node=document.createElement("div"),this.node.className="plane shockwave",this.node.id="shockwave"):"bullet"==a&&(this.node=document.createElement("div"),this.node.className="plane bullet");this.width=b;this.height=c;this.a=new n(d,e,f);this.b=new n(r,m,V);this.g=function(){this.node.style.cssText+="width:"+this.width+"px;height:"+this.height+"px;"+g.translate(this.a.x,this.a.y,
this.a.z,this.b.x,this.b.y,this.b.z)};this.g()}function fa(a){this.node=document.createElement("div");this.node.className="world";a.node.appendChild(this.node);a.c.m=this;this.f=function(a){this.node.appendChild(a.node)};this.a=function(){this.node.innerHTML=""}}function ha(){var a=document.body;this.node=document.createElement("div");this.node.className="viewport";this.c=new da;a.appendChild(this.node)}
function ia(){var a=t,b=.0174532925*(90-u);this.x=v;this.y=a;this.a=b;this.z=150;this.height=this.width=100;this.speed=40;this.active=!0;this.b=new p("bullet",100,100,this.x,this.y,this.z,270,270,180);this.node=this.b.node;w.f(this.b);h.push(this);this.frame=function(){this.x+=this.speed*Math.cos(this.a);this.y+=this.speed*Math.sin(this.a);for(var a=!x(this.x,this.y),b=0;b<y.length;b++)y[b].i(this.x,this.y,200)&&(y[b].l(60),a=!0);return a?(this.active=!1,this.node.classList.add("hidden"),!0):!1};
this.set=function(a,b,e){this.x=a;this.y=b;this.a=e;this.active=!0;this.node.classList.remove("hidden")}}var z=[],A=0;
function ja(){B=[];C=0;var a;a:{var b=decodeURIComponent(document.cookie).split(";");for(a=0;a<b.length;a++){for(var c=b[a];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf("save=")){a=c.substring(5,c.length);break a}}a=""}if(a.constructor===String&&0<a.length&&(a=JSON.parse(a),a.constructor===Array)){C=a[0];0<C&&(document.getElementById("continueButton").className="option");for(b=1;b<a.length;b++)B.push(a[b]);if(0<B.length){a="<h2>Scores</h2>";for(b=0;b<B.length;b++)a+="<li>"+B[b]+" ticks</li>";
document.getElementById("stats").innerHTML=a;document.getElementById("statButton").className="option"}else document.getElementById("statButton").className="option option-disabled"}}function ka(){for(var a=[C],b=0;b<B.length;b++)a.push(B[b]);console.log(JSON.stringify(a));a=JSON.stringify(a);b=new Date;b.setTime(b.getTime()+31536E6);document.cookie="save="+a+";"+("expires="+b.toUTCString())+";path=/";ja()}
var D=[Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random(),Math.random()],E=[-20,20,60,100,140,180,220,260],F=[],la,ma,na,G=0;
function oa(){na=document.getElementsByClassName("background");.3>Math.random()&&(D.push(Math.random()),E.push(-20));for(var a=0;a<na.length;a++){var b=na[a];F[a]=b.getContext("2d");F[a].font="10px monospace";la=b.width;ma=b.height;F[a].clearRect(0,0,la,ma);for(b=0;b<D.length;b++)for(var c=0;7>c;c++)F[a].fillStyle="rgba(0,255,0,0."+(7-c)+")",F[a].fillText(Math.floor(9*Math.random()),D[b]*la,E[b]-10*c)}for(b=0;b<D.length;b++)E[b]+=4,E[b]>ma+160&&(E.splice(b,1),D.splice(b,1),b--);setTimeout(oa,100)}
function pa(){for(var a=document.getElementsByClassName("glitch"),b=["6,7,96","222,236,6","235,236,237","6,24,114","12,11,11"],c=0;c<a.length;c++){var d=a[c],e=d.getContext("2d"),f=d.width;d=d.height;e.clearRect(0,0,f,d);e.beginPath();e.fillStyle="darkGreen";a[c].classList.contains("targeting")&&(e.fillStyle="red");e.rect(f/4,d/4,f/2,d/2);e.fill();for(var r=0;5>r;r++){e.beginPath();e.fillStyle="rgba("+b[Math.floor(Math.random()*b.length)]+","+parseInt(a[c].classList[0],10)/100+")";var m=Math.random()*
f,V=Math.random()*d,q=Math.random()*f,k=Math.random()*d;e.rect(Math.min(m,q),Math.min(V,k),Math.abs(m-q),Math.abs(V-k));e.fill()}}setTimeout(pa,150)}
function qa(){var a=document.getElementsByClassName("data");G+=10;200<G&&(G=10);for(var b=0;b<a.length;b++){var c=a[b],d=c.getContext("2d"),e=c.width,f=c.height;d.clearRect(0,0,e,f);c.width=200;c.height=500;d.font="20px monospace";d.fillStyle="white";d.fillText("Protect me",-G,f/2);d.fillText("Protect me",e-G,f/2);for(c=0;100>c;c++)d.fillText(Math.floor(9*Math.random()),e*Math.random(),f-(f/2-50)*Math.random());for(c=0;100>c;c++)d.fillText(Math.floor(9*Math.random()),e*Math.random(),(f/2-50)*Math.random())}setTimeout(qa,
150)}
function ra(a,b){this.x=a;this.y=b;this.b=0;this.a=this.z=100;this.j=.01+H/1E3;this.speed=2+H/10;this.height=this.width=300;this.h=!1;this.g=new p("glitch",300,300,this.x,this.y,this.z,270,270,180);this.node=this.g.node;w.f(this.g);h.push(this);this.active=!0;this.frame=function(a,b){this.b++;var c=!0;var d=this.x;var r=this.y;d=0>d||0>r||d>=I.length*J||r>=I[0].length*J?0:I[Math.floor(d/J)][Math.floor(r/J)];this.a+=this.j;100<this.a&&(this.a=100);if(this.i(a,b,400))a=Math.atan2(b-this.y,a-this.x),this.node.className=
this.a+" plane glitch targeting";else{if(0==d||5==d)c=!1;a=(270+[-1,45,270,135,180,0,0,295,90,225][d])*Math.PI/180;this.node.className=this.a+" plane glitch"}c&&(this.x+=this.speed*Math.cos(a),this.y+=this.speed*Math.sin(a));return 5==d?!0:!1};this.i=function(a,b,e){return(this.x-a)*(this.x-a)+(this.y-b)*(this.y-b)<e*e};this.delete=function(){this.node.remove();for(var a=0;a<h.length;a++)h[a]===this&&h.splice(a,1)};this.l=function(a){this.a-=a;0>=this.a&&(this.h=!0)};this.o=function(){var a=v,b=t,
e=u,f=a+100*Math.sin(.0174532925*e);e=b+100*Math.cos(.0174532925*e);var r=this.x,m=this.y;console.log(a+" "+b+" "+f+" "+e);300>Math.abs((e-b)*r-(f-a)*m+f*b-e*a)/Math.sqrt((e-b)*(e-b)+(f-a)*(f-a))&&this.l(1.5)};this.s=function(){var a=K,b=L,e=M;this.b>sa&&e*e>=(a-this.x)*(a-this.x)+(b-this.y)*(b-this.y)&&(this.b=0,this.l(99))}}var N=0,O=0,P=0,Q=270,u=0,v=1E3,t=1E3,ta=150,R,I,J,y,S=[],B=[],C=0,T=0,U=[20,80,200],W=0,K=0,L=0,M=-1,sa=0,X=500,H=0,ua=87,va=83,wa=65,xa=68,ya=0;
function za(){Aa(0);this.a=!1;this.g=!0;this.v=function(){Aa(1);this.a=!0;this.g=!1;H=P=0;X=500};this.frame=function(){sa++;document.getElementById("frameAlive").innerHTML=Math.floor(P/100);this.a?(P++,Y[va]?-10<N&&(N-=.2):Y[ua]?10>N&&(N+=.2):.4>Math.abs(N)?N=0:N/=1.1,Y[wa]?-10<O&&(O-=.2):Y[xa]?10>O&&(O+=.2):.4>Math.abs(O)?O=0:O/=1.1):this.g&&(O=3,u-=.12);var a=Math.sin(.0174532925*u),b=Math.cos(.0174532925*u),c=v,d=t;v+=a*N;t+=b*N;ta+=0;t-=a*O;v+=b*O;Ba(v,t)||(Ba(c,t)?v=c:Ba(v,d)?t=d:Ba(c,d)?(v=
c,t=d):console.log("error !"));1==W&&document.getElementById("laserbeam").classList.remove("laserbeamActive");0<W&&W--; -1!=M&&(M+=30,2E3<=M&&(M=-1));for(a=0;a<A&&a<z.length;a++)z[a].frame()&&(A--,a!=A&&(b=z[a],z[a]=z[A],z[A]=b,a--));if((Ca||Y[32])&&this.a)T++;else{for(a=U.length-1;0<=a;a--)if(T>U[a]){this.u(a);break}T=0}b=!1;for(a=0;a<y.length;a++)y[a].frame(v,t)?(b=!0,y[a].h=!0):y[a].i(v,t,100)&&(this.b(),y[a].h=!0),0<W&&y[a].o(),-1!=M&&y[a].s();for(a=y.length-1;0<=a;a--)y[a].h&&(y[a].delete(),
y.splice(a,1));b&&this.b();1==P%X&&this.a&&(console.log("spawning "+X),400<X&&(X-=5),300<X&&(X-=5),200<X&&(X-=5),150<X&&(X-=3),100<X&&X--,50<X&&X--,H++,S&&0<S.length&&(a=S[Math.floor(S.length*Math.random())],y.push(new ra(a.x,a.y))))};this.u=function(a){switch(a){case 0:A<z.length?z[A].set(v,t,.0174532925*(90-u)):z.push(new ia);A++;break;case 1:K=v;L=t;M=sa=0;break;case 2:W=180,document.getElementById("laserbeam").classList.add("laserbeamActive")}};this.b=function(){if(this.a){O=N=0;var a=Math.floor(P/
100);document.exitPointerLock();document.getElementsByTagName("BODY")[0].onclick=function(){return!1};this.a=!1;document.getElementById("gameOver").classList.remove("hidden");document.getElementById("ingame").classList.add("hidden");document.getElementById("score").innerHTML=a;for(var b=!0,c=0;c<B.length;c++)if(a>=B[c]){B.splice(c,0,a);document.getElementById("scorePosition").innerHTML="you are number "+(c+1)+" in the leaderboard !";b=!1;break}10>B.length&&b&&(document.getElementById("scorePosition").innerHTML=
"you are number "+(B.length+1)+" in the leaderboard !",B.push(a));10<=B.length&&B.splice(-1,1);ka();document.getElementById("gameOver").onclick=function(){document.getElementById("gameOver").classList.add("hidden");document.getElementById("menu").classList.remove("hidden")}}};this.j=function(a,b){Q+=a;u+=b;230>Q&&(Q=230);320<Q&&(Q=320)}}var Y={};window.onkeydown=function(a){a=a||window.event;Y[a.keyCode]=!0};window.onkeyup=function(a){a=a||window.event;delete Y[a.keyCode]};var Ca=0;
function Da(a,b,c,d){var e=w;e.f(new p(d,c,500,a+c,b,-447,270,90,180));e.f(new p(d,c,500,a+c,b+c,-447,270,0,180));e.f(new p(d,c,500,a,b,-447,270,180,180));e.f(new p(d,c,500,a,b+c,-447,270,270,180))}var w;
function Ea(){ya++;ya%=3;switch(ya){case 1:ua=90;va=83;wa=81;xa=68;document.getElementById("keyboardType").innerHTML="azerty";break;case 0:ua=87;va=83;wa=65;xa=68;document.getElementById("keyboardType").innerHTML="qwerty";break;case 2:ua=38,va=40,wa=37,xa=39,document.getElementById("keyboardType").innerHTML="arrows"}}
window.onload=function(){function a(b){if(1E3<b-f)window.requestAnimationFrame(a),f=b;else{r+=b-f;for(f=b;16<=r;)d.frame(),c.c.a.x=-v,c.c.a.y=-t,c.c.a.z=ta,c.c.b.x=Q,c.c.b.y=0,c.c.b.z=u,ea(c.c),r-=16;var e=document.getElementById("attackLoader");b=e.getContext("2d");var q=e.offsetWidth,k=e.offsetHeight,l=q/k;b.clearRect(0,0,q,k);1>l?(e.width=800,e.height=800/l,q=800,k=800/l):(e.width=800*l,e.height=800,q=800*l,k=800);b.strokeStyle="rgba(255,255,255,0.4)";b.lineWidth=3;b.beginPath();b.arc(q/2,k/2,
5,0,2*Math.PI);b.stroke();b.strokeStyle="rgba(255,255,255,1)";0<T&&(e=T/U[0],b.lineWidth=3,b.beginPath(),b.arc(q/2,k/2,5,0,2*Math.PI*e),b.stroke());T>U[0]&&(b.lineWidth=4,b.beginPath(),b.arc(q/2,k/2,5,0,2*Math.PI),b.stroke(),b.strokeStyle="rgba(255,255,255,0.7)",e=(T-U[0])/(U[1]-U[0]),b.lineWidth=3,b.beginPath(),b.arc(q/2,k/2,10,0,2*Math.PI*e),b.stroke());T>U[1]&&(b.lineWidth=4,b.beginPath(),b.arc(q/2,k/2,10,0,2*Math.PI),b.stroke(),b.strokeStyle="rgba(255,255,255,0.7)",e=(T-U[1])/(U[2]-U[1]),b.lineWidth=
3,b.beginPath(),b.arc(q/2,k/2,15,0,2*Math.PI*e),b.stroke());T>U[2]&&(b.lineWidth=4,b.beginPath(),b.arc(q/2,k/2,15,0,2*Math.PI),b.stroke());1!=M&&(b=M/4E3*100,document.getElementById("shockwave").style.cssText="width: 4000px;height: 4000px;"+g.translate(K-2E3,L+2E3,-20,180,0,0)+"background: radial-gradient(circle at 50%, transparent, transparent "+(b-10)+"%, #eee "+b+"%, transparent "+b+"%);");k=document.getElementById("minimap");b=k.getContext("2d");q=k.width;k=k.height;b.clearRect(0,0,q,k);b.fillStyle=
"rgba(120,120,120,0.8)";e=(R.length+0)/(0+R[0].length);l=100/(R.length*J);b.fillRect(0,0,100,100/e);b.fillStyle="blue";b.fillRect(v*l-2,t*l-2,5,5);b.fillStyle="red";for(var m=0;m<y.length;m++)b.fillRect(y[m].x*l-1,y[m].y*l-1,3,3);b.fillStyle="green";for(m=0;m<z.length;m++)z[m].active&&b.fillRect(z[m].x*l-1,z[m].y*l-1,3,3);b.strokeStyle="green";b.lineWidth=2;-1!=M&&(b.beginPath(),b.arc(K*l,L*l,M*l,0,2*Math.PI),b.stroke());0<W&&(b.beginPath(),b.moveTo(v*l,t*l),b.lineTo(v*l+200*Math.sin(.0174532925*
u),t*l+200*Math.cos(.0174532925*u)),b.lineTo(v*l-200*Math.sin(.0174532925*u),t*l-200*Math.cos(.0174532925*u)),b.stroke());b.clearRect(0,100/e,q,k);window.requestAnimationFrame(a)}}function b(a){d.j(.5*-a.movementY,a.movementX/2)}document.body.onmousedown=function(){++Ca};document.body.onmouseup=function(){--Ca};ja();var c=new ha;w=new fa(c);var d=new za;c.c.a.x=0;c.c.a.y=0;c.c.a.z=150;c.c.b.x=270;c.c.b.y=0;c.c.b.z=0;ea(c.c);Ea();document.getElementById("keyboardButton").onclick=Ea;document.getElementById("statButton").onclick=
function(){document.getElementById("stats").className="stats"};var e=document.getElementsByTagName("BODY")[0];e.requestPointerLock=e.requestPointerLock;document.getElementById("survivalButton").onclick=function(){e.onclick=function(){e.requestPointerLock()};e.requestPointerLock();document.getElementById("ingame").className="";d.v();document.getElementById("menu").classList.add("hidden")};document.addEventListener("pointerlockchange",function(){document.pointerLockElement===e?document.addEventListener("mousemove",
b,!1):document.removeEventListener("mousemove",b,!1)},!1);var f=0,r=0;a(0);oa();pa();qa()};
function Aa(a){S=[];J=400;0==a?(R=[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,1,0,1,0,0,0],[0,0,0,0,2,0,0,0,0],[0,0,0,1,0,1,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],t=v=700,u=45):1==a?(R=[[3,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[3,0,0,0,0,0,1,1,1,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0],[3,0,0,0,0,0,1,2,0,0,0,0],[0,0,0,0,0,0,1,0,0,0,0,0],[3,0,0,0,0,0,1,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0],[3,0,0,0,0,0,0,0,0,0,0,0]],v=1800,t=4200,u=180):2==a&&
(R=[[0,0,0,0,2],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[3,0,0,0,0]],t=v=1800,u=180);y=[];Fa();a=R;var b=J;w.a();z=[];A=0;var c=a.length*b,d=a[0].length*b;w.f(new p("floor",c,d,0,d,53,180,0,0));w.f(new p("ceil",c,d,0,0,-447,0,0,0));w.f(new p("shockwave",4E3,4E3,0,0,-80,180,0,0));for(var e=0;e<a.length;e++)for(var f=0;f<a[e].length;f++)1==a[e][f]&&Da(e*b,f*b,b,"div"),2==a[e][f]&&Da(e*b+b/4,f*b+b/4,b/2,"data"),3==a[e][f]&&S.push({x:e*b+b/2,y:f*b+b/2});w.f(new p("background",d,500,0,0,-447,270,90,180));
w.f(new p("background",c,500,c,0,-447,270,0,180));w.f(new p("background",c,500,0,d,-447,270,180,180));w.f(new p("background",d,500,c,d,-447,270,270,180))}
function Fa(){I=[];for(var a=[],b=0;b<R.length;b++){I.push([]);for(var c=0;c<R[0].length;c++)2==R[b][c]&&a.push([b,c,5,0]),I[b].push(-1)}for(;0<a.length;){a.sort(function(a,b){return a[3]-b[3]});b=a[0];a.splice(0,1);c=b[0];var d=b[1],e=b[3];0<=c&&c<R.length&&0<=d&&d<R[0].length&&(1==R[c][d]?I[c][d]=0:-1==I[c][d]&&(a.push([c+1,d,2,e+2]),a.push([c-1,d,8,e+2]),a.push([c,d+1,6,e+2]),a.push([c,d-1,4,e+2]),Z(c+1,d)&&Z(c,d+1)&&a.push([c+1,d+1,7,e+3]),Z(c-1,d)&&Z(c,d-1)&&a.push([c-1,d-1,3,e+3]),Z(c-1,d)&&
Z(c,d+1)&&a.push([c-1,d+1,1,e+3]),Z(c+1,d)&&Z(c,d-1)&&a.push([c+1,d-1,9,e+3]),I[c][d]=b[2]))}}function Z(a,b){return 0>a||0>b||a>=R.length||b>=R[0].length?!1:1!=R[a][b]}function x(a,b){return 0>a||0>b||a>=R.length*J||b>=R[0].length*J?!1:1!=R[Math.floor(a/J)][Math.floor(b/J)]}function Ba(a,b){return x(a-80,b-80)&&x(a+80,b-80)&&x(a-80,b+80)&&x(a+80,b+80)};
