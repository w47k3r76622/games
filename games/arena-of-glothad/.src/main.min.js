document.addEventListener("DOMContentLoaded",function(a){function v(a,b,c,d){for(var e=0;e<a;e++){u[e]=[];for(var f=0;f<b;f++)u[e][f]=K(e*n+p,f*o+q,n,o,t)}}function A(a,b){return parseInt(Math.random()*(b-a+1)+a)}function G(){for(var a={x:-1,y:1},b=1;b<6;b++){a.x+=2;var c="goblin"+b,d=J(u[a.x][a.y].left,u[a.x][a.y].top,n,o,e,f,c,{x:a.x,y:a.y},"Goblin",2,5,B,D,!0);F.push(d),u[a.x][a.y].occupied=!0,u[a.x][a.y].occupiedType=d.type,u[a.x][a.y].gamePieceId=d.id}}function I(){for(var a={x:-1,y:8},b=1;b<4;b++){a.x+=2;var c="hero"+b,d=J(u[a.x][a.y].left,u[a.x][a.y].top,n,o,g,h,c,{x:a.x,y:a.y},"Hero",10,4,C,E,!1);H.push(d),u[a.x][a.y].occupied=!0,u[a.x][a.y].occupiedType=d.type,u[a.x][a.y].gamePieceId=d.id}}function J(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o={left:a,top:b,width:c,height:d,color:e,highlightColor:f,currentColor:e,hasMoved:!1,hasAttacked:!1,id:g,location:h,name:i,health:j,movement:k,currentHP:j,weapon:l,armor:m,attack:l.damage,attackRange:l.range,defense:m.defense,type:n?"NPC":"PC"};return o}function K(a,b,c,d,e,f){var g={left:a,top:b,width:c,height:d,color:e,gamePieceId:"",isHighlightMove:!1,isHighlightAttack:!1,occupied:!1,occupiedType:"",type:"NORMAL"};return g}function N(){document.addEventListener("mousedown",function(a){var c=a.clientX-(p+b.parentElement.offsetLeft)+document.scrollingElement.scrollLeft,d=a.clientY-(q+b.parentElement.offsetTop)+document.scrollingElement.scrollTop,e=a.clientX-b.parentElement.offsetLeft+document.scrollingElement.scrollLeft,f=a.clientY-b.parentElement.offsetTop+document.scrollingElement.scrollTop;if(!M&&e>=ha.left&&e<=ha.left+ha.width&&f>=ha.top&&f<=ha.top+ha.height&&R(),!M&&c>=0&&c<=n*l&&d>=0&&d<=o*m){var g=parseInt(c/n),h=parseInt(d/o);if(g>=0&&h>=0&&g<=l&&h<=m){var i=u[g][h];if(void 0!==i&&i.occupied&&!i.isHighlightAttack)H.forEach(function(a){a.id===i.gamePieceId&&V(a)}),F.forEach(function(a){a.id===i.gamePieceId&&V(a)});else if(null!==L){if(!L.hasAttacked&&i.occupied&&i.isHighlightAttack&&"PC"===L.type)for(var j=0;j<F.length;j++){var k=F[j];i.gamePieceId===k.id&&"NPC"===k.type&&O(k,j)}if(!L.hasMoved&&!i.occupied&&i.isHighlightMove&&"PC"===L.type)for(var j=0;j<H.length;j++)L.id===H[j].id&&Q(H[j],g,h);H.forEach(function(a){null!==L&&a.id===L.id&&_(a)}),F.forEach(function(a){null!==L&&a.id===L.id&&_(a)})}}}else null!==L&&(H.forEach(function(a){null!==L&&a.id===L.id&&_(a)}),F.forEach(function(a){null!==L&&a.id===L.id&&_(a)}))})}function O(a,b){L.hasMoved=!0,L.hasAttacked=!0;var c=A(1,10),d=z-a.armor.defense;c>=d?P(a,b):ca(a,"MISS!")}function P(a,c){var d=A(1,L.attack);a.currentHP-=d,a.currentHP<=0&&("PC"===L.type?(F.length>0&&F.splice(c,1),U()&&fa(b.width/2-250,b.height/2,"VICTORY!",!1)):"NPC"===L.type&&(H.length>0&&H.splice(c,1),U()&&fa(b.width/2-200,b.height/2,"DEFEAT!",!1))),L.hasMoved=!0,L.hasAttacked=!0,ca(a,"-"+d)}function Q(a,b,c){var d=a;d.left=u[b][c].left,d.top=u[b][c].top,u[d.location.x][d.location.y].occupied=!1,u[d.location.x][d.location.y].occupiedType="",u[d.location.x][d.location.y].gamePieceId="",d.location={x:b,y:c},u[b][c].occupied=!0,u[b][c].occupiedType=d.type,u[b][c].gamePieceId=d.id,d.hasMoved=!0,L=d}function R(){for(var a=0;a<F.length;a++){var b=H[A(0,H.length-1)];V(F[a]);var c=b.location.x-F[a].location.x,d=b.location.y-F[a].location.y,e=Math.abs(c),f=Math.abs(d),g=0,h=0,i=F[a].movement;e>0&&(g=e>i?i:e,i-=e),f>0&&i>0&&(h=f>i?i:f,i-=f),c<0?(g-=F[a].location.x,g=Math.abs(g)):g+=F[a].location.x,d<0?(h-=F[a].location.y,h=Math.abs(h)):h+=F[a].location.y,u[g][h].occupied?g-1>=0&&!u[g-1][h].occupied?Q(F[a],g-1,h):h-1>=0&&!u[g][h-1].occupied?Q(F[a],g,h-1):h+1>=0&&!u[g][h+1].occupied&&Q(F[a],g,h+1):Q(F[a],g,h);var j=F[a];j.location.x-1>=0&&u[j.location.x-1][j.location.y].occupied?S(u[j.location.x-1][j.location.y],j):j.location.x+1<=l&&u[j.location.x+1][j.location.y].occupied?S(u[j.location.x+1][j.location.y],j):j.location.y-1>=0&&u[j.location.x][j.location.y-1].occupied?S(u[j.location.x][j.location.y-1],j):j.location.y+1<=m&&u[j.location.x][j.location.y+1].occupied&&S(u[j.location.x][j.location.y+1],j)}T()}function S(a,b){for(var c=0;c<H.length;c++)a.gamePieceId===H[c].id&&O(H[c],c)}function T(){for(var a=0;a<H.length;a++)H[a].hasMoved=!1,H[a].hasAttacked=!1;for(var a=0;a<F.length;a++)F[a].hasMoved=!1,F[a].hasAttacked=!1;k++}function U(){return(F.length<=0||H.length<=0)&&(gameStart=!1,gameRunning=!1,!0)}function V(a){null!==L&&_(L),L=a,a.currentColor=a.highlightColor,"PC"===a.type&&(a.hasMoved||W(a,a.movement,!1),a.hasAttacked||W(a,a.attackRange,!0))}function W(a,b,c){for(var d,e,f,g,h=1;h<=b;h++)a.location.x+h<l&&(d=u[a.location.x+h][a.location.y],Z(d,a,c),X(a,b-h,a.location.x+h,!1,c)),a.location.x-h>=0&&(e=u[a.location.x-h][a.location.y],Z(e,a,c),X(a,b-h,a.location.x-h,!0,c)),a.location.y-h>=0&&(f=u[a.location.x][a.location.y-h],Z(f,a,c),Y(a,b-h,a.location.y-h,!0,c)),a.location.y+h<m&&(g=u[a.location.x][a.location.y+h],Z(g,a,c),Y(a,b-h,a.location.y+h,!1,c))}function X(a,b,c,d,e){for(var f=1;f<=b;f++)if(d){if(a.location.y-f>=0){var g=u[c][a.location.y-f];Z(g,a,e)}}else if(a.location.y+f<m){var g=u[c][a.location.y+f];Z(g,a,e)}}function Y(a,b,c,d,e){for(var f=1;f<=b;f++)if(d){if(a.location.x+f<l){var g=u[a.location.x+f][c];Z(g,a,e)}}else if(a.location.x-f>=0){var g=u[a.location.x-f][c];Z(g,a,e)}}function Z(a,b,c){a.occupied||c?c&&(a.isHighlightAttack=!0):a.isHighlightMove=!0}function $(){for(var a=0;a<l;a++)for(var b=0;b<m;b++)(u[a][b].isHighlightMove||u[a][b].isHighlightAttack)&&(u[a][b].isHighlightMove=!1,u[a][b].isHighlightAttack=!1)}function _(a){L=null,a.currentColor=a.color,$()}function ca(a,b){aa={x:a.left+p,y:a.top+q,damage:b},ba=window.setTimeout(function(){aa=null,this.clearTimeout(ba)},1e3)}function fa(a,b,c,d){da={x:a,y:b,msg:c},d&&(ea=window.setTimeout(function(){da=null,this.clearTimeout(ea)},5e3))}function ga(){c.fillStyle=d,c.fillRect(b.offsetLeft,b.offsetTop,b.width,b.height)}function ia(){ga();for(var a=0;a<l;a++)for(var b=0;b<m;b++)c.fillStyle=u[a][b].color,c.fillRect(u[a][b].left,u[a][b].top,u[a][b].width,u[a][b].height),c.fillStyle="#000000",c.strokeRect(u[a][b].left,u[a][b].top,u[a][b].width,u[a][b].height);for(var a=0;a<H.length;a++)c.fillStyle=H[a].currentColor,c.fillRect(H[a].left,H[a].top,H[a].width,H[a].height);for(var a=0;a<F.length;a++)c.fillStyle=F[a].currentColor,c.fillRect(F[a].left,F[a].top,F[a].width,F[a].height);for(var a=0;a<l;a++)for(var b=0;b<m;b++)(u[a][b].isHighlightAttack||u[a][b].isHighlightMove)&&(u[a][b].isHighlightMove&&(c.fillStyle=i),u[a][b].isHighlightAttack&&(c.fillStyle=j),c.fillRect(u[a][b].left,u[a][b].top,u[a][b].width,u[a][b].height),c.fillStyle="#000000",c.strokeRect(u[a][b].left,u[a][b].top,u[a][b].width,u[a][b].height));c.fillStyle="#FFFFFF",c.fillRect(x.left,x.top,x.width,x.height),null!=L?(c.font="18px serif",c.fillStyle="#000",c.fillText("Name: "+L.name,x.left+w,x.top+w),c.fillText("Health: "+L.currentHP+" / "+L.health,x.left+w,x.top+w+20),c.fillText("Move: "+L.movement,x.left+w,x.top+w+60),c.fillText("Attack: "+L.attack,x.left+w,x.top+w+80),c.fillText("Defense: "+L.defense,x.left+w,x.top+w+100),c.fillText("Weapon: "+L.weapon.name,x.left+w,x.top+w+120),c.fillText("Armor: "+L.armor.name,x.left+w,x.top+w+140),c.fillText("HasMoved: "+L.hasMoved,x.left+w,x.top+w+160),c.fillText("HasAttack: "+L.hasAttacked,x.left+w,x.top+w+180)):(c.font="18px serif",c.fillStyle="#000",c.fillText("Nothing selected.",x.left+w,x.top+w)),c.fillStyle="#000000",c.strokeRect(x.left,x.top,x.width,x.height),c.fillStyle="#FFFFFF",c.fillRect(y.left,y.top,y.width,y.height),c.font="18px serif",c.fillStyle="#000",c.fillText("Round: "+k,y.left+20,y.top+30),c.fillStyle="#000000",c.strokeRect(y.left,y.top,y.width,y.height),c.fillStyle=ha.color,c.fillRect(ha.left,ha.top,ha.width,ha.height),c.font="18px serif",c.fillStyle="#FFFFFF",c.fillText("End Round",ha.left+35,ha.top+20),null!==aa&&(c.font="54px serif",c.fillStyle="#ffee1e",c.fillText(aa.damage,aa.x,aa.y)),null!==da&&(c.font="54px serif",c.fillStyle="#ec560e",c.fillText(da.msg,da.x,da.y))}function ja(){ia(),requestAnimationFrame(ja)}var b=document.getElementById("canvas"),c=b.getContext("2d"),d="#FFFFFF",e="#319225",f="#56e445",g="#7b0e76",h="#d628ce",i="rgba(128, 145, 241, 0.6)",j="rgba(251, 34, 34, 0.6)",k=0,l=12,m=12,n=40,o=40,p=20,q=20,r=l*n,s=m*o,t="#ccaf92",u=[];v(l,m,n,o);var w=40,x={left:r+w,top:q,width:300,height:s},y={left:p,top:s+w,width:800,height:50},z=8,B={name:"Dagger",damage:2,range:1},C={name:"Sword",damage:3,range:2},D={name:"Cloth Armor",defense:1},E={name:"Leather Armor",defense:2},F=new Array;G();var H=new Array;I();var L=null,M=!1,aa=null,ba=null,da=null,ea=null,ha={color:"#000000",left:y.width-150,top:y.top+10,width:150,height:30};N(),requestAnimationFrame(ja)});