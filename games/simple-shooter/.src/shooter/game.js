function init(){function R(){var e=utils.getDistanceCoordinants(b,y);b.rotation=Math.atan2(e.dy,e.dx)}function U(e){var t=new Ball(e,"#49a6b6",true);t.x=b.x;t.y=b.y;t.angle=b.rotation;t.mass=2;E.push(t)}function z(t){var n=E.indexOf(t);var r=utils.getAngleVelocity(t.angle,15);t.x+=r.vx;t.y+=r.vy;if(utils.ballOffScreen(t,e)){E.splice(n,1)}S.forEach(function(e){if(utils.ballCollision(t,e)){if(e.powerup){at(e.color);var r=S.indexOf(e);S.splice(r,1);E.splice(n,1)}else{Q(e,I);E.splice(n,1)}}})}function W(e){e.draw(t)}function X(t,n,r,i){var s=t||Math.round(Math.random()*100+30);var o=new Ball(s,"rgba(252,71,88,1)",true);if(i)o.color=i;if(i){o.powerup=true}else{o.powerup=false}o.x=n||Math.random()*e.width;o.y=r||Math.random()*e.height;o.vx=Math.random()*10-5;o.vy=Math.random()*10-5;o.mass=s;o.hp=Math.round(s/10)>1?Math.round(s/10):5;o.life=o.hp;o.speed=Math.random()*5;if(s>1){S.push(o)}else{x.push(o)}}function V(e){var t=Math.round(e.radius/10);for(i=0;i<t;i++){X(t,e.x,e.y)}}function $(e){var t=e.radius;for(i=0;i<t;i++){X(1,e.x,e.y)}}function J(t,n){t.x+=t.vx;t.y+=t.vy;var r=S.indexOf(t);var i=S.length;for(var s,o=n+1;o<i;o++){s=S[o];utils.conserveMomentumTwoAxes(t,s)}if(t.radius>=5&&!t.powerup){utils.ballCheckWalls(t,w,e)}else{if(utils.ballOffScreen(t,e)){S.splice(r,1);if(S.length<=0)ht()}}if(utils.ballCollision(t,b)){if(t.powerup){at(t.color);S.splice(r,1)}else{t.vx*=w;t.vy*=w;Y();Q(t)}}if(T){if(utils.ballCollision(t,T)){t.vx*=w;t.vy*=w;Q(t);tt(5)}}if(_){if(utils.ballCollision(t,H)){if(H.id==t.bombID)return;t.bombID=H.id;Q(t,3)}}}function K(t,n){t.x+=t.vx;t.y+=t.vy;var r=x.indexOf(t);if(utils.ballOffScreen(t,e)){x.splice(r,1)}if(T){if(utils.ballCollision(t,T)){x.splice(r,1)}}if(_){if(utils.ballCollision(t,H)){x.splice(r,1)}}if(utils.ballCollision(t,b)){x.splice(r,1)}}function Q(e,t){e.hp-=t||1;var n=e.hp/e.life;console.log("ratio: "+n);if(n>.3)e.color="rgba(252,71,88,"+n+")";console.log(e.hp);console.log(e.life);console.log(e.color);if(e.hp<=0){return G(e)}}function G(e){ot(50);var t=Math.round(Math.random()*50);if(e.radius>=30){V(e)}else if(e.radius>1){$(e)}if(t<=10)ut(e,t);var n=S.indexOf(e);S.splice(n,1);if(S.length<=0)ht()}function Y(){if(!b.invincible)b.hp-=1;st();if(b.hp<=0)ft()}function Z(){if(C<=0)return;T=new Ball(30,k,false);T.lineWidth=3;T.x=b.x;T.y=b.y}function et(){T=false}function tt(e){if(!T)return;C-=e||.1;if(C<=0){C=0;T=false}}function nt(){if(T||C>=150)return;if(!N)C+=.25}function rt(){if(M<=0||_)return;_=true;H=new Ball(30,P,false);H.id=M;H.lineWidth=5;H.x=b.x;H.y=b.y;M-=1;s.innerHTML=M}function it(){if(D<=0){H=null;_=false;D=100}D-=.25}function st(){n.innerHTML=b.hp}function ot(e){b.score+=e;O+=e;r.innerHTML=b.score;if(O>=1e3){O=O-1e3;b.hp+=1;st();M+=1;s.innerHTML=M}}function ut(e,t){var n=t<5?"#49a6b6":"#de7545";X(10,e.x,e.y,n)}function at(e){if(e=="#49a6b6"){C+=25}else{M+=1;s.innerHTML=M}}function ft(){L=true;j=0;b.hp=5;C=150;M=2;S=[];u.style.display="none";o.style.display="block";f.innerHTML="GAME OVER";a.style.display="block"}function lt(){L=true;j=0;b.hp=5;C=150;M=2;S=[];u.style.display="none";o.style.display="block";f.innerHTML="YOU WIN";a.style.display="block"}function ct(){if(L){a.style.display="none";o.style.display="block";u.style.display="block"}else{u.style.display="none";o.style.display="none"}}function ht(){if(j==15){return lt()}q=false;L=false;b.invincible=true;j+=1;g.innerHTML=j;m.style.opacity=1;setTimeout(function(){m.style.opacity=0;pt(j)},2e3)}function pt(e){q=true;for(i=0;i<e;i++){X()}setTimeout(function(){b.invincible=false},1500)}function dt(){if(L){window.cancelRequestAnimationFrame(A);return false}A=window.requestAnimationFrame(dt,e);t.clearRect(0,0,e.width,e.height);R();B=new Line(b.x,b.y,y.x,y.y,"#333333");B.draw(t);b.draw(t);if(_){P="rgba(222,117,69,"+D/100+")";H.color=P;H.radius+=.5;H.draw(t);it()}if(F){if(I<5)I+=.005;if(I>=5)b.color="#49a6b6"}E.forEach(z);E.forEach(W);S.forEach(J);S.forEach(W);x.forEach(K);x.forEach(W);k="rgba(73,166,182,"+C/100+")";if(T){T.draw(t);tt()}else{nt()}}var e=document.getElementById("canvas"),t=e.getContext("2d"),n=document.getElementById("lives"),r=document.getElementById("score"),s=document.getElementById("bombs"),o=document.getElementById("overlay"),u=document.getElementById("paused"),a=document.getElementById("game-over"),f=document.getElementById("game-over-text"),l=document.getElementById("again"),c=document.getElementById("home"),h=document.getElementById("play"),p=document.getElementById("how"),d=document.getElementById("howto"),v=document.getElementById("back"),m=document.getElementById("stage-message"),g=document.getElementById("stage"),y=utils.captureMouse(e),b=new Ball(10,"#FFFFFF",true),w=-1,E=[],S=[],x=[],T=false,N=false,C=150,k="rgba(73,166,182,"+C/100+")",L=false,A,O=0,M=2,_=false,D=100,P="rgba(222,117,69,"+D/100+")",H,B,j=0,F=false,I=2,q=false;e.setAttribute("width",window.innerWidth);e.setAttribute("height",window.innerHeight);o.style.display="block";c.style.display="block";b.x=e.width/2;b.y=e.height/2;b.mass=10;b.hp=5;b.score=0;b.invincible=false;st();h.addEventListener("mouseup",function(e){o.style.display="none";c.style.display="none";st();s.innerHTML=M;ht();dt()},false);p.addEventListener("mouseup",function(e){c.style.display="none";d.style.display="block"},false);v.addEventListener("mouseup",function(e){d.style.display="none";c.style.display="block"},false);window.addEventListener("keydown",function(e){e.preventDefault();if(e.keyCode==83){Z();N=true}else if(e.keyCode==32){L=!L;if(!L)dt();ct()}else if(e.keyCode==68){rt()}},false);window.addEventListener("keyup",function(e){if(e.keyCode==83){et();N=false}},false);window.addEventListener("mousedown",function(e){F=true},false);window.addEventListener("mouseup",function(e){U(I);F=false;b.color="#FFFFFF";I=2},false);l.addEventListener("mouseup",function(){a.style.display="none";c.style.display="block"},false)}window.onload=init()