function $(t){return document.getElementById(t)}function show(t){t.style.display="block"}function hide(t){t.style.display="none"}function fadeIn(t,e){e=e||100;var i=.1;t.style.opacity=0,show(t);var a=setInterval(function(){t.style.opacity=i,i+=.05,i>=1&&clearInterval(a)},e)}function scaleX(t){return t/SCALE_X}function scaleY(t){return t/SCALE_Y}function addListener(t,e){var i=document.addEventListener||document.attachEvent;return i.call(document,t,e,!1)}function hideAddressBar(){window.location.hash||(document.height<window.outerHeight&&(document.body.style.height=window.outerHeight+50+"px"),setTimeout(function(){window.scrollTo(0,1)},1))}function resize(){wW=window.innerWidth,wH=window.innerHeight,(H!==wH||W!==wW)&&(H=wH,W=wW,SCALE_X=_W/W,SCALE_Y=_H/H,SCALE=1/Math.max(SCALE_X,SCALE_Y),MARGIN_Y=.3*H,canvas.width=W,canvas.height=H,uiCanvas.width=W,uiCanvas.height=H,document.body.style.fontSize=.9*SCALE+"em",MOBILE&&!window.scrollOffset&&hideAddressBar())}function randomInt(t,e){return Math.floor(t+Math.random()*(e-t))}function euclid_distance(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))}function resolveVelocities(t,e){var i=.9*(t.x-e.x),a=.9*(t.y-e.y);if(!t.r){var r=Math.atan(i/a);return t.vx=.01*-i,t.vy=t.vx/Math.tan(r),void(t.angle=r)}25==t.r&&"red"==t.col&&(i*=1.1,a*=1.1),.2*W>i&&.2*H>a&&5==t.r&&(i*=2.3,a*=2.3);var r=Math.atan(i/a);return t.vx=.016*-i,t.vy=t.vx/Math.tan(r),t.angle=r,{dx:i,dy:a,angle:r}}function circleCollides(t,e){var i=euclid_distance(t,e),a=t.r+e.r;return a>i}function doPhysics(t,e,i){var a=t.x,r=t.y,n=e.x,s=e.y,o=a-n,c=r-s,l=Math.abs(o),u=Math.abs(c),h=t.r+e.r,d=t.r+t.r,p=null;if(h>l&&d>u){var f=h-l,y=d-u;f>=y?c>0?(t.y+=y,p="bottom"):(t.y-=y,p="top"):o>0?(t.x+=f,p="right"):(t.x-=f,p="left")}i||("left"===p||"right"===p?t.vx*=-1:("bottom"===p||"top"===p)&&(t.vy*=-1))}function clear(t){t=t||ctx,t.clearRect(0,0,W,H)}function circle(t,e,i,a,r){t=scaleX(t),e=scaleY(e),i*=SCALE,a=a||ctx,a.arc(t,e,i,0,r||angle360,!1)}function line(t,e,i,a,r){t/=SCALE_X,e/=SCALE_Y,i/=SCALE_X,a/=SCALE_Y,ctx.save(),ctx.fillStyle=r||"white",ctx.lineWidth=1.5*SCALE,ctx.fillRect(t,e,i-t,a-e),ctx.restore()}function shadow(t,e,i){i=i||ctx,i.shadowColor=t,i.shadowBlur=e}function tmpCanvas(t,e,i){var a=document.createElement("canvas");return a.width=t,a.height=e,i(a.getContext("2d"),a),a}function save(){STORAGE&&(localStorage.lg_items=JSON.stringify(ITEMS),localStorage.lg_cash=JSON.stringify(CASH))}function restore(){if(STORAGE){var t=localStorage.lg_items,e=localStorage.lg_cash;t&&e?(ITEMS=JSON.parse(t),CASH=JSON.parse(e)):save()}}function initData(t){if(t)aiQ+=.1+.25*Math.random(),CUSTOMER++;else for(i=0;3>i;i++)addCircle(randomInt(0,700),randomInt(400,500),"a");THREATS+=randomInt(10+CUSTOMER/aiQ*.1,20+CUSTOMER/aiQ*.1)}function boot(){ctx=gCtx;var t=200,e=0,i=setInterval(function(){clear(),ctx.save(),Text("Lone Guard",295,230,"f","white",2,1,2),e+=.1,e>=randomInt(7,9)&&(e=0,glitch(4)),ctx.restore(),--t<0&&(clear(),clearInterval(i),setTimeout(start,500),tick())},30)}function Antivirus(){Circle.apply(this,arguments),this.col="white"}function Virus(){Circle.apply(this,arguments),this.col="red"}function randomVirus(){return viruses[randomInt(0,viruses.length)]}function addCircle(t,e,i){"a"==i?backup.push(new Antivirus(t,e)):desViruses+viruses.length<=THREATS&&viruses.push(new Virus(t,e))}function destroyAll(){ITEMS[2]--,PAUSED=1,save(),glitch(3,function(){for(var t=viruses.length,e=0;t>e;e++)explode(viruses[e],viruses)})}function createBackup(){for(var t=0;2>t;t++)addCircle(randomInt(0,700),randomInt(490,550),"a");ITEMS[1]--,save()}function reCharge(){ITEMS[0]--,save(),sendMsg("YOU RECEIVED AN EXTRA LIFE. YIPEE!","gray"),LIVES++}function Byte(t,e,i){this.x=t,this.y=e,this.w=8,this.h=8,this.o=.1,this.fill=i,this.img=IMAGES["byte"],this.lasts=randomInt(5,10)}function sendByte(t,e,i){var a=new Byte(t,e,i);a.name=BYTES[i].name,a.effect=BYTES[i].effect,bytes.push(a),placeByte=randomInt(500,600)}function buy(t){var e,i=CASH,a=function(t){return CASH>=t?(e=t,CASH-=t,1):0};switch(t){case"Recharge":a(100)&&ITEMS[0]++;break;case"Backup":a(350)&&ITEMS[1]++;break;case"Destroy":a(250)&&ITEMS[2]++;break;case"Setback":a(50)&&ITEMS[3]++}i>CASH?(sendMsg(t.toUpperCase()+" BOUGHT SUCCCESSFULLY","rgba(80,230,100,.9)","$"+e+" HAS BEEN DEDUCTED"),save()):i===CASH&&sendMsg("TRANSACTION DENIED","red","REASON: NOT ENOUGH MONEY")}function Particle(t,e){this.x=t,this.y=e,this.r=30,this.vx=0,this.vy=0,this.scale=1,this.scaleSpeed=.015}function emitParticles(t,e,a){var r=randomInt(10,30);for(i=0;360>i;i+=Math.floor(360/a)){var n=new Particle(t,e);r=i+Math.random()*r,n.vx=Math.cos(r*Math.PI/180),n.vy=Math.sin(r*Math.PI/180),particles.push(n)}}function Projectile(t,e,i){this.x=t,this.y=e,this.r=5,this.vx=0,this.vy=0,this.col=i,this.img=IMAGES.projectile(i)}function shootProj(t,e){var i=t.x+6*t.vx,a=t.y+6*t.vy,r=new Projectile(i,a,t.col);resolveVelocities(r,e),projectiles.push(r)}function Text(t,e,i,a,r,n,s,c){r=r||"white",n*=SCALE,s=s||1,s>1?s=1:0>s&&(s=o),ctx.save(),ctx.translate(scaleX(e),scaleY(i)),ctx.globalAlpha=s,ctx.lineWidth=n,c&&(ctx.font=c+"em Verdana"),"s"===a?(ctx.strokeStyle=r,ctx.strokeText(t,0,0)):"f"===a?(ctx.fillStyle=r,ctx.fillText(t,0,0)):(ctx.strokeStyle=r[1],ctx.fillStyle=r[0],ctx.strokeText(t,0,0),ctx.fillText(t,0,0)),ctx.restore()}function glitch(t,e){t=t||6;var i=setInterval(function(){ctx=uiCtx,clear(),ctx.fillStyle="white",ctx.fillRect(0,0,W,H),--t%2==0&&(ctx.fillStyle="black",ctx.fillRect(0,0,W,H),0>=t&&(clearInterval(i),PAUSED=0,e&&e()))},200)}function Button(t,e,i,a,r,n){ctx.save(),ctx.strokeStyle="rgb(105,120,180)",ctx.lineWidth=1*SCALE,ctx.globalAlpha=1,ctx.translate(scaleX(e),scaleY(i)),a&&(opacity=1),Text(t,15,30,"f","white",1,opacity,.95),line(0,41,60,42,a||"navy"),ctx.restore(),opacity=(opacity+.01)%1}function drawGameUI(){PAUSED||(clear(),Text(" "+aiMsg,250,50,"f",aiMsgCol,1,aiMsgO-=.03,1.4),MENU?(Button("Play",320,150),Button("Shop",320,230),Button("Bytes",320,310)):SHOP?(Button("BACK",50,30,"fuchsia"),Text("Cash: $"+CASH,500,90,"f","",1,1,1),Text("Please tap/click 'Buy' to buy.",250,120,"f","gray",1,1,.9),Text("Recharge - $100",100,180,"f","green",1,1,1),Button("Buy",300,145,"white"),Text("Backup - $350",100,225,"f","white",1,1,1),Button("Buy",300,190,"white"),Text("Destroy - $250",100,270,"f","navy",1,1,1),Button("Buy",300,235,"white")):INVENTORY&&(Button("BACK",50,30,"fuchsia"),Text("Cash: $"+CASH,500,90,"f","",1,1,1),Text("Your Inventory",290,120,"f","gray",1,1,1.1),Text("Recharge x"+ITEMS[0],100,180,"f","green",1,1,.9),Text("Backup x"+ITEMS[1],100,225,"f","white",1,1,.9),Text("Destroy x"+ITEMS[2],100,270,"f","navy",1,1,.9)),STARTED&&(GAME_OVER||(Text("Lives ::  "+LIVES,20,30,"f","white",3,1,1.1),Text("Destroyed Viruses ::  "+desViruses,20,50,"f","white",3,1,1.1))),GAME_OVER&&(Text("Game Over !!",250,100,"f","red",5,1,3),Text("Oops. You lost. Better luck next time",50,180,"f","",2,1,2),Text("Customers served: "+CUSTOMER,150,220,"f","gray",1,1,1),Text("Money received: $"+RECEIVED,150,250,"f","gray",5,1,1),Button("RETRY",230,300),Button("HOME",420,300)))}function sendMsg(t,e,i){aiMsg=t,aiMsgCol=e,aiMsgO=1,setTimeout(function(){aiMsg="",i&&setTimeout(function(){sendMsg(i,e)},500)},2500)}function explode(t,e){return emitParticles(t.x,t.y,randomInt(7,10)),e?("red"==t.col?(e.splice(e.indexOf(t),1),++desViruses>=THREATS?(RECEIVED+=randomInt(50,100),sendMsg(msgs.kills[randomInt(0,5)],Math.random()>.5?"green":"purple","     WELL DONE."),play("victory"),setTimeout(function(){initData(1),sendMsg("YOU HAVE A NEW CUSTOMER","violet","    CUSTOMER "+CUSTOMER),STARTED=1,splitVirus=250},5e3)):sendMsg(msgs.kills[randomInt(0,5)],Math.random()>.5?"brown":"white")):(backup.splice(backup.indexOf(t),1),sendMsg("OOPS! ONE BACKUP DOWN","rgb(200,150,190)"),STARTED&&0===backup.length&&!player.alive&&(PAUSED=1,RECEIVED+=randomInt(15,30),CASH+=RECEIVED,save(),glitch(6,function(){GAME_OVER=1,PAUSED=0}))),void t.attackers.forEach(function(t){t.target=null,t.wait=10})):(--LIVES<=0&&(LIVES=0,player.alive=0,0===backup.length?(PAUSED=1,RECEIVED+=randomInt(15,30),CASH+=RECEIVED,save(),glitch(6,function(){GAME_OVER=1,PAUSED=0})):(sendMsg("SITUATION IS CRITICAL !!!",Math.random()>.5?"red":"fuchsia",backup.length+" BACKUP(S) REMAINING"),glitch(3))),void sendMsg(msgs.lost[randomInt(0,5)],Math.random()>.5?"red":"fuchsia"))}function handleClick(t){var e=t.pageX*SCALE_X,a=t.pageY*SCALE_Y;MENU?e>=320&&380>=e&&(a>=150&&192>=a?(clear(uiCtx),MENU=0,setTimeout(function(){player.alive=1,GAME=1,initData(),STARTED=1,sendMsg("A NEW CUSTOMER","indigo","CUSTOMER "+CUSTOMER),setTimeout(function(){for(i=0;3>i;i++)addCircle(randomInt(0,700),randomInt(19,30)),viruses[i].wait=50},3e3)},500)):a>=230&&272>=a?(MENU=0,setTimeout(function(){SHOP=1},500)):a>=310&&352>=a&&(MENU=0,setTimeout(function(){INVENTORY=1},500))):SHOP?e>=50&&110>=e&&a>=30&&72>=a?(SHOP=0,MENU=1,aiMsg=""):e>=300&&360>=e&&(a>=145&&187>=a?buy("Recharge"):a>=190&&232>=a?buy("Backup"):a>=235&&277>=a&&buy("Destroy")):INVENTORY&&e>=50&&110>=e&&a>=30&&72>=a&&(INVENTORY=0,MENU=1,aiMsg=""),GAME&&!GAME_OVER&&(player.target={x:e,y:a,r:10}),GAME_OVER&&a>=300&&342>=a&&(e>=230&&290>=e?(GAME_OVER=0,STARTED=0,GAME=0,setTimeout(restart,500)):e>=420&&480>=e&&(GAME_OVER=0,STARTED=0,GAME=0,setTimeout(reset,500)))}function aiSmart(){return aiQ+Math.random()>aiQ+CUSTOMER*Math.random()/CUSTOMER}function aiLogic(t){GAME_OVER&&(t.target=null);var e=t.x,i=t.y,a=t.attackers,r=a.length,n=t.target;if(--t.wait<=0){if("white"==t.col){if(n=Math.random()>.5?randomVirus():a[randomInt(0,r)],!n){var s=randomVirus();s=s?s:{x:randomInt(0,W),y:randomInt(0,H)},n={x:randomInt(s.x-50,s.x+50),y:randomInt(s.y-50,s.y+50)}}}else{var o=[{x:randomInt(e-100,e+100),y:randomInt(i-100,i+100)},player.alive?player:backup[randomInt(0,backup.length)],a[randomInt(0,r)]];n=o[randomInt(0,3)]}if(n){t.target=n;var c=resolveVelocities(t,n);if(t.vx*=.2,t.vy*=.2,t.wait=randomInt(50,90>100/aiQ?90:100/aiQ),!n.col)return;n.attackers.push(t),c.dx<.15*W&&c.dy<.15*H?aiShoot(t):aiSmart()&&aiShoot(t)}}}function aiShoot(t){shootProj(t,t.target),t.vx*=.1,t.vy*=.1,aiSmart()&&(t.target.wait=0),t.target=0,play("shoot")}function playerShoot(){if(lastShot>=25){var t=player,e=t.target;shootProj(t,e),t.vx*=.1,t.vy*=.1,lastShot=5,play("shoot")}}function tick(){t=(new Date).getTime(),last||(last=t),canStart&&(STARTED&&update(),render()),rAF(tick)}function update(){for(dt+=Math.min(1,(t-last)/1e3);dt>=dstep;)updateViruses(),updatePlayer(),updateParticles(),updateCollisions(),updatePositions(),dt-=dstep;last=t}function render(){ctx=uiCtx,ctx.save(),drawGameUI(),ctx.restore(),ctx=gCtx,clear(),GAME?drawGame():MENU&&(ctx.fillStyle=ctx.createPattern(cyberCanvas(.6),"repeat"),ctx.fillRect(0,0,W,H),drawCircles(backup))}function drawGame(){clear(),ctx.save(),ctx.fillStyle=ctx.createPattern(cyberCanvas(bgO=(bgO+.009)%1),"repeat"),ctx.fillRect(0,0,W,H),ctx.strokeStyle="rgba(255,255,255,0.6)",ctx.fillStyle="rgba(0,0,0,0.5)",ctx.beginPath(),circle(350,250,80),ctx.stroke(),ctx.fill(),ctx.closePath(),ctx.beginPath(),circle(0,500,80),ctx.stroke(),ctx.fill(),ctx.beginPath(),circle(700,500,80),ctx.stroke(),ctx.fill(),ctx.beginPath(),circle(0,0,80),ctx.stroke(),ctx.fill(),ctx.beginPath(),circle(700,0,80),ctx.stroke(),ctx.fill(),drawCircles(viruses,backup),drawProjectiles(),drawParticles(),ctx.restore()}function drawCircle(t){ctx.save(),ctx.translate(scaleX(t.x),scaleY(t.y)),t.rotation&&ctx.rotate(t.rotation),ctx.beginPath(),ctx.strokeStyle=t.col,ctx.lineWidth=3*SCALE,shadow(t.col,10),circle(0,0,t.r),ctx.stroke(),ctx.closePath(),ctx.strokeRect(-1,-1,1,1),ctx.restore()}function drawCircles(){var t=arguments;for(i=0;i<t.length;i++)for(o=t[i],j=0;j<o.length;j++)drawCircle(o[j]);player.alive&&drawCircle(player),player.target&&(ctx.save(),ctx.translate(scaleX(player.target.x),scaleY(player.target.y)),ctx.rotate(targetAngle*(Math.PI/180)),ctx.drawImage(IMAGES.target,-20*SCALE,-20*SCALE,40*SCALE,40*SCALE),ctx.restore(),targetAngle=(targetAngle+8)%360)}function drawProjectiles(){for(i=0;i<projectiles.length;i++){var t=projectiles[i];ctx.save(),ctx.translate(scaleX(t.x),scaleY(t.y)),ctx.scale(SCALE,SCALE),ctx.drawImage(t.img,-t.r,-t.r,2*t.r,2*t.r),ctx.restore()}}function updatePlayer(){for(player.target&&(resolveVelocities(player,player.target),MOBILE&&viruses.forEach(function(t){circleCollides(t,player.target)&&(shoot=1)})),i=0;i<backup.length;i++){var t=backup[i];aiLogic(t)}shoot&&player.alive&&player.target&&(playerShoot(),shoot=0),lastShot++}function updateViruses(){if(--splitVirus<0&&!GAME_OVER&&STARTED){splitVirus=randomInt(20,100>50/aiQ?100:100/aiQ);var t=randomVirus();if(t)for(i=0;2>i;i++)addCircle(t.x,t.y);else splitVirus*=.6,addCircle(randomInt(0,_W),randomInt(20,100))}for(i=0;i<viruses.length;i++){var e=viruses[i];aiLogic(e)}}function updateCollisions(){var t;for(t=viruses.concat(backup),i=0;i<projectiles.length;i++){var e=projectiles[i];if(Math.abs(e.vx)<.1&&Math.abs(e.vy)<.1)projectiles.splice(i,1);else if(player.alive&&e.col!==player.col&&circleCollides(e,player))projectiles.splice(i,1),explode(player);else for(j=0;j<t.length;j++){var a=t[j];if(a&&e&&e.col!==a.col&&circleCollides(e,a)){projectiles.splice(i,1);var r="white"==a.col?backup:viruses;explode(a,r),t[j]=0}else;}}}function updatePositions(){for(player.alive&&(player.x+=player.vx,player.y+=player.vy),backup.forEach(function(t){t.x+=t.vx,t.y+=t.vy}),STARTED&&viruses.forEach(function(t){t.x+=t.vx,t.y+=t.vy}),i=0;i<projectiles.length;i++)o=projectiles[i],o.x+=o.vx,o.y+=o.vy,(o.x+o.r>_W||o.x<o.r||o.y+o.r>W||o.y<o.r)&&projectiles.splice(i,1);var t=viruses.concat(backup).concat([player]);t.forEach(function(t){scaleX(t.x)+t.r*SCALE>W?(t.x=685,t.vx*=-.1):scaleX(t.x)<t.r*SCALE&&(t.x=15,t.vx*=-.1),scaleY(t.y)+t.r*SCALE>H?(t.y=_H-t.r,t.vy*=-.1):scaleY(t.y)<t.r*SCALE&&(t.y=t.r,t.vy*=-.1)})}function drawParticles(){var t;for(i=0;i<particles.length;i++)t=particles[i],ctx.save(),ctx.translate(scaleX(t.x),scaleY(t.y)),ctx.globalAlpha=t.scale,ctx.drawImage(IMAGES.particle,-t.r*SCALE,-t.r*SCALE,t.r*SCALE,t.r*SCALE),ctx.restore()}function updateParticles(){var t;for(i=0;i<particles.length;i++)t=particles[i],t.x+=t.vx,t.y+=t.vy,t.scale-=t.scaleSpeed,t.scale<=0&&particles.splice(i,1)}function start(){player=new Antivirus(350,450),MENU=1,canStart=1}function reset(){PAUSED=0,canStart=1,aiMsg="",CUSTOMER=1,THREATS=0,LIVES=3,RECEIVED=0,viruses=[],desViruses=0,projectiles=[],particles=[],splitVirus=500,lastShot=0,aiQ=.1,backup=[],shoot=!1,MENU=1}function restart(){reset(),initData(),MENU=0,GAME_OVER=0,player.alive=1,GAME=1,sendMsg("                A NEW CUSTOMER","yellow","                CUSTOMER "+CUSTOMER),setTimeout(function(){for(i=0;3>i;i++)addCircle(randomInt(0,W),randomInt(-10,.1*H))},2e3),STARTED=1}var game=$("gameArea"),canvas=$("g"),uiCanvas=$("u"),playBtn=$("play"),gCtx=canvas.getContext("2d"),uiCtx=uiCanvas.getContext("2d"),ctx=gCtx,_W=canvas.width,_H=canvas.height,MARGIN_Y=40,SCALE=1,SCALE_X=1,SCALE_Y=1,dstep=1/60,DEBUG=1,MOBILE="ontouchstart"in document,STORAGE=!!window.localStorage,angle360=2*Math.PI;$("btnShoot").innerHTML=MOBILE?"tap them":"press the Space Bar";var rAF=function(){return window.requestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.webkitRequestAnimationFrame||function(t){setTimeout(t,1e3/60)}}(),H=700,W=500,wH=0,wW=0;setInterval(resize,50);var cyberCanvas=function(t){return tmpCanvas(100,100,function(e){e.globalAlpha=t,e.strokeStyle="rgba(30,50,220,.8)",e.lineWidth=1,e.strokeRect(5,5,20,20),e.strokeRect(40,5,1,30),e.strokeRect(15,36,26,1),e.strokeRect(15,36,1,30),e.strokeRect(50,50,40,1),e.strokeRect(70,50,1,30),e.strokeRect(50,70,20,1)})},IMAGES={antivirus:tmpCanvas(50,50,function(t){t.beginPath(),t.strokeStyle="white",t.lineWidth=3,shadow("white",3,t),circle(25,25,21,t),t.stroke(),t.closePath(),t.strokeRect(24,24,1,1)}),virus:tmpCanvas(50,50,function(t){t.beginPath(),t.strokeStyle="red",t.lineWidth=3,shadow("red",3,t),circle(25,25,21,t),t.stroke(),t.closePath(),t.strokeRect(24,24,1,1)}),particle:tmpCanvas(50,50,function(t){t.fillStyle="rgba(255,255,255,.8)",t.beginPath(),shadow("white",10,t),circle(25,25,23,t),t.fill(),t.closePath()}),"byte":tmpCanvas(10,10,function(t){var e=t.createLinearGradient(5,5,2,5,5,5);e.addColorStop(0,"#E2E858"),e.addColorStop(1,"yellow"),t.fillStyle=e,t.shadowColor="yellow",t.shadowBlur=13,t.fillRect(0,0,10,10)}),projectile:function(t){return tmpCanvas(6,6,function(e){e.fillStyle=t,e.beginPath(),e.arc(3,3,3,0,angle360),e.fill()})},target:tmpCanvas(50,50,function(t){t.beginPath(),t.strokeStyle="white",t.lineWidth=1.5,t.arc(25,25,26,0,angle360),t.stroke(),t.closePath()})};!function(t,e){"function"==typeof define&&define.amd?define(["exports"],e):e("object"==typeof exports&&"string"!=typeof exports.nodeName?exports:t.TinyMusic={})}(this,function(t){function e(t){var i=t.split(o);this.frequency=e.getFrequency(i[0])||0,this.duration=e.getDuration(i[1])||0}function i(t,e,i){this.ac=t||new AudioContext,this.createFxNodes(),this.tempo=e||120,this.loop=!0,this.smoothing=0,this.staccato=0,this.notes=[],this.push.apply(this,i||[])}var a="B#-C|C#-Db|D|D#-Eb|E-Fb|E#-F|F#-Gb|G|G#-Ab|A|A#-Bb|B-Cb",r=440*Math.pow(Math.pow(2,1/12),-9),n=/^[0-9.]+$/,s=4,o=/\s+/,c=/(\d+)/,l={};a.split("|").forEach(function(t,e){t.split("-").forEach(function(t){l[t]=e})}),e.getFrequency=function(t){var e=t.split(c),i=l[e[0]],a=(e[1]||s)-s,n=r*Math.pow(Math.pow(2,1/12),i);return n*Math.pow(2,a)},e.getDuration=function(t){return n.test(t)?parseFloat(t):t.toLowerCase().split("").reduce(function(t,e){return t+("w"===e?4:"h"===e?2:"q"===e?1:"e"===e?.5:"s"===e?.25:0)},0)},i.prototype.createFxNodes=function(){var t=[["bass",100],["mid",1e3],["treble",2500]],e=this.gain=this.ac.createGain();return t.forEach(function(t,i){i=this[t[0]]=this.ac.createBiquadFilter(),i.type="peaking",i.frequency.value=t[1],e.connect(e=i)}.bind(this)),e.connect(this.ac.destination),this},i.prototype.push=function(){return Array.prototype.forEach.call(arguments,function(t){this.notes.push(t instanceof e?t:new e(t))}.bind(this)),this},i.prototype.createCustomWave=function(t,e){e||(e=t),this.waveType="custom",this.customWave=[new Float32Array(t),new Float32Array(e)]},i.prototype.createOscillator=function(){return this.stop(),this.osc=this.ac.createOscillator(),this.customWave?this.osc.setPeriodicWave(this.ac.createPeriodicWave.apply(this.ac,this.customWave)):this.osc.type=this.waveType||"square",this.osc.connect(this.gain),this},i.prototype.scheduleNote=function(t,e){var i=60/this.tempo*this.notes[t].duration,a=i*(1-(this.staccato||0));return this.setFrequency(this.notes[t].frequency,e),this.smoothing&&this.notes[t].frequency&&this.slide(t,e,a),this.setFrequency(0,e+a),e+i},i.prototype.getNextNote=function(t){return this.notes[t<this.notes.length-1?t+1:0]},i.prototype.getSlideStartDelay=function(t){return t-Math.min(t,60/this.tempo*this.smoothing)},i.prototype.slide=function(t,e,i){var a=this.getNextNote(t),r=this.getSlideStartDelay(i);return this.setFrequency(this.notes[t].frequency,e+r),this.rampFrequency(a.frequency,e+i),this},i.prototype.setFrequency=function(t,e){return this.osc.frequency.setValueAtTime(t,e),this},i.prototype.rampFrequency=function(t,e){return this.osc.frequency.linearRampToValueAtTime(t,e),this},i.prototype.play=function(t){return t="number"==typeof t?t:this.ac.currentTime,this.createOscillator(),this.osc.start(t),this.notes.forEach(function(e,i){t=this.scheduleNote(i,t)}.bind(this)),this.osc.stop(t),this.osc.onended=this.loop?this.play.bind(this,t):null,this},i.prototype.stop=function(){return this.osc&&(this.osc.onended=null,this.osc.disconnect(),this.osc=null),this},t.Note=e,t.Sequence=i});var Audio=function(){var t=window.AudioContext||window.webkitAudioContext;t&&(this.ctx=new t,this.tempo=120,this.sounds={},this.playing={},this.addSounds())};Audio.prototype={addSounds:function(){var t=this;this.sounds.explosion=function(){var e=1300,i=new TinyMusic.Sequence(t.ctx,e,["B2 q","F2 q"]);return i.loop=!1,i.gain.gain.value=1,i.bass.gain.value=20,i.waveType="triangle",i}(),this.sounds.shoot=function(){var e=1e3,i=new TinyMusic.Sequence(t.ctx,e,["F5 q","G4 e"]);return i.loop=!1,i.gain.gain.value=.8,i.bass.gain.value=20,i.waveType="sine",i}(),this.sounds.victory=function(){var e=900,i=new TinyMusic.Sequence(t.ctx,e,["C3 q","D4 q","E5 w"]);return i.loop=!1,i.gain.gain.value=.8,i.bass.gain.value=20,i.waveType="triangle",i}()},play:function(t){this.sounds[t]&&(this.playing[t]=this.sounds[t],this.playing[t].play(this.ctx.currentTime),this.playing[t].loop||(this.playing[t]=null))},stop:function(t,e){this.playing[t]&&(e=e||0,this.playing[t].stop(this.ctx.currentTime+e))}};var audio=new Audio,play=function(t){audio.play(t)},Circle=function(t,e,i){this.x=t,this.y=e,this.r=i||19,this.vx=0,this.vy=0,this.col=null,this.angle=0,this.wait=0,this.target=null,this.attackers=[],this.dfs=0},targetAngle=1,STARTED=0,PAUSED=0,GAME_OVER=0,canStart=0,aiMsg="",aiMsgCol="white",aiMsgO=1,bgO=0,GAME=0,MENU=0,SHOP=0,INVENTORY=0,CUSTOMER=1,THREATS=0,LIVES=3,CASH=100,RECEIVED=0,ITEMS=[2,1,1],t=0,last=0,dt=0,dstep=1/60,o=0,opacity=0,i=0,j=0,viruses=[],desViruses=0,projectiles=[],particles=[],splitVirus=500,lastShot=0,aiQ=.1,player=0,backup=[],shoot=!1,msgs={kills:["NICE HIT !!!","!!! EXTREME  !!!","UNSTOPPABLE","YOU GOT THIS","SUPERB !!!"],lost:["OUCH !!!","AWW ... COME ON"," TRY HARDER","TERRIBLE","ARE YOU THAT ... WEAK?"]};restore(),MOBILE?(addListener("touchstart",function(t){t.preventDefault(),handleClick(t.changedTouches[0])},!1),playBtn.ontouchstart=function(){hide($("home")),fadeIn(game,50),glitch(5,boot)}):(addListener("click",function(t){t.preventDefault(),handleClick(t)},!1),addListener("keydown",function(t){32===t.keyCode&&(t.preventDefault(),STARTED&&(shoot=1))}),playBtn.onclick=function(){hide($("home")),fadeIn(game,50),glitch(6,boot)});var destroyHS=new Circle(350,250,80),backupHSL=new Circle(0,500,80),backupHSR=new Circle(700,500,80),rechargeHSL=new Circle(0,0,80),rechargeHSR=new Circle(700,0,80),useBytes=function(){var t,e=0,i=0,a=function(a,r){i=1,e=2;var n=1===r.length?circleCollides(player,r[0]):circleCollides(player,r[0])||circleCollides(player,r[1]);t=setInterval(function(){if(!n)return e=10,void clearInterval(t);if(--e<=0){switch(clearInterval(t),i=0,sendMsg("    ' "+a+" '  ACTIVATED","rgb(39,100,80)"),a){case"DESTROY":destroyAll();break;case"BACKUP":createBackup();break;case"RECHARGE":reCharge()}save()}},1e3)};setInterval(function(){STARTED&&player.alive&&!i&&(circleCollides(player,destroyHS)?ITEMS[2]>0&&a("DESTROY",[destroyHS]):circleCollides(player,backupHSL)||circleCollides(player,backupHSR)?ITEMS[1]>0&&a("BACKUP",[backupHSL,backupHSR]):(circleCollides(player,rechargeHSL)||circleCollides(player,rechargeHSR))&&ITEMS[0]>0&&a("RECHARGE",[rechargeHSL,rechargeHSR]))},1e3)};useBytes();