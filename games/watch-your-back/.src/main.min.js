let canvas,ctx,player,robot,light,monsterSpawnInterval,timeInterval,width=document.documentElement.clientWidth-35,height=document.documentElement.clientHeight-30,monsters=[],angle=0,lightRadius=45,velocity=10,monstersVelocity=.5,score=0,maxMonsters=3,purpleProb=.05,canShoot=!0,gameStarted=!1,animating=!1,gameOverState=!1,startConfigFlag=!0,fastMonster=!1,tankMonster=!1,time={seconds:0,minutes:0},shoots=[],mousePos={},deathMarks=[],monsterSize=40;function startConfig(){createCanvas(width,height),player=new Player(40,25,"orange",width/2,height/2),robot=new Robot(15,"red",width,height,lightRadius),light=new Light("#F9E4B7",canvas.width,canvas.height),window.addEventListener("keypress",function(){animating||gameStarted||(animating=!0,animation()),gameOverState&&(monsters=[],angle=0,shoots=[],score=0,canShoot=!0,maxMonsters=3,time={seconds:0,minutes:0},gameStarted=!1,animating=!1,gameOverState=!1,startConfigFlag=!0,fastMonster=!1,tankMonster=!1,monstersVelocity=.5,clearInterval(timeInterval),clearInterval(monsterSpawnInterval),menu())}),menu()}function menu(){draw(),ctx.beginPath(),ctx.fillStyle="rgba(0, 0, 0,0.5)",ctx.fillRect(0,0,width,height),ctx.closePath(),ctx.font="60px Verdana",ctx.fillStyle="yellow",ctx.strokeStyle="white",ctx.textAlign="center",ctx.fillText("Watch Your Back!",width/2,height/3),ctx.strokeText("Watch Your Back!",width/2,height/3),ctx.font="30px Verdana",ctx.fillStyle="red",ctx.strokeStyle="white",ctx.textAlign="center",ctx.fillText("You control the red circle (Robot) and the orange triangle (Player).",width/2,height/2),ctx.strokeText("You control the red circle (Robot) and the orange triangle (Player).",width/2,height/2),ctx.fillText("The robot will aim its flashlight to your mouse position and the player will shoot",width/2,height/2+50),ctx.strokeText("The robot will aim its flashlight to your mouse position and the player will shoot",width/2,height/2+50),ctx.fillText("at the opposite way as you left click with the mouse.",width/2,height/2+100),ctx.strokeText("at the opposite way as you left click with the mouse.",width/2,height/2+100),ctx.fillText("Be careful with the green squares! (monsters!)",width/2,height/2+150),ctx.strokeText("Be careful with the green squares! (monsters!)",width/2,height/2+150),ctx.fillText("Press any key to start!",width/2,height/2+250),ctx.strokeText("Press any key to start!",width/2,height/2+250)}function animation(){let t=0,e=0,a=setInterval(function(){if(ctx.clearRect(0,0,canvas.width,canvas.height),ctx.beginPath(),ctx.arc(width/2,height/2,lightRadius,0,2*Math.PI),ctx.strokeStyle="grey",ctx.stroke(),ctx.fillStyle="#F9E4B7",ctx.fill(),ctx.closePath(),player.setAngle(t),player.draw(ctx,!1),robot.setAngle(e),robot.draw(ctx),e-=.04,(t+=.02)>=6.28){clearInterval(a);let t=!0,e=0,o=setInterval(function(){ctx.clearRect(0,0,canvas.width,canvas.height),t=!t,ctx.beginPath(),ctx.arc(width/2,height/2,lightRadius,0,2*Math.PI),ctx.strokeStyle="grey",ctx.stroke(),ctx.fillStyle="#F9E4B7",ctx.fill(),ctx.closePath(),t&&(light.setAngle(0),light.draw(ctx)),player.draw(ctx,t),robot.draw(ctx),++e>=5&&(clearInterval(o),animating=!1,gameStarted=!0,startGame())},100)}},1)}function gameOver(){let t=0,e=setInterval(function(){ctx.save(),ctx.translate(0,height-t),ctx.clearRect(0,0,canvas.width,canvas.height),ctx.beginPath(),ctx.fillStyle="rgba(128,128,128,0.5)",ctx.fillRect(0,0,width,height),ctx.closePath(),ctx.font="30px Verdana",ctx.fillStyle="red",ctx.strokeStyle="white",ctx.textAlign="center",ctx.fillText("Game Over!",width/2,height/2),ctx.strokeText("Game Over!",width/2,height/2);let a=("0"+time.minutes).slice(-2),o=("0"+time.seconds).slice(-2);ctx.fillText("Final Score: "+score,width/2,height/2+50),ctx.strokeText("Final Score: "+score,width/2,height/2+50),ctx.fillText("Final Time: "+a+":"+o,width/2,height/2+100),ctx.strokeText("Final Time: "+a+":"+o,width/2,height/2+100),ctx.fillText("Press any key to go back to the menu",width/2,height/2+150),ctx.strokeText("Press any key to go back to the menu",width/2,height/2+150),ctx.restore(),t>=height&&(clearInterval(e),gameOverState=!0),t+=10},20)}function startGame(){startConfigFlag&&(canvas.addEventListener("mousemove",function(t){getMousePos(t);let e=mousePos.x-width/2,a=mousePos.y-height/2;angle=Math.atan2(a,e)-90*Math.PI/180}),canvas.addEventListener("click",function(){if(canShoot&&gameStarted){let t=velocity*Math.cos(angle-90*Math.PI/180),e=velocity*Math.sin(angle-90*Math.PI/180);shoots.push(new Bullet(width/2,height/2,t,e)),canShoot=!1,setTimeout(function(){canShoot=!0},500)}}),startConfigFlag=!1),interval=setInterval(draw,20),monsterSpawnInterval=setInterval(function(){purpleProb+=.02,++maxMonsters>=5&&(fastMonster=!0),maxMonsters>=8&&clearInterval(monsterSpawnInterval)},3e4),timeInterval=setInterval(function(){time.seconds++,60==time.seconds&&(time.seconds=0,time.minutes++)},1e3)}function createCanvas(t,e){(canvas=document.createElement("canvas")).width=t,canvas.height=e,document.body.insertBefore(canvas,document.body.firstChild),ctx=canvas.getContext("2d")}function draw(){if(monsters.length<maxMonsters){let t,e,a=Math.random(),o=Math.random();o>=0&&o<.25?(t=Math.random()*width,e=-50):o>=.25&&o<.5?(t=width+50,e=Math.random()*height):o>=.5&&o<.75?(t=Math.random()*width,e=height+50):(t=-50,e=Math.random()*height);let i=monstersVelocity;a<=purpleProb&&fastMonster&&(i+=1);let s=width/2-t,n=height/2-e,r=Math.atan2(n,s),c=i*Math.cos(r),l=i*Math.sin(r);a<=purpleProb&&fastMonster?monsters.push(new Monster(monsterSize,"purple",t,e,c,l)):monsters.push(new Monster(monsterSize,"green",t,e,c,l))}if(ctx.clearRect(0,0,canvas.width,canvas.height),ctx.beginPath(),ctx.arc(width/2,height/2,lightRadius,0,2*Math.PI),ctx.strokeStyle="grey",ctx.stroke(),ctx.fillStyle="#F9E4B7",ctx.fill(),ctx.closePath(),gameStarted&&(light.setAngle(angle),light.draw(ctx)),shoots.forEach((t,e)=>{t.draw(ctx),(t.x>=width+50||t.x<=-50||t.y>=height+50||t.y<=-50)&&(shoots.splice(e,1),delete t),monsters.forEach((t,a)=>{hitMonster(a,e)})}),robot.setAngle(angle),robot.draw(ctx,width,height),ctx.globalCompositeOperation="source-atop",monsters.forEach(t=>{t.draw(ctx),hitPlayer(t)}),ctx.globalCompositeOperation="source-over",deathMarks.forEach(t=>{ctx.save(),ctx.translate(t.x,t.y),ctx.beginPath(),ctx.moveTo(-monsterSize/4,-monsterSize/4),ctx.lineTo(monsterSize/4,-monsterSize/4),ctx.strokeStyle="red",ctx.lineWidth=5,ctx.stroke(),ctx.closePath(),ctx.beginPath(),ctx.moveTo(0,-monsterSize/2),ctx.lineTo(0,monsterSize/2),ctx.strokeStyle="red",ctx.lineWidth=5,ctx.stroke(),ctx.closePath(),ctx.restore()}),player.setAngle(angle),player.draw(ctx,gameStarted),gameStarted){ctx.textAlign="left",ctx.font="30px Verdana",ctx.fillStyle="black",ctx.strokeStyle="white",ctx.fillText("Score: "+score,10,35),ctx.strokeText("Score: "+score,10,35);let t=("0"+time.minutes).slice(-2),e=("0"+time.seconds).slice(-2);ctx.font="30px Verdana",ctx.fillStyle="black",ctx.strokeStyle="white",ctx.fillText("Time: "+t+":"+e,width-200,35),ctx.strokeText("Time: "+t+":"+e,width-200,35)}}function hitMonster(t,e){if(null!=shoots[e])for(let a=0;a<monsters[t].size;a++)for(let a=0;a<monsters[t].size;a++)if(shoots[e].x>=monsters[t].x-monsters[t].size/2&&shoots[e].x<=monsters[t].x+monsters[t].size/2&&shoots[e].y>=monsters[t].y-monsters[t].size/2&&shoots[e].y<=monsters[t].y+monsters[t].size/2)return deathMarks.push({x:monsters[t].x,y:monsters[t].y}),setTimeout(function(){deathMarks.shift()},2e3),monsters.splice(t,1),shoots.splice(e,1),score+=10,void("purple"==monsters[t].color&&(score+=10))}function hitPlayer(t){var e=t.size/2,a=t.x,o=t.y,i=15,s=a-player.x,n=o-player.y;Math.sqrt(s*s+n*n)<e+i&&(clearInterval(interval),gameOver())}function getMousePos(t){let e=canvas.getBoundingClientRect();mousePos={x:t.clientX-e.left,y:t.clientY-e.top}}