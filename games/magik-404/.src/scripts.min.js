function mkCtl(go,dm,dck,thm){return ctl={go:go,dm:dm,init:function(){let df=document.importNode(document.querySelector("#Ctl_tem").content,!0);this.el=df.querySelector("div.ctltop"),this.crdsel=df.querySelector("div.crds"),df.querySelector("div.pname").innerHTML=tth[thm].n,this.el.classList.add("team"+go.team),document.getElementById("full").appendChild(this.el),this.deck=dck,this.drawCard(),this.drawCard(),this.drawCard(),this.drawCard(),this.drawCard(),this.drawCard(),this.drawCard()},kill:function(){this.el.remove()},drawCard:function(){this.addCard(this.deck.charAt(0)),this.deck=this.deck.substring(1)},addCard:function(cc){let cd=cds[cc],df=document.importNode(document.querySelector("#Card_tem").content,!0),e=df.querySelector("div.card");e.gameAction=cc;let n=df.querySelector("span.name");if(curves[cc]){df.querySelector("path").setAttribute("d",decodeCurve(curves[cc][1].curve))}n.innerHTML=cd.t,e.onclick=(()=>{dm.activeRes&&dm.activeRes(e)}),this.crdsel.appendChild(e)},req:function(responder){this.setCs(),this.cardOut&&(this.cardOut.remove(),this.drawCard(),this.cardOut=null),this.el.classList.add("active");let ops=Array.from(this.el.querySelectorAll("div.card")).slice(0,4);console.log(ops),dm.choose(ops,e=>{e.classList.add("used"),this.cardOut=e,this.el.classList.remove("active"),responder(e.gameAction)})},setCs:function(){this.el.style.setProperty("--hth",this.go.health+"%")}},ctl.init(),ctl}function mkUserDm(){return{choose:function(ops,res){this.activeRes=(e=>{this.activeRes=null,this.activeKey=null,res(e)}),this.activeKey=(i=>{this.activeRes=null,this.activeKey=null,res(ops[i])})},activeRes:null,activeKey:null}}let MZt=["Welcome Apprentice - Click one of  the four 'move' cards on your side of the board (or use key indicated).","Well done. These cards allow you to control your position, try a few to see what they do","You lose if you fall off the back of the plyth so it's important to stay forward.","Now try dodge some incoming magic bolts!","You can also use a cast a shield spell to create a defence but it will only protect you next round.","And try casting your our bolts to attack me. I think you are getting the basics.","Spells are faster at close quarters so many wizards prefer fighting as close as possible.","The Blast Spell is short range but deadly. Blasts spread up and down as they expand.","Use your shields carefully against them and control your range to your advantage.","Many a duel is won by an aggressive close quarters strategy pushing the opponent backwards.","So come at me lets see what you've learnt!"];function mkMZDm(off){let ai=0;return{choose:function(ops,res){setTimeout(()=>{res(ops[0]),"1"==ops[0].gameAction&&(msg(MZt[ai+off],15e3,"tut"),ai+=1)},200*Math.random())}}}function mkAIDm(air,aif,ais,aia){return{choose:function(ops,res){setTimeout(()=>{res(this.think(ops,res))},600*Math.random())},think:function(ops,res){let list=ops.map(o=>({o:o,a:o.gameAction,sc:this.evalOp(o.gameAction)})).sort((a,b)=>b.sc-a.sc);return console.log(list),list[0].o},evalOp:function(ga){let sc=Math.random()*air,p=this.go.pos,v=this.go.vpos,p2=gs.p1.go.pos,d=p-p2;switch(ga){case"F":sc+=aif+(p>700?2+5*ais:0)+(p2<400?3*aif+3*aia:0)+(d>500?3*aif:0);break;case"B":sc+=aia+(d>350?aia:0),sc-=5*this.countGOs("S",300,v,v)+2*this.countGOs("S",1e3,v,v);break;case"C":sc+=(d<300?2*aia+aif:0)+(d<250?5*aia+aif:0),sc-=5*this.countGOs("S",300,v,v);break;case"J":sc+=aif+this.countGOs("B",500,1,2)*ais*2+this.countGOs("C",300,1,1)*ais*4,sc-=this.countGOs("B",300,4,4)*ais*2;break;case"D":sc+=aif+this.countGOs("B",500,2,2)*ais*2+this.countGOs("C",300,4,4)*ais*4,sc-=this.countGOs("B",300,1,1)*ais*2;break;case"S":sc+=2*ais+this.countGOs("B",800,v,v)*ais+this.countGOs("B",500,v,v)*ais*3+this.countGOs("C",400,v,v)*ais*5}return sc},countGOs:function(ty,dist,vs,ve){let c=0;return gs.go.forEach(go=>{go.team||go.ty==ty&&(dist<this.go.pos-go.pos||vs>go.vpos||ve<go.vpos||(c+=1))}),c},activeRes:null}}let bcurves={B:{0:"M-22,36 Q-10,43 -21,43 M-25,40 Q-6,38 -23,41 M-23,44 Q-9,35 -25,43",1:"M-22,36 Q-10,43 4,38 M-25,40 Q-6,38 4,39 M-23,44 Q-9,35 3,39",2:"M-22,36 Q-17,46 4,38 M-25,40 Q-6,38 4,39 M-23,44 Q-8,31 3,39",3:"M7,31 Q-10,43 -11,39 M-6,43 Q-6,38 4,39 M-5,30 Q-9,35 2,42"},S:{0:"M-5,20 Q-18,26 -5,30 M-10,20 Q-1,24 -10,30 M0,20 Q-15,24 0,30",1:"M-15,55 Q-5,38 -15,25 M-10,22 Q3,39 -10,58 M-5,20 Q15,39 -5,60",2:"M-15,55 Q-10,39 -15,25 M-10,22 Q-2,39 -10,58 M-5,20 Q13,37 -5,60",3:"M-15,55 Q-5,38 -15,25 M-10,22 Q1,42 -10,58 M-4,23 Q-15,38 -5,60"},C:{0:"M-14,47 Q-17,46 -12,50 M-15,45 Q-17,49 -14,46 M-15,44 Q-18,43 -13,45 M-15,44 Q-19,47 -13,43 M-15,44 Q-22,45 -15,42  M-8,42 Q-27,46 -9,51  M-20,43 Q-7,47 -21,47",1:"M-39,58 Q-32,73 12,86 M-36,53 Q-34,58 6,68 M-35,46 Q-21,49 3,49 M-36,39 Q-35,35 7,27 M-38,32 Q-38,23 19,1  M18,1 Q-4,39 14,85 M-39,33 Q-31,45 -38,58 M18,1 Q28,40 14,85 ",2:"M-17,75 Q-4,79 12,86 M-21,62 Q-11,69 6,68 M-23,48 Q-11,49 3,49 M-20,28 Q-9,26 7,27 M-13,15 Q1,9 19,1  M18,1 Q-4,39 14,85 M-13,15 Q-31,45 -17,74 M18,1 Q28,40 14,85 ",3:"M-14,47 Q-17,46 -12,50 M-15,45 Q-17,49 -14,46 M-15,44 Q-18,43 -13,45 M-15,44 Q-19,47 -13,43 M-15,44 Q-22,45 -15,42  M-8,42 Q-27,46 -9,51  M-20,43 Q-7,47 -21,47"},A:{1:"M1,76 Q10,74 17,82 M16,80 Q21,85 19,92  M22,93 Q21,99 27,98 M27,72 Q30,85 23,93 M10,64 Q17,64 28,74 M-11,64 Q-1,70 11,64 M-12,64 Q-17,70 -24,75 M-32,93 Q-25,85 -24,75 M-28,96 Q-31,96 -35,99 M-24,97 Q-21,88 -12,82 M-14,81 Q-7,76 1,76 ",2:"M0,71 Q5,76 15,76 M16,75 Q19,83 15,92  M15,93 Q15,99 25,97 M24,72 Q25,83 19,93 M10,64 Q17,67 24,71 M-11,64 Q-1,70 11,64 M-12,64 Q-17,70 -22,77 M-41,89 Q-30,83 -22,77 M-44,93 Q-45,98 -38,97 M-36,94 Q-29,92 -14,81 M-14,81 Q-7,76 -1,70 ",3:"M0,56 Q5,58 15,61 M15,61 Q28,68 40,69  M42,64 Q47,65 47,70 M24,57 Q32,58 40,63 M10,49 Q17,52 24,56 M-11,49 Q-1,55 11,49 M-10,51 Q-19,55 -20,57 M-11,67 Q-24,63 -21,57 M-5,62 Q-4,67 -11,70 M-7,59 Q-9,59 -9,62 M-7,59 Q-7,61 -1,55 ",4:"M0,56 Q1,58 9,58 M11,57 Q16,58 8,62  M9,63 Q6,64 19,65 M24,57 Q32,58 12,64 M10,49 Q17,52 24,56 M-11,49 Q-1,55 11,49 M-10,51 Q-19,55 -20,57 M-11,67 Q-24,63 -21,57 M-5,62 Q-4,67 -11,70 M-7,59 Q-9,59 -9,62 M-7,59 Q-7,61 -1,55  ",8:"M-4,78 Q10,74 9,82 M12,81 Q11,84 15,87  M18,87 Q21,99 18,95 M21,74 Q17,79 23,93 M10,64 Q10,67 20,76 M-6,62 Q-1,70 11,64 M-7,67 Q-13,65 -19,76 M-27,91 Q-21,81 -24,75 M-26,97 Q-31,96 -30,88 M-26,92 Q-21,92 -12,82 M-14,81 Q-7,76 1,76",101:"M9,41 Q3,48 4,57 M-9,35 Q-3,34 7,40 M-8,37 Q-12,49 -11,55 M-9,38 Q-33,61 -7,60 M-5,60 Q-5,55 -1,54 M6,41 Q11,51 28,43 M29,42 Q27,37 30,34 ",102:"M4,40 Q3,48 6,57 M-11,34 Q-3,34 5,40 M-11,33 Q-15,40 -11,55 M-9,38 Q-20,27 -30,23 M-32,23 Q-38,23 -37,31 M7,41 Q13,51 24,61 M27,62 Q30,62 33,67 ",103:"M6,37 Q3,48 6,57 M-9,37 Q-3,34 4,35 M-6,36 Q-12,49 -11,55 M-9,38 Q-8,46 20,38 M22,36 Q21,32 23,28 M1,37 Q18,46 26,40 M25,38 Q26,30 29,28 ",104:"M4,40 Q3,48 6,57 M-11,34 Q-3,34 5,40 M-11,33 Q-15,40 -11,55 M-10,37 Q6,10 20,21 M23,21 Q21,16 26,13 M7,41 Q7,51 23,54 M26,54 Q23,54 26,59 ",108:"M1,42 Q-2,45 6,57 M-11,34 Q-3,34 0,43 M-11,33 Q-7,39 -11,55 M-9,38 Q-16,44 -4,56 M-4,59 Q-6,60 0,61 M1,40 Q5,51 14,44 M15,39 Q12,34 14,31 ",201:"M-8,29 Q5,28 15,24 M15,23 Q9,23 7,21 M8,24 Q3,19 0,13 M0,13 Q-4,7 -9,5 M-5,15 Q-4,7 -9,5 M-5,15 Q-5,19 -4,25 M-2,22 Q-3,25 -9,28",202:"M-8,29 Q7,25 14,28 M14,27 Q14,24 7,23 M8,24 Q3,19 0,13 M0,13 Q-4,7 1,4 M-5,15 Q-4,7 1,3 M-5,15 Q-5,19 -4,25 M-2,22 Q-3,25 -9,28",203:"M-10,35 Q9,26 11,16 M11,15 Q9,15 1,20 M2,18 Q-1,15 -2,11 M-2,11 Q-10,1 -23,15 M-10,17 Q-12,10 -26,17 M-10,16 Q-5,19 -7,24 M-6,23 Q-3,25 -10,34",208:"M-10,24 Q17,31 16,35 M20,31 Q11,29 7,23 M6,25 Q3,19 4,11 M6,13 Q-4,7 -4,0 M-9,13 Q-4,7 1,3 M-9,13 Q-13,15 -8,19 M-7,19 Q-3,25 -11,25"},J:{1:"M-13,97 Q-20,59 7,27 M11,24 Q12,41 27,53  M12,22 Q-6,39 -30,35"},F:{1:"M-35,60 Q-12,63 29,60 M41,60 Q9,53 7,41  M41,62 Q17,65 11,78 M21,60 Q-4,54 -13,41  M21,62 Q1,66 -9,78"},D:{1:"M-6,28 Q-12,63 4,88 M8,92 Q1,72 13,63  M3,91 Q-10,82 -21,79"},P:{1:"M-100,0 Q -50,-10 50,0 M-0,0 Q100,-10 150,0 M-50,10 Q -80,30 -100,0 M30,30 Q -40,60 -60,0 M50,90 Q 35,10 0,20 M80,90 Q 55,10 30,20",101:"M-50,30 Q 14,32 80,100 M-12,28 Q 36,47 80,100  M17,29 Q 39,37 80,100",102:"M-10,30 Q 14,32 80,100 M22,28 Q 36,47 80,100  M47,29 Q 39,37 80,100",103:"M-0,30 Q 64,32 110,100 M-42,28 Q 86,47 110,100  M77,29 Q 89,37 110,100",104:"M30,10 Q 64,32 120,100 M82,18 Q 86,47 120,100  M120,19 Q 89,37 120,100"},M:{0:"M0,0 Q1,1 2,2 M0,0 Q1,1 2,2 M0,0 Q1,1 2,2 M0,0 Q1,1 2,2",1:"M5,10 Q-9,41 -49,95 M5,10 Q2,56 39,92 M-10,43 Q-10,61 -3,71 M-24,62 Q-25,72 -19,82",2:"M5,10 Q-9,41 -49,95 M5,10 Q2,56 39,92 M-20,80 Q-28,75 -40,92 M19,68 Q15,81 -19,82",3:"M5,10 Q-9,41 -49,95 M5,10 Q2,56 39,92 M8,78 Q7,86 -21,94 M19,68 Q15,81 5,86"},T:{0:"M0,0 Q1,1 2,2 M0,0 Q1,1 2,2 M0,0 Q1,1 2,2 M0,0 Q1,1 2,2 M0,0 Q1,1 2,2 M0,0 Q1,1 2,2 M0,0 Q1,1 2,2",1:"M5,10 Q-9,41 -5,94 M5,10 Q-6,17 -14,23 M5,10 Q9,21 12,28 M0,22 Q6,28 12,38 M-1,22 Q-10,31 -21,39 M-3,36 Q2,41 15,53 M-5,36 Q-13,43 -24,55",2:"M5,10 Q-9,41 -5,94 M5,10 Q-6,17 -13,13 M5,10 Q9,21 12,28 M0,22 Q6,28 11,44 M-1,22 Q-10,31 -21,39 M-3,36 Q2,41 15,53 M-5,36 Q-13,43 -17,65",3:"M5,10 Q-12,47 1,78 M5,10 Q-6,17 -13,13 M5,10 Q6,20 12,28 M0,21 Q6,28 11,44 M-1,22 Q-10,32 -21,39 M-3,36 Q2,41 15,53 M-5,36 Q-13,43 -17,65"},U:{0:"M0,0 Q1,1 2,2 M0,0 Q1,1 2,2 M0,0 Q1,1 2,2 M0,0 Q1,1 2,2 M0,0 Q1,1 2,2 M0,0 Q1,1 2,2 M0,0 Q1,1 2,2 ",1:"M0,10 Q13,31 40,33 M0,10 Q-5,25 -41,29 M25,80 Q29,54 22,35 M19,80 Q18,54 18,35 M-25,80 Q-29,54 -22,35 M-19,80 Q-18,54 -18,35  M-31,30 Q-2,28 32,34",2:"M0,10 Q13,31 40,33 M0,10 Q-5,25 -41,29 M25,80 Q6,54 22,35 M39,37 Q4,32 0,20 M-25,80 Q-14,55 -22,38 M0,21 Q-7,31 -41,33  M-40,40 Q-2,28 40,44 ",3:"M0,10 Q13,31 40,33 M0,10 Q-5,25 -41,29 M25,80 Q29,54 22,35 M19,80 Q27,45 0,37 M-25,80 Q-29,54 -22,35 M-19,80 Q-24,37 1,38  M-31,30 Q-2,28 32,34"}},curves={};function preProcessCurves(){Object.keys(bcurves).forEach(key=>curves[key]=(el=>{let r={};return Object.keys(el).forEach(key=>{r[key]={curve:brushCurve(encodeCurve(el[key]))},r[+key+1e3]={curve:innerCurve(encodeCurve(el[key]))},r[+key+2e3]={curve:encodeCurve(el[key])}}),r})(bcurves[key])),console.log(curves)}function setCurve(go,i,c){go.pels[i].setAttribute("d",decodeCurve(c))}function innerCurve(c){let n=[];n.push(c[0]);for(let i=0;i<c.length;i+=3)n.push({l:"L",x:c[i].x,y:c[i].y},c[i+1],c[i+2]);return n.push({l:"L",x:c[0].x,y:c[0].y}),n}function brushCurve(c){let n=[];for(let i=0;i<c.length;i+=3)n.push(c[i],c[i+1],c[i+2],{l:"L",x:c[i+2].x+2,y:c[i+2].y+4},{l:"Q",x:c[i+1].x+3,y:c[i+1].y+6},{l:" ",x:c[i].x,y:c[i].y});return n}function iCurve(r,s,e){let ir=1-r;return s.map((p,i)=>({l:p.l,x:p.x*ir+e[i].x*r,y:p.y*ir+e[i].y*r}))}preProcessCurves();const pathRegex=/([M QTZL]+)(-?\d+),(-?\d+)/g;function decodeCurve(c){return c.map(e=>e.l+e.x+","+e.y).join("")}function encodeCurve(path){const pathRegex=/([M QTZL]+)(-?\d+),(-?\d+)/g;let a,r=[];for(;a=pathRegex.exec(path);)r.push({l:a[1],x:+a[2],y:+a[3]});return r}let cds={J:{t:"JUMP"},F:{t:"FORWARD"},D:{t:"DUCK"},B:{t:"BOLT"},S:{t:"SHIELD"},C:{t:"BLAST"},X:{t:"STEP"},1:{t:"ORATE"}},decks={basic:()=>shuffle("JJDDFBBBSC",10),qq:()=>shuffle("FFFFFJDBBSSSCCCC",10),full:()=>shuffle("JJDDFFFBBBCSSSC",10)};function shuffle(str,rep){let dck="";for(let i=0;i<rep;i+=1)dck+=str.split("").sort(()=>Math.random()-.5).join("");return dck}let tth={p1:{n:"Player 1",pr:128,pg:0,pb:0,br:192,bg:64,bb:32,dr:64,dg:0,db:0},p2:{n:"Player 2",pr:0,pg:0,pb:128,br:64,bg:64,bb:255,dr:0,dg:0,db:64},mz:{n:"Master Zendaro",pr:64,pg:0,pb:128,br:128,bg:0,bb:255,dr:0,dg:0,db:0},aj:{n:"Admiral Jamie Ent",pr:255,pg:192,pb:0,br:255,bg:255,bb:0,dr:64,dg:32,db:0},ck:{n:"Crazy K",pr:192,pg:192,pb:0,br:64,bg:64,bb:0,dr:0,dg:0,db:0},mx:{n:"Marcus X",pr:32,pg:128,pb:32,br:128,bg:255,bb:128,dr:0,dg:128,db:0},dd:{n:"Daft Darius",pr:0,pg:192,pb:128,br:0,bg:255,bb:0,dr:0,dg:128,db:64},ww:{n:"Warlock Wilson",pr:255,pg:0,pb:64,br:255,bg:128,bb:128,dr:64,dg:0,db:32},ka:{n:"Killer Adams",pr:64,pg:0,pb:0,br:192,bg:0,bb:0,dr:0,dg:0,db:0},zz:{n:"Master Zi",pr:192,pg:192,pb:255,br:0,bg:64,bb:255,dr:0,dg:0,db:128},tj:{n:"Timid Jay",pr:192,pg:255,pb:192,br:64,bg:255,bb:64,dr:0,dg:192,db:0}};function setTh(t,team){let ls=team?"--p2":"--p1",e=document.getElementById("full");console.log(team,t,ls);let o=tth[t];Object.keys(o).forEach(k=>e.style.setProperty(ls+k,o[k]))}var mkgot=ty=>{switch(ty){case"B":return{prepTurn:function(){this.pose=this.pos+150*(this.team?-1:1)},doTurn:function(){(this.pos>1250||this.pos<-50)&&gs.remove(this);let hits=gs.go.reduce((hits,go)=>{if(go.team==this.team)return hits;if(!go.hit)return hits;let t=1e3*(this.pos-go.pos)/(go.pose-go.pos-this.pose+this.pos);if(t<=0||t>=1e3)return hits;if("A"==go.ty){let vp=li(t/1e3,go.vpos,go.vpose);if(!(this.vpos<vp+.5&&this.vpos>vp-go.vlen-.5))return hits}else if(this.vpos!=go.vpos)return hits;return hits.push({t:t,go:go}),hits},[]).sort((a,b)=>a.t-b.t);hits&&console.log(hits),hits.length&&(hits[0].go.hit(hits[0].t,this,30,80),this.explodeTime=hits[0].t)},impTurn:function(){this.aQ.push({st:0,et:500,curve:[2],pos:this.pos+75*(this.team?-1:1)}),this.aQ.push({st:500,et:1e3,curve:[1],pos:this.pos+150*(this.team?-1:1)}),this.explodeTime&&(this.aQ.push({st:this.explodeTime,et:this.explodeTime+400,curve:[3]}),gs.remove(this))},init:function(){this.curve=[curves.B[0].curve],this.aQ.push({st:0,et:1e3,curve:[1]})},aQ:[]};case"C":return{action:0,prepTurn:function(){this.pose=this.pos+80*(this.team?-1:1)},doTurn:function(){this.action+=1;let hits=gs.go.reduce((hits,go)=>{if(go.team==this.team)return hits;if(!go.hit)return hits;let t=1e3*(this.pos-go.pos)/(go.pose-go.pos-this.pose+this.pos);if(t<=0||t>=1e3)return hits;if("A"==go.ty){let vp=li(t/1e3,go.vpos,go.vpose);if(Math.abs(this.vpos-vp)>2.1)return hits}else if(this.vpos!=go.vpos)return hits;return hits.push({t:t,go:go}),hits},[]).sort((a,b)=>a.t-b.t);hits.length&&(hits[0].go.hit(hits[0].t,this,45,40),this.explodeTime=hits[0].t)},impTurn:function(){1==this.action?this.aQ.push({st:0,et:1e3,curve:[1],pos:this.pos+80*(this.team?-1:1)}):(this.aQ.push({st:0,et:800,curve:[2],pos:this.pos+70*(this.team?-1:1)}),this.aQ.push({st:800,et:1e3,curve:[3],pos:this.pos+80*(this.team?-1:1)})),this.explodeTime?(this.aQ.push({st:this.explodeTime,et:this.explodeTime+100,curve:[3]}),gs.remove(this)):2==this.action&&gs.remove(this)},init:function(){this.curve=[curves.C[0].curve],this.aQ.push({st:0,et:1e3,pos:this.pos+20*(this.team?-1:1)})},aQ:[]};case"S":return{life:3,prepTurn:function(){this.pose=this.pos+10*(this.team?-1:1)},doTurn:function(){this.life-=1,this.life<=0&&gs.remove(this)},impTurn:function(){this.aQ.push({st:0,et:500,curve:[2],pos:this.pos+5*(this.team?-1:1)}),this.aQ.push({st:500,et:1e3,curve:[1],pos:this.pos+10*(this.team?-1:1)}),this.knockTime&&(this.aQ.push({st:this.knockTime,et:this.knockTime+200,curve:[3]}),this.aQ.push({st:this.knockTime+200,et:this.knockTime+400,curve:[2],pos:this.pos+5*(this.team?-1:1)}),this.knockTime=0)},init:function(){this.curve=[curves.S[0].curve],this.aQ.push({st:500,et:1e3,curve:[1],pos:this.pos+2*(this.team?-1:1)})},hit:function(t){this.knockTime=t,this.life-=1},aQ:[]};case"A":return{len:5,vlen:1,vpos:2,sret:-1,nextAct:null,init:function(){this.curve=[curves.A[1].curve,curves.A[101].curve,curves.A[203].curve,curves.A[1001].curve,curves.A[1101].curve,curves.A[1203].curve],this.aQ.push({st:0,et:800,curve:[4,102,201,1004,1102,1201],vpos:1}),this.aQ.push({st:800,et:1e3,curve:[2,102,203,1002,1102,1203],vpos:2}),this.aQ.push({st:1e3,et:1500,curve:[3,101,201,1003,1101,1201],vpos:1}),this.aQ.push({st:1500,et:2e3,curve:[1,101,202,1001,1101,1202],vpos:2}),this.aQ.push({st:2e3,et:3e3,pos:this.pos-120*(this.team?-1:1)})},hit:function(t,bullet,hurt,dist){this.hitTime=t,this.bDist=dist,this.health-=hurt},prepTurn:function(){this.vpose=this.vpos,this.pose=this.pos;let fS=1==this.sret;switch(this.nextAct){case"J":this.vpose=fS?2:4,this.pose=this.pos+30*(this.team?-1:1);break;case"D":this.vpose=1,this.pose=this.pos+10*(this.team?-1:1);break;case"F":this.vpose=fS?2:this.vpos,this.pose=this.pos+50*(this.team?-1:1);break;case"B":case"S":case"C":case"X":this.vpose=fS?2:this.vpos,this.pose=this.pos}},doTurn:function(){this.sret-=1},impTurn:function(){switch(this.nextAct){case"J":this.aQ.push({st:0,et:100,pos:this.pos+5*(this.team?-1:1),curve:[4,0,0,1004],vpos:1.2}),this.aQ.push({st:100,et:400,pos:this.pos+10*(this.team?-1:1),curve:[2,0,0,1002],vpos:3}),this.aQ.push({st:400,et:700,pos:this.pos+25*(this.team?-1:1),curve:[4,0,0,1004],vpos:4.2}),this.aQ.push({st:700,et:1e3,pos:this.pos+30*(this.team?-1:1),vpos:4}),this.sret=1;break;case"D":this.aQ.push({st:0,et:700,pos:this.pos+6*(this.team?-1:1),curve:[4,0,203,1004,0,1203],vpos:.9}),this.aQ.push({st:700,et:1e3,pos:this.pos+10*(this.team?-1:1),curve:[3,0,201,1003,0,1201],vpos:1}),this.sret=1;break;case"F":let bf=2==this.vpos?1:3;this.aQ.push({st:0,et:250,curve:[bf+1,0,0,1e3+bf+1],pos:this.pos+12*(this.team?-1:1)}),this.aQ.push({st:250,et:500,curve:[bf,0,0,1e3+bf],pos:this.pos+24*(this.team?-1:1)}),this.aQ.push({st:500,et:750,curve:[bf+1,0,0,1e3+bf+1],pos:this.pos+36*(this.team?-1:1)}),this.aQ.push({st:750,et:1e3,curve:[bf,0,0,1e3+bf],pos:this.pos+48*(this.team?-1:1)});break;case"X":this.aQ.push({st:0,et:500,curve:[2],pos:this.pos+10*(this.team?-1:1)}),this.aQ.push({st:500,et:1e3,curve:[1],pos:this.pos+20*(this.team?-1:1)});break;case"B":case"C":case"S":(!this.hitTime||this.hitTime>800)&&gs.add(this.nextAct,this.team,this.pos+40*(this.team?-1:1),this.vpos),this.aQ.push({st:0,et:200,curve:[0,102,202,0,1102,1202]}),this.aQ.push({st:300,et:500,curve:[0,104,203,0,1104,1203]}),this.aQ.push({st:500,et:700,curve:[0,103,202,0,1103,1202]}),this.aQ.push({st:800,et:1e3,curve:[0,104,201,0,1104,1201]})}0==this.sret&&this.aQ.push({st:800,et:1e3,curve:[1,0,0,1001],vpos:2}),this.hitTime&&(this.aQ.push({st:this.hitTime,et:this.hitTime+300,curve:[8,108,208,1008,1108,1208]}),this.aQ.push({st:this.hitTime+300,et:this.hitTime+600,pos:this.pos-80*(this.team?-1:1),vpos:2}),this.aQ.push({st:this.hitTime+600,et:this.hitTime+700,curve:[1,101,202,1001,1101,1202]}),this.hitTime=0)},aQ:[],health:100};case"P":return{init:function(){this.curve=[curves.P[1].curve,curves.P[101].curve,curves.P[104].curve]},impTurn(){let st=500*Math.random();this.aQ=[{st:st,et:st+500,curve:[0,101+Math.floor(4*Math.random()),101+Math.floor(4*Math.random())]}]},aQ:[]};default:return{init:function(){this.curve=[curves[ty][0].curve];let xs=.5+Math.random(),ys=xs*(1+Math.random());this.pels[0].style.transform="scale("+xs+","+ys+")",this.aQ=[{st:0,et:1e3,vpos:this.vpos+5,curve:[Math.floor(3*Math.random()+1)]},{st:1e3,et:2e3,vpos:this.vpos+10,curve:[Math.floor(3*Math.random()+1)]}]}}}},mkGOEl=go=>{let df=document.importNode(document.querySelector("#"+go.ty+"_tem").content,!0);go.el=df.querySelector("g"),go.pels=df.querySelectorAll("path"),go.el.classList.add("team"+go.team,"type"+go.ty)},mkgo=(ty,team,pos,vpos)=>{var go=mkgot(ty);return go.pos=pos,go.team=team,go.ty=ty,vpos&&(go.vpos=vpos),mkGOEl(go),go},gs={go:[],killgo:[],add:function(type,team,pos,vpos){let v=mkgo(type,team,pos,vpos);return this.go.push(v),this.wel.appendChild(v.el),v.init&&v.init(),v},remove:function(go){this.killgo.push(go)},start:function(p1dm,p2dm,p1d,p2d,p1t,p2t){this.wel=document.getElementById("lines"),this.wel.innerHTML="",this.go=[],this.killgo=[],setTh(p1t,0),setTh(p2t,1),this.add("P",0,425,-1),this.add("P",1,675,-1);let bgt=["U","M","T","MMT","UUM"][Math.floor(5*Math.random())];for(i=0;i<10;i+=1)this.add(bgt.charAt(Math.floor(Math.random()*bgt.length)),0,280+50*i+40*Math.random(),3*Math.random()-5);this.p1=this.addPlayer(0,p1dm,p1d,p1t),this.p2=this.addPlayer(1,p2dm,p2d,p2t),this.setPos(),this.setCamera(),msg("Ready",500,"info"),this.runFrames(()=>{this.setCamera(),msg("Engage",1e3,"info"),this.turn()})},addPlayer:function(team,dm,dck,th){let go=this.add("A",team,team?600:500,10);return dm.go=go,{go:go,ctl:mkCtl(go,dm,dck,th)}},turn:function(){let p1d=!1,p2d=!1;document.getElementById("full").focus(),this.p1.ctl.req(ac=>{this.p1.go.nextAct=ac,p1d=!0,p2d&&this.doTurn()}),this.p2.ctl.req(ac=>{this.p2.go.nextAct=ac,p2d=!0,p1d&&this.doTurn()})},doTurn:function(){this.go.forEach(o=>o.prepTurn?o.prepTurn():0),this.go.forEach(o=>o.doTurn?o.doTurn():0),this.go.forEach(o=>o.impTurn?o.impTurn():0),this.runFrames(()=>{this.judgeTurn()})},judgeTurn:function(){let d=this.p2.go.pos-this.p1.go.pos;if(d<200){let s=(200-d)/2;this.p1.go.aQ.push({st:0,et:400,pos:this.p1.go.pos-s}),this.p2.go.aQ.push({st:0,et:400,pos:this.p2.go.pos+s}),msg("Keep Distance",500,"info")}this.runFrames(()=>{this.endTurn(),this.checkWin()||this.turn()})},checkWin:function(){let winner=null,tko=!1;if(this.p2.go.pos>800?winner=this.p1:this.p2.go.health<0?(winner=this.p1,tko=!0):this.p1.go.pos<300?winner=this.p2:this.p1.go.health<0&&(winner=this.p2,tko=!0),this.p1.ctl.deck.length<7&&(winner=this.p1),!winner)return!1;let loser=winner==this.p1?this.p2:this.p1;return msg("Victory Awarded",2e3,"vic"),tko?(loser.go.aQ.push({st:0,et:200,curve:[8,108,208,1008,1108,1208]}),loser.go.aQ.push({st:200,et:400,curve:[8,104,201]}),loser.go.aQ.push({st:350,et:800,curve:[1,108,202]}),loser.go.aQ.push({st:700,et:1e3,curve:[8,108,208,1008,1108,1208]})):(loser.go.aQ.push({st:0,et:200,curve:[1,102,208,1008,1108,1208]}),loser.go.aQ.push({st:200,et:500,curve:[8,104,201]}),loser.go.aQ.push({st:400,et:700,curve:[3,108,208],vpos:-2}),loser.go.aQ.push({st:600,et:1e3,curve:[8,108,208],vpos:-5})),winner.go.aQ.push({st:0,et:150,curve:[4,102,203,1004,1102,1203],vpos:2}),winner.go.aQ.push({st:200,et:350,curve:[4,104,201,1004,1104,1201],vpos:3}),winner.go.aQ.push({st:400,et:600,curve:[4,102,202,1004,1102,1202]}),winner.go.aQ.push({st:600,et:1e3,curve:[1,103,201,1001,1103,1201],vpos:2}),this.runFrames(()=>{this.p1.ctl.kill(),this.p2.ctl.kill(),moveCam(550,800,820,500),winner.go.aQ.push({st:0,et:1e3,curve:[1,102,203,1001,1102,1203],pos:550-50*(winner.go.team?-1:1),vpos:2}),winner.go.aQ.push({st:1200,et:1350,curve:[4,104,201,1004,1104,1201],vpos:3}),winner.go.aQ.push({st:1400,et:1600,curve:[4,102,202,1004,1102,1202]}),winner.go.aQ.push({st:1600,et:3e3,curve:[1,103,201,1001,1103,1201],vpos:5}),loser.go.aQ.push({st:0,et:1e3,curve:[1,101,208,1008,1108,1208],pos:550-50*(loser.go.team?-1:1),vpos:2}),loser.go.aQ.push({st:1200,et:1500,curve:[3,104,201],vpos:1}),loser.go.aQ.push({st:1400,et:1700,curve:[3,108,202]}),loser.go.aQ.push({st:1600,et:2e3,curve:[3,108,208]}),loser.go.aQ.push({st:2e3,et:3e3,vpos:-4}),this.runFrames(()=>{showMenu()})}),!0},endTurn:function(){this.setCamera(),this.killgo.forEach(go=>{let i=this.go.indexOf(go);i>=0&&(this.go[i].el.remove(),this.go.splice(i,1))}),this.killgo=[]},setPos:function(){this.go.forEach(o=>{o.el.style.transform="translate("+o.pos+"px,"+this.calcVP(o.vpos)+"px)",o.curve&&(o.curve.forEach((c,i)=>{o.lcurve&&c==o.lcurve[i]||setCurve(o,i,c)}),o.lcurve=o.curve.map(o=>o))})},calcVP:function(vp){return 830-35*(vp-1)},runFrames:function(after){let st=0,al=ts=>{st||(st=ts-1);let t=ts-st,going=!1;this.go.forEach(go=>{going=this.doAnimate(go,.5*t)||going}),this.setPos(),going?requestAnimationFrame(al):after()};requestAnimationFrame(al)},doAnimate:function(go,t){if(go.aQ&&go.aQ.length){let a=go.aQ[0];if(t<a.st)return!0;if(t>=a.et)return a.pos&&(go.pos=a.pos),a.vpos&&(go.vpos=a.vpos),go.aQ.shift(),this.doAnimate(go,t);a.ipos||(a.ipos=go.pos),a.ivpos||(a.ivpos=go.vpos),a.icurve||(a.icurve=go.curve.map(o=>o));let r=(t-a.st)/(a.et-a.st);a.pos&&(go.pos=li(r,a.ipos,a.pos)),a.vpos&&(go.vpos=li(r,a.ivpos,a.vpos)),a.curve&&a.curve.forEach((c,i)=>{c&&(go.curve[i]=iCurve(r,a.icurve[i],curves[go.ty][c].curve))});for(let i=1;i<go.aQ.length;i+=1)if(go.aQ[i].st<t)return go.aQ=go.aQ.slice(i),this.doAnimate(go,t);return!0}return!1},setCamera:function(){let cp=(this.p1.go.pos+this.p2.go.pos)/2,we=Math.abs(this.p1.go.pos-this.p2.go.pos)+400;we>1200&&(we=1200),moveCam(cp,we,820,1e3)}};function li(r,x1,x2){return x1*(1-r)+x2*r}let cam_w=1e3,cam_cp=500,cam_ycp=200;function moveCam(cpe,we,ycpe,mt){let cpi=cam_cp,ycpi=cam_ycp,wi=cam_w,cam=document.getElementById("wld"),ar=cam.clientHeight/cam.clientWidth,st=0,al=ts=>{st||(st=ts-1);let r=(ts-st)/mt;r>1&&(r=1);let w=li(r,wi,we),cp=li(r,cpi,cpe),ycp=li(r,ycpi,ycpe),h=w*ar;cam.setAttribute("viewBox",cp-w/2+" "+(ycp-h/2)+" "+w+" "+h),r<1&&requestAnimationFrame(al)};requestAnimationFrame(al),cam_cp=cpe,cam_w=we,cam_ycp=ycpe}function start(){detectMobile()||(document.getElementById("full").classList.add("hi"),document.getElementById("full").focus(),document.getElementById("full").onkeydown=(e=>{switch(e.key){case"1":return gs.p1.ctl.dm.activeKey?gs.p1.ctl.dm.activeKey(0):0;case"q":return gs.p1.ctl.dm.activeKey?gs.p1.ctl.dm.activeKey(1):0;case"a":return gs.p1.ctl.dm.activeKey?gs.p1.ctl.dm.activeKey(2):0;case"z":return gs.p1.ctl.dm.activeKey?gs.p1.ctl.dm.activeKey(3):0;case"9":return gs.p2.ctl.dm.activeKey?gs.p2.ctl.dm.activeKey(0):0;case"i":return gs.p2.ctl.dm.activeKey?gs.p2.ctl.dm.activeKey(1):0;case"j":return gs.p2.ctl.dm.activeKey?gs.p2.ctl.dm.activeKey(2):0;case"n":return gs.p2.ctl.dm.activeKey?gs.p2.ctl.dm.activeKey(3):0}})),showMenu(startmenu)}function detectMobile(){let isMobile=RegExp(/Android|webOS|iPhone|iPod|iPad/i).test(navigator.userAgent);if(!isMobile){RegExp(/Macintosh/i).test(navigator.userAgent)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&(isMobile=!0)}return isMobile}var startmenu=[{t:"MAGIK - 404 "},{t:"----a tactical turn game of magical duels by elementalsystems-------"},{t:""},{t:""},{t:"Enter the MAGIK UNIVERSITY",cmd:()=>{fullScreen(),setTimeout(()=>showMenu(mainmenu),100)}}],mainmenu=[{t:"MAGIK - 404 "},{t:"The Advanced Martial Use of Unnatural Energies"},{t:"Classroom: Learn to Duel",cmd:()=>showMenu(smenu)},{t:"Duel with the Faculty Members",cmd:()=>showMenu(fmenu)},{t:"Duel with another Player",cmd:()=>showMenu(pmenu)}],smenu=[{t:"Classroom Learning 404"},{t:"Discover the fundimental magical forces with Master Zenita"},{t:"Basic Dueling",cmd:()=>gs.start(mkUserDm(),mkMZDm(0),"JDJDFJDFSDSSDBSBSSJDSSS","111B1DBJ1BB1BDBJBJB1SDSJ","p1","mz")},{t:"Close Quarters Combat",cmd:()=>gs.start(mkUserDm(),mkMZDm(6),"FFDJFDJSSCCJCDCCCSSSSSS","1F1C1DC1C1FDCSJCDCSJCDCSJCDCSJCDCSJC","p1","mz")},{t:""},{t:"back to MAIN MENU",cmd:()=>showMenu(mainmenu)}],fmenu=[{t:"Practice Halls"},{t:"Challenge students and staff for single player dueling"},{t:"Students in the Class",cmd:()=>showMenu(fmenu1)},{t:"Teachers and Assistants",cmd:()=>showMenu(fmenu2)},{t:"The Master Magi",cmd:()=>showMenu(fmenu3)},{t:"back to MAIN MENU",cmd:()=>showMenu(mainmenu)}],fmenu1=[{t:"The Students Rooms"},{t:"Not the happiest bunch but they're the only classmates you have."},{t:"Daft Darius * Basic",cmd:()=>{gs.start(mkUserDm(),mkAIDm(6,1,0,1),decks.basic(),decks.basic(),"p1","dd")}},{t:"Crazy K * Close Quarters",cmd:()=>{gs.start(mkUserDm(),mkAIDm(2,1,0,2),decks.qq(),decks.qq(),"p1","ck")}},{t:"Timid Jay * Basic",cmd:()=>{gs.start(mkUserDm(),mkAIDm(2,0,5,0),decks.basic(),decks.basic(),"p1","tj")}},{t:"back to the PRACTICE HALLS",cmd:()=>showMenu(fmenu)}],fmenu2=[{t:"Learning Experiences"},{t:"Take on some more experienced wizards in a fearsome duel."},{t:"Marcus X * Basic",cmd:()=>{gs.start(mkUserDm(),mkAIDm(1,1,2,3),decks.basic(),decks.basic(),"p1","mx")}},{t:"'Killer' Adams * Close Quarters",cmd:()=>{gs.start(mkUserDm(),mkAIDm(1,5,1,5),decks.qq(),decks.qq(),"p1","ka")}},{t:"Warlock Wilson * Full",cmd:()=>{gs.start(mkUserDm(),mkAIDm(1,0,5,1),decks.full(),decks.full(),"p1","ww")}},{t:"back to the PRACTICE HALLS",cmd:()=>showMenu(fmenu)}],fmenu3=[{t:"Meet the Masters"},{t:"Prove yourself against some skilled duelists."},{t:"Master Zendaro * Full",cmd:()=>{gs.start(mkUserDm(),mkAIDm(0,2,5,3),decks.full(),decks.full(),"p1","mz")}},{t:"Admiral Jamie Ent * Close Quarters",cmd:()=>{gs.start(mkUserDm(),mkAIDm(0,6,3,3),decks.qq(),decks.qq(),"p1","aj")}},{t:"Master Zi * Full",cmd:()=>{gs.start(mkUserDm(),mkAIDm(0,2,5,2),decks.full(),decks.full(),"p1","zz")}},{t:"back to the PRACTICE HALLS",cmd:()=>showMenu(fmenu)}],pmenu=[{t:"The Duelling Courtyard"},{t:"Two players duel on one device"},{t:"PvP - Basic Deck",cmd:()=>{gs.start(mkUserDm(),mkUserDm(),decks.basic(),decks.basic(),"p1","p2")}},{t:"PvP - Close Quarters Deck",cmd:()=>{gs.start(mkUserDm(),mkUserDm(),decks.qq(),decks.qq(),"p1","p2")}},{t:"PvP - Advanced Deck",cmd:()=>{gs.start(mkUserDm(),mkUserDm(),decks.full(),decks.full(),"p1","p2")}},{t:"back to MAIN MENU",cmd:()=>showMenu(mainmenu)}];function animateOffset(e,len,off){let st=0,al=ts=>{st||(st=ts-1);let r=(ts-st-off)/1e3;r<0&&(r=0),r>1&&(r=1),e.setAttribute("startOffset",(1-r)*len),r<1&&requestAnimationFrame(al)};requestAnimationFrame(al)}let lMenu=null;function showMenu(m){m||(m=lMenu),lMenu=m,moveCam(500,1e3,200,1e3);let me=document.getElementById("menu");me.innerHTML="",m.forEach((mi,i)=>{let df=document.importNode(document.querySelector("#Menu_tem").content,!0),tp=df.querySelector("textPath"),e=df.querySelector("text");tp.innerHTML=mi.t,tp.setAttribute("href","#tp"+i),tp.onclick=(()=>{mi.cmd()}),me.appendChild(e),animateOffset(tp,1e3,i>1?200*i+500:0)})}let msgto=0;function msg(txt,tm,cls){let d=document.getElementById("msg");msgto&&(clearTimeout(msgto),d.classList.remove("act")),setTimeout(()=>{d.innerHTML=txt,d.classList.add("act",cls)},10),msgto=setTimeout(()=>{d.classList.remove("act",cls)},tm)}var _fullScreenAttempt=0;function fullScreen(){if(!_fullScreenAttempt){var docEl=window.document.documentElement;(docEl.requestFullscreen||docEl.mozRequestFullScreen||docEl.webkitRequestFullScreen||docEl.msRequestFullscreen).call(docEl),_fullScreenAttempt+=1}}