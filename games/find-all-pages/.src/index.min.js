let e,t,l,n,a,o,r,i,s,c,f,h,u,g,y,d,x,m,p,w,T=A.getContext("2d"),k=360,b=480,v={x:10,y:10,w:100,h:60,t:"Readme"},R={x:250,y:10,w:100,h:60},S={x:10,y:410,w:340,h:60,t:"Start"},M={x:10,y:10,w:100,h:60,t:"Quit"},O={x:0,y:10,w:k,h:60},E={x:250,y:10,w:100,h:60,t:"Shuffle"},V={x:10,y:410,w:100,h:60,t:"Retry"},C={x:120,y:410,w:120,h:60},D={x:250,y:410,w:100,h:60,t:"Undo"},P=+localStorage.pages_muted||0,K=(e,t,l,n,...a)=>{if(!P){w||(w=new(window.AudioContext||webkitAudioContext));let o=w.createOscillator(),r=w.createGain(),i=r.gain,s=w.currentTime;for(let e of a)o.frequency.setValueAtTime(440*2**((e-69)/12),s),i.setValueAtTime(0,s),i.linearRampToValueAtTime(l,s+t),i.setValueAtTime(l,(s+=n/a.length)-t),i.linearRampToValueAtTime(0,s);o.type=e,o.connect(r).connect(w.destination),o.start(),o.stop(s)}},q=(...e)=>{T.beginPath(),T.moveTo(e[0][0],e[0][1]);for(let t=1;t<e.length;t++)T.lineTo(e[t][0],e[t][1]);T.closePath()},z=e=>{T.fillText(e.t,e.x+e.w/2,e.y+e.h/2)},B=e=>{T.strokeRect(e.x,e.y,e.w,e.h),z(e)},F=e=>c.y+h*(e%s+.5),L=e=>c.x+h*(.5+~~(e/s)),N=()=>{requestAnimationFrame(r=>{if(r!==o){o=r,T.save();try{if(T.clearRect(0,0,e,t),T.setTransform(l,0,0,l,n,a),T.textAlign="center",T.textBaseline="middle",T.font="16px Arial",p){B(M),z(O),B(E),B(V),B(D),3===p?B(C):z(C),~d&&(T.fillStyle="#ccc",T.fillRect(c.x+h*~~(d/s),c.y+h*(d%s),h,h));let e=.3*h,t=h/2-e,l=t/2;T.lineJoin="bevel",T.font=~~e+"px Arial";for(let n=f;n--;){let a=L(n),o=F(n),r=x.indexOf(n)+1,i=r===x.length;for(let e of y[n]){let r=L(e),s=F(e);T.save();try{T.translate((a+r)/2,(o+s)/2),T.rotate(Math.atan2(s-o,r-a)),q([-t,-l],[0,-l],[0,-t],[t,0],[0,t],[0,l],[-t,l]),T.fillStyle=i&&m.includes(e)?"#00f":n===x[x.indexOf(e)-1]?"#808":"#999",T.fill()}finally{T.restore()}}q([a-e,o-e],[a+e-l,o-e],[a+e,o-e+l],[a+e-l,o-e+l],[a+e-l,o-e],[a+e,o-e+l],[a+e,o+e],[a-e,o+e]),T.fillStyle=i?"#ccf":r?"#fcf":"#fff",T.fill(),T.strokeStyle=i?"#00f":r?"#808":"#999",T.stroke(),T.fillStyle="#000",T.fillText(n===u?"🚩":n===g?"🏁":"",a,o),2!==p||r||T.fillText("❌",a,o)}}else B(v),B(R),B(S),T.font="32px Arial",T.fillText(document.title,180,240)}finally{T.restore()}}})},Q=()=>{m=y[x[x.length-1]].filter(e=>!x.includes(e)),m.length?(p=1,C.t=""):x.length<f?(p=2,C.t="404 Not Found",K("triangle",.02,.2,.3,76,74,72)):r<4?(p=3,C.t="Next",K("triangle",.02,.2,.4,72,76,79,84)):(p=4,C.t="Congratulations!",K("triangle",.02,.2,.8,72,76,79,76,72,76,79,84))},U=e=>{if(m.includes(e))x.push(e),K("triangle",.02,.2,.1,69,71);else{if(!(x.length>1&&x.indexOf(e)===x.length-2))return;x.length--}Q(),~d&&(d=e),N()},_=()=>{U(x[x.length-2])},G=()=>{d=-1,x=[u],Q(),N()},H=(e,t)=>{let l=e[t];~l&&(H(e,l),e[l]=t)},I=()=>{let e=[[]],t=[-1];for(let l=1;l<f;l++){let n=~~(l/s),a=l%s,o=e[l]=[];n&&(o.push(l-s),e[l-s].push(l)),a&&(o.push(l-1),e[l-1].push(l)),t[l]=n%2?a<s-1?l+1:l-s:a?l-1:l-s}u=f-(i%2?1:s),g=0;for(let l=8*f;l--;){H(t,u),t[u]=-1,[u,g]=[g,u];let l=e[g].slice(0);for(let e=l.length;e--;)t[l[e]]===g&&l.splice(e,1);let n=l[~~(l.length*Math.random())],a=t[n];H(t,a),t[a]=-1,t[n]=g,g=a}y=[];for(let e=f;e--;){let l=t[e];y[e]=~l?[l]:[]}let l=[];for(let t=f;t--;)for(let n of e[t])t<n&&!y[t].includes(n)&&!y[n].includes(t)&&l.push([t,n]);(e=>{let t=e.length;for(;t;){let l=t*Math.random()|0,n=e[--t];e[t]=e[l],e[l]=n}})(l);for(let[e,t]of l.slice(0,~~(.8*l.length)))e===u||t===g||e!==g&&t!==u&&Math.random()<.5?y[e].push(t):y[t].push(e);G()},J=()=>{if(3===p&&r<4){r++,O.t="Level "+r+" / 4",i=s=r+2,f=i*s,h=Math.min(320/i,320/s);let e=h*i,t=h*s;c={x:(k-e)/2,y:(b-t)/2,w:e,h:t},I()}},W=()=>{r=0,p=3,K("triangle",0,0,0),J()},X=e=>{P=localStorage.pages_muted=e?1:0,R.t=P?"🔇Off":"🔊On",N()},Y=()=>{parent.location.href="https://github.com/stackshub/pages/blob/master/README.md"},j=()=>{p=0,X(P)},Z=e=>{let t=e.x-c.x,l=e.y-c.y;return t>0&&t<c.w&&l>0&&l<c.h?~~(t/h)*s+~~(l/h):-1},$=(e,t)=>t.x>=e.x&&t.x<e.x+e.w&&t.y>=e.y&&t.y<e.y+e.h,ee=e=>{let t=e.changedTouches,o=t?t[0]:e;return{x:(o.clientX-n)/l,y:(o.clientY-a)/l}},te=e=>{e.cancelable&&e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()};A.onmouseup=A.ontouchend=e=>{te(e),focus();let t=ee(e);p?~d?(d=-1,N()):$(M,t)?j():$(E,t)?I():$(V,t)?G():$(D,t)?_():$(C,t)&&J():$(S,t)?W():$(R,t)?X(!P):$(v,t)&&Y()},A.onmousemove=A.ontouchmove=e=>{if(te(e),p&&~d){let t=Z(ee(e));~t&&t!==d&&U(t)}},A.onmousedown=A.ontouchstart=e=>{if(te(e),p){let t=Z(ee(e)),l=x.indexOf(t)+1;l&&(l<x.length&&(x.length=l,Q()),d=t,N())}},onkeydown=e=>{if(!(e.altKey||e.ctrlKey||e.metaKey))if(te(e),p){let t=x[x.length-1],l=0;switch(e.key){case"Q":j();break;case"S":I();break;case"r":case"Escape":return void G();case"z":case"Backspace":case"Delete":return void _();case" ":case"Enter":return void J();case"d":case"ArrowRight":t<f-s&&(l=s);break;case"a":case"ArrowLeft":t>=s&&(l=-s);break;case"s":case"ArrowDown":t%s<s-1&&(l=1);break;case"w":case"ArrowUp":t%s&&(l=-1)}l&&U(t+l)}else switch(e.key){case"R":Y();break;case"M":X(!P);break;case" ":case"Enter":W()}};let le=()=>{e=A.width=innerWidth,t=A.height=innerHeight,l=Math.min(e/k,t/b),n=(e-k*l)/2,a=(t-b*l)/2,scrollTo(0,0)};onresize=()=>{le(),N()},onload=()=>{le(),focus(),j()};
