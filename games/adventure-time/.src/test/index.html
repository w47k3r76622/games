<head> <style>*{margin: 0; border: 0;}body{background-color: black;}div#f{color: white; float: right; margin: 40px; font-size: 25px;}canvas{background: black; width: 1100px; height: 600px;}button{background-color: #4CAF50; padding: 15px 32px; text-align: center;}.n{margin-top: 4px; margin-bottom: 4px;}.c{font-size: 18px; color: white;}.ins{position: fixed; right: 40px; padding : 20px; border: white solid 2px; bottom :40px;}#s{margin-top:100px}</style> <script src="kontra.min.js"></script></head><body> <div class="n c">Adventure Time: Save Princess</div><canvas width="352" height="176"></canvas> <div id="f"> <div class="c">Score: <span id="score">0</span> </div><button id="b" class="c" onclick="location.reload()">Restart</button> <div id="s">Game Started</div></div><div class="ins c">Mute: m</div><script>kon.init();var playscore=0,stag=document.getElementById("score"),s=document.getElementById("s");kon.assets.imagePath="assets/",kon.assets.dataPath="assets/",setTimeout(function(){s.innerHTML=""},2e3),kon.assets.load("terrain.json","new.png").then(function(){kon.assets.data.terrain;var t=kon.qtree();teg=kon.teg(kon.assets.data.terrain),teg.sx=0,teg.sy=0;var e=kon.spriteSheet({image:kon.assets.images.new,frameWidth:16,frameHeight:16,anim:{d:{frames:[90],frameRate:3,loop:!1},g:{frames:[91],frameRate:3,loop:!1},so:{frames:[100,101,102],frameRate:3,loop:!1},sc:{frames:[102,101,100],frameRate:3,loop:!1},sd:{frames:[100],frameRate:3,loop:!1},go:{frames:[48,93,9,59],frameRate:3,loop:!1},gc:{frames:[59,9,93,48],frameRate:3,loop:!1},gd:{frames:[48],frameRate:3,loop:!1},t:{frames:[103,104,105],frameRate:.1},swd:{frames:[61,62,63],frameRate:12},swu:{frames:[81,82,83],frameRate:12},r:{frames:[15],frameRate:6},wu:{frames:[44,34,24],frameRate:12},wl:{frames:[2,12,22],frameRate:12},wd:{frames:[10,76,1],frameRate:12},wr:{frames:[33,40,41],frameRate:12},dd:{frames:[11],frameRate:12},ps:{frames:[10,1],frameRate:3},ghu:{frames:[80,77,67],frameRate:6},gwl:{frames:[16,26,36],frameRate:6},ghd:{frames:[60,55,45],frameRate:6},gwr:{frames:[7,0,75],frameRate:6}}}),a=kon.pool({create:kon.sprite,maxSize:170});!function(){var t=[0,0,0,16,16,16,16,16,16,32,32,32,32,32,32,32,32,48,48,48,64,64,64,80,80,80,80,80,112,112,128,128,128,144,144,144,144,160,160,208,208,208,208,224,224,240,240,240,256,256,272,272,272,288,320,320,320,320,320,336,336,336,352,352,352,352,352,368,368,368,384,384,416,432,432,448,464,480,480,480,480,496,496,512,512,512,528,528,544,544],s=[720,768,816,432,464,736,768,784,832,352,368,384,448,496,720,768,816,352,368,384,64,80,96,64,80,96,688,704,496,512,256,272,512,256,272,496,512,256,272,336,640,672,704,304,720,320,368,688,320,368,624,656,688,704,176,208,240,624,672,192,224,704,176,208,240,480,848,192,224,832,496,848,480,1008,1088,1040,1008,576,640,688,1056,608,1024,16,656,688,48,512,16,80];for(var i in s){var r=s[i],n=t[i];a.get(function(t){return{x:r,y:n,startX:r,startY:n,anim:e.anim,ttl:1/0,type:t,way:1,update:function(){1==this.way&&(this.pAni(t),this.way=0),this.x=this.startX-teg.sx,this.y=this.startY-teg.sy}}}(["d","g"][Math.floor(2*Math.random())]))}for(var i in t=[144,144,512],s=[112,432,960])r=s[i],n=t[i],a.get({x:r,y:n,startX:r,startY:n,anim:e.anim,ttl:1/0,count:30,way:1,s:1,type:"s",toggle:function(){this.way?(this.pAni("so"),this.way=0):(this.pAni("sc"),this.way=1)},update:function(){this.adv(),this.s&&(this.pAni("sd"),this.s=0),this.x=this.startX-teg.sx,this.y=this.startY-teg.sy}});for(var i in t=[80,112,416],s=[400,80,672])r=s[i],n=t[i],a.get({x:r,y:n,startX:r,startY:n,way:1,start:1,anim:e.anim,ttl:1/0,type:"gt",toggle:function(){this.way?(this.pAni("go"),this.way=0):(this.pAni("gc"),this.way=1)},update:function(){this.adv(),this.start&&(this.pAni("gd"),this.start=0),this.x=this.startX-teg.sx,this.y=this.startY-teg.sy}});for(var i in t=[112,112,128,128,144,144,160,160,160,240,256,272,304,304,304,384,384,400,400,416,432,512,528,544],s=[448,704,448,704,448,704,832,848,864,928,928,928,1024,1040,1056,624,720,640,704,416,416,256,256,256])r=s[i],n=t[i],a.get({x:r,y:n,startX:r,startY:n,w:1,anim:e.anim,ttl:1/0,type:"t",update:function(){this.adv(),1==this.w&&(this.pAni("t"),this.w--),this.x=this.startX-teg.sx,this.y=this.startY-teg.sy}});t=[160,192,224,224,240,256,304,368,432],s=[944,64,496,992,656,1072,656,96,784];var h=[96,96,128,208,208,240,400,496,512,544,16,16,16,160,240,272,320,464,480,528,528],o=[736,800,544,288,384,192,32,432,208,464,752,800,848,1040,720,336,1088,544,976,304,368];for(var i in s)r=s[i],n=t[i],a.get({x:r,y:n,X:0,startX:r,startY:n,anim:e.anim,ttl:1/0,leftEdge:-32,rightEdge:48,speedx:.3,type:"gh",update:function(){this.adv(),this.X+=this.speedx,this.x=this.startX+this.X-teg.sx,this.y=this.startY-teg.sy,this.X<=this.leftEdge?this.speedx=Math.abs(this.speedx):this.X>=this.rightEdge&&(this.speedx=-Math.abs(this.speedx)),this.speedx>0?this.pAni("gwr"):this.speedx<0&&this.pAni("gwl")}});for(var i in o)r=o[i],n=h[i],a.get(function(t){return{x:r,y:n,Y:0,startX:r,startY:n,anim:e.anim,ttl:1/0,bottomEdge:48,topEdge:-32,speedy:.3,type:"gh",update:function(){this.adv(),this.Y+=this.speedy,this.x=this.startX-teg.sx,this.y=this.startY+this.Y-teg.sy,this.Y<=this.topEdge?this.speedy=Math.abs(this.speedy):this.Y>=this.bottomEdge&&(this.speedy=-Math.abs(this.speedy)),this.speedy>0?this.pAni(t+"d"):this.speedy<0&&this.pAni(t+"u")}}}(["sw","gh"][Math.floor(2*Math.random())]));for(var i in t=[208,224,480,112],s=[784,608,992,976])r=s[i],n=t[i],a.get({x:r,y:n,startX:r,startY:n,way:1,ttl:1/0,type:"r",anim:e.anim,update:function(){this.way&&(this.pAni("r"),this.way=0),this.x=this.startX-teg.sx,this.y=this.startY-teg.sy}})}(),a.get({x:752,y:208,startX:752,startY:208,time:0,anim:e.anim,ttl:1/0,type:"ps",update:function(){this.adv(),this.x=this.startX-teg.sx,this.y=this.startY-teg.sy,0==this.time?(this.pAni("ps"),this.time=60):this.time--}}),player=kon.sprite({x:176,y:88,speed:.8,startX:176,startY:88,w:1,anim:e.anim,update:function(){this.w&&(this.w=0,this.pAni("wd"));var t={y:this.y+4,x:this.x+2,width:10,height:10};if(kon.keys.pressed("up")){if(teg.layercWi("top",t))return;this.pAni("wu"),this.adv(),t.y-=this.speed,teg.sy>0&&this.y<=this.startY?teg.sy-=this.speed:this.y-=this.speed}else if(kon.keys.pressed("down")){if(this.pAni("wd"),this.adv(),t.y+=this.speed,teg.layercWi("top",t))return;teg.sy<teg.mapHeight-kon.canvas.height&&this.y>=this.startY?teg.sy+=this.speed:this.y+=this.speed}else if(kon.keys.pressed("left")){if(this.pAni("wl"),this.adv(),t.x-=this.speed,teg.layercWi("top",t))return;teg.sx>0&&this.x<=this.startX?teg.sx-=this.speed:this.x-=this.speed}else if(kon.keys.pressed("right")){if(this.pAni("wr"),this.adv(),t.x+=this.speed,teg.layercWi("top",t))return;teg.sx<teg.mapWidth-kon.canvas.width&&this.x>=this.startX?teg.sx+=this.speed:this.x+=this.speed}}});const i=new(window.AudioContext||window.webkitAudioContext);player.position.clamp(0,0,kon.canvas.width-player.width,kon.canvas.height-player.height);let r=new function(){this.playNote=function(t){const e=i.createOscillator();e.type="sine",e.frequency.value=t;const s=i.createGain();s.gain.value=.4,e.connect(s),s.connect(i.destination),e.start(0),s.gain.linearRampToValueAtTime(1e-4,i.currentTime+2.5),e.stop(i.currentTime+2.5)}},n=60,h=0,o=0;var p=[196,65.5,496,588,880,440,588,98,165,660,392,330,165,392,123.5,524,349],y=kon.gameLoop({update:function(){a.update(),a.update(),t.clear(),t.add(a.gAO());for(var e,s=t.get(player),d=0;e=s[d];d++)if("r"===e.type&&e.cWi(player)){var g,f,m=1,l=112;784==e.startX&&208==e.startY?(g=608,f=224,m=-1):608==e.startX&&224==e.startY?(g=784,f=208):992==e.startX&&480==e.startY?(g=976,f=112,l+=96):976==e.startX&&112==e.startY&&(g=992,f=480,l+=112),player.x=l+20*m,player.y=112+20*m,teg.sx=g-112,teg.sy=f-112}else if("ps"===e.type&&e.cWi(player))y.stop(),alert("Hurray, you princess!");else if("s"===e.type&&e.cWi(player))if(e.count)e.count--;else{e.toggle();var c={toggle:function(){}};112==e.startX&&144==e.startY?c=a.objects.find(t=>80===t.startX&&112==t.startY):432==e.startX&&144==e.startY?c=a.objects.find(t=>400===t.startX&&80==t.startY):960==e.startX&&512==e.startY&&(c=a.objects.find(t=>672===t.startX&&416==t.startY)),c.toggle(),e.count=30}else{if("gt"===e.type&&e.cWi(player)&&1==e.way)return player.y+=player.speed,void console.log(e);if("d"!==e.type&&"g"!=e.type||!e.cWi(player))"gh"!=e.type&&"t"!=e.type||!e.cWi(player)||(player.pAni("dd"),gameOver());else{var u=i.createOscillator(),w=i.createGain();u.connect(w);u.frequency.value=261.6,w.connect(i.destination),0==o&&(u.start(0),u.stop(i.currentTime+.1)),e.ttl=0,"d"==e.type&&(playscore+=100),"g"==e.type&&(playscore+=200),stag.innerHTML=playscore}}player.update(),0==o&&(0==n?(h++,h%=17,r.playNote(p[h]),n=60):n--)},render:function(){teg.render(),player.render(),a.render(),a.render()}});window.gameOver=function(){y.stop(),stag.innerHTML=0,s.innerHTML="GameOver"},y.start(),kon.keys.bind("m",function(){o=0==o?1:0})}); </script></body>
