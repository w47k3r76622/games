<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><script>window.$=document.querySelectorAll.bind(document),Node.prototype.on=window.on=function(o,t){this.addEventListener(o,t)},NodeList.prototype.__proto__=Array.prototype,NodeList.prototype.on=NodeList.prototype.addEventListener=function(o,t){this.forEach(function(e,n){e.on(o,t)})};</script><title>Flight Back Home</title><style type="text/css">body,html{width:100%;height:100%;margin:0;padding:0;font-family:Courier;background:#91b247}body{display:flex;flex-direction:column;height:100vh;justify-content:center}p{max-width:400px;padding:10px;margin:0}.content{flex:1}ul{list-style:none;margin:0}#lf>li{background-image:url(219711df21e2783adb6754ff12063580.svg);width:1.5em}#rw>li:before{content:"\1F6A9";margin-left:-20px;margin-right:10px}li{margin:5px;display:inline-block;height:1.5em;background-size:contain;background-repeat:no-repeat}.header{display:flex;background:#576c99;border-bottom:2px solid #9eb4db;flex-direction:row;position:absolute;top:0;width:100%}.footer,.header{justify-content:space-between;color:#fff;text-align:center;vertical-align:middle;font-family:monospace}#lvl{background:#9eb4db;padding:0 20px 0 10px;border-radius:0 20px 20px 0;font-size:2em}.footer{justify-content:center;font-size:1.3em;padding:5px 0;border:none;background:#b2acab;position:absolute;bottom:0;width:100%}.footer:empty{display:none}dialog{padding:0;border:0;border-radius:.6rem;box-shadow:0 0 1em #000}dialog::backdrop{background-color:rgba(0,0,0,.4)}#backdrop{display:none;position:fixed;top:0;right:0;bottom:0;left:0;background-color:rgba(0,0,0,.4)}dialog[open]{display:block;position:absolute;left:0;right:0;color:#000;margin:auto;border:initial solid;border-color:initial;border-image:initial;padding:1em;background:#f1f1f1;text-align:center;width:400px;max-width:80%;animation:fade .2s ease-out}@keyframes fade{0%{opacity:0}to{opacity:1}}.button,button{user-select:none;border-radius:5px;border:2px solid #fff;padding:10px;background:#9eb4db;color:#fff;text-decoration:none;margin:0 10px;font-family:Courier}.button:focus,button:focus{outline:none}h1{padding:10px;color:#576c99;font-size:2em;font-weight:700;text-align:center}h1,h2{margin:0}h2{padding:0}table{background:#e0e0e0;width:100%;padding:10px;margin:20px 0;text-align:left}.pb{padding-bottom:30px}</style></head><body><div class="bar header"><div id="lvl">X</div><ul id="lf"></ul><ul id="rw"></ul></div><canvas class="content"></canvas><div class="footer"></div><div id="backdrop"></div><dialog id="new-dialog"><svg width="155.73" height="143.49" viewBox="0 0 155.73 143.49" xmlns="http://www.w3.org/2000/svg"><path transform="matrix(.82334 .18301 -.18863 .79881 14.875 -28.777)" d="m184.45 81.554-24.934 82.496-83.911 19.655-58.977-62.841 24.934-82.496 83.911-19.655z" fill="#91b247" stroke="#fff" stroke-width="7.4537"/><g transform="matrix(.40233 -.38534 .39518 .38673 19.46 71.609)"><rect x="60.003" y="3.4984" width="38.754" height=".80181" ry=".4009" fill="#333" stroke-width=".076138"/><rect x="35.157" y="104.67" width="88.446" height="23.85" rx="13.957" ry="9.145" fill="#e0e0e8" stroke-width=".13616"/><rect x="1.5173" y="39.958" width="155.73" height="37.42" rx="41.211" ry="14.348" fill="#e0e0e8" stroke-width=".22631"/><rect x="72.826" y=".81089" width="13.109" height="16.823" rx="6.5546" ry="6.7001" fill="#e6e6e6" stroke-width=".043295"/><rect x="60.239" y="7.4752" width="38.284" height="136.83" rx="12.733" ry="54.493" fill="#e0e0e8" stroke-width=".211"/><path d="m36.89 68.423-7.9166-4.0098-7.7913 4.2483 1.3672-8.7683-6.448-6.0971 8.7616-1.4093 3.8062-8.0165 4.0478 7.8973 8.8004 1.1426-6.2599 6.2901z" fill="#c75c5c" stroke-width=".26458"/><path d="m141.93 67.888-7.9166-4.0098-7.7912 4.2483 1.3672-8.7683-6.448-6.0971 8.7616-1.4093 3.8062-8.0165 4.0478 7.8973 8.8004 1.1426-6.2599 6.2901z" fill="#c75c5c" stroke-width=".26458"/><ellipse cx="80.182" cy="70.561" rx="11.893" ry="28.619" fill="#77b3d4" stroke-width=".33999"/></g></svg><h1>Flight Back Home</h1><p class="pb">Watch the outbound flight and plot the journey back along exactly the same path to get home safely.</p><button class="new-game">Story Mode</button> <button class="options">Free Play</button></dialog><dialog id="lvl-dialog"><span></span> <button class="next">Continue</button></dialog><dialog id="over-dialog"><span></span> <button class="reset">Try Again</button></dialog><dialog id="options-dialog"><h1>Free Play</h1><p>In this mode you can select the level to play and how many lives.</p><table><tr><td>Flight Length</td><td><select id="opt-level"></select></td></tr><tr><td>Lifes</td><td><select id="opt-lifes"><option>1</option><option>2</option><option selected="selected">3</option><option>4</option><option>5</option></select></td></tr><tr><td>Rewinds</td><td><select id="opt-rewinds"><option>1</option><option>2</option><option selected="selected">3</option><option>4</option><option>5</option></select></td></tr></table><button class="reset">Back</button> <button class="free-game">Play</button></dialog><script type="tx" id="lvl-tmp"><h1>Level {{level}} Pilot</h1>
    {{message}}
    <table>
        <tr>
            <td colspan=2><h2>Flight Plan</h2></td>
        </tr>
        <tr>
            <td>Distance</td>
            <td>{{distance}} sectors</td>
        </tr>
        <tr>
            <td>Speed</td>
            <td>{{speed}} mph</td>
        </tr>
    </table></script><script type="tx" id="story-over-tmp"><h1>Game Over</h1>
    <p class="pb">Congratulations on reaching level {{level}} however you have run out of planes!</p>
    <a class="button" target="_" href="http://www.twitter.com/share?text=I reached pilot level {{level}} on 'Flight Back Home' a JS13K game entry by @johnkilmister. Try it out yourself at {{url}} #js13k #flightbackhome">Tweet Score</a></script><script type="tx" id="free-over-tmp"><h1>Game Over</h1>
        <p class="pb">Congratulations on {{flights}} flights at level {{level}} however you have run out of planes!</p>
        <a class="button" target="_" href="http://www.twitter.com/share?text=I reached {{flights}} flights at level {{level}} on 'Flight Back Home' a JS13K game entry by @johnkilmister. Try it out yourself at {{url}} #js13k #flightbackhome">Tweet Score</a></script><script type="text/javascript">!function(t){var e={};function i(s){if(e[s])return e[s].exports;var h=e[s]={i:s,l:!1,exports:{}};return t[s].call(h.exports,h,h.exports,i),h.l=!0,h.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var h in t)i.d(s,h,function(e){return t[e]}.bind(null,h));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=3)}([function(t,e,i){t.exports=i.p+"219711df21e2783adb6754ff12063580.svg"},function(t,e,i){function s(){this.setSettings=function(t){for(var e=0;e<24;e++)this[String.fromCharCode(97+e)]=t[e]||0;this.c<.01&&(this.c=.01);var i=this.b+this.c+this.e;if(i<.18){var s=.18/i;this.b*=s,this.c*=s,this.e*=s}}}var h=new function(){var t,e,i,h,n,r,o,a,l,c,u,d;this._params=new s,this.reset=function(){var t=this._params;h=100/(t.f*t.f+.001),n=100/(t.g*t.g+.001),r=1-t.h*t.h*t.h*.01,o=-t.i*t.i*t.i*1e-6,t.a||(u=.5-t.n/2,d=5e-5*-t.o),a=1+t.l*t.l*(t.l>0?-.9:10),l=0,c=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.totalReset=function(){this.reset();var s=this._params;return t=s.b*s.b*1e5,e=s.c*s.c*1e5,i=s.e*s.e*1e5+12,3*((t+e+i)/3|0)},this.synthWave=function(s,f){var p=this._params,g=1!=p.s||p.v,m=p.v*p.v*.1,y=1+3e-4*p.w,v=p.s*p.s*p.s*.1,w=1+1e-4*p.t,x=1!=p.s,b=p.x*p.x,_=p.g,M=p.q||p.r,C=p.r*p.r*p.r*.2,T=p.q*p.q*(p.q<0?-1020:1020),k=p.p?32+((1-p.p)*(1-p.p)*2e4|0):0,j=p.d,A=p.j/2,S=p.k*p.k*.01,P=p.a,$=t,L=1/t,E=1/e,R=1/i,O=5/(1+p.u*p.u*20)*(.01+v);O>.8&&(O=.8),O=1-O;for(var D,I,W,z,H,q,Y=!1,F=0,U=0,B=0,G=0,X=0,J=0,K=0,N=0,Q=0,V=0,Z=new Array(1024),tt=new Array(32),et=Z.length;et--;)Z[et]=0;for(et=tt.length;et--;)tt[et]=2*Math.random()-1;for(et=0;et<f;et++){if(Y)return et;if(k&&++Q>=k&&(Q=0,this.reset()),c&&++l>=c&&(c=0,h*=a),(h*=r+=o)>n&&(h=n,_>0&&(Y=!0)),I=h,A>0&&(V+=S,I*=1+Math.sin(V)*A),(I|=0)<8&&(I=8),P||((u+=d)<0?u=0:u>.5&&(u=.5)),++U>$)switch(U=0,++F){case 1:$=e;break;case 2:$=i}switch(F){case 0:B=U*L;break;case 1:B=1+2*(1-U*E)*j;break;case 2:B=1-U*R;break;case 3:B=0,Y=!0}M&&((W=0|(T+=C))<0?W=-W:W>1023&&(W=1023)),g&&y&&((m*=y)<1e-5?m=1e-5:m>.1&&(m=.1)),q=0;for(var it=8;it--;){if(++K>=I&&(K%=I,3==P))for(var st=tt.length;st--;)tt[st]=2*Math.random()-1;switch(P){case 0:H=K/I<u?.5:-.5;break;case 1:H=1-K/I*2;break;case 2:H=.225*(((H=1.27323954*(z=6.28318531*((z=K/I)>.5?z-1:z))+.405284735*z*z*(z<0?1:-1))<0?-1:1)*H*H-H)+H;break;case 3:H=tt[Math.abs(32*K/I|0)]}g&&(D=J,(v*=w)<0?v=0:v>.1&&(v=.1),x?(X+=(H-J)*v,X*=O):(J=H,X=0),G+=(J+=X)-D,H=G*=1-m),M&&(Z[N%1024]=H,H+=Z[(N-W+1024)%1024],N++),q+=H}q*=.125*B*b,s[et]=q>=1?32767:q<=-1?-32768:32767*q|0}return f}};t.exports=function(t){h._params.setSettings(t);var e=h.totalReset(),i=new Uint8Array(4*((e+1)/2|0)+44),s=2*h.synthWave(new Uint16Array(i.buffer,44),e),n=new Uint32Array(i.buffer,0,44);n[0]=1179011410,n[1]=s+36,n[2]=1163280727,n[3]=544501094,n[4]=16,n[5]=65537,n[6]=44100,n[7]=88200,n[8]=1048578,n[9]=1635017060,n[10]=s,s+=44;for(var r=0,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a="data:audio/wav;base64,";r<s;r+=3){var l=i[r]<<16|i[r+1]<<8|i[r+2];a+=o[l>>18]+o[l>>12&63]+o[l>>6&63]+o[63&l]}return a}},function(t,e,i){},function(t,e,i){"use strict";i.r(e);let s,h,n={};function r(t,e){n[t]=n[t]||[],n[t].push(e)}function o(t,...e){n[t]&&n[t].map(t=>t(...e))}function a(){return s}function l(){return h}function c(t){if(!(s=document.getElementById(t)||t||document.querySelector("canvas")))throw Error("You must provide a canvas element for the game");return(h=s.getContext("2d")).imageSmoothingEnabled=!1,o("init"),{canvas:s,context:h}}class u{constructor({spriteSheet:t,frames:e,frameRate:i,loop:s=!0}={}){this.spriteSheet=t,this.frames=e,this.frameRate=i,this.loop=s;let{width:h,height:n,margin:r=0}=t.frame;this.width=h,this.height=n,this.margin=r,this._f=0,this._a=0}clone(){return d(this)}reset(){this._f=0,this._a=0}update(t=1/60){if(this.loop||this._f!=this.frames.length-1)for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}render({x:t,y:e,width:i=this.width,height:s=this.height,context:h=l()}={}){let n=this.frames[this._f]/this.spriteSheet._f|0,r=this.frames[this._f]%this.spriteSheet._f|0;h.drawImage(this.spriteSheet.image,r*this.width+(2*r+1)*this.margin,n*this.height+(2*n+1)*this.margin,this.width,this.height,t,e,i,s)}}function d(t){return new u(t)}d.prototype=u.prototype,d.class=u;new WeakMap;const f=()=>{};function p(){let t=a();l().clearRect(0,0,t.width,t.height)}function g({fps:t=60,clearCanvas:e=!0,update:i,render:s}={}){if(!i||!s)throw Error("You must provide update() and render() functions");let h,n,r,a,l,c=0,u=1e3/t,d=1/t,g=e?p:f;function m(){if(n=requestAnimationFrame(m),r=performance.now(),a=r-h,h=r,!(a>1e3)){for(o("tick"),c+=a;c>=u;)l.update(d),c-=u;g(),l.render()}}return l={update:i,render:s,isStopped:!0,start(){h=performance.now(),this.isStopped=!1,requestAnimationFrame(m)},stop(){this.isStopped=!0,cancelAnimationFrame(n)},_frame:m,set _last(t){h=t}}}let m=[],y=[],v={},w=[],x={},b={0:"left",1:"middle",2:"right"},_={x:0,y:0,radius:5};function M(t){let e=t.x,i=t.y;t.anchor&&(e-=t.width*t.anchor.x,i-=t.height*t.anchor.y);let s=_.x-Math.max(e,Math.min(_.x,e+t.width)),h=_.y-Math.max(i,Math.min(_.y,i+t.height));return s*s+h*h<_.radius*_.radius}function C(){let t,e,i=y.length?y:m;for(let s=i.length-1;s>=0;s--)if(e=(t=i[s]).collidesWithPointer?t.collidesWithPointer(_):M(t))return t}function T(t){let e=void 0!==t.button?b[t.button]:"left";x[e]=!0,S(t,"onDown")}function k(t){let e=void 0!==t.button?b[t.button]:"left";x[e]=!1,S(t,"onUp")}function j(t){S(t,"onOver")}function A(){x={}}function S(t,e){let i,s,h=a();if(!h)return;-1!==["touchstart","touchmove","touchend"].indexOf(t.type)?(i=(t.touches[0]||t.changedTouches[0]).clientX,s=(t.touches[0]||t.changedTouches[0]).clientY):(i=t.clientX,s=t.clientY);let n=h.height/h.offsetHeight,r=h.getBoundingClientRect(),o=(i-r.left)*n,l=(s-r.top)*n;_.x=o,_.y=l,t.preventDefault();let c=C();c&&c[e]&&c[e](t),v[e]&&v[e](t,c)}function P(){let t=a();t.addEventListener("mousedown",T),t.addEventListener("touchstart",T),t.addEventListener("mouseup",k),t.addEventListener("touchend",k),t.addEventListener("blur",A),t.addEventListener("mousemove",j),t.addEventListener("touchmove",j),r("tick",()=>{y.length=0,m.map(t=>{y.push(t)}),m.length=0})}function L(t){[].concat(t).map(t=>{t._r||(t._r=t.render,t.render=function(){m.push(this),this._r()},w.push(t))})}function E(t){v.onDown=t}class R{constructor({create:t,maxSize:e=1024}={}){let i;if(!t||!(i=t())||!(i.update&&i.init&&i.isAlive))throw Error("Must provide create() function which returns an object with init(), update(), and isAlive() functions");this._c=t,this._i=0,this.objects=[t()],this.size=1,this.maxSize=e}get(t={}){if(this.objects.length==this._i){if(this.size===this.maxSize)return;for(let t=0;t<this.size&&this.objects.length<this.maxSize;t++)this.objects.unshift(this._c());this.size=this.objects.length}let e=this.objects.shift();return e.init(t),this.objects.push(e),this._i++,e}getAliveObjects(){return this.objects.slice(this.objects.length-this._i)}clear(){this._i=this.objects.length=0,this.size=1,this.objects.push(this._c())}update(t){let e,i=this.size-1,s=Math.max(this.objects.length-this._i,0);for(;i>=s;)(e=this.objects[i]).update(t),e.isAlive()?i--:(this.objects=this.objects.splice(i,1).concat(this.objects),this._i--,s++)}render(){let t=Math.max(this.objects.length-this._i,0);for(let e=this.size-1;e>=t;e--)this.objects[e].render()}}function O(t){return new R(t)}function D(t,e){let i=[],s=e.x+e.width/2,h=e.y+e.height/2,n=t.y<h&&t.y+t.height>=e.y,r=t.y+t.height>=h&&t.y<e.y+e.height;return t.x<s&&t.x+t.width>=e.x&&(n&&i.push(0),r&&i.push(2)),t.x+t.width>=s&&t.x<e.x+e.width&&(n&&i.push(1),r&&i.push(3)),i}O.prototype=R.prototype,O.class=R;class I{constructor({maxDepth:t=3,maxObjects:e=25,bounds:i}={}){this.maxDepth=t,this.maxObjects=e;let s=a();this.bounds=i||{x:0,y:0,width:s.width,height:s.height},this._b=!1,this._d=0,this._o=[],this._s=[],this._p=null}clear(){this._s.map(function(t){t.clear()}),this._b=!1,this._o.length=0}get(t){let e,i,s=new Set;for(;this._s.length&&this._b;){for(e=D(t,this.bounds),i=0;i<e.length;i++)this._s[e[i]].get(t).forEach(t=>s.add(t));return Array.from(s)}return this._o.filter(e=>e!==t)}add(){let t,e,i,s;for(e=0;e<arguments.length;e++)if(i=arguments[e],Array.isArray(i))this.add.apply(this,i);else if(this._b)this._a(i);else if(this._o.push(i),this._o.length>this.maxObjects&&this._d<this.maxDepth){for(this._sp(),t=0;s=this._o[t];t++)this._a(s);this._o.length=0}}_a(t,e,i){for(e=D(t,this.bounds),i=0;i<e.length;i++)this._s[e[i]].add(t)}_sp(t,e,i){if(this._b=!0,!this._s.length)for(t=this.bounds.width/2|0,e=this.bounds.height/2|0,i=0;i<4;i++)this._s[i]=W({bounds:{x:this.bounds.x+(i%2==1?t:0),y:this.bounds.y+(i>=2?e:0),width:t,height:e},maxDepth:this.maxDepth,maxObjects:this.maxObjects}),this._s[i]._d=this._d+1,this._s[i]._p=this}}function W(t){return new I(t)}W.prototype=I.prototype,W.class=I;class z{constructor(t,e){this._x=t||0,this._y=e||0}add(t,e){return H(this.x+(t.x||0)*(e||1),this.y+(t.y||0)*(e||1))}clamp(t,e,i,s){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?Math.min(Math.max(this._a,t),this._d):t}set y(t){this._y=this._c?Math.min(Math.max(this._b,t),this._e):t}}function H(t,e){return new z(t,e)}H.prototype=z.prototype,H.class=z;class q{constructor(t){this.init(t)}init(t={}){let{x:e,y:i,dx:s,dy:h,ddx:n,ddy:r,width:o,height:a,image:c}=t;this.position=H(e,i),this.velocity=H(s,h),this.acceleration=H(n,r),this.width=this.height=this.rotation=0,this.ttl=1/0,this.anchor={x:0,y:0},this.context=l();for(let e in t)this[e]=t[e];c&&(this.width=void 0!==o?o:c.width,this.height=void 0!==a?a:c.height)}get x(){return this.position.x}get y(){return this.position.y}get dx(){return this.velocity.x}get dy(){return this.velocity.y}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}get animations(){return this._a}set x(t){this.position.x=t}set y(t){this.position.y=t}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}set animations(t){let e,i;for(e in this._a={},t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}isAlive(){return this.ttl>0}collidesWith(t){if(this.rotation||t.rotation)return null;let e=this.x-this.width*this.anchor.x,i=this.y-this.height*this.anchor.y,s=t.x,h=t.y;return t.anchor&&(s-=t.width*t.anchor.x,h-=t.height*t.anchor.y),e<s+t.width&&e+this.width>s&&i<h+t.height&&i+this.height>h}update(t){this.advance(t)}render(){this.draw()}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){this.velocity=this.velocity.add(this.acceleration,t),this.position=this.position.add(this.velocity,t),this.ttl--,this.currentAnimation&&this.currentAnimation.update(t)}draw(){let t=-this.width*this.anchor.x,e=-this.height*this.anchor.y;this.context.save(),this.context.translate(this.x,this.y),this.rotation&&this.context.rotate(this.rotation),this.image?this.context.drawImage(this.image,0,0,this.image.width,this.image.height,t,e,this.width,this.height):this.currentAnimation?this.currentAnimation.render({x:t,y:e,width:this.width,height:this.height,context:this.context}):(this.context.fillStyle=this.color,this.context.fillRect(t,e,this.width,this.height)),this.context.restore()}}function Y(t){return new q(t)}function F(t){if(+t===t)return t;let e=[],i=t.split(".."),s=+i[0],h=+i[1],n=s;if(s<h)for(;n<=h;n++)e.push(n);else for(;n>=h;n--)e.push(n);return e}Y.prototype=q.prototype,Y.class=q;class U{constructor({image:t,frameWidth:e,frameHeight:i,frameMargin:s,animations:h}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:e,height:i,margin:s},this._f=t.width/e|0,this.createAnimations(h)}createAnimations(t){let e,i;for(i in t){let{frames:s,frameRate:h,loop:n}=t[i];if(e=[],void 0===s)throw Error("Animation "+i+" must provide a frames property");[].concat(s).map(t=>{e=e.concat(F(t))}),this.animations[i]=d({spriteSheet:this,frames:e,frameRate:h,loop:n})}}}function B(t){return new U(t)}B.prototype=U.prototype,B.class=U;var G=i(0),X=i.n(G);function J(t){return Math.floor(Math.random()*Math.floor(t))}const K=i(1),N={gameOver:[0,,.0249,.3547,.3999,.5186,,,,,,,,,,,,,1,,,,,.5],crash:[3,,.3862,.4342,.2399,.1505,,-.2944,,,,.34,.8579,,,.7022,,,1,,,,,.5],start:[1,,.1031,,.1284,.5261,,,,,,,,,,,,,1,,,.1,,.5],nextCell:[0,,.0711,.3423,.4561,.4235,,,,,,,,,,,,,1,,,,,.5],levelup:[0,,.2254,,.4779,.2773,,.3754,,,,,,.0559,,.5794,,,1,,,,,.5]};function Q(t){var e=K(t),i=new Audio;i.src=e,i.play()}function V(t){tt()?$(t)[0].hasAttribute("open")||$(t)[0].showModal():($(t)[0].setAttribute("open",""),$("#backdrop")[0].style.display="block")}function Z(t){tt()?$(t)[0].close():($(t)[0].removeAttribute("open"),$("#backdrop")[0].style.display="none"),Q(N.start)}function tt(){return"function"==typeof HTMLDialogElement}function et(t,e,i,s){var h=["#a9be63","#91b247","#85a037"],n=h[J(h.length)];return Y({x:t,y:e,color:"#eaeaea",fill:n,width:50,height:43.30127,row:s,col:i,resetHome:function(){this.previous=null,this.next=null},reset:function(){this.status=null,this.fill=n,this.previous=null,this.next=null,clearTimeout(this.fade)},onHit:function(){"home"!=this.status&&(this.status="hit",this.fill="#9eb4db")},collidesWithPointer:function(t){let e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)<this.width/2},collidesWithCentre:function(t){let e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)<4},update:function(t){if(t&&this.collidesWithPointer(t)&&"active"===this.status&&"#9eb4db"!=this.fill){let t=this.fill;this.fill="#9eb4db",this.fade=setTimeout((t,e)=>{t.fill=e},500,this,t)}"end"!=this.status&&"home"!=this.status||(this.fill="#b2acab")},render:function(){var t=this.context,e=this.x+Math.cos(2*Math.PI/6)*this.width/2,i=this.y+Math.sin(2*Math.PI/6)*(this.height/2*1.1547005);t.setLineDash([]),t.beginPath(),t.moveTo(e,i),this.fill&&(t.fillStyle=this.fill),t.strokeStyle=this.color,t.lineWidth=.5;for(var s=1;s<7;s++)e=this.x+Math.cos(2*Math.PI/6*s)*this.width/2,i=this.y+Math.sin(2*Math.PI/6*s)*(this.height/2*1.1547005),t.lineTo(e,i);t.closePath(),t.fill(),t.stroke(),t.strokeStyle="#576c99",t.lineWidth=2,t.beginPath(),t.setLineDash([5,5]),this.previous&&(t.moveTo(this.previous.x,this.previous.y),t.lineTo(this.x,this.y)),this.next&&(t.moveTo(this.x,this.y),t.lineTo(this.next.x,this.next.y)),t.closePath(),t.stroke()}})}function it(t,e,i){let s=$(e)[0].innerHTML;Object.keys(t).forEach(e=>s=s.replace(new RegExp("{{"+e+"}}","g"),t[e])),$(i)[0].innerHTML=s}function st(t,e,i){if("free"==i)return 0==e?"":1==e?"First flight completed!":e+" flights completed.";let s=[{lvl:1,msg:"Welcome to pilot flight school. The instructor will show you the route, then just follow the route back and try not to crash the plane!"},{lvl:2,msg:"Let’s try it again before moving on to a harder route."},{lvl:3,msg:"You have made it past the third flight, lets now make the route a bit longer…"},{lvl:5,msg:"Did you know if you forget the route you can re-wind up to 3 times by using the flags in the top corner."},{lvl:9,msg:"A lot of pilots do not make it this far, time to make it a bit harder."},{lvl:10,msg:"Level 10, that is impressive. You are out pacing the other students in your class. Have another plane to help you out."},{lvl:15,msg:"Wow you are acing this, you will be flying longer routes soon."},{lvl:30,msg:"To be honest I did not thing anyone would fly this many flights!"}].find(e=>e.lvl==t);return null!=s?s.msg:""}function ht(t){let e=[{state:"out",msg:"Memorize the route..."},{state:"pending",msg:"Route set please wait..."},{state:"back",msg:"Plot the same route back."},{state:"show",msg:"Plane down, try again..."},{state:"levelup",msg:"Your going places!"},{state:"new",msg:""},{state:"over",msg:""}].find(e=>e.state==t);return null!=e?e.msg:t}function nt(t,e){let i=function(t){let e=Math.ceil(t.width/37.5),i=(t.height-35)/43.30127,s=[];const h=Math.floor(e/2),n=Math.floor(i/2);let r;for(let t=0;t<e;t++)for(let e=0;e<i;e++){let i=43*e,o=et(12.5+37.5*t,(i+=t%2?21.5:0)+35,t,e);L(o),t==h&&e==n&&(o.status="home",r=o),s.push(o)}return{hexMap:s,centreCell:r}}(e);return t.x=i.centreCell.x,t.y=i.centreCell.y,{mode:"story",state:"new",level:1,lifes:3,flights:0,targetCells:null,hexMap:i.hexMap,centreCell:i.centreCell,player:t,resetGame:function(){this.mode="story",this.flights=0,this.level=1,this.lifes=3,this.rewinds=3},resetLevel:function(){this.state="out",this.targetCells=function(t,e,i){let s=[[0,-1],[-1,-1],[-1,0],[0,1],[1,0],[1,-1]],h=[[0,-1],[-1,0],[-1,1],[0,1],[1,1],[1,0]];e=e.map(t=>("home"!=t.status?t.reset():t.resetHome(),t));let n=[],r=t,o=Math.floor(i/3)+5,a=0;for(n.push(t);n.length<=o&&a<100;){let t=r.col%2==0?s[J(6)]:h[J(6)],i=e.find(e=>e.col===r.col+t[0]&&e.row===r.row+t[1]);i&&!i.status?(n.length===o?i.status="end":(i.status="active",L(i)),n.push(i),r=i):a++}return n}(this.centreCell,this.hexMap,this.level),this.player.reset(this.centreCell.x,this.centreCell.y),this.drawRouteOut()},rewind:function(){"back"===this.state&&this.rewinds>0&&1==confirm("Do you wish to use a rewind to replay the route?")&&(this.rewinds--,this.player.reset(this.centreCell.x,this.centreCell.y),this.hexMap=this.hexMap.map(t=>("home"!=t.status&&"end"!=t.status?t.reset():t.resetHome(),t)),this.targetCells=this.targetCells.map(t=>("hit"===t.status&&(t.status="active"),t)),this.drawRouteOut())},showPlan:function(){it({level:this.level,message:st(this.level,this.flights,this.mode),speed:150*this.player.speed,distance:Math.floor(this.level/3)+5},"#lvl-tmp","#lvl-dialog>span"),V("#lvl-dialog")},onPointerDown(t){if(("new"===this.state||"show"===this.state)&&this.lifes>0&&this.resetLevel(),"back"===this.state){Q(N.nextCell);var e=this.targetCells.filter(t=>"hit"!=t.status&&"end"!=t.status),i=e[e.length-1];if(t.onHit(),this.player.moveToCell(t),t===i)return void(1===e.length&&(this.state="pending",this.player.afterMove=()=>{this.state="levelup",this.flights++,Q(N.levelup),"free"!=this.mode&&(this.level++,this.level%10==0&&this.lifes++),this.showPlan()}));this.state="pending",this.player.afterMove=()=>{Q(N.crash),this.lifes--,this.reaminingRoute(),0===this.lifes&&setTimeout(()=>{this.state="over",it({flights:this.flights,level:this.level,url:window.location.href},"story"==this.mode?"#story-over-tmp":"#free-over-tmp","#over-dialog>span"),V("#over-dialog")},3e3)}}},reaminingRoute:function(){this.state="show",this.targetCells.map((t,e)=>{e>0&&(t.previous=this.targetCells[e-1]),e!=this.targetCells.length&&(t.next=this.targetCells[e+1]),"active"===t.status&&(t.fill="#97d2da")})},drawRouteOut:function(){for(let t=0;t<this.targetCells.length;t++)this.player.moveToCell(this.targetCells[t]);this.state="out"},update:function(){"out"==this.state&&null==this.player.currentTarget&&(this.state="back")},render:function(){this.domReady&&($(".footer")[0].innerText!=ht(this.state)&&($(".footer")[0].innerText=ht(this.state)),$("#lvl")[0].innerText!="Level "+this.level&&($("#lvl")[0].innerText="Level "+this.level),$("#lf")[0].children.length!=Math.max(this.lifes,0)&&($("#lf")[0].innerHTML="<li></li>".repeat(this.lifes)),$("#rw")[0].children.length!=Math.max(this.rewinds,0)&&($("#rw")[0].innerHTML="<li></li>".repeat(this.rewinds)))}}}function rt(t){$(".reset").forEach(t=>{t.on("click",()=>{Z("#options-dialog"),Z("#over-dialog"),V("#new-dialog")})}),$(".new-game")[0].on("click",()=>{t.resetGame(),Z("#new-dialog"),t.showPlan()}),$(".options")[0].on("click",()=>{Z("#new-dialog"),V("#options-dialog")}),$(".free-game")[0].on("click",()=>{Z("#options-dialog"),t.resetGame(),t.level=parseInt($("#opt-level")[0].value),t.lifes=parseInt($("#opt-lifes")[0].value),t.rewinds=parseInt($("#opt-rewinds")[0].value),t.mode="free",t.showPlan()}),$("#lvl-dialog>.next")[0].on("click",()=>{t.resetLevel(),Z("#lvl-dialog")})}let ot,at,{canvas:lt}=c();function ct(){var t=lt.getBoundingClientRect();lt.width=t.width,lt.height=t.height-t.top,ot=function(){const t=new Image;return t.src=X.a,Y({x:0,y:0,width:27.6,height:30,cw:!0,rotation:0,dr:0,dx:0,dy:0,scale:1,pathCells:[],speed:1,currentTarget:null,afterMove:null,reset:function(t,e){this.pathCells=[],this.rotation=0,this.dr=0,this.dx=0,this.dy=0,this.x=t,this.y=e},moveToCell:function(t){t&&this.pathCells.push(t)},update:function(){if(!this.currentTarget&&this.afterMove&&(this.afterMove(),this.afterMove=null),Math.abs(this.dr-this.rotation)>10)this.cw?this.rotation+=4:this.rotation-=4,this.rotation>360&&(this.rotation=0),this.rotation<0&&(this.rotation=360);else if(this.pathCells.length>0)if(this.currentTarget&&this.currentTarget.collidesWithCentre(this)&&this.pathCells.splice(0,1),this.pathCells.length>0){this.currentTarget=this.pathCells[0];let t=Math.atan2(this.currentTarget.y-this.y,this.currentTarget.x-this.x);this.dr=(180*t/Math.PI+90+360)%360;let e=this.dr-this.rotation;e<0&&(e+=360),this.cw=!(e>180),this.dx=Math.cos(t)*this.speed,this.dy=Math.sin(t)*this.speed,this.x+=this.dx,this.y+=this.dy,this.scale=1.1}else this.currentTarget=null,this.scale=1},render:function(){if(t){let e=this.context;e.setTransform(this.scale,0,0,this.scale,this.x,this.y),e.rotate(this.rotation*Math.PI/180),e.drawImage(t,-this.width/2,-this.height/2,this.width,this.height),e.setTransform(1,0,0,1,0,0)}}})}(),at=nt(ot,lt),V("#new-dialog")}P(),E(function(t,e){at&&at.onPointerDown(e)}),window.addEventListener("resize",function(){ct(),at.domReady=!0,rt(at)},!0),document.addEventListener("DOMContentLoaded",function(t){ct(),at.domReady=!0,rt(at);for(let t=5;t<20;t++){var e=document.createElement("option");e.value=Math.max(1,3*(t-5)),e.text=t+" Sectors",$("#opt-level")[0].appendChild(e)}$("#rw")[0].on("click",()=>{at.rewind()}),g({update:function(){ot.update(),at.hexMap.map(t=>t.update(ot)),at.update()},render:function(){at.hexMap.map(t=>t.render()),ot.render(),at.render()}}).start()});i(2)}]);</script></body></html>