!function(){function t(){k.innerHTML=localStorage.highestScore||0,q.innerHTML=y.reduceRight(n,""),addEventListener("keydown",r)}function e(t){return O[t]||(O[t]=document.querySelector(t))}function n(t,e){return'<div class="className-wrapper wrapper"><div class="className track-block"></div>child</div>'.replace(/className/g,(""===t?"last ":"")+e).replace("child",t)}function r(t){var e=i(t);if(setTimeout(function(){S.scrollIntoView()},0),!L.gameOver)if(L.pause)u();else if(e)return t.preventDefault(),e(),!1}function i(t){return{39:a.bind(null,"right"),68:a.bind(null,"right"),37:a.bind(null,"left"),65:a.bind(null,"left"),27:u,32:s.bind(null,t)}[t.keyCode]}function a(t){L.turns.length<2&&L.turns.push(t)}function u(){L.pause=!L.pause,S.classList.add("left-behind"),L.pause?x.stop():(o(),c())}function s(){var t;L.jump||(T.setAttribute("class","player jumping"),L.jump=!0,x.stop(),setTimeout(function(){t=l({gain:1})},1450),setTimeout(function(){L.gameOver||(L.jump=!1,t.stop(),o())},1500))}function o(){x=l({gain:.25}),T.setAttribute("class","player running")}function l(t){if(!M)return{stop:function(){}};var e=Y.createGain(),n=Y.createOscillator();return t=t||{},e.gain.value=t.gain||1,n.type=t.type||"square",n.frequency.value=t.frequency||1,n.detune.value=0,n.connect(e),n.start(t.delay||0),e.connect(Y.destination),n}function c(){j>1&&f(),j+=g(),q.style.transform=h(),k.innerHTML=b(),"jump"!==y[0]||L.jump||w(),L.pause||requestAnimationFrame(c)}function f(){if(j=0,-1!==["right","left"].indexOf(y[0])&&L.turns[0]!==y[0]||-1===["right","left"].indexOf(y[0])&&L.turns[0])throw w();p(),L.turns.shift(),0===L.turns.length&&L.turns.push(!1),y.shift(),A++,y.push(d()),q.innerHTML=y.reduceRight(n,"")}function p(){var t=["left","right","jump"];t.forEach(function(t){e("#"+t).classList.remove("to-be-pressed")}),t.indexOf(y[2])>-1&&e("#"+y[2]).classList.add("to-be-pressed")}function d(){var t=Math.random().toString()[2];return{1:"left",2:"right",3:"down",5:"jump"!==y[y.length-1]&&"jump"}[t]||"straight"}function g(){return["left","right","down"].indexOf(y[0])>-1?.03:.02}function h(){return"rotateX(45deg) "+(m()||v()||"translateY("+-128*j+"px)")}function m(){return{left:"translateY("+-64*j+"px) translateX("+-64*j+"px) rotateZ("+-90*j+"deg)",right:"translateY("+-64*j+"px) translateX("+64*j+"px) rotateZ("+90*j+"deg)"}[L.turns[0]]}function v(){return{down:"translateY("+-128*j+"px) translateZ("+64*j+"px)",up:"translateY("+-128*j+"px) translateZ("+-64*j+"px)"}[y[0]]}function w(){localStorage.highestScore=b(),T.setAttribute("class","player"),requestAnimationFrame(function(){T.setAttribute("class","player fell")}),x.stop(),L.pause=!0,L.gameOver=!0,setTimeout(location.reload.bind(location),1e3)}function b(){return A/2|0}var x,y=["straight","down","left","jump","straight","right"],j=0,A=0,L={turns:[],pause:!0},O={},T=e(".player"),k=e(".score"),q=e(".track"),S=e(".wall"),M=window.AudioContext||window.webkitAudioContext,Y=M&&new M;t()}();
