var CPlayer=function(){var e,o,a,r,l,s=function(e){return Math.sin(6.283184*e)},c=function(e){return .003959503758*2**((e-128)/12)},p=function(t,o,n){var a,i,r,l,s,p,y=d[t.i[0]],m=t.i[1],h=t.i[3]/32,u=d[t.i[4]],g=t.i[5],x=t.i[8]/32,A=t.i[9],f=4*(t.i[10]*t.i[10]),k=4*(t.i[11]*t.i[11]),v=4*(t.i[12]*t.i[12]),P=-t.i[13]/16,L=t.i[14],C=n*2**(2-t.i[15]),w=new Int32Array(f+k+v),S=0,b=0;for(a=0,i=0;a<f+k+v;a++,i++)0<=i&&(L=L>>8|(255&L)<<4,i-=C,s=c(o+(15&L)+t.i[2]-128),p=c(o+(15&L)+t.i[6]-128)*(1+8e-4*t.i[7])),r=1,a<f?r=a/f:a>=f+k&&(r=(a-f-k)*(1/v),r=(1-r)*3**(P*r)),S+=s*r**h,l=y(S)*m,b+=p*r**x,l+=u(b)*g,A&&(l+=(2*Math.random()-1)*A),w[a]=0|80*l*r;return w},d=[s,function(e){return .5>e%1?1:-1},function(e){return 2*(e%1)-1},function(e){var t=4*(e%1);return 2>t?t-1:3-t}];this.init=function(t){e=t,o=t.endPattern,a=0,r=2*(t.rowLen*t.patternLen*(o+1)),l=new Int32Array(r)},this.generate=function(){var c,y,m,h,u,g,x,A,v,P,L,C,w,S,b=new Int32Array(r),T=e.songData[a],E=e.rowLen,M=e.patternLen,I=0,H=0,W=!1,D=[];for(m=0;m<=o;++m)for(x=T.p[m],h=0;h<M;++h){var R=x?T.c[x-1].f[h]:0;R&&(T.i[R-1]=T.c[x-1].f[h+M]||0,17>R&&(D=[]));var B=d[T.i[16]],N=T.i[17]/512,F=2**(T.i[18]-9)/E,U=T.i[19],O=T.i[20],J=3.141592*(43.23529*T.i[21])/44100,Y=1-T.i[22]/255,z=1e-5*T.i[23],G=T.i[24]/32,q=T.i[25]/512,K=6.283184*2**(T.i[26]-9)/E,$=T.i[27]/255,V=-2&T.i[28]*E;for(L=(m*M+h)*E,u=0;4>u;++u)if(g=x?T.c[x-1].n[h+u*M]:0,g){D[g]||(D[g]=p(T,g,E));var X=D[g];for(y=0,c=2*L;y<X.length;y++,c+=2)b[c]+=X[y]}for(y=0;y<E;y++)A=2*(L+y),P=b[A],P||W?(C=J,U&&(C*=B(F*A)*N+.5),C=1.5*Math.sin(C),I+=C*H,w=Y*(P-H)-I,H+=C*w,P=3==O?H:1==O?w:I,z&&(P*=z,P=1>P?-1<P?s(.25*P):-1:1,P/=z),P*=G,W=1e-5<P*P,v=Math.sin(K*A)*q+.5,S=P*(1-v),P*=v):S=0,A>=V&&(S+=b[A-V+1]*$,P+=b[A-V]*$),b[A]=0|S,b[A+1]=0|P,l[A]+=0|S,l[A+1]+=0|P}return a++,a/e.numChannels},this.createAudioBuffer=function(e){for(var t,n=e.createBuffer(2,r/2,44100),o=0;2>o;o++){t=n.getChannelData(o);for(var a=o;a<r;a+=2)t[a>>1]=l[a]/65536}return n},this.createWave=function(){var e=44+2*r-8,t=e-36,n=new Uint8Array(44+2*r);n.set([82,73,70,70,255&e,255&e>>8,255&e>>16,255&e>>24,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&t,255&t>>8,255&t>>16,255&t>>24]);for(var o,a=0,s=44;a<r;++a)o=l[a],o=-32767>o?-32767:32767<o?32767:o,n[s++]=255&o,n[s++]=255&o>>8;return n},this.getData=function(e,t){for(var n,o=2*Math.floor(44100*e),a=Array(t),i=0;i<2*t;i+=1)n=o+i,a[i]=0<e&&n<l.length?l[n]/32768:0;return a}};class MainAttribute{constructor(){this.velocity=Random(120,100),this.strength=Random(699,312),this.leftArmSpeed=Random(.02,.01),this.rightArmSpeed=Random(.02,.01),this.walkAnimationSpeed=Random(.02,.01),this.SelectedArmor=[new Armor(0,0,"Head"),new Armor(0,0,"LeftArm1"),new Armor(0,0,"LeftArm2"),new Armor(0,0,"RightArm1"),new Armor(0,0,"RightArm2"),new Armor(0,0,"Body"),new Armor(0,0,"LeftLeg"),new Armor(0,0,"RightLeg")],this.SelectedWeapons=[new Sword(100,100,10),new Shield(100,75,0)]}}function dot(e,t,n,o){return e*n+t*o}class Vector2{constructor(e,t){this.x=e,this.y=t}Normalize(){var e=this.Length;this.x/=e,this.y/=e}get Length(){return Math.sqrt(this.x*this.x+this.y*this.y)}}var RightVector=new Vector2(0,1);function Random(e,t){return Math.random()*(e-t)+t}function Lerp(e,t,n){return new Vector2(e.x+n*(t.x-e.x),e.y+n*(t.y-e.y))}function Rotate(e,t){return new Vector2(e.x*Math.cos(t)-e.y*Math.sin(t),e.x*Math.sin(t)+e.y*Math.cos(t))}function rotatePoint(e,t,n){var o=t.x,a=t.y,i=e.x,r=e.y,l=o+(i-o)*Math.cos(n)-(r-a)*Math.sin(n),s=a+(i-o)*Math.sin(n)+(r-a)*Math.cos(n);return new Vector2(l,s)}class AIController{constructor(e,t){this.sprite=t,this.keysDown={},this.mousex=0,this.mousey=0,this.leftbutton=!1,this.rightbutton=!1,this.InputManager=e,this.waitTimeCount=0,this.isjump=1}Update(e){this.PlayerLocation=e;var t=Math.floor(15*Math.random())+1;if(this.waitTimeCount+=1,10<this.waitTimeCount)switch(this.waitTimeCount=0,t){case 1:this.LeftAttack();break;case 2:this.LefRelease();break;case 3:this.LeftWave();break;case 4:this.RightAttack();break;case 5:this.RightRelease();break;case 6:this.RightWave();break;case 7:this.Jump();break;case 8:this.JumpStop();break;case 9:this.MoveTo();break;case 10:this.MoveStop();break;default:}else return}LeftAttack(){this.mousex=this.PlayerLocation.x,this.mousey=this.PlayerLocation.y,this.mousey+=79*(Math.random()*2-1),this.leftbutton=!0}LefRelease(){this.leftbutton=!1}LeftWave(){this.mousey+=455*Math.random()}RightWave(){this.mousey+=455*Math.random()}RightAttack(){this.mousex=this.PlayerLocation.x,this.mousey=this.PlayerLocation.y,this.mousey+=79*(Math.random()*2-1),this.rightbutton=!0}RightRelease(){this.rightbutton=!1}MoveTo(){this.mousex=this.PlayerLocation.x,this.mousey=this.PlayerLocation.y,this.mousex<this.sprite.location.x?this.keysDown.a=!0:this.keysDown.d=!0}MoveStop(){this.keysDown.a=!1,this.keysDown.d=!1}Jump(){this.keysDown.w=!0}JumpStop(){this.keysDown.w=!1}}class Animation{constructor(e,t,n){this.isPlay=0,this.count=0,this.rate=e,this.from=t,this.to=n}Play(){this.isPlay=this.Loop&&2==this.isPlay?2:1}SetLoop(){this.Loop=1}StopPlay(){this.isPlay=0,this.count=0}BackPlay(){this.isPlay=2}Update(){return 1==this.isPlay?(this.count+=this.rate,1<=this.count&&(this.count=1,this.Loop&&(this.isPlay=2,console.log("shiteater"))),[Lerp(this.from[0],this.to[0],this.count),Lerp(this.from[1],this.to[1],this.count)]):2==this.isPlay?(console.log("Locve"),this.count-=this.rate,0>=this.count&&(this.isPlay=0,this.count=0,this.Loop&&(this.isPlay=1)),[Lerp(this.to[0],this.from[0],1-this.count),Lerp(this.to[1],this.from[1],1-this.count)]):void 0}}var StandBy=[new Vector2(0,0),new Vector2(35,20),new Vector2(64,-15),new Vector2(20,30),new Vector2(45,0),new Vector2(0,47),new Vector2(-29,93),new Vector2(29,93)],RightAttack=[new Vector2(45,0),new Vector2(73,0)],LeftAttack=[new Vector2(45,0),new Vector2(79,0)],move=[new Vector2(0,93),new Vector2(0,93)];function combine(e,t,n){return[StandBy[0],...e,...t,StandBy[5],...n]}class AnimationComponent{constructor(e,t,n){this.animations=[new Animation(e,[StandBy[3],StandBy[4]],LeftAttack),new Animation(t,[StandBy[1],StandBy[2]],RightAttack),new Animation(n,[StandBy[6],StandBy[7]],move)]}Play(e){this.animations[e].Play()}StopPlay(e){this.animations[e].StopPlay()}BackPlay(e){this.animations[e].BackPlay()}LoopPlay(e){this.animations[e].SetLoop()}Update(){for(var e=[[new Vector2(StandBy[3].x,StandBy[3].y),new Vector2(StandBy[4].x,StandBy[4].y)],[new Vector2(StandBy[1].x,StandBy[1].y),new Vector2(StandBy[2].x,StandBy[2].y)],[new Vector2(StandBy[6].x,StandBy[6].y),new Vector2(StandBy[7].x,StandBy[7].y)]],t=0;3>t;t++)0!=this.animations[t].isPlay&&(e[t]=this.animations[t].Update());return combine(e[0],e[1],e[2])}}class Armor{constructor(e,t,n){this.weight=e,this.protectiveLevel=t,this.color="#101010",this.type=n,this.category="Armor"}Draw(e,t,n,o){function a(n,a){var i=new Vector2(t[a].x-t[n].x,t[a].y-t[n].y),r=dot(i.x,i.y,RightVector.x,RightVector.y),l=Math.asin(r/(i.Length*RightVector.Length));e.save(),e.translate(o.x+t[n].x,o.y+t[n].y),i.x<RightVector.x&&(l=Math.PI-l),e.rotate(l),e.fillRect(0,-5+5/2,i.Length,5),e.stroke(),e.restore()}var i=-1;switch(n||(i=1),e.fillStyle=this.color,this.type){case"Head":var r=17,l=100,s=t[0].y+100;e.beginPath(),e.fillRect(o.x+t[0].x-l/2,o.y-s,l,r),e.stroke();var c=0;-1==n&&(c=-l/6),e.beginPath(),e.fillRect(o.x+n*(t[0].x-l/2)+c,o.y-s,r,l),e.stroke();break;case"Body":var l=10;e.beginPath(),e.fillRect(o.x+t[0].x-l,o.y+t[0].y,t[5].x+2*l,t[5].y),e.stroke();break;case"LeftArm1":a(0,1);break;case"LeftArm2":a(1,2);break;case"RightArm1":a(0,3);break;case"RightArm2":a(3,4);break;case"LeftLeg":a(5,6);break;case"RightLeg":a(5,7);break;case"LeftFeet":case"RightFeet":}}}class ArmorComponent{constructor(e){this.Armors=e}Draw(e,t,n,o){if(this.Armors)for(var a of this.Armors)a&&a.weight&&0!=a.weight&&a.Draw(e,t,n,o)}}class BackPack{constructor(){this.backpack=[]}}class PlayerMainAttribute extends MainAttribute{constructor(){super(),this.money=10,this.backpack=new BackPack}}class Collider{constructor(e,t,n){this.start=e,this.end=t,this.type=n}}function CheckIsCollide(e,t){return 1==t.type?lineRect(e.start,e.end,t.start,t.end):lineLine(e.start,e.end,t.start,t.end)}function lineLine(e,t,n,o){var a=(o.x-n.x)*(e.y-n.y)-(o.y-n.y)*(e.x-n.x),i=(t.x-e.x)*(e.y-n.y)-(t.y-e.y)*(e.x-n.x),r=(o.y-n.y)*(t.x-e.x)-(o.x-n.x)*(t.y-e.y);if(0!==r){var l=a/r,s=i/r;if(0<=l&&1>=l&&0<=s&&1>=s)return!0}return!1}function lineRect(e,t,n,o){var a=n,i=new Vector2(o.x,n.y),r=new Vector2(n.x,o.y),l=o;return!!lineLine(e,t,a,i)||!!lineLine(e,t,i,r)||!!lineLine(e,t,r,l)||!!lineLine(e,t,l,a)}class Weapon{constructor(e,t,n){this.weight=e,this.length=t,this.Attack=n,this.Start=new Vector2(0,0),this.End=new Vector2(0,0),this.category="Weapon"}}class InputManager{constructor(){let t=this;this.keysDown={},addEventListener("keydown",function(n){t.keysDown[n.key]=!0},!1),addEventListener("keyup",function(n){t.keysDown[n.key]=!1},!1),addEventListener("mousemove",function(n){t.mousex=n.offsetX,t.mousey=n.offsetY},!1),addEventListener("mouseup",function(n){0==n.button?t.leftbutton=!1:t.rightbutton=!1},!1),addEventListener("mousedown",function(n){0==n.button?(t.leftbutton=!0,console.log("Lily")):(t.rightbutton=!0,console.log("Elaine"))},!1)}}function DrawHead(e,t,n,o,a){e.beginPath(),e.arc(t,n,50,0,2*Math.PI,!0),e.fillStyle=a?"#F0E68C":"#907080",e.fill(),e.stroke();var i=44,r=30,l=6;-1==o&&(i*=-1,r*=-1,l*=-1),e.beginPath(),e.ellipse(t+l,n-10,10,15,0,0,2*Math.PI,!0),e.fillStyle="#A9A9A9",e.fill(),e.stroke(),e.beginPath(),e.ellipse(t+r,n-10,8,12,0,0,2*Math.PI,!0),e.fillStyle="#A9A9A9",e.fill(),e.stroke(),e.beginPath(),e.ellipse(t+1.5*l,n-10,5,7.5,0,0,2*Math.PI,!0),e.fillStyle="#000000",e.fill(),e.stroke(),e.beginPath(),e.ellipse(t+1.1*r,n-10,4,6,0,0,2*Math.PI,!0),e.fillStyle="\t#000000",e.fill(),e.stroke();e.moveTo(t,n+23),e.lineTo(t+i,n+23),e.stroke(),e.beginPath(),e.moveTo(0,0),e.lineTo(t,n)}function DrawBody(e,t,n){var o=n.x,a=n.y;e.beginPath(),e.moveTo(t[0].x+o,t[0].y+a),e.lineTo(t[1].x+o,t[1].y+a),e.lineTo(t[2].x+o,t[2].y+a),e.stroke(),e.beginPath(),e.moveTo(t[0].x+o,t[0].y+a),e.lineTo(t[3].x+o,t[3].y+a),e.lineTo(t[4].x+o,t[4].y+a),e.stroke(),e.beginPath(),e.moveTo(t[0].x+o,t[0].y+a),e.lineTo(t[5].x+o,t[5].y+a),e.stroke(),e.beginPath(),e.moveTo(t[5].x+o,t[5].y+a),e.lineTo(t[6].x+o,t[6].y+a),e.moveTo(t[5].x+o,t[5].y+a),e.lineTo(t[7].x+o,t[7].y+a),e.stroke()}class PlayerState{constructor(e){this.Health=[100,100,100,100,100,100,100,100],this.isAttacked=[[],[],[],[],[],[],[],[]],this.owner=e,this.isScalttered=!0}Update(){var e=.3*this.Health[0]+.05*this.Health[1]+.05*this.Health[2]+.05*this.Health[3]+.05*this.Health[4]+.3*this.Health[5]+.1*this.Health[6]+.1*this.Health[7];30>=e&&this.isScalttered&&(this.owner.components.AnimationComponent.animations[0].rate*=.5,this.owner.components.AnimationComponent.animations[1].rate*=.5,this.isScalttered=!1),(0>=this.Health[0]||0>=this.Health[5])&&this.owner.game.Stop(this.owner.index),30>=(this.Health[6]+this.Health[7])/2&&(this.owner.components.MovementComponent.rate=.5)}TakeDamage(e,t,n){if(!(n in this.isAttacked[e])){this.isAttacked[e].push(n);var o=this.owner.components.ArmorComponent.Armors[e];o&&(this.Health[e]-=t*(1-o.protectiveLevel))}}RemoveAttack(e,t){var n=this.isAttacked[e].indexOf(t);-1<n&&this.isAttacked[e].splice(n,1)}}class MovementComponent{constructor(e,t,n){this.floor=t,this.velocity=e,this.rate=1,this.upwardspeed=250,this.isJumped=!1,this.owner=n}Update(e,t,n){var o=t.x,a=t.y;t.y+=1;var i=0;return e.keysDown.a&&(i=-1),e.keysDown.d&&(i=1),e.keysDown.w&&!this.isJumped&&(this.isJumped=!0),o+=i*this.velocity*this.rate*n,a+=1*n,this.isJumped&&(a-=this.upwardspeed*n*this.rate,this.upwardspeed-=300*n),a>=this.floor&&(this.isJumped=!1,this.upwardspeed=250,a=this.floor),[o,a,i]}}class RandomEnemyGenerator extends MainAttribute{constructor(){super()}Easy(){this.SelectedArmor=[new Armor(1,Random(.3,.1),"Head"),new Armor(1,Random(.3,.1),"LeftArm1"),new Armor(1,Random(.3,.1),"LeftArm2"),new Armor(1,Random(.3,.1),"RightArm1"),new Armor(1,Random(.3,.1),"RightArm2"),new Armor(1,Random(.3,.1),"Body"),new Armor(1,Random(.3,.1),"LeftLeg"),new Armor(1,Random(.3,.1),"RightLeg")],this.SelectedWeapons=[new Sword(Random(200,100),Random(100,50),Random(10,5)),new Sword(Random(200,100),Random(100,50),Random(10,5))]}Mid(){this.leftArmSpeed=Random(.05,.02),this.rightArmSpeed=Random(.05,.02),this.velocity=Random(150,120),this.SelectedArmor=[new Armor(1,Random(.5,.37),"Head"),new Armor(1,Random(.5,.25),"LeftArm1"),new Armor(1,Random(.5,.25),"LeftArm2"),new Armor(1,Random(.5,.37),"RightArm1"),new Armor(1,Random(.5,.37),"RightArm2"),new Armor(1,Random(.5,.37),"Body"),new Armor(1,Random(.5,.37),"LeftLeg"),new Armor(1,Random(.5,.37),"RightLeg")];var e=Math.round(Math.random());this.SelectedWeapons=e?[new Sword(Random(200,100),Random(100,50),Random(37,17)),new Sword(Random(200,100),Random(100,50),Random(37,17))]:[new Sword(Random(200,100),Random(100,50),Random(37,17)),new Shield(Random(200,100),Random(150,100),0)]}Hard(){this.leftArmSpeed=Random(.08,.05),this.rightArmSpeed=Random(.08,.05),this.velocity=Random(180,150),this.SelectedArmor=[new Armor(1,Random(.76,.59),"Head"),new Armor(1,Random(.76,.59),"LeftArm1"),new Armor(1,Random(.76,.59),"LeftArm2"),new Armor(1,Random(.76,.59),"RightArm1"),new Armor(1,Random(.76,.59),"RightArm2"),new Armor(1,Random(.76,.59),"Body"),new Armor(1,Random(.76,.59),"LeftLeg"),new Armor(1,Random(.76,.59),"RightLeg")];var e=Math.round(Math.random());this.SelectedWeapons=e?[new Sword(Random(300,200),Random(150,50),Random(67,47)),new Sword(Random(350,200),Random(150,50),Random(67,47))]:[new Sword(Random(300,200),Random(150,50),Random(67,47)),new Shield(Random(500,354),Random(200,150),Random(37,17))]}}class Shield extends Weapon{constructor(e,t,n){super(e,t,n),this.type="Shield"}Update(e,t){this.pointing=new Vector2(t.x-e.x,t.y-e.y);var n=this.length/2,o=rotatePoint(t,e,Math.PI/2);o.x-=e.x,o.y-=e.y,o.Normalize(),this.Start=new Vector2(t.x+o.x*n,t.y+o.y*n),this.End=new Vector2(t.x-o.x*n,t.y-o.y*n)}Draw(e){e.save(),e.lineWidth=4,e.strokeStyle="#36777",e.beginPath(),e.moveTo(this.Start.x,this.Start.y),e.lineTo(this.End.x,this.End.y),e.stroke(),e.restore()}}class Sword extends Weapon{constructor(e,t,n){super(e,t,n),this.type="Sword"}Update(e,t){this.SwordPointing=new Vector2(t.x-e.x,t.y-e.y),this.Start=t;var n=this.SwordPointing;n.Normalize(),this.End=new Vector2(this.Start.x+n.x*this.length,this.Start.y+n.y*this.length)}Draw(e,t){var n=dot(this.SwordPointing.x,this.SwordPointing.y,RightVector.x,RightVector.y),o=Math.asin(n/(this.SwordPointing.Length*RightVector.Length));e.beginPath(),this.SwordPointing.x<RightVector.x&&(o=Math.PI-o),e.save(),e.translate(t.x,t.y),e.rotate(o);var a=.23*this.length;e.moveTo(a,0),e.strokeStyle="#C0C0C0",e.lineWidth=2,e.lineTo(this.length,0),e.stroke(),e.beginPath(),e.moveTo(0,0),e.strokeStyle="#766666",e.lineWidth=4,e.lineTo(a,0),e.stroke(),e.restore()}}class Sprite{constructor(e,t,n,o,a,i,r){this.location=new Vector2(t,n),this.facing=1,this.direction=1,this.currentPose=StandBy,this.Weapons=o[5],this.components={MovementComponent:new MovementComponent(o[0],e,this),AnimationComponent:new AnimationComponent(o[1],o[2],o[3]),ArmorComponent:new ArmorComponent(o[4])},this.MyCollisionArray=[],this.State=new PlayerState(this),this.SpriteArray=a,this.index=i,this.game=r}Draw(e){var t;t=this.game.type?this.index:1,DrawHead(e,this.location.x,this.location.y-50,this.facing,t),DrawBody(e,this.currentPose,this.location),this.Weapons[0].Draw(e,new Vector2(this.currentPose[2].x+this.location.x,this.currentPose[2].y+this.location.y)),this.Weapons[1].Draw(e,new Vector2(this.currentPose[3].x+this.location.x,this.currentPose[3].y+this.location.y),new Vector2(this.currentPose[4].x+this.location.x,this.currentPose[4].y+this.location.y)),this.components.ArmorComponent.Draw(e,this.currentPose,this.facing,this.location)}Update(e,t){function n(t,n,o){var a=e.mousex-t.x,i=e.mousey;0>a&&(a*=-1);var r=new Vector2(n[0].x-a,n[0].y-(i-t.y)),l=new Vector2(n[o].x-n[0].x,n[o].y-n[0].x),s=dot(r.x,r.y,l.x,l.y),c=.5*Math.PI+Math.asin(s/(r.Length*l.Length));e.mousey<t.y&&(c*=-1),n[o-1]=Rotate(n[o-1],c),n[o]=Rotate(n[o],c)}this.Weapons[0].Update(new Vector2(this.currentPose[1].x+this.location.x,this.currentPose[1].y+this.location.y),new Vector2(this.currentPose[2].x+this.location.x,this.currentPose[2].y+this.location.y)),this.Weapons[1].Update(new Vector2(this.currentPose[3].x+this.location.x,this.currentPose[3].y+this.location.y),new Vector2(this.currentPose[4].x+this.location.x,this.currentPose[4].y+this.location.y)),this.facing=e.mousex<=this.location.x?-1:1;var o=this.components.MovementComponent.Update(e,this.location,t);if(this.location.x=o[0],this.location.y=o[1],this.direction=o[2],e.leftbutton&&(this.components.AnimationComponent.Play(0),this.Weapons[0].isAttack=!0),e.leftbutton||1!=this.components.AnimationComponent.animations[0].isPlay||(this.components.AnimationComponent.BackPlay(0),this.Weapons[0].isAttack=!1),e.rightbutton&&(this.components.AnimationComponent.Play(1),this.Weapons[1].isAttack=!0),e.rightbutton||1!=this.components.AnimationComponent.animations[1].isPlay||(this.components.AnimationComponent.BackPlay(1),this.Weapons[1].isAttack=!1),this.components.AnimationComponent.LoopPlay(2),e.keysDown.d&&this.components.AnimationComponent.Play(2),e.keysDown.a&&this.components.AnimationComponent.Play(2),0==this.direction&&this.components.AnimationComponent.StopPlay(2),this.currentPose=this.components.AnimationComponent.Update(),this.components.AnimationComponent.animations[0].isPlay&&n(this.location,this.currentPose,2),this.components.AnimationComponent.animations[1].isPlay&&n(this.location,this.currentPose,4),-1==this.facing)for(var a=1;4>=a;a++)this.currentPose[a].x*=-1;this.MyCollisionArray[0]=new Collider(this.Weapons[0].Start,this.Weapons[0].End,0),this.MyCollisionArray[1]=new Collider(this.Weapons[1].Start,this.Weapons[1].End,0),this.MyCollisionArray[2]=new Collider(new Vector2(this.location.x-30,this.location.y-90),new Vector2(this.location.x+30,this.location.y-13),1),this.MyCollisionArray[3]=new Collider(new Vector2(this.location.x+this.currentPose[0].x,this.location.y+this.currentPose[0].y),new Vector2(this.location.x+this.currentPose[1].x,this.location.y+this.currentPose[1].y)),this.MyCollisionArray[4]=new Collider(new Vector2(this.location.x+this.currentPose[1].x,this.location.y+this.currentPose[1].y),new Vector2(this.location.x+this.currentPose[2].x,this.location.y+this.currentPose[2].y)),this.MyCollisionArray[5]=new Collider(new Vector2(this.location.x+this.currentPose[0].x,this.location.y+this.currentPose[0].y),new Vector2(this.location.x+this.currentPose[3].x,this.location.y+this.currentPose[3].y)),this.MyCollisionArray[6]=new Collider(new Vector2(this.location.x+this.currentPose[3].x,this.location.y+this.currentPose[3].y),new Vector2(this.location.x+this.currentPose[4].x,this.location.y+this.currentPose[4].y)),this.MyCollisionArray[7]=new Collider(new Vector2(this.currentPose[0].x+this.location.x,this.currentPose[0].y+this.location.y),new Vector2(this.currentPose[5].x+this.location.x,this.currentPose[5].y+this.location.y),0),this.MyCollisionArray[8]=new Collider(new Vector2(this.currentPose[5].x+this.location.x,this.currentPose[5].y+this.location.y),new Vector2(this.location.x+this.currentPose[6].x,this.currentPose[6].y+this.location.y),0),this.MyCollisionArray[9]=new Collider(new Vector2(this.currentPose[5].x+this.location.x,this.currentPose[5].y+this.location.y),new Vector2(this.location.x+this.currentPose[7].x,this.currentPose[7].y+this.location.y),0);var r;r=1==this.index?0:1,this.State.Update();for(var a=0;2>a;a++)for(var l=0;10>l;l++)if(this.SpriteArray[r].MyCollisionArray[l])if(!CheckIsCollide(this.MyCollisionArray[a],this.SpriteArray[r].MyCollisionArray[l]))2<=l&&this.SpriteArray[r].State.RemoveAttack(l-2,a);else if(this.Weapons[a].isAttack)if(2<=l)this.SpriteArray[r].State.TakeDamage(l-2,this.Weapons[a].Attack,a);else{var s=this.SpriteArray[r].Weapons[l];s&&s.isAttack&&("Shield"==this.SpriteArray[r].Weapons[l].type&&(this.location.x-=11*this.facing),this.Weapons[a].weight<=this.SpriteArray[r].Weapons[l].weight&&(this.location.x-=5*this.facing))}}}class Game{constructor(){this.isRunning=!0,this.mTickCount=0}Initialize(e,t){this.canvas=document.createElement("canvas"),document.body.appendChild(this.canvas),this.canvas.style="display: block",this.context=this.canvas.getContext("2d"),this.canvaswidth=this.canvas.width=window.innerWidth,this.canvasheight=this.canvas.height=window.innerHeight,this.MainAttribute=e,this.SpriteArray=[],this.SpriteArray[0]=new Sprite(.618*this.canvasheight-59,200,200,[e[0].velocity,e[0].leftArmSpeed,e[0].rightArmSpeed,e[0].walkAnimationSpeed,e[0].SelectedArmor,e[0].SelectedWeapons],this.SpriteArray,0,this),this.SpriteArray[1]=new Sprite(.618*this.canvasheight-59,1e3,200,[e[1].velocity,e[1].leftArmSpeed,e[1].rightArmSpeed,e[1].walkAnimationSpeed,e[1].SelectedArmor,e[1].SelectedWeapons],this.SpriteArray,1,this),this.InputManager=new InputManager,this.AIController=new AIController(this.InputManager,this.SpriteArray[1]),this.points=[],this.fillstyle=[];for(var n=["#977156","#343c3c","#43321e"],o=0;91>o;o++)this.fillstyle.push(n[Math.round(Random(2,0))]),this.points.push(new Vector2(Math.round(Random(this.canvaswidth,0)),Math.round(Random(.618*this.canvasheight,this.canvasheight))));this.groundcolor=["#D2B48C","#8B4513","#228B22","#808080","#FFD700"][Math.round(Random(4,0))],this.type=t}Update(){var e=(Date.now()-this.mTickCount)/1e3;this.mTickCount=Date.now(),this.AIController.Update(this.SpriteArray[0].location),this.SpriteArray[0].Update(this.InputManager,e),this.SpriteArray[1].Update(this.AIController,e)}GenerateOutput(){this.context.beginPath(),this.context.fillStyle=this.type?"#200000":"#00BFFF",this.context.fillRect(0,0,this.canvaswidth,this.canvasheight),this.context.moveTo(0,0),this.context.fillStyle=this.type?"#3D1D1D":this.groundcolor,this.context.fillRect(0,.618*this.canvasheight,this.canvaswidth,this.canvasheight);for(var e=0;91>e;e++)this.context.fillStyle=this.fillstyle[e],this.context.fillRect(this.points[e].x,this.points[e].y,13,13);this.context.stroke(),this.SpriteArray[0].Draw(this.context),this.SpriteArray[1].Draw(this.context),this.context.stroke()}Loop(){this.loop=setInterval(()=>{this.Update(),this.GenerateOutput(),this.isRunning||clearInterval(this.loop)},1)}Stop(e){this.isRunning=!1,1==e?(alert("You Win"),this.MainAttribute[0].money+=Math.round(Random(20,10)),this.type?FinalPage():MainPage()):(alert("You Lose"),Start()),this.canvas.remove()}}var mainAttribute=[new PlayerMainAttribute,new RandomEnemyGenerator];function Start(){MainAudio?.pause(),mainAttribute[0]=new PlayerMainAttribute,mainAttribute[1]=new RandomEnemyGenerator;var e=document.createElement("img");e.src="svg.svg",e.style.height="100%",e.style.width="100%",document.body.appendChild(e),e.id=1;var t=e.addEventListener("click",function(){e.removeEventListener("click",t),remove()})}function remove(){document.getElementById("1").remove(),Introduction(text,finishText)}var text=["Ages and ages past, you found yourself captivated by the allure of a stunning young woman.","The sentiment was mutual, as she too harbored a deep fondness for you.","However, fate's whims placed another admirer on the scene, one who grew infatuated with her as well.","This individual cunningly orchestrated a plan that left you destitute and bereft of your fortunes.","Yet now, driven by a thirst for retribution, you stand resolute, determined to reclaim every fragment of what rightfully belongs to you!"],finishText="... Press Any Key To Start ...";const sleep=e=>new Promise(t=>setTimeout(t,e));async function Introduction(e,t){function n(){l||(r.remove(),o.remove(),MainPage(),l=!0)}var o=document.createElement("div");o.setAttribute("class","text"),document.body.appendChild(o);for(var a=0;a<e.length;a++){console.log(a);var r=document.createElement("p");for(r.setAttribute("class","text"),o.appendChild(r),r.innerHTML=e[a],await sleep(1e4);o.hasChildNodes();)o.removeChild(o.firstChild)}var r=document.createElement("p");r.setAttribute("class","undertext"),r.innerHTML=t,o.appendChild(r);var l=!1,s=addEventListener("keydown",function(){removeEventListener("keydown",s),n()})}function Remove(){MainAudio?.pause(),document.getElementById("MainPage")?.remove()}function GenerateSpeed(e){return console.log(1/e),1/e}function ABATOIR(){Remove();var e=new Game,t=Math.round(Math.random());t?mainAttribute[1].Easy():mainAttribute[1].Mid();for(var n=0;2>n;n++)mainAttribute[n].leftArmSpeed=GenerateSpeed(mainAttribute[n].SelectedWeapons[n].weight);startDemo(backgroundSound),e.Initialize(mainAttribute,0),e.Loop()}function REVENGE(){Remove();var e=new Game;mainAttribute[1].Hard();for(var t=0;1>t;t++)mainAttribute[t].leftArmSpeed=GenerateSpeed(mainAttribute[t].SelectedWeapons[t].weight);startDemo(WindSong),e.Initialize(mainAttribute,1),e.Loop()}function RandomAttackGenerator(e,t,n){return(e/t+.4*n*Random(14,1))/10}function RandomProtectiveLevelGenerator(e,t){var n=(.1*e+.05*t*Random(14,1))/100;return .9<=n&&(n=.9),n}function SMITHY(){Remove(),alert("You have "+mainAttribute[0].money+"$");for(var e,t=document.createElement("select"),n=["Head","LeftArm1","LeftArm2","RightArm1","RightArm2","Body","LeftLeg","RightLeg","Sword","Shield"],o=0;10>o;o++)e=document.createElement("option"),e.innerHTML=n[o],t.add(e);var a=document.createElement("div");a.appendChild(t);var r=document.createElement("p");r.innerHTML="Money:",a.appendChild(r);var l=document.createElement("input");a.appendChild(l);var s=document.createElement("p");s.innerHTML="Weight:",a.appendChild(s);var c=document.createElement("input");a.appendChild(c);var p=document.createElement("p");p.innerHTML="Length:",a.appendChild(p);var d=document.createElement("br");a.appendChild(d);var y=document.createElement("input");a.appendChild(y);var m=document.createElement("button");m.innerHTML="FORGE",a.appendChild(m),m.onclick=function(){var e=parseInt(l.value);if(e){if(mainAttribute[0].money<e)return void alert("Not Enough Money!");mainAttribute[0].money-=e;var n,o=t.selectedIndex,a=y.value,i=c.value;switch(t.options[o].outerText){case"Sword":n=new Sword(i,a,RandomAttackGenerator(i,a,e));break;case"Shield":n=new Shield(i,a,0);break;default:n=new Armor(i,RandomProtectiveLevelGenerator(i,e),t.options[o].outerText);}mainAttribute[0].backpack.backpack.push(n)}};var h=document.createElement("button");h.innerHTML="Back",h.onclick=function(){a.remove(),MainPage()},a.appendChild(h),document.body.appendChild(a)}function Drag(e){e.dataTransfer.setData("Item",e.target.id),e.dataTransfer.setData("type",e.target.type)}function allowDrop(e){e.preventDefault()}function Drop(e){var t=e.dataTransfer.getData("Item"),n=e.dataTransfer.getData("type"),o=e.target.getElementsByTagName("div");if(n==e.target.type){if(o[0]){var a=document.getElementById("Itemdiv"),i=o[0].getElementsByTagName("p");switch(i[0].outerText){case"Sword":mainAttribute[0].backpack.backpack.push(new Sword(i[1].outerText,i[2].outerText,i[3].outerText));break;case"Shield":mainAttribute[0].backpack.backpack.push(new Shield(i[1].outerText,i[2].outerText,i[3].outerText));break;default:mainAttribute[0].backpack.backpack.push(new Armor(i[1].outerText,i[2].outerText,i[0].outerText));}o[0].setAttribute("class","ritem"),a.appendChild(o[0])}var r=document.getElementById(t);r.setAttribute("class","item"),e.target.appendChild(r),mainAttribute[0].backpack.backpack.splice(t,1)}}function OUFIT(){Remove();var e=document.createElement("div");document.body.appendChild(e);var n=document.createElement("div");e.appendChild(n),n.id="selectdiv";for(var o,a=["Head","LeftArm1","LeftArm2","RightArm1","RightArm2","Body","LeftLeg","RightLeg","LeftWeapon","RightWeapon"],r=0;10>r;r++){o=document.createElement("div"),o.id="s"+r,o.type=a[r],8<=r&&(o.type="Weapon"),o.setAttribute("class","Item"),o.ondragover=allowDrop,o.ondrop=Drop,o.innerHTML=a[r];var l=document.createElement("div");if(l.id="a"+r,l.setAttribute("class","item"),l.draggable=!0,l.ondragstart=Drag,l.ondrop=Drop,8<=r){var s=r-8,c=mainAttribute[0].SelectedWeapons[s],p=document.createElement("p");p.innerHTML=c.type,l.appendChild(p);var d=document.createElement("p");d.innerHTML=c.weight,l.appendChild(d);var y=document.createElement("p");y.innerHTML=c.length;var m=document.createElement("p");m.innerHTML=c.Attack,l.appendChild(y),l.appendChild(m),l.type="Weapon"}else{var h=mainAttribute[0].SelectedArmor[r],p=document.createElement("p");p.innerHTML=h.type,l.appendChild(p);var d=document.createElement("p");d.innerHTML=h.weight,l.appendChild(d);var u=document.createElement("p");u.innerHTML=h.protectiveLevel,l.appendChild(u),l.type=h.type}o.appendChild(l),n.appendChild(o)}var g=document.createElement("p");g.innerHTML="--------------------------------------------------------------------",e.appendChild(g);var x=document.createElement("div");e.appendChild(x),x.id="Itemdiv",x.ondrop=Drop,x.style.height="179px";for(var A,r=0;r<mainAttribute[0].backpack.backpack.length;r++){A=document.createElement("div"),A.setAttribute("class","ritem"),A.draggable=!0,A.ondragstart=Drag,A.id=+r;var f=mainAttribute[0].backpack.backpack[r];A.type="Weapon"==f.category?f.category:f.type;var p=document.createElement("p"),k=mainAttribute[0].backpack.backpack[r];if(k){var v=k.type;p.innerHTML=v,A.appendChild(p);var d=document.createElement("p");if(d.innerHTML=k.weight,A.appendChild(d),"Weapon"==k.category){var y=document.createElement("p");y.innerHTML=k.length;var m=document.createElement("p");m.innerHTML=k.Attack,A.appendChild(y),A.appendChild(m)}else{var u=document.createElement("p");u.innerHTML=k.protectiveLevel,A.appendChild(u)}x.appendChild(A)}}var t=document.createElement("button");t.innerHTML="Back",t.onclick=function(){for(var t=0,n=1e3,o=0;10>o;o++){var a=document.getElementById("s"+o),r=a.getElementsByTagName("p");t+=parseInt(r[1].outerText)}if(t>n)return void alert("Outfits are too heavy!");for(var o=0;10>o;o++){var a=document.getElementById("s"+o),r=a.getElementsByTagName("p");8>o?mainAttribute[0].SelectedArmor[o]=new Armor(r[1].outerText,r[2].outerText,r[0].outerText):"Sword"==r[0].outerText?mainAttribute[0].SelectedWeapons[o-8]=new Sword(r[1].outerText,r[2].outerText,r[3].outerText):mainAttribute[0].SelectedWeapons[o-8]=new Shield(r[1].outerText,r[2].outerText,r[3].outerText)}e.remove(),MainPage()},e.appendChild(t)}function CASINO(){Remove(),alert("You have "+mainAttribute[0].money+"$");var e=document.createElement("div");document.body.appendChild(e);var t=document.createElement("h1");t.innerHTML="LUCKY";var n=1,o=document.createElement("input"),a=document.createElement("button");a.innerHTML="SMALL",a.onclick=function(){n=1},e.appendChild(a);var i=document.createElement("button");i.innerHTML="MID",i.onclick=function(){n=2},e.appendChild(i);var r=document.createElement("button");r.innerHTML="BIG",r.onclick=function(){n=3},e.appendChild(r),e.appendChild(o);var l=document.createElement("button");l.innerHTML="CONFIRM",l.onclick=function(){var e=Random(18,3);e=10>=e?1:11==e?2:3;var t=parseInt(o.value);return t?mainAttribute[0].money<t?void alert("Not Enough Money!"):void(mainAttribute[0].money-=t,n==e&&(mainAttribute[0].money+=3*t,2==n&&(mainAttribute[0].money+=7*t)),console.log(mainAttribute[0].money)):void 0},e.appendChild(l);var s=document.createElement("button");s.innerHTML="BACK",e.appendChild(s),s.onclick=function(){e.remove(),MainPage()}}var MainAudio,MainSong={songData:[{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[1],c:[{n:[141,,,,,,,,143,,,,,,,,148,,,,153,,,,148,,,,,,,155,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,172,,,,167,,,,165,,,,167,,,,160,,,,172,,,,167,,,,,,,169],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1},WindSong={songData:[{i:[0,0,140,0,0,0,140,0,0,255,158,158,158,0,0,0,0,51,2,1,2,58,239,0,32,88,1,157,2],p:[1],c:[{n:[140],f:[]}]}],rowLen:5513,patternLen:79,endPattern:0,numChannels:1},backgroundSound={songData:[{i:[2,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,0,195,6,1,2,135,0,0,32,147,6,121,6],p:[1],c:[{n:[140,149,146,138,147,152,142,140,147,154,140,147,151,151,144,146],f:[]}]}],rowLen:5513,patternLen:16,endPattern:0,numChannels:1};function startDemo(e){var t=new CPlayer;t.init(e);var n=!1;setInterval(function(){if(!n&&(n=1<=t.generate(),n)){var e=t.createWave();MainAudio=document.createElement("audio"),MainAudio.src=URL.createObjectURL(new Blob([e],{type:"audio/wav"})),MainAudio.loop=!0,MainAudio.play()}},0)}function MainPage(){startDemo(MainSong);var e=["TATAKAI","REVENGE","SMITHY","OUTFIT","LUCKY"],t=[618,372,372,382,236],n=["darkred","darkblue","darkcyan","darksalmon","darkviolet"],o=[ABATOIR,REVENGE,SMITHY,OUFIT,CASINO],a=document.createElement("table");a.setAttribute("id","MainPage");var r=[document.createElement("tr"),document.createElement("tr")];a.setAttribute("class","text");for(var l,s=0;5>s;s++){l=document.createElement("td"),l.addEventListener("click",o[s]),l.setAttribute("class","block"),l.style.width=t[s]+"px",l.innerHTML=e[s],l.style.backgroundColor=n[s];var c=0;2<=s&&(c=1),r[c].appendChild(l)}a.appendChild(r[0]),a.appendChild(r[1]),document.body.appendChild(a)}function FinalPage(){Introduction(["I once poured my heart and soul into her, giving all my efforts and genuine affection.","I devoted my time, care, and unwavering support to her, regarding her as the most significant person in my life."," Each day, I contemplated ways to make her happy, fulfill her needs, and ensure she felt truly cherished.","However, I now find myself deeply wounded and profoundly betrayed.","I've uncovered hidden actions on her part that I cannot reconcile or accept.","I'm left questioning if I missed something or if I was naively deceived all along.","I used to believe our love was indestructible, but I'm now overwhelmed with profound disappointment and exhaustion.","I yearn to understand, why has she treated me in this manner?","Am I truly inadequate or unworthy of her affection?","Despite the immense effort and devotion I invested in her, she has inflicted deep emotional pain.","My heart weighs heavy, and the path forward remains uncertain, but I recognize the need to grant myself the time to heal and rediscover my identity.","Perhaps one day, clarity will emerge, and I will comprehend the underlying reasons.","For now, all I can do is confront the painful reality before me."],"... THE END ...")}Start(),document.body.addEventListener("touchmove",function(t){t.preventDefault(),t.stopPropagation()},{passive:!1});let objDemo=document.body;objDemo.oncontextmenu=t=>{t.preventDefault()};