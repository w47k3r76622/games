function PQueue(){this.data=[],this.data.push([0,1/0])}function Vec2d(t,e){this.x=t,this.y=e}function Queue(){this.data=[]}function rotateMap(t){for(var e=t[0].length,n=new Array(e).fill(0).map(()=>new Array(e).fill(0)),i=0;i<t.length;i++)for(var r=0;r<e;r++){var a=e-i-1;n[r][a]=t[i][r]}return n}function in_bound(t,e){return e<map.length&&e>=0&&t<map.length&&t>=0}function in_selection(t,e,n,i,r){for(var a=selection[0][0+r],o=selection[0][1-r],l=!1,h=-100,u=0;u<=o;u++)for(var s=0;s<=a;s++)t+u==n&&e+s==i&&(l=!0),in_bound(t+u,e+s)&&map[t+u][e+s]>h&&(h=map[t+u][e+s]),in_bound(t+u,e+s)&&plats[t+u][e+s]>h&&(h=plats[t+u][e+s]);return[l,h]}function can_build(e,n,i,r){var a=Math.max(map[e][n],plats[e][n]),o=0;if(selection[0][0+i]==selection[2][0+i]&&selection[0][1-i]==selection[2][1-i]&&a<water_level)return!1;for(var l=selection[0][0+i],h=selection[0][1-i],u=0;u<=h;u++)for(var s=0;s<=l;s++){if(t=map[e+u][n+s],p=plats[e+u][n+s],m=Math.max(t,p),-1!=buildings[e+u][n+s][0])return!1;if(0==r&&(m<water_level||m!=a))return!1;if(1==r){if(m>=water_level&&m!=a&&a>=water_level)return!1;a<water_level&&m>=water_level&&(a=m)}o+=m<water_level}return 1!=r||1==o}function rotateCoords(t,e,n,i){for(var r=0;r<i;r++){var a=e;e=n-t,t=a}return[t,e]}function rgb(t,e,n){return"rgb("+t+","+e+","+n+")"}PQueue.prototype.size=function(){return this.data.length-1},PQueue.prototype.insert=function(t,e){var n=this.data.length;for(this.data.push([t,e]);n/2>0&&this.data[n][1]>this.data[Math.floor(n/2)][1];)temp=this.data[Math.floor(n/2)],this.data[Math.floor(n/2)]=this.data[n],this.data[n]=temp,n=Math.floor(n/2)},PQueue.prototype.pop=function(){if(this.data.length>1){var t=this.data[1];this.data[1]=this.data[this.data.length-1],this.data=this.data.splice(0,this.data.length-1);for(var e=1;2*e<this.data.length;)minChild=this.minChild(e),this.data[e][1]<this.data[minChild][1]&&(temp=this.data[e],this.data[e]=this.data[minChild],this.data[minChild]=temp),e=minChild;return t}throw"Tried to pop from empty priority queue!"},PQueue.prototype.top=function(){if(this.data.length>1)return this.data[1];throw"Priority queue is empty!"},PQueue.prototype.minChild=function(t){return 2*t+1>this.data.length-1?2*t:this.data[2*t][1]>this.data[2*t+1][1]?2*t:2*t+1},PQueue.prototype.isEmpty=function(){return this.data.length<=1},Vec2d.prototype.add=function(t){return new Vec2d(this.x+t.x,this.y+t.y)},Vec2d.prototype.subtract=function(t){return new Vec2d(this.x-t.x,this.y-t.y)},Vec2d.prototype.multiply=function(t){return new Vec2d(this.x*t,this.y*t)},Vec2d.prototype.dot=function(t){return this.x*t.x+this.y*t.x},Vec2d.prototype.project=function(t){return t.multiply(this.dot(t)*(1/(this.length()*t.length())))},Vec2d.prototype.length=function(){return Math.sqrt(this.x**2+this.y**2)},Vec2d.prototype.normalize=function(){return length=this.length(),new Vec2d(this.x/length,this.y/length)},Queue.prototype.push=function(t){this.data.push(t)},Queue.prototype.top=function(){return 0==this.data.length?"idle":this.data[0]},Queue.prototype.pop=function(){return this.data.splice(0,1)},Queue.prototype.isEmpty=function(){return 0==this.data.length};const shadeColor=(t,e)=>{var n=parseInt,i=Math.round,[r,a,t,o]=t.split(","),l=(h=e<0)?0:255*e,h=h?1+e:1-e;return"rgb"+(o?"a(":"(")+i(n("a"==r[3]?r.slice(5):r.slice(4))*h+l)+","+i(n(a)*h+l)+","+i(n(t)*h+l)+(o?","+o:")")};function drawCube(t,e,n,i,r,a,o){t.beginPath(),t.moveTo(e,n),t.lineTo(e-i,n-.5*i),t.lineTo(e-i,n-a-.5*i),t.lineTo(e,n-1*a),t.closePath(),t.fillStyle=shadeColor(o,-.1),t.strokeStyle=o,t.fill(),t.beginPath(),t.moveTo(e,n),t.lineTo(e+r,n-.5*r),t.lineTo(e+r,n-a-.5*r),t.lineTo(e,n-1*a),t.closePath(),t.fillStyle=shadeColor(o,.1),t.strokeStyle=shadeColor(o,.5),t.fill(),t.beginPath(),t.moveTo(e,n-a),t.lineTo(e-i,n-a-.5*i),t.lineTo(e-i+r,n-a-(.5*i+.5*r)),t.lineTo(e+r,n-a-.5*r),t.closePath(),t.fillStyle=shadeColor(o,.2),t.strokeStyle=shadeColor(o,.6),t.fill()}function cancel(){null!=current_build&&(res[0]+=returned[0],res[1]+=returned[1],res[2]+=returned[2],res[3]+=returned[3],currentButton=-1,currentPanelButton=-1,current_build=null),c1.clearRect(0,0,layer1.width,layer1.height)}
