var __extends=(this&&this.__extends)||function(f,a){for(var e in a){if(a.hasOwnProperty(e)){f[e]=a[e]}}function c(){this.constructor=f}c.prototype=a.prototype;f.prototype=new c()};var Time;(function(l){var g=60;var k=1;var t=8/g;var f;var e;var h;var j;var a=(function(w){__extends(v,w);function v(y,x){w.call(this,y);this.position=[0,0];this.direction=0;this.color=x;this.transformedPolygon=new Geometry.Polygon(Vectorial.Matrix.copy(this.vertices))}v.prototype.render=function(x){x.fillStyle=this.color;x.beginPath();x.moveTo(this.transformedPolygon.vertices[0][0],this.transformedPolygon.vertices[0][1]);for(var y=1;y<this.transformedPolygon.vertices.length;y++){x.lineTo(this.transformedPolygon.vertices[y][0],this.transformedPolygon.vertices[y][1])}x.fill()};v.prototype.preStep=function(){};v.prototype.step=function(){this.preStep();var x=Vectorial.Matrix.multiply(Vectorial.Matrix.rotate(this.direction),Vectorial.Matrix.translate(this.position[0],this.position[1]));Vectorial.Matrix.multiply(this.vertices,x,this.transformedPolygon.vertices)};return v})(Geometry.Polygon);var o=(function(w){__extends(v,w);function v(){w.call(this,c(20,8),"#F80")}v.prototype.preStep=function(){this.position[0]+=this.speed[0];this.position[1]+=this.speed[1]};v.prototype.render=function(x){w.prototype.render.call(this,x);x.save();x.translate(this.position[0]+8,this.position[1]);x.fillStyle="#FFF";x.beginPath();var A=3;var y=0.2;var z=0.1+Math.abs((f%(2*y+A))-y)/y;x.scale(Math.min(1,z),1);x.arc(0,-7,3,0,Math.PI*2);x.arc(0,7,3,0,Math.PI*2);x.fill();x.restore()};return v})(a);var p=(function(w){__extends(v,w);function v(){w.call(this,c(20,8),"green")}v.prototype.render=function(x){w.prototype.render.call(this,x);x.save();x.translate(this.position[0]-8,this.position[1]);x.fillStyle="#FFF";x.beginPath();var A=5;var y=0.2;var z=0.1+Math.abs((f%(2*y+A))-y)/y;x.scale(Math.min(1,z),1);x.arc(0,-7,3,0,Math.PI*2);x.arc(0,7,3,0,Math.PI*2);x.fill();x.restore()};return v})(a);var n=(function(w){__extends(v,w);function v(A,z,B,x,y){if(y===void 0){y=true}w.call(this,A,z);this.calculatePosition=B;this.calculateDirection=x;this.collides=y}v.prototype.preStep=function(){this.position=this.calculatePosition(f);this.direction=this.calculateDirection(f)};return v})(a);function s(v){return function(x){for(var w=0;w<v.length;w++){if(x>v[w][0]){continue}if(!v[w-1]){return v[w][1]}var y=(x-(v[w-1][0]))/(v[w][0]-v[w-1][0]);return v[w-1][1]+(v[w][1]-v[w-1][1])*y}return v[v.length-1][1]}}var b=(function(v){__extends(w,v);function w(x){var y=this;v.call(this,x);this.player=new o();this.goal=new p();this.addRenderObject({render:function(z){if(!e){return}var B=y.canvas.width/e[0];var A=y.canvas.height/e[1];var F=Math.min(B,A);var D=e[0]*F;var C=e[1]*F;z.setTransform(F,0,0,F,(y.canvas.width-D)/2,(y.canvas.height-C)/2);z.translate(-h[0],-h[1]);var E=z.createRadialGradient(j[0]/2,j[1]/2,e[1]/2,j[0]/2,j[1]/2,j[0]/2);E.addColorStop(0,"#037");E.addColorStop(1,"#111");z.fillStyle=E;z.fillRect(0,0,j[0],j[1]);y.obstacles.forEach(function(G){return G.render(z)})}});this.addRenderObject(this.player);this.addStepObject(this.player);this.addRenderObject(this.goal);this.addStepObject(this.goal);this.addStepObject({step:function(){y.obstacles.forEach(function(A){return A.step()});var z=y.obstacles.some(function(A){return A.collides&&A.transformedPolygon.intersectsWith(y.player.transformedPolygon)});if(z){y.stop();y.gameOverCallback(false);return}if(y.player.transformedPolygon.intersectsWith(y.goal.transformedPolygon)){y.stop();y.gameOverCallback(true,f,Math.round(y.starsPerTime(f)));return}k=Math.max(-1,Math.min(1,k+t));f+=k/g;h[0]=Math.max(0,Math.min(j[0]-e[0],y.player.position[0]-e[0]/2));h[1]=Math.max(0,Math.min(j[1]-e[1],y.player.position[1]-e[1]/2))}});document.body.addEventListener("ontouchend" in document.documentElement?"touchend":"mousedown",function(z){return z.target.tagName=="CANVAS"&&y.running&&(t=-t)})}w.prototype.start=function(){v.prototype.start.call(this,g)};w.prototype.setLevel=function(x){h=[0,0];f=0;k=0;t=8/g;e=x.viewSize;j=x.roomSize;this.player.position=x.playerStart;this.player.speed=x.playerSpeed;this.goal.position=x.goalPosition;this.obstacles=x.obstacles;this.starsPerTime=x.starsPerTime;return x};return w})(Game.GameView);l.GameView=b;function r(){return f}l.getTime=r;function d(){var v=1;return[{id:v++,name:"Fall",viewSize:[500,300],roomSize:[500,300],playerStart:[40,150],playerSpeed:[30/g,0],goalPosition:[460,150],starsPerTime:s([[-10,5],[6,1]]),obstacles:[new n(u(60,60,true),"#060",function(w){var x;if(w<2){x=50}else{w-=2;x=Math.min(150,50+200*w*w/2)}return[250,x]},function(){return 0})]},{id:v++,name:"Jump",viewSize:[700,400],roomSize:[700,400],playerStart:[40,200],playerSpeed:[30/g,0],goalPosition:[660,200],starsPerTime:s([[0,5],[10,1]]),obstacles:[new n(u(60,60,true),"#600",function(w){w=w%5;var x;if(w<2){x=200}else{w-=2;x=Math.min(200,200-200*w+200*w*w/2)}return[500,x]},function(){return 0}),new n(u(40,40,true),"#600",function(w){w=w%4;var x;if(w<1){x=200}else{w-=1;x=Math.min(200,200-200*w+200*w*w/2)}return[300,x]},function(){return 0})]},{id:v++,name:"Doors",viewSize:[500,400],roomSize:[1000,400],playerStart:[40,200],playerSpeed:[30/g,0],goalPosition:[800,200],starsPerTime:s([[2,5],[10,1]]),obstacles:[new n(u(40,100),"#ddd",function(){return[390,0]},function(){return 0},false),new n(u(40,100),"#ddd",function(){return[390,300]},function(){return 0},false),new n(u(40,100),"#ddd",function(){return[470,0]},function(){return 0},false),new n(u(40,100),"#ddd",function(){return[470,300]},function(){return 0},false),new n(u(-200,20),"#950",function(){return[400,100]},s([[2,0],[4,Math.PI/2]])),new n(u(-20,-200),"#950",function(){return[500,300]},s([[2,0],[4,-Math.PI/2]]))]},{id:v++,name:"Pendulum",viewSize:[500,400],roomSize:[1000,600],playerStart:[40,300],playerSpeed:[30/g,0],goalPosition:[960,300],starsPerTime:s([[-7,5],[10,1]]),obstacles:[new n(Vectorial.Matrix.multiply(u(10,400),Vectorial.Matrix.translate(-5,0)),"#999",function(){return[500,0]},function(){return Math.cos(f)},false),new n(Vectorial.Matrix.multiply(c(30,15),Vectorial.Matrix.translate(0,400)),"#dd0",function(){return[500,0]},function(){return Math.cos(f)},true)]},{id:v++,name:"Gears",viewSize:[500,400],roomSize:[2000,1000],playerStart:[40,500],playerSpeed:[30/g,0],goalPosition:[1800,500],starsPerTime:s([[9,5],[40,1]]),obstacles:[new n(q(12,0.065,0.085,0.9,480),"#999",function(w){return[400,45]},function(w){return Math.PI*0.03*w}),new n(q(10,0.11,0.12,0.8,240),"#AAA",function(w){return[800,720]},function(w){return -Math.PI*0.06*w}),new n(q(10,0.11,0.12,0.8,240),"#888",function(w){return[1320,720]},function(w){return -Math.PI*0.06*w}),new n(q(10,0.065,0.085,0.9,480),"#BBB",function(w){return[1320,45]},function(w){return Math.PI*0.03*w})]},{id:v++,name:"Highway Crossing",viewSize:[500,400],roomSize:[900,1200],playerStart:[40,600],playerSpeed:[30/g,0],goalPosition:[860,600],starsPerTime:s([[-20,5],[20,1]]),obstacles:[new n(u(590,1200),"#666",function(w){return[180,0]},function(w){return 0},false),new n(u(50,100),"#77d",function(w){return[200,w*150%1500]},function(w){return 0}),new n(u(50,100),"#0dd",function(w){return[200,(w+200)*150%1500]},function(w){return 0}),new n(u(50,100),"#008",function(w){return[200,(w+1200)*150%1500]},function(w){return 0}),new n(u(50,100),"#d00",function(w){return[300,w*200%1500]},function(w){return 0}),new n(u(50,100),"#d0d",function(w){return[300,(w+470)*200%1500]},function(w){return 0}),new n(u(50,100),"#d70",function(w){return[300,(w+890)*200%1500]},function(w){return 0}),new n(u(50,100),"#07d",function(w){return[400,w*220%1500]},function(w){return 0}),new n(u(50,100),"#0d0",function(w){return[400,(w+660)*220%1500]},function(w){return 0}),new n(u(50,100),"#d77",function(w){return[400,(w+890)*220%1500]},function(w){return 0}),new n(u(50,100),"#00d",function(w){return[500,1500-(w+40)*220%1500]},function(w){return 0}),new n(u(50,100),"#d77",function(w){return[500,1500-(w+100)*220%1500]},function(w){return 0}),new n(u(50,100),"#d7d",function(w){return[500,1500-(w+150)*220%1500]},function(w){return 0}),new n(u(50,100),"#dd0",function(w){return[600,1800-(w+5)*200%1800]},function(w){return 0}),new n(u(50,100),"#df0",function(w){return[600,1800-(w+10)*200%1800]},function(w){return 0}),new n(u(50,100),"#707",function(w){return[600,1800-(w+25)*200%1800]},function(w){return 0}),new n(u(50,100),"#ddd",function(w){return[700,1800-(w+5)*150%1800]},function(w){return 0}),new n(u(50,100),"#d70",function(w){return[700,1800-(w+10)*150%1800]},function(w){return 0}),new n(u(50,100),"#d00",function(w){return[700,1800-(w+35)*150%1800]},function(w){return 0})]},{id:v++,name:"Solar System",viewSize:[900,900],roomSize:[3000,3000],playerStart:[40,1500],playerSpeed:[30/g,0],goalPosition:[2960,1500],starsPerTime:s([[-30,5],[40,1]]),obstacles:[{radius:24,color:"#8d888e",orbitRadius:58},{radius:60,color:"#c7c3ba",orbitRadius:108},{radius:64,color:"#365470",orbitRadius:150},{radius:34,color:"#df8d52",orbitRadius:228},{radius:714,color:"#dbb292",orbitRadius:778},{radius:602,color:"#d2c286",orbitRadius:1430},{radius:255,color:"#b9dfe2",orbitRadius:2870},{radius:247,color:"#3d5ff6",orbitRadius:4500},{radius:11,color:"#e6bd97",orbitRadius:5900}].map(function(w){var x=10*Math.sqrt(w.orbitRadius);var y=30+8*Math.sqrt(w.radius);return new n(c(0.1*y,10),w.color,function(z){return[1500+x*Math.cos(100*(z+300)/x),1500+x*Math.sin(100*(z+300)/x)]},function(){return 0})})}]}l.getLevels=d;function i(v){return d().filter(function(w){return w.id==v}).pop()}l.getLevel=i;function m(){return{id:null,name:"Demo",viewSize:[500,400],roomSize:[1000,1000],playerStart:[500,500],playerSpeed:[0,0],goalPosition:[-1000,500],starsPerTime:null,obstacles:[new n(Vectorial.Matrix.multiply(u(10,400),Vectorial.Matrix.translate(-5,0)),"#999",function(){return[0,200]},function(){return Math.cos(f)},false),new n(Vectorial.Matrix.multiply(c(30,15),Vectorial.Matrix.translate(0,400)),"#dd0",function(){return[0,200]},function(){return Math.cos(f)},false),new n(q(12,0.065,0.085,0.9,480),"#999",function(v){return[800,-10]},function(v){return Math.PI*0.03*v},false),new n(q(10,0.11,0.12,0.8,240),"#AAA",function(v){return[400,770]},function(v){return -Math.PI*0.06*v},false)]}}l.getDemoLevel=m;function u(y,x,w){var z=w?y/2:0;var v=w?x/2:0;return[[-z,-v,1],[y-z,-v,1],[y-z,x-v,1],[-z,x-v,1]]}function q(v,H,F,z,x){var D=new Array();for(var A=0;A<v;A++){var y=A*(Math.PI*2/v);var w=A*(Math.PI*2/v)+Math.PI/2;var G=Math.cos(y);var B=Math.cos(w);var E=Math.sin(y);var C=Math.sin(w);D.push([x*(G*z-B*F),x*(E*z-C*F)]);D.push([x*(G-B*H),x*(E-C*H)]);D.push([x*(G+B*H),x*(E+C*H)]);D.push([x*(G*z+B*F),x*(E*z+C*F)])}return D}function c(v,w){var x=[];for(var y=0;y<w;y++){x.push([Math.cos(Math.PI*2*y/w)*v,Math.sin(Math.PI*2*y/w)*v,1])}return x}})(Time||(Time={}));