function fontDrawer(a){return{img:a,letters:function(){for(var a=[],c=0;26>c;c++)a.push(String.fromCharCode(97+c)),a.push(String.fromCharCode(65+c));for(c=0;10>c;c++)a.push(String.fromCharCode(48+c));return a}(),draw:function(a,c,d,e,g){a.save();g&&a.scale(g,g);for(g=0;g<c.length;g++){var l=a,h=c[g],m=6*g+d,w=e;-1!==this.letters.indexOf(h)&&(h=h.toUpperCase().charCodeAt(0),l.drawImage(this.img,5*(64<h?h-65:h-48),5*(64<h?0:1),5,5,m,w,5,5))}a.restore()},drawIcon:function(a,c,d,e){(c={">":12,"<":0,on:11,
off:10}[c])&&a.drawImage(this.img,5*c,5,5,5,d,e,5,5)},drawTitle:function(a,c,d){this.draw(a,"0",c,d,2);this.draw(a,"x",c+40,d+24);this.draw(a,"DEAD",c+9,d,2)}}};function Images(){return{images:{},load:function(a){var b=["alphabet","pixrl1"],c=0,d=this;b.forEach(function(e){var g=new Image;g.src=e+".png";g.addEventListener("load",function(){c++;c===b.length&&a(d.images)});this.images[e]=g},this)}}};function renderMap(a,b){var c=this.game.getPixelSize(),d=this.fontdrawer;iter2dArray(b.map,function(e,g,l){var h=g*c,m=l*c;g=b.isSolid(g,l);if("100"===e)a.fillStyle="gray",a.fillRect(h,m,c,c),d.drawIcon(a,"on",h+4|0,m+5|0),e=[255,255,0],a.strokeStyle="rgba("+e[0]+","+e[1]+","+e[2]+",0.8)",a.strokeRect(h,m,c,c);else if("30"===e)a.strokeStyle="yellow",a.strokeRect(h,m,c,c);else if("20"===e)for(a.fillStyle="red",a.fillRect(h,m,c,c),l=m;l<m+c;l++)for(g=h;g<h+c;g++)a.fillStyle="rgb("+(255*Math.random()|
0)+","+(255*Math.random()|0)+","+(255*Math.random()|0)+")",a.fillRect(g,l,1,1);else"99"===e?(a.save(),a.shadowBlur=25,a.shadowColor="white",e=a.createLinearGradient(0,0,0,m+20),e.addColorStop(0,"white"),e.addColorStop(1,"black"),a.fillStyle=e,a.fillRect(h,m,c,c),a.restore()):g?(d.draw(a,e,h+5|0,m+5|0),a.strokeStyle="green",a.strokeRect(h,m,c,c)):(e=.3<Math.random()?e:randomLetter(),d.draw(a,e,h+5|0,m+5|0))})}
function iter2dArray(a,b){for(var c=0;c<a.length;c++)for(var d=0;d<a[0].length;d++)b(a[c][d],d,c)};function randi(a){a=a||100;return Math.floor(randd()*a)}function randd(){return Math.random()};function getMaps(){var a=0,b=0,c=[function(){return{maps:[[[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,100,0],[1,1,1,2,2,3,20,2,2,2,2,2,2,2],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,99,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0]],[[1,0,0,0,0,0,0,0,
0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,100,0],[1,1,1,2,2,0,0,0,2,2,2,2,2,2],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,99,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0]]],sprites:[],start:[20,20]}},function(){return{maps:[[[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,
0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,100,0],[1,20,20,2,2,3,4,15,2,2,2,2,2,2],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,99,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0]],[[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,100,0],[1,0,1,1,1,1,1,1,1,1,1,
1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,99,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0]]],sprites:[{x:50,y:50},{x:110,y:10}],start:[90,20]}},function(){return{maps:[[[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,2,0,0,0,2,0,0,0,0,0,0],[1,0,0,2,0,0,0,8,0,0,0,0,0,0],[1,0,0,2,0,0,0,7,0,0,0,0,
0,0],[1,0,0,2,0,0,0,6,0,0,0,0,0,0],[1,0,0,3,0,0,0,5,0,0,0,0,0,0],[1,0,0,4,100,0,0,4,0,0,0,0,0],[1,0,0,1,1,1,1,1,1,1,0,0,0,1],[1,0,0,12,0,0,0,0,0,0,0,0,0,0],[1,0,0,2,0,0,0,0,0,0,0,99,0,0],[1,0,0,4,0,0,0,0,1,1,1,1,1,1],[1,0,0,5,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0]],[[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,4,0,2,0,0,0,0,2,0,0,0,0,0],[1,0,0,2,0,0,0,0,8,0,0,0,0,0],[1,0,2,2,0,0,0,0,7,0,0,0,0,0],[1,0,0,2,0,0,0,0,6,0,0,0,0,0],[1,0,0,3,0,0,0,0,0,0,0,0,0,0],[1,0,0,4,0,0,
0,0,0,0,0,100,0,0],[1,0,0,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,12,0,0,0,0,0,0,0,0,0,0],[1,0,0,2,0,0,0,0,0,0,0,99,0,0],[1,0,0,4,0,0,0,0,1,1,1,1,1,1],[1,0,0,5,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0]]],start:[80,80],sprites:[{x:116,y:80},{x:143,y:119}]}},function(){return{maps:[[[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,2,0,0,0,0,0,0],[1,2,2,2,0,0,0,8,0,0,0,0,0,0],[1,0,0,2,0,0,0,7,0,0,0,0,0,0],[1,0,0,2,0,0,0,6,0,0,0,0,0,0],[1,0,0,3,0,0,0,5,0,0,0,0,0,0],[1,0,0,4,100,
0,0,4,0,0,0,0,0],[1,0,0,1,1,1,1,1,1,1,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,5,5,2,0,0,0,0,0,0,0,99,0,0],[1,0,0,4,0,0,0,0,1,1,1,1,1,1],[1,0,0,5,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0]],[[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,2,0,0,0,0,0,0],[1,0,0,0,0,0,0,8,0,0,0,0,0,0],[1,0,0,0,0,0,0,7,0,0,0,0,0,0],[1,0,0,0,0,0,0,6,0,0,0,0,0,0],[1,100,0,3,0,0,0,5,0,0,0,0,0,0],[1,1,1,4,100,0,0,4,0,0,0,0,0],[1,0,0,1,1,1,1,1,1,1,0,0,0,1],[1,0,0,12,0,0,0,0,0,0,0,0,0,0],
[1,0,0,2,0,0,0,0,0,0,0,99,0,0],[1,0,0,4,0,0,0,0,1,1,1,1,1,1],[1,99,0,5,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0]]],start:[80,20],sprites:[{x:112,y:119}]}},function(){return{maps:[[[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,99,0],[1,0,0,0,0,0,0,0,0,0,0,1,1,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,1,0,1,1,1,1,1,0,0,0],[1,0,100,0,0,0,0,0,0,1,0,0,0,0],[1,0,1,0,0,0,0,0,0,1,0,0,0,0],[1,0,1,0,0,0,0,0,0,1,0,100,0,0],[1,0,1,
100,0,1,0,0,0,1,0,1,1,0],[1,0,15,1,1,1,0,0,0,1,0,0,0,0],[1,0,11,0,0,1,20,20,1,1,1,1,1,0],[1,0,11,0,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1]],[[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,7,1,1,3,2,0,0,0],[1,0,100,0,0,0,0,0,0,0,0,0,0,0],[1,0,1,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,100,0,0,100,0,0,0,0,0,0],[1,0,0,0,1,3,2,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,0,0,0,
0,0,0,0,0,0,0,0],[1,0,0,100,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1]]],start:[80,158],sprites:[{x:90,y:55}]}},function(){return{maps:[[[1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,1,0,0,0,0,0,0,0,0,1],[1,0,1,0,0,0,0,0,0,0,1,1,1,0],[1,0,1,0,0,0,1,1,0,0,0,0,0,0],[1,0,1,0,0,1,0,0,0,0,0,0,0,0],[1,0,1,0,0,0,0,0,0,1,0,0,0,0],[1,0,1,0,0,0,0,0,0,0,0,0,0,0],[1,0,1,1,1,1,1,1,1,1,1,0,0,0],[1,0,0,1,0,0,0,0,0,0,0,0,0,0],[1,0,0,1,0,0,0,0,0,0,0,0,0,0],[1,0,0,1,0,0,0,0,0,0,0,0,0,
0],[1,99,0,1,0,0,0,0,0,100,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1]],[[1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,0,0,1,1,1,0,0,0,1,1,0],[1,0,1,0,0,0,0,0,0,0,0,0,0,0],[1,0,1,0,0,0,0,0,0,100,0,0,0,0],[1,0,1,0,0,0,0,0,0,1,0,0,0,0],[1,0,1,0,0,0,4,0,0,0,0,0,0,0],[1,0,1,0,0,0,0,0,0,0,0,0,0,0],[1,0,0,1,0,1,0,1,0,1,0,1,0,0],[1,0,0,1,0,0,0,0,0,0,0,0,0,0],[1,0,0,1,0,0,0,0,0,0,0,0,1,1],[1,99,0,1,0,0,99,0,0,100,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1]]],start:[80,
158],sprites:[{x:130,y:75},{x:40,y:55}]}},function(){return{maps:[[[1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,1,0,1,0,0,0,99,0,1],[1,1,1,0,0,0,0,0,0,0,0,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,1,1,1,1,1,0,0,0,0,1],[1,0,0,1,0,0,1,0,0,1,0,0,0,1],[1,0,0,1,0,0,1,0,0,1,0,0,0,1],[1,0,0,1,1,1,1,1,1,1,0,0,0,1],[1,0,0,0,1,1,1,1,1,0,0,0,0,1],[1,0,0,0,1,0,1,0,1,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,100,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1]],[[1,0,0,0,
0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1,0,1],[1,0,0,0,100,0,0,0,0,0,0,0,0,1],[1,0,0,0,1,1,1,1,1,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,1,1,1,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,100,0,1],[1,0,0,0,0,0,0,0,0,0,0,1,20,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1]]],start:[80,158],sprites:[{x:130,y:75},{x:50,y:25}]}}];return{nextLevel:function(c){b=
0;a++;return this.restartMap(c)},restartMap:function(d){b=0;var e=c[a];if(!e)return!1;e=e();this.start=e.start;this.maps=e.maps.map(function(a){var b=new World(resolution);b.init(a,d);return b},this);return{map:this.maps[0],start:e.start,sprites:e.sprites}},nextMap:function(){b=(b+1)%this.maps.length;return this.maps[b]},maps:[]}};function song(){var a=new AudioContext,b=new TinyMusic.Sequence(a,70,"A3 s;C4 s;D4 s;E4 s;A3 s;C4 s;D4 s;E4 s;A3 s;C4 s;D4 s;E4 s;A3 s;C4 s;D4 s;E4 s;G3 s;C4 s;D4 s;E4 s;G3 s;C4 s;D4 s;E4 s;G3 s;C4 s;D4 s;E4 s;G3 s;C4 s;D4 s;E4 s;F3 s;C4 s;D4 s;E4 s;F3 s;C4 s;D4 s;E4 s;F3 s;C4 s;D4 s;E4 s;F3 s;C4 s;D4 s;E4 s;E3 s;G#3 s;B3 s;D4 s;E3 s;G#3 s;B3 s;D4 s;E3 s;G#3 s;B3 s;D3 s;E4 s;G#4 s;D4 s;E4 s".split(";")),c=function(a){a+=" s";return[a,"- s","- s",a,"- s",a,"- e",a,"- s","- s","- s","- s","- s","- s",
"- s"]},d=c("A3"),e=c("G3"),c=c("G#3"),g=new TinyMusic.Sequence(a,70,d.concat(e,d,c)),l=new TinyMusic.Sequence(a,70,"B4 h;C5 h;D5 h;E5 h;B5 h;A5 h;C6 h;B5 h".split(";"));b.gain.gain.value=.0625;g.gain.gain.value=.125;l.gain.gain.value=.05;l.waveType="sawtooth";g.bass.gain.value=6;g.bass.frequency.value=80;var h=!0,m={play:function(){var c=a.currentTime,d=c+60/70*16;h=!0;b.play();g.play(d);l.play(c+60/70*32)},stop:function(){h=!1;b.stop();g.stop();l.stop()},playStopListener:function(){h?(m.stop(),
Game.soundOn=!1,this.innerHTML="&#x1f507;"):(m.play(),Game.soundOn=!0,this.innerHTML="&#x1f50a;")}};return m};(function(a,b){"function"===typeof define&&define.amd?define(["exports"],b):"object"===typeof exports&&"string"!==typeof exports.nodeName?b(exports):b(a.TinyMusic={})})(this,function(a){function b(a){a=a.split(g);this.frequency=b.getFrequency(a[0])||0;this.duration=b.getDuration(a[1])||0}function c(a,b,c){this.ac=a||new AudioContext;this.createFxNodes();this.tempo=b||120;this.loop=!0;this.staccato=this.smoothing=0;this.notes=[];this.push.apply(this,c||[])}var d=440*Math.pow(Math.pow(2,1/12),-9),e=
/^[0-9.]+$/,g=/\s+/,l=/(\d+)/,h={};"B#-C C#-Db D D#-Eb E-Fb E#-F F#-Gb G G#-Ab A A#-Bb B-Cb".split(" ").forEach(function(a,b){a.split("-").forEach(function(a){h[a]=b})});b.getFrequency=function(a){a=a.split(l);return d*Math.pow(Math.pow(2,1/12),h[a[0]])*Math.pow(2,(a[1]||4)-4)};b.getDuration=function(a){return e.test(a)?parseFloat(a):a.toLowerCase().split("").reduce(function(a,b){return a+("w"===b?4:"h"===b?2:"q"===b?1:"e"===b?.5:"s"===b?.25:0)},0)};c.prototype.createFxNodes=function(){var a=this.gain=
this.ac.createGain();[["bass",100],["mid",1E3],["treble",2500]].forEach(function(b,c){c=this[b[0]]=this.ac.createBiquadFilter();c.type="peaking";c.frequency.value=b[1];a.connect(a=c)}.bind(this));a.connect(this.ac.destination);return this};c.prototype.push=function(){Array.prototype.forEach.call(arguments,function(a){this.notes.push(a instanceof b?a:new b(a))}.bind(this));return this};c.prototype.createCustomWave=function(a,b){b||(b=a);this.waveType="custom";this.customWave=[new Float32Array(a),new Float32Array(b)]};
c.prototype.createOscillator=function(){this.stop();this.osc=this.ac.createOscillator();this.customWave?this.osc.setPeriodicWave(this.ac.createPeriodicWave.apply(this.ac,this.customWave)):this.osc.type=this.waveType||"square";this.osc.connect(this.gain);return this};c.prototype.scheduleNote=function(a,b){var c=60/this.tempo*this.notes[a].duration,d=c*(1-(this.staccato||0));this.setFrequency(this.notes[a].frequency,b);this.smoothing&&this.notes[a].frequency&&this.slide(a,b,d);this.setFrequency(0,b+
d);return b+c};c.prototype.getNextNote=function(a){return this.notes[a<this.notes.length-1?a+1:0]};c.prototype.getSlideStartDelay=function(a){return a-Math.min(a,60/this.tempo*this.smoothing)};c.prototype.slide=function(a,b,c){var d=this.getNextNote(a),e=this.getSlideStartDelay(c);this.setFrequency(this.notes[a].frequency,b+e);this.rampFrequency(d.frequency,b+c);return this};c.prototype.setFrequency=function(a,b){this.osc.frequency.setValueAtTime(a,b);return this};c.prototype.rampFrequency=function(a,
b){this.osc.frequency.linearRampToValueAtTime(a,b);return this};c.prototype.play=function(a){a="number"===typeof a?a:this.ac.currentTime;this.createOscillator();this.osc.start(a);this.notes.forEach(function(b,c){a=this.scheduleNote(c,a)}.bind(this));this.osc.stop(a);this.osc.onended=this.loop?this.play.bind(this,a):null;return this};c.prototype.stop=function(){this.osc&&(this.osc.onended=null,this.osc.disconnect(),this.osc=null);return this};a.Note=b;a.Sequence=c});var GameScene=function(a,b){this.sprites=b;this.name="gamescene";this.isGravity=!0;this.player=new Player(90,20);this.game=a;this.fontdrawer=a.fontdrawer;b.push(this.player);this.maps=getMaps();this.resetLevel(this.maps.restartMap());this.playerSprite=a.images.pixrl1;this.fadingout=!1;this.restartCounter=0;this.playerDead=!1;this.rTime=200;this.arrow={};this.soundPlayer=Soundz()};
GameScene.prototype={update:function(a){var b=this.player;this.fadingout?(this.restartCounter--,0>this.restartCounter&&(this.fadingout=!1,this.changinglevel?(this.changinglevel=!1,this.nextLevel()):(this.playerDead=!1,this.resetLevel(this.maps.restartMap())))):(this.sprites.forEach(function(a){"player"!==a.type&&(a.move(this.map),"sprite"===a.type&&a.x<b.x+b.width&&a.x+a.width>b.x&&a.y<b.y+b.height&&a.y+a.height>b.y&&(this.restart(),this.soundPlayer.play("dead")))},this),this.getPressedKeys(a),this.movePlayer(),
a=this.map.getTile(b.x,b.y),"100"===a.t||"99"===a.t?(this.arrow=this.arrow?this.arrow:new Arrow(a.x,a.y),this.arrow.move()):this.arrow=null)},nextLevel:function(){var a=this.maps.nextLevel();a?this.resetLevel(a):this.game.nextScene()},resetLevel:function(a){this.sprites=[this.player];this.map=a.map;a.start&&(this.player.x=a.start[0],this.player.y=a.start[1]);a.sprites&&a.sprites.forEach(function(a){a=new Sprite(a.x,a.y);a.vx=a.speed;a.vy=.5;this.sprites.push(a)},this);this.player.isOnGround=!1},render:function(a){a.globalAlpha=
0<this.restartCounter?this.restartCounter/this.rTime:1;renderMap.call(this,a,this.map,!0);this.sprites.forEach(function(b){a.drawImage(this.game.images.pixrl1,b.img,0,16,16,b.x-5,b.y-5,16,16)},this);if(this.arrow){var b=this.arrow.x,c=this.arrow.y+this.arrow.vy;a.save();a.translate(b,c-10);a.rotate(Math.PI/180*-90);a.translate(-b-5,-c+10);a.font="10px Arial";a.fillStyle="gray";a.fillText("\u2794",b,c);a.restore()}this.map.collisionTiles=[];this.playerDead&&0<this.restartCounter&&this.restartCounter<
this.rTime/2&&(a.globalAlpha=1,this.fontdrawer.drawTitle(a,30,20))},getPressedKeys:function(a){var b=this.player;a.pressed[a.A]&&!b.jumping&&b.isOnGround&&(b.vy=-6,b.jumping=!0,b.isOnGround=!1,b.canJump=!1,this.soundPlayer.play("jump"));a.pressed[a.DOWN]&&(b.vy=1);a.pressed[a.LEFT]&&(b.vx=-1,b.img=48);a.released[a.LEFT]&&(b.vx=0);a.pressed[a.RIGHT]&&(b.vx=1,b.img=32);a.released[a.UP]&&(b=this.map.getTile(b.x+b.width/2,b.y+b.height/2).t,"100"===b&&(this.map=this.maps.nextMap(),this.soundPlayer.play("pressSwitch")),
"99"===b&&(this.soundPlayer.play("endlevel"),this.changeLevel()),a.released[a.UP]=!1)},restart:function(){this.playerDead=this.fadingout=!0;this.restartCounter=this.rTime},changeLevel:function(){this.changinglevel=this.fadingout=!0;this.restartCounter=50},movePlayer:function(){var a=this.player,b=this.map,c=a.vx,d=a.vy,d=d+.5;if(0<c){c-=.1;.05>c&&(c=0);var e=a.x+c+a.width,g=a.y,l=a.y+a.height,g=b.collidingPoint(e,g),h=b.collidingPoint(e,l);if(g||h)c=0}else 0>c&&(e=a.x+c,g=a.y,l=a.y+a.height,g=b.collidingPoint(e,
g),h=b.collidingPoint(e,l),g||h)&&(c=0);if(0<d){1<d&&(d=1);var e=a.y+d+a.height,m=a.x,l=a.x+a.width,g=b.collidingPoint(m,e),h=b.collidingPoint(l,e);if(g||h){d=b.getTile(m,e).t;b=b.getTile(l,e).t;a.jumping=!1;a.isOnGround=!0;a.canJump=!0;if("20"===d||"20"===b)this.soundPlayer.play("dead"),this.restart();d=0}else a.isOnGround=!1}else 0>d&&(e=a.y+d,m=a.x,l=a.x+a.width,g=b.collidingPoint(m,e),h=b.collidingPoint(l,e),g||h)&&(d=0);a.vy=d;a.vx=c;a.x+=a.vx;a.y+=a.vy}};function TitleScene(a){this.g=a}TitleScene.prototype={update:function(a){a.anyPressed()&&this.g.nextScene()},render:function(a){var b=this.g.fontdrawer;b.drawTitle(a,30,20);b.draw(a,"Controls : ",50,52);b.draw(a,"Arrows to move,",50,62);b.draw(a,"A to open doors",50,72);b.draw(a,"and press switches",50,80)}};function EndScene(a){this.g=a}
EndScene.prototype={update:function(){},render:function(a){var b=this.g.fontdrawer;b.draw(a,"THE END",20,20,2);b.draw(a,"ThAnKs",20,30,2);b.draw(a,"foR PlayiNg",20,40,2)}};var canvasScaleFactor=3,resolution=180,Game={delta:0,then:0,logInfo:[],canvasSize:resolution,isGravity:!0,images:{},soundOn:!0,init:function(a,b){var c=this.canvasSize*canvasScaleFactor,d=this.canvas=document.getElementById("canvas"),e=this.ctx=d.getContext("2d");d.width=c;d.height=c;this.sprites=[];e.scale(canvasScaleFactor,canvasScaleFactor);e.imageSmoothingEnabled=!1;e.mozImageSmoothingEnabled=!1;this.keys=KeyListeners();this.images=b;this.scene1=new TitleScene(this);this.fontdrawer=fontDrawer(b.alphabet)},
getPixelSize:function(){return this.canvasSize/this.scene1.map.size},render:function(){var a=this.ctx;a.clearRect(0,0,canvas.width,canvas.height);a.fillStyle="black";a.fillRect(0,0,canvas.width,canvas.height);this.scene1.render(a);this.drawLogging(a)},fadeOut:function(a){a.globalAlpha=.5},nextScene:function(){this.scene1="gamescene"===this.scene1.name?new EndScene(this):new GameScene(this,this.sprites)},log:function(a){this.logInfo.push(a)},drawLogging:function(a){var b=this.logInfo,c=32;a.font="16px Arial bold";
a.fillStyle="green";for(var d=0;d<b.length;d++)a.fillText(b[d],20,c),c+=16;this.logInfo=[]},update:function(){this.scene1.update(this.keys)},run:function(a){Game.render();Game.update();requestAnimationFrame(Game.run)}};function Sprite(a,b,c){this.height=this.width=9;this.x=a||50;this.y=b||50;this.vy=this.vx=0;this.speed=.5;this.img=0;this.gravity=!0;this.isOnGround=!1;this.col="red";this.type="sprite";this.isOnGround=!1}
Sprite.prototype={move:function(a){var b=this.vx,c=this.vy+.5;if(0<c){var d=c+this.y+this.height,e=this.x+this.width,g=a.collidingPoint(this.x,d),d=a.collidingPoint(e,d);g||d?(c=this.vy=0,this.isOnGround=!0):(this.vy=1,b=0)}if(0<b){if(g=this.x+b+this.width,e=this.y,d=this.y+this.height,e=a.collidingPoint(g,e),a=!a.collidingPoint(g,d+1),e||a)this.vx=b=-1*this.speed}else 0>b&&(g=this.x+b,e=this.y,d=this.y+this.height,e=a.collidingPoint(g,e),a=!a.collidingPoint(g,d+1),e||a)&&(this.vx=b=this.speed);this.x+=
b;this.y+=c}};function Arrow(a,b){this.x=a;this.y=b;this.vy=0;this.width=this.height=10;this.dir=-1}Arrow.prototype.move=function(a){0<this.dir?(this.vy+=.3,this.y+this.vy>this.y+4&&(this.dir*=-1)):(this.vy-=.3,this.y+this.vy<this.y-4&&(this.dir*=-1))};function World(a,b){this.size=14;this.height=this.width=a;this.collisionTiles=[]}
World.prototype={init:function(a){for(var b=this.size,c=[],d=0;d<b;d++){for(var e=[],g=0;g<b;g++){var l=a[d][g];l?(l=1===l?randomLetter():10>l?String.fromCharCode(48+l):l.toString(),e.push(l)):e.push(randomLetter())}c.push(e)}this.map=c;this.collisions=a},getTile:function(a,b){var c=this.width/this.size,d=a/c|0,e=b/c|0;return{t:this.map[e][d],x:d*c,y:e*c}},collidingPoint:function(a,b){var c=this.width,d=c/this.size;return a>c-1||b>this.height-1||0>a||0>b?!0:this.isSolid(a/d|0,b/d|0)},isSolid:function(a,
b){return 0!==this.collisions[b][a]&&50>this.collisions[b][a]}};function randomLetter(){var a=randi(16);return 10>a?String.fromCharCode(48+a):String.fromCharCode(87+a)};function KeyListeners(){var a={},b={};[37,38,39,40,65,70,83].forEach(function(a){});document.addEventListener("keyup",function(c){var d=c.keyCode;a[d]=!1;b[d]=!0;c.preventDefault()});document.addEventListener("keydown",function(c){var d=c.keyCode;a[d]=!0;b[d]=!1;c.preventDefault()});return{pressed:a,released:b,UP:38,DOWN:40,LEFT:37,RIGHT:39,F:70,A:65,S:83,anyPressed:function(){return 0<Object.keys(a).length}}};function Player(a,b){this.col="green";this.x=a;this.width=5;this.y=b;this.type="player";this.img=32;this.jumpTime=0;this.canJump=!1}Player.prototype=new Sprite;Player.prototype.move=function(){};var f=Images();f.load(function(a){Game.init("canvas",a);Game.run()});var music=song();document.getElementById("sound").addEventListener("click",function(){});document.getElementById("sound").addEventListener("click",music.playStopListener);music.play();function SfxrParams(){this.setSettings=function(a){for(var b=0;24>b;b++)this[String.fromCharCode(97+b)]=a[b]||0;.01>this.c&&(this.c=.01);a=this.b+this.c+this.e;.18>a&&(a=.18/a,this.b*=a,this.c*=a,this.e*=a)}}
function SfxrSynth(){this._params=new SfxrParams;var a,b,c,d,e,g,l,h,m,w,r,K;this.reset=function(){var a=this._params;d=100/(a.f*a.f+.001);e=100/(a.g*a.g+.001);g=1-a.h*a.h*a.h*.01;l=-a.i*a.i*a.i*1E-6;a.a||(r=.5-a.n/2,K=5E-5*-a.o);h=1+a.l*a.l*(0<a.l?-.9:10);m=0;w=1==a.m?0:(1-a.m)*(1-a.m)*2E4+32};this.totalReset=function(){this.reset();var d=this._params;a=d.b*d.b*1E5;b=d.c*d.c*1E5;c=d.e*d.e*1E5+12;return 3*((a+b+c)/3|0)};this.synthWave=function(W,L){var k=this._params,M=1!=k.s||k.v,x=k.v*k.v*.1,N=
1+3E-4*k.w,t=k.s*k.s*k.s*.1,X=1+1E-4*k.t,Y=1!=k.s,Z=k.x*k.x,aa=k.g,O=k.q||k.r,ba=k.r*k.r*k.r*.2,P=k.q*k.q*(0>k.q?-1020:1020),Q=k.p?((1-k.p)*(1-k.p)*2E4|0)+32:0,ca=k.d,R=k.j/2,da=k.k*k.k*.01,G=k.a,H=a,ea=1/a,fa=1/b,ga=1/c,k=5/(1+k.u*k.u*20)*(.01+t);.8<k&&(k=.8);for(var k=1-k,I=!1,S=0,z=0,A=0,T=0,E=0,B,C=0,p,u=0,v,J=0,n,U=0,y,V=0,F=Array(1024),D=Array(32),q=F.length;q--;)F[q]=0;for(q=D.length;q--;)D[q]=2*Math.random()-1;for(q=0;q<L;q++){if(I)return q;Q&&++U>=Q&&(U=0,this.reset());w&&++m>=w&&(w=0,d*=
h);g+=l;d*=g;d>e&&(d=e,0<aa&&(I=!0));p=d;0<R&&(V+=da,p*=1+Math.sin(V)*R);p|=0;8>p&&(p=8);G||(r+=K,0>r?r=0:.5<r&&(r=.5));if(++z>H)switch(z=0,++S){case 1:H=b;break;case 2:H=c}switch(S){case 0:A=z*ea;break;case 1:A=1+2*(1-z*fa)*ca;break;case 2:A=1-z*ga;break;case 3:A=0,I=!0}O&&(P+=ba,v=P|0,0>v?v=-v:1023<v&&(v=1023));M&&N&&(x*=N,1E-5>x?x=1E-5:.1<x&&(x=.1));y=0;for(var ha=8;ha--;){u++;if(u>=p&&(u%=p,3==G))for(B=D.length;B--;)D[B]=2*Math.random()-1;switch(G){case 0:n=u/p<r?.5:-.5;break;case 1:n=1-u/p*2;
break;case 2:n=u/p;n=6.28318531*(.5<n?n-1:n);n=1.27323954*n+.405284735*n*n*(0>n?1:-1);n=.225*((0>n?-1:1)*n*n-n)+n;break;case 3:n=D[Math.abs(32*u/p|0)]}M&&(B=C,t*=X,0>t?t=0:.1<t&&(t=.1),Y?(E+=(n-C)*t,E*=k):(C=n,E=0),C+=E,T+=C-B,n=T*=1-x);O&&(F[J%1024]=n,n+=F[(J-v+1024)%1024],J++);y+=n}y*=.125*A*Z;W[q]=1<=y?32767:-1>=y?-32768:32767*y|0}return L}}var synth=new SfxrSynth;
window.jsfxr=function(a){synth._params.setSettings(a);var b=synth.totalReset();a=new Uint8Array(4*((b+1)/2|0)+44);var b=2*synth.synthWave(new Uint16Array(a.buffer,44),b),c=new Uint32Array(a.buffer,0,44);c[0]=1179011410;c[1]=b+36;c[2]=1163280727;c[3]=544501094;c[4]=16;c[5]=65537;c[6]=44100;c[7]=88200;c[8]=1048578;c[9]=1635017060;c[10]=b;for(var b=b+44,c=0,d="data:audio/wav;base64,";c<b;c+=3)var e=a[c]<<16|a[c+1]<<8|a[c+2],d=d+("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e>>18]+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e>>12&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e>>6&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e&63]);return d};function Soundz(){function a(a){var b=new Audio;b.src=jsfxr(a);return b}var b={jump:a([0,,.1539,,.25,.18,,.2573,.02,,,-.04,,.4471,,,,,1,,,.1972,,.5]),dead:a([3,.1086,.01,.0738,.9284,.5,,.0283,-.5185,.0267,.0891,.5533,-.9053,,.9468,,.605,.8053,.9996,.0242,,.0475,.1965,.5]),endlevel:a([2,.13,.25,.0537,.6544,.31,.08,,,5E-4,-.6473,.54,.08,-.4693,.0397,-.5448,.56,-.38,.35,.0428,.46,.34,,.5]),pressSwitch:a([0,,.0611,.5871,.3333,.8637,,,,,,.5184,.6157,,,,,,1,,,,,.5])};return{play:function(a){a=b[a];Game.soundOn&&
a&&a.play()}}};
