<!DOCTYPE html><html><head><meta charset="utf-8"><title>Death Estate</title><style>body,canvas,div,html{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}body{line-height:1}</style></head><body><script>!function(){"use strict";const t=Math.PI,s=t=>t<0?-t:t,i=(t,s)=>t<s?t:s,n=(t,s)=>t>s?t:s,e=t=>t<0?-1:1,h=(t,s=0,i=1)=>t<s?s:t>i?i:t,o=(t,s=0,i=1)=>i-s?h((t-s)/(i-s)):0,r=(t,s=0,i=1)=>s+h(t)*(i-s),c=(t=1,s=0)=>s+(t-s)*Math.random(),u=(t=1,s=0)=>0|c(t,s),l=(t=0,s)=>null==t.x?new a(t,null==s?t:s):new a(t.x,t.y);class a{constructor(t=0,s=0){this.x=t,this.y=s}t(){return new a(this.x,this.y)}add(t){return new a(this.x+t.x,this.y+t.y)}i(t){return new a(this.x-t.x,this.y-t.y)}multiply(t){return new a(this.x*t.x,this.y*t.y)}h(t){return new a(this.x/t.x,this.y/t.y)}scale(t){return new a(this.x*t,this.y*t)}length(){return this.o()**.5}o(){return this.x**2+this.y**2}u(t){return this.l(t)**.5}l(t){return(this.x-t.x)**2+(this.y-t.y)**2}normalize(t=1){const s=this.length();return s?this.scale(t/s):new a(0,t)}g(t=1){const s=this.length();return s>t?this.scale(t/s):this}m(t){return this.x*t.x+this.y*t.y}p(t){return this.x*t.y-this.y*t.x}angle(){return Math.atan2(this.x,this.y)}v(t=0,s=1){return this.x=s*Math.sin(t),this.y=s*Math.cos(t),this}rotate(t){const s=Math.cos(t),i=Math.sin(t);return new a(this.x*s-this.y*i,this.x*i+this.y*s)}direction(){return s(this.x)>s(this.y)?this.x<0?3:1:this.y<0?2:0}M(){return new a(this.y,-this.x)}floor(){return new a(Math.floor(this.x),Math.floor(this.y))}k(){return s(this.x*this.y)}S(t,s){return this.add(t.i(this).scale(h(s)))}T(t){return this.x>=0&&this.y>=0&&this.x<t.x&&this.y<t.y}toString(t=3){return`(${(this.x<0?"":" ")+this.x.toFixed(t)},${(this.y<0?"":" ")+this.y.toFixed(t)} )`}}class d{constructor(t=1,s=1,i=1,n=1){this.r=t,this.A=s,this.b=i,this.a=n}t(){return new d(this.r,this.A,this.b,this.a)}add(t){return new d(this.r+t.r,this.A+t.A,this.b+t.b,this.a+t.a)}i(t){return new d(this.r-t.r,this.A-t.A,this.b-t.b,this.a-t.a)}multiply(t){return new d(this.r*t.r,this.A*t.A,this.b*t.b,this.a*t.a)}h(t){return new d(this.r/t.r,this.A/t.A,this.b/t.b,this.a/t.a)}scale(t,s=t){return new d(this.r*t,this.A*t,this.b*t,this.a*s)}C(){return new d(h(this.r),h(this.A),h(this.b),h(this.a))}S(t,s){return this.add(t.i(this).scale(h(s)))}R(t=0,s=0,i=1,n=1){const e=i<.5?i*(1+s):i+s-i*s,h=2*i-e,o=(t,s,i)=>(i=(i%1+1)%1)<1/6?t+6*(s-t)*i:i<.5?s:i<2/3?t+(s-t)*(2/3-i)*6:t;return this.r=o(h,e,t+1/3),this.A=o(h,e,t),this.b=o(h,e,t-1/3),this.a=n,this}D(){const t=this.r,s=this.A,i=this.b,n=this.a,e=Math.max(t,s,i),h=Math.min(t,s,i),o=(e+h)/2;let r=0,c=0;if(e!=h){let n=e-h;c=o>.5?n/(2-e-h):n/(e+h),t==e?r=(s-i)/n+(s<i?6:0):s==e?r=(i-t)/n+2:i==e&&(r=(t-s)/n+4)}return[r/6,c,o,n]}$(t=.05,s=0){return new d(this.r+c(t,-t),this.A+c(t,-t),this.b+c(t,-t),this.a+c(s,-s)).C()}toString(){return`rgb(${255*this.r|0},${255*this.A|0},${255*this.b|0},${this.a})`}F(){return(255*this.r|0)+(255*this.A<<8)+(255*this.b<<16)+(255*this.a<<24)}P(t){const s=s=>parseInt(t.slice(s,s+2),16)/255;return this.r=s(1),this.A=s(3),this.b=s(5),this.a=1,this}H(){const t=t=>((t=255*t|0)<16?"0":"")+t.toString(16);return"#"+t(this.r)+t(this.A)+t(this.b)}}let f=l(1920,1200),w=l(),g=l(16),m=.3,p=(l(1),l()),v=n(g.x,g.y);let M,y,k=0,S=0,x=0,b=0;const T="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)";const A=new Image;let C,R,D,$,F=l();const P=t=>t.add(l(.5)).i(F.scale(.5)).multiply(l(1/v,-1/v)).add(p),H=t=>t.i(p).multiply(l(v,-v)).add(F.scale(.5)).i(l(.5));function W(t,s=l(1),i=-1,n=g,e=new d,h=0,o,r=new d(0,0,0,0),c=1){if(c)if(i<0||!A.width)mt(t.x,t.y,s.x,s.y,h,0,0,0,0,0,e.F());else{const c=M.x/n.x|0,u=n.x/M.x,l=n.y/M.y,a=i%c*u,d=(i/c|0)*l;mt(t.x,t.y,o?-s.x:s.x,s.y,h,a+y.x,d+y.y,a-y.x+u,d-y.y+l,e.F(),r.F())}else!function(t,s,i,n,e,h=R){t=H(t),s=s.scale(v),h.save(),h.translate(t.x+.5|0,t.y-.5|0),h.rotate(i),h.scale(n?-s.x:s.x,s.y),e(h),h.restore()}(t,s,h,o,(t=>{if(i<0)t.fillStyle=e,t.fillRect(-.5,-.5,1,1);else{const s=M.x/n.x|0,h=i%s*n.x+m,o=(i/s|0)*n.y+m,r=n.x-.6,c=n.y-.6;t.globalAlpha=e.a,t.drawImage(A,h,o,r,c,-.5,-.5,1,1)}}))}function U(t,s,i,n,e){W(t,s,-1,g,i,n,0,0,e)}function N(t,s,i,n,e){!function(t,s=l(1),i,n,e,h,o,r,c){W(P(t),s.scale(1/v),i,n,e,h,o,r,c)}(t,s,-1,g,i,n,0,0,e)}function z(t,s,i=1,n=new d,e=0,h=new d(0,0,0),o="center",r="arial"){$.fillStyle=n,$.lineWidth=e,$.strokeStyle=h,$.textAlign=o,$.font=i+"px "+r,$.textBaseline="middle",$.lineJoin="round",s=s.t(),(t+"").split("\n").forEach((t=>{e&&$.strokeText(t,s.x,s.y),$.fillText(t,s.x,s.y),s.y+=i}))}function q(t,s,i=1,n,e,h,o,r){z(t,H(s),i*v,n,e*v,h,o,r)}const B=(t,s=0)=>j[s]&&1&j[s][t]?1:0,I=B,E=(t,s=0)=>j[s]&&2&j[s][t]?1:0,L=(t,s=0)=>j[s]&&4&j[s][t]?1:0;let _=l(),G=l(),J=0,O=0,j=[[]];function Y(){document.hasFocus()||(j=[[]]),_=P(G)}function K(){for(const t of j)for(const s in t)t[s]&=1;J=0}onkeydown=t=>{t.repeat||(j[O=0][Q(t.keyCode)]=3)},onkeyup=t=>{j[0][Q(t.keyCode)]=4};const Q=t=>87==t?38:83==t?40:65==t?37:68==t?39:t;onmousedown=t=>{j[O=0][t.button]=3,onmousemove(t),t.button&&t.preventDefault()},onmouseup=t=>j[0][t.button]=2&j[0][t.button]|4,onmousemove=t=>G=V(t),onwheel=t=>t.ctrlKey||(J=e(t.deltaY)),oncontextmenu=t=>!1;const V=t=>{if(!C)return l();const s=C.getBoundingClientRect();return l(C.width,C.height).multiply(l(o(t.x,s.left,s.right),o(t.y,s.top,s.bottom)))};if(void 0!==window.ontouchstart){let t,s;ontouchstart=ontouchmove=ontouchend=i=>{i.button=0;const n=i.touches.length;return n?(s||st(0,s=1),i.x=i.touches[0].clientX,i.y=i.touches[0].clientY,t?onmousemove(i):onmousedown(i)):t&&onmouseup(i),t=n,!i.cancelable}}let X;new class{constructor(t){this.time=null==t?void 0:S+t,this.setTime=t}set(t=0){this.time=S+t,this.setTime=t}W(){this.time=void 0}U(){return null!=this.time}active(){return S<=this.time}N(){return S>this.time}get(){return this.U()?S-this.time:0}q(){return this.U()?o(this.time-S,this.setTime,0):0}toString(){0}},l();class Z{constructor(t,s=30,i=.7){this.range=s,this.B=i,this.I=t[1]||0,t[1]=0,this.L=nt(...t)}play(t,s=1,i=1,n=1){let e=0;if(t){const i=this.range;if(i){const n=p.l(t);if(n>i*i)return;s*=o(n**.5,i,i*this.B)}e=2*H(t).x/C.width-1}const h=i+i*this.I*n*c(-1,1);return tt([this.L],s,h,e)}_(t,s,i=1){return this.play(s,i,2**(t/12),0)}}function tt(t,s=1,i=1,n=0,e=0){if(X||(X=new(window.AudioContext||webkitAudioContext)),X.resume(),"running"!=X.state)return;const o=X.createBuffer(t.length,t[0].length,it),r=X.createBufferSource();t.forEach(((t,s)=>o.getChannelData(s).set(t))),r.buffer=o,r.playbackRate.value=i,r.loop=e;const c=X.createGain();return c.gain.value=.5*s,c.connect(X.destination),(window.StereoPannerNode?r.connect(new StereoPannerNode(X,{pan:h(n,-1,1)})):r).connect(c),r.start(),r}const st=(...t)=>tt([nt(...t)]),it=44100;function nt(h=1,o=.05,r=220,u=0,l=0,a=.1,d=0,f=1,w=0,g=0,m=0,p=0,v=0,M=0,y=0,k=0,S=0,x=1,b=0,T=0){let A,C,R=2*t,D=w*=500*R/it/it,$=[],F=r*=(1+o*c(-1,1))*R/it,P=0,H=0,W=0,U=1,N=0,z=0,q=0;for(g*=500*R/it**3,y*=R/it,m*=R/it,p*=it,v=v*it|0,C=(u=u*it+9)+(b*=it)+(l*=it)+(a*=it)+(S*=it)|0;W<C;$[W++]=q)++z%(100*k|0)||(q=d?d>1?d>2?d>3?Math.sin((P%R)**3):n(i(Math.tan(P),1),-1):1-(2*P/R%2+2)%2:1-4*s(Math.round(P/R)-P/R):Math.sin(P),q=(v?1-T+T*Math.sin(R*W/v):1)*e(q)*s(q)**f*h*.5*(W<u?W/u:W<u+b?1-(W-u)/b*(1-x):W<u+b+l?x:W<C-S?(C-W-S)/a*x:0),q=S?q/2+(S>W?0:(W<C-S?1:(C-W)/S)*$[W-S|0]/2):q),A=(r+=w+=g)*Math.cos(y*H++),P+=A-A*M*(1-1e9*(Math.sin(W)+1)%2),U&&++U>p&&(r+=m,F+=m,U=0),!v||++N%v||(r=F,w=D,U=U||1);return $}let et,ht,ot,rt,ct,ut,lt,at,dt,ft;l();function wt(t,s){const i=ht.createShader(s);return ht.shaderSource(i,t),ht.compileShader(i),i}function gt(){if(!at)return;const t=dt?pt:yt;ht.blendFuncSeparate(Mt,t,pt,t),ht.enable(kt),ht.bufferSubData(Ht,0,ut.subarray(0,at*zt*qt)),ht.drawArrays(vt,0,at*zt),at=0,dt=ft}function mt(t,s,i,n,e,h,o,r,c,u=4294967295,l=0){at!=Bt&&dt==ft||gt();const a=Math.cos(e)/2,d=Math.sin(e)/2,f=a*i,w=a*n,g=d*i,m=d*n;let p=at++*zt*qt;ut[p++]=t-f-m,ut[p++]=s-w+g,ut[p++]=h,ut[p++]=c,lt[p++]=u,lt[p++]=l,ut[p++]=t+f+m,ut[p++]=s+w-g,ut[p++]=r,ut[p++]=o,lt[p++]=u,lt[p++]=l,ut[p++]=t-f+m,ut[p++]=s+w+g,ut[p++]=h,ut[p++]=o,lt[p++]=u,lt[p++]=l,ut[p++]=t-f-m,ut[p++]=s-w+g,ut[p++]=h,ut[p++]=c,lt[p++]=u,lt[p++]=l,ut[p++]=t+f-m,ut[p++]=s-w-g,ut[p++]=r,ut[p++]=c,lt[p++]=u,lt[p++]=l,ut[p++]=t+f+m,ut[p++]=s+w-g,ut[p++]=r,ut[p++]=o,lt[p++]=u,lt[p++]=l}const pt=1,vt=4,Mt=770,yt=771,kt=3042,St=3553,xt=5121,bt=5126,Tt=6408,At=9728,Ct=10240,Rt=10241,Dt=10242,$t=10243,Ft=16384,Pt=33071,Ht=34962,Wt=35048,Ut=35632,Nt=35633,zt=6,qt=6,Bt=65536,It=24,Et=0,Lt=1,_t=2,Gt=3,Jt=4,Ot=5,jt=0,Yt=1,Kt=2,Qt=3,Vt=[[0,1],[1,0],[0,-1],[-1,0]],Xt=(Vt.concat([[1,1],[1,-1],[-1,-1],[-1,1]]),0),Zt=1,ts=2,ss=3,is=4,ns=5,es=6,hs={G:1,J:2,O:4,j:8,Y:16,K:32,V:64,X:128},os=[hs.G,hs.J,hs.O,hs.j,hs.Y,hs.K,hs.V,hs.X];class rs{constructor(){this.buttons=[],this.Z=null}tt(t){this.buttons.push(t)}st(t){const s=this.buttons.indexOf(t);s>-1&&this.buttons.splice(s,1)}pressed(){this.Z=null;for(let t=this.buttons.length-1;t>=0&&!this.Z;t--){const s=this.buttons[t];s.it()&&(this.Z=s)}return!!this.Z}nt(){return!!this.Z&&(this.Z.it()&&this.Z.pressed(),this.Z=null,!0)}update(){this.buttons.forEach((t=>t.update()))}et(){this.buttons.forEach((t=>t.et()))}}const cs=new Z([2.77,,21,,.02,.01,3,.23,72,27,-13,.07,,,,.1,,.36]),us=new Z([1.01,,402,.02,.04,.08,2,1.24,-14,,,,,,,,,.56,.07]),ls=new Z([1.54,,438,.02,.04,.19,,1.49,-6.9,,,,,.1,,.3,.01,.85,.01]),as=new Z([,,167,.01,.01,.01,2,.06,,,,,,,,.1,,,,.01]),ds=new Z([,,86,.01,.01,.01,2,.06,,,,,,,,.1,,,,.01]),fs=new Z([1.73,,389,,.09,.13,1,1.89,,,-455,.01,,,,,.01,.74,.05,.08]),ws=new d(.2,.2,.2,0);class gs{constructor(t,s,i,n,e,h,o,r=!0,c=!0){this.ht=t,this.offset=l(),this.size=s,this.text=i,this.ot=n,this.bgColor=e,this.rt=h,this.ct=o||(()=>{}),this.ut=c,this.lt=!0,this.visible=!0,this.dt=r,this.ft=!1,this.wt=0,this.gt=0}get enabled(){return this.lt}set enabled(t){this.lt=t,this.bgColor.a=t?1:.5,this.rt.a=t?1:.5}it(){if(!this.enabled||!this.visible)return!1;const t=this.dt?G:_;return t.x>=this.ht.x-this.size.x/2&&t.y>=this.ht.y-this.size.y/2&&t.x<this.ht.x+this.size.x/2&&t.y<this.ht.y+this.size.y/2}pressed(){this.ct(),this.vt(),this.ut&&cs.play()}vt(){this.ft=!0,this.wt=S,this.gt=S+.1}update(){if(!this.ft)return;if(S>=this.gt)return this.offset.y=0,void(this.ft=!1);const t=o(S,this.wt,this.gt);this.offset.y=.5*t-.5}et(){if(!this.visible)return;let t,s;this.dt?(t=N,s=z):(t=U,s=q);const i=.5+this.offset.y;t(this.ht.add(this.offset).add(l(0,-this.size.y/2-i/2)),l(this.size.x,i),this.bgColor.i(ws)),t(this.ht.add(this.offset),this.size,this.bgColor),s(this.text,this.ht.add(this.offset),this.ot,this.rt)}}const ms=["Can you build me this?","Please make this for me?","I would like this house!"],ps=["Thank you!","Thanks so much!","Appreciate it!","<3"],vs=["Aww...","Darn...","Fine then...",":("];function Ms(t){return t[u(0,t.length)]}class ys{constructor(t){this.ht=t,this.color=new d(1,1,1,1),this.size=l(6),this.text=null,this.Mt=21+u(0,4),this.yt=!1,this.kt=t.t(),this.St=l(),this.xt=0,this.bt=0,this.Tt=null,this.At=!1,this.Ct=1,this.Rt=1,this.Dt=0,this.$t=0,this.Ft=null,this.Pt=!1,this.Ht=this.size.t(),this.Wt=l(),this.Ut=0,this.Nt=0,this.zt=null,this.qt=!1}moveTo(t,s){this.kt=this.ht.t(),this.St=t;const i=this.kt.u(this.St)/s;return this.xt=S,this.bt=S+i,this.yt=!0,new Promise((t=>this.Tt=t))}Bt(t,s){return this.Ct=this.color.a,this.Rt=t,this.Dt=S,this.$t=S+s,this.At=!0,new Promise((t=>this.Ft=t))}resizeTo(t,s){return this.Ht=this.size.t(),this.Wt=t,this.Ut=S,this.Nt=S+s,this.Pt=!0,new Promise((t=>this.zt=t))}It(){this.text=Ms(ms)}Et(){this.text=Ms(ps),setTimeout((()=>this.text=null),1500)}Lt(){this.text=Ms(vs)}_t(){if(!this.yt)return;if(S>=this.bt)return this.ht=this.St.t(),this.yt=!1,this.Tt(this),void(this.Tt=null);const t=o(S,this.xt,this.bt);this.ht=this.kt.S(this.St,t)}Gt(){if(!this.At)return;if(S>=this.$t)return this.color.a=this.Rt,this.At=!1,this.Ft(this),void(this.Ft=null);const t=o(S,this.Dt,this.$t);this.color.a=r(t,this.Ct,this.Rt)}Jt(){if(!this.Pt)return;if(S>=this.Nt)return this.size=this.Wt.t(),this.Pt=!1,this.zt(this),void(this.zt=null);const t=o(S,this.Ut,this.Nt);this.size=this.Ht.S(this.Wt,t)}update(){this._t(),this.Gt(),this.Jt()}et(){W(this.ht,this.size,this.Mt,void 0,this.color),this.text&&q(this.text,this.ht.add(l(0,this.size.y/2+1)),1,this.color)}}const ks=[new d(1,1,1,.3),null,new d(1,0,0,.5),new d(1,1,1,.5)],Ss=l(2);class xs{constructor(t,s){this.ht=t,this.offset=l(),this.Ot=s||function(t){const s=2*t-1,i=u(1,s**2+1),n=[],e=[];for(let t=0;t<s;t++)n.push(new Array(s).fill(Et));for(let t=0;t<i;t++){let i,h;if(0===t)i=u(0,s),h=u(0,s),e.push([i,h]);else{const t=e[u(0,e.length)],o=Vt.map((i=>{let e=[t[0]+i[0],t[1]+i[1]];return e[0]<0||e[0]>=s||e[1]<0||e[1]>=s||n[e[1]][e[0]]!==Et?null:e})).filter((t=>t));if(!o.length)continue;const r=o[u(0,o.length)];[i,h]=r,e.push(r)}n[h][i]=Lt}for(let t=n.length-1;t>=0;t--)n[t].every((t=>t===Et))&&n.splice(t,1);for(let t=s-1;t>=0;t--)n.map((s=>s[t])).every((t=>t===Et))&&n.forEach((s=>s.splice(t,1)));return n}(2),this.jt(),this.Yt=-1,1===this.Ot.length&&1===this.Ot[0].length&&(this.Yt=u(0,7)-1,this.Yt>-1&&(this.Yt+=25)),this.state=jt,this.Kt=!1,this.Qt=0,this.Vt=0}Xt(){this.Kt||(this.Kt=!0,this.Qt=S,this.Vt=S+.2)}jt(){for(let t=0;t<this.Ot.length;t++)for(let s=0;s<this.Ot[t].length;s++){const i=l(this.Ot[t].length,this.Ot.length),n=Vt.reduce(((n,e,h)=>{const o=l(s+e[0],t+e[1]);return o.T(i)&&7&this.Ot[o.y][o.x]?n|os[h]:n}),0);this.Ot[t][s]=7&this.Ot[t][s]|n<<3}}t(){const t=[];for(let s=0;s<this.Ot.length;s++)t.push([...this.Ot[s]]);return new xs(this.ht.t(),t)}Zt(){const t=2*this.Ot[0].length,s=2*this.Ot.length;return[this.ht.t(),this.ht.add(l(t,s))]}ts(){const t=_.i(this.ht).add(l(1)).h(l(2)).floor(),s=this.Ot[t.y];return!!s&&!!s[t.x]}rotate(t){const s=this.Ot.length,i=this.Ot[0].length,n=new Array(i);for(let t=0;t<i;t++)n[t]=new Array(s).fill(Et);for(let t=0;t<s;t++)for(let s=0;s<i;s++)n[s][t]=this.Ot[t][s];1===t?n.reverse():n.forEach((t=>t.reverse())),this.Ot=n,this.jt()}update(){if(!this.Kt)return;S>=this.Vt&&(this.offset.y=0,this.Kt=!1);const s=o(S,this.Qt,this.Vt);this.offset.y=1*Math.sin(s*t)}et(){for(let t=0;t<this.Ot.length;t+=1){const s=this.Ot[t];for(let i=0;i<s.length;i+=1){const n=s[i];if(!(7&n))continue;const e=ks[this.state],h=l(i,t).multiply(Ss).add(this.ht).add(this.offset),o=this.Yt>-1?this.Yt:n>>3;W(h,Ss,o),e&&U(h,Ss,e)}}}}const bs=new class{constructor(){this.ss=null,this.ns=Xt}init(t){this.ss=t}es(t,s){this.ns=t,this.hs=this.ss[t],this.hs.init(s)}os(){this.hs.os()}rs(){this.hs.rs()}},Ts=new gs(l(0,-10),l(4,2.5),"Start",1.5,new d(1,1,1),new d(0,0,0),(()=>{bs.es(ts)}),!1),As=new rs;As.tt(Ts);const Cs=l(5,0),Rs=l(-5,0),Ds=new ys(Cs.t());Ds.size=l(10);let $s=null,Fs=0;function Ps(){$s=new xs(l());const t=$s.Zt(),s=l((t[0].x+t[1].x)/2,(t[0].y+t[1].y)/2),i=$s.ht.i(s);$s.ht.x=Rs.x+i.x,$s.ht.y=Rs.y+i.y,$s.state=Yt,$s.Xt()}const Hs={init(){Ps()},os(){const s=Math.sin(S*t*2/.5)/2+.5,i=Math.sin(S*t*2/1.3),n=Math.sin(S*t*2/2.1);Ds.color.a=1-.2*s,Ds.ht=Cs.add(l(1*i,1*n)),S-Fs>=1&&(Ps(),Fs=S),$s&&$s.update(),E(0)&&As.pressed(),L(0)&&As.nt(),As.update()},rs(){$s&&$s.et(),Ds.et();const s=Math.sin(S*t*2/3)/2+.5;q("Death Estate",l(0,10),5,new d(1,0,0),1+.2*s,new d(1,1,1)),As.et()}},Ws=[null,null,new d(.6,.6,.6),new d(.5,.5,.5),new d(.8,.3,.3),new d(1,0,0)],Us=[new d(.278,.176,.235),new d(.223,.125,.183)],Ns=[null,{index:4,angle:t},{index:4,angle:-t/2},{index:1,angle:-t/2},{index:4,angle:0},{index:0,angle:0},{index:1,angle:0},{index:2,angle:0},{index:4,angle:t/2},{index:1,angle:t},{index:0,angle:t/2},{index:2,angle:-t/2},{index:1,angle:t/2},{index:2,angle:t},{index:2,angle:t/2},{index:3,angle:0}];class zs{constructor(t,s,i){this.x=s,this.y=i,this.type=t||0,this.cs=0,this.us=!1}t(){return new zs(this.type,this.x,this.y)}apply(t){this.type=t.type}}class qs{constructor(t,s){this.ht=l(),this.Ot=[],this.ls=[],this.ds=[],this.fs=!1,this.ws=!1,this.size=l(t,s);const i=this.size.x*this.size.y;for(let t=0;t<i;t+=1){const s=new zs(0,t%this.size.x,Math.floor(t/this.size.y));this.Ot.push(s),this.ds.push(s.t())}}gs(){this.Ot.forEach(((t,s)=>this.ds[s].apply(t)))}ps(t){const s=t.Zt(),i=this.Zt();if(!(s[0].x>=i[0].x&&s[0].y>=i[0].y&&s[1].x<=i[1].x&&s[1].y<=i[1].y))return!1;const n=t.ht.h(l(2)),e=t.Ot;for(let t=0;t<e.length;t+=1){const s=e[t];for(let i=0;i<s.length;i+=1){if(!(7&s[i]))continue;const e=n.add(l(i,t)),h=this.vs(e.x,e.y);if(h&&h.type)return!1}}return!0}Ms(t){const s=t.t();s.state=Qt;for(const t of this.Ot){const i=l(t.x,t.y).multiply(l(2));s.ht=i;for(let t=0;t<4;t++){if(this.ps(s)&&this.ys(s))return s;s.rotate(1)}}return null}ks(){const t=this.Ot.filter((t=>t.type===_t));for(const s of t)for(const t of Vt){const i=l(s.x+t[0],s.y+t[1]),n=this.vs(i.x,i.y);if(n&&n.type===Et)return void(this.ws=!0)}this.ws=!1}ys(t){const s=t.ht.h(l(2)),i=t.Ot;for(let t=0;t<i.length;t+=1){const n=i[t];for(let i=0;i<n.length;i+=1){if(!(7&n[i]))continue;const e=s.add(l(i,t));if(Vt.map((t=>this.vs(e.x+t[0],e.y+t[1]))).filter((t=>t)).some((t=>t.type===_t)))return!0}}return!1}Ss(t){t.state=Yt,this.ls.push(t);const s=t.ht.h(l(2)),i=t.Ot;for(let t=0;t<i.length;t+=1){const n=i[t];for(let i=0;i<n.length;i+=1){if(!(7&n[i]))continue;const e=s.add(l(i,t));this.xs(e.x,e.y,Lt)}}}bs(){return this.size.multiply(l(2))}Zt(){return[this.ht.t(),this.ht.add(this.size.multiply(l(2)))]}xs(t,s,i){this.Ot[t+s*this.size.x].type=i}vs(t,s){return l(t,s).T(this.size)?this.Ot[t+s*this.size.x]:null}Ts(){const t=this.As();return t?this.vs(t.x,t.y):null}As(t=!1){return this.Cs(_,t)}Cs(t,s=!1){const i=t.i(this.ht).add(l(1));return s||i.T(this.size.multiply(l(2)))?i.h(l(2)).floor():null}Rs(t,s,i){const n=[];if(Math.abs(s.x-t.x)<Math.abs(s.y-t.y)){const i=Math.max(Math.min(s.y,t.y),0),e=Math.min(Math.max(s.y,t.y),this.size.y-1);for(let s=i;s<=e;s+=1)n.push(this.vs(t.x,s))}else{const i=Math.max(Math.min(s.x,t.x),0),e=Math.min(Math.max(s.x,t.x),this.size.x-1);for(let s=i;s<=e;s+=1)n.push(this.vs(s,t.y))}for(const t of n)t.type=i;return n}Ds(){this.Ot.forEach(((t,s)=>t.apply(this.ds[s])))}$s(){const t=this.Ot.filter((t=>t.type===_t||t.type===Ot));t.forEach((t=>{t.type=Ot,t.us=!1}));const i=t.filter((t=>0===t.x||0===t.y||t.x===this.size.x-1||t.y===this.size.y-1));if(!i.length)return void(this.fs=!1);const n=[];i.forEach((t=>{n.some((i=>s(i.x-t.x)<=3&&s(i.y-t.y)<=3))&&t.type!==Ot||(t.us=!0,n.push(t)),this.Fs(t.x,t.y)})),this.fs=t.every((t=>t.type===_t))}Fs(t,s){const i=this.vs(t,s);if(i&&i.type===Ot){i.type=_t;for(const i of Vt)this.Fs(t+i[0],s+i[1])}}jt(){const t=this.Ot.filter((t=>t.type===_t));for(const s of t)s.cs=Vt.reduce(((t,i,n)=>{const e=l(s.x+i[0],s.y+i[1]);if(e.T(this.size)){const s=this.vs(e.x,e.y);if(!s||s.type!==_t)return t}else if(!s.us)return t;return t|os[n]}),0)}Ps(){const t=this.size.x*this.size.y;let s=0,i=0;for(const t of this.Ot)t.type===Lt?s+=1:t.type===_t&&(i+=1);return{Hs:t,Ws:s,Us:i}}et(){for(const t of this.Ot){let s=-1,i=0;const n=l(t.x,t.y).multiply(l(2)).add(this.ht),e=Ws[t.type]||Us[(t.x+t.y)%2];if(t.type===_t){const n=Ns[t.cs];n&&(s=n.index+16,i=n.angle)}s>-1?W(n,l(2),s,void 0,void 0,i):e&&U(n,l(2),e)}for(const t of this.ls)t.et()}}let Bs,Is,Es,Ls,_s,Gs=l(),Js=null,Os=null,js=l(),Ys=null,Ks=null;const Qs=l(0,-8);let Vs=[];const Xs=l(),Zs=l();let ti=l();const si="Drag and drop the ghosts' house requests! Must touch\na road, not overlap other houses, and be within the grid",ii=new rs,ni=new gs(l(0,-4),l(5,3),"Done",1.5,new d(1,1,1),new d(0,0,0),(()=>{Bs.fs&&bs.es(ss)}),!1);ii.tt(ni);const ei=new rs,hi=new gs(l(0,-5),l(5,3),"Rotate",1.2,new d(1,1,1),new d(0,0,0),(()=>{_s.rotate(1)}),!1);ei.tt(hi);const oi=new gs(hi.ht.add(l(0,-4)),l(5,3),"Skip",1.5,new d(1,1,1),new d(0,0,0),(()=>{Es>0&&(_s=null,Es-=1,ls.play(),Ys.Lt(),Ys.Bt(0,2),Ys.moveTo(Qs.t().add(l(20,0)),10).then((t=>t.qt=!0)),bs.es(ss)),Es<=0&&(oi.enabled=!1)}),!1,!1);ei.tt(oi);const ri={lower:l(),upper:l()},ci=oi.ht.i(oi.size.h(l(2))).add(l(1)),ui=hi.ht.add(hi.size.h(l(2))).add(l(1));function li(){for(let t=0;t<Vs.length;t++){const s=Vs[t];s.update(),s.qt&&(Vs.splice(t,1),t--)}}const ai={init(){Bs=new qs(15,15),Js=null,Os=null,_s=null;const t=Bs.bs();p.x=Bs.ht.x+t.x/2-1,p.y=Bs.ht.y+t.y/2-1,ni.ht.x=Bs.ht.x+t.x/2-1,ni.enabled=!1,Xs.x=ni.ht.x,Xs.y=Bs.ht.y+t.y-1+5,Zs.x=ni.ht.x,Zs.y=ni.ht.y-4,Es=3;const s=Bs.Zt();ri.lower=s[0].i(l(8)),ri.upper=s[1].add(l(8)),js.x=Bs.ht.x+t.x/2-1,js.y=-8,Qs.x=Bs.ht.x+t.x-5,Vs=[]},os(){if(E(0)&&!ii.pressed()&&(Os=Bs.As(),Os)){Bs.gs();const t=Bs.Ts();Is=t.type===_t||t.type===Ot?Jt:Gt}if(L(0)){if(ii.nt(),Os){Bs.Ds();const t=Bs.As(!0);Is===Gt?(Bs.Rs(Os,t,_t),ds.play()):(Bs.Rs(Os,t,Et),fs.play()),Bs.$s(),Bs.jt(),ni.enabled=Bs.fs}Os=null}if(ii.update(),I(0)&&Os){Bs.Ds();const t=Bs.As(!0);Bs.Rs(Os,t,Is)}},rs(){Bs.et(),q("Make roads by clicking and dragging lines\non the grid. Delete by clicking and dragging\non existing roads",Xs,1.5),Bs.fs||q("All roads must connect to an edge of the grid",Zs,1.5),ii.et()}},di={init(){oi.enabled=!1,hi.enabled=!1,Ys=new ys(l(40,-20)),Ys.moveTo(Qs,15).then((()=>{bs.es(is)})),Vs.push(Ys)},os(){li(),ei.update()},rs(){Bs.et(),_s&&_s.et();for(const t of Vs)t.et();q(si,Xs,1.5),q("right-click\nworks too",hi.ht.add(l(3,.5)),1,void 0,void 0,void 0,"left"),q(`Skips left: ${Es}`,oi.ht.add(l(3,0)),1.5,void 0,void 0,void 0,"left"),ei.et()}},fi={init(){oi.enabled=Es>0,hi.enabled=!0,Ys.It(),Bs.ks(),_s=new xs(js.t()),Ks=Bs.Ms(_s),Bs.ws&&(Ks||Es>0)&&us.play(),_s.Xt()},os(){if(li(),_s.update(),L(2)&&(_s.rotate(1),cs.play()),E(0)&&!ei.pressed()&&_s.ts()&&(as.play(),_s.state=jt,Gs=_s.ht.t(),Js=_.t()),L(0)&&(ei.nt(),Js)){_s.ht.x=2*Math.floor((_s.ht.x+1)/2),_s.ht.y=2*Math.floor((_s.ht.y+1)/2);const t=_s.Zt(),s=l((t[0].x+t[1].x)/2,(t[0].y+t[1].y)/2);s.x>=ci.x&&s.x<=ui.x&&s.y>=ci.y&&s.y<=ui.y&&(_s.ht.x=Gs.x,_s.ht.y=Gs.y),Bs.ps(_s)&&Bs.ys(_s)?(ds.play(),Bs.Ss(_s),Ys.Et(),Ys.resizeTo(l(1),1),Ys.moveTo(s.t(),10).then((t=>t.Bt(0,1))).then((t=>{t.qt=!0})),_s=null,bs.es(ss)):(fs.play(),_s.state=Kt),Js=null}if(ei.update(),I(0)&&Js){_s.ht.x=Gs.x+(_.x-Js.x),_s.ht.y=Gs.y+(_.y-Js.y);const t=_s.Zt();t[0].x<ri.lower.x?_s.ht.x=ri.lower.x:t[1].x>ri.upper.x&&(_s.ht.x=ri.upper.x-(t[1].x-t[0].x)),t[0].y<ri.lower.y?_s.ht.y=ri.lower.y:t[1].y>ri.upper.y&&(_s.ht.y=ri.upper.y-(t[1].y-t[0].y))}bs.ns===is&&(!Bs.ws||!Ks&&Es<=0)&&(Ys&&(Ys.Lt(),Ys.Bt(0,2),Ys.moveTo(Qs.t().add(l(20,0)),10).then((t=>t.qt=!0))),ls.play(),bs.es(ns))},rs(){Bs.et();for(const t of Vs)t.et();_s.et(),q(si,Xs,1.5),q("right-click\nworks too",hi.ht.add(l(3,.5)),1,void 0,void 0,void 0,"left"),q(`Skips left: ${Es}`,oi.ht.add(l(3,0)),1.5,void 0,void 0,void 0,"left"),ei.et()}},wi={init(){hi.enabled=!1,oi.enabled=!1,Ls=Date.now()},os(){li(),ei.update();const s=Date.now(),i=s-Ls;if(ti=((s=1)=>(new a).v(c(2*t),s))(r(o(i,0,1e3),1,0)),i>=3e3){const t=Bs.Ps();bs.es(es,{timestamp:s,Ns:t.Hs,zs:t.Ws,Us:t.Us})}},rs(){Bs.et(),_s.et();for(const t of Vs)t.et();q("Game over! No more space or skips",Xs.add(ti),1.5),q("right-click\nworks too",hi.ht.add(l(3,.5)),1,new d(1,1,1,.5),void 0,void 0,"left"),q(`Skips left: ${Es}`,oi.ht.add(l(3,0)),1.5,new d(1,1,1,.5),void 0,void 0,"left"),ei.et()}},gi=new d(1,0,0),mi=new d(1,1,1),pi=new d(1,1,1),vi=new d(1,1,0),Mi="deathestate_jayther_ldb",yi={};let ki,Si=[],xi=0,bi=0,Ti=!0;const Ai=l(0,18),Ci=Ai.add(l(0,-5)),Ri=Ai.add(l(0,-13)),Di=Ri.add(l(3,-5)),$i=new Array(5);for(let t=0;t<$i.length;t++)$i[t]=[Di.add(l(-.7,-2*t)),Di.add(l(.7,-2*t))];const Fi=new rs,Pi=new gs(Ai.add(l(0,-31)),l(5,3),"Retry",1.5,new d(1,1,1),new d(0,0,0),(()=>{bs.es(ts)}),!1);function Hi(t,s){for(ki={zs:t,timestamp:s,qs:new Date(s).toLocaleDateString(),Bs:!0},Si.push(ki),Si.sort(((t,s)=>{const i=s.zs-t.zs;return 0===i?s.timestamp-t.timestamp:i}));Si.length>5;)Si.pop();!function(){const t=Si.map((t=>({zs:t.zs,timestamp:t.timestamp}))),s=JSON.stringify(t);if(Ti)try{window.localStorage.setItem(Mi,s)}catch(t){Ti=!1}Ti||(yi[Mi]=s)}()}Fi.tt(Pi);const Wi=[{init(){},os(){},rs(){}},Hs,ai,di,fi,wi,{init(t){xi=t.Ns,bi=t.Us,function(){let t=null;if(Ti)try{t=window.localStorage.getItem(Mi)}catch(t){Ti=!1}else t=yi[Mi]||null;t&&(Si=JSON.parse(t)),Si=Si.filter((t=>"number"==typeof t.zs)),Si.forEach((t=>t.qs=new Date(t.timestamp).toLocaleDateString()))}(),Hi(t.zs,t.timestamp),p.x=0,p.y=0},os(){E(0)&&Fi.pressed(),L(0)&&Fi.nt(),Fi.update()},rs(){!function(){q("Game over",Ai,4,gi,.5,mi),q(`You covered ${ki.zs} tiles (${Math.floor(ki.zs/xi*100)}%)\n(road count: ${bi}, grid total: ${xi})`,Ci,2,pi),q("High Scores",Ri,4,gi,.5,mi);for(let t=0;t<5;t++){const s=Si[t];let i,n,e;s?(i=s.qs,n=s.zs.toString(),e=s.Bs?vi:pi):(i="-------------",n="---",e=pi),q(i,$i[t][0],2,e,void 0,void 0,"right"),q(n,$i[t][1],2,e,void 0,void 0,"left")}}(),Fi.et()}}],Ui=680,Ni=940,zi=v;!function(t,s,n,e,h,o){A.onerror=A.onload=()=>{y=l(m).h(M=l(A.width,A.height)),document.body.style="margin:0;overflow:hidden;background:#000;touch-action:none;user-select:none;-webkit-user-select:none;-moz-user-select:none",document.body.appendChild(C=document.createElement("canvas")),R=C.getContext("2d"),C.style=T,function(){0;et=document.createElement("canvas"),ht=et.getContext("webgl",{antialias:!1}),et.style=T,ot=function(t){if(!t||!t.width)return;const s=ht.createTexture();return ht.bindTexture(St,s),ht.texImage2D(St,0,Tt,Tt,xt,t),ht.texParameteri(St,Rt,At),ht.texParameteri(St,Ct,At),ht.texParameteri(St,Dt,Pt),ht.texParameteri(St,$t,Pt),s}(A),document.body.appendChild(et),ct=function(t,s){0;const i=ht.createProgram();ht.attachShader(i,wt(t,Nt)),ht.attachShader(i,wt(s,Ut)),ht.linkProgram(i),0;return i}("precision highp float;uniform mat4 m;attribute vec2 p,t;attribute vec4 c,a;varying vec2 v;varying vec4 d,e;void main(){gl_Position=m*vec4(p,1,1);v=t;d=c;e=a;}","precision highp float;varying vec2 v;varying vec4 d,e;uniform sampler2D s;void main(){gl_FragColor=texture2D(s,v)*d+e;}");const t=new ArrayBuffer(Bt*zt*It);(function(t,s,i){0;const n=ht.createBuffer();ht.bindBuffer(t,n),ht.bufferData(t,s,i)})(Ht,t.byteLength,Wt),ut=new Float32Array(t),lt=new Uint32Array(t);let s=at=0;const i=(t,i,n,e,h=0)=>{const o=ht.getAttribLocation(ct,t);ht.enableVertexAttribArray(o),ht.vertexAttribPointer(o,e,i,h,It,s),s+=e*n};i("p",bt,4,2),i("t",bt,4,2),i("c",xt,1,4,1),i("a",xt,1,4,1)}(),document.body.appendChild(D=document.createElement("canvas")),$=D.getContext("2d"),D.style=T,t(),r()};const r=(t=0)=>{let o=t-x;if(x=t,b=i(b+!0*o,50),w.x){D.width=C.width=w.x,D.height=C.height=w.y;const t=innerWidth/innerHeight,s=C.width/C.height;C.style.width=D.style.width=t<s?"100%":"",C.style.height=D.style.height=t<s?"":"100%",et&&(et.style.width=C.style.width,et.style.height=C.style.height)}else D.width=C.width=i(innerWidth,f.x),D.height=C.height=i(innerHeight,f.y);F=l(C.width,C.height);{let t=0;for(b<0&&b>-9&&(t=b,b=0);b>=0;b-=1e3/60)Y(),s(),S=++k/60,n(),K();b+=t}F=l(C.width,C.height),R.imageSmoothingEnabled=!1,function(t,s,i,n,e){var h;ht.viewport(0,0,et.width=t,et.height=s),ht.clear(Ft),ht.bindTexture(St,rt=ot),ht.useProgram(ct),ft=h;const o=2*e/t,r=2*e/s;ht.uniformMatrix4fv(ht.getUniformLocation(ct,"m"),0,new Float32Array([o,0,0,0,0,r,0,0,1,1,-1,1,-1-o*i,-1-r*n,0,0]))}(C.width,C.height,p.x,p.y,v),e(),h(),function(t,s){if(!at&&!s)return;gt(),s&&t.drawImage(et,0,0)}(R),requestAnimationFrame(r)};o?A.src=o:A.onload()}((function(){Bi(),bs.init(Wi),bs.es(Zt)}),(function(){bs.os()}),(function(){}),(function(){bs.rs()}),(function(){}),"t.png");let qi=null;function Bi(){const t=Ui/Ni>innerWidth/innerHeight?innerWidth/Ui:innerHeight/Ni;!function(t){v=t}(zi*t)}window.addEventListener("resize",(function(){clearTimeout(qi),qi=setTimeout(Bi,200)}),!1)}();</script></body></html>