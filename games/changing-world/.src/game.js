!function(){"use strict";var t="undefined"==typeof window?global:window;if("function"!=typeof t.require){var e={},i={},n={}.hasOwnProperty,o={},r=function(t,e){var i=0;e&&(e.indexOf(!1)&&(i="components/".length),e.indexOf("/",i)>0&&(e=e.substring(i,e.indexOf("/",i))));var n=o[t+"/index.js"]||o[e+"/deps/"+t+"/index.js"];return n?"components/"+n.substring(0,n.length-".js".length):t},s=function(){var t=/^\.\.?(\/|$)/;return function(e,i){var n,o,r=[];n=(t.test(i)?e+"/"+i:i).split("/");for(var s=0,c=n.length;c>s;s++)o=n[s],".."===o?r.pop():"."!==o&&""!==o&&r.push(o);return r.join("/")}}(),c=function(t){return t.split("/").slice(0,-1).join("/")},a=function(e){return function(i){var n=s(c(e),i);return t.require(n,e)}},l=function(t,e){var n={id:t,exports:{}};return i[t]=n,e(n.exports,a(t),n),n.exports},u=function(t,o){var c=s(t,".");if(null==o&&(o="/"),c=r(t,o),n.call(i,c))return i[c].exports;if(n.call(e,c))return l(c,e[c]);var a=s(c,"./index");if(n.call(i,a))return i[a].exports;if(n.call(e,a))return l(a,e[a]);throw new Error('Cannot find module "'+t+'" from "'+o+'"')};u.alias=function(t,e){o[e]=t},u.register=u.define=function(t,i){if("object"==typeof t)for(var o in t)n.call(t,o)&&(e[o]=t[o]);else e[t]=i},u.list=function(){var t=[];for(var i in e)n.call(e,i)&&t.push(i);return t},u.brunch=!0,t.require=u}}(),require.register("scripts/block",function(t,e,i){"use strict";var n=function(t,i){var n=25,o=6,r=t,s=i,c=!1,a=!1,l={t:!1,r:!1,d:!1,l:!1},u=!1,h=!1,A=function(t,i){e("scripts/display").drawLine(t,i,o)};return{wallCount:function(){var t=0;return l.t||++t,l.r||++t,l.d||++t,l.l||++t,t},isConnected:function(){return l.t||l.r||l.d||l.l},isConnectedTo:function(t){return l[t]},setPathFrom:function(t){var e={t:"d",r:"l",d:"t",l:"r"};l[e[t]]=!0},setPathTo:function(t){l[t]=!0},setStarting:function(){u=!0},setExit:function(){h=!0},visit:function(){c=!0},wasVisited:function(){return c},clearContent:function(){a=!1},setContent:function(){a=!0},hasContent:function(){return a},reDraw:function(){this.clear(),this.draw(),$.trigger("redrawBlock_"+r+"_"+s,{block:this})},clear:function(){var t=r*n,i=s*n,c=n+o;e("scripts/display").clear(t,i,c,c)},draw:function(){if(!l.t){var t={x:s*n,y:r*n},e={x:(s+1)*n,y:r*n};A(t,e)}if(!l.r){var i={x:(s+1)*n,y:r*n},o={x:(s+1)*n,y:(r+1)*n};A(i,o)}if(!l.d){var c={x:(s+1)*n,y:(r+1)*n},a={x:s*n,y:(r+1)*n};A(c,a)}if(!l.l){var u={x:s*n,y:(r+1)*n},h={x:s*n,y:r*n};A(u,h)}},row:r,col:s,size:n,border:o}};i.exports=n}),require.register("scripts/choice",function(t,e,i){"use strict";var n=e("scripts/content"),o=function(t,i,o){n.call(this),this.active=!0;var r=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUBAMAAAB/pwA+AAAAD1BMVEVDkiRtsg5tbSRutBS324tBdjoXAAAAA3RSTlMBuKrhq8CvAAAAS0lEQVR4XmMAAUYGOGAUgDIEBYUNBQUVgSxhYwgwZGA0hjNBgi7OcKYJGlOAgRnOhKh1ASlAMI2BTIS5giDbgAhiNZMCkCCbifAFAN6zEyVNyrfjAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUBAMAAAB/pwA+AAAAD1BMVEU/b8FMaXFEecNIf8GpxOSP1hZTAAAAA3RSTlOGAMyNHC13AAAAWklEQVR4XpXOwQ2AMAgF0A8sgE5QcQEj3aDdfyZbUluvcvh5IUDA1kqpZ3AfBCCJGQT1URe4ZS5BaVnrZMmT3rtpzAZ9zi46ZN2FmZ1mftP7A+j7TlCPH4y1B1V0GE6KvG7FAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUBAMAAAB/pwA+AAAAD1BMVEX5fg/sbgnxdw/zn1X61LJRsA56AAAAA3RSTlP9CKUpD/kyAAAAWklEQVR4Xo2OwQ2AIAxFCzqA7QT1T0ACG8D+M1moiPHkOzQvP+9QYkO443q6ikAjAFO6CXTYzenR1oYqGXua69Y8WGunljTbUk3JgzxaBqBRKb5++Kvhqyu4AM44C8Q3rY/0AAAAAElFTkSuQmCC"];this.image=r[i],this.value=t,this.el=o,o.style.backgroundImage="url("+this.image+")",this.elClassName=o.className,this.registerEvents=function(){var t=this;$.on("reachedBlock_"+this.block.row+"_"+this.block.col,function(){t.active&&e("scripts/game").story.choose(t.value)}),this.draw=function(){if(this.active){var t=5,i=this.block.row*this.block.size+1.5*t,n=this.block.col*this.block.size+1.5*t,o=this.block.size-2*t;e("scripts/display").drawImage(this.image,i,n,o,o)}},this.addMouseOver(function(){$("#sB ."+t.elClassName).className=t.elClassName+" h"},function(){$("#sB ."+t.elClassName).className=t.elClassName})},this.disable=function(){this.active=!1,this.clear()}};o.prototype=Object.create(n.prototype),o.prototype.constructor=o,i.exports=o}),require.register("scripts/content",function(t,e,i){"use strict";var n=function(){this.block=null,this.image="";var t=5;this.setBlock=function(t){this.block=t,t.setContent();var e=this;$.on("redrawBlock_"+t.row+"_"+t.col,function(t){e.block.row===t.data.block.row&&e.block.col===t.data.block.col&&e.draw()})},this.moveToBlock=function(t){this.clear(),this.setBlock(t),this.draw()},this.clear=function(){this.block.clearContent();var t=this.block.row*this.block.size+this.block.border,i=this.block.col*this.block.size+this.block.border,n=this.block.size-this.block.border;e("scripts/display").clear(t,i,n,n)},this.draw=function(){var i=this.block.row*this.block.size+1.5*t,n=this.block.col*this.block.size+1.5*t,o=this.block.size-2*t;e("scripts/display").drawImage(this.image,i,n,o,o)},this.addMouseOver=function(i,n){var o=this.block.size-2*t,r=this.block.row*this.block.size+1.5*t,s=this.block.col*this.block.size+1.5*t;e("scripts/display").addMouseOver(r,s,o,o,i,n)}};i.exports=n}),require.register("scripts/display",function(t,e,i){"use strict";var n=function(){function t(t){var i,n,o=e,r=0,s=0;if(void 0!==o.offsetParent)do r+=o.offsetLeft,s+=o.offsetTop,o=o.offsetParent;while(o);return i=t.pageX-r,n=t.pageY-s,{x:i,y:n}}var e=$("canvas"),i=e.getContext("2d"),n="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKBAMAAAB/HNKOAAAAGFBMVEUxMTE6OjpCQkJKSkpSUlJaWlopKSkhISEHxUPBAAAAQ0lEQVR4XgVAyw1AQBB96+I6ySpgZ1YB5j2cJTRACUrQ/0dQYlwmFNIdbyo7TK4LvvEG5rrGjtpowpDUCesWQvv4HD/f/AgYtHxdLQAAAABJRU5ErkJggg==",o=[];return e.on("mousemove",function(e){for(var i=t(e),n=0;n<o.length;++n){var r=o[n];if(r){var s=!1;i.x>r.left&&i.x<r.left+r.width&&i.y>r.top&&i.y<r.top+r.height&&(s=!0),r.hovered&&!s?(r.outCallback(),r.hovered=!1):!r.hovered&&s&&(r.inCallback(),r.hovered=!0)}}}),{setSize:function(t,i){e.height=i,e.width=t},drawLine:function(t,e,i){var o=Math.abs(e.y-t.y)+i,r=Math.abs(e.x-t.x)+i,s=t.x<e.x?t.x:e.x,c=t.y<e.y?t.y:e.y;this.drawImage(n,c,s,r,o)},drawImage:function(t,e,n,o,r){var s=new Image;s.onload=function(){i.drawImage(s,n,e,o,r)},s.src=t},removeMouseOver:function(t){o[t]=!1},addMouseOver:function(t,e,i,n,r,s){var c={left:e,top:t,width:i,height:n,inCallback:r,outCallback:s,hovered:!1};return o.push(c),o.length-1},clear:function(t,e,n,o){i.clearRect(e,t,n,o)},getWidth:function(){return $("canvas").attributes.width.value},getPosition:function(){for(var t=$("canvas"),e=0,i=0;t;)e+=t.offsetLeft-t.scrollLeft+t.clientLeft,i+=t.offsetTop-t.scrollTop+t.clientTop,t=t.offsetParent;return{left:e,top:i}}}}();i.exports=n}),require.register("scripts/game",function(t,e,i){"use strict";var n=e("scripts/story"),o=e("scripts/moves"),r=e("scripts/player"),s=e("scripts/maze"),c=function(){var t="Changing Worlds",i=new o,c="paused",a=new n("article"),l=new s,u=new r;i.registerEvents(),$("title").text=t;var h=function(){var t=e("scripts/game");document.hidden?t.pause():(t["continue"](),e("scripts/notify").show("info","Welcome Back"))};return{story:a,maze:l,player:u,pause:function(){c="paused",$.trigger("gamePaused"),$("main").className="paused"},"continue":function(){c="running",$.trigger("gameContinued"),$("main").className=""},isRunning:function(){return"running"===c?!0:void 0},displayEvents:function(){document.addEventListener("visibilitychange",h,!1)},start:function(){a.start()},end:function(){document.removeEventListener("visibilitychange",h,!1),a.finish()},endEpisode:function(){l.openExit()}}}();i.exports=c}),require.register("scripts/maze",function(t,e,i){"use strict";var n=function(){var t=20,i=[],n=t,o=[],r={},s=null,c=e("scripts/block"),a=e("scripts/special_blocks").ExitBlock;return function(){for(var t=0;n>t;++t){i[t]=[];for(var e=0;n>e;++e)i[t][e]=new c(t,e)}}(),{size:n,buildPath:function(t,e,i){t.setPathTo(i),e.setPathFrom(i)},allConnected:function(){for(var t=!0,e=0;n>e&&t;++e)for(var o=0;n>o&&t;++o)t=i[e][o].isConnected();return t},reachedExit:function(){e("scripts/game").end()},getExit:function(){return s},openExit:function(){s.enable()},getBlock:function(t,e){return i[t][e]},reset:function(){$.trigger("mazeReset")},visitBlock:function(t,e){i[t][e].visit(),o.push([t,e])},build:function(){var t=Math.floor(Math.random()*n),c=0;this.visitBlock(t,c),i[t][c].setStarting();var l=e("scripts/game");l.player.setBlock(i[t][c]),r.row=t;for(var u=this.getAdjustedBlocks(t,c),h=[];u.length>0&&!this.allConnected();){for(var A=null;u.length>0;){var f=Math.floor(Math.random()*u.length);if(h=u.splice(f,1)[0],A=i[h[0]][h[1]],!A.wasVisited())break;A=null}if(A)this.visitBlock(h[0],h[1]),this.buildPath(i[t][c],A,h[2]);else{var d=o.pop();if(!d)break;t=d[0],c=d[1]}u=this.getAdjustedBlocks(t,c)}var p=o[o.length-1];i[p[0]][p[1]].setExit(),s=new a,s.setBlock(i[p[0]][p[1]]),s.disable(),$.trigger("mazeBuilt",{exitB:s}),this.draw(),$.trigger("mazeDisplayed"),l["continue"]()},getAdjustedBlocks:function(t,e){var i=[];return t>0&&i.push([t-1,e,"t"]),n-1>e&&i.push([t,e+1,"r"]),n-1>t&&i.push([t+1,e,"d"]),e>0&&i.push([t,e-1,"l"]),i},getBlockAndWall:function(t){var e=i[0][0].size,n=Math.floor(t.x/e),o=Math.floor(t.y/e),r=e*(n+1)-t.x,s=e*(o+1)-t.y,c={h:{name:"r",distance:r},v:{name:"b",distance:s}};return e*n>=r-e/2&&(c.h.name="l",c.h.distance=e-r),e*o>=s-e/2&&(c.v.name="l",c.v.distance=e-s),{block:i[o][n],wall:c.v.distance<c.h.distance?c.v.name:c.h.name}},getRandomCorneredBlock:function(){for(var t=0,e={};3!==t;)e=this.getRandomBlock(),t=e.wallCount();return e},getRandomBlock:function(){for(var t=0,e=0,o=!1,r=null;!o;)e=Math.floor(Math.random()*n),t=Math.floor(Math.random()*n),r=i[e][t],r.startingBlock||r.exitBlock||r.active||r.hasContent()||(o=!0);return r},draw:function(){var t=i[0][0].size;e("scripts/display").setSize(t*n+i[0][0].border,t*n+i[0][0].border);for(var o=0;n>o;++o)for(var r=0;n>r;++r)i[o][r].draw();e("scripts/game").player.draw()}}};i.exports=n}),require.register("scripts/moves",function(t,e,i){"use strict";var n=function(){var t=null,i=0,n=null;this.paused=!0;var o=15,r=35;this.direction="t";var s={t:["Up","Right","Down","Left"],r:["Right","Down","Left","Up"],d:["Down","Left","Up","Right"],l:["Left","Up","Right","Down"]},c=[37,38,39,40,87,65,83,68];this.registerEvents=function(){var e=this;document.addEventListener("keydown",function(t){e.checkKeys(t)}),$.on("gamePaused",function(){window.clearTimeout(t)}),$.on("gameContinued",function(t){e.paused&&e.setRandomDirectionChange(t)})},this.setRandomDirectionChange=function(){var s=this;s.paused=!1;var c=Math.floor(Math.random()*(r-o))+o;i=c,n=Date.now(),t=window.setTimeout(function(){var t=["t","r","d","l"],i=Math.floor(Math.random()*t.length),n=s.direction;s.direction=t[i],$("#dial").className=t[i],n!==s.direction&&e("scripts/notify").show("info","Movement direction changed"),s.setRandomDirectionChange()},1e3*c)},this.checkKeys=function(t){var i="_"+c.join("_")+"_";if(-1!==i.indexOf("_"+t.keyCode+"_")){t.preventDefault();var n=e("scripts/game").player;switch(t.keyCode){case 37:case 65:n["move"+s[this.direction][3]]();break;case 38:case 87:n["move"+s[this.direction][0]]();break;case 39:case 68:n["move"+s[this.direction][1]]();break;case 40:case 83:n["move"+s[this.direction][2]]()}}}};i.exports=n}),require.register("scripts/notify",function(t,e,i){"use strict";var n=function(){var t=4e3,i={info:"#1e90ff",warn:"#FFFF00",error:"#FF5D05"},n=$("#notification"),o=e("scripts/display"),r=o.getPosition();n.style.top=r.top+"px",n.style.left=r.left+"px";var s=o.getWidth();return n.style.width=s+"px",{show:function(e,o){n.style.color=i[e],n.innerHTML=o,n.style.display="block",setTimeout(function(){$("#notification").style.display="none"},t)}}}();i.exports=n}),require.register("scripts/player",function(t,e,i){"use strict";var n=e("scripts/content"),o=function(){n.call(this),this.name="Player",this.image="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACYAAAAmCAMAAACf4xmcAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAwUExURYOk3ExpcXKNtPr8/w5r+WuJuABm/wBm/2ek/wBm/4O1/0N90wxt/x54/wBm/0qT/1dL1vkAAAAMdFJOUxcAWijonkzE8YyZ1GwLKe4AAAE6SURBVDjLzdRJcsQgDAVQmWZojID73zZCQgymku5lfnnhglfygAAuCbS8trSRS6eneh2ZEDYF9wh092A0SJPvEZHqYLwYVXrXqoruGjyYuVOluaqKkm6jTpmJNtfd5Wyj2ZknldVVKcbOb4yVuKqmxcaVxYAo47myzcIQQxwMfLCIA460MRs8KIu2FHb4QFiKjZ1RsdJCg7iHh7kc9GK/h8vR5T8xLyyUPxOYwWcG/5x9+aUb2xdgZ/p712WaVH9vX6yxpJmv4XSxWh+RKl0s7cEdoks/G6khzNJPWm40kpTDreEYN7e0pTS5KOxKqy1NfrWNpQ/VZ4prW2vsBZhOvkHveQPCZMYEi0dsMObBXDqcTe5kLu3QpuQezDTGsEvLyJ3V2BHUOFEL665Lsk6N2U4kOQfNERjH4A8bvi3FqR5ZEgAAAABJRU5ErkJggg==",this.setName=function(t){this.name=t},this.movePlayer=function(t){var e=this.block;this.moveToBlock(t),$.trigger("leftBlock_"+e.row+"_"+e.col),$.trigger("reachedBlock_"+this.block.row+"_"+this.block.col)},this.moveLeft=function(){if(this.block.col>0&&this.block.isConnectedTo("l")){var t=e("scripts/game").maze.getBlock(this.block.row,this.block.col-1);this.movePlayer(t)}},this.moveRight=function(){var t=e("scripts/game"),i=t.maze.size-1;if(this.block.col<i&&this.block.isConnectedTo("r")){var n=t.maze.getBlock(this.block.row,this.block.col+1);this.movePlayer(n)}},this.moveUp=function(){if(this.block.row>0&&this.block.isConnectedTo("t")){var t=e("scripts/game").maze.getBlock(this.block.row-1,this.block.col);this.movePlayer(t)}},this.moveDown=function(){var t=e("scripts/game"),i=t.maze.size-1;if(this.block.row<i&&this.block.isConnectedTo("d")){var n=t.maze.getBlock(this.block.row+1,this.block.col);this.movePlayer(n)}}};o.prototype=Object.create(n.prototype),o.prototype.constructor=o,i.exports=o}),require.register("scripts/score",function(t,e,i){"use strict"}),require.register("scripts/special_blocks",function(t,e,i){"use strict";var n=e("scripts/content"),o=function(){n.call(this);var t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkBAMAAAATLoWrAAAAJFBMVEVKKA1MaXEiHhQPGR6BSBJmMwqXWRnd/v6fEQurbyRrY1OZpaBCeVihAAAABHRSTlP+ALR3m+KILQAAAQFJREFUeF6F0jFOAzEQQFErsbehwXABlBsgbgBja0VlhZmewhrJJ+ACRPIJVtoeGi6Q6zFe41jJRuIXLp7G8hRW1t4/qKXNTnq0VujWkFLkSEK3rSSiQpDDED5XChqAGcA70o0GISiEnRTVdCPSNx81xBXRmpD2a9pckr5G+6v0/0WzbWR+atq8NSJ0RASEncBzKcZGQaiYd3CiAQTAx+OX7lOJPcD78bu/CCl6P+Ir9ingxJwzxOHljxB4nmLOn3AiLcQxizWihdjlQ8ZziqOMdUozT8xjHjqV5dMcD2bbKfpCcEnTOfGKErNsy51UkAyRMbrR8rdUKVS629Welqz9BcaCkmunAVpfAAAAAElFTkSuQmCC",i="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkBAMAAAATLoWrAAAAHlBMVEVMaXE5IRAcGxtbMQ6SWBn//8/Y+PjY26ixsoEUewyVUZzeAAAAA3RSTlMAaDR25tHEAAAArUlEQVR4XpXPwQ3CMAxA0bYsALAAbRegdQ7cbbEBEyBV3AF1gFRw5phtcTEkJGmk8o9Psi1nQXkTCYxUVNIopSKmAmxtrQCYcnAR7E9vevSSZumEbkfpivcuou4vwi9dZtEwl85aHnIEAMS0cESKyCfNgCqigw4GiXCCsNkGBMbs/F3G+DSk6Ln0iRS24UWaIBqJ7EVLmCC3K0X9J7KD8JNQvpLWFVdueDCsbrMXzKWnf1m2mYYAAAAASUVORK5CYII=";this.image=t,this.active=!1,$.on("episodeFinished",function(t){t.data.exitB.enable()}),$.on("mazeBuilt",function(t){t.data.exitB.registerEvents()}),this.registerEvents=function(){var t=this;$.on("leftBlock_"+this.block.row+"_"+this.block.col,function(){t.draw()}),$.on("reachedBlock_"+this.block.row+"_"+this.block.col,function(){t.active?e("scripts/game").maze.reachedExit():e("scripts/notify").show("warn","You can't leave yet, the state of the world was not reversed yet")})},this.enable=function(){this.active=!0,this.image=i,this.clear(),this.draw()},this.disable=function(){this.active=!1,this.image=t,this.clear(),this.draw()}};o.prototype=Object.create(n.prototype),o.prototype.constructor=o,i.exports={ExitBlock:o}}),require.register("scripts/story",function(t,e,i){"use strict";var n=function(t){var i=t,n="prologue",o=[],r=[],s=e("scripts/choice");return{choose:function(t){o.push(t),this["continue"]()},createChoices:function(){var t=$("#sB li"),i=this;t.forEach(function(t,n){var o=t.attributes.rel.value,r=new s(o,n,t),c=e("scripts/game").maze.getRandomCorneredBlock();r.setBlock(c),r.draw(),r.registerEvents(),i.cBlocks.push(r)})},clearChoices:function(){for(var t=0;t<r.length;++t)r[t].disable()},start:function(){var t=i,o=n,r=$(i+" ."+o+" p"),s=$(i+" ."+o+" h2");$("#sB").innerHTML=s.outerHTML,s.parentNode.removeChild(s);var c=$(i+" ."+o+" p:nth-child(1)");$("#sB").innerHTML+=c.outerHTML,c.parentNode.removeChild(c);for(var a=1;a<r.length;++a)setTimeout(function(){var e=$(t+" ."+o+" p:nth-child(1)");$("#sB").innerHTML+=e.outerHTML,e.parentNode.removeChild(e)},1e3*(a+.5));var l=this;setTimeout(function(){$("#sB button").on("click",function(){var t=e("scripts/game");t.maze.build(),t.displayEvents(),t["continue"](),l["continue"]()}).className="active"},1e3*(a+1.5)),n="chapter1"},"continue":function(){this.clearChoices();var t=!0;if($("#sB").innerHTML=$(i+" ."+n).innerHTML,$("#sB div.section")&&$("#sB div.section").length>0&&(t=!1,$("#sB div.section").forEach(function(t,e){e>0&&(t.style.display="none")}),$("#sB .sectionBtn").on("click",function(){var t=$("#sB .section");t[0].style.display="none",t[1].style.display="block",this.style.display="none",$("#sB>button").style.display="block"})),"finish"!==n&&"exit"!==n){var o=document.createElement("button");o.innerHTML="Make a choice",$("#sB ol").style.display="none",t||(o.style.display="none"),$("#sB").insertBefore(o,$("#sB ol")),$("#sB>button").on("click",function(){$("#sB p, #sB>button").forEach(function(t){t.style.display="none"}),$("#sB ol").style.display="block"})}this.createChoices(),"chapter1"===n?n="chapter2":"chapter2"===n?n="chapter3":"chapter3"===n?n="exit":"exit"===n&&(n="finish",e("scripts/game").endEpisode())},finish:function(){var t=$(i+" ."+n+" ."+o.join(""));0===t.length&&(t=$(i+" ."+n+" .other")),$("#sB").innerHTML=t.innerHTML;var r=document.createElement("button");r.innerHTML="Restart",r.className="active",$("#sB").appendChild(r),$("#sB").on("click",function(){document.location.reload()}),e("scripts/game").pause()},cBlocks:r}};i.exports=n});