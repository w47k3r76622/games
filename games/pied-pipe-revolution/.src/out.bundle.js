(()=>{var F=()=>{};function ve(t,e){let i=t.indexOf(e);if(i!=-1)return t.splice(i,1),!0}var Z={};function H(t,e){Z[t]=Z[t]||[],Z[t].push(e)}function tt(t,...e){(Z[t]||[]).map(i=>i(...e))}var E,j,Ut={get(t,e){return e=="_proxy"?!0:F}};function Se(){return E}function et(){return j}function Jt(t,{contextless:e=!1}={}){if(E=document.getElementById(t)||t||document.querySelector("canvas"),e&&(E=E||new Proxy({},Ut)),!E)throw Error("You must provide a canvas element for the game");return j=E.getContext("2d")||new Proxy({},Ut),j.imageSmoothingEnabled=!1,tt("init"),{canvas:E,context:j}}function be(t,e){let i=Math.sin(e),s=Math.cos(e);return{x:t.x*s-t.y*i,y:t.x*i+t.y*s}}function xt(t,e,i){return Math.min(Math.max(t,i),e)}function Ce(t){let{x:e=0,y:i=0,width:s,height:n}=t.world||t;return t.mapwidth&&(s=t.mapwidth,n=t.mapheight),t.anchor&&(e-=s*t.anchor.x,i-=n*t.anchor.y),s<0&&(e+=s,s*=-1),n<0&&(i+=n,n*=-1),{x:e,y:i,width:s,height:n}}var _t=class t{constructor(e=0,i=0,s={}){e.x!=null?(this.x=e.x,this.y=e.y):(this.x=e,this.y=i),s._c&&(this.clamp(s._a,s._b,s._d,s._e),this.x=e,this.y=i)}set(e){this.x=e.x,this.y=e.y}add(e){return new t(this.x+e.x,this.y+e.y,this)}subtract(e){return new t(this.x-e.x,this.y-e.y,this)}scale(e){return new t(this.x*e,this.y*e)}normalize(e=this.length()||1){return new t(this.x/e,this.y/e)}dot(e){return this.x*e.x+this.y*e.y}length(){return Math.hypot(this.x,this.y)}distance(e){return Math.hypot(this.x-e.x,this.y-e.y)}angle(e){return Math.acos(this.dot(e)/(this.length()*e.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(e,i,s,n){this._c=!0,this._a=e,this._b=i,this._d=s,this._e=n}get x(){return this._x}get y(){return this._y}set x(e){this._x=this._c?xt(this._a,this._d,e):e}set y(e){this._y=this._c?xt(this._b,this._e,e):e}};function y(){return new _t(...arguments)}var yt=class{constructor(e){return this.init(e)}init(e={}){this.position=y(),this.velocity=y(),this.acceleration=y(),this.ttl=1/0,Object.assign(this,e)}update(e){this.advance(e)}advance(e){let i=this.acceleration;e&&(i=i.scale(e)),this.velocity=this.velocity.add(i);let s=this.velocity;e&&(s=s.scale(e)),this.position=this.position.add(s),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(e){this.velocity.x=e}set dy(e){this.velocity.y=e}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(e){this.acceleration.x=e}set ddy(e){this.acceleration.y=e}isAlive(){return this.ttl>0}_pc(){}},vt=class extends yt{init({width:e=0,height:i=0,context:s=et(),render:n=this.draw,update:o=this.advance,children:a=[],anchor:l={x:0,y:0},opacity:f=1,rotation:p=0,scaleX:c=1,scaleY:w=1,...d}={}){this._c=[],super.init({width:e,height:i,context:s,anchor:l,opacity:f,rotation:p,scaleX:c,scaleY:w,...d}),this._di=!0,this._uw(),this.addChild(a),this._rf=n,this._uf=o,H("init",()=>{this.context||(this.context=et())})}update(e){this._uf(e),this.children.map(i=>i.update&&i.update(e))}render(){let e=this.context;e.save(),(this.x||this.y)&&e.translate(this.x,this.y),this.rotation&&e.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&e.scale(this.scaleX,this.scaleY);let i=-this.width*this.anchor.x,s=-this.height*this.anchor.y;(i||s)&&e.translate(i,s),this.context.globalAlpha=this.opacity,this._rf(),(i||s)&&e.translate(-i,-s),this.children.map(o=>o.render&&o.render()),e.restore()}draw(){}_pc(){this._uw(),this.children.map(e=>e._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(e){this.position.x=e,this._pc()}set y(e){this.position.y=e,this._pc()}get width(){return this._w}set width(e){this._w=e,this._pc()}get height(){return this._h}set height(e){this._h=e,this._pc()}_uw(){if(!this._di)return;let{_wx:e=0,_wy:i=0,_wo:s=1,_wr:n=0,_wsx:o=1,_wsy:a=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=s*this.opacity,this._wsx=o*this.scaleX,this._wsy=a*this.scaleY,this._wx=this._wx*o,this._wy=this._wy*a,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wr=n+this.rotation;let{x:l,y:f}=be({x:this._wx,y:this._wy},n);this._wx=l,this._wy=f,this._wx+=e,this._wy+=i}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}set children(e){this.removeChild(this._c),this.addChild(e)}get children(){return this._c}addChild(...e){e.flat().map(i=>{this.children.push(i),i.parent=this,i._pc=i._pc||F,i._pc()})}removeChild(...e){e.flat().map(i=>{ve(this.children,i)&&(i.parent=null,i._pc())})}get opacity(){return this._opa}set opacity(e){this._opa=xt(0,1,e),this._pc()}get rotation(){return this._rot}set rotation(e){this._rot=e,this._pc()}setScale(e,i=e){this.scaleX=e,this.scaleY=i}get scaleX(){return this._scx}set scaleX(e){this._scx=e,this._pc()}get scaleY(){return this._scy}set scaleY(e){this._scy=e,this._pc()}};var St=class extends vt{init({image:e,width:i=e?e.width:void 0,height:s=e?e.height:void 0,...n}={}){super.init({image:e,width:i,height:s,...n})}get animations(){return this._a}set animations(e){let i,s;this._a={};for(i in e)this._a[i]=e[i].clone(),s=s||this._a[i];this.currentAnimation=s,this.width=this.width||s.width,this.height=this.height||s.height}playAnimation(e){this.currentAnimation?.stop(),this.currentAnimation=this.animations[e],this.currentAnimation.start()}advance(e){super.advance(e),this.currentAnimation?.update(e)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}};function A(){return new St(...arguments)}var it=new WeakMap,bt={},Et={},Qt={0:"left",1:"middle",2:"right"};function Me(t,e){let{x:i,y:s,width:n,height:o}=Ce(t);do i-=t.sx||0,s-=t.sy||0;while(t=t.parent);let a=e.x-Math.max(i,Math.min(e.x,i+n)),l=e.y-Math.max(s,Math.min(e.y,s+o));return a*a+l*l<e.radius*e.radius}function Te(t){let e=t._lf.length?t._lf:t._cf;for(let i=e.length-1;i>=0;i--){let s=e[i];if(s.collidesWithPointer?s.collidesWithPointer(t):Me(s,t))return s}}function v(t,e){return parseFloat(t.getPropertyValue(e))||0}function ke(t){let{canvas:e,_s:i}=t,s=e.getBoundingClientRect(),n=i.transform!="none"?i.transform.replace("matrix(","").split(","):[1,1,1,1],o=parseFloat(n[0]),a=parseFloat(n[3]),l=(v(i,"border-left-width")+v(i,"border-right-width"))*o,f=(v(i,"border-top-width")+v(i,"border-bottom-width"))*a,p=(v(i,"padding-left")+v(i,"padding-right"))*o,c=(v(i,"padding-top")+v(i,"padding-bottom"))*a;return{scaleX:(s.width-l-p)/e.width,scaleY:(s.height-f-c)/e.height,offsetX:s.left+(v(i,"border-left-width")+v(i,"padding-left"))*o,offsetY:s.top+(v(i,"border-top-width")+v(i,"padding-top"))*a}}function Bt(t){let e=t.button!=null?Qt[t.button]:"left";Et[e]=!0,At(t,"onDown")}function wt(t){let e=t.button!=null?Qt[t.button]:"left";Et[e]=!1,At(t,"onUp")}function Ft(t){At(t,"onOver")}function Pe(t){let e=it.get(t.target);e._oo=null,Et={}}function qt(t,e,i){let s=Te(t);s&&s[e]&&s[e](i),bt[e]&&bt[e](i,s),e=="onOver"&&(s!=t._oo&&t._oo&&t._oo.onOut&&t._oo.onOut(i),t._oo=s)}function At(t,e){t.preventDefault();let i=t.target,s=it.get(i),{scaleX:n,scaleY:o,offsetX:a,offsetY:l}=ke(s);t.type.includes("touch")?(Array.from(t.touches).map(({clientX:p,clientY:c,identifier:w})=>{let d=s.touches[w];d||(d=s.touches[w]={start:{x:(p-a)/n,y:(c-l)/o}},s.touches.length++),d.changed=!1}),Array.from(t.changedTouches).map(({clientX:p,clientY:c,identifier:w})=>{let d=s.touches[w];d.changed=!0,d.x=s.x=(p-a)/n,d.y=s.y=(c-l)/o,qt(s,e,t),tt("touchChanged",t,s.touches),e=="onUp"&&(delete s.touches[w],s.touches.length--,s.touches.length||tt("touchEnd"))})):(s.x=(t.clientX-a)/n,s.y=(t.clientY-l)/o,qt(s,e,t))}function Ee({radius:t=5,canvas:e=Se()}={}){let i=it.get(e);if(!i){let s=window.getComputedStyle(e);i={x:0,y:0,radius:t,touches:{length:0},canvas:e,_cf:[],_lf:[],_o:[],_oo:null,_s:s},it.set(e,i)}return e.addEventListener("mousedown",Bt),e.addEventListener("touchstart",Bt),e.addEventListener("mouseup",wt),e.addEventListener("touchend",wt),e.addEventListener("touchcancel",wt),e.addEventListener("blur",Pe),e.addEventListener("mousemove",Ft),e.addEventListener("touchmove",Ft),i._t||(i._t=!0,H("tick",()=>{i._lf.length=0,i._cf.map(s=>{i._lf.push(s)}),i._cf.length=0})),i}function Ae(t,e){let i=t[0].toUpperCase()+t.substr(1);bt["on"+i]=e}function Oe(t){let e=t.canvas;t.clearRect(0,0,e.width,e.height)}function Zt({fps:t=60,clearCanvas:e=!0,update:i=F,render:s,context:n=et(),blur:o=!1}={}){if(!s)throw Error("You must provide a render() function");let a=0,l=1e3/t,f=1/t,p=e?Oe:F,c,w,d,W,T,$=!0;o||(window.addEventListener("focus",()=>{$=!0}),window.addEventListener("blur",()=>{$=!1})),H("init",()=>{T.context||(T.context=et())});function x(){if(w=requestAnimationFrame(x),!!$&&(d=performance.now(),W=d-c,c=d,!(W>1e3))){for(tt("tick"),a+=W;a>=l;)T.update(f),a-=l;p(T.context),T.render()}}return T={update:i,render:s,isStopped:!0,context:n,start(){c=performance.now(),this.isStopped=!1,requestAnimationFrame(x)},stop(){this.isStopped=!0,cancelAnimationFrame(w)},_frame:x,set _last(U){c=U}},T}var q=[],Ct={},Mt={},jt={0:"south",1:"east",2:"west",3:"north",4:"leftshoulder",5:"rightshoulder",6:"lefttrigger",7:"righttrigger",8:"select",9:"start",10:"leftstick",11:"rightstick",12:"dpadup",13:"dpaddown",14:"dpadleft",15:"dpadright"};function Ge(t){q[t.gamepad.index]={pressedButtons:{},axes:{}}}function Re(t){delete q[t.gamepad.index]}function Ie(){q.map(t=>{t.pressedButtons={},t.axes={}})}function Le(){let t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[];for(let e=0;e<t.length;e++){let i=t[e];if(!i)continue;i.buttons.map((n,o)=>{let a=jt[o],{pressed:l}=n,{pressedButtons:f}=q[i.index],p=f[a];!p&&l?[Ct[i.index],Ct].map(c=>{c?.[a]?.(i,n,a)}):p&&!l&&[Mt[i.index],Mt].map(c=>{c?.[a]?.(i,n,a)}),f[a]=l});let{axes:s}=q[i.index];s.leftstickx=i.axes[0],s.leftsticky=i.axes[1],s.rightstickx=i.axes[2],s.rightsticky=i.axes[3]}}function ze(){window.addEventListener("gamepadconnected",Ge),window.addEventListener("gamepaddisconnected",Re),window.addEventListener("blur",Ie),H("tick",Le)}function Ne(t,e,{gamepad:i,handler:s="gamepaddown"}={}){let n=s=="gamepaddown"?Ct:Mt;[].concat(t).map(o=>{isNaN(i)?n[o]=e:(n[i]=n[i]||{},n[i][o]=e)})}var Tt={},Q,Vt=!1,kt={swipe:{touches:1,threshold:10,touchend({0:t}){let e=t.x-t.start.x,i=t.y-t.start.y,s=Math.abs(e),n=Math.abs(i);if(!(s<this.threshold&&n<this.threshold))return s>n?e<0?"left":"right":i<0?"up":"down"}},pinch:{touches:2,threshold:2,touchstart({0:t,1:e}){this.prevDist=Math.hypot(t.x-e.x,t.y-e.y)},touchmove({0:t,1:e}){let i=Math.hypot(t.x-e.x,t.y-e.y);if(Math.abs(i-this.prevDist)<this.threshold)return;let s=i>this.prevDist?"out":"in";return this.prevDist=i,s}}};function Xe(){Vt||(Vt=!0,H("touchChanged",(t,e)=>{Object.keys(kt).map(i=>{let s=kt[i],n;(!Q||Q==i)&&e.length==s.touches&&[...Array(e.length).keys()].every(o=>e[o])&&(n=s[t.type]?.(e)??"")&&Tt[i+n]&&(Q=i,Tt[i+n](t,e))})}),H("touchEnd",()=>{Q=0}))}function He(t,e){[].concat(t).map(i=>{Tt[i]=e})}var te={},ee={},st={},X={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function ie(t=F,e){t._pd&&e.preventDefault(),t(e)}function De(t){let e=X[t.code],i=te[e];st[e]=!0,ie(i,t)}function Ye(t){let e=X[t.code],i=ee[e];st[e]=!1,ie(i,t)}function We(){st={}}function Ot(){let t;for(t=0;t<26;t++)X["Key"+String.fromCharCode(t+65)]=String.fromCharCode(t+97);for(t=0;t<10;t++)X["Digit"+t]=X["Numpad"+t]=""+t;window.addEventListener("keydown",De),window.addEventListener("keyup",Ye),window.addEventListener("blur",We)}function Gt(t,e,{handler:i="keydown",preventDefault:s=!0}={}){let n=i=="keydown"?te:ee;e._pd=s,[].concat(t).map(o=>n[o]=e)}function O(t){return!![].concat(t).some(e=>st[e])}function Kt(t,e){return Object.values(e).includes(t)}function $e(t){return Object.keys(kt).some(e=>t.startsWith(e))}function se(t={}){Ot();let e=Ee(t.pointer);return Xe(),ze(),{pointer:e}}function V(t,e,{gamepad:i,key:s}={}){[].concat(t).map(n=>{if(Kt(n,jt))Ne(n,e,i);else if($e(n))He(n,e);else if(Kt(n,X))Gt(n,e,s);else if(["down","up"].includes(n))Ae(n,e);else throw new TypeError(`"${n}" is not a valid input name`)})}var Pt=class{constructor({create:e,maxSize:i=1024}={}){let s;if(!e||!(s=e())||!(s.update&&s.init&&s.isAlive&&s.render))throw Error("Must provide create() function which returns an object with init(), update(), render(), and isAlive() functions");this._c=e,this.objects=[e()],this.size=0,this.maxSize=i}get(e={}){if(this.size==this.objects.length){if(this.size==this.maxSize)return;for(let s=0;s<this.size&&this.objects.length<this.maxSize;s++)this.objects.push(this._c())}let i=this.objects[this.size];return this.size++,i.init(e),i}getAliveObjects(){return this.objects.slice(0,this.size)}clear(){this.size=this.objects.length=0,this.objects.push(this._c())}update(e){let i,s=!1;for(let n=this.size;n--;)i=this.objects[n],i.update(e),i.isAlive()||(s=!0,this.size--);s&&this.objects.sort((n,o)=>o.isAlive()-n.isAlive())}render(){for(let e=this.size;e--;)this.objects[e].render()}};function nt(){return new Pt(...arguments)}function G(...t){return Ue.play(...t)}var Ue={volume:.3,sampleRate:44100,x:new AudioContext,play:function(...t){return this.playSamples(this.buildSamples(...t))},playSamples:function(...t){let e=this.x.createBuffer(t.length,t[0].length,this.sampleRate),i=this.x.createBufferSource();return t.map((s,n)=>e.getChannelData(n).set(s)),i.buffer=e,i.connect(this.x.destination),i.start(),i},buildSamples:function(t=1,e=.05,i=220,s=0,n=0,o=.1,a=0,l=1,f=0,p=0,c=0,w=0,d=0,W=0,T=0,$=0,x=0,U=1,B=0,Wt=0){let C=Math.PI*2,_=this.sampleRate,ge=ye=>ye>0?1:-1,me=f*=500*C/_/_,$t=i*=(1+e*2*Math.random()-e)*C/_,gt=[],P=0,we=0,g=0,J=1,xe=0,_e=0,k=0,mt,N;for(s=s*_+9,B*=_,n*=_,o*=_,x*=_,p*=500*C/_**3,T*=C/_,c*=C/_,w*=_,d=d*_|0,N=s+B+n+o+x|0;g<N;gt[g++]=k)++_e%($*100|0)||(k=a?a>1?a>2?a>3?Math.sin((P%C)**3):Math.max(Math.min(Math.tan(P),1),-1):1-(2*P/C%2+2)%2:1-4*Math.abs(Math.round(P/C)-P/C):Math.sin(P),k=(d?1-Wt+Wt*Math.sin(C*g/d):1)*ge(k)*Math.abs(k)**l*t*this.volume*(g<s?g/s:g<s+B?1-(g-s)/B*(1-U):g<s+B+n?U:g<N-x?(N-g-x)/o*U:0),k=x?k/2+(x>g?0:(g<N-x?1:(N-g)/x)*gt[g-x|0]/2):k),mt=(i+=f+=p)*Math.cos(T*we++),P+=mt-mt*W*(1-(Math.sin(g)+1)*1e9%2),J&&++J>w&&(i+=c,$t+=c,J=0),d&&!(++xe%d)&&(i=$t,f=me,J||(J=1));return gt},getNote:function(t=0,e=440){return e*2**(t/12)}};var{canvas:b,context:Be}=Jt(),ot=t=>Math.floor(Math.random()*t);Be.imageSmoothingEnabled=!1;se();Ot();var u={width:400,height:400},h=A({x:240,y:100,color:"#333",width:40,height:40,dx:2,dy:2,speed:2,r:20,flipX:1,anim:1,render:function(t=!0){let e=Math.sin(this.anim*Math.PI),i=this.context;i.scale(this.flipX,1),t&&(i.fillStyle="#8884",i.beginPath(),i.arc(0,10,this.r,0,2*Math.PI),i.fill()),i.strokeStyle="#333",i.lineJoin="bevel",i.lineCap="round",i.lineWidth=4;let s=e*2;i.beginPath(),i.moveTo(-10,0+s),i.lineTo(-10,20+s),i.quadraticCurveTo(-10,20+s,-5,20+s),i.lineTo(15,20+s),i.quadraticCurveTo(20,20+s,20,15+s),i.lineTo(20,5+s),i.quadraticCurveTo(20,0+s,15,0+s),i.stroke(),ht(i,14,7+s),ht(i,14,13+s);let n=e*4;i.beginPath(),i.moveTo(-10,-12+n),i.lineTo(-10,-4+n),i.quadraticCurveTo(-10,n,-6,n),i.lineTo(6,n),i.quadraticCurveTo(10,n,10,-4+n),i.lineTo(10,-8+n),i.quadraticCurveTo(10,-12+n,6,-12+n),i.stroke(),ht(i,3,-7+n),i.beginPath(),i.moveTo(-12,-13+n*1.2),i.lineTo(17,-13+n*1.2),i.lineTo(-10,-23+n*1.2),i.closePath(),i.stroke(),i.beginPath(),i.moveTo(-10,-13+n*1.2),i.quadraticCurveTo(-15,-20+n,-20,-17+n*2),i.stroke(),i.strokeRect(-4-n,20+s,8,7-s),i.strokeRect(4+n,20+s,8,7-s)},update:function(t){this.x+=this.dx,this.y+=this.dy,this.flipX=this.dx>0?1:-1,this.anim+=Math.min(.1,.04*y(this.dx,this.dy).length()),this.anim>1&&(this.anim-=1),this.controlled||(Math.random()>.8&&Math.random()*100<this.r&&zt(this.x-this.flipX*10,this.y),(this.x+this.width>u.width||this.x<0)&&(this.randomDir(),this.x+=this.dx),(this.y+this.height>u.height||this.y<0)&&(this.randomDir(),this.y+=this.dy))},randomDir:function(){let t=y(ot(u.width/4*3)+u.width/8-h.x,ot(u.height/4*3)+u.height/8-h.y),e=ae();if(e.length>0){let i=e[ot(e.length)];t=y(i.x-h.x,i.y-h.y)}t=t.normalize().scale(this.speed),h.dx=t.x,h.dy=t.y},inSway:function(t){return je(this.x,this.y+10,this.r-Math.min(t.width,t.height)/2,t.x,t.y)}}),at=()=>{let t=Math.random()*Math.PI*2;return y(Math.cos(t),Math.sin(t)).normalize()},Fe=(t,e,i)=>Math.min(i,Math.max(t,e)),qe=t=>t<0?Math.floor(t):Math.ceil(t),S=nt({create:A}),Dt=t=>S.getAliveObjects().filter(e=>e.follow===t),ae=()=>S.getAliveObjects().filter(t=>!t.follow),Lt=(t,e)=>{let i=at().scale(Math.max(u.width,u.height)*1.2);S.get({x:t||u.width/2+i.x,y:e||u.height/2+i.y,d:i.normalize().scale(-4),offScreen:!0,color:"#333",width:30,height:30,follow:!1,will:1,anim:0,flipX:1,update:function(){if(this.x+=this.d.x,this.y+=this.d.y,this.flipX=Fe(-1,this.flipX+(this.d.x>0?.1:-.1),1),this.offScreen)this.x>this.width&&this.x<u.width-this.width&&this.y>this.height&&this.y<u.height-this.height&&(this.offScreen=!1,this.d=this.d.normalize().scale(.2));else if(this.will<=.2&&this.follow){let s=y(this.follow.x-this.x,this.follow.y-this.y),n=s.length();s=s.normalize();let o=Dt(this.follow),a=y(0,0);for(let l of o)a=a.add(l.d);o.length>0&&(s=s.add(a.scale(1/o.length).normalize().scale(.5)));for(let l of o){let f=y(this.x-l.x,this.y-l.y);f.length()<30&&(s=s.add(f.normalize()))}n<40&&(s=s.scale(-.8)),s=s.add(at().scale(.1)),this.d.set(s.normalize().scale(this.follow.speed))}else(this.x+this.width/2>u.width||this.x-this.width/2<0)&&(this.x-=this.d.x,this.d.x*=-1),(this.y+this.height/2>u.height||this.y-this.width/2<0)&&(this.y-=this.d.y,this.d.y*=-1);this.anim+=.07*Math.abs(this.dx)/1,this.anim>1&&(this.anim-=1),this.will>0&&h.inSway(this)?(this.will-=.07,this.will<=0&&(this.follow=h)):this.follow&&this.will>.3&&(this.follow=!1,this.d=this.d.normalize().scale(.4))},render:function(){let s=this.context;s.fillStyle=this.color;let n=Math.floor(this.height/2*(1-this.will));s.fillStyle="#3333";let o=Math.sin(this.anim*Math.PI)*2,a=Math.cos(this.anim*Math.PI)*3;s.scale(qe(this.flipX),1),s.beginPath(),s.moveTo(-15,-5),s.bezierCurveTo(-25-o,-30+a,-5-o,-15+a,-5-a,-25+o),s.stroke(),s.strokeRect(-12+o,0,3,3),s.strokeRect(-5-o,0,3,3),s.strokeRect(2+o,0,3,3),s.strokeRect(9-o,0,3,3),s.strokeStyle="#333",s.lineJoin="bevel",s.lineCap="round",s.lineWidth=4,s.beginPath(),s.moveTo(15,0),s.lineTo(-10,0),s.quadraticCurveTo(-15,0,-15,-5+o),s.bezierCurveTo(-15,-20+o,0,-20+o,15,0),s.closePath(),s.stroke(),s.clip(),s.fillRect(-this.width/2,-n+o,this.width,n-o),ht(s,5,-5+o/2)}})},lt=nt({create:A}),zt=(t,e)=>{lt.get({x:t,y:e,d:at().scale(.5),width:6,height:10,life:4+ot(5),alive:!0,update:function(){this.x+=this.d.x,this.y+=this.d.y,this.life-=.2,this.life<0&&(this.alive=!1)},render:function(){let i=this.context,s=this.life>1?"f":Math.floor(this.life*10);i.strokeStyle="#333"+s,i.fillStyle="#333"+s,i.lineWidth=3,i.beginPath(),i.moveTo(0,0),i.arc(0,0,2,0,Math.PI*2),i.moveTo(2,0),i.lineTo(2,-8),i.closePath(),i.fill(),i.stroke(),i.fillStyle="#fff"},isAlive:function(){return this.alive}})},ne=(t,e,i,s,n)=>{t.beginPath(),t.moveTo(e,i),t.lineTo(s,n),t.stroke(),t.closePath()},ht=(t,e,i)=>{t.beginPath(),t.moveTo(e,i),t.lineTo(e,i),t.stroke()},Nt=(t,e,i)=>{t.strokeStyle="#333",t.lineWidth=4,t.lineJoin="bevel",[20,26,32,40].forEach((s,n)=>t.strokeRect(e+n*6,i,6,s))},Xt=A({x:0,y:400,width:b.width,height:120,lanes:[26,50,74,98],render:function(){let t=this.context;t.strokeStyle="#333",t.lineWidth=4,t.lineJoin="bevel",ne(t,0,0,this.width,0),this.lanes.forEach(e=>ne(t,50,e,this.width,e)),Nt(t,12,this.height/2-20),t.fillStyle="#333",O("arrowup")?t.strokeStyle="#888":t.strokeStyle="#333",t.beginPath(),t.moveTo(65,26-8),t.lineTo(65-10,26+8),t.lineTo(65+10,26+8),t.lineTo(65,26-8),t.closePath(),t.fill(),t.stroke(),O("arrowleft")?t.strokeStyle="#888":t.strokeStyle="#333",t.beginPath(),t.moveTo(65-8,50),t.lineTo(65+8,50+10),t.lineTo(65+8,50-10),t.lineTo(65-8,50),t.closePath(),t.fill(),t.stroke(),O("arrowright")?t.strokeStyle="#888":t.strokeStyle="#333",t.beginPath(),t.moveTo(65+8,74),t.lineTo(65-8,74+10),t.lineTo(65-8,74-10),t.lineTo(65+8,74),t.closePath(),t.fill(),t.stroke(),t.stroke(),O("arrowdown")?t.strokeStyle="#888":t.strokeStyle="#333",t.beginPath(),t.moveTo(65,98+8),t.lineTo(65-10,98-8),t.lineTo(65+10,98-8),t.lineTo(65,98+8),t.closePath(),t.fill(),t.stroke()}}),K=A({x:50,y:400,width:30,height:120,color:"#8884"}),R=nt({create:A});var re=t=>{if(t===void 0)return;let e=[];(t&1)===1&&e.push(0),(t&2)===2&&e.push(1),(t&4)===4&&e.push(2),(t&8)===8&&e.push(3),e.forEach(i=>R.get({noteType:i,x:b.width+67,y:b.height-Xt.height+Xt.lanes[i],width:20,height:20,color:"#333",dx:-2,alive:!0,update:function(){this.x+=this.dx,this.x<K.x&&(this.alive=!1,Je(10),Dt(h).forEach(s=>s.will+=.1),G(...Ht(ct[this.noteType]-20)),ue())},render:function(){let s=this.context;s.strokeStyle="#333",s.fillStyle="#333",s.lineWidth=4,s.beginPath(),s.moveTo(0,0),s.arc(0,0,6,0,Math.PI*2),s.moveTo(6,0),s.lineTo(6,-20),s.closePath(),s.fill(),s.stroke(),s.fillStyle="#fff"},isAlive:function(){return this.alive}}))},Ht=t=>[3,0,t,.05,.1,,1,,,,,,,.1,,,.09,.5,.22],ct=[261.63,311.13,392,523.25],Rt=t=>[t||.6,0,65.40639,,.01,.07,,3,,,,,,.2,,.5,,1.3,.01],M=[{introText:["","","Here is an easy","song to start you off.","","Good luck!"],outroText:[["Oh hero,","the streets are cleaner!","Everyone is happy!"],["Well, you cleared","some rats, at least."],["Are you sure","you are blowing into","the right end of the pipes?"]],rats:5,song:{notes:[1,,1,,2,,4,,8,,4,,2,,1,,1,2,1,,1,,1,,1,2,1,,1,,1]}},{introText:["","Something a little","trickier, since we","see you can truly play.","","Good luck!"],outroText:[["Our rats they flee,","Oh sweet melody!","","Well done Piper!"],["Some rats gone","is better than","no rats gone."],["Have your tried","turning it off and","back on again?"]],rats:6,song:{notes:[1,,2,4,8,,2,4,8,,8,,4,,4,2,4,,4,2,4,,4,2,4,8,4,,1]}},{introText:["","Harmonies will do","the trick to cause","the rats to flee.","","Good luck!"],outroText:[["Nice playing!","Our children would love","to hear your sweet melodies!"],["Maybe the cats","will take care","of the rest of them?"],["Maybe you should try","playing an auto pan pipe?"]],rats:7,song:{notes:[1,,12,,8,4,12,,8,4,2,,2,4,1,,1,2,6,,1,2,6,,1,2,6,,2,,1]}},{introText:["The final push!","","These rats get a","free concert basically.","","Good luck!"],outroText:[["All the rats","are gone!","","Piper, you hero!"],["Piper you missed","a few rats..."],["Obviously you","aren't cut out for","this line of work!"]],rats:8,song:{notes:[1,,3,,6,,12,,4,2,6,2,4,2,12,,12,,8,4,2,1,2,1,6,,2,,3]}}].map(t=>({freqs:ct,...t}));var oe=t=>Math.abs(K.x+K.width/2-t),le=0,ce=1,de=2,fe=3,Ve=t=>{let s=R.getAliveObjects().filter(n=>n.noteType===t&&oe(n.x)<K.width/2).pop();if(s){let n=oe(s.x);return s.alive=!1,n}},ue=()=>{setTimeout(()=>{if(R.getAliveObjects().length>0)return!1;Yt(dt)},500)},Ke=(t=5)=>{h.r=Math.min(h.r+t,100),r.score+=t},Je=(t=5)=>{h.r=Math.max(h.r-t,20)},pt=t=>function(e){if(r.scene===z&&r.state===Y){let i=Ve(t);i!==void 0&&(G(...Ht(ct[t])),zt(he.x+3+t*6,he.y+24+t*7),Ke(i),ue())}else r.scene===z&&r.state===I&&r.introText?zt(D.x+3+t*6,D.y+24+t*7):r.scene===L&&(t===le||t===ce?r.menuChoice--:(t===fe||t===de)&&r.menuChoice++),G(...Ht(ct[t]))};V(["arrowup","w"],pt(le));V(["arrowleft","a"],pt(ce));V(["arrowright","d"],pt(de));V(["arrowdown","s"],pt(fe));Gt(["enter","space"],t=>{r.scene===L?ut(Y):r.scene===z&&r.state===I&&r.introText?r.introText=!1:r.scene===ft&&ut(L)},{handler:"keyup"});var I=0,Y=1,dt=2,L=0,z=1,ft=2,r={scene:z,song:null,highScores:{},level:0,state:I,introText:!0,intro:80,outroText:!1,outro:80,score:0,menuChoice:0},Qe=t=>{let e=!1;if(window.localStorage){pe();let i=r.highScores[r.level];(!i||i<t)&&(r.highScores[r.level]=t,t>0&&(e=!0)),window.localStorage.setItem("highscores",JSON.stringify(r.highScores))}return e},pe=()=>{if(window.localStorage){let t=window.localStorage.getItem("highscores");t?r.highScores=JSON.parse(t):r.highScores={}}else r.highScores={};console.log("High scores: ",r.highScores)},ut=t=>{if(r.scene=t,lt.clear(),t===L)h.x=100,h.y=150,h.r=0,r.menuChoice=0,Lt(330,175),Lt(270,175);else if(t===z)r.level=r.menuChoice,S.clear(),Yt(I);else if(t===ft){r.postGame={score:r.score,cleared:Dt(h).length,loose:ae().length};let e=r.postGame.cleared+r.postGame.loose,i=r.postGame.cleared/e;r.postGame.score+=r.postGame.cleared*50,r.postGame.score-=r.postGame.loose*50,r.postGame.score=Math.max(0,r.postGame.score),r.postGame.loose===0?r.postGame.text=M[r.level].outroText[0]:i>.35?r.postGame.text=M[r.level].outroText[1]:r.postGame.text=M[r.level].outroText[2],r.postGame.gotHighScore=Qe(r.postGame.score),S.clear(),R.clear()}},Yt=t=>{if(t===I)r.introText=!0,r.intro=80,h.x=-100,h.y=u.height/2,h.dy=0,h.dx=3,h.r=10,h.controlled=!0;else if(t===Y){h.speed=2;let e=at().scale(h.speed);h.dx=e.x,h.dy=e.y,delete h.controlled,r.song=M[r.level].song,r.songPlace=0;for(let i=0;i<M[r.level].rats;i++)Lt()}else t===dt&&(h.controlled=!0,h.dx=3,h.dy=0,h.speed=3,r.outro=80,r.outroText=!1);r.state=t},D=y(b.width/2-20,b.height-128),he=y(12,b.height-50),It=0,rt=0,Ze=Zt({update:function(t){r.scene===L?(r.menuChoice<0?r.menuChoice+=M.length:r.menuChoice>M.length-1&&(r.menuChoice-=M.length),h.anim+=.1,S.getAliveObjects().forEach(e=>{e.anim+=.05+Math.random()*.1,e.will=1})):r.scene===z&&(r.state===I?r.introText||(h.update(t),h.x>=u.width/2&&Yt(Y)):r.state===Y?(h.update(),S.update(),R.update(),O("t")&&(h.r=Math.min(h.r+1,100)),O("g")&&(h.r=Math.max(h.r-1,20)),(r.song||R.getAliveObjects().length>0)&&(It<=0?(It=.25,rt++,rt===2?(r.song&&(r.songPlace++,re(r.song.notes[r.songPlace])),G(...Rt(.6))):rt===4?(r.song&&(r.songPlace++,re(r.song.notes[r.songPlace])),G(...Rt(1.2)),rt=0):G(...Rt(.6))):It-=t)):r.state===dt&&(h.update(t),S.update(),h.x>=u.width+u.width/2&&ut(ft))),lt.update()},render:function(){let t=this.context;t.fillStyle="#333",r.scene===L?(t.font="bold 32px sans-serif",m(t,"Pied Pipe",48),t.font="bold 36px sans-serif",t.save(),t.translate(10,0),t.rotate(.1),m(t,"Revolution",65),t.restore(),t.font="bold 28px sans-serif",M.forEach((e,i)=>{let s="Level "+(i+1);m(t,r.menuChoice===i?`> ${s} <`:s,200+(i+1)*32)}),Nt(t,D.x,D.y),t.font="bold 24px sans-serif",m(t,"Space/Enter to choose level",b.height-20),m(t,"Arrow keys to play pipes",b.height-52),h.render(),S.render()):r.scene===z?r.state===I?r.introText?(t.font="bold 28px sans-serif",M[r.level].introText.forEach((e,i)=>m(t,e,(i+1)*32)),Nt(t,D.x,D.y),m(t,"Space/Enter to start",b.height-32)):(S.render(),h.render()):r.state===Y?(S.render(),h.render(),K.render(),Xt.render(),R.render()):r.state===dt&&(S.render(),h.render()):r.scene===ft&&(t.font="bold 32px sans-serif",m(t,"Song Complete",32),t.font="bold 28px sans-serif",m(t,r.postGame.cleared+" rats gone",96),m(t,r.postGame.loose+" rats left",128),m(t,"Score: "+r.postGame.score,160),r.postGame.gotHighScore&&m(t,"High Score!",192),r.postGame.text.forEach((e,i)=>m(t,e,224+(i+1)*32)),m(t,"Space/Enter for menu",b.height-32)),lt.render()}}),m=(t,e,i)=>{let{width:s}=t.measureText(e);t.fillText(e,b.width/2-s/2,i)};pe();ut(L);Ze.start();function je(t,e,i,s,n){return Math.sqrt(Math.pow(t-s,2)+Math.pow(e-n,2))<i}})();
/*! Bundled license information:

kontra/kontra.mjs:
  (**
   * @preserve
   * Kontra.js v9.0.0
   *)
*/
