c=a.getContext`2d`,k=[u=r=d=l=s=0],c.w=innerWidth,c.h=innerHeight,onkeydown=onkeyup=b=>k[b.which]=self["lld*rlurdu"[b.which%32%17]]=b.type[5];var tool,tS,toX,loot=0,nLoot=0,nDead=0,levelCols=32,levelRows=16,tileSize=innerWidth/32,pCol=2,pRow=12,ct2=0,pS=3,pL=c.width/32,gameOver=!1,testing=!1,lorR=-1,time=!0,p=makeSprite(c,420,70,"robot.png",6,30,c.w/7,c.h/3,2*(tileSize/70),3),key=makeSprite(c,6,6,"key.png",1,0,0,0,6,0),toY=0,onOff=-1,numnpcs=5,npcs=[],bd=[];for(let b=0;b<numnpcs;b+=1)spawnnpc(),2<b?spawnb():spawnb(),bd[b].seq=[0];var story,choose,data,game,mob,health,dead,speak=["This is a ","Ahh! You're a ","You have a ","You're here to ",""],choices=[["Peaceful Town","Alien","Warp Tunnel","Destroy all life!","Ahhh! What are you?!"],["Mob's Hideout","Robo Cop","Laser Gun","Fight the Mob!","Can I pay you off?"],["Government Facility","Escaped Experiment","Self Destruct","Destroy the Evidence.","I'm going to be in so much trouble!"],["Delightful Bakery","Bad Trip","Cool Jet Pack","Try the Brownies?","Yikes!"],["Comic Convention","Cosplayer","Loot Bag","Collect Prizes","The costumes are amazing this year!"]],endG=[0,0,0,0],R=0,done=!0,bdBoom=toolTap=mobile=!1;const songData=[[[.9,0,143,,,.35,3]],[[[0,-1,1,8,6,4,1.5,2.75,4,,5,,6,4,,5,,6,-1,0,0,0],[0,1,1,8,6,4,1.5,2.75,4,,5,,6,4,,5,,6,-1,0,0,0]],[[0,-1,20,,21,18,,18,20,,21,18,,18,,18,,18,20,,21,,20,,21,18,,12,0,0,0,-1,3.5,12,12,5,,10,,10,5,,8,,0,0,0,3.5,12,,,-1],[0,1,20,,21,18,,18,20,,21,18,,18,,18,,18,20,,21,,20,,21,18,,12,0,0,0,-1,3.5,12,12,5,,10,,10,5,,8,,0,0,0,3.5,12,,,-1]]],[1,1,0,0,1,0],60];localStorage["OS13kMusic, Robot Mission 404 Song"]=JSON.stringify(songData);const buffer=zzfxM(...songData);var music=!1,level=[[[1,1,1,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,1,1,1],[1,1,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,1,1,1,0,0,0,1,1,1,1,1],[1,0,0,0,1,0,1,0,0,0,0,0,0,1,1,0,0,2,0,0,0,1,1,0,0,0,1,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,1,1,1,0,0,1,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,1,0,1,0,0,1,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,1,0,0,0,1,0,1,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,1,0,0,0,0,0,1],[1,1,0,0,0,2,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,1,0,0,0,2,0,1],[1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,1,0,0,0,1,1,1],[1,0,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,1,0,0,1,1,1,1],[4,0,0,1,1,0,0,0,0,0,0,0,1,1,1,1,1,0,0,1,1,1,1,1,1,1,0,1,0,0,0,1],[4,0,0,0,1,0,1,1,1,1,1,1,1,0,0,0,1,1,1,1,0,0,0,0,0,1,1,0,0,0,0,1],[4,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],[[1,1,1,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,1,1,1],[1,1,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,1,1],[1,1,1,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,1,1,1,1,1,1,0,0,1],[1,1,2,0,0,0,0,1,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0,1,0,0,0,0,1,1,0,1],[1,1,1,1,0,0,1,1,0,0,1,1,0,0,1,0,1,0,1,0,1,0,0,1,1,1,0,0,0,1,0,1],[1,0,0,0,0,1,1,1,1,1,1,0,0,0,1,1,0,1,0,1,0,0,0,0,0,1,0,0,0,1,0,1],[1,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,1,1,1,1,0,1,0,2,0,1,0,1],[1,0,0,0,0,0,0,0,0,1,0,1,0,0,1,0,0,0,0,0,1,1,1,1,0,1,1,1,0,1,0,1],[1,1,1,0,0,0,0,0,1,0,2,1,0,1,1,0,0,0,0,0,1,0,0,0,0,1,1,1,0,1,0,1],[1,1,1,1,1,1,1,1,0,1,1,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1],[4,0,0,0,1,0,0,0,0,0,0,0,1,1,0,1,0,2,0,1,0,0,0,0,0,0,0,0,0,1,0,1],[4,0,0,0,1,0,0,0,0,0,0,0,1,0,0,1,1,1,1,0,0,0,1,1,1,0,0,0,1,1,0,1],[4,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,2,0,0,0,0,0,0,0,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],[[1,1,1,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,1,1,1],[1,1,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,1,1],[1,1,1,1,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,1,1,1],[1,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,2,0,0,0,1,0,0,0,0,0,0,1],[1,2,0,1,0,0,0,0,1,1,1,1,1,1,1,0,0,1,0,1,1,1,1,0,1,0,0,0,0,0,0,1],[1,1,0,1,0,1,0,0,1,0,0,0,0,0,1,0,0,0,0,1,1,1,1,0,1,0,0,1,0,0,0,1],[1,0,0,1,0,1,0,1,1,1,0,0,0,2,1,0,0,0,0,0,0,0,0,0,1,0,0,1,2,0,0,1],[1,0,0,0,0,1,0,0,0,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,1,0,0,1,1,1,0,1],[1,0,0,0,0,1,0,0,0,1,1,0,1,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,1],[1,1,1,0,0,1,0,0,0,1,1,0,0,0,0,0,0,1,1,1,1,1,0,0,0,1,0,0,0,1,0,1],[1,1,1,1,0,1,0,0,2,1,0,0,0,0,0,1,1,1,0,0,1,1,1,0,0,1,1,1,1,1,0,1],[4,0,0,1,1,1,0,1,1,1,0,0,0,0,1,1,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,1],[4,0,0,0,1,1,1,0,0,1,1,1,1,1,1,0,0,0,0,0,0,1,0,0,1,1,0,0,0,0,0,1],[4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],[[1,1,1,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,1,1,1],[1,1,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,1,1],[1,1,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,1],[1,0,0,1,2,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,1],[1,0,0,1,1,1,1,1,1,1,0,0,1,0,0,0,0,0,0,0,0,0,1,1,2,0,0,0,0,0,0,1],[1,0,0,0,0,1,0,0,1,0,0,0,1,0,0,0,0,0,0,2,0,0,0,1,1,1,1,0,0,1,0,1],[1,0,0,0,1,0,0,0,1,1,0,0,1,0,0,0,0,1,1,1,1,0,0,1,0,0,0,0,0,1,0,1],[1,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0,1,1,1,1,0,0,1,0,0,0,0,0,1,0,1],[1,0,0,0,0,1,2,0,0,1,0,0,1,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,0,1,0,1],[1,1,1,0,0,1,1,1,1,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],[1,1,1,1,0,1,1,1,1,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],[4,0,0,1,0,0,0,0,0,1,0,0,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,0,0,1,0,1],[4,0,0,1,1,1,1,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,1,1,1,1,0,1],[4,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,0,0,1],[1,1,0,0,0,0,0,0,1,1,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,2,0,0,0,0,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],[[1,1,1,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,1,1,1],[1,1,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,1,1],[1,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,1,0,0,2,0,0,0,1,0,0,0,0,0,0,0,1,2,0,1,0,0,1],[1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,0,0,1,1,1,0,1,0,1],[1,0,0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,1,1],[1,0,0,0,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,1,0,0,1,0,1],[1,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1],[1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,2,1],[1,1,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,1,1,1,1],[4,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[4,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1],[4,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,0,1,0,0,0,0,0,0,0,0,0,0,0,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]]];setInterval(()=>{a.width=innerWidth,a.height=innerHeight;0===s?title():1===s?(street(),k[13]&&document.monetization&&"started"===document.monetization.state&&(testing=!0)):2===s?inside():3===s?s=1:4===s?endScreen():5===s?mapEditor():void 0},16),onclick=b=>{switch(x=b.pageX,y=b.pageY,s){case 0:if(x>a.width/2&&(mobile=!0,p.s=5),!music){const b=zzfxP(...buffer);b.loop=!0,music=!0}toX=p.x=c.w/4,toY=p.y=c.h/2,p.switch(0),s=1;break;case 1:mobile&&(toX=x,toY=y,done=!1);break;case 2:mobile&&(key.isClose(x,y,1)?toolTap=!0:(toX=x,toY=y,done=!1,3==tool||5==tool?setTimeout(()=>{toolTap=!1},1e3):toolTap=!1));break;case 3:break;case 4:p.x=c.w/7,p.y=c.h/3,p.switch(0),s=0;case 5:toX=x,toY=y,tapped(x,y,!1);}};function title(){c.w=a.width,c.h=a.height,data=["404","404","404","404"],endG=[0,0,0,0],done=!0,story="Robot Mission 404",choose="",game=1,nLoot=nDead=loot=0,bdBoom=toolTap=mobile=!1,mob=[!1,!1,!1,!1,!1],dead=[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],health=100;for(let b=0;b<numnpcs;b+=1)npcs[b].newSeq([0,0,1,1,2,2,1,1]),bd[b].newSeq([0]);shadow(),c.fillStyle="#241007",c.fillRect(0,0,c.w,c.h),document.monetization&&"started"===document.monetization.state&&(tx("Hello Coil Subscribers! You have access to the level editor!",c.w/2,c.h/6,2,"#FFDC21"),tx("Press 'enter' before flying into building, 'enter' to exit. Refresh to reset.",c.w/2,c.h/4,1.5,"#f5e2b4")),tx(story,c.w/2,.45*c.h,7,"#FFDC21"),tx("You're an amnesiac robot with corrupted mission data.",c.w/2,.55*c.h,2,"#dc21ff"),tx("Fly around, talk to the town's people to fill in the blanks, and then carry out your mission.",c.w/2,.62*c.h,1.7,"#dc21ff"),tx("Start Mission! Desktop",c.w/3,.75*c.h,3,"#f5e2b4"),tx("Start Mission! Mobile",2*(c.w/3),.75*c.h,3,"#f5e2b4"),tx("arrows or awsd, space, y, n, +/- speed.",c.w/3,.85*c.h,1.5,"#f5e2b4"),tx("landscape, tap to move, button to interact.",2*(c.w/3),.85*c.h,1.5,"#f5e2b4"),keyMove(),p.x>c.w&&(p.x=0),p.y>c.h&&(p.y=0),0>p.y&&(p.y=c.h),0>p.x&&(p.x=c.w),p.render()}function endScreen(){c.fillStyle="#241007",c.fillRect(0,0,c.w,c.h),tx(story,a.width/2,a.height/2,6,"#FFDC21"),tx(choose,a.width/2,.65*a.height,4,"#f5e2b4"),tx("Click to restart.",a.width/2,.75*a.height,3,"#f5e2b4"),localStorage["OS13kTrophy,\uD83D\uDC7E,Robot Mission 404, Mission Complete"]="",100==health&&(localStorage["OS13kTrophy,\uD83D\uDC96,Robot Mission 404, Perfect Health"]=""),(nDead=0)&&(localStorage["OS13kTrophy,\uD83D\uDD4A,Robot Mission 404, Angel of Peace"]=""),25==nDead&&(localStorage["OS13kTrophy,\uD83D\uDC80,Robot Mission 404, Death Robot"]=""),25==nDead&&30==nLoot&&100>health&&(localStorage["OS13kTrophy,\uD83E\uDD48,Robot Mission 404, Loot & Pillage"]="Now try for 100% health."),25==nDead&&99<health&&30==nLoot&&(localStorage["OS13kTrophy,\uD83C\uDFC6,Robot Mission 404, Max Combo"]=""),document.monetization&&"started"===document.monetization.state&&(localStorage["OS13kTrophy,\uD83D\uDC51,Robot Mission 404, Coil Subscriber"]="")}function street(){p.x>c.w&&(p.x=0),p.y>c.h-p.h&&(p.y=c.h-p.h),0>p.x&&(p.x=c.w),c.w=a.width,c.h=a.height,mob=[!1,!1,!1,!1,!1],c.fillStyle="#99A5FE",c.fillRect(0,0,c.w,c.h),c.fillStyle="#483477",shadow(),c.fillRect(0,.3*c.h,c.w,.7*c.h),c.fillStyle="#241007",c.fillRect(0,c.h/2,c.w,c.h/3);let b,e=0;for(i=0;i<bd.length;i++)2<i?(e=.12*c.h,b=2*(i-2)*c.w/5-c.w/5):(e=.05*c.h,b=2*i*c.w/5),bd[i].x=b,bd[i].y=e,bd[i].scaleRatio=.00675*c.w,bd[i].update(),bd[i].render(),!p.isClose(b,e,1.5)||bdBoom||deadR(i)||(R=i,testing?s=5:(ct2=0,building()));tx("Robot Mission 404",c.w/2,.65*c.h,5,"#FFDC21"),story="Mission: Enter "+data[0]+" as "+data[1]+" use "+data[2]+" to "+data[3],tx(story,c.w/2,.75*c.h,2,"#f5e2b4");let f;f=mobile?"landscape, tap to move, button to interact.":"arrows or awsd, space, y, n, +/- speed.",tx("Controls: "+f,c.w/2,.8*c.h,1.5,"#f5e2b4"),bdBoom?setTimeout(()=>{story="Self Destruct Complete!",s=4},2300):mobile?done?(p.seq=[1,0],p.update(),p.seq=[]):touchMove(toX,toY):keyMove(),k[32]&&2==game&&4==tool&&!bdBoom&&bdTNT(),p.render(),mobile||speed()}function building(){if(2==game){tS.x=0,tS.y=0;for(let b=0;5>b;b++)dead[R][b]?npcs[b].newSeq([5]):npcs[b].newSeq([0,0,1,1,2,2,1,1])}p.x=pCol*a.width/32,p.y=pRow*a.height/16,s=2}function complete(){for(i in data)if(404==data[i])return!1;return!0}function inside(){c.w=a.width,c.h=a.height,drawR(),questTrophy(),mobile&&1==game&&(key.x=c.w-2*tileSize+tileSize/2,key.y=tileSize+tileSize/2);let b=!1;for(i=0;i<npcs.length;i++)p.isClose(npcs[i].x,npcs[i].y,1)&&(1==game&&(mobile&&(key.x=21*tileSize,key.y=tileSize/2),story=speak[i]+choices[R][i]+"!",choose="Incoporate into memory file? Y or N",b=!0,(k[89]||toolTap)&&4!=i?(data[i]=choices[R][i],endG[i]=R,choose="Data Entered!"):k[78]&&4!=i?(data[i]="404",choose="404 data corrupted!"):(4==i&&k[78]||k[89]||toolTap)&&(data[2]="404",choose="404 data corrupted!")),2==game&&!mob[i]&&0==dead[R][i]&&4!=R&&(npcs[i].newSeq([3,4]),mob[i]=!0)),2==game&&npcs[i].isClose(tS.x,tS.y,1.5)&&0==dead[R][i]&&4>tool&&(npcs[i].newSeq([5]),dead[R][i]=1,nDead++),npcs[i].update(),npcs[i].render(),deadR(i)&&bd[i].newSeq([4,5,6,7]);b||(story="Mission: Enter "+data[0]+" as "+data[1]+" use "+data[2]+" to "+data[3],choose="",mobile&&(choose="Hint: Tap past where you want to go."),complete()&&1==game&&(choose="Memory restored. Start mission? Y ? N",mobile&&(key.x=27*tileSize,key.y=tileSize/2),(k[89]||toolTap)&&(makeTool(),game=2)),2==game&&(choose="Health: "+Math.floor(health),0<loot&&(3==endG[3]?choose+=" Brownies: "+loot:choose+=" Loot: "+loot),0<nDead&&(choose+=" Dead: "+nDead))),2==game&&(win(),k[32]||toolTap?(useTool(),(5==tool||3==tool)&&(tS.update(),tS.render())):(5==tool||3==tool)&&(tS.x=0,tS.y=0),3>tool&&(tS.update(),tS.render())),p.render(),mobile?done?(p.seq=[1,0],p.update(),p.seq=[],p.y+=p.s):touchMove(toX,toY):(keyMove(),p.y+=p.s),mobile&&key.render(),bump(p),tx(story,a.width/2,.05*c.h,1.7,"#FFDC21"),tx(choose,a.width/2,.09*c.h,1.5,"#f5e2b4");let e=a.width/levelCols;p.y>12*e&&p.x<1*e+e/4&&(s=3),0>health&&(story="Damage Sustained,",choose="Failure",s=4);mobile||speed()}function speed(){(k[187]||k[61])&&5>p.s&&time&&(time=!1,p.s++,setTimeout(()=>{time=!0},500)),(k[189]||k[173])&&1<p.s&&time&&(time=!1,p.s--,setTimeout(()=>{time=!0},500))}function drawR(){for(tileSize=a.width/levelCols,c.fillStyle="#99A5FE",c.fillRect(0,0,a.width,a.height),i=0;i<4;i++)for(j=0;j<8;j++)drawWall(c,4*(j*tileSize)+tileSize/2,4*(i*tileSize)+tileSize/2,4*tileSize,"#c6cdff","#99A5FE");c.width=tileSize*levelCols,c.height=tileSize*levelRows;var e=0;for(i=0;i<levelRows;i++)for(j=0;j<levelCols;j++){let b=level[R][i][j];if(1===b?drawWall(c,j*tileSize,i*tileSize,tileSize,"#241007","#dc21ff"):4===b||5===b?(c.fillStyle="#000000",c.fillRect(j*tileSize,i*tileSize,tileSize,tileSize)):6===b?(1==game?level[R][i][j]=0:(c.fillStyle=3==endG[3]?"#7B4835":"#ffdc21",c.fillRect(j*tileSize,i*tileSize+tileSize/2,tileSize/2,tileSize/2)),p.isClose(j*tileSize,i*tileSize,1)&&(k[32]||toolTap)&&(level[R][i][j]=0,loot++)):void 0,2==b&&e<numnpcs&&0==dead[R][e]){if(2==game&&mob[e]){let f=p.x-5*e-2*tileSize,g=f<c.width-tileSize&&f>tileSize;npcs[e].isClose(p.x,p.y,3)&&!(npcs[e].y>p.y+3*tileSize)&&g&&(npcs[e].x=f,health-=.1),npcs[e].y+p.s<c.height-tileSize&&(npcs[e].y+=p.s),bump(npcs[e])}else npcs[e].x=j*tileSize,npcs[e].y=i*tileSize;e++}}}function questTrophy(){for(i in data){c.fillStyle=404==data[i]?"grey":"#FFDC21",c.fillRect(i*tileSize,0,tileSize/2,tileSize/2);let b=29*tileSize-tileSize/2;c.fillRect(i*tileSize+b,0,tileSize/2,tileSize/2)}}function drawWall(b,e,f,g,h,m){b.fillStyle=m,b.fillRect(e,f,g,g),b.strokeStyle=h,b.lineWidth=4,b.beginPath(),b.moveTo(e,f+g/2),b.lineTo(e+g,f+g/2),b.stroke(),b.lineWidth=2,b.beginPath(),b.moveTo(e,f),b.lineTo(e+g,f),b.stroke(),b.beginPath(),b.moveTo(e,f+g-2),b.lineTo(e+g,f+g-2),b.stroke(),b.lineWidth=4,b.beginPath(),b.moveTo(e+g-2,f+g/2),b.lineTo(e+g-2,f+g),b.stroke(),b.beginPath(),b.moveTo(e+g/2-2,f),b.lineTo(e+g/2-2,f+g/2),b.stroke()}function makeTool(){switch(endG[2]){case 0:tool=1,tS=makeSprite(c,24,4,"warp.png",4,5,0,0,10,0);break;case 1:tool=2,tS=makeSprite(c,40,5,"shot.png",2,10,0,0,2,2),tS.newSeq([0]);break;case 2:tool=4,tS={x:0,y:0};break;case 3:tool=3,tS=makeSprite(c,70,70,"jet.png",1,0,0,0,1,0);break;case 4:tool=5,tS=makeSprite(c,11,7,"bag.png",1,0,0,0,3,0);}if(3==endG[3]||4==endG[3])if(0==endG[0])for(let b=0;6>b;b++)for(j in bd)hideLoot(j);else for(let b=0;6>b;b++)hideLoot(endG[0])}function useTool(){switch(tool){case 1:tS.x=p.x,tS.y=p.y,toolTap=!1;break;case 2:tS.x=p.x+a.width/levelCols/2,tS.y=p.y;let b;(l||toolTap&&0<lorR)&&(tS.newSeq([0]),b=-8),(r||toolTap&&0>lorR)&&(b=8,tS.newSeq([1]));let e=setInterval(()=>{tS.x+=b},20);setTimeout(()=>{clearInterval(e),tS.x=0,tS.y=0},400),toolTap=!1,lorR*=-1;break;case 3:tS.x=p.x,tS.y=p.y;break;case 4:bdTNT(R),s=1,toolTap=!1;break;case 5:tS.x=p.x-tileSize/2,tS.y=p.y;}}function win(){let b=endG[0];switch(endG[3]){case 0:(25==nDead||0==!b&&deadR(b))&&(story="Sucess! Targets eliminated!",s=4);break;case 1:deadR(1)&&(story="Sucess! Mob liquidated!",s=4);break;case 2:1>health&&(story="Sucess! Destroyed the evidence!");break;case 3:loot==nLoot&&(story="Sucess! Tried the brownies!",s=4);break;case 4:loot==nLoot&&(story="Sucess! Got the loot!",s=4);}}function deadR(b){return!!(dead[b][0]&&dead[b][1]&&dead[b][2]&&dead[b][3]&&dead[b][4])}function bdTNT(b){let e,f=0;return console.log(b),bdBoom?void console.log("Already blown up!"):void(p.switch(5),bdBoom=!0,p.seq=[5],b?(p.x=bd[b].x+2*tileSize,p.y=bd[b].y+4*bd[b].h,e=setInterval(()=>{f++,bd[b].newSeq([f])},250),setTimeout(()=>{bd[b].newSeq([4,5,6,7,8]),clearInterval(e)},1e3)):(e=setInterval(()=>{for(i in bd)bd[i].newSeq([f]);f++},250),setTimeout(()=>{for(i in bd)bd[i].newSeq([4,5,6,7,8]);clearInterval(e)},1e3)))}function hideLoot(b){let e=Math.floor(32*Math.random()),f=Math.floor(16*Math.random());level[b][f][e]?hideLoot(b):(level[b][f][e]=6,nLoot++)}function mapEditor(){for(drawR(),i=0;i<npcs.length;i+=1)npcs[i].update(),npcs[i].render();k[13]&&(console.log(level[R]),s=2,testing=!1),u&&tapped(toX,toY,!0)}function tapped(b,e,f){var g=a.width/levelCols,h=Math.floor(b/g),m=Math.floor(e/g);let n=level[R][m][h];0===n?n=1:1===n?n=0:2===n?n=0:void 0;f&&(n=2),level[R][m][h]=n}function bump(b){var e=a.width/levelCols,f=Math.floor(b.x/e),g=Math.floor(b.y/e),h=b.x%e,m=b.y%e;if(!(16<g)&&!(32<f)){let n=[level[R][g][f],level[R][g][f+1],level[R][g+1][f],level[R][g+1][f+1]];(n[1]&&!n[0]||n[3]&&!n[2]&&m)&&(b.x=f*e),(!n[1]&&n[0]||!n[3]&&n[2]&&m)&&(b.x=(f+1)*e),(n[2]&&!n[0]||n[3]&&!n[1]&&h)&&(b.y=g*e),(!n[2]&&n[0]||!n[3]&&n[1]&&h)&&(b.y=(g+1)*e)}}function sprite(b){var e={},f=0,g=0,h=0,m=b.ticksPerFrame||0,n=b.numberOfFrames||1;return e.context=b.context,e.w=b.width,e.h=b.height,e.x=b.x,e.y=b.y,e.image=b.image,e.scaleRatio=1,e.s=b.s,e.seq=[],e.newSeq=function(b){h=0,f=0,e.seq=b},e.switch=function(b){f=b},e.update=function(){g+=1,g>m&&(g=0,f<n-1?(f+=1,0<e.seq.length&&(f=e.seq[h],h+=1)):1>e.seq.length&&(f=0),h>e.seq.length-1&&(h=0))},e.render=function(){e.context.shadowOffsetX=-3,e.context.shadowOffsetY=-1,e.context.shadowColor="black",e.context.shadowBlur=3,e.context.drawImage(e.image,f*e.w/n,0,e.w/n,e.h,e.x,e.y,e.w/n*e.scaleRatio,e.h*e.scaleRatio)},e.getFrameWidth=function(){return e.w/n},e.isClose=function(b,f,g){var h=e.x+e.getFrameWidth()/2*e.scaleRatio-(b+e.getFrameWidth()/2),m=e.y+e.getFrameWidth()/2*e.scaleRatio-(f+e.getFrameWidth()/2),n=Math.sqrt(h*h+m*m);return!!(n<e.getFrameWidth()*e.scaleRatio*g)},e}function makeSprite(b,e,g,h,m,f,n,o,p,q){let t=new Image;return sp=sprite({context:b,width:e,height:g,image:t,numberOfFrames:m,ticksPerFrame:f,s:q}),sp.x=n,sp.y=o,sp.scaleRatio=p,t.src=h,sp}function spawnnpc(){let b=npcs.length;npcs[b]=makeSprite(c,168,22,"man3.png",6,10,0,0,tileSize/22,2),npcs[b].dead=!1}function spawnb(){bd[bd.length]=makeSprite(c,270,24,"build.png",9,20,0,0,0,0)}function tx(b,e,g,h,f){c.textAlign="center",c.fillStyle=f,c.font=h+"vw Arial",c.fillText(b,e,g)}function keyMove(){u&&(p.y-=5*p.s,p.switch(4));d&&(p.y+=p.s,p.switch(4));r&&(p.x+=p.s,p.switch(3));(k[37]||k[65])&&(p.x-=p.s,p.switch(2));u&&r&&p.switch(1);u&&k[37]&&p.switch(0);u||d||r||l||bdBoom||(p.seq=[1,0],p.update(),p.seq=[])}function touchMove(b,e){p.x<b-p.s&&(p.x+=p.s,p.switch(3)),p.x>b+p.s&&(p.x-=p.s,p.switch(2)),p.y<e-p.s&&(p.y+=p.s,p.switch(4)),p.y>e+p.s&&(p.y-=p.s,p.x<b-p.s?p.switch(1):p.switch(0)),p.isClose(b,e,.1)&&(done=!0)}function shadow(){c.shadowOffsetX=-3,c.shadowOffsetY=-3,c.shadowColor="black",c.shadowBlur=3}