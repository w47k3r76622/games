(()=>{"use strict";var t,e,i,s,h={70:(t,e,i)=>{i.d(e,{A:()=>a});let s=.3,h=new AudioContext,r=(t=1,e=.05,i=220,r=0,a=0,n=.1,o=0,l=1,c=0,d=0,u=0,p=0,x=0,m=0,f=0,w=0,g=0,y=1,_=0,v=0,S=0)=>{let b=Math,z=2*b.PI,A=44100,M=c*=500*z/A/A,T=i*=(1-e+2*e*b.random(e=[]))*z/A,k=0,E=0,N=0,C=1,R=0,P=0,L=0,O=S<0?-1:1,W=z*O*S*2/A,I=b.cos(W),Y=b.sin,G=Y(W)/4,j=1+G,B=-2*I/j,X=(1-G)/j,U=(1+O*I)/2/j,$=-(O+I)/j,D=U,H=0,q=0,K=0,V=0;for(d*=500*z/A**3,f*=z/A,u*=z/A,p*=A,x=A*x|0,t*=s,O=(r=A*r+9)+(_*=A)+(a*=A)+(n*=A)+(g*=A)|0;N<O;e[N++]=L*t)++P%(100*w|0)||(L=o?1<o?2<o?3<o?Y(k**3):b.max(b.min(b.tan(k),1),-1):1-(2*k/z%2+2)%2:1-4*b.abs(b.round(k/z)-k/z):Y(k),L=(x?1-v+v*Y(z*N/x):1)*(L<0?-1:1)*b.abs(L)**l*(N<r?N/r:N<r+_?1-(N-r)/_*(1-y):N<r+_+a?y:N<O-g?(O-N-g)/n*y:0),L=g?L/2+(g>N?0:(N<O-g?1:(O-N)/g)*e[N-g|0]/2/t):L,S&&(L=V=D*H+$*(H=q)+U*(q=L)-X*K-B*(K=V))),W=(i+=c+=d)*b.cos(f*E++),k+=W+W*m*Y(N**5),C&&++C>p&&(i+=u,T+=u,C=0),!x||++R%x||(i=T,c=M,C=C||1);(t=h.createBuffer(1,O,A)).getChannelData(0).set(e),(i=h.createBufferSource()).buffer=t,i.connect(h.destination),i.start()};function a(t,e=.3){switch(s=e,t){case"explosion":r(...[,,68,.01,.03,.76,2,1.2,5,,,,,1.5,,.2,,.32,.12,.4]);break;case"pickup":r(...[,,590,.01,.07,,1,1.3,,-96,443,.06,.03,,,,,.83,.04]);break;case"update":r(...[,,919,.01,,.02,1,4.4,51,-17,,,,,113,,,.66,.02,.13,-1319]);break;case"levelup":r(...[.6,,405,.09,.13,.14,,1.4,,-3,-198,.05,.05,,,,,.82,.21,,170])}}},961:(t,e,i)=>{i.d(e,{A:()=>o});var s=i(251);let h=document.createElement("canvas");h.width=576,h.height=576;let r=h.getContext("2d");function a(t){for(let n=0;n<t;n++)e=Math.random()*h.width,i=Math.random()*h.height,s=2*Math.random(),a=Math.random(),r.beginPath(),r.arc(e,i,s,0,2*Math.PI),r.fillStyle=`rgba(255, 255, 255, ${a})`,r.fill();var e,i,s,a;return h}r.fillStyle="black",r.fillRect(0,0,h.width,h.height);var n=i(70);class o{constructor(t){this.sprite=t,this.columnTexts=[],this.numberOfColumns=8,this.level=1,this.levelSpeed=1,this.horizontalNumbers=[],this.verticalNumbers=[],this.populateNumbers(),this.horizontalTexts=[],this.verticalTexts=[],this.updateNumberTexts(),this.colsWith13Sums=[],this.rowsWith13Sums=[],this.tilesWith13Sums=[],this.warningTiles=[],this.populateColsAndRowsWith13Sums(),this.populateWarningTiles(),this.grid=this.resetGrid(),this.background=this.createBackground()}startLevel(){this.horizontalNumbers=[],this.verticalNumbers=[],this.populateNumbers(),this.updateNumberTexts(),this.populateColsAndRowsWith13Sums(),this.populateWarningTiles(),this.resetGrid()}setLevelSpeed(){this.levelSpeed=1+this.level/2}resetGrid(){return console.log(this.getCurrentLevel()),this.createGrid(this.sprite,this.getColsWith13Sums.bind(this),this.getRowsWith13Sums.bind(this),this.updateNumbers.bind(this),this.getCurrentLevel.bind(this))}getCurrentLevel(){return this.level}getColsWith13Sums(){return this.colsWith13Sums}getRowsWith13Sums(){return this.rowsWith13Sums}populateNumbers(){for(let t=0;t<this.numberOfColumns;t++)this.horizontalNumbers.push(t%5+1),this.verticalNumbers.push(t%5+1);this.horizontalNumbers[3]+this.verticalNumbers[3]===13&&(this.horizontalNumbers=[],this.verticalNumbers=[],this.populateNumbers())}updateNumbers(){this.horizontalNumbers.shift(),this.horizontalNumbers.push(Math.floor(9*Math.random())+1),this.verticalNumbers.shift(),this.verticalNumbers.push(Math.floor(9*Math.random())+1),this.updateNumberTexts(),this.populateColsAndRowsWith13Sums(),this.populateWarningTiles(),(0,n.A)("update")}populateColsAndRowsWith13Sums(){this.colsWith13Sums=[],this.rowsWith13Sums=[],this.tilesWith13Sums=[];for(let t=0;t<this.numberOfColumns-1;t++)for(let e=0;e<this.numberOfColumns-1;e++)this.horizontalNumbers[t]+this.verticalNumbers[e]===13&&(this.colsWith13Sums.push(t),this.rowsWith13Sums.push(e),this.tilesWith13Sums.push({x:t,y:e}))}populateWarningTiles(){this.warningTiles=[],this.tilesWith13Sums.forEach((t=>{this.warningTiles.push((0,s.kx)({x:64*t.x+64,y:64*t.y+64,color:"#ae3b2f",alpha:255,width:64,height:64,render:function(){const t=`${this.color}${this.alpha.toString(16).padStart(2,"0")}`;this.context.fillStyle=t,this.context.fillRect(0,0,this.width,this.height)},update:function(t){this.alpha=this.alpha-Math.floor(200*t),this.alpha<0&&(this.alpha=0)}}))}))}updateNumberTexts(){this.horizontalTexts=[],this.verticalTexts=[];for(let t=0;t<this.numberOfColumns;t++){const e=64,i=5;this.horizontalTexts.push(new s.EY({text:this.horizontalNumbers[t].toString(),font:"20px Arial",color:"white",x:64*t+e/2-i+e,y:e/2-i})),this.verticalTexts.push(new s.EY({text:this.verticalNumbers[t].toString(),font:"20px Arial",color:"white",x:e/2-i/2,y:64*t+e/2-2*i+64}))}}createGrid(t,e,i,h,r){return(0,s.kx)({x:0,y:0,image:t,tileSize:64,numRows:8,green:"#41772f",red:"#ae3b2f",seed:7,seededRandom:function(t){const e=1e4*Math.sin(t);return e-Math.floor(e)},generateColor:function(t,e){return"#"+((1<<24)+(Math.floor(256*this.seededRandom(t+e))<<16)+(Math.floor(256*this.seededRandom(t+e+1))<<8)+Math.floor(256*this.seededRandom(t+e+2))).toString(16).slice(1).toUpperCase()+"99"},getLevelSpeed:function(){return 2/(1+.1*(r()-1))},drawCanon:function(t,e,i=!1,s=!1){if(!s){if(t!==8*this.tileSize){const s=i?this.red:this.green;this.context.fillStyle=s,this.context.fillRect(t+20,e+8,26,13)}this.context.drawImage(this.image,this.tileSize,0,this.tileSize,this.tileSize,t,e,this.tileSize,this.tileSize)}if(s){if(e!==8*this.tileSize){const s=i?this.red:this.green;this.context.fillStyle=s,this.context.fillRect(t+8,e+20,13,26)}this.context.save(),this.context.translate(t,e+this.tileSize),this.context.rotate(-Math.PI/2),this.context.drawImage(this.image,this.tileSize,0,this.tileSize,this.tileSize,0,0,this.tileSize,this.tileSize),this.context.restore()}},render:function(){for(let t=0;t<this.numRows;t++)for(let s=0;s<this.numRows;s++){const h=s*this.tileSize,a=t*this.tileSize;if(0==(t+s)%2&&0!=t&&0!=s){const t=this.generateColor(this.seed,r());this.context.fillStyle=t,this.context.fillRect(h,a,this.tileSize,this.tileSize),this.context.drawImage(this.image,0,0,this.tileSize,this.tileSize,h,a,this.tileSize,this.tileSize)}0==t&&0!=s&&this.drawCanon(h,a,e().includes(s-1)),0==s&&0!=t&&this.drawCanon(h,a,i().includes(t-1),!0)}this.drawCanon(0,8*this.tileSize,!1,!0),this.drawCanon(8*this.tileSize,0,!1,!1)},update:function(t){this.timeSinceLastUpdate=this.timeSinceLastUpdate||0,this.timeSinceLastUpdate+=t,this.timeSinceLastUpdate>this.getLevelSpeed()&&(h(),this.timeSinceLastUpdate=0)}})}createBackground(){return(0,s.kx)({x:0,y:0,image:a(500)})}update(t){this.grid.update(t),this.warningTiles.forEach((e=>e.update(t)))}render(){this.background.render(),this.grid.render(),this.warningTiles.forEach((t=>t.render())),this.horizontalTexts.forEach((t=>t.render())),this.verticalTexts.forEach((t=>t.render()))}}},956:(t,e,i)=>{i.d(e,{A:()=>h});var s=i(251);(0,s.an)(),(0,s.KD)();class h extends s.Sm{constructor(t,e){super(e),this.gameState=t,this.title=new s.EY({text:"You died",font:"20px Arial",color:"white",x:180,y:180}),this.scoreText=new s.EY({score:0,text:"Total score: "+this.score,font:"20px Arial",color:"white",x:180,y:210,update:function(){this.text="Total score: "+this.score}}),this.subTitle=new s.EY({text:"Press [Enter / Start] to try again",font:"20px Arial",color:"white",x:180,y:240})}update(t,e){this.scoreText.score=e,this.scoreText.update(),((0,s._l)("enter")||(0,s.Ie)("start"))&&this.gameState.startGame()}render(){this.title.render(),this.subTitle.render(),this.scoreText.render()}}},603:(t,e,i)=>{i.d(e,{A:()=>r});var s=i(251),h=i(70);(0,s.an)(),(0,s.KD)(),s.Kd.ControlLeft="ctrl";class r extends s.Sm{constructor(t,e,i){super(i),this.sprite=t,this.gameArea=e,this.score=100,this.level=1,this.maxLevel=7,this.gameOver=!1,this.gameObjects=[],this.scene="START",this.goalSprite=(0,s.kx)({x:64*Math.floor(7*Math.random())+64,y:64*Math.floor(7*Math.random())+64,radius:32,color:"#edc06d",render(){this.context.fillStyle="#00000055",this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,2*Math.PI),this.context.fill();const t=this.context.createRadialGradient(this.radius/1.3,this.radius/1.3,0,0,0,2*this.radius);t.addColorStop(0,"#edc06dff"),t.addColorStop(1,"#edc06d00"),this.context.fillStyle=t,this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,2*Math.PI),this.context.fill()}}),this.energyBar=(0,s.kx)({x:412,y:544,width:96,height:32,customRender(t){this.context.fillStyle="white",this.context.fillRect(this.x-32,this.y-this.height/2,this.width+36,this.height+4),this.context.fillStyle="black",this.context.fillRect(this.x+2,this.y-this.height/2+2,this.width,this.height),this.context.fillStyle="#4a8cbd",this.context.fillRect(this.x+2,this.y-this.height/2+2,this.width*t/100,this.height),this.context.fillStyle="black",this.context.font="bold 20px Arial",this.context.fillText("E",this.x-22,this.y+10)}}),this.playerSprite=(0,s.kx)({x:288,y:288,velocity:{x:0,y:0},direction:{x:0,y:-1},anchor:{x:.5,y:.5},speed:2,size:64,rotation:0,customImage:this.sprite,turbo:!1,energy:100,cooldown:0,dead:!1,stealthed:!1,toggleTurbo(){0===this.cooldown&&this.energy>0&&!this.stealthed&&(this.turbo=!this.turbo,this.cooldown=30)},resetPlayer(){this.x=288,this.y=288,this.dead=!1,this.energy=100,this.turbo=!1,this.rotation=0},updateEnergy(){this.turbo?(this.energy-=1,this.energy<=0&&(this.turbo=!1)):this.stealthed?(this.energy-=1.5,this.energy<=0&&(this.stealthed=!1)):(this.energy+=.5,this.energy>100&&(this.energy=100))},getSpeed(){return this.turbo?2*this.speed:this.speed},remove(){this.ttl=0},render(){this.stealthed&&(this.context.globalAlpha=.5),this.context.drawImage(this.customImage,128,0,this.size,this.size,-this.size/2,-this.size/2,this.size,this.size)},update(t,e){let i=(0,s.P7)("leftstickx",0),h=(0,s.P7)("leftsticky",0);this.direction.x=0,this.direction.y=0,((0,s._l)("w")||(0,s._l)("arrowup")||(0,s.Ie)("dpadup")||h<-.5)&&(this.direction.y=-1),((0,s._l)("s")||(0,s._l)("arrowdown")||(0,s.Ie)("dpaddown")||h>.5)&&(this.direction.y=1),((0,s._l)("a")||(0,s._l)("arrowleft")||(0,s.Ie)("dpadleft")||i<-.5)&&(this.direction.x=-1),((0,s._l)("d")||(0,s._l)("arrowright")||(0,s.Ie)("dpadright")||i>.5)&&(this.direction.x=1),((0,s._l)("space")||(0,s.Ie)("south"))&&this.toggleTurbo(),((0,s._l)("ctrl")||(0,s.Ie)("west"))&&this.energy>0&&!this.turbo&&(this.stealthed=!0),this.velocity.x=this.direction.x*this.getSpeed(),this.velocity.y=this.direction.y*this.getSpeed(),0!==this.velocity.x&&0!==this.velocity.y&&(this.velocity.x/=Math.sqrt(2),this.velocity.y/=Math.sqrt(2)),this.x+=this.velocity.x,this.y+=this.velocity.y,this.x<64+this.size/2&&(this.x=64+this.size/2),this.x>512-this.size/2&&(this.x=512-this.size/2),this.y<64+this.size/2&&(this.y=64+this.size/2),this.y>512-this.size/2&&(this.y=512-this.size/2),0===this.direction.x&&0===this.direction.y||(this.rotation=Math.atan2(this.direction.y,this.direction.x)+Math.PI/2),this.updateEnergy(),this.cooldown>0&&(this.cooldown-=1)}}),this.gameObjects.push(this.playerSprite)}startGame(){this.level=1,this.gameArea.level=this.level,this.gameArea.startLevel(),this.gameObjects=[],this.playerSprite.resetPlayer(),this.gameOver=!1,this.score=0,this.scene="GAME"}createLasers(){const t=64*this.columnNumber+96,e=64*this.rowNumber+96,i=(this.colNumber,64*this.rowNumber+128);this.gameObjects.push((0,s.kx)({x:t,y:64,color:"#aa4d8dff",size:4,remove:!1,render(){this.context.fillStyle=this.color,this.context.fillRect(-this.size/2,0,this.size,i-this.y)},update(t){this.size+=this.size*t*50,this.size>48&&(this.size=48,this.remove=!0)}})),this.gameObjects.push((0,s.kx)({x:64,y:e,color:"#aa4d8dff",size:4,remove:!1,render(){this.context.fillStyle=this.color,this.context.fillRect(0,-this.size/2,t-32,this.size)},update(t){this.size+=this.size*t*50,this.size>48&&(this.size=48,this.remove=!0)}}))}createExplosion(){let t=[];self=this;for(let e=0;e<20;e++)t.push({x:this.playerSprite.x,y:this.playerSprite.y,radius:20*Math.random()+10,color:`rgba(255, ${255*Math.random()}, 0, 1)`,velocityX:4*(Math.random()-.5),velocityY:4*(Math.random()-.5),life:1});this.gameObjects.push((0,s.kx)({x:this.playerSprite.x,y:this.playerSprite.y,particles:t,update(){for(let t=this.particles.length-1;t>=0;t--){let e=this.particles[t];e.x+=e.velocityX,e.y+=e.velocityY,e.radius*=.97,e.life-=.02,e.life<=0&&this.particles.splice(t,1)}0===this.particles.length&&(this.ttl=0,self.gameOver=!0)},render(){this.particles.forEach((t=>{this.context.beginPath(),this.context.arc(t.x-this.x,t.y-this.y,t.radius,0,2*Math.PI,!1),this.context.fillStyle=t.color.replace("1)",`${t.life})`),this.context.fill()}))}}))}updateNumbers(){this.rowNumber=Math.floor(this.playerSprite.y/64)-1,this.columnNumber=Math.floor(this.playerSprite.x/64)-1,13!==this.gameArea.verticalNumbers[this.rowNumber]+this.gameArea.horizontalNumbers[this.columnNumber]||this.playerSprite.stealthed||(this.createLasers(),this.playerSprite.dead=!0,this.createExplosion(),(0,h.A)("explosion"))}update(t){this.score===5*this.level&&(this.level=this.level+1,this.gameArea.level=this.level,(0,h.A)("levelup",.3)),this.gameOver?this.scene="GAME_OVER":(this.gameObjects.forEach(((e,i)=>{e.update(t),e.remove&&this.gameObjects.splice(i,1)})),this.playerSprite.dead||(this.playerSprite.update(),this.updateNumbers()),(0,s.MS)(this.playerSprite,this.goalSprite)&&(this.score=this.score+1,this.goalSprite.x=64*Math.floor(7*Math.random())+64,this.goalSprite.y=64*Math.floor(7*Math.random())+64,(0,h.A)("pickup",.2)))}render(){this.goalSprite.render(),this.gameOver?this.scene="GAME_OVER":(this.gameObjects.forEach((t=>t.render())),this.playerSprite.dead||this.playerSprite.render(),this.energyBar.customRender(this.playerSprite.energy))}}},202:(t,e,i)=>{i.d(e,{A:()=>h});var s=i(251);(0,s.an)(),(0,s.KD)();class h extends s.Sm{constructor(t,e){super(e),this.gameState=t,this.title=new s.EY({text:"Dont step on thirteen",font:"20px Arial",color:"white",x:192,y:192}),this.subTitle=new s.EY({text:"Press [Enter / Start] to start",font:"20px Arial",color:"white",x:192,y:256})}update(t){((0,s._l)("enter")||(0,s.Ie)("start"))&&this.gameState.startGame()}render(){this.title.render(),this.subTitle.render()}}},44:(t,e,i)=>{i.a(t,(async(t,e)=>{try{var s=i(251),h=i(603),r=i(961),a=i(202),n=i(956);let{canvas:t,context:o}=(0,s.Ts)();t.width=576,t.height=576;const l=await(0,s.Hh)("square.png");let c=new r.A(l[0]),d=new h.A(l[0],c),u=new a.A(d),p=new n.A(d);(0,s.$7)({update:function(t){"START"!=d.scene?"GAME_OVER"!=d.scene?(d.gameArea.update(t),d.update(t)):p.update(t,d.score):u.update()},render:function(){"START"!=d.scene?"GAME_OVER"!=d.scene?(d.gameArea.render(),d.render()):p.render():u.render()}}).start(),e()}catch(t){e(t)}}),1)},251:(t,e,i)=>{function s(t,e,i){return Math.min(Math.max(t,i),e)}function h(t,e){let i=r(t),s=r(e);return!(t.radius&&i.width!=i.height||e.radius&&s.width!=s.height)&&([i,s]=[i,s].map((s=>((s==i?t:e).radius&&(s.radius=s.width/2,s.x+=s.radius,s.y+=s.radius),s))),t.radius&&e.radius?Math.hypot(i.x-s.x,i.y-s.y)<i.radius+s.radius:t.radius||e.radius?function(t,e){let{x:i,y:s,width:h,height:a}=r(e);do{i-=e.sx||0,s-=e.sy||0}while(e=e.parent);let n=t.x-Math.max(i,Math.min(t.x,i+h)),o=t.y-Math.max(s,Math.min(t.y,s+a));return n*n+o*o<t.radius*t.radius}(t.radius?i:s,t.radius?e:t):i.x<s.x+s.width&&i.x+i.width>s.x&&i.y<s.y+s.height&&i.y+i.height>s.y)}function r(t){let{x:e=0,y:i=0,width:s,height:h,radius:r}=t.world||t;return t.mapwidth&&(s=t.mapwidth,h=t.mapheight),r&&(s=2*r.x,h=2*r.y),t.anchor&&(e-=s*t.anchor.x,i-=h*t.anchor.y),s<0&&(e+=s,s*=-1),h<0&&(i+=h,h*=-1),{x:e,y:i,width:s,height:h}}i.d(e,{$7:()=>X,EY:()=>j,Hh:()=>C,Ie:()=>Q,KD:()=>J,Kd:()=>st,MS:()=>h,P7:()=>Z,Sm:()=>O,Ts:()=>x,_l:()=>lt,an:()=>ot,kx:()=>I});let a=()=>{};let n,o,l={};function c(t,e){l[t]=l[t]||[],l[t].push(e)}function d(t,...e){(l[t]||[]).map((t=>t(...e)))}let u={get:(t,e)=>"_proxy"==e||a};function p(){return o}function x(t,{contextless:e=!1}={}){if(n=document.getElementById(t)||t||document.querySelector("canvas"),e&&(n=n||new Proxy({},u)),!n)throw Error("You must provide a canvas element for the game");return o=n.getContext("2d")||new Proxy({},u),o.imageSmoothingEnabled=!1,d("init"),{canvas:n,context:o}}let m=/(jpeg|jpg|gif|png|webp)$/,f=/(wav|mp3|ogg|aac)$/,w=/^\//,g=/\/$/,y=new WeakMap,_="",v="",S="";function b(t,e){return new URL(t,e).href}function z(t,e){return[t.replace(g,""),t?e.replace(w,""):e].filter((t=>t)).join("/")}function A(t){return t.split(".").pop()}function M(t){let e=t.replace("."+A(t),"");return 2==e.split("/").length?e.replace(w,""):e}let T={},k={},E={};function N(){window.__k||(window.__k={dm:y,u:b,d:E,i:T})}function C(...t){return N(),Promise.all(t.map((t=>{let e=A([].concat(t)[0]);return e.match(m)?(i=t,N(),new Promise(((t,e)=>{let s,h,r;if(s=z(_,i),T[s])return t(T[s]);h=new Image,h.onload=function(){r=b(s,window.location.href),T[M(i)]=T[s]=T[r]=this,d("assetLoaded",this,i),t(this)},h.onerror=function(){e("Unable to load image "+s)},h.src=s}))):e.match(f)?function(t){return new Promise(((e,i)=>{let s,h,r,a,n=t;var o;return s=new Audio,h={wav:(o=s).canPlayType('audio/wav; codecs="1"'),mp3:o.canPlayType("audio/mpeg;"),ogg:o.canPlayType('audio/ogg; codecs="vorbis"'),aac:o.canPlayType("audio/aac;")},(t=[].concat(t).reduce(((t,e)=>t||(h[A(e)]?e:null)),0))?(r=z(v,t),k[r]?e(k[r]):(s.addEventListener("canplay",(function(){a=b(r,window.location.href),k[M(t)]=k[r]=k[a]=this,d("assetLoaded",this,t),e(this)})),s.onerror=function(){i("Unable to load audio "+r)},s.src=r,void s.load())):i("cannot play any of the audio formats provided "+n)}))}(t):function(t){let e,i;return N(),e=z(S,t),E[e]?Promise.resolve(E[e]):fetch(e).then((t=>{if(!t.ok)throw t;return t.clone().json().catch((()=>t.text()))})).then((s=>(i=b(e,window.location.href),"object"==typeof s&&y.set(s,i),E[M(t)]=E[e]=E[i]=s,d("assetLoaded",s,t),s)))}(t);var i})))}class R{constructor(t=0,e=0,i={}){null!=t.x?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}set(t){this.x=t.x,this.y=t.y}add(t){return new R(this.x+t.x,this.y+t.y,this)}subtract(t){return new R(this.x-t.x,this.y-t.y,this)}scale(t){return new R(this.x*t,this.y*t)}normalize(t=this.length()||1){return new R(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}direction(){return Math.atan2(this.y,this.x)}clamp(t,e,i,s){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?s(this._a,this._d,t):t}set y(t){this._y=this._c?s(this._b,this._e,t):t}}function P(){return new R(...arguments)}class L{constructor(t){return this.init(t)}init(t={}){this.position=P(),this.velocity=P(),this.acceleration=P(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}class O extends L{init({width:t=0,height:e=0,context:i=p(),render:s=this.draw,update:h=this.advance,children:r=[],anchor:a={x:0,y:0},opacity:n=1,rotation:o=0,drotation:l=0,ddrotation:d=0,scaleX:u=1,scaleY:x=1,...m}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:a,opacity:n,rotation:o,drotation:l,ddrotation:d,scaleX:u,scaleY:x,...m}),this._di=!0,this._uw(),this.addChild(r),this._rf=s,this._uf=h,c("init",(()=>{this.context??=p()}))}update(t){this._uf(t),this.children.map((e=>e.update&&e.update(t)))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),1==this.scaleX&&1==this.scaleY||t.scale(this.scaleX,this.scaleY);let e=this.width,i=this.height;this.radius&&(e=i=2*this.radius);let s=-e*this.anchor.x,h=-i*this.anchor.y;(s||h)&&t.translate(s,h),this.context.globalAlpha=this.opacity,this._rf(),(s||h)&&t.translate(-s,-h),this.children.map((t=>t.render&&t.render())),t.restore()}draw(){}_pc(){this._uw(),this.children.map((t=>t._pc()))}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:i=1,_wrot:s=0,_wsx:h=1,_wsy:r=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this.radius&&(this._wrx=this.radius,this._wry=this.radius),this._wo=i*this.opacity,this._wsx=h*this.scaleX,this._wsy=r*this.scaleY,this._wx=this._wx*h,this._wy=this._wy*r,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this.radius&&(this._wrx=this.radius*this._wsx,this._wry=this.radius*this._wsy),this._wrot=s+this.rotation;let{x:a,y:n}=function(t,e){let i=Math.sin(e),s=Math.cos(e);return{x:t.x*s-t.y*i,y:t.x*i+t.y*s}}({x:this._wx,y:this._wy},s);this._wx=a,this._wy=n,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,radius:this.radius?{x:this._wrx,y:this._wry}:void 0,opacity:this._wo,rotation:this._wrot,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map((t=>{this.children.push(t),t.parent=this,t._pc=t._pc||a,t._pc()}))}removeChild(...t){t.flat().map((t=>{(function(t,e){let i=t.indexOf(e);if(-1!=i)return t.splice(i,1),!0})(this.children,t)&&(t.parent=null,t._pc())}))}get radius(){return this._r}set radius(t){this._r=t,this._pc()}get opacity(){return this._opa}set opacity(t){this._opa=s(0,1,t),this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}advance(t){super.advance(t),this.drotation+=this.ddrotation,this.rotation+=this.drotation}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class W extends O{init({image:t,width:e=(t?t.width:void 0),height:i=(t?t.height:void 0),...s}={}){super.init({image:t,width:e,height:i,...s})}get animations(){return this._a}set animations(t){let e,i;for(e in this._a={},t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){this.currentAnimation?.stop(),this.currentAnimation=this.animations[t],this.currentAnimation.start()}advance(t){super.advance(t),this.currentAnimation?.update(t)}draw(){if(this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color){if(this.context.fillStyle=this.color,this.radius)return this.context.beginPath(),this.context.arc(this.radius,this.radius,this.radius,0,2*Math.PI),void this.context.fill();this.context.fillRect(0,0,this.width,this.height)}}}function I(){return new W(...arguments)}let Y=/(\d+)(\w+)/;class G extends O{init({text:t="",textAlign:e="",lineHeight:i=1,font:s=p()?.font,...h}={}){t=""+t,super.init({text:t,textAlign:e,lineHeight:i,font:s,...h}),this.context&&this._p(),c("init",(()=>{this.font??=p().font,this._p()}))}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=function(t){if(!t)return{computed:0};let e=t.match(Y),i=+e[1];return{size:i,unit:e[2],computed:i}}(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context,e=[this.text];if(t.font=this.font,e=this.text.split("\n"),this._fw&&e.map((e=>{let i=e.split(" "),s=i.shift(),h=s;i.map((e=>{h+=" "+e,t.measureText(h).width>this._fw&&(this._s.push(s),h=e),s=h})),this._s.push(h)})),!this._s.length&&this.text.includes("\n")){let i=0;e.map((e=>{this._s.push(e),i=Math.max(i,t.measureText(e).width)})),this._w=this._fw||i}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,e=this.textAlign,i=this.context;e=this.textAlign||("rtl"==i.canvas.dir?"right":"left"),t="right"==e?this.width:"center"==e?this.width/2|0:0,this._s.map(((s,h)=>{i.textBaseline="top",i.textAlign=e,i.fillStyle=this.color,i.font=this.font,this.strokeColor&&(i.strokeStyle=this.strokeColor,i.lineWidth=this.lineWidth??1,i.strokeText(s,t,this._fs*this.lineHeight*h)),i.fillText(s,t,this._fs*this.lineHeight*h)}))}}function j(){return new G(...arguments)}function B(t){let e=t.canvas;t.clearRect(0,0,e.width,e.height)}function X({fps:t=60,clearCanvas:e=!0,update:i=a,render:s,context:h=p(),blur:r=!1}={}){if(!s)throw Error("You must provide a render() function");let n,o,l,u,x,m=0,f=1e3/t,w=1/t,g=e?B:a,y=!0;function _(){if(o=requestAnimationFrame(_),y&&(l=performance.now(),u=l-n,n=l,!(u>1e3))){for(m+=u;m>=f;)d("tick"),x.update(w),m-=f;g(x.context),x.render()}}return r||(window.addEventListener("focus",(()=>{y=!0})),window.addEventListener("blur",(()=>{y=!1}))),c("init",(()=>{x.context??=p()})),x={update:i,render:s,isStopped:!0,context:h,start(){this.isStopped&&(n=performance.now(),this.isStopped=!1,requestAnimationFrame(_))},stop(){this.isStopped=!0,cancelAnimationFrame(o)},_frame:_,set _last(t){n=t}},x}new WeakMap;let U=[],$={},D={},H={0:"south",1:"east",2:"west",3:"north",4:"leftshoulder",5:"rightshoulder",6:"lefttrigger",7:"righttrigger",8:"select",9:"start",10:"leftstick",11:"rightstick",12:"dpadup",13:"dpaddown",14:"dpadleft",15:"dpadright"};function q(t){U[t.gamepad.index]={pressedButtons:{},axes:{}}}function K(t){delete U[t.gamepad.index]}function V(){U.map((t=>{t.pressedButtons={},t.axes={}}))}function F(){let t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[];for(let e=0;e<t.length;e++){let i=t[e];if(!i)continue;i.buttons.map(((t,e)=>{let s=H[e],{pressed:h}=t,{pressedButtons:r}=U[i.index],a=r[s];!a&&h?[$[i.index],$].map((e=>{e?.[s]?.(i,t,s)})):a&&!h&&[D[i.index],D].map((e=>{e?.[s]?.(i,t,s)})),r[s]=h}));let{axes:s}=U[i.index];s.leftstickx=i.axes[0],s.leftsticky=i.axes[1],s.rightstickx=i.axes[2],s.rightsticky=i.axes[3]}}function J(){window.addEventListener("gamepadconnected",q),window.addEventListener("gamepaddisconnected",K),window.addEventListener("blur",V),c("tick",F)}function Q(t,{gamepad:e}={}){return isNaN(e)?U.some((e=>e.pressedButtons[t])):!!U[e]&&!!U[e].pressedButtons[t]}function Z(t,e){return U[e]?.axes[t]||0}let tt={},et={},it={},st={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function ht(t=a,e){t._pd&&e.preventDefault(),t(e)}function rt(t){let e=st[t.code],i=tt[e];it[e]=!0,ht(i,t)}function at(t){let e=st[t.code],i=et[e];it[e]=!1,ht(i,t)}function nt(){it={}}function ot(){let t;for(t=0;t<26;t++)st["Key"+String.fromCharCode(t+65)]=String.fromCharCode(t+97);for(t=0;t<10;t++)st["Digit"+t]=st["Numpad"+t]=""+t;window.addEventListener("keydown",rt),window.addEventListener("keyup",at),window.addEventListener("blur",nt)}function lt(t){return!![].concat(t).some((t=>it[t]))}}},r={};function a(t){var e=r[t];if(void 0!==e)return e.exports;var i=r[t]={exports:{}};return h[t](i,i.exports,a),i.exports}t="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",i="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",s=t=>{t&&t.d<1&&(t.d=1,t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},a.a=(h,r,a)=>{var n;a&&((n=[]).d=-1);var o,l,c,d=new Set,u=h.exports,p=new Promise(((t,e)=>{c=e,l=t}));p[e]=u,p[t]=t=>(n&&t(n),d.forEach(t),p.catch((t=>{}))),h.exports=p,r((h=>{var r;o=(h=>h.map((h=>{if(null!==h&&"object"==typeof h){if(h[t])return h;if(h.then){var r=[];r.d=0,h.then((t=>{a[e]=t,s(r)}),(t=>{a[i]=t,s(r)}));var a={};return a[t]=t=>t(r),a}}var n={};return n[t]=t=>{},n[e]=h,n})))(h);var a=()=>o.map((t=>{if(t[i])throw t[i];return t[e]})),l=new Promise((e=>{(r=()=>e(a)).r=0;var i=t=>t!==n&&!d.has(t)&&(d.add(t),t&&!t.d&&(r.r++,t.push(r)));o.map((e=>e[t](i)))}));return r.r?l:a()}),(t=>(t?c(p[i]=t):l(u),s(n)))),n&&n.d<0&&(n.d=0)},a.d=(t,e)=>{for(var i in e)a.o(e,i)&&!a.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),a(44)})();