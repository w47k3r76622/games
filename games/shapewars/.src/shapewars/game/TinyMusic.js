(function(d){var h="B#-C|C#-Db|D|D#-Eb|E-Fb|E#-F|F#-Gb|G|G#-Ab|A|A#-Bb|B-Cb",j=440*Math.pow(Math.pow(2,1/12),-9),i=/^[0-9.]+$/,e=4,b=/\s+/,g=/(\d+)/,f={};h.split("|").forEach(function(l,k){l.split("-").forEach(function(m){f[m]=k})});function a(l){var k=l.split(b);this.frequency=a.getFrequency(k[0])||0;this.duration=a.getDuration(k[1])||0}a.getFrequency=function(l){var m=l.split(g),o=f[m[0]],k=(m[1]||e)-e,n=j*Math.pow(Math.pow(2,1/12),o);return n*Math.pow(2,k)};a.getDuration=function(k){return i.test(k)?parseFloat(k):k.toLowerCase().split("").reduce(function(l,m){return l+(m==="w"?4:m==="h"?2:m==="q"?1:m==="e"?0.5:m==="s"?0.25:0)},0)};typeof module!=="undefined"&&(module.exports=a);function c(m,l,k){this.ac=m||new AudioContext();this.createFxNodes();this.tempo=l||120;this.loop=true;this.smoothing=0;this.staccato=0;this.notes=[];this.push.apply(this,k||[])}c.prototype.createFxNodes=function(){var k=[["bass",100],["mid",1000],["treble",2500]],l=this.gain=this.ac.createGain();k.forEach(function(m,n){n=this[m[0]]=this.ac.createBiquadFilter();n.type="peaking";n.frequency.value=m[1];l.connect(l=n)}.bind(this));l.connect(this.ac.destination);return this};c.prototype.push=function(){Array.prototype.forEach.call(arguments,function(k){this.notes.push(k instanceof a?k:new a(k))}.bind(this));return this};c.prototype.createCustomWave=function(l,k){if(!k){k=l}this.waveType="custom";this.customWave=[new Float32Array(l),new Float32Array(k)]};c.prototype.createOscillator=function(){this.stop();this.osc=this.ac.createOscillator();if(this.customWave){this.osc.setPeriodicWave(this.ac.createPeriodicWave.apply(this.ac,this.customWave))}else{this.osc.type=this.waveType||"square"}this.osc.connect(this.gain);return this};c.prototype.scheduleNote=function(m,k){var n=60/this.tempo*this.notes[m].duration,l=n*(1-(this.staccato||0));this.setFrequency(this.notes[m].frequency,k);if(this.smoothing&&this.notes[m].frequency){this.slide(m,k,l)}this.setFrequency(0,k+l);return k+n};c.prototype.getNextNote=function(k){return this.notes[k<this.notes.length-1?k+1:0]};c.prototype.getSlideStartDelay=function(k){return k-Math.min(k,60/this.tempo*this.smoothing)};c.prototype.slide=function(m,k,l){var n=this.getNextNote(m),o=this.getSlideStartDelay(l);this.setFrequency(this.notes[m].frequency,k+o);this.rampFrequency(n.frequency,k+l);return this};c.prototype.setFrequency=function(l,k){this.osc.frequency.setValueAtTime(l,k);return this};c.prototype.rampFrequency=function(l,k){this.osc.frequency.linearRampToValueAtTime(l,k);return this};c.prototype.play=function(k){k=typeof k==="number"?k:this.ac.currentTime;this.createOscillator();this.osc.start(k);this.notes.forEach(function(m,l){k=this.scheduleNote(l,k)}.bind(this));this.osc.stop(k);this.osc.onended=this.loop?this.play.bind(this,k):null;return this};c.prototype.stop=function(){if(this.osc){this.osc.onended=null;this.osc.disconnect();this.osc=null}return this};typeof module!=="undefined"&&(module.exports=c);d.Note=a;d.Sequence=c}(typeof window!=="undefined"?window:this));