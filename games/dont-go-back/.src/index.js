var canvas=document.getElementById("game"),ctx=canvas.getContext("2d"),width=canvas.width,height=canvas.height,canvasData=document.getElementById("gameData"),ctxData=canvasData.getContext("2d"),widthD=canvasData.width,heightD=canvasData.height,fieldSize=540,fieldSizeForDrawing=fieldSize+1,borderWidth=1,mainLevels='{"n":"Main Level 1","h":"000000000000000000000000000111001110110111001100101110110000100011110000111010110000000100011110100100100110010000100011110100010100010010000100011111000001000000001000110011111110001010000010001000011011111000000000000000100110011111100110100010011111010101101111101000110011110101011111111111010011001101010110001111111000001100110101000111111110000000100101010001110111000000000101110100001110010000000000111100100001111000010000001110011010001111010010000011111101110011111101110001010110001111101111010111010111111101001101010111000110011111101000110101011000011011111110100101010111100110011111110101010101111111110011111111011101001111101000011111111011010110011000110011111111101010101101011110011111111101110001111001010","v":"000010001001000010010100000000111000100001011001000100001111101110000110010111100011111011100001101101001110001110011110000111111011111010011011100000001111011111001111001110000000111001111011110111100110000011111101001111001010100001000001011010100000101011000000000110000111001010100010000000101010011010101010101000000111011001011010111000000001111011101000101110001100111111011100001001111000111111111011100110101110000001101111010000000010110000110101111010100111000000000001000110000000001010011000000010010000000010111010101110011110010000000011101010100011100000000001101010101000011000010000000010001010000000011000000000101000010100010101010000000001010011010011010000000000010110110011000110000000000000000001000010001","s":[0,0],"e":[26,26],"l":100,"cs":20,"hl":10};{"n":"Main Level 2","h":"000000000000000000000000000011111110111111111101011110011111101111111111000101110111111000111001111000110100011100000111001111100001000011100000111011111011111111011100001111001110111111110011100011111100100011111111000000010101000000011111111010000001010000000111111110011100011110000000111111100011100101111000001111110100011110110111100011111111110001100100011110111111111110000100000011100011111111111000110000111100001111111111001111111111100101011111110011111111111101101010111110000101111111001010100011110000011011110000101010100010100010111110000110101000001010101111101001111010110000101011111100111110101001000010111111111111100001100000101111111111111100000100000010011111111111110100000100101111110111111110110010010","v":"000000001000000000000010000000000000000000000011100000000000010000110000111010101100001111000101000011101011010001111100010000011000010000011111000110000100000000010001110000011001100000000000011100000011111100000000011111111111111111100000000010111110000111111100000001001001100000111111000000011010001101000011110000001001010001001100001000000000000011011111110001100000000000011001111100001110000000000011000100000011111000000001010000000000001011010000000011000000000011010101100001011100010000111101010000101101110100001111010101011110001101000000111000010111101000010000011010000101000110001100000001000001100011111001000000000000001111001111001000000000000001111111111001100000000000000001111111000000000000100000000000000","s":[13,12],"e":[14,12],"l":100,"cs":20,"hl":7};{"n":"Main Level 3","h":"000000000000000000000000000011111101110101010111111110001011001111011100111111100001110000111111000111111000110110000011111110010110000010110000111111100000100000010001000011111110001000000010000000011111110001000100010000000111111111000100010101000001111111111100100001010000011111110111100100010010000111100111101111110001101001111111111110000000010011011111111111111111111101000001111111111111101111110000000101111111111110111110000000011111100001011111100000000110111111111110100000010000111111110111111000000000000011111111111111111110000000011111111111111001111001000101011111111110011110000000010011111111100011110000010001111101111100111110000111010101100000000011100001101010111111111110010100011111111111101111111011010","v":"000000000001001001000000000010000010000101001000000001011000111000000011000000011000001111100000010100000111000000111100000001111101111010101111100000001111011111001111111100000001110111111010111111100000000111001101000111111000000000011101110000111110000001000001011110000111100010000010000001110000111000001000001010100110000110000000000000101010110011110000000000000010000010011111000000000000000000001011111110000001110001000001011111100000001001000011011010111100000001000000101111010111100000000000000010101011110100000000000000010000010111110000000000000110000011111101110000000001100001011111010100000000011110000010100101010001010101100001011000110000010101001110001010000010100000000000110011000000010000000000001000100","s":[13,0],"e":[13,26],"l":200,"cs":20,"hl":7};{"n":"Main Level 4","h":"000000000000000000000000000111111111111111111111011111111111111111111111111111101110111111111111111111111111111111111111111111111111110111111111111111111111111110111110111111111111111111111111110111111111111111111111111111111111111111011111111011111111111111111111111111000000001111111111111111110000000000000000000011111110000000000111111111011111110000000000000000000111111100000000000000000000011111110000000000000000000111111100111111111111111110011111110111101111111111111111111111111111111111111111111111110000000000000000000000000000000000000000000000000000000011111111111111111111111111111111111111111111111011111111111110111111111111111111110111111000000011110011110011000000011111000000001111011111000011111000000011011","v":"000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010100010000000000000000000011111111110101010100000001011111111001010101000000001011111111101011100100000001011111111111111111100000001011111111111111111100000001001011101010100011100000001000000000000000000100000000000000000000000000000000000001101010100101101010100101011010101011111010101011010010101010111010101010100111000000000000000000000000000000000000000000000000000000000000000101010100001100000100101111110101010100110000000010000000000111111110000000000111100000101011010000","s":[0,0],"e":[26,26],"l":1,"cs":20,"hl":15};{"n":"Main Level 5","h":"000000000000000000000000000000000000011111111111110111111111111111111110001111111111111000000001111111111110000111111111111111111111111111111000000011111111111111111111111111110000000000111111110110111111111111110000000000011111100000111111111111110000000000000000000001111111111101110000000000000000000100111111111111110000000000000000001111111111111111000000000000000001111111111111111110000000000000000011101001111111111100000000000000000111010100111111111000000000000000001110101000011111110000000000000000011110110000011011111000000000000000111100010000110111111000000000000001111000100001101111110000000000000011110000010011011111100000000000000001100000001010111111000000000000000000010001100001111110000000000000000001101000100001111100000000000000000011110101001010000000000000000000000111111001110000000000000000000000001111110001111010000000011000000000000111100011110111111000111100000000000011100111100111011101111110000000100001111111110111111011111111000000010000101111000011110111111111100000001000001110000000001111111100010000000000011100000011111111111110010000001000011110000110000000000000100000011100111110001111000000000010110000001110011111011111111111111111100000011100011111111111111111111111111000001110000000011111111111111111111100011110111111111111111111111111111110","v":"000000000000000100000000000000000000010000000000000101010101000000000000011000000000000010101011000000000001011100000000000000000000000000000111011110000000001000000000000000001111011111100000001101000000000000001111011111111010111111000000000000001111011111111111111111000000000000001111011111111111111001000000000000011111011111111111010000000000000000111111011111111110001010000000000001111111011111111100010101000000000011111111011111111000101011100000000111111111011111110000010111110000000111111111011111100001101111100100000111111111011111000011101111001000000111111111011110000111101110010000001111111111011110001111110100100000011111111111011111001111011001000000111111111111011111110111000000000001111111111111011110001011011001010011111111111111011100000001000110111111111111111111011000000111000111111111110111111111011000001110000100101111100011111111011100011100001100000011000001111111011110001000001100000010000000111111001111000000011100000100000000011111010111111000111101011000000001001111011011110001111110100000000010101111011111100001111110110111010100101111010011100000111000101001101001101111010001100000110000010110110110001111010001100000100000000000000000000111010000100101000000000000000000000011010001101010100000000000000000000001000000000000000000000000000000000000","s":[15,19],"e":[35,0],"l":100,"cs":15,"hl":6};{"n":"Main Level 6","h":"000000000000000000000000000000000000011000111111111111111111111111111110011001111011111111111111111110001100011100011111111111111111111110001110001000001111111111111111111010111111000000000001111111111111110000111100000000001010101111100000100000111000000000001100001111000001000000000000000000100110000111000010000001110000000001111100000011100100000001100000000011111110000011001000000000000000000111111111000111010000000000000000000111111111101111100000000000000000001111111111111111010001001000000000000111111111111110101010100100000000000011111111111111010101000010000000000001111111111111101010010000000000000000111111111111110100101000000000000000000011111111111111000100000000000000010001111111111111000110000000000000100000111110000000000111000000000000010000011010000000001111100000000000100000111000001111111100110000000000010001111110000000010100000000000000100011111101110000001000001000000000010111111000010000000100000100000000101111110000001111001001000010000000011111100000011111001000000010000000011110000000111111011000000001000000011111000011111111111000000010000000111111111110111111111000000001000001111111111111011111111000000010000011111111111111001111111100000001000111111111111111100000000010000010001111111111111111110000000011000001011111111111111111111111111111110010","v":"000011000000000000000000000000000000000011000010000000000000000000010001000011000010000000000000000000011001010011110000000000000000000000110000111111111000000000000000000111000000011111111111000000000000001111000011011111111001100000011110111111101111011111111001111000111101011111010111011111001001111100011011111110001111011110000001111110010101111111011111011100000000111100111111111111111111011000000000011000001111111111111111011000000000000000010110110111111111011000000000000000101011011011111111011100000000000000010110101101111111011110000000000000001001001110111111011111000000000000000110010111111111011111100000000000000000111011111111011111101110000000000000011101111111011111101111000000101111111100111111011111101111100001111100011000011111011111101111100100010011110001001111011111101111000001111011000011101111011111101110000001111110111011111111011111101100000011100101111011111011011111101000000111111011111011111101011111100000001111110000011010011110011111100000011111100000000111111110011111100000011110000000000111111110011111100000000000000000000011111110011111000000000000100000000011111110011110000000000000010000000011111110011100000000000000011101010101111110011000000000000000001011111000111110010000000000000000000110101100001110000000000000000000000000000000000100","s":[19,24],"e":[32,2],"l":100,"cs":15,"hl":9};{"n":"Main Level 7","h":"000000000000000000000000000000000000000011111111111100000000000111111110000001111111111110000000000011111111000011111111111100000000000111111110000011111011111110000000000011111111000011111111111100000000000111111110000001111111111110000000000011111111000011111111111100000000000111111110000001111111111110000000000111111110000001111111111110000000000111111110000011111111111100000000000011111111000011110111111110000000000111111110000011111110111110000000000111101111000011111011111110000000000111111110000011011111111110000000000111011111000011111111111100000000000111111110000001111111111110000000000111011111000011111111111100000000000101111111000001111111111110000000000111111110000001111111111110000000000000000000000011111111111100000000000000000000000001111111111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011111111","v":"011100000000000001111110101000000000011110000000000001111011111100000000011110000000000001111111111100000000011110000000000001111111111100000000011110000000000001111111111100000000011110000000000001111111111100000000011110000000000001111111111100000000011110000000000001111111111100000000011110000000000001111111111100000000011110000000000001111111111100000000011110000000000001111111111100000000011110000000000001011111111100000000010110000000000001111111111100000000011110000000000001111111111100000000011110000000000001111111111100000000011110000000000001111111111100000000011110000000000001111111111100000000011110000000000001111111111100000000011110000000000001111111111101101101011110000000000001111111111111111111011110000000000001111111111111111111011111101011010111111111111111111111011111111111111101111111111111111111011111111111111111110111111111111111011111111111111111111111111110111111011111111111111111111111111111111111011111111111111111111111111111111111011111011111111111111111111111111111011111111111101111101111111111111111011111111111111111111111111111111111011111111111111111111111111111111111011111111111111111111111111111111111011110111111111111111111111111111111011111111111111111111111111111110111001111111111111111111111110111011010011011110100111010111101011100000000","s":[0,0],"e":[35,35],"l":1,"cs":15,"hl":25};{"n":"Main Level 8","h":"000000000000000000000000000000000000000000000000000000001111111111111101111111111111111111111111111111111110011011111111111000111111111111111111111111111111111110011111111111110001111111111111111111111111110001111100111111111111100000111111111111111111111111111000000000011111111111000000000001111111111111111111110000000000111111101111000000000000111111111111111111100000000000011111111111000000000000111111111111111111110000000000111111111110000000000001111111111111111111111000000000111111011111000000000000111111111111111111111100000000111111101111000000000000011111111111111111111110000000011111111111000000000000001111111111111111111111000000111111111110000000000000000111111111111111111110000000011111111100000000000000000111111110111111111111111000111111111000000000000000001111111101111111110000001100011111110000000000000000011111111010110111111000011000111111100000000000000000111111110101101111101000001100011111000000000000000001111111101011000111111000001100111110000000000000000011111111010110001111110000011000011100000000000000000011111111101100000111111000001100111000000000000000000011111111111000001111110000011000000000000000000000000001111111111100001111111011111100000000000000000000000001111111111100000000111111111110000000000000000000000011111111111000000000011111111100000000000000100000000001111111111100000000001111110001000011111101000000000011111111111000000000011111100010000010111111000000000011111111111100000000001111110100000010000111100000000001111111111110000000011111101000011110000011110000000000111111111111011100001111111000001001000001111000000000011111110111100000011111110000000010000000111101111100001111101111000000001111111000000001000000011111111100000111011110000000011110111000000010000000111111111000000011111110000000011011111000000001000000011111111100000111111100000000011110111000000010000000111111111000000011111110000000011111101000000001000000111111111000000001111111000000010111111000000010000000011111111100000000111111111110001111111000000001000000111111111000000000011111111111011111110000000010000000011111111100000000001111111111101111111000000001000000111111111000000000000111111000011111110000000000100000011111111100000000000011110111101111100000000001010000111111111000000000000001101001110111000000100010101001111111111100000000000000011000111000000000000001010011111111111110000000000000001100010000000000000000101011111111111111000000000000000110100000000000000001010101111111111111111100000000000011100000000000000010101010000000001111111110000000000111000000000000000001010101111111111111111110000000000100001111000000000000001011111111111111111110000000000100011111100000000011111111111111111111111111000000000010111111000000000111111111111111111111111111100011000100111111000000000111111111111111111111111111110111100010011111100000000111111111111111111111111111111111110100111111000000011111111111111111111111111111111111111010111111101111","v":"010000000000000010000000000000000000000000000000000000010000000000000011000000000000000000000000000000000000000000000000000111000000000000000000000000000110000001000000000000001111000000000000000000000000000111001011100000000000011111110110000000000000000000000111111111000000000000111111111111000000000000000000001111111111000000000000111111111111100000000000000000001111111111000000000000111111111111000000000000000000000111111111000000000000111111111111000000000000000000000011111111000000000000111111111111100000000000000000000001111111000000000000111111111111110000000000000000000000111111000000000000111111111111111000000000000000000000111111000000000001111111011111111000000001000000000000110111000000000011111111111111111000000001000000000101010011000000000111111111111111110000000010100000000111110011000000001111111111111111100000000101001000000111110011000000011111111111111111000000001010011000000111110011100000111111111111111110000000010100111000000111110011000001111111111111111110000000001001111000000111110011000011111111111111111110000000000011111000000111110011010111111111111111111110000000000011111000000110100011011111111111111111111110000000000011111010000000000001011111111111111111111110000000000011111111100000000001011111111111101111111110000000000011111111110000000011011110101011011111111110000000000011111111110000001110011101000000111111111100000000000011111111110000001101011101101000011111111110000000000001111111110000001011001001111100001111101011000000000000110101110000000111010010111110000111111111100000000100001011110000000111011110111111000011111111110000001000011111110000000111011110111111100000000011111100010000111111110000000111011110111111100000000011111100000001111111110000000111011110111111100000000011111100000001111111110000000111011110111111100000000011111100000001111111110000000111011110111111100000000011111110000000111111110000000111011110111111100000000011111111000000010111110000000111011110111111100000000011111111100000000000110000000111011110111111100000000011111111110000000000010000000111011110111111100000000011111111111000000010100000000111011111011111100000000011111111111100000101010000001111011110101111100000000011111111111110001010001000011111011111010111000000000011111111111111100111000101111111011110101110000000000001111111111111110011100111111111011111010100000000000000111111111111111001101111111111011110101010000000000000010011111111111100011111111111011111010101101010100000000001111111111100011111111111011110101010010101010000000001111111111000111010111111011111010100000000000000000001111111111101110000011111011110001000000000000000000000111111111101100000011111011100000000000000000000000000011110111101100000011111011000000000000000000000000000001100011101100000011111011000000000000000000000000000000000001101100000011111010000000000000000000000000000000000000101000000011010000000000000000000000000000000000000000000000000010000","s":[0,0],"e":[53,53],"l":300,"cs":10,"hl":26};{"n":"Main Level 9","h":"000000000000000000000000000000000000000000000000000000011111111111111111111011111111111111111111111111111110001111111111111111111111111111111111111111111111111100000111111111111111111111111111111111111111111111111000000011111111111111111111111111111111111111111111110000000001111111111111111111111111111111111111111111100000000000111111111111111111111111111111111111111111000000000000011111111111111111111111111111111111111110000000000000001111111011111111111111111111111111111100000000000000000111111111111111111111111111111111111000000000000000000011111111111111111111111111111111110000000000000010000001111111111111111111111111111111100000000000000000000000111011111111111111111111111111000000000000000000000000011111111111111111111111111110000000000000000000000000001111111111111111111111111100000000000000000000000000000111011111111111111111111000000000000000000000000000000011111111111111111111110000000000000000000000000000000001111111111111111111100000000000000000000000000000000000111111111111111111000000000000000000000000000000000000011111111111111110000000000000000000000000000000000000001111111111111100000000000000000000000000000000000000000111111111111000000000000000000000000000000000000000000001111111110000000000000000000000000000000000000000000001111111100000000000000000000000000000100000000000000000111101000000000000000000000000000000000000000000000000011110000000000000000000000000000000000000000000000000001100100000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000001110000000000000000000000000000000000000000000000000011111000000000000000000000000000000000000000010000000111111100010000000000000000000000000000000000000000001111111110000000000000000000000000000000000000000000011111111111000000000000000000000000000000000000000000111111111111100000000000000000000000000000000000000001111111111111110000000000000000000000000000000000000011111111111011111000000000000000000000000000000000000111111111111111111100000000000000000000000000000000001111011111111111111110000000000000000000000000000000011111111111111111111111000000000000000000000000000000111111111111111111111111100000000000000000000000000001111111111111111110111111110000000000000000000000000011111111111111111111111111111000000000000000000000000111111111111111111111111111011100000000000000000000001111111111111111111111111111111110000000000000000000011111111111111111111111111111011111000000000000000000111111111111111111111111111111111111100000000000000001111111111111111111111111111111111111110000000000000011111111111111111111111111111111111111111000000000000111111111111111111111111111111111111111111100000000001111111011111111111111111111111111111111111110000000011111111111111111111111111111111111111111111111000000111111111111111111111111111111111111111111111111100001111111111111111111111111111111111111111111111111110011111111111111111111111111111111111111111111111111111","v":"000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000001011000000000000000000000000000000000000000000100000011011100000000000000000000000000000000000000000000000111011110000000000000000000000000000000000000000000001111011111000000000000000000000000000000000000000000011111011111100000000000000000000000000000000000000000111111011111110000000000000000000000000000000100000001111111011111111000000000000000000000000000000000000011111111011111111100000000000000010000000000000000000111111111011011111110000000000000000000000000000000001111111111011111111111000000000000000000000000000000011111111111011111111111100000000000000000000000000000111111111111011111111111110000000000000000000000000001111111111111011111111111111000000000000000000000010011111111111111011111111111111100000000000000000000000111111111111111011111111111111110000000000000000000001111111111111111011111111111111111000000000000000000011111111111111111011111111011111111100000000000000000111111111111111111011111111111111111110000000000000001111111111111111111011111111111111111111000000000000001111111111111111111011111111111111111111100000000000111111111111111111111011111111111111111111110000000001111111111111111111111011111111111111111111111000000011111111111111111111111011111111111111111111111100000111111111111111111111111011111111111111111111111110001111111111111111111111111011111111111111111111111111011111111111111111111111111011111111111111111111111111001111111111111111111111111011111111111111111111111110000111111111111111111111111011111111111111111011111100000011111111111111111111111011111111111111111111111000000001111111111111111111111011111111111111111111110000000010111111111111111111111011111111111111111111100000000000011111111111111111111011111111111111111111000000000000001111111111111111111011111111111111111110000000000000000111111111111111111011111111111111111100000000000000000011111111111111111011111111111111111000000000000000000001111111111111111011111111111111110000000000000000000000111111111111111011111111111111100000000000000000000000011111111111111011111111111111000000000000000000000000001111111111111011111111111110001000000000000000000000000111111111111011111111111100000000000000000000000000000011111111111011111111111000001000000000000000000000000001111111111011111101110000000000000000000000000000000000111111111011111111100000000000000000000000000000000000011111111011111111000000000000000000000000000000000000001111111011111110000000000000000000000000000000000000000111111011111100000000000000000000000000000000000000000011111011111000000000000000000000000000000000000000000001111011110000000000000000000000000000000000000000000000111011100000000000000000000000000000000000000000000000011011000000000000000000000000000000000000000000000000001010000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000","s":[27,26],"e":[53,53],"l":2,"cs":10,"hl":14};{"n":"Main Level 10","h":"000000000000000000000000000000000000000000000000000000001111111111111111111111111111111001111111111111100000000111111111111111111111111111110000111111111111000000000000000000011111111000000000000000000000000000000000000000111111101111110000000000000000000000000000000000000000011111110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000001011000000000000000111111111110000111111111000000000000001100000000000001111110111111000111111110000000000000000011111111111111100000000011110000000000000000000000000001111111111111000000000001111000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000011100011100000111000000000000000000010000000000000000111100011110000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111110000000000000000000000000000000000000000000000001111110000000000000001100111111111111111110111111100000000000000000000000000110011111111111111110111111000000000000000000000000000011000000000000000000000000000011111000000000000000000001100000000000000000000000000111110000000011110000000000000000000000000000000000011111100000000111100000000000111111111100000000000000111111000000000000000000000000011111111000000000111111111100000000000000000000000000000000000000000000111111111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000001000000000000000000000000000000011111110000000000000000000000000000000000000011111000111111111000000000000000000000000000000000000111110000000000011111111111000000000000000000000000001111100000000000001111111111100000000000000000000000011111000000000000000000000000000000000000000000000000111100000111111100000111111111111000000000000000000001111000001111111000000111111111111100000000000000000000000000000000000000000000000000000000000111110000000011110000000000000000000000000000011111001111100000000111100000000000000000000000000000001111100000000000000000000000000000000000001111111110000000000000000000001110000000000000000100011111111100000000000000000000011100000000011111111111111111100000000001000000000000000000000000111111111111111111000000000000000000000000000000000000000000000000000000000010000000000000000000000000000011111111111111000000100000000000000000000000000000000111111111111111000000000000000000111111100000000000000000000000000001111111000011100001111111110000000000000000000000000000111110000001110000000000000000000000001111111111111110000000011100000000011111111100000000011111111111111111000000001110000000001111111110000001111111111111111111000000000001111111100000000000000011111111111111111111000001010001111111110000000000","v":"000000000000000000000000000000000000000000000000000000001000000000000000000000000000000101000000000000010000001100000000000000000000000000001101100000000000110000001100000000010000000100000000001101100000000000110000001100100000001000001100000000001101100000000000110000001100110000000000001100000000001101100000000000110000001100110000000000001100000000001101100000000000110000001100110000000000001100000000001101100000000000110000010100110000000000001100000000001101100000000000110000011010010000000000001000000000000101000000000100110000011011000000000000000000001100000001100000001100110000011011010000000000000010001100010000100000001100110000011011011000000000000110001100011000000000001100110000011011011000000000000110000000011000000000001100110000011101011000000000000100000000001000100100001100110000011110011000000000000000000000000000111100001100110000011110011000000000000000001100000000111100001100110000011110011000000000000000001100000000111100001100110000011110011000000000000000001100000000111000000100110000011110011000000000000000001100000000110000001100110000011111001100000000000000000000000010110000001100110000011111100110000000000000001100000110110000001100110000011111110010000000000000001100000110100000101100110000011111111000000000000000001100000110000001101100100001011111111000000000000000001100000100000011101100000011011111111100000000010000001100000000000111101100000011011111111110000000110000001000000000010111101100000011011111111110000000110000001100000000110111101100000011011111111110000000110000001100000000110111101100000011011111111110000000110000001100000000110111011100000011011111111110000000110000001100000000110110111100000011011111111110000000100000000100000000110110111100000011011111111100000100000000000000000000110110111100000011011111111000001100000000010000000000010110111100000011011111110000011100000000011000000000000110111100000011011111100000111100000000011000000000000110111100000011011111000010111000000010011100000000000010111100000011011110000110110000000110011000000000000000111100000011011110000110110000000110011000000000000000111000001011011100001110110000000110011000000000010000010000011011011000011110110000000110011000000000011000000000011011011000011110110000000110010000000001011000000000011011010001011110110000000000000000000011011000000000011011000011011110100000000000000000010011011001100000011011000011011110000000000000000000110011011001100000011011000011011110000000000000000000110000011001100000011011000011011100000000000000100000000000011001100000011011000011011000000000000000000000000000011001000000001011000011011000000000000001000000100010001000000000000011000011011000000000000001100001100011000000000000000011000011010000000000000000100001110001000000010000000001000011000000000000000000000001111000000000011000000000000010000000000000000000100001111001000000001000000000000000000000000000000000000000000000000000000000000000","s":[26,14],"e":[27,50],"l":5,"cs":10,"hl":10}'.split(";"),
storageRecordPrefix="DNTGBJS636FR",storageMainChallengeKey="DNTGBJS636FFIN",storageLevelPrefix="DNTGBJS636FL",playerColor="rgb(18, 125, 255)",endPosColor="rgba(0, 255, 0, 0.5)",visitedColors=["rgba(245, 177, 177, 0.4)","rgba(245, 142, 142, 0.5)","rgba(245, 100, 100, 0.6)","rgba(245, 52, 52, 0.7)","rgba(245, 7, 7, 0.8)"],makerColor="rgba(255, 0, 255, 0.5)",startPosColor="rgba(255, 165, 0, 0.5)",visBordersColor="rgb(0, 255, 0)",bordersColor="rgb(0, 0, 0)",fontColor="rgb(0, 0, 255)",crModeOnOffFlag=
document.getElementById("crModeOnOff"),helpContent=document.getElementById("helpContent"),gameAndEdit=document.getElementById("gameAndEdit"),loadGameContent=document.getElementById("loadGameContent"),recordsContent=document.getElementById("recordsContent"),genJson=document.getElementById("genJson"),levelName=document.getElementById("levelName"),visibleArea=document.getElementById("visibleArea"),playerLife=document.getElementById("playerLife"),isFiedAcceptsKeys=!0,isAlert=!1,gs=new GameState;
window.addEventListener("keydown",keydown,!1);window.addEventListener("keyup",keyup,!1);crModeOnOffFlag.addEventListener("click",crModeOnOff);document.getElementById("help").addEventListener("click",help);document.getElementById("records").addEventListener("click",records);document.getElementById("loadJsonFromBrowser").addEventListener("click",loadJsonFromBrowserGame);document.getElementById("loadJsonFromBrowserEdit").addEventListener("click",loadJsonFromBrowserEdit);
document.getElementById("genSmallLevel").addEventListener("click",genSmallLevel);document.getElementById("genMediumLevel").addEventListener("click",genMediumLevel);document.getElementById("genLargeLevel").addEventListener("click",genLargeLevel);document.getElementById("crSmallLevel").addEventListener("click",crSmallLevel);document.getElementById("crMediumLevel").addEventListener("click",crMediumLevel);document.getElementById("crLargeLevel").addEventListener("click",crLargeLevel);
document.getElementById("edCurrLevel").addEventListener("click",edCurrLevel);document.getElementById("tryEdLevel").addEventListener("click",tryEdLevel);document.getElementById("showLevelJson").addEventListener("click",showLevelJson);document.getElementById("loadLevelJsonEd").addEventListener("click",loadLevelJsonEd);document.getElementById("loadLevelJson").addEventListener("click",loadLevelJson);genJson.addEventListener("blur",genJsonLostFocus);genJson.addEventListener("focus",controlGotFocus);
levelName.addEventListener("change",levelNameChanged);levelName.addEventListener("blur",controlLostFocus);levelName.addEventListener("focus",controlGotFocus);visibleArea.addEventListener("change",visibleAreaChanged);visibleArea.addEventListener("blur",controlLostFocus);visibleArea.addEventListener("focus",controlGotFocus);playerLife.addEventListener("change",playerLifeChanged);playerLife.addEventListener("blur",controlLostFocus);playerLife.addEventListener("focus",controlGotFocus);
document.getElementById("saveToBrowser").addEventListener("click",saveToBrowser);(function(){for(var b='<li><a onclick="playMainGame()" href="#">Play Main Game</a></li>',a=document.getElementById("genPlayMenu"),c=0;c<mainLevels.length;c++)b+=createMenuEntry(c,JSON.parse(mainLevels[c]).n);a.innerHTML=b})();function createMenuEntry(b,a){return'<li><a href="#" onclick="loadMainLevelFromMenu('+b+')">'+a+"</a></li>"}
function GameState(){this.keyMap={37:"left",38:"up",39:"right",40:"down",87:"upBorderW",65:"LeftBorderA",83:"downBorderS",68:"rightBorderD",90:"startPositionZ",88:"endPositionX",80:"generateLayerDataP"};this.pressedKeys={left:!1,right:!1,up:!1,down:!1,upBorderW:!1,LeftBorderA:!1,downBorderS:!1,rightBorderD:!1,startPositionZ:!1,endPositionX:!1};this.cellSize;this.cellSizeForDrawing;this.cellsAmount;this.visibleZone;this.borders=[];this.player;this.currentLevel;this.currentMode=0;this.currentMainLevelNumber;
this.mainGameFinishStats=[]}function loadJsonFromBrowserEdit(){loadJsonFromBrowser(3)}function loadJsonFromBrowserGame(){loadJsonFromBrowser(2)}function help(){stopGame();helpContent.style.display="block";gameAndEdit.style.display="none";loadGameContent.style.display="none";recordsContent.style.display="none"}
function records(){stopGame();helpContent.style.display="none";gameAndEdit.style.display="none";loadGameContent.style.display="none";recordsContent.style.display="block";for(var b=function(a){return"<p><b>Name: </b>"+a.levelName+"<b> Life: </b>"+a.playerLife+"<b> Time: </b>"+a.timeElapsedString+"</p>"},a=[],c=0;c<localStorage.length;c++){var e=localStorage.key(c);e.includes(storageRecordPrefix)&&a.push(JSON.parse(localStorage.getItem(e)))}var d=/\D/g;a.sort(function(a,b){return parseInt(a.levelName.replace(d,
""),10)-parseInt(b.levelName.replace(d,""),10)});(c=localStorage.getItem(storageMainChallengeKey))&&a.push(JSON.parse(c));if(0===a.length)recordsContent.innerHTML="<h1>No records</h1>";else{c="";for(e=0;e<a.length;e++)c+=b(a[e]);recordsContent.innerHTML="<h1>Records</h1>"+c}}
function loadSelectedLevelFromBrowser(b,a){var c=localStorage.getItem(b);c=JSON.parse(JSON.parse(c).levelJson);stopGame();showGameAndEditArea();gs.currentMode=parseInt(a);2===gs.currentMode?(gs.currentLevel=c,gs.borders=makeBordersAndSetCellParameters(gs.currentLevel),gs.player=new Player(gs.currentLevel)):(gs.currentLevel=c,gs.borders=makeBordersAndSetCellParameters(gs.currentLevel),gs.player=new Maker(gs.currentLevel),setControlsAfterLoadingLevel());runAnimation()}
function deleteSelectedLevelFromBrowser(b){localStorage.removeItem(b);b=document.getElementById("p"+b);b.parentNode.removeChild(b)}
function loadJsonFromBrowser(b){stopGame();helpContent.style.display="none";gameAndEdit.style.display="none";loadGameContent.style.display="block";recordsContent.style.display="none";for(var a=function(a,c){var d=JSON.parse(a.levelJson);return'<p id="p'+c+'" ><b>Name: </b>'+d.n+"<b> Version: </b>"+a.version+' <a href=# id="link'+(c+'" onclick="loadSelectedLevelFromBrowser(\''+c+"',"+b+')">Load</a> <a href=# id="del')+(c+'" onclick="deleteSelectedLevelFromBrowser(\''+c+"')\">Delete</a></p>")},c=[],
e=0;e<localStorage.length;e++){var d=localStorage.key(e);d.includes(storageLevelPrefix)&&c.push([JSON.parse(localStorage.getItem(d)),d])}c.sort(function(a,b){return a[0].version-b[0].version});if(0===c.length)loadGameContent.innerHTML="<h1>No Saved Levels</h1>";else{e="";for(d=0;d<c.length;d++)e+=a(c[d][0],c[d][1]);loadGameContent.innerHTML="<h1>Levels</h1>"+e}}
function showGameAndEditArea(){stopGame();helpContent.style.display="none";gameAndEdit.style.display="initial";loadGameContent.style.display="none";recordsContent.style.display="none"}function genJsonLostFocus(){genJson.value="";isFiedAcceptsKeys=!0}function controlGotFocus(){isFiedAcceptsKeys=!1}function controlLostFocus(){isFiedAcceptsKeys=!0}function setControls(){levelName.value=genNameForLevel();visibleArea.value=5;playerLife.value=100}
function setControlsAfterLoadingLevel(){levelName.value=gs.currentLevel.n;visibleArea.value=gs.currentLevel.hl;visibleArea.max=gs.cellsAmount-1;playerLife.value=gs.currentLevel.l}function levelNameChanged(){""===levelName.value&&(levelName.value=genNameForLevel());gs.currentLevel.n=levelName.value}function genNameForLevel(){return"New Level"}function visibleAreaChanged(){var b=parseInt(visibleArea.value);gs.currentLevel.hl=b;gs.visibleZone=b}
function playerLifeChanged(){var b=parseInt(playerLife.value);gs.currentLevel.l=b;gs.player.life=b}function StorageLevelValue(b,a,c){this.levelName=b;this.version=a;this.levelJson=c}function saveToBrowser(){var b=constructLevelJson();b?(b=new StorageLevelValue(b.n,(new Date).getTime(),JSON.stringify(b)),localStorage.setItem(storageLevelPrefix+b.version,JSON.stringify(b)),alert("Data saved to browser.")):alert("Nothing to export.")}
function constructLevelJson(){var b;return gs.player?b=gs.player.isRealPlayer?gs.currentLevel:gs.player.makeEditedLayer(gs.player):!1}function showLevelJson(){var b=constructLevelJson();b?(alert("Level JSON is ready. Copy it from JSON field and save it somewhere."),genJson.value=JSON.stringify(b)):alert("Nothing to export")}
function loadLevelJsonEd(){showGameAndEditArea();var b=prompt("Paste level's JSON here","");try{var a=JSON.parse(b);if(!checkLoadedJson(a))throw Error("Wrong JSON");stopGame();gs.currentMode=3;gs.currentLevel=a;gs.borders=makeBordersAndSetCellParameters(gs.currentLevel);gs.player=new Maker(gs.currentLevel);setControlsAfterLoadingLevel();runAnimation()}catch(c){alert("JSON is incorrect. Try arain, please.")}}
function loadLevelJson(){showGameAndEditArea();var b=prompt("Paste level's JSON here","");try{var a=JSON.parse(b);if(!checkLoadedJson(a))throw Error("Wrong JSON");stopGame();gs.currentMode=2;gs.currentLevel=a;gs.borders=makeBordersAndSetCellParameters(gs.currentLevel);gs.player=new Player(gs.currentLevel);runAnimation()}catch(c){alert("JSON is incorrect. Try arain, please.")}}
function checkLoadedJson(b){return b&&"object"===typeof b&&b.n&&"string"===typeof b.n&&b.h&&"string"===typeof b.h&&b.v&&"string"===typeof b.v&&b.h.length===b.v.length&&b.s&&"object"===typeof b.s&&2===b.s.length&&b.e&&"object"===typeof b.e&&2===b.s.length&&b.l&&"number"===typeof b.l&&b.cs&&"number"===typeof b.cs&&(10===b.cs||15===b.cs||20===b.cs)&&b.hl&&"number"===typeof b.hl?!0:!1}
function crModeOnOff(){stopGame();showGameAndEditArea();var b=document.getElementById("createTools"),a=document.getElementById("mainMenu"),c=document.getElementById("creatorModeMenu");crModeOnOffFlag.checked?(b.style.display="initial",a.style.display="none",c.style.display="initial",setControls()):(b.style.display="none",a.style.display="initial",c.style.display="none")}function draw(){ctcl();drawField();gs.player.draw(gs.player)}function update(){gs.player.checkState(gs.player)}
function loop(b){gs.player&&gs.player.isRealPlayer&&(gs.player.timeEnd=b);0!==gs.currentMode?(isAlert?ctcl():(update(),draw()),window.requestAnimationFrame(loop)):(ctcl(),gs=new GameState)}function keydown(b){gs.pressedKeys[gs.keyMap[b.keyCode]]=!0}function keyup(b){gs.pressedKeys[gs.keyMap[b.keyCode]]=!1}
function getTimeElapsedString(b){var a=parseInt(b%1E3/100),c=Math.floor(b/1E3%60),e=Math.floor(b/6E4%60);b=Math.floor(b/36E5%24);return(10>b?"0"+b:b)+":"+(10>e?"0"+e:e)+":"+(10>c?"0"+c:c)+"."+a}
var Level=function(b,a,c,e,d,f,g,h){this.n=b;this.h=a;this.v=c;this.s=e;this.e=d;this.l=f;this.cs=g;this.hl=h},Player=function(b){this.isRealPlayer=!0;this.col=b.s[0];this.row=b.s[1];this.colNew=b.s[0];this.rowNew=b.s[1];this.step=1;this.life=b.l;this.bonusAmount=b.b;this.endPositionForLevel=[b.e[0],b.e[1]];this.timeStart=performance.now();this.timeEnd;this.timeElapsed;this.timeElapsedString="0:00:00";this.draw=function(a){ctx.fillStyle=playerColor;ctx.fillRect(a.col*gs.cellSize+2,a.row*gs.cellSize+
2,gs.cellSize-3,gs.cellSize-3);ctxData.font="16px Arial";ctxData.fillStyle=fontColor;ctxData.fillText(b.n+" | Life: "+a.life+" | Time: "+a.timeElapsedString,6,heightD-5);ctx.fillStyle=endPosColor;ctx.fillRect(a.endPositionForLevel[0]*gs.cellSize+1,a.endPositionForLevel[1]*gs.cellSize+1,gs.cellSize-2,gs.cellSize-2)};this.checkState=function(a){if(isFiedAcceptsKeys){if(gs.pressedKeys.left){var b;(b=0===a.col)||(b=1===gs.borders[a.row][a.col].valV?!0:!1);b||(a.colNew=a.col-a.step,gs.pressedKeys.left=
!1)}gs.pressedKeys.right&&((b=a.col===gs.cellsAmount-1)||(b=1===gs.borders[a.row][a.col+1].valV?!0:!1),b||(a.colNew=a.col+a.step,gs.pressedKeys.right=!1));gs.pressedKeys.up&&((b=0===a.row)||(b=1===gs.borders[a.row][a.col].valH?!0:!1),b||(a.rowNew=a.row-a.step,gs.pressedKeys.up=!1));gs.pressedKeys.down&&((b=a.row===gs.cellsAmount-1)||(b=1===gs.borders[a.row+1][a.col].valH?!0:!1),b||(a.rowNew=a.row+a.step,gs.pressedKeys.down=!1))}0===gs.borders[a.row][a.col].visited&&gs.borders[a.row][a.col].visited++;
a.col===a.colNew&&a.row===a.rowNew||!gs.borders[a.rowNew][a.colNew].visited||(a.life-=gs.borders[a.rowNew][a.colNew].visited,5>=gs.borders[a.rowNew][a.colNew].visited&&gs.borders[a.rowNew][a.colNew].visited++);a.col=a.colNew;a.row=a.rowNew;b=a.endPositionForLevel[0]===a.col&&a.endPositionForLevel[1]===a.row?!0:!1;b&&(1===gs.currentMode&&mainGameFinishedLevelWin(),2===gs.currentMode&&generatedGameWin(),3===gs.currentMode&&tryGameWin());0>=a.life?(a.life=0,b=!0):b=!1;b&&(1===gs.currentMode&&mainGameFinishedLevelFail(),
2===gs.currentMode&&generatedGameLoose(),3===gs.currentMode&&tryGameLoose());a.timeElapsedString=getTimeElapsedString(a.timeElapsed);a.timeElapsed=a.timeEnd-a.timeStart}},Maker=function(b){this.isRealPlayer=!1;this.col=b.s[0];this.row=b.s[1];this.colNew=b.s[0];this.rowNew=b.s[1];this.step=1;this.startPositionForLevel=[b.s[0],b.s[1]];this.endPositionForLevel=[b.e[0],b.e[1]];this.life=b.l;this.cellSize=b.cs;this.makeEditedLayer=function(a){for(var b=[],e=[],d=0;d<gs.cellsAmount;d++)for(var f=0;f<gs.cellsAmount;f++)b.push(gs.borders[d][f].valH),
e.push(gs.borders[d][f].valV);return new Level(gs.currentLevel.n,b.join(""),e.join(""),a.startPositionForLevel,a.endPositionForLevel,a.life,a.cellSize,gs.visibleZone)};this.draw=function(a){ctx.fillStyle=makerColor;ctx.fillRect(a.col*gs.cellSize,a.row*gs.cellSize,gs.cellSize,gs.cellSize);ctx.fillStyle=startPosColor;ctx.fillRect(a.startPositionForLevel[0]*gs.cellSize,a.startPositionForLevel[1]*gs.cellSize,gs.cellSize,gs.cellSize);ctx.fillStyle=endPosColor;ctx.fillRect(a.endPositionForLevel[0]*gs.cellSize,
a.endPositionForLevel[1]*gs.cellSize,gs.cellSize,gs.cellSize);ctx.strokeStyle=visBordersColor;ctx.setLineDash([5,3]);ctx.beginPath();ctx.rect((a.col-gs.visibleZone)*gs.cellSize,(a.row-gs.visibleZone)*gs.cellSize,(2*gs.visibleZone+1)*gs.cellSize,(2*gs.visibleZone+1)*gs.cellSize);ctx.stroke()};this.checkState=function(a){isFiedAcceptsKeys&&(gs.pressedKeys.left&&0!==a.col&&(a.colNew=a.col-a.step,gs.pressedKeys.left=!1),gs.pressedKeys.right&&a.col!==gs.cellsAmount-1&&(a.colNew=a.col+a.step,gs.pressedKeys.right=
!1),gs.pressedKeys.up&&0!==a.row&&(a.rowNew=a.row-a.step,gs.pressedKeys.up=!1),gs.pressedKeys.down&&a.row!==gs.cellsAmount-1&&(a.rowNew=a.row+a.step,gs.pressedKeys.down=!1),gs.pressedKeys.upBorderW&&(gs.borders[a.row][a.col].valH=1===gs.borders[a.row][a.col].valH?0:1,gs.pressedKeys.upBorderW=!1),gs.pressedKeys.LeftBorderA&&(gs.borders[a.row][a.col].valV=1===gs.borders[a.row][a.col].valV?0:1,gs.pressedKeys.LeftBorderA=!1),gs.pressedKeys.downBorderS&&(a.row+1<gs.cellsAmount&&(gs.borders[a.row+1][a.col].valH=
1===gs.borders[a.row+1][a.col].valH?0:1),gs.pressedKeys.downBorderS=!1),gs.pressedKeys.rightBorderD&&(a.col+1<gs.cellsAmount&&(gs.borders[a.row][a.col+1].valV=1===gs.borders[a.row][a.col+1].valV?0:1),gs.pressedKeys.rightBorderD=!1),gs.pressedKeys.startPositionZ&&(a.startPositionForLevel[0]=a.col,a.startPositionForLevel[1]=a.row,gs.pressedKeys.startPositionZ=!1),gs.pressedKeys.endPositionX&&(a.endPositionForLevel[0]=a.col,a.endPositionForLevel[1]=a.row,gs.pressedKeys.endPositionX=!1));a.col=a.colNew;
a.row=a.rowNew}},BorderInfo=function(b,a,c,e){this.valH=b;this.valV=a;this.x=c;this.y=e;this.visited=0};function makeBordersAndSetCellParameters(b){gs.cellSize=b.cs;gs.cellSizeForDrawing=gs.cellSize+gs.cellSize/20;gs.cellsAmount=fieldSize/gs.cellSize;gs.visibleZone=b.hl;for(var a=0,c=[],e=0;e<gs.cellsAmount;e++){c[e]=[];for(var d=0;d<gs.cellsAmount;d++)c[e].push(new BorderInfo(parseInt(b.h[a]),parseInt(b.v[a]),d*gs.cellSize,e*gs.cellSize)),a++}return c}
function generateMaze(b){for(var a=fieldSize/b,c=function(a,b){this.valV=this.valH=1;this.visited=!1;this.row=a;this.col=b},e=[],d=0;d<a;d++){e[d]=[];for(var f=0;f<a;f++)e[d].push(new c(d,f))}c=[];d=e[0][0];d.visited=!0;f=1;for(var g=[],h,k;f<a*a;)0<=d.row-1&&(e[d.row-1][d.col].visited||g.push([e[d.row-1][d.col],"U"])),0<=d.col-1&&(e[d.row][d.col-1].visited||g.push([e[d.row][d.col-1],"L"])),d.row+1<a&&(e[d.row+1][d.col].visited||g.push([e[d.row+1][d.col],"D"]),d.col+1<a&&(e[d.row][d.col+1].visited||
g.push([e[d.row][d.col+1],"R"]))),0===g.length?d=c.shift():(h=Math.round(Math.random()*(g.length-1)),k=g[h],h=k[0],"U"===k[1]&&(d.valH=0),"L"===k[1]&&(d.valV=0),"D"===k[1]&&(h.valH=0),"R"===k[1]&&(h.valV=0),c.unshift(d),d=h,d.visited=!0,f++,g.length=0);c=[];d=[];for(g=f=0;g<a;g++)for(h=0;h<a;h++)c[f]=e[g][h].valH,d[f]=e[g][h].valV,f++;return new Level("Generated Level",c.join(""),d.join(""),[0,0],[a-1,a-1],a,b,4)}
function generateEmptyMaze(b){for(var a=fieldSize/b,c=[],e=[],d=0;d<a;d++)for(var f=0;f<a;f++)e.push(0),c.push(0);return new Level(""!==levelName.value?levelName.value:genNameForLevel(),c.join(""),e.join(""),[0,0],[a-1,a-1],100,b,visibleArea.value)}function genSmallLevel(){showGameAndEditArea();generateNewLevel(20)}function genMediumLevel(){showGameAndEditArea();generateNewLevel(15)}function genLargeLevel(){showGameAndEditArea();generateNewLevel(10)}
function generateNewLevel(b){gs.currentMode=2;gs.currentLevel=generateMaze(b);gs.borders=makeBordersAndSetCellParameters(gs.currentLevel);gs.player=new Player(gs.currentLevel);runAnimation()}function crSmallLevel(){showGameAndEditArea();crNewLevel(20)}function crMediumLevel(){showGameAndEditArea();crNewLevel(15)}function crLargeLevel(){showGameAndEditArea();crNewLevel(10)}
function crNewLevel(b){gs.currentMode=3;gs.currentLevel=generateEmptyMaze(b);gs.borders=makeBordersAndSetCellParameters(gs.currentLevel);gs.player=new Maker(gs.currentLevel);levelName.value=genNameForLevel();visibleArea.value=5;visibleArea.max=gs.cellsAmount-1;playerLife.value=100;gs.visibleZone=parseInt(visibleArea.value);gs.player.life=parseInt(playerLife.value);runAnimation()}
function edCurrLevel(){3===gs.currentMode&&(gs.borders=makeBordersAndSetCellParameters(gs.currentLevel),gs.player=new Maker(gs.currentLevel),runAnimation())}function tryEdLevel(){gs.player&&!gs.player.isRealPlayer&&(gs.player.makeEditedLayer(gs.player),gs.currentLevel=gs.player.makeEditedLayer(gs.player),gs.borders=makeBordersAndSetCellParameters(gs.currentLevel),gs.player=new Player(gs.currentLevel),runAnimation())}
function tryLevelFinished(){gs.borders=makeBordersAndSetCellParameters(gs.currentLevel);gs.player=new Player(gs.currentLevel);runAnimation()}function runAnimation(){window.requestAnimationFrame(loop)}
function drawField(){for(var b=0;b<gs.cellsAmount;b++)for(var a=0;a<gs.cellsAmount;a++)if(b<=gs.player.row+gs.visibleZone&&b>=gs.player.row-gs.visibleZone&&a<=gs.player.col+gs.visibleZone&&a>=gs.player.col-gs.visibleZone||!gs.player.isRealPlayer)1===gs.borders[b][a].valV&&(ctx.fillStyle=bordersColor,ctx.fillRect(gs.borders[b][a].x,gs.borders[b][a].y,borderWidth,gs.cellSizeForDrawing)),b<gs.cellsAmount-gs.visibleZone&&b===gs.player.row+gs.visibleZone&&1===gs.borders[b+1][a].valH&&(ctx.fillStyle=bordersColor,
ctx.fillRect(gs.borders[b+1][a].x,gs.borders[b+1][a].y,gs.cellSizeForDrawing,borderWidth)),a<gs.cellsAmount-gs.visibleZone&&a===gs.player.col+gs.visibleZone&&1===gs.borders[b][a+1].valV&&(ctx.fillStyle=bordersColor,ctx.fillRect(gs.borders[b][a+1].x,gs.borders[b][a+1].y,borderWidth,gs.cellSizeForDrawing)),1===gs.borders[b][a].valH&&(ctx.fillStyle=bordersColor,ctx.fillRect(gs.borders[b][a].x,gs.borders[b][a].y,gs.cellSizeForDrawing,borderWidth)),0<gs.borders[b][a].visited&&(ctx.fillStyle=visitedColors[gs.borders[b][a].visited-
1],ctx.fillRect(gs.borders[b][a].x+2,gs.borders[b][a].y+2,gs.cellSize-3,gs.cellSize-3));ctx.fillStyle=bordersColor;ctx.fillRect(0,0,fieldSizeForDrawing,borderWidth);ctx.fillRect(0,0,borderWidth,fieldSizeForDrawing);ctx.fillRect(0,fieldSize,fieldSizeForDrawing,borderWidth);ctx.fillRect(fieldSize,0,borderWidth,fieldSizeForDrawing)}function playMainGame(){showGameAndEditArea();gs.currentMode=1;gs.currentMainLevelNumber=0;loadMainGameLevel(gs.currentMainLevelNumber)}
function loadMainLevelFromMenu(b){showGameAndEditArea();gs.currentMode=2;gs.currentMainLevelNumber=b;gs.currentLevel=JSON.parse(mainLevels[b]);gs.borders=makeBordersAndSetCellParameters(gs.currentLevel);gs.player=new Player(gs.currentLevel);runAnimation()}function loadMainGameLevel(b){gs.currentLevel=JSON.parse(mainLevels[b]);gs.borders=makeBordersAndSetCellParameters(gs.currentLevel);gs.player=new Player(gs.currentLevel);runAnimation()}
function StorageRecordValue(b,a,c,e){this.levelName=b;this.playerLife=a;this.timeElapsedString=c;this.timeElapsed=e}
function mainGameFinishedLevelWin(){var b=storageRecordPrefix+gs.currentLevel.n,a=localStorage.getItem(b),c=new StorageRecordValue(gs.currentLevel.n,gs.player.life,gs.player.timeElapsedString,gs.player.timeElapsed);gs.mainGameFinishStats.push(c);a?(a=JSON.parse(a),c.playerLife>a.playerLife&&localStorage.setItem(b,JSON.stringify(c))):localStorage.setItem(b,JSON.stringify(c));gs.currentMainLevelNumber++;gs.currentMainLevelNumber>=mainLevels.length?(saveMainGameStats(),showMessageWithTimeout(function(){alert("You Win!"+
dataForAlert()+" Main Challenge Finished!");isAlert=!1;stopGame()})):showMessageWithTimeout(function(){alert("You Win!"+dataForAlert());isAlert=!1;loadMainGameLevel(gs.currentMainLevelNumber)})}
function saveMainGameStats(){var b=gs.mainGameFinishStats.reduce(function(a,b){a.playerLife+=b.playerLife;a.timeElapsed+=b.timeElapsed;return a},{levelName:"",playerLife:0,timeElapsedString:"",timeElapsed:0});b.levelName="Complete Main Challenge";b.timeElapsedString=getTimeElapsedString(b.timeElapsed);var a=localStorage.getItem(storageMainChallengeKey);a?(a=JSON.parse(a),b.playerLife>a.playerLife&&localStorage.setItem(storageMainChallengeKey,JSON.stringify(b))):localStorage.setItem(storageMainChallengeKey,
JSON.stringify(b))}function dataForAlert(){return" Player's life: "+gs.player.life+". Elapsed time: "+gs.player.timeElapsedString+"."}function ctcl(){ctx.clearRect(0,0,width,height);ctxData.clearRect(0,0,widthD,heightD)}function showMessageWithTimeout(b){isAlert=!0;ctcl();setTimeout(b,20)}function mainGameFinishedLevelFail(){showMessageWithTimeout(function(){alert("You Lose! Loading the level again..."+dataForAlert());isAlert=!1;loadMainGameLevel(gs.currentMainLevelNumber)})}
function generatedGameWin(){showMessageWithTimeout(function(){alert("You Win!"+dataForAlert());isAlert=!1;stopGame()})}function generatedGameLoose(){showMessageWithTimeout(function(){alert("You Lose!"+dataForAlert());isAlert=!1;stopGame()})}function tryGameWin(){showMessageWithTimeout(function(){alert("You Win! Loading the same level again."+dataForAlert());isAlert=!1;tryLevelFinished()})}
function tryGameLoose(){showMessageWithTimeout(function(){alert("You Lose! Loading the same level again."+dataForAlert());isAlert=!1;tryLevelFinished()})}function stopGame(){gs.currentMode=0};