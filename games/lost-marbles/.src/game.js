!function(t){function e(r){if(i[r])return i[r].exports;var n=i[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var i={};e.m=t,e.c=i,e.d=function(t,i,r){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,i){"use strict";function r(t){t.forEach(function(e){e.t+=.1;var i=e.type===q.LINEAR?e.t:e.t<.5?e.t:1-e.t;if(e.t>=1){switch(e.type){case q.LINEAR:e.item.x=e.to.x,e.item.y=e.to.y;break;case q.BUMP:e.item.x=e.from.x,e.item.y=e.from.y}var r=t.indexOf(e);t.splice(r,1)}else e.item.x=e.from.x+(e.to.x-e.from.x)*i,e.item.y=e.from.y+(e.to.y-e.from.y)*i})}function n(t,e,i){for(var r=new X(t,e,i),n=0;n<t;n++)r.set(n,0,1),r.set(n,e-1,1);for(var s=0;s<e;s++)r.set(0,s,1),r.set(t-1,s,1);return r}function s(t){for(var e=0,i=t;e<i.length;e++){var r=i[e];if(r.energy*=.9,r.energy<=.01){var n=t.indexOf(r);t.splice(n,1)}else r.x+=r.vx,r.y-=r.vy}}function a(t,e){e.forEach(function(e){var i=0===e.brightness?1:Math.min(1,e.energy);t.fillStyle="rgba("+e.brightness+","+e.brightness+","+e.brightness+","+i+")";var r=0===e.brightness?e.size:e.size-i*e.size;e.vy-=.04,t.beginPath(),t.arc(e.x,e.y,r,0,2*Math.PI),t.fill()})}function o(){return j++}function h(t){var e=B[t];return e||(e=[],B[t]=e),e}function l(t,e,i){i.entity=t,h(e)[t]=i}function c(t,e){return h(e)[t]}function f(t){for(var e in B)B.hasOwnProperty(e)&&delete h(e)[t]}function y(){B={}}function u(t,e){var i=nt[t];i||(i=[],nt[t]=i),i.push(e)}function v(t,e){var i=nt[t];i&&i.forEach(function(i){return i(t,e)})}function x(t,e,i,r,n,s){var a=e.split(/\s/),o=i,h=r,l=t.measureText(" ").width;a.forEach(function(e){var r=t.measureText(e);o+r.width>i+n&&(o=i,h+=s),t.strokeText(e,o,h),t.fillText(e,o,h),o+=r.width+l})}function d(t,e,i){var r=t.measureText(e),n=(t.canvas.width-r.width)/2;t.strokeText(e,n,i),t.fillText(e,n,i)}function m(t,e){return V.dist(t,e)<Et}function p(t,e){if(0!==z({x:t,y:e}))return!1;var i=o();return l(i,Bt,new st(0,0,Et,1)),l(i,Vt,{event:"kill"}),l(i,Dt,{x:t,y:e}),l(i,Kt,{r:1.5}),!0}function w(t,e){p(t,e),p(t-Et,e)&&p(t-2*Et,e),p(t+Et,e)&&p(t+2*Et,e),p(t,e-Et)&&p(t,e-2*Et),p(t,e+Et)&&p(t,e+2*Et)}function g(t){ut=!1,Xt=0,Ot=H[t],Wt=n(Ot.width,Ot.height,Et),Ct=new Y(Ot.width,Ot.height,Et,133*yt%360),It.x=Ot.playerX*Et,It.y=Ot.playerY*Et;for(var e=0;e<Ot.walls.length/2;e++)Wt.set(Ot.walls[2*e],Ot.walls[2*e+1],1);return y(),Ot.items.switches&&Ot.items.switches.forEach(function(t){var e=o();l(e,Bt,new ht(0,0,Et)),l(e,ie,{}),l(e,Dt,{x:t.x*Et,y:t.y*Et})}),Ot.items.faces&&Ot.items.faces.forEach(function(t){var e=o();l(e,Bt,new lt(0,0,Et)),l(e,Dt,{x:t.x*Et,y:t.y*Et})}),Ot.items.boxes&&Ot.items.boxes.forEach(function(t){var e=o();l(e,Bt,new K(0,0,Et)),l(e,Vt,{event:"slide"}),l(e,ee,{}),l(e,Dt,{x:t.x*Et,y:t.y*Et})}),Ot.items.exits&&Ot.items.exits.forEach(function(t){Wt.set(t.x,t.y,0);var e=o(),i=t.x===Ot.width-1?"right":"down";l(e,Bt,new at(t.x*Et,t.y*Et,Et,i))}),Ot.items.ghosts&&Ot.items.ghosts.forEach(function(t){var e=o(),i=new G(0,0,0,1,"#fff","#000");l(e,Bt,i),l(e,Qt,{period:.005+.004*Math.random()}),l(e,Vt,{event:"kill"}),l(e,Dt,{x:t.x*Et,y:t.y*Et,facing:t.facing}),l(e,Zt,{pattern:"scatter"})}),Ot.items.bombs&&Ot.items.bombs.forEach(function(t){var e=o();l(e,Bt,new it(0,0,Et)),l(e,Vt,{event:"slide"}),l(e,Dt,{x:t.x*Et,y:t.y*Et}),l(e,Jt,{ttl:5,entity:e})}),Ot.items.marbles&&Ot.items.marbles.forEach(function(t){var e=o(),i=new Q(0,0,Et);l(e,Dt,{x:t.x*Et,y:t.y*Et}),l(e,Bt,i),l(e,te,{}),l(e,Vt,{event:"pickup"})}),Ot.items.levers&&Ot.items.levers.forEach(function(t){var e=o(),i=new _(0,0,1,Et,!1);l(e,Dt,{x:t.x*Et,y:t.y*Et,facing:-1,on:!1,inverted:t.inverted||!1}),l(e,Bt,i),l(e,Vt,{event:"toggle"}),l(e,_t,{period:400,cutoff:200,on:!1}),l(e,ae,{entity:e})}),Ot.items.doors&&Ot.items.doors.forEach(function(t){var e=o();l(e,Bt,new Z(0,0,Et,t.type,t.lockType)),l(e,Vt,{event:"block"}),l(e,Dt,{x:t.x*Et,y:t.y*Et}),l(e,$t,{entity:e})}),Ot.items.spikes&&Ot.items.spikes.forEach(function(t){var e=o();l(e,Bt,new et(0,0,Et)),l(e,Vt,{event:"slice"}),l(e,Dt,{x:t.x*Et,y:t.y*Et})}),Ot.items.saws&&Ot.items.saws.forEach(function(t){var e=o();l(e,Bt,new tt(0,0,Et)),l(e,Vt,{event:"slice"}),l(e,Dt,{x:t.x1*Et,y:t.y1*Et}),l(e,re,{}),l(e,oe,{x1:t.x1*Et,y1:t.y1*Et,x2:t.x2*Et,y2:t.y2*Et,steps:Math.abs(t.x2-t.x1+t.y2-t.y1),delta:1,current:0})}),Ot.items.eyes&&Ot.items.eyes.forEach(function(t){var e=o();l(e,Bt,new $(0,0,Et,It)),l(e,Vt,{event:"slide"}),l(e,Dt,{x:t.x*Et,y:t.y*Et}),l(e,ne,{})}),Ot.items.mouths&&Ot.items.mouths.forEach(function(t){var e=o();l(e,Bt,new rt(0,0,Et)),l(e,Vt,{event:"slide"}),l(e,Dt,{x:t.x*Et,y:t.y*Et}),l(e,se,{})}),Ot.events&&Ot.events.forEach(function(t){0===t.turn&&L(t)}),[Wt,Ct]}function b(t,e,i){switch(e){case Tt.LEFT:return{x:t.x-i,y:t.y};case Tt.UP:return{x:t.x,y:t.y-i};case Tt.RIGHT:return{x:t.x+i,y:t.y};case Tt.DOWN:return{x:t.x,y:t.y+i};default:return t}}function S(t,e,i,r){r=r||q.LINEAR,Nt=!0,Lt.push({type:r,item:t,from:{x:t.x,y:t.y},to:b(t,e,i),t:0})}function z(t){var e=t.x/Et|0,i=t.y/Et|0;return e<0||i<0||e>=Wt.width||i>=Wt.height?-1:Wt.get(e,i)}function k(t){Rt.push({x:t.x+.5*Et,y:t.y+.75*Et,vx:0,vy:.5*Math.random(),energy:1,size:3,brightness:255}),Rt.push({x:.5*Et*Math.random()+t.x+.25*Et,y:t.y+.75*Et,vx:0,vy:.5*Math.random(),energy:1,size:3,brightness:255}),Rt.push({x:.5*Et*Math.random()+t.x+.25*Et,y:t.y+.75*Et,vx:0,vy:.5*Math.random(),energy:1,size:3,brightness:255})}function M(t){Rt.push({x:t.x+.5*Et,y:t.y+.5*Et,vx:Math.random()-.5,vy:1.5+.25*Math.random(),energy:1,size:3,brightness:255})}function T(t){Rt.push({x:t.x+.5*Et,y:t.y+.75*Et,vx:3*Math.random()-1.5,vy:.5*Math.random()+1,energy:1,size:3,brightness:0}),Rt.push({x:.5*Et*Math.random()+t.x+.25*Et,y:t.y+.75*Et,vx:4*Math.random()-2,vy:.5*Math.random()+1,energy:1,size:2,brightness:0}),Rt.push({x:.5*Et*Math.random()+t.x+.25*Et,y:t.y+.75*Et,vx:4*Math.random()-2,vy:.5*Math.random()+1,energy:1,size:1,brightness:0})}function P(t,e,i){var r=!1;return h(Vt).forEach(function(n,s){if(s!==t){var a=c(s,Dt),o=m(e,a);if(o)switch(n.event){case"toggle":r=r||o;var l=c(s,Bt);l.facing=-l.facing;c(s,_t).on=-1===l.facing,zt.play();break;case"pickup":f(s),Mt.play(),O("I feel slightly better now."),jt++;break;case"block":c(s,Bt).open||(r=r||o);break;case"slice":c(s,Bt);T(b(It,Pt,.5*Et)),r=r||o;break;case"slide":var y=c(s,Dt),u=b(y,i,Et);if(0===z(u)){void 0===h(Vt).filter(function(t){return void 0!==t}).find(function(t){var e=c(t.entity,Dt),i=e&&m(u,e);if(i&&"block"===t.event){if(c(t.entity,Bt).open)return!1}return i})?S(y,i,Et,q.LINEAR):r=!0}else r=!0;break;case"kill":-1===t&&(v("restartLevel",{}),Pt=Tt.NONE),f(s)}}}),r}function E(){var t=b(It,Pt,Et),e=0===z(t);switch(Pt){case Tt.LEFT:Ft.facing=-1;break;case Tt.RIGHT:Ft.facing=1}if(e){P(-1,t,Pt)?(S(It,Pt,Et,q.BUMP),zt.play()):(k(It),S(It,Pt,Et,q.LINEAR),bt.play())}else k(b(It,Pt,.5*Et)),S(It,Pt,Et,q.BUMP),zt.play();Pt=Tt.NONE}function I(){h(Zt).forEach(function(t,e){var i=c(e,Dt),r=Tt.NONE,n=3*Math.random()|0,s=3*Math.random()|0;0===n&&(r=Tt.LEFT),1===n&&(r=Tt.RIGHT),2===n&&(0===s&&(r=Tt.UP),1===s&&(r=Tt.DOWN));var a=c(e,Bt);switch(r){case Tt.LEFT:a.facing=-1;break;case Tt.RIGHT:a.facing=1}var o=b(i,r,Et);0===z(o)?P(e,o,r)?(k(b(It,Pt,.5*Et)),S(i,r,Et,q.BUMP)):(k(i),S(i,r,Et,q.LINEAR),bt.play()):(k(b(It,Pt,.5*Et)),S(i,r,Et,q.BUMP))})}function R(){h(oe).forEach(function(t){var e=t.entity,i=c(e,Dt);t.current=t.current+t.delta,t.current!==t.steps&&0!==t.current||(t.delta=-t.delta);var r=t.x1+(t.x2-t.x1)*t.current/t.steps,n=t.y1+(t.y2-t.y1)*t.current/t.steps;Lt.push({type:q.LINEAR,item:i,from:{x:i.x,y:i.y},to:{x:r,y:n},t:0})})}function L(t){switch(t.event){case"speak":var e=o();l(e,Bt,new ot(It.x,It.y,Et,t.text)),l(e,he,{entity:e,energy:1,fadeAfterTurn:Xt+1})}}function N(){Ot.events&&Ot.events.forEach(function(t){t.turn===Xt&&L(t)})}function O(t){var e=o();l(e,Bt,new ot(It.x,It.y,Et,t)),l(e,he,{entity:e,energy:1,fadeAfterTurn:Xt+1})}function A(){Nt?(r(Lt),0===Lt.length&&(Nt=!1)):Pt!==Tt.NONE&&0===Yt&&(Xt++,Ht++,E(),I(),R(),N()),h(he).forEach(function(t){var e=t.entity,i=c(e,Bt);t.fadeAfterTurn<=Xt&&(t.energy-=.01),t.energy<.01&&f(e),i.x=Ft.x,i.y=Ft.y}),h(Dt).forEach(function(t){var e=c(t.entity,Bt);e.x=t.x,e.y=t.y}),h(Qt).forEach(function(t,e){c(e,Bt).z=Math.cos(U.time*t.period)}),h(_t).forEach(function(t,e){c(e,Bt).on=t.on&&U.time%t.period>t.cutoff}),Math.random()<.5&&h(Jt).forEach(function(t){var e=t,i=c(e.entity,Bt);i&&M({x:i.x+.3*Et,y:i.y-.3*Et})}),s(Rt),h(Kt).forEach(function(t,e){var i=c(e,Bt);t.r*=.92,i.r=t.r,t.r<.1&&f(e)});var t=0,e=h(ae).filter(function(t){return void 0!==t});e.forEach(function(e){c(e.entity,_t).on&&t++});var i=0,n=h(ie).filter(function(t){return void 0!==t});if(n.forEach(function(t){var e=c(t.entity,Dt),r=!1;h(ee).filter(function(t){return void 0!==t}).forEach(function(t){m(e,c(t.entity,Dt))&&(r=!0)}),r&&i++}),h($t).forEach(function(r){var s=r.entity,a=c(s,Bt),o=a.open;switch(a.lockType){case"invertedLever":a.open=t!==e.length;break;case"lever":a.open=t===e.length;break;case"switch":a.open=i===n.length;break;case"marble":var l=h(te).filter(function(t){return void 0!==t}).length;a.open=0===l}o!==a.open&&(a.open?"vertical"===a.type?(k({x:a.x,y:a.y-.7*Et}),k({x:a.x,y:a.y+.3*Et})):(k({x:a.x-.7*Et,y:a.y-.2*Et}),k({x:a.x+.3*Et,y:a.y-.2*Et})):(k({x:a.x,y:a.y-.1*Et}),k({x:a.x,y:a.y-.2*Et})))}),Ot.items.exits){Ot.items.exits.find(function(t){return m(It,{x:t.x*Et+.5*Et,y:t.y*Et+.5*Et})})&&v("nextLevelFadeOut",{});var a=!1;Ot.items.exits.forEach(function(t){h(Vt).forEach(function(e){m(c(e.entity,Dt),{x:t.x*Et,y:t.y*Et})&&(a=!0)})}),a&&O("I'm trapped! Press R key to restart room")}if(Ot.items.faces){var o=0;if(h(ne).forEach(function(t){var e=c(t.entity,Dt);m(e,{x:4*Et,y:3*Et})&&o++,m(e,{x:6*Et,y:3*Et})&&o++}),h(se).forEach(function(t){m(c(t.entity,Dt),{x:5*Et,y:5*Et})&&o++}),3===o){var l=0;h(Qt).forEach(function(t){f(t.entity),l++}),l>0&&O("Hooraay! I have restored my sanity! End of Game 🎉")}}h(re).forEach(function(t){m(c(t.entity,Bt),It)&&(T(It),v("restartLevel",{}))}),Ut+=Yt,Yt>.01&&Ut>=Math.PI?("next"===qt&&(yt=(yt+1)%H.length),g(yt),Ut=Math.PI,Yt=-Yt,Rt.length=0):Yt<0&&Ut<=0&&(Ut=0,Yt=0,qt="next",Pt=Tt.NONE),Ft.x=It.x,Ft.y=It.y}function W(){dt.clearRect(0,0,xt.width,xt.height),dt.save(),dt.translate(.5*(xt.width-Wt.width*Et)|0,.5*(xt.height-Wt.height*Et)|0),Ct.draw(dt),Wt.draw(dt),h(Bt).forEach(function(t){return t.draw(dt)}),Ft.draw(dt),a(dt,Rt),dt.restore(),dt.fillStyle="rgba(0,0,0,"+(.5*Math.cos(Ut+Math.PI)+.5)+")",dt.fillRect(0,0,xt.width,xt.height),dt.fillStyle="#fff",d(dt,"Level: "+(yt+1)+" - Move: "+Ht+" - Restarts: "+Gt+" - Marbles: "+jt,330);var t=dt.createRadialGradient(xt.width/2,xt.height/2,0,xt.width/2,xt.height/2,xt.width/2);t.addColorStop(0,"rgba(0,0,0,0)"),t.addColorStop(1,"rgba(0,0,0,.2)"),dt.fillStyle=t,dt.fillRect(0,0,xt.width,xt.height)}function C(){}function F(){for(var t=dt.createRadialGradient(xt.width/2,xt.height/2,0,xt.width/2,xt.height/2,xt.width/1.9),e=0;e<.99;e+=.2){var i=(e+.001*U.time)%.99,r=.03*U.time%360;t.addColorStop(i,"hsl("+r+",30%,40%)"),t.addColorStop(i+.01,"hsl("+r+",40%,35%)")}dt.fillStyle=t,dt.fillRect(0,0,xt.width,xt.height);for(var e=0;e<20;e++){dt.save();var n=(.5*U.time+100*e)%xt.width/1.5,s=.2*Math.PI*e,a=n/(xt.width/2),o=xt.width/2+Math.cos(s)*n,h=xt.height/2+Math.sin(s)*n;dt.translate(o,h),dt.scale(a,a),dt.rotate(.005*U.time%(2*Math.PI));(e%2==0?le:ce).draw(dt),dt.restore()}dt.fillStyle="#fff",dt.strokeStyle="#000",dt.lineWidth=5,dt.font="58px fantasy";var l=dt.measureText("Lost Marbles");dt.strokeText("Lost Marbles",(xt.width-l.width)/2,100),dt.fillText("Lost Marbles",(xt.width-l.width)/2,100),dt.strokeStyle="#000",dt.fillStyle="#fff",dt.font="17px cursive",dt.lineWidth=3,dt.miterLimit=5;x(dt,"You have lost your marbles. Travel into the strange mazes of your mind to collect your marbles and restore sanity!",175,170,xt.width-350,20),d(dt,"Press ENTER to start",290),dt.font="12px cursive",d(dt,"A game by Rene Hangstrup Møller",115),document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement||d(dt,"Press F to enter full screen",350)}function D(t){switch(U.update(t),ft){case ct.TITLE:C(),F();break;case ct.LEVEL:A(),W()}requestAnimationFrame(D)}Object.defineProperty(e,"__esModule",{value:!0});var q,U={time:0,lastTime:0,dt:0,update:function(t){this.dt=t-this.lastTime,this.lastTime=this.time,this.time=t}};!function(t){t[t.LINEAR=0]="LINEAR",t[t.BUMP=1]="BUMP"}(q||(q={}));var Y=function(){function t(t,e,i,r){this.width=t,this.height=e,this.checkerSize=i,this.hue=r}return t.prototype.draw=function(t){for(var e=0,i=0;i<this.height*this.checkerSize;i+=this.checkerSize)for(var r=0;r<this.width*this.checkerSize;r+=this.checkerSize)e=r/this.checkerSize%2^i/this.checkerSize%2,t.fillStyle=0===e?"hsl("+this.hue+",35%,55%)":"hsl("+this.hue+",40%,60%)",t.fillRect(r,i,this.checkerSize,this.checkerSize);var n=this.width*this.checkerSize,s=this.height*this.checkerSize,a=t.createRadialGradient(n/2,s/2,0,n/2,s/2,n/2);a.addColorStop(0,"rgba(0,0,0,0)"),a.addColorStop(1,"rgba(0,0,0,.5)"),t.fillStyle=a,t.fillRect(0,0,this.width*this.checkerSize,this.height*this.checkerSize)},t}(),X=function(){function t(t,e,i){this.width=t,this.height=e,this.tileSize=i,this.tiles=new Array(t*e);for(var r=0;r<t*e;r++)this.tiles[r]=0}return t.prototype.set=function(t,e,i){this.tiles[t+e*this.width]=i},t.prototype.get=function(t,e){return this.tiles[t+e*this.width]},t.prototype.draw=function(t){t.fillStyle="#000";for(var e=0;e<this.height;e++)for(var i=0;i<this.width;i++){var r=this.get(i,e);1===r&&t.fillRect(i*this.tileSize,e*this.tileSize,this.tileSize,this.tileSize)}},t}(),H=[{width:7,height:5,playerX:1,playerY:1,walls:[],items:{exits:[{x:6,y:2}]},events:[{turn:0,event:"speak",text:"Move with arrow keys or WASD or ZQSD"},{turn:3,event:"speak",text:"There is a passage over there to the right"}]},{width:5,height:8,playerX:1,playerY:2,walls:[1,5,3,5],items:{exits:[{x:2,y:7}],boxes:[{x:2,y:4}]},events:[{turn:0,event:"speak",text:"I need to push that box out of the way"}]},{width:8,height:7,playerX:1,playerY:1,walls:[2,1,2,2,2,3,3,3,5,3,6,3,5,5,3,5],items:{exits:[{x:4,y:6}],marbles:[{x:6,y:1,facing:0}],levers:[{x:6,y:5}],doors:[{x:4,y:3,type:"horizontal"},{x:4,y:5,type:"horizontal",lockType:"marble"}]},events:[{turn:0,event:"speak",text:"Oooh. One of my marbles is behind that door"}]},{width:8,height:6,playerX:1,playerY:1,walls:[1,3,2,3,2,4,1,4,4,3,5,3,6,3,4,4,5,4,6,4],items:{exits:[{x:3,y:5}],doors:[{x:3,y:3,type:"horizontal",lockType:"switch"}],boxes:[{x:4,y:2}],switches:[{x:5,y:2}]},events:[{turn:0,event:"speak",text:"You can always restart a room by pressing R"}]},{width:7,height:5,playerX:1,playerY:1,walls:[4,1,2,1,5,1,5,3],items:{exits:[{x:6,y:2}],boxes:[{x:3,y:2}],marbles:[{x:3,y:1}],doors:[{x:5,y:2,lockType:"marble"}]},events:[{turn:0,event:"speak",text:"I thought my mind would be more twisted than this"}]},{width:8,height:7,playerX:1,playerY:1,walls:[3,5,5,5,3,2,2,2,1,2,3,3,5,2],items:{exits:[{x:4,y:6}],switches:[{x:3,y:1}],boxes:[{x:4,y:3},{x:5,y:1}],levers:[{x:6,y:5}],doors:[{x:3,y:4},{x:4,y:5,type:"horizontal",lockType:"switch"}]},events:[]},{width:6,height:6,playerX:1,playerY:4,walls:[3,4],items:{boxes:[{x:3,y:3},{x:2,y:2},{x:2,y:1}],switches:[{x:1,y:1},{x:2,y:1},{x:3,y:1}],doors:[{x:4,y:4,lockType:"switch",type:"horizontal"}],exits:[{x:4,y:5}]}},{width:8,height:7,playerX:1,playerY:2,walls:[1,4,2,4,3,4,5,4,3,3,2,1,5,1,5,2],items:{exits:[{x:1,y:6}],switches:[],boxes:[],levers:[],doors:[{x:2,y:5,lockType:"marble"}],saws:[{x1:4,y1:3,x2:6,y2:3}],marbles:[{x:6,y:1}]},events:[]},{width:10,height:9,playerX:1,playerY:4,walls:[1,1,2,1,1,2,3,1,1,6,1,7,1,3,2,3,6,2,1,5,2,5,5,2,6,3,6,5,5,6,4,6,6,6,8,3,8,5],items:{boxes:[{x:3,y:4},{x:5,y:4},{x:3,y:3},{x:3,y:2}],switches:[{x:2,y:2},{x:2,y:7},{x:5,y:5},{x:4,y:7}],levers:[{x:5,y:3}],doors:[{x:8,y:4,lockType:"switch"},{x:6,y:4,lockType:"lever"}],exits:[{x:9,y:4}]}},{width:10,height:8,playerX:1,playerY:1,walls:[4,6,6,6,2,5,6,5,7,5,1,3,3,3,4,3,5,3,6,3,8,3],items:{marbles:[{x:7,y:6}],boxes:[{x:2,y:2}],switches:[{x:6,y:4}],levers:[{x:5,y:2}],doors:[{x:5,y:6,type:"horizontal",lockType:"marble"},{x:2,y:3,type:"horizontal",lockType:"invertedLever"},{x:7,y:3,type:"horizontal",lockType:"lever"},{x:8,y:5,type:"horizontal",lockType:"switch"}],exits:[{x:5,y:7}],eyes:[{x:4,y:-1},{x:6,y:-1}]},events:[{turn:0,event:"speak",text:"I always feel like somebody's watching me 🎵"}]},{width:9,height:6,playerX:1,playerY:1,walls:[5,4,7,4,4,1,2,3],items:{exits:[{x:6,y:5}],boxes:[{x:3,y:2},{x:3,y:3},{x:5,y:3}],switches:[{x:1,y:3}],marbles:[],doors:[{x:6,y:4,type:"horizontal",lockType:"switch"}]},events:[]},{width:12,height:9,playerX:1,playerY:1,walls:[],items:{ghosts:[{x:2,y:3,facing:1},{x:9,y:6,facing:0},{x:5,y:7,facing:-1}],faces:[{x:5,y:4}],eyes:[{x:5,y:2},{x:6,y:4}],mouths:[{x:4,y:4}]},events:[{turn:0,event:"speak",text:"That face does not look right"}]}],G=function(){function t(t,e,i,r,n,s){this.x=t,this.y=e,this.z=i,this.facing=r,this.baseColor=n,this.eyeColor=s}return t.prototype.draw=function(t){t.save(),t.translate(this.x+8,this.y+4-this.z),t.scale(.6,.6),t.fillStyle=this.baseColor,t.fillRect(0,15,30,25),t.beginPath(),t.arc(15,15,15,0,2*Math.PI),t.fill(),t.fillStyle=this.eyeColor,t.beginPath(),t.arc(10+5*this.facing,15,4,0,2*Math.PI),t.arc(20+5*this.facing,15,4,0,2*Math.PI),t.fill(),t.beginPath(),t.strokeStyle=this.baseColor,t.lineWidth=3,t.moveTo(5,25),t.lineTo(-5,15),t.lineTo(-5,10),t.moveTo(-5,15),t.lineTo(-10,15),t.moveTo(-5,15),t.lineTo(-10,10),t.moveTo(25,25),t.lineTo(35,15),t.lineTo(35,10),t.moveTo(35,15),t.lineTo(40,15),t.moveTo(35,15),t.lineTo(40,10),t.stroke(),t.restore()},t}(),j=0,B={},_=function(){function t(t,e,i,r,n){this.x=t,this.y=e,this.facing=i,this.tileSize=r,this.on=n}return t.prototype.draw=function(t){t.save(),t.translate(this.x+.5*this.tileSize,this.y+.75*this.tileSize),t.beginPath(),t.fillStyle="#000",t.arc(0,0,.3*this.tileSize,0,Math.PI,!0),t.fill(),t.lineWidth=2,t.beginPath();var e=-1===this.facing?.75*-Math.PI:.25*-Math.PI;t.moveTo(.1*this.tileSize*Math.cos(e),.1*this.tileSize*Math.sin(e)),t.lineTo(.5*this.tileSize*Math.cos(e),.5*this.tileSize*Math.sin(e)),t.stroke(),t.beginPath(),t.arc(.55*this.tileSize*Math.cos(e),.55*this.tileSize*Math.sin(e),3,0,2*Math.PI),t.fill(),this.on&&(t.fillStyle="#fff",t.beginPath(),t.arc(0,-5,2.5,0,2*Math.PI),t.fill()),t.restore()},t}(),V=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.add=function(e,i){return new t(e.x+i.x,e.y+i.y)},t.sub=function(e,i){return new t(e.x-i.x,e.y-i.y)},t.dot=function(t,e){return t.x*e.x+t.y*e.y},t.mul=function(e,i){return new t(e.x*i,e.y*i)},t.dist=function(t,e){var i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.mul=function(t){return this.x*=t,this.y*=t,this},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.normalize=function(){var t=this.length();return this.x/=t,this.y/=t,this},t}(),Q=function(){function t(t,e,i){this.x=t,this.y=e,this.tileSize=i}return t.prototype.draw=function(t){t.save(),t.translate(this.x+.5*this.tileSize,this.y+.5*this.tileSize),t.scale(.6,.6),t.beginPath(),t.fillStyle="#fff",t.arc(0,0,.25*this.tileSize,0,2*Math.PI),t.fill(),t.strokeStyle="#fff",t.lineWidth=2,t.beginPath();for(var e=0,i=0;e<2*Math.PI;e+=.25*Math.PI,i++){var r=e+2*Math.cos(4e-4*U.time),n=.35*this.tileSize,s=.4*this.tileSize+3*Math.cos(.01*(U.time+(i%2==0?1500:0)));t.moveTo(0+n*Math.cos(r),0+n*Math.sin(r)),t.lineTo(0+s*Math.cos(r),0+s*Math.sin(r))}t.stroke(),t.restore()},t}(),Z=function(){function t(t,e,i,r,n){void 0===r&&(r="vertical"),void 0===n&&(n="lever"),this.x=t,this.y=e,this.tileSize=i,this.type=r,this.lockType=n,this.open=!1}return t.prototype.draw=function(t){if(t.save(),t.translate(this.x,this.y),t.fillStyle="#000",this.open)"vertical"===this.type?(t.fillRect(.375*this.tileSize,0,.25*this.tileSize,.125*this.tileSize),t.fillRect(.375*this.tileSize,.875*this.tileSize,.25*this.tileSize,.125*this.tileSize)):(t.fillRect(0,.375*this.tileSize,.125*this.tileSize,.25*this.tileSize),t.fillRect(.875*this.tileSize,.375*this.tileSize,.125*this.tileSize,.25*this.tileSize));else{"vertical"===this.type?t.fillRect(.375*this.tileSize,0,.25*this.tileSize,this.tileSize):t.fillRect(0,.375*this.tileSize,this.tileSize,.25*this.tileSize),t.scale(.5,.5),t.translate(.5*this.tileSize,.5*this.tileSize),t.beginPath(),t.fillStyle="rgba(255,255,255,"+(.5+.1*Math.cos(.005*U.time))+")",t.arc(.5*this.tileSize,.5*this.tileSize,.5*this.tileSize,0,2*Math.PI),t.fill();var e=.125*this.tileSize,i=.5*this.tileSize;switch(this.lockType){case"key":t.fillStyle="#000";break;case"lever":case"invertedLever":t.strokeStyle="#000",t.lineWidth=3,t.beginPath(),t.moveTo(i+0*e,4.5*e),t.lineTo(i-1.5*e,1.95*e),t.stroke(),t.fillStyle="#000",t.beginPath(),t.arc(i,5.5*e,2.25*e,Math.PI,2*Math.PI),t.fill(),t.beginPath(),t.arc(i-1.5*e,1.95*e,.7*e,0,2*Math.PI),t.fill(),"lever"===this.lockType&&(t.fillStyle="#aaa",t.beginPath(),t.arc(i,4.4*e,.6*e,0,2*Math.PI),t.fill());break;case"switch":t.strokeStyle="#000",t.lineWidth=2,t.strokeRect(2.5*e,2.5*e,3*e,3*e);break;case"marble":t.fillStyle="#f00",t.beginPath(),t.lineWidth=3,t.arc(.5*this.tileSize,.5*this.tileSize,.15*this.tileSize,0,2*Math.PI),t.stroke(),t.lineWidth=2,t.beginPath();for(var r=0,n=0;r<2*Math.PI;r+=.25*Math.PI,n++){var s=r+2,a=.5*this.tileSize,o=.5*this.tileSize,h=.25*this.tileSize,l=.35*this.tileSize;t.moveTo(a+h*Math.cos(s),o+h*Math.sin(s)),t.lineTo(a+l*Math.cos(s),o+l*Math.sin(s))}t.stroke()}}t.restore()},t}(),J=i(1),K=function(){function t(t,e,i){this.x=t,this.y=e,this.tileSize=i}return t.prototype.draw=function(t){t.save(),t.translate(this.x,this.y),t.fillStyle="#000",t.fillRect(.125*this.tileSize,.125*this.tileSize,.75*this.tileSize,.75*this.tileSize),t.restore()},t}(),$=function(){function t(t,e,i,r){this.x=t,this.y=e,this.tileSize=i,this.player=r}return t.prototype.draw=function(t){var e=this.tileSize;t.save(),t.translate(this.x,this.y),t.fillStyle="#fff",t.beginPath(),t.arc(.5*e,.5*e,.4*e,0,2*Math.PI),t.fill();var i=new V(this.player.x-this.x,this.player.y-this.y);i.normalize(),i.mul(.2*e),t.fillStyle="#000",t.beginPath(),t.arc(.5*e+i.x,.5*e+i.y,.1*e,0,2*Math.PI),t.fill();var r=.5*e-.4*e,n=.5*e-.4*e,s=.4*e,a=20*Math.max(0,-.9+Math.cos(.002*U.time));t.beginPath(),t.moveTo(r,n+s),t.bezierCurveTo(r,n-.4*s,r+2*s,n-.4*s,r+2*s,n+s),t.bezierCurveTo(r+2*s,n+a*s,r,n+a*s,r,n+s),t.bezierCurveTo(r,n+2.4*s,r+2*s,n+2.4*s,r+2*s,n+s),t.bezierCurveTo(r+2*s,n+(2-a)*s,r,n+(2-a)*s,r,n+s),t.fill(),t.restore()},t}(),tt=function(){function t(t,e,i){this.x=t,this.y=e,this.tileSize=i}return t.prototype.draw=function(t){var e=this.tileSize;t.save(),t.translate(this.x,this.y);var i=.5*e;t.beginPath(),t.rect(0,0,e,1.5*i),t.clip(),t.beginPath(),t.fillStyle="#fff",t.moveTo(i,i);for(var r=0;r<=30;r++){var n=2*r*Math.PI/30+.004*U.time,s=i*(r%2==0?.9:.7),a=i+Math.cos(n)*s,o=i+Math.sin(n)*s;t.lineTo(a,o+.5*i)}t.fill(),t.fillStyle="#000",t.fillRect(0,1.5*i-2,e,4),t.restore()},t}(),et=function(){function t(t,e,i){this.x=t,this.y=e,this.tileSize=i}return t.prototype.draw=function(t){var e=this.tileSize;t.save(),t.translate(this.x,this.y);var i=.25*e;t.fillStyle="#000",t.beginPath(),t.arc(1.2*i,1.2*i,.4*i,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(2.8*i,1.2*i,.4*i,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(2.8*i,2.8*i,.4*i,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(1.2*i,2.8*i,.4*i,0,2*Math.PI),t.fill();var r=5*Math.cos(.01*U.time)+5;t.lineWidth=3,t.strokeStyle="#fff",t.beginPath(),t.moveTo(1.2*i,1.2*i),t.lineTo(1.2*i,1.2*i-r),t.moveTo(2.8*i,1.2*i),t.lineTo(2.8*i,1.2*i-r),t.moveTo(2.8*i,2.8*i),t.lineTo(2.8*i,2.8*i-r),t.moveTo(1.2*i,2.8*i),t.lineTo(1.2*i,2.8*i-r),t.stroke(),t.restore()},t}(),it=function(){function t(t,e,i,r){void 0===r&&(r=0),this.x=t,this.y=e,this.tileSize=i,this.jitter=r}return t.prototype.draw=function(t){var e=this.tileSize;t.save();var i=this.jitter*(2*Math.random()-1),r=this.jitter*(2*Math.random()-1);t.translate(this.x+i,this.y+r);var n=.25*e;t.strokeStyle="#fff",t.lineWidth=3,t.beginPath(),t.moveTo(2*n,2*n),t.lineTo(3*n,1*n),t.stroke(),t.fillStyle="#000",t.beginPath(),t.arc(2*n,2*n,n,0,2*Math.PI),t.fill(),t.restore()},t}(),rt=function(){function t(t,e,i){this.x=t,this.y=e,this.tileSize=i}return t.prototype.draw=function(t){var e=this.tileSize;t.save(),t.translate(this.x,this.y);var i=.125*e,r=5+2*Math.cos(.01*U.time);t.fillStyle="#000",t.strokeStyle="#000",t.lineWidth=2,t.translate(0,.4*e-1.5*r),t.beginPath(),t.moveTo(i,i),t.lineTo(7*i,i),t.bezierCurveTo(7*i,r*i,i,r*i,i,i),t.fill(),t.stroke(),t.clip(),t.fillStyle="#fff",t.fillRect(i+4,i,3,3),t.fillRect(i+9,i,3,3.5),t.fillRect(i+14,i,3,3.5),t.fillRect(i+19,i,3,3),t.fillRect(i+9,r*i-6,3,3.5),t.fillRect(i+14,r*i-6,3,3.5),t.restore()},t}(),nt={},st=function(){function t(t,e,i,r){void 0===r&&(r=0),this.x=t,this.y=e,this.tileSize=i,this.r=r}return t.prototype.draw=function(t){var e=this.tileSize;t.save(),t.translate(this.x+2*Math.random()-1,this.y+2*Math.random()-1);var i=.25*e;t.fillStyle="#fff",t.beginPath(),t.arc(2*i,2*i,2*this.r*i,0,2*Math.PI),t.fill(),t.restore()},t}(),at=function(){function t(t,e,i,r){this.x=t,this.y=e,this.tileSize=i,this.dir=r,this.open=!1}return t.prototype.draw=function(t){var e=this.tileSize;t.save();var i=.25*e;"right"===this.dir?(t.translate(this.x+.125*e+Math.max(Math.cos(.002*U.time),.5)*e*.25,this.y+.375*e),t.fillStyle="rgba(255,255,255,"+(.2+.1*Math.cos(.002*U.time))+")",t.beginPath(),t.moveTo(0,0),t.lineTo(i,.5*i),t.lineTo(0,i),t.moveTo(i,0),t.lineTo(i+i,.5*i),t.lineTo(i,i),t.fill()):(t.translate(this.x+.375*e,this.y+.125*e+Math.max(Math.cos(.002*U.time),.5)*e*.25),t.fillStyle="rgba(255,255,255,"+(.2+.1*Math.cos(.002*U.time))+")",t.beginPath(),t.moveTo(0,0),t.lineTo(.5*i,i),t.lineTo(i,0),t.moveTo(0,i),t.lineTo(.5*i,i+i),t.lineTo(i,i),t.fill()),t.restore()},t}(),ot=function(){function t(t,e,i,r){this.x=t,this.y=e,this.tileSize=i,this.text=r}return t.prototype.draw=function(t){t.save(),t.fillStyle="#fff",t.translate(this.x+this.tileSize,this.y),t.beginPath(),t.lineTo(-10,15),t.lineTo(20,-5),t.lineTo(20,5),t.fill(),t.fillRect(15,-20,170,40),t.fillStyle="#000",t.strokeStyle="#fff",x(t,this.text,22,-2,160,14),t.restore()},t}(),ht=function(){function t(t,e,i){this.x=t,this.y=e,this.tileSize=i}return t.prototype.draw=function(t){t.save(),t.translate(this.x,this.y),t.fillStyle="rgba(255,255,255,"+(.2+.05*Math.cos(.006*U.time))+")",t.fillRect(.125*this.tileSize,.125*this.tileSize,.75*this.tileSize,.75*this.tileSize),t.lineWidth=2,t.strokeStyle="rgba(255,255,255,0.5)",t.strokeRect(.125*this.tileSize,.125*this.tileSize,.75*this.tileSize,.75*this.tileSize),t.restore()},t}(),lt=function(){function t(t,e,i){this.x=t,this.y=e,this.tileSize=i}return t.prototype.draw=function(t){t.save(),t.translate(this.x+.5*this.tileSize,this.y),t.lineWidth=2,t.setLineDash([3,3]),t.strokeStyle="rgba(255,255,255,0.3)",t.beginPath(),t.arc(0,0,2*this.tileSize,0,2*Math.PI),t.stroke(),t.beginPath(),t.arc(1*this.tileSize,-.5*this.tileSize,.3*this.tileSize,0,2*Math.PI),t.stroke(),t.beginPath(),t.arc(-1*this.tileSize,-.5*this.tileSize,.3*this.tileSize,0,2*Math.PI),t.stroke(),t.beginPath(),t.arc(0,1.5*this.tileSize,.3*this.tileSize,0,Math.PI),t.closePath(),t.stroke(),t.restore()},t}();!function(){Array.prototype.find||(console.log("add find method"),Object.defineProperty(Array.prototype,"find",{value:function(t){if(null==this)throw new TypeError('"this" is null or not defined');var e=Object(this),i=e.length>>>0;if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var r=arguments[1],n=0;n<i;){var s=e[n];if(t.call(r,s,n,e))return s;n++}}})),console.log("Done")}();var ct;!function(t){t[t.TITLE=0]="TITLE",t[t.LEVEL=1]="LEVEL"}(ct||(ct={}));var ft=ct.LEVEL,yt=0,ut=!1,vt=function(t,e){void 0===t&&(t=640),void 0===e&&(e=360);var i=document.createElement("canvas");i.width=t,i.height=e,i.mozOpaque=!0,document.getElementById("stage").appendChild(i);var r=window.innerWidth/t,n=window.innerHeight/e,s=Math.min(r,n);return i.style.transformOrigin="0 0",i.style.transform="scale("+s+","+s+")",[i,i.getContext("2d",{alpha:!1})]}(),xt=vt[0],dt=vt[1],mt=[3,.2,.05,.15,.2,.3,0,.2,-.35,0,0,0,0,0,0,0,.15,0,.15,0,0,.1,0,.2],pt=[2,.05,.1,.35,.15,.2,0,-.35,0,0,0,0,0,0,0,0,0,0,.7,0,0,.25,0,.6],wt=[2,0,.06330123033,.4,.25,.25407342,0,.362481573,0,0,0,0,0,0,0,.513327,0,0,1,0,0,0,0,.6],gt=J(mt),bt=new Audio;bt.src=gt;var St=J(pt),zt=new Audio;zt.src=St;var kt=J(wt),Mt=new Audio;Mt.src=kt;var Tt;!function(t){t[t.NONE=0]="NONE",t[t.LEFT=1]="LEFT",t[t.UP=2]="UP",t[t.RIGHT=3]="RIGHT",t[t.DOWN=4]="DOWN"}(Tt||(Tt={}));var Pt=Tt.NONE,Et=35,It={x:5*Et,y:5*Et,facing:0},Rt=[],Lt=[],Nt=!1,Ot=H[yt],At=g(yt),Wt=At[0],Ct=At[1],Ft=new G(0,0,0,1,"#000","#fff"),Dt="spatial",qt="next",Ut=0,Yt=0,Xt=0,Ht=0,Gt=0,jt=0,Bt="sprite",_t="blink",Vt="collider",Qt="hover",Zt="ai",Jt="bomb",Kt="fire",$t="door",te="marble",ee="box",ie="switch",re="saw",ne="eye",se="mouth",ae="lever",oe="pingpong",he="speech";g(yt),u("nextLevelFadeOut",function(t,e){qt="next",Yt=.1}),u("restartLevel",function(t,e){0===Yt&&Gt++,qt="current",Yt=.1}),u("move",function(t,e){Pt=e.move}),u("move",function(t,e){Pt=e.move,h("bomb").forEach(function(t){t.ttl--;var e=c(t.entity,Bt);t.ttl<1?(f(t.entity),w(e.x,e.y)):e.jitter=.5*Math.max(0,3-t.ttl)})});var le=new G(0,0,0,0,"#000","#fff"),ce=new G(0,0,0,0,"#fff","#000");requestAnimationFrame(D),window.addEventListener("keypress",function(t){t.keyCode>=37&&t.keyCode<=40&&t.preventDefault()}),window.addEventListener("keyup",function(t){switch(t.keyCode){case 37:case 65:case 81:v("move",{move:Tt.LEFT}),t.preventDefault();break;case 38:case 87:case 90:v("move",{move:Tt.UP}),t.preventDefault();break;case 39:case 68:v("move",{move:Tt.RIGHT}),t.preventDefault();break;case 40:case 83:v("move",{move:Tt.DOWN}),t.preventDefault();break;case 82:ft===ct.LEVEL&&v("restartLevel",{}),t.preventDefault();break;case 70:var e=document.getElementById("stage");e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.msRequestFullcreen&&e.msRequestFullscreen();break;case 13:case 32:ft===ct.TITLE&&(ft=ct.LEVEL),t.preventDefault()}},!1),document.addEventListener("fullscreenchange",function(t){var e=window.innerWidth/xt.width,i=window.innerHeight/xt.height,r=Math.min(e,i);xt.style.transformOrigin="0 0",xt.style.transform="scale("+r+","+r+")"},!1),window.addEventListener("resize",function(t){var e=window.innerWidth/xt.width,i=window.innerHeight/xt.height,r=Math.min(e,i);xt.style.transformOrigin="0 0",xt.style.transform="scale("+r+","+r+")"},!1)},function(t,e,i){function r(){this.setSettings=function(t){for(var e=0;e<24;e++)this[String.fromCharCode(97+e)]=t[e]||0;this.c<.01&&(this.c=.01);var i=this.b+this.c+this.e;if(i<.18){var r=.18/i;this.b*=r,this.c*=r,this.e*=r}}}function n(){this._params=new r;var t,e,i,n,s,a,o,h,l,c,f,y;this.reset=function(){var t=this._params;n=100/(t.f*t.f+.001),s=100/(t.g*t.g+.001),a=1-t.h*t.h*t.h*.01,o=-t.i*t.i*t.i*1e-6,t.a||(f=.5-t.n/2,y=5e-5*-t.o),h=1+t.l*t.l*(t.l>0?-.9:10),l=0,c=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.totalReset=function(){this.reset();var r=this._params;return t=r.b*r.b*1e5,e=r.c*r.c*1e5,i=r.e*r.e*1e5+12,3*((t+e+i)/3|0)},this.synthWave=function(r,u){var v=this._params,x=1!=v.s||v.v,d=v.v*v.v*.1,m=1+3e-4*v.w,p=v.s*v.s*v.s*.1,w=1+1e-4*v.t,g=1!=v.s,b=v.x*v.x,S=v.g,z=v.q||v.r,k=v.r*v.r*v.r*.2,M=v.q*v.q*(v.q<0?-1020:1020),T=v.p?32+((1-v.p)*(1-v.p)*2e4|0):0,P=v.d,E=v.j/2,I=v.k*v.k*.01,R=v.a,L=t,N=1/t,O=1/e,A=1/i,W=5/(1+v.u*v.u*20)*(.01+p);W>.8&&(W=.8),W=1-W;for(var C,F,D,q,U,Y,X=!1,H=0,G=0,j=0,B=0,_=0,V=0,Q=0,Z=0,J=0,K=0,$=new Array(1024),tt=new Array(32),et=$.length;et--;)$[et]=0;for(var et=tt.length;et--;)tt[et]=2*Math.random()-1;for(var et=0;et<u;et++){if(X)return et;if(T&&++J>=T&&(J=0,this.reset()),c&&++l>=c&&(c=0,n*=h),a+=o,n*=a,n>s&&(n=s,S>0&&(X=!0)),F=n,E>0&&(K+=I,F*=1+Math.sin(K)*E),F|=0,F<8&&(F=8),R||(f+=y,f<0?f=0:f>.5&&(f=.5)),++G>L)switch(G=0,++H){case 1:L=e;break;case 2:L=i}switch(H){case 0:j=G*N;break;case 1:j=1+2*(1-G*O)*P;break;case 2:j=1-G*A;break;case 3:j=0,X=!0}z&&(M+=k,D=0|M,D<0?D=-D:D>1023&&(D=1023)),x&&m&&(d*=m,d<1e-5?d=1e-5:d>.1&&(d=.1)),Y=0;for(var it=8;it--;){if(++Q>=F&&(Q%=F,3==R))for(var rt=tt.length;rt--;)tt[rt]=2*Math.random()-1;switch(R){case 0:U=Q/F<f?.5:-.5;break;case 1:U=1-Q/F*2;break;case 2:q=Q/F,q=6.28318531*(q>.5?q-1:q),U=1.27323954*q+.405284735*q*q*(q<0?1:-1),U=.225*((U<0?-1:1)*U*U-U)+U;break;case 3:U=tt[Math.abs(32*Q/F|0)]}x&&(C=V,p*=w,p<0?p=0:p>.1&&(p=.1),g?(_+=(U-V)*p,_*=W):(V=U,_=0),V+=_,B+=V-C,B*=1-d,U=B),z&&($[Z%1024]=U,U+=$[(Z-D+1024)%1024],Z++),Y+=U}Y*=.125*j*b,r[et]=Y>=1?32767:Y<=-1?-32768:32767*Y|0}return u}}var s=new n,a=function(t){s._params.setSettings(t);var e=s.totalReset(),i=new Uint8Array(4*((e+1)/2|0)+44),r=2*s.synthWave(new Uint16Array(i.buffer,44),e),n=new Uint32Array(i.buffer,0,44);n[0]=1179011410,n[1]=r+36,n[2]=1163280727,n[3]=544501094,n[4]=16,n[5]=65537,n[6]=44100,n[7]=88200,n[8]=1048578,n[9]=1635017060,n[10]=r,r+=44;for(var a=0,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h="data:audio/wav;base64,";a<r;a+=3){var l=i[a]<<16|i[a+1]<<8|i[a+2];h+=o[l>>18]+o[l>>12&63]+o[l>>6&63]+o[63&l]}return h};t.exports=a}]);