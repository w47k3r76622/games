"use strict";var HEIGHT=350;var WIDTH=450;var OFFSCREEN_SPACE=10;var FPS=60;var WORLD_FRAMES=10*FPS;var INITIAL_LIVES=3;var NEW_LIFE_POINTS=500;var SHIP_ROTATE_SPEED=Math.PI*2/FPS;var SHIP_ACCELERATION=3/FPS;var SHIP_AUTO_INTERVAL=Math.floor(FPS/4);var IMG_SHIP=document.getElementById("IMG_SHIP");var SHIP_PAST_ALPHA=.5;var SHOT_RADIUS=1.5;var SHOT_SPEED=3;var SHOT_TTL=1*FPS;var SHOT_COLOR="#474";var ROCK_LARGE_RADIUS=10;var ROCK_MEDIUM_RADIUS=7;var ROCK_SMALL_RADIUS=3;var ROCK_RADIUS_SPEED_SCALE=1.5;var ROCK_MAX_SPEED=8;var ROCK_SPAWN_MARGIN_X=WIDTH/2.5;var ROCK_SPAWN_MARGIN_Y=HEIGHT/2.5;var ROCK_POINTS=10;var LEVEL_FADE_TIME=.25*FPS;var GAME_OVER_TIME=5*FPS;var IMG_RED_PARTICLE;var IMG_YELLOW_PARTICLE;(function(){var canvas=document.createElement("canvas");canvas.width=1;canvas.height=1;var ctx=canvas.getContext("2d");ctx.fillStyle="#a22";ctx.fillRect(0,0,canvas.width,canvas.height);IMG_RED_PARTICLE=new Image;IMG_RED_PARTICLE.src=canvas.toDataURL();ctx.fillStyle="#aa4";ctx.fillRect(0,0,canvas.width,canvas.height);IMG_YELLOW_PARTICLE=new Image;IMG_YELLOW_PARTICLE.src=canvas.toDataURL()})();var FX_SHIP_THRUST={width:0,height:0,image:function(){return function(){if(Math.random()<.8){return IMG_RED_PARTICLE}return IMG_YELLOW_PARTICLE}},emitCount:1,ttl:0,particleTTL:500};var FX_ROCK_HIT={width:0,height:0,image:function(){return function(){var r=Math.random();if(r<.8){return IMG_YELLOW_PARTICLE}return IMG_RED_PARTICLE}},ttl:0,emitCount:40,particleTTL:750,particleVelocity:function(){var angle=Math.PI*2*Math.random();var speed=275*Math.random();return function(t){return{x:Math.cos(angle)*speed,y:Math.sin(angle)*speed}}},opacity:function(){return function(t){return Math.max(750-t,0)/750}}};var FX_SHIP_EXPLODE={width:0,height:0,image:function(){return function(){var r=Math.random();if(r<.8){return IMG_RED_PARTICLE}return IMG_YELLOW_PARTICLE}},ttl:0,emitCount:100,particleTTL:1500,particleVelocity:function(){var angle=Math.PI*2*Math.random();var speed=350*Math.random();return function(t){return{x:Math.cos(angle)*speed,y:Math.sin(angle)*speed}}},opacity:function(){return function(t){return Math.max(1500-t,0)/1500}}};"use strict";function Controller(){this.buttons={};this.shootingUp=true;window.addEventListener("keydown",function(event){switch(event.which){case 37:case 65:case 81:this.buttons.left=true;break;case 39:case 68:this.buttons.right=true;break;case 38:case 87:this.buttons.accelerate=true;break;case 80:if(paused){window.unpause()}else{window.pause();window.manuallyPaused=true}break;case 32:this.buttons.shooting=true&&this.shootingUp;this.shootingUp=false;this.buttons.spaceDown=true;break;case 13:if(this.enterFunction){var func=this.enterFunction;this.enterFunction=null;func()}break}}.bind(this));window.addEventListener("keyup",function(event){switch(event.which){case 37:case 65:case 81:this.buttons.left=false;break;case 39:case 68:this.buttons.right=false;break;case 38:case 87:this.buttons.accelerate=false;break;case 32:this.buttons.shooting=false;this.shootingUp=true;this.buttons.spaceDown=false;break}}.bind(this))}"use strict";function Entity(options){this.pos=options.pos||{x:0,y:0};this.velocity=options.velocity||{x:0,y:0};this.angle=options.angle||0;this.image=options.image;this.radius=options.radius||0;this.color=options.color||"#fff";this.initialPos=clone(this.pos);this.initialVelocity=clone(this.velocity);this.initialAngle=this.angle}Entity.prototype.reset=function(){this.pos=clone(this.initialPos);this.velocity=clone(this.initialVelocity);this.angle=this.initialAngle};Entity.prototype.accelerate=function(acceleration){this.velocity.x+=Math.cos(this.angle)*acceleration;this.velocity.y+=Math.sin(this.angle)*acceleration};Entity.prototype.collides=function(other){var distance=Math.sqrt(Math.pow(this.pos.x-other.pos.x,2)+Math.pow(this.pos.y-other.pos.y,2));return distance<this.radius+other.radius};Entity.prototype.update=function(){this.pos.x+=this.velocity.x;this.pos.y+=this.velocity.y;if(this.pos.x<-OFFSCREEN_SPACE){this.pos.x+=WIDTH+2*OFFSCREEN_SPACE}else if(this.pos.x>WIDTH+OFFSCREEN_SPACE){this.pos.x-=WIDTH+2*OFFSCREEN_SPACE}if(this.pos.y<-OFFSCREEN_SPACE){this.pos.y+=HEIGHT+2*OFFSCREEN_SPACE}else if(this.pos.y>HEIGHT+OFFSCREEN_SPACE){this.pos.y-=HEIGHT+2*OFFSCREEN_SPACE}};Entity.prototype.render=function(){if(this.image){ctx.save();ctx.translate(this.pos.x,this.pos.y);ctx.rotate(this.angle);ctx.drawImage(this.image,-this.image.width/2,-this.image.height/2);ctx.restore()}else{ctx.fillStyle=this.color;ctx.beginPath();ctx.arc(this.pos.x,this.pos.y,this.radius,0,Math.PI*2);ctx.fill()}};"use strict";function generateImages(){var canvas=document.createElement("canvas");canvas.width=IMG_SHIP.width;canvas.height=IMG_SHIP.height;var ctx=canvas.getContext("2d");ctx.globalAlpha=SHIP_PAST_ALPHA;ctx.drawImage(IMG_SHIP,0,0);window.IMG_SHIP_PAST=new Image;IMG_SHIP_PAST.src=canvas.toDataURL()}"use strict";window.addEventListener("load",function(){generateImages();window.stardust=new Stardust;window.canvas=document.createElement("canvas");document.body.appendChild(canvas);canvas.width=WIDTH;canvas.height=HEIGHT;canvas.style.height=window.innerHeight-20+"px";window.addEventListener("resize",function(){canvas.style.height=window.innerHeight-20+"px"});window.ctx=canvas.getContext("2d");window.controller=new Controller;mainMenu()});function mainMenu(){ctx.fillStyle="#000";ctx.fillRect(0,0,WIDTH,HEIGHT);ctx.fillStyle="#a22";ctx.font="20px courier";ctx.textAlign="center";ctx.fillText("n o v a   r u n n e r",2*WIDTH/3,HEIGHT/2-20);ctx.fillStyle="#f22";ctx.fillText("n         r          ",2*WIDTH/3,HEIGHT/2-20);ctx.fillStyle="#a22";ctx.font="15px courier";ctx.fillText("press enter to start",2*WIDTH/3,HEIGHT/2+25);ctx.fillStyle="#522";ctx.font="10px courier";ctx.textAlign="right";ctx.fillText("Richard Schneider",WIDTH-5,HEIGHT-5);ctx.fillStyle="#855";ctx.fillRect(0,HEIGHT/2-1,WIDTH,2);ctx.fillStyle="#aa4";ctx.beginPath();ctx.arc(-2*HEIGHT/3,HEIGHT/2,HEIGHT,0,Math.PI*2);ctx.fill();controller.enterFunction=instructions}function instructions(){ctx.fillStyle="#000";ctx.fillRect(0,0,WIDTH,HEIGHT);ctx.fillStyle="#a22";ctx.font="10px courier";ctx.textAlign="left";var text;text=['"Even now it is clear that the most significant scientific discovery',"of the century was the spontaneous generation of a previously-unknown",'element in the moments immediately before the explosion of a nova."','                 - "Novide", Dictionary of Chemical History, 3rd ed.'];for(var i=0;i<text.length;i++){ctx.fillText(text[i],20,25+11*i)}text=['"The Northern Cluster Minerals pilot strike enters its third week',"today. The strikers demand stricter safety protocols, but an NCM","spokesman emphasized that all their spacecraft are equipped with","state-of-the-art prior-explosion time-reversal engines (PETREs). The","spokesman did not address the concerns over the short usable lifetime",'of PETREs, nor the difficulty of preventing paradoxes."',"                                - Milky Way Broadcasting news report"];for(var i=0;i<text.length;i++){ctx.fillText(text[i],20,80+11*i)}text=['"It\'s quiet out in space, but them stars sure light up pretty."','                                  - Pilot Johnny "Too Close" Willery'];for(var i=0;i<text.length;i++){ctx.fillText(text[i],20,170+11*i)}ctx.fillStyle="#aa4";ctx.textAlign="center";ctx.fillText("i n s t r u c t i o n s",WIDTH/2,203);ctx.textAlign="left";ctx.fillText("- Maneuver with arrow keys, shoot with space, and pause with 'p'.",20,220);ctx.fillText("- Destroy all the rocks in a sector to jump to the next one.",20,220+11);ctx.fillText("- You have ten seconds until the nova explodes.",20,220+11*2);ctx.fillText("- Time will rewind immediately before the nova explodes.",20,220+11*3);ctx.fillText("- Previous timelines will continue to exist after a rewind.",20,220+11*4);ctx.fillText("- If *any* timeline gets hit, your emergency system will activate.",20,220+11*5);ctx.fillText('- Your emergency system has a limited number of uses (slang "lives").',20,220+11*6);ctx.fillText("- If you are hit with no lives, you die. Hope you got a high score!",20,220+11*7);ctx.fillText("- Each rock hit is worth 10 points.",20,220+11*8);ctx.fillText("- Extra lives given every 500 points, awarded after clearing a sector.",20,220+11*9);ctx.fillStyle="#a22";ctx.textAlign="center";ctx.fillText("press enter to begin",WIDTH/2,337);controller.enterFunction=startGame}function startGame(){window.frozen=false;window.level=1;window.score=0;window.lives=INITIAL_LIVES;window.world=new World(level++);stardust.emitters=[];controller.buttons={};if(typeof world.timer==="undefined"){window.timer=setTimer(function(){world.update();stardust.update(1e3/FPS);if(world.isOver&&!world.rewinding&&!world.finalPlay&&!world.fadeOut){lives+=Math.floor((score+world.score)/NEW_LIFE_POINTS)-Math.floor(score/NEW_LIFE_POINTS);score+=world.score;window.world=new World(level++)}},1e3/FPS)}else{unpause()}function frame(time){if(!window.frozen){world.render();stardust.render(canvas,ctx);requestAnimationFrame(frame)}}requestAnimationFrame(frame)}function highScores(){if(!localStorage.getItem("nr-scores")){localStorage.setItem("nr-scores",JSON.stringify([{name:"Johnny",score:5960},{name:"Jacsn",score:2980},{name:"Nick",score:2210},{name:"Josh",score:1650},{name:"Richard",score:1280},{name:"Ed",score:920},{name:"Brock",score:650},{name:"Rick",score:430},{name:"Garrett",score:200},{name:"Fredrick",score:150}]))}var scores=JSON.parse(localStorage.getItem("nr-scores"));if(typeof window.lastScore!=="undefined"){var highScore=false;if(scores.length<10){highScore=true}else{for(var i=0;i<scores.length;i++){if(lastScore>scores[i].score){highScore=true;break}}}if(highScore){var name=prompt("High score! What is your name?");var added=false;for(var i=0;i<scores.length;i++){if(lastScore>scores[i].score){scores.splice(i,0,{name:name,score:lastScore});added=true;break}}if(!added){scores.push({name:name,score:lastScore})}scores=scores.slice(0,10);localStorage.setItem("nr-scores",JSON.stringify(scores))}}ctx.fillStyle="#000";ctx.fillRect(0,0,WIDTH,HEIGHT);ctx.fillStyle="#a22";ctx.font="20px courier";ctx.textAlign="center";ctx.fillText("    h i g h   s c o r e s",WIDTH/2,30);ctx.fillStyle="#aa4";ctx.font="15px courier";for(var i=0;i<scores.length;i++){ctx.textAlign="right";ctx.fillText(scores[i].name+"  ",WIDTH/2,60+20*i);ctx.textAlign="left";ctx.fillText("  "+scores[i].score,WIDTH/2,60+20*i)}if(typeof window.lastScore!=="undefined"){ctx.fillStyle="#ddd";ctx.textAlign="right";ctx.fillText("last score"+"  ",WIDTH/2,60+20*i);ctx.textAlign="left";ctx.fillText("  "+window.lastScore,WIDTH/2,60+20*i)}ctx.fillStyle="#855";ctx.textAlign="center";ctx.fillText("press enter to play again",WIDTH/2,60+20*i+35);controller.enterFunction=startGame}"use strict";Array.prototype.update=function(delta){for(var i=0;i<this.length;i++){this[i].update(delta)}};Array.prototype.render=function(delta){for(var i=0;i<this.length;i++){this[i].render()}};Array.prototype.remove=function(x){this.splice(this.indexOf(x),1)};function clone(object){var c={};for(var attribute in object){c[attribute]=object[attribute]}return c}function randomSign(){if(Math.random()<.5){return-1}return 1}"use strict";function Rock(radius){var x;var y;do{x=Math.floor(WIDTH*Math.random());y=Math.floor(HEIGHT*Math.random())}while(!(x<ROCK_SPAWN_MARGIN_X||x>WIDTH-ROCK_SPAWN_MARGIN_X||y<ROCK_SPAWN_MARGIN_Y||y>HEIGHT-ROCK_SPAWN_MARGIN_Y));Entity.call(this,{pos:{x:x,y:y},velocity:{x:Math.random()*ROCK_MAX_SPEED*randomSign()/(radius*2),y:Math.random()*ROCK_MAX_SPEED*randomSign()/(radius*2)},radius:radius,color:"#444"});this.debris=[];var debrisRadius=0;if(this.radius===ROCK_LARGE_RADIUS){debrisRadius=ROCK_MEDIUM_RADIUS}else if(this.radius===ROCK_MEDIUM_RADIUS){debrisRadius=ROCK_SMALL_RADIUS}if(debrisRadius){for(var i=0;i<2;i++){this.debris.push(new Rock(debrisRadius))}}}Rock.prototype=Object.create(Entity.prototype);Rock.prototype.constructor=Rock;Rock.prototype.hit=function(){world.entities.remove(this);for(var i=0;i<this.debris.length;i++){var debris=this.debris[i];debris.pos.x=this.pos.x;debris.pos.y=this.pos.y;world.entities.push(debris)}world.score+=ROCK_POINTS;var over=true;for(var i=0;i<world.entities.length;i++){if(world.entities[i]instanceof Rock){over=false;break}}if(over){world.over()}};"use strict";function Ship(){Entity.call(this,{pos:{x:WIDTH/2,y:HEIGHT/2},radius:4,image:IMG_SHIP});this.inputs=[];this.autoTimer=0}Ship.prototype=Object.create(Entity.prototype);Ship.prototype.update=function(){var input;if(this.inputs[world.frame]){input=clone(this.inputs[world.frame]);if(!world.finalPlay){this.image=IMG_SHIP_PAST}else{this.image=IMG_SHIP}}else{input=controller.buttons;this.inputs[world.frame]=clone(controller.buttons)}if(input.left){this.angle-=SHIP_ROTATE_SPEED}if(input.right){this.angle+=SHIP_ROTATE_SPEED}if(input.accelerate){this.accelerate(SHIP_ACCELERATION)}if(input.shooting){world.entities.push(new Shot(this));input.shooting=false;this.autoTimer=SHIP_AUTO_INTERVAL}else if(input.spaceDown&&this.autoTimer<=0){world.entities.push(new Shot(this));this.autoTimer+=SHIP_AUTO_INTERVAL}if(this.autoTimer>0){this.autoTimer--}Entity.prototype.update.call(this);for(var i=0;i<world.entities.length;i++){var entity=world.entities[i];if(entity instanceof Rock){if(this.collides(entity)){world.shipHit=true;break}}}if(input.accelerate){var fx=FX_SHIP_THRUST;var player=this;fx.particleVelocity=function(){var angle=player.angle+Math.PI+(Math.PI/4*Math.random()-Math.PI/8);var speed=75*Math.random();return function(t){return{x:player.velocity.x*60+Math.cos(angle)*speed,y:player.velocity.y*60+Math.sin(angle)*speed}}};stardust.add(player.pos.x+Math.cos(player.angle+Math.PI)*10,player.pos.y+Math.sin(player.angle+Math.PI)*10,fx)}};"use strict";function Shot(ship){Entity.call(this,{pos:{x:ship.pos.x,y:ship.pos.y},velocity:{x:ship.velocity.x+SHOT_SPEED*Math.cos(ship.angle),y:ship.velocity.y+SHOT_SPEED*Math.sin(ship.angle)},radius:SHOT_RADIUS,color:SHOT_COLOR});this.ttl=SHOT_TTL}Shot.prototype=Object.create(Entity.prototype);Shot.prototype.update=function(){Entity.prototype.update.call(this);for(var i=0;i<world.entities.length;i++){var entity=world.entities[i];if(entity instanceof Rock){if(this.collides(entity)){entity.hit();stardust.add(this.pos.x,this.pos.y,FX_ROCK_HIT);world.entities.remove(this)}}}this.ttl--;if(this.ttl===0){world.entities.remove(this)}};"use strict";(function(){function getValue(x,time){if(typeof x==="function"){return x(time)}else{return x}}function Stardust(){this.emitters=[]}Stardust.prototype.add=function(x,y,options){if(Array.isArray(options)){for(var i=0;i<options.length;i++){this.add(x,y,options[i])}return}var emitter=new Emitter(x,y,options);this.emitters.push(emitter);return emitter};Stardust.prototype.remove=function(emitter){this.emitters.splice(this.emitters.indexOf(emitter),1)};Stardust.prototype.update=function(delta){while(delta>100){this.update(100);delta-=100}var stillAlive=[];this.emitters.forEach(function(emitter){emitter.update(delta);if(emitter.ttl===null||emitter.ttl>0||emitter.particles.length>0){stillAlive.push(emitter)}});this.emitters=stillAlive};Stardust.prototype.render=function(canvas,ctx){this.emitters.forEach(function(emitter){emitter.render(canvas,ctx)})};function Emitter(x,y,options){this.x=x;this.y=y;this.image=getValue(options.image)||null;if(options.ttl===undefined){this.ttl=1e3}else{this.ttl=getValue(options.ttl)}this.width=options.width||0;this.height=options.height||0;this.velocity=options.velocity||null;this.inheritVelocity=options.inheritVelocity;if(this.inheritVelocity===undefined){this.inheritVelocity=true}this.emitCount=options.emitCount||10;this.emitInterval=options.emitInterval||500;this.particleTTL=options.particleTTL||100;this.particleVelocity=options.particleVelocity||{x:0,y:0};this.renderOrder=options.renderOrder||"first";this.opacity=options.opacity||1;this.rotation=options.rotation||0;this.time=0;this.emitTimer=0;this.particles=[]}Emitter.prototype.update=function(delta){if(this.emitTimer<=0&&(this.ttl>=0||this.ttl===null)){var count=getValue(this.emitCount,this.time);for(var i=0;i<count;i++){this.particles.push(new Particle(this,getValue(this.image,this.time),getValue(this.x,this.time)+Math.random()*getValue(this.width,this.time),getValue(this.y,this.time)+Math.random()*getValue(this.height,this.time),getValue(this.particleTTL,this.time),getValue(this.particleVelocity),getValue(this.opacity,this.time),getValue(this.rotation,this.time)))}this.emitTimer+=getValue(this.emitInterval,this.time)}this.emitTimer-=delta;var stillAlive=[];this.particles.forEach(function(particle){particle.update(delta);if(particle.ttl===null||particle.ttl>0){stillAlive.push(particle)}});this.particles=stillAlive;if(this.velocity){var velocity=getValue(this.velocity,this.time);this.x+=getValue(velocity,this.time).x*delta/1e3;this.y+=getValue(velocity,this.time).y*delta/1e3}if(this.ttl!==null){this.ttl-=delta}this.time+=delta};Emitter.prototype.render=function(canvas,ctx){if(getValue(this.renderOrder)==="first"){for(var i=this.particles.length-1;i>=0;i--){this.particles[i].render(canvas,ctx)}}else{for(var i=0;i<this.particles.length;i++){this.particles[i].render(canvas,ctx)}}};function Particle(emitter,image,x,y,duration,velocity,opacity,rotation){this.emitter=emitter;this.image=image;this.x=x;this.y=y;this.ttl=duration;this.velocity=velocity;this.opacity=opacity;this.rotation=rotation;this.time=0}Particle.prototype.update=function(delta){var velocity=getValue(this.velocity,this.time);this.x+=velocity.x*delta/1e3;this.y+=velocity.y*delta/1e3;if(this.emitter.velocity&&getValue(this.emitter.inheritVelocity,this.emitter.time)){var emitterVelocity=getValue(this.emitter.velocity,this.time);this.x+=emitterVelocity.x*delta/1e3;this.y+=emitterVelocity.y*delta/1e3}if(this.ttl!==null){this.ttl-=delta}this.time+=delta};Particle.prototype.render=function(canvas,ctx){ctx.save();ctx.translate(getValue(this.x,this.time),getValue(this.y,this.time));ctx.rotate(getValue(this.rotation,this.time));ctx.globalAlpha=getValue(this.opacity,this.time);var image=getValue(this.image,this.time);ctx.drawImage(image,-image.width/2,-image.height/2);ctx.restore()};window.Stardust=Stardust;window.Emitter=Emitter;window.Particle=Particle})();"use strict";function setTimer(func,interval){var lastTime=Date.now();var drift=0;var timer;window.paused=false;window.pause=function(){clearInterval(timer);paused=true};window.unpause=function(){if(window.frozen){return}lastTime=Date.now();drift=0;clearInterval(timer);timer=setTimeout(timeHit,Math.max(interval-drift,0));paused=false};function timeHit(){if(window.frozen){return}var now=Date.now();var delta=now-lastTime;lastTime=now;drift+=delta-interval;func();timer=setTimeout(timeHit,Math.max(interval-drift,0))}timer=setTimeout(timeHit,interval);var firstFocus=true;window.addEventListener("blur",function(){if(!paused){pause();window.manuallyPaused=false}});window.addEventListener("focus",function(){if(!window.manuallyPaused){unpause()}});return timer}"use strict";function World(rocks){this.entities=[];this.frame=0;this.currentShip=new Ship;this.entities.push(this.currentShip);for(var i=0;i<rocks;i++){this.entities.push(new Rock(ROCK_LARGE_RADIUS))}this.initalEntities=[];for(var i=0;i<this.entities.length;i++){this.initalEntities.push(this.entities[i])}this.video=[];this.videoCurrentFrame;this.score=0;this.timelines=1;stardust.emitters=[];this.fadeOutInterval=LEVEL_FADE_TIME}World.prototype.update=function(){if(this.rewinding){if(this.video.length){this.videoCurrentFrame=this.video.pop()}else{this.rewinding=false;if(this.isOver){this.finalPlay=true}}return}if(this.fadeOut){this.fadeOutInterval--;if(this.fadeOutInterval<0){this.fadeOut=false;return}}this.entities.update();this.frame++;if(this.gameOver){if(this.gameOverTimer>0){this.gameOverTimer--}else{window.frozen=true;window.lastScore=score+world.score;highScores()}return}if(this.frame%4===0&&!this.finalPlay){var image=new Image;image.src=canvas.toDataURL();this.video.push(image)}if(this.shipHit){this.initalEntities.remove(world.currentShip);this.lostLife=true;lives--;if(lives>=0){this.rewind()}else{this.gameOver=true;this.gameOverTimer=GAME_OVER_TIME;lives=0;var toRemove=[];for(var i=0;i<this.entities.length;i++){var entity=this.entities[i];if(entity instanceof Ship){toRemove.push(entity);stardust.add(entity.pos.x,entity.pos.y,FX_SHIP_EXPLODE)}}for(var i=0;i<toRemove.length;i++){this.entities.remove(toRemove[i])}}}else if(this.frame===WORLD_FRAMES){if(!this.finalPlay&&!this.fadeOut){this.rewind()}else{this.finalPlay=false;this.fadeOut=true}}else if(this.isOver){if(!this.finalPlay&&!this.fadeOut){world.rewind()}}};World.prototype.render=function(){if(this.rewinding){ctx.drawImage(this.videoCurrentFrame,0,0);if(this.lostLife){ctx.fillStyle="#a33";ctx.font="18pt courier";ctx.textAlign="center";ctx.fillText("emergency system activated",WIDTH/2,HEIGHT/2)}else if(this.isOver){ctx.fillStyle="#3a3";ctx.font="18pt courier";ctx.textAlign="center";ctx.fillText("sector mined successfully",WIDTH/2,HEIGHT/2)}return}this.lostLife=false;if(this.fadeOut){this.frame--}var bgColorScale=Math.pow(this.frame,5)/Math.pow(WORLD_FRAMES,5);ctx.fillStyle="rgb("+Math.floor(150*bgColorScale)+","+Math.floor(150*bgColorScale)+","+Math.floor(120*bgColorScale)+")";if(this.fadeOut){this.frame++}ctx.fillRect(0,0,WIDTH,HEIGHT);this.entities.render();ctx.fillStyle="#ccc";ctx.font="10px courier";ctx.textAlign="right";ctx.fillText("Score: "+(score+world.score),WIDTH-5,10);ctx.fillText("Lives: "+lives,WIDTH-5,20);ctx.textAlign="left";ctx.fillText("Sector: "+(level-1),5,10);ctx.fillText("Timelines: "+this.timelines,5,20);if(this.gameOver){ctx.fillStyle="#3a3";ctx.font="18pt courier";ctx.textAlign="center";ctx.fillText("game over",WIDTH/2,HEIGHT/2)}if(this.fadeOut){var fadeAlpha=(LEVEL_FADE_TIME-this.fadeOutInterval)/LEVEL_FADE_TIME;ctx.fillStyle="#000";ctx.globalAlpha=fadeAlpha;ctx.fillRect(0,0,WIDTH,HEIGHT)}};World.prototype.rewind=function(){if(!this.isOver){this.currentShip=new Ship;this.initalEntities.push(this.currentShip);if(!this.shipHit){this.timelines++}}this.shipHit=false;this.entities=[];for(var i=0;i<this.initalEntities.length;i++){this.entities.push(this.initalEntities[i])}for(var i=0;i<this.entities.length;i++){this.entities[i].reset()}controller.buttons={};this.frame=0;this.score=0;this.rewinding=true;this.videoCurrentFrame=this.video.pop();stardust.emitters=[]};World.prototype.over=function(){this.isOver=true};