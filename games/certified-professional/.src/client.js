!function(e){var t={};function i(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(s,n,function(t){return e[t]}.bind(null,n));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=2)}({2:function(e,t,i){"use strict";!function(){let e,t,i,s,n,a,o,l,d,r,h,c,p,y,u,m,f,g=!0,b=!0;const v=document.getElementById("readybtn"),w=document.getElementById("warnbtn"),T=document.getElementById("reactbtn"),E=document.getElementById("endmessage"),L=document.getElementById("playeractionmessage"),M=document.getElementsByClassName("userinfo");function k(){C(),H()}function C(){w.setAttribute("disabled","disabled"),T.setAttribute("disabled","disabled")}function H(){v.setAttribute("disabled","disabled")}function A(e){i.innerHTML=e}function B(){for(s.innerHTML="",a.style.backgroundImage="";a.firstChild;)a.removeChild(a.firstChild)}function I(e){E.style.display="block",E.innerHTML=e,setTimeout(()=>{N()},5e3)}function N(){E.style.display="none",E.innerHTML=""}function D(){var t;e.on("start",e=>{v.removeAttribute("disabled"),n=e.id,o=e.job,B(),p=document.getElementById("groundinstructions").cloneNode(!0),y=document.getElementById("lineinstructions").cloneNode(!0),"line"===o.type&&(y.style.display="block",p.style.display="none",f="You pause to re-route the power surge!",L.innerHTML=f,a.appendChild(y)),"ground"===o.type&&(p.style.display="block",y.style.display="none",f="You step down off the tracks to avoid the train!",L.innerHTML=f,a.appendChild(p)),"ground"===o.type&&(w.innerHTML="Send Warning (w)",T.innerHTML="React to Warning (r)"),A("Waiting for players to ready up.")}),e.on("end",()=>{k(),A("Waiting for opponent...")}),e.on("connect",()=>{k(),B(),A("Waiting for opponent...")}),e.on("disconnect",()=>{k(),B(),A("Connection lost!")}),e.on("error",()=>{k(),A("Connection error!")}),e.on("tick",e=>{t=e,s.innerHTML=t}),e.on("gameon",()=>{A("Ready, set go! Good luck!"),N(),H(),w.removeAttribute("disabled","disabled"),T.removeAttribute("disabled","disabled"),"line"===o.type?(y.style.display="none",function(){const t=["red","yellow","green","blue","white"],i=document.createElement("div"),s=document.createElement("div"),n=document.createElement("div"),o=document.createElement("div"),p=document.createElement("div"),y=document.createElement("div"),m=document.getElementById("doh").cloneNode(!0),f=1500;let g=!1,b=void 0,v=void 0,w=void 0,T=!0;y.classList.add("textblock"),s.classList.add("groundmessage"),a.appendChild(y),a.appendChild(m),i.classList.add("trainwarning"),n.classList.add("arc","arc1"),o.classList.add("arc","arc2"),p.classList.add("arc","arc3"),n.innerHTML="&#9697;",o.innerHTML="&#9697;",p.innerHTML="&#9697;",i.appendChild(n),i.appendChild(o),i.appendChild(p),u=function(e){const t=e.keyCode;g&&T&&("r"===v&&82===t||"y"===v&&89===t||"g"===v&&71===t||"b"===v&&66===t||"w"===v&&87===t?(A("Nice, correct color!"),y.innerHTML='<span style="color:green;">&#x2714;</span>',k()):(C(),k()))};const E=new class{constructor(e,t){this.warningEl=e.cloneNode(),this.warningEl.classList.add("groundwarning"),this.warningEl.style.backgroundColor="red",this.warningEl.style.color="white",this.reactionEl=e.cloneNode(),this.reactionEl.classList.add("groundreaction"),this.parent=t,this.append()}append(){this.parent.appendChild(this.warningEl),this.parent.appendChild(this.reactionEl)}disableMinigame(){L.style.display="block",T=!1,y.style.opacity=.25,setTimeout(this.enableMinigame.bind(this),2e3)}enableMinigame(){L.style.display="none",T=!0,y.style.opacity=1}showWarning(){this.warningEl.innerHTML="Watch Out! Surge Incoming!!",this.warningEl.style.visibility="visible",setTimeout(this.hideMessage.bind(this.warningEl),2e3)}showThanks(){this.reactionEl.innerHTML="Close call on that train, thanks!",this.reactionEl.style.visibility="visible",setTimeout(this.hideMessage.bind(this.reactionEl),2e3)}hideMessage(){this.style.visibility="hidden"}}(s,a);let M=void 0;function k(){g=!1,v=void 0,w=void 0}function C(){e.emit("minifail"),A("Opps, not the right color!"),m.style.display="block",setTimeout(()=>{m.style.display="none"},250),y.innerHTML='<span style="color:red;">X</span>'}(function e(){const i=Math.floor(75*Math.random())+1;if(25===i&&!g){const e=Math.floor(Math.random()*t.length);let i=e;for(g=!0,w=Date.now(),y.style.backgroundColor="#999";i===e;)i=Math.floor(Math.random()*t.length);v=t[i].charAt(0),y.innerHTML=t[e],y.style.color=t[i]}g&&w+f<Date.now()&&(C(),k());b&&b.move();M=setTimeout(e,25)})(),d=function(e){"train"===e.type.type&&(b=new class{constructor(e,t){this.element=e,this.element.style.visibility="visible",this.parent=t,this.spawnedAt=Date.now(),this.a1=this.element.childNodes[0],this.a2=this.element.childNodes[1],this.a3=this.element.childNodes[2],this.arcs=[this.a1,this.a2,this.a3],this.allVisible=!1,this.finished=!1,this.endPause=1e3,this.visible=!1,this.setStyles(),this.append()}setStyles(){for(let e=0;e<this.arcs.length;e++)this.arcs[e].style.opacity=0}append(){this.parent.appendChild(this.element)}delete(){this.arcs.forEach(e=>{e.style.opacity=0}),this.parent.removeChild(this.element)}move(){let e=0;for(let t=0;t<this.arcs.length;t++){if(this.arcs[t].style.opacity<1){this.arcs[t].style.opacity=Number(this.arcs[t].style.opacity)+.025;break}++e}this.allvisible||e!==this.arcs.length||(this.allVisible=!0),this.allVisible&&(this.endPause-=25,this.visible?(this.element.style.visibility="hidden",this.visible=!1):(this.element.style.visibility="visible",this.visible=!0)),0===this.endPause&&(this.finished=!0)}}(i,a))},r=function(e){"warning"===e.type&&E.showWarning(),"reaction"===e.type&&E.showThanks()},h=function(e){A("Nice, hazard avoided!"),b&&(b.delete(),b=void 0,E.showThanks())},c=function(){A("Game Over!"),clearTimeout(M),b=void 0,B()},l=function(e){E.disableMinigame()}}()):"ground"===o.type&&(p.style.display="none",function(){const t=document.createElement("img"),i=document.createElement("img"),s=document.createElement("div"),n=document.createElement("div"),o=document.createElement("div"),p=document.getElementById("exclamations").cloneNode(!0),y=p.cloneNode(!0);function u(){p.style.display="block",setTimeout(()=>{p.style.display="none"},250),e.emit("minifail")}y.id="warnexclamations",y.draggable=!1,p.draggable=!1,o.classList.add("linemessage"),n.addEventListener("click",function(){u()}),n.id="headtarget",m=function(t){const i=t.keyCode;87===i&&(w.disabled||e.emit("action",w.dataset.action)),82===i&&(T.disabled||(e.emit("action",T.dataset.action),l()))};const f=new class{constructor(e,t,i){this.steppedDown=!1,this.steppedDownAt=void 0,this.wavedAt=void 0,this.downTime=2e3,this.element=e,this.messageEl=t,this.waving=!1,this.parent=i,this.append()}append(){this.parent.appendChild(this.messageEl)}stepDown(){L.style.display="block",a.style.top="-100px",this.steppedDown=!0,this.steppedDownAt=Date.now(),setTimeout(this.stepUp.bind(this),this.downTime)}stepUp(){L.style.display="none",a.style.top="0px",this.steppedDown=!1,this.steppedDownAt=void 0}wave(){self=this,this.element.style.left="-100%",y.style.display="block",this.waving||(this.wavedAt=Date.now(),this.waving=!0),setTimeout(()=>{self.element.style.left="0%",y.style.display="none",self.wavedAt+self.downTime>Date.now()?setTimeout(self.wave.bind(self),50):self.unWave()},50)}unWave(){this.waving=!1,this.element.style.left="0%"}showThanks(){this.messageEl.innerHTML="&lt; Surge gone! Re-routed! &gt;",this.messageEl.style.visibility="visible",setTimeout(this.hideMessage.bind(this),2e3)}hideMessage(){this.messageEl.style.visibility="hidden"}}(t,o,a);s.id="surge",t.src="person-sprite.png",t.id="person",t.draggable=!1,i.src="bird.png",i.draggable=!1,a.style.backgroundImage="url(/lines.png)",a.style.cursor="crosshair",a.appendChild(t),a.appendChild(n),a.appendChild(p),a.appendChild(y);let g=void 0,b=void 0,v=void 0;class E{constructor(e,t,i){this.element=e,this.parent=t,this.left=105,this.scale=1,this.startTop=-13.5,this.top=-13.5,this.speed=-1,this.targetX=54,this.targetTop=20,this.flyingAway=!1,this.hitTarget=!1,this.away=!1,i&&this.reverse(),this.setStyles(),this.append(),this.element.addEventListener("click",e=>{A("Got that bird, yah!"),this.flyingAway=!0})}delete(){this.parent.removeChild(this.element)}append(){this.parent.appendChild(this.element)}move(){this.flyingAway||((1===this.scale&&this.left>this.targetX||-1===this.scale&&this.left<this.targetX)&&(this.left+=this.speed,this.setLeft()),this.top<this.targetTop&&(this.top+=Math.abs(this.speed/1.5),this.setTop()),this.top>=this.targetTop&&(1===this.scale&&this.left<=this.targetX||-1===this.scale&&this.left>=this.targetX)&&(this.hitTarget=!0,this.flyingAway=!0,A("Ow, it has large talons!"),u())),this.flyingAway&&(this.left+=3*this.speed,this.top-=3*Math.abs(this.speed),this.setLeft(),this.setTop(),this.top<this.startTop&&(this.away=!0))}reverse(){this.targetX=46,this.top=-13,this.speed=1,this.left=-5,this.scale=-1,this.setStyles()}setLeft(){this.element.style.left=`${this.left}%`}setTop(){this.element.style.top=`${this.top}%`}setStyles(){this.element.style.position="absolute",this.setTop(),this.setLeft(),this.element.style.transform=`translateX(-50%) scaleX(${this.scale})`}}(function e(){const t=Math.floor(50*Math.random())+1;g&&g.away&&(g.delete(),g=void 0);g||25!==t?g&&g.move():g=new E(i,a,Math.round(Math.random()));b&&b.move();v=setTimeout(e,25)})(),d=function(e){"surge"===e.type.type&&(b=new class{constructor(e,t){this.element=e,this.parent=t,this.spawnedAt=Date.now(),this.initialLeft=-32,this.left=this.initialLeft,this.leftLimit=160,this.speed=1.3,this.hitPlayer=!1,this.append()}delete(){this.element.style.left=`${this.initialLeft}px`,this.parent.removeChild(this.element)}append(){this.element.style.left=`${this.initialLeft}px`,this.parent.appendChild(this.element)}move(){this.left>=this.leftLimit&&(this.left=this.initialLeft,this.hitPlayer=!0),this.left+=this.speed,this.setLeft()}setLeft(){this.element.style.left=`${this.left}px`}}(s,a))},r=function(e){"warning"===e.type&&f.wave(),"reaction"===e.type&&f.showThanks()},h=function(e){A("Nice, hazard avoided!"),b&&(b.delete(),b=void 0,f.showThanks())},c=function(){A("Game Over! Too Bad!"),clearTimeout(v),b=void 0,B()},l=function(e){f.stepDown()}}())}),window.addEventListener("keydown",function(e){if("line"===o.type)try{u(e)}catch(e){}if("ground"===o.type)try{m(e)}catch(e){}}),e.on("users",e=>{let t=1;e.forEach(e=>{document.getElementById(`user${t}`).innerHTML=`Player${t} ${t===n?"(you)":""} is ${e?"ready":"not ready"}`,t===n&&e?(v.style.backgroundColor="#b5ffb4",v.innerHTML="Ready!",H()):t!==n||e||(v.style.backgroundColor="#ffb4b4",v.innerHTML="Ready?"),++t})}),e.on("hazard",e=>{d(e)}),e.on("msg",e=>{r(e)}),e.on("avoided",e=>{h(e)}),e.on("lose",e=>{C(),c(),I(`Ouch, it's going to take some time to recover from that ${e.type.name}.`)}),e.on("won",()=>{C(),c(),I("Well done, you won! The line is repaired!")}),v.addEventListener("click",function(t){e.emit("action",v.dataset.action)},!1),w.addEventListener("click",function(t){g&&e.emit("action",w.dataset.action)},!1),T.addEventListener("click",function(t){b&&(e.emit("action",T.dataset.action),l())},!1)}window.addEventListener("load",function(){e=e||io({upgrade:!1,transports:["websocket"]}),t=document.getElementsByTagName("button"),i=document.getElementById("message"),s=document.getElementById("timer"),(a=document.getElementById("game")).draggable=!1,Array.from(M).forEach(e=>{e.innerHTML="Waiting..."}),k(),D()},!1)}()}});