var map={tile_size:16,keys:[{id:0,colour:"#7888A4",solid:0},{id:1,colour:"#040303",solid:1},{id:2,colour:"#AFAEAE",solid:1,bounce:.35},{id:3,colour:"#021234",friction:{x:.9,y:.9},gravity:{x:0,y:.2},jump:1,fore:1},{id:4,colour:"#021234",friction:{x:.9,y:.9},gravity:{x:0,y:.2},jump:1,fore:1},{id:8,colour:"#FFFF00",solid:0,script:"next_level"},{id:9,colour:"#C93232",solid:0,script:"death"}],data:[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,8,8,8,8,8,8,1],[1,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,3,3,3,3,3,9,3,9,3,3,3,3,3,8,8,8,8,8,1],[1,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,2,3,3,3,9,9,9,3,3,3,3,3,9,9,9,3,3,3,2,3,2,3,3,3,9,9,9,3,3,3,3,3,9,9,9,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,2,3,2,9,3,3,9,9,9,3,3,3,3,3,9,9,9,3,3,9,2,3,2,9,3,3,3,3,9,3,3,3,3,3,8,8,8,8,8,8,1],[1,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,3,2,3,9,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,3,2,3,9,3,3,3,9,3,9,3,3,3,3,3,3,8,8,8,8,1],[1,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,9,9,3,3,3,9,9,9,9,9,9,3,3,3,9,9,9,3,3,3,3,3,9,2,3,2,9,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,2,3,2,9,3,3,3,3,3,3,3,3,3,3,3,8,3,8,8,8,1],[1,4,4,4,4,4,4,4,4,4,3,3,3,2,3,2,2,3,2,2,3,2,3,3,3,3,3,3,2,3,2,3,3,3,3,3,3,9,9,9,9,9,3,3,3,3,3,3,2,3,2,3,3,3,3,3,3,9,9,9,9,9,3,3,3,3,3,3,2,3,2,2,3,2,2,3,2,2,3,2,2,3,2,2,3,2,3,3,3,3,3,9,2,3,2,9,3,3,3,3,3,9,9,9,9,9,3,3,3,3,3,9,2,3,2,9,3,3,3,3,3,3,3,3,3,3,3,3,3,8,3,8,1],[1,4,4,4,4,4,4,4,4,4,3,3,3,3,2,3,3,2,3,3,2,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,3,2,3,3,2,3,3,2,3,3,2,3,3,2,3,3,3,3,3,3,9,3,2,3,9,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,3,2,3,9,3,3,3,9,9,9,9,9,9,9,9,9,3,3,3,8,1],[1,4,4,4,4,4,4,4,4,4,3,3,3,2,3,2,2,3,2,2,3,2,3,3,3,3,3,3,2,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,2,2,3,2,2,3,2,2,3,2,2,3,2,2,3,2,3,3,3,3,3,9,2,3,2,9,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,2,3,2,9,3,3,9,2,3,2,2,3,2,2,3,2,9,3,3,9,1],[1,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,2,3,3,3,3,3,3,3,9,9,9,3,3,3,3,3,3,3,2,3,2,3,3,3,3,3,3,3,9,9,9,3,3,3,3,3,3,3,9,9,9,3,3,3,9,9,9,9,9,9,3,3,3,9,9,9,3,3,3,3,3,9,2,3,2,9,3,3,3,3,3,3,9,9,9,3,3,3,3,3,3,9,2,3,2,9,3,3,9,3,2,3,3,2,3,3,2,3,9,3,3,9,1],[1,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,3,2,3,9,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,3,2,3,9,3,3,9,2,3,2,2,3,2,2,3,2,9,3,3,9,1],[1,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,2,3,2,9,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,2,3,2,9,3,3,3,9,9,9,9,9,9,9,9,9,3,3,3,9,1],[1,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,2,3,2,9,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,2,3,2,9,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,1],[1,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,3,2,3,9,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,3,2,3,9,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,1],[1,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,2,3,3,3,3,2,3,2,2,3,2,2,3,2,3,3,3,3,2,3,2,3,3,3,3,2,3,2,2,3,2,2,3,2,3,3,3,3,9,9,9,3,3,3,9,9,9,9,9,9,3,3,3,9,9,9,3,3,3,3,3,9,2,3,2,9,3,3,3,9,9,9,9,9,9,9,9,9,3,3,3,9,2,3,2,9,3,3,3,9,9,9,9,9,9,9,9,9,3,3,3,9,1],[1,4,4,4,4,4,4,4,4,4,3,3,3,2,3,2,2,3,2,2,3,2,3,3,3,3,3,3,2,3,2,3,3,3,3,3,2,3,3,2,3,3,2,3,3,3,3,3,2,3,2,3,3,3,3,3,2,3,3,2,3,3,2,3,3,3,3,3,2,3,2,2,3,2,2,3,2,2,3,2,2,3,2,2,3,2,3,3,3,3,3,3,3,3,3,3,3,3,9,2,3,2,2,3,2,2,3,2,9,3,3,3,3,9,3,3,3,3,9,2,3,2,2,3,2,2,3,2,9,3,3,9,1],[1,4,4,4,4,4,4,4,4,4,3,3,3,3,2,3,3,2,3,3,2,3,3,3,3,3,3,3,3,2,3,3,3,3,3,2,3,2,2,3,2,2,3,2,3,3,3,3,3,2,3,3,3,3,3,2,3,2,2,3,2,2,3,2,3,3,3,3,3,2,3,3,2,3,3,2,3,3,2,3,3,2,3,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,9,3,2,3,3,2,3,3,2,3,9,3,3,3,3,3,3,3,3,3,9,3,2,3,3,2,3,3,2,3,9,3,3,9,1],[1,4,4,4,4,4,4,4,4,4,3,3,3,2,3,2,2,3,2,2,3,2,3,3,3,3,3,3,2,3,2,3,3,3,3,3,3,3,2,3,2,3,3,3,3,3,3,3,2,3,2,3,3,3,3,3,3,3,2,3,2,3,3,3,3,3,3,3,2,3,2,2,3,2,2,3,2,2,3,2,2,3,2,2,3,2,3,3,3,3,3,3,3,3,3,3,3,3,9,2,3,2,2,3,2,2,3,2,9,3,3,3,3,3,3,3,3,3,9,2,3,2,2,3,2,2,3,2,9,3,3,9,1],[1,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,9,9,9,3,3,3,9,9,9,9,9,9,3,3,3,9,9,9,3,3,3,3,3,3,3,3,3,3,3,3,3,9,9,9,9,9,9,9,9,9,3,3,3,3,3,9,3,3,3,3,3,9,9,9,9,9,9,9,9,9,3,3,3,9,1],[1,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,2,3,2,9,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,2,3,2,9,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,1],[1,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,3,2,3,9,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,3,2,3,9,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,1],[1,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,2,3,2,9,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,2,3,2,9,3,3,3,9,9,9,9,9,9,9,9,9,3,3,3,9,1],[1,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,9,9,3,3,3,3,3,3,3,2,3,2,3,3,3,3,3,3,3,9,9,9,3,3,3,3,3,3,3,2,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,2,3,2,9,3,3,3,3,3,3,9,9,9,3,3,3,3,3,3,9,2,3,2,9,3,3,9,2,3,2,2,3,2,2,3,2,9,3,3,9,1],[1,2,2,2,2,2,2,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,2,3,3,3,3,3,3,3,9,9,9,3,3,3,9,9,9,9,9,9,3,3,3,9,9,9,3,3,3,3,3,9,3,2,3,9,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,3,2,3,9,3,3,9,3,2,3,3,2,3,3,2,3,9,3,3,9,1],[1,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,2,3,2,2,3,2,2,3,2,2,3,2,2,3,2,2,3,2,3,3,3,3,3,9,2,3,2,9,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,2,3,2,9,3,3,9,2,3,2,2,3,2,2,3,2,9,3,3,9,1],[1,0,2,2,0,0,0,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,9,9,9,9,3,3,3,3,3,3,2,3,2,3,3,3,3,3,3,9,9,9,9,9,3,3,3,3,3,3,2,3,2,3,3,3,3,3,3,3,3,2,3,3,2,3,3,2,3,3,2,3,3,2,3,3,2,3,3,3,3,3,3,9,2,3,2,9,3,3,3,3,3,9,9,9,9,9,3,3,3,3,3,9,2,3,2,9,3,3,3,9,9,9,9,9,9,9,9,9,3,3,3,9,1],[1,0,2,2,0,0,0,2,2,2,0,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,2,3,3,3,3,3,3,3,2,3,2,2,3,2,2,3,2,2,3,2,2,3,2,2,3,2,3,3,3,3,3,9,3,2,3,9,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,3,2,3,9,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,9,1],[1,0,2,2,0,0,0,0,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,3,3,3,3,3,3,3,9,9,9,3,3,3,9,9,9,9,9,9,3,3,3,9,9,9,3,3,3,3,3,9,2,3,2,9,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,2,3,2,9,3,3,3,3,3,3,3,3,3,3,3,3,3,9,9,9,1],[1,2,2,2,2,2,2,2,2,2,2,0,0,0,2,2,3,3,3,3,3,3,3,3,9,9,9,3,3,3,3,3,9,9,9,3,3,3,2,3,2,3,3,3,9,9,9,3,3,3,3,3,9,9,9,3,3,3,2,3,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,2,3,2,9,3,3,9,9,9,3,3,3,3,3,9,9,9,3,3,9,2,3,2,9,3,3,3,9,3,9,3,3,3,3,3,3,9,9,9,9,1],[1,2,2,2,2,2,0,0,0,0,2,2,0,0,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,3,2,3,9,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,3,2,3,9,3,3,3,3,9,3,3,3,3,3,3,9,9,9,9,9,1],[1,2,2,0,0,2,2,0,0,0,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,2,3,2,9,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,2,3,2,9,3,3,3,9,3,9,3,3,3,3,9,9,9,9,9,9,1],[1,2,0,0,0,2,2,0,0,0,2,2,0,0,0,0,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,3,3,3,3,3,3,3,3,3,3,3,9,9,9,9,9,9,9,1],[1,2,2,2,2,2,2,2,0,0,2,2,0,0,0,0,0,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,9,9,9,9,9,9,9,1],[1,2,0,0,0,2,2,2,2,2,2,2,0,0,0,0,2,2,2,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],gravity:{x:0,y:.3},vel_limit:{x:2,y:16},movement_speed:{jump:6,left:.25,right:.25},player:{x:4,y:4,colour:"yellow"},scripts:{next_level:'alert("Eureka! You got Dottie back to the Sun!");game.load_map(map);console.log("Back to the Sun!")',death:'console.log("Dottie was absorbed.");game.load_map(map);alert("Dottie absorbed!")'}};document.addEventListener("keydown",function(t){82==t.keyCode&&game.load_map(map)});var Clarity=function(){this.alert_errors=!1,this.log_info=!0,this.tile_size=16,this.limit_viewport=!1,this.jump_switch=0,this.viewport={x:200,y:200},this.camera={x:0,y:0},this.key={left:!1,right:!1,up:!1},this.player={loc:{x:0,y:0},vel:{x:0,y:0},can_jump:!0},window.onkeydown=this.keydown.bind(this),window.onkeyup=this.keyup.bind(this)};Clarity.prototype.error=function(t){this.alert_errors&&alert(t),this.log_info&&console.log(t)},Clarity.prototype.log=function(t){this.log_info&&console.log(t)},Clarity.prototype.set_viewport=function(t,i){this.viewport.x=t,this.viewport.y=i},Clarity.prototype.keydown=function(t){switch(t.keyCode){case 37:this.key.left=!0;break;case 38:this.key.up=!0;break;case 39:this.key.right=!0}},Clarity.prototype.keyup=function(t){switch(t.keyCode){case 37:this.key.left=!1;break;case 38:this.key.up=!1;break;case 39:this.key.right=!1}},Clarity.prototype.load_map=function(t){if(void 0===t||void 0===t.data||void 0===t.keys)return this.error("Error: Invalid map data!"),!1;this.current_map=t,this.current_map.background=t.background||"#333",this.current_map.gravity=t.gravity||{x:0,y:.3},this.tile_size=t.tile_size||16;var i=this;return this.current_map.width=0,this.current_map.height=0,t.keys.forEach(function(e){t.data.forEach(function(t,a){i.current_map.height=Math.max(i.current_map.height,a),t.forEach(function(t,r){i.current_map.width=Math.max(i.current_map.width,r),t==e.id&&(i.current_map.data[a][r]=e)})})}),this.current_map.width_p=this.current_map.width*this.tile_size,this.current_map.height_p=this.current_map.height*this.tile_size,this.player.loc.x=t.player.x*this.tile_size||0,this.player.loc.y=t.player.y*this.tile_size||0,this.player.colour=t.player.colour||"#000",this.key.left=!1,this.key.up=!1,this.key.right=!1,this.camera={x:0,y:0},this.player.vel={x:0,y:0},this.log("Successfully loaded map data."),!0},Clarity.prototype.get_tile=function(t,i){return this.current_map.data[i]&&this.current_map.data[i][t]?this.current_map.data[i][t]:0},Clarity.prototype.draw_tile=function(t,i,e,a){e&&e.colour&&(a.fillStyle=e.colour,a.fillRect(t,i,this.tile_size,this.tile_size))},Clarity.prototype.draw_map=function(t,i){for(var e=0;e<this.current_map.data.length;e++)for(var a=0;a<this.current_map.data[e].length;a++)if(!i&&!this.current_map.data[e][a].fore||i&&this.current_map.data[e][a].fore){var r=a*this.tile_size-this.camera.x,l=e*this.tile_size-this.camera.y;if(r<-this.tile_size||l<-this.tile_size||r>this.viewport.x||l>this.viewport.y)continue;this.draw_tile(r,l,this.current_map.data[e][a],t)}i||this.draw_map(t,!0)},Clarity.prototype.move_player=function(){var tX=this.player.loc.x+this.player.vel.x,tY=this.player.loc.y+this.player.vel.y,offset=Math.round(this.tile_size/2-1),tile=this.get_tile(Math.round(this.player.loc.x/this.tile_size),Math.round(this.player.loc.y/this.tile_size));tile.gravity?(this.player.vel.x+=tile.gravity.x,this.player.vel.y+=tile.gravity.y):(this.player.vel.x+=this.current_map.gravity.x,this.player.vel.y+=this.current_map.gravity.y),tile.friction&&(this.player.vel.x*=tile.friction.x,this.player.vel.y*=tile.friction.y);var t_y_up=Math.floor(tY/this.tile_size),t_y_down=Math.ceil(tY/this.tile_size),y_near1=Math.round((this.player.loc.y-offset)/this.tile_size),y_near2=Math.round((this.player.loc.y+offset)/this.tile_size),t_x_left=Math.floor(tX/this.tile_size),t_x_right=Math.ceil(tX/this.tile_size),x_near1=Math.round((this.player.loc.x-offset)/this.tile_size),x_near2=Math.round((this.player.loc.x+offset)/this.tile_size),top1=this.get_tile(x_near1,t_y_up),top2=this.get_tile(x_near2,t_y_up),bottom1=this.get_tile(x_near1,t_y_down),bottom2=this.get_tile(x_near2,t_y_down),left1=this.get_tile(t_x_left,y_near1),left2=this.get_tile(t_x_left,y_near2),right1=this.get_tile(t_x_right,y_near1),right2=this.get_tile(t_x_right,y_near2);if(tile.jump&&this.jump_switch>15?(this.player.can_jump=!0,this.jump_switch=0):this.jump_switch++,this.player.vel.x=Math.min(Math.max(this.player.vel.x,-this.current_map.vel_limit.x),this.current_map.vel_limit.x),this.player.vel.y=Math.min(Math.max(this.player.vel.y,-this.current_map.vel_limit.y),this.current_map.vel_limit.y),this.player.loc.x+=this.player.vel.x,this.player.loc.y+=this.player.vel.y,this.player.vel.x*=.9,left1.solid||left2.solid||right1.solid||right2.solid){for(;this.get_tile(Math.floor(this.player.loc.x/this.tile_size),y_near1).solid||this.get_tile(Math.floor(this.player.loc.x/this.tile_size),y_near2).solid;)this.player.loc.x+=.1;for(;this.get_tile(Math.ceil(this.player.loc.x/this.tile_size),y_near1).solid||this.get_tile(Math.ceil(this.player.loc.x/this.tile_size),y_near2).solid;)this.player.loc.x-=.1;var bounce=0;left1.solid&&left1.bounce>bounce&&(bounce=left1.bounce),left2.solid&&left2.bounce>bounce&&(bounce=left2.bounce),right1.solid&&right1.bounce>bounce&&(bounce=right1.bounce),right2.solid&&right2.bounce>bounce&&(bounce=right2.bounce),this.player.vel.x*=-bounce||0}if(top1.solid||top2.solid||bottom1.solid||bottom2.solid){for(;this.get_tile(x_near1,Math.floor(this.player.loc.y/this.tile_size)).solid||this.get_tile(x_near2,Math.floor(this.player.loc.y/this.tile_size)).solid;)this.player.loc.y+=.1;for(;this.get_tile(x_near1,Math.ceil(this.player.loc.y/this.tile_size)).solid||this.get_tile(x_near2,Math.ceil(this.player.loc.y/this.tile_size)).solid;)this.player.loc.y-=.1;var bounce=0;top1.solid&&top1.bounce>bounce&&(bounce=top1.bounce),top2.solid&&top2.bounce>bounce&&(bounce=top2.bounce),bottom1.solid&&bottom1.bounce>bounce&&(bounce=bottom1.bounce),bottom2.solid&&bottom2.bounce>bounce&&(bounce=bottom2.bounce),this.player.vel.y*=-bounce||0,!bottom1.solid&&!bottom2.solid||tile.jump||(this.player.on_floor=!0,this.player.can_jump=!0)}var c_x=Math.round(this.player.loc.x-this.viewport.x/2),c_y=Math.round(this.player.loc.y-this.viewport.y/2),x_dif=Math.abs(c_x-this.camera.x),y_dif=Math.abs(c_y-this.camera.y);if(x_dif>5){var mag=Math.round(Math.max(1,.1*x_dif));c_x!=this.camera.x&&(this.camera.x+=c_x>this.camera.x?mag:-mag,this.limit_viewport&&(this.camera.x=Math.min(this.current_map.width_p-this.viewport.x+this.tile_size,this.camera.x),this.camera.x=Math.max(0,this.camera.x)))}if(y_dif>5){var mag=Math.round(Math.max(1,.1*y_dif));c_y!=this.camera.y&&(this.camera.y+=c_y>this.camera.y?mag:-mag,this.limit_viewport&&(this.camera.y=Math.min(this.current_map.height_p-this.viewport.y+this.tile_size,this.camera.y),this.camera.y=Math.max(0,this.camera.y)))}this.last_tile!=tile.id&&tile.script&&eval(this.current_map.scripts[tile.script]),this.last_tile=tile.id},Clarity.prototype.update_player=function(){this.key.left&&this.player.vel.x>-this.current_map.vel_limit.x&&(this.player.vel.x-=this.current_map.movement_speed.left),this.key.up&&this.player.can_jump&&this.player.vel.y>-this.current_map.vel_limit.y&&(this.player.vel.y-=this.current_map.movement_speed.jump,this.player.can_jump=!1),this.key.right&&this.player.vel.x<this.current_map.vel_limit.x&&(this.player.vel.x+=this.current_map.movement_speed.left),this.move_player()},Clarity.prototype.draw_player=function(t){t.fillStyle=this.player.colour,t.beginPath(),t.arc(this.player.loc.x+this.tile_size/2-this.camera.x,this.player.loc.y+this.tile_size/2-this.camera.y,this.tile_size/2-1,0,2*Math.PI),t.fill()},Clarity.prototype.update=function(){this.update_player()},Clarity.prototype.draw=function(t){this.draw_map(t,!1),this.draw_player(t)},window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)};var canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d");canvas.width=400,canvas.height=400;var game=new Clarity;game.set_viewport(canvas.width,canvas.height),game.load_map(map),game.limit_viewport=!0;var Loop=function(){ctx.fillStyle="#333",ctx.fillRect(0,0,canvas.width,canvas.height),game.update(),game.draw(ctx),window.requestAnimFrame(Loop)};Loop();
