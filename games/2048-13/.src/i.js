
class Controls
{constructor(){this.mouseX=0;this.mouseY=0;this.worldDX=0;this.worldDY=0;this.windowLayout=false;this.areaUnderMouse=-1;this.totalClear();}
totalClear(){this.menuLine=-1;this.controlUp=false;this.controlDown=false;this.controlLeft=false;this.controlRight=false;this.controlEscape=false;this.controlFire=false;this.mouseLeftButton=false;}
onKeyUp(event){return!this.keyControl(event,false);}
onKeyDown(event){return!this.keyControl(event,true);}
keyControl(event,value){var handled=true;var key=0;if(window.event){key=window.event.keyCode;}else{key=event.which;}
switch(key){case 37:this.controlLeft=value;break;case 38:this.controlUp=value;break;case 39:this.controlRight=value;break;case 40:this.controlDown=value;break;case 32:case 13:this.controlFire=value;break;case 27:this.controlEscape=value;break;default:handled=false;}
return handled;}
onMouseUp(event){this.mouseLeftButton=false;return true;}
onMouseDown(event){this.mouseLeftButton=true;return true;}
onTouchStart(event)
{this.onMouseMove(event);return this.onMouseDown(event);}
onTouchEnd(event)
{event.preventDefault();return this.onMouseUp(event);}
onTouchMove(event)
{event.preventDefault();var result=this.onMouseMove(event);return result;}
acknowledgeMouseClick(){this.mouseLeftButton=false;this.areaUnderMouse=-1;this.menuLine=-1;}
onMouseMove(event){var clientX=0,clientY=0;if('changedTouches'in event&&event.changedTouches.length>0)
{clientX=event.changedTouches[0].clientX;clientY=event.changedTouches[0].clientY;}
if('clientX'in event&&'clientY'in event)
{clientX=event.clientX;clientY=event.clientY;}
if(this.windowLayout)
{this.worldDX=(clientX-(innerWidth>>1))*16/this.windowLayout.width;this.worldDY=(clientY-(innerHeight>>1))*16/this.windowLayout.width;this.areaUnderMouse=-1;if(this.worldDX*this.worldDX+this.worldDY*this.worldDY>7.35*7.35&&this.worldDY>2.5&&Math.abs(this.worldDX)<=8){if(this.worldDX<-4){this.areaUnderMouse=3;}
else if(this.worldDX>4){this.areaUnderMouse=1;}
else if(this.worldDY<9.65){this.areaUnderMouse=2;}
else{this.areaUnderMouse=0;}}
this.menuLine=Math.floor((this.worldDY-5.4)/1.2);}
return true;}
onLayoutChange(windowLayout){this.windowLayout=windowLayout;}}
const MERGE_DOWN=1;const MERGE_IN_PLACE=2;const MERGE_TO_13=3;class World
{constructor(controls){this.controls=controls;this.grid=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,0,0,0,0,0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.tiles=[{x:2,y:2,value:2,moving:0,merging:0},{x:3,y:2,value:0,moving:0,merging:0},{x:4,y:2,value:4,moving:0,merging:0},{x:5,y:2,value:8,moving:0,merging:0},{x:3,y:4,value:13,moving:0,merging:0}];this.waitingLine=[false,false,false,false,false];this.combos=[];this.orientation=0;this.moves=0;this.fallingDown=false;this.merging=false;this.mergingTo13=false;this.gameInProgress=false;this.animationInProgress=false;this.currentMove=-1;this.saveGameListeners=[];}
startNewGame(){this.grid=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0];this.tiles=[{x:1,y:5,value:4,moving:0,merging:0}];this.waitingLine=[false,false,false,false,false];this.combos=[];this.orientation=0;this.currentMessage=0;this.moves=0;this.fallingDown=false;this.merging=false;this.mergingTo13=false;this.gameInProgress=true;this.animationInProgress=false;this.currentMove=-1;this.addTileToQueue();}
loadGame(gameProgress){this.grid=gameProgress.grid.slice();this.tiles=[];gameProgress.tiles.forEach(tile=>{this.tiles.push(structuredClone(tile));});this.waitingLine=[];gameProgress.waitingLine.forEach(square=>{this.waitingLine.push(structuredClone(square));});this.orientation=gameProgress.orientation;this.gameInProgress=true;}
addTileToQueue(){let randomX=Math.floor(5*Math.random());let randomValue=Math.random();for(let x=0;x<5;++x){let tileX=(randomX+x)%5;if(!this.waitingLine[tileX]) {this.waitingLine[tileX]={value:randomValue>.9?4:(randomValue>.5?2:1),y:-1.5,speedY:0,targetY:-1.5}
return true;}}
return false;}
beginFall(){let bottomLeftSquare=[36,8,12,40][this.orientation];let up=[-7,1,7,-1][this.orientation]
let right=[1,7,-1,-7][this.orientation];for(let column=0;column<5;++column){let freeSquares=0,lastValue=0,willMerge=false;for(let row=0;row<5;++row){let tileId=this.grid[bottomLeftSquare+column*right+row*up]-1;if(tileId>=0){this.tiles[tileId].speedX=0;this.tiles[tileId].speedY=0;this.tiles[tileId].targetX=this.tiles[tileId].x+freeSquares*[0,-1,0,1][this.orientation];this.tiles[tileId].targetY=this.tiles[tileId].y+freeSquares*[1,0,-1,0][this.orientation];this.tiles[tileId].moving=freeSquares;willMerge=willMerge|| (lastValue==this.tiles[tileId].value);lastValue=this.tiles[tileId].value;}else{++freeSquares;}}
if(this.waitingLine[column]){let topTileId=this.grid[bottomLeftSquare+column*right+4*up]-1;willMerge=willMerge||(topTileId>-1&&this.tiles[topTileId].value==this.waitingLine[column].value);if(freeSquares||willMerge){this.waitingLine[column].targetY=freeSquares;}}}
this.fallingDown=this.animationInProgress=true;}
triggerMerge(){let removedTiles=[];let bottomLeftSquare=[36,8,12,40][this.orientation];let up=[-7,1,7,-1][this.orientation]
let right=[1,7,-1,-7][this.orientation];let deltaX=[0,-1,0,1][this.orientation];let deltaY=[1,0,-1,0][this.orientation];for(let column=0;column<5;++column){let tileBelow=this.grid[bottomLeftSquare+column*right]-1;let merges=0;for(let row=1;row<6;++row){let tileId=this.grid[bottomLeftSquare+column*right+row*up]-1;if(tileId>=0){if(tileBelow>=0&&this.tiles[tileId].value==this.tiles[tileBelow].value&&!this.tiles[tileBelow].merging){this.tiles[tileBelow].merging=MERGE_IN_PLACE;this.tiles[tileBelow].targetX=this.tiles[tileBelow].x+merges*deltaX;this.tiles[tileBelow].targetY=this.tiles[tileBelow].y+merges*deltaY;this.tiles[tileBelow].speedX+=.1*merges*deltaX;this.tiles[tileBelow].speedY+=.1*merges*deltaY;this.tiles[tileBelow].targetValue=2*this.tiles[tileId].value;this.tiles[tileBelow].deltaValue=.1*this.tiles[tileId].value;this.tiles[tileBelow].mergeStep=10;this.tiles[tileBelow].dx=this.tiles[tileId].x-this.tiles[tileBelow].x;this.tiles[tileBelow].dy=this.tiles[tileId].y-this.tiles[tileBelow].y;this.tiles[tileId].merging=MERGE_DOWN;++merges;removedTiles.push(tileId);}else{this.tiles[tileId].targetX=this.tiles[tileId].x+merges*deltaX;this.tiles[tileId].targetY=this.tiles[tileId].y+merges*deltaY;this.tiles[tileId].speedX+=.1*merges*deltaX;this.tiles[tileId].speedY+=.1*merges*deltaY;this.tiles[tileId].moving=(merges>0);this.tiles[tileId].targetValue=this.tiles[tileId].value;this.tiles[tileId].deltaValue=0;}}
tileBelow=tileId;}}
removedTiles.sort((a,b)=>b-a);removedTiles.forEach(tileIndex=>{this.tiles.splice(tileIndex,1);});return removedTiles.length>0;}
recordCombo(id0,id1,id2){this.combos.push({x0:this.tiles[id0].x,y0:this.tiles[id0].y,v0:this.tiles[id0].value,x1:this.tiles[id1].x,y1:this.tiles[id1].y,v1:this.tiles[id1].value,x2:this.tiles[id2].x,y2:this.tiles[id2].y,v2:this.tiles[id2].value,step:20});}
checkFor13(){let removedTiles=[];for(let column=0;column<5;++column){for(let row=0;row<5;++row){let tileLeft=this.grid[7+column+7*row]-1;let tileCenter=this.grid[8+column+7*row]-1;let tileRight=this.grid[9+column+7*row]-1;if(tileLeft>-1&&tileCenter>-1&&tileRight>-1){if(this.tiles[tileLeft].value+this.tiles[tileCenter].value+this.tiles[tileRight].value==13){this.recordCombo(tileLeft,tileCenter,tileRight);this.tiles[tileCenter].merging=MERGE_TO_13;this.tiles[tileCenter].value=13;this.grid[7+column+7*row]=0;this.grid[9+column+7*row]=0;removedTiles.push(tileLeft,tileRight);}}
let tileAbove=this.grid[1+column+7*row]-1;let tileBelow=this.grid[15+column+7*row]-1;if(tileAbove>-1&&tileCenter>-1&&tileBelow>-1){if(this.tiles[tileAbove].value+this.tiles[tileCenter].value+this.tiles[tileBelow].value==13){this.recordCombo(tileAbove,tileCenter,tileBelow);this.tiles[tileCenter].merging=MERGE_TO_13;this.tiles[tileCenter].value=13;this.grid[1+column+7*row]=0;this.grid[15+column+7*row]=0;removedTiles.push(tileAbove,tileBelow);}}}}
removedTiles.sort((a,b)=>b-a);removedTiles.forEach(tileIndex=>{this.tiles.splice(tileIndex,1);});return removedTiles.length>0;}
animateItems(){if(this.fallingDown){let stillMoving=false;let accelX=.03*[0,-1,0,1][this.orientation];let accelY=.03*[1,0,-1,0][this.orientation];this.tiles.forEach(tile=>{if(tile.moving){tile.speedX+=accelX;tile.speedY+=accelY;tile.x+=tile.speedX;tile.y+=tile.speedY;if((tile.targetX-tile.x)*tile.speedX<0||(tile.targetY-tile.y)*tile.speedY<0){tile.x=tile.targetX;tile.y=tile.targetY;tile.speedX=tile.speedY=0;tile.moving=false;}}
stillMoving=stillMoving|tile.moving;});this.waitingLine.forEach((tile,column)=>{if(tile&&tile.targetY>tile.y){tile.speedY+=.03
tile.y+=tile.speedY;if(tile.y>=tile.targetY){let newTile={x:[column+1,6-tile.targetY,5-column,tile.targetY][this.orientation],y:[tile.targetY,column+1,6-tile.targetY,5-column][this.orientation],speedX:0,speedY:0,targetX:[column+1,6-tile.targetY,5-column,tile.targetY][this.orientation],targetY:[tile.targetY,column+1,6-tile.targetY,5-column][this.orientation],moving:false,value:tile.value}
this.tiles.push(newTile);this.waitingLine[column]=false;}else{stillMoving=true;}}});this.fallingDown=stillMoving;if(!stillMoving){this.grid=this.grid.map(i=>Math.min(i,0));this.tiles.forEach((tile,index)=>{this.grid[tile.x+tile.y*7]=index+1;});this.merging=this.triggerMerge();}}
if(this.merging){let stillMerging=false;this.tiles.forEach((tile,index)=>{if(tile.moving|| tile.merging){tile.x+=tile.speedX;tile.y+=tile.speedY;tile.value+=tile.deltaValue;if(tile.mergeStep){--tile.mergeStep;}
if(tile.moving&&((tile.targetX-tile.x)*tile.speedX<0||(tile.targetY-tile.y)*tile.speedY<0)){tile.x=tile.targetX;tile.y=tile.targetY;tile.speedX=tile.speedY=0;tile.moving=false;}
if(tile.merging&&tile.mergeStep<1){tile.value=tile.targetValue;tile.merging=0;}
stillMerging=stillMerging||tile.moving|| tile.merging;}});this.merging=stillMerging;if(!this.merging){this.grid=this.grid.map(i=>Math.min(i,0));this.tiles.forEach((tile,index)=>{this.grid[tile.x+tile.y*7]=index+1;});this.merging=this.triggerMerge();if(!this.merging){this.mergingTo13=this.checkFor13();}}}
if(this.mergingTo13){this.mergingTo13=false;this.combos.forEach(combo=>{combo.step=Math.max(0,combo.step-1);this.mergingTo13=this.mergingTo13|| (combo.step>0);});if(!this.mergingTo13){this.combos=[];this.grid=this.grid.map(i=>Math.min(i,0));this.tiles.forEach((tile,index)=>{tile.merging=0;this.grid[tile.x+tile.y*7]=index+1;});this.beginFall();}}
if(this.animationInProgress&&!this.mergingTo13&&!this.merging&&!this.fallingDown){this.animationInProgress=false;this.gameInProgress=this.addTileToQueue();}}
processControls(){if(this.currentMessage){if(this.controls.mouseLeftButton|| this.controls.controlLeft|| this.controls.controlFire||this.controls.controlRight||this.controls.controlUp|| this.controls.controlsDown){this.currentMessage=0;}}else if(!this.animationInProgress){this.currentMove=this.controls.mouseLeftButton?this.controls.areaUnderMouse:-1;if(this.controls.controlLeft){this.currentMove=3;}
if(this.controls.controlRight){this.currentMove=1;}
if(this.controls.controlUp){this.currentMove=2;}
if(this.controls.controlDown){this.currentMove=0;}
if(this.currentMove>-1){this.orientation=(this.orientation+this.currentMove)&3;++this.moves;this.beginFall();}}
this.controls.totalClear();}
addSaveGameListener(listener){this.saveGameListeners.push(listener);}
saveGame(){let tilesClone=[];this.tiles.forEach(tile=>{tilesClone.push(structuredClone(tile));});let waitingLineClone=[];this.waitingLine.forEach(square=>{waitingLineClone.push(structuredClone(square));});let gridClone=this.grid.slice();for(let i=0;i<this.saveGameListeners.length;++i){this.saveGameListeners[i].notifySave(gridClone,tilesClone,waitingLineClone,this.orientation);}}}
class Game
{constructor(controls,savedData){this.controls=controls;this.mainMenu=new MenuDriver(5,controls);this.persistentData={musicOn:true};this.savedGame=false;if(savedData.hasOwnProperty('gameProgress')){this.savedGame=savedData.gameProgress;}
if(savedData.hasOwnProperty('musicOn')){this.persistentData.musicOn=savedData.musicOn;}
this.world=new World(controls);this.mainMenu.setEnabled(0,false);this.mainMenu.setEnabled(1,this.savedGame?true:false);this.mainMenu.setEnabled(3,false);this.world.addSaveGameListener(this);this.state=-1;let musicPlayer=new CPlayer();musicPlayer.init(song);let progress=0;while(progress<1){progress=musicPlayer.generate();}
this.audioMusic=new Audio(URL.createObjectURL(new Blob([musicPlayer.createWave()],{type:"audio/wav"})));this.audioMusic.loop=true;if(this.persistentData.musicOn){this.audioMusic.play();}}
launch(){this.changeState(0);this.intervalId=setInterval(function(){game.mainLoop();},40);requestAnimationFrame(function(){game.renderLoop();});}
changeState(newState){this.controls.totalClear();if(newState==0){this.mainMenu.setEnabled(0,this.world.gameInProgress);this.mainMenu.initialize();}
this.state=newState;}
mainLoop(){if(this.state==0)
{if(this.world.gameInProgress){this.world.animateItems();}
this.mainMenu.processEvents();if(this.mainMenu.done){switch(this.mainMenu.selectedLine){case 2:this.world.startNewGame();case 0:this.changeState(2);break;case 1:this.world.loadGame(this.savedGame);this.changeState(2);break;case 3:this.world.saveGame();this.mainMenu.setEnabled(1,true);this.renderer.setSaved(true);break;case 4:this.toggleMusic();break;}}}
if(this.state==1||this.state==2){this.renderer.setGameOver(false);this.renderer.setSaved(false);this.mainMenu.setEnabled(3,true);if(this.controls.controlEscape){this.changeState(0);}
this.world.processControls();this.world.animateItems();if(!this.world.gameInProgress){this.renderer.setGameOver(true);this.changeState(0);}}}
renderLoop(){this.renderer.drawMain(this.state==0,this.mainMenu);if(this.state==0){this.renderer.drawMainMenu(this.mainMenu);}
requestAnimationFrame(function(){game.renderLoop();});}
setRenderer(renderer){this.renderer=renderer;}
toggleMusic(){this.persistentData.musicOn=!this.persistentData.musicOn;if(this.persistentData.musicOn){this.audioMusic.play();}else{this.audioMusic.pause();}
this.writeToStorage();}
notifySave(grid,tiles,waitingLine,orientation){this.savedGame={grid:grid,tiles:tiles,waitingLine:waitingLine,orientation:orientation};this.persistentData.gameProgress=this.savedGame;this.writeToStorage();}
writeToStorage(){localStorage.setItem("2048over13Data",JSON.stringify(this.persistentData));}
layoutChanged(windowLayout){this.controls.onLayoutChange(windowLayout);}}
function main(){controls=new Controls();if('ontouchstart'in document.documentElement){document.ontouchstart=function(event){return controls.onTouchStart(event);}
document.ontouchenter=function(event){return controls.onTouchStart(event);}
document.ontouchend=function(event){return controls.onTouchEnd(event);}
document.ontouchleave=function(event){return controls.onTouchEnd(event);}
document.ontouchmove=function(event){return controls.onTouchMove(event);}}else{document.onmousedown=function(event){return controls.onMouseDown(event);}
document.onmouseup=function(event){return controls.onMouseUp(event);}
document.onmousemove=function(event){return controls.onMouseMove(event);}}
document.onkeydown=function(event){return controls.onKeyDown(event);}
document.onkeyup=function(event){return controls.onKeyUp(event);}
var recordedDataString=localStorage.getItem("2048over13Data");var recordedData={};if(recordedDataString){recordedData=JSON.parse(recordedDataString);}
game=new Game(controls,recordedData);renderer=new Renderer(document.getElementById("c"),document.getElementById("s"),game);window.addEventListener('resize',function(event){renderer.resizeWindow();});game.setRenderer(renderer);game.launch();}
window.addEventListener('load',main);class MenuDriver
{constructor(lineCount,controls){this.controls=controls;this.columnCount=1;this.lineCount=lineCount;this.enabledLines=new Array(lineCount);this.enabledLines.fill(true);this.initialize();}
initialize(){this.done=false;this.selectedLine=this.enabledLines.findIndex(i=>i);this.controls.totalClear();}
setEnabled(line,value){this.enabledLines[line]=value;}
getSelectedOption(){return this.selectedLine;}
processEvents(){this.done=false;let nextLine=this.selectedLine;if(this.controls.controlUp){while(--nextLine>-1&&!this.enabledLines[nextLine]){}}
if(this.controls.controlDown){while(++nextLine<this.lineCount&&!this.enabledLines[nextLine]){}}
if(nextLine>-1&&nextLine<this.lineCount){this.selectedLine=nextLine;}
if(this.controls.menuLine>-1&&this.controls.menuLine<this.lineCount){if(this.enabledLines[this.controls.menuLine]){this.selectedLine=this.controls.menuLine;}}
if(this.controls.mouseLeftButton||this.controls.controlFire){this.done=true;}
this.controls.totalClear();}}"use strict";var CPlayer=function(){var osc_sin=function(value){return Math.sin(value*6.283184);};var osc_saw=function(value){return 2*(value%1)-1;};var osc_square=function(value){return(value%1)<0.5?1:-1;};var osc_tri=function(value){var v2=(value%1)*4;if(v2<2)return v2-1;return 3-v2;};var getnotefreq=function(n){return 0.003959503758*(2**((n-128)/12));};var createNote=function(instr,n,rowLen){var osc1=mOscillators[instr.i[0]],o1vol=instr.i[1],o1xenv=instr.i[3]/32,osc2=mOscillators[instr.i[4]],o2vol=instr.i[5],o2xenv=instr.i[8]/32,noiseVol=instr.i[9],attack=instr.i[10]*instr.i[10]*4,sustain=instr.i[11]*instr.i[11]*4,release=instr.i[12]*instr.i[12]*4,releaseInv=1/release,expDecay=-instr.i[13]/16,arp=instr.i[14],arpInterval=rowLen*(2**(2-instr.i[15]));var noteBuf=new Int32Array(attack+sustain+release);var c1=0,c2=0;var j,j2,e,t,rsample,o1t,o2t;for(j=0,j2=0;j<attack+sustain+release;j++,j2++){if(j2>=0){arp=(arp>>8)|((arp&255)<<4);j2-=arpInterval;o1t=getnotefreq(n+(arp&15)+instr.i[2]-128);o2t=getnotefreq(n+(arp&15)+instr.i[6]-128)*(1+0.0008*instr.i[7]);}
e=1;if(j<attack){e=j/attack;}else if(j>=attack+sustain){e=(j-attack-sustain)*releaseInv;e=(1-e)*(3**(expDecay*e));}
c1+=o1t*e**o1xenv;rsample=osc1(c1)*o1vol;c2+=o2t*e**o2xenv;rsample+=osc2(c2)*o2vol;if(noiseVol){rsample+=(2*Math.random()-1)*noiseVol;}
noteBuf[j]=(80*rsample*e)|0;}
return noteBuf;};var mOscillators=[osc_sin,osc_square,osc_saw,osc_tri];var mSong,mLastRow,mCurrentCol,mNumWords,mMixBuf;this.init=function(song){mSong=song;mLastRow=song.endPattern;mCurrentCol=0;mNumWords=song.rowLen*song.patternLen*(mLastRow+1)*2;mMixBuf=new Int32Array(mNumWords);};this.generate=function(){var i,j,b,p,row,col,n,cp,k,t,lfor,e,x,rsample,rowStartSample,f,da;var chnBuf=new Int32Array(mNumWords),instr=mSong.songData[mCurrentCol],rowLen=mSong.rowLen,patternLen=mSong.patternLen;var low=0,band=0,high;var lsample,filterActive=false;var noteCache=[];for(p=0;p<=mLastRow;++p){cp=instr.p[p];for(row=0;row<patternLen;++row){var cmdNo=cp?instr.c[cp-1].f[row]:0;if(cmdNo){instr.i[cmdNo-1]=instr.c[cp-1].f[row+patternLen]||0;if(cmdNo<17){noteCache=[];}}
var oscLFO=mOscillators[instr.i[16]],lfoAmt=instr.i[17]/512,lfoFreq=(2**(instr.i[18]-9))/rowLen,fxLFO=instr.i[19],fxFilter=instr.i[20],fxFreq=instr.i[21]*43.23529*3.141592/44100,q=1-instr.i[22]/255,dist=instr.i[23]*1e-5,drive=instr.i[24]/32,panAmt=instr.i[25]/512,panFreq=6.283184*(2**(instr.i[26]-9))/rowLen,dlyAmt=instr.i[27]/255,dly=instr.i[28]*rowLen&~1;rowStartSample=(p*patternLen+row)*rowLen;for(col=0;col<4;++col){n=cp?instr.c[cp-1].n[row+col*patternLen]:0;if(n){if(!noteCache[n]){noteCache[n]=createNote(instr,n,rowLen);}
var noteBuf=noteCache[n];for(j=0,i=rowStartSample*2;j<noteBuf.length;j++,i+=2){chnBuf[i]+=noteBuf[j];}}}
for(j=0;j<rowLen;j++){k=(rowStartSample+j)*2;rsample=chnBuf[k];if(rsample||filterActive){f=fxFreq;if(fxLFO){f*=oscLFO(lfoFreq*k)*lfoAmt+0.5;}
f=1.5*Math.sin(f);low+=f*band;high=q*(rsample-band)-low;band+=f*high;rsample=fxFilter==3?band:fxFilter==1?high:low;if(dist){rsample*=dist;rsample=rsample<1?rsample>-1?osc_sin(rsample*.25):-1:1;rsample/=dist;}
rsample*=drive;filterActive=rsample*rsample>1e-5;t=Math.sin(panFreq*k)*panAmt+0.5;lsample=rsample*(1-t);rsample*=t;}else{lsample=0;}
if(k>=dly){lsample+=chnBuf[k-dly+1]*dlyAmt;rsample+=chnBuf[k-dly]*dlyAmt;}
chnBuf[k]=lsample|0;chnBuf[k+1]=rsample|0;mMixBuf[k]+=lsample|0;mMixBuf[k+1]+=rsample|0;}}}
mCurrentCol++;return mCurrentCol/mSong.numChannels;};this.createAudioBuffer=function(context){var buffer=context.createBuffer(2,mNumWords/2,44100);for(var i=0;i<2;i++){var data=buffer.getChannelData(i);for(var j=i;j<mNumWords;j+=2){data[j>>1]=mMixBuf[j]/65536;}}
return buffer;};this.createWave=function(){var headerLen=44;var l1=headerLen+mNumWords*2-8;var l2=l1-36;var wave=new Uint8Array(headerLen+mNumWords*2);wave.set([82,73,70,70,l1&255,(l1>>8)&255,(l1>>16)&255,(l1>>24)&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,l2&255,(l2>>8)&255,(l2>>16)&255,(l2>>24)&255]);for(var i=0,idx=headerLen;i<mNumWords;++i){var y=mMixBuf[i];y=y<-32767?-32767:(y>32767?32767:y);wave[idx++]=y&255;wave[idx++]=(y>>8)&255;}
return wave;};this.getData=function(t,n){var i=2*Math.floor(t*44100);var d=new Array(n);for(var j=0;j<2*n;j+=1){var k=i+j;d[j]=t>0&&k<mMixBuf.length?mMixBuf[k]/32768:0;}
return d;};};class Renderer
{constructor(sceneryCanvas,spriteImg,game){this.game=game;this.engine=game.world;this.sceneryCanvas=sceneryCanvas;this.sceneryContext=sceneryCanvas.getContext("2d");this.windowLayout={width:140,height:200};this.mainMenuText=["RESUME","LOAD GAME","NEW GAME","SAVE GAME","MUSIC "];this.spriteImg=spriteImg;this.sceneryContext.save();this.resizeWindow();this.targetOrientation=this.orientation=0;this.frameCount=0;}
resizeWindow(){let refWidth=Math.min(innerWidth,Math.floor(innerHeight*.7));let refHeight=Math.floor(refWidth/.7);this.sceneryCanvas.width=refWidth;this.sceneryCanvas.height=refHeight;this.sceneryCanvas.style.width=refWidth+"px";this.sceneryCanvas.style.height=refHeight+"px";this.sceneryCanvas.style.marginLeft=-(refWidth>>1)+"px";this.sceneryCanvas.style.top=((innerHeight-refHeight)>>1)+"px";this.sceneryContext.restore();this.sceneryContext.save();this.sceneryContext.translate(refWidth>>1,refHeight>>1);this.sceneryContext.scale(refWidth/16,refWidth/16);this.windowLayout.width=refWidth;this.windowLayout.height=refHeight;this.game.layoutChanged(this.windowLayout);}
drawShadedText(text,x,y)
{this.sceneryContext.shadowOffsetX=-1;this.sceneryContext.shadowOffsetY=-1;this.sceneryContext.fillText(text,x,y);this.sceneryContext.shadowOffsetX=2;this.sceneryContext.shadowOffsetY=2;this.sceneryContext.fillText(text,x,y);}
outlineText(text,x,y,size){this.sceneryContext.font=size+"px cursive";this.sceneryContext.strokeText(text,x,y);this.sceneryContext.fillText(text,x,y);}
drawMain(showMenu,menu){this.drawPlayfield(showMenu);if(showMenu){this.drawMainMenu(menu);}
++this.frameCount;}
drawOneTile(x,y,value,rotateText,dx,dy,step){let tileColor="#c0f";if(value%13){tileColor=["#fec","#fc8","#fa4","#f80","#c84","#888","#48c","#08f","#04f","#00f","#00c","#008","#004"][Math.round(Math.log(value)/Math.log(2))];}
let leftX=Math.min(x,x+dx*step/10);let topY=Math.min(y,y+dy*step/10);let width=1+Math.abs(dx)*step/10;let height=1+Math.abs(dy)*step/10;this.sceneryContext.fillStyle=tileColor;this.sceneryContext.beginPath();this.sceneryContext.roundRect(leftX*2-7+.02,topY*2-7+.02,width*2-.04,height*2-.04,.2);this.sceneryContext.fill();this.sceneryContext.fillStyle="#fff";this.sceneryContext.fillRect(leftX*2-7+.15,topY*2-7+.15,width*2-.3,height*2-.3);this.sceneryContext.fillStyle=tileColor;this.sceneryContext.fillRect(leftX*2-7+.3,topY*2-7+.3,width*2-.6,height*2-.6);this.sceneryContext.save();this.sceneryContext.fillStyle="#000";this.sceneryContext.translate(x*2-7+1,y*2-7+1);this.sceneryContext.textAlign="center";this.sceneryContext.textBaseline="middle";if(rotateText){this.sceneryContext.rotate(this.orientation*Math.PI/2);}
this.sceneryContext.scale(.05,.05);this.sceneryContext.fillText(Math.round(value),0,0);this.sceneryContext.restore();}
drawCombo(combo){let step=combo.step;let alpha=Math.min(1,step/10);let beta=Math.max(0,step/10-1);let leftX=combo.x0*alpha+combo.x1*(1-alpha);let topY=combo.y0*alpha+combo.y1*(1-alpha);let width=1+(combo.x2-combo.x0)*alpha;let height=1+(combo.y2-combo.y0)*alpha;let tileColor=step>10?"#ff0":"rgb("+(195+6*step)+","+(25*step)+","+(255-25*step)+")";this.sceneryContext.fillStyle=tileColor;this.sceneryContext.beginPath();this.sceneryContext.roundRect(leftX*2-7+.02,topY*2-7+.02,width*2-.04,height*2-.04,.2);this.sceneryContext.fill();this.sceneryContext.fillStyle="#fff";this.sceneryContext.fillRect(leftX*2-7+.15,topY*2-7+.15,width*2-.3,height*2-.3);this.sceneryContext.fillStyle=tileColor;this.sceneryContext.fillRect(leftX*2-7+.3,topY*2-7+.3,width*2-.6,height*2-.6);this.sceneryContext.textAlign="center";this.sceneryContext.textBaseline="middle";if(step>10){this.sceneryContext.save();this.sceneryContext.fillStyle="#000";this.sceneryContext.translate(combo.x0*2-7+1,combo.y0*2-7+1);this.sceneryContext.rotate(this.orientation*Math.PI/2);this.sceneryContext.scale(.05,.05);this.sceneryContext.fillText(Math.round(beta*combo.v0),0,0);this.sceneryContext.restore();this.sceneryContext.save();this.sceneryContext.fillStyle="#000";this.sceneryContext.translate(combo.x2*2-7+1,combo.y2*2-7+1);this.sceneryContext.rotate(this.orientation*Math.PI/2);this.sceneryContext.scale(.05,.05);this.sceneryContext.fillText(Math.round(beta*combo.v2),0,0);this.sceneryContext.restore();}
this.sceneryContext.save();this.sceneryContext.fillStyle="#000";this.sceneryContext.translate(combo.x1*2-7+1,combo.y1*2-7+1);this.sceneryContext.rotate(this.orientation*Math.PI/2);this.sceneryContext.scale(.05,.05);this.sceneryContext.fillText(Math.round(combo.v1+(1-beta)*(combo.v0+combo.v2)),0,0);this.sceneryContext.restore();}
drawPlayfield(showMenu){this.sceneryContext.fillStyle="#fed";this.sceneryContext.fillRect(-8,-16,16,32);if(showMenu){this.sceneryContext.filter="blur(4px)";}else{this.sceneryContext.fillStyle="#f87";switch(this.game.controls.areaUnderMouse){case 0:this.sceneryContext.fillRect(-3,9.65,6,2.35);break;case 1:this.sceneryContext.beginPath();this.sceneryContext.arc(0,0,7.4,.996,.342,true);this.sceneryContext.lineTo(8,7.4*Math.sin(.342));this.sceneryContext.lineTo(8,9);this.sceneryContext.lineTo(7.4*Math.cos(.996),9);this.sceneryContext.fill();break;case 2:this.sceneryContext.beginPath();this.sceneryContext.arc(0,0,7.4,1.15,1.99);this.sceneryContext.lineTo(-3,9.65);this.sceneryContext.lineTo(3,9.65);this.sceneryContext.fill();break;case 3:this.sceneryContext.beginPath();this.sceneryContext.arc(0,0,7.4,2.146,2.8);this.sceneryContext.lineTo(-8,7.4*Math.sin(2.8));this.sceneryContext.lineTo(-8,9);this.sceneryContext.lineTo(7.4*Math.cos(2.146),9);this.sceneryContext.fill();break;default:break;}}
this.sceneryContext.drawImage(this.spriteImg,0,0,32,32,-7,6.5,1,1);this.sceneryContext.drawImage(this.spriteImg,32,0,32,32,6,6.5,1,1);this.sceneryContext.drawImage(this.spriteImg,64,0,32,32,-.5,8,1,1);this.sceneryContext.drawImage(this.spriteImg,96,0,32,32,-.5,10,1,1);for(let i=0;i<2;++i){this.sceneryContext.fillStyle=this.engine.currentMove==[3,1][i]?"#f00":"#600";this.sceneryContext.strokeStyle="#000";this.sceneryContext.beginPath();this.sceneryContext.arc(0,0,8.2,.7*Math.PI,.8*Math.PI);this.sceneryContext.lineTo(8*Math.cos(.8*Math.PI),8*Math.sin(.8*Math.PI));this.sceneryContext.lineTo(8.4*Math.cos(.83*Math.PI),8.4*Math.sin(.83*Math.PI));this.sceneryContext.lineTo(8.8*Math.cos(.8*Math.PI),8.8*Math.sin(.8*Math.PI));this.sceneryContext.arc(0,0,8.6,.8*Math.PI,.7*Math.PI,true);this.sceneryContext.lineTo(8.2*Math.cos(.7*Math.PI),8.2*Math.sin(.7*Math.PI));this.sceneryContext.fill();this.sceneryContext.stroke();this.sceneryContext.fillStyle=this.engine.currentMove==2?"#f00":"#600";this.sceneryContext.beginPath();this.sceneryContext.arc(0,8.5,1.3,.7*Math.PI,1.2*Math.PI);this.sceneryContext.lineTo(1.5*Math.cos(1.2*Math.PI),8.5+1.5*Math.sin(1.2*Math.PI));this.sceneryContext.lineTo(1.1*Math.cos(1.35*Math.PI),8.5+1.1*Math.sin(1.35*Math.PI));this.sceneryContext.lineTo(.7*Math.cos(1.2*Math.PI),8.5+.7*Math.sin(1.2*Math.PI));this.sceneryContext.arc(0,8.5,.9,1.2*Math.PI,.7*Math.PI,true);this.sceneryContext.lineTo(1.3*Math.cos(.7*Math.PI),8.5+1.3*Math.sin(.7*Math.PI));this.sceneryContext.fill();this.sceneryContext.stroke();this.sceneryContext.fillStyle=this.engine.currentMove==0?"#f00":"#600";this.sceneryContext.beginPath();this.sceneryContext.moveTo(1.3,9.8);this.sceneryContext.lineTo(1.3,10.8);this.sceneryContext.lineTo(1.5,10.8);this.sceneryContext.lineTo(1.1,11.3);this.sceneryContext.lineTo(.7,10.8);this.sceneryContext.lineTo(.9,10.8);this.sceneryContext.lineTo(.9,9.8);this.sceneryContext.lineTo(1.3,9.8);this.sceneryContext.fill();this.sceneryContext.stroke();this.sceneryContext.scale(-1,1);}
this.sceneryContext.filter="none";this.targetOrientation=this.engine.orientation;if(this.targetOrientation>this.orientation+2.5){this.targetOrientation-=4;}
if(this.targetOrientation<this.orientation-2.5){this.targetOrientation+=4;}
if(Math.abs(this.targetOrientation-this.orientation)<.04){this.orientation=this.targetOrientation=this.engine.orientation;}else{let headingRate=(this.targetOrientation>this.orientation)?.04:-.04;this.orientation+=headingRate;}
this.sceneryContext.strokeStyle="#444";this.sceneryContext.lineWidth=.04;for(let x=0;x<6;++x){this.sceneryContext.beginPath();this.sceneryContext.moveTo(x*2-5,-10);this.sceneryContext.lineTo(x*2-5,-8);this.sceneryContext.stroke();if(x<2){this.sceneryContext.beginPath();this.sceneryContext.moveTo(-5,x*2-10);this.sceneryContext.lineTo(5,x*2-10);this.sceneryContext.stroke();}}
for(let x=0;x<5;++x){if(this.engine.waitingLine[x]){this.drawOneTile(x+1,this.engine.waitingLine[x].y,this.engine.waitingLine[x].value,false,0,0,0);}}
this.sceneryContext.save();this.sceneryContext.rotate(-this.orientation*Math.PI/2);for(let x=0;x<6;++x){this.sceneryContext.beginPath();this.sceneryContext.moveTo(x*2-5,-5);this.sceneryContext.lineTo(x*2-5,5);this.sceneryContext.stroke();this.sceneryContext.beginPath();this.sceneryContext.moveTo(-5,x*2-5);this.sceneryContext.lineTo(5,x*2-5);this.sceneryContext.stroke();}
this.sceneryContext.beginPath();this.sceneryContext.arc(0,0,7.35,0,2*Math.PI);this.sceneryContext.stroke();this.engine.tiles.forEach(tile=>{if(tile.merging!=MERGE_TO_13)
this.drawOneTile(tile.x,tile.y,tile.value,true,tile.dx?tile.dx:0,tile.dy?tile.dy:0,tile.mergeStep?tile.mergeStep:0);});this.engine.combos.forEach(combo=>{this.drawCombo(combo);});this.sceneryContext.restore();}
setGameOver(gameOver){this.mainMenuText[0]=gameOver?"GAME OVER":"RESUME";}
setSaved(saved){this.mainMenuText[3]=saved?"SAVED":"SAVE GAME";}
drawMainMenu(menu){this.sceneryContext.save();var highlightColor="#fff";var gray=Math.round(20+20*Math.cos(this.frameCount/50));this.sceneryContext.lineWidth=.1;this.sceneryContext.textAlign="center";for(var index=0;index<5;++index){var text=this.mainMenuText[index];if(index==4){text+=this.game.persistentData.musicOn?"ON":"OFF";}
this.sceneryContext.fillStyle=(menu.selectedLine==index?highlightColor:(menu.enabledLines[index]?"#aaa":(text=="GAME OVER"?"#C00":"#888")));this.sceneryContext.strokeStyle="hsl(0,0%,"+(menu.selectedLine==index?gray:(menu.enabledLines[index]?0:50))+"%)";this.outlineText(text,0,index*1.2+6,1.1);}
this.sceneryContext.restore();}}
var song={songData:[{i:[2,40,140,64,0,0,140,0,0,255,5,0,67,104,0,0,0,0,0,0,3,161,192,0,32,0,0,52,1],p:[,11,1,2,3,4,3,4,5,6,7,8,7,8,9,9,10,10,7,8,7,8,9,9,5,6,3,4,3,4,3,4,3,4,3,4,3,4,3,4,3,4,3,4,3,4,3,4,3,4,5,6,9,9,10,10,3,4,3,4],c:[{n:[,154,147,152,,154,147,152,,154,147,152,,154,147,152,,154,147,152,,154,147,152,,154,147,152,,154,147,152],f:[]},{n:[,154,147,152,,154,147,152,,154,147,152,,154,147,152,,154,,152,,,147,152,,,147],f:[]},{n:[,154,147,152,,,147,152,,154,147,152,,,147,152,,154,147,152,,,147,152,,154,147,152,,,147],f:[]},{n:[,154,147,152,,,147,152,,154,147,152,,,147,152,,154,147,152,,,147,,154,147,,154],f:[]},{n:[,154,147,152,,,147,152,,154,147,152,,,147,,,154,147,152,,,147,152,,154,147,152,,,147],f:[]},{n:[,156,156,,,156,156,156,156,156,156,156,,,156,,,156,156,,,,156],f:[]},{n:[151,151,151,151,,151,151,151,,151,151,151,151,151,151,151,151,151,151,151,,151,,151,151,151,151,151,151,151,151,151],f:[]},{n:[,151,151,151,151,151,,151,,151,,151,151,151,151,151,,151,,151,,151,,151,151,151,151,151,151,151,151,151],f:[]},{n:[,152,152,152,,152,152,,152,,,152,,152,,152,,152,152,152,,152,152,152,152,,,152,,152,152],f:[]},{n:[,154,147,152,,,147,,,154,,152,,,147,152,,154,147,152,,,147,152,,154,147,152,,,147],f:[]},{n:[,,,,,,,,,,,,,,,,154,154,154,154,154,154,154,154,147,156,152,156,147,156,152,156],f:[]}]},{i:[1,255,119,36,0,255,116,0,64,0,4,6,35,0,0,0,0,0,0,0,2,14,0,1,39,76,5,0,0],p:[,,1,2,3,4,3,4,5,6,,,,,7,8,9,9,,,,,7,8,5,6,3,4,3,4,3,4,3,4,3,4,3,4,3,4,3,4,3,4,3,4,3,4,3,4,5,6,7,8,9,9,3,4,3,4],c:[{n:[145,,,,145,,,,145,,,,145,,,,145,,,,145,,,,145,,,,145],f:[]},{n:[145,,,,145,,,,145,,,,145,,,,145,,,,145],f:[]},{n:[145,,,,,,,,145,,,,,,,,145,,,,,,,,145],f:[]},{n:[145,,,,,,,,145,,,,,,,,145,,,,,,,145,,,145],f:[]},{n:[145,,,,,,,,145,,,,,,,,145,,,,,,,,145,,,,,,,145],f:[]},{n:[145,,,,,,,,,,,,,,,,145],f:[]},{n:[145,,,,,,,145,,,145,,,,145,,145,,,,,,,,,145,145],f:[]},{n:[145,,,,,,,145,,,145,,,,,,145],f:[]},{n:[145,,,,,,,145,,,145,,,,,,145,,,,,,,,145],f:[]}]},{i:[0,221,128,64,0,210,128,0,64,255,4,6,73,79,0,0,0,64,7,1,3,195,15,0,32,20,0,24,6],p:[,,,1,2,3,2,3,4,5,6,6,6,6,7,8,2,2,6,6,6,6,7,8,4,5,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,2,3,4,5,7,8,2,2,2,3,2,3,,9],c:[{n:[,,,,,,,,,,,,,,,,,,158,,,158,,,158,158,,158,158,158,158,158],f:[]},{n:[,,,,154,,,,,,,,154,,,,,,,,154,,,,,,,,154,,,154],f:[]},{n:[,,,,154,,,,,,,,154,,,,,,,,154,,,,,,,,154,,154,154],f:[]},{n:[,,,,154,,,,,,,,154,,,154,,,,,154,,,,,,,,154],f:[]},{n:[,,,,154,,,,,,,,154,,,154,,,,,154,,,,154,154,154,154,154,154,154,154],f:[]},{n:[,,,,154,,,,,,,,154,,,,,,,,154,,,,,,,,154],f:[]},{n:[,,,,156,,,,,156,,,156,,,,,,,,156,,,,,,,,156,,,156],f:[]},{n:[,,,,156,,,,,156,,,156,,,156,,,,,156,,,156,,156,156,,156,,,156],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,154],f:[]}]},{i:[3,194,128,0,2,198,128,6,0,0,12,12,33,0,0,0,0,61,4,1,2,109,86,7,32,112,3,67,2],p:[,,1,2,1,2,1,2,3,4,5,6,5,6,7,8,9,10,5,6,5,6,7,8,3,4,1,2,1,2,1,2,1,2,1,2,1,2,1,2,1,2,11,12,11,12,1,2,1,2,3,4,7,8,9,10,11,12,11,12,11,13],c:[{n:[132,,132,,144,132,132,,,132,132,,144,132,132,,123,,123,,135,123,123,,,123,123,,135,123,123],f:[]},{n:[130,,130,,142,130,130,,,130,130,,142,130,130,,127,,127,,139,127,127,,,127,127,,139,127,127],f:[]},{n:[128,,128,,140,128,128,,,128,128,,140,128,128,,128,,128,,140,128,128,,,128,128,,140,128,128],f:[]},{n:[130,,130,,142,130,130,,,142,130,130,142,130,130,,134,,134,,146,134,134,,,146,134,134,146,134,134],f:[]},{n:[,135,147,135,,,142,147,135,135,147,135,,,142,147,,127,139,127,,,134,139,127,127,139,127,,,134,139],f:[]},{n:[,128,140,128,,,135,140,128,140,135,128,,,135,140,,130,142,130,,,137,142,134,134,146,134,,,134,146],f:[]},{n:[132,,132,,144,,132,132,,144,132,,144,,132,,131,,131,,143,,131,131,,143,131,,143,,131],f:[]},{n:[130,,130,,142,,130,130,,142,130,,142,,130,,129,,141,,153,,141,129,,129,141,,153,,141],f:[]},{n:[128,,128,,140,128,128,,,128,128,,140,128,128,,128,,128,,140,128,128,,,140,128,128,140,128,128],f:[]},{n:[130,,130,,142,130,130,,,130,130,,142,130,130,,130,,130,,142,130,130,,134,134,146,134,146,146,134,146],f:[]},{n:[128,,128,,140,128,128,,,128,128,,140,128,128,,130,,130,,142,130,130,,,130,130,,142,130,130],f:[]},{n:[127,,127,,139,127,127,,,127,127,,139,127,127,,132,,132,,144,132,132,,,132,144,132,130,130,142,130],f:[]},{n:[127,,127,,139,127,127,,,127,127,,139,127,127,,132,,132,,144,132,132,,,132,144,132,154],f:[]}]},{i:[2,183,128,0,1,178,128,14,0,0,3,45,35,0,0,0,0,0,0,0,2,11,21,0,45,75,4,24,2],p:[,,,,,,,,,,1,2,1,2,,,3,4,1,2,1,2,,,,,,,,,,,,,5,6,5,6,,,,,7,,7,,,,,,,,,,3,4,7,,7,,7],c:[{n:[135,,,147,,147,,135,147,,135,,,135],f:[]},{n:[128,,,140,,140,,128,140,,128,,,128,,,130,,142,,142,,130,142,,130,,,,130],f:[]},{n:[128,,,140,,140,,128,140,,128,,,128,,,128,,,140,,140,,128,140,,128,,,128],f:[]},{n:[130,,,142,,142,,130,142,,130,,,130,,,130,,,142,,142,,130,142,,130,,,130],f:[]},{n:[,,,,,,,,,,,,,,,,135,147,147,,147,147,,135,147,,135,,,135],f:[]},{n:[130,142,142,,142,142,,130,142,,130,,,142,130],f:[]},{n:[,,,,,,,,128,,,140,,,128,,,,,,,,,,130,,,142,,,130],f:[]}]},{i:[2,223,128,0,2,219,140,18,0,0,11,31,33,0,0,0,0,0,0,0,2,17,0,0,32,0,0,24,2],p:[,,,,,,,,,,1,,1,,,,,,1,,1,,,,,,,,,,,,,,2,3,2,3,,,,,,4,,4,,,,,,,,,,,,4,,4,,4],c:[{n:[,,,,,,,,,,,,,,,,127,,139,,139,,127,139,,127,,,,127],f:[]},{n:[132,144,144,,144,144,,132,144,,132,,,132],f:[]},{n:[,,,,,,,,,,,,,,,,127,139,139,,139,139,,127,139,,127,,,127],f:[]},{n:[,,,,,,,,127,,,139,,,127,,,,,,,,,,,132,144,132],f:[]}]},{i:[2,146,116,0,2,175,128,0,0,0,11,56,35,0,0,0,3,179,5,1,2,15,8,2,43,60,3,35,3],p:[,,,,,,,,1,2,,,,,3,4,5,,,,,,3,4,1,2,,,,,,,,,6,7,8,9,,,,,,,,,,,,,1,2,3,4,5],c:[{n:[140,,,,146,,,,140,,,,146,,,,140,,,,151,,,,140,,,,147,,,,,,147,,,,147,,,,144,,,,147,,,,152,,,,152,,,,144,,,,152],f:[]},{n:[142,,,,147,,,,142,,,,147,,,,142,,,,152,,,,142,,,,147,,,,,,149,,,,149,,,,146,,,,149,,,,154,,,,154,,,,146,,,,149],f:[]},{n:[147,,,,,,,,,,,,146,,147,,149,,,,147,,,,146,,,,147],f:[]},{n:[151,,,,,,,,,,,,149,,151,,152,,,,151,,,,149,,,,151],f:[]},{n:[,,,,,,,,,,,,,,,,146,,,,147,,147,,,,146,,144],f:[]},{n:[151,,,,,,,,,,,,151,,152,,154,,,,152,,,,151,,,,147,,149],f:[]},{n:[,,,,,,,,,,,,149,,151,,152,,,,151,,,,149,,,,152],f:[]},{n:[151,,,,,,,,,,,,151,,149,,151,,147,,149,,151,,,,,,149,,147],f:[]},{n:[149,,,,,,,,,,,,151,,147,,149,,,,,,,,,,,,147,,146],f:[]}]},{i:[0,255,128,0,3,255,140,0,0,101,2,5,47,61,0,0,0,96,3,1,3,94,55,3,51,84,2,12,4],p:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,1,2,1,2,,,,,1,2,1,2,3,4,3,4,,,,,,,,,,,3,4,3,4,3,5],c:[{n:[144,144,151,144,152,,152,144,,151,149,151,147,151,146,151,147,,,,,149,151,154,,,152,,151,,149],f:[]},{n:[142,142,146,142,147,142,149,142,,149,147,149,146,149,144,149,146,146,149,146,151,146,149,146,,151,149,151,147,151,146,151],f:[]},{n:[144,156,154,156,152,156,151,156,149,156,147,156,146,156,144,156,142,139,142,154,142,137,142,154,142,137,142,154,142,137,142,154],f:[]},{n:[139,151,149,151,147,151,146,151,144,151,142,151,140,151,139,151,144,139,144,156,144,139,144,156,144,139,144,156,144,139,144,156],f:[]},{n:[139,151,149,151,147,151,146,151,144,151,142,151,140,151,139,151,144,,,144,,144,,144,144,,,,135],f:[]}]},{i:[1,192,128,0,2,191,116,5,0,0,6,28,34,0,0,0,0,69,3,1,1,54,130,2,33,77,6,25,6],p:[1,2,1,2,1,2,1,2,,,3,4,3,4,5,6,7,8,3,4,3,4,5,6,,,1,2,1,2,9,10,9,10,,,,,9,10,9,10,,,,,1,2,1,2,3,4,,,7,8],c:[{n:[144,,,,144,,,,139,,,,151,,,,151,,,,147,,,,139,,,,149,,,,,,139,,,,152,,,,144,,,,139,,,,139,,,,149,,,,147,,,,151,,132,,,,,,,,,,,,,,,,123],f:[]},{n:[149,,,,147,,,,142,,,,147,,,,151,,,,146,,,,142,,,,149,,,,,,142,,,,149,,,,146,,,,149,,,,142,,,,149,,,,147,,,,151,,130,,,,,,,,,,,,,,,,127],f:[]},{n:[151,,,,149,,,,147,,,,,,,,,,,,147,,,,147,,,,144,,,,,,154,,,,154,,,,,,,,,,,,146,,,,149,,,,146,,,,142],f:[]},{n:[144,,,,144,,,,152,,,,149,,,,149,,,,146,,,,152,,,,151,,,,,,140,,,,147,,,,151,,,,147,,,,142,,,,149,,,,154,,,,149],f:[]},{n:[144,,139,,144,,139,,144,,139,,137,,139,,140,,,,139,,,,137,,,,135],f:[]},{n:[147,,142,,147,,142,,147,,142,,146,,147,,149,,,,147,,,,146,,,,147],f:[]},{n:[144,,,,146,,147,,,,,,,,,,144,,,,146,,147,,,,146,,144],f:[]},{n:[146,,,,147,,149,,,,,,,,,,154,,152,,151,,149,,152,,151,,149,,152],f:[]},{n:[144,,139,,144,,152,,139,,144,,151,,139,,151,,139,,147,,149,,139,,147,,149,,151],f:[]},{n:[149,,142,,147,,149,,142,,146,,147,,149,,151,,142,,146,,149,,142,,147,,149,,151],f:[]}]},],rowLen:5292,patternLen:32,endPattern:61,numChannels:9};