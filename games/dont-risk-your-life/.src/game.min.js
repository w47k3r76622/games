function J(){this.B=function(e){for(var t=0;24>t;t++)this[String.fromCharCode(97+t)]=e[t]||0;.01>this.c&&(this.c=.01),e=this.b+this.c+this.e,.18>e&&(e=.18/e,this.b*=e,this.c*=e,this.e*=e)}}function Splash(){SP=this,G.splash=SP,SP.is=0}function Menu(){MN=this,this.y=0,this.font="50px Helvetica",this.fireColor="rgb(255, 56, 8)",ctx.fillStyle="#222",ctx.fillRect(0,0,G.can.width,G.can.height),splash=new Splash,this.heat=MN.getHeatMap(),this.noise=null,this.noise=MN.getNoise(G.can.width,8*G.can.height),ctx.drawImage(this.heat,0,0),this.update()}function Paddle(){Pa=this,Pa.x=G.can.width/2,Pa.y=1===G.part?G.can.height-55:G.can.height-50,Pa.speed=1,P.vx=5,P.vy=0,Pa.width=200,Pa.height=10}function Body(){return Bo=this,Bo.outlineColor="#fff",Bo.addOutline(),Bo}function Ball(e){return B=this,e=e||{},B.width=10,B.height=10,B.slope=1,B.xDirection=1,B.yDirection=1,B.globalSpeed=10,B.speed=10,B.color="#fff",B.numCollided=0,B.maxCollisions=11,CC.w=utils.pI(G.can.width),CC.h=utils.pI(G.can.height),B.add(),B}function Cells(){Ce=this,Ce.color="#777",Ce.part=1===G.part?brain:2===G.part?heart:lungs}function Game(){G=this,G.isMobile=window.isMobile,G.isInProgress=!0,G.canSpeedBeIncreased=G.canExplode=!0,G.backgroundColor="#222",G.karma=0,G.highscore=utils.getLocalStorageData()||0,G.isSound=utils.getLocalStorageData(!0),0!==G.isSound&&(G.isSound=1),G.resolution=1,G.curPos=[],G.can=document.querySelector("canvas"),G.can.width=P.w,G.can.height=P.h,ctx=G.ctx=window.c=G.can.getContext("2d"),G.part=1,G.resize(),addEventListener("resize",G.resize,!1),CC=document.getElementById("canvascontainer").style,document.body.addEventListener("touchstart",G.touchStart.bind(G),!1),document.body.addEventListener("touchmove",G.touchMove.bind(G),!1),document.body.addEventListener("touchend",G.touchEnd.bind(G),!1),document.body.addEventListener("mousedown",G.mouseDown.bind(G),!1),document.body.addEventListener("mousemove",G.mouseMove.bind(G),!1),document.body.addEventListener("mouseup",G.mouseUp.bind(G),!1),document.body.addEventListener("keydown",G.keyDown.bind(G),!1),document.body.addEventListener("keyup",G.keyUp.bind(G),!1),G.frameCount=0,G.lastFrame=G.frameCountStart=Date.now();var e=_.innerWidth*_.innerHeight*_.devicePixelRatio,t=P.w*P.h,a=e/t;a<.5&&G.setResolution(2*a),G.speed=1,G.menu=!0}function canvasToImage(){G.dataURL=document.getElementById("game-canvas").toDataURL("image/png")}function downloadCanvas(){var e=_.open();e?e.document.write('<img src="'+G.dataURL+'"/>'):alert("Your browser prevented the window from opening. Please allow to view game screenshot.")}navigator.vibrate=function(){return navigator.vibrate||navigator.mozVibrate||navigator.webkitVibrate||noop}();var utils={getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},pI:function(e){return parseInt(e,10)},clamp:function(e,t,a){return"number"!=typeof t&&(t=-(1/0)),"number"!=typeof a&&(a=1/0),Math.max(t,Math.min(a,e))},getLocalStorageData:function(e){return e?utils.pI(atob(localStorage.getItem("__js13k_game_sound"))):utils.pI(atob(localStorage.getItem("__js13k_game_karma")))||0},setLocalStorageData:function(e,t){t?localStorage.setItem("__js13k_game_sound",btoa(e)):localStorage.setItem("__js13k_game_karma",btoa(e))}},W=new function(){this.A=new J;var e,t,a,i,o,n,l,r,s,c,d,h;this.reset=function(){var e=this.A;i=100/(e.f*e.f+.001),o=100/(e.g*e.g+.001),n=1-.01*e.h*e.h*e.h,l=1e-6*-e.i*e.i*e.i,e.a||(d=.5-e.n/2,h=5e-5*-e.o),r=0<e.l?1-.9*e.l*e.l:1+10*e.l*e.l,s=0,c=1==e.m?0:2e4*(1-e.m)*(1-e.m)+32},this.D=function(){this.reset();var i=this.A;return e=1e5*i.b*i.b,t=1e5*i.c*i.c,a=1e5*i.e*i.e+10,e+t+a|0},this.C=function(f,u){var p=this.A,G=1!=p.s||p.v,m=.1*p.v*p.v,g=1+3e-4*p.w,B=.1*p.s*p.s*p.s,x=1+1e-4*p.t,w=1!=p.s,y=p.x*p.x,v=p.g,S=p.q||p.r,P=.2*p.r*p.r*p.r,C=p.q*p.q*(0>p.q?-1020:1020),b=p.p?(2e4*(1-p.p)*(1-p.p)|0)+32:0,T=p.d,M=p.j/2,D=.01*p.k*p.k,k=p.a,O=e,E=1/e,I=1/t,L=1/a,p=5/(1+20*p.u*p.u)*(.01+B);.8<p&&(p=.8);for(var N,U,A,R,_,p=1-p,q=!1,H=0,W=0,j=0,F=0,X=0,Y=0,V=0,z=0,K=0,J=0,Q=Array(1024),Z=Array(32),$=Q.length;$--;)Q[$]=0;for($=Z.length;$--;)Z[$]=2*Math.random()-1;for($=0;$<u;$++){if(q)return $;if(b&&++K>=b&&(K=0,this.reset()),c&&++s>=c&&(c=0,i*=r),n+=l,i*=n,i>o&&(i=o,0<v&&(q=!0)),U=i,0<M&&(J+=D,U*=1+Math.sin(J)*M),U|=0,8>U&&(U=8),k||(d+=h,0>d?d=0:.5<d&&(d=.5)),++W>O)switch(W=0,++H){case 1:O=t;break;case 2:O=a}switch(H){case 0:j=W*E;break;case 1:j=1+2*(1-W*I)*T;break;case 2:j=1-W*L;break;case 3:j=0,q=!0}S&&(C+=P,A=0|C,0>A?A=-A:1023<A&&(A=1023)),G&&g&&(m*=g,1e-5>m?m=1e-5:.1<m&&(m=.1)),_=0;for(var ee=8;ee--;){if(V++,V>=U&&(V%=U,3==k))for(N=Z.length;N--;)Z[N]=2*Math.random()-1;switch(k){case 0:R=V/U<d?.5:-.5;break;case 1:R=1-2*(V/U);break;case 2:R=V/U,R=.5<R?6.28318531*(R-1):6.28318531*R,R=0>R?1.27323954*R+.405284735*R*R:1.27323954*R-.405284735*R*R,R=0>R?.225*(R*-R-R)+R:.225*(R*R-R)+R;break;case 3:R=Z[Math.abs(32*V/U|0)]}G&&(N=Y,B*=x,0>B?B=0:.1<B&&(B=.1),w?(X+=(R-Y)*B,X*=p):(Y=R,X=0),Y+=X,F+=Y-N,R=F*=1-m),S&&(Q[z%1024]=R,R+=Q[(z-A+1024)%1024],z++),_+=R}_=.125*_*j*y,f[$]=1<=_?32767:-1>=_?-32768:32767*_|0}return u}};window.jsfxr=function(e){W.A.B(e);var t=W.D();e=new Uint8Array(4*((t+1)/2|0)+44);var t=2*W.C(new Uint16Array(e.buffer,44),t),a=new Uint32Array(e.buffer,0,44);a[0]=1179011410,a[1]=t+36,a[2]=1163280727,a[3]=544501094,a[4]=16,a[5]=65537,a[6]=44100,a[7]=88200,a[8]=1048578,a[9]=1635017060,a[10]=t;for(var t=t+44,a=0,i="data:audio/wav;base64,";a<t;a+=3)var o=e[a]<<16|e[a+1]<<8|e[a+2],i=i+("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[o>>18]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[o>>12&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[o>>6&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&o]);return a-=t,i.slice(0,i.length-a)+"==".slice(0,a)};var soundUtils=SU={rd:function(e,t){return t||(t=e,e=0),Math.random()*(t-e)+e},rp:function(e){return e[~~this.rd(e.length)]},soundEffect:function(e,t){SU[e]=[],t.forEach(function(t){var a=new Audio;a.src=jsfxr(t),SU[e].push(a)})},play:function(e){G.isSound&&SU[e]&&SU.rp(SU[e]).play()}};SU.soundEffect("gameOver",[[2,.2,.01,,.83,.24,,,,.62,.6,,,.1248,.4522,,,,.4,,,,,.6]]),SU.soundEffect("info",[[2,,.1889,,.111,.2004,,,,,,,,.1157,,,,,1,,,.1,,1]]),SU.soundEffect("soundOn",[[2,,.2,,.1753,.64,,-.5261,,,,,,.5522,-.564,,,,1,,,,,.5]]),SU.soundEffect("playGame",[[2,,.261,.2142,.2005,.4618,.0137,-.3602,,,,,,.2249,.0858,,,,1,,,1e-4,,.44]]);var lungs=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,1,1],[0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,0,0,1,1],[0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,1,1],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,0,1,1],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1],[0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1],[0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1],[0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0],[0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0],[0,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0]],brain=[[,,,,,,,,,,,1,1,1,1,1,1,1,1,1,,,,,,,,,,,,],[,,,,,,,,,1,1,1,1,1,1,1,1,1,1,1,1,,,,,,,,,,,],[,,,,,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,,,,,,,],[,,,,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,,,,,],[,,,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,,,,],[,,,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,,,],[,,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,,,],[,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,,],[,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,,],[,,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,],[,,,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,],[,,,,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,],[,,,,,,,,,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,],[,,,,,,,,,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,],[,,,,,,,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,],[,,,,,,,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,],[,,,,,,,,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,],[,,,,,,,,,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,,],[,,,,,,,,,,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,,],[,,,,,,,,,,,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,,],[,,,,,,,,,,,,,,,,,,,1,1,1,1,1,1,,,,,,,],[,,,,,,,,,,,,,,,,,,,,1,1,1,1,,,,,,,,],[,,,,,,,,,,,,,,,,,,,,,1,1,,,,,,,,,]],heart=[[,,,,,1,1,,,,,,,,1,1,,,,1,1,,,,,,,,,,,],[,,,,,,1,1,,1,1,1,,1,1,,1,1,,1,1,,,,,,,,,,,],[,,,,,,,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,,,,,,,,,],[,,,,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,,,,,,,,,],[,,,1,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,,,,,,,,],[,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,],[,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,],[,,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,,,,,],[,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,],[,,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[,,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,,,,,,,,,],[,,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,1,1,,,,,,,,,],[,,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,,,,,],[,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,,,,,],[,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,,,,,],[,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,,,,],[,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,,,,],[,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,,,],[,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,,,],[,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,,,],[,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,,,],[,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,,,],[,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,,,,],[,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,,,,],[,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,,,,,],[,,1,1,1,1,1,,,1,1,1,1,1,1,1,1,1,1,1,1,1,1,,,,,,,,,],[,,,1,1,1,,,,,1,1,1,1,1,1,1,1,1,1,1,1,,,,,,,,,,],[,,,,1,,,,,,,1,1,1,1,1,1,1,1,1,1,,,,,,,,,,,],[,,,,,,,,,,,,1,1,1,1,1,1,1,1,1,,,,,,,,,,,],[,,,,,,,,,,,,,1,1,1,1,1,1,1,,,,,,,,,,,,],[,,,,,,,,,,,,,,1,1,,,,,,,,,,,,,,,,],[,,,,,,,,,,,,,,1,1,,,,,,,,,,,,,,,,]],SP;Splash.prototype={show:function(e){8===SP.num&&G.stopCycle(),SP.is=1,SP.num=e||SP.num},hide:function(){SP.is=0},addBtn:function(e){var t=2.1,a=G.can.width,i=G.can.height;a=e?a/10-30:a-50;var o=e?1:-1;ctx.beginPath(),ctx.arc(a,i/t,30,0,2*Math.PI,!1),ctx.fillStyle="#555",ctx.closePath(),ctx.fill(),ctx.beginPath(),ctx.moveTo(a,i/t-5*o),ctx.lineTo(a,i/t-5*o-10*o),ctx.lineTo(a-20*o,i/t-5*o+5*o),ctx.lineTo(a,i/t-5*o+20*o),ctx.lineTo(a,i/t-5*o+10*o),ctx.lineTo(a+20*o,i/t-5*o+10*o),ctx.lineTo(a+20*o,i/t-5*o),ctx.closePath(),ctx.fillStyle="#222",ctx.fill()},mouseDown:function(e,t,a){var i=G.can.width,o=G.can.height;t>=.1*i-30-30&&t<=.1*i-30+30&&a>=o/2.1-30&&a<=o/2.1+30?(SP.num-=1,SU.play("info")):t>=i-50-30&&t<=i-50+30&&a>=o/2.1-30&&a<=o/2.1+30&&(SP.num+=1,SU.play("info"),4!==SP.num&&6!==SP.num&&8!==SP.num||(SP.is=0,6===SP.num&&(G.part=2),8===SP.num&&(G.part=3),G.restart()))},addNavigationBtns:function(){SP.addBtn(0),SP.num>=2&&SP.addBtn(1)},getText:function(){var e=[];switch(SP.num){case 1:e=["A MAN STARTED","LOSING","HIS LIFE","THE DAY","HE STARTED..."],config={color:[0,1,0,0,0]};break;case 2:e=["LEVEL 1","DRUGS"],config={color:[0,1]};break;case 3:case 5:case 7:e=["LIGHT ALL THE CELLS","OF DAMAGED "+(3===SP.num?"BRAIN":5===SP.num?"HEART":"LUNGS"),"OF A","LOST MAN","BY","Moving the mouse to position the paddle and avoiding the","moving cell to cross paddle and hitting bottom more than 10 times.","Note: Moving cell can cross the already lit cell. Don't be LOST!"],config={color:[0,0,0,1,0,2,2,2]};break;case 4:e=["LEVEL 2","DRINKING"],config={color:[0,1]};break;case 6:e=["LEVEL 3","SMOKING"],config={color:[0,1]}}return{text:e,config:config}},update:function(){if(SP.is){fs("#222"),fr(0,0,G.can.width,G.can.height),SP.addNavigationBtns();for(var e,t=G.can.width,a=G.can.height,i=SP.getText().text,o=SP.getText().config,n=0;n<i.length;n++){var l=.5*(i.length-1);1===o.color[n]?(hOffset=95*n,e=i[n].split("").join("  "),ctx.fillStyle="rgb(255, 56, 8)",ctx.font="45px Helvetica"):2===o.color[n]?(2===o.color[n-1]?hOffset=85*n:hOffset=95*n,e=i[n].split("").join(""),ctx.fillStyle="#fff",ctx.font="25px Helvetica"):(hOffset=95*n,e=i[n].split("").join("  "),ctx.fillStyle="#fff",ctx.font="35px Helvetica"),ctx.fillText(e,(t-ctx.measureText(e).width)/2,a/(2+l)+hOffset)}}}};var MN,splash;Menu.prototype={getNoise:function(){var e=document.createElement("canvas");e.width=G.can.width,e.height=G.can.height;for(var t=e.getContext("2d"),a=e.width,i=e.height,o=t.createImageData(a,i),n=a*i*4,l=0;l<n;l+=4)o.data[l]=15,o.data[l+1]=3,o.data[l+2]=1,o.data[l+3]=Math.floor(128*Math.random());sv(),t.putImageData(o,0,0),t.drawImage(e,0,0,64*a,64*i),t.globalAlpha=.5,t.drawImage(e,0,0,16*a,16*i);for(var o=t.getImageData(0,0,a,i),l=3;l<a*i*4;l+=4)o.data[l]>220&&(o.data[l]=255),o.data[l]<40&&(o.data[l]=0);return t.putImageData(o,0,0),rs(),e},getHeatMap:function(){var e=document.createElement("canvas");e.width=G.can.width,e.height=G.can.height;var t=e.getContext("2d");sv();var a=G.can.width,i=G.can.height,o=MN.fireColor,n=G.isGameOver?"WELL PLAYED":"DO NOT";firstSecondText="NOT",secondText=G.isGameOver?"YOU SAVED":"RISK",thirdText=G.isGameOver?"THE":"YOUR LIFE",fText=G.isGameOver?"LOST MAN":"",n=n.split("").join("   "),secondText=secondText.split("").join("   "),thirdText=thirdText.split("").join("   "),fText=fText.split("").join(" "),t.fillStyle=o,t.strokeStyle=o,t.font=MN.font;var l=t.measureText(n),r=t.measureText(secondText),s=t.measureText(thirdText),c=t.measureText(fText);if(t.fillStyle="#fff",G.isGameOver?t.fillText(n,(a-l.width)/2,i/2-270):(t.fillText("D   O",(a-l.width)/2,i/2-270),t.fillStyle=MN.fireColor,t.fillText("N   O   T",(a-l.width+400)/2,i/2-270)),t.fillStyle="#fff",t.fillText(secondText,(a-r.width)/2,i/2-180),G.isGameOver?t.fillStyle=MN.fireColor:t.fillStyle="#fff",t.fillText(thirdText,(a-s.width)/2,i/2-90),fText&&t.fillText(fText,(a-c.width)/2,i/2-0),t.lineWidth=10,!G.isInfoMenu){t.beginPath(),t.arc(.5*a,i/1.2,30,0,2*Math.PI,!1),t.fillStyle="#555",t.closePath(),t.fill(),t.beginPath(),t.moveTo(.5*a-20,i/1.2-10),t.lineTo(.5*a-20,i/1.2+5),t.lineTo(.5*a-10,i/1.2+5),t.lineTo(.5*a+5,i/1.2+15),t.lineTo(.5*a+5,i/1.2-20),t.lineTo(.5*a-10,i/1.2-10),t.fillStyle="#222",t.closePath(),G.isSound&&(t.fillRect(.5*a+10,i/1.2-5,3,10),t.fillRect(.5*a+15,i/1.2-7,3,15),t.fillRect(.5*a+20,i/1.2-10,3,20)),t.fill(),G.isSound||(t.save(),t.beginPath(),t.moveTo(.5*a+10,i/1.2-22),t.lineTo(.5*a-10,i/1.2+22),t.closePath(),t.fill(),t.lineWidth=5,t.strokeStyle="#000",t.stroke(),t.restore()),G.isGameOver&&(t.fillStyle="#fff",t.font="35px Helvetica",t.lineWidth=10,t.beginPath(),t.arc(.5*a,i/1.06,30,0,2*Math.PI,!1),t.fillStyle="#555",t.closePath(),t.fill(),t.beginPath(),t.moveTo(.5*a-10,i/1.06-15),t.lineTo(.5*a-10,i/1.06-15+15),t.lineTo(.5*a-20,i/1.06-15+15),t.lineTo(.5*a,i/1.06-15+35),t.lineTo(.5*a+20,i/1.06-15+15),t.lineTo(.5*a+10,i/1.06-15+15),t.lineTo(.5*a+10,i/1.06-15),t.fillStyle="#222",t.closePath(),t.fill()),t.beginPath(),t.arc(a/2,i/1.6,50,0,2*Math.PI,!1),t.fillStyle="#793f02",t.closePath(),t.fill();var d=20,h=i/1.6-d;t.beginPath(),t.moveTo(a/2-d/2,h),t.lineTo(a/2+d,h+20),t.lineTo(a/2-d/2,h+40),t.fillStyle="#fff",t.closePath(),t.fill()}return rs(),e},process:function(){sv(),ctx.globalAlpha=.25,ctx.globalCompositeOperation="source-over",MN.y=(MN.y+3)%MN.noise.height,x=0*Math.round(5*Math.random()),ctx.drawImage(MN.noise,x,MN.y),ctx.drawImage(MN.noise,x,MN.y-MN.noise.height),ctx.globalAlpha=1,x=1-2*Math.random(),ctx.drawImage(G.can,x,-1),ctx.globalAlpha=.13,ctx.globalCompositeOperation="lighter",ctx.drawImage(G.can,x,-1),ctx.globalAlpha=.22,ctx.drawImage(MN.heat,0,0),bp(),cp(),fl(),rs()},mouseDown:function(e,t,a){var i=G.can.width,o=G.can.height,n=(MN.heat.getContext("2d"),G.isMobile()?10:4.4);t>=i/2-50&&t<=i/2+50&&a>=o/1.6-50&&a<=o/1.6+50?(G.menu=null,splash.show(1),SU.play("playGame")):t>=.5*i-30&&t<=.5*i+30&&a>=o/1.06-30&&a<=o/1.06+30?(downloadCanvas(),SU.play("download")):t>=.5*i-30&&t<=.5*i+30&&a>=o/1.2-30&&a<=o/1.2+30?(G.isSound=+!G.isSound,G.isSound&&SU.play("soundOn"),utils.setLocalStorageData(G.isSound,!0),MN.heat=MN.getHeatMap()):t>=.75*i-30&&t<=.75*i+30&&a>=o/1.2-30&&a<=o/1.2+30?(G.isInfoMenu=!0,MN.heat=MN.getHeatMap(),SU.play("info")):t>=.1*i-30&&t<=.1*i+30&&a>=o/n-30&&a<=o/n+30&&(G.isInfoMenu=!1,MN.heat=MN.getHeatMap(),SU.play("info"))},update:function(){this.heat=MN.getHeatMap(),this.noise=null,this.noise=MN.getNoise(G.can.width,8*G.can.height),ctx.drawImage(this.heat,0,0)}};var Pa;Paddle.prototype={body:function(){sv(),3===G.part?(fs("#eee"),fr(Pa.x,Pa.y,Pa.width-30,Pa.height),fs("#ffa666"),fr(Pa.x+Pa.width-30,Pa.y,30,Pa.height)):(fs("#777"),fr(Pa.x,Pa.y,Pa.width,Pa.height)),rs()},update:function(){Pa.body()},keyDown:function(e,t){var t=t||e.keyCode;if(!Pa.busted){var a=e.offsetX-Pa.width/2;e.offsetX<=G.can.width&&e.offsetX===e.clientX?a=-1*(Pa.width/2):e.offsetX>=G.can.width&&e.offsetX===e.clientX&&(a=G.can.width-Pa.width/2),37!==t&&39!==t||(Pa.x=Math.round(a))}},keyUp:function(e){Pa.speed=5}};var Bo;Body.prototype.update=function(){Bo.addOutline()},Body.prototype.halfSideOutline=function(e){var t=G.can.width/2;sv(),bp(),sts("#444"),ctx.lineWidth=3,mt(t-80*e,50),qct(t-80*e,105,t-80*e,105),mt(t-80*e,105),qct(t-80*e,145,t-270*e,155),mt(t-270*e,155),qct(t-315*e,163,t-330*e,205),mt(t-330*e,205),qct(t-335*e,240,t-335*e,315),mt(t-325*e,295),qct(t-355*e,340,t-360*e,470),mt(t-360*e,470),qct(t-360*e,470,t-365*e,490),mt(t-260*e,270),qct(t-240*e,370,t-260*e,430),mt(t-260*e,430),qct(t-260*e,430,t-280*e,490),mt(t-260*e,430),qct(t-260*e,430,t-235*e,490),ctx.stroke()},Body.prototype.addOutline=function(){Bo.halfSideOutline(1),Bo.halfSideOutline(-1)};var B,CC;Ball.prototype={add:function(e){return B.x=80,B.y=700,B},setSlope:function(e){var t=e-Pa.x,a=Math.abs(Math.floor(t/10));switch(a){case 0:B.slope=.1,B.speed=B.globalSpeed+5;case 1:case 20:B.slope=.3,B.speed=B.globalSpeed+4;break;case 2:case 19:B.slope=.5,B.speed=B.globalSpeed+3;break;case 3:case 18:B.slope=.7,B.speed=B.globalSpeed+2;break;case 4:case 17:B.slope=.9,B.speed=B.globalSpeed+1;break;case 5:case 16:B.slope=1.5,B.speed=B.globalSpeed+5;break;case 6:case 15:B.slope=2,B.speed=B.globalSpeed+4;break;case 7:case 14:B.slope=4,B.speed=B.globalSpeed+3;break;case 8:case 13:B.slope=7,B.speed=B.globalSpeed+2;break;case 9:case 12:B.slope=15,B.speed=B.globalSpeed+1;break;case 10:case 11:B.slope=1/0,B.speed=B.globalSpeed}SU.play("playGame")},checkCollision:function(){var e,t,a,i=Math.abs(B.x)%B.width,o=Math.abs(B.y)%B.width;0!==i?i<Math.round(B.width/2)?Bxr=B.x-i:Bxr=B.x+(B.width-i):Bxr=B.x,a=0!==o?o<Math.round(B.width/2)?B.y-o:B.y+(B.width-o):B.y,B.slope===1/0?(t=0,e=B.speed):B.slope<=1?(t=B.speed,e=B.slope*t):(e=B.speed,t=e/B.slope),a>=G.can.height-B.height?(B.yDirection=-1,B.y-=e,B.numCollided+=1,SU.play("playGame")):a<=0&&(B.yDirection=1,B.y+=e,SU.play("playGame")),Bxr>=G.can.width-B.width?(B.xDirection=-1,B.x-=t,SU.play("playGame")):Bxr<=0&&(B.xDirection=1,B.x+=t,SU.play("playGame"));for(var n=0;n<Ce.cells.length;n++){var l=Ce.cells[n].x,r=Ce.cells[n].y;if(1===Ce.cells[n].mode){if(1===B.yDirection&&a+B.height===r&&Bxr===l&&Bxr+B.width===l+Ce.width){B.yDirection=-1,B.y-=e,Ce.cells[n].mode=2,SU.play("playGame");break}if(B.yDirection===-1&&a===r+Ce.height&&Bxr===l&&Bxr+B.width===l+Ce.width){B.yDirection=1,B.y+=e,Ce.cells[n].mode=2,SU.play("playGame");break}if(1===B.xDirection&&B.slope!==1/0&&Bxr+B.width===l&&a===r&&a+B.height===r+Ce.height){B.xDirection=-1,B.x-=t,Ce.cells[n].mode=2,SU.play("playGame");break}if(B.xDirection===-1&&B.slope!==1/0&&Bxr===l+Ce.width&&a===r&&a+B.height===r+Ce.height){B.xDirection=1,B.x+=t,Ce.cells[n].mode=2,SU.play("playGame");break}}}a>=Pa.y&&a<=Pa.y+Pa.height&&(Bxr>=Pa.x+Pa.width/2-20&&Bxr+B.width<=Pa.x+Pa.width/2+20?(B.setSlope(Bxr),B.yDirection=-1):B.xDirection===-1&&Bxr>=Pa.x+Pa.width/2&&Bxr<=Pa.x+Pa.width?(B.setSlope(Bxr),B.yDirection=-1,B.xDirection=1):1===B.xDirection&&Bxr+B.width<=Pa.x+Pa.width/2&&Bxr>=Pa.x?(B.setSlope(Bxr),B.yDirection=-1,B.xDirection=-1):Bxr+B.width>=Pa.x&&Bxr<=Pa.x+Pa.width&&Bxr+B.width<=Pa.x+Pa.width&&(B.setSlope(Bxr),B.yDirection=-1)),a>0&&a<G.can.height-B.height&&Bxr>0&&Bxr<G.can.width-B.width&&(1===B.xDirection?B.x+=t:B.x-=t,1===B.yDirection?B.y+=e:B.y-=e);for(var s={},n=0;n<Ce.cells.length;n++){var c=Ce.cells[n].mode;s[c]=s[c]?s[c]+1:1}var d="CELLS  LEFT:  "+s[1],h="LIVES  LEFT:  "+(B.maxCollisions-B.numCollided),f="S K I P  : /";ctx.fillStyle="#fff",ctx.font="12px Helvetica",ctx.fillText(d,25,25),ctx.fillText(h,G.can.width-110,25),ctx.fillText(f,G.can.width-80,G.can.height-20),B.isDone=Ce.cells.every(function(e){return 2===e.mode}),B.isDone&&(canvasToImage(),B.gameDoneOrOver("W E L L  D O N E!"),setTimeout(function(){1===G.part||2===G.part||3===G.part?SP.show():G.stopCycle()},2500)),B.numCollided>=B.maxCollisions&&(B.gameDoneOrOver("G A M E  O V E R"),setTimeout(function(){G.restart()},2500))},gameDoneOrOver:function(e){ctx.fillStyle="rgb(255, 56, 8)",ctx.font="45px Helvetica",ctx.fillText(e,(G.can.width-ctx.measureText(e).width)/2,G.can.height/2.1)},update:function(e){e=e||B;var t=e.x,a=e.y;sv(),fs("#444"),fr(t,a,e.width,e.height),fs(B.color),fr(t+1,a+1,e.width-2,e.height-2),rs(),B.numCollided>=B.maxCollisions?B.gameDoneOrOver("G A M E  O V E R"):B.isDone?B.gameDoneOrOver("W E L L  D O N E!"):B.checkCollision()},mouseDown:function(e,t,a){t>=G.can.width-80&&t<=G.can.width-10&&a>=G.can.height-30&&a<=G.can.height-10&&(SU.play("playGame"),SP.show())}};var Ce;Cells.prototype.update=function(){Ce.isOneCycleCompleted||(Ce.cells=[]),3===G.part?(Ce.width=10,Ce.height=10,B.speed=10,B.globalSpeed=10,B.width=10,B.height=10):2===G.part?(Ce.width=10,Ce.height=10,B.speed=10,B.globalSpeed=10,B.width=10,B.height=10,B.color="#a23939"):1===G.part&&(Ce.width=20,Ce.height=20,B.speed=10,B.globalSpeed=10,B.width=20,B.height=20,Pa.height=20,B.color="#ffc284");var e=3===G.part?Ce.part[0].length*Ce.width:Ce.part[0].length*Ce.width/2,t=G.can.width/2-e,a=1===G.part?50:170,i=Math.abs(t)%B.width,o=Math.abs(a)%B.width;if(0!==i&&(i<Math.round(B.width/2)?t-=i:t+=B.width-i),0!==o&&(o<Math.round(B.width/2)?a-=o:a+=B.width-o),Ce.isOneCycleCompleted)for(var n=0;n<Ce.cells.length;n++)Ce.drawCell({mode:Ce.cells[n].mode,color:"#111",inColor:1===Ce.cells[n].mode?"#444":3===G.part?"#fff":2===G.part?"#a23939":"#ffc284",x:Ce.cells[n].x,y:Ce.cells[n].y});else Ce.drawCells({startX:t,startY:a,isRight:0}),t+=e,3===G.part&&Ce.drawCells({startX:t,startY:a,isRight:1});Ce.isOneCycleCompleted=!0},Cells.prototype.drawCells=function(e){for(var t=0;t<Ce.part.length;t++)for(var a=e.isRight?Ce.part[t].slice().reverse():Ce.part[t],i=0;i<a.length;i++)1!==a[i]&&2!==a[i]||Ce.drawCell({mode:a[i],color:"#111",inColor:1===Ce.part[t].mode?"#444":3===G.part?"#fff":2===G.part?"#a23939":"#ffc284",x:e.startX+i*Ce.width,y:e.startY+t*Ce.height})},Cells.prototype.drawCell=function(e){Ce.isOneCycleCompleted||Ce.cells.push(e),sv(),fs(e.color),fr(e.x,e.y,Ce.width,Ce.height),fs(e.inColor),fr(e.x+1,e.y+1,Ce.width-2,Ce.height-2),rs()};var G,ctx,CC,background,player,cells,paddle,tree,time;Game.prototype={restart:function(){G.isGameOver=!1,G.isInProgress=!0,G.karma=0,G.speed=1,G.gameStartTime=(new Date).getTime(),blw=200,bw=0,G.ball=new Ball,2!==G.part&&3!==G.part||(player=new Body),cells=new Cells,paddle=new Paddle,G.raf=raf(function(){G.raf&&(G.cycle(),raf(arguments.callee))})},stopCycle:function(){canvasToImage(),G.isGameOver=!0,G.isInProgress=!1,G.part=1,player=null,SU.play("gameOver"),G.menu=new Menu},cycle:function(){var e=(new Date).getTime();if(dt=e-time,!(dt<1e3/fps)){if(time=e,G.menu)return void(G.menu.update&&G.menu.update());if(SP.is)return void(SP&&SP.update());fs(G.backgroundColor),fr(0,0,CC.w,CC.h),ctx.font="15px Comic Sans",ctx.fillText("KARMA: "+G.karma,25,25),ctx.fillText("SPEED: "+G.speed.toFixed(1)+" mph",G.can.width-130,25),ctx.lineWidth=3,player&&player.update(),cells&&cells.update(),paddle&&paddle.update(),G.ball&&G.ball.update()}},resize:function(){setTimeout(function(){var e,t,a=innerWidth,i=innerHeight,o=a/i,n=P.w/P.h,l=(abs(o-n),document.getElementById("canvascontainer").style);return o<=n?(e=a,t=i):(t=i,e=t*n),l.width=e+"px",l.height=t+"px",ctx.globalCompositeOperation="lighter",G.can.width=e,G.can.height=t,G.menu?(G.menu=new Menu,void(G.raf=raf(function(){G.raf&&(G.cycle(),raf(arguments.callee))}))):void G.restart()},100)},pos:function(e){var t=(G.can.getBoundingClientRect(),[]);e=e.touches||[e];for(var a=0;a<e.length;a++)t.push({x:e[a].clientX,y:e[a].clientY});return t},touchStart:function(e,t){e.preventDefault(),G.touch=G.touch||!t;var a=G.pos(e);G.curPos=a,scrollTo(0,1);var i=G.curPos[0].x-G.can.offsetLeft,o=G.curPos[0].y-G.can.offsetTop;G.menu?G.menu.mouseDown&&G.menu.mouseDown(e,i,o):G.splash.is&&G.splash.mouseDown&&G.splash.mouseDown(e,i,o),G.ball&&G.ball.mouseDown&&G.ball.mouseDown(e,i,o),!G.isInProgress},touchMove:function(e){if(e.preventDefault(),G.curPos&&G.curPos.length){if(!G.isInProgress)return;G.curPos[0].x>G.pos(e)[0].x?G.keyDown(e,37):G.curPos[0].x<G.pos(e)[0].x&&G.keyDown(e,39),G.curPos=G.pos(e)}},touchEnd:function(e){e.preventDefault();G.curPos[0];!G.isInProgress},keyDown:function(e,t){return 13!==e.keyCode&&32!==e.keyCode||!G.menu?void(G.isInProgress&&(37!==t&&39!==t||paddle&&paddle.keyDown(e,t))):(G.menu=null,G.restart(),void SU.play("playGame"))},keyUp:function(e){G.isInProgress&&paddle&&paddle.keyUp(e.keyCode)},mouseDown:function(e){G.touchStart(e)},mouseMove:function(e){G.touchMove(e)},mouseUp:function(e){G.touchEnd(e)},setResolution:function(e){G.can.width=P.w*e,G.can.height=P.h*e,G.resolution=e}};var _=window,raf=function(){return _.requestAnimationFrame||_.webkitRequestAnimationFrame||_.mozRequestAnimationFrame||function(e){setTimeout(e,1e3/60)}}(),M=Math,abs=M.abs,min=M.min,max=M.max,to=setTimeout,fps=60,p=CanvasRenderingContext2D.prototype;p.fr=p.fillRect,p.sv=p.save,p.rs=p.restore,p.lt=p.lineTo,p.mt=p.moveTo,p.sc=p.scale,p.bp=p.beginPath,p.cp=p.closePath,p.rt=p.rotate,p.ft=p.fillText,p.bct=p.bezierCurveTo,p.qct=p.quadraticCurveTo,p.st=p.stroke,p.ar=p.arc,p.fl=p.fill,p.el=function(e,t,a,i,o,n){var l=t+i,r=a+o,s=t+i/2,c=a+o/2;sv(),bp(),mt(t,c),qct(t,a,s,a),qct(l,a,l,c),qct(l,r,s,r),qct(t,r,t,c),e.strokeStyle=n?n:"#000",e.lineWidth=2,st(),rs(),fl()},p.fs=function(e){this.fillStyle=P.inverted?invert(e):e},p.sts=function(e){this.strokeStyle=P.inverted?invert(e):e};for(var i in p)_[i]=function(e){return function(){c[e].apply(c,arguments)}}(i);_.isMobile=function(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)};var P={w:_.isMobile()?640:800,h:760,g:800,fireOffset:70,spikesOffset:50,tbOffset:20};addEventListener("DOMContentLoaded",function(){_._can=document.querySelector("canvas"),new Game});