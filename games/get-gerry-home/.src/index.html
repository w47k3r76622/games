<html><body><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name=viewport><style>body{margin:0;background:#000}b{display:flex;justify-content:center;align-items:center}canvas{height:100vmin;width:100vmin}</style><b><canvas></canvas></b><script>function e(e,t){const a=1e4*m(y++);return h((a-h(a))*(t-e)+e)}function t(t){return t.splice(e(0,t.length),1)[0]}function a(e,t,a=1,o=0){const n=b(o),r=m(o);return new Float32Array([n*a,r*a,0,0,-r*a,n*a,0,0,0,0,1,0,e,t,0,1])}function o(e){const[t,a]=e,o=v(t*t+a*a);return[t/o,a/o]}function n(e,t){document.title=`Get Gerry Home - Current: ${e}, Max: ${t}`}function r(e,t,a){const o=e.createShader(t?e.FRAGMENT_SHADER:e.VERTEX_SHADER);if(e.shaderSource(o,a),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS))throw e.getShaderInfoLog(o);return o}function i(e,a,o){return e+o*(a-e)}function l(e){return u(4*Math.log2(e+1)+2)}function s(e,t){return e*p(2,(t-49)/12)}function c(){const e=G.gl;e.clear(e.COLOR_BUFFER_BIT),j.draw(),f.requestAnimationFrame(c)}var d=Math.abs,p=Math.pow,v=Math.sqrt,b=Math.cos,m=Math.sin,u=Math.floor;const f=window,h=u,g={lastFrame:Date.now(),delta:0};let y=u(1e4*Math.random());var S={INITIAL_PLAYER_SPEED:1.2,TRANSITION:350,RENDER_AOE:4,MAX_TOUCH_DISTANCE:150,TIME_DILATION:1,CAMERA_SCALE:12,MINIMAP_DURATION:15000,SHIELD_DURATION:1e4};class T{constructor(e=0,t=0){this.x=e,this.y=t}clone(){return new T(this.x,this.y)}subtract(e){return e instanceof T?new T(this.x-e.x,this.y-e.y):new T(this.x-e,this.y-e)}add(e){return e instanceof T?new T(this.x+e.x,this.y+e.y):new T(this.x+e,this.y+e)}multiply(e){return e instanceof T?new T(this.x*e.x,this.y*e.y):new T(this.x*e,this.y*e)}dist2(e){const t=e?this.subtract(e):this;return t.x*t.x+t.y*t.y}dist(e){return v(this.dist2(e))}normalize(){const e=this.dist();return new T(this.x/e,this.y/e)}}class x{constructor(e,t){this.untouched=[],this.children=[],this.touched=!1,this.distance=0,this.time=0,this.position=new T(e,t)}passable(e,t=0){if(e=e.clone(),0.5>e.x%1?e.x-=t:e.x+=t,0.5>e.y%1?e.y-=t:e.y+=t,e.x=u(e.x),e.y=u(e.y),this.position.x===e.x&&this.position.y===e.y)return!0;for(const a of this.children)if(a.position.x===u(e.x)&&a.position.y===u(e.y))return!0;return!1}draw(e){const{x:o,y:n}=this.position,r=e.renderer,i=r.gl;r.modelMat=a(o,n),r.setMatrices();const l=u(e.player.position.x)===o&&u(e.player.position.y)===n;i.uniform1i(e.mazeShaders.playerSpace,l?1:0),i.uniform1i(e.mazeShaders.squareState,this===e.start?0:this===e.end?1:this.touched?2:3);let s=this.time?(Date.now()-this.time)/S.TRANSITION:0;1<s&&(s=1),i.uniform1f(e.mazeShaders.t,s);const t=Date.now()/1e3%1;i.uniform1f(e.mazeShaders.pulse,t),i.drawArrays(i.TRIANGLE_STRIP,0,4)}}class A{constructor(e,t){this.width=e,this.height=t,this.nodes={}}get(e){e=e.clone(),e.x=u(e.x),e.y=u(e.y);const t=[e.x,e.y].toString();if(e.x>=this.width||e.y>=this.height||0>e.x||0>e.y)return null;let a=this.nodes[t];return a||(a=this.nodes[t]=new x(e.x,e.y)),a}draw(e,t){e.mazeShaders.use();const a=e.renderer,o=a.gl;for(const n in o.bindBuffer(o.ARRAY_BUFFER,a.squareBuffer),o.vertexAttribPointer(e.mazeShaders.vertPos,2,o.FLOAT,!1,0,0),o.uniform1i(e.mazeShaders.isMinimap,t?1:0),this.nodes){const t=this.nodes[n];t.draw(e)}}}const I=[new T(-1,0),new T(1,0),new T(0,-1),new T(0,1)];var w=function(a,o){const n=new A(a,o);for(let e=0;e<a;e++)for(let t=0;t<o;t++){const a=new T(e,t),o=n.get(a);for(const e of I){const t=n.get(a.add(e));t&&o.untouched.push(t)}}const r=n.get(new T(e(0,a),e(0,o))),i=[r];let l=r;for(;i.length;){const e=i[0];if(e.touched=!0,!e.untouched.length){i.shift();continue}const a=t(e.untouched);a.touched||(a.untouched.splice(a.untouched.indexOf(e),1),a.children.push(e),a.distance=e.distance+1,a.distance>l.distance&&(l=a),e.children.push(a),a.touched=!0,i.splice(0,0,a))}return[n,r,l]};const P="precision mediump float;attribute vec2 o;uniform mat4 r,t,u;varying vec2 d;void main(){gl_Position=u*t*r*vec4(o,0,1),d=o;}const vec3 e=vec3(.858824,.266667,.215686);",E={fade:"g",modelMat:"r",viewMat:"t",projMat:"u",hp:"h",t:"k",squareState:"l",isMinimap:"m",playerSpace:"p",pulse:"n"},_={vertPos:"o"};let R;class M{constructor(e,...t){this.renderer=e;const a=this.shaderProgram=R.createProgram();for(let o=0;2>o;o+=1)R.attachShader(a,r(R,o,t[o]));for(const o in R.linkProgram(a),R.getProgramParameter(a,R.LINK_STATUS)||console.error("Could not link shaders...."),this.use(),E)this[o]=R.getUniformLocation(a,E[o]);for(const o in _)this[o]=R.getAttribLocation(a,_[o]),R.enableVertexAttribArray(this[o])}use(){this.renderer.use(this)}}class L{constructor(e,t){this.bulletScale=0.05,this.bulletSpeed=0.9,this.position=new T(e,t)}draw(e){const t=e.renderer,o=t.gl;e.bulletShaders.use(),t.modelMat=a(this.position.x-this.bulletScale/2,this.position.y-this.bulletScale/2,this.bulletScale),t.setMatrices(),o.drawArrays(o.TRIANGLE_STRIP,0,4)}simulate(e){const t=this.position.add(this.vector.multiply(this.bulletSpeed*g.delta)),a=e.grid.get(this.position),o=e.grid.get(t),n=e.player;if(o&&o!==e.start&&o!==e.end&&a.passable(t,this.bulletScale/2)){const{x:o,y:r}=n.position;return a.passable(n.position)&&e.grid.get(n.position)!==e.start&&t.dist(n.position)<(n.playerScale+this.bulletScale)/2?(n.attack(0.07),!1):(this.position=t,!0)}return!1}}class N{constructor(e,t,a,o){this.level=a,this.distance=o,this.position=new T(e,t)}}class D{constructor(e,t){this.position=new T(e,t)}}class C extends D{constructor(e,t){super(e+0.5,t+0.5),this.shieldScale=0.5,this.fade=0}draw(e){const t=e.renderer,o=t.gl;e.shieldProgram.use(),o.uniform1f(e.shieldProgram.fade,this.fade),t.modelMat=a(this.position.x-this.shieldScale/2,this.position.y-this.shieldScale/2,this.shieldScale),t.setMatrices(),o.drawArrays(o.TRIANGLE_STRIP,0,4)}simulate(e){const{player:t}=e;if(!this.grabbed)0.05>t.position.dist2(this.position)&&(this.grabbed=Date.now(),e.player.shield=Date.now());else if(this.fade=(Date.now()-this.grabbed)*S.TIME_DILATION/300,1<this.fade)return!1;return!0}}class F extends D{constructor(e,t){super(e+0.5,t+0.5),this.fade=0}draw(e){var t=Math.PI;const o=1/e.grid.height,n=e.renderer,r=n.gl,i=Date.now(),l=b(2*(i/1e3%t)),c=m(2*(i/1e3%t)),s=e.renderer.camera,d=S.CAMERA_SCALE,p=l*o,v=c*o,u=this.position.subtract(e.player.position);n.camera=new Float32Array([p,v,0,0,-v,p,0,0,0,0,1,0,d*(u.x-0.1*(p+v)),d*(u.y-0.2*(p-v)),1,1]),e.dropShadowShaders.use(),r.uniform1f(e.dropShadowShaders.fade,this.fade),n.modelMat=a(-0.1/o,-0.1/o,1.2*e.grid.height),n.setMatrices(),r.drawArrays(r.TRIANGLE_STRIP,0,4),e.mazeShaders.use(),r.uniform1f(e.mazeShaders.fade,this.fade),e.grid.draw(e,!0),r.uniform1f(e.mazeShaders.fade,0),e.renderer.camera=s}simulate(e){const{player:t}=e;if(!this.grabbed)0.05>t.position.dist2(this.position)&&(this.grabbed=Date.now(),e.minimapActivated=Date.now());else if(this.fade=(Date.now()-this.grabbed)*S.TIME_DILATION/300,1<this.fade)return!1;return!0}}class O extends N{constructor(e,t,a,o){super(e,t,a,o),this.maxEnemyScale=0.2,this.maxExplosionScale=0.7,this.explosionScale=0,this.currentSpeed=0,this.chaseTime=2500,this.accelTime=600,this.explodeTime=500,this.spent=!1,this.enemyScale=this.maxEnemyScale,this.maxSpeed=0.8*S.INITIAL_PLAYER_SPEED}draw(e){const t=e.renderer,o=t.gl;e.proximityProgram.use(),t.modelMat=a(this.position.x-this.enemyScale/2,this.position.y-this.enemyScale/2,this.enemyScale),t.setMatrices(),o.drawArrays(o.TRIANGLE_STRIP,0,4),e.explosionProgram.use(),t.modelMat=a(this.position.x-this.explosionScale/2,this.position.y-this.explosionScale/2,this.explosionScale),t.setMatrices(),o.drawArrays(o.TRIANGLE_STRIP,0,4)}simulate(e){const t=e.grid.get(this.position),a=e.player,{x:o,y:n}=a.position,r=a.position.subtract(this.position),l=r.normalize(),s=r.dist2(),c=t.passable(a.position);if(!this.startTime&&0.5>s&&c)this.startTime=Date.now();else if(this.startTime){let t=(Date.now()-this.startTime)*S.TIME_DILATION;if(t<this.chaseTime){if(1e-3<s&&c){const e=(Date.now()-this.startTime)/this.accelTime,t=i(0,this.maxSpeed,1<e?1:e);this.position=this.position.add(l.multiply(t*g.delta))}}else if(t<this.chaseTime+this.explodeTime){t-=this.chaseTime;let o;t>this.explodeTime/2?(o=2-2*t/this.explodeTime,this.enemyScale=this.maxEnemyScale*o):o=2*t/this.explodeTime,this.explosionScale=this.maxExplosionScale*o;const n=p((this.explosionScale+a.playerScale)/2,2);for(const t of e.entities)if(t instanceof B){const e=this.position.subtract(t.position),a=e.dist2();a<p((this.explosionScale+t.enemyScale)/2,2)&&(t.dying=!0)}!this.spent&&s<n&&(a.attack(0.25),this.spent=!0)}else return!1}return!0}}class B extends N{constructor(e,t,a,o){var n=Math.log;super(e,t,a,o),this.maxEnemyScale=0.13,this.prevShotTime=Date.now(),this.dying=!1,this.currentClip=0,this.clipSize=u(n(1.9*(a+2))),this.roundsPerSecond=u(3.5*n(a+2)),this.coolDown=1e3,this.enemyScale=this.maxEnemyScale}draw(e){const t=e.renderer,o=t.gl;e.shooterProgram.use(),t.modelMat=a(this.position.x-this.enemyScale/2,this.position.y-this.enemyScale/2,this.enemyScale),t.setMatrices(),o.drawArrays(o.TRIANGLE_STRIP,0,4)}simulate(e){if(this.dying){if(!this.dieStart)this.dieStart=Date.now();else{const e=(Date.now()-this.dieStart)*S.TIME_DILATION;if(this.enemyScale=i(this.enemyScale,0,e),0>=this.enemyScale)return!1}return!0}const t=(Date.now()-this.prevShotTime)*S.TIME_DILATION;return this.currentClip&&t>1e3/this.roundsPerSecond?(this.currentClip-=1,this.shoot(e)):0===this.currentClip&&t>this.coolDown&&(this.currentClip=this.clipSize),!0}shoot(e){let t=e.player.position.subtract(this.position).normalize();const a=new L(this.position.x,this.position.y);a.vector=t,e.pendingEntities.push(a),this.prevShotTime=Date.now()}}const H=0.04;class U{constructor(e){this.game=e,this.hp=0,this.speed=S.INITIAL_PLAYER_SPEED,this.actualHP=1,this.playerScale=H,this.shield=0,this.lastHitTime=Date.now();const t=e.renderer;this.program=new M(t,P,"precision mediump float;uniform float h;varying vec2 d;float f(float a,float b){float c=a<1.-2.*b?1.:a>1.?0.:1.-(a-(1.-2.*b))/.1;return c*c;}void main(){vec2 b=d-.5;float c=f(distance(vec2(0,0),b)*2.,.05);vec4 a=mix(vec4(1,0,0,1),vec4(0,1,0,1),h);a.a=c,gl_FragColor=a;}const vec3 e=vec3(.858824,.266667,.215686);"),this.shieldProgram=new M(t,P,"precision mediump float;varying vec2 d;float i(float a){return 1.-a*a;}float f(float a,float b){float c=a<1.-2.*b?1.:a>1.?0.:1.-(a-(1.-2.*b))/.1;return c*c;}void main(){vec2 c=d-.5;float q=distance(c,vec2(0,0)),j=f(distance(vec2(0,0),c)*2.,.05),a=i((q-.8)/.5);a=a<0.?0.:a;vec4 b=mix(vec4(0,0,0,0),vec4(0,1,1,1),a);b.a=b.a<j?b.a:j,gl_FragColor=b;}const vec3 e=vec3(.858824,.266667,.215686);")}start(e,t){this.position=new T(e+0.5,t+0.5)}setHP(e){this.lastHitTime=Date.now(),this.actualHP=e}attack(e){(Date.now()-this.shield)*S.TIME_DILATION<S.SHIELD_DURATION||this.game.grid.get(this.position)===this.game.start||(0.01>d(this.hp-this.actualHP)&&(this.lastHitTime=Date.now()),this.actualHP-=e,0>this.actualHP&&(this.actualHP=0))}circularIn(e){return e*e}simulate(){const e=this.circularIn((Date.now()-this.lastHitTime)/800);this.hp=i(this.hp,this.actualHP,1<e?1:0>e?0:e),0.15>this.hp&&0.15>this.actualHP&&(this.actualHP=0)}draw(){const e=this.game.renderer,t=e.gl,o=(Date.now()-this.shield)*S.TIME_DILATION;if(o<S.SHIELD_DURATION){this.shieldProgram.use();const n=400,r=o<n?o/n:S.SHIELD_DURATION-o<n?(S.SHIELD_DURATION-o)/n:1,i=2*H*r;e.modelMat=a(this.position.x-i/2,this.position.y-i/2,i),e.setMatrices(),t.drawArrays(t.TRIANGLE_STRIP,0,4)}this.program.use(),t.bindBuffer(t.ARRAY_BUFFER,e.squareBuffer),t.vertexAttribPointer(this.program.vertPos,2,t.FLOAT,!1,0,0),e.modelMat=a(this.position.x-H/2,this.position.y-H/2,H),e.setMatrices(),t.uniform1f(this.program.hp,this.hp),t.drawArrays(t.TRIANGLE_STRIP,0,4)}}class k{constructor(e,t,a,o,n,r,i){this.context=e,this.parent=t,this.channel=a,this.ticksPerBeat=o,this.beatsPerMinute=n,this.beatsPerBar=r,this.done=i,this.oscillatorPool=[],this.gainPool=[],this.finalTime=0}playSequence(e,a){const t=this.channel[1][e],o=60/(this.ticksPerBeat*this.beatsPerMinute);if(t)for(const e of t)for(let n=0;n<e.p.length;n+=1){const r=e.p[n],l=r.t*o+a;for(let t=0;t<e.n.length;t+=1){const a=e.n[t],[o,i]=this.get(t);0==n?i.gain.setValueAtTime(r.v/100,l+0.01):i.gain.exponentialRampToValueAtTime(r.v/100||1e-5,l-0.03),n==e.p.length-1&&i.gain.exponentialRampToValueAtTime(1e-4,l);const c=n==e.p.length-1?0:s(440,a-8);o.frequency.setValueAtTime(c,l),l>this.finalTime&&(this.finalTime=l)}}}play(e){this.finalTime=0;for(let t=0;t<this.channel[2].length;t+=1){const a=this.channel[2][t]-1;this.playSequence(a,e+60*(t*this.beatsPerBar)/this.beatsPerMinute)}setTimeout(()=>{this.done()},1e3*this.finalTime+800-1e3*e)}get(e){if(e>=this.oscillatorPool.length){const e=this.context.createOscillator(),t=this.context.createGain();t.connect(this.parent),e.connect(t),e.frequency.setValueAtTime(0,0),e.type=this.channel[0].wave,e.start(),this.oscillatorPool.push(e),this.gainPool.push(t)}return[this.oscillatorPool[e],this.gainPool[e]]}}const V="square",z=0,q=0,G=new class{constructor(){this.camera=a(-8,-8,0.85,0);const e=document.querySelector("canvas");R=this.gl=e.getContext("webgl");const t=()=>{const t=innerWidth,a=innerHeight;e.width=t,e.height=a;let o=-10,n=10,r=10,i=-10;const l=1/(o-n),s=1/(r-i);this.projMat=new Float32Array([-2*l,0,0,0,0,-2*s,0,0,0,0,2*(1/-160),0,(o+n)*l,(i+r)*s,0,1]),R.viewport(0,0,t,a)};onresize=t,t(),R.clearColor(0,0,0,1),R.blendFunc(R.SRC_ALPHA,R.ONE_MINUS_SRC_ALPHA),R.enable(R.BLEND),this.squareBuffer=R.createBuffer(),R.bindBuffer(R.ARRAY_BUFFER,this.squareBuffer),R.bufferData(R.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),R.STATIC_DRAW)}use(e){this.currentProgram!==e&&(this.currentProgram=e,R.useProgram(e.shaderProgram))}setMatrices(){R.uniformMatrix4fv(this.currentProgram.viewMat,!1,this.camera),R.uniformMatrix4fv(this.currentProgram.modelMat,!1,this.modelMat),R.uniformMatrix4fv(this.currentProgram.projMat,!1,this.projMat)}},j=new class{constructor(e){this.renderer=e,this.downMap={},this.startTime=Date.now(),this.minimapActivated=0,this.level=0,this.maxLevel=0,this.shadowCount=0,this.startVector=[0,0],this.currentVector=[0,0],this.mazeShaders=new M(e,P,"precision mediump float;uniform int l,m,p;uniform float k,n,g;varying vec2 d;float i(float a){return 1.-a*a;}const vec3 e=vec3(.858824,.266667,.215686);void main(){vec4 j=vec4(0,0,0,g),b=vec4(1,1,1,g);b=l==0?m==1?vec4(1,0,0,1):mod((d.x-d.y)*10.,2.)>1.?vec4(1,1,0,1):vec4(.2,.2,.2,1):l==1?m==1?vec4(0,1,0,1):mod(d.x*10.,2.)>1.&&mod(d.y*10.,2.)>1.||mod(d.x*10.,2.)<1.&&mod(d.y*10.,2.)<1.?vec4(1,1,1,1):vec4(0,0,0,1):l==2?vec4(.5,.5,.5,1):b;vec4 a=mix(vec4(.5,.5,.5,1),b,1.-i(l<2?1.:k));if(m==1&&p==1){float c=n<.5?n/.5:1.-(n-.5)/.5;a=mix(a,vec4(.5,.5,.5,1),c);}a.a=1.-g,gl_FragColor=a;}"),this.shooterProgram=new M(e,P,"precision mediump float;varying vec2 d;float f(float a,float b){float c=a<1.-2.*b?1.:a>1.?0.:1.-(a-(1.-2.*b))/.1;return c*c;}const vec3 e=vec3(.858824,.266667,.215686);void main(){vec2 a=d-.5;float b=f(distance(vec2(0,0),a)*2.,.05);gl_FragColor=vec4(e,b);}"),this.bulletShaders=new M(e,P,"precision mediump float;varying vec2 d;float f(float a,float b){float c=a<1.-2.*b?1.:a>1.?0.:1.-(a-(1.-2.*b))/.1;return c*c;}const vec3 e=vec3(.858824,.266667,.215686);void main(){vec2 a=d-.5;float c=distance(vec2(0,0),a)*2.,b=f(c,.05)*2.,j=(atan(a.y/a.x)+1.)/2.;gl_FragColor=mix(vec4(1,0,0,b),vec4(.6,0.,0.,b),j);}"),this.proximityProgram=new M(e,P,"precision mediump float;varying vec2 d;float f(float a,float b){float c=a<1.-2.*b?1.:a>1.?0.:1.-(a-(1.-2.*b))/.1;return c*c;}const vec3 e=vec3(.858824,.266667,.215686);void main(){vec2 c=d-.5;float a=distance(vec2(0,0),c)*2.,b=f(a,.02);gl_FragColor=a<.25?vec4(e,b):vec4(.3,.3,.6,b);}"),this.explosionProgram=new M(e,P,"precision mediump float;varying vec2 d;float f(float a,float b){float c=a<1.-2.*b?1.:a>1.?0.:1.-(a-(1.-2.*b))/.1;return c*c;}const vec3 e=vec3(.858824,.266667,.215686);void main(){vec2 a=d-.5;float b=f(distance(vec2(0,0),a)*2.,.02);gl_FragColor=vec4(.8,0,0,b);}"),this.shadowShaders=new M(e,P,"precision mediump float;uniform float h;const vec3 e=vec3(.858824,.266667,.215686);void main(){gl_FragColor=mix(vec4(0,0,0,1.),vec4(1,1,1,1.),h>1.?(h-1.)*2.:0.);}"),this.flashlightShaders=new M(e,P,"precision mediump float;uniform float k,h;varying vec2 d;float i(float a){return 1.-a*a;}const vec3 e=vec3(.858824,.266667,.215686);float s(float a){return (1.+.2*sin(5e-3*a)+.05*sin(.8*a)+1.2*sin(.024*a)+.8*sin(.1*a))/10.;}void main(){vec2 b=d-.5;float a=1.-i(distance(vec2(0,0),b/(.55*h)));a+=s(k);float c=h>1.?(h-1.)*2.:0.;gl_FragColor=mix(vec4(0,0,0,a),vec4(1,1,1,1),c);}"),this.indicatorShaders=new M(e,P,"precision mediump float;uniform float k;varying vec2 d;float f(float a,float b){float c=a<1.-2.*b?1.:a>1.?0.:1.-(a-(1.-2.*b))/.1;return c*c;}const vec3 e=vec3(.858824,.266667,.215686);void main(){vec2 a=d-.5;float b=f(distance(vec2(0,0),a)*2.,.05);gl_FragColor=vec4(0,.75,.75,b*.85*k);}"),this.dropShadowShaders=new M(e,P,"precision mediump float;uniform float g;void main(){gl_FragColor=vec4(0,0,0,1.-g);}const vec3 e=vec3(.858824,.266667,.215686);"),this.shieldProgram=new M(e,P,"precision mediump float;uniform float g;varying vec2 d;float i(float a){return 1.-a*a;}const vec3 e=vec3(.858824,.266667,.215686);void main(){vec2 c=d-.5;float j=distance(vec2(0,0),c)*2.1;vec2 a=d-vec2(.5,.8);a.x*=23.,a.y*=-36.;bool b=false;b=a.x>-7.&&a.x<7.&&a.y>a.x*a.x/2.5?a.y<(a.x<-3.5?pow(a.x+3.5,2.)/6.+17.5:a.x<0.?pow(a.x+3.5,2.)/1.7+17.5:a.x<3.5?pow(a.x-3.5,2.)/1.7+17.5:pow(a.x-3.5,2.)/6.+17.5):b,gl_FragColor=b?mix(vec4(0,1,1,1.-g),vec4(0,0.,0.,1.-g),1.-i(j+g)):vec4(0,0,0,0);}"),this.player=new U(this),this.buildWorld(),onkeydown=(e)=>{this.downMap[e.key.toLowerCase()]=1},onkeyup=(e)=>{this.downMap[e.key.toLowerCase()]=0};const t=(e)=>{e.preventDefault();e.targetTouches&&e.targetTouches[0]||e;this.startVector=[window.innerWidth/2,window.innerHeight/2]},a=(e)=>{e.preventDefault(),this.startVector=[0,0]},o=(e)=>{e.preventDefault();const t=e.targetTouches&&e.targetTouches[0]||e;this.currentVector=[t.clientX,t.clientY]};addEventListener("touchstart",t,{passive:!1}),addEventListener("touchend",a,{passive:!1}),addEventListener("touchmove",o,{passive:!1}),onmouseup=a,onmousedown=t,onmousemove=o}buildWorld(){this.entities=[],this.pendingEntities=[],this.minimapActivated=0;const t=l(this.level);[this.grid,this.start,this.end]=w(t,t),n(this.level,this.maxLevel);const a=[O,B],o=[F,C];for(const t in this.grid.nodes){const n=this.grid.nodes[t];if(n!==this.start&&n!==this.end){if(0===e(0,25)){const t=o[e(0,o.length)];this.entities.push(new t(n.position.x,n.position.y))}const t=e(0,2);for(let o=0;o<t;o+=1){const t=a[e(0,a.length)],o=new t(n.position.x+0.2+0.6*Math.random(),n.position.y+0.2+0.6*Math.random(),this.level,n.distance);this.entities.push(o)}}}this.player.start(this.start.position.x,this.start.position.y)}processInput(){const{player:e,grid:t,downMap:a}=this;let{x:n,y:r}=e.position;const i=n,l=r,s=t.get(e.position);if(!this.startVector[0]&&!this.startVector[1])a.arrowup&&(r-=e.speed*g.delta),a.arrowdown&&(r+=e.speed*g.delta),a.arrowleft&&(n-=e.speed*g.delta),a.arrowright&&(n+=e.speed*g.delta),a.w&&(r-=e.speed*g.delta),a.s&&(r+=e.speed*g.delta),a.a&&(n-=e.speed*g.delta),a.d&&(n+=e.speed*g.delta);else{let t=[this.currentVector[0]-this.startVector[0],this.currentVector[1]-this.startVector[1]];t=t[0]*t[0]>p(S.MAX_TOUCH_DISTANCE,2)?o(t):[t[0]/S.MAX_TOUCH_DISTANCE,t[1]/S.MAX_TOUCH_DISTANCE],n+=t[0]*e.speed*g.delta,r+=t[1]*e.speed*g.delta}let c=0.01,d=c;0.5>i%1&&(c*=-1),0.5>l%1&&(d*=-1),s.passable(new T(n+c,l+d))&&(e.position.x=n),s.passable(new T(i+c,r+d))&&(e.position.y=r),s.touched=!1,s.time||(s.time=Date.now())}buildShadows(){let e=[];const t=500;for(const a in this.grid.nodes){function n(a,n,r,i){const l=o([a-s,n-c]),d=o([r-s,i-c]),p=[a+l[0]*t,n+l[1]*t],v=[r+d[0]*t,i+d[1]*t];e=e.concat([a,n],p,[r,i],p,[r,i],v)}const r=this.grid.nodes[a],{x:i,y:l}=r.position,{x:s,y:c}=this.player.position,d=s-i,p=c-l;d*d+p*p<4&&(!r.passable(new T(i,l-1))&&n(i,l,i+1,l),!r.passable(new T(i-1,l))&&n(i,l,i,l+1))}const{gl:a}=this.renderer;this.shadowBuffer&&a.deleteBuffer(this.shadowBuffer),this.shadowBuffer=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.shadowBuffer);const n=new Float32Array(e);a.bufferData(a.ARRAY_BUFFER,n,a.STREAM_DRAW),this.shadowCount=n.length/2}draw(){g.lastFrame+=1e3*g.delta/S.TIME_DILATION,g.delta=(Date.now()-g.lastFrame)/1e3*S.TIME_DILATION,this.processInput();const e=this.player,t=S.CAMERA_SCALE;this.renderer.camera=new Float32Array([t,0,0,0,0,t,0,0,0,0,1,0,-t*e.position.x,-t*e.position.y,1,1]),this.buildShadows();const o=this.renderer.gl;this.grid.draw(this,!1);const n=[];this.entities=this.entities.concat(this.pendingEntities),this.pendingEntities=[];for(const t of this.entities){if(d(e.position.x-t.position.x)>S.RENDER_AOE||d(e.position.y-t.position.y)>S.RENDER_AOE)continue;const a=t.simulate(this);a?t.draw(this):n.push(t)}for(const e of n)this.entities.splice(this.entities.indexOf(e),1);e.simulate(),e.draw(),this.flashlightShaders.use(),this.renderer.modelMat=a(e.position.x-1,e.position.y-1,2),this.renderer.setMatrices(),o.uniform1f(this.flashlightShaders.hp,this.player.hp),o.uniform1f(this.flashlightShaders.t,(Date.now()-this.startTime)/100),o.drawArrays(o.TRIANGLE_STRIP,0,4),this.shadowCount&&(this.shadowShaders.use(),o.bindBuffer(o.ARRAY_BUFFER,this.shadowBuffer),o.vertexAttribPointer(this.mazeShaders.vertPos,2,o.FLOAT,!1,0,0),this.renderer.modelMat=a(0,0,1),this.renderer.setMatrices(),o.uniform1f(this.shadowShaders.hp,this.player.hp),o.drawArrays(o.TRIANGLES,0,this.shadowCount));this.end.position.add(0.5).add(e.position);if((Date.now()-this.minimapActivated)*S.TIME_DILATION<S.MINIMAP_DURATION){const e=2/this.grid.height;this.renderer.camera=new Float32Array([e,0,0,0,0,e,0,0,0,0,1,0,8,-10,1,1]),this.grid.draw(this,!0)}(0.01>e.hp&&1>e.actualHP||1.5<=e.hp&&1.5<e.actualHP)&&(1<e.hp?this.level+=1:this.level=0,this.level>this.maxLevel&&(this.maxLevel=this.level),e.setHP(1),this.buildWorld());const r=this.grid.get(e.position);r===this.end&&1.8>e.actualHP&&(e.setHP(1.8),this.entities=[])}}(G),Y=new class{constructor(e,t,a,o,n){this.beatsPerMinute=a,this.beatsPerBar=o,this.loopBars=n,this.channels=[];const r=new AudioContext;this.createdTime=Date.now();const i=r.createGain();i.gain.value=0.02,i.connect(r.destination);for(const l of e){const e=new k(r,i,l,t,a,o,()=>{this.channelsRemaining-=1,0===this.channelsRemaining&&this.play()});this.channels.push(e)}}play(){this.channelsRemaining=this.channels.length;const e=(Date.now()-this.createdTime)/1e3;for(const t of this.channels)t.play(e)}}([[{wave:"triangle",envelope:1,filter:q},[[{n:[54],p:[{t:0,b:0,v:100},{t:2,b:0,v:100}]},{n:[55],p:[{t:4,b:0,v:100},{t:6,b:0,v:100}]},{n:[54],p:[{t:8,b:0,v:100},{t:10,b:0,v:100}]},{n:[51],p:[{t:12,b:0,v:100},{t:14,b:0,v:100}]},{n:[47],p:[{t:16,b:0,v:100},{t:18,b:0,v:100}]},{n:[56,55],p:[{t:24,b:0,v:100},{t:26,b:0,v:100}]}],[{n:[54],p:[{t:0,b:0,v:100},{t:2,b:0,v:100}]},{n:[50],p:[{t:4,b:0,v:100},{t:6,b:0,v:100}]},{n:[47],p:[{t:8,b:0,v:100},{t:10,b:0,v:100}]},{n:[44],p:[{t:10,b:0,v:100},{t:12,b:0,v:100}]},{n:[42],p:[{t:12,b:0,v:100},{t:14,b:0,v:100}]},{n:[42],p:[{t:16,b:0,v:100},{t:18,b:0,v:100}]}],[{n:[56],p:[{t:0,b:0,v:100},{t:2,b:0,v:100}]},{n:[56],p:[{t:2,b:0,v:100},{t:4,b:0,v:100}]},{n:[59],p:[{t:4,b:0,v:100},{t:6,b:0,v:100}]},{n:[63],p:[{t:8,b:0,v:100},{t:10,b:0,v:100}]},{n:[66],p:[{t:10,b:0,v:100},{t:12,b:0,v:100}]},{n:[67],p:[{t:12,b:0,v:100},{t:14,b:0,v:100}]},{n:[71],p:[{t:16,b:0,v:100},{t:18,b:0,v:100}]}],[{n:[54],p:[{t:0,b:0,v:100},{t:4,b:0,v:100}]},{n:[51],p:[{t:4,b:0,v:100},{t:8,b:0,v:100}]},{n:[56],p:[{t:8,b:0,v:100},{t:12,b:0,v:100}]},{n:[59],p:[{t:12,b:0,v:100},{t:16,b:0,v:100}]},{n:[54],p:[{t:16,b:0,v:100},{t:20,b:0,v:100}]},{n:[51],p:[{t:20,b:0,v:100},{t:24,b:0,v:100}]},{n:[47],p:[{t:24,b:0,v:100},{t:28,b:0,v:100}]}],[{n:[56],p:[{t:0,b:0,v:100},{t:2,b:0,v:100}]},{n:[56],p:[{t:2,b:0,v:100},{t:4,b:0,v:100}]},{n:[54],p:[{t:4,b:0,v:100},{t:6,b:0,v:100}]},{n:[51],p:[{t:8,b:0,v:100},{t:10,b:0,v:100}]},{n:[50],p:[{t:10,b:0,v:100},{t:12,b:0,v:100}]},{n:[47],p:[{t:12,b:0,v:100},{t:14,b:0,v:100}]},{n:[44,43],p:[{t:16,b:0,v:100},{t:18,b:0,v:100}]}],[{n:[54],p:[{t:0,b:0,v:100},{t:4,b:0,v:100}]},{n:[51],p:[{t:4,b:0,v:100},{t:8,b:0,v:100}]},{n:[56],p:[{t:8,b:0,v:100},{t:12,b:0,v:100}]},{n:[59],p:[{t:12,b:0,v:100},{t:16,b:0,v:100}]},{n:[60],p:[{t:16,b:0,v:100},{t:20,b:0,v:100}]},{n:[59],p:[{t:20,b:0,v:100},{t:24,b:0,v:100}]},{n:[63],p:[{t:24,b:0,v:100},{t:28,b:0,v:100}]}],[{n:[56],p:[{t:0,b:0,v:100},{t:2,b:0,v:100}]},{n:[55],p:[{t:2,b:0,v:100},{t:4,b:0,v:100}]},{n:[56],p:[{t:4,b:0,v:100},{t:6,b:0,v:100}]},{n:[59],p:[{t:6,b:0,v:100},{t:8,b:0,v:100}]},{n:[56],p:[{t:8,b:0,v:100},{t:10,b:0,v:100}]},{n:[55],p:[{t:10,b:0,v:100},{t:12,b:0,v:100}]},{n:[56],p:[{t:12,b:0,v:100},{t:14,b:0,v:100}]},{n:[59],p:[{t:14,b:0,v:100},{t:16,b:0,v:100}]},{n:[56],p:[{t:16,b:0,v:100},{t:18,b:0,v:100}]},{n:[55],p:[{t:18,b:0,v:100},{t:20,b:0,v:100}]},{n:[54,59],p:[{t:24,b:0,v:100},{t:26,b:0,v:100}]}],[{n:[56],p:[{t:0,b:0,v:100},{t:2,b:0,v:100}]},{n:[55],p:[{t:2,b:0,v:100},{t:4,b:0,v:100}]},{n:[56],p:[{t:4,b:0,v:100},{t:6,b:0,v:100}]},{n:[59],p:[{t:6,b:0,v:100},{t:8,b:0,v:100}]},{n:[56],p:[{t:8,b:0,v:100},{t:10,b:0,v:100}]},{n:[55],p:[{t:10,b:0,v:100},{t:12,b:0,v:100}]},{n:[54],p:[{t:12,b:0,v:100},{t:14,b:0,v:100}]},{n:[51],p:[{t:14,b:0,v:100},{t:16,b:0,v:100}]},{n:[50],p:[{t:16,b:0,v:100},{t:18,b:0,v:100}]},{n:[47],p:[{t:18,b:0,v:100},{t:20,b:0,v:100}]}]],[1,2,1,2,3,5,4,6,4,6,1,2,7,8,1,1]],[{wave:V,envelope:z,filter:q},[[{n:[35],p:[{t:4,b:0,v:100},{t:8,b:0,v:100}]},{n:[43],p:[{t:12,b:0,v:100},{t:16,b:0,v:100}]}],[{n:[44],p:[{t:4,b:0,v:100},{t:8,b:0,v:100}]},{n:[38],p:[{t:12,b:0,v:100},{t:16,b:0,v:100}]}],[{n:[38],p:[{t:4,b:0,v:100},{t:8,b:0,v:100}]},{n:[31],p:[{t:12,b:0,v:100},{t:16,b:0,v:100}]},{n:[38],p:[{t:20,b:0,v:100},{t:24,b:0,v:100}]},{n:[35],p:[{t:28,b:0,v:100},{t:32,b:0,v:100}]}],[{n:[35],p:[{t:0,b:0,v:100},{t:4,b:0,v:100}]},{n:[38],p:[{t:8,b:0,v:100},{t:12,b:0,v:100}]},{n:[35],p:[{t:16,b:0,v:100},{t:20,b:0,v:100}]},{n:[38],p:[{t:24,b:0,v:100},{t:28,b:0,v:100}]}],[],[],[],[]],[1,2,1,2,1,2,3,3,3,3,1,2,4,4,1,1]],[{wave:V,envelope:z,filter:q},[[{n:[18],p:[{t:0,b:0,v:100},{t:4,b:0,v:100}]},{n:[26],p:[{t:8,b:0,v:100},{t:12,b:0,v:100}]},{n:[18],p:[{t:16,b:0,v:100},{t:20,b:0,v:100}]},{n:[30],p:[{t:24,b:0,v:100},{t:28,b:0,v:100}]}],[{n:[18],p:[{t:0,b:0,v:100},{t:4,b:0,v:100}]},{n:[26],p:[{t:8,b:0,v:100},{t:12,b:0,v:100}]},{n:[18],p:[{t:16,b:0,v:100},{t:20,b:0,v:100}]},{n:[23],p:[{t:24,b:0,v:100},{t:28,b:0,v:100}]}],[{n:[26],p:[{t:0,b:0,v:100},{t:4,b:0,v:100}]},{n:[19],p:[{t:8,b:0,v:100},{t:12,b:0,v:100}]},{n:[26],p:[{t:16,b:0,v:100},{t:20,b:0,v:100}]},{n:[23],p:[{t:24,b:0,v:100},{t:28,b:0,v:100}]}],[{n:[18],p:[{t:4,b:0,v:100},{t:8,b:0,v:100}]},{n:[19],p:[{t:12,b:0,v:100},{t:16,b:0,v:100}]},{n:[18],p:[{t:20,b:0,v:100},{t:24,b:0,v:100}]},{n:[20,18],p:[{t:28,b:0,v:100},{t:32,b:0,v:100}]}],[],[],[],[]],[1,1,1,1,1,1,3,3,3,3,1,1,4,4,1,1]],[{wave:"sawtooth",envelope:z},[[],[],[],[],[],[],[],[]],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]]],4,151,8,14);Y.play(),c()</script></body></html>