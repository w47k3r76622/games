(function(){"use strict";function e([e,...t],...n){return n.reduce((e,n)=>e.concat(n,t.shift()),[e]).filter((e)=>null!=e).join("")}function n(...e){return Object.assign({},...e)}function r(e){return"#"===e.charAt(0)&&(e=e.substr(1)),3===e.length&&(e=e.split("").map((e)=>e+e).join("")),e.match(/.{1,2}/g).map((e)=>parseFloat((parseInt(e,16)/255).toFixed(2)))}function a(e){return e.reduce((e,t)=>{let n=(~~(255*t)).toString(16);return 1===n.length&&(n="0"+n),e+n},"#")}function o(e,t,n){let a,r,o;if(0==t)a=r=o=n;else{function i(e,n,r){return 0>r&&(r+=1),1<r&&(r-=1),r<1/6?e+6*(n-e)*r:r<1/2?n:r<2/3?e+6*((n-e)*(2/3-r)):e}let s=0.5>n?n*(1+t):n+t-n*t,c=2*n-s;a=i(c,s,e+1/3),r=i(c,s,e),o=i(c,s,e-1/3)}return[a,r,o]}function i(){let e=new Qe(3);return e[0]=0,e[1]=0,e[2]=0,e}function s(e,t,n){let r=new Qe(3);return r[0]=e,r[1]=t,r[2]=n,r}function c(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function m(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function _(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function d(e,t){let n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2];return Le(n*n+r*r+a*a)}function p(e,t){let n=t[0],r=t[1],a=t[2],o=n*n+r*r+a*a;return 0<o&&(o=1/Le(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o),e}function l(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function f(e,t,n){let r=t[0],a=t[1],o=t[2],i=n[0],s=n[1],c=n[2];return e[0]=a*c-o*s,e[1]=o*i-r*c,e[2]=r*s-a*i,e}function u(e,n,r,a){let t=n[0],o=n[1],i=n[2];return e[0]=t+a*(r[0]-t),e[1]=o+a*(r[1]-o),e[2]=i+a*(r[2]-i),e}function g(e,t,n){let r=t[0],a=t[1],o=t[2],i=n[3]*r+n[7]*a+n[11]*o+n[15];return i=i||1,e[0]=(n[0]*r+n[4]*a+n[8]*o+n[12])/i,e[1]=(n[1]*r+n[5]*a+n[9]*o+n[13])/i,e[2]=(n[2]*r+n[6]*a+n[10]*o+n[14])/i,e}function h(){let e=new Qe(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function v(e,t){let n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],s=t[5],c=t[6],m=t[7],d=t[8],_=t[9],l=t[10],f=t[11],u=t[12],p=t[13],g=t[14],h=t[15],v=n*s-r*i,y=n*c-a*i,b=n*m-o*i,k=r*c-a*s,x=r*m-o*s,A=a*m-o*c,E=d*p-_*u,F=d*g-l*u,R=d*h-f*u,T=_*g-l*p,w=_*h-f*p,L=l*h-f*g,P=v*L-y*w+b*T+k*R-x*F+A*E;return P?(P=1/P,e[0]=(s*L-c*w+m*T)*P,e[1]=(a*w-r*L-o*T)*P,e[2]=(p*A-g*x+h*k)*P,e[3]=(l*x-_*A-f*k)*P,e[4]=(c*R-i*L-m*F)*P,e[5]=(n*L-a*R+o*F)*P,e[6]=(g*b-u*A-h*y)*P,e[7]=(d*A-l*b+f*y)*P,e[8]=(i*w-s*R+m*E)*P,e[9]=(r*R-n*w-o*E)*P,e[10]=(u*x-p*b+h*v)*P,e[11]=(_*b-d*x-f*v)*P,e[12]=(s*F-i*T-c*E)*P,e[13]=(n*T-r*F+a*E)*P,e[14]=(p*y-u*k-g*v)*P,e[15]=(d*k-_*y+l*v)*P,e):null}function y(e,t,n){let r=t[0],a=t[1],o=t[2],i=t[3],s=t[4],c=t[5],m=t[6],d=t[7],_=t[8],l=t[9],f=t[10],u=t[11],p=t[12],g=t[13],h=t[14],v=t[15],y=n[0],b=n[1],k=n[2],x=n[3];return e[0]=y*r+b*s+k*_+x*p,e[1]=y*a+b*c+k*l+x*g,e[2]=y*o+b*m+k*f+x*h,e[3]=y*i+b*d+k*u+x*v,y=n[4],b=n[5],k=n[6],x=n[7],e[4]=y*r+b*s+k*_+x*p,e[5]=y*a+b*c+k*l+x*g,e[6]=y*o+b*m+k*f+x*h,e[7]=y*i+b*d+k*u+x*v,y=n[8],b=n[9],k=n[10],x=n[11],e[8]=y*r+b*s+k*_+x*p,e[9]=y*a+b*c+k*l+x*g,e[10]=y*o+b*m+k*f+x*h,e[11]=y*i+b*d+k*u+x*v,y=n[12],b=n[13],k=n[14],x=n[15],e[12]=y*r+b*s+k*_+x*p,e[13]=y*a+b*c+k*l+x*g,e[14]=y*o+b*m+k*f+x*h,e[15]=y*i+b*d+k*u+x*v,e}function b(e,t,n,r){let a=t[0],o=t[1],i=t[2],s=t[3],c=a+a,m=o+o,d=i+i,_=a*c,l=a*m,f=a*d,u=o*m,p=o*d,g=i*d,h=s*c,v=s*m,y=s*d,b=r[0],k=r[1],x=r[2];return e[0]=(1-(u+g))*b,e[1]=(l+y)*b,e[2]=(f-v)*b,e[3]=0,e[4]=(l-y)*k,e[5]=(1-(_+g))*k,e[6]=(p+h)*k,e[7]=0,e[8]=(f+v)*x,e[9]=(p-h)*x,e[10]=(1-(_+u))*x,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function k(e,t,n,r,a){let o=1/Math.tan(t/2),i=1/(r-a);return e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(a+r)*i,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*a*r*i,e[15]=0,e}function x(e,t,n,r){let a,o,i,s,c,m,d,_,l,f,u=t[0],p=t[1],g=t[2],h=r[0],v=r[1],y=r[2],b=n[0],k=n[1],x=n[2];return Te(u-b)<Xe&&Te(p-k)<Xe&&Te(g-x)<Xe?mat4.identity(e):(d=u-b,_=p-k,l=g-x,f=1/Le(d*d+_*_+l*l),d*=f,_*=f,l*=f,a=v*l-y*_,o=y*d-h*l,i=h*_-v*d,f=Le(a*a+o*o+i*i),f?(f=1/f,a*=f,o*=f,i*=f):(a=0,o=0,i=0),s=_*i-l*o,c=l*a-d*i,m=d*o-_*a,f=Le(s*s+c*c+m*m),f?(f=1/f,s*=f,c*=f,m*=f):(s=0,c=0,m=0),e[0]=a,e[1]=s,e[2]=d,e[3]=0,e[4]=o,e[5]=c,e[6]=_,e[7]=0,e[8]=i,e[9]=m,e[10]=l,e[11]=0,e[12]=-(a*u+o*p+i*g),e[13]=-(s*u+c*p+m*g),e[14]=-(d*u+_*p+l*g),e[15]=1,e)}function A(){let e=new Qe(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function E(){let e=new Qe(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function F(){let e=new Qe(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function R(e,t,n){n*=0.5;let r=Re(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Fe(n),e}function T(e,t,n){let r=t[0],a=t[1],o=t[2],i=t[3],s=n[0],c=n[1],m=n[2],d=n[3];return e[0]=r*d+i*s+a*m-o*c,e[1]=a*d+i*c+o*s-r*m,e[2]=o*d+i*m+r*c-a*s,e[3]=i*d-r*s-a*c-o*m,e}function w(e,n,r,a){let t,o,i,s,c,m=n[0],d=n[1],_=n[2],l=n[3],f=r[0],u=r[1],p=r[2],g=r[3];return o=m*f+d*u+_*p+l*g,0>o&&(o=-o,f=-f,u=-u,p=-p,g=-g),1e-6<1-o?(t=Math.acos(o),i=Re(t),s=Re((1-a)*t)/i,c=Re(a*t)/i):(s=1-a,c=a),e[0]=s*m+c*f,e[1]=s*d+c*u,e[2]=s*_+c*p,e[3]=s*l+c*g,e}function L(e,t){let n,r=t[0]+t[4]+t[8];if(0<r)n=Le(r+1),e[3]=0.5*n,n=0.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);let a=(r+1)%3,o=(r+2)%3;n=Le(t[3*r+r]-t[3*a+a]-t[3*o+o]+1),e[r]=0.5*n,n=0.5/n,e[3]=(t[3*a+o]-t[3*o+a])*n,e[a]=(t[3*a+r]+t[3*r+a])*n,e[o]=(t[3*o+r]+t[3*r+o])*n}return e}function P(e,t,n,r){const a=Float32Array.of(...t,...n,...r);return at(e,L(e,a))}function S(e){return e*Ee/180}function B(e){const t=mt.createBuffer();return mt.bindBuffer(mt.ARRAY_BUFFER,t),mt.bufferData(mt.ARRAY_BUFFER,new Float32Array(e),mt.STATIC_DRAW),t}function U(e){const t=mt.createBuffer();return mt.bindBuffer(mt.ELEMENT_ARRAY_BUFFER,t),mt.bufferData(mt.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),mt.STATIC_DRAW),t}function I(e,t){const n=mt.createShader(e);if(mt.shaderSource(n,t),mt.compileShader(n),!mt.getShaderParameter(n,mt.COMPILE_STATUS))throw mt.getShaderInfoLog(n);return n}function q(e,t){const n=mt.createProgram();if(mt.attachShader(n,e),mt.attachShader(n,t),mt.linkProgram(n),!mt.getProgramParameter(n,mt.LINK_STATUS))throw mt.getProgramInfoLog(n);return n}function M(e){Ht=e}function D(e=0,t=1){return Ae(Vt()*(t-e+1)+e)}function C(e=0,t=1){return Vt()*(t-e)+e}function O(e){return e[D(0,e.length-1)]}function N([e,t],n,r=1.5){const a=C(0,2*Ee),o=C(0,n);return nt(e+o*Fe(a),r,t+o*Re(a))}function j(e){const t=C(-Ee/10,Ee/10),n=C(0,Ee/10),r=nt(Fe(n)*Re(t),Re(n),Fe(n)*Fe(t));return p(r,r),g(r,r,e)}function Y(e,t){return e.reduce((e,n,r)=>e+n*t[r],0)}function G(e){return Le(Y(e,e))}function H(e,t){const n=V.slice();return m(n,e,t),G(n)}function W(e){return Le(xe(1-e,2))}function X(e,t,n){const r=H(e,t),a=Le(n*n)/2;return Math.max(0,1-r/a)}function Q(e,t){return Te(Y(e,t))}function K(e,t,n){const a=t.get_component(pt),o=t.get_component(Xt),i=X(e.position,a.position,n),s=Q(e.rotation,a.rotation),c=Q(a.rotation,o.rotation),m=s*(1-W(i))+c*W(i);return(i+m)/2/2}function J(e,t,n){const a=t.get_component(pt),o=X(e.position,a.position,n),i=Q(e.rotation,a.rotation);return(o*Re(i)+i*Re(o))/(0.8414709848078965*2)}function Z(e=0,t=1){return Ae(Math.random()*(t-e+1)+e)}function $(e){return e[Z(0,e.length-1)]}function z(e,t){const n=Jt.sampleRate*e,r=Jt.createBuffer(2,n,Jt.sampleRate),a=r.getChannelData(0),o=r.getChannelData(1);for(let r=0;r<n;r++)a[r]=(2*Math.random()-1)*xe(1-r/n,t),o[r]=(2*Math.random()-1)*xe(1-r/n,t);return r}function ee(e){const t=Jt.createOscillator();t.type="sine",t.frequency.value=e;const n=Jt.createGain();n.gain.setTargetAtTime(1,Jt.currentTime,.1),n.gain.setTargetAtTime(0,Jt.currentTime+1,.1),t.connect(n),n.connect($t),t.start(),t.stop(Jt.currentTime+10)}function te(){const e=$(Zt);ee(e),setTimeout(te,2e3+Z(0,1e4))}function ne(e,t,n,r){this.modulator_gain=e.createGain(),this.modulator_gain.gain.value=r||300,n.connect(this.modulator_gain),this.modulator_gain.connect(t.frequency),this.connect=(e)=>{t.disconnect(),t.connect(e)},this.disconnect=(e)=>{t.disconnect(e)}}function re(e,t,n){var r=e.createGain();r.gain.value=1,t.connect(r),n.connect(r.gain),this.connect=function(e){r.disconnect(),r.connect(e)}}function ae(e,t,n,r,a,o){var i=6.90776;this.attack_time=n||0.9,this.decay_time=r||0.9,this.min=a||0,this.max=o||50,this.trigger=(n)=>{var r=n||e.currentTime;t.cancelScheduledValues(r),t.setValueAtTime(this.min,r),t.setTargetAtTime(this.max,r,this.attack_time/i),t.setTargetAtTime(this.min,r+this.attack_time+1/44100,this.decay_time/i)}}function oe(e,t){const n=7e3,r=300,a=0.9,o=3e3,i=Jt.createPanner();i.panningModel="equalpower",i.distanceModel="exponential",i.refDistance=0.3,i.setPosition(...e);const s=Jt.createOscillator(),c=Jt.createOscillator(),m=Jt.createOscillator(),d=Jt.createGain(),_=Jt.createGain(),l=Jt.createGain();c.connect(d),m.connect(_);const f=new ne(Jt,s,d),u=new re(Jt,f,_),p=new ae(Jt,l.gain),g=new ae(Jt,c.frequency),h=new ae(Jt,m.frequency),v=new ae(Jt,d.gain),y=new ae(Jt,_.gain);u.connect(l),l.connect(i),i.connect(Jt.destination),f.modulator_gain.gain.value=r+n*en.ifrq,s.frequency.value=r+n*en.ifrq,p.attack_time=a*en.atk,p.decay_time=a*en.dcy,g.max=o*en.fmod1,g.attack_time=a*en.atkf1,g.decay_time=a*en.dcyf1,h.max=o*en.fmod2,h.attack_time=a*en.atkf2,h.decay_time=a*en.dcyf2,v.max=en.amod1,v.attack_time=a*en.atka1,v.decay_time=a*en.dcya1,y.max=-en.amod2,y.attack_time=a*en.atka2,y.decay_time=a*en.dcya2,l.gain.value=0,s.start(0),c.start(0),m.start(0),p.trigger(t),g.trigger(t),h.trigger(t),v.trigger(t),y.trigger(t)}function ie(e){for(let t=0;3>t;t++)setTimeout(()=>{oe(e,Jt.currentTime+0.4*Math.random())},1.2*(1e3*en.atk)*t)}function se(e,t,n,r,a){ie(e);for(let o=0;o<r;o++)setTimeout(()=>{const r=N([e[0],e[2]],n,100),o=new _t({components:[new pt({position:e,scale:[0.2,0.2,0.2]}),new ht({material:jt,color:t}),new xt({frame_time:16})]});o.get_component(xt).frames=nn,o.get_component(pt).look_at(r),o.get_component(pt).rotate_ud(Ee/2),o.get_component(pt).rotate_rl(Math.PI),o.get_component(xt).create_buffers(),a.add(o),new Kt({object:o.get_component(pt),property:"position",to:r,time:1e3*tn,game:a}).start().then(()=>{a.remove(o)})},15*o)}function ce(e,t){const n=o(e,on,t);return a(n)}function me(e){M(xe(Gt/e,2)),_n=[],ln=[];const t=new Ft({width:window.innerWidth,height:window.innerHeight,clear_color:"#eeeeee",far:rn});t.camera.add_component(new bt({keyboard_controlled:!1,mouse_controlled:!1,move_speed:30,rotate_speed:.2}));const n=C(0,1),r=ce(n,sn),a=new qt;a.get_component(pt).scale=[an,1,an],a.get_component(ht).set({material:jt,color:r}),t.add(a);for(let n=0;n<xe(e,2)+1;n++)Wt(n,r,D(0,2)).forEach((e)=>{_n.push(e),t.add(e)});t.camera.get_component(pt).position=N([0,0],rn/3),t.camera.get_component(pt).look_at(O(_n).get_component(pt).position),t.camera.get_component(pt).look_at(j(t.camera.get_component(pt).matrix)),delete t.camera.get_component(bt).dir_desc[69],delete t.camera.get_component(bt).dir_desc[81];const o=D(2,4);for(let t=0;t<o;t++){const e=N([0,0],rn/3,-3);ln.push(e)}return t.on("afterrender",function e(){t.off("afterrender",e);const n={snapshot:t.canvas.toDataURL(),position:t.camera.get_component(pt).position,rotation:t.camera.get_component(pt).rotation};bn(je,n),t.stop()}),[t,n]}function de(e,t,n){e.camera.get_component(pt).set({position:[0,cn,0],rotation:F()}),e.camera.get_component(bt).keyboard_controlled=!0,e.camera.get_component(bt).mouse_controlled=!0,e.camera.add_component(new Xt({target:n}));for(const r of e.entities)r.get_component(ht).color="#000000";e.start(),e.on("tick",()=>{for(let r=0;r<ln.length;r++)if(d(ln[r],e.camera.get_component(pt).position)<mn){se(ln[r],ce(t,sn*K(n,e.camera,rn)),rn/5,dn,e),ln.splice(r,1);break}}),e.on("afterrender",function(){const r=K(n,e.camera,rn);for(const n of e.entities)n.get_component(ht).color=ce(t,sn*r)})}function _e(e,t){e.stop();const n=J(t,e.camera,rn);return Ae(100*n)}function le(e){pn[e.type]=performance.now()}function fe(){pe();for(const e of["mousemove","keydown"])if(pn[e]+fn<performance.now()){bn(Ye,e);break}}function ue(){window.addEventListener("mousemove",le),window.addEventListener("keydown",le),un=setTimeout(fe,5e3);const e=performance.now();pn={mousemove:e,keydown:e}}function pe(){window.removeEventListener("mousemove",le),window.removeEventListener("keydown",le),clearTimeout(un)}function ge(e,t=1){return`<div class="ui"
    onanimationend="dispatch(${Be})"
    style="
      background-color: ${e};
      animation: fadein ${t}s forwards reverse"></div>`}function he(e,t,n=1){return`<div class="ui"
    onanimationend="
      dispatch(${Se});
      dispatch(${e.join(", ")})"
    style="
      background-color: ${t};
      animation: fadein ${n}s forwards"></div>`}function ve({next:t},{id:n,from:r,to:a,duration_in:o,duration_out:i},...s){const[c]=t;return null===c?s:e`
    ${s}
    ${c===n?ge(r,o):he(t,a,i)}`}function ye(t){return e`
    <div class="ui"
      onanimationend="dispatch(${Ve})"
      style="
        background: hsl(${360*t}, 70%, 60%);
        animation: fadein 1s 1s forwards reverse;"></div>
    <div class="ui">
      <div class="pad">Find this moment.</div>
    </div>`}function be(){return e`
    <div class="ui action"
      onclick="dispatch(${He}); goto(${Me})">
      <div class="pad">Find this moment.</div>
    </div>`}function ke(t,n){return e`
     <div class="box action"
       onclick="goto(${qe}, ${n})"
       style="color: rgba(255, 255, 255, 0.35);">
       ${t}</div>
  `}var xe=Math.pow,Ae=Math.floor,Ee=Math.PI,Fe=Math.cos,Re=Math.sin,Te=Math.abs,we=Math.min,Le=Math.sqrt;const Pe=100,Se=101,Be=102,Ue=0,Ie=1,qe=2,Me=3,De=4,Ce=5,Oe=6,Ne=10,je=11,Ye=12,Ge=13,He=14,Ve=15,We={current_scene:Ue,next:[Ue]},Xe=1e-6;let Qe="undefined"==typeof Float32Array?Array:Float32Array;const Ke=function(e){let t=e[0],n=e[1],r=e[2];return Le(t*t+n*n+r*r)},Je=function(){let e=i();return function(t,n,r,a,o,s){let c,i;for(n||(n=3),r||(r=0),i=a?we(a*n+r,t.length):t.length,c=r;c<i;c+=n)e[0]=t[c],e[1]=t[c+1],e[2]=t[c+2],o(e,e,s),t[c]=e[0],t[c+1]=e[1],t[c+2]=e[2];return t}}(),Ze=Float32Array,V=Ze.of(0,0,0),$e=Ze.of(1,1,1),ze=Ze.of(1,0,0),et=Ze.of(0,1,0),tt=Ze.of(0,0,1),nt=(...e)=>Ze.of(...e),rt=function(){let e=E();return function(t,n,r,a,o,s){let c,i;for(n||(n=4),r||(r=0),i=a?we(a*n+r,t.length):t.length,c=r;c<i;c+=n)e[0]=t[c],e[1]=t[c+1],e[2]=t[c+2],e[3]=t[c+3],o(e,e,s),t[c]=e[0],t[c+1]=e[1],t[c+2]=e[2],t[c+3]=e[3];return t}}(),at=function(e,t){let n=t[0],r=t[1],a=t[2],o=t[3],i=n*n+r*r+a*a+o*o;return 0<i&&(i=1/Le(i),e[0]=n*i,e[1]=r*i,e[2]=a*i,e[3]=o*i),e},ot=function(){let e=i(),t=s(1,0,0),n=s(0,1,0);return function(r,o,a){let i=l(o,a);return-0.999999>i?(f(e,t,o),1e-6>Ke(e)&&f(e,n,o),p(e,e),R(r,e,Math.PI),r):0.999999<i?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(f(e,o,a),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+i,at(r,r))}}(),it=function(){let e=F(),n=F();return function(r,o,a,i,s,c){return w(e,o,s,c),w(n,a,i,c),w(r,e,n,2*c*(1-c)),r}}(),st=function(){let e=A();return function(t,n,r,a){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=a[0],e[4]=a[1],e[7]=a[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],at(t,L(t,e))}}(),ct=document.createElement("canvas"),mt=ct.getContext("webgl"),dt={components:[],skip:!1};class _t{constructor(e={}){Object.assign(this,dt,e),this.entities=new Set,this.components=new Map,this.add_components(e.components)}add_component(e){e.entity=this,e.mount(),this.components.set(e.constructor,e)}add_components(e=[]){e.forEach((e)=>this.add_component(e))}get_component(e){return this.components.get(e)}get_components(...e){return e.map((e)=>this.get_component(e))}add(e){e.parent=this,this.entities.add(e)}update(e){if(!this.skip){const t=(t)=>t.update(e);this.components.forEach(t),this.entities.forEach(t)}}render(e){if(!this.skip){const t=(t)=>t.render(e);this.components.forEach(t),this.entities.forEach(t)}}}const lt={entity:null};class ft{constructor(e){Object.assign(this,lt,e)}mount(){}set(e){Object.assign(this,e)}update(){}render(){}}const ut={_scale:$e.slice(),_rotation:F(),scale:$e.slice(),position:V.slice(),rotation:F()};class pt extends ft{constructor(e){super(Object.assign({matrix:h(),world_matrix:h(),world_to_self:h()},ut,e))}get up(){const e=this.matrix.slice(4,7);return p(e,e)}get forward(){const e=this.matrix.slice(8,11);return p(e,e)}set position(e){b(this.matrix,this.rotation,e,this.scale)}get position(){return this.matrix.slice(12,15)}set scale(e){this._scale=e,b(this.matrix,this.rotation,this.position,e)}get scale(){return this._scale}set rotation(e){this._rotation=e,b(this.matrix,e,this.position,this.scale)}get rotation(){return this._rotation}look_at(e){const t=V.slice();m(t,e,this.position),p(t,t);const n=nt(t[2],0,-t[0]);p(n,n);const r=V.slice();f(r,t,n);const a=F();P(a,n,r,t),this.rotation=a}rotate_along(e,t){const n=F();R(n,e,t),T(n,this.rotation,n),this.rotation=n}rotate_rl(e){this.rotate_along(et,e)}rotate_ud(e){this.rotate_along(ze,e)}translate(e){const t=V.slice();c(t,this.position,e),this.position=t}get_view_matrix(e){const t=[];return c(t,this.position,this.forward),x(e,this.position,t,this.up),e}update(){this.entity.parent?y(this.world_matrix,this.entity.parent.get_component(pt).world_matrix,this.matrix):this.world_matrix=this.matrix.slice(),v(this.world_to_self,this.world_matrix)}}const gt={material:null,vertices:[],indices:[],normals:[],color:"fff",color_opacity:1};class ht extends ft{constructor(e){super(e),Object.assign(this,gt,e),this.create_buffers()}set color(e){this._color=e||"fff",this.color_vec=[...r(this._color),this.color_opacity]}get color(){return this._color}create_buffers(){this.buffers={vertices:B(this.vertices),indices:U(this.indices),qty:this.indices.length,normals:B(this.normals)}}render(){this.material.render(this.entity)}}const vt=3,yt={keyboard_controlled:!1,mouse_controlled:!1,move_speed:3.5,rotate_speed:.5,dir_desc:{37:"yl",38:"pu",39:"yr",40:"pd",65:"l",68:"r",69:"u",81:"d",83:"b",87:"f"}};class bt extends ft{constructor(e){super(e),Object.assign(this,yt,e)}handle_keys(e,{f:t=0,b:n=0,l:a=0,r:o=0,u:r=0,d:i=0,pu:s=0,pd:c=0,yl:d=0,yr:l=0}){const f=this.entity.get_component(pt),u=e/1e3*this.move_speed,h=nt(a-o,0,t-n);g(h,h,f.matrix),m(h,h,f.position),h[1]=r-i,p(h,h),_(h,h,u),f.translate(h);this.handle_mouse(e,{x:d*vt-l*vt,y:s*vt-c*vt})}handle_mouse(e,{x:t,y:n}){const r=this.entity.get_component(pt);if(0!==t||0!==n){const a=e/1e3,o=this.rotate_speed*a*t,i=this.rotate_speed*a*n,s=nt(Fe(i)*Re(o),Re(i),Fe(i)*Fe(o));p(s,s),g(s,s,r.matrix),r.look_at(s)}}update(e){if(this.keyboard_controlled&&this.entity.game){const t={};for(const[e,n]of Object.entries(this.dir_desc))t[n]=this.entity.game.get_key(e);this.handle_keys(e,t)}this.mouse_controlled&&this.entity.game&&this.handle_mouse(e,this.entity.game.mouse_delta)}}const kt={buffers:[],current_frame:0,next_frame:1,current_tick:0,frame_time:16};class xt extends ft{constructor(e){super(e),Object.assign(this,kt,e),this.frames&&this.frames.length&&this.create_buffers()}create_buffers(){this.number_of_frames=this.frames.length,this.entity.get_component(ht).buffers=this.frames.map((e)=>({vertices:B(e.vertices),indices:U(e.indices),qty:e.indices.length,normals:B(e.normals)}))}get_next_frame(){let e=this.current_frame;return e++,e%this.number_of_frames}update(){this.current_tick++,this.frame_delta=1-this.current_tick%this.frame_time/this.frame_time,this.current_tick%this.frame_time||(this.current_frame=this.next_frame,this.next_frame=this.get_next_frame())}}const At={canvas:ct,width:800,height:600,dom:document.body,fps:60,running:!0,fov:60,near:0.35,far:85,clear_color:"#FFFFFF",light_position:V.slice(),light_intensity:0.6},Et=["keydown","keyup","mousemove"];class Ft{constructor(e){Object.assign(this,At,e),this.canvas.width=this.width,this.canvas.height=this.height,this.dom.appendChild(ct),this.reset(),this.camera=new _t({components:[new pt,new bt]}),this.camera.game=this,this.projMatrix=h(),this.viewMatrix=h(),k(this.projMatrix,S(this.fov),this.width/this.height,this.near,this.far),this.tick_delta=1e3/this.fps;for(const t of Et){const e="on"+t;this[e]=this[e].bind(this),window.addEventListener(t,this[e])}this.running&&this.start(),mt.enable(mt.CULL_FACE),mt.enable(mt.DEPTH_TEST),mt.clear(mt.DEPTH_BUFFER_BIT|mt.COLOR_BUFFER_BIT)}get clear_color(){return this._clear_color}set clear_color(e){this._clear_color=e;const t=r(e);mt.clearColor(t[0],t[1],t[2],1)}stop(){this.running=!1}start(){this.running=!0,this.last_tick=performance.now(),window.requestAnimationFrame((e)=>this.frame(e))}reset(){this.entities=new Set,this.listeners=new Map,this.keys={},this.mouse_delta={x:0,y:0}}destroy(){for(const e of Et)window.removeEventListener(e,this[e])}emit(e,...t){if(this.listeners.has(e))for(const n of this.listeners.get(e))n(...t)}on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}off(e,t){this.listeners.has(e)&&this.listeners.get(e).delete(t)}onkeydown(t){this.keys[t.keyCode]=1}onkeyup(t){this.keys[t.keyCode]=0}get_key(e){return this.keys[e]||0}onmousemove(t){this.mouse_delta.x-=t.movementX,this.mouse_delta.y-=t.movementY}frame(e){if(this.running&&window.requestAnimationFrame((e)=>this.frame(e)),e>this.last_tick+this.tick_delta){const t=e-this.last_tick,n=Ae(t/this.tick_delta);this.perform_ticks(n),this.render()}}perform_ticks(e){this.mouse_delta.x/=e,this.mouse_delta.y/=e;for(let t=0;t<e;t++)this.last_tick+=this.tick_delta,this.update();this.mouse_delta.x=0,this.mouse_delta.y=0}update(){this.emit("tick",this.last_tick),this.entities.forEach((e)=>e.update(this.tick_delta)),this.camera.update(this.tick_delta),this.camera.get_component(pt).get_view_matrix(this.viewMatrix)}render(){mt.clear(mt.COLOR_BUFFER_BIT|mt.DEPTH_BUFFER_BIT),mt.viewport(0,0,this.canvas.width,this.canvas.height),this.entities.forEach((e)=>e.render()),this.emit("afterrender")}add(e){e.game=this,this.entities.add(e)}remove(e){this.entities.delete(e)}}class Rt{constructor(e){this.to=e.to,this.time=e.time||1e3,this.game=e.game,this.object=e.object,this.property=e.property,this.cb=e.cb}do_step(e){this.current_step=we(1,(e-this.first_tick)/this.tick_delta*this.step),this.action()}action(){}pre_start(){this.tick_delta=this.game.tick_delta,this.first_tick=this.game.last_tick,this.number_of_ticks=Math.ceil(this.time/this.tick_delta),this.step=1/this.number_of_ticks}start(){return this.pre_start(),new Promise((e)=>{const t=(n)=>{1===this.current_step?(this.game.off("tick",t),e()):this.do_step(n,e)};this.game.on("tick",t)})}}class Tt{constructor(){this.uniforms={},this.attribs={}}setup_program(){if(this.program=q(I(mt.VERTEX_SHADER,this.get_shader_code(this.vertex_shader.variables,this.vertex_shader.body)),I(mt.FRAGMENT_SHADER,this.get_shader_code(this.fragment_shader.variables,this.fragment_shader.body))),this.program.error)return void console.log(this.program.error)}get_uniforms_and_attrs(e,t){e.forEach((e)=>{this.uniforms[e]=mt.getUniformLocation(this.program,e)}),t.forEach((e)=>{this.attribs[e]=mt.getAttribLocation(this.program,e)})}get_shader_code(e,t){return`
      precision mediump float;
      ${e}

      void main()
      {
        ${t}
      }
    `}render(e){let t=e,n=t.game;for(;t.parent&&!n;)t=t.parent,n=t.game;const[r,a]=e.get_components(pt,ht);mt.useProgram(this.program),mt.uniformMatrix4fv(this.uniforms.p,mt.FALSE,n.projMatrix),mt.uniformMatrix4fv(this.uniforms.v,mt.FALSE,n.viewMatrix),mt.uniformMatrix4fv(this.uniforms.w,mt.FALSE,r.world_matrix),mt.uniform4fv(this.uniforms.c,a.color_vec),this.apply_shader(e,n)}}const wt=[0.5,0.5,0.5,0.5,0.5,-0.5,0.5,-0.5,0.5,0.5,-0.5,-0.5,-0.5,0.5,-0.5,-0.5,0.5,0.5,-0.5,-0.5,-0.5,-0.5,-0.5,0.5,-0.5,0.5,-0.5,0.5,0.5,-0.5,-0.5,0.5,0.5,0.5,0.5,0.5,-0.5,-0.5,0.5,0.5,-0.5,0.5,-0.5,-0.5,-0.5,0.5,-0.5,-0.5,-0.5,0.5,0.5,0.5,0.5,0.5,-0.5,-0.5,0.5,0.5,-0.5,0.5,0.5,0.5,-0.5,-0.5,0.5,-0.5,0.5,-0.5,-0.5,-0.5,-0.5,-0.5],Lt=[0,2,1,2,3,1,4,6,5,6,7,5,8,10,9,10,11,9,12,14,13,14,15,13,16,18,17,18,19,17,20,22,21,22,23,21],Pt=[1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1];class St extends _t{constructor(e={}){e.components=[new pt,new ht({vertices:wt,indices:Lt,normals:Pt,material:e.material})],super(e)}}const Bt=[-1,0,1,1,0,1,1,0,-1,-1,0,-1],Ut=[0,1,3,3,1,2],It=[0,1,0,0,1,0,0,1,0,0,1,0];class qt extends _t{constructor(e={}){e.components=[new pt,new ht({vertices:Bt,indices:Ut,normals:It,material:e.material})],super(e)}}const Mt=0.5+2.23606797749979/2,Dt=[-1,Mt,0,1,Mt,0,-1,-Mt,0,1,-Mt,0,0,-1,Mt,0,1,Mt,0,-1,-Mt,0,1,-Mt,Mt,0,-1,Mt,0,1,-Mt,0,-1,-Mt,0,1],Ct=[-1,Mt,0,1,Mt,0,-1,-Mt,0,1,-Mt,0,0,-1,Mt,0,1,Mt,0,-1,-Mt,0,1,-Mt,Mt,0,-1,Mt,0,1,-Mt,0,-1,-Mt,0,1],Ot=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];class Nt extends _t{constructor(e={}){e.components=[new pt,new ht({vertices:Dt,indices:Ot,normals:Ct,material:e.material})],super(e)}}const jt=new class extends Tt{constructor(){super(),this.vertex_shader={variables:`uniform mat4 p;
        uniform mat4 v;
        uniform mat4 w;
        uniform float frame_delta;
        uniform float do_morph;
        attribute vec3 P_current;
        attribute vec3 P_next;`,body:`if (do_morph == 1.0) {
        float next_frame_delta = 1.0 - frame_delta;
        gl_Position = p * v * vec4((w * vec4(P_next * next_frame_delta + P_current * frame_delta, 1.0)).xyz, 1.0);
      } else {
        gl_Position = p * v * vec4((w * vec4(P_current, 1.0)).xyz, 1.0);
      }`},this.fragment_shader={variables:"uniform vec4 c;",body:"gl_FragColor = c;"},this.setup_program(),this.get_uniforms_and_attrs(["p","v","w","c","frame_delta","do_morph"],["P_current","P_next"])}apply_shader(e){const[t,n]=e.get_components(ht,xt);let r=t.buffers;n?(r=t.buffers[n.current_frame],mt.bindBuffer(mt.ARRAY_BUFFER,t.buffers[n.next_frame].vertices),mt.vertexAttribPointer(this.attribs.P_next,3,mt.FLOAT,mt.FALSE,0,0),mt.enableVertexAttribArray(this.attribs.P_next),mt.uniform1f(this.uniforms.do_morph,1),mt.uniform1f(this.uniforms.frame_delta,n.frame_delta)):mt.uniform1f(this.uniforms.do_morph,0),mt.bindBuffer(mt.ARRAY_BUFFER,r.vertices),mt.vertexAttribPointer(this.attribs.P_current,3,mt.FLOAT,mt.FALSE,0,0),mt.enableVertexAttribArray(this.attribs.P_current),mt.bindBuffer(mt.ELEMENT_ARRAY_BUFFER,r.indices),mt.drawElements(mt.TRIANGLES,r.qty,mt.UNSIGNED_SHORT,0)}};const Yt=new class extends Tt{constructor(){super(),this.vertex_shader={variables:`  uniform mat4 p;
        uniform mat4 v;
        uniform mat4 w;
        uniform float frame_delta;
        uniform float do_morph;
        attribute vec3 P_current;
        attribute vec3 P_next;
        attribute vec3 N_current;
        attribute vec3 N_next;
        varying vec3 fp;
        varying vec3 fn;`,body:`if (do_morph == 1.0) {
        float next_frame_delta = 1.0 - frame_delta;
        fp = (w * vec4(P_next * next_frame_delta + P_current * frame_delta, 1.0)).xyz;
        fn = (w * vec4(N_next * next_frame_delta + N_current * frame_delta, 0.0)).xyz;
      } else {
        fp = (w * vec4(P_current, 1.0)).xyz;
        fn = (w * vec4(N_current, 0.0)).xyz;
      }
      gl_Position = p * v * vec4(fp, 1.0);`},this.fragment_shader={variables:`uniform vec3 lp;
        uniform vec4 c;
        uniform vec2 li;
        varying vec3 fp;
        varying vec3 fn;`,body:`gl_FragColor = vec4(c.rgb * li.x + li.y * max(dot(fn, normalize(lp - fp)), 0.0), c.a);`},this.setup_program(),this.get_uniforms_and_attrs(["p","v","w","lp","li","c","do_morph","frame_delta"],["P_current","P_next","N_current","N_next"])}apply_shader(e,t){const[n,r]=e.get_components(ht,xt);let a=n.buffers;r?(a=n.buffers[r.current_frame],mt.bindBuffer(mt.ARRAY_BUFFER,n.buffers[r.next_frame].vertices),mt.vertexAttribPointer(this.attribs.P_next,3,mt.FLOAT,mt.FALSE,0,0),mt.enableVertexAttribArray(this.attribs.P_next),mt.uniform1f(this.uniforms.do_morph,1),mt.uniform1f(this.uniforms.frame_delta,r.frame_delta)):mt.uniform1f(this.uniforms.do_morph,0),mt.bindBuffer(mt.ARRAY_BUFFER,a.vertices),mt.vertexAttribPointer(this.attribs.P_current,3,mt.FLOAT,mt.FALSE,0,0),mt.enableVertexAttribArray(this.attribs.P_current),mt.bindBuffer(mt.ARRAY_BUFFER,a.normals),mt.vertexAttribPointer(this.attribs.N_current,3,mt.FLOAT,mt.FALSE,0,0),mt.enableVertexAttribArray(this.attribs.N_current),mt.bindBuffer(mt.ELEMENT_ARRAY_BUFFER,a.indices),mt.drawElements(mt.TRIANGLES,a.qty,mt.UNSIGNED_SHORT,0),mt.uniform3fv(this.uniforms.lp,t.light_position),mt.uniform2fv(this.uniforms.li,[t.light_intensity,1-t.light_intensity])}},Gt=132079672568928;let Ht=Gt;const Vt=function(){return Ht=16807*Ht%2147483647,(Ht-1)/2147483646},Wt=(e,t,n)=>{let r=[];const a=Fe(e*Ee),o=Fe(e*Ee),i=75+100*Re(e*Ee/6);switch(n){case 0:case 1:for(let n=D(0,2);n--;){const n=D(5,80),s=D(5,80),c=new St;c.get_component(ht).set({material:jt,color:t}),c.get_component(pt).set({position:[a*i+s,n/2,20*o*e],scale:[s,n,D(5,80)]}),r.push(c)}break;case 2:const s=new Nt,c=new St,m=D(12,17);c.get_component(pt).set({position:[a*i,m/2,20*o*e],scale:[1,m,1]}),c.get_component(ht).set({material:jt,color:t}),r.push(c);const d=D(2,7);s.get_component(pt).set({position:[a*i,m,20*o*e],scale:[d,d,d]}),s.get_component(ht).set({material:jt,color:t}),r.push(s);break;case 3:const _=new St;_.get_component(ht).set({color:"#000000",material:jt}),_.get_component(pt).set({position:[0,1,0]}),r.push(_);}return r};class Xt extends pt{update(){this.position=this.entity.get_component(pt).position,this.look_at(this.target.position)}}const Qt=[2,1,0,6,3,0,6,0,9,2,0,3,2,1,0,6,3,0,6,0,9,2,0,3,19,1,2,19,1,2,2,16,19,2,16,19,2,3,16,2,3,16,16,3,6,16,6,17,16,3,6,16,6,17,7,18,17,7,17,6,7,18,17,7,17,6,10,11,18,10,18,7,10,11,18,10,18,7,8,11,10,8,10,7,8,11,10,8,10,7,9,8,7,9,8,7,9,7,6,9,7,6,6,5,4,6,4,3,14,5,6,12,14,6,12,6,3,6,5,4,6,4,3,14,5,6,12,14,6,12,6,3,4,12,3,4,12,3,5,13,4,13,12,4,5,13,4,13,12,4,15,14,12,15,12,13,15,14,12,15,12,13,14,15,5,14,15,5,5,15,13,5,15,13,20,21,22,29,20,23,23,20,22,20,21,22,29,20,23,23,20,22,22,21,39,22,21,39,36,23,22,39,36,22,36,23,22,39,36,22,37,23,36,37,23,36,26,37,38,37,26,23,26,37,38,37,26,23,23,25,26,26,27,28,26,28,29,26,38,27,29,23,26,26,25,34,23,26,34,23,25,26,26,27,28,26,28,29,26,38,27,29,23,26,26,25,34,23,26,34,27,38,30,27,30,28,27,38,30,27,30,28,38,31,30,38,31,30,30,31,28,30,31,28,33,32,34,33,34,35,23,34,32,25,35,34,33,32,34,33,34,35,23,34,32,25,35,34,24,33,35,24,32,33,24,33,35,24,32,33,23,32,24,23,32,24,23,24,25,23,24,25,24,35,25,24,35,25];class Kt extends Rt{action(){const e=[];u(e,this.from,this.to,this.current_step),this.object[this.property]=e}pre_start(){super.pre_start(),this.from=this.object[this.property].slice()}}const Jt=new AudioContext,Zt=[220,246.942,261.626,293.665,329.628,349.228,415.305,440],$t=Jt.createBiquadFilter();$t.type="lowpass",$t.frequency.value=100,$t.Q.value=10;const zt=Jt.createConvolver();zt.buffer=z(10,10),$t.connect(zt),zt.connect(Jt.destination);const en={ifrq:0.0204082,atk:0.367347,dcy:0.183673,fmod1:0.0612245,atkf1:0,dcyf1:1,fmod2:0.285714,atkf2:0.22449,dcyf2:0.489796,amod1:0.367347,atka1:0.387755,dcya1:0.734694,amod2:0.204082,atka2:0.428571,dcya2:0.142857},tn=4,nn=[[0,1,0.0432336,0,2.66717,-0.0897549,-0.311383,2.19602,0.234146,-0.63757,1.36243,0.125756,-2.39534,2.44478,-0.378434,-1.73172,-1.46682,-0.378434,-0.891271,-1.67049,0.125756,-2.88463,-2.81215,0.125755,0,-3.5,0.108391,0,-1.67049,-0.39161,-1.59801,-4.78739,0.125755,0,-5.27165,0.234146,-2.39534,2.44478,-0.126923,-3.45125,2.35058,-3.40775,-1.73172,-1.46682,-0.126923,-3.10363,0.637105,-3.60768,0,1,0.40839,0,-1.67049,0.464128,0,-2.87961,0.359902,0,2.16981,0.60839,0,1,0.0432336,0,2.66717,-0.0897549,0.311383,2.19602,0.234146,0.63757,1.36243,0.125756,2.39534,2.44478,-0.378434,1.73172,-1.46682,-0.378434,0.891271,-1.67049,0.125756,2.88463,-2.81215,0.125755,0,-3.5,0.108391,0,-1.67049,-0.39161,1.59801,-4.78739,0.125755,0,-5.27165,0.234146,2.39534,2.44478,-0.126923,3.45125,2.35058,-3.40775,1.73172,-1.46682,-0.126923,3.10363,0.637105,-3.60768,0,1,0.40839,0,-1.67049,0.464128,0,-2.87961,0.359902,0,2.16981,0.60839],[0,1,-0.18593,0,2.66717,-0.318919,-0.311383,2.19602,0.00498234,-0.63757,1.36243,0.125756,-2.13574,2.71753,0.924384,-1.27253,-1.44252,0.497551,-0.891271,-1.67049,0.125756,-2.88463,-2.81215,0.125755,0,-3.5,-0.120773,0,-1.67049,-0.620773,-1.59801,-4.78739,0.125755,0,-5.27165,0.00498211,-2.13066,2.69291,1.17464,-5.74559,1.12196,4.29641,-1.26745,-1.46715,0.747802,-5.69843,-0.612202,4.29641,0,1,0.179227,0,-1.67049,0.234964,0,-2.87961,0.130738,0,2.16981,0.379227,0,1,-0.18593,0,2.66717,-0.318919,0.311383,2.19602,0.00498234,0.63757,1.36243,0.125756,2.13574,2.71753,0.924384,1.27253,-1.44252,0.497551,0.891271,-1.67049,0.125756,2.88463,-2.81215,0.125755,0,-3.5,-0.120773,0,-1.67049,-0.620773,1.59801,-4.78739,0.125755,0,-5.27165,0.00498211,2.13066,2.69291,1.17464,5.74559,1.12196,4.29641,1.26745,-1.46715,0.747802,5.69843,-0.612202,4.29641,0,1,0.179227,0,-1.67049,0.234964,0,-2.87961,0.130738,0,2.16981,0.379227]].map((e)=>({vertices:e,indices:Qt})),rn=1e3,an=10*rn,on=0.7,sn=0.6,cn=1.74,mn=25,dn=25;let _n=[],ln=[];const fn=5e3;let un,pn={};const gn={level:null,hue:0,target:null,results:[],clickable:!0,idle_reason:null},hn=function(e){return function(t={},n,r){return Object.keys(e).reduce((a,o)=>Object.assign(a,{[o]:e[o](t[o],n,r)}),t)}}({nav:function(e=We,t,r){switch(t){case Pe:return n(e,{next:r});case Be:return n(e,{next:[null]});case Se:{const{next:[t]}=e;return n(e,{current_scene:t})}default:return e;}},game:function(e=gn,t,r){function a(){bn(Ge),kn(De)}switch(t){case Ne:{te();const t=localStorage.getItem("results"),r=t?t.split(" ").map((e)=>parseInt(e)):[];return n(e,{results:r})}case qe:{const[t]=r,[a,o]=me(t+1);return n(e,{index:t,level:a,hue:o,clickable:!1})}case Ve:{const{clickable:t}=e;return n(e,{clickable:!t})}case je:{const[t]=r;return n(e,{target:t})}case He:{const{level:t}=e;return t.canvas.requestPointerLock(),e}case Me:{const{level:t,hue:r,target:o}=e;return de(t,r,o),t.canvas.addEventListener("click",a),ue(),n(e,{idle_reason:null})}case Ye:{const[t]=r;return n(e,{idle_reason:t})}case Ge:{const{level:t,index:r,target:o,results:i}=e,s=_e(t,o),c=[...i.slice(0,r),s,...i.slice(r+1)];return pe(),t.canvas.removeEventListener("click",a),document.exitPointerLock(),localStorage.setItem("results",c.join(" ")),n(e,{results:c})}case Ce:return n(e,{level:null});default:return Object.assign({},gn,e);}}}),{attach:vn,connect:yn,dispatch:bn}=function(e){function t(){for(const[e,t]of r){const r=t();if(r!==a.get(e)){a.set(e,r),e.innerHTML=r;const t=new CustomEvent("render",{detail:n});e.dispatchEvent(t)}}}let n=e();const r=new Map,a=new Map;return{attach(e,n){r.set(n,e),t()},connect(e){return(...t)=>e(n,...t)},dispatch(r,...a){n=e(n,r,a),t()}}}(hn),kn=(...e)=>bn(Pe,...e);window.dispatch=bn,window.goto=kn,bn(Ne);var xn=yn((e,...t)=>ve(e.nav,...t));const An=[function(){return xn({id:Ue,from:"#000",to:"#000"},e`
      <div class="ui action"
        onclick="goto(${Ie})">
        <div class="pad" style="margin: 1.3rem 0 1rem;">A moment lost in time.</div>
        <div style="font-size: 0.3rem; animation: fadein 1s 3s both">
          A story by <a href="https://piesku.com">piesku.com</a>.</div>
      </div>`)},function({results:t}){const n=t.length?`goto(${Ce})`:`goto(${qe}, 0)`;return xn({id:Ie,from:"#000",to:"#000"},e`
      <div class="ui action" onclick="${n}">
        <div class="pad">
          Collect your memories before they fade away.
        </div>
      </div>`)},function({hue:e,clickable:t}){return xn({id:qe,from:"#000",to:"#fff"},t?be():ye(e))},function({idle_reason:t}){const n="keydown"===t?"Walk with the WASD keys.":"Move the mouse.";return xn({id:Me,from:"#fff",to:"#fff",duration_out:.1},e`<div class="ui"
      onclick="dispatch(${Ge}); goto(${De})">
        ${t&&`<div style="opacity: 0; animation: fadein 2s 1s alternate 2;">${n}</div>`}</div>`)},function({results:t,index:n,target:r}){const a=t[n],o=15>a?"Doesn't look like it.":35>a?"It was something else.":50>a?"It's not quite the same.":75>a?"Could it be?":85>a?"It reminds you of something.":95>a?"That's it, almost there.":"Wonderful. You've found it.";return xn({id:De,from:"#fff",duration_in:1.9,to:"#000"},e`
      <img class="ui"
        style="opacity: .5"
        src="${r.snapshot}">
      <div class="ui action"
        onclick="goto(${Ce})">
        <div class="pad" style="margin: 1.5rem 0 1rem;">${o}</div>
        <div>${t[n]}</div>
      </div>`)},function({results:t}){const n=t.reduce((e,t)=>e+t),r=Ae(n/t.length),a=100*(1-2/t.length);return xn({id:Ce,from:"#000",to:"#000"},e`
      <div class="ui" style="background: #111">
        <div class="pad">
          ${t.map(ke)}
          ${r>a?`<div class="box action"
                onclick="goto(${qe}, ${t.length})">next</div>`:`<div class="box action"
                onclick="goto(${Oe})"
                title="Collect more accurate moments before advancing.">…?</div>`}
        </div>
      </div>`)},function(){return xn({id:Oe,from:"#000",to:"#000"},e`
      <div class="ui action" style="background: #111"
        onclick="goto(${Ce})">
        <div class="pad">
          The path onward is never easy.
          Collect more accurate moments before venturing forth.
        </div>
      </div>`)}];var En=yn(function({game:e,nav:{current_scene:t}}){const n=An[t];return n?n(e):""});vn(En,document.querySelector("#root"))})();
