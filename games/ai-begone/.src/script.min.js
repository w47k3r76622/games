var aa=Math.floor(1e4*Math.random()),ba=noise={};function g(a,e,t){this.x=a,this.y=e,this.z=t}function ca(a,e,t){return a.x*e+a.y*t}for(var da=[new g(1,1,0),new g(-1,1,0),new g(1,-1,0),new g(-1,-1,0),new g(1,0,1),new g(-1,0,1),new g(1,0,-1),new g(-1,0,-1),new g(0,1,1),new g(0,-1,1),new g(0,1,-1),new g(0,-1,-1)],ea=Array(256),m=0;256>m;m++)ea[m]=n(0,255);var p=Array(512),u=Array(512);ba.Fa=function(a){0<a&&1>a&&(a*=65536),256>(a=Math.floor(a))&&(a|=a<<8);for(var e=0;256>e;e++){var t=1&e?ea[e]^255&a:ea[e]^a>>8&255;p[e]=p[e+256]=t,u[e]=u[e+256]=da[t%12]}},ba.Fa(0),ba.v=function(a,e){var t=Math.floor(a),n=Math.floor(e),r=(a-=t)*a*a*(a*(6*a-15)+10),i=(e-=n)*e*e*(e*(6*e-15)+10);return(1-i)*((1-r)*ca(u[(t&=255)+p[n&=255]],a,e)+r*ca(u[t+1+p[n]],a-1,e))+i*((1-r)*ca(u[t+p[n+1]],a,e-1)+r*ca(u[t+1+p[n+1]],a-1,e-1))},noise.Fa(aa);var fa={A:[[1,1,1],[1,,1],[1,,1],[1,1,1],[1,,1]],B:[[1,1],[1,,1],[1,1,1],[1,,1],[1,1]],C:[[1,1,1],[1],[1],[1],[1,1,1]],D:[[1,1],[1,,1],[1,,1],[1,,1],[1,1]],E:[[1,1,1],[1],[1,1,1],[1],[1,1,1]],F:[[1,1,1],[1],[1,1],[1],[1]],G:[[,1,1],[1],[1,,1,1],[1,,,1],[,1,1]],H:[[1,,1],[1,,1],[1,1,1],[1,,1],[1,,1]],I:[[1,1,1],[,1],[,1],[,1],[1,1,1]],J:[[1,1,1],[,,1],[,,1],[1,,1],[1,1,1]],K:[[1,,,1],[1,,1],[1,1],[1,,1],[1,,,1]],L:[[1],[1],[1],[1],[1,1,1]],M:[[1,1,1,1,1],[1,,1,,1],[1,,1,,1],[1,,,,1],[1,,,,1]],N:[[1,,,1],[1,1,,1],[1,,1,1],[1,,,1],[1,,,1]],O:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],P:[[1,1,1],[1,,1],[1,1,1],[1],[1]],Q:[[0,1,1],[1,,,1],[1,,,1],[1,,1,1],[1,1,1,1]],R:[[1,1,1],[1,,1],[1,,1],[1,1],[1,,1]],S:[[1,1,1],[1],[1,1,1],[,,1],[1,1,1]],T:[[1,1,1],[,1],[,1],[,1],[,1]],U:[[1,,1],[1,,1],[1,,1],[1,,1],[1,1,1]],V:[[1,,,,1],[1,,,,1],[,1,,1],[,1,,1],[,,1]],X:[[1,,,,1],[,1,,1],[,,1],[,1,,1],[1,,,,1]],Y:[[1,,1],[1,,1],[,1],[,1],[,1]],0:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],1:[[,1],[,1],[,1],[,1],[,1]],2:[[1,1,1],[0,,1],[1,1,1],[1,,0],[1,1,1]],3:[[1,1,1],[0,,1],[1,1,1],[0,,1],[1,1,1]],4:[[1,,1],[1,,1],[1,1,1],[0,,1],[0,,1]],5:[[1,1,1],[1,,0],[1,1,1],[0,,1],[1,1,1]],6:[[1,1,1],[1,,0],[1,1,1],[1,,1],[1,1,1]],7:[[1,1,1],[0,,1],[0,,1],[0,,1],[0,,1]],8:[[1,1,1],[1,,1],[1,1,1],[1,,1],[1,1,1]],9:[[1,1,1],[1,,1],[1,1,1],[0,,1],[1,1,1]],":":[[,,],[,1],[,,],[,1],[,,]],"/":[[0,,1],[0,1,0],[0,1,0],[0,1,0],[1,,0]]," ":[[,,],[,,],[,,],[,,],[,,]],"%":[[0,,,1,0],[1,,1,,0],[0,,1,,0],[0,,1,,1],[0,1,,,0]],",":[[,,],[,,],[,,],[,1],[1,,]]};function ha(a){var e=[];a=a.toUpperCase();for(var t=0;t<a.length;t++){var n=fa[a.charAt(t)];null!=n&&e.push(n)}return e}function ia(a){a=ha(a);for(var e=0,t=0;t<a.length;t++){for(var n=a[t],r=0,i=0;i<n.length;i++)r=Math.max(r,2*n[i].length);e+=2+r}return e}function x(a,e,t,n,r){a=ha(a),y.fillStyle=r;for(var i=r=0;i<a.length;i++){for(var o=a[i],l=0,h=0,b=0;b<o.length;b++){for(var s=o[b],f=0;f<s.length;f++)s[f]&&y.fillRect(f*n+r+e,l+t,n,n);h=Math.max(h,s.length*n),l+=n}r+=n+h}return r}function z(){var a=1e4*Math.sin(aa++);return a-Math.floor(a)}function ja(a,e){var t=A[a];if(0==a)return{x:0,y:0};if(0==t.l)return B(0,0,A[t.l].o,t.o,t.Z,e+t.ha);var n=ja(t.l,e);return B(n.x,n.y,A[t.l].o,t.o,t.Z,e+t.ha)}function B(a,e,t,n,r,i){return t=Math.sqrt(2.5*(t+n)/r)/r,{x:Math.cos(i*t)*r+a,y:Math.sin(i*t)*r+e}}function ka(a,e,t,n,r,i){var y=B(a,e,t,n,r,i);return y=C((a=B(a,e,t,n,r,i+.01)).x-y.x,a.y-y.y),t=Math.sqrt(2.5*(t+n)/r),y.x*=t,y.y*=t,y}function la(a,e,t,n,r){if(0==a)return 0==t?{x:0,y:0}:ka(0,0,A[0].o,e,t,n+r);a=A[a];var i=ka(A[a.l].x,A[a.l].y,A[a.l].o,a.o,a.Z,n+a.ha),y=la(a.l,e,0,n,r);return i={x:i.x+y.x,y:i.y+y.y},0==t?i:(e=ka(a.x,a.y,a.o,e,t,n+r),{x:i.x+e.x,y:i.y+e.y})}function ma(a,e){var t={x:0,y:0};if(-1===e)for(var n=0;n<A.length;n++){var r=A[n];r=na(a,r.x,r.y,A[n].o),t.x+=r.x,t.y+=r.y}else for(n=0;n<A.length;n++)r=na(a,(r=ja(n,e)).x,r.y,A[n].o),t.x+=r.x,t.y+=r.y;return t}function oa(a,e){for(var t=0;t<A.length;t++){var n=ja(t,e);if(D(a.x,a.y,n.x,n.y)<=1.02*A[t].a)return{f:t,sa:(n=C(a.x-n.x,a.y-n.y)).x*A[t].a*1.02,ta:n.y*A[t].a*1.02,rb:n.x,sb:n.y}}return null}function pa(a,e,t){var n=E;a:{var r=oa(a,n);if(null!=r){var i=A[r.f];if(null!=i.i)for(var y=0;y<i.i.length;y++){var o=i.i[y],l=o.x*i.a*.98+i.x,h=o.y*i.a*.98+i.y;if(D(l,h,a.x,a.y)<=2*o.size){r={Ga:o,ga:y,f:r.f,tb:l,ub:h};break a}}}r=null}n=oa(a,n);a:{for(e=void 0===(e=void 0===e?-1:e)?-1:e,t=void 0===(t=void 0===t?1:t)?1:t,i=0;i<F.length;i++)if(((0==(y=F[i].g)?1==e:e!=y)||-1==e)&&(y=8,1==F[i].type?y=16:2==F[i].type&&(y=32),D(a.x,a.y,F[i].x,F[i].y)<=y*t)){F[i].ga=i,a=F[i];break a}a=null}return{Ga:r,f:n,ma:a}}function na(a,e,t,n){var r=C(e-a.x,t-a.y);return n=n/((e=a.x-e)*e+(a=a.y-t)*a)*2.5,{x:r.x*n,y:r.y*n}}function qa(a){var e=n(0,100),t=n(0,5);return ra(50>=e?0:90>=e?1:2,z(),a,t)}function G(a,e){var t,r;if(0==a)var i=t=r=n(128,180);else 1==a?50<=n(0,100)?(t=n(50,170),i=n(90,200),r=n(80,170)):(t=n(100,200),i=n(80,170),r=n(50,100)):2==a?(t=n(100,250),i=n(40,100),r=n(50,100)):3==a?(t=n(50,200),i=n(50,200),r=n(50,200)):(t=n(0,255),i=n(0,255),r=n(0,255));return"rgb("+t*e+","+i*e+","+r*e+")"}function sa(a){var e=E;return a==A[0]?{x:0,y:0}:la(a.l,a.o,a.Z,e,a.ha)}function ta(a){if(0==a)var e=(a=n(80,160))*n(80,100)*.01,t=a*n(100,130)*.01;else 1==a?(e=(a=n(120,210))*n(40,90)*.01,t=a*n(20,50)*.01):t=e=a=n(80,110);return"rgb("+a+","+e+","+t+")"}function n(a,e){return Math.floor(a+z()*(e+1-a))}function ua(a){var e=document.createElement("canvas"),t=e.getContext("2d");return e.width=a.width,e.height=a.height,t.putImageData(a,0,0),(a=new Image).src=e.toDataURL(),e.innerHTML="",a}function va(a,e,t){var n=y.globalCompositeOperation;y.globalCompositeOperation="lighter",y.translate(a,e),y.scale(t,t),y.drawImage(wa,-H.width/2,-H.height/2),y.scale(1/t,1/t),y.translate(-a,-e),y.globalCompositeOperation=n}function xa(){y.setTransform(1,0,0,1,0,0),y.translate(I.width/2,I.height/2),ya&&y.rotate(-F[0].c-Math.PI),y.scale(J,J),y.translate(-za,-Aa)}function Ba(a){return Math.abs(a)>=2*Math.PI&&(a%=2*Math.PI),0>=a&&(a=2*Math.PI+a),a}function Ca(a,e){var t=a-e;return t>Math.PI&&(t=-2*Math.PI+t),t}function Da(a){return 0==a?"Free":isNaN(a)?"":a.toString()}function C(a,e){var t=Math.sqrt(a*a+e*e);return{x:a/t,y:e/t}}function D(a,e,t,n){return a-=t,e-=n,Math.sqrt(a*a+e*e)}function Ea(a,e,t){var n=Math.atan2(e,a);return n+=t,{x:(a=Math.sqrt(a*a+e*e))*Math.cos(n),y:a*Math.sin(n)}}function Fa(a,e){a.h.va={target:e,type:0}}function Ga(a,e){a.frame=e,a.h.xa={type:0,Ca:0}}function Ha(a,e,t){a.frame=e,a.h.xa={type:1,a:t,Ra:!1,Sa:!1,Ea:4,Ya:0}}function Ia(a,e,t){var n=Ca(Ba(a.c),t.target);e=Math.abs(Ca(Ba(a.c+a.$*e),t.target))-Math.abs(n);var r=1;return 1>=Math.abs(n)&&(r=Math.max(1*Math.abs(n)*Math.abs(n),.6)),0>e?Math.abs(a.$)>=Math.min(2*Math.abs(n),1)&&(a.b.c=Math.abs(n)<=Math.PI/4?-Math.sign(n)*r*.1:0):a.b.c=-Math.sign(n)*r*1.4,.01>=Math.abs(n)&&.1>=Math.abs(a.$)&&(a.$=0,a.c=t.target,a.b.c=0),Math.abs(n)}function L(a,e,t,r,i,y,o,l,h){h=void 0===h?.5:h,Ja.push({x:a,y:e,ia:t,ja:r,time:0,size:i,speed:y,$a:o,eb:!0}),t=i/100,h=void 0===h?.6:h,a=Math.min(Math.max(700/(10*D(za,Aa,a,e)),.005),1),e=.05+1.7*t,freq=n(150-.14*t,280-.14*t),l||(e=.1+.67*t),a*=h,zzfx(Math.min(4*a,1),0,n(freq-200*t,2*freq),e,-5,0,8,0,.81),l&&zzfx(Math.min(a*t*2,1),0,n(freq,freq+100),n(1,.1*t)*t*e*4,0,0,8,0,0)}String.prototype.splice||(String.prototype.splice=function(a,e,t){return this.slice(0,a)+t+this.slice(a+Math.abs(e))}),zzfx_v=.5,zzfx_x=new AudioContext,zzfx=function(a,e,t,n,r,i,y,o,l){var h=Math.PI;t=2*h/44100*t*(1+e*(2*Math.random()-1)),i*=1e3*h/Math.pow(44100,2),r*=0|(n=0<n?44100*(10<n?10:n)|0:1),o*=2*h/44100,l*=h,e=[];for(var b=h=0,s=0;s<n;++s)e[s]=a*zzfx_v*Math.cos(h*t*Math.cos(b*o+l))*(s<r?s/r:1-(s-r)/(n-r)),h+=1+y*(2*Math.random()-1),b+=1+y*(2*Math.random()-1),t+=i;return a=zzfx_x.createBuffer(1,n,44100),t=zzfx_x.createBufferSource(),a.getChannelData(0).set(e),t.buffer=a,t.connect(zzfx_x.destination),t.start(),t};var Ka="Lygkos;Lithos;Guamedo;Eadu;Anoth;Dikti;Big Iron".split(";"),La="Delphi Trapani Erytrae Gaia Boston Jericho Nile".split(" "),Ma="Bespin;Nuvo;Jupiter;Vol;Lightbulb;Big Boy".split(";"),Na="Rhodes Jairo Jakku Savareen Arrakis Sahara".split(" "),Oa=0,E=0,I=document.getElementById("canvas");I.width=1*window.innerWidth,I.height=1*window.innerHeight;for(var Qa,wa,Ua,y=I.getContext("2d"),M=Math.floor(Math.max(I.width,I.height)*(1+Math.sqrt(2))),Pa=y.createImageData(M,M),H=y.createImageData(768,768),A=[],Ra=n(9,14),Ja=[],Sa=[],Ta=[],F=[],Va=[],za=0,Aa=0,J=.5,N={x:0,y:0},Wa=0,Xa=0,Ya=0,O=1,P=0,ya=!1,Za=[0,1,2,4,10,25,50,100],Q=0,R=0,S="",T=0,U=5e3,$a=!1,ab=!1,bb=[1,1,1],cb=[0,0,0],db=n(0,1e4),V=0;V<M;V++)for(var W=0;W<M;W++){var eb=V*M+W,fb=0,gb=0,hb=0,ib=noise.v(.001*W,.001*V),jb=noise.v(.01*W+5,.01*V+5);gb=.7*(fb=255*(noise.v(.01*W+ib,.01*V+ib)+noise.v(.05*W,.05*V)+ib))+60*jb,hb=.5*fb+128*jb,9995<=n(0,1e4)?hb=gb=fb=255:(fb*=.25,gb*=.25,hb*=.25),Pa.data[4*eb]=.6*fb,Pa.data[4*eb+1]=.6*gb,Pa.data[4*eb+2]=.6*hb,Pa.data[4*eb+3]=255}Qa=ua(Pa);for(var kb=0;768>kb;kb++)for(var lb=0;768>lb;lb++){var nb=768*kb+lb,ob=lb-384,pb=kb-384,X=768/((ob*ob+pb*pb)/6),qb=X,rb=Math.atan2(pb,ob);qb+=.6*noise.v(15*rb,0),qb-=1-Math.pow(X,.03);var sb=Math.max(1-(X-1)*(X-1),0),tb=Math.max(1-(X-1.2)*(X-1.2),0),ub=Math.max(1-(X-1.4)*(X-1.4),0),vb=noise.v(16*rb,7)*tb+tb,wb=noise.v(32*rb,15)*ub+ub;H.data[4*nb]=200*qb+128*(noise.v(8*rb,1)*sb+sb),H.data[4*nb+1]=160*qb+118*vb,H.data[4*nb+2]=128*qb+98*wb,H.data[4*nb+3]=255*qb}for(wa=ua(H);!xb(););Ua.name="Sun";var yb=1;for(m=0;m<A.length;m++)if(1==A[m].type){yb=m,A[m].name="Earth",A[m].i=[],zb(A[m],.3,0);break}F.push(ra(0,db,2,bb[0]));var Ab=F[0],Bb=B(A[yb].x,A[yb].y,A[yb].o,.001,800,E+0),Cb=la(yb,.001,800,E,0);Ab.x=Bb.x,Ab.y=Bb.y,Ab.speed.x=Cb.x,Ab.speed.y=Cb.y,F[0].s=[],F[0].frame=yb;var Db=!1,Eb=!1,Fb=0,Y=-1,Gb=0,Hb=-1,Ib=!1,Jb=0,Kb=!1,Lb=!1;O=0;var Mb=!1;function Nb(){for(var a=P,e=0;e<O;e++){Jb-=a=P,Ob=!1;for(var t=1;t<A.length;t++){var r=A[t];Pb(r,a);var i=B(A[r.l].x,A[r.l].y,A[r.l].o,r.o,r.Z,E+r.ha);r.x=i.x,r.y=i.y}if(Ob?Z=Qb:(Z=Rb,null!=F[0]&&F[0].da&&(0==(r=A[F[0].w.f]).type||3<=r.type?Z=Sb:2==r.type?Z=Tb:1==r.type&&(Z=Ub))),0<P){for(t=0;t<F.length;t++)if(null!=(r=F[t])){if(0<t){i=r;var y=a,o=2*(noise.v(i.h.ua+3*E,i.h.ua+2*E)+1);if(-1!=i.h.target&&!i.Aa){var l=F[i.h.target];if(null!=l){var h={x:l.x,y:l.y},b=D(l.x,l.y,i.x,i.y);h.x+=(l.speed.x-i.speed.x)*b*.0016*o,h.y+=(l.speed.y-i.speed.y)*b*.0016*o,Vb(i,h)}}if(o=1e3,i.h.ua-=y,0>=i.h.ua){for(1==i.g&&500<=n(0,1e3)&&(i.h.target=0),i.h.target=-1,l=0;l<F.length;l++)h=i.g,b=F[l].g,(0==h?1==b:b!=h)&&600<=n(0,1e3)&&(found=!0,i.h.target=l);i.h.ua=-1==i.h.target?n(1,5):n(3,16)}if(i.Ba=-1!=i.h.target,null!=i.h.va&&0==i.h.va.type&&(o=Ia(i,y,i.h.va)),null!=i.h.xa)if(0==(l=i.h.xa).type)Fa(i,Wb(i)+Math.PI),h=i.b.m,.02>=o&&10<=Xb(i)&&0>=l.Ca?i.b.m=1:(i.b.m=0,200>=Yb(i)&&0!=h&&(l.Ca=1)),l.Ca-=y,i.da&&(i.h.xa=null,i.h.va=null,i.b.m=0);else if(1==l.type){h=Yb(i),b=Zb(i);var s=A[i.frame];l.Sa?(l.Ea-=y,0>=l.Ea&&($b(i),l.Ea=4),Fa(i,Wb(i)),10>h&&Ha(i,i.frame,1.4*l.a),i.da&&(i.frame=i.w.f,Ha(i,i.w.f,1.4*l.a)),.1>o?h<.8*l.a?i.b.g=-.05:h>1.2*l.a?i.b.g=.05:(i.b.g=0,i.b.m=0):(i.b.m=0,i.b.g=0)):l.Ra?(Fa(i,l.angle),i.b.m=1,Xb(i)>=Math.sqrt(2.5*(A[i.frame].o+.001)/b)&&(l.a=h,i.b.m=0,l.Sa=!0)):h<=l.a/2?(Fa(i,Math.atan2(i.y-s.y,i.x-s.x)-Math.PI/2),i.b.m=1):h>=l.Ya?(Fa(i,Math.atan2(i.y-s.y,i.x-s.x)),i.b.m=0):(null==l.angle&&(l.angle=Math.atan2(i.y-s.y,i.x-s.x)),Fa(i,l.angle),i.b.m=0,.1>=(o=Ia(i,y,i.h.va))&&(l.Ra=!0)),l.Ya=h}}else 0!=Mb&&(F[0].$-=F[0].$*F[0].aa.Ta*.6*a),Vb(r,N);ac(r,a)&&0!=t&&(F.splice(t,1),(r=Math.abs(Y+1))==t&&(Y=-1),t--)}for(t=0;t<Ja.length;t++)i=a,(r=Ja[t]).time+=i*r.speed,r.x+=r.ia*i,r.y+=r.ja*i,1<=r.time&&(Ja.splice(t,1),t--);for(t=0;t<Ta.length;t++)i=a,(r=Ta[t]).time+=i*r.speed,r.x+=r.ia*i,r.y+=r.ja*i,1<=r.time&&(Ta.splice(t,1),t--);for(t=0;t<Sa.length;t++)o=a,(r=Sa[t]).x+=r.ia*o,r.y+=r.ja*o,i=ma(r,E),r.ia+=i.x*o,r.ja+=i.y*o,i=Math.pow(r.size,2.5),null!=(y=pa(r,r.g)).ma?(L(r.x,r.y,y.ma.speed.x,y.ma.speed.y,17*r.size,2.4,.4,!1),y.ma.j-=i,r=!0):null!=y.f?(o=y.f,h=la((l=A[o.f]).l,l.o,l.Z,E,l.ha),L(r.x,r.y,h.x,h.y,17*r.size,2.4,.4,!1),null!=y.Ga&&2==r.g&&(o=y.Ga,(r=(l=A[o.f]).i[o.ga]).j-=.5*i,0>=l.ea&&(l.Ia=!0),l.ea=60,0>=r.j&&(L(o.tb,o.ub,h.x,h.y,7*r.size,1.5,1,!1),l.i.splice(o.ga,1),l.La=bc(l))),r=!0):(r.Oa-=o,r=0>=r.Oa),r&&(Sa.splice(t,1),t--);E+=a}}if(0<P&&(0<O&&(0==F[0].b.m&&0==F[0].b.g||zzfx(.25,.1,12,.1,.5,0,1.9,79.5,.75),0!=F[0].b.c&&zzfx(.03,.1,45,.1,.5,0,4,79.5,.75)),(N={x:Wa,y:Xa}).x-=I.width/2,N.y-=I.height/2,ya&&(e=Ea(N.x,N.y,F[0].c+Math.PI),N.x=e.x,N.y=e.y),N.x*=1/J,N.y*=1/J,N.x+=za,N.y+=Aa,0>Y?(r=Math.abs(Y+1),null!=F[r]&&(za=F[r].x,Aa=F[r].y)):(za=A[Y].x,Aa=A[Y].y),e=pa(N,-1,.5/J),Db&&null!=e.f&&F[0].frame!=e.f.f&&(F[0].frame=e.f.f,S="Reference frame set to "+A[e.f.f].name,R=2),Eb&&(t=Y,null!=e.ma?Y=-(e.ma.ga+1):null!=e.f&&(Y=e.f.f),t!=Y&&(0>Y?(r=Math.abs(Y+1),t="player",0==F[r].g?t="human":1==F[r].g&&(t="ai"),S="Focusing on "+t+" ship"):S="Focusing on "+A[Y].name,R=2)),null==e.f?(Gb=0,Hb=-1):e.f.f!=Hb&&(Gb=0,Hb=e.f.f),0>Fb||0!=F[0].b.m||0!=F[0].b.g?($b(F[0]),Fb=.5):Fb-=a,cc-=cc*P*3,.1>=Math.abs(cc)&&(cc=0),Ya=.16>=(J+=J*cc*P*.8)?Math.max(Math.min(.02/J,1),0):0,Gb+=a,R-=a,Kb||(S="Read the manual",R=5,Kb=!0),!dc&&(ec=.07,0>=(fc-=a))))for(fc=hc,4*++gc>Z.length-1&&(gc=0),a=0;4>a;a++)e=3==a?3:0,t=3==a?hc/2:1.3*hc,null!=(r=Z[4*gc+a])&&zzfx(ec,0,440*Math.pow(1.05946,r),t,0,0,e,0,0)}var ic=0,jc=0;function kc(a){var e=a-Oa;for(Oa=a,P=e/1e3,Nb(),jc=ic=0,y.setTransform(1,0,0,1,0,0),y.translate(I.width/2,I.height/2),ya&&y.rotate(-F[0].c-Math.PI),y.translate(-M/2-I.height/2,-M/2-I.width/2),y.drawImage(Qa,0,0),xa(),va(0,0,85),a=1;a<A.length;a++)if(1==(e=A[a]).Ka?(y.fillStyle=e.gb,y.beginPath(),y.arc(e.x,e.y,e.a,0,2*Math.PI),y.fill(),lc(e.x,e.y,e.a,e.ca,e.Ha)):(y.fillStyle=e.jb,mc(e,e.ob)),null!=e.i&&0<e.i.length)for(var t=0;t<e.i.length;t++){var n=e.i[t],r=n.x*e.a*.98+e.x,i=n.y*e.a*.98+e.y,o=-n.y,l=n.x,h=3*n.size;0==n.g?(jc++,y.fillStyle="rgb("+n.tone+", "+n.tone+", "+n.tone+")",y.strokeStyle="rgb(200, 200, 200)",y.beginPath(),y.moveTo(r-o*n.size,i-l*n.size),y.lineTo(r+o*n.size,i+l*n.size),y.lineTo(r+o*n.size+n.x*h,i+l*n.size+n.y*h),y.lineTo(r-o*n.size+n.x*h,i-l*n.size+n.y*h),y.lineTo(r-o*n.size,i-l*n.size),y.fill()):(ic++,y.fillStyle="rgb("+n.tone+", "+.5*n.tone+", "+.5*n.tone+")",y.strokeStyle="rgb(200, 128, 128)",y.beginPath(),y.moveTo(r-o*n.size*.5,i-l*n.size*.5),y.lineTo(r+o*n.size*.5,i+l*n.size*.5),y.lineTo(r+o*n.size*.5+n.x*h,i+l*n.size*.5+n.y*h),y.lineTo(r-o*n.size*.5+n.x*h,i-l*n.size*.5+n.y*h),y.fill(),y.beginPath(),y.arc(r,i,1*n.size,0,2*Math.PI)),y.stroke()}for(a=0;a<Va.length;a++)if(e=Va[a],t=E,n=A[e.l].x,r=A[e.l].y,.01<=J&&D(za,Aa,n,r)<=Math.max(I.width,I.height)/J+e.pb)for(i=0;i<e.Za.length;i++)o=e.Za[i],l=B(n,r,A[e.l].o,.001,o.Z,t+o.offset),y.fillStyle=o.color,y.beginPath(),y.arc(l.x,l.y,o.size,0,2*Math.PI),y.fill();for(a=0;a<F.length;a++)nc(e=F[a]),oc(e),xa();for(a=1;a<A.length;a++)(e=A[a]).Ka||(y.fillStyle=e.ib,mc(e,e.cb),y.fillStyle=e.hb,y.beginPath(),y.arc(e.x,e.y,e.a,0,2*Math.PI),y.fill()),0<=e.ca&&lc(e.x,e.y,e.a,e.ca,e.Ha);for(a=1;a<A.length;a++){l=(e=A[a]).x*e.x+e.y*e.y,n=(t=Math.PI/2-Math.atan2(-e.y,-e.x))-(r=Math.acos(e.a/Math.sqrt(l+e.a*e.a))),i=t+r,o=1*e.a,0!=e.ca&&(o=e.ca),t=e.x+Math.sin(n)*o,n=e.y+Math.cos(n)*o,r=e.x+Math.sin(i)*o,i=e.y+Math.cos(i)*o,o=32*e.a,h=Math.sqrt(t*t+n*n);var b=Math.sqrt(r*r+i*i),s=Math.sqrt(l);l=t/h,h=n/h;var f=r/b;b=i/b,s=y.createLinearGradient(e.x,e.y,e.x+e.x/s*o,e.y+e.y/s*o),e=.005+Math.max((e.ca-e.a)/32e3,0),s.addColorStop(0,"rgba(0, 0, 0, 0)"),s.addColorStop(e,"rgba(0, 0, 0, 0.8)"),s.addColorStop(1,"rgba(0, 0, 0, 0)"),y.fillStyle=s,y.beginPath(),y.moveTo(t,n),y.lineTo(t+l*o,n+h*o),y.lineTo(r+f*o,i+b*o),y.lineTo(r,i),y.closePath(),y.fill()}for(a=0;a<F.length;a++){for(nc(e=F[a]),t=0;t<e.ba.length;t++)y.fillStyle="rgb(255, 255, 255)",y.strokeStyle="rgb(180, 180, 255)",y.lineWidth=2,r=pc(n=e.ba[t]),y.beginPath(),y.lineTo(n.x+r.Wa,n.y+r.Xa),y.lineTo(n.x+r.mb*(r.b+2)*r.Na,n.y+r.Na*(r.b+2)*r.nb),y.lineTo(n.x+r.Ua,n.y+r.Va),y.fill(),y.stroke();xa()}for(a=0;a<Ja.length;a++)(e=Ja[a]).time<=.1*e.speed&&1==e.eb&&va(e.x,e.y,e.size/256),0!=e.$a&&(y.fillStyle="rgba(255, 255, 255, "+(1-Math.pow(e.time,1/3.5))+")",y.beginPath(),y.arc(e.x,e.y,Math.pow(4*e.time,.4)*e.size*e.$a,0,2*Math.PI),y.fill());for(a=0;a<Sa.length;a++)e=Sa[a],y.strokeStyle="rgb(255, 200, 200)",y.strokeStyle=e.color,y.lineWidth=e.size/(1.5*J),y.beginPath(),y.moveTo(e.x,e.y),t=C(e.ia-F[0].speed.x,e.ja-F[0].speed.y),y.lineTo(e.x-t.x*e.size*5,e.y-t.y*e.size*5),y.stroke();for(a=0;a<Ta.length;a++){for(e=Ta[a],y.beginPath(),t=Math.pow(e.time,2),n=[255,220,200],r=[0,0,0],i=0;3>i;i++)r[i]=70*t+n[i]*(1-e.time);y.fillStyle="rgba("+r[0]+", "+r[1]+", "+r[2]+", "+(1-Math.sqrt(e.time))+")",y.arc(e.x,e.y,Math.sqrt(e.time)*e.size,0,2*Math.PI),y.fill()}if(!Lb){if(0<Ya){for(y.globalAlpha=Ya,a=1;a<A.length;a++)e=A[a],t=A[e.l],y.strokeStyle=e.Ma,y.fillStyle=e.Ma,y.lineWidth=1/J,y.beginPath(),y.arc(t.x,t.y,e.Z,0,2*Math.PI),y.stroke(),y.beginPath(),y.arc(e.x,e.y,e.a,0,2*Math.PI),y.fill(),t=2/J,0!=e.l&&(t=.02>=J?0:1.3/J),0<t&&x(e.name,e.x-4*e.name.length*t/2,e.y+Math.max(e.ca,1.1*e.a),t,e.Ma);y.globalAlpha=1}if(a=F[0],y.strokeStyle="rgb(204,168,255)",y.lineWidth=Math.max(1/J,1),1.5>=J&&1<=J&&(y.globalAlpha=1-2*(J-1)),1.5>=J&&!a.da&&null!=a.s){for(y.beginPath(),e=A[a.frame],t=0;t<a.s.length;t++)r=ja(a.frame,a.s[t].time),n=a.s[t].x-r.x+e.x,r=a.s[t].y-r.y+e.y,0==t?y.moveTo(n,r):y.lineTo(n,r);y.stroke()}y.globalAlpha=1,e=Math.max(42/J,42),y.strokeStyle="rgb(128, 128, 128)",y.lineWidth=Math.max(2/J,2),y.beginPath(),y.arc(a.x,a.y,e,0,2*Math.PI),y.stroke(),n=-(t=qc(a)).x,r=-t.y,i=-t.y,o=t.x,l=t.y,h=-t.x,y.strokeStyle="rgb(255,214,117)",y.beginPath(),y.moveTo(a.x+t.x*e,a.y+t.y*e),y.lineTo(a.x+t.x*e*1.5,a.y+t.y*e*1.5),y.stroke(),y.beginPath(),y.moveTo(a.x+n*e*1.25,a.y+r*e*1.25),y.lineTo(a.x+n*e*1.5,a.y+r*e*1.5),y.stroke(),y.strokeStyle="rgb(87,188,255)",y.beginPath(),y.moveTo(a.x+i*e,a.y+o*e),y.lineTo(a.x+i*e*1.5,a.y+o*e*1.5),y.stroke(),y.beginPath(),y.moveTo(a.x+l*e*1.25,a.y+h*e*1.25),y.lineTo(a.x+l*e*1.5,a.y+h*e*1.5),y.stroke(),y.strokeStyle="white",t=Math.cos(a.c+Math.PI/2),n=Math.sin(a.c+Math.PI/2),y.beginPath(),y.moveTo(a.x+t*e,a.y+n*e),y.lineTo(a.x+t*e*1.25,a.y+n*e*1.25),y.stroke(),0<Hb&&Ib&&rc(),y.setTransform(1,0,0,1,0,0),0<=R&&(y.globalAlpha=R,a=ia(S),x(S,I.width/2-a/2,20,2,"white"),y.globalAlpha=1),0==O&&(a=ia("Paused"),x("Paused",I.width/2-a/2,50,2,"white")),sc()}window.requestAnimationFrame(kc)}window.requestAnimationFrame(function(a){Oa=a,kc(a)});var cc=0;function tc(a){var e="mousedown"==a.type;1==a.which?F[0].Ba=e:2==a.which?(Eb=e,a.preventDefault()):3==a.which&&(Db=e)}I.addEventListener("wheel",function(a){cc-=Math.sign(a.deltaY)}),I.addEventListener("mousemove",function(a){var e=I.getBoundingClientRect(),t=a.clientX-e.left;a=a.clientY-e.top,Wa=t,Xa=a},!1),I.addEventListener("mousedown",tc,!1),I.addEventListener("mouseup",tc,!1),document.onkeydown=document.onkeyup=function(a){var e="keyup"==a.type,t=a.code,n=F[0].b,r=1;e&&(r=0),"KeyT"==t&&(Ib=!e),"KeyW"==t?n.m=r:"KeyS"==t?n.m=-r:"KeyA"==t?n.c=-r:"KeyD"==t?n.c=r:"KeyQ"==t?n.g=-r:"KeyE"==t&&(n.g=r),"Space"==t&&(Mb=r),2<O&&(n.m=0,n.c=0,n.g=0),e||("KeyL"==t&&(S=(ya=!ya)?"Camera locked":"Camera free",R=2),"Period"==t&&(++Q>Za.length-1?Q=Za.length-1:(O=Za[Q],S=O.toString()+"x Timewarp",R=2)),"Comma"==t&&(0>--Q?Q=0:(O=Za[Q],S=O.toString()+"x Timewarp",R=2)),"KeyF"==t&&(Y=-1),"F2"==t&&(Lb=!Lb,a.preventDefault()),"F3"==t&&(dc=!dc,a.preventDefault())),F[0].da&&uc(t,e)};var vc="rgba(0, 0, 0, 0.8)";function rc(){function a(){i=0,o+=16/J}var e=A[Hb],t=N.x,n=N.y;y.globalAlpha=4*Gb,ya&&(y.translate(t,n),y.rotate(F[0].c+Math.PI),y.translate(-t,-n)),y.fillStyle=vc,y.strokeStyle="rgb(255, 255, 255)",y.beginPath(),y.rect(t,n,320/J,350/J),y.fill(),y.stroke();var r=8/J,i=0,o=0;i+=x("Name: ",t+r,n+r,2/J,"rgb(255, 220, 200)"),i+=x(e.name,t+r+i,n+r,2/J,"rgb(255, 255, 255)"),a();var l=0,h=0;if(null!=e.i)for(var b=0;b<e.i.length;b++)0==e.i[b].g?l++:h++;0==l&&0==h?(i+=x("Planet is uninhabited",t+r,n+r+o,2/J,"rgb(255, 220, 200)"),a(),i+=x("Ore: ",t+r,n+r+o,2/J,"rgb(255, 220, 200)"),i+=x(e.la.toString(),t+r+i,n+r+o,2/J,"rgb(255, 255, 255)")):(b=function(a){for(var e=0;e<a.length;e++){var l=.15/J;y.translate(t+i,n+o),y.scale(l,l),oc(a[e]),y.scale(1/l,1/l),y.translate(-t-i,-n-o),(i+=128*l)>=320/J-r&&(i=2*r,o+=350*l)}},i+=x("Cities: ",t+r,n+r+o,2/J,"rgb(255, 220, 200)"),i+=x(l.toString(),t+r+i,n+r+o,2/J,"rgb(0, 255, 0)"),i+=x(" / ",t+r+i,n+r+o,2/J,"rgb(255, 255, 255)"),i+=x(h.toString(),t+r+i,n+r+o,2/J,"rgb(255, 0, 0)"),a(),i+=x("Human Ships: ",t+r,n+r+o,2/J,"rgb(255, 220, 200)"),i+=x(e.ya.length.toString(),t+r+i,n+r+o,2/J,"rgb(255, 255, 255)"),i+=x(" / ",t+r+i,n+r+o,2/J,"rgb(255, 255, 255)"),i+=x(e.La.Ja.toString(),t+r+i,n+r+o,2/J,"rgb(255, 255, 255)"),i+=x("  Resources: ",t+r+i,n+r+o,2/J,"rgb(255, 220, 200)"),i+=x(Math.floor(100*e.qa).toString()+"%",t+r+i,n+r+o,2/J,"rgb(255, 255, 255)"),i=2*r,o+=32/J,b(e.ya),i=0,i+=x("AI Ships: ",t+r,n+r+(o+=64/J),2/J,"rgb(255, 220, 200)"),i+=x(e.oa.length.toString(),t+r+i,n+r+o,2/J,"rgb(255, 255, 255)"),i+=x(" / ",t+r+i,n+r+o,2/J,"rgb(255, 255, 255)"),i+=x(e.La.h.toString(),t+r+i,n+r+o,2/J,"rgb(255, 255, 255)"),i=2*r,o+=32/J,b(e.oa)),xa(),y.globalAlpha=1}function sc(){function a(){t=0,n+=16}function e(a,e,y){t+=x(a,(y=void 0===y?r:y)+4+t,i+4+n,2,"rgb(166,255,128)"),t=f,t+=x(e,y+4+t,i+4+n,2,"rgb(166,255,128)")}y.strokeStyle="rgb(166,255,128)",y.lineWidth=1;var t=0,n=0;if(F[0].da){var r=I.width-180,i=I.height/2-178;y.beginPath(),y.rect(r,i,1e3,256),y.stroke();var o=A[F[0].w.f],l=["M","Mine",NaN];null!=o.i&&0!=o.i.length&&(l=["R","Repair",wc(),"U","Upgrade",xc(),"S","Sell Ore",16*T,"1","Fighter",0,"2","Freighter",4e3*!$a,"3","Destroyer",14e3*!ab]);var h=0,b=0;if(null!=o.i&&0!=o.i.length)for(var s=0;s<o.i.length;s++)0==o.i[s].g?b++:h++;if(s="AI World",b>h?s="Human World":0==b&&0==h&&(s="Free World"),t+=x(s,r+4+t,i+4+n,2,"rgb(166,255,128)"),a(),a(),0<o.ea)x("Planet at war",r+4+t,i+4+n,2,"rgb(166,255,128)"),a(),x(Math.floor(o.ea)+" until peace",r+4+t,i+4+n,2,"rgb(166,255,128)");else for(s=0;s<l.length/3;s++)x(l[3*s],r+4+t,i+4+n,2,"rgb(166,255,128)"),t=20,x(l[3*s+1],r+4+t,i+4+n,2,"rgb(166,255,128)"),t=120,x(Da(l[3*s+2]),r+4+t,i+4+n,2,"rgb(166,255,128)"),a()}r=I.width-180,i=I.height-64,y.beginPath(),y.rect(r,i,1e3,1e3),y.stroke(),n=t=0;var f=80;t+=x("Hull ",r+4+t,i+4+n,2,"rgb(166,255,128)"),t=f,0>F[0].j?t+=x("Dead",r+4+t,i+4+n,2,"rgb(166,255,128)"):(t+=x(Math.floor(F[0].j)+"/",r+4+t,i+4+n,2,"rgb(166,255,128)"),t+=x(Math.floor(F[0].aa.wa).toString(),r+4+t,i+4+n,2,"rgb(166,255,128)")),a(),t+=x("Cargo ",r+4+t,i+4+n,2,"rgb(166,255,128)"),t=f,t+=x(T.toString()+"/",r+4+t,i+4+n,2,"rgb(166,255,128)"),t+=x(Math.floor(F[0].aa.Qa).toString(),r+4+t,i+4+n,2,"rgb(166,255,128)"),a(),e("Money ",Math.floor(U).toString()),a(),e("Level ",F[0].level.toString()),y.beginPath(),y.rect(-5,i,185,1e3),y.stroke(),n=t=0,f=80,e("Frame ",A[F[0].frame].name,0),a(),e("Speed ",Math.floor(Xb(F[0])).toString(),0),a(),e("Altitude ",Math.floor(Yb(F[0])).toString(),0),a(),e("Total AI ",ic.toString(),0)}function yc(a,e,t,r){if(0==a){a=n(350,1e3)*e;var i=zc(n(25,60),n(140,150),a,0,G(0,1),G(0,.5),G(0,1),"0, 0, 0"),y=Ka;850<=n(0,1e3)?zb(i,.01*n(-70,50),z()):i.la=n(100,a*a*.007)}else if(1==a)a=n(300,600)*e,i=zc(n(25,30),n(90,160),a,a+n(120,170),G(1,1),G(1,.5),G(1,1),"120, 120, 255"),y=La,zb(i,.01*n(-70,100),z());else if(2==a)a=n(350,900)*e,i=zc(n(15,25),n(80,120),a,a+n(120,170),G(2,1),G(2,.5),G(2,1),"255, 120, 120"),y=Na,200<=n(0,1e3)?zb(i,.01*n(-80,40),z()):i.la=n(100,a*a*.015);else if(3==a){a=n(700,1800)*e,i=G(3,1),y=a,a+=n(50,300),e=i.splice(0,4,""),i={x:0,y:0,a:y,ca:a,Ha:e=e.splice(i.length-5,2,""),gb:i,wb:G(3,1),Ka:!0},y=Ma,i.la=0}else 4==a&&(a=n(20,150)*e,i=zc(n(25,60),n(140,150),a,0,G(0,1),G(0,.5),G(0,1),"0, 0, 0"),y=Ka,i.la=n(35,a*a*.3));return i.o=4*Math.PI*i.a*i.a,i.Ma=G(-1,2),y=y[t%y.length],-1!=r&&(y=A[r].name+" "+t),i.name=y,i}function xb(){Ua={x:0,y:0,a:5e3,o:375e6,Bb:!0},A.push(Ua);for(var a=0;a<Ra;a++){var e=n(0,4),t=n(9e3,8e4);1==e&&(4e4>=t||8e4<=t)&&(e=2);var r=yc(e,1,a,-1);r.Z=t,r.ha=n(-5e4,5e4),r.l=0,r.type=e,r.ga=A.length,A.push(r)}for(a=1;a<Ra+1;a++){var i=n(0,A[a].a/300);for(t=0;t<i;t++){3==(e=n(0,4))&&(e=0),(r=yc(e,.01*n(25,60),t+1,a)).a>=.6*A[a].a&&(r.a*=.5,r.ca*=.5);var y=A[a].a+5*r.a;r.Z=n(y,y+A[a].Z/16e3*A[a].a),r.ha=n(0,5e5),r.l=a,r.type=e,r.ga=A.length,A.push(r)}if(900<=n(0,1e3)&&150<=A[a].a){r=(e=n(1.5*A[a].a,8*A[a].a))+.01*n(50,300)*A[a].a,i=3e-7*n(80,400),t=a,y=[],100<=(i*=Math.PI*r*r-Math.PI*e*e)&&(i=100);for(var o=0;o<i;o++){var l=n(e,r),h=n(-1e4,1e4),b=n(15,50),s=G(2,.6);y.push({Z:l,offset:h,size:b,color:s})}Va.push({l:t,zb:e,pb:r,Za:y})}}for(Nb(),i=r=e=!1,a=1;a<A.length;a++)if(1==A[a].type&&(e=!0),2==A[a].type&&(r=!0),a<Ra)for(t=1;t<Ra;t++)t!=a&&2e4>=D(A[a].x,A[a].y,A[t].x,A[t].y)&&(i=!0);return!(0==e||0==r||1>=Va.length||i)||(A=[],Va=[],aa+=n(1,5e3),!1)}function zc(a,e,t,r,i,y,o,l){var h=n(0,1e4),b=Array(64),s=Array(64);for(noise.Fa(h),h=0;64>h;h++){var f=noise.v(h/64*a*4,8)*e*.25;b[h]=1.5*Math.max(noise.v(h/64*a,0)*e+noise.v(h/64*a*2,5)*e*.5,0),s[h]=.2*(noise.v(h/64*a,40)*e+f)}return{x:0,y:0,a:t,ca:r,ib:i,jb:y,hb:o,Ha:l,ob:b,cb:s,Ka:!1,i:[],la:0}}function bc(a){for(var e=0,t=0,n=0;n<a.i.length;n++){var r=a.i[n].size/20;0==a.i[n].g?e+=r:t+=r}return{Ja:e=Math.min(Math.floor(e),26),h:t=Math.min(Math.floor(t),26)}}function zb(a,e,t){noise.Fa(t),t=1/(a.a/34);for(var r=0;r<2*Math.PI;r+=t){var i=1.2*noise.v(r,0);if(.2<=Math.abs(i)){nside=Math.max(Math.min(i+e,1),-1),i=1;var y=Math.min(Math.max(.07*Math.abs(i)*a.a,16),40);0<=nside&&(i=0),a.i.push({x:Math.cos(r),y:Math.sin(r),size:y,g:i,tone:n(80,200),j:y,yb:y})}}for(e=bc(a),a.ya=[],a.oa=[],t=0;t<e.Ja+e.h;t++)t<e.Ja?a.ya.push(qa(0)):a.oa.push(qa(1));a.La=e,a.za=[],a.ea=0,a.vb=0,a.xb=0,a.qa=.01*n(5,35)}var Ob=!1;function Pb(a,e){if(null!=a.ea)if(a.ea-=e,0>=a.ea){for(var t=0;t<a.za.length;t++)Ga(a.za[t],a.ga);a.za=[],a.Ia=!0}else if(t=function(e,t){for(var r=0;r<t&&!(0>=e.length);r++){var i=n(0,e.length-1),y=e[i];e.splice(i,1),(i=C(n(0,1e3)-500,n(0,1e3)-500)).x=1.02*i.x*a.a,i.y=1.02*i.y*a.a,y.x=a.x+i.x,y.y=a.y+i.y,y.c=Math.atan2(i.y,i.x)-Math.PI/2,y.speed=sa(a),y.frame=a.ga,Ha(y,a.ga,n(60,a.a)),F.push(y),a.za.push(y)}},Ob=!0,a.Ia){var r=n(1,a.oa.length/2),i=r*a.qa;t(a.oa,r),t(a.ya,i),a.Ia=!1}}function lc(a,e,t,n,r){(t=y.createRadialGradient(a,e,t,a,e,n)).addColorStop(0,"rgba("+r+",0.5)"),t.addColorStop(1,"rgba("+r+", 0)"),y.fillStyle=t,y.beginPath(),y.arc(a,e,n,0,2*Math.PI),y.fill()}function mc(a,e){y.beginPath();for(var t=e.length,n=0;n<t;n++){var r=n/t*2*Math.PI,i=Math.cos(r);r=Math.sin(r);var o=e[n]+15;i=i*a.a+i*o+a.x,r=r*a.a+r*o+a.y,0==n?y.moveTo(i,r):y.lineTo(i,r)}y.fill()}function ra(a,e,t,r){function i(a,e){l.push({x:a,y:e})}function y(a,e,t,n){b.push({x:a,y:e,size:t,t:0,dir:n})}var o=[2.4,13,80,50,1,9,180,160,.6,9,500,60];aa=e,e={};var l=[],h=[],b=[];if(0==a){var s=.5*n(50,100),f=s*n(100,140)*.01,x=f/(2*s);i(-s/2,0),i(s/2,0),i(0,f),i(.5*f*x,.5*f),i(.8*s,.5*f),i(.8*-s,.5*f),i(0,2*f),i(.8*s,.5*f),i(.5*f*x,.5*f),i(0,f);var c=s*n(30,70)*.005;y(-c,0,6,0),y(c,0,6,0),y(0,2*f,6,Math.PI),y(0,2*f,6,Math.PI/2),y(0,2*f,6,-Math.PI/2),y(c,0,6,Math.PI/2),y(-c,0,6,-Math.PI/2),x=(c=n(60,90)*f*.01)*x*.5,h.push({x:x,y:c,dir:0,size:6,angle:Math.PI/2.5,speed:8,W:.08,u:0}),h.push({x:-x,y:c,dir:0,size:6,angle:Math.PI/2.5,speed:8,W:.08,u:0})}else 1==a?(x=(c=(f=(s=.5*n(100,160))*n(140,180)*.01)*n(130,170)*.01)-f,i(-s/2,0),i(s/2,0),i(s/2,f),i(-s/2,f),i(s/8,f),i(s/8,c),i(-s/8,c),i(-s/8,f),i(-s/2,f),c=s*n(30,70)*.05,y(-(c=s*n(30,70)*.005),0,12,0),y(c,0,12,0),y(0,.8*x+f,7,Math.PI),y(0,.8*x+f,7,Math.PI/2),y(0,.8*x+f,7,-Math.PI/2),y(c,0,7,Math.PI/2),y(-c,0,7,-Math.PI/2),c=n(70,100)*f*.01,x=n(50,80)*s*.005,h.push({x:x,y:c,dir:0,size:12,angle:Math.PI/2,speed:4,W:.3,u:0}),h.push({x:-x,y:c,dir:0,size:12,angle:Math.PI/2,speed:4,W:.3,u:0}),c=n(30,60)*f*.01,x=n(50,80)*s*.005,h.push({x:x,y:c,dir:-Math.PI/2,size:16,angle:Math.PI/2,speed:2,W:.5,u:0}),h.push({x:-x,y:c,dir:Math.PI/2,size:16,angle:Math.PI/2,speed:2,W:.5,u:0})):2==a&&(f=(s=.5*n(180,260))*n(200,320)*.01,x=s*n(40,70)*.01,c=n(30,60)*f*.01,i(s/2,0),i(x/2,c),i(s/2,f),i(0,1.1*f),i(-s/2,f),i(-x/2,c),i(-s/2,0),y(s/2.2,0,14,0),y(-s/2.2,0,14,0),y(.5*-x,c,12,1.15*Math.PI),y(.4*x,.74*f,12,Math.PI/2),y(.4*-x,.74*f,12,-Math.PI/2),y(.5*x,.5*c,12,Math.PI/2),y(.5*-x,.5*c,12,-Math.PI/2),y(.5*x,c,12,1.15*-Math.PI),h.push({x:0,y:c,dir:0,size:32,angle:Math.PI,speed:2,W:1,u:0}),h.push({x:x/2.2,y:1.8*c,dir:-Math.PI/2.5,size:20,angle:Math.PI/2,speed:2,W:.4,u:0}),h.push({x:-x/2.2,y:1.8*c,dir:Math.PI/2.5,size:20,angle:Math.PI/2,speed:2,W:.4,u:0}),h.push({x:x/1.8,y:.95*f,dir:0,size:15,angle:Math.PI/2.5,speed:4,W:.1,u:0}),h.push({x:-x/1.8,y:.95*f,dir:0,size:15,angle:Math.PI/2.5,speed:4,W:.1,u:0}));for(x=1+.11*(r-1),e.Ta=o[4*a]*x,e.speed=o[4*a+1]*x,e.wa=o[4*a+2]*x,e.Qa=o[4*a+3]*x*x,o=e.wa,c=0;c<h.length;c++)h[c].size*=x,h[c].W/=x/2;return x=.01*n(14,25),c=ta(t),{level:r,j:o,Aa:!1,type:a,aa:e,ka:l,fa:h,ba:b,width:s,length:f,x:0,y:0,c:Math.PI,$:0,speed:{x:0,y:0},b:{m:0,g:0,c:0},bb:{x:0,y:0},da:!1,scale:x,Ba:!1,g:t,color:c,h:{bb:n(5,22),va:null,Ab:null,xa:null,level:r,target:-1,ua:0},Da:0}}function oc(a){y.fillStyle=a.color,y.strokeStyle="white",y.lineWidth=2,y.beginPath(),y.moveTo(a.ka[0].x,a.ka[0].y);for(var e=1;e<a.ka.length;e++)y.lineTo(a.ka[e].x,a.ka[e].y);for(y.lineTo(a.ka[0].x,a.ka[0].y),y.fill(),y.stroke(),e=0;e<a.ba.length;e++){y.fillStyle="rgb(60, 60, 60)",y.strokeStyle="white",y.lineWidth=2;var t=a.ba[e],n=pc(t);y.beginPath(),y.moveTo(t.x,t.y),y.lineTo(t.x+n.Wa,t.y+n.Xa),y.lineTo(t.x+n.Ua,t.y+n.Va),y.lineTo(t.x,t.y),y.fill(),y.stroke(),y.beginPath(),y.arc(t.x,t.y,n.Na,0,2*Math.PI),y.fill(),y.stroke()}for(e=0;e<a.fa.length;e++)y.lineWidth=2,n=(t=a.fa[e]).size,y.beginPath(),y.rect(t.x-n/2,t.y-n/2,n,n),y.fill(),y.stroke(),y.beginPath(),y.lineWidth=4,y.moveTo(t.x,t.y),n*=1.5,y.lineTo(t.x+n*Math.cos(t.ra+Math.PI/2-a.c),t.y+n*Math.sin(t.ra+Math.PI/2-a.c)),y.stroke()}function nc(a){y.translate(a.x,a.y),y.scale(a.scale,a.scale),y.rotate(a.c),y.translate(0,-a.length/2)}function pc(a){var e=a.size,t=Math.cos(a.dir-Math.PI/2),n=Math.sin(a.dir-Math.PI/2),r=Math.cos(a.dir),i=Math.sin(a.dir);return{Wa:t*e*2+r*e*.7,Xa:n*e*2+i*e*.7,Ua:t*e*2-r*e*.7,Va:n*e*2-i*e*.7,b:8*(a.t+0),Na:e,mb:t,nb:n}}function Ac(a){var e=0,t=0;return 0<=a?e=a:t=-a,{na:e,pa:t}}function Vb(a,e){for(var t=e.x-a.x,n=e.y-a.y,r=0;r<a.fa.length;r++){var i=a.fa[r],y=a.c;i.dir=Ba(i.dir);var o=y+i.dir+Math.PI/2;o=Ba(o);var l=Math.cos(o);o=Math.sin(o),y=i.dir+y;var h=Math.atan2(n-o,t-l);(l=Math.atan2(n,t)-Math.atan2(o,l))>Math.PI?l-=2*Math.PI:l<=-Math.PI&&(l+=2*Math.PI),Math.abs(l)<=i.angle?(i.ab=h-.5*Math.PI,i.Pa=!0):(i.ab=y,i.Pa=!1),null==i.ra&&(i.ra=y),i.ra=i.ab,l=Ea(0,-a.length/2,a.c),o=1.5*i.size,y=Math.cos(i.ra+Math.PI/2),h=Math.sin(i.ra+Math.PI/2);var b=Ea(i.x*a.scale,i.y*a.scale,a.c);b.x+=o*y*a.scale,b.y+=o*h*a.scale,i.qb={x:a.x+b.x+a.scale*l.x,y:a.y+b.y+a.scale*l.y,kb:y,lb:h}}}function $b(a){a.s=[],a.fb=-1,a.s.push({x:a.x,y:a.y,sa:a.speed.x,ta:a.speed.y,time:E});var e=.5,t=500;0==a.frame?(e=5,t=15e3,minDist=1500):0!=A[a.frame].l&&(e=.25);for(var n=0;n<t/e;n++){var r={x:a.s[n].x,y:a.s[n].y},i=a.s[n].sa,y=a.s[n].ta,o=a.s[n].time;o+=e,r.x+=i*e,r.y+=y*e;var l=ma(r,o);if(i+=l.x*e,y+=l.y*e,null!=(l=oa(r,o))){e=ja(l.f,o),a.s.push({x:l.sa+e.x,y:l.ta+e.y,sa:0,ta:0,time:o}),a.fb=l.f;break}a.s.push({x:r.x,y:r.y,sa:i,ta:y,time:o})}}function Bc(a){var e=sa(A[a.frame]);return{x:a.speed.x-e.x,y:a.speed.y-e.y}}function qc(a){return C((a=Bc(a)).x,a.y)}function Zb(a){var e=A[a.frame];return D(0,0,a.x-e.x,a.y-e.y)}function Yb(a){return Zb(a)-A[a.frame].a}function Wb(a){return a=qc(a),Math.atan2(a.y,a.x)-Math.PI/2}function Xb(a){return D(0,0,(a=Bc(a)).x,a.y)}function ac(a,e){if(a.Da-=e,n(0,1e3)>=a.j/a.aa.wa*2e3){var t=a.x+n(-10,10),r=a.y+n(-10,10),i=a.speed.x+n(-10,10),y=a.speed.y+n(-10,10),o=n(4,15),l=.005*n(100,200);Ta.push({x:t,y:r,ia:i,ja:y,time:0,size:o,speed:l})}if(a.Aa){if(a.b.m=0,a.b.g=0,a.b.c=0,a.Ba=!1,a.j-=e,-50>=a.j&&2!=a.g)return L(a.x,a.y,a.speed.x,a.speed.y,n(50,200),1,1,!1),!0}else 0>=a.j&&(L(a.x,a.y,a.speed.x,a.speed.y,n(100,400),.7,2,!1,1),a.Aa=!0,a.$=.01*n(-400,400));if(t=Ac(a.b.c),r=Ac(a.b.g),i=Ac(a.b.m),a.ba[0].t=i.na,a.ba[1].t=i.na,a.ba[2].t=i.pa,2==a.type&&(a.ba[7].t=i.pa),a.ba[3].t=Math.max(r.na,t.na),a.ba[4].t=Math.max(r.pa,t.pa),a.ba[5].t=Math.max(r.na,t.pa),a.ba[6].t=Math.max(r.pa,t.na),1==a.da){if(i=ja(a.w.f,E),3==(r=A[a.w.f]).type)return!0;if(t=la(r.l,r.o,r.Z,E,r.ha),a.x=i.x+a.w.sa,a.y=i.y+a.w.ta,a.speed.x=t.x,a.speed.y=t.y,a.$=0,0<(i=a.b.m)&&(a.da=!1,a.speed.x=20*a.w.rb+t.x,a.speed.y=20*a.w.sb+t.y,a.x+=a.speed.x*e,a.y+=a.speed.y*e,a.Da=1),null!=r.ea&&0>r.ea){if(0==a.g)return r.ya.push(a),!0;if(1==a.g)return r.oa.push(a),!0}}else null!=(i=oa(r={x:a.x,y:a.y},E))&&0!=i.f&&(t=la((t=A[i.f]).l,t.o,t.Z,E,t.ha),100<=(t=D(0,0,a.speed.x-t.x,a.speed.y-t.y))&&(a.j-=.8*(t-100),L(a.x,a.y,a.speed.x,a.speed.y,.4*(t-100),.8,2,!1)),a.da=!0,a.w=i),i=a.b.m,t=a.b.g,y=Math.sin(a.c+Math.PI/2),o=Math.cos(a.c),l=Math.sin(a.c),a.speed.x+=Math.cos(a.c+Math.PI/2)*i*a.aa.speed*e*5,a.speed.y+=y*i*a.aa.speed*e*5,a.speed.x+=o*-t*a.aa.speed*e*5,a.speed.y+=l*-t*a.aa.speed*e*5,a.$+=a.aa.Ta*e*a.b.c,a.x+=a.speed.x*e,a.y+=a.speed.y*e,a.c+=a.$*e,0>=a.Da&&(t=ma(r,-1),a.speed.x+=t.x*e,a.speed.y+=t.y*e);for(r=0;r<a.fa.length;r++)a.Ba&&1==a.fa[r].Pa&&0>=a.fa[r].u&&(y=C((i=(l=a.fa[r]).qb).kb,i.lb),o=l.size/8,t=650-l.size/32*350,L(i.x,i.y,a.speed.x+15*y.x,a.speed.y+15*y.y,4*o,1,.5,!0,.8),l.u=l.W,l=a.g,Sa.push({x:i.x,y:i.y,ia:y.x*t+a.speed.x,ja:y.y*t+a.speed.y,g:l,size:o,Oa:10,color:ta(l)})),a.fa[r].u-=e;return!1}function wc(){return Math.floor(500*(1-F[0].j/F[0].aa.wa))}function xc(){return F[0].level*F[0].level*1e3}var Cc=!1;function uc(a,e){var t=A[F[0].w.f];if(e&&"KeyU"==a&&(Cc=!1),!e)if(0==t.i.length)"KeyM"==a&&T<F[0].aa.Qa&&0>=Jb&&0<t.la&&(T++,t.la--,980<=n(0,1e3)?(S="Accident",R=1,F[0].j-=n(1,5),zzfx(1,.1,50,.6,.5,.3,1,3.6,.03)):zzfx(.5,.1,n(220,320),.01*n(8,17),.66,.3,0,3.6,.03),Jb=.01*n(15,60));else{var r=function(a){return(a=ra(a,db,2,F[0].level)).s=[],a.frame=F[0].frame,a.da=!0,a.w=F[0].w,a.c=F[0].c,a},i=-1;"KeyR"==a?U>=wc()&&(U-=wc(),F[0].j=F[0].aa.wa,F[0].Aa=!1):"KeyU"==a?Cc||(U>=xc()&&(U-=xc(),F[0].level++,(t=r(F[0].type)).j=F[0].j,F[0]=t,zzfx(.7,.1,15,.5,.13,0,0,30,.79)),Cc=!0):"KeyS"==a?(U+=16*T,0!=16*T&&zzfx(1,.1,836,.2,.01,0,.3,1.3,.78),t.qa+=.0013*T,t.qa=Math.min(t.qa,1),T=0):"Digit1"==a?0!=F[0].type&&(i=0,zzfx(1,.1,2,.8,.42,0,0,67,.1)):"Digit2"==a?U>=4e3*!$a&&1!=F[0].type&&(i=1,U-=4e3*!$a,$a=!0,zzfx(1,.1,5,.8,.42,-.012,0,43,400)):"Digit3"==a&&U>=14e3*!ab&&2!=F[0].type&&(i=2,U-=14e3*!ab,ab=!0,zzfx(1,.1,2,.8,.42,0,.6,33,.1)),-1!=i&&(bb[F[0].type]=F[0].level,cb[F[0].type]=F[0].j,F[0]=r(i),0==cb[i]&&(cb[i]=F[0].j),F[0].j=cb[i],F[0].level=bb[i])}}var Rb=[-9,-9,13,-9,,-2,,,,-3,,-2,,-9,,,,-10,,-9,,-9,,,,-3,,-2,,-2,,-2,-9,-10,15,-9,,-2,,,,-3,,-2,,-10,,,,-15,,-9,,-10,,,,-3,,-2,,-2,,-2],Tb=[-16,-10,-6,-3,-16,-10,,,-14,-3,-7,-9,,,,,-12,-3,-7,,-12,,-7,,-14,-9,-6,,,,,,],Ub=[1,-1,,,-3,,,,-6,-16,,,1,,,,-3,,,,-6,-16,,,-10,-1,,,-1,,,,],Sb=[-9,,,-9,-7,,,-9,-3,,,-3,1,,,,-9,,,-9,-7,,,-9,-3,,,-3,1,,,,-3,,,-9,-7,,,-9,-9,,,-3,-7,,,,],Qb=[,-21,,-21,,-21,,,,,,-3,,,,,,,,-21,,-21,,,,-15,,-3,,-16,,,,-21,-9,-21,,-21,-3,,,,-4,-3,,,-9,,,,,-21,,-21,,,,-15,-9,-3,,-16,-3,,],fc=2,hc=.25,gc=0,ec=.1,Z=Rb,dc=!1;