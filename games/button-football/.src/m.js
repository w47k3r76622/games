function B(a){this.c=[.5*W,.5*H],this.r=a,this.v=0,this.vd=[0,0]}function T(a){this.te=a,this.p=[],this.s=0,this.act=0}function P(a,b,c){this.c=[a,b],this.r=c,this.s=0,this.vd=[0,0],this.v=0,this.t=0,this.vload=0}function stP(){for(mov=!0,i=0;i<te[0].p.length;i++)if(0!=te[0].p[i].v){mov=!1;break}for(i=0;i<te[1].p.length;i++)if(0!=te[1].p[i].v){mov=!1;break}0!=ball.v&&(mov=!1),mov&&0==turn&&(te[0].p[te[0].act].v=te[0].p[te[0].act].vload,te[0].p[te[0].act].vd=[Math.cos(te[0].p[te[0].act].t),Math.sin(te[0].p[te[0].act].t)],vload=!1,turntimes+=1,2==turntimes&&(turn=1,turntimes=0))}function tos(a,b){if(9!=st)st=9,init();else{for(loading=0,tpl=!1,i=0;i<te[0].p.length;i++)if(Math.sqrt(Math.pow(a-te[0].p[i].c[0],2)+Math.pow(b-te[0].p[i].c[1],2))<=te[0].p[i].r){tpl=!0,te[0].act=i;break}Math.sqrt(Math.pow(a-.15*H,2)+Math.pow(b-.85*H,2))<=.08*H?dir=-1:Math.sqrt(Math.pow(a-W+.15*H,2)+Math.pow(b-.85*H,2))<=.08*H?dir=1:tpl||(stP2(),loading=1)}}function toe(){9!=st&&1!=st?st=9:(0==dir&&1==loading&&stP(),dir=0)}function stP2(){for(mov=!0,i=0;i<te[0].p.length;i++)if(0!=te[0].p[i].v){mov=!1;break}for(i=0;i<te[1].p.length;i++)if(0!=te[1].p[i].v){mov=!1;break}(0!=ball.v||1==turn)&&(mov=!1),vload=mov}function u(a){9!=st&&1!=st?st=9:(k="which"in a?a.which:a.keyCode,(39==k||37==k)&&(dir=0),32==k&&stP())}function d(a){if(9!=st)st=9,init();else if(-1!=win)eq1=Math.floor(4*Math.random()),eq2=Math.floor(4*Math.random()),init(),win=-1,sc=[0,0];else switch(k="which"in a?a.which:a.keyCode){case 39:dir=1;break;case 37:dir=-1;break;case 32:stP2();break;case 38:te[0].p[te[0].act].vload=0,te[0].act+=1,te[0].act=te[0].act==te[0].p.length?0:te[0].act;break;case 40:te[0].p[te[0].act].vload=0,te[0].act-=1,te[0].act=-1==te[0].act?te[0].p.length-1:te[0].act}}function move(){for(STEP=.1*W/600,ball.c[0]+=ball.vd[0]*ball.v*STEP,ball.c[1]+=ball.vd[1]*ball.v*STEP,te[0].p[te[0].act].t+=.05*dir,vload&&(te[0].p[te[0].act].vload=Math.min(80,te[0].p[te[0].act].vload+1)),i=0;2>i;i++)te[i].p.forEach(function(a){if(0!=a.v){for(a.c[0]+=a.vd[0]*a.v*STEP,a.c[1]+=a.vd[1]*a.v*STEP,a.vload=0,a.v=Math.max(a.v-.3,0),(a.c[0]-a.r<=0||a.c[0]+a.r>=W)&&(a.c[0]-=a.vd[0]*a.v*STEP,a.c[1]-=a.vd[1]*a.v*STEP,a.vd[0]*=-1,a.v*=.8),(a.c[1]-a.r<=0||a.c[1]+a.r>=H)&&(a.c[0]-=a.vd[0]*a.v*STEP,a.c[1]-=a.vd[1]*a.v*STEP,a.vd[1]*=-1,a.v*=.8),j=0;2>j;j++)te[j].p.forEach(function(b){a.c!=b.c&&Math.sqrt(Math.pow(a.c[0]-b.c[0],2)+Math.pow(a.c[1]-b.c[1],2))<a.r+b.r&&(c1c2=[a.c[0]-b.c[0],a.c[1]-b.c[1]],angle=Math.atan2(c1c2[0],c1c2[1])-Math.atan2(a.vd[0],a.vd[1]),a.vd=[a.vd[0]*Math.cos(angle)+a.vd[1]*Math.sin(angle),-a.vd[0]*Math.sin(angle)+a.vd[1]*Math.cos(angle)],b.vd=[-a.vd[0],-a.vd[1]],a.v*=.8,b.v=a.v,a.c[0]+=3*a.vd[0]*a.v*STEP,a.c[1]+=3*a.vd[1]*a.v*STEP)});a.c!=ball.c&&Math.sqrt(Math.pow(a.c[0]-ball.c[0],2)+Math.pow(a.c[1]-ball.c[1],2))<a.r+ball.r&&(c1c2=[a.c[0]-ball.c[0],a.c[1]-ball.c[1]],angle=Math.atan2(c1c2[0],c1c2[1])-Math.atan2(a.vd[0],a.vd[1]),a.vd=[a.vd[0]*Math.cos(angle)+a.vd[1]*Math.sin(angle),-a.vd[0]*Math.sin(angle)+a.vd[1]*Math.cos(angle)],ball.vd=[-a.vd[0],-a.vd[1]],a.v*=.8,ball.v=1.2*a.v,a.v*=.3,a.c[0]+=3*a.vd[0]*a.v*STEP,a.c[1]+=3*a.vd[1]*a.v*STEP)}});for(j=0;2>j;j++)te[j].p.forEach(function(a){ball.c!=a.c&&Math.sqrt(Math.pow(ball.c[0]-a.c[0],2)+Math.pow(ball.c[1]-a.c[1],2))<ball.r+a.r&&(c1c2=[ball.c[0]-a.c[0],ball.c[1]-a.c[1]],angle=Math.atan2(c1c2[0],c1c2[1])-Math.atan2(ball.vd[0],ball.vd[1]),ball.vd=[ball.vd[0]*Math.cos(angle)+ball.vd[1]*Math.sin(angle),-ball.vd[0]*Math.sin(angle)+ball.vd[1]*Math.cos(angle)],a.vd=[-ball.vd[0],-ball.vd[1]],ball.v*=.8,a.v=.8*ball.v,ball.c[0]+=3*ball.vd[0]*ball.v*STEP,ball.c[1]+=3*ball.vd[1]*ball.v*STEP)});(ball.c[0]-ball.r<=0||ball.c[0]+ball.r>=W)&&(ball.c[1]+ball.r>=.3*H&&ball.c[1]+ball.r<=.7*H&&(ball.c[0]-ball.r<=0?(sc[1]+=1,initT=0,10==sc[1]&&(win=1)):(sc[0]+=1,initT=1,10==sc[0]&&(win=0)),init()),ball.c[0]-=ball.vd[0]*ball.v*STEP,ball.c[1]-=ball.vd[1]*ball.v*STEP,ball.vd[0]*=-1,ball.v*=.8),(ball.c[1]-ball.r<=0||ball.c[1]+ball.r>=H)&&(ball.c[0]-=ball.vd[0]*ball.v*STEP,ball.c[1]-=ball.vd[1]*ball.v*STEP,ball.vd[1]*=-1,ball.v*=.8),ball.v=Math.max(ball.v-.3,0)}function move2(){for(mov=!0,i=0;i<te[0].p.length;i++)if(0!=te[0].p[i].v){mov=!1;break}for(i=0;i<te[1].p.length;i++)if(0!=te[1].p[i].v){mov=!1;break}0!=ball.v&&(mov=!1),1==turn&&mov&&(turn=2,setTimeout(function(){turn=1,turntimes+=1,2==turntimes&&(turn=0,turntimes=0),wp=Math.floor(Math.random()*te[1].p.length),Math.random()<.3?(te[1].p[wp].v=20*Math.random()+60,te[1].p[wp].vd=[Math.random()-.5,Math.random()-.5],norm=Math.sqrt(Math.pow(te[1].p[wp].vd[0],2)+Math.pow(te[1].p[wp].vd[1],2)),te[1].p[wp].vd[0]/=norm,te[1].p[wp].vd[1]/=norm):(te[1].p[wp].v=20*Math.random()+60,te[1].p[wp].vd=[ball.c[0]-te[1].p[wp].c[0],ball.c[1]-te[1].p[wp].c[1]],norm=Math.sqrt(Math.pow(te[1].p[wp].vd[0],2)+Math.pow(te[1].p[wp].vd[1],2)),te[1].p[wp].vd[0]/=norm,te[1].p[wp].vd[1]/=norm)},1e3))}function tx(a,b){for(b.clearRect(0,0,W,H),b.fillStyle="rgb(250, 250, 250)",font=24,b.font=font+"px Helvetica";b.measureText(a).width>.9*W;)font-=1,b.font=font+"px Helvetica";b.textAlign="center",b.textBaseline="medium",b.fillText(a,.5*W,.5*H)}function init(){switch(turn=initT,turntimes=0,ctx.clearRect(0,0,W,H),st){case 0:for(st+=1,tx("Button Football",ctx),ctx.fillStyle="rgb(250, 0, 0)",font=24,ctx.font=font+"px Helvetica",t="Press any button to skip...";ctx.measureText(t).width>.9*W;)font-=1,ctx.font=font+"px Helvetica";ctx.textAlign="center",ctx.textBaseline="top",ctx.fillText(t,.5*W,.5*H+2*font),setTimeout(init,4e3);break;case 1:st+=1,tx("Use LEFT or RIGHT arrows to select different players.",ctx),setTimeout(init,4e3);break;case 2:st+=1,tx("Mantain SPACE pressed to choose kick's strength",ctx),setTimeout(init,4e3);break;case 3:st+=1,tx("and release it to kick.",ctx),setTimeout(init,4e3);break;case 4:st+=1,tx("Press UP or DOWN to change of player.",ctx),setTimeout(init,4e3);break;case 5:st+=1,tx("If you're using a touchscreen, use the arrows to aim,",ctx),setTimeout(init,4e3);break;case 6:st+=1,tx("touch another player to swich of players, and touch anywhere to kick.",ctx),setTimeout(init,4e3);break;case 7:st+=1,tx("Please, play in landscape mode for a better experience.",ctx),setTimeout(init,4e3);break;case 8:st+=1,tx("Each team represents an element. Beat the other elements!",ctx),setTimeout(init,4e3);break;default:for(firstRun&&(eq1=Math.floor(4*Math.random()),eq2=Math.floor(4*Math.random()));eq2==eq1;)eq2=Math.floor(4*Math.random());te=[new T(eq1),new T(eq2)],te[0].p.push(new P(.35*W,.5*H,.05*H)),te[0].p.push(new P(.25*W,.2*H,.05*H)),te[0].p.push(new P(.25*W,.8*H,.05*H)),te[0].p.push(new P(.1*W,.5*H,.05*H)),te[1].p.push(new P(.65*W,.5*H,.05*H)),te[1].p.push(new P(.75*W,.2*H,.05*H)),te[1].p.push(new P(.75*W,.8*H,.05*H)),te[1].p.push(new P(.9*W,.5*H,.05*H)),ball=new B(.02*H),firstRun&&(main(),firstRun=!1)}}var render=function(){ctx.clearRect(0,0,W,H),ctx.save();var a=ctx.createLinearGradient(0,0,.7*W,0);switch(a.addColorStop(0,"#0B610B"),a.addColorStop(1,"#0B3B0B"),ctx.beginPath(),ctx.strokeStyle="rgba(0, 0, 0, 0)",ctx.rect(0,0,W,H),ctx.fillStyle=a,ctx.fill(),ctx.stroke(),ctx.beginPath(),ctx.strokeStyle="white",ctx.lineWidth=3,ctx.moveTo(Math.floor(.5*W),0),ctx.lineTo(Math.floor(.5*W),H),ctx.stroke(),ctx.beginPath(),ctx.arc(Math.floor(.5*W),Math.floor(.5*H),Math.floor(.2*H),0,2*Math.PI),ctx.stroke(),ctx.beginPath(),ctx.moveTo(2,.3*H),ctx.lineTo(2,.7*H),ctx.stroke(),ctx.beginPath(),ctx.moveTo(W-2,.3*H),ctx.lineTo(W-2,.7*H),ctx.stroke(),ctx.font="50px Helvetica",ctx.fillStyle="rgba(255,255,255,0.3)",ctx.textAlign="right",ctx.textBaseline="bottom",ctx.fillText(sc[0],.45*W,H),ctx.font="20px Helvetica",te[0].te){case 0:ctx.fillText("FIRE",.45*W,H-60);break;case 1:ctx.fillText("WATER",.45*W,H-60);break;case 2:ctx.fillText("AIR",.45*W,H-60);break;case 3:ctx.fillText("EARTH",.45*W,H-60)}switch(ctx.textAlign="left",ctx.font="50px Helvetica",ctx.fillText(sc[1],.55*W,H),ctx.font="20px Helvetica",te[1].te){case 0:ctx.fillText("FIRE",.55*W,H-60);break;case 1:ctx.fillText("WATER",.55*W,H-60);break;case 2:ctx.fillText("AIR",.55*W,H-60);break;case 3:ctx.fillText("EARTH",.55*W,H-60)}ctx.restore(),ctx.save(),ctx.beginPath();var a=ctx.createRadialGradient(ball.c[0],ball.c[1],8*ball.r/10,ball.c[0],ball.c[1],ball.r/10);for(a.addColorStop(0,"#585858"),a.addColorStop(1,"white"),ctx.fillStyle=a,ctx.strokeStyle="rgba(0,0,0,0)",ctx.arc(ball.c[0],ball.c[1],ball.r,0,2*Math.PI),ctx.fill(),ctx.stroke(),ctx.restore(),i=0;2>i;i++)for(j=0;j<te[i].p.length;j++){ctx.save();var a=ctx.createRadialGradient(te[i].p[j].c[0],te[i].p[j].c[1],5,te[i].p[j].c[0],te[i].p[j].c[1],te[i].p[j].r+5);switch(te[i].te){case 0:a.addColorStop(0,"#FE642E"),a.addColorStop(1,"#B40404");break;case 1:a.addColorStop(0,"#0489B1"),a.addColorStop(1,"#084B8A");break;case 2:a.addColorStop(0,"#F2F2F2"),a.addColorStop(1,"#A4A4A4");break;case 3:a.addColorStop(0,"#886A08"),a.addColorStop(1,"#61380B")}ctx.fillStyle=a,ctx.beginPath(),ctx.arc(te[i].p[j].c[0],te[i].p[j].c[1],te[i].p[j].r,0,2*Math.PI),ctx.strokeStyle="rgba(0,0,0,0)",ctx.fill(),ctx.stroke(),ctx.restore()}if(0==turn){for(mov=!0,i=0;i<te[0].p.length;i++)if(0!=te[0].p[i].v){mov=!1;break}for(i=0;i<te[1].p.length;i++)if(0!=te[1].p[i].v){mov=!1;break}0!=ball.v&&(mov=!1),mov&&(ctx.save(),ctx.beginPath(),actP=te[0].p[te[0].act],ctx.arc(actP.c[0],actP.c[1],actP.r+5,0,2*Math.PI),ctx.strokeStyle="rgba(0,0,0,0)",ctx.fillStyle="rgba(255,255,255,0.3)",ctx.fill(),ctx.stroke(),ctx.beginPath(),arrowH=Math.min(100,20+actP.vload),ctx.moveTo(actP.c[0]+(actP.r+arrowH)*Math.cos(actP.t),actP.c[1]+(actP.r+arrowH)*Math.sin(actP.t)),ctx.lineTo(actP.c[0]+(actP.r+5)*Math.cos(actP.t+.3),actP.c[1]+(actP.r+5)*Math.sin(actP.t+.3)),ctx.lineTo(actP.c[0]+(actP.r+5)*Math.cos(actP.t-.3),actP.c[1]+(actP.r+5)*Math.sin(actP.t-.3)),ctx.fill(),ctx.stroke(),ctx.restore())}ctx.save(),ctx.beginPath(),ctx.fillStyle="rgba(73,185,65,0.5)",ctx.arc(.15*H,.85*H,.08*H,0,2*Math.PI),ctx.moveTo(.17*H,.81*H),ctx.lineTo(.11*H,.85*H),ctx.lineTo(.17*H,.89*H),ctx.fill(),ctx.restore(),ctx.beginPath(),ctx.fillStyle="rgba(73,185,65,0.5)",ctx.arc(W-.15*H,.85*H,.08*H,0,2*Math.PI),ctx.moveTo(W-.17*H,.81*H),ctx.lineTo(W-.17*H,.89*H),ctx.lineTo(W-.11*H,.85*H),ctx.fill(),ctx.restore()},main=function(){-1==win?(move(ctx),move2(),render()):0==win?tx("You won "+sc[0]+"-"+sc[1],ctx):tx("You lost "+sc[0]+"-"+sc[1],ctx),requestAnimationFrame(main)},c=document.createElement("canvas"),ctx=c.getContext("2d");W=document.body.clientWidth,H=document.body.clientHeight,W=Math.max(W,H),H=Math.min(W,H),c.height=H,c.width=W,c.addEventListener("touchstart",function(a){a.preventDefault(),tos(a.touches[0].clientX,a.touches[0].clientY)},!1),c.addEventListener("touchend",function(a){a.preventDefault(),-1!=win?(eq1=Math.floor(4*Math.random()),eq2=Math.floor(4*Math.random()),init(),win=-1,sc=[0,0]):toe()},!1),st=0,te=[],sc=[0,0],turn=0,eq1=0,eq2=0,turntimes=0;var ball;dir=0,win=-1,vload=!1,firstRun=!0,document.body.appendChild(c),loading=0;var initT=0;window.onresize=function(){W=document.body.clientWidth,H=document.body.clientHeight,W=Math.max(W,H),H=Math.min(W,H),c.height=H,c.width=W,init()},init();