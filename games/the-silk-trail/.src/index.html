<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width,initial-scale=1"><title>The Silk Trail</title></head><body style="margin:0;display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;background:#000;color:#fff;font-family:sans-serif"><canvas width="1200" height="550" style="width:100%;max-width:100vw"></canvas><a style="cursor:pointer;padding-top:8px">mute</a><script>let t=()=>{};let e,s,i={};function n(t,e){i[t]=i[t]||[],i[t].push(e)}function o(t,e){i[t]=(i[t]||[]).filter((t=>t!=e))}function a(t,...e){(i[t]||[]).map((t=>t(...e)))}let r={get:(e,s)=>"_proxy"==s||t};function h(){return e}function l(){return s}function c(t,e,s){return t*(1-s)+e*s}function d(t){let{x:e=0,y:s=0,width:i,height:n}=t.world||t;return t.mapwidth&&(i=t.mapwidth,n=t.mapheight),t.anchor&&(e-=i*t.anchor.x,s-=n*t.anchor.y),{x:e,y:s,width:i,height:n}}class f{constructor(t=0,e=0,s={}){this.x=t,this.y=e}add(t){return new f(this.x+t.x,this.y+t.y,this)}}function p(){return new f(...arguments)}class x extends class{constructor(t){return this.init(t)}init(t={}){this.position=p(),this.velocity=p(),this.acceleration=p(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;this.velocity=this.velocity.add(e);let s=this.velocity;this.position=this.position.add(s),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}{init({width:t=0,height:e=0,context:s=l(),render:i=this.draw,update:n=this.advance,anchor:o={x:0,y:0},...a}={}){super.init({width:t,height:e,context:s,anchor:o,...a}),this._di=!0,this._uw(),this._rf=i,this._uf=n}update(t){this._uf(t)}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y);let e=-this.width*this.anchor.x,s=-this.height*this.anchor.y;(e||s)&&t.translate(e,s),this._rf(),(e||s)&&t.translate(-e,-s),t.restore()}draw(){}_pc(){this._uw()}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){this._di&&(this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height)}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh}}}let u=class extends x{init({...t}={}){super.init({...t})}draw(){this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}};function g(){return new u(...arguments)}let y=/(\d+)(\w+)/;class w extends x{init({text:t="",textAlign:e="",lineHeight:s=1,font:i=l().font,...n}={}){t=""+t,super.init({text:t,textAlign:e,lineHeight:s,font:i,...n}),this._p()}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=function(t){let e=t.match(y),s=+e[1];return{size:s,unit:e[2],computed:s}}(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context;t.font=this.font,this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=this.textAlign,e=this.context;this._s.map(((s,i)=>{e.textBaseline="top",e.textAlign=t,e.fillStyle=this.color,e.font=this.font,e.fillText(s,0,this._fs*this.lineHeight*i)}))}}function m(){return new w(...arguments)}let b=new WeakMap,L={},v={},M={0:"left",1:"middle",2:"right"};function _(t,e){let{x:s,y:i,width:n,height:o}=d(t);do{s-=t.sx||0,i-=t.sy||0}while(t=t.parent);let a=e.x-Math.max(s,Math.min(e.x,s+n)),r=e.y-Math.max(i,Math.min(e.y,i+o));return a*a+r*r<e.radius*e.radius}function z(t,e){return parseFloat(t.getPropertyValue(e))||0}function P(t){let e=null!=t.button?M[t.button]:"left";v[e]=!0,S(t,"onDown")}function O(t){let e=null!=t.button?M[t.button]:"left";v[e]=!1,S(t,"onUp")}function E(t){S(t,"onOver")}function j(t){b.get(t.target)._oo=null,v={}}function k(t,e,s){let i=function(t){let e=t._lf.length?t._lf:t._cf;for(let s=e.length-1;s>=0;s--){let i=e[s];if(i.collidesWithPointer?i.collidesWithPointer(t):_(i,t))return i}}(t);i&&i[e]&&i[e](s),L[e]&&L[e](s,i),"onOver"==e&&(i!=t._oo&&t._oo&&t._oo.onOut&&t._oo.onOut(s),t._oo=i)}function S(t,e){t.preventDefault();let s=t.target,i=b.get(s),{scaleX:n,scaleY:o,offsetX:r,offsetY:h}=function(t){let{canvas:e,_s:s}=t,i=e.getBoundingClientRect(),n="none"!=s.transform?s.transform.replace("matrix(","").split(","):[1,1,1,1],o=parseFloat(n[0]),a=parseFloat(n[3]),r=(z(s,"border-left-width")+z(s,"border-right-width"))*o,h=(z(s,"border-top-width")+z(s,"border-bottom-width"))*a,l=(z(s,"padding-left")+z(s,"padding-right"))*o,c=(z(s,"padding-top")+z(s,"padding-bottom"))*a;return{scaleX:(i.width-r-l)/e.width,scaleY:(i.height-h-c)/e.height,offsetX:i.left+(z(s,"border-left-width")+z(s,"padding-left"))*o,offsetY:i.top+(z(s,"border-top-width")+z(s,"padding-top"))*a}}(i);t.type.includes("touch")?(Array.from(t.touches).map((({clientX:t,clientY:e,identifier:s})=>{let a=i.touches[s];a||(a=i.touches[s]={start:{x:(t-r)/n,y:(e-h)/o}},i.touches.length++),a.changed=!1})),Array.from(t.changedTouches).map((({clientX:s,clientY:l,identifier:c})=>{let d=i.touches[c];d.changed=!0,d.x=i.x=(s-r)/n,d.y=i.y=(l-h)/o,k(i,e,t),a("touchChanged",t,i.touches),"onUp"==e&&(delete i.touches[c],i.touches.length--,i.touches.length||a("touchEnd"))}))):(i.x=(t.clientX-r)/n,i.y=(t.clientY-h)/o,k(i,e,t))}function A(...t){t.flat().map((t=>{let e=t.context?t.context.canvas:h(),s=b.get(e);t._r||(t._r=t.render,t.render=function(){s._cf.push(this),this._r()},s._o.push(t))}))}function I(t,e){let s=t[0].toUpperCase()+t.substr(1);L["on"+s]=e}function H(t){let e=t.canvas;t.clearRect(0,0,e.width,e.height)}class D{constructor({create:t,maxSize:e=1024}={}){this._c=t,this.objects=[t()],this.size=0,this.maxSize=e}get(t={}){if(this.size==this.objects.length){if(this.size==this.maxSize)return;for(let t=0;t<this.size&&this.objects.length<this.maxSize;t++)this.objects.push(this._c())}let e=this.objects[this.size];return this.size++,e.init(t),e}getAliveObjects(){return this.objects.slice(0,this.size)}clear(){this.size=this.objects.length=0,this.objects.push(this._c())}update(t){let e,s=!1;for(let i=this.size;i--;)e=this.objects[i],e.update(t),e.isAlive()||(s=!0,this.size--);s&&this.objects.sort(((t,e)=>e.isAlive()-t.isAlive()))}render(){for(let t=this.size;t--;)this.objects[t].render()}}function V(){return new D(...arguments)}const B=[[[.2,0,386,,,.3,1],[.2,0,386,,,.5,2]],[[[,1,6,,.03,.06,6.02,.04,.09,,18,,.03,.06,6.02,.04,18.05,,,,6.03,.06,18.02,.04,6.05,,13,,6.03,.06,18.02,.04,6.05,,2,,.03,.06,2.02,.04,.09,,14,,.03,.06,2.02,.04,14.05,,,,2.03,.06,14.02,.04,2.05,,9,,2.03,.06,14.02,.04,2.05,,],[1,-1,13,13.77,18,13.77,21,18.77,13,21.77,18,13.77,21,18.77,13,21.77,18,13.77,21,18.77,13,21.77,18,13.77,21,18.77,13,21.77,18,13.77,21,18.77,13,21.77,14,13.77,18,14.77,21,18.77,14,21.77,18,14.77,21,18.77,14,21.77,18,14.77,21,18.77,14,21.77,18,14.77,21,18.77,14,21.77,18,14.77,21,18.77,14,21.77]],[[,1,9,,.03,.06,9.02,.04,.09,,21,,.03,.06,9.02,.04,21.05,,,,9.03,.06,21.02,.04,9.05,,16,,9.03,.06,21.02,.04,9.05,,4,,.03,.06,4.02,.04,.09,,16,,.03,.06,4.02,.04,16.05,,,,4.03,.06,16.02,.04,4.05,,11,,4.03,.06,16.02,.04,4.05,,],[1,-1,13,13.77,16,13.77,21,16.77,13,21.77,16,13.77,21,16.77,13,21.77,16,13.77,21,16.77,13,21.77,16,13.77,21,16.77,13,21.77,16,13.77,21,16.77,13,21.77,16,16.77,20,16.77,23,20.77,16,23.77,20,16.77,23,20.77,16,23.77,20,16.77,23,20.77,16,23.77,20,16.77,23,20.77,16,23.77,20,16.77,23,20.77,16,23.77]],[[,1,6,,.03,.06,6.02,.04,.09,,18,,.03,.06,6.02,.04,18.05,,,,6.03,.06,18.02,.04,6.05,,13,,6.03,.06,18.02,.04,6.05,,2,,.03,.06,2.02,.04,.09,,14,,.03,.06,2.02,.04,14.05,,,,2.03,.06,14.02,.04,2.05,,9,,2.03,.06,14.02,.04,2.05,,],[1,-1,6,6.75,13,6.75,11,13.75,16,11.75,18,16.75,21,18.75,28,21.75,30,28.75,6,30.75,13,6.75,11,13.75,16,11.75,18,16.75,21,18.75,28,21.75,30,28.75,6,30.75,13,6.75,11,13.75,16,11.75,18,16.75,21,18.75,28,21.75,30,28.75,6,30.75,13,6.75,11,13.75,16,11.75,18,16.75,21,18.75,28,21.75,30,28.75]],[[,1,9,,.03,.06,9.02,.04,.09,,21,,.03,.06,9.02,.04,21.05,,,,9.03,.06,21.02,.04,9.05,,16,,9.03,.06,21.02,.04,9.05,,4,,.03,.06,4.02,.04,.09,,16,,.03,.06,4.02,.04,16.05,,,,4.03,.06,16.02,.04,4.05,,11,,4.03,.06,16.02,.04,4.05,,],[1,-1,4,4.75,9,4.75,9,9.75,16,9.75,16,16.75,21,16.75,21,21.75,28,21.75,4,28.75,9,4.75,9,9.75,16,9.75,16,16.75,21,16.75,21,21.75,28,21.75,11,28.75,16,11.75,16,16.75,23,16.75,23,23.75,28,23.75,28,28.75,35,28.75,11,28.75,16,11.75,16,16.75,23,16.75,23,23.75,28,23.75,28,28.75,35,28.75]],[[,1,6,,.03,.06,6.02,.04,.09,,18,,.03,.06,6.02,.04,18.05,,,,6.03,.06,18.02,.04,6.05,,13,,6.03,.06,18.02,.04,6.05,,2,,.03,.06,2.02,.04,.09,,14,,.03,.06,2.02,.04,14.05,,,,2.03,.06,14.02,.04,2.05,,9,,2.03,.06,14.02,.04,2.05,,],[1,-1,20,21,,,20,,18,,20,21,,,20,,18,,20.75,,21,,20,,18,,20,21,,,20,,18,,20,21,,,20,,18,,20,21,,,20,,18,,20.75,,21,,20,,18,,20,21,,,20,,18,,]],[[,1,9,,.03,.06,9.02,.04,.09,,21,,.03,.06,9.02,.04,21.05,,,,9.03,.06,21.02,.04,9.05,,16,,9.03,.06,21.02,.04,9.05,,4,,.03,.06,4.02,.04,.09,,16,,.03,.06,4.02,.04,16.05,,,,4.03,.06,16.02,.04,4.05,,11,,4.03,.06,16.02,.04,4.05,,],[1,-1,15,16,,,21,,25,,15,16,,,21,,25,,21.75,,16,,21,,25.16,.32,25,28,,,26,,25,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]]],[0,1,0,1,2,3,4,5],180,{title:"sr",instruments:["2","5"],patterns:["2","3","4","5","6","7"]}];var C=Object.defineProperty,R=Object.defineProperties,$=Object.getOwnPropertyDescriptors,T=Object.getOwnPropertySymbols,N=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable,W=(t,e,s)=>e in t?C(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,F=(t,e)=>{for(var s in e||(e={}))N.call(e,s)&&W(t,s,e[s]);if(T)for(var s of T(e))X.call(e,s)&&W(t,s,e[s]);return t},Y=(t,e)=>R(t,$(e));const Z={levelIndex:0,gold:350,items:["empty",...new Array(6).fill("").flatMap((t=>["rock","copper-axe"]))]},G=t=>({size:t[0],size2:t[1],health:t[2],damage:t[3],weight:t[4],value:t[5],color:t[6],image:t[7],name:t[7]}),K=t=>({x:t[0],y:t[1],name:t[2],len:t[3],waves:t[4],items:t[5],market:t[6]}),U=G([32,32,10,1,.2,100,"#fff","gem"]),q=G([32,64,10,10,.9,25,"#fff","axe"]),J=G([32,64,10,15,1.3,10,"#fff","ingot"]),Q={empty:G([0,0,0,0,0,0,"#000","empty"]),rock:G([20,20,10,5,.7,1,"#666","rock"])},tt={topaz:["#ff0",.5],amethyst:["#f0f",1],emerald:["#0f0",1.5],sapphire:["#00f",2],ruby:["#f00",3],diamond:["#0ff",4]};Object.entries(tt).forEach((([t,e])=>{const s=U;Q[t]=Y(F({},s),{image:"gem",name:t,value:s.value*e[1],color:e[0]})})),Object.entries({copper:["#fa0",1,1],silver:["#aaa",2,2],gold:["#ff0",5,3]}).forEach((([t,e])=>{const s=J,i=q;Q[t+"-ingot"]=Y(F({},s),{name:t+"-ingot",image:"ingot",value:s.value*e[1],damage:s.damage*e[2],color:e[0]}),Q[t+"-axe"]=Y(F({},i),{name:t+"-axe",image:"axe",value:i.value*e[1],damage:s.damage*e[2],color:e[0]})}));const et=[K([50,260,"ISKENDERUN",.75]),K([245,400,"BAGHDAD",1]),K([412,330,"TEHRAN",1.25]),K([645,325,"MASHHAD",1.5]),K([908,380,"KABEL",1.75]),K([1080,195,"KASHI",1.75])];var st=Object.defineProperty,it=Object.getOwnPropertySymbols,nt=Object.prototype.hasOwnProperty,ot=Object.prototype.propertyIsEnumerable,at=(t,e,s)=>e in t?st(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;class rt extends u{constructor(t={}){var e,s;super(((t,e)=>{for(var s in e||(e={}))nt.call(e,s)&&at(t,s,e[s]);if(it)for(var s of it(e))ot.call(e,s)&&at(t,s,e[s]);return t})({anchor:{x:.5,y:1}},t)),at(this,"symbol"!=typeof(e="health")?e+"":e,s),this.health=(null==t?void 0:t.health)||10,this._frame=0}hurt(t){this.health<=0||"#f00"===this.color||(t>0&&(this.health-=t),this.color="#f00",a("delay","unhurt",20,(()=>{this.color="#fff"})),this.health<=0&&this.die())}die(){this.ttl=0,this.opacity=0}svg(t,e,s,i=1,n=0,o=0){let a=new Path2D(t);this.context.translate(n,o),s&&(this.context.fillStyle=s,this.context.fill(a)),e&&(this.context.strokeStyle=e,this.context.lineWidth=i,this.context.stroke(a)),this.context.translate(-n,-o)}drawShadow(){this.context.lineWidth=1,this.context.beginPath();const t=-this.y+.5*this.height,e=c(this.width/2,5,(t+455)/300);this.context.fillStyle=`rgba(0,0,0,${c(.4,0,(t+455)/300)})`,this.context.ellipse(this.width/2,t+455,e,3,0,0,2*Math.PI),this.context.closePath(),this.context.fill()}drawDebug(){}update(t){super.update(t),this._frame++}render(){super.render()}}const ht=({canvas:t,getSpeed:e})=>{const s=new lt(0,0,t.width,t.height-223,["#0081AA","#6AC4E0"]),i=new ct(0,326,t.width,155),n=new lt(0,325,t.width,t.height-455+130,["#B78F73","#8C6548"]);return{render(){s.render(),n.render(),i.render()},update(){i.update(),i.dx=-1*e(),i.x<-400&&(i.x=t.width,i.scaleX=1.5*Math.random()+1,i.scaleY=.6*Math.random()+.4,i.y=326+180*(1-i.scaleY))},shutdown(){}}};class lt extends rt{constructor(t,e,s,i,n,o){super({x:t,y:e,width:s,height:i,anchor:{x:0,y:0}}),this.colors=n,this.paths=o}draw(){if(0===this.opacity)return;const t=this.context.createLinearGradient(0,0,0,1.2*this.height);this.colors.forEach(((e,s)=>t.addColorStop(s/this.colors.length,e))),this.context.fillStyle=t,this.context.beginPath(),this.context.rect(0,0,this.width,this.height),this.context.closePath(),this.context.scale(4,4),this.paths?(this.context.scale(.35,.35),this.paths.forEach((t=>this.context.fill(new Path2D(t)))),this.context.scale(1,1)):this.context.fill(),this.context.scale(1,1)}}class ct extends rt{constructor(t,e,s,i){super({x:t,y:e,width:s,height:i,anchor:{x:0,y:1}})}draw(){0!==this.opacity&&(this.context.scale(this.scaleX,this.scaleY),this.svg("M106 1L1 154H209L106 1Z","transparent","#B78F73",1))}}class dt extends rt{constructor(){super()}draw(){0!==this.opacity&&(this.context.lineWidth=10,et.forEach(((t,e,s)=>{var i,n;this.context.beginPath(),this.context.strokeStyle=this.levelIndex===e?"#f00":this.levelIndex>e?"#000":"#0003",this.context.moveTo(t.x,t.y-40),this.context.lineTo(null==(i=s[e+1])?void 0:i.x,(null==(n=s[e+1])?void 0:n.y)-40),this.context.closePath(),this.context.stroke()})))}}class ft extends rt{draw(){0!==this.opacity&&(this.context.beginPath(),this.context.arc(0,0,this.size/2,0,2*Math.PI),this.context.fillStyle=this.color,this.context.closePath(),this.context.fill())}}const pt={playerHit:[2,,1050,.01,.01,.02,3,1.06,-66,,,.15,,,,,.05,.82,.01,.03],click:[,,1768,,.01,.01,,.2,14,39,,,,,.5,.3,,.31,.01],catch:[2,,1182,,.01,0,1,.43,-84,50,,,,,,,.14,.94,.08,.01],swap:[1,,10,,.01,.01,,1.76,92,-1,,,,.6,-6.7,,,.42,.01],nextLevel:[1.66,,441,.06,.26,.34,,1.11,,,83,.05,.02,,,.1,.11,.42,.23]},xt=t=>{zzfx(pt[t][0]||1,...pt[t].slice(1))},ut=(t,e,s)=>{t.forEach((t=>e.forEach((e=>{var i,n;i=t,n=e,[i,n]=[i,n].map((t=>d(t))),i.x<n.x+n.width&&i.x+i.width>n.x&&i.y<n.y+n.height&&i.y+i.height>n.y&&s(t,e)}))))};var gt=Object.defineProperty,yt=(t,e,s)=>(((t,e,s)=>{e in t?gt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s})(t,"symbol"!=typeof e?e+"":e,s),s);function wt(t){for(var e=t.length-1;e>0;e--){var s=Math.floor(Math.random()*(e+1)),i=t[e];t[e]=t[s],t[s]=i}return t}class mt{constructor(t,e,s,i){yt(this,"nlab"),yt(this,"clickLabel"),yt(this,"wlab"),yt(this,"dlab"),yt(this,"vlab"),yt(this,"id"),yt(this,"sel");const{width:n,height:o}=t,a=(0===e?0:n/2-25)+50+25,r=95+32*s+15;this.id=`${0===e?"player":"shop"}:${s}`;const h="#fff";this.sel=!1;const l="24px sans-serif",c={x:.5,y:0};this.clickLabel=m({x:a,y:r,text:"",width:500,color:h,font:l,anchor:{x:0,y:0},onDown:i}),this.nlab=m({x:a,y:r,text:"",color:h,font:l,anchor:{x:0,y:0}}),this.wlab=m({x:a+225,y:r,text:"",color:h,font:l,anchor:c}),this.dlab=m({x:a+340,y:r,text:"",color:h,font:l,anchor:c}),this.vlab=m({x:a+450,y:r,text:"",color:h,font:l,anchor:c}),A(this.clickLabel)}setItem(t,e){const s=Q[t],i=(null==e?void 0:e[null==s?void 0:s.name])||1;this.nlab.text=(null==s?void 0:s.name)||"",this.wlab.text=(null==s?void 0:s.weight)||"",this.vlab.text=(null==s?void 0:s.value)?""+(null==s?void 0:s.value)*i:"",this.dlab.text=(null==s?void 0:s.damage)||"",this.toggleColor("#fff"),i<.8&&this.toggleColor("#f66"),i>1.2&&this.toggleColor("#6f6")}toggleSelect(){this.sel=!this.sel,this.nlab.font=this.sel?"bold 24px sans-serif":"24px sans-serif"}toggleColor(t){this.nlab.color=t,this.wlab.color=t,this.vlab.color=t,this.dlab.color=t}render(){this.nlab.render(),this.clickLabel.render(),this.wlab.render(),this.dlab.render(),this.vlab.render()}}var bt=Object.defineProperty,Lt=Object.defineProperties,vt=Object.getOwnPropertyDescriptors,Mt=Object.getOwnPropertySymbols,_t=Object.prototype.hasOwnProperty,zt=Object.prototype.propertyIsEnumerable,Pt=(t,e,s)=>e in t?bt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Ot=(t,e)=>{for(var s in e||(e={}))_t.call(e,s)&&Pt(t,s,e[s]);if(Mt)for(var s of Mt(e))zt.call(e,s)&&Pt(t,s,e[s]);return t};const Et=({canvas:t,data:e,particles:s,player:i,bullets:n})=>{let o=V({create:()=>new At({health:10+10*e.levelIndex})}),r=i.sprite;const h=()=>{var t;const e=o.getAliveObjects(),s=e.filter((t=>r.x-t.x<900));var i,n;null==(t=s[(i=0,n=s.length-1,(Math.random()*(n-i+1)|0)+i)])||t.attack(),a("delay","attack",600/(e.length+1),h)},l=550-25*e.levelIndex,c=()=>{o.get({x:-25,y:395,ttl:1/0,opacity:1,target:r,pool:o,bullets:n,particles:s}),a("delay","spawn",l,c)};return a("delay","attack",10,h),a("delay","spawn",l,c),{pool:o,update(){const t=o.getAliveObjects().sort(((t,e)=>t.x-e.x));t.forEach((e=>{const s=t.find((t=>t.x>e.x))||r,i=s.x-e.x;e.dx=i>(s!==r?240:300)?e.speed-r.speed:0}))},attack:h,spawn:c}};class jt extends rt{constructor(t){super(Ot({},t)),this._frame=0}draw(){if(0===this.opacity)return;const t=-3*this.width,e=-.4*this.height;this.context.translate(t,e);const s=Math.round(this._frame%30/30);this.svg(0===s?"M11 216L6 205L24 169L53 146L64 120L104 95L147 91L172 106L190 111L207 103L221 91L216 84L212 77L220 79L223 84L236 86L247 88L254 95L252 99L241 101L229 110L212 120L194 127L180 135L200 153L227 178L236 176L237 178L232 185L225 187L202 166L198 189V194L194 200H190L194 187L197 161L190 155L180 152L159 144L127 147L104 135L96 151L78 182L93 216L104 221L105 225H93L69 182L78 158V146L33 169L13 205L16 212L11 216Z":"M99 189L94 192L73 189L89 203H94L91 209L85 207L56 184L59 168L58 153L55 142L67 108L90 91L118 84L155 89L191 112L212 108L228 96L223 89L219 82L226 84L230 89L243 91L254 93L261 100L259 103L248 105L224 119L206 128L189 130L175 142L171 186L136 197V202L135 205H129V197L160 181V146L138 170L131 177L124 205L116 204L111 200L120 195H124L127 170L149 141L87 135L78 153L73 180L94 186L96 183L99 189Z","#84530A","#F58328",1);const i=0===s?-5:1,n=0===s?-10:-5;this.context.translate(n,i),this.svg(kt,"#B6AC88",this.color,1),this.svg(St,"#84530A","#DEA248",1),this.svg("M164 82L227 103","#84530A",void 0,3),this.context.translate(-n,-i),this.context.translate(-t,-e),this.drawDebug()}}const kt="M131 106L149 125L166 126L165 95L160 87L163 82L142 53L139 40L147 30L139 23L128 28L127 44L131 88V106Z",St="M143 32H135V41L141 44L143 37L145 38L143 32Z";class At extends jt{constructor(t={}){super(t)}init(t){super.init(((t,e)=>Lt(t,vt(e)))(Ot({color:"#fff",width:40,height:80,speed:5,health:10,damage:10},t),{anchor:{x:.5,y:1}}))}attack(){if("#f00"===this.color)return;this.color="#f00";const t=[5,8,10],e=[12,12,14],s=Math.floor((this.target.x-this.x)/250)-1;xt("catch"),a("delay","color",20,(()=>{let i;this.color="#fff",this.ttl>0&&(i=this.bullets.spawn(this.x,this.y-40,"copper-axe")),this.bullets.shoot(i,t[s],e[s],5.5,.175,1/0,!0)}))}die(){xt("playerHit"),this.particles.spawn({x:this.x+this.width/2,y:this.y-this.width/2,size:3*this.width,ttl:30}),super.die()}}var It=Object.defineProperty,Ht=Object.getOwnPropertySymbols,Dt=Object.prototype.hasOwnProperty,Vt=Object.prototype.propertyIsEnumerable,Bt=(t,e,s)=>e in t?It(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Ct=(t,e)=>{for(var s in e||(e={}))Dt.call(e,s)&&Bt(t,s,e[s]);if(Ht)for(var s of Ht(e))Vt.call(e,s)&&Bt(t,s,e[s]);return t},Rt=(t,e,s)=>(Bt(t,"symbol"!=typeof e?e+"":e,s),s);class $t{constructor(t){Rt(this,"sprites"),Rt(this,"as"),Rt(this,"ts"),Rt(this,"speed"),Rt(this,"stage"),Rt(this,"angle"),this.ts=new Nt(t),this.as=new Tt(t),this.stage=0,this.speed=t.speed,this.angle=t.angle}update(){0!==this.stage&&(this.as.angle=this.angle,this.as.speed=this.speed,this.as.update(),this.ts.angle=this.angle,this.ts.speed=this.speed,this.ts.update())}render(){0!==this.stage&&(this.as.render(),this.ts.render())}}class Tt extends rt{constructor(t={}){super(Ct({anchor:{x:0,y:0}},t))}update(t){super.update(t)}draw(){const t=50+(this.speed-4)/11*50;this.context.beginPath(),this.context.lineWidth=10,this.context.strokeStyle="#000",this.context.moveTo(0*Math.cos(this.angle),0*Math.sin(this.angle)),this.context.lineTo((0+t)*Math.cos(this.angle),(0+t)*Math.sin(this.angle)),this.context.stroke()}}class Nt extends rt{constructor(t={}){super(Ct({anchor:{x:0,y:0}},t))}update(t){super.update(t)}draw(){let t=0,e=0,s=this.speed*Math.cos(this.angle),i=this.speed*Math.sin(this.angle),n=.4;for(let o=0;o<200&&(t+=s,e+=i,i+=.175,!(e+280>455));o++)o%4==0&&(n-=.02,this.context.beginPath(),this.context.fillStyle=`rgba(255,255,255,${n})`,this.context.arc(t,e,4,0,2*Math.PI),this.context.closePath(),this.context.fill())}}var Xt=Object.defineProperty,Wt=Object.getOwnPropertySymbols,Ft=Object.prototype.hasOwnProperty,Yt=Object.prototype.propertyIsEnumerable,Zt=(t,e,s)=>e in t?Xt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Gt=(t,e,s)=>(Zt(t,"symbol"!=typeof e?e+"":e,s),s);const Kt=({canvas:t,data:e,bullets:s})=>{let i=new Ut({x:t.width-60,y:421,color:"#fff",width:102,height:102,health:5,maxHealth:5}),r=0,h=0,l=!0;const c=t=>{xt("catch"),e.items.unshift(t.name),w()};n("player-catch-item",c),i.progress=0,i.data=e;const d=()=>i.x-51,f=()=>i.y-102*1.2;let p,x,u=(t,e)=>{r=t,h=e,g.angle=t;const s=Q[p.name];g.speed=e*(1/s.weight)},g=new $t({x:d(),y:f(),angle:0,speed:0});const y=()=>{let t=0;if(x)x.x=d(),x.y=f(),x.small=!1,p=x,t=1;else{const t=e.items[0];p=s.spawn(d(),f(),t)}e.items=e.items.slice(1),x=s.spawn(d()+90,f()+30,e.items[t]),x&&(x.small=!0)};y();const w=()=>{(null==p?void 0:p.name)&&(xt("swap"),0!==g.stage&&(g.stage=0),p&&(e.items.push(p.name),p.ttl=0),y())},m=()=>{"empty"===p.type?0===g.stage&&l&&(xt("swap"),i.block=!0,l=!1,a("delay","block",20,(()=>{i.block=!1,a("delay","allow-block",60,(()=>{l=!0}))}))):0!==e.items.length&&(0===g.stage?(xt("click"),u(3.2,3)):1===g.stage?xt("click"):2===g.stage&&(xt("catch"),s.shoot(p,g.speed,g.speed,r,.175),y()),g.stage++,3===g.stage&&(g.stage=0))};I("down",(e=>{e.clientX/t.clientWidth>.88?w():m()}));let b=-1;return{sprite:i,trajectory:g,update(){i.update(),g.update(),i.progress+=1e-4*i.speed,i.progress>=et[e.levelIndex].len&&a("level-end");const t=1-e.items.map((t=>Q[t].weight)).reduce(((t,e)=>t+e),0)/18;i.speed=6*t,0!==g.stage&&(1===g.stage?((r>4||r<3.2)&&(b=-1===b?1:-1),u(r+.02*b,h)):2===g.stage&&((h>8||h<3)&&(b=-1===b?1:-1),u(r,h+.12*b)))},shutdown(){!function(t){let e=t[0].toUpperCase()+t.substr(1);L["on"+e]=0}("down"),o("player-catch-item",c)}}};class Ut extends rt{constructor(t){super(((t,e)=>{for(var s in e||(e={}))Ft.call(e,s)&&Zt(t,s,e[s]);if(Wt)for(var s of Wt(e))Yt.call(e,s)&&Zt(t,s,e[s]);return t})({},t)),Gt(this,"progress"),Gt(this,"speed"),Gt(this,"block"),this.block=!1,this.progress=0,this.speed=4.5}die(){super.die(),a("player-dead")}draw(){if(0===this.opacity)return;const t=51;this.context.translate(t,102),this.context.scale(-1,1),this.context.rotate(.2),this.context.translate(0,this.block?-30:0),this.svg(kt,"#B6AC88",this.color,1,-150,-150),this.svg(St,"#B6AC88","#DEA248",1,-150,-150),this.context.translate(-0,this.block?30:0),this.context.rotate(-.2),this.context.scale(1,1),this.context.translate(5,-20),this.context.rotate(this._frame/-10*(this.speed/4)),this.svg("M16 16L85 85M85 16L16 85M51 2V99M99 50H2","#501502","#7D1F01",6,-t,-t),this.context.rotate(this._frame/10*(this.speed/4)),this.context.beginPath(),this.context.arc(0,0,50,0,2*Math.PI),this.context.closePath(),this.context.stroke(),this.context.translate(-5,20),this.context.translate(-t,-102),this.svg("M19 67H142L158 1H1L19 67Z","#000","#7D1F01",2,-30,25),this.context.translate(t,102),this.context.rotate(this._frame/-10*(this.speed/4)),this.svg("M16 16L85 85M85 16L16 85M51 2V99M99 50H2","#501502","#7D1F01",6,-t,-t),this.context.rotate(this._frame/10*(this.speed/4)),this.context.beginPath(),this.context.arc(0,0,50,0,2*Math.PI),this.context.closePath(),this.context.stroke(),this.context.translate(-t,-102),this.drawDebug()}}class qt extends rt{constructor(t={}){super(t)}init(t){super.init(t),this.small=!1}update(){var t;this.active?(super.update(),this.ttl<=0||(this.x<0||this.y>455)&&(null==(t=this.particles)||t.spawn({x:this.x,y:this.y,size:this.width/3,ttl:30}),this.dx=0,this.dy=0,this.ddy=0,this.ttl=0,xt("click"))):this._frame=0}draw(){const t=this.width/2,e=-2*t;if(this.small&&this.context.scale(.6,.6),this.context.translate(t,t),this.context.rotate(-this._frame/5),"rock"===this.type)this.context.beginPath(),this.context.arc(0,0,this.size/2,0,2*Math.PI),this.context.fillStyle=this.color,this.context.closePath(),this.context.fill(),this.context.stroke();else if("gem"===this.type)this.svg(ee,"transparent",this.color,0,e,e),this.svg(se,"#000","transparent",0,e,e);else if("ingot"===this.type)this.svg(te,"transparent",this.color,0,e,e),this.svg(Qt,"#000","transparent",0,e,e);else if("axe"===this.type){const t=-this.size/2;this.svg(Jt,"#000",this.color,1,t,t)}this.context.rotate(this._frame/5),this.context.translate(-t,-t),this.drawDebug(),this.drawShadow()}}const Jt="M11 21L22 34L29 27V51L33 56L36 51V27L42 34L53 21L42 9L36 16L33 13L29 16L22 9L11 21Z",Qt="M15 33L11 48H35M15 33H30M15 33L35 17H48M30 33L35 48M30 33L48 17M35 48L53 31L48 17",te="M11 48L15 33L35 17H48L53 31L35 48H11Z",ee="M32 8L53 20L53 44L32 56L11 44V20L20 25L11 20L32 8Z",se="M11 20L32 8M11 20V44M11 20L20 25M32 8L53 20M32 8V18M53 20V44M53 20L44 25M53 44L32 56M53 44L44 39M32 56L11 44M32 56V46M11 44L20 39M20 25V39M20 25L32 18M20 39L32 46M32 46L44 39M44 39V25M44 25L32 18";var ie=Object.defineProperty,ne=Object.getOwnPropertySymbols,oe=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable,re=(t,e,s)=>e in t?ie(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;class he extends rt{constructor(t={}){super(((t,e)=>{for(var s in e||(e={}))oe.call(e,s)&&re(t,s,e[s]);if(ne)for(var s of ne(e))ae.call(e,s)&&re(t,s,e[s]);return t})({},t))}update(){super.update(),this.opacity-=this.io/this.ttl}draw(){this.context.beginPath(),this.context.arc(-this.width/2,-this.width/2,this.width,0,2*Math.PI),this.context.fillStyle=`rgba(255,255,255,${this.opacity})`,this.context.closePath(),this.context.fill()}}const le=({canvas:t,data:e,onNext:s,onWin:i,onLose:r})=>{const h={},l=()=>y.text=`HP: ${x.sprite.health}`,c=(t,e,s)=>{h[t]={fn:s,delay:e}};n("delay",c),n("player-damaged",l),n("player-dead",r),n("level-end",s),e.levelIndex;let d=new ft({x:0,y:20,size:10,color:"#fff"}),f=(()=>{let t=V({create:()=>new he});return{pool:t,spawn({x:e,y:s,size:i=1,ttl:n=50,opacity:o=1}){t.get({x:e,y:s,width:i,ttl:n,opacity:o,io:o})}}})(),p=(({particles:t})=>{let e=V({create:()=>new qt});return{particles:t,pool:e,spawn:(s,i,n)=>{if(!Q[n])return;const{health:o,size:a,size2:r,image:h,damage:l,color:c}=Q[n];return e.get({x:s,y:i,damage:l,color:c,health:o,type:h,name:n,active:!1,ttl:1/0,isEnemyBullet:!1,particles:t,width:a,height:a,size:r,maxHealth:o,anchor:{x:.5,y:.5}})},shoot:(t,e=0,s=0,i=0,n=0,o=1/0,a=!1)=>{t.dx=e*Math.cos(i),t.dy=s*Math.sin(i),t.ddy=n,t.ttl=o,t.active=!0,t.isEnemyBullet=a}}})({particles:f}),x=Kt({canvas:t,data:e,bullets:p}),u=Et({canvas:t,data:e,player:x,particles:f,bullets:p});const g=ht({canvas:t,getSpeed:()=>3*x.sprite.speed}),y=m({x:t.width-70,y:t.height/2-20,text:`HP: ${x.sprite.health}`,color:"#fff",font:"bold 24px sans-serif",anchor:{x:.5,y:.5}}),w=(t,e)=>{if(t.hurt(t.health),e.block)return a("player-catch-item",t);e.hurt(1),a("player-damaged"),xt("playerHit")},b=(t,e)=>{t.hurt(t.health),e.hurt(t.damage,!0),xt("playerHit")};return{shutdown(){o("delay",c),o("player-damaged",l),o("player-dead",r),o("level-end",s),u.pool.clear(),p.pool.clear(),x.shutdown()},update(){x.update(),g.update(),u.update(),u.pool.update(),p.pool.update(),f.pool.update(),Object.keys(h).forEach((t=>{0==h[t].delay--&&h[t].fn()})),ut(p.pool.getAliveObjects().filter((t=>!t.isEnemyBullet)),u.pool.getAliveObjects(),b),ut(p.pool.getAliveObjects().filter((t=>t.isEnemyBullet)),[x.sprite],w);const s=t.width;d.x=s*(x.sprite.progress/et[e.levelIndex].len)},render(){g.render(),x.sprite.render(),d.render(),u.pool.render(),f.pool.render(),p.pool.render(),x.trajectory.render(),y.render()}}},ce=({canvas:t,heading:e,description:s,button1:i})=>{const n=t.width,o=t.height,a=ht({canvas:t,getSpeed:()=>3}),r=n/2,h=o/2;let l=de(r,h-175,e,64,"#eee","center");let c=de(r,h-100,s,28,"#ddd","center"),d=m({x:r,y:h+170,text:"Start",color:"#fff",font:"52px sans-serif",anchor:{x:.5,y:.5},onDown:()=>{xt("click"),i()}});return A(d),{shutdown(){},update(){a.update()},render(){a.render(),l.render(),c.render(),d.render()}}},de=(t,e,s,i,n,o="left")=>m({x:t,y:e,text:s,color:n,font:`${i}px sans-serif`,textAlign:o});zzfx=(...t)=>zzfxP(zzfxG(...t)),zzfxP=(...t)=>{let e=zzfxX.createBufferSource(),s=zzfxX.createBuffer(t.length,t[0].length,zzfxR);return t.map(((t,e)=>s.getChannelData(e).set(t))),e.buffer=s,e.connect(zzfxX.destination),e.start(),e},zzfxG=(t=1,e=.05,s=220,i=0,n=0,o=.1,a=0,r=1,h=0,l=0,c=0,d=0,f=0,p=0,x=0,u=0,g=0,y=1,w=0,m=0)=>{let b,L,v=2*Math.PI,M=h*=500*v/zzfxR**2,_=(0<x?1:-1)*v/4,z=s*=(1+2*e*Math.random()-e)*v/zzfxR,P=[],O=0,E=0,j=0,k=1,S=0,A=0,I=0;for(i=99+zzfxR*i,w*=zzfxR,n*=zzfxR,o*=zzfxR,g*=zzfxR,l*=500*v/zzfxR**3,x*=v/zzfxR,c*=v/zzfxR,d*=zzfxR,f=zzfxR*f|0,L=i+w+n+o+g|0;j<L;P[j++]=I)++A%(100*u|0)||(I=a?1<a?2<a?3<a?Math.sin((O%v)**3):Math.max(Math.min(Math.tan(O),1),-1):1-(2*O/v%2+2)%2:1-4*Math.abs(Math.round(O/v)-O/v):Math.sin(O),I=(f?1-m+m*Math.sin(2*Math.PI*j/f):1)*(0<I?1:-1)*Math.abs(I)**r*t*zzfxV*(j<i?j/i:j<i+w?1-(j-i)/w*(1-y):j<i+w+n?y:j<L-g?(L-j-g)/o*y:0),I=g?I/2+(g>j?0:(j<L-g?1:(L-j)/g)*P[j-g|0]/2):I),b=(s+=h+=l)*Math.sin(E*x-_),O+=b-b*p*(1-1e9*(Math.sin(j)+1)%2),E+=b-b*p*(1-1e9*(Math.sin(j)**2+1)%2),k&&++k>d&&(s+=c,z+=c,k=0),!f||++S%f||(s=z,h=M,k=k||1);return P},zzfxV=.3,zzfxR=44100,zzfxX=new(window.AudioContext||webkitAudioContext),
//! ZzFXM (v2.0.3) | (C) Keith Clark | MIT | https://github.com/keithclark/ZzFXM
zzfxM=(t,e,s,i=125)=>{let n,o,a,r,h,l,c,d,f,p,x,u,g,y,w=0,m=[],b=[],L=[],v=0,M=0,_=1,z={},P=zzfxR/i*60>>2;for(;_;v++)m=[_=d=u=0],s.map(((i,O)=>{for(c=e[i][v]||[0,0,0],_|=!!e[i][v],y=u+(e[i][0].length-2-!d)*P,g=O==s.length-1,o=2,r=u;o<c.length+g;d=++o){for(h=c[o],f=o==c.length+g-1&&g||p!=(c[0]||0)|h|0,a=0;a<P&&d;a++>P-99&&f?x+=(x<1)/99:0)l=(1-x)*m[w++]/2||0,b[r]=(b[r]||0)-l*M+l,L[r]=(L[r++]||0)+l*M+l;h&&(x=h%1,M=c[1]||0,(h|=0)&&(m=z[[p=c[w=0]||0,h]]=z[[p,h]]||(n=[...t[p]],n[2]*=2**((h-12)/12),h>0?zzfxG(...n):[])))}u=y}));return[b,L]};var fe=Object.defineProperty,pe=Object.getOwnPropertySymbols,xe=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable,ge=(t,e,s)=>e in t?fe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;const{canvas:ye}=function(t,{contextless:i=!1}={}){return e=document.getElementById(t)||t||document.querySelector("canvas"),i&&(e=e||new Proxy({},r)),s=e.getContext("2d")||new Proxy({},r),s.imageSmoothingEnabled=!1,a("init"),{canvas:e,context:s}}();let we,me,be;!function({radius:t=5,canvas:e=h()}={}){let s=b.get(e);if(!s){let i=window.getComputedStyle(e);s={x:0,y:0,radius:t,touches:{length:0},canvas:e,_cf:[],_lf:[],_o:[],_oo:null,_s:i},b.set(e,s)}e.addEventListener("mousedown",P),e.addEventListener("touchstart",P),e.addEventListener("mouseup",O),e.addEventListener("touchend",O),e.addEventListener("touchcancel",O),e.addEventListener("blur",j),e.addEventListener("mousemove",E),e.addEventListener("touchmove",E),s._t||(s._t=!0,n("tick",(()=>{s._lf.length=0,s._cf.map((t=>{s._lf.push(t)})),s._cf.length=0})))}(),document.getElementsByTagName("a")[0].addEventListener("click",(t=>{be.playbackRate.value="mute"===t.target.innerHTML?0:1,t.target.innerHTML="mute"===t.target.innerHTML?"unmute":"mute",window.zzfxV=0===window.zzfxV?.3:0})),I("up",(()=>{be||(be=zzfxP(...zzfxM(...B)),be.loop=!0)}));const Le=()=>{we&&we.shutdown(),we=(({canvas:t,data:e,onNext:s})=>{const{width:i,height:n}=t,o=ht({canvas:t,getSpeed:()=>.1});let a={};const r=wt(Object.keys(tt)),h=wt(Object.keys(Q)).filter((t=>"empty"!==t));let l=[];h.forEach((t=>{const e=t.match(/axe|ingot|rock/),s=e?12:3,i=e?5:0,n=Math.floor(Math.random()*s)+i;for(let e=0;e<n;e++)l.push(t)}));for(let t=0;t<6;t++){const e=r[t];a[e]=t<3?.2:1.8}const c=i/2-75,d=n-140,f=i/2+25,p=[g({x:50,y:70,width:c,height:d,color:"#000000aa"}),g({x:f,y:70,width:c,height:d,color:"#000000aa"})],x=[],u=[];let y="";xt("nextLevel");const w=()=>{const t=y.split(":")[0],s=+y.split(":")[1];return Q["shop"!==t?e.items[s+10*v]:l[s+10*M]]},b=(e,s)=>{const i=new mt(t,s,e,(()=>{var t;null==(t=[...u,...x].find((t=>t.id===y)))||t.toggleSelect(),y=i.id,u.forEach((t=>t.color="#fff")),x.forEach((t=>t.color="#fff")),B.text=0===s?"Sell":"Buy",i.toggleSelect(),xt("click"),E()}));0===s&&u.push(i),1===s&&x.push(i)};let L=10,v=0,M=0;const _=Math.ceil(e.items.length/L),z=Math.ceil(l.length/L),P=t=>{v=Math.max(0,Math.min(_-1,v+t)),u.forEach((t=>t.setItem())),E()},O=t=>{M=Math.max(0,Math.min(z-1,M+t)),x.forEach((t=>t.setItem())),E()},E=()=>{const t=y.split(":")[0];u.forEach((t=>t.setItem())),x.forEach((t=>t.setItem())),k.text=`${v+1}/${_}`,S.text=`${M+1}/${z}`,e.items.filter((t=>"empty"!==t)).slice(v*L,(v+1)*L).forEach(((t,e)=>u[e].setItem(t,a))),l.slice(M*L,(M+1)*L).forEach(((t,e)=>x[e].setItem(t,a))),V.text=`Gold: ${e.gold}`;const s=w();B.color=`rgba(255,255,255,${!s||"shop"===t&&e.gold<s.value?.5:1})`};new Array(L).fill("").forEach(((t,e)=>b(e,0))),new Array(L).fill("").forEach(((t,e)=>b(e,1))),p.push(m({x:75,y:78,text:"Name                     Weight      Damage      Value",color:"#fff",font:"bold 22px sans-serif",anchor:{x:0,y:0}})),p.push(m({x:i/2-25+50+25,y:78,text:"Name                     Weight      Damage      Value",color:"#fff",font:"bold 22px sans-serif",anchor:{x:0,y:0}}));const j=m({x:i/2-100+50-10,y:n-70-30,text:">",color:"#fff",font:"bold 22px sans-serif",anchor:{x:0,y:0},onDown:()=>P(1)});p.push(j);const k=m({x:i/4+12.5,y:n-70-30,text:`1/${_}`,color:"#fff",font:"bold 22px sans-serif",anchor:{x:.5,y:0}});p.push(k);const S=m({x:i/2+(i/4-12.5),y:n-70-30,text:`1/${z}`,color:"#fff",font:"bold 22px sans-serif",anchor:{x:.5,y:0}});p.push(S);const I=m({x:70,y:n-70-30,text:"<",color:"#fff",font:"bold 22px sans-serif",anchor:{x:0,y:0},onDown:()=>P(-1)});p.push(I);const H=m({x:i-80,y:n-70-30,text:">",color:"#fff",font:"bold 22px sans-serif",anchor:{x:0,y:0},onDown:()=>O(1)});p.push(H);const D=m({x:i/2-25+70,y:n-70-30,text:"<",color:"#fff",font:"bold 22px sans-serif",anchor:{x:0,y:0},onDown:()=>O(-1)});p.push(D),p.push(m({x:i/4,y:20,text:"Player",color:"#fff",font:"28px sans-serif",anchor:{x:.5,y:0}})),p.push(m({x:i/2,y:20,text:et[e.levelIndex].name,color:"#fff",font:"bold 32px sans-serif",anchor:{x:.5,y:0}})),p.push(m({x:i/2+i/4-5,y:20,text:"Shop",color:"#fff",font:"28px sans-serif",anchor:{x:.5,y:0}}));const V=m({x:i/2,y:n-20,text:`Gold: ${e.gold}`,color:"#fff",font:"28px sans-serif",anchor:{x:.5,y:1}});p.push(V);const B=m({x:i-50,y:n-20,text:"Buy",color:"#fff",font:"28px sans-serif",anchor:{x:1,y:1},onDown:()=>{const t=+y.split(":")[1],s=w();if(s){if(xt("click"),y.includes("player")){const i=t+10*v;l.push(e.items[i]),e.items=e.items.filter(((t,e)=>e!==i)),e.gold+=s.value*a[s.name]||1}else if(e.gold>=s.value){const i=t+10*M;e.items.push(l[i]),l=l.filter(((t,e)=>e!==i)),e.gold-=s.value*a[s.name]||1}E()}}});p.push(B),A(B);const C=m({x:50,y:n-20,text:"Next",color:"#fff",font:"28px sans-serif",anchor:{x:0,y:1},onDown:()=>{xt("click"),s()}});return A(C),A(j),A(H),A(I),A(D),p.push(C),E(),{shutdown(){},update(){o.update()},render(){o.render(),p.forEach((t=>t.render())),u.forEach((t=>t.render())),x.forEach((t=>t.render()))}}})({canvas:ye,data:me,onNext:Me})},ve=()=>{we&&we.shutdown(),we=le({canvas:ye,data:me,onNext:()=>{me.levelIndex++>=et.length-1?ze(me.gold):Le()},onWin:ze,onLose:Pe})},Me=()=>{we&&we.shutdown(),we=(({canvas:t,data:e,onNext:s})=>{const{width:i,height:n}=t,o=[];et.forEach(((t,s)=>{const i=t.y-40,n=new ft({x:t.x,y:i,size:22,color:e.levelIndex===s?"#000":e.levelIndex+1===s?"#f00":e.levelIndex>s?"#000":"#0003",anchor:{x:.5,y:.5}}),a=t.name.match(/ISK|MASH|KA/),r=t.name.match(/ISK|TEH|MASH/),h=m({x:t.x,y:i+(a?-20:20),text:t.name,color:"#000",font:"bold 28px sans-serif",anchor:{x:r?0:.5,y:a?1:0}});o.push(n),o.push(h)}));const a=m({x:i-20,y:n-20,text:"Next",color:"#000",font:"bold 42px sans-serif",anchor:{x:1,y:1},onDown:()=>{xt("nextLevel"),setTimeout((()=>s()),50)}});A(a);const r=new dt;r.levelIndex=e.levelIndex;const h=new lt(0,0,t.width,t.height,["#B68E72","#B68E72"]);return{shutdown(){},update(){},render(){h.render(),r.render(),o.forEach((t=>t.render())),a.render()}}})({canvas:ye,data:me,onNext:ve})},_e=()=>{me=((t,e)=>{for(var s in e||(e={}))xe.call(e,s)&&ge(t,s,e[s]);if(pe)for(var s of pe(e))ue.call(e,s)&&ge(t,s,e[s]);return t})({},Z),we&&we.shutdown(),we=ce({canvas:ye,data:me,heading:"The Silk Trail",description:"By Dan Whiffing",button1:Me})},ze=(t=0)=>{we&&we.shutdown(),we=ce({canvas:ye,data:me,heading:"Congratulations",description:`$${t}`,button1:_e})},Pe=()=>{we&&we.shutdown(),we=ce({canvas:ye,data:me,heading:"Game Over",description:"",button1:_e})};_e(),function({fps:e=60,clearCanvas:s=!0,update:i=t,render:n,context:o=l(),blur:r=!1}={}){let h,c,d,f,p,x=0,u=1e3/e,g=1/e,y=s?H:t,w=!0;function m(){if(c=requestAnimationFrame(m),w&&(d=performance.now(),f=d-h,h=d,!(f>1e3))){for(a("tick"),x+=f;x>=u;)p.update(g),x-=u;y(o),p.render()}}return r||(window.addEventListener("focus",(()=>{w=!0})),window.addEventListener("blur",(()=>{w=!1}))),p={update:i,render:n,isStopped:!0,start(){h=performance.now(),this.isStopped=!1,requestAnimationFrame(m)},stop(){this.isStopped=!0,cancelAnimationFrame(c)}},p}({update:(...t)=>we&&we.update(...t),render:(...t)=>we&&we.render(...t)}).start();</script></body></html>