(()=>{window.AudioContext=window.AudioContext||window.webkitAudioContext;var f=!1,y=.001;window.AudioContext&&(f=new window.AudioContext);var et={C:3,D:5,E:7,F:8,G:10,A:12,B:14};function O(){return!!f}function st(i){return parseInt(i,10)}function it(i){let s=0,e=i.createScriptProcessor(4096,1,1);return e.onaudioprocess=n=>{let o=n.outputBuffer.getChannelData(0);for(let r=0;r<4096;r++){let c=Math.random()*2-1;o[r]=(s+.02*c)/1.02,s=o[r],o[r]*=3.5}},e}var A=class{constructor(t){O()&&this.init(t)}init(t){O()&&(this.initted=!0,this.audioContext=t||f,f=this.audioContext,this.mainGain=f.createGain(),this.mainCompressor=f.createDynamicsCompressor(),this.mainGain.connect(this.mainCompressor),this.mainCompressor.connect(f.destination),this.mainGain.gain.value=1,this.brownNoiseNode=it(this.audioContext),this.noiseGain=f.createGain(this.mainGain),this.noiseGain.gain.value=y,this.brownNoiseNode.connect(this.noiseGain),this.noiseGain.connect(this.mainGain))}fireNoise(){this.noiseGain.gain.exponentialRampToValueAtTime(1,f.currentTime+.1),this.noiseGain.gain.exponentialRampToValueAtTime(y,f.currentTime+1.2)}cardNoise(){this.noiseGain.gain.linearRampToValueAtTime(.2,f.currentTime+.1),this.noiseGain.gain.exponentialRampToValueAtTime(y,f.currentTime+.5)}makeOscillators(t="default",s){return t==="ocarina"?[this.makeOscillator({waveType:"sine",detune1:4,gain:.25/4,attack:.1,decay:.2,sustain:.6,release:.2},s),this.makeOscillator({waveType:"triangle",detune1:4.001,gain:.1/4,attack:.1,decay:.2,sustain:.3,release:.2},s)]:[this.makeOscillator({waveType:"triangle",detune1:1,gain:.21,attack:.05,decay:.6,hold:.3,sustain:.6,release:.2},s),this.makeOscillator({waveType:"triangle",detune1:.5,gain:.11,attack:.01,decay:.4,hold:.3,sustain:.5,release:.2},s),this.makeOscillator({waveType:"square",detune1:2,gain:.01,attack:.01,decay:.4,hold:.3,sustain:.1,release:.2},s)]}makeOscillator(t={},s){let e=t||{},n=f.createOscillator(),o=f.createGain(),r=t.gain??.2;return n.type=e.waveType||"sine",n.detune1=t.detune1||1,n.detune2=t.detune2||1,n.baseGain=r,n.attack=t.attack||.01,n.decay=t.decay||.01,n.sustain=t.sustain||.01,n.release=t.release||.01,n.hold=t.hold||.1,n.gainNode=o,o.gain.value=y,n.connect(o),s?o.connect(s):o.connect(this.mainGain),n}startOscillators(t=0,s){s=s||this.oscillators,s.forEach(e=>{setTimeout(()=>{e.start(t),e.gainNode.gain.exponentialRampToValueAtTime(y,t),setTimeout(()=>{e.gainNode.gain.exponentialRampToValueAtTime(e.baseGain,t+e.attack),e.gainNode.gain.exponentialRampToValueAtTime(e.baseGain*e.sustain||y,t+e.attack+e.hold+e.decay)},0)},0)})}setOscillatorsFrequency(t,s){s=s||this.oscillators,s.forEach(e=>e.frequency.value=t*e.detune1*e.detune2)}setOscillatorsGain(t,s){s=s||this.oscillators,s.forEach(e=>e.gainNode.gain.value=t)}stopOscillators(t=0,s){s=s||this.oscillators,s.forEach(e=>{e.gainNode.gain.exponentialRampToValueAtTime(y,t+e.release),setTimeout(()=>{e.stop(t+e.release)},0)})}makeNote(t){if(!O())return;let s={},e=t.length===3?2:1;return s.letter=t[0],s.octave=st(t[e]),e===2&&(s.accidental=t[1],s.accidentalOffset=s.accidental==="b"?-1:1),s.frequency=this.calculateNoteFrequency(s),s.name=t,s}playNote(t,s,e){if(!O())return;this.oscillators&&this.oscillators.length&&this.stopOscillators();let n=this.makeOscillators(s.instrument,e);this.setOscillatorsFrequency(t.frequency,n);let o=s.gain||.2;this.setOscillatorsGain(o,n);let r=s.delay||0;this.startOscillators(f.currentTime+r,n);let c=s.duration||.25;this.stopOscillators(f.currentTime+r+c,n)}calculateNoteFrequency(t){let e=et[t.letter];e+=t.accidentalOffset?t.accidentalOffset:0,e+=t.octave*12-60;let n=this.frequencyByOffset(440,e);return Number.isNaN(n)?0:n}frequencyByOffset(t,s){return t*2**(s/12)}},a=new A;var p={},_=i=>new Promise(t=>{i.knote=a,document.body.addEventListener("click",()=>{if(console.log("audio click",i),a.initted||a.init(new window.AudioContext),!a.initted)return;let s=a.audioContext.currentTime;console.log("audio click2");let e=a.audioContext.createGain();p.songGainNode=e,p.fadeOut=()=>{p.songGainNode.gain.setValueCurveAtTime([1,.9,y],a.audioContext.currentTime,1)},p.fadeIn=()=>{p.songGainNode.gain.setValueCurveAtTime([y,1],a.audioContext.currentTime,.5)},e.connect(a.mainGain),p.cardNoise=()=>a.cardNoise();let n=c=>{let l=a.audioContext.currentTime;return a.playNote(a.makeNote("Ab1"),{duration:2,delay:c-l+.1}),a.playNote(a.makeNote("Fb1"),{duration:2,delay:c-l+2+.1}),a.playNote(a.makeNote("B1"),{duration:2,delay:c-l+4+.1}),a.playNote(a.makeNote("Ab1"),{duration:2,delay:c-l+6+.1}),setTimeout(()=>{n(c+8)},1e3),!0},o=c=>{let l=a.audioContext.currentTime,u=.8,v=g=>(c-l)/1e3+.25/u*g,T=-1,h=0,d=(g,W=1,D=!0)=>{let F=Number(g.slice(-1))+T,H=g.slice(0,-1);a.playNote(a.makeNote(`${H}${F}`),{duration:.8*W,delay:v(h)},e),D&&(h+=1)};d("C4"),h+=1,d("C4"),d("G4"),d("G4"),h+=1,d("G4"),d("C5"),d("C5",2),d("D5",2),d("C5"),d("Bb4"),d("G4",2),h+=1,d("Eb4"),d("F4",2),d("G4",2.1),h+=1,d("Eb4"),d("F4",2),d("C4",2),h+=1,d("C4",2),d("Eb4",2),d("F4",2),h+=1,d("C4",2.1),h+=1,d("G4",4),h+=4,console.log("beatcount",h),setTimeout(()=>{o(a.audioContext.currentTime+1e3*.5)},v(h-1)*1e3)};i.medievalLoop||=o(s);let r=c=>{let l=a.audioContext.currentTime,u=.8,v=g=>(c-l)/1e3+.25/u*g,T=-1,h=0,d=(g,W=1,D=!0)=>{let F=Number(g.slice(-1))+T,H=g.slice(0,-1);a.playNote(a.makeNote(`${H}${F}`),{duration:.8*W,delay:v(h),instrument:"ocarina"},e),D&&(h+=1)};return h+=2,d("C4",3),h+=3,d("G4",3),h+=5,d("F4",2),d("G4",2),d("Eb4",3),h+=4,d("Eb4"),d("F4",2),d("C4",2),h+=11,setTimeout(()=>{r(a.audioContext.currentTime+1e3*.5)},v(h-1)*1e3),!0};i.medievalLoop2||=r(s),t({songGainNode:e}),setTimeout(()=>{document.body.classList.add("audio-ready")},300)},{once:!0})});var R=i=>i.sort(()=>Math.random()>.5?-1:1);var L=class{constructor(t,s,e,n=!0){this.combo=t,this.selected=!1,this.onSelectChange=e,this.el=document.createElement("div"),this.el.classList.add("card-wrap"),this.el.innerHTML=`<div class="card ${t.join(" ")}"></div>`,n&&s.appendChild(this.el),this.el.addEventListener("click",()=>{console.log("card click"),e(this)})}toggleSelected(t=!1){t||nt(),this.selected=!this.selected,this.el.querySelector(".card").classList.toggle("selected")}failSound(){a.playNote(a.makeNote("G3"),{duration:1.7,delay:0,instrument:"default"}),a.playNote(a.makeNote("G#3"),{duration:1.7,delay:0,instrument:"default"}),a.playNote(a.makeNote("E#3"),{duration:1.7,delay:0,instrument:"default"})}successSound(){at()}destroy(){this.el.parentNode.removeChild(this.el)}};function nt(){let i=R(["G4","C5","C4","F4","D5"])[0];a.cardNoise(),a.playNote(a.makeNote(i),{duration:.8,delay:0,instrument:"ocarina"}),a.playNote(a.makeNote(i),{duration:.7,delay:0,instrument:"default"})}function at(){a.playNote(a.makeNote("C4"),{duration:.4,delay:0,instrument:"default"}),a.playNote(a.makeNote("G4"),{duration:.4,delay:.3,instrument:"default"}),a.playNote(a.makeNote("C4"),{duration:.4,delay:.6,instrument:"default"}),a.playNote(a.makeNote("G5"),{duration:.8,delay:.9,instrument:"default"}),a.playNote(a.makeNote("F5"),{duration:.8,delay:1.7,instrument:"default"}),a.playNote(a.makeNote("C6"),{duration:1.2,delay:2.1,instrument:"default"})}var ot=["color-1","color-2","color-3"],ct=["coin","sword","cup"],lt=["none","partial","solid"],rt=["one","two","three"];function j(){let i=[];for(let t of ot)for(let s of ct)for(let e of lt)for(let n of rt)i.push([t,s,e,n]);return i}var z=j(),K=i=>i.sort(()=>Math.random()>.5?-1:1),k=class{cardsInPlay=[];drawDeck=[];constructor(t,s){this.scene=s;let e=document.createElement("div");e.classList.add("grid-wrap"),e.classList.add("column-direction"),this.el=e,t.appendChild(e),this.lock()}show(){this.el.classList.remove("hidden")}hide(){this.el.classList.add("hidden")}takeNWithTrinity(t){for(;!this.trinityExists();){K(z);let s=z.slice(-t);this.cardsInPlay&&this.cardsInPlay.forEach(e=>e.destroy()),this.cardsInPlay=s.map(e=>new L(e,this.el,this.onCardSelectChange))}}replaceTrinity(t){let e=this.cardsInPlay.filter(l=>!l.selected&&t.indexOf(l)<0).map(l=>l.combo),n=z.filter(l=>!e.includes(l));K(n);let o=n.slice(-3),r=[...o,...e];if(this.findAllTrinityInCombos(r).length){let l=t.map((u,v)=>{let T=new L(o[v],this.el,this.onCardSelectChange,!1);return u.el.parentNode.replaceChild(T.el,u.el),this.cardsInPlay.splice(this.cardsInPlay.indexOf(u),1,T),T})}else return this.replaceTrinity(t)}lock(){this.scene.elMain.classList.add("lock")}unlock(){this.scene.elMain.classList.remove("lock")}shake(){this.scene.elMain.classList.add("shake"),setTimeout(()=>{this.scene.elMain.classList.remove("shake")},1e3)}onCardSelectChange=t=>{if(!this.scene.claimStruck){this.scene.claimButton.shake(),this.shake(),p.cardNoise(),setTimeout(()=>{p.cardNoise()},200);return}this.trinityExists()||console.log("no trinity!!!");let s=this.cardsInPlay.filter(e=>e.selected);if((t.selected||!t.selected&&s.length<3)&&t.toggleSelected(),s=this.cardsInPlay.filter(e=>e.selected),s.length===3)if(this.isTrinity(s)){if(t.successSound(),this.scene.claimResults.showTrueTrinity(),this.scene.matchInfo.updateScore(1),this.scene.matchInfo.score>=this.scene.matchPoints){this.winMatch();return}setTimeout(()=>{this.replaceTrinity(s),this.scene.claimButton.unstrikeClaim()},1e3)}else setTimeout(()=>{if(t.failSound(),this.scene.claimResults.showFalseTrinity(),this.scene.matchInfo.updateScore(-1),this.scene.matchInfo.score===-this.scene.matchPoints){this.loseMatch();return}setTimeout(()=>{this.scene.claimButton.unstrikeClaim(),s.forEach(e=>{e.toggleSelected(!0)})},300)},300)};loseMatch(){this.scene.stats.duelsLost||=0,this.scene.stats.duelsLost+=1,this.scene.matchInfo.stopOpponentWait(),this.scene.claimBlocked=!1,setTimeout(()=>{this.hide(),this.cardsInPlay.forEach(t=>t.destroy()),this.cardsInPlay=[],this.scene.claimButton.hide(),this.scene.matchResults.showLossResults()},1e3)}winMatch(){this.scene.stats.duelsWon+=1,this.scene.matchInfo.stopOpponentWait(),this.scene.claimBlocked=!1,setTimeout(()=>{this.hide(),this.cardsInPlay.forEach(t=>t.destroy()),this.cardsInPlay=[],this.scene.claimButton.hide(),this.scene.questList&&this.scene.questList.checkQuest(),this.scene.matchList.match.onWin?(this.scene.matchList.match.onWin(this.scene),this.scene.matchList.show()):this.scene.matchResults.showWinResults()},1e3)}isTrinity(t){let[s,e,n]=t;return s.combo.filter((r,c)=>{let l=s.combo[c],u=e.combo[c],v=n.combo[c];return l===u&&u===v||l!==u&&l!==v&&u!==v}).length===4}isTrinityCombos(t){let[s,e,n]=t;return s.filter((r,c)=>{let l=s[c],u=e[c],v=n[c];return l===u&&u===v||l!==u&&l!==v&&u!==v}).length===4}trinityExists(t){return console.log("trinity",this.findAllTrinity(t)),!!this.findAllTrinity(t).length}findAllTrinity(t){return t||=this.cardsInPlay,$(3,t.map((e,n)=>n)).filter(e=>{let n=e.map(o=>t[o]);return this.isTrinity(n)})}findAllTrinityInCombos(t){return $(3,t.map((e,n)=>n)).filter(e=>{let n=e.map(o=>t[o]);return this.isTrinityCombos(n)})}autoTrueTrinity(){console.log("auto true trinity"),document.addEventListener("keypress",t=>{if(t.key!==" ")return;this.scene.claimStruck=!0;let s=this.findAllTrinity()[0];s&&s.forEach(e=>{this.onCardSelectChange(this.cardsInPlay[e])})})}};function $(i,t){let s=[];return i===0||t.forEach((e,n)=>{if(i===1){s.push([e]);return}$(i-1,t.slice(n+1)).forEach(r=>{s.push([e,...r])})}),s}var b=class{constructor(t,s){this.scene=s;let e=document.createElement("div");e.classList.add("claim-button-wrap"),this.el=e,t.appendChild(e),this.el.innerHTML='<div class="claim-strike-button"><div>Strike</div><div>Claim</div></div>',this.hide(),this.el.addEventListener("click",()=>{this.scene.claimBlocked||(console.log("claim click"),this.strikeClaim(),p.fadeOut(),setTimeout(()=>{s.timer.flip()},300))})}show(){this.el.classList.remove("hidden")}hide(){this.el.classList.add("hidden")}shake(){this.el.classList.add("shake"),setTimeout(()=>{this.el.classList.remove("shake")},1e3)}strikeClaim(){this.el.classList.add("struck"),p.cardNoise(),this.scene.claimStruck=!0,this.scene.cards.unlock(),this.scene.matchInfo.stopOpponentWait()}unstrikeClaim(){this.el.classList.remove("struck"),this.scene.claimStruck=!1,this.scene.cards.lock()}};var x=class{constructor(t,s){this.scene=s;let e=document.createElement("div");e.classList.add("claim-results"),this.el=e,t.appendChild(e)}showResult(t){this.el.innerHTML=`
    <div class="results-text ${t.toLowerCase()}">
      <div>${t}</div>
      <div>Trinity</div>
    </div>
  `,setTimeout(()=>{this.el.classList.add("in")},100),setTimeout(()=>{this.scene.timer.el.classList.remove("in"),this.scene.timer.reset()},300),setTimeout(()=>{this.el.classList.remove("in"),p.fadeIn()},2e3)}showTrueTrinity(){this.showResult("True")}showFalseTrinity(){this.showResult("False")}showMissedTrinity(){this.showResult("Missed")}showStolenTrinity(){this.showResult("Stolen")}};var dt=`
<div class="title-text">
  <span class="v">You</span> <span class="king">Are</span> <span class="cards">King</span>
</div>
<div class="not-true-end">But it doesn't really count unless it's a twelve card match...</div>
<div class="credits">Created by Jordan J Watkins for js13kGames jam 2023</div>
`,G=class{constructor(t,s){this.scene=s,this.el=document.createElement("div"),this.el.classList.add("title-game-won"),this.el.innerHTML=`<div class="title-game-won">${dt}</div>`,t.appendChild(this.el),this.hide(),this.el.addEventListener("click",()=>{this.hide()})}show(t){let s=this.el.querySelector(".not-true-end");t===12?s.classList.add("hidden"):s.classList.remove("hidden"),this.el.classList.remove("hidden")}hide(){this.el.classList.add("hidden")}};var V=class{constructor(t,s){this.canvas=t,this.context=s,this.offCanvases={}}initOffCanvas({key:t="c1",bgColor:s,width:e,height:n}){let o=document.createElement("canvas");o.width=e||this.canvas.width+50,o.height=n||this.canvas.height+50;let r=o.getContext("2d");return r.imageSmoothingEnabled=!1,s&&(r.fillStyle=s,r.fillRect(0,0,o.width,o.height)),this.offCanvases[t]={canvas:o,context:r,drawRect:this.drawRect,centerX:o.width/2,centerY:o.width/2,clear:()=>r.clearRect(0,0,o.width,o.height),trace:this.trace,strokeRect:this.strokeRect},this.offCanvases[t]}drawRect({x:t,y:s,color:e,width:n=30,height:o=60}){this.context.fillStyle=e||"#000",this.context.fillRect(t,s,n,o)}strokeRect({x:t,y:s,color:e,width:n=30,height:o=60}){this.context.fillStyle=e||"#000",this.context.strokeRect(t,s,n,o)}trace(){this.strokeRect({x:0,y:0,color:"red",width:this.canvas.width,height:this.canvas.height})}drawSelectedRect(t,s=2){let{context:n}=this;n.lineWidth=2,n.strokeStyle="#111",n.setLineDash([5,3]),n.strokeRect(t.x-s-2,t.y-s-2,t.width+s*2+2*2,t.height+s*2+2*2),n.lineDashOffset+=.1}noise(t,s){if(!this.offCanvases.c1){let{canvas:e,context:n}=this.initOffCanvas({key:"c1",bgColor:"#FFF",width:500,height:300}),o=n.getImageData(0,0,e.width,e.height);n.putImageData(this.applyNoise(o),0,0)}this.context.drawImage(this.offCanvases.c1.canvas,t,s,this.canvas.height,this.canvas.height,0,0,this.canvas.width,this.canvas.height)}vignette(){let t=this.context.createRadialGradient(this.canvas.width/2,this.canvas.height/2,0,this.canvas.width/2-10,this.canvas.height/2,this.canvas.width/2+20);t.addColorStop(.9,"rgba(0,0,0,0)"),t.addColorStop(1,"rgba(0,0,0,0.2)"),this.context.fillStyle=t,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)}applyNoise(t){let s=ht(t.width,t.height);for(let e=0;e<t.data.length;e+=4){let n=s[Math.floor(e/4)]?35:0;n*=Math.random(),t.data[e+3]=n}return t}};function ht(i,t){let s=[];for(let e=0;e<i*t;e++)s.push(Math.round(Math.random()));return s}var Y=V;var S=class{constructor(t,s){this.scene=s;let e=document.createElement("div");e.classList.add("match-info-wrap"),this.el=e,t.appendChild(e),this.el.innerHTML='<div class="match-info"><div class="points-label">Tally</div><div class="points"></div></div>',this.elPoints=this.el.querySelector(".points"),this.hide(),this.el.addEventListener("click",()=>{})}show(){this.el.classList.remove("hidden")}hide(){this.el.classList.add("hidden")}setMatchConfig(t={}){this.matchConfig=t;let e=(t.matchPoints||1)*2+1,n=Math.floor(e/2);this.elPoints.querySelectorAll("div").forEach(c=>c.remove());for(let c=0;c<e;c++){let l=document.createElement("div");this.elPoints.appendChild(l)}let o=this.elPoints.querySelectorAll("div")[n];this.elPoints.querySelectorAll("div").forEach(c=>c.classList.remove("active")),o.classList.add("active"),this.score=0,this.startOpponentWait()}updateScore(t){this.lastUpdateTime=Date.now(),clearTimeout(this.opponentUpdateTimeout),this.startOpponentWait(),this.score+=t,t>0&&(this.scene.stats.trinityCount+=1);let{matchPoints:s}=this.scene,e=s*2+1,o=Math.floor(e/2)+this.score,r=this.elPoints.querySelectorAll("div"),c=r[o];c&&(r.forEach(l=>l.classList.remove("active")),c.classList.add("active"))}startOpponentWait(){this.scene.claimBlocked=!1,clearTimeout(this.opponentUpdateTimeout);let{fieldSize:t,opponentSkill:s}=this.matchConfig,e=8*t*1.3/s;s||(e=300),this.opponentUpdateTimeout=setTimeout(()=>{this.stealTrinity()},e*1e3)}stopOpponentWait(){clearTimeout(this.opponentUpdateTimeout)}stealTrinity(){if(this.scene.claimBlocked)return;if(this.scene.cards.cardsInPlay[0]&&this.scene.cards.cardsInPlay[0].failSound(),this.scene.claimResults.showStolenTrinity(),this.updateScore(-1),this.scene.claimBlocked=!0,this.scene.matchInfo.score<=-this.scene.matchPoints){this.scene.cards.loseMatch();return}let t=this.scene.cards.findAllTrinity()[0];if(t){let s=t.map(e=>this.scene.cards.cardsInPlay[e]);setTimeout(()=>{this.scene.cards.replaceTrinity(s),this.scene.claimBlocked=!1},1e3)}}};var J=["Constantinople","Florence","Cairo","Paris","Jerusalem","Angkor","Hangzhou","Kaifeng","York","Milan"],Z=[4,6,9,12],mt=[1,3,5],E=class{scene;el;elList;matches;match;matchConfig={fieldSize:4,matchPoints:1};constructor(t,s){this.scene=s;let e=document.createElement("div");e.classList.add("match-list-wrap"),this.el=e,t.appendChild(e),this.el.innerHTML=`<div class="heading"><div>Duel</div> <div>Choices</div></div>
      <div class="match-list"></div>
      <div class="match-options-wrap">
        <div class="match-options">
          <div class="match-options-label">Cards</div>
          <div class="match-options-cards"></div>

          <div class="match-options-label">Points</div>
          <div class="match-options-points"></div>

          <div class="match-options-confirm">Confirm</div>
        </div>
      </div>`,this.elList=this.el.querySelector(".match-list"),this.elOptions=this.el.querySelector(".match-options-wrap"),this.elOptionsCards=this.el.querySelector(".match-options-cards"),this.elOptionsPoints=this.el.querySelector(".match-options-points"),this.elOptionsConfirm=this.el.querySelector(".match-options-confirm"),this.elOptions.classList.add("hidden");let n=Z.map(r=>{let c=document.createElement("div");return c.innerText=r.toString(),this.elOptionsCards.appendChild(c),c.addEventListener("click",()=>{n.forEach(l=>l.classList.remove("active")),c.classList.add("active"),this.matchConfig.fieldSize=r}),c});n[0].classList.add("active");let o=mt.map((r,c)=>{let l=document.createElement("div");return l.innerText=r.toString(),this.elOptionsPoints.appendChild(l),l.addEventListener("click",()=>{o.forEach(u=>u.classList.remove("active")),l.classList.add("active"),this.matchConfig.matchPoints=r}),l});o[0].classList.add("active"),this.elOptionsConfirm.addEventListener("click",()=>{this.match.init(this.scene)}),this.updateMatches(ut()),this.el.addEventListener("click",()=>{})}updateMatches(t){this.matches=t,this.matches.forEach((s,e)=>{let n=document.createElement("div");n.innerHTML=s.labelText,this.elList.appendChild(n),n.addEventListener("click",()=>{this.match=s,s.optionsSelect?this.elOptions.classList.remove("hidden"):s.init(this.scene)})})}show(){this.el.classList.remove("hidden"),this.elOptions.classList.add("hidden")}hide(){this.el.classList.add("hidden")}showOptions(){}initMatch(t){R(J),this.scene.wheel.show(J[0]),setTimeout(()=>{this.scene.wheel.hide(),this.scene.cards.takeNWithTrinity(t.fieldSize),Z.forEach(s=>this.scene.cards.el.classList.remove(`fs-${s}`)),this.scene.cards.el.classList.add(`fs-${t.fieldSize}`),this.scene.cards.show(),this.scene.claimButton.unstrikeClaim(),this.scene.claimButton.show(),this.scene.matchInfo.show(),this.scene.matchPoints=t.matchPoints,this.scene.matchInfo.setMatchConfig(t)},2e3)}};function ut(){return[{labelText:"Training 1: Seeing the light",optionsSelect:!1,init(i){i.matchList.initMatch({matchPoints:1,fieldSize:3}),i.matchList.hide()}},{labelText:"Training 2: The light in the dark",init(i){i.matchList.initMatch({matchPoints:3,fieldSize:4}),i.matchList.hide(),this.startTime=Date.now()}},{labelText:"Spar with a local fool",optionsSelect:!0,init(i){i.matchList.initMatch({opponentSkill:1,...i.matchList.matchConfig}),i.matchList.hide()}},{labelText:"Duel: Novice",optionsSelect:!0,init(i){i.matchList.initMatch({opponentSkill:2,...i.matchList.matchConfig}),i.matchList.hide()}},{labelText:"Duel: Adept",optionsSelect:!0,init(i){i.matchList.initMatch({opponentSkill:3,...i.matchList.matchConfig}),i.matchList.hide()}},{labelText:"Duel: Master",optionsSelect:!0,init(i){i.matchList.initMatch({opponentSkill:4,...i.matchList.matchConfig}),i.matchList.hide()}},{labelText:"Challenge the King",optionsSelect:!0,init(i){i.matchList.initMatch({opponentSkill:5,...i.matchList.matchConfig}),i.matchList.hide()},onWin(i){i.gameWon.show(i.matchList.matchConfig.fieldSize)}}]}var N=class{constructor(t,s){this.scene=s;let e=document.createElement("div");e.classList.add("match-results-wrap"),this.el=e,t.appendChild(e),this.el.innerHTML='<div class="match-results"></div>',this.elMatchResults=this.el.querySelector(".match-results"),this.el.addEventListener("click",()=>{this.scene.matchList.show(),setTimeout(()=>{this.el.classList.remove("win","loss"),this.scene.matchInfo.hide()},500)})}showWinResults(){this.el.classList.add("win"),this.elMatchResults.innerHTML='<div class="heading"><div>Match</div> <div>Won!</div></div>'}showLossResults(){this.el.classList.add("loss"),this.elMatchResults.innerHTML='<div class="heading"><div>Match</div> <div>Lost!</div></div>'}};var Q=i=>new Promise(t=>setTimeout(()=>t(),i)),P=class{currentT=10;tickSpeed=1e3;constructor(t,s){this.scene=s;let e=document.createElement("div");e.classList.add("timer-card-wrap"),this.el=e,t.appendChild(e),this.el.innerHTML='<div class="timer-card"><div class="timer-wrap"><div class="timer"><div class="timer-fg"></div></div></div></div>'}async flip(){this.el.classList.toggle("in"),await Q(500),this.el.classList.toggle("flip"),setTimeout(()=>{this.el.classList.toggle("fg-flip")},0),await Q(500),this.el.classList.toggle("flipped"),this.el.classList.toggle("fg-flip"),setTimeout(()=>{this.el.classList.toggle("flip"),this.el.classList.toggle("flipped")},100),this.currentT=this.currentT===10?0:10,this.setT(this.currentT),this.loop&&clearInterval(this.loop),this.currentT===0?this.loop=setInterval(()=>{this.currentT<10?(this.currentT+=1,this.setT(this.currentT)):(clearInterval(this.loop),this.timeUp())},this.tickSpeed):this.loop=setInterval(()=>{this.currentT>0?(this.currentT-=1,this.setT(this.currentT)):(clearInterval(this.loop),this.timeUp())},this.tickSpeed)}timeUp(){console.log("time up"),this.scene.claimBlocked=!0,setTimeout(()=>{let{cardsInPlay:t}=this.scene.cards,s=t.filter(e=>e.selected);if(t[0].failSound(),this.scene.claimResults.showMissedTrinity(),this.scene.matchInfo.updateScore(-1),this.scene.claimButton.unstrikeClaim(),this.scene.matchInfo.score<=-this.scene.matchPoints){console.log("match lost! - time up"),this.scene.cards.loseMatch();return}setTimeout(()=>{s.forEach(e=>{e.toggleSelected(!0)}),this.scene.claimBlocked=!1},300)},300)}reset(){clearInterval(this.loop),this.setT(10)}getT(){return document.documentElement.style.getProperty("--t")}setT(t){this.currentT=t,document.documentElement.style.setProperty("--t",t)}};var X='<div class="title-text"><span class="v">Vagabond</span><br><span class="king">King</span> <span class="of">of</span> <span class="cards">Cards</span></div>',tt=()=>{let i=document.createElement("div");i.classList.add("title"),i.innerHTML=X,document.body.appendChild(i),i.addEventListener("click",()=>{_({}),document.addEventListener("visibilitychange",t=>{console.log("event",t),document.visibilityState==="visible"?(console.log("play"),p.fadeIn()):(console.log("stop"),p.fadeOut())}),i.style.display="none"})},q=class{constructor(t,s){this.scene=s,this.el=document.createElement("div"),this.el.classList.add("title-in-aside-wrap"),this.el.innerHTML=`<div class="title-in-aside">${X}</div>`,t.appendChild(this.el)}};var M=class{constructor(t,s){this.scene=s;let e=document.createElement("div");e.classList.add("wheel-wrap"),this.el=e,t.appendChild(e),this.el.innerHTML='<div class="wheel"></div>',this.elWheel=this.el.querySelector(".wheel"),this.elWheel.innerHTML='<div class="wheel-card"><div class="travel-text">Traveling hither...</div><div class="destination-text"></div></div>',this.elDestinationText=this.el.querySelector(".destination-text"),this.hide(),this.el.addEventListener("click",()=>{})}show(t="somewhere nearby"){this.elDestinationText.innerText=`...to ${t}.`,this.el.classList.remove("hidden")}hide(){this.el.classList.add("hidden")}};new EventSource("/esbuild").addEventListener("change",()=>location.reload());var w=document.createElement("canvas");w.width=500;w.height=300;Object.assign(w.style,{position:"absolute",top:"0",left:"0",zIndex:10,pointerEvents:"none"});document.body.appendChild(w);var U=new Y(w,w.getContext("2d"));U.vignette();U.noise(0,0);U.noise(10,10);var m={claimStruck:!1,stats:{trinityCount:0,duelsWon:0}},B=document.createElement("div");B.classList.add("game-wrap");document.body.appendChild(B);var C=document.createElement("div");m.elMain=C;C.classList.add("main");m.cards=new k(C,m);B.appendChild(C);var I=document.createElement("div");I.classList.add("aside");m.titleCard=new q(I,m);m.matchInfo=new S(I,m);m.claimButton=new b(I,m);m.timer=new P(m.claimButton.el,m);B.appendChild(I);m.claimResults=new x(C,m);m.matchResults=new N(C,m);m.wheel=new M(C,m);m.matchList=new E(C,m);tt();m.gameWon=new G(document.body,m);})();
