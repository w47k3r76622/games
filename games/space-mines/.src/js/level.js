function Asteroid(t,e){this.id=t,this.level_objects=[],this.width=Math.floor(e.canvas.width),this.height=Math.floor(e.canvas.height),this.coords={},this.coords.x=Math.floor(.3*this.width+Math.random()*(.4*this.width)),this.coords.y=Math.floor(.3*this.height+Math.random()*(.4*this.height)),this.x=this.coords.x,this.y=this.coords.y,this.sim=new Simulation(e,this.id),this.starsize=4+8*Math.random(),this.world=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.heightmap=this.randomTerrain(this.world.length,5,40),this.colonised=!1,this.discovered=!1,this.destroyed=!1,this.collision=!1,this.building_total=0}Asteroid.prototype.randomTerrain=function(t,e,r){var o=[],a=0;for(i=0;i<t;i++)a=Math.floor(e+Math.random()*r),o.push(a);return o};var Building=function(t,e,r,i,o){this.type=o,this.tileX=t||0,this.x=e||0,this.y=r||0,this.height=Math.floor(64+256*Math.random()),this.width=Math.floor(64+96*Math.random()),this.rotation=i||0,this.size=60,this.state={}};function Starfield(t){this.game=t,this.canvas=this.game.canvas,this.particles=[],this.zIndex=0,this.createParticles()}function Level(t){this.game=t,this.starfield=new Starfield(t),this.state={_current:0,BUILD:0,UNIVERSE:1}}Building.prototype.draw=function(t,e,r,i){e.save(),e.rotate(this.rotation),e.font=this.size+"px Arial",e.fillText(this.type,.5*-this.size-r,-this.y-(Game.current_world.heightmap[this.tileX]+.2*this.size)),e.restore()},Starfield.prototype.draw=function(t,e){e.save(),e.fillStyle="white";for(var r=0;r<this.particles.length;r++){var i=this.particles[r];e.fillRect(i.x,i.y,i.radius,i.radius)}e.restore()},Starfield.prototype.createParticles=function(){for(var t=0;t<100;t++)this.particles.push({x:Math.random()*this.canvas.width,y:Math.random()*this.canvas.height,opacity:Math.random()/1,speed:1+2*Math.random(),radius:1+Math.random(),color:"",sourceX:64*Math.floor(1*Math.random()*5),angle:Math.PI/1+4*Math.random()})},Level.prototype.Init=function(t,e){this.width=32,this.height=64,this.threesixty=2*Math.PI,this.radius=this.game.current_world.world.length*this.width,this.segment=this.threesixty/this.game.current_world.world.length,this.offset=3*Math.PI/2,this.rotation=0,this.x=.5*this.game.canvas.width,this.y=this.game.canvas.height,this.selection="No tile clicked",this.buildings=["🏢","🏭","🏪","⚗️","🚰","🏬","🏗"],this.description=["A mine: get ore, sell ore, make money!","Power! You need power to keep it all going!","Food! Feed your workers a hearty meal.","Oxygen generator - Trust me you need O2!","Water - quench your workers thirst!","Accomodation! Everyone needs a place to rest their head!","Factory! Build cool stuff!"],this.current_building_type=0},Level.prototype.showDescription=function(t){Game.addMessage("Building type",this.description[t])},Level.prototype.setBuildingType=function(t){this.current_building_type=t},Level.prototype.Build=function(t){var e=Game.player.tile,r=this.mouse.tile;if(this.building_total=Game.current_world.building_total,1==t&&(r=e),console.log(this.game.current_world.world[r]),Game.state._current==Game.state.PLANET&&0==Game.current_world.world[r]){var i=r*this.segment+.5*this.segment,o=r*this.segment,a=this.radius;console.log(Game.current_world.sim.power,this.current_building_type),(0==Game.current_world.sim.power||Game.current_world.sim.power/this.building_total<5)&&1!=this.current_building_type&&Game.addMessage("Asteroid "+Game.current_world.id,"You need more power! Build a power plant.");var s=new Building(r,o,a,i,this.buildings[this.current_building_type]);switch(Game.current_world.building_total+=1,this.selection=r,Game.current_world.world[r]=s,Game.current_world.level_objects.push(s),this.current_building_type){case 0:Game.current_world.sim.buyMine();break;case 1:Game.current_world.sim.buyPower();break;case 2:Game.current_world.sim.buyFood();break;case 3:Game.current_world.sim.buyOxygen();break;case 4:Game.current_world.sim.buyWater();break;case 5:Game.current_world.sim.buyHouse();break;case 6:Game.current_world.sim.buyFactory()}}return Game.ProcessMessages(),Game.current_world.sim.update(),Game.current_world.sim.draw(),!0},Level.prototype.AdjustTile=function(t,e){return(t-e)*Game.current_world.world.length/(2*Math.PI)},Level.prototype.deleteBuilding=function(){Game.player.tile;var t=this.mouse.tile;return this.building_total=Game.current_world.building_total,Game.state._current==Game.state.PLANET&&0!=Game.current_world.world[t]&&(Game.current_world.world[t]=0,Game.current_world.level_objects.splice(t)),Game.ProcessMessages(),Game.current_world.sim.update(),Game.current_world.sim.draw(),!0},Level.prototype.getMouseAngle=function(t){var e=t.x-(this.x-Game.camera.xScroll),r=t.y-(this.y-Game.camera.yScroll)*Game.camera.zoom,i=Math.atan2(r,e);angle=r<0?2*Math.PI+i:i,angle-=this.rotation;var o=angle/this.segment,a=this.offset/this.segment,s=Math.floor(a-o),l=s;return l<0&&(l+=Game.current_world.world.length),l>0&&(l=Math.abs(Game.current_world.world.length-1-l)),Game.current_world.world.length+s==Game.current_world.world.length&&(l=this.game.current_world.world.length-1),{dx:e,dy:r,degrees:(180*angle/Math.PI).toFixed(2),tile:Math.floor(l),radian:angle.toFixed(2)}},Level.prototype.Terraform=function(){var t=this.getMouseAngle(Game.mouse);this.game.current_world.heightmap[t.tile]-=10},Level.prototype.checkRotation=function(t){return t<-this.threesixty&&(t=this.threesixty),t>this.threesixty&&(t=0),t},Level.prototype.update=function(t,e,r){Game.player.left&&(this.rotation+=Game.player.vx*t),Game.player.right&&(this.rotation-=Game.player.vx*t),this.rotation=this.checkRotation(this.rotation),this.mouse=this.getMouseAngle(Game.mouse),Game.mouse.clicked&&(Game.mouse.clicked=!1,this.Build()),Game.player.action&&this.Build(!0),Game.camera.Set(Game.player.x,Game.player.y-.98*this.radius-150)},Level.prototype.drawWorld=function(t,e,r){for(t.strokeStyle="rgb(100,100,100)",t.lineWidth=10,this.tileX=0;this.tileX<Game.current_world.world.length;this.tileX++)t.beginPath(),t.arc(0,0,this.radius+Game.current_world.heightmap[this.tileX],this.offset+this.tileX*this.segment,this.offset+(this.tileX+1)*this.segment,!1),t.stroke(),t.lineStyle="grey",t.lineTo(0,0),t.fillStyle="grey",t.fill(),t.closePath()},Level.prototype.draw=function(t,e,r,i){e.save(),e.setTransform(Game.camera.zoom,0,0,Game.camera.zoom,this.x-r,(this.y-i)*Game.camera.zoom),e.rotate(this.rotation);for(var o=0;o<Game.current_world.level_objects.length;o++)Game.current_world.level_objects[o]&&Game.current_world.level_objects[o].draw(t,e,r,i);this.drawWorld(e,r,i),e.restore()};