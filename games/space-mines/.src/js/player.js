function Camera(t){this.x=.5*t.canvas.width,this.y=.5*t.canvas.height,this.xScroll=0,this.yScroll=0}function Player(t){this.game=t}Camera.prototype.Init=function(){this.speed=2,this.vx=this.speed,this.vy=this.speed,this.xScroll=0,this.yScroll=0,this.zoom=1,this.zoom_limit=.3,this.width=32,this.height=32,this.state={_current:0,FOLLOW:0,PAN:1},this.cameraPosition=[this.xScroll,this.yScroll],this.prevCameraPosition=[this.xScroll,this.yScroll],this.curCameraPosition=[this.xScroll,this.yScroll],this.lerpAmount=1,this.target=void 0,this.prev_target=null},Camera.prototype.Set=function(t,i){this.prev_target=this.target,this.target={x:t,y:i}},Camera.prototype.update=function(t){this.dx=this.target.x-this.x,this.dy=this.target.y-this.y,this.cameraPosition=[this.xScroll,this.yScroll],this.cameraPosition!=this.curCameraPosition&&(this.lerpAmount=0,this.curCameraPosition=this.cameraPosition),this.lerpAmount<1?this.lerpAmount+=.05:this.prevCameraPosition=this.curCameraPosition,this.xScroll=utils.Lerp(this.dx,this.curCameraPosition[0],this.lerpAmount),this.yScroll=utils.Lerp(this.dy,this.curCameraPosition[1],this.lerpAmount),this.zoom<=this.zoom_limit?this.target={x:Game.player.x,y:Game.player.y}:this.target={x:.5*Game.canvas.width,y:.5*Game.canvas.height}},Camera.prototype.keydown=function(t){switch(t.keyCode){case 187:this.zoom+=.1;break;case 189:this.zoom-=.1;break;case 107:this.zoom+=.1;break;case 109:this.zoom-=.1}},Camera.prototype.keyup=function(t){t.keyCode},Player.prototype.Init=function(t,i,e){this.x=i||.5*this.game.canvas.width,this.y=200,this.orig_width=16,this.orig_height=32,this.width=this.orig_width,this.height=this.orig_height,this.size=30,this.color=t||"black",this.vx=0,this.vy=0,this.speed=.5,this.rotation=0,this.right=!1,this.left=!1,this.up=!1,this.down=!1,this.fire=!1,this.pause=!1,this.jump=!1,this.friction=.1,this.gravity=-6,this.AABB={}},Player.prototype.getBoundingBox=function(t,i){this.newposition={x:this.x+this.vx,y:this.y+this.vy},this.AABB.bottom={x:this.x+.5*this.width,y:this.newposition.y}},Player.prototype.checkCollisions=function(t){this.tile=this.getTile(Game.level.rotation),this.AABB.bottom.y<Game.level.y-Game.current_world.heightmap[this.tile]?this.vy+=.5:this.vy!=this.gravity?(this.up=!1,this.jump=!1,this.vy=0):this.up&&this.jump&&(this.jump=!0,this.vy=this.gravity)},Player.prototype.getTile=function(t){var i=Math.floor(t/Game.level.segment);return i=t>0?Math.abs(Game.current_world.world.length-i-1):Math.abs(i)-1,0==t&&(i=0),i},Player.prototype.Gravity=function(t){this.y+=this.vy},Player.prototype.update=function(t,i,e){this.zindex=this.y,this.Gravity(t),this.getBoundingBox(),this.checkCollisions(),Game.player=this},Player.prototype.draw=function(t,i,e,s){i.save(),i.fillStyle=this.color,i.setTransform(Game.camera.zoom,0,0,Game.camera.zoom,this.x-e,(this.y-s)*Game.camera.zoom),i.beginPath(),i.fillStyle="silver",i.arc(0,-(Game.level.radius+(this.height-3)),13,0,2*Math.PI,!1),i.fill(),i.lineWidth=2,i.stroke(),i.fillStyle="pink",i.fillRect(-.5*this.width,-(Game.level.radius+this.height),this.width,this.height),i.beginPath(),i.arc(0,-(Game.level.radius+(this.height-3)),13,0,2*Math.PI,!1),i.strokeStyle="silver",i.fillStyle="silver",i.lineWidth=2,i.stroke(),i.fillRect(-.5*this.width,-(Game.level.radius+this.height-10),this.width,this.height-10),i.fillStyle="black",this.left?(i.fillRect(-.5*this.width+5,5-(Game.level.radius+this.height),3,4),i.fillRect(-.5*this.width+1,5-(Game.level.radius+this.height),3,4)):this.right?(i.fillRect(-.5*this.width+8,5-(Game.level.radius+this.height),3,4),i.fillRect(-.5*this.width+12,5-(Game.level.radius+this.height),3,4)):(i.fillRect(-.5*this.width+4,5-(Game.level.radius+this.height),3,4),i.fillRect(-.5*this.width+8,5-(Game.level.radius+this.height),3,4)),i.restore()},Player.prototype.keydown=function(t){switch(t.preventDefault(),t.keyCode){case 37:this.left=!0,this.vx=this.speed;break;case 39:this.idle=!1,this.right=!0,this.vx=this.speed;break;case 38:this.up=!0,this.up&&!this.jump&&(this.jump=!0,this.vy=this.gravity);break;case 40:this.down=!0;break;case 65:this.left=!0,this.vx=this.speed;break;case 68:this.right=!0,this.vx=this.speed;break;case 87:this.up=!0,this.up&&!this.jump&&(this.jump=!0,this.vy=this.gravity);break;case 83:this.down=!0;break;case 32:this.action=!0;break;case 69:0==Game.debug?Game.debug=!0:1==Game.debug&&(Game.debug=!1)}},Player.prototype.keyup=function(t){switch(t.keyCode){case 37:this.left=!1,this.vx=0;break;case 39:this.right=!1,this.vx=0;break;case 38:this.up=!1;break;case 40:this.down=!1;break;case 65:this.left=!1,this.vx=0;break;case 68:this.right=!1,this.vx=0;break;case 87:this.up=!1;break;case 83:this.down=!1;break;case 32:this.action=!1}};