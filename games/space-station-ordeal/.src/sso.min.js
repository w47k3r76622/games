'use strict';function aa(a,b=new a.g(16)){b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=0;b[5]=1;b[6]=0;b[7]=0;b[8]=0;b[9]=0;b[10]=1;b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b}
function ba(a,b,c,d,e,f=new a.g(16)){a=b[0];var g=b[1],h=b[2],l=b[3],k=b[4],p=b[5],m=b[6],q=b[7],n=b[8],r=b[9],w=b[10],y=b[11],t=b[12],E=b[13],M=b[14],N=b[15];b!==f&&(f[0]=a,f[1]=g,f[2]=h,f[3]=l,f[4]=k,f[5]=p,f[6]=m,f[7]=q,f[8]=n,f[9]=r,f[10]=w,f[11]=y);f[12]=a*c+k*d+n*e+t;f[13]=g*c+p*d+r*e+E;f[14]=h*c+m*d+w*e+M;f[15]=l*c+q*d+y*e+N;return f}
function ca(a,b,c,d=new a.g(16)){a=b[0];var e=b[1],f=b[2],g=b[3],h=b[8],l=b[9],k=b[10],p=b[11],m=Math.cos(c);c=Math.sin(c);d[0]=m*a-c*h;d[1]=m*e-c*l;d[2]=m*f-c*k;d[3]=m*g-c*p;d[8]=m*h+c*a;d[9]=m*l+c*e;d[10]=m*k+c*f;d[11]=m*p+c*g;b!==d&&(d[4]=b[4],d[5]=b[5],d[6]=b[6],d[7]=b[7],d[12]=b[12],d[13]=b[13],d[14]=b[14],d[15]=b[15]);return d}function da(a,b,c=new a.g(3)){a=Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2]);1E-5<a&&(c[0]=b[0]/a,c[1]=b[1]/a,c[2]=b[2]/a);return c}
function ea(a,b,c,d=new a.g(3)){d[0]=b[0]-c[0];d[1]=b[1]-c[1];d[2]=b[2]-c[2];return d}function fa(a,b,c,d=new a.g(3)){d[0]=b[1]*c[2]-b[2]*c[1];d[1]=b[2]*c[0]-b[0]*c[2];d[2]=b[0]*c[1]-b[1]*c[0];return d}function ha(a,b,c,d,e=new a.g(16)){c=da(a,ea(a,b,c));d=da(a,fa(a,d,c));a=da(a,fa(a,c,d));e[0]=d[0];e[1]=d[1];e[2]=d[2];e[3]=0;e[4]=a[0];e[5]=a[1];e[6]=a[2];e[7]=0;e[8]=c[0];e[9]=c[1];e[10]=c[2];e[11]=0;e[12]=b[0];e[13]=b[1];e[14]=b[2];e[15]=1;return e}
function ia(a,b,c,d=new a.g(16)){a=c[0];var e=c[1],f=c[2],g=c[3],h=c[4],l=c[5],k=c[6],p=c[7],m=c[8],q=c[9],n=c[10],r=c[11],w=c[12],y=c[13],t=c[14];c=c[15];var E=b[0],M=b[1],N=b[2],S=b[3],L=b[4],x=b[5],I=b[6],u=b[7],A=b[8],v=b[9],F=b[10],J=b[11],G=b[12],K=b[13],R=b[14];b=b[15];d[0]=a*E+e*L+f*A+g*G;d[1]=a*M+e*x+f*v+g*K;d[2]=a*N+e*I+f*F+g*R;d[3]=a*S+e*u+f*J+g*b;d[4]=h*E+l*L+k*A+p*G;d[5]=h*M+l*x+k*v+p*K;d[6]=h*N+l*I+k*F+p*R;d[7]=h*S+l*u+k*J+p*b;d[8]=m*E+q*L+n*A+r*G;d[9]=m*M+q*x+n*v+r*K;d[10]=m*N+q*I+
n*F+r*R;d[11]=m*S+q*u+n*J+r*b;d[12]=w*E+y*L+t*A+c*G;d[13]=w*M+y*x+t*v+c*K;d[14]=w*N+y*I+t*F+c*R;d[15]=w*S+y*u+t*J+c*b;return d}function ja(a,b,c,d,e,f=new a.g(16)){a=Math.tan(.5*Math.PI-.5*b);b=1/(d-e);f[0]=a/c;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=a;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=(d+e)*b;f[11]=-1;f[12]=0;f[13]=0;f[14]=d*e*b*2;f[15]=0;return f}
function ka(a,b,c=new a.g(16)){c[0]=b[0];c[1]=b[4];c[2]=b[8];c[3]=b[12];c[4]=b[1];c[5]=b[5];c[6]=b[9];c[7]=b[13];c[8]=b[2];c[9]=b[6];c[10]=b[10];c[11]=b[14];c[12]=b[3];c[13]=b[7];c[14]=b[11];c[15]=b[15];return c}
class la{constructor(){this.g=Float32Array}inverse(a,b=new this.g(16)){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],l=a[6],k=a[7],p=a[8],m=a[9],q=a[10],n=a[11],r=a[12],w=a[13],y=a[14];a=a[15];var t=q*a,E=y*n,M=l*a,N=y*k,S=l*n,L=q*k,x=e*a,I=y*f,u=e*n,A=q*f,v=e*k,F=l*f,J=p*w,G=r*m,K=g*w,R=r*h,V=g*m,ma=p*h,na=c*w,oa=r*d,pa=c*m,qa=p*d,ra=c*h,sa=g*d,Ga=t*h+N*m+S*w-(E*h+M*m+L*w),Ha=E*d+x*m+A*w-(t*d+I*m+u*w);w=M*d+I*h+v*w-(N*d+x*h+F*w);d=L*d+u*h+F*m-(S*d+A*h+v*m);h=1/(c*Ga+g*Ha+p*w+r*d);b[0]=h*Ga;b[1]=
h*Ha;b[2]=h*w;b[3]=h*d;b[4]=h*(E*g+M*p+L*r-(t*g+N*p+S*r));b[5]=h*(t*c+I*p+u*r-(E*c+x*p+A*r));b[6]=h*(N*c+x*g+F*r-(M*c+I*g+v*r));b[7]=h*(S*c+A*g+v*p-(L*c+u*g+F*p));b[8]=h*(J*k+R*n+V*a-(G*k+K*n+ma*a));b[9]=h*(G*f+na*n+qa*a-(J*f+oa*n+pa*a));b[10]=h*(K*f+oa*k+ra*a-(R*f+na*k+sa*a));b[11]=h*(ma*f+pa*k+sa*n-(V*f+qa*k+ra*n));b[12]=h*(K*q+ma*y+G*l-(V*y+J*l+R*q));b[13]=h*(pa*y+J*e+oa*q-(na*q+qa*y+G*e));b[14]=h*(na*l+sa*y+R*e-(ra*y+K*e+oa*l));b[15]=h*(ra*q+V*e+qa*l-(pa*l+sa*q+ma*e));return b}};function ta(a){var b=["attribute vec4 p;attribute vec3 n;uniform mat4 a;uniform mat4 b;varying vec3 c;void main(){gl_Position=a*p;c=mat3(b)*n;}","precision mediump float;varying vec3 c;uniform vec4 e;void main(){vec3 f=normalize(c);float l=abs(f.x)*0.9+abs(f.y)+abs(f.z)*0.75;gl_FragColor=e;gl_FragColor.rgb*=l;}"];const c=[];for(let g=0;g<b.length;++g){var d=c,e=d.push,f=a;const h=f.h.createShader(a.h[a.g[g]]);f.h.shaderSource(h,b[g]);f.h.compileShader(h);e.call(d,h)}return a.createProgram(c)}
function ua(a){const b=a.clientWidth|0,c=a.clientHeight|0;if(a.width!==b||a.height!==c)a.width=b,a.height=c}class va{constructor(a){this.h=a;this.g=["VERTEX_SHADER","FRAGMENT_SHADER"]}createProgram(a){const b=this.h.createProgram();a.forEach(c=>{this.h.attachShader(b,c)});this.h.linkProgram(b);return this.h.getProgramParameter(b,this.h.LINK_STATUS)?b:null}};function z(a){let b=[];b[0]=((a&16711680)>>16)/255;b[1]=((a&65280)>>8)/255;b[2]=(a&255)/255;return b}function wa(a,b){b.u=[...b.position];let c=b.parent;c===a&&(b.u=[...b.position]);for(;c!==a;){if(!c){b.u=[0,0,0];break}b.u[0]+=c.position[0];b.u[1]+=c.position[1];b.u[2]+=c.position[2];c=c.parent}}function xa(a,b){b.parent!==a?(b.T=b.parent.T,b.T=ba(a.S,b.T,b.position[0],b.position[1],b.position[2])):(b.T=aa(a.S),b.T=ba(a.S,b.T,b.u[0],b.u[1],b.u[2]));b.T=ca(a.S,b.T,b.rotation)}
function ya(a){let b=null;a.j.length=0;let c=[],d=null;for(let e=0;e<a.children.length;e++)for(a.children[e].visible?(d=a.children[e],c.push(d),b=!1):b=!0;!b;){let f=!0;for(let g=d.Ka;g<d.children.length;g++)if(d.children[g].visible){d.Ka=g+1;d=d.children[g];c.push(d);f=!1;break}d.Ka=0;f&&(d.parent!==a?d=d.parent:(b=!0,a.j=a.j.concat(c),c.length=0))}a.j.forEach(e=>{wa(a,e);xa(a,e)})}
function B(a,b,c=a,d=!0){b.parent&&a.removeChild(b);c.children.push(b);b.parent=c;d&&ya(a);C(b.H,new D(Math.round(b.u[0]/b.i.Z),Math.round(b.u[2]/b.i.Z)));return b}function H(a,b,c){b.forEach(d=>{B(a,d,c,!1)});ya(a)}function za(a,b){b.forEach(c=>{a.removeChild(c,!1)});ya(a)}function Aa(a,b=a){for(;0<b.children.length;)a.removeChild(b.children[0],!1);ya(a)}
class Ba{constructor(){this.V={va:null,ja:null};document.addEventListener("keydown",b=>{this.V.ja&&this.V.ja(b)});document.addEventListener("keyup",b=>{this.V.va&&this.V.va(b)});this.X=document.getElementById("glcanvas");this.canvas=document.getElementById("canvas");this.s=this.canvas.getContext("2d");this.X.style.background="black";this.s.font="32px Comic Sans MS";this.s.fillStyle="red";this.s.textAlign="left";this.h=this.X.getContext("webgl");this.gb=new va(this.h);this.S=new la;this.g=ta(this.gb);
this.I=[];this.Ya=this.h.getAttribLocation(this.g,"p");this.da=this.h.getAttribLocation(this.g,"n");this.ib=this.h.getUniformLocation(this.g,"a");this.hb=this.h.getUniformLocation(this.g,"b");this.ab=this.h.getUniformLocation(this.g,"e");this.wb=20;this.oa=[];this.children=[];this.j=[];let a=this.h.canvas.width/this.h.canvas.height;this.cb=Math.PI/3;this.eb=ja(this.S,this.cb,a,.25,20);this.M=Math.pow(2,32);this.D=new Ca(this);this.Z=1;this.h.enableVertexAttribArray(this.Ya);this.h.enableVertexAttribArray(this.da);
this.R=this.h.createBuffer();this.h.bindBuffer(this.h.ARRAY_BUFFER,this.R);this.h.bufferData(this.h.ARRAY_BUFFER,O.j,this.h.STATIC_DRAW);this.h.bindBuffer(this.h.ARRAY_BUFFER,this.R);this.h.vertexAttribPointer(this.da,3,this.h.FLOAT,!1,0,0);this.bb=this.h.createBuffer();this.h.bindBuffer(this.h.ELEMENT_ARRAY_BUFFER,this.bb);this.h.bufferData(this.h.ELEMENT_ARRAY_BUFFER,new Uint16Array(O.g),this.h.STATIC_DRAW);ua(this.h.canvas);this.h.viewport(0,0,this.h.canvas.width,this.h.canvas.height);this.h.enable(this.h.CULL_FACE);
this.h.enable(this.h.DEPTH_TEST);this.h.useProgram(this.g);this.$a=0;this.v=null;this.oa=[];this.Ma=null;this.aa=.2;requestAnimationFrame(this.Za.bind(this))}Za(a){let b=(a-this.$a)/1E3;this.$a=a;b>this.aa&&(b=this.aa);this.oa.forEach(e=>{e.update(b)});this.Ma&&Da(this.Ma);this.v&&(this.v.ra.forEach(e=>{e.fa=!1;e.ga=!1}),this.v.ra.length=0,this.v.update(),Ea(this.v,b));this.h.clear(this.h.COLOR_BUFFER_BIT|this.h.DEPTH_BUFFER_BIT);let c=ia(this.S,this.eb,this.D.s);this.j.forEach(e=>{!e.fixed&&e.active&&
(e.fa||(e.position[0]+=e.speed.x*b),e.ga||(e.position[2]+=e.speed.z*b),wa(this,e),e.rotation+=e.ca*b,xa(this,e));if(e.ha&&400>(e.Ba||Fa(this.D.position,e.u))){this.h.bindBuffer(this.h.ARRAY_BUFFER,e.ha.Xa);var f=this.h.FLOAT;this.h.vertexAttribPointer(this.Ya,3,f,!1,0,0);f=ia(this.S,c,e.T);var g=this.S.inverse(e.T);g=ka(this.S,g);this.h.uniformMatrix4fv(this.ib,!1,f);this.h.uniformMatrix4fv(this.hb,!1,g);this.h.uniform4fv(this.ab,[...e.ha.color,1]);f=this.h.UNSIGNED_SHORT;this.h.drawElements(this.h.TRIANGLES,
36,f,0)}});this.j.forEach(e=>{e.active&&e.update(b)});this.update(b);this.s.clearRect(0,0,this.canvas.width,this.canvas.height);let d="";this.I.forEach(e=>{d+=e});this.s.fillText(d,0,this.canvas.height/2);requestAnimationFrame(this.Za.bind(this))}removeChild(a,b=!0){a.parent.children.splice(a.parent.children.findIndex(c=>c===a),1);a.parent=null;b&&ya(this)}update(){}start(){}}function C(a,b){a.x=b.x;a.z=b.z;return a}
class D{constructor(a=0,b=0){this.x=a;this.z=b}compare(a){return a?a.x===this.x&&a.z===this.z?!0:!1:!1}add(a){a&&(this.x+=a.x,this.z+=a.z)}}function Ia(a){let b=[];for(let c=0;c<a.length;c++){let d=Math.floor(c/a.C),e=c-d*a.C;b.push({Ea:a.l[e][d],x:e,y:d})}return b}
class Ja{constructor(a,b){var c={U:[]};let d=null;d="object"===typeof c?(e,f,g)=>{f[g].push(JSON.parse(JSON.stringify(e)))}:(e,f,g)=>{f[g].push(e)};this.l=[];this.C=a;this.F=b;for(let e=0;e<a;e++){this.l.push([]);for(let f=0;f<b;f++)d(c,this.l,e)}this.length=a*b;this.j=Ia(this)}}function Ea(a,b){a.g.forEach(c=>{Ka(a,c,c.H.x,c.H.z,b)})}
function La(a,b){let c=new D(b.H.x,b.H.z);b.speed.x?b.fa&&b.speed.x?c.x=Math.round(b.position[0]/a.i.Z):0>b.speed.x&&b.position[0]<=(c.x-1)*a.i.Z?c.x--:0<b.speed.x&&b.position[0]>=(c.x+1)*a.i.Z&&c.x++:c.x=Math.round(b.position[0]/a.i.Z);b.speed.z?b.ga&&b.speed.z?c.z=Math.round(b.position[2]/a.i.Z):0>b.speed.z&&b.position[2]<=(c.z-1)*a.i.Z?c.z--:0<b.speed.z&&b.position[2]>=(c.z+1)*a.i.Z&&c.z++:c.z=Math.round(b.position[2]/a.i.Z);return c}
function Ma(a,b){b.fixed||a.g.push(b);let c=La(a,b);b.H.compare(c)||(C(b.H,c),P(b.Ga));a.l[c.x][c.z].U.push(b)}function Na(a,b){a.j.some(c=>c.Ea.U.some((d,e)=>{if(d===b)return c.Ea.U.splice(e,1),!0}));a.g.splice(a.g.findIndex(c=>c===b),1)}function Oa(a,b){b.forEach(c=>{Na(a,c)})}
function Ka(a,b,c,d,e=0){let f=(y,t)=>{let E=0;t&&!y.fa&&(E=y.speed.x*e);return y.position[0]+E},g=(y,t)=>{let E=0;t&&!y.ga&&(E=y.speed.z*e);return y.position[2]+E},h=!1,l=[],k=[],p=0,m=0,q=0,n=0;k.push(new D(f(b,!0),g(b,!1)));k.push(new D(f(b,!1),g(b,!0)));var r=c-3;0>r&&(r=0);c+=3;c>a.C&&(c=a.C);let w=d-3;0>w&&(w=0);d+=3;d>a.F&&(d=a.F);for(;r<c;r++)for(let y=w;y<d;y++)a.l[r][y].U.forEach(t=>{if(t!==b&&t.constructor.A&b.ba){l.length=0;l.push(new D(f(t,!0),g(t,!1)));l.push(new D(f(t,!1),g(t,!0)));
h=!1;for(let E=0;2>E;E++)p=l[E].x-k[E].x,m=l[E].z-k[E].z,q=t.size[0]/2+b.size[0]/2,n=t.size[1]/2+b.size[1]/2,Math.abs(p)<q&&Math.abs(m)<n&&(h=!0,0===E?b.La&&(t.fa=!0,b.fa=!0,a.ra.push(t,b)):b.La&&(t.ga=!0,b.ga=!0,a.ra.push(t,b)));h&&(P(b.O,b,t),P(t.O,t,b))}})}
class Pa extends Ja{constructor(a){super(110,110);this.i=a;this.g=[];this.ra=[]}update(){let a=[];this.g.forEach(b=>{if(b.active&&b.speed.x||b.speed.z){let c=new D(b.H.x,b.H.z),d=La(this,b);d.compare(c)||a.push({ka:b,ua:c,Da:d})}});a.forEach(b=>{let c=this.l[b.ua.x][b.ua.z].U.findIndex(d=>d===b.ka);this.l[b.ua.x][b.ua.z].U.splice(c,1)});a.forEach(b=>{this.l[b.Da.x][b.Da.z].U.push(b.ka);C(b.ka.H,b.Da);P(b.ka.Ga)})}clear(){this.j.forEach(a=>{a.Ea.U.length=0})}}
class O{static get j(){return new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0])}static get g(){return[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}constructor(a,b=[1,1,1],c=[0,1,0]){this.size=b;this.color=c;this.Xa=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this.Xa);b=[b[0]/2,b[1]/2,b[2]/2];b=new Float32Array([-b[0],-b[1],
b[2],b[0],-b[1],b[2],b[0],b[1],b[2],-b[0],b[1],b[2],-b[0],-b[1],-b[2],-b[0],b[1],-b[2],b[0],b[1],-b[2],b[0],-b[1],-b[2],-b[0],b[1],-b[2],-b[0],b[1],b[2],b[0],b[1],b[2],b[0],b[1],-b[2],-b[0],-b[1],-b[2],b[0],-b[1],-b[2],b[0],-b[1],b[2],-b[0],-b[1],b[2],b[0],-b[1],-b[2],b[0],b[1],-b[2],b[0],b[1],b[2],b[0],-b[1],b[2],-b[0],-b[1],-b[2],-b[0],-b[1],b[2],-b[0],b[1],b[2],-b[0],b[1],-b[2]]);a.bufferData(a.ARRAY_BUFFER,b,a.STATIC_DRAW)}}
class Q{static get A(){return 0}constructor(a,b=[0,0,0],c=null){this.i=a;this.position=b;this.parent=null;this.ha=c;this.u=[0,0,0];this.visible=!0;this.children=[];this.ca=this.rotation=this.Ka=0;this.T=null;this.fixed=!1;this.La=!0;this.speed=new D(0,0);this.H=new D(0,0);this.ga=this.fa=!1;this.ba=null;this.O=new Qa(this);this.Ga=new Qa(this);this.active=!0;this.size=[1,1];this.Ba=!1;this.K=1}reset(){this.position=[0,0,0];this.speed.x=0;this.rotation=this.speed.z=0;this.K=1}set(a){this.position=
a.position||[0,0,0];this.active=!0}update(){}}function Ra(a){a.j=ha(a.i.S,a.position,a.target,a.g);a.s=a.i.S.inverse(a.j)}function Sa(a,b=a.position,c=a.target,d=a.g){a.target=c;a.position=b;a.g=d;Ra(a)}class Ca{constructor(a){this.i=a;this.target=[0,0,0];this.position=[0,0,0];this.g=[0,1,0];this.s=this.j=null;Ra(this)}}
function Da(a){var b=a.i.wb;a.j.forEach(g=>{g.visible=!1});a.j.length=0;var c=a.Y.H.x-b;0>c&&(c=0);let d=a.Y.H.x+b;d>=a.L.C&&(d=a.L.C);let e=a.Y.H.z-b;0>e&&(e=0);b=a.Y.H.z+b;b>=a.L.F&&(b=a.L.F);let f=Ta(Math.atan2(a.i.D.target[0],a.i.D.target[2]));for(;c<d;c++)for(let g=e;g<b;g++){let h=Ta(Ta(Math.atan2(c-a.Y.H.x,g-a.Y.H.z))-f);(h<=.5*Math.PI||h>=1.5*Math.PI)&&a.R.l[c][g].U.forEach(l=>{l.visible=!0;a.j.push(l)})}ya(a.i)}
function Ua(a){for(let c=0;c<a.L.F;c++)for(let d=0;d<a.L.C;d++)if(a.L.l[d][c].filled){var b=B(a.i,T(a.aa,{i:a.i,position:[d,0,c]}),a);a.g.push(b);a.R.l[d][c].U.push(b);b.visible=!1}else b=B(a.i,T(a.X,{i:a.i,position:[d,0,c]}),a),a.s.push(b),a.R.l[d][c].U.push(b),b.visible=!1;ya(a.i);a.i.v&&a.g.forEach(c=>{Ma(a.i.v,c)})}function Va(a){a.i.v&&Oa(a.i.v,a.g);a.j.forEach(b=>{b.visible=!1});a.g.forEach(b=>{U(a.aa,b)});a.g.length=0;a.s.forEach(b=>{U(a.X,b)});a.s.length=0;Aa(a.i,a)}
function Wa(a){var b=Xa.A+Ya.A+Za.A;a.da.forEach(c=>{c.ba=b})}class $a extends Q{constructor(a,b,c,d,e,f){super(a,b);this.g=[];this.s=[];this.Y=e;this.aa=new ab(c);this.X=new ab(d);this.L=f;this.da=[];this.j=[];this.R=new Ja(f.C,f.F)}reset(){super.reset();Va(this)}set(a){super.set(a);this.Y=a.Y;this.L=a.L}}class bb extends Q{constructor(a,b){super(a,b);this.fixed=!0}Aa(){}}function T(a,b){let c;0<a.j.length?(c=a.j[a.j.length-1],c.set(b),a.j.splice(a.j.length-1,1)):c=a.g(b);return c}
function U(a,b){b.reset();1500>a.j.length&&a.j.push(b)}function cb(a,b){for(let c=0;c<b.length;c++)U(a,b[c])}class W{constructor(){this.j=[]}g(){return{}}}class db extends W{g(a){return new $a(a.i,a.position,a.Na,a.pb,a.Y,a.L)}}class ab extends W{constructor(a){super();this.Na=a}g(a){a=new this.Na(a.i,a.position);a.Aa();return a}}
class eb{constructor(a){this.endTime=a;this.j=0;this.s=!1;this.g=null;this.active=!1}update(a){!this.s&&this.active&&(this.j+=a,this.j>this.endTime&&(this.s=!0,this.g&&this.g(this)))}reset(a){this.active=a;this.s=!1;this.j=0}}function P(a,...b){a.g.forEach(c=>{let d=a.ka;for(;d&&(c.sb!==d||(c.nb(...b),!c.terminate));)d.parent?d=d.parent:d=null})}class Qa{constructor(a){this.ka=a;this.g=[]}addListener(a,b,c=!1){a=new fb(a,b,c);this.g.push(a);return a}}
class fb{constructor(a,b,c=!1){this.sb=a;this.nb=b;this.terminate=c}}class gb{constructor(a,b){this.l=[];this.C=a;this.F=b;this.$=X.j;for(let c=0;c<a;c++){let d=[];this.l.push(d);for(let e=0;e<b;e++)d.push({filled:!1,rb:!1,ia:[!0,!0,!0,!0]})}}forEach(a){for(let b=0;b<this.C;b++)for(let c=0;c<this.F;c++)a(this.l[b][c],b,c)}}function hb(a){a.l.forEach(b=>{for(let c=0;c<b.length;c++)b[c]=!1})}
class ib{constructor(a,b){this.l=[];this.C=a;this.F=b;for(let c=0;c<a;c++){let d=[];this.l.push(d);for(let e=0;e<b;e++)d.push(!1)}}}class X{static get g(){return{E:1,jb:2,lb:3,za:4,NONE:5}}constructor(){this.N=[];this.N.push({id:X.g.E,J:new D(1,0),qa:[]},{id:X.g.jb,J:new D(0,-1),qa:[]},{id:X.g.lb,J:new D(-1,0),qa:[]},{id:X.g.za,J:new D(0,1),qa:[]},{id:X.g.NONE,J:new D(0,0),qa:[]})}static get j(){return new X}}function Fa(a,b){return Math.pow(b[0]-a[0],2)+Math.pow(b[2]-a[2],2)}
function Ta(a){0>a?a=a%(2*Math.PI)+2*Math.PI:a>2*Math.PI&&(a%=2*Math.PI);return a}function jb(){var a=X.g.za-1;var b=Math.ceil(0);a=Math.floor(a);return Math.floor(Math.random()*(a-b+1))+b}function Y(a){a=a.length;var b=Math.ceil(0);a=Math.floor(a);return Math.floor(Math.random()*(a-b))+b};class kb extends W{g(a){return new lb(a.position,a.direction)}}class mb extends W{g(a){return new nb(a.l,a.start,a.end,a.o,a.G)}}class ob extends W{g(a){return new pb(a.m,a.start,a.end,a.B,a.G,a.W)}}class lb{constructor(a,b){this.position=a?new D(a.x,a.z):new D(0,0);this.direction=b?b:X.g.NONE}reset(){this.direction=X.g.NONE;this.position.x=0;this.position.z=0}set(a){C(this.position,a.position);this.direction=a.direction}}
class nb{static get g(){return{fb:1,Ra:2,Pa:4,kb:8}}constructor(a,b,c,d,e){this.l=a;this.start=new D(b.x,b.z);this.end=isNaN(c)?new D(c.x,c.z):c;this.G=e;if(d)for(this.o=[],a=0;a<d.length-1;a++)this.o.push(T(this.G,{position:d[a].position,direction:d[a].direction}));else this.o=[],this.o.push(T(this.G,{position:b,direction:X.g.NONE}));this.sa=this.Ja=!1}reset(){cb(this.G,this.o);this.o.length=0;this.sa=this.Ja=!1}set(a){C(this.start,a.start);isNaN(a.end)?C(this.end,a.end):this.end=a.end;this.l=a.l;
if(a.o)for(let b=0;b<a.o.length-1;b++)this.o.push(T(this.G,{position:a.o[b].position,direction:a.o[b].direction}));else this.o.push(T(this.G,{position:a.start,direction:X.g.NONE}))}}
class pb{constructor(a,b,c,d,e,f){this.m=a;this.G=e;this.W=f;this.g=new ib(a.C,a.F);d?this.B=d:(this.B=[],this.B.push(T(this.W,{l:a,start:b,end:c,o:null,G:this.G})))}process(){let a=0,b=0,c=!1;let d=!1,e=isNaN(this.B[0].end)?!1:!0,f=this.B[0].end;if(!e&&this.B[0].start.compare(f))d=!0;else{do{if(this.B[a].Ja||this.B[a].sa)a<this.B.length-1?a++:d?(a=0,d=!1):c=!0;else{a:{var g=this.B[a];var h=this.g;let n=g.o[g.o.length-1];var l=0,k=new D(0,0);n.direction!==X.g.NONE&&(l=n.direction);for(var p=l;p<X.g.za;p++){l=
g.l.$.N[p];var m=n.position,q=l.J;C(k,new D(m.x+q.x,m.z+q.z));if(m=k.x<g.l.C&&0<=k.x&&k.z<g.l.F&&0<=k.z)if(m=!g.l.l[k.x][k.z].filled){m=!1;for(q=0;q<g.o.length;q++)if(g.o[q].position.x===k.x&&g.o[q].position.z===k.z){m=!0;break}m=!m}if(m){p=!1;isNaN(g.end)&&k.compare(g.end)&&(p=!0);if(p){n.direction=l.id;g.Ja=!0;g.o.push(T(g.G,{position:k,direction:X.g.NONE}));g=nb.g.Ra;break a}p=nb.g.Pa;h.l[k.x][k.z]?g.sa=!0:h.l[k.x][k.z]=!0;n.direction=l.id;g.o.push(T(g.G,{position:k,direction:X.g.NONE}));g=p;break a}}g.sa=
!0;g=nb.g.fb}g===nb.g.Pa?(this.B.push(T(this.W,{l:this.m,start:this.B[a].start,end:this.B[a].end,o:this.B[a].o,G:this.G})),a++,d||(d=!0)):g===nb.g.kb?d||(d=!0):g===nb.g.Ra&&(b=a,c=!0,d||(d=!0))}e&&this.B[a].o.length===f&&(b=a,c=!0)}while(!c)}return{vb:d,Ia:b}}set(a){this.m=a.m;this.B.push(T(this.W,{l:this.m,start:a.start,end:a.end,o:null,G:this.G}));this.m.C!==this.g.C||this.m.F!==this.g.F?this.g=new ib(this.m.C,this.m.F):hb(this.g)}reset(){cb(this.W,this.B);this.B.length=0}};function qb(a,b){let c=a.findIndex(d=>d.x===b.x&&d.z===b.z);0<=c&&a.splice(c,1)}
function rb(a,b,c){let d=[],e=[];for(var f=3;f<a.m.C-2-2;f++)for(let g=3;g<a.m.F-2-2;g++)d.push(new D(f,g));for(f=g=>{e.push(new D(g.x,g.z));for(let h=g.x-1;h<g.x+1;h++)for(let l=g.z-1;l<g.z+1;l++)qb(d,new D(h,l))};0<b&&0<d.length;){let g=d[Y(d)];0===e.length?(f(g),b--):e.some(h=>{if(6>Math.abs(g.x-h.x)&&6>Math.abs(g.z-h.z))return!0})?qb(d,g):(f(g),b--)}e.forEach(g=>{for(let h=g.x-1;h<g.x+1+1;h++)for(let l=g.z-1;l<g.z+1+1;l++){let k=a.m.l[h][l];k.filled=!0;k.rb=!1;k.ia.forEach((p,m)=>{k.ia[m]=!1});
qb(c,new D(h,l))}});return e}function sb(a,b){let c=new D(0,0),d=!0;for(let e=0;e<a.m.$.N.length-1;e++)if(c.x=a.m.$.N[e].J.x+b.x,c.z=a.m.$.N[e].J.z+b.z,0<=c.x&&c.x<a.m.C&&0<=c.z&&c.z<a.m.F&&!a.m.l[c.x][c.z].filled){d=!1;break}return d}
function tb(a,b,c,d=0){a.m=new gb(b,c);let e=[];b=[];let f=[];for(c=0;c<a.m.C;c++)for(var g=0;g<a.m.F;g++)e.push(new D(c,g));d=rb(a,d,e);g=e[Y(e)];c=C(new D,g);g=e[Y(e)];g=C(new D,g);let h=!1;do{let l=T(a.j,{m:a.m,start:c,end:g,B:null,G:a.G,W:a.W}),k=l.process();if(k.vb){let p=X.g.NONE;l.B[k.Ia].o.forEach(m=>{let q=a.m.l[m.position.x][m.position.z];m.direction!==X.g.NONE&&(q.ia[m.direction-1]=!1);if(p!==X.g.NONE){let n=a.m.$.N[p-1].J,r=a.m.$.N.findIndex(w=>w.J.x===-1*n.x&&w.J.z===-1*n.z);q.ia[r]=
!1}p=m.direction;q.filled=!0;qb(e,m.position);f.push(new D(m.position.x,m.position.z))});if(0<e.length){do C(c,f[Y(f)]),qb(f,c);while(sb(a,c));b=[...e];C(g,b[Y(b)]);qb(b,g)}else h=!0}else{if(!(0<b.length)){do C(c,f[Y(f)]),qb(f,c);while(sb(a,c));b=[...e]}C(g,b[Y(b)]);qb(b,g)}U(a.j,l)}while(!h);a.g.length=0;d.forEach(l=>{let k=a.m.$.N[jb()].J,p=a.m.$.N.findIndex(n=>n.J.x===-1*k.x&&n.J.z===-1*k.z),m=2*k.x,q=2*k.z;a.g.push(new D(l.x+m,l.z+q));a.m.l[l.x+m][l.z+q].ia[p]=!1});return a.m}
class ub{constructor(a,b,c){this.G=a;this.W=b;this.j=c;this.m=null;this.g=[]}};class Z extends Ba{static get g(){return{Oa:2821972,ya:11214693,ea:16732009,P:16775160,Qa:16744770,Sa:16767557,la:3369180,ma:4843500}}constructor(){super();this.Va={ta:"ArrowUp",wa:"ArrowLeft",xa:"ArrowRight",forward:"KeyW",pa:"KeyS",left:"KeyA",right:"KeyD",na:"ShiftLeft"};let a=Object.values(this.Va);a.push("ArrowDown");window.addEventListener("keydown",function(e){-1<a.indexOf(e.code)&&e.preventDefault()},!1);let b=new vb(this),c=new wb(this),d=new xb(this);B(this,b);b.j();b.s();b.g.addListener(this,
()=>{this.removeChild(b);B(this,c);c.j()});d.g.addListener(this,()=>{this.removeChild(d);B(this,b);b.s()});c.g.addListener(this,e=>{this.removeChild(c);e?(B(this,d),d.s()):(B(this,b),b.s())})}}class yb{constructor(){this.Ta=100;this.size=25;this.ob=10;this.Ua=20;this.tb=40}}
class vb extends Q{constructor(a){super(a);this.update=()=>{if(!p&&-2>k.u[0]){this.i.D.position=[-2,0,-6.5];this.i.D.target=[-this.i.M,0,this.i.M];let m=Math.atan2(l.u[2]-a.D.position[2],l.u[0]-a.D.position[0]);this.i.D.target=[Math.cos(m)*this.i.M,0,Math.sin(m)*this.i.M];Sa(this.i.D);k.position[0]-=2;k.speed.x*=.8;p=!0}};this.j=()=>{g.reset(!1);h.reset(!1);f=0;k.position=[...c];l.position=[...e];k.speed.x=0;a.V.ja=null;p=!1};this.s=()=>{a.I.length=0;a.I[0]=b[0];this.i.D.position=[-2,0,-.5];this.i.D.target=
[this.i.M,0,this.i.M];Sa(this.i.D);C(k.speed,d);g.reset(!0);a.V.ja=()=>{0<f&&(this.j(),P(this.g))}};let b="Distress signal detected from;deep space research station vdg26e;Last contact at sd15.78.94:10:56.;All the robots have turned evil;Navigate to sector ks937d and dock with station;Eliminate all hostile robots;Rescue all hostages".split(";"),c=[0,0,0],d=new D(-.5,0),e=[-15,0,0],f=0,g=new eb(3);g.g=()=>{f++;f<b.length?(a.I[0]=b[f],g.reset(!0)):h.reset(!0)};g.reset(!0);let h=new eb(4);a.oa.push(g,
h);h.g=()=>{this.j();P(this.g)};this.g=new Qa(this);let l=new zb(a);B(a,l,this);let k=new Ab(a);B(a,k,this);let p=!1}}
class xb extends Q{constructor(a){super(a);this.update=()=>{0<f.u[0]&&(this.j(),P(this.g))};this.j=()=>{f.position=[...b];e.position=[...d];f.speed.x=0};this.s=()=>{a.I.length=0;a.I[0]="Great job, mission complete!";a.D.position=[-2,0,-.5];let g=Math.atan2(e.u[2]-a.D.position[2],e.u[0]-a.D.position[0]);this.i.D.target=[Math.cos(g)*this.i.M,0,Math.sin(g)*this.i.M];Sa(this.i.D);C(f.speed,c)};let b=[-11,0,0],c=new D(1,0),d=[-15,0,0],e=new zb(a);B(a,e,this);let f=new Ab(a);f.rotation=Math.PI;B(a,f,this);
this.g=new Qa(this);this.j()}}
class Ab extends Q{constructor(a){super(a,[0,0,0]);let b=new Q(a,[.03125,0,0],new O(a.h,[.25,.125,.125],z(Z.g.P))),c=new Q(a,[-.125,0,0],new O(a.h,[.0625,.09375,.09375],z(Z.g.la))),d=new Q(a,[.09375,0,.09375],new O(a.h,[.125,.0625,.0625],z(Z.g.ea))),e=new Q(a,[.09375,0,-.09375],new O(a.h,[.125,.0625,.0625],z(Z.g.ea))),f=new Q(a,[.09375,0,.15625],new O(a.h,[.09375,.0125,.0625],z(Z.g.P))),g=new Q(a,[.09375,0,-.15625],new O(a.h,[.09375,.0125,.0625],z(Z.g.P))),h=new Q(a,[.109375,.0625,.125],new O(a.h,
[.09375,.0625,.0125],z(Z.g.P))),l=new Q(a,[.109375,.0625,-.125],new O(a.h,[.09375,.0625,.0125],z(Z.g.P)));H(a,[b,c,d,e,f,g,h,l],this)}}
class zb extends Q{constructor(a){super(a,[0,0,0]);var b=.2*1.5;let c=new Q(a,[0,0,0],new O(a.h,[7.5,1.5,7.5],z(Z.g.Qa))),d=new Q(a,[0,1.5,0],new O(a.h,[2.25,1.5,2.25],z(Z.g.ya))),e=new Q(a,[0,-1.5,0],new O(a.h,[2.25,1.5,2.25],z(Z.g.ya))),f=new Q(a,[0,4.5,0],new O(a.h,[.75,4.5,.75],z(Z.g.la))),g=new Q(a,[0,-4.5,0],new O(a.h,[.75,4.5,.75],z(Z.g.la)));b=new Q(a,[3.75,0,0],new O(a.h,[b,b,.75],z(Z.g.Oa)));H(a,[c,d,e,f,g,b],this)}}
class wb extends Q{constructor(a){super(a);this.j=()=>{var L=b[0];S=!1;a.I.length=0;a.I.push("Hostages: ",0," Robots: ",0," Health: ",0);var x=tb(h,L.size,L.size,L.ob);x=c(x,3);let I=[];x.forEach((v,F,J)=>{v.filled||I.push(new D(F,J))});var u=Y(I),A=I[u];I.splice(u,1);n=T(k,{i:a,position:[A.x,0,A.z]});for(let v=A.x-5;v<A.x+5;v++)for(let F=A.z-5;F<A.z+5;F++)u=I.findIndex(J=>J.x===v&&J.z===F),0<=u&&I.splice(u,1);B(a,n,this);n.mb(x);a.I[5]=Math.round(100*n.K);n.O.addListener(this,(v,F)=>{F.constructor===
Za&&(v.K-=F.Ca,0>=Math.round(100*v.K)&&(N=!0),a.I[5]=Math.round(100*v.K))});t=T(q,{i:a,position:[0,0,0],Na:Bb,pb:Cb,Y:n,L:x});Ua(t);B(a,t,this);a.Ma=t;Wa(t);E=new Q(a,[x.C/2,-.5,x.F/2],new O(a.h,[x.C,1,x.F],z(Z.g.Oa)));E.Ba=!0;M=new Q(a,[x.C/2,2.5,x.F/2],new O(a.h,[x.C,1,x.F],z(Z.g.ea)));M.Ba=!0;H(a,[E,M],this);Ma(a.v,n);a.I[3]=L.Ta;for(A=0;A<L.Ta;A++){u=Y(I);let v=T(l,{i:a,position:[0,0,0],end:I[u],L:x,ub:5,Wa:n});r.push(v);B(a,v,this);Ma(a.v,v);v.navigate();I.splice(u,1);v.Ha.addListener(this,F=>
{Na(a.v,F)});v.Fa.addListener(this,F=>{a.removeChild(F);r.splice(r.findIndex(J=>J===F),1);U(l,F);a.I[3]=r.length;0===r.length&&0===w.length&&(N=S=!0)})}a.I[1]=L.Ua;for(x=0;x<L.Ua;x++)A=Y(I),u=I[A],u=T(p,{i:a,position:[u.x,0,u.z]}),w.push(u),u.O.addListener(this,(v,F)=>{F.constructor===Xa&&(U(p,v),a.removeChild(v),w.splice(w.findIndex(J=>J===v),1),Na(a.v,v),a.I[1]=w.length,0===w.length&&0===r.length&&(N=S=!0))}),B(a,u,this),Ma(a.v,u),I.splice(A,1);for(x=0;x<L.tb;x++)A=Y(I),u=I[A],u=T(m,{i:a,position:[u.x,
0,u.z]}),y.push(u),u.O.addListener(this,(v,F)=>{F.constructor===Xa&&(U(m,v),a.removeChild(v),y.splice(y.findIndex(J=>J===v),1),Na(a.v,v),n.K+=v.qb,1<n.K&&(n.K=1),a.I[5]=Math.round(100*n.K))}),B(a,u,this),Ma(a.v,u),I.splice(A,1)};let b=[new yb],c=(L,x=1)=>{let I=new gb(L.C*(x+1)+1,L.F*(x+1)+1);L.l.forEach((u,A)=>{u.forEach((v,F)=>{v.ia.forEach((J,G)=>{if(J){J=h.m.$.N[G].J;G=(x+1)*A+(1+x/2);let K=(x+1)*F+(1+x/2),R=G-((x+1)*A+1);for(let V=-R-1;V<R+1;V++)I.l[G+V*(1-Math.abs(J.x))+J.x*(R+Math.abs(Math.min(J.x,
0)))][K+V*(1-Math.abs(J.z))+J.z*(R+Math.abs(Math.min(J.z,0)))].filled=!0}})})});return I},d=new kb,e=new mb,f=new ob,g=new Pa(a);a.v=g;let h=new ub(d,e,f),l=new Db,k=new Eb,p=new Fb,m=new Gb,q=new db,n=null,r=[],w=[],y=[],t=null;a.I.length=0;let E=null,M=null,N=!1,S=!1;this.g=new Qa(this);this.update=()=>{N&&(N=!1,U(q,t),a.removeChild(t),t=null,U(k,n),Na(a.v,n),a.removeChild(n),n=null,cb(l,r),Oa(a.v,r),za(a,r),r.length=0,cb(p,w),Oa(a.v,w),za(a,w),w.length=0,cb(m,y),Oa(a.v,y),za(a,y),y.length=0,a.removeChild(E),
a.removeChild(M),M=E=null,P(this.g,S))}}}function Hb(a){let b=(c,d)=>{let e=a.i.Va;e.right===c&&(a.j.right=d);e.left===c&&(a.j.left=d);e.forward===c&&(a.j.forward=d);e.pa===c&&(a.j.pa=d);e.ta===c&&(a.j.ta=d);e.na===c&&(a.j.na=d);e.wa===c&&(a.j.wa=d);e.xa===c&&(a.j.xa=d)};a.i.V.ja=c=>{b(c.code,!0)};a.i.V.va=c=>{b(c.code,!1)}}
class Xa extends Q{static get A(){return 2}constructor(a,b){super(a,b);this.mb=g=>{var h=new X;f=T(e,{m:g,start:this.H,end:10,B:null,G:c,W:d});g=f.process();h=h.N[f.B[g.Ia].o[1].direction-1].J;this.g.rotation=Math.atan2(h.x,h.z);this.i.D.target=[Math.sin(this.g.rotation)*this.i.M,1,Math.cos(this.g.rotation)*this.i.M];U(e,f);f=null;this.size=[.9,.9]};this.j={left:!1,right:!1,forward:!1,pa:!1,ta:!1,na:!1,wa:!1,xa:!1};this.da=Math.PI/1.6;this.ba=Bb.A+Ib.A+Za.A+Jb.A+Kb.A;this.g=new Q(a,[0,0,0],new O(a.h,
[.2,.5,4],z(Z.g.ma)));B(a,this.g,this);this.aa=new Lb;this.X=new eb(.5);a.oa.push(this.X);this.X.g=()=>{this.R=!0};this.R=!0;let c=new kb,d=new mb,e=new ob,f=null;this.s=[];Hb(this)}set(a){super.set(a);Hb(this)}reset(){super.reset();this.X.reset(!1);this.R=!0;cb(this.aa,this.s);za(this.i,this.s);Oa(this.i.v,this.s);this.s.length=0;this.O.g.length=0;this.i.V.ja=null;this.i.V.va=null;Object.keys(this.j).forEach(a=>{this.j[a]=!1})}update(){this.g.ca=0;this.speed.x=0;this.speed.z=0;this.j.right?(this.speed.x=
3*Math.sin(this.g.rotation-Math.PI/2),this.speed.z=3*Math.cos(this.g.rotation-Math.PI/2)):this.j.left&&(this.speed.x=3*Math.sin(this.g.rotation+Math.PI/2),this.speed.z=3*Math.cos(this.g.rotation+Math.PI/2));this.j.wa?this.g.ca=this.da:this.j.xa&&(this.g.ca=-this.da);if(this.j.forward){var a=this.j.na?6:3;this.speed.x+=Math.sin(this.g.rotation)*a;this.speed.z+=Math.cos(this.g.rotation)*a}else this.j.pa&&(a=this.j.na?6:3,this.speed.x+=Math.sin(this.g.rotation)*-a,this.speed.z+=Math.cos(this.g.rotation)*
-a);this.j.ta&&this.R&&(a=T(this.aa,{i:this.i,position:[...this.u]}),this.s.push(a),a.position[0]+=2*Math.sin(this.g.rotation),a.position[1]=.5,a.position[2]+=2*Math.cos(this.g.rotation),B(this.i,a,this.parent),a.speed.x=8*Math.sin(this.g.rotation),a.speed.z=8*Math.cos(this.g.rotation),a.rotation=this.g.rotation,Ma(this.i.v,a),a.O.addListener(a,b=>{U(this.aa,b);Na(this.i.v,b);this.i.removeChild(b);this.s.splice(this.s.findIndex(c=>b===c),1)}),this.R=!1,this.X.reset(!0));this.i.D.position=[this.position[0],
1,this.position[2]];this.i.D.target=[Math.sin(this.g.rotation)*this.i.M,1,Math.cos(this.g.rotation)*this.i.M];Sa(this.i.D)}}
class Ib extends Q{static get A(){return 4}constructor(a,b,c,d,e,f){super(a,b);let g=new kb,h=new mb,l=new ob,k=!1,p=z(Z.g.P),m=z(Z.g.ea);this.size=[.9,.9];let q=new Q(a,[0,.3,0],new O(a.h,[.9,.6,.9],z(Z.g.P))),n=new Q(a,[0,.9,0],new O(a.h,[.6,.6,.6],z(Z.g.la)));H(a,[q,n],this);n.ca=Math.PI;this.O.addListener(this,(G,K)=>{K.constructor===Ya&&(q.ha.color=m,w.reset(!0),this.K-=K.Ca,0>=Math.round(10*this.K)&&(q.speed.x=10,n.speed.x=-10,t.reset(!0),P(this.Ha,this)))});let r=[],w=new eb(.2);w.g=()=>{q.ha.color=
p};let y=new eb(2),t=new eb(.15);a.oa.push(y,w,t);let E=new D(0,0);y.g=()=>{M=!0};let M=!0,N=new Mb;this.Ha=new Qa(this);this.Fa=new Qa(this);t.g=()=>{P(this.Fa,this)};let S=c,L=d,x=null;this.set=G=>{super.set(G);S=G.end;L=G.L;A=0;v=null;k=!1;f=G.Wa;I()};this.reset=()=>{super.reset();w.reset(!1);y.reset(!1);t.reset(!1);this.Ha.g.length=0;this.Fa.g.length=0;M=!0;q.speed.x=0;n.speed.x=0;q.position[0]=0;n.position[0]=0;q.ha.color=z(Z.g.P);cb(N,r);za(a,r);Oa(a.v,r);r.length=0};let I=()=>{C(E,S);x=T(l,
{m:L,start:E,end:e,B:null,G:g,W:h});let G=x.process();u=JSON.parse(JSON.stringify(x.B[G.Ia]));u.end=new D(u.o[u.o.length-1].position.x,u.o[u.o.length-1].position.z);U(l,x);F=u.o[A].position;this.position[0]=F.x;this.position[2]=F.z};this.update=()=>{if(100>Fa(this.u,f.u)&&M){let G=T(N,{i:this.i,position:[this.u[0],.9,this.u[2]]});r.push(G);let K=Math.atan2(f.u[0]-this.u[0],f.u[2]-this.u[2]);G.speed.x=6*Math.sin(K);G.speed.z=6*Math.cos(K);G.rotation=K;Ma(a.v,G);B(a,G,this.parent);G.O.addListener(G,
R=>{U(N,R);Na(a.v,R);a.removeChild(R);r.splice(r.findIndex(V=>V===R),1)});M=!1;y.reset(!0)}};this.navigate=()=>{let G=!1,K=J.N[u.o[A].direction-1].J;v!==K&&(this.position[0]=this.H.x,this.position[2]=this.H.z);k?(this.speed.x=1.5*-K.x,this.speed.z=1.5*-K.z,0===A?(A=-1,k=!1):v=K):(this.speed.x=1.5*K.x,this.speed.z=1.5*K.z,0===K.x&&0===K.z?(k=!0,A--,G=!0):v=K);return G};this.Ga.addListener(this,()=>{k?A--:A++;this.navigate()&&this.navigate()});let u=null,A=0,v=null,F=null,J=new X;I();this.ba=Xa.A+Ya.A}}
class Jb extends Q{static get A(){return 32}constructor(a,b){super(a,b);this.size=[.5,.5];this.La=!1;b=new Q(a,[-.1,.24,0],new O(a.h,[.1,.48,.1],z(Z.g.ma)));let c=new Q(a,[.1,.24,0],new O(a.h,[.1,.48,.1],z(Z.g.ma))),d=new Q(a,[0,.72,0],new O(a.h,[.3,.48,.1],z(Z.g.la))),e=new Q(a,[0,1.08,0],new O(a.h,[.15,.24,.1],z(Z.g.Sa))),f=new Q(a,[-.2,.96-.3,0],new O(a.h,[.1,.6,.1],z(Z.g.ma))),g=new Q(a,[.2,.96-.3,0],new O(a.h,[.1,.6,.1],z(Z.g.ma)));H(a,[b,c,d,e,f,g],this);this.ca=Math.PI/4;this.ba=Xa.A}reset(){super.reset();
this.O.g.length=0}}class Kb extends Q{static get A(){return 32}constructor(a,b){super(a,b);this.size=[.5,.5];b=new Q(a,[0,.25,0],new O(a.h,[.3,.1,.2],z(Z.g.P)));let c=new Q(a,[0,.25,0],new O(a.h,[.1,.3,.2],z(Z.g.P))),d=new Q(a,[0,.25,0],new O(a.h,[.5,.5,.1],z(Z.g.ea)));H(a,[b,c,d],this);this.ca=Math.PI/4;this.ba=Xa.A;this.qb=.25}reset(){super.reset();this.O.g.length=0}}
class Nb extends Q{constructor(a,b,c){super(a,b,new O(a.h,[.25,.25,.5],c));this.size=[.25,.5];this.Ca=1/3}reset(){super.reset();this.O.g.length=0}}class Ya extends Nb{static get A(){return 8}constructor(a,b){super(a,b,z(Z.g.ea));this.ba=Bb.A+Ib.A}}class Za extends Nb{static get A(){return 16}constructor(a,b){super(a,b,z(Z.g.Sa));this.ba=Bb.A+Xa.A;this.Ca=1/6}}class Lb extends W{g(a){return new Ya(a.i,a.position)}}class Mb extends W{g(a){return new Za(a.i,a.position)}}
class Db extends W{g(a){return new Ib(a.i,a.position,a.end,a.L,a.ub,a.Wa)}}class Eb extends W{g(a){return new Xa(a.i,a.position)}}class Fb extends W{g(a){return new Jb(a.i,a.position)}}class Gb extends W{g(a){return new Kb(a.i,a.position)}}class Bb extends bb{static get A(){return 1}Aa(){let a=new Q(this.i,[0,1,0],new O(this.i.h,[1,2,1],z(Z.g.Qa)));new O(this.i.h,[1.05,2/9,1.05],z(Z.g.P));H(this.i,[a],this)}}
class Cb extends bb{Aa(){let a=new Q(this.i,[0,.00625,0],new O(this.i.h,[.9,.0125,.9],z(Z.g.ya)));H(this.i,[a],this)}}new Z;
