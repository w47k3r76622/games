"use strict";!function(){var t=document.getElementsByClassName("alert-box-container")[0];function s(e){var t=document.createElement("div");return t.innerText=e,t.classList.add("card"),t.dataset.data=e,t}document.body.addEventListener("click",function(e){var t=document.getElementsByClassName("how-to-play")[0];e.target===document.getElementsByClassName("instruction-toggle")[0]||e.target===t||function(e,t){for(var n=t.parentNode;null!=n;){if(n==e)return!0;n=n.parentNode}return!1}(t,e.target)||(document.getElementsByClassName("how-to-play-container")[0].style.display="none")}),document.getElementsByClassName("instruction-toggle")[0].addEventListener("click",function(e){this===e.target&&(document.getElementsByClassName("how-to-play-container")[0].style.display="flex")}),document.getElementsByClassName("play-button")[0].addEventListener("click",function(e){this===e.target&&(document.getElementsByClassName("how-to-play-container")[0].style.display="none")}),document.getElementsByClassName("ok-button")[0].addEventListener("click",function(){t.style.display="none"});var r=0,o=[2,4,8,16,32,64],i={src:[]};function m(e){var t=Math.floor(6*Math.random()+0),n=new s(o[t]),a=document.getElementById("card-"+e+"-container");a.insertBefore(n,a.firstChild),i[e].unshift(n)}function u(e){document.getElementsByClassName("alert-message")[0].innerText=e,t.style.display="block"}window.onload=function(){!function(){localStorage.getItem("instruction")||(document.getElementsByClassName("how-to-play-container")[0].style.display="flex");var e=document.getElementById("myViewport"),t="width=device-width, initial-scale="+((window.outerWidth/452).toFixed(2)-.02).toFixed(2)+", maximum-scale=1.0, user-scalable=no";e.setAttribute("content",t),m("src"),m("src"),document.getElementById("high-score").innerText=localStorage.getItem("high-score")?localStorage.getItem("high-score"):0,localStorage.setItem("instruction",!0)}()};for(var g=Array(4).fill(-1),y=Array(4).fill(!1),e=document.getElementsByClassName("slot"),n=0;n<e.length;n++)e[n].addEventListener("click",a);var h=!1;function a(){if(!h){var e=i.src[i.src.length-1],t=e.getBoundingClientRect(),n=1<this.children.length&&this.children[this.children.length-1];if(y[parseInt(this.dataset.index)-1]&&e.dataset.data!==n.dataset.data)u("Current slot is filled");else{h=!0;var a=i.src.pop(),s=a.cloneNode(!0),o=a.getBoundingClientRect(),l=n?n.getBoundingClientRect():this.getBoundingClientRect();a.classList.add("card-in-slot"),a.style.top=g[parseInt(this.dataset.index)-1]+"px",g[parseInt(this.dataset.index)-1]+=30,a.style.opacity="0",p(s,o,l,a,this);var d=i.src[0];p(d.cloneNode(!0),d.getBoundingClientRect(),t,d,this,!0),this.appendChild(a);var c=this;setTimeout(function(){!function(e){for(var t=e.children,n=1,a=t.length-1;0<a;a--){var s=t[a],o=t[a-1];if(s.dataset.data===o.dataset.data){o.dataset.data=parseInt(s.dataset.data)+parseInt(o.dataset.data),r=r?r+parseInt(o.dataset.data)*n:parseInt(o.dataset.data),n++,o.innerText=o.dataset.data,e.removeChild(s),g[parseInt(e.dataset.index)-1]-=30,a<e.children.length-1&&a++,B(document.getElementById("score"),r,1e3);var l=localStorage.getItem("high-score")?localStorage.getItem("high-score"):0;l<r&&(B(document.getElementById("high-score"),r,1e3),f||(f=!0,document.getElementsByClassName("high-score")[0].classList.add("high-score-animation"),document.getElementById("card-dest-container").classList.add("shadow"),document.getElementById("card-src-container").classList.add("shadow"),document.body.style.background="#000",document.getElementById("card-src-container").style.background="#212121",document.getElementById("card-dest-container").style.background="#212121",document.getElementById("score").style.color="#fff",document.getElementsByClassName("highest-score")[0].style.color="#fff",setTimeout(function(){document.getElementById("card-dest-container").classList.remove("shadow"),document.getElementById("card-src-container").classList.remove("shadow"),document.body.style.background="#eeeeee",document.getElementById("card-src-container").style.background="#ffffff",document.getElementById("card-dest-container").style.background="#ffffff",document.getElementsByClassName("high-score")[0].classList.remove("high-score-animation"),document.getElementById("score").style.color="#000",document.getElementsByClassName("highest-score")[0].style.color="#000"},3e3)),localStorage.setItem("high-score",r))}}8<e.children.length?y[parseInt(e.dataset.index)-1]=!0:y[parseInt(e.dataset.index)-1]=!1;if(d=!0,y.forEach(function(e){d=d&&e}),d)return u("Game Over"),E();var d;h=!1}(c)},1200),m("src")}}}document.getElementById("score").innerText=r;var f=!1;document.getElementById("discard").addEventListener("click",function(){if(l<2){var e=i.src.pop(),t=window.getComputedStyle(e,null).getPropertyValue("background-color"),n=e.cloneNode(!0),a=document.getElementById("discard");p(n,e.getBoundingClientRect(),a.getBoundingClientRect(),e,null,!0),document.getElementById("card-src-container").removeChild(e),m("src"),l++,document.querySelector(".discard-count").innerHTML=l,setTimeout(function(){document.getElementsByClassName("slot-"+l)[0].style.background=t,document.getElementsByClassName("slot-"+l)[0].style.color="white"},1500)}else u("No more cards can be discarded")});var l=0;function p(e,t,n,a,s,o){e.classList.add("fake-node"),document.body.appendChild(e),e.style.left=t.x+"px",e.style.top=t.y+"px",e.style.margin="0",setTimeout(function(){e.style.left=n.x+"px",o?(e.style.top=n.y+"px",a.style.opacity="0"):s.children.length<3?(e.style.top=n.y+1+"px",e.style.left=n.x+2+"px"):e.style.top=n.y+30+"px"},10),setTimeout(function(){e.style.display="none",a.style.opacity="1",o||(a.style.left="0px")},1100)}function E(){for(var e=document.getElementsByClassName("slot"),t=0;t<e.length;t++){for(;e[t].firstChild;)e[t].removeChild(e[t].firstChild);e[t].innerHTML='<div class="slot-inner"><div class="hand hand-art"></div></div>'}l=0,h=!1,y=Array(4).fill(!1),g=Array(4).fill(-1),r=0,document.getElementById("score").innerText=r,document.getElementsByClassName("slot-1")[0].style.background="#e0e0e0",document.getElementsByClassName("slot-2")[0].style.background="#e0e0e0",document.getElementsByClassName("slot-1")[0].style.color="black",document.getElementsByClassName("slot-2")[0].style.color="black",f=!1}var B=function(e,t,n){var a=parseInt(e.innerHTML);if(!(t<=a)){var s=n/50,o=parseInt((t-a)/50,10)+1,l=setInterval(function(){t<=(a+=o)?(e.innerHTML=t,clearInterval(l)):e.innerHTML=a},s);setTimeout(function(){},n)}};document.getElementById("reload").addEventListener("click",E)}();