!function(){function t(t){this.map=new MapManager,this.map.SetMap(t),this.mapPw=this.map.MapSize().width-64,this.mapPh=this.map.MapSize().height-64,this.maxEnemy=8,this.clock,this.decider=0,this.badguys=new ObjectPool,this.mainTitle=new Title(this.map.ScreenSize()),this.mainTitle.enabled=!0,this.player=new Player(640,64,32,32,{up:"playeru",down:"playerd"},"playerd",{l:8,r:23,t:10,b:31}),this.player.enabled=!1,this.wifi=new WiFi(this.mapPw,this.mapPh),this.gameInfo=new Info(this.map.ScreenSize()),this.gameInfo.enabled=!1,this.player.mob=new Device(this.map.ScreenSize(),this.map.MapSize()),this.decider=Util.Rnd(120,240),input.onKeyUp(function(t){if(this.Asset.player.enabled)"B"==t&&this.Asset.player.txt(),"RET"==t&&this.Asset.player.mob.send()&&this.Asset.wifi.reset(),"SPACE"==t&&this.Asset.player.mob.enter();else if("B"==t&&(2==this.Asset.mainTitle.screen?this.Asset.mainTitle.screen=0:this.Asset.mainTitle.screen++,2==this.Asset.mainTitle.screen)){this.Asset.player.start(640,64),this.Asset.gameInfo.enabled=!0,this.Asset.mainTitle.enabled=!1,this.Asset.wifi.enabled=!0,this.Asset.wifi.reset(),this.Asset.maxEnemy=8;for(var i=this.Asset.badguys.Get(),e=0;e<i.length;e++)i[e].enabled=i[e].visible;this.Asset.clock=new Date}"ESC"==t&&this.Asset.gameOver()})}t.prototype={GetAbsHitBox:function(t,i,e){return{x:t+e.l,y:i+e.t,width:Math.abs(e.r)-Math.abs(e.l),height:Math.abs(e.b)-Math.abs(e.t)}},RectHit:function(t,i){return t.x<i.x+i.width&&t.x+t.width>i.x&&t.y<i.y+i.height&&t.height+t.y>i.y},IsTouching:function(t,i){var e={l:!1,r:!1,t:!1,b:!1};return e.l=t.x<i.x+i.width&&t.x>i.x&&t.y+1<i.y+i.height&&t.height+t.y-1>i.y,e.r=t.x+t.width<i.x+i.width&&t.x+t.width>i.x&&t.y+1<i.y+i.height&&t.height+t.y-1>i.y,e.t=t.y<i.y+i.height&&t.y>i.y&&t.x+1<i.x+i.width&&t.x+t.width-1>i.x,e.b=t.y+t.height<i.y+i.height&&t.y+t.height>i.y&&t.x+1<i.x+i.width&&t.x+t.width-1>i.x,e},CheckTouching:function(t,i){t.touching={l:!1,r:!1,t:!1,b:!1};for(var e=0;e<i.length;e++)if(i[e]!=t){var s=this.IsTouching(this.GetAbsHitBox(t.x,t.y,t.sideBox()),this.GetAbsHitBox(i[e].x,i[e].y,i[e].hitBox()));t.touching.l=1==s.l||t.touching.l,t.touching.r=1==s.r||t.touching.r,t.touching.t=1==s.t||t.touching.t,t.touching.b=1==s.b||t.touching.b}},CheckCollisions:function(t,i){for(var e=0;e<i.length;e++)if(i[e]!=t&&this.RectHit(this.GetAbsHitBox(t.x+t.dx,t.y+t.dy,t.hitBox()),this.GetAbsHitBox(i[e].x+i[e].dx,i[e].y+i[e].dy,i[e].hitBox()))){var s=!1,h=!1;0!=t.dx&&this.RectHit(this.GetAbsHitBox(t.x+t.dx,t.y,t.hitBox()),this.GetAbsHitBox(i[e].x+i[e].dx,i[e].y+i[e].dy,i[e].hitBox()))&&(s=!0),0!=t.dy&&this.RectHit(this.GetAbsHitBox(t.x,t.y+t.dy,t.hitBox()),this.GetAbsHitBox(i[e].x+i[e].dx,i[e].y+i[e].dy,i[e].hitBox()))&&(h=!0),t.dx=1==s?t.dx=0:t.dx,t.dy=1==h?t.dy=0:t.dy}return s||h},decisions:function(){if(this.badguys.Count()<this.maxEnemy){for(var t,i,e=this.badguys.Get(),s=[],h=0;h<e.length;h++)s.push(e[h]);s.push(this.player);for(var a=new Enemy(0,0,32,32,[{up:"shopru",down:"shoprd"},{up:"trollu",down:"trolld"},{up:"hateru",down:"haterd"}],"shoprd",{l:8,r:23,t:10,b:31});a.x=Util.Rnd(32,this.mapPw),a.y=Util.Rnd(32,this.mapPh),t=this.map.IsVisible(a),i=this.CheckCollisions(a,s),t||i||this.map.mapCollision(a,!0););a.set(this.player,this.wifi,{wt:this.mapPw,ht:this.mapPh},0==Util.Rnd(0,4)?Const.actors.hater:Const.actors.troll),this.badguys.Add(a)}this.decider=Util.Rnd(120,240)},gameOver:function(){this.maxEnemy=8,this.player.stop(),this.gameInfo.enabled=!1,this.mainTitle.pscore=this.player.score(),this.mainTitle.enabled=!0},update:function(t){--this.decider<0&&this.decisions();for(var i=this.badguys.Get(),e=[],s=[],h=0;h<i.length;h++)e.push(i[h]),s.push(i[h]);this.player.enabled&&(this.CheckTouching(this.player,s),s.push(this.player));for(var a=0;a<i.length;a++)this.CheckTouching(i[a],s);this.player.enabled&&(this.player.logic(t),this.map.mapCollision(this.player,!1),this.CheckCollisions(this.player,i),e.push(this.player));for(a=0;a<i.length;a++)i[a].logic(t),this.map.mapCollision(i[a],!1)&&i[a].reset(),this.CheckCollisions(i[a],e);this.map.ScrollTo(this.player.x,this.player.y);var n=this.map.ScrollOffset();this.player.update(t,n),this.player.strength=this.wifi.InRange(this.player,!0),!this.wifi.active&&0<this.player.strength&&(this.wifi.active=!0);for(a=0;a<i.length;a++)i[a].visible=this.map.IsVisible(i[a]),i[a].update(t,n),this.wifi.active&&this.wifi.InRange(i[a],!1);var r=(new Date-this.clock)/1e3;this.wifi.CheckSignal(),this.gameInfo.update(this.player.strength,this.player.score(),r),this.player.mob.update(this.player,this.wifi.users),this.maxEnemy=parseInt(r/14)+16,300<r&&this.gameOver()},render:function(){var t=this.badguys.Get();this.map.Render(0),this.player.enabled&&this.player.render();for(var i=0;i<t.length;i++)t[i].render();this.map.Render(1),this.gameInfo.render(),this.player.mob.render(),this.mainTitle.render()}},window.Watashi=t}();