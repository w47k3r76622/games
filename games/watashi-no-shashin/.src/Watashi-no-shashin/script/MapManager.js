var MapManager=function(){var x={set:null,dimensions:{width:0,height:0},tile:{width:32,height:32},screen:{width:0,height:0},colliders:{hit:[],over:[]},data:[]},s=0,l=0,y={x:0,y:0,xoffset:0,yoffset:0};function n(t){return Math.floor(t/x.tile.width)}function o(t){return Math.floor(t/x.tile.height)}function h(t,e){var i,h;return x.data[(i=t,h=e,n(i)+o(h)*x.dimensions.width)]}function c(t,e,i){return(e-t)*i+t}function r(t){return-1!=x.colliders.hit.indexOf(t)}return{Hit:function(t,e){return r(h(t,e))},MapSize:function(){return{width:x.dimensions.width*x.tile.width,height:x.dimensions.height*x.tile.height}},ScreenSize:function(){return{width:x.screen.width*x.tile.width,height:x.screen.height*x.tile.height}},SetMap:function(t){x=t},Hpoint:function(t){return n(t)},Vpoint:function(t){return o(t)},Content:function(t,e){return h(t,e)},IsVisible:function(t){var e=t.x,i=t.x+t.width,h=t.y,n=t.y+t.height,o={x:y.xoffset*x.tile.width-y.x,y:y.yoffset*x.tile.height-y.y};return o.x<i&&e<o.x+x.screen.width*x.tile.width&&o.y<n&&h<o.y+x.screen.height*x.tile.height},mapCollision:function(t,e){var i=!1;return e||0<t.dx?(r(h(t.x+t.dx+t.hitBox().r,t.y+t.hitBox().t))||r(h(t.x+t.dx+t.hitBox().r,t.y+t.hitBox().b)))&&(i=!(t.dx=0)):(e||t.dx<0)&&(r(h(t.x+t.dx+t.hitBox().l,t.y+t.hitBox().t))||r(h(t.x+t.dx+t.hitBox().l,t.y+t.hitBox().b)))&&(i=!(t.dx=0)),e||0<t.dy?(r(h(t.x+t.hitBox().l,t.y+t.dy+t.hitBox().b))||r(h(t.x+t.hitBox().r,t.y+t.dy+t.hitBox().b)))&&(i=!(t.dy=0)):(e||t.dy<0)&&(r(h(t.x+t.hitBox().l,t.y+t.dy+t.hitBox().t))||r(h(t.x+t.hitBox().r,t.y+t.dy+t.hitBox().t)))&&(i=!(t.dy=0)),i},ScrollOffset:function(){return{x:y.xoffset*x.tile.width-y.x,y:y.yoffset*x.tile.height-y.y}},ScrollTo:function(t,e){var i=x.screen.width*x.tile.width/2,h=x.screen.height*x.tile.height/2,n=x.dimensions.width*x.tile.width-x.screen.width*x.tile.width,o=x.dimensions.height*x.tile.height-x.screen.height*x.tile.height,r=y.xoffset*x.tile.width-y.x,f=y.yoffset*x.tile.height-y.y,d=c(r,t-i,.04),s=c(f,e-h,.04);0<d&&d<n&&(y.x=-d%x.tile.width,y.xoffset=parseInt(d/x.tile.width)),0<s&&s<o&&(y.y=-s%x.tile.height,y.yoffset=parseInt(s/x.tile.height))},Scroll:function(t,e){var i=x.tile.width,h=x.tile.height,n=x.dimensions.width-x.screen.width-1,o=x.dimensions.height-x.screen.height-1;(0<t&&(0<y.xoffset||0==y.xoffset&&y.x+t<0)||t<0&&(y.xoffset<n||y.xoffset==n&&y.x+t>=-i))&&(y.x+=t,y.x<-i&&(y.x+=i,y.xoffset++),0<y.x&&(y.x-=i,y.xoffset--)),(0<e&&(0<y.yoffset||0==y.yoffset&&y.y+e<0)||e<0&&(y.yoffset<o||y.yoffset==o&&y.y+e>=-h))&&(y.y+=e,y.y<-h&&(y.y+=h,y.yoffset++),0<y.y&&(y.y-=h,y.yoffset--))},Render:function(t){!function(t){var e,i=0,h=!0,n=x.dimensions.width,o=x.screen.width+1,r=x.screen.height+1;Renderer.SetContext(1,1);for(var f=0;f<r;f++)for(var d=0;d<o;d++)i=(f+y.yoffset)*n+(d+y.xoffset),e=x.data[i],0==t?(-1!=x.colliders.over.indexOf(e)&&(e-=4),h=!0):h=-1!=x.colliders.over.indexOf(e),1==h&&Renderer.RawTile(d*x.tile.width+y.x+s,f*x.tile.height+y.y+l,x.set+e)}(t)}}};