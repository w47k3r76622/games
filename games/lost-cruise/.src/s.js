function SfxrParams(){this.setSettings=function(t){for(var i=0;i<24;i++)this[String.fromCharCode(97+i)]=t[i]||0;this.c<.01&&(this.c=.01);var e=this.b+this.c+this.e;if(e<.18){var s=.18/e;this.b*=s,this.c*=s,this.e*=s}}}function SfxrSynth(){this._params=new SfxrParams;var t,i,e,s,a,h,o,l,r,n,c,d;this.reset=function(){var t=this._params;s=100/(t.f*t.f+.001),a=100/(t.g*t.g+.001),h=1-t.h*t.h*t.h*.01,o=-t.i*t.i*t.i*1e-6,t.a||(c=.5-t.n/2,d=5e-5*-t.o),l=1+t.l*t.l*(t.l>0?-.9:10),r=0,n=1==t.m?0:(1-t.m)*(1-t.m)*2e4+32},this.totalReset=function(){this.reset();var s=this._params;return t=s.b*s.b*1e5,i=s.c*s.c*1e5,e=s.e*s.e*1e5+12,3*((t+i+e)/3|0)},this.synthWave=function(u,y){var w=this._params,f=1!=w.s||w.v,p=w.v*w.v*.1,x=1+3e-4*w.w,v=w.s*w.s*w.s*.1,m=1+1e-4*w.t,g=1!=w.s,F=w.x*w.x,G=w.g,b=w.q||w.r,k=w.r*w.r*w.r*.2,C=w.q*w.q*(w.q<0?-1020:1020),S=w.p?32+((1-w.p)*(1-w.p)*2e4|0):0,P=w.d,R=w.j/2,W=w.k*w.k*.01,M=w.a,T=t,B=1/t,L=1/i,A=1/e,N=5/(1+w.u*w.u*20)*(.01+v);N>.8&&(N=.8),N=1-N;for(var D,H,I,O,E,U,$=!1,q=0,K=0,_=0,j=0,X=0,V=0,Y=0,z=0,J=0,Q=0,Z=new Array(1024),tt=new Array(32),it=Z.length;it--;)Z[it]=0;for(it=tt.length;it--;)tt[it]=2*Math.random()-1;for(it=0;it<y;it++){if($)return it;if(S&&++J>=S&&(J=0,this.reset()),n&&++r>=n&&(n=0,s*=l),h+=o,(s*=h)>a&&(s=a,G>0&&($=!0)),H=s,R>0&&(Q+=W,H*=1+Math.sin(Q)*R),(H|=0)<8&&(H=8),M||((c+=d)<0?c=0:c>.5&&(c=.5)),++K>T)switch(K=0,++q){case 1:T=i;break;case 2:T=e}switch(q){case 0:_=K*B;break;case 1:_=1+2*(1-K*L)*P;break;case 2:_=1-K*A;break;case 3:_=0,$=!0}b&&((I=0|(C+=k))<0?I=-I:I>1023&&(I=1023)),f&&x&&((p*=x)<1e-5?p=1e-5:p>.1&&(p=.1)),U=0;for(var et=8;et--;){if(++Y>=H&&(Y%=H,3==M))for(var st=tt.length;st--;)tt[st]=2*Math.random()-1;switch(M){case 0:E=Y/H<c?.5:-.5;break;case 1:E=1-Y/H*2;break;case 2:E=.225*(((E=1.27323954*(O=6.28318531*((O=Y/H)>.5?O-1:O))+.405284735*O*O*(O<0?1:-1))<0?-1:1)*E*E-E)+E;break;case 3:E=tt[Math.abs(32*Y/H|0)]}f&&(D=V,(v*=m)<0?v=0:v>.1&&(v=.1),g?(X+=(E-V)*v,X*=N):(V=E,X=0),j+=(V+=X)-D,E=j*=1-p),b&&(Z[z%1024]=E,E+=Z[(z-I+1024)%1024],z++),U+=E}U*=.125*_*F,u[it]=U>=1?32767:U<=-1?-32768:32767*U|0}return y}}function onKeyDown(t){keys[t.keyCode]=!0}function onKeyUp(t){keys[t.keyCode]=!1}function randomNumber(t,i){return Math.floor(Math.random()*(i-t+1))+t}function playAudio(t){var i=jsfxr(t),e=new Audio;e.src=i,e.play()}function $(t){return D.querySelector(t)}function Bullet(){this.alive=!1,this.width=50,this.height=12}function Wall(t){t=t||{},this.isMovementHappening=t.isMovementHappening||!1,this.shiftDelta=t.isMovementHappening?0:250,this.x=t.x||WallsController.decideWallXPosition(this.shiftDelta),this.y=t.y||randomNumber(0,GameFactory.viewPortHeight),this.width=t.width||25,this.height=t.height||25,this.showPortal=!1,this.portalColor=colors[randomNumber(0,colors.length-1)],this.color="#ffffff",this.alive=!0,this.chanceOfRecovery=Math.random(),this.isLost=GameFactory.isLost||!1,this.scored=!1}function Ship(){this.x=10,this.y=10,this.vx=0,this.vy=0,this.defaultSpeed=4,this.speed=6,this.friction=.95,this.width=96,this.height=40,this.bullets=[],this.counter=0,this.fireRate=15,this.isLost=!1}function Background(){this.width=GameFactory.viewPortWidth,this.height=GameFactory.viewPortHeight,this.color="#2d72da",this.isLost=!1}function CollisionManager(){}function runFPS(){GameFactory.update(),GameFactory.paint(),requestAnimationFrame(runFPS)}function bootstrap(){"INTRO"!==GameFactory.state&&(GameFactory.addShip(),GameFactory.addWalls(),GameFactory.background.paint(),GameFactory.ship.paint(),GameFactory.paintWalls(),GameFactory.validateWalls(),GameFactory.initCollisionManager())}function initEngine(){(canvas=D.createElement("canvas")).width=GameFactory.viewPortWidth,canvas.height=GameFactory.viewPortHeight,D.body.appendChild(canvas),GameFactory.addCanvas($("canvas")),GameFactory.addBackground(),GameFactory.introScreen(),bootstrap(),runFPS()}var synth=new SfxrSynth;window.jsfxr=function(t){synth._params.setSettings(t);var i=synth.totalReset(),e=new Uint8Array(4*((i+1)/2|0)+44),s=2*synth.synthWave(new Uint16Array(e.buffer,44),i),a=new Uint32Array(e.buffer,0,44);a[0]=1179011410,a[1]=s+36,a[2]=1163280727,a[3]=544501094,a[4]=16,a[5]=65537,a[6]=44100,a[7]=88200,a[8]=1048578,a[9]=1635017060,a[10]=s,s+=44;for(var h=0,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l="data:audio/wav;base64,";h<s;h+=3){var r=e[h]<<16|e[h+1]<<8|e[h+2];l+=o[r>>18]+o[r>>12&63]+o[r>>6&63]+o[63&r]}return l};var keys={};addEventListener("keydown",onKeyDown),addEventListener("keyup",onKeyUp);var D=document;Bullet.prototype.init=function(t,i,e){this.x=t,this.y=i,this.speed=e,this.alive=!0},Bullet.prototype.paint=function(){var t;GameFactory.isLost?t=$("#bl"):this.alive&&(t=$("#b")),ctx.drawImage(t,this.x,this.y,this.width,this.height)},Bullet.prototype.update=function(){this.x+this.width>canvas.width||this.y+this.height>canvas.height?this.alive=!1:this.alive&&(this.x+=this.speed)};var colors=["black","#18FF6D"];Wall.prototype.paint=function(){var t,i;this.hide||(GameFactory.isLost?this.showPortal&&this.chanceOfRecovery>.5?(t="white",i=$("#pw")):(t="black",i=$("#pb")):this.showPortal?(t=this.portalColor,i=$("black"===this.portalColor?"#pb":"#po")):t=this.color,GameFactory.ship.x>canvas.width/2&&(this.x=this.x-10),this.showPortal?ctx.drawImage(i,this.x,this.y,25,40):(ctx.beginPath(),ctx.fillStyle=t,ctx.fillRect(this.x,this.y,this.width/2,this.height/4),ctx.fillRect(this.x+this.width/2,this.y,this.width/2,this.height/4),ctx.fillRect(this.x,this.y+this.height/4,this.width/3,this.height/4),ctx.fillRect(this.x+this.width/3,this.y+this.height/4,this.width/3,this.height/4),ctx.fillRect(this.x+2*this.width/3,this.y+this.height/4,this.width/3,this.height/4),ctx.fillRect(this.x,this.y+this.height/2,this.width/2,this.height/4),ctx.fillRect(this.x+this.width/2,this.y+this.height/2,this.width/2,this.height/4),ctx.fillRect(this.x,this.y+3*this.height/4,this.width/3,this.height/4),ctx.fillRect(this.x+this.width/3,this.y+3*this.height/4,this.width/3,this.height/4),ctx.fillRect(this.x+2*this.width/3,this.y+3*this.height/4,this.width/3,this.height/4),ctx.fill(),ctx.closePath()))},Ship.prototype.paintBullets=function(){for(var t=0;t<this.bullets.length;t++)this.bullets[t].alive?this.bullets[t].paint():this.bullets.splice(t,1)},Ship.prototype.updateBullets=function(){for(var t=0;t<this.bullets.length;t++)this.bullets[t].update()},Ship.prototype.paint=function(){var t;t=$(GameFactory.isLost?"#sl":"#s"),ctx.drawImage(t,this.x,this.y,this.width,this.height),this.paintBullets()},Ship.prototype.fireBullets=function(){var t=new Bullet;playAudio([1,,.2703,.2778,.1181,.8566,.2754,-.272,,,,,,.1877,.1543,,,,1,,,,,.5]),t.init(this.x+this.width,this.y+this.height/2,20),this.bullets.push(t)},Ship.prototype.update=function(){this.counter++,keys[37]&&GameFactory.reverseMode&&this.vx>-this.speed&&this.vx--,keys[38]&&this.vy>-this.speed&&this.vy--,keys[39]&&this.vx<this.speed&&this.vx++,keys[40]&&this.vy<this.speed&&this.vy++,keys[32]&&this.counter>=this.fireRate&&(this.fireBullets(),this.counter=0),this.vy*=this.friction,this.y+=this.vy,this.vx*=this.friction,this.x+=this.vx,this.x>canvas.width/2||(this.x+=this.defaultSpeed),this.updateBullets()},Background.prototype.paint=function(){GameFactory.isLost?ctx.fillStyle="black":ctx.fillStyle=this.color,ctx.fillRect(0,0,this.width,this.height),ctx.fill()};var GameFactory={addCanvas:function(t){canvas=t,this.addCtx()},addCtx:function(){ctx=canvas.getContext("2d")},addBackground:function(){this.background=new Background},addShip:function(){this.ship=new Ship},addWalls:function(){for(var t=0;t<20;t++)this.walls=this.walls||[],this.walls.push(new Wall)},paintWalls:function(){for(var t=0;t<this.walls.length;t++)this.walls[t].paint()},update:function(){"INTRO"!==this.state&&GameFactory.ship.update()},paint:function(){"INTRO"===this.state&&keys[13]&&(this.state="RUNNING",bootstrap()),"RUNNING"===this.state&&(this.background.paint(),this.ship.paint(),this.paintWalls(),this.collisionManager.wallBulletCollision(),this.collisionManager.shipWallCollision(),this.validateWalls())},initCollisionManager:function(){this.collisionManager=new CollisionManager},checkWallCount:function(){for(var t=0;t<this.walls.length;t++)this.walls[t].alive||this.walls.splice(t,1);this.walls.length<20&&this.walls.push(new Wall({isMovementHappening:!0}))},validateWalls:function(){for(var t=0;t<this.walls.length;t++)this.walls[t].x<0?(this.walls[t].alive=!1,this.checkWallCount()):this.walls[t].x<50&&this.checkWallCount()},setLostMode:function(){this.isLost=!0,this.ship.isLost=!0;for(var t=0;t<this.walls.length;t++)this.walls[t].isLost=!0},undoPortalMode:function(){this.isLost=!1,this.ship.isLost=!1;for(var t=0;t<this.walls.length;t++)this.walls[t].isLost=!1},activateReverseMode:function(){var t=this;t.reverseMode=!0,setTimeout(function(){t.reverseMode=!1},5e3)},state:"RUNNING",score:0,introScreen:function(){var t,i=ctx.createRadialGradient(this.viewPortWidth/2,this.viewPortHeight/2,10,this.viewPortWidth/2,this.viewPortHeight/2,500);i.addColorStop(0,"#02b0ea"),i.addColorStop(1,"#2d72da"),ctx.fillStyle=i,ctx.fillRect(0,0,this.viewPortWidth,this.viewPortHeight),this.state="INTRO",ctx.font="96px p",ctx.fillStyle="#8AC926";var e="Lost Cruise";t=ctx.measureText(e).width,ctx.fillText(e,canvas.width/2-t/2,100),ctx.fillStyle="#FFCA3A",ctx.font="20px p",e="How to play:",ctx.fillText(e,canvas.width/2-ctx.measureText(e).width/2,150),e="Right Arrow to Accelerate",ctx.fillText(e,canvas.width/2-ctx.measureText(e).width/2,200),e="Left Arrow to Slow Down(Disabled)",ctx.fillText(e,canvas.width/2-ctx.measureText(e).width/2,250),e="Up Arrow to Bubble Up",ctx.fillText(e,canvas.width/2-ctx.measureText(e).width/2,300),e="Down Arrow to Sink",ctx.fillText(e,canvas.width/2-ctx.measureText(e).width/2,350),e="Space Button shoots bullets",ctx.fillText(e,canvas.width/2-ctx.measureText(e).width/2,400),ctx.fillStyle="#D64933",ctx.font="30px p",e="Break Walls To Find Portals!",ctx.fillText(e,canvas.width/2-ctx.measureText(e).width/2,450),e="Black Portal reveals the LOST WORLD :D",ctx.fillText(e,canvas.width/2-ctx.measureText(e).width/2,500),e="Green Portal allows the use of magical left arrow to ease the game :P",ctx.fillText(e,canvas.width/2-ctx.measureText(e).width/2,550),e="ENTER Key starts the game, BEGIN!",ctx.fillText(e,canvas.width/2-ctx.measureText(e).width/2,600),ctx.fill()},viewPortWidth:innerWidth,viewPortHeight:innerHeight};CollisionManager.prototype.rectanglesCollide=function(t,i){return t.x<i.x+i.width&&t.x+t.width>i.x&&t.y<i.y+i.height&&t.height+t.y>i.y},CollisionManager.prototype.wallBulletCollision=function(){for(var t=0;t<GameFactory.walls.length;t++)if(!GameFactory.walls[t].showPortal&&!GameFactory.walls[t].hide)for(var i=0;i<GameFactory.ship.bullets.length;i++){var e=GameFactory.ship.bullets[i];if(e.alive){var s=GameFactory.walls[t];this.rectanglesCollide(e,s)&&(s.showPortal=!0,GameFactory.walls[t].scored||(GameFactory.walls[t].scored=!0,GameFactory.score++))}}},CollisionManager.prototype.shipWallCollision=function(){for(var t=0;t<GameFactory.walls.length;t++)GameFactory.walls[t].hide||(GameFactory.walls[t].showPortal?this.rectanglesCollide(GameFactory.ship,GameFactory.walls[t])&&(GameFactory.isLost&&GameFactory.walls[t].chanceOfRecovery>.5?(playAudio([0,,.0712,,.4461,.2341,,.4116,,,,,,.5762,,.4397,,,1,,,,,.5]),GameFactory.undoPortalMode(),GameFactory.walls[t].hide=!0):"black"===GameFactory.walls[t].portalColor?(playAudio([1,,.3881,,.4212,.2738,,.3543,,,,,,,,.6422,,,1,,,,,.5]),GameFactory.setLostMode(),GameFactory.walls[t].hide=!0):(playAudio([0,,.0389,.5667,.3495,.4261,,,,,,.5479,.5348,,,,,,1,,,,,.5]),GameFactory.activateReverseMode(),GameFactory.walls[t].hide=!0)):this.rectanglesCollide(GameFactory.ship,GameFactory.walls[t])&&(GameFactory.state="GAME_OVER",playAudio([3,,.3742,.7757,.3575,.1445,,-.0568,,,,,,,,.3485,.0426,-.134,1,,,,,.61]),setTimeout(function(){alert("Game Over! Your score is: "+GameFactory.score),location.reload(!0)},250)))};var WallsController={decideWallXPosition:function(t){return randomNumber(GameFactory.ship.x+GameFactory.ship.width+t,GameFactory.viewPortWidth)}},ctx,canvas;D.body.onload=initEngine;