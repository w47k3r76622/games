var kontra=function(){"use strict";let t,i,e={};function n(t,...i){e[t]&&e[t].map(t=>t(...i))}function h(){return t}function s(){return i}const o=()=>{};function r(){let t=h();s().clearRect(0,0,t.width,t.height)}let a={},c={},d={13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"};function u(t){let i=d[t.which];c[i]=!0,a[i]&&a[i](t)}function l(t){c[d[t.which]]=!1}function y(){c={}}class m{constructor(t=0,i=0){this._x=t,this._y=i}add(t,i=1){return g(this.x+(t.x||0)*i,this.y+(t.y||0)*i,this)}clamp(t,i,e,n){this._c=!0,this._a=t,this._b=i,this._d=e,this._e=n}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?Math.min(Math.max(this._a,t),this._d):t}set y(t){this._y=this._c?Math.min(Math.max(this._b,t),this._e):t}}function g(t,i,e={}){let n=new m(t,i);return e._c&&(n.clamp(e._a,e._b,e._d,e._e),n.x=t,n.y=i),n}g.prototype=m.prototype,g.class=m;class x{constructor(t){this.init(t)}init(t={}){let{x:i,y:e,dx:n,dy:h,ddx:o,ddy:r,width:a,height:c,image:d}=t;this.position=g(i,e),this.velocity=g(n,h),this.acceleration=g(o,r),this.width=this.height=this.rotation=0,this.ttl=1/0,this.anchor={x:0,y:0},this.context=s();for(let i in t)this[i]=t[i];d&&(this.width=void 0!==a?a:d.width,this.height=void 0!==c?c:d.height),this.sx=0,this.sy=0}get x(){return this.position.x}get y(){return this.position.y}get dx(){return this.velocity.x}get dy(){return this.velocity.y}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}get animations(){return this._a}get viewX(){return this.x-this.sx}get viewY(){return this.y-this.sy}set x(t){this.position.x=t}set y(t){this.position.y=t}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}set animations(t){let i,e;for(i in this._a={},t)this._a[i]=t[i].clone(),e=e||this._a[i];this.currentAnimation=e,this.width=this.width||e.width,this.height=this.height||e.height}set viewX(t){}set viewY(t){}isAlive(){return this.ttl>0}collidesWith(t){if(this.rotation||t.rotation)return null;let i=this.x-this.width*this.anchor.x,e=this.y-this.height*this.anchor.y,n=t.x,h=t.y;return t.anchor&&(n-=t.width*t.anchor.x,h-=t.height*t.anchor.y),i<n+t.width&&i+this.width>n&&e<h+t.height&&e+this.height>h}update(t){this.advance(t)}render(){this.draw()}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){this.velocity=this.velocity.add(this.acceleration,t),this.position=this.position.add(this.velocity,t),this.ttl--,this.currentAnimation&&this.currentAnimation.update(t)}draw(){let t=-this.width*this.anchor.x,i=-this.height*this.anchor.y;this.context.save(),this.context.translate(this.viewX,this.viewY),this.width<0&&this.context.scale(-1,1),this.rotation&&this.context.rotate(this.rotation),this.image?this.context.drawImage(this.image,0,0,this.image.width,this.image.height,t,i,this.width,this.height):this.currentAnimation?this.currentAnimation.render({x:t,y:i,width:this.width,height:this.height,context:this.context}):(this.context.fillStyle=this.color,this.context.fillRect(t,i,this.width,this.height)),this.context.restore()}}function p(t){return new x(t)}return p.prototype=x.prototype,p.class=x,{init:function(e){if(!(t=document.getElementById(e)||e||document.querySelector("canvas")))throw Error("You must provide a canvas element for the game");return(i=t.getContext("2d")).imageSmoothingEnabled=!1,n("init"),{canvas:t,context:i}},getCanvas:h,getContext:s,on:function(t,i){e[t]=e[t]||[],e[t].push(i)},off:function(t,i){let n;!e[t]||(n=e[t].indexOf(i))<0||e[t].splice(n,1)},emit:n,GameLoop:function({fps:t=60,clearCanvas:i=!0,update:e,render:h}={}){if(!e||!h)throw Error("You must provide update() and render() functions");let s,a,c,d,u,l=0,y=1e3/t,m=1/t,g=i?r:o;function x(){if(a=requestAnimationFrame(x),c=performance.now(),d=c-s,s=c,!(d>1e3)){for(n("tick"),l+=d;l>=y;)u.update(m),l-=y;g(),u.render()}}return u={update:e,render:h,isStopped:!0,start(){s=performance.now(),this.isStopped=!1,requestAnimationFrame(x)},stop(){this.isStopped=!0,cancelAnimationFrame(a)},_frame:x,set _last(t){s=t}}},keyMap:d,initKeys:function(){let t;for(t=0;t<26;t++)d[65+t]=(10+t).toString(36);for(t=0;t<10;t++)d[48+t]=""+t;window.addEventListener("keydown",u),window.addEventListener("keyup",l),window.addEventListener("blur",y)},bindKeys:function(t,i){[].concat(t).map(t=>a[t]=i)},unbindKeys:function(t){[].concat(t).map(t=>a[t]=0)},keyPressed:function(t){return!!c[t]},Sprite:p,setStoreItem:function(t,i){void 0===i?localStorage.removeItem(t):localStorage.setItem(t,JSON.stringify(i))},getStoreItem:function(t){let i=localStorage.getItem(t);try{i=JSON.parse(i)}catch(t){}return i}}}();