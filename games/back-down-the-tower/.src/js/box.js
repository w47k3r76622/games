function anyDirTrue(t){return Object.keys(t).map(function(e){return t[e]}).some(t=>t)}class Game{constructor(){this.resetGame()}resetGame(){this.start=!1,this.maxFloor=7,this.floor=7,this.floorStarted=!1,this.win=!1,this.state="menu",this.enemiesKilled=0,this.timer=0,this.swordHealth=0,this.loaded=!1}updateTimer(){this.timer+=1/3600}getTimeMin(){return("0"+Math.floor(this.timer)).slice(-2)}getTimeSec(){return("0"+Math.floor(60*this.timer)%60).slice(-2)}}class Allpieces{constructor(){this.pieces={}}addPiece(t){t.spriteKey in this.pieces||(this.pieces[t.spriteKey]=t)}removePiece(t){t in this.pieces&&delete this.pieces[t]}getPiece(t){return t in this.pieces?this.pieces[t]:null}updatePiece(t,e){t in this.pieces&&t===e.spriteKey&&(this.pieces[t]=e)}updateAllButHero(){for(let t in this.pieces)this.pieces[t]instanceof Hero||this.pieces[t].sprite.update()}updateAll(){for(let t in this.pieces)this.pieces[t].sprite.update(),this.pieces[t].resetStopMove()}renderAll(){for(let t in this.pieces)this.pieces[t].renderMe&&this.pieces[t].sprite.render()}getByType(t){let e={};for(let i in this.pieces){let s=this.pieces[i];s.type===t&&(e[i]=s)}return e}purgePieces(){for(let t in this.pieces)this.pieces[t].destroyMe&&delete this.pieces[t]}clearPieces(t=!1){for(let e in this.pieces)("hero"!==e||t)&&delete this.pieces[e]}}class Gamepiece{constructor(t,e,i){this.sprite=i,this.spriteKey=t,this.type=e,this.destroyMe=!1,this.renderMe=!0,this.health=0,this.sprite.dLeft=0,this.sprite.dRight=0,this.sprite.dUp=0,this.sprite.dDown=0,this.sprite.stopMove={left:!1,right:!1,down:!1,up:!1}}getSpriteBoundaries(){let t=this.sprite;return{top:t.y-t.height*t.anchor.y,left:t.x-t.width*t.anchor.x,bottom:t.y-t.height*t.anchor.y+t.height*(1-t.anchor.y),right:t.x-t.width*t.anchor.x+t.width*(1-t.anchor.x)}}contactedOnWith(t){let e=this.getSpriteBoundaries(),i=t.getSpriteBoundaries();return{up:e.bottom===i.top&&e.left<i.right&&e.right>i.left,down:e.top===i.bottom&&e.left<i.right&&e.right>i.left,left:e.right===i.left&&e.top<i.bottom&&e.bottom>i.top,right:e.left===i.right&&e.top<i.bottom&&e.bottom>i.top}}resetStopMove(){this.sprite.stopMove={left:!1,right:!1,down:!1,up:!1}}touchedOn(t){let e={right:!1,left:!1,up:!1,down:!1};for(let i in t){let s=t[i].contactedOnWith(this);for(let t in s)!1===e[t]&&!0===s[t]&&(e[t]=!0)}return e}setStopMove(t){for(let e in t)this.sprite.stopMove[e]=t[e]}getStopMove(){return this.sprite.stopMove}updateStopMove(t,e){for(let i in t)t[i]===e&&(this.sprite.stopMove[i]=t[i])}kill(){this.destroyMe=!0}addToPieces(t){t.addPiece(this)}}class Hero extends Gamepiece{constructor(t,e,i=10){super(t,"hero",e),this.health=i,this.itemCount=0,this.invulnerable=!1,this.invulnerableCounter=0,this.sprite.dLeft=-5,this.sprite.dRight=5,this.sprite.dUp=-5,this.sprite.dDown=5,this.sprite.moveAbility=!1,this.sprite.hasMovePiece=!1,this.sprite.update=this.spriteUpdate,this.sprite.direction="up",this.sprite.attack=!1,this.sprite.hasSword=!1,this.sprite.swordHealth=0}spriteUpdate(){this.moveAbility=!1,keyPressed("left")&&!this.stopMove.left&&this.x>0&&(this.x+=this.dLeft,this.direction="left",emit("melee",pieces)),keyPressed("right")&&!this.stopMove.right&&this.x<canvas.width-this.width&&(this.x+=this.dRight,this.direction="right",emit("melee",pieces)),keyPressed("up")&&!this.stopMove.up&&this.y>0&&(this.y+=this.dUp,this.direction="up",emit("melee",pieces)),keyPressed("down")&&!this.stopMove.down&&this.y<canvas.height-this.height&&(this.y+=this.dDown,this.direction="down",emit("melee",pieces)),keyPressed("z")&&(this.moveAbility=!0),keyPressed("a")&&this.hasSword&&(this.swordHealth<=1&&(this.hasSword=!1),this.attack=!this.attack,emit("melee",pieces))}setSpeed(t){this.sprite.dLeft=-t,this.sprite.dRight=t,this.sprite.dUp=-t,this.sprite.dDown=t}getMoveAbilityStatus(){return this.sprite.moveAbility}blinkEffect(t){this.invulnerable&&(this.invulnerableCounter>.5?(this.invulnerable=!1,this.invulnerableCounter=0,this.renderMe=!0,this.setSpeed(5)):(this.invulnerableCounter+=1/60,60*this.invulnerableCounter%t<t/2?this.renderMe=!1:this.renderMe=!0))}getStats(t){let e={};for(let i of t)i in this&&(e[i]=this[i]);return e}}class Move extends Gamepiece{constructor(t,e,i,s,h,r,p=Sprite({})){super(t,"move",p),this.sprite.x=e,this.sprite.y=i,this.sprite.width=s,this.sprite.height=h,this.sprite.color=r,this.sprite.enableMove=!1,this.sprite.update=this.spriteUpdate}spriteUpdate(){this.enableMove&&(keyPressed("left")&&!this.stopMove.left&&this.x>0&&(this.x+=this.dLeft),keyPressed("right")&&!this.stopMove.right&&this.x<canvas.width-this.width&&(this.x+=this.dRight),keyPressed("up")&&!this.stopMove.up&&this.y>0&&(this.y+=this.dUp),keyPressed("down")&&!this.stopMove.down&&this.y<canvas.height-this.height&&(this.y+=this.dDown))}setSpeed(t){this.sprite.dLeft=-t,this.sprite.dRight=t,this.sprite.dUp=-t,this.sprite.dDown=t}enableMovement(){this.sprite.enableMove=!0,this.setSpeed(5)}disableMovement(){this.sprite.enableMove=!1,this.setSpeed(0)}setSpeed(t){this.sprite.dLeft=-t,this.sprite.dRight=t,this.sprite.dUp=-t,this.sprite.dDown=t}}class FastGP extends Gamepiece{constructor(t,e,i,s,h,r,p,o=Sprite({})){super(t,e,o),this.sprite.x=i,this.sprite.y=s,this.sprite.width=h,this.sprite.height=r,this.sprite.color=p}}class Heart extends Gamepiece{constructor(t,e,i,s=Sprite({})){super(t,"item",s),this.itemType="heart",this.sprite.x=e,this.sprite.y=i,this.sprite.width=20,this.sprite.height=20;let h=new Image;h.src="assets/imgs/Heart.png",this.sprite.image=h}}class Tower extends Gamepiece{constructor(t,e,i,s,h=Sprite({})){super(t,e,h),this.sprite.x=i,this.sprite.y=s,this.sprite.width=60,this.sprite.height=60;let r=new Image;r.src="assets/imgs/TowerWall.png",this.sprite.image=r}}class Wall extends Gamepiece{constructor(t,e,i,s,h,r=Sprite({})){super(t,"wall",r),this.sprite.x=i,this.sprite.y=s,this.thickness=10,this.sprite.color="white","h"===e?(this.sprite.width=h,this.sprite.height=this.thickness):(this.sprite.width=this.thickness,this.sprite.height=h)}}class Stairs extends Gamepiece{constructor(t,e,i,s=Sprite({})){super(t,"stairs",s);let h=new Image;h.src="assets/imgs/Stairs.png",this.sprite.x=e,this.sprite.y=i,this.sprite.width=30,this.sprite.height=30,this.sprite.image=h}}class Sword extends Gamepiece{constructor(t,e,i,s,h=20,r=10,p=Sprite({})){super(t,e,p),this.sprite.x=i,this.sprite.y=s,this.sprite.width=r,this.sprite.height=h,this.sprite.color="white",this.renderTime=.5,this.sLength=h,this.sWidth=r}updateHealth(t){this.health=t}updatePosition({x:t,y:e,width:i,height:s,direction:h}){switch(h){case"up":this.sprite.x=t,this.sprite.y=e-s,this.sprite.width=this.sWidth,this.sprite.height=this.sLength;break;case"down":this.sprite.x=t,this.sprite.y=e+s,this.sprite.width=this.sWidth,this.sprite.height=this.sLength;break;case"right":this.sprite.x=t+i,this.sprite.y=e,this.sprite.width=this.sLength,this.sprite.height=this.sWidth;break;case"left":this.sprite.x=t-i,this.sprite.y=e,this.sprite.width=this.sLength,this.sprite.height=this.sWidth}}}class Enemy extends Gamepiece{constructor(t,e,i,s,h,r,p,o,n=100,d=1,a=Sprite({})){super(t,e,a),this.sprite.x=i,this.sprite.y=s,this.sprite.width=h,this.sprite.height=r,this.sprite.color=p,this.sprite.movement=o,this.sprite.positiveDirection=!0,this.sprite.delta=d,this.sprite.minHor=i-n,this.sprite.maxHor=i+n,this.sprite.minVer=s-n,this.sprite.maxVer=s+n,this.sprite.update=this.updateMovementTo(o)}updateMovementTo(t){switch(t){case"horizontal":return this.horizontalMovement;case"vertical":return this.verticalMovement}}horizontalMovement(){(this.x>=this.maxHor||this.x<=this.minHor||this.stopMove.left||this.stopMove.right)&&(this.positiveDirection=!this.positiveDirection),this.positiveDirection&&!this.stopMove.right&&(this.x+=this.delta),this.positiveDirection||this.stopMove.left||(this.x-=this.delta)}verticalMovement(){(this.y>=this.maxVer||this.y<=this.minVer||this.stopMove.down||this.stopMove.up)&&(this.positiveDirection=!this.positiveDirection),this.positiveDirection&&!this.stopMove.downt&&(this.y+=this.delta),this.positiveDirection||this.stopMove.up||(this.y-=this.delta)}}class SwordItem extends FastGP{constructor(t,e,i,s=Sprite({})){super(t,"item",s),this.sprite.itemType="sword",this.sprite.x=e,this.sprite.y=i,this.sprite.width=30,this.sprite.height=30;let h=new Image;h.src="assets/imgs/Sword.png",this.sprite.image=h}}