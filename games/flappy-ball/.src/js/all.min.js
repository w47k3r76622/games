function drawText(t,e,a){var o=[];t=t.toString();for(var r=0;r<t.length;r++){var n=letters[t.charAt(r)];n&&o.push(n)}a=a||{},ctx.fillStyle=a.color||"#A6E1FA";var i=a.size||gameCanvas.width/32,s=a.x||(gameCanvas.width-i*t.length*4)/2;for("PLAY"!==t&&"RESTART"!==t||(objectFactory.currentBtn={startX:s,startY:a.y||gameCanvas.height/4+e*i*4+40*e}),r=0;r<o.length;r++){n=o[r];for(var c=a.y||gameCanvas.height/4+e*i*4+40*e,l=0,h=0;h<n.length;h++){for(var d=n[h],g=0;g<d.length;g++)d[g]&&ctx.fillRect(s+g*i,c,i,i);l=Math.max(l,d.length*i),c+=i}s+=i+l}"PLAY"!==t&&"RESTART"!==t||(objectFactory.currentBtn.endX=s,objectFactory.currentBtn.endY=c)}function ExplodedBall(t,e,a,o){this.x=t,this.y=e,this.r=a,this.color=o,this.direction=2*Math.random()>1?1:-1,this.vx=~~(10*Math.random())*this.direction,this.vy=~~(15*Math.random()),this.draw=function(t){t.beginPath(),t.arc(this.x,this.y,this.r,0,2*Math.PI,!1),t.fillStyle=this.color,t.fill(),t.closePath()},this.update=function(){this.x+=this.vx,this.y+=this.vy,this.vx*=.99,this.vy*=.99,this.vy+=.25}}function H(){this.A=function(t){for(var e=0;24>e;e++)this[String.fromCharCode(97+e)]=t[e]||0;.01>this.c&&(this.c=.01),t=this.b+this.c+this.e,.18>t&&(t=.18/t,this.b*=t,this.c*=t,this.e*=t)}}function playSound(t){var e=new Audio;e.src=t,e.play()}function playScoreUp(){playSound(scoreUpSound)}function playExplosion(){playSound(explosionSound)}function playBallJump(){playSound(ballJumpSound)}function updateScore(){playScoreUp(),objectFactory.score+=1}function resetScore(){objectFactory.score=0}function detectCollision(){var t=objectFactory.ball;if(t)for(var e=0;e<objectFactory.rings.length;e++){var a=objectFactory.rings[e];if(a.isScoreMarked||t.y<a.y-a.r-a.lineWidth/2-t.r&&(a.isScoreMarked=!0,objectFactory.ball.changeColor()),t.y>=a.y-a.r-a.lineWidth/2-t.r&&t.y<=a.y-a.r+a.lineWidth/2+t.r)for(var o=Math.atan(t.r/a.r),r=0;r<possibleColors.length;r++){var n=a.startAngle+a.currentAngle+Math.PI/2*r,i=a.endAngle+a.currentAngle+Math.PI/2*r;n=n>2*Math.PI?n-2*Math.PI:n,i=i>2*Math.PI?i-2*Math.PI:i,n<=1.5*Math.PI-o&&i>=1.5*Math.PI+o&&possibleColors[r]!==t.color&&t.explode()}if(t.y<=a.y+a.r+a.lineWidth/2+t.r&&t.y>=a.y+a.r-a.lineWidth/2-t.r){o=Math.atan(t.r/a.r);for(var s=0;s<possibleColors.length;s++)n=a.startAngle+a.currentAngle+Math.PI/2*s,i=a.endAngle+a.currentAngle+Math.PI/2*s,n=n>2*Math.PI?n-2*Math.PI:n,i=i>2*Math.PI?i-2*Math.PI:i,n<=.5*Math.PI-o&&i>=.5*Math.PI+o&&possibleColors[s]!==t.color&&t.explode()}}}function clickEventHandler(){objectFactory.cursor.x>=objectFactory.currentBtn.startX&&objectFactory.cursor.x<=objectFactory.currentBtn.endX&&objectFactory.cursor.y>=objectFactory.currentBtn.startY&&objectFactory.cursor.y<=objectFactory.currentBtn.endY&&(keysDown={},objectFactory.rings=[],objectFactory.ball=new Ball(gameCanvas.width/2,gameCanvas.height<500?gameCanvas.height-20:gameCanvas.height-100),document.getElementsByTagName("canvas")[0].style.backgroundColor="#B2DBBF",resetScore(),objectFactory.gameState="playing",bindGamePlayingEvents())}function mouseMoveHandler(t){objectFactory.cursor.x=t.pageX-gameCanvas.offsetLeft,objectFactory.cursor.y=t.pageY-gameCanvas.offsetTop}function bindNotStartedGameEvents(){addEventListener("mousemove",mouseMoveHandler),addEventListener("click",clickEventHandler)}function onJumpBall(t){playBallJump(),"touchstart"===t.type&&(t.keyCode=32),keysDown[t.keyCode]=!0}function onGravitizeBall(t){"touchend"===t.type&&(t.keyCode=32),keysDown[t.keyCode]=!1}function bindGamePlayingEvents(){removeEventListener("mousemove",mouseMoveHandler),removeEventListener("click",clickEventHandler),addEventListener("keydown",onJumpBall),addEventListener("keyup",onGravitizeBall),addEventListener("touchstart",onJumpBall),addEventListener("touchend",onGravitizeBall)}function bindGameOverEvents(){removeEventListener("keydown",onJumpBall),removeEventListener("keyup",onGravitizeBall),removeEventListener("touchstart",onJumpBall),removeEventListener("touchend",onGravitizeBall),addEventListener("mousemove",mouseMoveHandler),addEventListener("click",clickEventHandler)}function Ball(t,e){this.x=t,this.y=e,this.r=10,this.vy=5,this.gravity=2.5,this.lineWidth=10,this.remove=!1,this.generateColor=function(){return possibleColors[Math.floor(Math.random()*possibleColors.length)]},this.color=this.generateColor(),this.draw=function(t){t.beginPath(),t.arc(this.x,this.y,this.r,0,2*Math.PI,!1),t.fillStyle=this.color,t.fill(),t.closePath()},this.onKeyPress=function(){keysDown[32]?(repositionRings(),this.y-=this.vy):this.y<gameCanvas.height-100&&(this.y+=this.gravity)},this.getNewBallColor=function(){var t=this.generateColor();t!=this.color?this.color=t:this.getNewBallColor()},this.changeColor=function(){updateScore(),this.getNewBallColor()},this.explode=function(){objectFactory.gameState="gameOver",objectFactory.previousScore=objectFactory.score,document.getElementsByTagName("canvas")[0].style.backgroundColor="black",bindGameOverEvents(),explodeBall(),playExplosion(),resetScore()}}function Ring(t,e,a){this.x=t,this.y=e,this.r=a,this.startAngle=0,this.endAngle=.5*Math.PI,this.lineWidth=10,this.currentAngle=0,this.isScoreMarked=!1,this.draw=function(t,e){for(var a=this.startAngle+this.currentAngle,o=this.endAngle+this.currentAngle,r=0,n=possibleColors.length;r<n;r++)t.beginPath(),t.arc(this.x,this.y,this.r,a+Math.PI/2*r,o+Math.PI/2*r,!1),t.strokeStyle=possibleColors[r],t.lineWidth=this.lineWidth,t.stroke();this.currentAngle+=e,this.currentAngle%=2*Math.PI}}function repositionRings(){if(objectFactory.ball.y<gameCanvas.height/2+100)for(var t=0;t<objectFactory.rings.length;t++)objectFactory.rings[t].y+=5}function appendMoreRings(){if(objectFactory.visibleBalls<3)for(var t=objectFactory.visibleBalls;t<3;t++){var e=Math.floor(70*Math.random())+50;objectFactory.rings.push(new Ring(gameCanvas.width/2,objectFactory.rings[objectFactory.rings.length-1].y-e-210,e))}}function drawRings(t,e){if(objectFactory.ball){objectFactory.visibleBalls=0;for(var a=0;a<objectFactory.rings.length;a++)objectFactory.rings[a].draw(t,e),objectFactory.rings[a].y<=objectFactory.ball.y&&objectFactory.visibleBalls++;appendMoreRings()}}function generateRings(t,e){objectFactory.rings.length||(objectFactory.rings.push(new Ring(t.width/2,t.height/2,Math.floor(70*Math.random())+50)),objectFactory.rings.push(new Ring(t.width/2,t.height/2-300,Math.floor(70*Math.random())+50))),drawRings(ctx,e)}function explodeBall(){objectFactory.explodedBalls=[];for(var t=0;t<50;t++)objectFactory.explodedBalls.push(new ExplodedBall(objectFactory.ball.x,objectFactory.ball.y,objectFactory.ball.r/2,possibleColors[Math.floor(Math.random()*possibleColors.length)]));objectFactory.ball.remove=!0}function notStartedGameState(){drawText("FLAPPY",0),drawText("BALL",1),drawText("PLAY",3,{color:"#4CE0D2"}),drawText("SPACE OR TAP TO JUMP",0,{color:"#4CE0D2",size:gameCanvas.height<=768?4:5,y:gameCanvas.height-60})}function playingGameState(t){drawText(objectFactory.score,0,{x:20,y:20,size:10,color:"#247BA0"}),objectFactory.ball.draw(ctx),objectFactory.ball.onKeyPress(ctx),generateRings(gameCanvas,t),detectCollision()}function gameOverState(){if(objectFactory.ball={},objectFactory.rings=[],objectFactory.explodedBalls&&objectFactory.explodedBalls.length)for(var t=0;t<objectFactory.explodedBalls.length;t++)objectFactory.explodedBalls[t].draw(gameCanvas.getContext("2d")),objectFactory.explodedBalls[t].update();drawText("GAME",0,{color:"#FF3C38"}),drawText("OVER",1,{color:"#FF3C38"}),drawText("SCORE:"+objectFactory.previousScore,gameCanvas.height<=768?2.5:2,{color:"#FFF",size:10}),drawText("RESTART",3.5,{color:"#00B295"})}function gameStateHandler(t){switch(ctx.clearRect(0,0,gameCanvas.width,gameCanvas.height),objectFactory.gameState){case"notStarted":notStartedGameState();break;case"playing":playingGameState(t);break;case"gameOver":gameOverState()}}var possibleColors=["#247BA0","#70C1B3","#F3FFBD","#FF1654"],letters=letters={A:[[,1],[1,,1],[1,,1],[1,1,1],[1,,1]],B:[[1,1],[1,,1],[1,1,1],[1,,1],[1,1]],C:[[1,1,1],[1],[1],[1],[1,1,1]],E:[[1,1,1],[1],[1,1,1],[1],[1,1,1]],F:[[1,1,1],[1],[1,1],[1],[1]],G:[[,1,1],[1],[1,,1,1],[1,,,1],[,1,1]],J:[[1,1,1],[,,1],[,,1],[1,,1],[1,1,1]],L:[[1],[1],[1],[1],[1,1,1]],M:[[1,1,1,1,1],[1,,1,,1],[1,,1,,1],[1,,,,1],[1,,,,1]],O:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],P:[[1,1,1],[1,,1],[1,1,1],[1],[1]],R:[[1,1],[1,,1],[1,,1],[1,1],[1,,1]],S:[[1,1,1],[1],[1,1,1],[,,1],[1,1,1]],T:[[1,1,1],[,1],[,1],[,1],[,1]],U:[[1,,1],[1,,1],[1,,1],[1,,1],[1,1,1]],V:[[1,,,,1],[1,,,,1],[,1,,1],[,1,,1],[,,1]],Y:[[1,,1],[1,,1],[,1],[,1],[,1]],0:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],1:[[,1],[,1],[,1],[,1],[,1]],2:[[1,1,1],[,,1],[1,1,1],[1,,],[1,1,1]],3:[[1,1,1],[,,1],[,1,1],[,,1],[1,1,1]],4:[[1,,1,0],[1,,1],[1,1,1,1],[,,1],[,,1]],5:[[1,1,1,0],[1,,,],[1,1,1],[,,1],[1,1,1]],6:[[1,1,1,0],[1,,,],[1,1,1],[1,,1],[1,1,1]],7:[[1,1,1],[,,1],[,,1],[,,1],[,,1]],8:[[1,1,1],[1,,1],[1,1,1],[1,,1],[1,1,1]],9:[[1,1,1],[1,,1],[1,1,1],[,,1],[1,1,1]]," ":[[,,],[,,],[,,],[,,],[,,]],":":[[,,],[1],[,,],[1],[,,]]},GameState={GAME_OVER:"gameOver",PLAYING:"playing"},U=new function(){this.z=new H;var t,e,a,o,r,n,i,s,c,l,h,d;this.reset=function(){var t=this.z;o=100/(t.f*t.f+.001),r=100/(t.g*t.g+.001),n=1-.01*t.h*t.h*t.h,i=1e-6*-t.i*t.i*t.i,t.a||(h=.5-t.n/2,d=5e-5*-t.o),s=1+t.l*t.l*(0<t.l?-.9:10),c=0,l=1==t.m?0:2e4*(1-t.m)*(1-t.m)+32},this.C=function(){this.reset();var o=this.z;return t=1e5*o.b*o.b,e=1e5*o.c*o.c,a=1e5*o.e*o.e+12,3*((t+e+a)/3|0)},this.B=function(g,y){var v=this.z,u=1!=v.s||v.v,b=.1*v.v*v.v,m=1+3e-4*v.w,f=.1*v.s*v.s*v.s,p=1+1e-4*v.t,F=1!=v.s,w=v.x*v.x,j=v.g,C=v.q||v.r,x=.2*v.r*v.r*v.r,M=v.q*v.q*(0>v.q?-1020:1020),S=v.p?(2e4*(1-v.p)*(1-v.p)|0)+32:0,B=v.d,A=v.j/2,E=.01*v.k*v.k,P=v.a,k=t,R=1/t,L=1/e,I=1/a,v=5/(1+20*v.u*v.u)*(.01+f);.8<v&&(v=.8);for(var T,G,z,H,O,v=1-v,U=!1,D=0,J=0,Y=0,W=0,q=0,N=0,X=0,V=0,K=0,Q=0,Z=Array(1024),_=Array(32),$=Z.length;$--;)Z[$]=0;for($=_.length;$--;)_[$]=2*Math.random()-1;for($=0;$<y;$++){if(U)return $;if(S&&++K>=S&&(K=0,this.reset()),l&&++c>=l&&(l=0,o*=s),n+=i,o*=n,o>r&&(o=r,0<j&&(U=!0)),G=o,0<A&&(Q+=E,G*=1+Math.sin(Q)*A),G|=0,8>G&&(G=8),P||(h+=d,0>h?h=0:.5<h&&(h=.5)),++J>k)switch(J=0,++D){case 1:k=e;break;case 2:k=a}switch(D){case 0:Y=J*R;break;case 1:Y=1+2*(1-J*L)*B;break;case 2:Y=1-J*I;break;case 3:Y=0,U=!0}C&&(M+=x,z=0|M,0>z?z=-z:1023<z&&(z=1023)),u&&m&&(b*=m,1e-5>b?b=1e-5:.1<b&&(b=.1)),O=0;for(var tt=8;tt--;){if(X++,X>=G&&(X%=G,3==P))for(T=_.length;T--;)_[T]=2*Math.random()-1;switch(P){case 0:H=X/G<h?.5:-.5;break;case 1:H=1-2*(X/G);break;case 2:H=X/G,H=6.28318531*(.5<H?H-1:H),H=1.27323954*H+.405284735*H*H*(0>H?1:-1),H=.225*((0>H?-1:1)*H*H-H)+H;break;case 3:H=_[Math.abs(32*X/G|0)]}u&&(T=N,f*=p,0>f?f=0:.1<f&&(f=.1),F?(q+=(H-N)*f,q*=v):(N=H,q=0),N+=q,W+=N-T,H=W*=1-b),C&&(Z[V%1024]=H,H+=Z[(V-z+1024)%1024],V++),O+=H}O*=.125*Y*w,g[$]=1<=O?32767:-1>=O?-32768:32767*O|0}return y}};window.jsfxr=function(t){U.z.A(t);var e=U.C(),t=new Uint8Array(4*((e+1)/2|0)+44),e=2*U.B(new Uint16Array(t.buffer,44),e),a=new Uint32Array(t.buffer,0,44);a[0]=1179011410,a[1]=e+36,a[2]=1163280727,a[3]=544501094,a[4]=16,a[5]=65537,a[6]=44100,a[7]=88200,a[8]=1048578,a[9]=1635017060,a[10]=e;for(var e=e+44,a=0,o="data:audio/wav;base64,",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";a<e;a+=3)var n=t[a]<<16|t[a+1]<<8|t[a+2],o=o+(r[n>>18]+r[n>>12&63]+r[n>>6&63]+r[63&n]);return o};var scoreUpSound=jsfxr([3,,.0492,.3652,.3894,.8659,,,,,,.2355,.5761,,,,,,1,,,,,.5]),explosionSound=jsfxr([3,,.3708,.5822,.3851,.0584,,-.0268,,,,-.0749,.7624,,,,,,1,,,,,.5]),ballJumpSound=jsfxr([2,,.2157,,.05,.4632,,.1288,,,,,,.4423,,,,,.4543,,,,,.5]),keysDown={};addEventListener("resize",function(){gameCanvas.height=window.innerHeight,gameCanvas.width=2*gameCanvas.height/3});var objectFactory={rings:[],gameState:"notStarted",cursor:{},ball:{},previousScore:0};!function(){var t,e=window,a=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.msRequestAnimationFrame||e.mozRequestAnimationFrame,o=window.gameCanvas=document.createElement("canvas");window.ctx=o.getContext("2d"),o.height=window.innerHeight,o.width=2*o.height/3,document.body.appendChild(o);var r=function(t){gameStateHandler(t)},n=function(){var e=Date.now(),o=e-t;r(o/1e3),t=e,a(n)};t=Date.now(),n(),bindNotStartedGameEvents()}();