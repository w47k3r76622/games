(()=>{"use strict";const t=document.querySelector.bind(document),e=document.querySelectorAll.bind(document),o=(t,e,o)=>t?.addEventListener(e,o),n=(t,e)=>{t&&(t.innerHTML=e)},s=(t,e="")=>{t&&e.split(" ").forEach((e=>{t.classList.add(e)}))},r=(t,e="")=>{t&&e.split(" ").forEach((e=>{t.classList.remove(e)}))},l=(t,e)=>{if(t)for(const o in e)t.style[o]=e[o]},i=t=>{e("button").forEach((e=>{o(e,"click",(e=>{t(e.target.id)}))}))},a=(t=1)=>Array.from({length:t},((t,e)=>e)),c=(t=0)=>t<=9?`0${t}`:`${t}`,d=t=>`${c(t.m)}:${c(t.s)}`,f=t=>60*t.m+t.s,h="THIRTEEN_ORDER_JS13K",v=()=>{const t=localStorage.getItem(h)||"";return""!==t&&((t="")=>{try{return JSON.parse(t),!0}catch(t){return!1}})(t)?JSON.parse(t):{}},u=(t,e)=>{const o=v();o[t]=e,(t=>{const e=JSON.stringify(t);localStorage.setItem(h,e)})(o)},b=(t="",e)=>v()[t]??e;let m,x,g;x=.3,m=(t=1,e=.05,o=220,n=0,s=0,r=.1,l=0,i=1,a=0,c=0,d=0,f=0,h=0,v=0,u=0,b=0,m=0,x=1,p=0,y=0,$=Math,w=44100,j=2*$.PI,k=(a*=500*j/w/w),S=(o*=(1-e+2*e*$.random(e=[]))*j/w),T=0,I=0,E=0,O=1,C=0,L=0,M=0,N,J)=>{for(c*=500*j/w**3,u*=j/w,d*=j/w,f*=w,h=w*h|0,J=(n=w*n+9)+(p*=w)+(s*=w)+(r*=w)+(m*=w)|0;E<J;e[E++]=M)++L%(100*b|0)||(M=l?1<l?2<l?3<l?$.sin((T%j)**3):$.max($.min($.tan(T),1),-1):1-(2*T/j%2+2)%2:1-4*$.abs($.round(T/j)-T/j):$.sin(T),M=(h?1-y+y*$.sin(j*E/h):1)*(0<M?1:-1)*$.abs(M)**i*.3*t*(E<n?E/n:E<n+p?1-(E-n)/p*(1-x):E<n+p+s?x:E<J-m?(J-E-m)/r*x:0),M=m?M/2+(m>E?0:(E<J-m?1:(J-E)/m)*e[E-m|0]/2):M),T+=(N=(o+=a+=c)*$.cos(u*I++))-N*v*(1-1e9*($.sin(E)+1)%2),O&&++O>f&&(o+=d,S+=d,O=0),!h||++C%h||(o=S,a=k,O||=1);return(t=g.createBuffer(1,J,w)).getChannelData(0).set(e),(o=g.createBufferSource()).buffer=t,o.connect(g.destination),o.start(),o},g=new AudioContext;let p=b("sound",!0);const y={gameOver:[,,20,.04,,.6,,1.31,,,-990,.06,.17,,,.04,.07],shot:[,,150,.05,,.05,,1.3,,,,,,3],click:[,,537,.02,.02,.22,1,1.59,-6.98,4.97],blocked:[,,925,.04,.3,.6,1,.3,,6.27,-184,.09,.17]},$=t=>{p&&m(...y[t])},w=t=>{p=!p,u("sound",p),n(t,p?"🔈":"🔇")},j="container",k=a(11).map(((t,e)=>({[String(t+3)]:5+5*e}))).reduce(((t,e)=>({...t,...e})),{}),S=((t,e)=>{var o;return function(){clearTimeout(o),o=setTimeout(t,e)}})((()=>{const e=t("#root"),o=Math.min(window.innerWidth/412,window.innerHeight/732);e.setAttribute("style",`transform: scale(${o});`)}),100),T=S,I=[["help","💡","Help"],["solve","❯","Solve level"],["restart","↺","Restart board"]],E=()=>`<button id="sounds" class="jc" title="Sounds">${p?"🔈":"🔇"} </button>`,O={interval:null,show({txt:e="",icon:o="",yes:n="yes",no:i="no",cb:a,timer:c=0}){var d;t("modal .txt").innerHTML=(o?`<p ${d={"font-size":"3rem"},Object.keys(d).length?`style='${Object.keys(d).map((t=>`${t}:${d[t]}`)).join(";")}'`:""}>${o}</p>`:"")+e,l(t("modal #btn1"),{display:n?"block":"none"}),l(t("modal #btn2"),{display:i?"block":"none"}),t("modal #btn1").textContent=n,t("modal #btn2").textContent=i,r(t("modal"),"hide"),s(t("modal"),"show"),this.interval&&clearTimeout(this.interval),c&&(this.interval=setTimeout((()=>{this.hide()}),c)),a&&(this.callback=a)},hide(){r(t("modal"),"show"),s(t("modal"),"hide"),this.interval&&clearTimeout(this.interval)},render:()=>'<modal class="hide wh"><div class="ms wh"></div><div class="mw wh jc"><div class=mc><div class="wh jc txt"></div><div class="mb wh jc"><button id=btn1></button><button id=btn2></button></div></div></div></modal>',events(){e("modal button").forEach((t=>o(t,"click",(t=>{this.hide(),this.callback&&this.callback("btn1"===t.target.id)}))))}};let C=[],L=0,M=0,N=0,J=0,A=[],H=0;const R=(t=0)=>{const e=L+M*J;0===t?(A[e]=A[e-1],A[e-1]=H,L--):1===t?(A[e]=A[e-J],A[e-J]=H,M--):2===t?(A[e]=A[e+J],A[e+J]=H,M++):3===t&&(A[e]=A[e+1],A[e+1]=H,L++)},_=(t=[])=>{for(let e=0;e<t.length;e++){const o=t[e];C.length&&C[C.length-1]+o===3?C.length--:C[C.length]=o,R(o)}},D=(t=0,e=0,o=0)=>{let n=-1,s=0,r=0;for(r=0;r<N;r++){for(s=0;s<J&&(n++,A[n]!==t);s++);if(A[n]===t)break}for(s<o&&M==e&&_([2]);s>o;){for(M===r&&L>s&&_(r===N-1?[1]:[2]);L>=s;)_([0]);for(;L<s-1;)_([3]);for(;M<r;)_([2]);for(;M>r;)_([1]);_([3]),s--}for(;s<o;){for(M===r&&L<s&&_(r===N-1?[1]:[2]);L<=s;)_([3]);for(;L>s+1;)_([0]);for(;M<r;)_([2]);for(;M>r;)_([1]);_([0]),s++}for(;r>e;){if(e<r-1){for(;M<r-1;)_([2]);for(L===s&&_([s==J-1?0:3]);M>r-1;)_([1]);for(;L<s;)_([3]);for(;L>s;)_([0]);_([2])}else if(s!==J-1){for(M===r&&_([2]);L<s+1;)_([3]);for(;L>s+1;)_([0]);for(;M>r-1;)_([1]);for(;M<r-1;)_([2]);_([0,2])}else if(M<r&&L==s)for(;M<r;)_([2]);else{for(;M>r+1;)_([1]);for(;M<r+1;)_([2]);for(;L<s;)_([3]);for(;L>s;)_([0]);_([1,1,0,2,3,2,0,1,1,3,2])}r--}for(;r<e;){for(L===s&&M<r&&_(s===J-1?[0]:[3]);M>r+1;)_([1]);for(;M<r+1;)_([2]);for(;L<s;)_([3]);for(;L>s;)_([0]);_([1]),r++}},G=(t=15,e=0,o=0,n=[],s=0)=>{A=JSON.parse(JSON.stringify(n)),L=e,M=o,N=s,J=s,H=t,C.length=0;const r=[];for(let t=0;t<=H;t++)r[t]=A[t];r[H+1]=L,r[H+2]=M;let l=0;for(let t=0;t<N-2;t++){for(let e=0;e<J;e++)D(l+e,t,e);l+=J}for(let t=0;t<J-2;t++){if(D(l,N-2,t),L===t&&_([3]),A[l+J]!==l+J){for(D(l+J,N-1,t+1),M!==N-1&&(L===t+1&&_([3]),_([2]));L>t+2;)_([0]);_([0,0,1,3,2,3,1,0,0,2,3])}l++}L<J-1&&_([3]),M<N-1&&_([2]),l=H-J-1,A[l]===l+1&&_([1,0,2,3]),A[l]===l+J&&_([0,1,3,2]);for(let t=0;t<=H;t++)A[t]=r[t];return L=r[H+1],M=r[H+2],C};let q=0,z=0;const B=(t=15,e=4,o=4,n=[])=>{let s=0,r=0,l=0;const i=[];for(s=0;s<=t;s++)i[s]=s;for(i[t-1]=-1,i[t-2]=-1,s=0;s<e;s++)for(r=0;r<o;r++){const e=Math.floor(Math.random()*i.length);n[l]=i[e],i[e]===t&&(q=r,z=s),i[e]=i[i.length-1],i.length--,l++}return n=((t=15,e=[],o=4,n=4)=>{let s=-1,r=-1;for(let o=0;o<=t;o++)if(-1===e[o]){if(!(s<0)){r=o,e[r]=t-2;break}s=o,e[s]=t-1}let l=0;for(let o=1;o<=t;o++)for(let t=0;t<o;t++)e[t]>e[o]&&l++;return l+=o-1-q+(n-1)-z,1&l&&(e[s]=t-2,e[r]=t-1),e.filter((t=>void 0!==t))})(t,n,o,e),n};let P,W,Y,K,X=0,F=[],Q=0,U=!1,V={m:0,s:0},Z=!1,tt=!1,et=0,ot=[],nt=0,st=!1;const rt=[{r:0,c:-1},{r:1,c:0},{r:0,c:1},{r:-1,c:0}],lt=(t=0,e=0)=>({x:X*t,y:X*e}),it=()=>a(Q).map((t=>a(Q).map((e=>{const o=e+1+t*Q,n=o!==Q**2?o:0,{x:s,y:r}=lt(e,t),l=`ti-${"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))}`;return{v:n,s:X,x:s,y:r,id:l}})))),at=()=>{for(let e=0;e<Q;e++)for(let o=0;o<Q;o++)l(t(`#${F[e][o].id}`),{left:`${F[e][o].x}px`,top:`${F[e][o].y}px`})},ct=(t={r:0,c:0},e={r:0,c:0})=>{const o=F[t.r][t.c],n=F[e.r][e.c],s=o.id,r=o.v,l=n.id,i=n.v;F[e.r][e.c].id=s,F[e.r][e.c].v=r,F[t.r][t.c].id=l,F[t.r][t.c].v=i,$("shot")},dt=(t=0)=>{for(let e=0;e<Q;e++)for(let o=0;o<Q;o++)if(F[e][o].v===t)return{r:e,c:o,id:F[e][o].id};return{r:0,c:0,id:""}},ft=(t=0,e=0)=>t>=0&&t<Q&&e>=0&&e<Q,ht=()=>{const t=F.flat(),e=Q**2,o=t[e-1].v;let n=0;for(let e=0;e<t.length&&t[e].v===e+1;e++)n++;return n+1===e&&0===o},vt=async()=>{var t;Z=!0,await(t=500,new Promise((e=>setTimeout(e,t))));const e={icon:"🎉",txt:`<h4>Excellent, you solved the level in ${d(V)}, do you want to play again?</h4>`};tt&&(e.icon="🤖",e.txt="<h4>I've solved the level for you!, This doesn't count as if you had solved it yourself 😉. Want to give it another shot? 🎉</h4>"),O.show({...e,no:"No",yes:"Yes",cb:t=>{t?gt():kt()}}),$("gameOver")},ut=()=>{O.show({icon:"😭",txt:"<h4>Sorry, I haven't found a solution for this level, do you want to try again?</h4>",no:"No",yes:"Yes",cb:t=>{t?gt():kt()}}),$("blocked")},bt=async(t="")=>{const{r:e,c:o}=((t="")=>{for(let e=0;e<Q;e++)for(let o=0;o<Q;o++)if(F[e][o].id===t)return{r:e,c:o};return{r:0,c:0}})(t),{direction:n,tilesToMove:s}=((t=0,e=0)=>{let o=[],n=!1,s=-1;for(let r=0;r<rt.length;r++){const{r:l,c:i}=rt[r],a=[];let c=t,d=e;for(;c+=l,d+=i,ft(c,d);){if(0===F[c][d].v){n=!0;break}a.push({r:c,c:d})}if(n){s=r,o=a,o.unshift({r:t,c:e});break}}return{direction:s,tilesToMove:o}})(e,o);if(n>=0){for(let t=s.length-1;t>=0;t--){const e=s[t].r+rt[n].r,o=s[t].c+rt[n].c;ct({r:s[t].r,c:s[t].c},{r:e,c:o})}at(),ht()&&((()=>{const t=b(`t-${Q}`,{m:-1,s:-1});let e=!0;(t.m>=0||t.s>=0)&&(e=f(V)<f(t)),e&&u(`t-${Q}`,V)})(),mt(),vt()),st=!0}},mt=()=>{Y&&(clearInterval(Y),Y=null)},xt=()=>{W.textContent=`${et}`},gt=()=>{et=k[Q],tt=!1,Z=!1,st=!1,nt=0,V={m:0,s:0},ot=[],xt(),yt(!1),(()=>{const t=Q**2,e=a(t),o=B(t-1,t,t,e).map((e=>e+1===t?0:e+1)).map((t=>[t,dt(t).id])),n=[];for(let e=0;e<t;e+=Q)n.push(o.slice(e,e+Q));for(let t=0;t<Q;t++)for(let e=0;e<Q;e++){const[o,s]=n[t][e],{x:r,y:l}=lt(e,t);F[t][e].v=o,F[t][e].id=s,F[t][e].x=r,F[t][e].y=l}at()})(),mt(),mt(),P.textContent=d(V),Y=setInterval((()=>{V.s++,60===V.s&&(V.s=0,V.m++,60===V.m&&mt()),P.textContent=d(V)}),1e3)},pt=(e=0,o=[])=>{const n=o[e],{r:s,c:r}=dt(0),l=[{r:0,c:-1},{r:-1,c:0},{r:1,c:0},{r:0,c:1}],i=s+l[n].r,a=r+l[n].c;ft(i,a)?(ct({r:i,c:a},{r:s,c:r}),at()):(t("#help").disabled=!0,clearInterval(K),mt())},yt=(t=!1)=>{e(".game-fo-o > button").forEach((e=>{e.disabled=t}))},$t=()=>{const{r:t,c:e}=dt(0),o=Q**2,n=F.flat().map((t=>0===t.v?o-1:t.v-1));return G(o-1,e,t,n,Q)},wt=(e=3)=>{Q=e,P=t(".game-he-t span"),W=t("#help span"),U=!1,(()=>{X=382/Q,F=it();const e=F.map((t=>t.map((t=>0!==t.v?(({v:t=0,s:e=0,x:o=0,y:n=0,id:s})=>`<button id=${s} class="tile jc" style="width:${e}px;height:${e}px;left:${o}px;top:${n}px">${t}</button>`)(t):"")))).flat().join("");n(t(".grid"),e)})(),i((e=>{if("start"===e&&(U=!0,s(t(".game-fo"),"s"),gt()),"restart"===e&&gt(),"help"===e&&et-1>=0)if(et--,xt(),0===ot.length||st?(nt=0,ot=$t(),st=!1):nt++,ot.length>0){let t=!1;nt<ot.length&&(pt(nt,ot),t=ht()),t&&vt()}else ut();e.includes("ti-")&&U&&!Z&&!tt&&bt(e),"solve"===e&&(mt(),(()=>{tt=!0,yt(!0),ot=$t();let t=0;K=setInterval((()=>{t<ot.length?(pt(t,ot),t++):(clearInterval(K),ht()?vt():ut())}),100)})()),"lobby"===e&&(clearInterval(K),mt(),kt()),"sounds"===e&&w(t("#sounds"))})),O.events()},jt={Game:({s:e=3})=>{const o=`<div class="game wh jc si-${e}">${((t=3)=>`<div class="game-he jc"><button id="lobby" title="Go to the lobby"><span>➜</span></button><div class="game-he-s">${t}x${t}</div><div class="game-he-t jc">⏰<span>00:00</span></div>${E()}</div>`)(e)}<div class="grid" style="width:382px;height:382px"></div><div class="game-fo jc"><button id="start" class="button">Start</button><div class="game-fo-o jc">${I.map((([t,e,o])=>`<button class="game-fo-b" id="${t}" title="${o}">\n      ${e}${"help"===t?'<span class="jc"></span>':""}\n      </button>`)).join("")}</div></div>${O.render()}</div>`;n(t(`#${j}`),o),wt(e)},Lobby:()=>{const e=`<div class="lobby wh jc"><div class="game-nav jc"><a class="jc" href="https://bio.link/jorgerub" target="_blank" title="About">👨🏻‍💻</a><div class="game-nav-logo jc">13 Order</div>${E()}</div><div class="lobby-b jc">${(()=>{const t=b("t-8",{m:-1,s:-1}),e=t.m>=0||t.s>=0;return a(11).map((t=>{const o=t+3,n=b(`t-${o}`,{m:-1,s:-1}),s=!(o<=8||e);return`<button id="level-${o}" class="button lobby-o jc" ${s?"disabled":""}><span>${o} X ${o}</span>${n.m>=0||n.s>=0?`<div class="lobby-t jc">⏰<span>${d(n)}</span></div>`:`<div class="lobby-m">Challenge now ${s?"<span>🔐</span>":""}</div>`}</button>`})).join("")})()}</div><a href="https://js13kgames.com/" target="_blank" class="lobby-l">Js13k 2024</a></div>`;n(t(`#${j}`),e),i((e=>{if(e.includes("level-")){const t=+e.split("-")[1];kt("Game",{s:t})}"sounds"===e&&w(t("#sounds"))}))}},kt=(t="Lobby",e={})=>jt[t](e);n(t("#root"),`<div id="${j}" style="overflow: hidden;width:412px;height:732px"></div>`),kt(),o(document,"contextmenu",(t=>t.preventDefault())),window.addEventListener("resize",T),T();o(window,"click",(t=>{const e=t.target,o=(e.id??"").includes("ti-");e&&!o&&["a","button"].includes(e.tagName.toLowerCase())&&$("click")}))})();