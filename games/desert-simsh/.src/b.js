'use strict';(function(){function wa(a,b){let g=document.createElement("canvas"),k=64*b.length;g.width=64*Q.length;g.height=k;a.offscreenCanvas=g;let m=Array(Q.length),c=a.getContext("2d"),e=g.getContext("2d");return{drawShape:function(a,k,l,p,t){let r=64*a,w=64*t;m[a]||(m[a]=Array(b.length));if(!m[a][t]){e.save();e.fillStyle=b[t];e.translate(r,w);let k=Q[a].toString(2).padStart(16,"0"),d=16;for(;d--;)if(parseInt(k.charAt(d),2)){var q=xa[d];for(let d=0;d<q.length;d++){const f=q[d];e.fillRect(f[0],
f[1],f[2],f[3])}}e.fill();e.restore();m[a][t]=1}c.drawImage(g,r,w,64,64,k,l,p,p)}}}function K(a,b){function g(a){for(let b=0;b<a.length;b++){let k=a[b];m+=k[0];r&&(l+=k[0].length);for(let a=0;a<k[0].length;a++)c.push(k[1]||1),e.push(null==k[2]?20:k[2]),n.push(null==k[3]?0:k[3])}}let k=0,m="",c=[],e=[],n=[],r=1,l=0;g(b);r=0;return{draw:function(b){let g=0,p=0;for(let b=0;b<=k;b++){let k=m.charCodeAt(b);10===k?(g=0,p++):(g++,a.drawShape(k,g,p,e[b],n[b]))}a.drawShape(1,g+1,p,20,0);!(b%c[k])&&k+1<m.length&&
k++},ingest:g,isReady:function(){let b=0;k+1>=l&&(b=1);return b},remove:function(b){b*=-1;k+=b;m=m.slice(0,b);c=c.slice(0,b);e=e.slice(0,b);n=n.slice(0,b)}}}function X(a){let b=a||0;return{getInt:function(a){b=(8121*b+28411)%134456;return a?Math.floor(a/134456*b):b}}}function ya(a,b){let g=Array.from(Array(a),()=>[]);g[0].push(1);g[1].push(0);for(let k=2;k<a;k++){let a=b.getInt(k);4>g[k].length+1&&4>g[a].length+1?(g[k].push(a),g[a].push(k)):k--}return g}function za(a,b,g){let k=X(b),m=[0,0,0];var c=
[77,77,187],e=[87,2,74];let n=ya(12,k),r=Array.from(Array(24),()=>[]),l=Array.from(Array(12),()=>[]);r[12][12]=0;let p=[[12,12]],t=[[0,12,12]],W=[],w=()=>{const b=t[0][0],d=t[0][1],a=t[0][2];for(let g=0;g<n[b].length;g++){const e=n[b][g];if(0>W.indexOf(e)){var f=[];null==r[d][a-1]&&f.push([d,a-1]);null==r[d+1][a]&&f.push([d+1,a]);null==r[d][a+1]&&f.push([d,a+1]);null==r[d-1][a]&&f.push([d-1,a]);var h=0;f.length||(null==r[d+1][a-1]&&f.push([d+1,a-1]),null==r[d+1][a+1]&&f.push([d+1,a+1]),null==r[d-
1][a+1]&&f.push([d-1,a+1]),null==r[d-1][a-1]&&f.push([d-1,a-1]),f.length&&(h=1));if(f.length){var c=k.getInt(f.length);const g=f[c][0];f=f[c][1];r[g][f]=e;p[e]=[g,f];h?(h=r[d][f],c=r[g][a],0>l[b].indexOf(h)&&(l[b].push(h),l[h].push(b)),0>l[b].indexOf(c)&&(l[b].push(c),l[c].push(b)),0>l[b].indexOf(e)&&(l[b].push(e),l[e].push(b)),0>l[e].indexOf(h)&&(l[e].push(h),l[h].push(e)),0>l[e].indexOf(c)&&(l[e].push(c),l[c].push(e)),0>l[h].indexOf(c)&&(l[h].push(c),l[c].push(h))):(l[b].push(e),l[e].push(b));t.push([e,
g,f])}}}W.push(b);t.splice(0,1);t.length&&w()};w();var q=[];for(var x=0;x<l.length;x++){var d=p[x],z=l[x];if(z.length){var f=void 0,h=void 0;let b,a,k,c,e,g;for(let x=0;x<z.length;x++){var A=z[x];let m=p[A][0]-d[0];A=p[A][1]-d[1];!m&&0>A&&(f=1);0<m&&!A&&(h=1);!m&&0<A&&(b=1);0>m&&!A&&(a=1);0>m&&0>A&&(k=1);0<m&&0>A&&(c=1);0<m&&0<A&&(e=1);0>m&&0<A&&(g=1)}let m,l,t,n,w,C,G,F;null!=r[d[0]][d[1]-1]&&(m=1);null!=r[d[0]+1][d[1]]&&(l=1);null!=r[d[0]][d[1]+1]&&(t=1);null!=r[d[0]-1][d[1]]&&(n=1);null!=r[d[0]-
1][d[1]-1]&&(w=1);null!=r[d[0]+1][d[1]-1]&&(C=1);null!=r[d[0]+1][d[1]+1]&&(G=1);null!=r[d[0]-1][d[1]+1]&&(F=1);q[x]=[k?[0]:f&&a?[1,w]:f?[2,n]:a?[3,m]:[4,n,w,m],c?[5]:f&&h?[6,C]:f?[7,l]:h?[8,m]:[9,m,C,l],e?[10]:b&&h?[11,G]:b?[12,l]:h?[13,t]:[14,l,G,t],g?[15]:b&&a?[16,F]:b?[17,n]:a?[18,t]:[19,t,F,n]]}}let C=[];for(x=0;x<q.length;x++)if(z=q[x],q[x]){d=Array.from(Array(32),()=>[]);for(f=0;32>f;f++)for(h=0;18>h;h++)d[f][h]=m;f=z[0];h=f[0];if(1===h)d[0][0]=f[1]?c:e;else if(2===h)for(h=0;9>h;h++)d[0][h]=
f[1]?c:e;else if(3===h)for(h=0;16>h;h++)d[h][0]=f[1]?c:e;else if(4===h){for(h=0;16>h;h++)d[h][0]=f[3]?c:e;for(h=0;9>h;h++)d[0][h]=f[1]?c:e;f[1]!==f[3]&&(d[0][0]=f[2]?c:e)}f=z[1];h=f[0];if(6===h)d[31][0]=f[1]?c:e;else if(7===h)for(h=0;9>h;h++)d[31][h]=f[1]?c:e;else if(8===h)for(h=16;32>h;h++)d[h][0]=f[1]?c:e;else if(9===h){for(h=16;32>h;h++)d[h][0]=f[1]?c:e;for(h=0;9>h;h++)d[31][h]=f[3]?c:e;f[1]!==f[3]&&(d[31][0]=f[2]?c:e)}f=z[2];h=f[0];if(11===h)d[31][17]=f[1]?c:e;else if(12===h)for(h=9;18>h;h++)d[31][h]=
f[1]?c:e;else if(13===h)for(h=16;32>h;h++)d[h][17]=f[1]?c:e;else if(14===h){for(h=16;32>h;h++)d[h][17]=f[3]?c:e;for(h=9;18>h;h++)d[31][h]=f[1]?c:e;f[1]!==f[3]&&(d[31][17]=f[2]?c:e)}z=z[3];f=z[0];if(16===f)d[0][17]=z[1]?c:e;else if(17===f)for(f=9;18>f;f++)d[0][f]=z[1]?c:e;else if(18===f)for(f=0;16>f;f++)d[f][17]=z[1]?c:e;else if(19===f){for(f=0;16>f;f++)d[f][31]=z[1]?c:e;for(f=9;18>f;f++)d[0][f]=z[3]?c:e;z[1]!==z[3]&&(d[0][17]=z[2]?c:e)}C[x]=d}let Y=Array.from(Array(12),()=>Array.from(Array(32),()=>
[]));for(c=0;c<C.length;c++)if(e=C[c])for(q=0;q<e.length;q++)for(x=0;x<e[q].length;x++)e[q][x]===m&&(d=k.getInt(10),d=8<d?1:0,Y[c][q][x]=d);let R=Array.from(Array(12),()=>Array.from(Array(32),()=>[])),y=[];for(c=0;12>c;c++)e=k.getInt(12),null!=p[e]&&(q=k.getInt(32),x=k.getInt(18),C[e][q][x]===m&&(R[e][q][x]=[c,64,69],y[c]=[e,q,x,50]));let F=()=>{const b=k.getInt(32),a=k.getInt(18);C[0][b][a]===m?(R[0][b][a]=[12,35,64],y[12]=[0,b,a,50]):F()};F();let G=K(a,[["Creating world "+b,NaN],["\nCreating water...\nCreating land...\nCreating flora...\nCreating fauna...\n\nReady!\n\nPress enter to start "]]);
return{draw:G.draw,handleInput:b=>{switch(b){case 13:G.isReady()&&g(r,p,C,Y,R,12,y)}}}}function Aa(a){return{draw:function(b,g){let k=b[2],m=b[3],c=b[4];b=Array.from(Array(32),(b,a)=>{b=[];for(let p=0;18>p;p++){let t,r;var e=void 0;e=k[g][a][p];t=e[0];r=e[1];e=e[2];var l=m[g][a][p];null!=l&&(e=Ba[l]);l=c[g][a][p];null!=l&&(t=l[1],r=l[2]);b.push([t,r,e])}return b});a.drawFrame(b)}}}function Ca(a,b,g,k,m,c,e){let n=b(),r=X(g),l=Aa(a),p=0,t=12,y=12,w=n[6][n[5]][1],q=n[6][n[5]][2];return{draw:function(){l.draw(b(),
p)},handleInput:function(a){var d=b(),c=d[0],f=d[2];let h=d[3],e=d[4],g=d[5];if(null!=d[6][g])switch(a){case 37:a=w-1;d=q;if(0<=a)0===f[p][a][d][0]&&null==e[p][a][d]&&(k(g,p,w,q,p,a,d),w--);else{f=t-1;var l=y;c=c[f][l];null!=c&&(a=31,null==e[c][a][d]&&(k(g,p,w,q,c,a,d),t=f,y=l,w=a,p=c))}break;case 38:a=w;d=q-1;0<=d?0===f[p][a][d][0]&&null==e[p][a][d]&&(k(g,p,w,q,p,a,d),q--):(f=t,l=y-1,c=c[f][l],null!=c&&(d=17,null==e[c][a][d]&&(k(g,p,w,q,c,a,d),t=f,y=l,q=d,p=c)));break;case 39:a=w+1;d=q;32>a?0===
f[p][a][d][0]&&null==e[p][a][d]&&(k(g,p,w,q,p,a,d),w++):(f=t+1,l=y,c=c[f][l],null!=c&&(a=0,null==e[c][a][d]&&(k(g,p,w,q,c,a,d),t=f,y=l,w=a,p=c)));break;case 40:a=w,d=q+1,18>d?0===f[p][a][d][0]&&null==e[p][a][d]&&(k(g,p,w,q,p,a,d),q++):(f=t,l=y+1,c=c[f][l],null!=c&&(d=0,null==e[c][a][d]&&(k(g,p,w,q,c,a,d),t=f,y=l,q=d,p=c)))}h[p][w][q]&&m(p,w,q,g)},update:function(a){if(!(a%30)){var d=b();a=d[0];let l=d[1],p=d[2],t=d[3],q=d[4],n=d[5];d=d[6];for(let b=0;b<d.length;b++)if(null!=d[b])if(100<=c(b))e(b);
else if(b!==n){var g=d[b];let c=g[0],e=g[1];g=g[2];let n=c,u=e,v=g;var f=r.getInt(5);if(0===f)if(u=e,v=g-1,0<=v)0===p[n][u][v][0]&&null==q[n][u][v]&&k(b,c,e,g,n,u,v);else{f=l[c][0];var h=l[c][1]-1;n=a[f][h];null!=a[f][h]&&(v=17,null==q[n][u][v]&&k(b,c,e,g,n,u,v))}else 1===f?(u=e+1,v=g,32>u?0===p[n][u][v][0]&&null==q[n][u][v]&&k(b,c,e,g,n,u,v):(f=l[c][0]+1,h=l[c][1],n=a[f][h],null!=a[f][h]&&(u=0,null==q[n][u][v]&&k(b,c,e,g,n,u,v)))):2===f?(u=e,v=g+1,18>v?0===p[n][u][v][0]&&null==q[n][u][v]&&k(b,c,
e,g,n,u,v):(f=l[c][0],h=l[c][1]+1,n=a[f][h],null!=a[f][h]&&(v=0,null==q[n][u][v]&&k(b,c,e,g,n,u,v)))):3===f&&(u=e-1,v=g,0<=u?0===p[n][u][v][0]&&null==q[n][u][v]&&k(b,c,e,g,n,u,v):(f=l[c][0]-1,h=l[c][1],n=a[f][h],null!=a[f][h]&&(u=31,null==q[n][u][v]&&k(b,c,e,g,n,u,v))));t[n][u][v]&&m(n,u,v,b)}}}}}function Da(a,b,g){let k=K(a,[["You died of starvation.\n\nYour species is extinct...\n\n",1,104,218],["Score = "+b+"\n\nPress enter to try again "]]);return{draw:k.draw,handleInput:a=>{switch(a){case 13:k.isReady()&&
g()}}}}function Z(){var a=+new Date;let b=a-aa;aa=a;for(S+=b;S>=ba;)a=void 0,L++,M&&0===L%Ea[D]&&(M=0),M||(ca?a=8:da?a=13:ea?a=37:fa?a=38:ha?a=39:ia?a=40:ja?a=48:ka?a=49:la?a=50:ma?a=51:na?a=52:oa?a=53:pa?a=54:qa?a=55:ra?a=56:sa&&(a=57),M=1),y[D].handleInput(a),null!=y[D].update&&y[D].update(L),S-=ba;H.clear();y[D].draw(L);window.requestAnimationFrame(Z)}var E=[[0,3],[3,6],[6,8]],I=a=>{const b=255/(a-1),g=[];for(let k=0;k<a;k++)g.push(Math.round(k*b));return g};let Fa={2:I(4),3:I(8)};I=(a,b)=>{a=
a.slice(b[0],b[1]);return Fa[a.length][parseInt(a,2)]};let N=[];for(let a=0;a<Math.pow(2,8);a++){let b=a.toString(2).padStart(8,"0");N.push("rgb("+I(b,E[0])+","+I(b,E[1])+","+I(b,E[2])+")")}let xa=[[[6,6,52,52]],[[58,58,5,5]],Array.from(Array(24),(a,b)=>[52-b,52-b,6,6]),[[30,30,4,28]],Array.from(Array(24),(a,b)=>[6+b,52-b,6,6]),Array.from(Array(24),(a,b)=>[52-b,6+b,6,6]),[[29,6,6,29]],Array.from(Array(24),(a,b)=>[6+b,6+b,6,6]),[[29,29,29,6]],[[6,29,29,6]],[[6,6,6,29]],[[6,30,4,28]],[[6,54,52,4]],
[[54,30,4,28]],[[52,6,6,29]],[[6,6,52,6]]],Q=[0,32768,16383,55,54,9,49,7,14,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16390,514,4814,4845,16356,9049,512,9216,2304,16320,4800,2048,192,16384,3072,3135,1030,219,143,230,8297,253,7,255,239,4608,2560,9280,200,2432,20611,699,247,4751,57,4623,121,113,189,246,4617,30,9328,56,1334,8502,63,243,8255,8435,237,4609,62,3120,10294,11520,238,3081,57,8448,15,10240,8,256,4184,8312,216,2190,2136,5312,1166,4208,4096,2576,13824,48,4308,4176,220,368,1158,80,8328,
120,28,2064,10260,11520,654,2120,2377,4608,9353,3264,0],T=16/9,Ba=[218,112],ba=1E3/30,Ga=[8,13,37,38,39,40,48,49,50,51,52,53,54,55,56,57],Ea=[5,5,5,5,20,20,5],L=-1,D=0,y=[],U,ca=0,da=0,ia=0,ea=0,ha=0,fa=0,ja=0,ka=0,la=0,ma=0,na=0,oa=0,pa=0,qa=0,ra=0,sa=0,M=0,S=0,aa=+new Date,ta,ua,V,O,J,P,B,va=0,H=function(){function a(){c=window.innerWidth;e=window.innerHeight;c/e<T?c-=40:(e-=40,c=Math.floor(e*T));for(;0<c%16||0<c/16%2;)c--;e=c/T;n=c/32;g.style.width=c+"px";g.style.height=e+"px";g.width=c;g.height=
e}function b(a,b,c,e,g){b*=n;c*=n;g&&(k.fillStyle=N[g],k.fillRect(b,c,n,n));m.drawShape(a,b,c,n,e)}let g=document.getElementById("c"),k=g.getContext("2d"),m=wa(g,N),c,e,n;a();window.addEventListener("resize",a);return{clear:function(){k.clearRect(0,0,c,e)},drawFrame:function(a){for(let c=0;32>c;c++)for(let e=0;18>e;e++){let g=a[c][e];g&&b(g[0],c,e,g[1],g[2])}},drawShape:b,fillBg:function(a){k.fillStyle=N[a];k.fillRect(0,0,c,e)}}}(),Ha=()=>[ta,ua,V,O,J,P,B],Ia=(a,b,g,k,m,c,e)=>{const n=J[b][g][k];
J[b][g][k]=null;J[m][c][e]=n;B[a]=[m,c,e,B[a][3]]},Ja=(a,b,g,k)=>{--O[a][b][g];B[k][3]-=2;k===P&&va++},Ka=a=>{B[a][3]+=1;return B[a][3]},La=a=>{const b=B[a];J[b[0]][b[1]][b[2]]=null;B[a]=null;V[b[0]][b[1]][b[2]]=[88,0,0];a===P&&setTimeout(()=>{y.push(Da(H,va,()=>{location.reload()}));D=y.length-1},1E3)};E=a=>{U=a;y.push(za(H,U,(a,g,k,m,c,e,n)=>{ta=a;ua=g;V=k;O=m;J=c;P=e;B=n;y.push(Ca(H,Ha,U,Ia,Ja,Ka,La));D=y.length-1}));D=y.length-1};y=[function(a,b){function g(a){k.isReady()&&!m.length&&(k.ingest([a]),
m+=a)}let k=K(a,[[")",60],["desert-sim.sh",10],['\n\n"Behind the dust, meanwhile,\nunder the vulture-haunted sky,\nthe desert waits - mesas,\nbutte, canyon, reef, sink,\nescarpment, pinnacle, maze,\ndry lake, sand dune and Barren\nMountain." -E. Abbey',1,104,218],["\n\n<1> Random seed\n<2> Choose seed\n\n"],["Enter <1-2> "]]),m="";return{draw:k.draw,handleInput:function(a){switch(a){case 8:m.length&&(m=m.slice(0,-1),k.remove(1));break;case 13:m.length&&b(parseInt(m));break;case 49:g("1");break;case 50:g("2")}}}}(H,
a=>D=a),function(a){return{draw:()=>{},handleInput:()=>a(Math.floor(134456*Math.random()))}}(E),function(a,b){function g(a){k.isReady()&&6>m.length&&(k.ingest([a]),m+=a)}let k=K(a,[["Enter seed <1-134456> "]]),m="";return{draw:k.draw,handleInput:function(a){switch(a){case 8:m.length&&(m=m.slice(0,-1),k.remove(1));break;case 13:a=parseInt(m);m.length&&a&&134456>=a&&b(a);break;case 48:g("0");break;case 49:g("1");break;case 50:g("2");break;case 51:g("3");break;case 52:g("4");break;case 53:g("5");break;
case 54:g("6");break;case 55:g("7");break;case 56:g("8");break;case 57:g("9")}}}}(H,E)];E=(a,b)=>{document.addEventListener(a,a=>{-1<Ga.indexOf(a.keyCode)&&a.preventDefault();switch(a.keyCode){case 8:ca=b;break;case 13:da=b;break;case 37:ea=b;break;case 38:fa=b;break;case 39:ha=b;break;case 40:ia=b;break;case 48:ja=b;break;case 49:ka=b;break;case 50:la=b;break;case 51:ma=b;break;case 52:na=b;break;case 53:oa=b;break;case 54:pa=b;break;case 55:qa=b;break;case 56:ra=b;break;case 57:sa=b}})};E("keydown",
1);E("keyup",0);Z()})()
