!function(){"use strict";const t=16;class e{constructor(t,e,s){this.x=t,this.y=e,this.z=s}dot2(t,e){return this.x*t+this.y*e}dot3(t,e,s){return this.x*t+this.y*e+this.z*s}}var s=[new e(1,1,0),new e(-1,1,0),new e(1,-1,0),new e(-1,-1,0),new e(1,0,1),new e(-1,0,1),new e(1,0,-1),new e(-1,0,-1),new e(0,1,1),new e(0,-1,1),new e(0,1,-1),new e(0,-1,-1)],i=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],h=new Array(512),n=new Array(512);const r=function(t){t>0&&t<1&&(t*=65536),(t=Math.floor(t))<256&&(t|=t<<8);for(var e=0;e<256;e++){var r;r=1&e?i[e]^255&t:i[e]^t>>8&255,h[e]=h[e+256]=r,n[e]=n[e+256]=s[r%12]}};function o(t){return t*t*t*(t*(6*t-15)+10)}function a(t,e,s){return(1-s)*t+s*e}r(100);function l(t){for(var e=t,s=[];e.parent;)s.unshift(e),e=e.parent;return s}const c={search:function(t,e,s,i){t.cleanDirty();var h=(i=i||{}).heuristic||c.heuristics.manhattan,n=i.closest||!1,r=new f((function(t){return t.f})),o=e;for(e.h=h(e,s),t.markDirty(e),r.push(e);r.size()>0;){var a=r.pop();if(a===s)return l(a);a.closed=!0;for(var d=t.neighbors(a),p=0,g=d.length;p<g;++p){var u=d[p];if(!u.closed&&!u.isWall()){var v=a.g+u.getCost(a),m=u.visited;(!m||v<u.g)&&(u.visited=!0,u.parent=a,u.h=u.h||h(u,s),u.g=v,u.f=u.g+u.h,t.markDirty(u),n&&(u.h<o.h||u.h===o.h&&u.g<o.g)&&(o=u),m?r.rescoreElement(u):r.push(u))}}}return n?l(o):[]},heuristics:{manhattan:function(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)},diagonal:function(t,e){var s=Math.sqrt(2),i=Math.abs(e.x-t.x),h=Math.abs(e.y-t.y);return 1*(i+h)+(s-2)*Math.min(i,h)}},cleanNode:function(t){t.f=0,t.g=0,t.h=0,t.visited=!1,t.closed=!1,t.parent=null}};class d{constructor(t,e){e=e||{},this.nodes=[],this.diagonal=!!e.diagonal,this.grid=[];for(var s=0;s<t.length;s++){this.grid[s]=[];for(var i=0,h=t[s];i<h.length;i++){var n=new p(i,s,h[i]);this.grid[s][i]=n,this.nodes.push(n)}}this.init()}init(){this.dirtyNodes=[];for(var t=0;t<this.nodes.length;t++)c.cleanNode(this.nodes[t])}cleanDirty(){for(var t=0;t<this.dirtyNodes.length;t++)c.cleanNode(this.dirtyNodes[t]);this.dirtyNodes=[]}markDirty(t){this.dirtyNodes.push(t)}neighbors(t){var e=[],s=t.x,i=t.y,h=this.grid;return h[i-1]&&h[i-1][s]&&e.push(h[i-1][s]),h[i+1]&&h[i+1][s]&&e.push(h[i+1][s]),h[i]&&h[i][s-1]&&e.push(h[i][s-1]),h[i]&&h[i][s+1]&&e.push(h[i][s+1]),this.diagonal&&(h[i-1]&&h[i-1][s-1]&&e.push(h[i-1][s-1]),h[i+1]&&h[i+1][s-1]&&e.push(h[i+1][s-1]),h[i-1]&&h[i-1][s+1]&&e.push(h[i-1][s+1]),h[i+1]&&h[i+1][s+1]&&e.push(h[i+1][s+1])),e}toString(){for(var t=[],e=this.grid,s=0;s<e.length;s++){for(var i=[],h=e[s],n=0;n<h.length;n++)i.push(h[n].weight);t.push(i.join(" "))}return t.join("\n")}getNode(t,e){return this.grid[e][t]}}class p{constructor(t,e,s){this.x=t,this.y=e,this.weight=s}toString(){return"["+this.x+" "+this.y+"]"}getCost(t){return t&&t.x!=this.x&&t.y!=this.y?1.41421*this.weight:this.weight}isWall(){return 0===this.weight}}class f{constructor(t){this.content=[],this.scoreFunction=t}push(t){this.content.push(t),this.sinkDown(this.content.length-1)}pop(){var t=this.content[0],e=this.content.pop();return this.content.length>0&&(this.content[0]=e,this.bubbleUp(0)),t}remove(t){var e=this.content.indexOf(t),s=this.content.pop();e!==this.content.length-1&&(this.content[e]=s,this.scoreFunction(s)<this.scoreFunction(t)?this.sinkDown(e):this.bubbleUp(e))}size(){return this.content.length}rescoreElement(t){this.sinkDown(this.content.indexOf(t))}sinkDown(t){for(var e=this.content[t];t>0;){var s=(t+1>>1)-1,i=this.content[s];if(!(this.scoreFunction(e)<this.scoreFunction(i)))break;this.content[s]=e,this.content[t]=i,t=s}}bubbleUp(t){for(var e=this.content.length,s=this.content[t],i=this.scoreFunction(s);;){var h,n=t+1<<1,r=n-1,o=null;if(r<e){var a=this.content[r];(h=this.scoreFunction(a))<i&&(o=r)}if(n<e){var l=this.content[n];this.scoreFunction(l)<(null===o?i:h)&&(o=n)}if(null===o)break;this.content[t]=this.content[o],this.content[o]=s,t=o}}}const g=(t,e,s)=>{const i=s??document.createElement("canvas");i.width=2*t,i.height=2*e;const h=i.getContext("2d");return h.scale(2,2),{canvas:i,context:h}};class u{type=null;name=null;#t=[];#e=0;shiftEvery=8;#s=[];#i=0;health=5;opponent=void 0;turn=void 0;hold=!1;sprite={};#h=0;#n=[];get colors(){}constructor(t,e,s="ally"){this.x=t,this.y=e,this.type=s}bind(t,e){this.graph=t,this.entities=e}move(t,e){this.#e=0,this.#t=c.search(this.graph,this.graph.getNode(Math.ceil(this.x),Math.ceil(this.y)),this.graph.getNode(t,e))}step(){const t=this.collideWithEnemy(Math.round(this.x),Math.round(this.y));if(t&&(t.hold=!0,t.opponent=this,this.hold=!0,this.opponent=t),this.opponent){if(Math.round(10*Math.random())>6&&(this.opponent.health--,this.opponent.health<=0)){if(this.opponent.opponent=void 0,this.opponent.hold=!1,this.hold=!1,"enemy"===this.opponent.type&&Math.floor(10*Math.random())>5)this.opponent.stop(),this.opponent.shiftEvery=this.shiftEvery,this.opponent.type="ally",this.opponent.clearCache&&this.opponent.clearCache();else{const t=this.entities.findIndex((t=>t===this.opponent));this.entities.splice(t,1)}if("King"===this.opponent.name)return void document.getElementById("gameover").showModal();this.opponent=void 0}}if(this.#t.length&&!this.hold)return this.x=this.x+(this.#t[0].x-this.x)/this.shiftEvery*this.#e,this.y=this.y+(this.#t[0].y-this.y)/this.shiftEvery*this.#e,this.#e++,this.#e%this.shiftEvery==0&&this.#t.shift(),void(this.#e>=this.shiftEvery&&(this.#e=0));if(this.#s.length&&!this.hold){const[t,e]=this.#s[this.#i];this.move(t,e),this.#i++,this.#i>=this.#s.length&&(this.#i=0)}}patrol(...t){this.shiftEvery=12,this.#s=[[this.x,this.y],...t]}stop(){this.#s=[],this.#t.length&&(this.#e=7,this.#t=[this.#t[0]])}collideWithEnemy(t,e){return this.entities.find((s=>{const i=Math.round(s.x),h=Math.round(s.y);return this.type!==s.type&&void 0===this.opponent&&void 0===s.opponent&&(t+1===i&&e===h||t-1===i&&e===h||t===i&&e+1===h||t===i&&e-1===h)}))}draw(e,s){this.#h++;const i=Math.floor(this.#h/40)%this.sprite.idle.length;if(this.#h>=80&&(this.#h=0),this.#n[i])return void e.drawImage(this.#n[i],0,0,32,32,this.x*t+s[0],this.y*t+s[1],t,t);const{canvas:h,context:n}=g(t,t),r=this.sprite.idle[i].length;for(let t=0;t<r;t++)for(let e=0;e<r;e++)n.fillStyle=this.colors[this.sprite.idle[i][t][e]],n.fillRect(e,t,1,1);this.#n[i]=h}clearCache(){this.#n=[]}}const v={};class m{sprite=[];colors={};constructor(t,e){this.x=t,this.y=e}draw(e){if(v[this.#r()])return void this.#o(e);const{canvas:s,context:i}=g(t,t),h=this.sprite.length;for(let t=0;t<h;t++)for(let e=0;e<h;e++)i.fillStyle=this.colors[this.sprite[t][e]],i.fillRect(e,t,1,1);v[this.#r()]=s,this.#o(e)}#r(){return this.constructor.name+(this.type??"")}#o(e){e.drawImage(v[this.#r()],0,0,32,32,this.x*t,this.y*t,t,t)}}class w extends m{sprite=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0],[0,0,0,0,0,1,5,5,5,5,1,0,0,0,0,0],[0,0,0,0,1,5,5,5,5,5,5,1,0,0,0,0],[0,0,0,1,4,5,5,5,5,5,5,4,1,0,0,0],[0,0,0,1,4,4,5,5,5,5,4,4,1,0,0,0],[0,0,1,3,4,4,4,4,4,4,4,4,3,1,0,0],[0,0,1,3,4,4,4,4,4,4,4,4,3,1,0,0],[0,0,1,3,3,4,4,4,4,4,4,3,3,1,0,0],[0,0,1,3,3,3,3,3,3,3,3,3,3,1,0,0],[0,0,0,1,3,3,3,3,3,3,3,3,1,0,0,0],[0,0,0,0,0,1,2,2,6,6,1,0,0,0,0,0]];colors={0:"rgba(0,0,0,0)",1:"#515151",2:"#d3a061",3:"#1a8425",4:"#239e1f",5:"#29b21c",6:"#99703b"}}class y extends m{sprite=[[0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,5,5,1,0,0,0,0,0,0],[0,0,0,0,0,0,1,5,5,1,0,0,0,0,0,0],[0,0,0,0,0,1,5,5,5,5,1,0,0,0,0,0],[0,0,0,0,0,1,5,5,5,5,1,0,0,0,0,0],[0,0,0,0,1,4,5,5,5,5,4,1,0,0,0,0],[0,0,0,0,1,4,4,5,5,4,4,1,0,0,0,0],[0,0,0,1,4,4,4,4,4,4,4,4,1,0,0,0],[0,0,0,1,4,4,4,4,4,4,4,4,1,0,0,0],[0,0,1,3,4,4,4,4,4,4,4,4,3,1,0,0],[0,0,1,3,3,4,4,4,4,4,4,3,3,1,0,0],[0,0,1,3,3,3,3,3,3,3,3,3,3,1,0,0],[0,0,0,1,3,3,3,3,3,3,3,3,1,0,0,0],[0,0,0,0,1,1,6,6,6,6,1,1,0,0,0,0],[0,0,0,0,0,1,2,2,2,2,1,0,0,0,0,0],[0,0,0,0,0,1,2,2,6,2,1,0,0,0,0,0]];colors={0:"rgba(0,0,0,0)",1:"#515151",2:"#d3a061",3:"#1a8425",4:"#239e1f",5:"#29b21c",6:"#99703b"}}class b extends m{sprite=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,1,1,0,0,0,0,1,1,0,0,0],[0,0,0,0,0,0,1,1,0,0,1,1,2,0,0,0],[0,0,0,0,0,2,1,1,1,0,1,2,0,0,0,0],[0,0,0,0,0,2,2,1,0,0,0,0,0,0,0,0],[0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,2,0,1,1,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];colors={0:"rgba(0,0,0,0)",1:"#1fa54a",2:"#1a8425"};constructor(t,e,s){super(t,e),this.type=s,"light"===s&&(this.colors[1]="#9bbc54",this.colors[2]="#66822a")}}class M extends m{sprite=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,2,2,0,0,2,2,0,0,2,0,0,0,0],[0,0,2,1,1,2,2,1,1,2,2,1,2,0,0,0],[0,0,2,1,1,1,2,1,1,1,2,1,2,0,0,0],[0,0,2,1,1,1,1,2,2,2,1,2,2,2,0,0],[0,0,2,1,1,1,1,1,2,1,1,1,2,2,0,0],[0,0,2,2,1,1,1,1,2,1,1,1,2,2,0,0],[0,0,0,2,1,1,1,2,2,1,1,2,2,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];colors={0:"rgba(0,0,0,0)",1:"#b3b3b3",2:"#989898"}}class x extends m{sprite=[[0,0,0,0,0,1,1,1,0,1,1,1,0,0,0,0],[0,0,0,0,1,3,2,1,1,2,2,1,0,0,0,0],[0,0,0,0,1,1,2,1,2,3,1,1,0,0,0,0],[0,0,0,1,3,1,3,2,2,3,1,3,1,0,0,0],[0,0,0,1,2,2,2,2,3,3,2,2,1,0,0,0],[0,0,1,1,1,3,2,2,3,3,2,1,1,1,0,0],[0,1,3,1,3,1,2,2,3,3,1,2,1,3,1,0],[0,1,2,2,2,1,2,2,3,3,1,2,2,2,1,0],[0,1,1,1,2,2,2,2,3,3,1,2,1,1,1,0],[1,3,1,3,1,3,2,2,3,3,2,3,2,1,3,1],[1,2,2,2,1,1,2,2,3,3,1,1,2,2,2,1],[0,1,1,2,2,3,2,2,3,3,3,2,2,1,1,0],[0,0,0,1,1,1,2,2,3,3,1,1,1,0,0,0],[0,0,0,0,0,1,2,2,3,3,1,0,0,0,0,0],[0,0,0,0,0,1,2,2,3,3,1,0,0,0,0,0],[0,0,0,0,0,1,2,2,3,3,1,0,0,0,0,0]];colors={0:"rgba(0,0,0,0)",1:"#515151",2:"#d3a061",3:"#99703b"}}class C extends m{sprite=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,1,2,3,1,0,0,0,0,0,0,0],[0,0,0,0,1,1,2,3,1,1,0,0,0,0,0,0],[0,0,0,1,2,1,2,3,1,2,1,0,0,0,0,0],[0,0,0,1,2,1,2,3,1,2,1,0,0,0,0,0],[0,0,0,1,2,2,2,3,2,2,1,0,0,0,0,0],[0,0,0,0,1,1,2,3,1,1,0,0,0,0,0,0],[0,0,0,0,0,1,2,3,1,0,0,0,0,0,0,0],[0,0,0,0,0,1,2,3,1,0,0,0,0,0,0,0]];colors={0:"rgba(0,0,0,0)",1:"#515151",2:"#b2b23a",3:"#878724"}}class D extends u{name="Swordman";sprite={idle:[[[0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,0],[0,0,0,0,0,4,1,1,1,4,0,0,0,4,0,0],[0,0,0,0,0,4,3,3,3,4,0,0,4,7,4,0],[0,0,0,0,0,4,2,2,2,4,0,0,4,7,4,0],[0,0,0,0,0,4,2,2,2,4,4,0,4,7,4,0],[0,4,4,4,4,4,3,2,3,3,3,4,4,7,4,0],[4,6,5,6,5,6,4,3,3,3,3,3,4,7,4,0],[4,5,6,5,6,5,4,3,3,3,4,3,4,7,4,0],[4,6,5,6,5,6,4,3,3,3,4,3,4,7,4,0],[4,5,6,5,6,5,4,3,3,3,4,3,4,6,4,0],[4,6,5,6,5,6,4,1,1,1,4,4,2,5,5,4],[4,5,6,5,6,5,4,1,1,1,4,0,4,6,4,0],[0,4,5,6,5,4,1,4,1,1,4,0,4,6,4,0],[0,0,4,4,4,1,1,4,1,1,4,0,0,4,0,0],[0,0,0,0,4,2,2,4,1,1,4,0,0,0,0,0],[0,0,0,0,0,0,0,4,2,2,4,0,0,0,0,0]],[[0,0,0,0,0,0,4,4,4,0,0,0,0,4,0,0],[0,0,0,0,0,4,1,1,1,4,0,0,4,7,4,0],[0,0,0,0,0,4,3,3,3,4,0,0,4,7,4,0],[0,0,0,0,0,4,2,2,2,4,0,0,4,7,4,0],[0,0,0,0,0,4,2,2,2,4,4,0,4,7,4,0],[0,4,4,4,4,4,3,2,3,3,3,4,4,7,4,0],[4,6,5,6,5,6,4,3,3,3,3,3,4,7,4,0],[4,5,6,5,6,5,4,3,3,3,4,3,4,7,4,0],[4,6,5,6,5,6,4,3,3,3,4,3,4,7,4,0],[4,5,6,5,6,5,4,3,3,3,4,3,2,5,5,4],[4,6,5,6,5,6,4,1,1,1,4,4,4,6,4,0],[4,5,6,5,6,5,4,1,1,1,4,0,4,6,4,0],[0,4,5,6,5,4,1,4,1,1,4,0,0,4,0,0],[0,0,4,4,4,1,1,4,1,1,4,0,0,0,0,0],[0,0,0,0,4,1,1,4,2,2,4,0,0,0,0,0],[0,0,0,0,4,2,2,4,0,0,0,0,0,0,0,0]]]};get colors(){return{0:"rgba(0,0,0,0)",1:"#5e5c57",2:"#f7d180",3:"#b1b1b1",4:"#171717",5:"ally"===this.type?"#d3a061":"#bc4e4e",6:"ally"===this.type?"#99703b":"#a43434",7:"#f4f4f4"}}}const O=new class{#a=[];#l=void 0;#c=void 0;#d=[];#p=void 0;#f=void 0;#g=null;#u=!1;#v=[0,0];#m=[0,0];#w=400;#y=[400,400];constructor(t){r(parseInt(100*Math.random()+50,10)),window.addEventListener("resize",this.resize.bind(this)),t.addEventListener("mousedown",this.handleMouseDown.bind(this)),t.addEventListener("mousemove",this.handleMouseMove.bind(this)),t.addEventListener("mouseup",this.handleMouseUp.bind(this)),t.addEventListener("touchstart",this.handleMouseDown.bind(this)),t.addEventListener("touchmove",this.handleMouseMove.bind(this)),t.addEventListener("touchend",this.handleMouseUp.bind(this)),this.resize()}resize(){const t=parseInt(window.innerWidth,10),e=parseInt(window.innerHeight,10);canvas.style.width=t,canvas.style.height=e,canvas.style.cursor="crosshair";const{context:s}=g(t,e,canvas);this.renderer=s,Math.abs(this.#v[0])>this.#y[0]&&(this.#y[0]=this.#y[0]+this.#w),Math.abs(this.#v[1])>this.#y[1]&&(this.#y[1]=this.#y[1]+this.#w),this.#b(t+this.#y[0],e+this.#y[1]);const{canvas:i,context:h}=g(t+this.#y[0],e+this.#y[1],this.#f);this.#f=i,this.#M(h);const{canvas:n,context:r}=g(t+this.#y[0],e+this.#y[1],this.#p);this.#p=n,this.#x(r)}handleMouseDown(e){const s=e.pageX??e.changedTouches[0].pageX,i=e.pageY??e.changedTouches[0].pageY;this.mouseX=Math.floor(s/t),this.mouseY=Math.floor(i/t),this.#u=!0,this.#m=[s-this.#v[0],i-this.#v[1]]}handleMouseUp(){this.#u=!1,(Math.abs(this.#v[0])>this.#y[0]||Math.abs(this.#v[1])>this.#y[1])&&this.resize(),this.handleClickEvent()}handleMouseMove(e){const s=e.pageX??e.changedTouches[0].pageX,i=e.pageY??e.changedTouches[0].pageY;this.mouseX=Math.floor(s/t),this.mouseY=Math.floor(i/t),this.#u&&(this.#v=[s-this.#m[0],i-this.#m[1]],this.#v[0]>=0&&(this.#v[0]=0),this.#v[1]>=0&&(this.#v[1]=0))}handleClickEvent(){const e=this.#a.filter((t=>"ally"===t.type)),s=Math.floor(Math.abs(this.#v[0]/t))+this.mouseX,i=Math.floor(Math.abs(this.#v[1]/t))+this.mouseY,h=this.#C(s,i,e.length,this.#l);for(const t of e){const[e,s]=h.shift();t.move(e,s)}}createMatrix(t,e,s,i){if(!i){return Array.from(Array(t),(()=>new Array(e).fill(s)))}const h=i.length,n=t-h,r=i[0].length,o=e-r;for(let t=0;t<h;t++)for(let e=r;e<r+o;e++)i[t]||(i[t]=[]),i[t][e]=s;for(let t=h;t<h+n;t++)for(let e=0;e<r;e++)i[t]||(i[t]=[]),i[t][e]=s;for(let t=h;t<h+n;t++)for(let e=r;e<r+o;e++)i[t]||(i[t]=[]),i[t][e]=s;return i}#b(e,s){const i=this.#c?.[0]?.length??0,r=this.#c?.length??0;this.#l=this.createMatrix(Math.floor(s/t),Math.floor(e/t),1,this.#l),this.#c=this.createMatrix(Math.ceil(s/4),Math.ceil(e/4),0,this.#c);const l=(t,e)=>100*function(t,e){var s=Math.floor(t),i=Math.floor(e);t-=s,e-=i;var r=n[(s&=255)+h[i&=255]].dot2(t,e),l=n[s+h[i+1]].dot2(t,e-1),c=n[s+1+h[i]].dot2(t-1,e),d=n[s+1+h[i+1]].dot2(t-1,e-1),p=o(t);return a(a(r,c,p),a(l,d,p),o(e))}(t/40,e/40)+10,c=Math.ceil(e/4)-i,p=Math.ceil(s/4)-r;for(let t=0;t<r;t++)for(let e=i;e<i+c;e++){const s=l(e,t);this.#c[t][e]=s,this.#D(e,t,s)}for(let t=r;t<r+p;t++)for(let e=0;e<i;e++){const s=l(e,t);this.#c[t][e]=s,this.#D(e,t,s)}for(let t=r;t<r+p;t++)for(let e=i;e<i+c;e++){const s=l(e,t);this.#c[t][e]=s,this.#D(e,t,s)}this.#g=new d(this.#l,{diagonal:!0});for(const t of this.#a)t.bind(this.#g,this.#a)}#D(t,e,s){const i=Math.floor(e/4),h=Math.floor(t/4);i<this.#l.length&&h<this.#l[0].length&&(s<-40&&(this.#l[i][h]=0),s>40&&(this.#l[i][h]=s),s>=20&&s<=20.4&&this.#d.push(new b(h,i,"light")),s<=-15&&s>=-15.5&&this.#d.push(new b(h,i)),s>=39&&s<=39.05&&this.#d.push(new M(h,i)),s>=11&&s<=11.05&&(this.#l[i][h]=0,this.#d.push(new x(h,i))),s>=20&&s<=20.05&&(this.#l[i][h]=0,this.#d.push(new C(h,i))),(s<=-15&&s>=-15.05||s<=-33&&s>=-33.08)&&(this.#l[i][h]=0,this.#d.push(new y(h,i))),(s<=-24&&s>=-24.05||s>=0&&s<=.08)&&(this.#l[i][h]=0,this.#d.push(new w(h,i))),(s>=1&&s<=1.002||s>=1.1&&s<=1.12)&&this.#O(h,i))}get grid(){return this.#l}addObstacle(t,e){this.#l[e][t]=0}add(t){t instanceof u&&(this.#a.push(t),t.bind(this.#g,this.#a))}#O(t,e){const s=()=>Math.floor(10*Math.random()),i=(t,e)=>{return(i=s()+t)>=e?e-1:i;var i},h=this.#l[0].length,n=this.#l.length,r=Array(s()+2).fill(null).map((()=>[i(t,h),i(e,n)])),o=new D(t,e,"enemy");o.patrol(...r),this.#a.push(o)}#E(e,s){this.renderer.beginPath(),this.renderer.ellipse(e*t+8,s*t+8,8,8,0,0,2*Math.PI),this.renderer.fillStyle="rgba(255, 255, 255, .5)",this.renderer.fill(),this.renderer.strokeStyle="rgba(0, 0, 0, .5)",this.renderer.stroke(),this.renderer.closePath()}loop(t){this.renderer.clearRect(0,0,this.renderer.canvas.clientWidth,this.renderer.canvas.clientHeight),this.renderer.drawImage(this.#f,2*-this.#v[0],2*-this.#v[1],2*this.renderer.canvas.clientWidth,2*this.renderer.canvas.clientHeight,0,0,this.renderer.canvas.clientWidth,this.renderer.canvas.clientHeight),this.renderer.drawImage(this.#p,2*-this.#v[0],2*-this.#v[1],2*this.renderer.canvas.clientWidth,2*this.renderer.canvas.clientHeight,0,0,this.renderer.canvas.clientWidth,this.renderer.canvas.clientHeight);for(const e of this.#a)e.step&&e.step(t),e.draw&&e.draw(this.renderer,this.#v);this.#E(this.mouseX,this.mouseY),window.requestAnimationFrame(this.loop.bind(this))}#M(t){const e=this.#c.length,s=this.#c[0].length;for(let h=0;h<e;h++)for(let e=0;e<s;e++)t.fillStyle=(i=this.#c[h][e])<=-60?"#0b1660":i>-60&&i<=-50?"#16247f":i>-50&&i<=-40?"#2e40b2":i>-40&&i<=-25?"#0b753e":i>-25&&i<=0?"#15913c":i>0&&i<=30?"#7b9b36":i>30&&i<=50?"#9ca092":i>50&&i<=60?"#c0c9ad":"#FFFFFF",t.fillRect(4*e,4*h,4,4);var i}#x(t){const e=this.#d.length;for(let s=0;s<e;s++)this.#d[s].draw(t)}#I(e){e.fillStyle="rgba(0,0,0,0.3)";for(let s=0;s<this.#l.length;s++)for(let i=0;i<this.#l[0].length;i++)0===this.#l[s][i]&&e.fillRect(this.#v[0]+i*t,this.#v[1]+s*t,t,t)}#C(t,e,s,i){const h=[[0,1],[1,0],[0,-1],[-1,0]];let n=e,r=t,o=0,a=1,l=0;const c=[];for(;c.length<s;)n>=0&&r>=0&&n<i.length&&r<i[0].length&&i[n][r]>0&&c.push([r,n]),n+=h[o][0],r+=h[o][1],l++,l===a&&(l=0,o=(o+1)%4,o%2==0&&a++);return c}}(document.getElementById("canvas")),E=new class extends u{health=15;name="King";sprite={idle:[[[0,0,0,0,0,1,1,2,2,1,1,0,0,0,0,0],[0,1,1,0,1,2,1,2,2,1,2,1,0,0,0,0],[1,7,7,1,1,2,1,2,2,1,2,1,0,0,0,0],[1,7,7,1,2,2,2,3,3,2,2,2,1,0,0,0],[1,7,7,1,4,4,3,3,3,3,4,4,1,0,0,0],[1,7,7,1,4,4,3,3,3,3,4,4,1,1,1,0],[1,7,7,1,1,4,1,3,3,1,4,1,10,4,10,1],[1,7,7,1,1,4,1,1,1,1,4,1,4,10,4,1],[1,7,7,1,5,5,5,1,1,5,5,1,10,4,10,1],[1,7,7,1,1,5,5,1,1,5,5,1,4,10,4,1],[9,9,9,9,1,5,5,5,5,5,5,1,10,4,10,1],[9,9,9,9,1,6,6,6,6,6,6,1,4,10,4,1],[1,8,8,1,1,8,8,8,8,8,8,1,10,4,10,1],[1,8,8,1,1,6,6,6,6,6,6,1,4,10,4,1],[1,8,8,1,1,6,6,1,1,6,6,1,10,4,10,1],[0,1,1,0,1,6,6,1,1,6,6,1,1,1,1,0]],[[0,1,1,0,0,1,1,2,2,1,1,0,0,0,0,0],[1,7,7,1,1,2,1,2,2,1,2,1,0,0,0,0],[1,7,7,1,1,2,1,2,2,1,2,1,0,0,0,0],[1,7,7,1,2,2,2,3,3,2,2,2,1,0,0,0],[1,7,7,1,4,4,3,3,3,3,4,4,1,0,0,0],[1,7,7,1,4,4,3,3,3,3,4,4,1,1,1,0],[1,7,7,1,1,4,1,3,3,1,4,1,10,4,10,1],[1,7,7,1,1,4,1,1,1,1,4,1,4,10,4,1],[1,7,7,1,5,5,5,1,1,5,5,1,10,4,10,1],[9,9,9,9,1,5,5,1,1,5,5,1,4,10,4,1],[9,9,9,9,1,5,5,5,5,5,5,1,10,4,10,1],[1,8,8,1,1,6,6,6,6,6,6,1,4,10,4,1],[1,8,8,1,1,8,8,8,8,8,8,1,10,4,10,1],[1,8,8,1,1,6,6,6,6,6,6,1,4,10,4,1],[0,1,1,0,1,6,6,1,1,6,6,1,10,4,10,1],[0,0,0,0,1,6,6,1,1,6,6,1,1,1,1,0]]]};colors={0:"rgba(0,0,0,0)",1:"#171717",2:"#fffc4c",3:"#f7d180",4:"#477def",5:"#d3a061",6:"#5e5c57",7:"#f4f4f4",8:"#b1b1b1",9:"#99703b",10:"#002577"}}(3,8);O.add(E);for(let t=5;t<7;t++)for(let e=6;e<11;e++){const s=new D(t,e);O.add(s)}for(let t=10;t<12;t++)for(let e=7;e<10;e++){const s=new D(t,e,"enemy");O.add(s)}O.loop()}();
