!function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(i,s,function(e){return t[e]}.bind(null,s));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=14)}([function(t,e,n){"use strict";n.r(e),n.d(e,"GOO_ID",(function(){return o})),n.d(e,"BULLET_ID",(function(){return h})),n.d(e,"PLAYER_ID",(function(){return l})),n.d(e,"DEFAULT_ID",(function(){return u})),n.d(e,"WALL_ID",(function(){return c})),n.d(e,"ALIEN_ID",(function(){return d})),n.d(e,"init",(function(){return w})),n.d(e,"drawColMap",(function(){return f})),n.d(e,"placeMeeting",(function(){return p})),n.d(e,"posMeeting",(function(){return g})),n.d(e,"colMaskAt",(function(){return m})),n.d(e,"boxMeeting",(function(){return b})),n.d(e,"colMaskInBox",(function(){return D}));var i,s,r=n(2),a=n(1);const o=8388608,h=4194304,l=32768,u=16384,c=128,d=64;function w(){i=document.createElement("canvas"),s=i.getContext("2d"),i.width=64,i.height=64,a.DEBUG&&document.body.append(i)}function f(t){s.fillStyle="black",s.globalCompositeOperation="source-over",s.fillRect(0,0,i.width,i.height),s.globalCompositeOperation="lighten",r.default.iterateChildren(t=>{t.collides&&t.isActive&&(s.fillStyle="#"+("000000"+t.collisionID.toString(16)).substr(-6,6),s.fillRect(t.x-~~(t.bbWidth/2),t.y-~~(t.bbHeight/2),t.bbHeight,t.bbWidth))},t)}function p(t,e,n,i){return b(t-~~(n.bbWidth/2),e-~~(n.bbHeight/2),n.bbWidth,n.bbHeight,i)}function g(t,e,n){return(m(t,e)&n)>0}function m(t,e){t=~~t,e=~~e;let n=s.getImageData(t,e,1,1).data;return n[0]<<16|n[1]<<8|n[2]}function b(t,e,n,i,s){return(D(t,e,n,i)&s)>0}function D(t,e,n,i){t=~~t,e=~~e,n=~~n,i=~~i;let r=s.getImageData(t,e,n,i).data,a=0;for(let t=0;t<r.length;t+=4)a=a|r[t]<<16|r[t+1]<<8|r[t+2];return a}},function(t,e,n){"use strict";n.r(e),n.d(e,"DEBUG",(function(){return d})),n.d(e,"level",(function(){return w})),n.d(e,"effectPool",(function(){return f})),n.d(e,"t",(function(){return p}));var i=n(4),s=n(3),r=n(5),a=n(0),o=n(2),h=n(6),l=(n(7),n(11)),u=n(12);window.onload=async function(){await i.init(),s.init(i.canvas),a.init(),r.init(),c=[],w=new u.default(0),f=new h.default(()=>new l.default(-123,-123,0,0,0),64),c.push(w),c.push(f),setInterval(g,1e3/30)};var c=[];const d=!1;var w,f,p=0;function g(){a.drawColMap(c),o.default.iterateChildren(t=>t.isActive?t.step():null,c),i.drawClear(),i.drawBackground(18),o.default.iterateChildren(t=>t.isActive?t.draw():null,c),o.default.iterateChildren(t=>t.isActive?t.lateDraw():null,c),i.drawImage(s.mouseX,s.mouseY,17),s.clearPresses(),p++}},function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return r}));var i=n(4),s=n(0);class r{constructor(t=0,e=0,n=-1,i=!1){this.x=t,this.y=e,this.imageIndex=n,this.rotation=0,this.isActive=!0,this.collides=i,this.collisionID=s.DEFAULT_ID,this.bbWidth=8,this.bbHeight=8}step(){}draw(){let t=Math.round(this.rotation/Math.PI*4)*Math.PI/4;Object(i.drawImage)(this.x,this.y,this.imageIndex,t)}lateDraw(){}children(){return null}static iterateChildren(t,e){if(e)for(let n of e)t(n),n.children&&r.iterateChildren(t,n.children())}}},function(t,e,n){"use strict";n.r(e),n.d(e,"mouseX",(function(){return a})),n.d(e,"mouseY",(function(){return o})),n.d(e,"init",(function(){return h})),n.d(e,"keyIsDown",(function(){return u})),n.d(e,"clearPresses",(function(){return c})),n.d(e,"keyIsPressed",(function(){return d}));var i=n(1),s={},r={},a=0,o=0;function h(t){t.onmousemove=e=>{a=(e.clientX-t.offsetLeft)*t.width/t.clientWidth,o=(e.clientY-t.offsetTop)*t.height/t.clientHeight},document.body.oncontextmenu=t=>{i.DEBUG||t.preventDefault()},l("left",[65,37]),l("right",[68,39]),l("up",[87,38]),l("down",[83,40]),l("exit",[27]),l("fire",[16,88,"mouse1"]),l("dash",[32,90]),l("place",["mouse2"]),l("1",[49]),l("2",[50]),l("3",[51]),l("4",[52])}function l(t,e){s[t]=!1,document.addEventListener("keydown",n=>{e.includes(n.keyCode)&&(i.DEBUG||n.preventDefault(),s[t]=!0,r[t]=!0)}),document.addEventListener("keyup",n=>{e.includes(n.keyCode)&&(i.DEBUG||n.preventDefault(),s[t]=!1)}),e.includes("mouse1")&&(document.addEventListener("mousedown",e=>{0==e.button&&(i.DEBUG||e.preventDefault(),s[t]=!0,r[t]=!0)}),document.addEventListener("mouseup",e=>{0==e.button&&(i.DEBUG||e.preventDefault(),s[t]=!1)})),e.includes("mouse2")&&(document.addEventListener("mousedown",e=>{2==e.button&&(i.DEBUG||e.preventDefault(),s[t]=!0,r[t]=!0)}),document.addEventListener("mouseup",e=>{2==e.button&&(i.DEBUG||e.preventDefault(),s[t]=!1)}))}function u(t){return!!s[t]}function c(){r={}}function d(t){return!!r[t]}},function(t,e,n){"use strict";var i,s;n.r(e),n.d(e,"canvas",(function(){return i})),n.d(e,"ctx",(function(){return s})),n.d(e,"colorLookupResolution",(function(){return o})),n.d(e,"colorLookup",(function(){return h})),n.d(e,"drawImage",(function(){return l})),n.d(e,"drawClear",(function(){return u})),n.d(e,"drawBackground",(function(){return c})),n.d(e,"drawText",(function(){return d})),n.d(e,"init",(function(){return w}));var r,a=[];const o=32;var h=[[[]]];function l(t,e,n,i=0,r=!0){n<0||(r&&(t=Math.round(t),e=Math.round(e)),(n%=a.length)>=a.length||(s.translate(t,e),s.rotate(i),s.translate(-4,-4),s.drawImage(a[n],0,0),s.resetTransform()))}function u(){s.fillStyle="#19191d",s.fillRect(0,0,i.width,i.height)}function c(t){for(let e=0;e<8;e++)for(let n=0;n<8;n++)l(8*n+4,8*e+4,t)}function d(t,e,n,i="white",r=8,a="left",o="top"){s.font="7px Altopixel",s.textAlign=a,s.textBaseline=o,s.fillStyle=i,s.fillText(n,t,e)}async function w(t=64,e=64){console.log("creating canvas"),i=document.createElement("canvas"),s=i.getContext("2d"),i.width=t,i.height=e;let n=document.querySelector("main");n.append(i),n.onresize=f,f(),console.log("loading images"),a=[],r=await p("sprites");for(let t=0;t<r.height;t+=8)for(let e=0;e<r.width;e+=8)a.push(g(e,t,8,8));console.log("prep palette");let l=document.createElement("canvas");l.width=r.width,l.height=r.height;let u=l.getContext("2d");u.drawImage(r,0,0);let c=u.getImageData(0,0,l.width,l.height).data,d=[];for(let t=0;t<c.length;t+=4){if(c[t+3]<255)continue;let e=c[t]<<16|c[t+1]<<8|c[t+2];-1==d.indexOf(e)&&d.push(e)}console.log(`colors: [${d.join(", ")}]`);const w=o;h=new Array(w).fill(0).map(()=>new Array(w).fill(0).map(()=>new Array(w).fill(0)));for(let t=0;t<w;t++)for(let e=0;e<w;e++)for(let n=0;n<w;n++){let i=t/(w-1),s=e/(w-1),r=n/(w-1),a=t=>(i-(t>>16&255)/255)**2+(s-(t>>8&255)/255)**2+(r-(255&t)/255)**2,o=d.reduce((t,e)=>a(t)<a(e)?t:e);h[t][e][n]=o}console.log("done")}function f(){let t=window.innerWidth/i.width,e=window.innerHeight/i.height,n=Math.floor(Math.min(t,e));i.style.width=n*i.width+"px",i.style.height=n*i.height+"px"}async function p(t,e="png"){let n=document.createElement("img");return n.src=`images/${t}.${e}`,await new Promise(t=>{n.onload=t}),n}function g(t,e,n,i,s=!1,a=!1){let o=document.createElement("canvas");o.width=n,o.height=i;let h=o.getContext("2d");return s&&h.scale(-1,1),a&&h.scale(1,-1),h.drawImage(r,-t-(s?n:0),-e-(a?i:0)),o}},function(t,e,n){"use strict";n.r(e),n.d(e,"init",(function(){return l})),n.d(e,"playCrash",(function(){return u}));let i=Math.random,s=Math.sin,r=Math.atan;const a=Math.PI;var o,h;function l(){o=new AudioContext,(h=o.createGain()).gain.setValueAtTime(.5,o.currentTime),h.connect(o.destination)}function u(t=1){let e=o.createBuffer(1,8e3,8e3),n=e.getChannelData(0),l=90+64*i();for(let e=0;e<8e3;e++){let i=e;e&=~(1<<~~(e/l));let o=1-e/2e3,h=s((1-e/8e3)**32*95);n[i]=r(h*o**5)/(a/2)*t,e=i}let u=o.createBufferSource();u.buffer=e,u.connect(h),u.start()}},function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return s}));var i=n(2);class s extends i.default{constructor(t,e){super(),this.instanciator=t,this.size=e,this.instances=[],this.pointer=0;for(let n=0;n<e;n++)this.instances.push(t())}getInstance(){let t=this.instances[this.pointer]=this.instances[this.pointer]||this.instanciator();return t.isActive=!0,this.pointer=(this.pointer+1)%this.size,t}children(){return this.instances}}},function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return u}));var i=n(2),s=n(3),r=n(6),a=n(10),o=n(5),h=n(1),l=n(0);class u extends i.default{constructor(t=0,e=0){super(t,e,0),this.collides=!0,this.collisionID=l.PLAYER_ID,this.bbWidth=4,this.bbHeight=4,this.bulletPool=new r.default(()=>new a.default(-123,-123,0,0),32),this.coolDown=0,this.dashing=!1,this.walkDirBuffer=0}step(){super.step();let t=1*Object(s.keyIsDown)("right")-1*Object(s.keyIsDown)("left"),e=1*Object(s.keyIsDown)("down")-1*Object(s.keyIsDown)("up");if(t**2+e**2>0&&(this.rotation=Math.atan2(e,t)),this.rotation=Math.atan2(s.mouseY-this.y,s.mouseX-this.x),0==t&&0==e||(this.walkDirBuffer=Math.atan2(e,t)),this.dashing=!1,Object(s.keyIsDown)("dash")&&this.coolDown<=0&&(this.dashing=!0,e=~~(20*Math.sin(this.walkDirBuffer)),t=~~(20*Math.cos(this.walkDirBuffer)),this.coolDown=12,o.playCrash()),Object(s.keyIsDown)("fire")&&this.coolDown<=0){let n=this.bulletPool.getInstance();n.reset(),n.x=this.x,n.y=this.y,n.ySpd=4*Math.sin(this.rotation),n.xSpd=4*Math.cos(this.rotation),t-=n.xSpd,e-=n.ySpd,this.coolDown=4,o.playCrash()}this.coolDown--,this.x=~~this.x,this.y=~~this.y;this.x,this.y;if(0!=t||0!=e){let n=0,i=0,s=0;for(;s<1e3;s++){let r=n/Math.max(Math.abs(t),.01);if(i/Math.max(Math.abs(e),.01)<r&&i<Math.abs(e)&&!this.meetsWallAt(this.x,this.y+Math.sign(e)))this.y+=Math.sign(e),i++;else if(n<Math.abs(t)&&!this.meetsWallAt(this.x+Math.sign(t),this.y))this.x+=Math.sign(t),n++;else{if(!(i<Math.abs(e))||this.meetsWallAt(this.x,this.y+Math.sign(e)))break;this.y+=Math.sign(e),i++}if(this.dashing&&s%6==0){let n=h.effectPool.getInstance(),i=~~(2*(1-s/(Math.abs(t)+Math.abs(e))));n.reset(this.x,this.y,32+i,6-i,2/3)}}}if(Object(l.placeMeeting)(this.x,this.y,this,l.ALIEN_ID)){h.effectPool.getInstance().reset(this.x,this.y,1,1,1/4);for(let t=0;t<3;t++){let t=()=>~~(8*Math.random()-4);h.effectPool.getInstance().reset(this.x+t(),this.y+t(),32,6,1/(7+t()))}this.isActive=!1}}meetsWallAt(t,e){let n=this.dashing?l.WALL_ID:l.WALL_ID|l.GOO_ID;return Object(l.placeMeeting)(t,e,this,n)}children(){return[this.bulletPool]}crtDebugEffect(t,e){h.effectPool.getInstance().reset(t,e,37,1,1/16)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return r}));var i=n(2),s=n(0);class r extends i.default{constructor(t,e){super(t,e,27,!0),this.bbWidth=6,this.bbHeight=6,this.rotation=.5*~~(4*Math.random())*Math.PI,this.collisionID=s.GOO_ID}}},function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return a}));var i=n(2),s=n(0),r=n(1);class a extends i.default{constructor(t,e){super(t,e,21,!0),this.collisionID=s.ALIEN_ID,this.bbHeight=6,this.bbWidth=6;let n=~~(4*Math.random())*Math.PI*.5;this.spdX=Math.round(Math.cos(n)),this.spdY=Math.round(Math.sin(n)),this.type=~~(2*Math.random())}step(){if(Object(s.placeMeeting)(this.x,this.y,this,s.BULLET_ID))for(let t=0;t<3;t++){let t=()=>~~(4*Math.random()-2);r.effectPool.getInstance().reset(this.x+t(),this.y+t(),5,2,1/(8+t())),this.isActive=!1}if(Object(s.placeMeeting)(this.x+this.spdX,this.y+this.spdY,this,s.WALL_ID|s.GOO_ID)){let t=this.spdX;if(0==this.type)this.spdX=-this.spdY,this.spdY=t;else{let t=Math.random()*Math.PI*2;this.spdX=Math.round(Math.cos(t)),this.spdY=Math.round(Math.sin(t))}}else this.x+=this.spdX,this.y+=this.spdY;this.imageIndex=8*this.type+21+~~(r.t/8)%2}}},function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return a}));var i=n(2),s=n(1),r=n(0);class a extends i.default{constructor(t,e,n,i){super(t,e,1),this.xSpd=n,this.ySpd=i,this.muzzle=-1,this.collides=!0,this.collisionID=r.BULLET_ID,this.bbHeight=4,this.bbWidth=4,this.reset()}reset(){this.muzzle=1,this.imageIndex=1}retire(){s.effectPool.getInstance().reset(this.x,this.y,24,3,2/3),this.reset(),this.isActive=!1,this.xSpd=0,this.ySpd=0}step(){super.step(),Object(r.placeMeeting)(this.x,this.y,this,r.WALL_ID|r.ALIEN_ID)&&this.retire(),this.x+=this.xSpd,this.y+=this.ySpd,0==this.muzzle&&this.imageIndex++,this.muzzle--}}},function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return s}));var i=n(2);class s extends i.default{constructor(t,e,n,i,s){super(t,e,n),this.startIndex=n,this.length=i,this.animSpeed=s,this.ind=0}retire(){this.isActive=!1}reset(t,e,n,i,s){this.x=t,this.y=e,this.startIndex=n,this.length=i,this.animSpeed=s,this.ind=0}step(){this.ind+=this.animSpeed,this.ind>=this.length&&this.retire(),this.imageIndex=~~(this.startIndex+this.ind)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return d}));var i=n(2),s=n(13),r=n(4),a=n(8),o=n(9),h=n(7),l=n(1),u=n(3);let c=[["w w w w w w w w","w ? . . . . ? w","w . . . p . . w","w . ? . . . . w","w . w w w w w w","w . . . . a . w","w ? . . . . ? w","w w w w w w w w","Use WASD, Mouse"],["w w w w w w w w","w p . w a . . w","w ? . . . w . w","w w w w w w . w","w . . a . a . w","w . w ? w ? w w","w . . . . . a w","w w w w w w w w","Kill to progess"],["w w w w w w w w","w ? . . . . ? w","w . . . p . . w","w ? . w w . ? w","w a . . . . a w","w . w . . w . w","w . . . . . . w","w w w w w w w w","SPACE to dash"],["w w w w w w w w","w ? . p . . ? w","w a . . . . a w","w . . ? ? . . w","w . . ? ? . . w","w . a . . a . w","w ? . . . . ? w","w w w w w w w w",""],["w w w w w w w w","w w a a a a w w","w . . w w . . w","w . ? . ? . . w","w . . ? . ? . w","w . ? . ? . . w","w w . p . . w w","w w w w w w w w",""],["w w w w w w w w","w . . . . w a w","w . . . . w w w","w . . . p . . w","w . . . . . . w","w w w . . . . w","w a w . . . . w","w w w w w w w w","YOU WIN Congrats!"]];class d extends i.default{constructor(t){super(),this.levelID=t,this.instances=[],this.levelEndCounter=0,this.data=c[t],l.DEBUG&&(this.textarea=document.createElement("textarea"),document.body.insertBefore(this.textarea,document.body.querySelector("main"))),this.reset()}reset(){this.instances=[],this.levelEndCounter=0,this.data=c[this.levelID],l.DEBUG&&(this.textarea.value=this.data.join("\n"),this.textarea.onchange=t=>{c[this.levelID]=this.textarea.value.split("\n"),this.reset()});for(let t=0;t<8;t++)for(let e=0;e<8;e++){let n=8*e+4,i=8*t+4,r=this.sampleLevelData(e,t);if("w"==r||"?"==r&&Math.random()<.5){let t=new s.default(n,i);this.instances.push(t)}else"g"==r?(this.instances.push(new a.default(n,i)),"g"==this.sampleLevelData(e+1,t)&&this.instances.push(new a.default(n+4,i)),"g"==this.sampleLevelData(e,t+1)&&this.instances.push(new a.default(n,i+4))):"a"==r?this.instances.push(new o.default(n,i)):"p"==r&&this.instances.push(new h.default(n,i))}}step(){let t=this.instances.filter(t=>t instanceof o.default&&t.isActive).length,e=this.instances.filter(t=>t instanceof h.default&&t.isActive).length;0!=t&&0!=e||this.levelEndCounter++,this.levelEndCounter>50&&(e>0?this.nextLevel():(this.levelID=0,this.reset())),l.DEBUG&&Object(u.keyIsPressed)("1")&&(this.levelID--,this.reset()),l.DEBUG&&Object(u.keyIsPressed)("2")&&(this.levelID++,this.reset())}nextLevel(){this.levelID++,this.reset()}sampleLevelData(t,e){return t<0||t>=8||e<0||e>=8?" ":this.data[e].charAt(2*t)}children(){return this.instances}lateDraw(){let t=this.data[8];Object(r.drawText)(1,2,t,"#eaeef1")}}},function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return r}));var i=n(2),s=n(0);class r extends i.default{constructor(t,e){super(t,e,~~(8+4*Math.random())),this.collides=!0,this.collisionID=s.WALL_ID}}},function(t,e,n){n(0),n(15),n(2),n(3),n(6),n(4),n(9),n(5),n(10),n(11),n(8),n(12),n(1),n(7),t.exports=n(13)},function(t,e,n){"use strict";function i(){}n.r(e),n.d(e,"processFont",(function(){return i}))}]);