zzfxV=.3;zzfx=(p=1,k=.05,b=220,e=0,r=0,t=.1,q=0,D=1,u=0,y=0,v=0,z=0,l=0,E=0,A=0,F=0,c=0,w=1,m=0,B=0)=>{let M=Math,R=44100,d=2*M.PI,G=u*=500*d/R/R,C=b*=(1-k+2*k*M.random(k=[]))*d/R,g=0,H=0,a=0,n=1,I=0,J=0,f=0,x,h;e=R*e+9;m*=R;r*=R;t*=R;c*=R;y*=500*d/R**3;A*=d/R;v*=d/R;z*=R;l=R*l|0;for(h=e+m+r+t+c|0;a<h;k[a++]=f)++J%(100*F|0)||(f=q?1<q?2<q?3<q?M.sin((g%d)**3):M.max(M.min(M.tan(g),1),-1):1-(2*g/d%2+2)%2:1-4*M.abs(M.round(g/d)-g/d):M.sin(g),f=(l?1-B+B*M.sin(d*a/l):1)*(0<f?1:-1)*M.abs(f)**D*p*zzfxV*(a<e?a/e:a<e+m?1-(a-e)/m*(1-w):a<e+m+r?w:a<h-c?(h-a-c)/t*w:0),f=c?f/2+(c>a?0:(a<h-c?1:(h-a)/c)*k[a-c|0]/2):f),x=(b+=u+=y)*M.cos(A*H++),g+=x-x*E*(1-1e9*(M.sin(a)+1)%2),n&&++n>z&&(b+=v,C+=v,n=0),!l||++I%l||(b=C,u=G,n=n||1);p=zzfxX.createBuffer(1,h,R);p.getChannelData(0).set(k);b=zzfxX.createBufferSource();b.buffer=p;b.connect(zzfxX.destination);b.start();return b};zzfxX=new(window.AudioContext||webkitAudioContext);const ctx=document.getElementById("canvas").getContext("2d");const PI=Math.PI;const pawnImg=new Image;const queenImg=new Image;const arrowImg=new Image;const zImg=new Image;const onekeyImg=new Image;const twokeyImg=new Image;const threekeyImg=new Image;const xkeyImg=new Image;const boardX=125;const boardY=200;const cellSize=50;pawnsrc="./imgs/p.png";queensrc="./imgs/q.png";arrowsrc="./imgs/arrow.png";zsrc="./imgs/z.png";onekeysrc="./imgs/1.png";twokeysrc="./imgs/2.png";threekeysrc="./imgs/3.png";xkeysrc="./imgs/x.png";let selectedPausedOption=3;const FLOOR=Math.floor;let selectedEndOption=3;let queenPiece;let isTransioning=0;let allPiece;let moveTo;let speed=5;const transitionSpeed=.06;let playerTurn=1;let alpha=0;let transitionTo;let selectedOption=3;let fired=false;let playerPieces=[];let time=0;let moveToo;let turn=0;let availableMoves=[];let queenMoveHistory=[];let start;let specialUI=[];let lock=false;let gamePhase=0;let doneCurse=0;let specialAnimation=0;let isEvaluating=0;pawnImg.src=pawnsrc;queenImg.src=queensrc;arrowImg.src=arrowsrc;zImg.src=zsrc;onekeyImg.src=onekeysrc;twokeyImg.src=twokeysrc;threekeyImg.src=threekeysrc;xkeyImg.src=xkeysrc;function parsePosition(n){return{y:180+40*FLOOR(n/7),x:130+50*(n%7)}}function shuffle(array){return array.sort((()=>Math.random()-.5))}const dir={ArrowUp:{x:0,y:-speed,p:-7},ArrowDown:{x:0,y:speed,p:7},ArrowRight:{x:speed,y:0,p:1},ArrowLeft:{x:-speed,y:0,p:-1}};function changeEndSelection(x){if(x){return selectedEndOption}else{if(selectedEndOption==3){selectedEndOption=0}else if(selectedEndOption==0){selectedEndOption=3}}}function changePauseSelection(x){if(x==undefined){return selectedPausedOption}else{selectedPausedOption=x}}function pauseScreen(){drawText("PAUSED",canvas.width/2,250,100,"white");if(selectedPausedOption==3){drawTextWithShadow("RESUME",canvas.width/2,350,50,"yellow");drawTextWithShadow("QUIT",canvas.width/2,410,50,"white")}else{drawTextWithShadow("RESUME",canvas.width/2,350,50,"white");drawTextWithShadow("QUIT",canvas.width/2,410,50,"yellow")}}function endScreen(z,y){ctx.beginPath();ctx.fillStyle=`rgba(0, 0, 0, 0.8)`;ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fill();ctx.closePath();if(!y){let c;let t;if(z<=0){c="green";t="you win!"}else{c="red";t="Game over"}drawText(t,canvas.width/2,250,100,c);drawText("Thanks for playing!",canvas.width/2,300,25,"white");if(selectedEndOption==3){drawTextWithShadow("Play Again?",canvas.width/2,400,50,"yellow");drawTextWithShadow("QUIT",canvas.width/2,460,50,"white")}else{drawTextWithShadow("Play Again?",canvas.width/2,400,50,"white");drawTextWithShadow("QUIT",canvas.width/2,460,50,"yellow")}}}class Piece{constructor(){}draw(){if(!this.init){this.init=1;this.x=parsePosition(this.boardPosition).x;this.y=parsePosition(this.boardPosition).y;this.currentHP=0;this.hpAnimate=this.maxHP;this.t=this.constructor.name.substring(0,1);this.direction=this.boardPosition;this.dy=0;this.dx=0;this.opacity=100;this.dead=0}this.x+=this.dx;this.y+=this.dy;if(this.hpAnimate==0){this.opacity>0?this.opacity-=10:this.opacity=0}if(this.opacity==0&&!this.dead){zzfx(...[1.5,,231,.09,.14,.4,1,1.35,,-2.8,,.1,.3,,,,,.79,.29]);this.dead=1}this.movePieceTo();this.attackAnimation();this.animateSpecial()}movePieceTo(){if(this.t=="Q"){if(this.direction!==this.boardPosition){let nD=parsePosition(this.direction);this.x!=nD.x?this.dx=-speed*Math.sign(this.x-nD.x):0;this.y!=nD.y?this.dy=.8*-speed*Math.sign(this.y-nD.y):0;if(this.x==nD.x&&this.y==nD.y){this.boardPosition=this.direction;this.dy=this.dx=0}}}else{if(this.direction!==this.boardPosition){let oD=parsePosition(this.boardPosition);if(this.x==oD.x&&this.y==oD.y){this.direction=this.boardPosition;this.dy=this.dx=0}}}}getScore(){let preCalc=this.t=="P"?1:-1;let modifier=this.hpAnimate>0?preCalc:0;return(this.hpAnimate+this.attack/.1)*modifier}animateHP(){this.hpAnimate<this.currentHP?this.currentHP-=2:0;this.hpAnimate>this.currentHP?this.currentHP+=2:0;this.currentHP<=0?this.currentHP=0:0;this.currentHP>=this.maxHP?this.currentHP=this.maxHP:0;this.hpAnimate<=0?this.hpAnimate=0:0;this.hpAnimate>=this.maxHP?this.hpAnimate=this.maxHP:0}animateSpecial(){if(this.playSpecial){let pieceCoords=parsePosition(this.boardPosition);this.dy==0?this.dy=-1:0;this.y<pieceCoords.y-25?this.dy=5:0;if(this.y>pieceCoords.y){this.dy=0;this.playSpecial=0;this.y=pieceCoords.y;specialAnimation=1}}}buffAttack(){if(this.t=="Q"){const ids=playerPieces.map((object=>object.currentHP));const max=Math.max(...ids);if(this.attack<max){specialUI.push({t:"a",v:10,l:this,y:this.y});this.playSpecial=1;zzfx(...[1.02,,93,,.24,.35,2,2,,,50,.05,.15,,,,,.83,.21,.09])}else{this.cursePiece()}}else{let diagonals=[-8,-7,-6,-1,0,1,6,7,8];let piecesToBuff=[];diagonals.forEach((f=>{let coord=this.boardPosition+f;if(coord>=0&&coord<=48&&parsePosition(this.boardPosition+f).x>=this.x-50&&parsePosition(this.boardPosition+f).x<=this.x+50){let fi=playerPieces.findIndex((i=>i.boardPosition==coord));if(fi>-1&&playerPieces[fi].hpAnimate>0){piecesToBuff.push(playerPieces[fi])}}}));return piecesToBuff}this.animateSpecial()}heal(){let healValue;if(this.t=="Q"){if(this.currentHP==this.maxHP){this.buffAttack()}else{healValue=20;specialUI.push({t:"h",v:healValue,l:this,y:this.y});this.playSpecial=1;this.animateSpecial();zzfx(...[1.79,,253,.1,.21,.42,,1.31,.1,,100,.15,.1,,,,.07,.87,.11,.44])}}else{let piecesToHeal=[];let diagonals=[-16,-16,-15,-14,-13,-12,-9,-8,-7,-6,-2,-1,0,1,2,6,7,8,9,12,13,14,15,16,16];diagonals.forEach((f=>{let coord=this.boardPosition+f;if(coord>=0&&coord<=48&&parsePosition(this.boardPosition+f).x>=this.x-50&&parsePosition(this.boardPosition+f).x<=this.x+50){let fi=playerPieces.findIndex((i=>i.boardPosition==coord));if(fi>-1){let ty;let val;if(playerPieces[fi].hpAnimate>0){if(playerPieces[fi].cursed==0){ty="h";val=Math.min(playerPieces[fi].maxHP-playerPieces[fi].currentHP,20)}else{ty="-c";val=1}piecesToHeal.push({t:ty,v:val,l:playerPieces[fi],y:playerPieces[fi].y})}}}}));return piecesToHeal}}attackAnimation(){let pieceCoords=parsePosition(this.boardPosition);let q;this.t=="P"?q=queenPiece:q=this.attackPiece;let targetCoords=parsePosition(q.boardPosition);if((this.attackingX||this.attackingY)&&specialUI.length==0){specialUI.push({t:"d",v:this.attack,l:q,y:q.y});specialAnimation=1}if(this.attackingY){if(this.dy==0){this.dy=.8*-speed*Math.sign(pieceCoords.y-targetCoords.y);this.dy==0?this.attackingY=0:0}else if(this.dy!=0){if(this.y>(pieceCoords.y+targetCoords.y)/2&&Math.sign(this.dy)>0){this.dy=.8*speed*Math.sign(pieceCoords.y-targetCoords.y)}if(this.y<(pieceCoords.y+targetCoords.y)/2&&Math.sign(this.dy)<0){this.dy=.8*speed*Math.sign(pieceCoords.y-targetCoords.y)}if(FLOOR(this.y)==pieceCoords.y){this.dy=0;this.attackingY=0}}}if(this.attackingX){if(this.dx==0){this.dx=-speed*Math.sign(pieceCoords.x-targetCoords.x);this.dx==0?this.attackingX=0:0}else if(this.dx!=0){if(this.x>(pieceCoords.x+targetCoords.x)/2&&Math.sign(this.dx)>0){this.dx=speed*Math.sign(pieceCoords.x-targetCoords.x)}if(this.x<(pieceCoords.x+targetCoords.x)/2&&Math.sign(this.dx)<0){this.dx=speed*Math.sign(pieceCoords.x-targetCoords.x)}if(Math.floor(this.x)==pieceCoords.x){this.dx=0;this.attackingX=0}}}}}class Moves extends Piece{constructor(p,owner){super();this.x=parsePosition(p).x;this.y=parsePosition(p).y;this.color=`${owner.color} opacity(50%)`;this.position=p}draw(){ctx.save();ctx.filter=this.color;ctx.drawImage(pawnImg,this.x,this.y);ctx.restore()}}class Queen extends Piece{constructor(boardPosition){super();this.boardPosition=boardPosition;this.maxHP=100;this.attack=20;this.attackPiece=this}draw(){super.draw();ctx.save();ctx.filter=`sepia(100%) brightness(100%) opacity(${this.opacity}%)`;ctx.drawImage(queenImg,this.x-5,this.y-20);ctx.restore();this.animateHP()}findLegalMoves(){let moves=[];let diagonals=[-8,-7,-6,-1,1,6,7,8];diagonals.forEach((f=>{let coord=this.boardPosition+f;if(coord>=0&&coord<=48&&parsePosition(this.boardPosition+f).x>=this.x-50&&parsePosition(this.boardPosition+f).x<=this.x+50){moves.push(coord)}}));return moves}cursePiece(){let max=-Infinity,strongPiece;playerPieces.forEach((function(v,k){if(v.currentHP>0){if(max<v.attack){max=v.attack;strongPiece=k}}}));specialUI.push({t:"c",l:playerPieces[strongPiece],s:1,o:1});this.playSpecial=1;this.animateSpecial();zzfx(...[,,629,.04,.25,.39,,.11,-6.6,,,,.17,,,.1,,.74,.16])}moveQueen(){if(!specialAnimation&&!playerTurn&&moveToo==undefined&&!isGameOver()){if(turn/3%5==0&&turn>0){this.cursePiece()}else if(turn/2%5==0&&turn>0){this.heal()}else if(turn%5==0&&turn>0){this.buffAttack()}else{isEvaluating=1;moveTo=findMove(this.findLegalMoves());isEvaluating=0;let pI=playerPieces.findIndex((i=>i.boardPosition===moveTo));if(pI<0||playerPieces[pI].hpAnimate==0){this.direction=moveTo;if(queenMoveHistory.length==2){queenMoveHistory.splice(1);queenMoveHistory.unshift(moveTo)}else{queenMoveHistory.unshift(moveTo)}zzfx(...[1.01,,288,.01,.01,.02,4,.82,-26,,,,,,,.1,,.13,.02])}else{zzfx(...[,,429,.02,.04,,3,2.08,4.1,-6.3,50,,,.2,,.3,,.6,.01,.26]);this.attackingX=1;this.attackingY=1;this.attackPiece=playerPieces[pI]}}playerTurn=1;doneCurse=0;playerPieces.forEach((z=>{if(z.hpAnimate==0){z.boardPosition=z.direction=-1}}))}}}class Pawn extends Piece{constructor(boardPosition,k){super();this.boardPosition=boardPosition;this.maxHP=100;this.key=k;this.selected=0;this.attack=this.key==3?20:10;this.cursed=0}draw(x=this.x,y=this.y,w=40,h=60,i=0){super.draw();let deg;this.key==1?deg=120:0;this.key==2?deg=0:0;this.key==3?deg=180:0;ctx.save();ctx.filter=this.color;if(!i){this.color=`brightness(75%) hue-rotate(${deg}deg)`;ctx.drawImage(pawnImg,this.x,this.y,w,h)}else{this.color=`brightness(80%) hue-rotate(${deg}deg) opacity(${this.opacity}%)`;ctx.drawImage(pawnImg,x,y,w,h)}ctx.restore();this.animateHP()}attackPiece(){let canAttack=false;let directions=[-8,-7,-6,-1,1,6,7,8];directions.forEach((f=>{let coord=this.boardPosition+f;if(coord>=0&&coord<=48&&queenPiece.boardPosition==coord&&parsePosition(this.boardPosition+f).x>=this.x-50&&parsePosition(this.boardPosition+f).x<=this.x+50){canAttack=true}}));return canAttack}findLegalMoves(){let legalMoves=[];let straights=[-7,7,-1,1];straights.forEach((f=>{let coord=this.boardPosition+f;let isOnTileIndex=allPiece.findIndex((i=>i.boardPosition==coord));let isAlive;if(isOnTileIndex==-1||allPiece[isOnTileIndex].animateHP>0){isAlive=1}if(coord>=0&&coord<=48&&parsePosition(this.boardPosition+f).x>=this.x-50&&parsePosition(this.boardPosition+f).x<=this.x+50&&isOnTileIndex==-1&&isAlive){legalMoves.push(coord)}}));return legalMoves}}canvas.onkeyup=function(){fired=false};function setupGame(){queenPiece=undefined;playerPieces=[];queenPiece=new Queen(10);playerPieces=[new Pawn(44,1),new Pawn(38,2),new Pawn(46,3)];playerTurn=1}canvas.addEventListener("keydown",(function(e){if(!fired){fired=true;if(gamePhase==-1){if(e.key=="Escape"){changeTransitionTo(3);zzfx(...[,,271,.01,,.02,1,.06,,,328,,,.2,,.1,,,.01])}else if(e.key=="ArrowUp"){zzfx(...[44,,121,.02,.04,.03,4,1.59,-.2,,,,.16,.3,270,,.11,.49,.01]);changePauseSelection(3)}else if(e.key=="ArrowDown"){zzfx(...[44,,121,.02,.04,.03,4,1.59,-.2,,,,.16,.3,270,,.11,.49,.01]);changePauseSelection(0)}if(e.key=="z"){zzfx(...[,,271,.01,,.02,1,.06,,,328,,,.2,,.1,,,.01]);changeTransitionTo(changePauseSelection())}}else if(gamePhase==0){if(e.key=="ArrowUp"||e.key=="ArrowDown"){zzfx(...[44,,121,.02,.04,.03,4,1.59,-.2,,,,.16,.3,270,,.11,.49,.01]);changeSelection()}if(e.key.toLowerCase()=="z"){zzfx(...[,,271,.01,,.02,1,.06,,,328,,,.2,,.1,,,.01]);setupGame();changeTransitionTo(changeSelection(1))}}else if(gamePhase==2.1||gamePhase==2.2){if(e.key.toLowerCase()=="z"){zzfx(...[,,271,.01,,.02,1,.06,,,328,,,.2,,.1,,,.01]);setupGame();changeTransitionTo(3)}gamePhase==2.1&&e.key=="ArrowRight"?(changeTransitionTo(2.2),zzfx(...[44,,121,.02,.04,.03,4,1.59,-.2,,,,.16,.3,270,,.11,.49,.01])):0;gamePhase==2.2&&e.key=="ArrowLeft"?(changeTransitionTo(2.1),zzfx(...[44,,121,.02,.04,.03,4,1.59,-.2,,,,.16,.3,270,,.11,.49,.01])):0}else if(gamePhase==3){if(playerTurn){if(e.key<4){zzfx(...[44,,121,.02,.04,.03,4,1.59,-.2,,,,.16,.3,270,,.11,.49,.01]);clearSelection();availableMoves=[];playerPieces.forEach((z=>{z.selected=0}));if(e.key==1&&playerPieces[e.key-1].hpAnimate){playerPieces[e.key-1].selected=1;playerPieces[e.key-1].findLegalMoves().forEach((m=>{availableMoves.push(new Moves(m,playerPieces[e.key-1]))}))}if(e.key==2&&playerPieces[e.key-1].hpAnimate){playerPieces[e.key-1].selected=1;playerPieces[e.key-1].findLegalMoves().forEach((m=>{availableMoves.push(new Moves(m,playerPieces[e.key-1]))}))}if(e.key==3&&playerPieces[e.key-1].hpAnimate){playerPieces[e.key-1].selected=1;playerPieces[e.key-1].findLegalMoves().forEach((m=>{availableMoves.push(new Moves(m,playerPieces[e.key-1]))}))}}if(e.key.toLowerCase()=="x"){if(playerPieces[0].selected){let piecesToHealCure=playerPieces[0].heal();piecesToHealCure.forEach((pHC=>{specialUI.push(pHC)}));playerPieces[0].playSpecial=1;lock=false;zzfx(...[1.79,,253,.1,.21,.42,,1.31,.1,,550,.15,.1,,,,.07,.87,.11,.44])}else if(playerPieces[1].selected){let piecesToBuff=playerPieces[1].buffAttack();if(piecesToBuff.length>0){piecesToBuff.forEach((b=>{let ve;b.boardPosition==playerPieces[1].boardPosition?ve=5:ve=10;specialUI.push({t:"a",v:ve,l:b,y:b.y})}))}playerPieces[1].playSpecial=1;lock=false;zzfx(...[1.02,,93,,.24,.35,2,2,,,-140,.05,.15,,,,,.83,.21,.09])}clearSelection()}let findSelectedIndex=playerPieces.findIndex((i=>i.selected==1));if(findSelectedIndex>=0){if(e.key=="ArrowUp"){movePiece(dir[e.key],findSelectedIndex)}if(e.key=="ArrowDown"){movePiece(dir[e.key],findSelectedIndex)}if(e.key=="ArrowLeft"){movePiece(dir[e.key],findSelectedIndex)}if(e.key=="ArrowRight"){movePiece(dir[e.key],findSelectedIndex)}if(e.key.toLowerCase()=="z"){let s=playerPieces[findSelectedIndex];if(s.attackPiece()){zzfx(...[,,429,.02,.04,,3,2.08,4.1,-6.3,50,,,.2,,.3,,.6,.01,.26]);playerPieces[findSelectedIndex].attackingY=1;playerPieces[findSelectedIndex].attackingX=1;lock=false;endMoves()}clearSelection()}}}if(e.key=="Escape"){clearSelection();changeTransitionTo(-1);changePauseSelection(3)}}else if(gamePhase==4){if(e.key=="ArrowUp"){zzfx(...[44,,121,.02,.04,.03,4,1.59,-.2,,,,.16,.3,270,,.11,.49,.01]);changeEndSelection()}else if(e.key=="ArrowDown"){zzfx(...[44,,121,.02,.04,.03,4,1.59,-.2,,,,.16,.3,270,,.11,.49,.01]);changeEndSelection()}if(e.key=="z"){setupGame();changeTransitionTo(changeEndSelection(1))}}}}));function clearSelection(){playerPieces.forEach((s=>{s.selected=0;availableMoves=[]}))}function step(timestamp){window.requestAnimationFrame(step);start?0:start=timestamp;const elapsed=timestamp-start;time=elapsed/1e3;ctx.clearRect(0,0,canvas.width,canvas.height);if(gamePhase==0){drawTitlePage()}else if(gamePhase==2.1){drawHelpPlayer()}else if(gamePhase==2.2){drawHelpEnemy()}else if(gamePhase==3||gamePhase==-1||gamePhase==4){drawBoard();if(isGameOver()&&gamePhase==3){changeTransitionTo(4)}allPiece=[...availableMoves,...playerPieces,queenPiece].sort((function(a,b){return a.y-b.y}));allPiece.forEach((e=>{e.draw()}));if(playerPieces.length>0&&queenPiece){drawInformationSection()}if(playerTurn==0&&time>.25){playerPieces.forEach((c=>{if(c.cursed>0&&c.hpAnimate>0&&specialUI.length==0&&!doneCurse){let v=c.cursed*5;specialUI.push({t:"d",v:v,l:c,y:c.y});specialAnimation=1}}));doneCurse=1;queenPiece.moveQueen();moveToo=undefined}if(specialAnimation&&specialUI.length>0){specialUI.forEach((u=>{let xPos=130+50*(u.l.boardPosition%7);let yPos=180+40*FLOOR(u.l.boardPosition/7);if(u.t=="c"){u.s+=10;u.o-=.03;drawText("☠️",xPos+25,yPos,u.s,`rgba(0,0,0,${u.o})`);drawText("CURSED",xPos+25,yPos+60,u.s,`rgba(225,0,0,${u.o+.2})`);if(u.o<=0){specialUI=[];u.l.cursed++;specialAnimation=0;endMoves()}}else if(u.t=="h"){u.y--;drawText(`❤️+${u.v}`,xPos+25,u.y,25,`green`);if(u.y==yPos-15){u.l.hpAnimate+=u.v}if(u.y<yPos-30){specialUI=[];specialAnimation=0;endMoves()}}else if(u.t=="d"){u.y--;drawText(`❤️-${u.v}`,xPos+25,u.y,25,`red`);if(u.y==yPos-5){u.l.hpAnimate-=u.v}if(u.y<yPos-30){specialAnimation=0;specialUI=[];endMoves()}}else if(u.t=="a"){u.y--;drawText(`⚔️+${u.v}`,xPos+25,u.y,30,`white`);if(u.y==yPos-15){u.l.attack+=u.v}if(u.y<=yPos-30){specialUI=[];specialAnimation=0;endMoves()}}else if(u.t=="-c"){u.y--;drawText(`☠️-${u.v}`,xPos+25,u.y,25,`green`);if(u.y==yPos-15){u.l.cursed-=u.v}if(u.y<yPos-30){specialUI=[];specialAnimation=0;endMoves()}}}))}if(gamePhase==4){endScreen(queenPiece.hpAnimate,isTransioning)}}screenFade()}function drawInformationSection(){for(let i=0;i<playerPieces.length;i++){const infoX=boardX-50+175*i;const dx=20;ctx.fillStyle="black";ctx.fillRect(infoX,boardY+cellSize*7-25,130,75);ctx.fillStyle="grey";ctx.fillRect(infoX,boardY+cellSize*7-25,130,20);drawText(`${playerPieces[i].currentHP} / ${playerPieces[i].maxHP}`,infoX+75,boardY+cellSize*7-16,25,"white");drawText(`⚔️${playerPieces[i].attack}`,infoX+75,boardY+cellSize*7+10,25,"white");let curseColor=playerPieces[i].cursed==0?"rgba(0,128,0,0.5)":"rgba(255,0,0,1)";drawText(`☠️${playerPieces[i].cursed}`,infoX+75,boardY+cellSize*7+36,20,curseColor);ctx.beginPath();ctx.strokeStyle="white";ctx.lineWidth=7;ctx.arc(infoX,boardY+cellSize*7-10,20,0,2*PI);ctx.stroke();playerPieces[i].selected?ctx.fillStyle="goldenrod":ctx.fillStyle="black";ctx.fill();if(playerPieces[i].currentHP/playerPieces[i].maxHP>.5){ctx.fillStyle="green"}else if(playerPieces[i].currentHP/playerPieces[i].maxHP>.2){ctx.fillStyle="goldenrod"}else{ctx.fillStyle="red"}ctx.fillRect(playerPieces[i].x-5,playerPieces[i].y-10,50*(playerPieces[i].currentHP/playerPieces[i].maxHP),5);playerPieces[i].draw(infoX-10,boardY+cellSize*7-25,dx,dx*1.5,1)}ctx.fillStyle="black";ctx.fillRect(boardX,boardY-cellSize*2,350,50);ctx.fillStyle="grey";ctx.fillRect(boardX,boardY-cellSize*2,350,20);if(queenPiece.currentHP/queenPiece.maxHP>.5){ctx.fillStyle="darkgreen"}else if(queenPiece.currentHP/queenPiece.maxHP>.2){ctx.fillStyle="goldenrod"}else{ctx.fillStyle="red"}ctx.fillRect(boardX,boardY-cellSize*2,350*(queenPiece.currentHP/queenPiece.maxHP),20);drawText(`${queenPiece.currentHP} / ${queenPiece.maxHP}`,boardX+175,boardY-cellSize*2+9,25,"white");drawText(`⚔️${queenPiece.attack}`,boardX+175,boardY-cellSize*2+36,25,"white");ctx.beginPath();ctx.strokeStyle="darkred";ctx.lineWidth=5;ctx.arc(boardX,boardY-cellSize*2+25,30,0,2*PI);ctx.stroke();ctx.fillStyle="black";ctx.fill();ctx.save();ctx.filter="sepia(100%) brightness(100%)";ctx.drawImage(queenImg,boardX-25,boardY-130);ctx.restore()}function findMove(x){let bestMove;let score=0;let bestScore=Infinity;shuffle(x);x.forEach((m=>{let pI=playerPieces[playerPieces.findIndex((i=>i.boardPosition===m))];if(pI){pI.hpAnimate-=queenPiece.attack;score+=queenPiece.getScore();playerPieces.forEach((p=>{score+=p.getScore()}));if(score<bestScore){bestScore=score;bestMove=m}pI.hpAnimate+=queenPiece.attack}else{let oP=queenPiece.boardPosition.toString();queenPiece.direction=queenPiece.boardPosition=m;score+=queenPiece.getScore();playerPieces.forEach((p=>{score+=p.getScore()}));queenPiece.direction=queenPiece.boardPosition=parseInt(oP);if(score<bestScore&&queenMoveHistory.indexOf(m)==-1){bestScore=score;bestMove=m}}score=0}));return bestMove}function movePiece(v,c){let s=playerPieces[c];let ind=allPiece.findIndex((i=>i.boardPosition==s.boardPosition+v.p));let isAlive;if(ind==-1||allPiece[ind].animateHP>0){isAlive=1}if(availableMoves.findIndex((i=>i.position==s.boardPosition+v.p))>=0&&ind==-1&&isAlive){s.dy=v.y;s.dx=v.x;s.selected=0;s.boardPosition+=v.p;lock=false;zzfx(...[1.01,,288,.01,.01,.02,4,.82,-26,,,,,,,.1,,.13,.02]);endMoves()}clearSelection()}function endMoves(){if(playerTurn&&!lock){turn++;playerTurn=0;time=0;start=0;lock=true}}function isGameOver(){let queenHealth=queenPiece.hpAnimate;let sumOfAllPlayerHealth=0;playerPieces.forEach((h=>{sumOfAllPlayerHealth+=h.hpAnimate}));if(!isEvaluating&&(queenHealth==0||sumOfAllPlayerHealth==0)){return true}else{return false}}function changeSelection(x){if(x){return selectedOption}else{if(selectedOption==3){selectedOption=2.1}else if(selectedOption==2.1){selectedOption=3}}}function drawTitlePage(){const TITLE="HIGH TREASON";drawTextWithShadow(TITLE,canvas.width/2,250,90);let leftButtonX=200;let leftButtonY=475;drawImage(arrowImg,leftButtonX,leftButtonY,180);drawImage(arrowImg,leftButtonX+24,leftButtonY);drawTextWithShadow("SELECT",leftButtonX+25,leftButtonY+35,25,"white");drawImage(zImg,leftButtonX+150,leftButtonY,180);drawTextWithShadow("confirm",leftButtonX+165,leftButtonY+35,25,"white");if(selectedOption==3){drawTextWithShadow("PLAY",canvas.width/2,345,70,"yellow");drawTextWithShadow("HELP",canvas.width/2,405,50,"white")}else{drawTextWithShadow("PLAY",canvas.width/2,345,70,"white");drawTextWithShadow("HELP",canvas.width/2,405,50,"yellow")}}function drawImage(src,x,y,deg=0){ctx.save();ctx.translate(x+src.width/2,y+src.width/2);ctx.rotate(rads(deg));ctx.translate(-x-src.width/2,-y-src.width/2);ctx.drawImage(src,x,y);ctx.restore()}function screenFade(){if(isTransioning){if(gamePhase==3&&transitionTo==-1||transitionTo==4){if(alpha<.8){alpha+=transitionSpeed}else{gamePhase=transitionTo;isTransioning=0}}else if(gamePhase==-1&&transitionTo==3){if(alpha>0){alpha-=transitionSpeed}else{gamePhase=transitionTo;isTransioning=0}}else{if(alpha<=2){alpha+=transitionSpeed}else if(alpha>2){gamePhase=transitionTo;isTransioning=0}}}if(!isTransioning){if(gamePhase!=-1){if(alpha>=0){alpha-=.06;transitionTo=undefined}}}if(gamePhase==-1){if(transitionTo==0){pauseScreen();fade(alpha)}else{fade(alpha);pauseScreen()}}else{fade(alpha)}}function changeTransitionTo(x){transitionTo=x;isTransioning=1}function fade(ap){ctx.beginPath();ctx.fillStyle=`rgba(0, 0, 0, ${ap})`;ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fill();ctx.closePath()}function drawBoard(){const bColor="#a9a9a9";const wColor="#000000";ctx.beginPath();ctx.strokeStyle="black";ctx.lineWidth=10;ctx.strokeRect(boardX,boardY,350,280);for(let i=0;i<7;i++){for(let j=0;j<7;j++){ctx.fillStyle=(i+j)%2==0?bColor:wColor;ctx.fillRect(boardX+cellSize*i,boardY+j*cellSize*.8,cellSize,cellSize-10)}}}function drawText(text,centerX,centerY,fontsize,color="#333"){ctx.save();ctx.font=`${fontsize}px p`;ctx.textAlign="center";ctx.fillStyle=color;ctx.textBaseline="middle";ctx.fillText(text,centerX,centerY);ctx.restore()}function drawTextWithShadow(text,centerX,centerY,fontsize,color="white"){drawText(text,centerX,centerY+fontsize/10,fontsize,"black");drawText(text,centerX,centerY,fontsize,color)}function rads(d){return d*.01745}function drawHelpPlayer(){let pieceX=100;drawText("PAWNS",canvas.width/2,170,100,"black");drawText("PAWNS",canvas.width/2,165,100,"white");let leftButtonX2=canvas.width/2-220;let leftButtonY2=230;drawImage(onekeyImg,leftButtonX2,leftButtonY2);drawImage(twokeyImg,leftButtonX2+20,leftButtonY2);drawImage(threekeyImg,leftButtonX2+42,leftButtonY2);drawText("select piece",leftButtonX2+35,leftButtonY2+35,20,"white");drawImage(zImg,leftButtonX2+157,leftButtonY2,180);drawText("attack",leftButtonX2+170,leftButtonY2+35,20,"white");drawImage(xkeyImg,leftButtonX2+285,leftButtonY2,180);drawText("special",leftButtonX2+300,leftButtonY2+35,20,"white");drawImage(arrowImg,leftButtonX2+390,leftButtonY2,270);drawImage(arrowImg,leftButtonX2+410,leftButtonY2,180);drawImage(arrowImg,leftButtonX2+410,leftButtonY2-20);drawImage(arrowImg,leftButtonX2+430,leftButtonY2,90);drawText("movement",leftButtonX2+430,leftButtonY2+35,20,"white");ctx.save();ctx.filter="brightness(75%) hue-rotate(180deg)";ctx.drawImage(pawnImg,pieceX,280-pawnImg.height/2+50);ctx.restore();drawText("NO specials - STARTS WITH 20 ATTACK",canvas.width/2+pieceX/3,280+50,20,"white");ctx.save();ctx.filter="brightness(75%) hue-rotate(120deg)";ctx.drawImage(pawnImg,pieceX,350-pawnImg.height/2+50);ctx.restore();drawText("CAN REMOVE CURSES AND HEAL OTHER PIECES",canvas.width/2+pieceX/2,345+50,20,"white");drawText("WITHIN A 2 TILE RANGE",canvas.width/2-34,360+50,20,"white");ctx.save();ctx.filter="brightness(75%) hue-rotate(0deg)";ctx.drawImage(pawnImg,pieceX,420-pawnImg.height/2+50);ctx.restore();drawText("CAN INCREASE PIECE ATTACK",canvas.width/2-pieceX/5,420+50,20,"white");let leftButtonY=525;drawImage(zImg,canvas.width/2,leftButtonY,180);drawTextWithShadow("play",canvas.width/2+12,leftButtonY+35,25,"yellow");drawImage(arrowImg,canvas.width/2+150,leftButtonY,90);drawTextWithShadow("next",canvas.width/2+163,leftButtonY+35,25,"yellow")}function drawHelpEnemy(){drawText("QUEEN",canvas.width/2,170,100,"black");drawText("QUEEN",canvas.width/2,165,100,"white");drawText("KILL THE EVIL QUEEN PIECE!",canvas.width/2,225,25,"yellow");drawText("THE QUEEN HAS AN ATTACK RANGE OF 1 SQUARE",canvas.width/2,250,20,"white");drawText("The queen can use the following SPECIAL ATTACKS:",canvas.width/2,300,20,"white");drawText("Self Buff: INCREASE ATTACK",canvas.width/2,340,22,"white");drawText("Curse: APPLIES DAMAGE OVER TIME TO PIECES",canvas.width/2,375,22,"white");drawText("INCREASES DAMAGE OVER TIME IF ALREADY CURSED",canvas.width/2,392,22,"white");drawText("Heal: RESTORES SOME HEALTH",canvas.width/2,440,22,"white");let leftButtonY=475;drawImage(zImg,canvas.width/2,leftButtonY,180);drawTextWithShadow("play",canvas.width/2+12,leftButtonY+35,25,"yellow");drawImage(arrowImg,canvas.width/2-150,leftButtonY,-90);drawTextWithShadow("Prev",canvas.width/2-137,leftButtonY+35,25,"yellow")}step();