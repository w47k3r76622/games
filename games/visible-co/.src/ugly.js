function q(s){var t,a=[1,0,0];t==r&&(t=new e(16));var n=a,i=G;i==r&&(i=new e(3)),a=1/Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]),i[0]=n[0]*a,i[1]=n[1]*a,i[2]=n[2]*a;var a=i,n=a[0],i=a[1],a=a[2],c=Math.cos(s),o=1-c;return s=Math.sin(s),t[0]=n*n*o+c,t[1]=i*n*o+a*s,t[2]=a*n*o-i*s,t[3]=0,t[4]=n*i*o-a*s,t[5]=i*i*o+c,t[6]=i*a*o+n*s,t[7]=0,t[8]=n*a*o+i*s,t[9]=i*a*o-n*s,t[10]=a*a*o+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function L(e){var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=0;if(n[0]=e[5]*e[10]*e[15]-e[5]*e[11]*e[14]-e[9]*e[6]*e[15]+e[9]*e[7]*e[14]+e[13]*e[6]*e[11]-e[13]*e[7]*e[10],n[4]=-e[4]*e[10]*e[15]+e[4]*e[11]*e[14]+e[8]*e[6]*e[15]-e[8]*e[7]*e[14]-e[12]*e[6]*e[11]+e[12]*e[7]*e[10],n[8]=e[4]*e[9]*e[15]-e[4]*e[11]*e[13]-e[8]*e[5]*e[15]+e[8]*e[7]*e[13]+e[12]*e[5]*e[11]-e[12]*e[7]*e[9],n[12]=-e[4]*e[9]*e[14]+e[4]*e[10]*e[13]+e[8]*e[5]*e[14]-e[8]*e[6]*e[13]-e[12]*e[5]*e[10]+e[12]*e[6]*e[9],n[1]=-e[1]*e[10]*e[15]+e[1]*e[11]*e[14]+e[9]*e[2]*e[15]-e[9]*e[3]*e[14]-e[13]*e[2]*e[11]+e[13]*e[3]*e[10],n[5]=e[0]*e[10]*e[15]-e[0]*e[11]*e[14]-e[8]*e[2]*e[15]+e[8]*e[3]*e[14]+e[12]*e[2]*e[11]-e[12]*e[3]*e[10],n[9]=-e[0]*e[9]*e[15]+e[0]*e[11]*e[13]+e[8]*e[1]*e[15]-e[8]*e[3]*e[13]-e[12]*e[1]*e[11]+e[12]*e[3]*e[9],n[13]=e[0]*e[9]*e[14]-e[0]*e[10]*e[13]-e[8]*e[1]*e[14]+e[8]*e[2]*e[13]+e[12]*e[1]*e[10]-e[12]*e[2]*e[9],n[2]=e[1]*e[6]*e[15]-e[1]*e[7]*e[14]-e[5]*e[2]*e[15]+e[5]*e[3]*e[14]+e[13]*e[2]*e[7]-e[13]*e[3]*e[6],n[6]=-e[0]*e[6]*e[15]+e[0]*e[7]*e[14]+e[4]*e[2]*e[15]-e[4]*e[3]*e[14]-e[12]*e[2]*e[7]+e[12]*e[3]*e[6],n[10]=e[0]*e[5]*e[15]-e[0]*e[7]*e[13]-e[4]*e[1]*e[15]+e[4]*e[3]*e[13]+e[12]*e[1]*e[7]-e[12]*e[3]*e[5],n[14]=-e[0]*e[5]*e[14]+e[0]*e[6]*e[13]+e[4]*e[1]*e[14]-e[4]*e[2]*e[13]-e[12]*e[1]*e[6]+e[12]*e[2]*e[5],n[3]=-e[1]*e[6]*e[11]+e[1]*e[7]*e[10]+e[5]*e[2]*e[11]-e[5]*e[3]*e[10]-e[9]*e[2]*e[7]+e[9]*e[3]*e[6],n[7]=e[0]*e[6]*e[11]-e[0]*e[7]*e[10]-e[4]*e[2]*e[11]+e[4]*e[3]*e[10]+e[8]*e[2]*e[7]-e[8]*e[3]*e[6],n[11]=-e[0]*e[5]*e[11]+e[0]*e[7]*e[9]+e[4]*e[1]*e[11]-e[4]*e[3]*e[9]-e[8]*e[1]*e[7]+e[8]*e[3]*e[5],n[15]=e[0]*e[5]*e[10]-e[0]*e[6]*e[9]-e[4]*e[1]*e[10]+e[4]*e[2]*e[9]+e[8]*e[1]*e[6]-e[8]*e[2]*e[5],det=e[0]*n[0]+e[1]*n[4]+e[2]*n[8]+e[3]*n[12],0==det)return t;for(det=1/det,r=0;16>r;r++)n[r]*=det;return n}function i(e){return data[e]="",function(t,n){var e=new XMLHttpRequest;e.onreadystatechange=function(){4==e.readyState&&(data[t]=e.responseText,loadingCount-=1)},e.open("GET",n,s),e.send()}(e,e),loadingCount+=1,e}function rt(){var t,e;return{J:function(n){e=t=n||Math.round(4294967296*Math.random())},M:function(){return t},I:function(){return e=(1664525*e+1013904223)%4294967296,e/4294967296}}}function a(t,n,e){return t>e?t:e>n?n:e}function D(a,e){for(key in e){var n=gl.getUniformLocation(a,key),r=typeof e[key];"undefined"!=r&&("atlas"==key?gl.uniform1i(n,e[key]):"number"==r?gl.uniform1f(n,e[key]):16==e[key].length?gl.uniformMatrix4fv(n,t,e[key]):(f=["uniform2fv","uniform3fv","uniform4fv"][e[key].length-2],gl[f](n,e[key])))}}function m(t,n){var e=t?t:gl.createBuffer();return gl.bindBuffer(gl.ARRAY_BUFFER,e),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(n),gl.STATIC_DRAW),e.length=n.length,e}function S(e){gl.useProgram(shaders[e][0]),D(shaders[e][0],scene.B),D(shaders[e][0],{time:.001*scene.time,mvc:scene.G})}function M(e){0<e.length&&(gl.bindBuffer(gl.ARRAY_BUFFER,e),gl.vertexAttribPointer(shaders[b][1],3,gl.FLOAT,t,24,0),gl.vertexAttribPointer(shaders[b][2],3,gl.FLOAT,t,24,12),gl.drawArrays(gl.TRIANGLES,0,e.length/6))}function _(e,n,r,t){t||(t=99999);var a=n+128*r;e.n[e.n.length]=[a,n,r,t,0],e.v[a]=s}function P(a,i){for(var n=-1,r=0,e=0;4>e;e++){var t=a.map[i+E[e]];t>=10&&t>r&&(r=t,n=e)}return O[n]}function g(a,l,f){function v(n,r,a){if(!(0>n||0>r||n>128||r>128)){var t=I(n,r);isValid(d[t])&&!(e[t]>=a)&&!(c[t]&&c[t]>=a)&&(e[t]=a,o[o.length]=[t,n,r,a,Math.abs(l-n)+Math.abs(f-r)],c[t]=a)}}var e=a.map,o=a.n,c=a.v;I=a.D;var d=a.L;isValid=a.F;var h=I(l,f);if(e[h])return P(a,h);for(var u=0;0<o.length&&1e5>u;){var u=u+1,r=o.pop();c[r[0]]=t,a.q[r[0]]+=1;for(var n=1,s=0;4>s;s++){var i=r[0]+E[s];e[i]&&e[i]>n&&(n=e[i])}if(n-=1,0==n)e[r[0]]=r[3],n=r[3];else{if(e[r[0]]>n)continue;e[r[0]]=n}for(n-=1,s=0;4>s;s++)i=r[0]+E[s],(!e[i]||e[i]<n)&&v(i%128,i/128|0,n-1);if(o.sort(function(e,t){return t[3]!=e[3]?e[3]-t[3]:t[4]-e[4]}),h==r[0])break}return P(a,h)}function nt(){function h(r){for(var n=0,e=0;64>e;e++)for(var t=0;64>t;t++)r(t,e,n),n+=4}function t(e,n,a,i,t){o[e+0]=n,o[e+1]=a,o[e+2]=i,t==r&&(t=255),o[e+3]=t}function c(e,t){n=(rnd.I()-.5)*t|0,o[e+0]+=n,o[e+1]+=n,o[e+2]+=n}function l(e){for(ctx.putImageData(y,64*(e%8),64*(e/8|0)),e=0;e<o.length;e++)o[e]=0}function b(e,n,r,a,i,s){(Math.abs(64-e-n)<floorCrossWidth||Math.abs(e-n)<floorCrossWidth||e>floorSquareDistance&&64-floorSquareDistance>e&&n>floorSquareDistance&&64-floorSquareDistance>n)&&t(r,a,i,s)}function s(n,r,a,e){h(function(s,o,i){t(i,195,195,204),e(s+1,o+2,i,123,127,131),e(s-1,o-2,i,203,207,211),e(s,o,i,n,r,a),c(i,10)}),l(floorI),floorI+=1}function g(e,n,r,a,i,s){(Math.abs(64-e-n)<floorCrossWidth||Math.abs(e-n)<floorCrossWidth||floorSquareDistance*floorSquareDistance>(n-32)*(n-32)+(e-32)*(e-32))&&t(r,a,i,s)}function f(e,n,a,i,s,o){var r=Math.round(Math.sqrt((n-32)*(n-32)+(e-32)*(e-32)));((Math.abs(64-e-n)<floorCrossWidth||Math.abs(e-n)<floorCrossWidth)&&r>floorSquareDistance-1||floorSquareDistance>r&&5>r%8)&&t(a,i,s,o)}var y=id,o=d;floorCrossWidth=6,floorSquareDistance=15,h(function(e,n,r){t(r,2>e?255:0,2>n?255:30,30)}),l(1),rnd=rt(),rnd.J(46),floorI=0,s(143,147,151,b),floorI+=1,s(173,177,181,b),floorCrossWidth=3,floorSquareDistance=16,floorI=4,s(100,100,100,g),floorI=8,s(103,207,191,g),s(207,103,101,g),s(50,50,50,g),floorSquareDistance=18,s(103,207,191,f),s(207,103,101,f),s(207,193,101,f),s(50,50,50,f),s(100,100,100,f),h(function(e,n,r){t(r,173-1.5*n,177-1.5*n,181-1.5*n),n>41&&51>n&&(e=n-44-3*Math.sin(.5*e)|0,e=e>0&&3>e,t(r,e?225:10,e?225:40,e?225:185),c(r,50)),c(r,10)}),l(6),h(function(r,e,n){t(n,173-e,177-e,181-e),c(n,10)}),l(7),colors=[[.1,.9,1,324,12],[.2,1,.8,400,16],[.1,.5,.8,256,12],[.2,.5,.8,324,14],[1,.4,.1,324,12],[.8,.5,.2,400,16],[.8,.2,.1,256,12],[.7,.2,.1,324,14]];for(var e in colors)color=colors[e],h(function(r,e,a){_x=Math.abs(r-32),_y=e-30,r=e>4&&60>e?Math.max(e>20?color[4]-_x:0,.9*(color[3]-(_x*_x+_y*_y))):-1;var n=10*r+30;n>255&&(n=10*Math.sqrt(n-255)+255),t(a,color[0]*n,color[1]*n,color[2]*n,r>0?255:0),r>0&&((e>20&&24>e&&_x>5&&9>_x||35==e&&6>_x)&&t(a,0,0,0,255),c(a,35))}),l(24|e);for(bubbles=[4,54,3,14,44,6,44,32,16,41,16,14,20,26,11,23,14,8],texts=["",1,0,"%F0%9F%98%A8",2.5,5,"X_X",1.5,8,"zzzZZ",1.5,15,"%E2%98%B9",2.5,5,"%E2%98%BA",3.5,10,":|",2.5,0],e=0;e<texts.length;e+=3){for(var a=0;a<bubbles.length;a+=3)h(function(e,n,r){_x=e-bubbles[a+0],_y=n-bubbles[a+1],e=_x-2,n=bubbles[a+2],n*n>e*e+_y*_y&&t(r,0,0,0),e=_x+2,n=bubbles[a+2],n*n>e*e+_y*_y&&t(r,0,0,0),e=_y-2,n=bubbles[a+2],n*n>_x*_x+e*e&&t(r,0,0,0),e=_y+2,n=bubbles[a+2],n*n>_x*_x+e*e&&t(r,0,0,0)});for(a=0;a<bubbles.length;a+=3)h(function(e,r,n){_x=e-bubbles[a+0],_y=r-bubbles[a+1],e=bubbles[a+2],e*e>_x*_x+_y*_y&&t(n,235,235,235),c(n,20)});ctx.save(),ctx.scale(texts[e+1],texts[e+1]),text=decodeURIComponent(texts[e]);var i=e/3;l(i+32),ctx.fillText(text,(64*i+28-texts[e+2])/texts[e+1],284/texts[e+1]),ctx.fillText(text,(64*i+29-texts[e+2])/texts[e+1],284/texts[e+1]),ctx.fillText(text,(64*i+28-texts[e+2])/texts[e+1],285/texts[e+1]),ctx.fillText(text,(64*i+29-texts[e+2])/texts[e+1],285/texts[e+1]),ctx.restore()}for(var v=[[200,30,20,0],[200,30,20,1.570796326795],[200,30,20,3.14159265359],[200,30,20,3.14159265359*1.5],[30,160,20,0]],u=0;u<v.length;u++)h(function(i,n,r){var e=i+n/5,a=3*Math.sin(.5*e+v[u][3]);n+a>15&&35>n+a&&e>25&&55>e&&(e=a+.2*n,t(r,10*e+v[u][0],10*e+v[u][1],10*e+v[u][2]),c(r,15)),e=3-Math.abs(i-(25-n/5)),e>=0&&n>10&&54>n&&(13>n&&(e=13-n),n>51&&(e=n-51),e=20+30*e,t(r,e,e,e)),c(r,15)}),l(16+u);for(e=[],i=-1;8>i;i++){var m=44*((i+2)/10)-22;if(e[e.length]=[15*Math.sin(2*m),m],!(0>i)){for(coinI=0;coinI<e.length;coinI++){var _=e[coinI],w=18-2.1875*i;h(function(o,h,a){for(var e=0;3>e;e++){var n=Math.min(1,.85+.05*e),i=o-_[0],s=h+e-_[1]-w;36>Math.round((i-32)*(i-32)+2*(s-32)*2*(s-32))&&t(a,220*n,150*n,25*n,r)}c(a,15)})}l(40+i)}}}function h(e){return function(t){return t[7][0]==e}}function tt(n,e){var t=e[4][0];e[7][2]=t>10?5:t>5?11:e[7][1001]}function et(n,e){var t=e[4][0];0==t?n.l(e):e[7][8]=t/e[5][0][1]*Math.abs(Math.sin(t/5))}function C(n,e){var t=e[4][0];0==t?n.l(e):e[7][8]=a(0,1,t/20)}function y(t,e){e[7][4]=40+a(0,7,e[4][3]/5)|0}function N(n,t){if(0==tickI%4){var e=t[7][1];t[7][1]=e-e%4+(e+1)%4}}function p(r,e){e[7][5]||void 0;var t=e[4][0];if(e[7][2]=t>10?15:t>5?16:e[7][1001],!(t>0)){e[7][1e3]&&e[7][1e3][1]&&e[7][1e3][0]==tickI&&(e[7][5](r,e,e[7][1e3][1]),e[7][1e3]=null);for(var t=r.c(e[0],e[1]).filter(h(1)),n=0;n<t.length;n++)1>Math.abs(t[n][0]-e[0])+Math.abs(t[n][1]-e[1])&&e[7][5](r,e,t[n])}}function Q(e){e[4][0]=e[5][0][1]}function x(e){e[4][0]=e[5][0][1]}function Z(n,e,t){t[4][0]+=10,x(e)}function V(n,e,t){t[4][1]+=2,x(e)}function z(n,e,r){function t(a,i){var e,t=n.c(a,i);for(e in t)t[e][7][5]&&(t[e][7][1e3]=[tickI+1,r])}x(e),n.h(e[0],e[1],k.sigil2),t(e[0]-1,e[1]-0),t(e[0]+1,e[1]-0),t(e[0]-0,e[1]-1),t(e[0]-0,e[1]+1)}function A(r,e,n){return(n=g(r.H(n[0],n[1]),e[0],e[1]))?(e[0]+=n[0],e[1]+=n[1],e[4][4]=2.5+5*Math.random(),s):t}function $(r,t){if(1==t[4][0]){r.h(t[0],t[1],j)[7][1]+=Math.floor(4*Math.random());for(var e=1,n=thiefSpawnCount;n>10*e;)n-=10*e,e+=1;t[4][0]=n/e==(n/e|0)?600-40*(n/e):100,thiefSpawnCount+=1}else e=t[4][0]/20,document.getElementById("nT").innerHTML=H(data["top.html"]).replace("$SPAWN",Math.ceil(e))}function at(r,e){if(r.z){var i=g(r.z,e[0],e[1]);i||(i=g(r.K,e[0],e[1]));for(var n=r.c(e[0],e[1]).filter(h(1)),t=0;t<n.length;t++){e[7][3]=37,n[t][7][0]=9,n[t][4][0]=n[t][5][0][1],n[t][8]=[C],ThievesCaught+=1;for(var s in n[t][7][1006]){ThievesCaughtLooted+=n[t][7][1006][s];var o=s.split(",");r.c(0|o[0],0|o[1]).filter(h(2))[0][4][3]+=n[t][7][1006][s]}}i?(0==e[4][4]&&(e[0]+=i[0],e[1]+=i[1],e[4][4]=6.5+4*Math.random()),0<e[7][1002]?e[7][1002]-=.1:e[7][3]=0):e[0]!=e[7][7][0]||e[1]!=e[7][7][1]?(e[7][3]=35,e[7][1002]=a(0,1,Math.sin(tickI/8+e[9])),0==e[4][4]&&A(r,e,e[7][7])):(e[7][3]=35,e[7][1002]=a(0,1,Math.sin(tickI/16+e[9])))}}function Y(s,e){var o=0;if(2==e[7][7])o=2;else{if(0<e[4][0])return e[7][3]=34,void(e[7][1002]=1);8<e[4][1]&&e[4][1]>e[4][2]?(e[7][3]=38,e[7][1002]=Math.min(1,Math.max(0,Math.abs(Math.sin(tickI/40))+e[4][1]/10)),o=0):8<e[4][2]?(e[7][3]=36,e[7][1002]=Math.min(1,Math.max(0,Math.abs(Math.sin(tickI/40))+e[4][2]/10)),o=0):(0<e[7][1002]?e[7][1002]-=.2:e[7][3]=0,o=1)}var t,r,n=[];if(0==e[4][4]){if(1==o){if(!e[7][1005]){r=s.g(2);for(var i in r)t=r[i],t=[t[0],t[1]],1>r[i][4][3]||e[7][1006]&&e[7][1006][t]||(n[n.length]=t);if(0==n.length)return void(e[4][2]=e[5][2][1]);t=n[Math.random()*n.length|0],e[7][1005]=t}if(t=e[7][1005],e[0]==t[0]&&e[1]==t[1])for(i in e[7][1006]||(e[7][1006]=[]),e[7][1005]=null,e[4][4]=20,e[7][3]=37,e[7][1002]=2,r=s.c(t[0],t[1]).filter(h(2)))e[7][1006][""+t]=a(0,20,r[i][4][3]),r[i][4][3]=a(0,20,r[i][4][3]-20);else A(s,e,t)}else{if(!e[7][1005]||1==e[7][7]){r=s.g(5);for(i in r)t=r[i],t=[t[0],t[1]],n[n.length]=t;t=n[Math.random()*n.length|0],e[7][1005]=t}if(t=e[7][1005],e[0]==t[0]&&e[1]==t[1]){if(n=s.c(t[0],t[1]).filter(h(5))[0],0==n[4][0])for(t in e[4][0]=e[5][0][1],n[4][0]=e[5][0][1],e[7][0]=9,e[8]=[et],e[7][3]=37,ThievesEscaped+=1,e[7][1006])ThievesEscapedLooted+=e[7][1006][t]}else A(s,e,t)||(2==e[7][7]?s.l(e):(e[7][3]=33,o=2,e[4][4]=30)),e[0]==t[0]&&e[1]==t[1]&&(e[4][4]=10)}e[7][7]=o}}function F(t){for(var e=0;e<t.length;e+=2)for(var r=document.getElementsByClassName(t[e]),n=0;n<r.length;n++)r[n].style.display=t[e+1]}function H(e){return e.replace("$CAUGHT_THIEVES",ThievesCaught).replace("$THIEF_VALUE",0|ThievesCaughtLooted).replace("$ESCAPED_THIEVES",ThievesEscaped).replace("$ESCAPED_VALUE",0|ThievesEscapedLooted)}function B(e){scene.w&&scene.view&&(scene.a||(scene.a=L(scene.view)),v=[2*(e.pageX/window.innerWidth)-1,-2*(e.pageY/window.innerHeight)+1,1,1],v=3==v.length?[v[0]*scene.a[0]+v[1]*scene.a[4]+v[2]*scene.a[8],v[0]*scene.a[1]+v[1]*scene.a[5]+v[2]*scene.a[9],v[0]*scene.a[2]+v[1]*scene.a[6]+v[2]*scene.a[10]]:[v[0]*scene.a[0]+v[1]*scene.a[4]+v[2]*scene.a[8]+v[3]*scene.a[12],v[0]*scene.a[1]+v[1]*scene.a[5]+v[2]*scene.a[9]+v[3]*scene.a[13],v[0]*scene.a[2]+v[1]*scene.a[6]+v[2]*scene.a[10]+v[3]*scene.a[14],v[0]*scene.a[3]+v[1]*scene.a[7]+v[2]*scene.a[11]+v[3]*scene.a[15]],c=v[0]/1+v[1]/.5,o=v[1]/.5-v[0]/1,c=Math.round(c),o=Math.round(o),scene.w(c,o,e))}function U(){for(var n=document.body.children[2],e=n.getContext("2d"),a=document.getElementsByTagName("img"),t=0;t<a.length;t++){var r=a[t];r.style.width="64px",r.style.height="64px";var i=r.attributes.offset.value.split(" ");e.clearRect(0,0,64,64),e.drawImage(cv,i[0],i[1],64,64,0,0,64,64),r.src=n.toDataURL()}for(e.drawImage(cv,448,0,64,64,0,0,64,64),document.body.children[3].style.backgroundImage='url("'+n.toDataURL()+'")',document.body.children[3].style.backgroundSize="30% 100%",e.drawImage(cv,448,0,64,64,0,0,64,64),e=document.getElementsByClassName("ui"),t=0;t<e.length;t++)e[t].style.backgroundImage='url("'+n.toDataURL()+'")',e[t].style.backgroundSize="64px 100%"}function R(e){document.body.children[3].innerHTML=data[e],document.body.children[3].style.display="block",U()}function X(e){e.width=canvas.width,e.height=canvas.height,e.size&&e.size()}var r=void 0,s=!0,t=!1,T=Array;try{T=WebGLFloatArray}catch(e){}try{T=Float32Array}catch(e){}var e=T,G=new e(3);new e(3),new e(3),e!=Array&&(new e([1,0,0]),new e([0,1,0]),new e([0,0,1])),new e(16),new e(16),e!=Array&&new e([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);var E=[-1,1,128,-128],O=[[-1,0],[1,0],[0,1],[0,-1]];Flowmap=function(t,n){this.L=t,this.F=n,this.n=[],this.v={},this.q=[];for(var e=0;16384>e;e++)this.q[e]=0;this.map=[],this.map[16385]=0},Flowmap.prototype.D=function(e,t){return e+128*t};var j=[[[0,0,64,-1],[0,0,10,-.01],[0,0,10,.01],,[0,0,999,-1]],[1,24,,],[Y]],K=[[,,,,[0,0,999,-1]],[7,28,,],[at]],W=[[[0,0,999999,-1]],[4,,9],[$]],J=[[[0,0,60,-1]],[5,,10,,,Q],[tt]],k={alarm:[[[10,0,40,-1]],[3,,13,,,z],[p]],freeze:[[[10,0,60,-1]],[3,,12,,,Z],[p]],shock:[[[10,0,70,-1]],[3,,14,,,V],[p]],sigil:[[[60,0,60,-1]],[8,16],[N,C]],sigil2:[[[30,0,30,-1]],[8,16],[N,C]]},w={0:[[,,,[10,0,10,3e-4]],[2],[y]],1:[[,,,[20,0,20,3e-4]],[2],[y]],2:[[,,,[40,0,40,3e-4]],[2],[y]]};ThievesEscapedLooted=ThievesCaughtLooted=ThievesEscaped=ThievesCaught=0,thiefSpawnCount=0,canvas=document.body.children[0],canvas.width=window.innerWidth,canvas.height=window.innerHeight,gl=canvas.getContext("webgl"),loadingStage=loadingCount=tickI=0,data=[],scene={time:0},globals={},keys={},lastKeys={},shaders=[],cv=document.body.children[1],ctx=cv.getContext("2d"),shaders[0]=function(){return[[i("bg.fs"),gl.FRAGMENT_SHADER],[i("bg.vs"),gl.VERTEX_SHADER]]};var b=1;shaders[b]=function(){return[[i("tiles.fs"),gl.FRAGMENT_SHADER],[i("tiles.vs"),gl.VERTEX_SHADER]]},uv=[];for(var l=0;64>l;l++){var c=l%8,o=l/8|0;uv[l]=[.125*c+.002,.125*o+.002,.125*c-.002+.125,.125*o-.002+.125]}uv[3]=uv[1],window.addEventListener("keyup",function(e){lastKeys[e.keyCode]=keys[e.keyCode],keys[e.keyCode]=-scene.time},t),window.addEventListener("keydown",function(e){lastKeys[e.keyCode]=keys[e.keyCode],keys[e.keyCode]=scene.time},t),canvas.addEventListener("mousemove",B),canvas.addEventListener("mousedown",B),window.setScene=R,window.startGame=function(e){U(),game.R=e,scene.next=game,F(["uV","block","intro","none"])},scene.o=function(){switch(loadingStage>50&&(S(0),gl.bindBuffer(gl.ARRAY_BUFFER,globals.s),gl.disableVertexAttribArray(1),gl.vertexAttribPointer(shaders[0][1],3,gl.FLOAT,t,0,0),gl.drawArrays(gl.TRIANGLES,0,6)),loadingStage){case 0:i("intro.html"),i("menu.html"),i("about.html"),i("gameover.html"),i("top.html");break;case 1:if(0!=loadingCount)return;R("menu.html");break;case 11:id=ctx.createImageData(64,64),d=id.data,nt();break;case 12:var e=document.body.children[2];e.getContext("2d").drawImage(cv,448,0,64,64,0,0,64,64),document.body.children[3].style.backgroundImage='url("'+e.toDataURL()+'")',document.body.children[3].style.backgroundSize="30% 100%";break;case 20:globals.r=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,globals.r),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,ctx.getImageData(0,0,512,512)),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR),gl.generateMipmap(gl.TEXTURE_2D),gl.bindTexture(gl.TEXTURE_2D,null),gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,globals.r),gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),gl.enable(gl.BLEND);break;case 30:for(key in shaders)shaders[key]=shaders[key]();break;case 31:if(!(0>=loadingCount))return;for(e=0;shaders[e];e++){shaderProgram=gl.createProgram();for(var n=0;shaders[e][n];n++)shader=gl.createShader(shaders[e][n][1]),gl.shaderSource(shader,data[shaders[e][n][0]]),gl.compileShader(shader),gl.getShaderParameter(shader,gl.COMPILE_STATUS)||void 0,gl.attachShader(shaderProgram,shader);gl.linkProgram(shaderProgram),gl.useProgram(shaderProgram),shaders[e]=[shaderProgram,gl.getAttribLocation(shaderProgram,"position"),gl.getAttribLocation(shaderProgram,"uv")]}break;case 40:globals.s=m(null,[-1,-1,0,1,-1,0,-1,1,0,-1,1,0,1,-1,0,1,1,0]);break;case 50:gl.viewport(0,0,gl.drawingBufferWidth,gl.drawingBufferHeight),this.B={resolution:[this.width,this.height],aspect:[1,this.i],atlas:0},gl.enableVertexAttribArray(0);break;case 51:return;default:return loadingStage+=1,void scene.o()}loadingStage+=1},window.onresize=function(){canvas.width=window.innerWidth,canvas.height=window.innerHeight},accumelator=0,onFrame=function(e){requestAnimationFrame(onFrame),X(scene),scene.f=e-scene.time,scene.u=scene.time,scene.time=e,scene.o(e),accumelator+=scene.f,accumelator>50&&(scene.A&&(scene.A(),tickI+=1),accumelator-=50,accumelator>50&&(accumelator=0)),scene.next&&(X(scene.next),scene.next.f=scene.f,scene.next.u=scene.u,scene.next.time=scene.time,e=scene,scene=scene.next,scene.t&&scene.t(),scene.parent=e)},requestAnimationFrame(onFrame);var u={d:0,e:126,H:function(t,n){var e=t+128*n;return this.j[e]||(this.j[e]=new Flowmap(scene.b,function(e){return!!e&&4!=e}),_(this.j[e],t,n)),this.j[e]},p:function(){this.k&&gl.deleteBuffer(this.k[0]),this.j={};for(var s=[],r=[],n=-1,a=0;128>a;a++)for(var i=0;128>i;i++)if(n+=1,0!=this.b[n]){var e=.5*(i-a),t=.25*(i+a);uvHH=(hh=0==this.b[n+128+1])?0:2/3/8,hh=hh?.5:0,0==this.b[n+128]&&(_uv=uv[6],r=[e-.5,t,0,_uv[0],_uv[3],1,e,t+.25,0,_uv[2],_uv[3],1,e-.5,t+.25+hh,0,_uv[0],_uv[1]+uvHH,1,e-.5,t+.25+hh,0,_uv[0],_uv[1]+uvHH,1,e,t+.25,0,_uv[2],_uv[3],1,e,t+.5+hh,0,_uv[2],_uv[1]+uvHH,1].concat(r)),0==this.b[n+1]&&(_uv=uv[6],r=[e+.5,t,0,_uv[2],_uv[3],1,e,t+.25,0,_uv[0],_uv[3],1,e+.5,t+.25+hh,0,_uv[2],_uv[1]+uvHH,1,e+.5,t+.25+hh,0,_uv[2],_uv[1]+uvHH,1,e,t+.25,0,_uv[0],_uv[3],1,e,t+.5+hh,0,_uv[0],_uv[1]+uvHH,1].concat(r)),_uv=uv[this.b[n]-1],s=s.concat([e-.5,t,0,_uv[0],_uv[3],1,e,t+.25,0,_uv[2],_uv[3],1,e+.5,t,0,_uv[2],_uv[1],1,e+.5,t,0,_uv[2],_uv[1],1,e,t-.25,0,_uv[0],_uv[1],1,e-.5,t,0,_uv[0],_uv[3],1])}this.k=m(this.k,s),this.C=m(this.C,r)},Q:function(e,t){this.d=e,this.e=t},h:function(e,s,n,a,i){a==r&&i==r&&(a=n[1],i=n[2],n=n[0]),e=[e,s,0,0,[],[],[],[],i];for(var t in n)e[4][t]=n[t][0],e[5][t]=[n[t][1],n[t][2]],e[6][t]=n[t][3];for(t in a)e[7][t]=a[t];return e[7][1001]=e[7][2],e[9]=this.entities.length,this.entities[this.entities.length]=e},g:function(r){var t,e=[];for(t in this.entities){var n=this.entities[t];n[7][0]==r&&(e[e.length]=n)}return e},c:function(n,r){for(var t=[],e=0;e<this.entities.length;e++)1>Math.abs(this.entities[e][0]-n)+Math.abs(this.entities[e][1]-r)&&(t[t.length]=this.entities[e]);return t},l:function(e){var t=this.entities.indexOf(e);t>-1&&(ents=this.entities.splice(t,1),ents.length&&e[7][1001]&&(this.b[e[0]+128*e[1]]=e[7][1003]))},t:function(){for(;;){var r=[];for(this.b=r;16384>r.length;r[r.length]=0);this.entities=[];for(var a=function(e,t,i,s,o){for(var n=e-i;e+i>=n;n++)for(var a=t-s;t+s>=a;a++)r[128*a+n]=1;return scene.h(e,t,o)},o=[w[0],w[1],w[2],J],i=[0,0,0,0],e=52;76>=e;e++)for(var n=52;76>=n;n++)this.b[128*n+e]=4;for(e=52;76>=e;e++)this.b[128*e+64]=3,this.b[8192+e]=3;for(e=-6;12>=e;e++)this.b[128*(64+e)+76]=3,this.b[128*(64-e)+64-12]=3,this.b[6720+e]=3,this.b[9792-e]=3;for(entranceY=entranceX=0,a(64+6*entranceX,64+6*entranceY,2,2,W),e=function(e,t){var n=a(64+e,64+t,1,1,K);n[7][1]+=4*Math.random()|0,n[7][7]=[64+e,64+t]},e(-12,-12),e(12,-12),e(-12,12),e(12,12),e=-2;3>e;e++)for(n=-2;3>n;n++)if(Math.abs(e)!=Math.abs(n)&&(e!=entranceX||n!=entranceY)){var c=Math.floor(Math.random()*o.length);i[c]+=1;var h=1,l=1;.7<Math.random()&&(.5<Math.random()?h=2:l=2),a(64+6*e,64+6*n,h,l,o[c])}if(!(0==i[3]||2<i[3])){this.S=function(){var r=new Flowmap(scene.b,function(e){return 0!=e&&2!=e});_(r,64+6*entranceX,64+6*entranceY);for(var e=-2;3>e;e++)for(var n=-2;3>n;n++)if((e!=entranceX||n!=entranceY)&&!g(r,64+6*e,64+6*n))return t;return s};break}}this.p()},A:function(){function h(n,r){for(var t=scene.g(n),e=0;e<t.length;e++)_(c,t[e][0],t[e][1],r)}function l(){var n,t=scene.g(1),r=0;for(n in t)for(var a in e[7][1006])r+=e[7][1006][a];t=scene.g(2);for(n in t)r+=t[n][4][3];return r<t.length}var r=t,c=new Flowmap(scene.b,function(e){return!!e&&4!=e});this.z=c,h(1,15),this.K=c=new Flowmap(scene.b,function(e){return!!e&&4!=e}),h(8,25);for(var i=0;i<this.entities.length;i++){for(var e=this.entities[i],o=0;o<e[8].length;o++)e[8][o](this,e);e[7][2]&&(o=128*e[1]+e[0],this.b[o]!=e[7][2]&&(e[7][1003]||(e[7][1003]=this.b[o]),this.b[o]=e[7][2],r=s))}for(i=0;i<this.entities.length;i++){var n,e=this.entities[i];for(n in e[4])e[4][n]=a(e[5][n][0],e[5][n][1],e[4][n]+e[6][n])}for(r&&this.p(),entBuffer=[],i=0;i<this.entities.length;i++)e=this.entities[i],r=function(t,a,e,n){var r=.5*(t-a);t=.25*(t+a),e=uv[e],n>1&&(n=1),entBuffer=entBuffer.concat([r-.45,t-.45,0,e[0],e[3],n,r-.45,t+.45,0,e[0],e[1],n,r+.45,t-.45,0,e[2],e[3],n,r+.45,t+.45,0,e[2],e[1],n,r-.45,t+.45,0,e[0],e[1],n,r+.45,t-.45,0,e[2],e[3],n])},e[7][1]&&((n=e[7][8])||(n=1),r(e[0]+.2,e[1]+.2,e[7][1],n)),0<e[7][4]&&r(e[0],e[1],e[7][4],1),0<e[7][3]&&r(e[0]+1.8,e[1]+.8,e[7][3],e[7][1002]),0<e[7][6]&&(r=.5*(e[0]-e[1]),n=.25*(e[0]+e[1]),_uv=uv[e[7][6]],entBuffer=entBuffer.concat([r-.5,n,0,_uv[0],_uv[3],1,r,n+.25,0,_uv[2],_uv[3],1,r+.5,n,0,_uv[2],_uv[1],1,r+.5,n,0,_uv[2],_uv[1],1,r,n-.25,0,_uv[0],_uv[1],1,r-.5,n,0,_uv[0],_uv[3],1]));this.m=m(this.m,entBuffer),!data.gameover&&l()&&setTimeout(function(){!data.gameover&&l()&&(data.gameover=H(data["gameover.html"]),R("gameover"))},250)},size:function(){gl.viewport(0,0,this.width,this.height),this.i=window.innerWidth/window.innerHeight,this.B={resolution:[this.width,this.height],aspect:[1,this.i],atlas:0};var n=-14/this.i,a=14/this.i,t=r;t==r&&(t=new e(16)),t[0]=2/28,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2/(a-n),t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=-2/99.9,t[11]=0,t[12]=-0,t[13]=-(a+n)/(a-n),t[14]=-100.1/99.9,t[15]=1,this.perspective=t,this.N=L(this.perspective),this.O=q(1.0471975511966667),this.P=q(-1.0471975511966667)},o:function(){var s=0;deltaY=0,0<keys[83]&&(deltaY-=4),0<keys[87]&&(deltaY+=4),0<keys[65]&&(s-=1),0<keys[68]&&(s+=1),this.f&&(this.d+=.012*s*this.f,this.e+=.012*deltaY*this.f,this.e=a(100,160,this.e),this.d=a(-10,10,this.d));var s=-this.d,o=-this.e/4,i=this.perspective,n=r;n==r&&(n=new e(16));var c=i[0],h=i[1],l=i[2],u=i[3],f=i[4],v=i[5],d=i[6],g=i[7],m=i[8],_=i[9],y=i[10],w=i[11],x=i[12],k=i[13],E=i[14],i=i[15];n[0]=c,n[1]=h,n[2]=l,n[3]=u,n[4]=f,n[5]=v,n[6]=d,n[7]=g,n[8]=m,n[9]=_,n[10]=y,n[11]=w,n[12]=c*s+f*o+-10*m+x,n[13]=h*s+v*o+-10*_+k,n[14]=l*s+d*o+-10*y+E,n[15]=u*s+g*o+-10*w+i,this.view=n,this.a=null,this.G=[this.view[0],this.view[4],[8],this.view[12],this.view[1],this.view[5],[9],this.view[13],this.view[2],this.view[6],[10],this.view[14],this.view[3],this.view[7],[11],this.view[15]],gl.disableVertexAttribArray(1),S(0),gl.bindBuffer(gl.ARRAY_BUFFER,globals.s),gl.vertexAttribPointer(shaders[0][1],3,gl.FLOAT,t,0,0),gl.drawArrays(gl.TRIANGLES,0,6),gl.enableVertexAttribArray(1),S(b),M(this.k),M(this.C),this.m&&M(this.m)},w:function(a,i,e){if("mousedown"==e.type){for(inputs=document.getElementsByTagName("input"),selected="",e=0;e<inputs.length;e++)if(inputs[e].checked){selected=inputs[e].value;break}var o=a+128*i,n=scene.b[o],r=this.c(a,i);switch(selected){case"floor":scene.b[o]=4==n?3:3==n?4:n;break;case"freeze":case"shock":case"alarm":case"sigil":if(n&&10!=n&&9!=n){var c=s;for(e=0;e<r.length;e++)r[e][7][0]==k[selected][1][0]&&(this.l(r[e]),c=t);c&&(document.title=""+[o,n,r,selected],scene.h(a,i,k[selected]))}}this.p()}},start:function(){for(var t=scene.g(4),e=0;e<t.length;e++)t[e][4][0]=100;F("bV none bH inline-block uH block".split(" "))}};ret={};for(key in u)ret[key]="function"==typeof u[key]?u[key].bind(ret):u[key];game=ret;
//# sourceMappingURL=ugly.map