var t=Object.defineProperty,i=(i,s,e)=>((i,s,e)=>s in i?t(i,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[s]=e)(i,"symbol"!=typeof s?s+"":s,e);const s="data:image/webp;base64,UklGRk4AAABXRUJQVlA4TEIAAAAvT8ADAA9wZ/Vbp/+4ff4DDwwiSXLS5IwmJCAJaSflJbwIsoKI/k+Af5co4RiT4KyMFUhcaPPKhmgz9oKQyzOy/wI=",e={wood:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAADxJREFUeNpjcC/wYaAEM4waMBgNKI52+g/CuNh4DUjwtv0PU4iPTTsDfO0t4ArxsYevFxCuAGFcbKonJADLRUigst4GXgAAAABJRU5ErkJggg==",fire:"data:image/webp;base64,UklGRooAAABXRUJQVlA4TH0AAAAvP8ADEB8gICH8/+ON7BLaEOb/WzVdTdsGTDoIlj+P3vMfANu/LDiqbdtNdkLvSIgEpumRgoBIownojBHzBWROMxDR/0XwQ31gDTEAekSQkDQ8e4Q5G9xXhBVdj7DiVXNaslvR1YSMc8Wu4lxxzthltBm7jF1K+/a3kzf/fwA=",construction:"data:image/webp;base64,UklGRqIAAABXRUJQVlA4TJYAAAAvL8ALAA/wM+d/WT/veP7jweA2tm1V+f4heq8GLCIkdC/DpQtogZK0Ek9fjMtBK7gnov+K3LZtktPo5DOsr9MsRETpsohE9IhkRO/2HEZ0KsFexBSyPKlpPJ1ZusVYllWnuLqy4UyvJF3DK5VMnhHFwAKXFC9Xjp3i4crmn96JB8Fr//ROFEANlEElEEO9F0lUReGv/QU="},h="data:image/webp;base64,UklGRoYCAABXRUJQVlA4THoCAAAvb8AHEHegJgDQBDrQwCLQvwTfPvfVURMASMO4yEAUmhAbNcT2W5/aACAbNrvV/yf4hR+k9yzzHwCgTL9qWDVEGCginYW+avvLDP4q2BA6M51cCOQ62+a4ykjutju5n8pyZek7cch4Knfk0Ga4gbFcEld0iMpU3rOOP+ECOCVdTh1Spku+B/7/n/Xa4gIi+g/BjSRFkmuPIYbqE2aO06WkMDAPxKMCn6PAhGimQ4zPpuuwlCUS+LyUkQQmHCh7JRyABYrIMTDCK7x/IoHP+P60LLClrPAg2KcDwEf26yDwcybItVw47fljIZV5erEfwGNdwXysAw2xjs8NYuuYNEh1KTFRoBzPw8j7z1FgIgFDQd8ysgs0BSVFVOBVFPistMNaJmp2MSuGBVKa3vecCryKAp97rNsOYSjPU83a3ehCrYt1/U9BPJgeYCGENWGtXVQIXmZd/7gOAJUyAbobQouMoRvWVkk4NGIzTftumrYyY2o30rSaacgZkFdmE9I0DOU309TuFnGza4VwV1StvVFKl4iSqXuvpDxCAqLeBHrey98Jih8E6pAOnCKKvz2Mvq3Jf5B/oLhoJbuuE+39KRW4F3hGHLA8o5KQq0wH98cSuIxjfZbyjKJAIUz1cAd4wM5vACcYCYoDEbUXSl2pTHNhYExOe3vk4oDmNBJN1ks0sOubABgE4oAg3xQ9cor3fpnYOjoNYus4JQE8++cRooCSkxyj7wEmspSpfe9Ee3/Ku1IMQIIqRuupH+SaBC57V+YL/SmP08j31tFjTd+J9v5yT+REDgUBNZApOnZ5EsrsPwAUBUoMkDc9VeL9nyFQ6hN1reY/+kzMfzMG",a=16,o={tree:{position:{x:0,y:0},width:16,height:32,box:{x:8,y:72,height:40,width:40},hp:3,chance:25,super:null},tree_snow:{position:{x:16,y:0},width:16,height:32,box:{x:8,y:72,height:40,width:40},hp:3,chance:100,super:null},giant_rock:{position:{x:32,y:0},width:32,height:32,box:{x:24,y:40,height:64,width:72},hp:13,chance:10,super:null},rock:{position:{x:64,y:0},width:16,height:16,box:{x:8,y:12,height:32,width:40},hp:5,chance:25,super:null},small_rock:{position:{x:64,y:16},width:16,height:16,box:{x:8,y:12,height:40,width:40},hp:5,chance:25,super:null},rock_yellow:{position:{x:96,y:0},width:16,height:16,box:{x:8,y:8,height:40,width:40},hp:2,chance:5,super:"speed"},rock_red:{position:{x:80,y:0},width:16,height:16,box:{x:8,y:8,height:40,width:40},hp:2,chance:5,super:"health"},rock_blue:{position:{x:96,y:16},width:16,height:16,box:{x:8,y:8,height:40,width:40},hp:2,chance:5,super:"damage"},rock_black:{position:{x:80,y:16},width:16,height:16,box:{x:8,y:8,height:40,width:40},hp:2,chance:5,super:"granade"}},n=Object.values(o).reduce(((t,i)=>t+i.chance),0),r=100,l={KeyA:!1,KeyD:!1,KeyS:!1,KeyW:!1,KeyQ:!1,Space:!1},d=13e3,c=(t,i)=>t.position.x+t.width>i.position.x&&t.position.y+t.height>i.position.y&&t.position.x<i.position.x+i.width&&t.position.y<i.position.y+i.height;class p{constructor({fps:t,mf:s,cf:e=0}){i(this,"fps"),i(this,"fi"),i(this,"ft"),i(this,"mf"),i(this,"cf"),this.fps=t,this.fi=1e3/this.fps,this.ft=0,this.mf=s,this.cf=e}te(t){return this.ft+=t,this.ft>=this.fi&&(this.ft=0),0===this.ft}uf(t=0){this.mf&&(this.cf||0===this.cf)&&(this.cf++,this.cf===this.mf&&(this.cf=t))}startCounting(){return this.uf(0),new Promise((t=>{const i=setInterval((()=>{0===this.cf&&(t(!0),clearInterval(i))}),100)}))}setFPS(t){this.fps=t,this.fi=1e3/this.fps}}class y{constructor({tileSize:t,position:s}){i(this,"shift",{x:0,y:0}),i(this,"tileSize"),i(this,"position"),i(this,"activeTime",d),this.tileSize=t,this.position=s}setShift(t){this.shift=t}}class g extends y{constructor({tileSize:t,position:s,width:h,height:a}){super({tileSize:t,position:s}),i(this,"construction",new Image),i(this,"fire",new Image),i(this,"wood",new Image),i(this,"active",!1),i(this,"frame",new p({fps:5,mf:4,cf:0})),i(this,"width"),i(this,"height"),i(this,"radius",250),i(this,"shift",{x:0,y:0}),i(this,"center",{x:0,y:0}),this.width=h,this.height=a,this.construction.src=e.construction,this.fire.src=e.fire,this.wood.src=e.wood,this.center={x:this.position.x+1.5*this.tileSize,y:this.position.y+1.5*this.tileSize}}update({time:t}){this.activeTime<=0&&(this.active=!1),this.active&&this.activeTime>=0&&(this.activeTime-=t),this.frame.te(t)&&this.frame.uf()}draw(t){this.drawFirePlace(t),this.dw(t),this.active&&this.dai(t),this.activeTime>0&&this.drawFire(t),this.dcri(t),this.ati(t)}dai(t){t.beginPath(),t.arc(this.center.x+this.shift.x,this.center.y+this.shift.y,this.radius,0,2*Math.PI),t.fillStyle="rgba(255, 100, 100, 0.05)",t.fill()}ati(t){t.fillStyle="rgba(0, 20, 122, 0.9)",t.fillRect(this.position.x+this.width/4+this.shift.x,this.position.y-this.tileSize/4+this.shift.y,this.width/2,15),t.fillStyle="rgba(220, 50, 50, 1)",t.fillRect(this.position.x+this.width/4+this.shift.x,this.position.y-this.tileSize/4+this.shift.y,Math.max(this.activeTime/d*this.width/2,0),15)}drawFirePlace(t){t.drawImage(this.construction,0,0,this.construction.width,this.construction.height,this.position.x+this.shift.x,this.position.y+this.shift.y,this.width,this.height)}dcri(t){t.beginPath(),t.arc(this.center.x+this.shift.x,this.center.y+this.shift.y,this.radius,0,2*Math.PI),t.setLineDash([4,16]),t.stroke()}dw(t){t.drawImage(this.wood,0,0,16,16,this.position.x+this.shift.x+this.tileSize-16,this.position.y+this.shift.y+this.tileSize/2,1.5*this.tileSize,1.5*this.tileSize)}drawFire(t){t.drawImage(this.fire,16*this.frame.cf,0,16,16,this.position.x+this.shift.x+this.tileSize-16,this.position.y+this.shift.y+this.tileSize/2,1.5*this.tileSize,1.5*this.tileSize)}}class m extends y{constructor({tileSize:t,position:s,type:e}){super({tileSize:t,position:s}),i(this,"image",new Image),i(this,"type"),i(this,"mapping"),i(this,"strictBox"),i(this,"hp"),this.tileSize=t,this.position=s,this.type=e,this.image.src=h,this.mapping=o[e],this.strictBox={position:{x:this.position.x+this.mapping.box.x,y:this.position.y+this.mapping.box.y},width:this.mapping.box.width,height:this.mapping.box.height},this.hp=this.mapping.hp}draw(t){this.dr(t),this.hp!==this.mapping.hp&&this.drawHealthBar(t)}drawHealthBar(t){t.fillStyle="rgba(255, 0, 0, 0.5)",t.fillRect(this.strictBox.position.x-10+this.shift.x,this.strictBox.position.y+this.shift.y,6,this.strictBox.height),t.fillStyle="rgba(25, 25, 25, 0.8)",t.fillRect(this.strictBox.position.x-10+this.shift.x,this.strictBox.position.y+this.shift.y,6,Math.max(this.hp/this.mapping.hp*this.strictBox.height,0))}dr(t){t.drawImage(this.image,this.mapping.position.x,this.mapping.position.y,this.mapping.width,this.mapping.height,this.position.x+this.shift.x,this.position.y+this.shift.y,this.mapping.width/a*this.tileSize,this.mapping.height/a*this.tileSize)}drawCollisionBox(t){t.fillStyle="rgba(255, 0, 0, 0.2)",t.fillRect(this.strictBox.position.x+this.shift.x,this.strictBox.position.y+this.shift.y,this.mapping.box.width,this.mapping.box.height)}}class u{constructor({boardDimensions:t,tileSize:s,centerArray:e}){i(this,"boardDimensions"),i(this,"backgroundArray"),i(this,"interactiveArray",[]),i(this,"tileSize"),i(this,"centerArray"),i(this,"shift",{x:0,y:0}),this.tileSize=s,this.boardDimensions=t,this.centerArray=e,this.backgroundArray=this.generateFloorTiles(),this.interactiveArray=this.giq()}setShift(t){this.shift=t}update({player:t}){this.interactiveArray=this.interactiveArray.filter((i=>!(i instanceof m)||(i.hp>0||(t.bonusAction(i.mapping.super),!1))))}generateFloorTiles(){const t=[];for(let i=0;i<this.boardDimensions.y;i++){const i=[];for(let t=0;t<this.boardDimensions.x;t++){const t=0===Math.floor(1.1*Math.random())?0:Math.floor(4*Math.random())+1;i.push(t)}t.push(i)}return t}giq(){const t=[],i=this.createCampfire();t.push(new g({tileSize:this.tileSize,position:i.position,width:i.width,height:i.height}));for(let s=0;s<this.boardDimensions.y-1;s++)for(let e=0;e<this.boardDimensions.x-1;e++){if(this.backgroundArray[s][e]||this.inCampfireRange(i,{x:e*this.tileSize,y:s*this.tileSize}))continue;if(!Math.floor(1.2*Math.random()))continue;const h=this.grci(),n={width:o[h].width,height:o[h].height};this.backgroundArray[s+1][e]!==r&&this.backgroundArray[s][e+1]!==r&&(n.width/a==2&&n.height/a==2?(this.backgroundArray[s][e+1]=r,this.backgroundArray[s+1][e]=r,this.backgroundArray[s+1][e+1]=r):n.width/a==2?this.backgroundArray[s][e+1]=r:n.height/a==2&&(this.backgroundArray[s+1][e]=r),t.push(new m({tileSize:this.tileSize,position:{x:e*this.tileSize,y:s*this.tileSize},type:h})))}return t}createCampfire(){const t=t=>Math.floor(Math.random()*(this.boardDimensions[t]-6))+3*this.tileSize;return{position:{x:this.centerArray?(this.boardDimensions.x/2-1.5)*this.tileSize:t("x"),y:this.centerArray?(this.boardDimensions.y/2-.5)*this.tileSize:t("y")},width:3*this.tileSize,height:3*this.tileSize}}inCampfireRange(t,{x:i,y:s}){return t.position.x-3*this.tileSize<i&&i<t.width+t.position.x+2*this.tileSize&&t.position.y-3*this.tileSize<s&&s<t.height+t.position.y+2*this.tileSize}grcv(){return Math.floor(Math.random()*n)}grci(){const t=this.grcv();let i=0;for(const s in o)if(i+=o[s].chance,i>=t)return s;return"tree"}}class f{constructor({gridSize:t,tileSize:s,boardDimensions:e,board:h}){i(this,"offset"),i(this,"gridSize"),i(this,"tileSize"),i(this,"tilesArray"),i(this,"boardDimensions"),i(this,"board"),this.gridSize=t,this.tileSize=s,this.boardDimensions=e,this.tilesArray=this.generateTiles(),this.offset={x:0,y:0},this.board=h}generateTiles(){const t=[];for(let i=0;i<this.gridSize;i++){const s=[];for(let t=0;t<this.gridSize;t++){const e=1===t&&1===i;s.push({backgroundArray:this.gba(e),render:e})}t.push(s)}return t}gba(t=!1){return new u({centerArray:t,boardDimensions:this.boardDimensions,tileSize:this.tileSize})}update(){this.uv(),this.handleGridShift()}uv(){this.uee(),this.ucc()}uee(){[{name:"left",tile:this.tilesArray[1][0],condition:()=>this.offset.x<this.board.position.x},{name:"top",tile:this.tilesArray[0][1],condition:()=>this.offset.y<this.board.position.y},{name:"right",tile:this.tilesArray[1][2],condition:()=>-this.offset.x<this.board.position.x},{name:"bottom",tile:this.tilesArray[2][1],condition:()=>-this.offset.y<this.board.position.y}].forEach((t=>{this.ucv(t.tile,t.condition())}))}ucc(){[{name:"topLeft",tile:this.tilesArray[0][0],condition:this.tilesArray[0][1].render&&this.tilesArray[1][0].render},{name:"topRight",tile:this.tilesArray[0][2],condition:this.tilesArray[0][1].render&&this.tilesArray[1][2].render},{name:"bottomLeft",tile:this.tilesArray[2][0],condition:this.tilesArray[2][1].render&&this.tilesArray[1][0].render},{name:"bottomRight",tile:this.tilesArray[2][2],condition:this.tilesArray[2][1].render&&this.tilesArray[1][2].render}].forEach((t=>{this.ucv(t.tile,t.condition)}))}ucv(t,i){!t.render&&i?t.render=!0:t.render&&!i&&(t.render=!1)}handleGridShift(){Math.abs(this.offset.x+this.board.position.x)>this.board.width&&(this.shiftGrid("left"),this.updateOffset("x",this.board.width+this.offset.x)),this.offset.x-this.board.position.x>this.board.width&&(this.shiftGrid("right"),this.updateOffset("x",this.board.position.x)),Math.abs(this.offset.y+this.board.position.y)>this.board.height&&(this.shiftGrid("up"),this.updateOffset("y",this.board.height+this.offset.y)),this.offset.y-this.board.position.y>this.board.height&&(this.shiftGrid("down"),this.updateOffset("y",this.board.position.y))}shiftGrid(t){const i=this.gridSize;for(let s=0;s<i;s++)"left"===t||"right"===t?this.shiftRow(s,t):this.shiftColumn(s,t)}shiftRow(t,i){if("left"===i){for(let i=2;i>0;i--)this.tilesArray[t][i]=this.tilesArray[t][i-1];this.tilesArray[t][0]={backgroundArray:this.gba(),render:!1}}else{for(let i=0;i<2;i++)this.tilesArray[t][i]=this.tilesArray[t][i+1];this.tilesArray[t][2]={backgroundArray:this.gba(),render:!1}}}shiftColumn(t,i){if("up"===i){for(let i=2;i>0;i--)this.tilesArray[i][t]=this.tilesArray[i-1][t];this.tilesArray[0][t]={backgroundArray:this.gba(),render:!1}}else{for(let i=0;i<2;i++)this.tilesArray[i][t]=this.tilesArray[i+1][t];this.tilesArray[2][t]={backgroundArray:this.gba(),render:!1}}}updateOffset(t,i){this.offset[t]=i}}class x{constructor(){}tileWithPlayer({tile:t,player:i,enemies:s}){t instanceof g&&this.playerWithCampfire({player:i,tile:t}),t instanceof m&&(this.pwr({player:i,tile:t}),this.tileWithBullet({tile:t,bullets:i.gun.bullets}),this.twg({tile:t,grenades:i.grenadier.grenades}),this.twe({tile:t,enemies:s}))}pwr({player:t,tile:i}){c({position:{x:i.strictBox.position.x+i.shift.x,y:i.strictBox.position.y+i.shift.y},width:i.mapping.box.width,height:i.mapping.box.height},{position:{x:t.position.x+t.velocity.x,y:t.position.y},width:t.width-Math.abs(t.velocity.x),height:t.height-Math.abs(t.velocity.y)})&&(t.position.x-=t.velocity.x,t.centerPoint.x-=t.velocity.x),c({position:{x:i.strictBox.position.x+i.shift.x,y:i.strictBox.position.y+i.shift.y},width:i.mapping.box.width,height:i.mapping.box.height},{position:{x:t.position.x,y:t.position.y+t.velocity.y},width:t.width-Math.abs(t.velocity.x),height:t.height-Math.abs(t.velocity.y)})&&(t.position.y-=t.velocity.y,t.centerPoint.y-=t.velocity.y)}playerWithCampfire({player:t,tile:i}){const s=Math.sqrt(Math.pow(i.center.x+i.shift.x-t.centerPoint.x,2)+Math.pow(i.center.y+i.shift.y-t.centerPoint.y,2));t.playerHitBoxRadius+i.radius>=s&&i.activeTime>0?(t.inCampfireRange.push(!0),i.active=!0):t.inCampfireRange.push(!1)}tileWithBullet({tile:t,bullets:i}){i.forEach(((i,s)=>{c({position:{x:t.strictBox.position.x+t.shift.x,y:t.strictBox.position.y+t.shift.y},width:t.mapping.box.width,height:t.mapping.box.height},{position:{x:i.position.x,y:i.position.y},width:2*i.bulletHitBoxRadius,height:2*i.bulletHitBoxRadius})&&(i.rb(s),t.hp-=i.damage)}))}twg({tile:t,grenades:i}){i.forEach((i=>{i.boom&&c({position:{x:t.strictBox.position.x+t.shift.x,y:t.strictBox.position.y+t.shift.y},width:t.mapping.box.width,height:t.mapping.box.height},{position:{x:i.position.x-i.boomRange/2,y:i.position.y-i.boomRange/2},width:i.boomRange,height:i.boomRange})&&(t.hp-=3)}))}enemyWithBullet({enemies:t,bullets:i}){i.forEach(((i,s)=>{t.forEach((t=>{c({position:{x:t.position.x,y:t.position.y},width:t.width,height:t.height},{position:{x:i.position.x,y:i.position.y},width:2*i.bulletHitBoxRadius,height:2*i.bulletHitBoxRadius})&&(i.rb(s),t.health-=i.damage)}))}))}ewgr({enemies:t,grenades:i}){i.forEach((i=>{t.forEach((t=>{i.boom&&c({position:{x:t.position.x,y:t.position.y},width:t.width,height:t.height},{position:{x:i.position.x-i.boomRange/2,y:i.position.y-i.boomRange/2},width:i.boomRange,height:i.boomRange})&&t.health--}))}))}twe({tile:t,enemies:i}){i.forEach((i=>{c({position:{x:t.strictBox.position.x+t.shift.x,y:t.strictBox.position.y+t.shift.y},width:t.mapping.box.width,height:t.mapping.box.height},{position:{x:i.position.x,y:i.position.y},width:i.width,height:i.height})}))}}class w{constructor({canvas:t}){i(this,"canvas"),i(this,"tileSize",64),i(this,"boardDimensions",{x:24,y:24}),i(this,"gridSize",3),i(this,"tilesImage",new Image),i(this,"collision",new x),i(this,"board"),i(this,"grid"),this.canvas=t,this.tilesImage.src=s,this.board={width:this.tileSize*this.boardDimensions.x,height:this.tileSize*this.boardDimensions.y,position:{x:t.width/2-this.tileSize*this.boardDimensions.x/2,y:t.height/2-this.tileSize*this.boardDimensions.y/2}},this.grid=new f({gridSize:this.gridSize,boardDimensions:this.boardDimensions,tileSize:this.tileSize,board:this.board})}update({time:t,player:i,enemies:s,isInMenu:e}){this.grid.update();for(let h=-1;h<this.gridSize-1;h++)for(let a=-1;a<this.gridSize-1;a++){if(!this.grid.tilesArray[h+1][a+1].render)continue;const o=this.grid.tilesArray[h+1][a+1].backgroundArray,{board:n}=this.grid,r={x:n.position.x+n.width*a-this.grid.offset.x,y:n.position.y+n.height*h-this.grid.offset.y};o.setShift(r),o.update({player:i}),o.interactiveArray.forEach((h=>{h.setShift(r),h instanceof g&&h.update({time:t}),e||this.collision.tileWithPlayer({tile:h,enemies:s,player:i})}))}}resetValues(){this.grid.tilesArray=this.grid.generateTiles(),this.grid.offset={x:0,y:0}}drawTileWithCampfire(t){for(let i=-1;i<this.gridSize-1;i++)for(let s=-1;s<this.gridSize-1;s++){if(!this.grid.tilesArray[i+1][s+1].render)continue;const e=this.grid.tilesArray[i+1][s+1].backgroundArray;for(let i=0;i<this.boardDimensions.y;i++)for(let s=0;s<this.boardDimensions.x;s++){const h=e.backgroundArray[i][s],o=h===r?0:h;t.drawImage(this.tilesImage,o*a,0,a,a,s*this.tileSize+e.shift.x,i*this.tileSize+e.shift.y,this.tileSize,this.tileSize)}for(const i of e.interactiveArray)if(i instanceof g){i.draw(t);break}}}diww(t){for(let i=-1;i<this.gridSize-1;i++)for(let s=-1;s<this.gridSize-1;s++){if(!this.grid.tilesArray[i+1][s+1].render)continue;const e=this.grid.tilesArray[i+1][s+1].backgroundArray;for(const i of e.interactiveArray)i instanceof m&&i.draw(t)}}ctic(t,i){for(let s=-1;s<this.gridSize-1;s++)for(let e=-1;e<this.gridSize-1;e++){if(!this.grid.tilesArray[s+1][e+1].render)continue;const h=this.grid.tilesArray[s+1][e+1].backgroundArray,{board:a}=this.grid,o={x:a.position.x+a.width*e-this.grid.offset.x,y:a.position.y+a.height*s-this.grid.offset.y};h.setShift(o);if(h.interactiveArray.find((s=>{if(s.setShift(o),!(s instanceof g)){if(c({position:{x:s.strictBox.position.x+s.shift.x,y:s.strictBox.position.y+s.shift.y},width:s.mapping.box.width,height:s.mapping.box.height},{position:{x:t.x,y:t.y},width:i.width,height:i.height}))return!0}})))return!0}return!1}}class A{constructor({position:t,imgSrc:s,scale:e=1,columns:h=1,mfs:a=1,framesCurrent:o=0,width:n,height:r,offSet:l,direction:d}){i(this,"position"),i(this,"image"),i(this,"scale"),i(this,"columns"),i(this,"mfs"),i(this,"framesCurrent"),i(this,"width"),i(this,"height"),i(this,"direction"),i(this,"offSet"),i(this,"drawSprite",(t=>{let i=this.image.width/this.columns,s=this.direction||1;t.save(),t.scale(s,1),t.drawImage(this.image,this.framesCurrent*i,0,this.image.width/this.columns,this.image.height,s*(this.position.x+this.width/2)-i/2*this.scale+this.offSet.x,this.position.y-this.image.height/2*this.scale+this.offSet.y,i*this.scale,this.image.height*this.scale),t.fillStyle="rgba(0, 0, 0, 0.5)",t.restore()})),i(this,"animateFrames",(()=>{this.framesCurrent<this.mfs-1?this.framesCurrent++:this.framesCurrent=0})),this.position=t,this.image=new Image,this.image.src=s,this.scale=e,this.columns=h,this.mfs=a,this.framesCurrent=o,this.width=n,this.height=r,this.direction=d,this.offSet=l}}const b="data:image/webp;base64,UklGRtoBAABXRUJQVlA4TM0BAAAvP8EJEFegJgAShhacJMBxeZnVqNZQG8kG9Z5fJjZ6kCpB/yVR00gKdHd8EuhRQYd/LZggyLYp7aAu+wAAwLeP0rjCyeOWf6yvmxkRC3CcbW/b8J+0igHUsvUDJFfQBVyoOW6c44lzujw6k32FHLPyxa8yJUBE/xm2bRtJXUBy79nB/Bs5qZWR63j4ONVrY35D6DhWem3MbwAde8ax0tugfx1abePi15Zd3scQOtLlda7XxvwG0HF+vhS9NuSHOk5MrzrObm6nOdtKbQPUsRS9rVgvg7VpOTOm0mUHop7uRGkrxQ5R3Eql9/POD4CagVxqwvn5u+ZWGr0L7zOLttrpbHV+/iigo3kR5Me2YpuWBAfaGpcdRMN54vwrwVsT9/N+L1qbOsLnCMQls6TtoYqz8V6IiyByIZvuGXGXh9xCDOm1EsVlizipyx5KgPM56zCACaAUY/MorZ8AFpsGfJoaWZQmSi5pG99q4hYMAeQL0GtDKOJYuxDAA5j5zoYH4HcfQoj7NVlRgg5LflvldiEkg4SEsMiTuOBDGQzwK0Ki0ZHabdGC4KLdAkKId4RvJDpbBbpBDzvUnNnzwtq67ejMz3zTA4IG+vWv48/gMQA=",v={IDLE:{imageSrc:b,columns:8,mfs:8,fps:0},RUNNING:{imageSrc:b,columns:8,mfs:8,fps:8}},S=0,k=1;class F{constructor({player:t,state:s}){i(this,"player"),i(this,"state"),this.player=t,this.state=s}}class M extends F{constructor(t){super({player:t,state:"IDLE"}),i(this,"input",(t=>{t.KeyW||t.KeyA||t.KeyS||t.KeyD||(this.player.setSprite(v.IDLE),this.player.velocity.x=0,this.player.velocity.y=0),t.Space&&this.player.attack(),t.KeyQ&&this.player.throwGrenade(),(t.KeyW||t.KeyA||t.KeyS||t.KeyD)&&(this.player.setState(k),this.player.setSprite(v.RUNNING))}))}}class B extends F{constructor(t){super({player:t,state:"RUNNING"}),i(this,"input",(t=>{if(t.KeyW||t.KeyA||t.KeyS||t.KeyD){this.player.velocity.x=0,this.player.velocity.y=0;const i=this.player.bonusSpeedTimeInMs>0?1.3:1;t.KeyA&&(this.player.velocity.x=-this.player.speed*i),t.KeyD&&(this.player.velocity.x=this.player.speed*i),t.KeyW&&(this.player.velocity.y=-this.player.speed*i),t.KeyS&&(this.player.velocity.y=this.player.speed*i)}t.Space&&this.player.attack(),t.KeyQ&&this.player.throwGrenade(),t.KeyW||t.KeyA||t.KeyS||t.KeyD||this.player.setState(S)}))}}class P{constructor({position:t,angle:s,rb:e,damage:h}){i(this,"position"),i(this,"width"),i(this,"height"),i(this,"velocity",{x:0,y:0}),i(this,"speed",10),i(this,"direction",1),i(this,"angle"),i(this,"centerPoint"),i(this,"bulletHitBoxRadius"),i(this,"damage"),i(this,"rb"),i(this,"update",(()=>{this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.centerPoint={x:this.position.x+this.width/2,y:this.position.y+this.height/2}})),i(this,"draw",(t=>{t.beginPath(),t.arc(this.centerPoint.x,this.centerPoint.y,this.bulletHitBoxRadius,0,2*Math.PI),t.fillStyle="rgba(255, 0, 0)",t.fill()})),this.position=t,this.width=4,this.height=8,this.angle=s,this.velocity.x=Math.cos(this.angle)*this.speed,this.velocity.y=Math.sin(this.angle)*this.speed,this.bulletHitBoxRadius=Math.max(this.width,this.height)/3,this.damage=h,this.centerPoint={x:this.position.x+this.width/2,y:this.position.y+this.height/2},this.rb=e}}function E(t){const i=Math.floor(4*Math.random())+1,s=Math.floor(Math.random()*t.width)+1,e=Math.floor(Math.random()*t.height)+1;let h={x:0,y:0};switch(i){case 1:h={x:s,y:-50};break;case 2:h={x:t.width+150,y:e};break;case 3:h={x:s,y:t.height+150};break;case 4:h={x:-50,y:e}}return h}class I extends A{constructor(t,s){super({canvas:s,position:{x:t.position.x,y:t.position.y},imgSrc:"data:image/webp;base64,UklGRoYAAABXRUJQVlA4THkAAAAvO8AJEEegJgAShhr8fODqH8RqahpJgU7EdQ90KEAC/isEkWlAaOE1nx6aiKjg/AcAAHqKNLW8bo/ycxtgFNlumy8GcmdgAkZQQqQC6KEQ6NIxOUX0fwLwpZMOe0Ok8bwpwZAUtuE0ZvBiXNdcFMBjLp3kwMYY/AkBAA==",scale:3,offSet:{x:0,y:5},width:10,height:20}),i(this,"canvas"),i(this,"playerPosition"),i(this,"mouse"),i(this,"gunAngle"),i(this,"targetAngle"),i(this,"bullets"),i(this,"bulletsAmount"),i(this,"attackFrame"),i(this,"reloadFrame"),i(this,"direction"),i(this,"player"),i(this,"isShooting"),i(this,"bulletDamage",1),this.player=t,this.playerPosition=t.position,this.mouse={x:0,y:0},this.gunAngle=0,this.targetAngle=0,this.bullets=[],this.bulletsAmount=13,this.isShooting=!1,this.attackFrame=new p({fps:6,cf:0,mf:2}),this.reloadFrame=new p({fps:1,cf:0,mf:2}),this.direction=this.player.direction,this.canvas=s}updateBulletOffset(t,i){this.bullets.forEach((s=>{s.position[t]-=i}))}updateGun(t,i){this.attackFrame.cf>0&&this.attackFrame.te(i)&&this.attackFrame.uf(),this.reloadFrame.cf>0&&this.reloadFrame.te(i)&&this.reloadFrame.uf(),this.mouse=t,this.targetAngle=Math.atan2(this.mouse.y-(this.playerPosition.y+this.height/2),this.mouse.x-(this.playerPosition.x+this.width/2));this.gunAngle=function(t,i,s){const e=2*Math.PI;(t%=e)<0&&(t+=e),(i%=e)<0&&(i+=e);let h=i-t;return h>Math.PI?h-=e:h<-Math.PI&&(h+=e),(t+h*s+e)%e}(this.gunAngle,this.targetAngle,.1)}dg(t){t.save(),t.translate(this.playerPosition.x+this.player.width/2,this.playerPosition.y+this.player.height/2),t.rotate(this.gunAngle),t.scale(-1,this.player.direction),this.position={x:-this.width,y:-this.height/2},this.drawSprite(t),t.restore(),t.beginPath(),t.moveTo(this.player.position.x+this.player.width/2,this.player.position.y+this.player.height/2),this.bulletsAmount>0&&t.arc(this.player.position.x+this.player.width/2,this.player.position.y+this.player.height/2,200,this.gunAngle-.15,this.gunAngle+.15),t.fillStyle="rgb(0, 0, 0, 0.15)",t.fill(),this.updateBullets(t,this.player.position)}async attack(){const t=1===this.bulletDamage?1:this.bulletDamage;this.bulletDamage=1;const i=new P({position:{x:this.playerPosition.x+this.width/2,y:this.playerPosition.y+this.height/2},angle:this.gunAngle,damage:t,rb:this.rb.bind(this)});this.bulletsAmount>1?0===this.attackFrame.cf&&(this.gunAngle-=this.player.direction/5,this.bulletsAmount-=1,this.bullets.push(i),await this.attackFrame.startCounting()):0===this.reloadFrame.cf&&(this.gunAngle-=this.player.direction/5,this.bulletsAmount-=1,this.bullets.push(i),this.player.reloadAnimation=!0,await this.reloadFrame.startCounting(),this.reload())}reload(){this.player.reloadAnimation=!1,this.bulletsAmount=13}updateBullets(t,i){this.bullets=this.bullets.filter((s=>{s.update(),s.draw(t);const e=Math.abs(s.position.x-i.x),h=Math.abs(s.position.y-i.y);return e<=750&&h<=750}))}rb(t){this.bullets.splice(t,1)}}class R{constructor(t,s){i(this,"player"),i(this,"position"),i(this,"velocity"),i(this,"gravity"),i(this,"wind"),i(this,"isThrown"),i(this,"startPoint"),i(this,"endPoint"),i(this,"t"),i(this,"flightDuration"),i(this,"rotation"),i(this,"grenadeHitBoxRadius"),i(this,"removeGrenade"),i(this,"boom",!1),i(this,"boomRange",280),this.player=t,this.position={x:this.player.position.x+this.player.width/2,y:this.player.position.y+this.player.height/2},this.gravity=.5,this.wind=0,this.isThrown=!1,this.velocity={x:0,y:0},this.startPoint={x:0,y:0},this.endPoint={x:0,y:0},this.t=0,this.flightDuration=.8,this.rotation=-.5,this.grenadeHitBoxRadius=Math.max(30,30)/3,this.removeGrenade=s}updateGrenade(t){const i={x:this.player.position.x+this.player.width/2,y:this.player.position.y+this.player.height/2};if(this.position={x:1===this.player.direction?i.x-15:i.x+15,y:i.y},!this.isThrown){this.startPoint={x:i.x,y:i.y},this.endPoint={x:t.x,y:t.y};const s=Math.sqrt(Math.pow(this.endPoint.x-this.startPoint.x,2)+Math.pow(this.endPoint.y-this.startPoint.y,2));this.flightDuration=Math.max(.4,Math.min(.8,s/300)),this.t=0,this.isThrown=!0}if(this.isThrown){this.t+=.02/this.flightDuration,this.t>1&&(this.t=1,this.boom=!0);const t=this.startPoint.x,i=this.startPoint.y,s=this.startPoint.x+.5*Math.abs(this.startPoint.x-this.endPoint.x)*this.player.direction;let e;const h=Math.abs(this.startPoint.y-this.endPoint.y);e=h<50?this.startPoint.y-150:this.endPoint.y<this.startPoint.y?this.startPoint.y-1.5*h:this.startPoint.y-.5*h;const a=this.endPoint.x,o=this.endPoint.y;this.position.x=(1-this.t)*(1-this.t)*t+2*(1-this.t)*this.t*s+this.t*this.t*a,this.position.y=(1-this.t)*(1-this.t)*i+2*(1-this.t)*this.t*e+this.t*this.t*o,this.rotation+=.1}}drawGrenade(t){if(this.isThrown){const i=Math.abs(this.startPoint.y-this.endPoint.y),s=i<50?this.startPoint.y-150:this.endPoint.y<this.startPoint.y?this.startPoint.y-1.5*i:this.startPoint.y-.5*i;t.beginPath(),t.moveTo(this.startPoint.x,this.startPoint.y),t.quadraticCurveTo(this.startPoint.x+.5*Math.abs(this.startPoint.x-this.endPoint.x)*this.player.direction,s,this.endPoint.x,this.endPoint.y),t.stroke()}t.fillStyle="green",t.strokeStyle="black",t.lineWidth=2,t.save(),t.translate(this.position.x,this.position.y),t.rotate(this.rotation*this.player.direction),t.translate(-this.position.x,-this.position.y),t.beginPath(),t.rect(this.position.x-6,this.position.y,12,20),t.fillStyle="rgba(255,0,0,0.2)",t.fillRect(this.position.x-this.boomRange/2,this.position.y-this.boomRange/2,this.boomRange,this.boomRange),t.setLineDash([]),t.lineWidth=2.5,t.moveTo(this.position.x-3,this.position.y-10),t.lineTo(this.position.x+3,this.position.y-10),t.lineTo(this.position.x+4,this.position.y),t.lineTo(this.position.x-4,this.position.y),t.closePath(),t.fill(),t.stroke(),t.restore()}}class C{constructor(t,s){i(this,"canvas"),i(this,"player"),i(this,"grenades"),i(this,"grenadesAmount"),i(this,"grenadeFrame",new p({fps:8,cf:0,mf:2})),i(this,"update",((t,i)=>{this.grenades.forEach((t=>{t.boom&&this.removeGrenade(t)})),this.grenadeFrame.cf>0&&this.grenadeFrame.te(i)&&this.grenadeFrame.uf(),this.grenades.map((i=>i.updateGrenade(t)))})),i(this,"draw",(t=>{this.grenades.map((i=>i.drawGrenade(t)))})),i(this,"generateGrenade",(()=>{const t=new R(this.player,this.removeGrenade);this.grenades.push(t)})),i(this,"attack",(async()=>{this.grenadesAmount>0&&0===this.grenadeFrame.cf&&(this.generateGrenade(),this.grenadesAmount-=1,await this.grenadeFrame.startCounting())})),i(this,"removeGrenade",(t=>{this.grenades=this.grenades.filter((i=>i!==t))})),this.canvas=s,this.player=t,this.grenades=[],this.grenadesAmount=3}updateBulletOffset(t,i){this.grenades.forEach((s=>{s.endPoint[t]-=i}))}}class z extends A{constructor({canvas:t,position:s,imgSrc:e,scale:h=3,columns:a=8,mfs:o=8,width:n,height:r,offSet:l,direction:c}){super({canvas:t,position:s,imgSrc:e,scale:h,columns:a,mfs:o,width:n,height:r,offSet:l,direction:c}),i(this,"score",0),i(this,"canvas"),i(this,"centerBox"),i(this,"velocity",{x:0,y:0}),i(this,"inCampfireRange",[]),i(this,"healthInMs",d),i(this,"health",this.healthInMs/d),i(this,"collision",{left:!1,right:!1,top:!1,bottom:!1}),i(this,"aboutToCollide",!1),i(this,"playerHitBoxRadius"),i(this,"centerPoint"),i(this,"speed",5),i(this,"direction",1),i(this,"state"),i(this,"previousState"),i(this,"states"),i(this,"sprite"),i(this,"frame",new p({fps:15,cf:0,mf:10})),i(this,"reloadAnimationFrame",new p({fps:10,cf:0,mf:2})),i(this,"reloadAnimation",!1),i(this,"moveFrame",new p({fps:60})),i(this,"gun"),i(this,"grenadier"),i(this,"isAttacking"),i(this,"isThrowingGrenade"),i(this,"isDead",!1),i(this,"bonusSpeedTimeInMs",0),i(this,"bonusSpeedStaticTime",2e3),i(this,"update",(({keys:t,mousePos:i,offset:s,isInMenu:e,enemies:h,time:a})=>{e||(this.bonusSpeedTimeInMs>0&&(this.bonusSpeedTimeInMs-=a),this.inCampfireRange.includes(!0)?this.healthInMs<d&&(this.healthInMs+=4*a):this.healthInMs>0?this.healthInMs-=a:this.isDead=!0,this.inCampfireRange=[],this.health=this.healthInMs/d,this.frame.te(a)&&(this.frame.uf(),this.animateFrames()),this.reloadAnimationFrame.te(a)&&this.reloadAnimation&&(this.reloadAnimationFrame.cf%2==0?this.gun.gunAngle-=.2:this.gun.gunAngle+=.2,this.reloadAnimationFrame.uf()),this.reloadAnimationFrame.cf>0&&this.reloadAnimationFrame.te(a)&&this.reloadAnimationFrame.uf(),this.gun.updateGun(i,a),this.grenadier.update(i,a),this.moveFrame.te(a)&&(this.state.input(t),i.x>=this.position.x+this.width/2?this.direction=1:this.direction=-1,this.inCenterBox(),this.collision.left||this.collision.right?((this.collision.left&&this.velocity.x>0||this.collision.right&&this.velocity.x<0)&&(this.position.x+=this.velocity.x),s.x+=this.velocity.x,this.gun.updateBulletOffset("x",this.velocity.x),this.grenadier.updateBulletOffset("x",this.velocity.x),h.forEach((t=>{t.updateEnemiesOffset("x",this.velocity.x)}))):(this.position.x+=this.velocity.x,this.centerPoint.x+=this.velocity.x),this.collision.top||this.collision.bottom?((this.collision.top&&this.velocity.y>0||this.collision.bottom&&this.velocity.y<0)&&(this.position.y+=this.velocity.y),s.y+=this.velocity.y,this.gun.updateBulletOffset("y",this.velocity.y),this.grenadier.updateBulletOffset("y",this.velocity.y),h.forEach((t=>{t.updateEnemiesOffset("y",this.velocity.y)}))):(this.position.y+=this.velocity.y,this.centerPoint.y+=this.velocity.y)))})),i(this,"setState",(t=>{this.previousState=this.state,this.state=this.states[t]})),i(this,"setSprite",(t=>{this.sprite!==t&&(this.sprite=t,this.framesCurrent=0,this.image.src=t.imageSrc,this.columns=t.columns,this.mfs=t.mfs,this.frame.setFPS(t.fps))})),i(this,"inCenterBox",(()=>{this.position.x+this.velocity.x<this.centerBox.position.x?this.collision.left=!0:this.position.x+this.width+this.velocity.x>this.centerBox.position.x+this.centerBox.width?this.collision.right=!0:(this.collision.left=!1,this.collision.right=!1),this.position.y+this.velocity.y<this.centerBox.position.y?this.collision.top=!0:this.position.y+this.height+this.velocity.y>this.centerBox.position.y+this.centerBox.height?this.collision.bottom=!0:(this.collision.top=!1,this.collision.bottom=!1)})),i(this,"bonusAction",(t=>{if("speed"===t)this.bonusSpeedTimeInMs=this.bonusSpeedStaticTime;else if("health"===t){if(this.healthInMs<d){const t=d-this.healthInMs;this.healthInMs+=Math.min(t,5e3)}this.health=this.healthInMs/d}else"damage"===t?this.gun.bulletDamage=13:"granade"===t&&(this.grenadier.grenadesAmount+=1);this.score+=1})),i(this,"draw",(t=>{this.drawSprite(t),this.grenadier.draw(t),this.gun.dg(t),t.fillStyle="rgba(0, 0, 0, 1)"})),i(this,"attack",(async()=>{this.isAttacking||(this.isAttacking=!0,await this.gun.attack(),this.isAttacking=!1)})),i(this,"throwGrenade",(async()=>{this.isThrowingGrenade||(this.isThrowingGrenade=!0,await this.grenadier.attack(),this.isThrowingGrenade=!1)})),this.canvas=t,this.position.x=this.canvas.width/2-this.width/2,this.position.y=this.canvas.height/2-this.height/2-this.height,this.playerHitBoxRadius=Math.max(this.width,this.height)/3,this.gun=new I(this,this.canvas),this.grenadier=new C(this,this.canvas),this.isAttacking=!1,this.isThrowingGrenade=!1,this.state=null,this.previousState=null,this.states=[new M(this),new B(this)],this.sprite=null,this.setState(S),this.setSprite(v.IDLE),this.centerBox={position:{x:this.canvas.width/2-this.canvas.width/4/2,y:this.canvas.height/4},width:this.canvas.width/4,height:this.canvas.height/2},this.centerPoint={x:this.position.x+this.width/2,y:this.position.y+this.height/2}}resetValues(){this.score=0,this.healthInMs=d,this.health=this.healthInMs/d,this.position.x=this.canvas.width/2-this.width/2,this.position.y=this.canvas.height/2-this.height/2-this.height,this.gun.bullets=[],this.gun.bulletsAmount=13,this.isDead=!1,this.grenadier.grenades=[]}drawInfo(t){t.font="20px Courier New",t.fillStyle="black",t.textAlign="left",t.fillText(`score: ${this.score}`,10,30),t.fillText(`time before freezing: ${(this.healthInMs/1e3).toFixed(1)}s`,10,50),t.fillText(`gun ammo: ${this.gun.bulletsAmount}`,10,70),t.fillText(`granades: ${this.grenadier.grenadesAmount}`,10,90)}}class D{constructor({canvas:t}){i(this,"keys"),i(this,"mousePos"),i(this,"canvas"),this.keys=l,this.mousePos={x:0,y:0},this.canvas=t,window.addEventListener("keydown",this.handleKeyDown.bind(this)),window.addEventListener("keyup",this.handleKeyUp.bind(this)),window.addEventListener("mousemove",this.handleMouseMove.bind(this))}handleKeyDown(t){t.code in l&&(this.keys[t.code]=!0)}handleKeyUp(t){t.code in l&&(this.keys[t.code]=!1)}handleMouseMove(t){this.mousePos.x=t.clientX-(window.innerWidth-this.canvas.width)/2,this.mousePos.y=t.clientY-(window.innerHeight-this.canvas.height)/2}}const T="data:image/webp;base64,UklGRk4BAABXRUJQVlA4TEIBAAAv78AJEDdAJmCxEmKI4BdJezUINTAugfmZAvo3pKiNFGgvcMEX/8LwgEAgyR9h2QPg/9VVDadkbb4AuZEkR87g1F+Q/0PtcA24oQXHXgMo+k/Z/tuwM2AVVvxIIKL/jNy2jeSid2qWT6R/fQfYaJblt13M8kQWAEoGsJF803Tc7n3YcMtRspjZRsgwy5Jvmo6XZ3fecTdasmYRMnwMmcw8ye7d/UHhuW84rwI1n9TB58JuLjy/y5vXZcprgZJP7GAhg3nmM3vjG8yMr1rGST6lQ5jZG18185lVIOc1QMmndUzwL1xt3CPbU9PWUV4LlHxqBwd2bH1jOfy+99b8yXkNUPKJHSxE4KVAKd0n8/XXUgrYM0ApFaj5xA6O7ujeA/gMaukBUEsAwOdB8kkdk1hSRMQhcWBEms43oXmVp94/lycB";class G{constructor({canvas:t}){i(this,"canvas"),i(this,"position",{x:0,y:0}),i(this,"width"),i(this,"isPlaying",!1),i(this,"transitionEnded",!1),this.canvas=t,this.width=t.width/4,this.position.x=-this.canvas.width/2}start(){this.isPlaying=!0}update({time:t}){this.isPlaying&&(this.position.x+=2*t),this.position.x>=this.canvas.width+this.canvas.width/2&&(this.isPlaying=!1,this.position.x=-this.canvas.width/2,this.transitionEnded=!0)}draw(t){this.transitionEnded||(t.fillStyle="black",t.fillRect(this.position.x,this.position.y,this.width,this.canvas.height))}}class K extends A{constructor({canvas:t,position:s,imgSrc:e,scale:h=3,columns:a=6,mfs:o=6,width:n,height:r,offSet:l,direction:d,removeEnemy:y,speed:g,health:m,background:u,score:f}){super({canvas:t,position:s,imgSrc:e,scale:h,columns:a,mfs:o,width:n,height:r,offSet:l,direction:d}),i(this,"frame",new p({fps:15,cf:0,mf:10})),i(this,"attackFrame",new p({fps:.5,cf:0,mf:2})),i(this,"moveFrame",new p({fps:4,cf:0,mf:8})),i(this,"health"),i(this,"fullHealth"),i(this,"isDead"),i(this,"speed"),i(this,"collision"),i(this,"removeEnemy"),i(this,"background"),i(this,"directionInCollision"),i(this,"score",1),i(this,"update",(({time:t,player:i})=>{this.health<=0&&(this.isDead=!0,i.score+=this.score,this.removeEnemy(this)),this.frame.te(t)&&(this.attack(),this.frame.uf(),this.animateFrames()),this.attackFrame.cf>0&&this.attackFrame.te(t)&&this.attackFrame.uf(),this.goTowardsPlayer({player:i})})),i(this,"draw",(t=>{this.drawSprite(t),this.fullHealth>1&&this.drawHealthBar(t)})),i(this,"attack",(async()=>{0===this.attackFrame.cf&&await this.attackFrame.startCounting()})),i(this,"goTowardsPlayer",(({player:t})=>{const i=[{x:0,y:-this.speed},{x:0,y:this.speed},{x:-this.speed,y:0},{x:this.speed,y:0}];let s=1/0,e={x:0,y:1},h=!1;i.forEach((i=>{const a={x:this.position.x+i.x,y:this.position.y+i.y},o=Math.hypot(a.x-t.position.x-t.width/2,a.y-t.position.y-t.height/2);this.background.ctic(a,this)?h=!0:o<s&&(s=o,e=i)})),h?(this.directionInCollision&&(this.background.ctic({x:this.position.x+this.directionInCollision.x,y:this.position.y+this.directionInCollision.y},this)||(e=this.directionInCollision)),this.directionInCollision=e):this.directionInCollision=void 0,this.position.x+=e.x,this.position.y+=e.y,c({position:this.position,width:this.width,height:this.height},{position:t.position,width:t.width,height:t.height})&&(t.isDead=!0)})),this.score=f,this.fullHealth=m,this.health=m,this.isDead=!1,this.speed=g,this.removeEnemy=y,this.collision=!1,this.background=u}updateEnemiesOffset(t,i){this.position[t]-=i}drawHealthBar(t){const i=this.health/this.fullHealth;t.fillStyle="red",t.fillRect(this.position.x,this.position.y,this.width,10),t.fillStyle="green",t.fillRect(this.position.x,this.position.y,this.width*i,10)}}const O=10,U=(t,i,s)=>{t.fillRect(i,s,O,O)},V=(t,i,s)=>{for(let e=0;e<7;e++)U(t,i,s+e*O);for(let e=0;e<5;e++)U(t,i+e*O,s);for(let e=0;e<5;e++)U(t,i+e*O,s+60);for(let e=0;e<4;e++)U(t,i+e*O,s+30)},W=(t,i,s)=>{((t,i,s)=>{for(let e=0;e<7;e++)U(t,i,s+e*O);for(let e=0;e<5;e++)U(t,i+e*O,s);for(let e=0;e<4;e++)U(t,i+e*O,s+30)})(t,i,s),((t,i,s)=>{for(let e=0;e<7;e++)U(t,i,s+e*O);for(let e=0;e<4;e++)U(t,i+e*O,s);for(let e=0;e<4;e++)U(t,i+e*O,s+30);U(t,i+40,s+O),U(t,i+40,s+20),U(t,i+20,s+40),U(t,i+30,s+50),U(t,i+40,s+60)})(t,i+60,s),V(t,i+120,s),V(t,i+180,s),((t,i,s)=>{for(let e=0;e<5;e++)U(t,i+e*O,s);for(let e=0;e<5;e++)U(t,i+e*O,s+60);for(let e=1;e<6;e++)U(t,i+(5-e)*O,s+e*O)})(t,i+240,s),((t,i,s)=>{for(let e=1;e<4;e++)U(t,i+e*O,s);for(let e=1;e<4;e++)U(t,i+e*O,s+60);for(let e=1;e<6;e++)U(t,i,s+e*O);for(let e=1;e<6;e++)U(t,i+40,s+e*O)})(t,i+300,s),((t,i,s)=>{for(let e=0;e<7;e++)U(t,i,s+e*O);for(let e=0;e<4;e++)U(t,i+e*O,s);for(let e=0;e<4;e++)U(t,i+e*O,s+30);for(let e=0;e<4;e++)U(t,i+e*O,s+60);U(t,i+40,s+10),U(t,i+40,s+20),U(t,i+40,s+40),U(t,i+40,s+50)})(t,i+360,s),((t,i,s)=>{for(let e=0;e<7;e++)U(t,i+20,s+e*O)})(t,i+410,s),((t,i,s)=>{for(let e=1;e<4;e++)U(t,i+e*O,s);for(let e=0;e<4;e++)U(t,i+e*O,s+30);for(let e=1;e<7;e++)U(t,i,s+e*O);for(let e=1;e<7;e++)U(t,i+40,s+e*O)})(t,i+460,s)};class Q{constructor({canvas:t}){i(this,"canvas"),i(this,"background"),i(this,"player"),i(this,"enemies"),i(this,"input"),i(this,"transition"),i(this,"collision"),i(this,"frame",new p({fps:2})),i(this,"enemySpawnFrame",new p({fps:.5})),i(this,"miniBossSpawnFrame",new p({fps:.1})),i(this,"showTextInfo",!1),i(this,"score",0),i(this,"isInMenu",!0),i(this,"startGame",!1),i(this,"removeEnemy",(t=>{this.enemies=this.enemies.filter((i=>i!==t))})),this.canvas=t,this.transition=new G({canvas:this.canvas}),this.background=new w({canvas:t}),this.player=new z({canvas:t,position:{x:0,y:0},width:48,height:72,offSet:{x:0,y:32},scale:3,imgSrc:b}),this.enemies=[],this.input=new D({canvas:this.canvas}),this.collision=new x}update(t){if(this.frame.te(t)&&(this.showTextInfo=!this.showTextInfo),this.enemySpawnFrame.te(t)&&this.startGame){const t=E(this.canvas),i=new K({canvas:this.canvas,position:t,width:42,height:33,offSet:{x:4,y:12},score:1,scale:3,imgSrc:T,removeEnemy:this.removeEnemy,speed:1.25,health:1,background:this.background});this.enemies.push(i)}if(this.miniBossSpawnFrame.te(t)&&this.startGame){const t=E(this.canvas),i=new K({canvas:this.canvas,position:t,width:84,height:66,offSet:{x:8,y:24},scale:6,imgSrc:T,removeEnemy:this.removeEnemy,speed:.8,health:20,background:this.background,score:3});this.enemies.push(i)}this.player.isDead&&(this.score=this.player.score,this.startGame=!1,this.isInMenu=!0,this.resetValues(),this.transition.transitionEnded=!1,this.miniBossSpawnFrame.ft=0,this.enemySpawnFrame.ft=0,this.enemies=[]),this.isInMenu&&this.input.keys.Space&&this.transition.start(),this.transition.transitionEnded&&(this.startGame=!0,this.isInMenu=!1,this.transition.isPlaying=!1),this.transition.update({time:t}),this.player.update({keys:this.input.keys,enemies:this.enemies,mousePos:this.input.mousePos,offset:this.background.grid.offset,isInMenu:this.isInMenu,time:t}),this.enemies.forEach((i=>{i.update({time:t,player:this.player}),this.collision.enemyWithBullet({enemies:this.enemies,bullets:this.player.gun.bullets}),this.collision.ewgr({enemies:this.enemies,grenades:this.player.grenadier.grenades})})),this.background.update({time:t,player:this.player,enemies:this.enemies,isInMenu:this.isInMenu})}resetValues(){this.player=new z({canvas:this.canvas,position:{x:0,y:0},width:48,height:72,offSet:{x:0,y:32},scale:3,imgSrc:b}),this.background=new w({canvas:this.canvas})}draw(t){this.background.drawTileWithCampfire(t),this.player.draw(t),this.enemies.map((i=>i.draw(t))),this.background.diww(t),this.drawEyeEffect(t),this.isInMenu&&this.drawMenuOverlay(t),this.isInMenu||this.player.drawInfo(t),this.transition.draw(t)}drawMenuOverlay(t){t.fillStyle="rgba(0, 0, 0, 0.7)",t.fillRect(0,0,this.canvas.width,this.canvas.height),t.font="48px Courier New",t.fillStyle="white",t.textAlign="center",W(t,this.canvas.width/2-230,50),0===this.score?(t.font="20px Courier New",t.fillText("Move - WSAD",this.canvas.width/2,220),t.fillText("Shoot - mouse click",this.canvas.width/2,240),t.fillText("granade - Q",this.canvas.width/2,260)):(t.font="24px Courier New",t.fillText(`Final score: ${this.score}`,this.canvas.width/2,220)),t.font="20px Courier New",this.showTextInfo&&t.fillText("press space to play",this.canvas.width/2,this.canvas.height-50)}drawEyeEffect(t){const i=t.createRadialGradient(this.canvas.width/2,this.canvas.height/2,15,this.canvas.width/2,this.canvas.height/2,this.canvas.width/2);i.addColorStop(.4,`rgba(122,122,122, ${Math.max(.75-this.player.health,0)})`),i.addColorStop(1,`rgba(0,0,0, ${Math.max(.9-this.player.health,0)})`),t.fillStyle=i,t.fillRect(0,0,this.canvas.width,this.canvas.height)}}const H=document.querySelector("canvas");H.width=Math.min(Math.max(1e3,window.innerWidth),2e3),H.height=Math.min(Math.max(500,window.innerHeight),1200);const N=H.getContext("2d");N.imageSmoothingEnabled=!1,window.addEventListener("load",(()=>{const t=new Q({canvas:H});let i=0;const s=e=>{const h=e-i;i=e,t.update(h),t.draw(N),requestAnimationFrame(s)};s(0)}));
