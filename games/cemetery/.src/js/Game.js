(()=>{function t(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,r){if(t){if("string"==typeof t)return e(t,r);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?e(t,r):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,o=new Array(e);r<e;r++)o[r]=t[r];return o}function r(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,o)}return r}function o(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?r(Object(o),!0).forEach((function(e){a(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function a(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function h(t,e,r){return e&&s(t.prototype,e),r&&s(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}var l=function(){function t(){i(this,t)}return h(t,null,[{key:"resultantOf",value:function(t,e){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))}}]),t}(),c=function(){function t(){i(this,t)}return h(t,null,[{key:"_",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=t.SLT(e,r);return o}},{key:"SLT",value:function(t,e){return"number"==typeof e?document.querySelectorAll(t)[e]:"length"==e?document.querySelectorAll(t).length:"this"==e?document.querySelectorAll(t):void 0}},{key:"RunOnLoad",value:function(e){t.OnLoadList.push(e)}}]),t}();a(c,"x",{}),a(c,"OnLoad",(function(t){})),a(c,"OnLoadList",[]),document.addEventListener("DOMContentLoaded",(function(t){c.OnLoad(t),c.OnLoadList.map((function(t){t()}))}));var d=h((function t(){i(this,t)}));a(d,"scope",d),a(d,"a",void 0),a(d,"b",void 0),a(d,"init",(function(t,e){d.a=t,d.b=e})),a(d,"line",(function(t,e,r,o){var n=this,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"red",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,s=[t,e,r,o,a,i];this.x=s[0],this.endX=s[1],this.y=s[2],this.endY=s[3],this.color=s[4],this.thick=s[5],this.lengthX=Math.abs(this.x-this.endX),this.breadthY=Math.abs(this.y-this.endY),this.center={},this.rotation={rad:0,about:this.center},this.alpha=1,this.GCParams={shadow:[0,0,"transparent",0]},this.updateProps=function(t){n.center.x=n.x,n.center.y=n.y+n.breadthY/2},this.autoStyle=new d.autoStyle(this.thick+"_"+this.color,this),this.draw=function(t){t.beginPath(),n.autoStyle.call(t),t.moveTo(n.x,n.y),t.lineTo(n.endX,n.endY),t.stroke(),t.closePath(),n.updateProps(t)}})),a(d,"sLine",(function(t,e,r,o,n,a){var i=this,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},h=[t,e,r,o,n,a];this.x=h[0],this.lengthX=h[1],this.y=h[2],this.breadthY=h[3],this.color=h[4],this.thick=h[5],this.center={},this.rotation={rad:0,about:this.center},this.alpha=1,this.GCParams={shadow:[0,0,"transparent",0]},this.updateProps=function(t){i.center.x=i.x,i.center.y=i.y+i.breadthY/2},this.autoStyle=new d.autoStyle(this.thick+"_"+this.color,this),this.draw=function(t){for(var e in i.endX=i.x+i.lengthX,i.endY=i.y+i.breadthY,t.beginPath(),i.autoStyle.call(t),s)t[e]=s[e];t.moveTo(i.x,i.y),t.lineTo(i.endX,i.endY),t.stroke(),t.closePath(),i.updateProps()}})),a(d,"arc",(function(t,e,r,o,n,a){var i=this;this.x=t,this.y=e,this.radius=r,this.startAngle=o,this.endAngle=n,this.styling=a,this.type="arc",this.center={},this.rotation={rad:0,about:this.center},this.alpha=1,this.GCParams={shadow:[0,0,"transparent",0]},this.indexInScene=null,this.updateProps=function(t){i.center.x=i.x,i.center.y=i.y},this.autoStyle=new d.autoStyle(this.styling,this),this.draw=function(t){t.beginPath(),t.arc(i.x,i.y,i.radius,i.startAngle,i.endAngle),i.autoStyle.call(t),t.closePath(),i.updateProps(t)}})),a(d,"rect",(function(t,e,r,o,n){var a=this;this.x=t,this.lengthX=e,this.y=r,this.breadthY=o,this.styling=n,this.center={},this.rotation={rad:0,about:this.center},this.alpha=1,this.GCParams={shadow:[0,0,"transparent",0]},this.updateProps=function(t){a.center.x=a.x+a.lengthX/2,a.center.y=a.y+a.breadthY/2},this.autoStyle=new d.autoStyle(this.styling,this),this.draw=function(t){t.beginPath(),a.autoStyle.call(t,(function(){t.strokeRect(a.x,a.y,a.lengthX,a.breadthY)}),(function(){t.fillRect(a.x,a.y,a.lengthX,a.breadthY)})),t.closePath(),a.updateProps(t)}})),a(d,"img",(function(t,e,r,o,n){var a=this;this.src=t,this.image=new Image,this.image.src=this.src,this.image.onload=function(){},this.src instanceof HTMLElement&&(this.image=t),this.x=e,this.lengthX=r,this.y=o,this.breadthY=n,this.center={},this.rotation={rad:0,about:this.center},this.alpha=1,this.GCParams={shadow:[0,0,"transparent",0]},this.updateProps=function(t){a.center.x=a.x+a.lengthX/2,a.center.y=a.y+a.breadthY/2},this.draw=function(t){t.drawImage(a.image,a.x,a.y,a.lengthX,a.breadthY),a.updateProps(t)}})),a(d,"group",(function(){})),a(d,"Group",(function(){var e=this;this.children=[],this.x=0,this.y=0,this.add=function(){for(var r=arguments.length,o=new Array(r),n=0;n<r;n++)o[n]=arguments[n];e.children=[].concat(t(e.children),o)}})),a(d,"autoStyle",(function(t,e){var r=this;this.set=function(t){var o;o="string"==typeof t?t.split("_"):t,r.object=e,r.color=r.object.color=o[1],r.strokeWidth=r.object.strokeWidth=Number(o[0]),r.styleType="FILL",""==o[0]&&(r.styleType="FILL"),""!=o[0]&&(r.styleType="STROKE")},this.call=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){t.stroke()},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){t.fill()};if(r.color=r.object.color,r.strokeWidth=r.object.strokeWidth,"FILL"==r.styleType&&(t.fillStyle=r.color,o()),"STROKE"==r.styleType&&(t.lineWidth=r.strokeWidth,t.strokeStyle=r.color,e()),void 0!==r.object.props)for(var n in r.object.props)t[n]=r.object.props[n]},this.set(t)})),a(d,"rotate",(function(t,e){0!=t.rotation.rad&&null!=t.center&&(e.translate(t.rotation.about.x,t.rotation.about.y),e.rotate(t.rotation.rad),e.translate(-t.rotation.about.x,-t.rotation.about.y))})),a(d,"shadow",(function(t,e){var r=[e[2],e[0],e[1],e[3]];t.shadowColor=r[0],t.shadowOffsetX=r[1],t.shadowOffsetY=r[2],t.shadowBlur=r[3]})),a(d,"stylesAndComposites",{draw:function(t,e){e.globalAlpha=t.alpha,d.shadow(e,t.GCParams.shadow)},restore:function(t,e){t.globalAlpha=1,d.shadow(t,[0,0,"transparent",0]),e.GCParams.norestore||(t.globalCompositeOperation="source-over")}}),a(d,"useScene",(function(t){var e=this;["rect","img","arc","line","sLine"].map((function(t){d[t].prototype.shapeName=t})),this.B=t,this.allChildren=[],function t(){d.clearCanvas(e.B),e.allChildren.map((function(t,r){t.indexInScene=r,e.B.save(),d.stylesAndComposites.draw(t,e.B),d.rotate(t,e.B),t.draw(e.B),d.stylesAndComposites.restore(e.B,t),e.B.restore()})),requestAnimationFrame(t)}(),this.add=function(t){t.indexInScene=e.allChildren.length,t.translation={x:0,y:0,allow:!1},e.allChildren.push(t)},this.remove=function(t){t.indexInScene&&e.allChildren.splice(t.indexInScene,1)}})),a(d,"clearCanvas",(function(t){t.clearRect(0,0,t.canvas.width,t.canvas.height)}));var p=c._("logSpace");p.style.color="red",logger={write:function(t){p.innerText=t}};var u=c._("scoreboard");function y(t){return Math.floor(t)}function f(){return Math.random()}function g(t,e,r,o){var n;CU=CR/3;var i=(a(n={head:new d.arc(r,o,CU/160,0,6.3,"_red"),body:new d.arc(r,o,CU/100,0,6.3,"_green")},"head",new d.sLine(r-CU/57,CU/60,o,0,"red",CU/40)),a(n,"body",new d.sLine(r,0,o-CU/40,CU/20,"rgba(0,200,0,0.6)",CU/27)),a(n,"leg1",new d.sLine(r,CU/40,o-CU/57,0,"yellowgreen",CU/57)),a(n,"leg2",new d.sLine(r,-CU/40,o+CU/57,0,"yellow",CU/57)),a(n,"arm1",new d.sLine(r,CU/24,o-CU/50,0,"yellowgreen",CU/57)),a(n,"arm2",new d.sLine(r,CU/24,o+CU/50,0,"yellow",CU/57)),a(n,"hnd1",new d.sLine(r,CU/22,o-CU/50,0,"yellowgreen",CU/66)),a(n,"hnd2",new d.sLine(r,CU/22,o+CU/50,0,"yellow",CU/66)),a(n,"gun",new d.sLine(r-CU/57,CU/60,o,0,"red",CU/40)),a(n,"gfc",new d.sLine(r-CU/57,CU/60,o,0,"black",CU/40)),a(n,"gfp",new d.rect(CU/57,CU/60,o,0,"red")),n);["leg1","leg2","body","arm1","arm2","hnd1","hnd2","head","gun","gfc","gfp"].map((function(t){e.add(i[t])})),i.head.props={lineCap:"round"},i.body.props={lineCap:"round"},i.leg1.props={lineCap:"round"},i.leg2.props={lineCap:"round"},i.leg1.dx=0,i.leg2.dx=0,i.leg1.dy=0,i.leg2.dy=0,i.arm1.props={lineCap:"round"},i.arm2.props={lineCap:"round"},i.arm1.dx=0,i.arm2.dx=0,i.arm1.dy=0,i.arm2.dy=0,i.hnd1.props={lineCap:"round"},i.hnd2.props={lineCap:"round"};var s=this,h=!0,l={};this.reanimate=function(){l.now=new Date,null===l.last&&(l.last=l.now-1e3),l.fps=1,l.dlt=1/l.fps,hero=s,[hero.parts.arm1,hero.parts.arm2,hero.parts.leg1,hero.parts.leg2,hero.parts.body,hero.parts.head,hero.parts.gun,hero.parts.gfc].map((function(t){t.rotation.about={x:hero.x,y:hero.y},t.rotation.rad=hero.rot,t.color="#bb7777",hero.majorColor&&(t.color=hero.majorColor)})),hero.parts.body.x=hero.x,hero.parts.body.y=hero.y-CU/40,hero.parts.head.color="white",hero.parts.head.x=hero.x+CU/100,hero.parts.head.y=hero.y,hero.parts.gun.y=hero.y,hero.parts.gun.lengthX=CU/35,hero.parts.gun.strokeWidth=.8*hero.parts.hnd2.strokeWidth,hero.parts.gun.color="brown",hero.parts.gfc.y=hero.y,hero.parts.gfc.lengthX=CU,hero.parts.gfc.strokeWidth=.1*hero.parts.hnd2.strokeWidth,!hero.parts.gfc.keepcolor||hero.parts.gfc.keepcolor<=0?hero.parts.gfc.color="black":(hero.parts.gfc.color="red",hero.parts.gfc.keepcolor-=.1),hero.parts.gfp.y=hero.y,hero.parts.gfp.lengthX=CU/30,hero.parts.gfp.breadthY=CU/30,hero.parts.gfp.color="rgba(0,0,250,0)";var e=hero.keycontactDetected(hero);if(e.yes){for(var r in e.obj.obj.x=-300,e.obj.contacted=!0,t.unpickedkeys=[],t.keycontactList)-300==t.keycontactList[r].obj.x||t.unpickedkeys.push(1);t.unpickedkeyslength=t.unpickedkeys.length}if(hero.getFocusLimit(),hero.collisionDetected(hero).yes){hero.speed*=-1;var o=t.getNearestCm(hero);o.alpha=.1,t.triggerGhost(o.x,o.y,hero.x,hero.y,hero)}hero.walking=!0,hero.speed<0&&(hero.walking=!1),h&&hero.walking&&(hero.parts.leg1.dx-=hero.speed*CU/133*l.dlt,hero.parts.leg2.dx+=hero.speed*CU/133*l.dlt),hero.parts.leg1.x<=hero.x-CU/40&&(h=!1),!h&&hero.walking&&(hero.parts.leg2.dx-=hero.speed*CU/133*l.dlt,hero.parts.leg1.dx+=hero.speed*CU/133*l.dlt),hero.parts.leg2.x<=hero.x-CU/40&&(h=!0),hero.parts.leg2.x=hero.x+hero.parts.leg2.dx,hero.parts.leg1.x=hero.x+hero.parts.leg1.dx,hero.parts.leg2.y=hero.y-CU/57+hero.parts.leg2.dy,hero.parts.leg1.y=hero.y+CU/57+hero.parts.leg1.dy,hero.parts.arm2.x=hero.x+hero.parts.arm2.dx,hero.parts.arm1.x=hero.x+hero.parts.arm1.dx,hero.parts.arm2.y=hero.y-CU/31+hero.parts.arm2.dy,hero.parts.arm1.y=hero.y+CU/31+hero.parts.arm1.dy,hero.parts.hnd1.x=hero.parts.arm1.x+1.23*hero.parts.arm1.lengthX,hero.parts.hnd1.y=hero.parts.arm1.y,hero.parts.hnd2.x=hero.parts.arm2.x+1.23*hero.parts.arm2.lengthX,hero.parts.hnd2.y=hero.parts.arm2.y,hero.parts.hnd1.lengthX=CU/24,hero.parts.hnd2.lengthX=CU/24,"pistol_stretch"==hero.gunHold&&(hero.parts.hnd1.breadthY=-CU/50*1,hero.parts.hnd2.breadthY=+CU/50*1),"gun_pistol_stretch"==hero.gunHold&&(hero.parts.arm2.lengthX=CU/57,hero.parts.arm1.lengthX=CU/57,hero.parts.hnd1.x=hero.parts.arm1.x+1.35*hero.parts.arm1.lengthX,hero.parts.hnd1.y=hero.parts.arm1.y,hero.parts.hnd2.x=hero.parts.arm2.x+1.35*hero.parts.arm2.lengthX,hero.parts.hnd2.y=hero.parts.arm2.y,hero.parts.hnd1.breadthY=-CU/33,hero.parts.hnd2.breadthY=CU/100,hero.parts.gun.x=hero.parts.hnd2.x+hero.parts.hnd2.lengthX,hero.parts.gfc.x=hero.parts.hnd2.x+hero.parts.hnd2.lengthX),"gun_none"==hero.gunHold&&(hero.parts.arm2.lengthX=0,hero.parts.arm1.lengthX=0,hero.parts.hnd1.x=hero.parts.arm1.x+1.35*hero.parts.arm1.lengthX,hero.parts.hnd1.y=hero.parts.arm1.y,hero.parts.hnd2.x=hero.parts.arm2.x+1.35*hero.parts.arm2.lengthX,hero.parts.hnd2.y=hero.parts.arm2.y,hero.parts.hnd1.lengthX/=2,hero.parts.hnd2.lengthX/=2,hero.parts.hnd1.breadthY=-0,hero.parts.hnd2.breadthY=0),hero.parts.hnd1.rotation.rad=hero.parts.arm1.rotation.rad,hero.parts.hnd2.rotation.rad=hero.parts.arm2.rotation.rad,hero.parts.hnd1.rotation.about=hero.parts.arm1.rotation.about,hero.parts.hnd2.rotation.about=hero.parts.arm2.rotation.about,hero.parts.hnd1.color=hero.parts.arm1.color,hero.parts.hnd2.color=hero.parts.arm2.color,hero.y-=hero.speed*hero.dy*l.dlt,hero.x-=hero.speed*hero.dx*l.dlt,hero.width=2*hero.parts.body.breadthY,hero.left=hero.x-hero.width/2,hero.height=2*hero.parts.body.breadthY,hero.top=hero.y-hero.height/2,hero.speed>0&&(hero.speed-=.01),hero.speed<0&&(hero.speed+=.05),hero.speed>-.05&&hero.speed<.05&&(hero.speed=0),l.last=l.now,u.innerText="Pick up ".concat(t.unpickedkeyslength," of 13 crosses without triggering the ghosts"),requestAnimationFrame(hero.reanimate)},this.goTo=function(t,e){this.speed=.9},this.collisionDetected=function(e){return this.contactDetected(e,t.collisionList)},this.keycontactDetected=function(e){return this.contactDetected(e,t.keycontactList)},this.contactDetected=function(t,e){var r=e;for(var o in r){var n=r[o],a=t.left+t.width,i=t.top+t.height,s=n.left+n.width,h=n.top+n.height;if(t.speed,t.name!=o&&a>n.left&&t.left<s&&i>n.top&&t.top<h)return{yes:!0,obj:n}}return{yes:!1}},this.getFocusLimit=function(){var e=this.parts.gfp,r=this.parts.gfc,o=this.parts.gun.rotation.about.x,n=this.parts.gun.rotation.about.y,a=Math.sqrt(Math.pow(o-this.parts.gun.x,2)+Math.pow(n-this.parts.gun.y,2)),i="".concat(y(this.parts.gun.x+this.parts.gun.y+hero.dx+hero.dy));e.hypobj&&e.hypobj[i]||(e.hypobj={},e.hypobj[i]=0),e.hypobj[i]+=e.speed,e.hyp=e.hypobj[i],e.x=o+(a+e.hyp)*hero.dx*-1,e.y=n+(a+e.hyp)*hero.dy*-1,e.width=e.lengthX,e.left=e.x,e.height=e.breadthY,e.top=e.y,e.speed=10,this.collisionDetected(e,t.gfpcollisionList).yes&&(e.speed=0,r.lengthX=e.hyp)},this.action={focusgun:function(){},shoot:function(){s.parts.gfc.color="red",s.parts.gfc.keepcolor=2,console.log(s.parts.gfc.keepcolor)}},Object.assign(this,{parts:i,x:r,y:o,walking:!0,rot:-1.6,speed:0,dx:0,dy:1,gunHold:"gun_none"})}var m=function(){function t(){var e;i(this,t),this.controller=(e=[],{createController:function(){},set:function(t,r){return console.log(r),{listen:function(a){var i={type:t,direction:r,callback:a,ended:!0};if("object"==n(i.direction))for(var s=0;i.direction.length>s;s++)e.push(o(o({},i),{},{direction:i.direction[s]}));else e.push(i);return document.onkeydown=function(t){var r=t.keyCode;e.map((function(t){"keydown"===t.type&&("left"==t.direction&&37==r&&(t.ended=!1),"right"==t.direction&&39==r&&(t.ended=!1),"W"==t.direction&&87==r&&(t.ended=!1),t.ended||t.callback())}))},document.onkeyup=function(t){var r=t.keyCode;e.map((function(t){"keydown"==t.type&&("left"==t.direction&&37==r&&(t.ended=!0),"right"==t.direction&&39==r&&(t.ended=!0),"W"==t.direction&&87==r&&(t.ended=!0)),"keyup"==t.type&&" "==t.direction&&32==r&&t.callback()}))},function(){var t=this,r=document.querySelector("heroctrls[triangle] contr");r.onselectstart=function(t){return t.preventDefault(),!1},r.ontouchstart=r.onmousedown=function(t){t.preventDefault(),e.map((function(t){"mobile"==t.type&&"move-clicked"==t.direction&&t.callback()}))},r.ontouchend=r.onmouseup=function(t){t.preventDefault(),e.map((function(t){"mobile"==t.type&&"move-end"==t.direction&&t.callback()}))};var o=document.querySelector("heroctrls[square] contr");o.onselectstart=function(t){return t.preventDefault(),!1},o.ontouchstart=r.onmousedown=function(t){t.preventDefault(),e.map((function(t){"mobile"==t.type&&"shoot-clicked"==t.direction&&t.callback()}))},o.ontouchend=o.onmouseup=function(t){t.preventDefault(),e.map((function(t){"mobile"==t.type&&"shoot-ended"==t.direction&&t.callback()}))};var n=document.querySelector("heroctrls[joystick] contr");n.style.display="block";var a=n.getBoundingClientRect().left,i=n.getBoundingClientRect().top,s=-n.parentNode.getBoundingClientRect().left+n.getBoundingClientRect().left,h=-n.parentNode.getBoundingClientRect().top+n.getBoundingClientRect().top,l=n.parentNode;ctx=this,this.joystickDeg=-90,this.joystickLeft=n.style.left,this.joystickTop=n.style.top,this.joystickHistory=[],n.ontouchmove=function(r){if(r.preventDefault(),ePX=r.touches[0].pageX,ePY=r.touches[0].pageY,oppX=-1*(ePX-a),adjZ=-1*(ePY-i),degInRad=Math.atan(oppX/adjZ),degInRad=Math.atan2(oppX,adjZ),degInRad=Math.atan2(adjZ,oppX),degInAng=180*degInRad/Math.PI,t.joystickDeg=-degInAng,t.joystickLeft=100*(s+Math.cos((180-t.joystickDeg)*Math.PI/180)*n.clientHeight)/l.clientWidth,t.joystickTop=100*(h+Math.sin((180-t.joystickDeg)*Math.PI/180)*n.clientWidth)/l.clientHeight,n.style.left=t.joystickLeft+"%",n.style.top=t.joystickTop+"%",t.joystickHistory.push({left:t.joystickLeft,right:t.joystickTop,degInAng}),t.joystickMove="neutral",t.joystickHistory.length>=2){var o=t.joystickHistory.length-1,c=t.joystickHistory[o].degInAng,d=t.joystickHistory[o-1].degInAng;c<d&&(t.joystickMove="left"),c>d&&(t.joystickMove="right")}e.map((function(e){"mJS"==e.type&&("dgl"==e.direction&&"left"==t.joystickMove&&e.callback(),"dgr"==e.direction&&"right"==t.joystickMove&&e.callback(),"dga"==e.direction&&e.callback())}))},n.ontouchend=function(e){t.joystickHistory=[]}}(),i}}}}),this.controller.createController("mobile-joystick"),this.controller.createController("desktop-keyboard");var r=this.initWorld(),a=r.canvas,s=r.context;this.canvas=a,this.context=s,this.collisionList={},this.gfpcollisionList={},this.hero=new v,this.initLevel(new b(1)),this.audioList={},this.audioList.shoot=new Audio,this.audioList.shoot.src="./assets/gun-shot.mp3"}return h(t,[{key:"initWorld",value:function(){return e=(t=document.getElementById("canvas")).getContext("2d"),t.style="position: absolute; top: 50%;left: 50%;display: block;margin: 0 auto;transform: translate(-50%,-50%);",{canvas:t,context:e};var t,e}},{key:"setLevel",value:function(t){this.level=t}},{key:"getLevel",value:function(){return this.level}},{key:"initLevel",value:function(t){this.setLevel(t),this.initUi()}},{key:"setPlaystate",value:function(t){this.playstate=t}},{key:"setLastCheckPoint",value:function(t){this.lastCheckPoint=t}},{key:"getLastCheckPoint",value:function(){return this.lastCheckPoint}},{key:"initUi",value:function(){!function(t){var e=t.canvas,r=t.context,o=(window.screen.width<601||window.screen.width,.9*window.screen.width),n=(window.screen.height,e.width=o),a=e.height=o,i=l.resultantOf(n,a);window.CR=i;var s=new d.useScene(r),h=new d.rect(0,n,0,a,"_#000817");s.add(h),function(t,e,r,o){var n=t.context.createLinearGradient(0,0,0,o);n.addColorStop(0,"transparent"),n.addColorStop(1,"white");var a={shapes:[new d.rect(0,r,0,o,["","#d4d4d4d4"])]};e.add(a.shapes[0]);var i=new d.img("./assets/cemetery-c.svg",0,r,0,o);i.alpha=.051,e.add(i);var s=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r={left:t.x,width:t.lengthX,top:t.y,height:t.breadthY,obj:e?t:{}};return t.left=r.left,t.top=r.top,t.width=r.width,t.height=r.height,r};t.cemList=[];var h=function(){for(var t=12,e=[],r=0;t>r;r+=4)for(var o=1*r,n=0;t>n;n++)for(var a=1*n,i=1+y(3*f()),s=0;i>s;s++)e.push([o,a]),s!=i-1&&(o+=1*[-1,1][y(2*f())]);for(var h=0;t>h;h+=4)for(var l=1*h,c=0;t>c;c++)for(var d=1*c,p=1+y(3*f()),u=0;p>u;u++)e.push([d,l]),u!=p-1&&(l+=1*[-1,1][y(2*f())]);for(var g=[],m=0;t>m;m+=1)for(var b=function(t){var r=[m,t],o=!1;e.map((function(t){t[0]==r[0]&&t[1]==r[1]&&(o=!0)})),o||g.push(r)},v=0;t>v;v+=1)b(v);return{Filled:e,Empty:g,Units:t}}();h.area={w:r,h:o},h.FilledList=[],h.Empty.map((function(n){var a=h.Units,i=r/a,l=o/a,c=new d.rect(n[0]*i,i,n[1]*l,l,"_rgba(70, 70, 70, 0.7)");e.add(c);var p=s(c);if(t.collisionList["cg".concat(y(1e3*f()))]=p,t.gfpcollisionList["gfp".concat(y(1e3*f()))]=p,f()>.8){var u=new d.img("./assets/cemetery.svg",n[0]*i,i,n[1]*l,l);u.alpha=.5,e.add(u),t.cemList.push({cem:u,pos:n})}})),h.Filled.map((function(t){var e=h.Units,r=120/e,o=120/e;stamf={position:{x:t[0]*r-60-r/2,y:3.75,z:215+t[1]*o-o/2}},h.FilledList.push(t)})),t.Labyrinth=h;var l=t.Labyrinth.Units,c=t.Labyrinth.area,p=c.w/l,u=c.h/l,g=t.Labyrinth.FilledList,m=g.length,b=[],v=[];t.keycontactList={},t.unpickedkeys=[],t.unpickedkeyslength=0;for(var w=function(){var r=y(f()*m);if(void 0!==v.find((function(t){return t==r})))return"continue";var o=g[r];if(o[0]<0||o[1]<0)return"continue";v.push(r),b.push(o),console.log(o);var n=new d.img("./assets/cemetery-c.svg",o[0]*p+p/4,p/2,o[1]*u+u/4,u/2);n.alpha=.5,e.add(n),t.keycontactList["ky".concat(y(1e3*f()))]=s(n,!0),t.unpickedkeys.push(1)};b.length<13;)w();var x=[];t.triggerGhost=function(o,n,a,i){var s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],h={};return(h=new d.img("./assets/ghost-3.svg",0,0,0,0)).alpha=1,e.add(h),x.push(h),h.expired=!1,h.x=o,h.y=n,h.my=i,h.mx=a,h.mlengthX=r/17,h.mbreadthY=h.mlengthX,h.lengthX=h.mlengthX/50,h.breadthY=h.mbreadthY/50,h.speedx=.25*(1+.2*f()),h.speedy=.25*(2.5+.2*f()),h.follow=s,t.gfpcollisionList["gfp".concat(y(1e3*f()))]=h,h};var k={};!function t(){k.now=new Date,null===k.last&&(k.last=k.now-2e4),k.fps=1,k.dlt=1/k.fps,x.map((function(t,e){t.expired||(t.follow&&(t.mx=t.follow.x,t.my=t.follow.y),t.y>t.my&&(t.y-=.5*t.speedy),t.y<t.my&&(t.y+=.5*t.speedy),t.x>t.mx&&(t.x-=.5*t.speedx),t.x<t.mx&&(t.x+=.5*t.speedx),t.lengthX<t.mlengthX&&(t.lengthX+=.4*t.speedx*k.dlt),t.breadthY<t.mbreadthY&&(t.breadthY+=.4*t.speedx*k.dlt))})),k.last=k.now,requestAnimationFrame(t)}(),t.getNearestCm=function(e){t.cemList=t.cemList.sort((function(t,r){if(t.used||r.used){if(t.used)return 1;if(r.used)return-1}return Math.hypot(t.cem.x-e.x,t.cem.y-e.y)-Math.hypot(r.cem.x-e.x,r.cem.y-e.y)}));var r=t.cemList[0].cem;return t.cemList[0].used=!0,r}}(t,s,n,a);var c=new g(t,s,n/2,a/2);c.type="hero",c.majorColor="#232333",c.reanimate(1),c.gunHold="gun_pistol_stretch",c.action.focusgun(),c.name="hero",c.parts.gfp.name="hero",t.collisionList.hero=c;var p=t.Labyrinth.Units,u=t.Labyrinth.area,m=u.w/p,b=u.h/p,v=t.Labyrinth.FilledList,w=v.length,x=function t(){var e=v[y(f()*w)];return e[0]<0||e[1]<0?t():e}();c.x=x[0]*m+m/2,c.y=x[1]*b+b/2,t.controller.set("mobile","move-clicked").listen((function(){c.speed=.9})),t.controller.set("mobile","move-ended").listen((function(){c.speed=0})),t.controller.set("mJS","dgr").listen((function(){c.rot+=Math.PI/128})),t.controller.set("mJS","dgl").listen((function(){c.rot-=Math.PI/128})),t.controller.set("mJS","dga").listen((function(){c.dy=-Math.sin(c.rot),c.dx=-Math.cos(c.rot)})),t.controller.set("mobile","shoot-clicked").listen((function(){c.action.shoot(),t.audioList.shoot.play()})),t.controller.set("mobile","shoot-ended").listen((function(){}))}(this)}}]),t}(),b=function(){function t(e){return i(this,t),this.setProps([{name:"shootout",difficulty:1,index:1},{name:"defense",difficulty:2,index:2}][e-1]),this}return h(t,[{key:"setProps",value:function(t){for(var e in t)this[e]=t[e]}}]),t}(),v=h((function t(){i(this,t),this.health=100,this.active=!1})),w=new m;console.log(w.hero),console.log(w.level)})();