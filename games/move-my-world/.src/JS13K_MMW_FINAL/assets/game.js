function vct(a,b){var c=this;c.x=a,c.y=b}function r_vct(a,b){var c=this;c.x=b,c.y=a}function image(a,b,c){totalAssetCount++;var d=new Image;return d.src=a,d.width=b,d.height=c,d.addEventListener("load",function(){loadedAssetCount++,console.log("an asset loaded")}),d}function preload(){function c(){function h(a,b,c,d){var e=this;e.oPos={x:a.x,y:a.y},e.name="parObst",e.position=a,e.width=b,e.height=c,e.rot=d,e.img=rectShape}function i(a,b){var c=this;c.name="parBall",c.position=a,c.radius=Math.min(40,b),c.width=2*c.radius,c.height=2*c.radius,c.hSpd=0,c.vSpd=0,c.maxSpd=16,c.gravDir=q.mth.d2r(270),c.grav=10,c.brush={fill:!0,color:"#C5322D"},c.pen={outline:!0,color:"#8C2020",width:4},c.highlightBrush={fill:!0,color:"#D75550"},c.highlightPen={outline:!1},c.seated=!1,c.winTimeout=null}function j(a,b,c,d){var e=new h(a,b,c,d);return e.name="parSpike",e.drawSelf=function(){var a=this;a.position.x+=g.position.x,a.position.y+=g.position.y,ctx.fillStyle="#ff0000",ctx.translate(a.position.x,a.position.y),ctx.rotate(a.rot+g.rot),ctx.fillRect(0,0,a.width,a.height),ctx.rotate(-a.rot-g.rot),ctx.translate(-a.position.x,-a.position.y),a.position.x-=g.position.x,a.position.y-=g.position.y},e}function k(a,b,c,d,e){var f=this;f.name="parBtn",f.position=a,f.width=b,f.height=c,f.img=d,f.text=e}function l(a,b,c,d){var e=new h(a,b,c,0);return e.name="parEnd",e.img=endShape,e.facing=d,e.tX=0,e.tY=0,e.tW=e.width,e.tH=e.height,e.create=function(){sprs.push(e);var a,b,c;switch(e.facing){case 0:e.width>e.height?(a=new h({x:e.position.x-20,y:e.position.y},20,e.height,0),b=new h({x:e.position.x+e.width,y:e.position.y},20,e.height,0),c=new h({x:e.position.x,y:e.position.y+e.height},e.width,20,0),a.create(),b.create(),c.create()):(a=new h({x:e.position.x,y:e.position.y-20},e.width,20,0),b=new h({x:e.position.x,y:e.position.y+e.height},e.width,20,0),c=new h({x:e.position.x+e.width,y:e.position.y},20,e.height,0),a.create(),b.create(),c.create());break;case 1:e.width>e.height?(a=new h({x:e.position.x-20,y:e.position.y},20,e.height,0),b=new h({x:e.position.x+e.width,y:e.position.y},20,e.height,0),c=new h({x:e.position.x,y:e.position.y-20},e.width,20,0),a.create(),b.create(),c.create()):(a=new h({x:e.position.x,y:e.position.y-20},e.width,20,0),b=new h({x:e.position.x,y:e.position.y+e.height},e.width,20,0),c=new h({x:e.position.x-20,y:e.position.y},20,e.height,0),a.create(),b.create(),c.create())}},e.drawSelf=function(){var a=this;a.position.x+=g.position.x,a.position.y+=g.position.y,ctx.translate(a.position.x,a.position.y),ctx.rotate(a.rot+g.rot);var b,c;switch(a.facing){case 0:a.width>a.height?(a.img=endShape,a.tX=0,a.tY=0,a.tW=a.width,a.tH=a.width/a.img.width*a.img.height,b=1,c=1):(a.img=endShapeVer,a.tX=0,a.tY=0,a.tH=a.height,a.tW=a.height/a.img.height*a.img.width,b=1,c=1);break;case 1:a.width>a.height?(a.img=endShapeFlip,a.tX=0,a.tY=0,a.tW=a.width,a.tH=a.width/a.img.width*a.img.height,b=1,c=-1):(a.img=endShapeVerFlip,a.tX=0,a.tY=0,a.tH=a.height,a.tW=a.height/a.img.height*a.img.width,b=-1,c=1)}ctx.drawImage(a.img,a.tX,a.tY,a.width,a.height),ctx.rotate(-a.rot-g.rot),ctx.translate(-a.position.x,-a.position.y),a.position.x-=g.position.x,a.position.y-=g.position.y},e}function H(a){for(var b=q.gm.arrFromStr(a),c=0;c<b.length;c++)switch(console.log(b[c]),b[c]){case"ball":C.position.x=parseInt(b[++c],10),C.position.y=parseInt(b[++c],10),C.radius=parseInt(b[++c],10)-4,C.create();break;case"end":var d=parseInt(b[++c],10),e=parseInt(b[++c],10),f=parseInt(b[++c],10),g=parseInt(b[++c],10),i=parseInt(b[++c],10),k=new l({x:d,y:e},f,g,i);k.img=endShape,k.create();break;case"block":var m=new h({x:parseInt(b[++c],10),y:parseInt(b[++c],10)},parseInt(b[++c],10),parseInt(b[++c],10),0);console.log("fat7i"),m.create();break;case"spike":var m=new j({x:parseInt(b[++c],10),y:parseInt(b[++c],10)},parseInt(b[++c],10),parseInt(b[++c],10),0);m.create()}}function J(){canvas.style.position="absolute";var c=window.innerWidth,d=window.innerHeight,f=c/d;if(c>d)topCanvas.style.display="none",canvas.style.display="block",canvas.width=600*f,canvas.style.height=d.toString()+"px",scaleRatio=600/d,canvas.style.left="0px",canvas.style.top="0px";else{canvas.style.display="none",topCanvas.style.display="block",topCanvas.width=c,topCanvas.height=d;var h=topCanvas.getContext("2d");h.font="30px Georgia",h.fillStyle="rgb(0, 0, 0)",h.textAlign="start";var i=c/2-157;h.fillText("Please rotate the",i,d/2),h.fillText(" device to play the game",i-40,d/2+50),ctx.fillRect(0,0,canvas.width,canvas.height)}switch(canvas.style.left="0px",canvas.style.top="0px",canvas.style.backgroundColor="#5b636a",ctx=canvas.getContext("2d"),ctx.fillStyle="#5b636a",ctx.fillRect(0,0,canvas.width,canvas.height),canvas.center={x:canvas.width/2,y:canvas.height/2},console.log("updateGame - "+a[b]+" -- objs: "+sprs.length),a[b]){case"rmMenu":if(e)g.rotating||waiting||moving||(waiting=!0,window.setTimeout(function(){waiting=!1},500+500*Math.random()),g.targetRot+=Math.round(Math.random())?Math.PI/2:-Math.PI/2),B.position.x=Math.max(0,(g.position.x-B.width)/2),A.position.x=(g.position.x-A.width)/2,moving||(A.position.y=350,B.position.y=150,g.position.x=canvas.width-600),ctx.fillStyle="#28323E",ctx.fillRect(g.position.x,0,600,600),ctx.fillStyle="#5B636A",ctx.fillRect(0,0,g.position.x,600),ctx.fillStyle="#44484B",ctx.fillRect(g.position.x-10,0,10,600),ctx.fillStyle="#25282B",ctx.fillRect(g.position.x-5,0,5,600);else{overAlpha=0,B.position.x=(canvas.width-600-B.width)/2,B.position.y=150,A.position.x=(canvas.width-600-A.width)/2,A.position.y=350,g.position.x=canvas.width-600;var j="ball-48-48-18-end-336-528-0-0-block-48-120-120-24-block-240-24-24-120-block-120-216-216-24-block-408-48-24-312-block-144-432-336-24-block-264-288-24-240-block-24-192-24-264-block-48-504-120-24-block-168-576-216-24-block-528-240-24-312-block-480-120-120-24-block-312-96-48-24-block-120-312-72-72";H(j),B.create(),A.create(),g.create(),e=!0}break;case"rmGame":if(e)1>overAlpha&&(overAlpha+=.08);else{overAlpha=0;var j=lvls[curLvl];""==j||null==j||"undefined"==typeof j?(b=0,q.gm.roomDestruct(),e=!1):(H(j),g.create(),F.create(),D.create(),E.create(),e=!0)}}g.drawBack();for(var k=0;k<sprs.length;k++)sprs[k].update();"rmMenu"==a[b]&&(ctx.fillStyle="rgba(40,50,62,"+overAlpha.toString()+")",ctx.fillRect(g.position.x,g.position.y,600,600))}var a=["rmMenu","rmGame","rmTest"],b=0,c=window.location.pathname,d=c.substring(c.lastIndexOf("/")+1);"test.html"==d&&(testing=!0,lvlText=readURL("lvl"),b=2);var e=!1,g={create:function(){sprs.push(g)},position:{x:canvas.width/2-300,y:canvas.height/2-300},width:600,height:600,rot:0,targetRot:0,atEnd:!1,drawBack:function(){ctx.beginPath(),ctx.fillStyle="rgb(40, 50, 62)",q.gfx.drawFixedRect({x:g.position.x+g.width/2,y:g.position.y+g.height/2},g.width,g.height,g.rot),ctx.closePath()},update:function(){("rmGame"==a[b]||"rmTest"==a[b])&&(g.position={x:canvas.width/2-300,y:canvas.height/2-300}),g.targetRot>=2*Math.PI?(g.rot-=2*Math.PI,g.targetRot-=2*Math.PI):g.targetRot<0&&(g.rot+=2*Math.PI,g.targetRot+=2*Math.PI),g.targetRot>g.rot?(g.rotating=!0,g.rotAmount=Math.min(.2,g.targetRot-g.rot),g.rot+=g.rotAmount):g.targetRot<g.rot?(g.rotating=!0,g.rotAmount=Math.max(-.2,g.targetRot-g.rot),g.rot+=g.rotAmount):g.rotating=!1,("rmGame"==a[b]||"rmTest"==a[b])&&(ctx.globalAlpha=overAlpha,ctx.fillStyle="#232628",ctx.fillRect(g.position.x+g.width,0,8,600),ctx.fillRect(g.position.x-8,0,8,600),ctx.fillStyle="#5B636A",ctx.fillRect(g.position.x+g.width+8,0,(canvas.width-616)/2,600),ctx.fillRect(0,0,(canvas.width-616)/2,600),ctx.fillStyle="#BFC6CC",ctx.fillRect(g.position.x+g.width+8,0,(canvas.width-616)/2,130),ctx.fillRect(0,0,(canvas.width-616)/2,130),ctx.fillRect(g.position.x+g.width+8,500,(canvas.width-616)/2,115),ctx.fillRect(0,500,(canvas.width-616)/2,115),ctx.fillStyle="#9BA1A5",ctx.fillRect(g.position.x+g.width+8,114,(canvas.width-616)/2,13),ctx.fillRect(0,114,(canvas.width-616)/2,13),ctx.fillRect(g.position.x+g.width+8,501,(canvas.width-616)/2,13),ctx.fillRect(0,501,(canvas.width-616)/2,13),ctx.fillStyle="#3F4549",ctx.fillRect(g.position.x+g.width+8,128,(canvas.width-616)/2,7),ctx.fillRect(0,128,(canvas.width-616)/2,7),ctx.fillRect(g.position.x+g.width+8,493,(canvas.width-616)/2,7),ctx.fillRect(0,493,(canvas.width-616)/2,7),ctx.fillStyle="rgba(56, 57, 59, 0.66)",ctx.fillRect(g.position.x+g.width+8,0,8,600),ctx.fillRect(g.position.x-16,0,8,600));var c={fill:!0,color:"rgb(255, 0, 0)"},d={outline:!1},e=g.position.x+g.width/2-g.width/2*Math.cos(g.rot),f=g.position.y+g.height/2-g.height/2*Math.sin(g.rot);q.gfx.drawCircle({x:e,y:f},3,c,d)}};h.prototype.create=function(){var a=this;sprs.push(a)},h.prototype.update=function(){var a=this;a.position=q.mth.rotateAbout({x:a.oPos.x,y:a.oPos.y},{x:g.width/2,y:g.height/2},a.rot+g.rot),a.drawSelf()},h.prototype.drawSelf=function(){var a=this;a.position.x+=g.position.x,a.position.y+=g.position.y,ctx.fillStyle="#00ff00",ctx.translate(a.position.x,a.position.y),ctx.rotate(a.rot+g.rot),ctx.fillStyle="#5059D7",ctx.strokeStyle="#233279",q.gfx.roundRect(ctx,0,0,a.width,a.height,6,!0,!0),ctx.fillStyle="#7C82E1",q.gfx.roundRect(ctx,5,5,a.width-10,a.height-10,6,!0,!1),ctx.rotate(-a.rot-g.rot),ctx.translate(-a.position.x,-a.position.y),ctx.fillStyle="#ff0000",ctx.fillStyle="#ff0000";var b=Math.max(a.width,a.height),c=Math.min(a.width,a.height),d={x:a.position.x,y:a.position.y};switch(a.rot+g.rot%(2*Math.PI)){case Math.PI/2:d={x:a.position.x-a.height,y:a.position.y},b=a.height,c=a.width;break;case Math.PI:d={x:a.position.x-a.width,y:a.position.y-a.height},b=a.width,c=a.height;break;case 3*Math.PI/2:d={x:a.position.x,y:a.position.y-a.width},b=a.height,c=a.width}a.position.x-=g.position.x,a.position.y-=g.position.y},i.prototype.win=function(){q.gm.roomDestruct(),curLvl++,e=!1,g.targetRot=g.rot=0},i.prototype.create=function(){var a=this;g.atEnd=!1,a.winTimeout=null,sprs.push(a)},i.prototype.collisionCheck=function(){var a=this;a.atEnd=!1,a.seated=!1;for(var b=0;b<sprs.length;b++){var c=sprs[b];q.mth.lengthDirX(a.grav,a.gravDir),q.mth.lengthDirY(a.grav,a.gravDir);if("parObst"==c.name||"parEnd"==c.name||"parSpike"==c.name){var h={x:c.position.x,y:c.position.y},i=c.width,j=c.height;switch(c.rot+g.rot%(2*Math.PI)){case Math.PI/2:h={x:c.position.x-c.height,y:c.position.y},i=c.height,j=c.width;break;case Math.PI:h={x:c.position.x-c.width,y:c.position.y-c.height},i=c.width,j=c.height;break;case 3*Math.PI/2:h={x:c.position.x,y:c.position.y-c.width},i=c.height,j=c.width}q.mth.rectCollidesRect({x:a.position.x,y:a.position.y+a.vSpd},a.width,a.height+a.vSpd,h,Math.floor(i),Math.floor(j))&&("parObst"==c.name||"parEnd"==c.name?("parEnd"==c.name&&a.win(),a.seated=!0,a.position.y=h.y-a.height-1,a.hSpd=0,a.vSpd=0):"parSpike"==c.name&&(console.log("koko lose"),q.gm.roomDestruct(),g.targetRot=g.rot=0,e=!1))}}},i.prototype.update=function(){var a=this;if(a.width=2*a.radius,a.height=2*a.radius,g.rotating){var b=g.rotAmount,c=Math.sin(b),d=Math.cos(b);a.position.x+=a.width/2,a.position.y+=a.height/2,a.position.x-=g.width/2,a.position.y-=g.height/2;var e=a.position.x*d-a.position.y*c,f=a.position.x*c+a.position.y*d;a.position.x=e+g.width/2,a.position.y=f+g.height/2,a.position.x-=a.width/2,a.position.y-=a.height/2}if(!g.rotating&&!mouseDown){a.position.x+=a.hSpd,a.position.y+=a.vSpd,Math.abs(a.vSpd)<1&&(a.vSpd=0),a.position.x<=1&&(a.position.x=1),a.position.x>=g.width-a.width-1&&(a.position.x=g.width-a.width-1),a.position.y>=g.height-a.height-1&&(a.position.y=g.height-a.height-1),a.position.y<=1&&(a.position.y=1),a.seated=!1,a.position.x=Math.round(a.position.x),a.position.y=Math.round(a.position.y);var i=(a.position.x+a.hSpd+q.mth.lengthDirX(1,a.gravDir),a.position.y+a.vSpd+q.mth.lengthDirY(1,a.gravDir));i>g.height-a.height?(a.position.y=g.height-a.height,a.hSpd=0,a.vSpd=0):!a.seated&&i<g.height-a.height&&(a.hSpd+=a.hSpd>a.maxSpd?0:q.mth.lengthDirX(a.grav,a.gravDir),a.vSpd+=a.vSpd>a.maxSpd?0:q.mth.lengthDirY(a.grav,a.gravDir)),a.collisionCheck()}a.position.x+=g.position.x,a.position.y+=g.position.y,q.gfx.drawCircle({x:a.position.x+a.width/2,y:a.position.y+a.height/2},a.radius-1,a.brush,a.pen),q.gfx.drawCircle({x:a.position.x+a.height/2+3,y:a.position.y+a.height/2-3},Math.max(1,a.radius-10),a.highlightBrush,a.highlightPen),a.position.x-=g.position.x,a.position.y-=g.position.y},k.prototype.click=function(){},k.prototype.create=function(){var a=this;sprs.push(a)},k.prototype.xtraUpdate=function(){},k.prototype.update=function(){var a=this;a.drawSelf(),ctx.fillStyle="#ff0f00",ctx.fillRect(a.position.x,a.position.y,5,5),ctx.fillRect(a.position.x+a.width,a.position.y+a.height,5,5),a.xtraUpdate(),mouse.x>a.position.x&&mouse.x<a.position.x+a.width&&mouse.y>a.position.y&&mouse.y<a.position.y+a.height&&mouseClick&&a.click()},k.prototype.drawSelf=function(){var a=this;null!=a.img?q.gfx.drawImage(a.img,a.position.x,a.position.y):(ctx.fillStyle="rgb(33, 19, 0)",ctx.fillRect(a.position.x-4,a.position.y-4,a.width+8,a.height+8),ctx.fillStyle="rgb(214, 139, 40)",ctx.fillRect(a.position.x,a.position.y,a.width,a.height),ctx.fillStyle="rgb(180, 232, 255)",q.gfx.drawText({x:a.position.x+5,y:a.position.y+20},a.text))};var n=[new vct(80,0),new vct(117,25),new vct(117,39),new vct(111,44),new vct(89,69),new vct(84,83),new vct(83,95),new vct(108,101),new vct(111,102),new vct(112,117),new vct(105,123),new vct(87,144),new vct(79,163),new vct(78,179),new vct(74,183),new vct(68,182),new vct(47,166),new vct(25,142),new vct(2,102),new vct(0,78),new vct(5,76),new vct(14,77),new vct(32,85),new vct(34,65),new vct(46,36),new vct(54,15),new vct(70,1)],o={fill:!0,color:"rgb(208, 111, 14)"},p={outline:!0,color:"rgb(110, 49, 0)",width:5};arrowShape=q.gfx.createShape(n,!0,!0,o,p,0,0,0,120,184),arrowShapeFlip=q.gfx.createShape(n,!0,!0,o,p,1,0,0,120,184);var n=[new vct(0,47),new vct(83,0),new vct(106,18),new vct(140,24),new vct(176,18),new vct(200,0),new vct(280,47)],o={fill:!0,color:"rgb(152, 177, 0)"},p={outline:!0,color:"rgb(5, 130, 55)",width:5};endShape=q.gfx.createShape(n,!0,!0,o,p,0,0,0,280,47);var n=[new vct(0,0),new vct(83,47),new vct(106,29),new vct(140,23),new vct(176,29),new vct(200,47),new vct(280,0)],o={fill:!0,color:"rgb(152, 177, 0)"},p={outline:!0,color:"rgb(5, 130, 55)",width:5};endShapeFlip=q.gfx.createShape(n,!0,!0,o,p,0,0,0,280,47);var n=[new r_vct(0,47),new r_vct(83,0),new r_vct(106,18),new r_vct(140,24),new r_vct(176,18),new r_vct(200,0),new r_vct(280,47)],o={fill:!0,color:"rgb(152, 177, 0)"},p={outline:!0,color:"rgb(5, 130, 55)",width:5};endShapeVer=q.gfx.createShape(n,!0,!0,o,p,0,0,0,47,280);var n=[new r_vct(0,0),new r_vct(83,47),new r_vct(106,29),new r_vct(140,23),new r_vct(176,29),new r_vct(200,47),new r_vct(280,0)],o={fill:!0,color:"rgb(152, 177, 0)"},p={outline:!0,color:"rgb(5, 130, 55)",width:5};endShapeVerFlip=q.gfx.createShape(n,!0,!0,o,p,0,0,0,47,280);var n=[new vct(10,41),new vct(130,41),new vct(140,36),new vct(140,6),new vct(130,0),new vct(10,0),new vct(0,6),new vct(0,36)],o={fill:!0,color:"#5059D7"},p={outline:!0,color:"#243273",width:5};rectShape=q.gfx.createShape(n,!0,!1,o,p,0,0,0,280,47);var n=[new vct(8,26),new vct(110,26),new vct(120,23),new vct(120,4),new vct(111,0),new vct(8,0),new vct(0,4),new vct(0,23)],o={fill:!0,color:"#7C82E1"},p={outline:!1,color:"#475dc7",width:5};rectShapeHighlight=q.gfx.createShape(n,!0,!1,o,p,0,0,0,280,47);var r={fill:!0,color:"#FFD800"},s={outline:!1,color:"#CC7D00",width:3},n=[new vct(0,50),new vct(2.5,54),new vct(8.5,54),new vct(12.5,51),new vct(12.5,26),new vct(16,24),new vct(23,31),new vct(27,31),new vct(33,25.5),new vct(35.5,27),new vct(35.5,47.5),new vct(39,51),new vct(58,51),new vct(62,46.5),new vct(61,3),new vct(56.5,0),new vct(43,0),new vct(38,1.5),new vct(27,12.5),new vct(23,11.5),new vct(12.5,1),new vct(5.5,1),new vct(.5,6),new vct(.5,12.5)],o={fill:!0,color:"#7C82E1"},p={outline:!1,color:"#475dc7",width:5},t=q.gfx.createShape(n,!0,!0,r,s,0,0,0,66,57),n=[new vct(18.5,51.5),new vct(24.5,54),new vct(33,55),new vct(41,49),new vct(58,12.5),new vct(59,4),new vct(53,1),new vct(39.5,0),new vct(33.5,3),new vct(26.5,24.5),new vct(22.5,29),new vct(19.5,27),new vct(12.5,5),new vct(8.5,1),new vct(.5,1.5),new vct(.5,9),new vct(7,29.5)],o={fill:!0,color:"#7C82E1"},p={outline:!1,color:"#475dc7",width:5},u=q.gfx.createShape(n,!0,!0,r,s,0,0,0,61,57),n=[new vct(4,31),new vct(6.5,32),new vct(40,53.5),new vct(44.5,53.5),new vct(47.5,51),new vct(48.3,28),new vct(47.5,5),new vct(39,.5),new vct(14,.7),new vct(4,3.2),new vct(.6,6.2),new vct(1,10.7),new vct(5.8,14.5),new vct(15.6,14),new vct(18.6,17),new vct(18.6,20.7),new vct(14,23.6),new vct(8,23),new vct(4,26)],o={fill:!0,color:"#7C82E1"},p={outline:!1,color:"#475dc7",width:5},v=q.gfx.createShape(n,!0,!0,r,s,0,0,0,52,57),n=[new vct(0,19),new vct(4,22),new vct(12.6,22),new vct(23.7,29.5),new vct(28,30),new vct(29.7,27),new vct(29.7,18.8),new vct(19.7,12),new vct(28,7),new vct(28,1.5),new vct(26,.7),new vct(12.4,8.8),new vct(4.6,8.4),new vct(.6,11.3)],o={fill:!0,color:"#7C82E1"},p={outline:!1,color:"#475dc7",width:5},w=q.gfx.createShape(n,!0,!0,r,s,0,0,0,30,30),n=[new vct(2,51.4),new vct(3.4,54),new vct(8,56.6),new vct(12.5,55),new vct(19,40),new vct(23,39),new vct(26,42),new vct(26,51),new vct(31.8,55.7),new vct(44.8,56),new vct(52.3,52.5),new vct(54,46.7),new vct(54,7.5),new vct(49,1.6),new vct(32,0),new vct(17,1.7),new vct(6.4,5.7),new vct(0,12.8),new vct(.4,26),new vct(3.6,31.6),new vct(9.3,35.3),new vct(6.8,39.8)],o={fill:!0,color:"#7C82E1"},p={outline:!1,color:"#475dc7",width:5},x=q.gfx.createShape(n,!0,!0,r,s,0,0,0,55,57),n=[new vct(.7,49),new vct(3.5,53.8),new vct(15,55.6),new vct(34.8,55.6),new vct(45,53),new vct(48,46),new vct(47.8,8.7),new vct(44,1.9),new vct(44,2),new vct(37.5,0),new vct(22,0),new vct(18.7,3),new vct(17,39),new vct(15.7,41.3),new vct(3,40.8),new vct(.5,43)],o={fill:!0,color:"#7C82E1"},p={outline:!1,color:"#475dc7",width:5},y=q.gfx.createShape(n,!0,!0,r,s,0,0,0,50,57),n=[new vct(.5,52.4),new vct(6.2,55.4),new vct(29.2,56.3),new vct(38.5,52.4),new vct(47.6,43.8),new vct(51.5,35),new vct(51.7,22),new vct(47.3,11.5),new vct(38.9,4.7),new vct(28,1),new vct(7,0),new vct(.5,4.7)],o={fill:!0,color:"#7C82E1"},p={outline:!1,color:"#475dc7",width:5},z=q.gfx.createShape(n,!0,!0,r,s,0,0,0,53,56),n=[new vct(0,22.2),new vct(3,25.6),new vct(7,24.3),new vct(11.8,19.3),new vct(12,11.8),new vct(10.7,5.2),new vct(4,.6),new vct(.7,3)];ltr_d=q.gfx.createShape(n,!0,!0,r,s,0,0,0,16,30);var n=[new vct(5,78),new vct(14.5,79.7),new vct(53,60),new vct(74,43.7),new vct(75.7,40.5),new vct(68,31),new vct(25,5),new vct(8,0),new vct(3,8.6)];shapeStart=q.gfx.createShape(n,!0,!0,r,s,0,0,0,80,80);var A=new k({x:200,y:200},120,120,shapeStart,"start");A.drawSelf=function(){var a=this;q.gfx.drawCircle({x:a.position.x+60,y:a.position.y+60},60,{fill:!0,color:"#EA8800"},{outline:!0,width:8,color:"#B53300"}),q.gfx.drawImage(a.img,a.position.x+25,a.position.y+15)},A.click=function(){if(!moving){moving=!0;var a=window.setInterval(function(){g.position.x=Math.max(g.position.x-15,canvas.width/2-300),B.position.y-=20,A.position.y+=20,overAlpha+=.05,g.position.x==canvas.width/2-300&&(window.clearInterval(a),window.setTimeout(function(){b++,q.gm.roomDestruct(),g.rot=0,g.targetRot=0,e=!1},300))},gameSpeed)}};var B={position:{x:0,y:0},width:485,height:135,create:function(){sprs.push(B)},update:function(){var a=B.position,b={fill:!0,color:"#C5322D"},c={outline:!0,color:"#8C2020",width:4},d={fill:!0,color:"#D75550"},e={outline:!1},f={fill:!0,color:"rgba(0,0,0,1)"};q.gfx.drawImage(t,a.x,a.y),q.gfx.drawCircle({x:a.x+98,y:a.y+30},25,b,c),q.gfx.drawCircle({x:a.x+103,y:a.y+26},15,d,e),q.gfx.drawImage(u,a.x+130,a.y,-1),q.gfx.drawImage(v,a.x+195,a.y,-1),q.gfx.drawImage(t,a.x+185,a.y+80,-1,-1),q.gfx.drawCircle({x:a.x+280,y:a.y+106},25,b,c),q.gfx.drawCircle({x:a.x+284,y:a.y+102},15,d,e),q.gfx.drawImage(x,a.x+318,a.y+74,-1,1),q.gfx.drawImage(y,a.x+377,a.y+76,-1,1),q.gfx.drawImage(z,a.x+428,a.y+76,1,1),q.gfx.drawImage(ltr_d,a.x+456,a.y+93,1,1),q.gfx.drawCircle({x:a.x+220,y:a.y+60},30,f,e),q.gfx.drawImage(w,a.x+200,a.y+52,.7,.7,0),q.gfx.drawImage(t,a.x+188,a.y+20,.35,.35,Math.PI/2)}},C=new i({x:60,y:20},27),D=new k({x:g.position.x+g.width+50,y:g.position.y+200},120,184,arrowShapeFlip,"Rot CW"),E=new k({x:g.position.x-180,y:g.position.y+200},120,184,arrowShape,"Rot CCW");D.drawSelf=E.drawSelf=function(){var a=this,b=0;a.width=a.img.width,a.height=a.img.height,g.rotating&&(g.targetRot>g.rot&&"Rot CW"==a.text&&(b=.25*Math.PI),g.targetRot<g.rot&&"Rot CCW"==a.text&&(b=-0.25*Math.PI)),ctx.translate(a.position.x+a.width/2,a.position.y+a.height/2),ctx.rotate(b),q.gfx.drawImage(a.img,-a.width/2,-a.height/2),ctx.rotate(-b),ctx.translate(-(a.position.x+a.width/2),-(a.position.y+a.height/2))},D.click=function(){g.rotating||0!=C.vSpd||g.atEnd||(g.targetRot+=Math.PI/2)},E.click=function(){g.rotating||0!=C.vSpd||g.atEnd||(g.targetRot-=Math.PI/2)},D.xtraUpdate=function(){var a=this;a.position.x=g.position.x+600+(canvas.width-600)/4-a.width/2,ctx.fillRect(a.position.x,a.position.y,5,5)},E.xtraUpdate=function(){var a=this;a.position.x=(canvas.width-600)/4-a.width/2-10,ctx.fillRect(a.position.x,a.position.y,5,5)};var F=new k({x:g.position.x-96,y:g.position.y},96,32,null,"Restart");F.click=function(){q.gm.roomDestruct(),g.rot=0,g.targetRot=0,e=!1};var G=new k({x:g.position.x-96,y:g.position.y+108},96,32,null,"Gravity");G.click=function(){g.atEnd||(C.gravDir+=Math.PI)};window.setInterval(function(){J()},gameSpeed)}console.log("preload started");var b=window.setInterval(function(){ctx.fillStyle=canvas.style.bacgroundColor,ctx.fillRect(0,0,canvas.width,canvas.height);var a=400;ctx.fillStyle="#d8d8d8",ctx.fillRect(canvas.width/2-a/2,5*canvas.height/6,a,5),ctx.fillStyle="#dd8822",ctx.fillRect(canvas.width/2-a/2,5*canvas.height/6,a*loadedAssetCount/totalAssetCount,5),loadedAssetCount>=totalAssetCount&&(ctx.clearRect(0,0,canvas.width,canvas.height),window.clearInterval(b),c())},50)}var totalAssetCount=0,loadedAssetCount=0,gameSpeed=15,canvas,ctx,scaleRatio=1,isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Opera()||isMobile.Windows()}},_isMobile=isMobile.any(),topCanvas=document.createElement("CANVAS"),testing=!1,lvlText="",waiting=!1,moving=!1,overAlpha=0,curLvl=0,lvls=["ball-96-128-28-end-280-500-128-32-0-block-64-192-224-64-block-352-128-64-288-block-0-320-224-64-spike-288-128-64-64","ball-64-288-30-end-320-480-160-32-0-block-0-384-256-64-block-320-160-64-288-block-0-0-384-64-block-448-0-64-448-spike-288-256-0-0-spike-192-192-128-64","ball-64-96-14-end-448-448-128-32-0-block-0-160-224-32-block-32-224-224-32-block-224-288-32-32-block-224-352-224-32-block-288-224-32-96-block-288-0-32-192-block-512-128-32-128-block-160-288-32-192","ball-288-128-16-end-544-512-64-64-0-block-128-384-384-32-block-224-192-128-128-block-128-96-32-256-block-480-96-32-256-block-384-32-32-224-spike-416-288-0-0-spike-384-288-96-32-block-224-96-128-32-block-544-160-32-320-block-32-128-32-96-block-96-448-160-32-block-0-544-96-32-spike-64-352-32-0-spike-96-384-0-0-spike-64-352-0-0-spike-32-384-0-0-spike-32-384-0-0-spike-32-352-0-32-spike-32-384-0-0-spike-64-352-32-32-block-32-352-32-128-block-32-32-352-32-block-0-256-96-64-block-480-416-32-96","ball-160-128-16-end-320-96-32-128-1-block-0-0-160-32-block-0-32-32-128-block-96-160-96-32-block-192-64-32-128-block-192-0-32-32-block-64-64-96-64-block-256-32-32-224-block-96-224-128-64-block-96-416-192-32-block-64-224-32-32-block-96-320-128-64-block-0-224-64-32-block-32-256-32-32-block-0-256-32-64-block-0-320-32-128-block-320-0-192-32-block-320-0-128-32-block-0-512-544-32-block-0-480-544-32-block-512-448-32-32-block-416-64-128-32-block-448-96-96-32-block-480-128-64-32-block-512-160-32-32-block-384-384-64-32-block-352-256-128-128","ball-32-96-14-end-480-512-64-32-0-block-288-128-32-224-block-192-128-32-256-block-192-32-256-32-block-96-416-224-32-block-32-288-96-32-block-64-352-32-32-block-96-32-32-224-block-384-128-32-160-block-416-320-96-96-block-544-320-32-160-block-448-192-96-32-block-448-256-96-32-block-480-32-32-96-block-544-288-32-32","ball-0-330-14-end-160-0-288-32-1-block-180-210-180-30-block-150-270-300-30-block-30-540-210-30-block-330-450-30-120-block-150-420-120-30-block-300-360-60-60-block-390-330-30-90-block-390-450-30-150-block-30-390-30-60-block-60-420-30-30-block-0-390-30-60-block-0-360-30-30-block-60-330-210-30-block-120-420-30-30-block-510-0-90-30-block-540-30-60-30-block-570-60-30-30-block-480-330-90-30-block-480-390-30-180-block-450-330-30-30-block-510-210-90-30-block-120-30-30-90-block-120-150-30-90-block-0-90-60-30-block-210-120-90-30-block-210-60-210-30-block-420-120-30-90-block-360-150-30-30-block-540-570-30-30-block-570-540-30-30-block-570-570-30-30-block-0-0-30-30-block-0-180-30-90-block-0-270-150-30-block-300-300-60-60","ball-100-40-8-end-320-560-140-20-0-block-60-60-240-20-block-160-40-20-20-block-220-80-20-60-block-0-100-60-20-block-0-0-60-20-block-0-20-40-20-block-0-40-20-20-block-440-0-160-20-block-460-20-120-20-block-580-20-20-20-block-480-20-120-40-block-500-60-100-20-block-520-80-80-20-block-540-100-60-20-block-560-120-40-20-block-580-140-20-20-block-360-100-120-20-block-480-100-20-20-block-480-140-60-20-spike-500-120-20-20-block-300-140-20-20-block-160-160-200-20-block-0-140-20-160-block-20-220-60-20-block-100-200-20-60-block-340-20-80-20-block-360-40-20-20-block-0-320-140-20-block-140-220-20-220-block-160-380-60-20-block-160-260-60-20-block-280-220-200-20-block-560-540-40-40-block-540-560-20-20-block-520-580-20-20-block-540-580-60-20-block-580-520-20-20-block-300-340-100-20-block-460-300-20-180-block-200-440-180-20-block-340-320-20-120-block-380-440-20-20-block-540-260-20-220-block-40-520-60-60-block-120-540-40-40-block-20-440-100-20-block-60-480-280-20-block-420-400-20-100-block-360-260-40-20-block-240-320-20-40-block-380-300-60-20","ball-40-60-8-end-580-260-20-80-0-block-60-20-20-260-block-120-0-180-20-block-160-100-220-20-block-40-180-20-20-block-0-120-40-20-block-80-440-200-20-block-120-400-20-40-block-20-580-220-20-block-0-580-20-20-block-100-500-20-80-block-40-360-60-20-block-60-340-20-20-block-180-240-80-20-block-120-300-40-20-block-160-180-20-200-block-200-60-20-40-block-280-120-20-60-block-260-300-140-20-block-320-240-20-60-block-340-320-20-220-block-220-500-120-20-block-360-400-100-20-block-420-40-20-220-block-360-200-60-20-block-400-60-20-20-block-460-360-20-140-block-540-200-20-80-block-540-300-20-80-block-500-180-20-100-block-500-300-20-40-block-500-440-80-20-block-520-460-40-140-block-420-540-60-20-block-440-560-20-40-block-340-580-20-20-block-320-560-60-20-block-520-0-40-100-block-500-100-80-40-spike-260-280-20-20-spike-440-280-0-0-spike-420-260-20-20-block-440-320-60-20-block-440-300-60-20","ball-300-300-8-end-340-40-40-20-1-block-240-240-40-20-block-300-240-40-20-block-320-320-20-20-block-300-320-20-20-block-240-320-40-20-block-240-260-20-20-block-220-340-20-40-block-200-360-20-40-block-340-340-20-40-block-360-360-20-40-block-380-380-20-40-block-400-400-20-40-block-340-200-20-40-block-360-180-20-40-block-380-160-20-40-block-400-140-20-40-block-220-200-20-40-block-200-180-20-40-block-180-160-20-40-block-160-140-20-40-block-240-80-60-20-block-200-160-80-20-block-120-60-100-20-block-80-240-160-20-block-60-100-20-260-block-80-180-40-20-block-140-260-20-40-block-320-260-20-20-block-340-260-140-20-block-480-100-20-300-block-400-280-20-40-block-460-380-20-20-block-500-380-40-20-block-280-480-160-20-block-100-540-220-20-block-180-500-20-40-block-0-400-80-20-block-40-420-20-100-block-60-460-60-20-block-240-440-20-20-block-320-520-20-60-block-200-520-20-20-block-400-0-200-20-block-420-20-20-40-block-320-120-20-20-block-420-140-60-20-block-560-480-40-120-block-480-560-40-40-block-520-520-40-80-spike-420-320-0-0-spike-400-320-20-20-spike-420-440-0-0-spike-400-440-20-20-spike-180-520-0-0-spike-160-520-20-20-block-240-300-20-20-block-300-260-20-20-spike-400-380-20-20-block-280-320-20-20-block-240-280-20-20-block-220-40-20-80-block-300-40-20-200-block-300-20-20-20-block-220-20-20-20-block-20-300-40-20-block-220-0-20-20-block-140-560-20-40-block-320-280-20-20-block-200-400-20-40-block-220-420-20-40-block-220-380-20-40-block-240-340-20-100-block-260-340-20-160-block-320-300-20-20"];document.body.appendChild(topCanvas),canvas=document.getElementById("gameCanvas"),canvas.width=1e3,canvas.height=600,canvas.center={x:canvas.width/2,y:canvas.height/2},ctx=canvas.getContext("2d");var mouse={x:canvas.width/2,y:canvas.height/2,previousX:0,previousY:0},mouseDown=!1,mouseClick=!1;document.addEventListener(_isMobile?"touchstart":"mousedown",function(a){a.preventDefault(),mouse.previousX=mouse.x,mouse.previousY=mouse.y;var b=_isMobile?a.targetTouches[0].pageX:a.pageX,c=_isMobile?a.targetTouches[0].pageY:a.pageY;mouse.x=Math.min(canvas.width/scaleRatio,Math.max(b-parseInt(canvas.style.left,10),0))*scaleRatio,mouse.y=Math.min(canvas.height/scaleRatio,Math.max(c-parseInt(canvas.style.top,10),0))*scaleRatio,mouseClick=!0,"undefined"!=typeof mouseClearInterval&&window.clearInterval(mouseClearInterval),mouseClearInterval=window.setTimeout(function(){mouseClick=!1},gameSpeed),mouseDown=!0}),document.addEventListener(_isMobile?"touchend":"mouseup",function(){mouseDown=!1,mouseClick=!1}),document.addEventListener("load",preload()),document.onload=function(a){mouse.x=Math.min(canvas.width,Math.max(a.pageX-parseInt(canvas.style.left,10),0)),mouse.y=Math.min(canvas.height,Math.max(a.pageY-parseInt(canvas.style.top,10),0))},document.addEventListener(_isMobile?"touchmove":"mousemove",function(a){a.preventDefault(),mouse.previousX=mouse.x,mouse.previousY=mouse.y;var b=_isMobile?a.targetTouches[0].pageX:a.pageX,c=_isMobile?a.targetTouches[0].pageY:a.pageY;mouse.x=Math.min(canvas.width/scaleRatio,Math.max(b-parseInt(canvas.style.left,10),0))*scaleRatio,mouse.y=Math.min(canvas.height/scaleRatio,Math.max(c-parseInt(canvas.style.top,10),0))*scaleRatio});var par=document.getElementById("displayText"),sprs=[],q={gm:{arrFromStr:function(a){a+="-";for(var b=[],c="",d=0,e=0;e<a.length;e++)"-"==a.charAt(e)?(b[d]=c,d++,c=""):c+=a.charAt(e);return b},cloneArr:function(a,b){for(var c=0;c<a.length;c++)b[c]=a[c]},instanceCount:function(a){for(var b=0,c=0;c<sprs.length;c++)sprs[c].name==a&&b++;return b},roomDestruct:function(){sprs.splice(0,sprs.length)}},gfx:{roundRect:function(a,b,c,d,e,f,g,h){"undefined"==typeof h&&(h=!0),"undefined"==typeof f&&(f=5),a.beginPath(),a.moveTo(b+f,c),a.lineTo(b+d-f,c),a.quadraticCurveTo(b+d,c,b+d,c+f),a.lineTo(b+d,c+e-f),a.quadraticCurveTo(b+d,c+e,b+d-f,c+e),a.lineTo(b+f,c+e),a.quadraticCurveTo(b,c+e,b,c+e-f),a.lineTo(b,c+f),a.quadraticCurveTo(b,c,b+f,c),a.closePath(),h&&a.stroke(),g&&a.fill()},drawImage:function(a,b,c,d,e,f){var g=0,h=1,i=1;return"undefined"!=typeof f&&(g=f),"undefined"!=typeof d&&(h=d),"undefined"!=typeof e&&(i=e),"undefined"!=typeof a.fngrPrnt&&"imgData"==a.fngrPrnt?void ctx.putImageData(a.imgData,b,c):"undefined"!=typeof a&&null!==a?(ctx.translate(b+a.width/2,c+a.height/2),ctx.rotate(g),ctx.scale(h,i),ctx.drawImage(a,-a.width/2,-a.height/2),ctx.scale(1/h,1/i),ctx.rotate(-g),void ctx.translate(-b-a.width/2,-c-a.height/2)):void 0},drawCircle:function(a,b,c,d){ctx.beginPath(),ctx.arc(a.x,a.y,b,0,2*Math.PI),ctx.closePath(),c.fill&&(ctx.fillStyle=c.color,ctx.fill()),d.outline&&(ctx.strokeStyle=d.color,ctx.lineWidth=d.width,ctx.stroke())},drawText:function(a,b){ctx.font="20px Georgia",ctx.textAlign="start",ctx.fillText(b,a.x,a.y+15)},drawRect:function(a,b,c,d){},drawFixedRect:function(a,b,c,d){ctx.beginPath();var e=a.x-(c/2*Math.sin(d)+b/2*Math.cos(d)),f=a.y+c/2*Math.cos(d)-b/2*Math.sin(d);ctx.moveTo(e,f),e+=q.mth.lengthDirX(b,d),f-=q.mth.lengthDirY(b,d),ctx.lineTo(e,f),d-=Math.PI/2,
e+=q.mth.lengthDirX(c,d),f-=q.mth.lengthDirY(c,d),ctx.lineTo(e,f),d-=Math.PI/2,e+=q.mth.lengthDirX(b,d),f-=q.mth.lengthDirY(b,d),ctx.lineTo(e,f),ctx.closePath(),ctx.fill()},createShape:function(a,b,c,d,e,f,g,h,i,j){var k=new Array,l=document.createElement("CANVAS"),m=l.getContext("2d");l.width=i+2*e.width,l.height=j+2*e.width,l.style.display="none",m.clearRect(0,0,i,j);for(var n=0;n<a.length;n++)k[n]={x:a[n].x,y:a[n].y};if(c){for(var o=new Array,p=0;2>p;p++){q.gm.cloneArr(k,o);for(var r=0,n=0;n<o.length-1;n++){var s,t;s=o[n],t=o[n+1];var u=q.mth.pointMid(s,t);k.splice(++r+n,0,u)}}q.gm.cloneArr(k,o);for(var n=0;n<k.length;n++){var t,v,s;v=0==n?o[k.length-1]:o[n-1],t=n==k.length-1?o[0]:o[n+1],s=o[n],k[n]={x:q.mth.avg3(v.x,s.x,t.x,2,1,2),y:q.mth.avg3(v.y,s.y,t.y,2,1,2)}}}m.translate(e.width+(f?i:0),e.width+(g?j:0)),m.scale(f?-1:1,g?-1:1),m.rotate(h),m.moveTo(k[0].x,k[0].y);for(var w=i,x=j,n=1;n<k.length;n++)k[n].x>w&&(w=k[n].x),k[n].y>x&&(x=k[n].y),m.lineTo(k[n].x,k[n].y);b&&m.closePath(),d.fill&&(m.fillStyle=d.color,m.fill()),e.outline&&(m.strokeStyle=e.color,m.lineWidth=e.width,m.stroke());var y=l.toDataURL("image/png"),z=new Image;return z.width=w,z.height=x,z.src=y,z},drawShape:function(a,b,c,d){for(var e=new Array,f=0;f<b.length;f++)e[f]={x:b[f].x+a.x,y:b[f].y+a.y};if(d){for(var g=new Array,h=0;2>h;h++){q.gm.cloneArr(e,g);for(var i=0,f=0;f<g.length-1;f++){var j,k;j=g[f],k=g[f+1];var l=q.mth.pointMid(j,k);e.splice(++i+f,0,l)}}q.gm.cloneArr(e,g);for(var f=0;f<e.length;f++){var k,m,j;m=0==f?g[e.length-1]:g[f-1],k=f==e.length-1?g[0]:g[f+1],j=g[f],e[f]={x:q.mth.avg3(m.x,j.x,k.x,2,1,2),y:q.mth.avg3(m.y,j.y,k.y,2,1,2)}}}ctx.moveTo(e[0].x,e[0].y);for(var f=1;f<e.length;f++)ctx.lineTo(e[f].x,e[f].y);c&&ctx.closePath(),ctx.fill()}},mth:{rectCollidesRect:function(a,b,c,d,e,f){return a.x<d.x+e&&a.x+b>d.x&&a.y<d.y+f&&a.y+c>d.y},rotateAbout:function(a,b,c){var d=Math.sin(c),e=Math.cos(c);a.x-=b.x,a.y-=b.y;var f=a.x*e-a.y*d,g=a.x*d+a.y*e;return a.x=f+b.x,a.y=g+b.y,a},avg3:function(a,b,c,d,e,f){return(a*d+b*e+c*f)/(d+e+f)},pointMid:function(a,b){return{x:(b.x+a.x)/2,y:(b.y+a.y)/2}},sign:function(a){return 0==a?0:a/Math.abs(a)},withinCircle:function(a,b,c){return Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2)<=Math.pow(c,2)?!0:!1},withinRect:function(a,b,c,d){return a.x>b.x&&a.y>b.y&&a.x<b.x+c&&a.y<b.y+d?!0:!1},lengthDirX:function(a,b){return Math.cos(b)*a},lengthDirY:function(a,b){return Math.sin(-b)*a},pointDis:function(a,b){return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2))},pointDir:function(a,b){var c=Math.abs(a.x-b.x),d=Math.abs(a.y-b.y),e=Math.atan(d/c);return a.x>b.x?a.y>b.y?2*Math.PI-e:e:a.y>b.y?Math.PI+e:Math.PI-e},r2d:function(a){return 180*a/Math.PI},d2r:function(a){return a*Math.PI/180}}};