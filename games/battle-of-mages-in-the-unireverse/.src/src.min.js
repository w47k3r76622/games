(function(){function jb(){this.B=function(b){for(var a=0;24>a;a++)this[String.fromCharCode(97+a)]=b[a]||0;.01>this.c&&(this.c=.01);b=this.b+this.c+this.e;.18>b&&(b=.18/b,this.b*=b,this.c*=b,this.e*=b)}}function na(b,a){ca[b]=[];a.forEach(function(a){var d=new Audio;d.src=jsfxr(a);ca[b].push(d)})}function H(b){ca[b]&&ca[b][x(0,ca[b].length-1)].play()}function O(b){b=b.split(kb);this.frequency=O.getFrequency(b[0])||0;this.duration=O.getDuration(b[1])||0}function u(b,a,c){this.ac=b||new AudioContext;
this.createFxNodes();this.tempo=a||120;this.loop=!0;this.staccato=this.smoothing=0;this.notes=[];this.push.apply(this,c||[]);this.gain}function Na(b){if(U[b])return U[b];var a=new Image;a.onload=function(){U[b]=a;Oa()&&Pa.forEach(function(a){a()})};U[b]=!1;a.src=b}function Oa(){var b=!0,a;for(a in U)U.hasOwnProperty(a)&&!U[a]&&(b=!1);return b}function I(b,a,c,d,f){this.pos=a;this.size=c;this.speed="number"===typeof d?d:0;this.frames=f;this._index=0;this.url=b}function r(b,a){this.x=b;this.y=a}function fa(b,
a,c,d,f){this.center=new r(b,a);this.side=c||10;this.left=d?!0:!1;this.h=v.sqrt(3)/2*this.side;this.selected=!1;this.isBorder=f;b=v.PI/6;this.left?(this.b=new r(this.center.x-2*this.h/3,this.center.y),this.a=new r(this.b.x+this.side*v.cos(b),this.b.y-this.side*v.sin(b)),this.c=new r(this.b.x+this.side*v.cos(b),this.b.y+this.side*v.sin(b))):(this.b=new r(this.center.x+2*this.h/3,this.center.y),this.a=new r(this.b.x-this.side*v.cos(b),this.b.y-this.side*v.sin(b)),this.c=new r(this.b.x-this.side*v.cos(b),
this.b.y+this.side*v.sin(b)))}function oa(b,a,c){this.pos=b;this.q=a;this.power=c||this.powerTypes.BLOCK}function Qa(b){this.pos=new r(b.x+x(-5,5),b.y+x(-5,5));this.alpha=.75;this.hue="hsla("+x(0,255)+", 100%, 50%, ";this.color=this.hue+this.alpha+")";this.vel=new r(x(-35,35),x(-35,35))}function Ra(b){this.pos=this.initial=b=new r(b.x+x(-10,10),b.y);this.alpha=x(0,75)/100;Da+=x(0,1);this.hue="hsla("+Da+", 100%, 50%, ";this.color=this.hue+this.alpha+")";this.vel=x(0,25)}function Sa(){var b=Date.now(),
a=(b-Ea)/1E3;0>=Ta--&&(Ta=f.SIN_FREC,pa++,V&&H("walk"));pa>Ua&&(pa=0);for(var c=0;c<f.NUM_STARS1;c++)qa[c].sprite.update(a);for(c=0;c<f.NUM_STARS2;c++)ra[c].sprite.update(a);if(0<P.length)for(c=P.length-1;0<=c;c--)P[c].update(a);V&&h==f.WHITE&&g.white.sprite.update(a);V&&h==f.BLACK&&g.black.sprite.update(a);if(V&&0==xa.length){V=!1;for(c=J.length-1;0<=c;c--)g.black.pos==J[c].q?Va(g.black,c):g.white.pos==J[c].q&&Va(g.white,c);h==f.WHITE?(g.white.sprite.reset(),X(f.WHITE)):(g.black.sprite.reset(),X(f.BLACK))}if(f.NEXT_PILL<
ya){for(var c=[],d=0,A=k.length;d<A;d++)da<=A/2&&1==k[d].selected?c.push(d):da>=A/2&&0==k[d].selected&&c.push(d);for(d=c[v.random()*c.length|0];lb(d)||d==g.white.pos||d==g.black.pos;)d=c[v.random()*c.length|0];c=new oa(new r(k[d].center.x,k[d].center.y),d,f.POWERS.shift());J.push(c);0==f.POWERS.length&&Wa();f.NEXT_PILL=(v.random()*f.LIM_PILL|0)+1;ya=0}if(K)for(c=G.length-1;0<=c;c--)G[c].update(a),0>G[c].alpha&&G.splice(c,1);e.clearRect(0,0,t,z);e.fillStyle="#000";e.fillRect(0,50,t,z);sa.clearRect(0,
0,t,z);for(a=0;a<f.NUM_STARS1;a++)sa.save(),sa.translate(qa[a].pos.x,qa[a].pos.y),qa[a].sprite.render(sa),sa.restore();ta.clearRect(0,0,t,z);for(a=0;a<f.NUM_STARS2;a++)ta.save(),ta.translate(ra[a].pos.x,ra[a].pos.y),ra[a].sprite.render(ta),ta.restore();e.dI(za,0-Fa/6,0-Ga/6);e.dI(Aa,0-Fa/10,0-Ga/10);a=e.createLinearGradient(0,0,0,75);a.addColorStop(0,"#fff");a.addColorStop(1,"#000");e.fillStyle=a;e.fillRect(0,0,t,50);e.strokeStyle="#000";e.fillStyle=h==f.BLACK?"#000":"#fff";e.bP();e.arc(25,25,10,
0,2*v.PI,!1);e.st();e.fill();var n=h==f.WHITE?g.white.actions[B]:g.black.actions[B],a=[],c=[],d=[],A=oa.prototype.map;a.push(Q.get("img/icons.png"));switch(n){case l.MOVE:a.push(126,0);break;case l.REVERSE:a.push(144,0);break;case l.POWER:n=h==f.WHITE?A[g.white.pow[0]]:A[g.black.pow[0]]||0,a.push(18*n,0),c.push(Q.get("img/icons.png")),n==A[E.DOUBLE]||n==A[E.RADIUS]||n==A[E.INVERSE]?c.push(180,0):c.push(162,0)}n=h==f.WHITE?g.white.toReset:g.black.toReset;n[0]&&(n=A[n[0]],d.push(Q.get("img/icons.png"),
18*n,0));a.push(18,18,40,15,18,18);e.dI.apply(e,a);0<c.length&&(c.push(18,18,60,15,18,18),e.dI.apply(e,c));0<d.length&&(d.push(18,18,80,15,18,18),e.dI.apply(e,d));a=da=0;for(c=k.length;a<c;a++)k[a].selected&&da++;e.strokeStyle="#262626";e.fillStyle="#fff";e.fillRect(t/1.25-4*c-11,20,4*c+2,12);e.strokeRect(t/1.25-4*c-11,20,4*c+2,12);e.fillStyle="#262626";e.fillRect(t/1.25-4*da-10,22,4*da,8);Y&&(Y=!1,Xa());e.dI(Ba,0,0);0<L.length&&Ya(L);if(0<Z.length)for(a=Z,(c=a[0]instanceof fa?!1:!0)?k[a[0]].draw(null,
"rgba(255, 0, 0, 0.75)"):a[0].draw(null,"rgba(255, 0, 0, 0.75)"),d=1,A=a.length;d<A;d++)n=4>d?"rgba(255, 0, 0, 0.5)":"rgba(255, 0, 0, 0.25)",c?k[a[d]].draw(null,n):a[d].draw(null,n);0<Ha.length&&Ya(Ha);a=0;for(c=J.length;a<c;a++)d=J[a],A=oa.prototype.map[d.power],e.dI(Q.get("img/icons.png"),18*A,0,18,18,d.pos.x-9,d.pos.y-9,18,18);a=Q.get("img/stone.png");0<=W&&F.push(W);c=0;for(d=F.length;c<d;c++)A=k[F[c]].center,e.dI(a,A.x-16,A.y-24);0<=W&&F.pop();a=k[g.white.base].center;c=k[g.black.base].center;
d=Q.get("img/bases.png");K&&aa!=f.BLACK||e.dI(d,0,0,32,32,a.x-32,a.y-32-4*ba[pa]|0,32,32);K&&aa!=f.WHITE||e.dI(d,32,0,32,32,c.x,c.y-32+4*ba[pa]|0,32,32);e.fillStyle="rgba(0, 0, 0, 0.5)";K&&aa!=f.WHITE||e.fillRect(c.x+10,c.y+4,16,4);K&&aa!=f.BLACK||e.fillRect(a.x-24,a.y+4,16,4);if(0<P.length)for(a=P.length-1;0<=a;a--)P[a].render();a=k[g.white.pos].center;c=k[g.black.pos].center;V&&h==f.WHITE&&(a=xa.shift());K&&aa!=f.BLACK||(e.save(),e.translate(a.x-15,a.y-26),g.white.sprite.render(e),e.restore());
V&&h==f.BLACK&&(c=xa.shift());K&&aa!=f.WHITE||(e.save(),e.translate(c.x-15,c.y-26),g.black.sprite.render(e),e.restore());a=y;c=R;d=M;c=c||"";d=d||"";e.fillStyle="#ADFF2F";e.font="14px "+f.FONT;e.textAlign="center";e.fillText(a,2*C.x,z-50);e.fillText(c,2*C.x,z-30);e.fillText(d,2*C.x,z-10);e.textAlign="left";if(K)for(e.fillStyle="#FF0000",e.font="40px "+f.FONT,e.textAlign="center",e.fillText("Game over",2*C.x,C.y),e.fillText(ga,2*C.x,C.y+50),e.textAlign="left",a=G.length-1;0<=a;a--)G[a].render();a=
0;c=z/4;e.fillStyle="rgba(50, 200, 25, 0.1)";for(e.bP();++a<c;)e.rect(0,4*a,t,3);e.fill();Ea=b;mb(Sa)}function Wa(){var b=E,a;for(a in b)f.POWERS.push(b[a]);f.POWERS.sort(function(){return.5<v.random()});for(a in b)f.POWERS.push(b[a]);f.POWERS.sort(function(){return.5<v.random()});f.POWERS.splice(0,1);f.POWERS.push(E.INVERSE)}function nb(b){Fa=b.x-t/2;Ga=b.y-z/2}function Za(b){for(var a=h==f.WHITE?g.white.pos:g.black.pos,a=ja(k[a],a),c=0,d=a.length;c<d;c++)if(k[a[c]].selected===b||!D(a[c]))return!0;
return!1}function ka(b){for(var a=h==f.WHITE?g.white.pos:g.black.pos,a=ja(k[a],a),c=0,d=a.length;c<d;c++)if(a[c]==b)return!0;return!1}function D(b){for(var a=0,c=F.length;a<c;a++)if(F[a]==b)return!1;return!0}function ja(b,a){for(var c=[],d=0,f=b.neighbours.length;d<f;d++){var e=0;1<v.abs(b.neighbours[d])&&(e=2*b.posRow);c.push(b.neighbours[d]+a-e)}return c}function $a(b){for(var a=0,c=F.length;a<c;a++)if(b==F[a]){F.splice(a,1);break}}function Ia(b){var a;void 0!=b.pageX&&void 0!=b.pageY?(a=b.pageX,
b=b.pageY):(a=b.clientX+S.body.scrollLeft+S.documentElement.scrollLeft,b=b.clientY+S.body.scrollTop+S.documentElement.scrollTop);a-=N.offsetLeft;b-=N.offsetTop;return new r(a,b)}function Xa(){var b,a=k.slice(0);ab.clearRect(0,0,t,z);b=0;for(var c=F.length;b<c;b++)a.push(k[F[b]]);b=0;for(c=J.length;b<c;b++)a.push(k[J[b].q]);for(var c=0,d=a.length;c<d;c++)b=a[c],b.draw(null,b.selected?"#999":"#eee",ab)}function bb(b,a){Ja+=.1;e.strokeStyle="hsla("+Ja+", 100%, 50%, 0.75)";e.lineWidth=3;e.bP();e.mT(b.center.x,
b.center.y-5);e.lT(a.center.x,a.center.y-5);e.cP();e.st();e.strokeStyle="rgba(0, 0, 0, 0.25)";e.bP();e.mT(b.center.x,b.center.y);e.lT(a.center.x,a.center.y);e.cP();e.st()}function Ya(b){for(var a=b[0]instanceof fa?!1:!0,c=0,d=b.length;c<d-1;c++)a?bb(k[b[c]],k[b[c+1]]):bb(b[c],b[c+1])}function ua(b){var a=k.slice(b,b+1)[0],c=a.selected,d={};d[b]={from:-1};la=[];a.pos=b;for(la.push(a);0<la.length;){b=la.pop();for(var a=ja(b,b.pos),f=[],e=0,g=a.length;e<g;e++){var h=a[e],l=k.slice(h)[0];!d[h]&&l.selected==
c&&D(a[e])&&(l.pos=h,f.push(l),d[h]={from:b.pos})}f.sort(function(a,b){return a.pos>b.pos});!b.left&&1<f.length&&f.splice(0,2,f[1],f[0]);la=la.concat(f)}return d}function va(b,a){for(var c=b,d=[b],f=99;a[c]&&-1!=a[c].from&&0<--f;)c=a[c].from,d.push(c);d.reverse();return a[c]?(d.push(b),d):[b]}function X(b){B++;var a,c=!1;a=g.black.pos;0==k[a].selected&&(ga=m.black_mage+m.dead,aa=f.BLACK,c=!0,ma(k[a].center),ma(k[g.black.base].center));a=g.white.pos;1==k[a].selected&&(ga=m.white_mage+m.dead,c=!0,aa=
f.WHITE,ma(k[a].center),ma(k[g.white.base].center));c&&!K&&(N.removeEventListener("click",Ka,!1),N.removeEventListener("mousemove",La,!1),K=!0,H("death"));a=h==f.WHITE?g.black.base:g.white.base;var d=h==f.WHITE?g.white.base:g.black.base,c=h==f.WHITE?g.black.pos:g.white.pos;k[a].selected==(h==f.WHITE?!1:!0)&&(d=va(d,ua(a)),1<d.length&&(ga=h==f.WHITE?m.black_mage:m.white_mage,ga+=m.dead,N.removeEventListener("click",Ka,!1),N.removeEventListener("mousemove",La,!1),Ha=d,ma(k[a].center),ma(k[c].center),
aa=h==f.WHITE?f.BLACK:f.WHITE,K=!0,H("death")));b==f.WHITE?g.white.actions[B]||(B=0,cb(),h=f.BLACK,ya++):g.black.actions[B]||(B=0,cb(),h=f.WHITE,ya++);b=h==f.WHITE?f.WHITE:f.BLACK;switch(h==f.WHITE?g.white.actions[B]:g.black.actions[B]){case l.MOVE:Za(h==f.WHITE?!1:!0)||X(b);break;case l.REVERSE:Za(h==f.WHITE?!0:!1)||X(b)}if((h==f.WHITE?g.white.actions[B]:g.black.actions[B])!=l.MOVE)for(b=h==f.WHITE?k[g.white.base].center:k[g.black.base].center,b=h==f.WHITE?new r(b.x-18,b.y):new r(b.x+12,b.y),b=new r(b.x,
b.y-22),a=0;50>a;a++)P.push(new Ra(b));else P=[]}function cb(){var b=h==f.WHITE?g.white:g.black,a=E;switch(b.toReset[0]){case a.DOUBLE:case a.INVERSE:b.actions=[l.REVERSE,l.MOVE];b.toReset.shift();break;case a.RADIUS:b.energy=!1,b.toReset.shift()}switch(b.pow[0]){case a.INVERSE:b.pow.shift();b.toReset.push(a.INVERSE);break;case a.DOUBLE:b.pow.shift();b.toReset.push(a.DOUBLE);break;case a.RADIUS:b.pow.shift(),b.toReset.push(a.RADIUS)}}function ma(b){b=new r(b.x,b.y-12);for(var a=0;50>a;a++)G.push(new Qa(b))}
function db(b){L=[];for(var a=0,c=b.length-1;a<c;a++)L.push(k.slice(b[a],b[a]+1)[0])}function lb(b){for(var a=0,c=J.length;a<c;a++)if(J[a].pos==b)return!0;return!1}function Va(b,a){b.actions.push(l.POWER);b.pow.push(J[a].power);J.splice(a,1);H("powerup")}function wa(b,a,c,d){var e=h==f.WHITE?g.white:g.black;if((d=d||!1)&&a!=g.black.pos&&a!=g.white.pos||!d)b.selected=c,$a(a);b=ja(b,a);a=d||!1;for(var n=0,l=b.length,m;n<l;n++)if(m=k[b[n]],a&&b[n]!=g.black.pos&&b[n]!=g.white.pos||!a)m.selected!=c&&(m.selected=
c),$a(b[n]),m.draw(null,m.selected?"#ccc":"#eee");if(e.energy)for(e.energy=!1,e=0,a=b.length;e<a;e++)wa(k[b[e]],b[e],c,d);Y=!0;Z=[]}function Ca(b,a,c){var d=h==f.WHITE?g.white:g.black;Z=[b];b=ja(b,a);a=0;for(var e=b.length;a<e;a++){var n=k[b[a]];n.selected==c&&Z.push(n);if(d.energy)for(var n=ja(n,b[a]),l=0,m=n.length;l<m;l++){var r=k[n[l]];r.selected==c&&Z.push(r)}}}function eb(b,a){L=[];for(var c=0,d=a.length-1;c<d;c++){L.push(k.slice(a[c],a[c]+1)[0]);for(var e=new r(k[a[c]].center.x,k[a[c]].center.y),
g=new r(k[a[c+1]].center.x,k[a[c+1]].center.y),h=(g.x-e.x)/f.ANIM_STEPS,g=(g.y-e.y)/f.ANIM_STEPS,l=0;l<f.ANIM_STEPS;l++)e.x+=h,e.y+=g,xa.push(new r(e.x,e.y))}L.push(k.slice(a[c])[0]);V=!0}function ob(b){return D(b)?(F.push(b),W=-1,!0):!1}function pb(b,a){W=-1;var c;if(c=D(b))c=g.black.pos==b||g.white.pos==b?!1:!0;c&&(W=b)}function qb(b){var a=h==f.WHITE?g.white.pos:g.black.pos,c=h==f.WHITE?!1:!0;if(ka(b)){b=fb(a,gb[b-a+(k[a].left?"L":"R")]);for(var a=0,d=b.length;a<d;a++)k[b[a]].selected=c;Y=!0;Z=
[];return!0}return!1}function rb(b,a){var c=h==f.WHITE?g.white.pos:g.black.pos;ka(b)&&(Z=fb(c,gb[b-c+(k[c].left?"L":"R")]))}function fb(b,a){for(var c=0,d=b+a[c],f=k[d].posRow,e=[];k[d]&&(1!=a.length||k[d].posRow==f);){e.push(d);if(k[d].isBorder)break;c++;a[c]||(c=0);d+=a[c]}return e}function sb(){for(var b=0,a=k.length;b<a;b++)b!=g.black.pos&&b!=g.white.pos&&(k[b].selected=!k[b].selected);return Y=!0}function tb(b,a){if(h==f.WHITE&&(b.selected||!D(a)))return wa(b,a,!1,!0),!0;if(!(h!=f.BLACK||b.selected&&
D(a)))return wa(b,a,!0,!0),!0;Y();return!1}function ub(b,a){h!=f.WHITE||!b.selected&&D(a)||a==w?h!=f.BLACK||b.selected&&D(a)||a==w?h==f.WHITE&&a!=w?w=a:h==f.BLACK&&a!=w&&(w=a):(clearPath=[],Ca(b,a,!1),w=a):(Ca(b,a,!0),w=a)}function vb(){h==f.WHITE?(g.white.actions=[l.MOVE,l.REVERSE,l.POWER],g.white.pow.unshift(E.INVERSE)):(g.black.actions=[l.MOVE,l.REVERSE,l.POWER],g.black.pow.unshift(E.INVERSE));return!0}function wb(){h==f.WHITE?(g.white.actions=[l.REVERSE,l.MOVE,l.REVERSE,l.POWER],g.white.pow.unshift(E.DOUBLE)):
(g.black.actions=[l.REVERSE,l.MOVE,l.REVERSE,l.POWER],g.black.pow.unshift(E.DOUBLE));return!0}function xb(){h==f.WHITE?(g.white.energy=!0,g.white.pow.unshift(E.RADIUS)):(g.black.energy=!0,g.black.pow.unshift(E.RADIUS));return!0}function x(b,a){return(v.random()*(a+1-b)|0)+b}function La(b){nb(Ia(b));for(var a=0,c=k.length;a<c;a++){var d=k[a];if(d.isIntoTriangle(Ia(b))){switch(h==f.WHITE?g.white.actions[B]:g.black.actions[B]){case l.MOVE:y=h==f.WHITE?m.white_mage:m.black_mage;y+=m.moves;h!=f.WHITE||
d.selected||!D(a)||V||a==w?h==f.BLACK&&d.selected&&D(a)&&!V&&a!=w&&(d=va(a,ua(g.black.pos)),1<d.length&&db(d),w=a):(d=va(a,ua(g.white.pos)),1<d.length&&db(d),w=a);break;case l.REVERSE:y=h==f.WHITE?m.white_mage:m.black_mage;y+=m.magic;h!=f.WHITE||!d.selected&&D(a)||!ka(a)||a==w?h!=f.BLACK||d.selected&&D(a)||!ka(a)||a==w?a!=w&&(w=a,Z=[]):(Ca(d,a,!1),w=a):(Ca(d,a,!0),w=a);break;case l.POWER:if(a!=w){var e,n;b=E;switch(h==f.WHITE?g.white.pow[0]:g.black.pow[0]||""){case b.BLOCK:y=m.immediate;R=m.block;
e=pb;n=[a,w];break;case b.RAY:y=m.immediate;R=m.ray;e=rb;n=[a];break;case b.BOMB:y=m.immediate;R=m.bomb;e=ub;n=[d,a];break;case b.REVERSE:y=m.immediate;R=m.reverse;M=m.click;e=function(){};n=[];break;case b.INVERSE:y=m.nextTurn;R=m.inverse;M=m.click;e=function(){};n=[];break;case b.DOUBLE:y=m.nextTurn;R=m["double"];M=m.click;e=function(){};n=[];break;case b.RADIUS:y=m.nextTurn,R=m.radius,M=m.click,e=function(){},n=[]}e.apply(this,n);w=a}}break}}}function Ka(b){for(var a=0,c=k.length;a<c;a++){var d=
k[a];if(d.isIntoTriangle(Ia(b))){switch(h==f.WHITE?g.white.actions[B]:g.black.actions[B]){case l.MOVE:y=R=M="";h!=f.WHITE||d.selected?h==f.BLACK&&d.selected&&(d=va(a,ua(g.black.pos)),1<d.length&&(eb(f.BLACK,d),g.black.pos=a)):(d=va(a,ua(g.white.pos)),1<d.length&&(eb(f.WHITE,d),g.white.pos=a));L=[];break;case l.REVERSE:y=R=M="";h!=f.WHITE||!d.selected&&D(a)||!ka(a)?h!=f.BLACK||d.selected&&D(a)||!ka(a)||(wa(d,a,!0),H("magic"),X(f.BLACK)):(wa(d,a,!1),H("magic"),X(f.WHITE));break;case l.POWER:y=R=M="";
var e,n,c=E;b=h==f.WHITE?g.white.pow.shift():b=g.black.pow.shift()||"";switch(b){case c.BLOCK:e=ob;n=[a];break;case c.RAY:e=qb;n=[a];break;case c.REVERSE:e=sb;n=[];break;case c.BOMB:e=tb;n=[d,a];break;case c.INVERSE:e=vb;n=[];break;case c.DOUBLE:e=wb;n=[];break;case c.RADIUS:e=xb,n=[]}e.apply(this,n)&&(P=[],H("power"),h==f.WHITE?(g.white.actions.pop(),X(f.WHITE)):(g.black.actions.pop(),X(f.BLACK)))}break}}}var mb=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||
window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b){window.setTimeout(b,1E3/60)}}(),Ma=new function(){this.A=new jb;var b,a,c,d,e,f,g,h,k,l,m,r;this.reset=function(){var a=this.A;d=100/(a.f*a.f+.001);e=100/(a.g*a.g+.001);f=1-.01*a.h*a.h*a.h;g=1E-6*-a.i*a.i*a.i;a.a||(m=.5-a.n/2,r=5E-5*-a.o);h=0<a.l?1-.9*a.l*a.l:1+10*a.l*a.l;k=0;l=1==a.m?0:2E4*(1-a.m)*(1-a.m)+32};this.D=function(){this.reset();var d=this.A;b=1E5*d.b*d.b;a=1E5*d.c*d.c;c=1E5*d.e*
d.e+10;return b+a+c|0};this.C=function(v,w){var p=this.A,x=1!=p.s||p.v,t=.1*p.v*p.v,y=1+3E-4*p.w,u=.1*p.s*p.s*p.s,z=1+1E-4*p.t,B=1!=p.s,C=p.x*p.x,E=p.g,D=p.q||p.r,J=.2*p.r*p.r*p.r,F=p.q*p.q*(0>p.q?-1020:1020),K=p.p?(2E4*(1-p.p)*(1-p.p)|0)+32:0,R=p.d,N=p.j/2,V=.01*p.k*p.k,P=p.a,Q=b,Z=1/b,aa=1/a,ba=1/c,p=5/(1+20*p.u*p.u)*(.01+u);.8<p&&(p=.8);for(var p=1-p,U=!1,X=0,L=0,M=0,S=0,H=0,O,I=0,T,ha=0,G,ca=0,q,fa=0,ia,da=0,Y=Array(1024),W=Array(32),ea=Y.length;ea--;)Y[ea]=0;for(ea=W.length;ea--;)W[ea]=2*Math.random()-
1;for(ea=0;ea<w;ea++){if(U)return ea;K&&++fa>=K&&(fa=0,this.reset());l&&++k>=l&&(l=0,d*=h);f+=g;d*=f;d>e&&(d=e,0<E&&(U=!0));T=d;0<N&&(da+=V,T*=1+Math.sin(da)*N);T|=0;8>T&&(T=8);P||(m+=r,0>m?m=0:.5<m&&(m=.5));if(++L>Q)switch(L=0,++X){case 1:Q=a;break;case 2:Q=c}switch(X){case 0:M=L*Z;break;case 1:M=1+2*(1-L*aa)*R;break;case 2:M=1-L*ba;break;case 3:M=0,U=!0}D&&(F+=J,G=F|0,0>G?G=-G:1023<G&&(G=1023));x&&y&&(t*=y,1E-5>t?t=1E-5:.1<t&&(t=.1));ia=0;for(var ga=8;ga--;){ha++;if(ha>=T&&(ha%=T,3==P))for(O=W.length;O--;)W[O]=
2*Math.random()-1;switch(P){case 0:q=ha/T<m?.5:-.5;break;case 1:q=1-ha/T*2;break;case 2:q=ha/T;q=.5<q?6.28318531*(q-1):6.28318531*q;q=0>q?1.27323954*q+.405284735*q*q:1.27323954*q-.405284735*q*q;q=0>q?.225*(q*-q-q)+q:.225*(q*q-q)+q;break;case 3:q=W[Math.abs(32*ha/T|0)]}x&&(O=I,u*=z,0>u?u=0:.1<u&&(u=.1),B?(H+=(q-I)*u,H*=p):(I=q,H=0),I+=H,S+=I-O,q=S*=1-t);D&&(Y[ca%1024]=q,q+=Y[(ca-G+1024)%1024],ca++);ia+=q}ia=.125*ia*M*C;v[ea]=1<=ia?32767:-1>=ia?-32768:32767*ia|0}return w}};window.jsfxr=function(b){Ma.A.B(b);
var a=Ma.D();b=new Uint8Array(4*((a+1)/2|0)+44);var a=2*Ma.C(new Uint16Array(b.buffer,44),a),c=new Uint32Array(b.buffer,0,44);c[0]=1179011410;c[1]=a+36;c[2]=1163280727;c[3]=544501094;c[4]=16;c[5]=65537;c[6]=44100;c[7]=88200;c[8]=1048578;c[9]=1635017060;c[10]=a;for(var a=a+44,c=0,d="data:audio/wav;base64,";c<a;c+=3)var e=b[c]<<16|b[c+1]<<8|b[c+2],d=d+("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e>>18]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e>>12&63]+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e>>6&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e&63]);c-=a;return d.slice(0,d.length-c)+"==".slice(0,c)};var yb=440*Math.pow(Math.pow(2,1/12),-9),zb=/^[0-9.]+$/,kb=/\s+/,Ab=/(\d+)/,hb={};"B#-C C#-Db D D#-Eb E-Fb E#-F F#-Gb G G#-Ab A A#-Bb B-Cb".split(" ").forEach(function(b,a){b.split("-").forEach(function(b){hb[b]=a})});O.getFrequency=function(b){var a=b.split(Ab);b=hb[a[0]];a=(a[1]||4)-4;return yb*Math.pow(Math.pow(2,
1/12),b)*Math.pow(2,a)};O.getDuration=function(b){return zb.test(b)?parseFloat(b):b.toLowerCase().split("").reduce(function(a,b){return a+("w"===b?4:"h"===b?2:"q"===b?1:"e"===b?.5:"s"===b?.25:0)},0)};"undefined"!==typeof module&&(module.exports=O);u.prototype.createFxNodes=function(){var b=this.gain=this.ac.createGain();[["bass",100],["mid",1E3],["treble",2500]].forEach(function(a,c){c=this[a[0]]=this.ac.createBiquadFilter();c.type="peaking";c.frequency.value=a[1];b.connect(b=c)}.bind(this));b.connect(this.ac.destination);
return this};u.prototype.push=function(){Array.prototype.forEach.call(arguments,function(b){this.notes.push(b instanceof O?b:new O(b))}.bind(this));return this};u.prototype.createCustomWave=function(b,a){a||(a=b);this.waveType="custom";this.customWave=[new Float32Array(b),new Float32Array(a)]};u.prototype.createOscillator=function(){this.stop();this.osc=this.ac.createOscillator();this.customWave?this.osc.setPeriodicWave(this.ac.createPeriodicWave.apply(this.ac,this.customWave)):this.osc.type=this.waveType||
"square";this.osc.connect(this.gain);return this};u.prototype.scheduleNote=function(b,a){var c=60/this.tempo*this.notes[b].duration,d=c*(1-(this.staccato||0));this.setFrequency(this.notes[b].frequency,a);this.smoothing&&this.notes[b].frequency&&this.slide(b,a,d);this.setFrequency(0,a+d);return a+c};u.prototype.getNextNote=function(b){return this.notes[b<this.notes.length-1?b+1:0]};u.prototype.getSlideStartDelay=function(b){return b-Math.min(b,60/this.tempo*this.smoothing)};u.prototype.slide=function(b,
a,c){var d=this.getNextNote(b),e=this.getSlideStartDelay(c);this.setFrequency(this.notes[b].frequency,a+e);this.rampFrequency(d.frequency,a+c);return this};u.prototype.setFrequency=function(b,a){this.osc.frequency.setValueAtTime(b,a);return this};u.prototype.rampFrequency=function(b,a){this.osc.frequency.linearRampToValueAtTime(b,a);return this};u.prototype.play=function(b){b="number"===typeof b?b:this.ac.currentTime;this.createOscillator();this.osc.start(b);this.notes.forEach(function(a,c){b=this.scheduleNote(c,
b)}.bind(this));this.osc.stop(b);this.osc.onended=this.loop?this.play.bind(this,b):null;return this};u.prototype.stop=function(){this.osc&&(this.osc.onended=null,this.osc.disconnect(),this.osc=null);return this};"undefined"!==typeof module&&(module.exports=u);var S=document,N=S.getElementById("screen"),e=N.getContext("2d"),Aa=S.createElement("canvas"),sa=Aa.getContext("2d"),za=S.createElement("canvas"),ta=za.getContext("2d"),Ba=S.createElement("canvas"),ab=Ba.getContext("2d"),v=Math;e.dI=e.drawImage;
e.bP=e.beginPath;e.cP=e.closePath;e.mT=e.moveTo;e.lT=e.lineTo;e.st=e.stroke;var U={},Pa=[],Q={load:function(b){b instanceof Array?b.forEach(function(a){Na(a)}):Na(b)},get:function(b){return U[b]},onReady:function(b){Pa.push(b)},isReady:Oa};I.prototype.update=function(b){this._index+=this.speed*b};I.prototype.reset=function(){this._index=0;this.done=!1};I.prototype.render=function(b){var a;if(0<this.speed){a=this.frames.length;var c=v.floor(this._index);a=this.frames[c%a]}else a=0;var c=this.pos[0],
d=this.pos[1],c=c+a*this.size[0];b.drawImage(Q.get(this.url),c,d,this.size[0],this.size[1],0,0,this.size[0],this.size[1])};fa.prototype={draw:function(b,a,c){c=c||e;c.strokeStyle=b||"#262626";c.fillStyle=a||"#fff";c.lineWidth=2;c.beginPath();c.moveTo(this.a.x,this.a.y);c.lineTo(this.b.x,this.b.y);c.lineTo(this.c.x,this.c.y);c.closePath();c.stroke();c.fill()},getH:function(){return this.h},isIntoTriangle:function(b){if(b.y>this.c.y||b.y<this.a.y)return!1;var a=v.tan(v.PI/6)*(b.x-this.b.x);if(this.left){if(b.x>
this.center.x+this.h/3||b.x<this.center.x-2*this.h/3||b.y<this.b.y-a||b.y>a+this.b.y)return!1}else if(b.x>this.center.x+2*this.h/3||b.x<this.center.x-this.h/3||b.y>this.b.y-a||b.y<a+this.b.y)return!1;return!0}};oa.prototype={powerTypes:{INVERSE:"inv",RADIUS:"rad",DOUBLE:"dbl",BLOCK:"bck",REVERSE:"rev",RAY:"ray",BOMB:"bmb"},map:{inv:0,rad:1,dbl:2,bck:3,rev:4,ray:5,bmb:6}};var m={immediate:"Immediate power: ",block:"Create a magical obstacle on the board",reverse:"Reverse board colors, except your own tile",
ray:"Cast a death magical ray in straight line",bomb:"Drop a magical bomb that reverts four tiles (not enemy's)",nextTurn:"On your next turn: ",inverse:"you move first and then use magic (inverse command order)",radius:"you have a greater magic radius for reversing tiles","double":"you have an aditional magic command (magic, move, magic)",click:"Click anywhere to continue.",white_mage:"White Mage",black_mage:"Black Mage",moves:" moves now",magic:" uses magic now",dead:" is dead"};Qa.prototype={update:function(b){this.pos.x+=
b*this.vel.x;this.pos.y+=b*this.vel.y;this.alpha-=.01;this.color=this.hue+this.alpha+")"},render:function(){e.fillStyle=this.color;e.bP();e.fillRect(this.pos.x,this.pos.y,4,4)}};Ra.prototype={update:function(b){this.pos.y-=b*this.vel;this.alpha-=.01;this.color=this.hue+this.alpha+")";0>this.alpha&&(this.alpha=.75,this.pos=new r(this.initial.x,this.initial.y))},render:function(){e.fillStyle=this.color;e.bP();e.fillRect(this.pos.x,this.pos.y,4,4)}};var Ea,V=!1,E=oa.prototype.powerTypes,f={FONT:"'Courier New', Courier, monospace",
UL:-7,DL:9,R:1,UR:-7,DR:9,L:-1,WHITE:!0,BLACK:!1,ANIM_STEPS:8,NUM_STARS1:40,NUM_STARS2:60,H:0,NEXT_PILL:1,LIM_PILL:3,SIN_FREC:10,POWERS:[]},gb={"-7L":[-7,-1,-9,-1],"7L":[7,-1,9,-1],"-9L":[-9,-1,-7,-1],"9L":[9,-1,7,-1],"-1R":[-1],"-7R":[-7,1,-9,1],"7R":[7,1,9,1],"-9R":[-9,1,-7,1],"9R":[9,1,7,1],"1L":[1]},l={MOVE:"move",REVERSE:"reverse",POWER:"power"},g={white:{actions:[l.REVERSE,l.MOVE],pos:40,base:40,pow:[],toReset:[],energy:!1,sprite:null},black:{actions:[l.REVERSE,l.MOVE],pos:23,base:23,pow:[],
toReset:[],energy:!1,sprite:null}},y="",R="",M="",t=N.width,z=N.height,C=new r(t/4,z/4),k=[],la=[],xa=[],L=[],Z=[],J=[],Ha=[],P=[],F=[],W=-1,qa=[],ra=[],Fa=t/2,Ga=z/2,h=f.WHITE,ya=0,B=1,w=-1,da=0,K=!1,aa=null,ga="",Ja=0,Da=0,G=[],ba=[],Ua=0,pa=0,Ta=f.SIN_FREC,Y=!1,ca=[],ib,Bb=function(){var b=new AudioContext,a=new u(b,90,"D2 q;-  h;D2 q;A2 q;-  h;A2 q;Bb2 q;-  h;Bb2 q;F2 h;A1 h".split(";"));a.waveType="sine";a.gain.gain.value=.05;var c=new u(b,90,"-  e;D3 e;D3 e;D3 e;G3 e;A4 e;A4 e;A4 e;A4 e;F3 e;G3 e;F3 e;E3 e;F3 e;D3 q;-  e;D3 s;D3 s;D3 e;G3 e;A4 e;A4 e;A4 e;A4 e;Bb4 e;Bb4 e;Bb4 e;Bb4 e;F4 s;F4 s;A4 e;A4 q".split(";"));
c.waveType="triangle";c.gain.gain.value=.015;c.waveType="sawtooth";var d=new u(b,90,"-   e;D4  e;C4  e;D4  e;Bb4 e;C4  e;A3  e;Bb3 e;G3  e;A3  e;Bb3 e;A3  e;G3  e;A3  e;F3  q;-   e;D4  s;C4  s;D4  e;Bb3 e;C4  e;Bb3 e;A4  e;Bb3 e;G3  e;A3  e;Bb4 e;A3  e;G3  s;A4  s;G4  e;F3  q".split(";"));d.waveType="square";d.gain.gain.value=.015;this.play=function(){a.play(b.currentTime);c.play(b.currentTime);d.play(b.currentTime)}};e.fillStyle="#26F0AA";e.font="40px "+f.FONT;e.textAlign="center";e.fillText("Loading...",
2*C.x,2*C.y);e.textAlign="left";Q.onReady(function(){Ea=Date.now();na("death",[[3,.0491,.0677,.2467,.868,.0859,,.3164,.0087,-.4147,-.3279,-.7587,-.4344,.3187,.0041,-.2153,.834,.0848,.6054,-.2568,.498,.0053,.7295,.39]]);na("powerup",[[2,,.3445,,.4092,.2226,,.3069,,,,,,,,.6779,,,1,,,,,.39]]);na("walk",[[3,,.1513,,.0296,.3151,,,,,,,,,,,,,1,,,.1,,.25],[3,,.1311,,.1015,.2034,,,,,,,,,,,,,1,,,.1,,.25]]);na("magic",[[3,.3724,.3639,.5748,.6647,.5128,,-.0193,-.9454,,.442,.6758,-.13,,.0017,.7079,.1116,-.0445,
.5906,.3887,.4988,.8052,,.25]]);na("power",[[2,.2197,.9687,.2917,.1978,.1725,,.1085,.0738,-.5064,,-.4779,-.3248,.6976,-.8023,-.8414,-.0112,-.6864,.8322,.407,.3749,.0156,-.0015,.39]]);ib=new Bb;ib.play();console.log(ca);for(var b=0;50>b;b++)ba.push(v.sin(2*v.PI/50*b));ba.push(0);ba=ba.concat(ba.slice(0).reverse());ba.splice(50,1);Ua=ba.length-1;b=new fa(C.x,C.y,50,!0);f.H=b.getH();for(b=0;8>b;b++){var a=0==b%2?0:1,c=[],d=new fa(C.x-a*f.H,C.y+50*b/2,50,!0,a);d.posRow=a;a||(7>b&&c.push(f.DL),0<b&&c.push(f.UL));
c.push(f.R);d.neighbours=c;k.push(d);d.draw(null,"#eee");for(var e=0;7>e;e++){var h=0==e%2?!1:!0,d=new fa(C.x-a*f.H+2*f.H/3+(h?4*f.H/3+(e-1)*f.H:e*f.H),C.y+50*b/2,50,h,6!=e||a?!1:!0);3<=e&&(d.selected=!0);c=[];h?(c.push(f.R),7>b&&c.push(f.DL),0<b&&c.push(f.UL)):(c.push(f.L),(a||6>e)&&7>b&&c.push(f.DR),(a||6>e)&&0<b&&c.push(f.UR));d.neighbours=c;d.posRow=a;k.push(d);d.draw(null,d.selected?"#ccc":"#eee")}}for(b=0;b<f.NUM_STARS1;b++)qa.push({pos:new r(x(0,t),x(50,z)),sprite:new I("img/stars.png",[0+
45*x(0,1),0],[9,9],x(1,3),[0,1,2,3,4,3,2,1])});for(b=0;b<f.NUM_STARS2;b++)ra.push({pos:new r(x(-t/8,t+t/8),x(0,z+z/8)),sprite:new I("img/stars.png",[0+45*x(0,1),0],[9,9],x(3,5),[0,1,2,1])});Wa();N.addEventListener("click",Ka,!1);N.addEventListener("mousemove",La,!1);g.white.sprite=new I("img/mages.png",[0,0],[30,36],16,[1,0]);g.black.sprite=new I("img/mages.png",[60,0],[30,36],16,[0,1]);Ba.width=Aa.width=za.width=t;Ba.height=Aa.height=za.height=z;Xa();Sa()});Q.load(["img/icons.png","img/mages.png",
"img/stone.png","img/bases.png","img/stars.png"])})();