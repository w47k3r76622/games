(()=>{var J=()=>{},Ae="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);";function Ce(e,t){let s=t.parentNode;if(e.setAttribute("data-kontra",""),s){let i=s.querySelector("[data-kontra]:last-of-type")||t;s.insertBefore(e,i.nextSibling)}else document.body.appendChild(e)}function Ee(e,t){let s=e.indexOf(t);if(s!=-1)return e.splice(s,1),!0}var gt={};function ke(e,t){gt[e]=gt[e]||[],gt[e].push(t)}function U(e,...t){(gt[e]||[]).map(s=>s(...t))}var N,mt,qt={get(e,t){return t=="_proxy"?!0:J}};function te(){return N}function _t(){return mt}function ee(e,{contextless:t=!1}={}){if(N=document.getElementById(e)||e||document.querySelector("canvas"),t&&(N=N||new Proxy({},qt)),!N)throw Error("You must provide a canvas element for the game");return mt=N.getContext("2d")||new Proxy({},qt),mt.imageSmoothingEnabled=!1,U("init"),{canvas:N,context:mt}}var ot=class{constructor({spriteSheet:t,frames:s,frameRate:i,loop:n=!0}){this.spriteSheet=t,this.frames=s,this.frameRate=i,this.loop=n;let{width:h,height:a,margin:o=0}=t.frame;this.width=h,this.height=a,this.margin=o,this._f=0,this._a=0}clone(){return new ot(this)}reset(){this._f=0,this._a=0}update(t=1/60){if(!(!this.loop&&this._f==this.frames.length-1))for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}render({x:t,y:s,width:i=this.width,height:n=this.height,context:h=_t()}){let a=this.frames[this._f]/this.spriteSheet._f|0,o=this.frames[this._f]%this.spriteSheet._f|0;h.drawImage(this.spriteSheet.image,o*this.width+(o*2+1)*this.margin,a*this.height+(a*2+1)*this.margin,this.width,this.height,t,s,i,n)}};function Pe(){return new ot(...arguments)}var Le=/(jpeg|jpg|gif|png|webp)$/,Ie=/(wav|mp3|ogg|aac)$/,ie=/^\//,Fe=/\/$/,se=new WeakMap,ne="",Re="",Oe="";function yt(e,t){return new URL(e,t).href}function It(e,t){return[e.replace(Fe,""),e?t.replace(ie,""):t].filter(s=>s).join("/")}function Ft(e){return e.split(".").pop()}function Rt(e){let t=e.replace("."+Ft(e),"");return t.split("/").length==2?t.replace(ie,""):t}function Be(e){return{wav:e.canPlayType('audio/wav; codecs="1"'),mp3:e.canPlayType("audio/mpeg;"),ogg:e.canPlayType('audio/ogg; codecs="vorbis"'),aac:e.canPlayType("audio/aac;")}}var b={},at={},Q={};function Ot(){window.__k||(window.__k={dm:se,u:yt,d:Q,i:b})}function re(e){ne=e}function De(e){return Ot(),new Promise((t,s)=>{let i,n,h;if(i=It(ne,e),b[i])return t(b[i]);n=new Image,n.onload=function(){h=yt(i,window.location.href),b[Rt(e)]=b[i]=b[h]=this,U("assetLoaded",this,e),t(this)},n.onerror=function(){s("Unable to load image "+i)},n.src=i})}function Te(e){return new Promise((t,s)=>{let i=e,n,h,a,o;if(n=new Audio,h=Be(n),e=[].concat(e).reduce((l,u)=>l||(h[Ft(u)]?u:null),0),!e)return s("cannot play any of the audio formats provided "+i);if(a=It(Re,e),at[a])return t(at[a]);n.addEventListener("canplay",function(){o=yt(a,window.location.href),at[Rt(e)]=at[a]=at[o]=this,U("assetLoaded",this,e),t(this)}),n.onerror=function(){s("Unable to load audio "+a)},n.src=a,n.load()})}function Ge(e){Ot();let t,s;return t=It(Oe,e),Q[t]?Promise.resolve(Q[t]):fetch(t).then(i=>{if(!i.ok)throw i;return i.clone().json().catch(()=>i.text())}).then(i=>(s=yt(t,window.location.href),typeof i=="object"&&se.set(i,s),Q[Rt(e)]=Q[t]=Q[s]=i,U("assetLoaded",i,e),i))}function dt(...e){return Ot(),Promise.all(e.map(t=>{let s=Ft([].concat(t)[0]);return s.match(Le)?De(t):s.match(Ie)?Te(t):Ge(t)}))}function Ye(e,t){let s=Math.sin(t),i=Math.cos(t);return{x:e.x*i-e.y*s,y:e.x*s+e.y*i}}function Kt(e,t,s){return Math.min(Math.max(e,s),t)}function $e(e){let{x:t=0,y:s=0,width:i,height:n}=e.world||e;return e.mapwidth&&(i=e.mapwidth,n=e.mapheight),e.anchor&&(t-=i*e.anchor.x,s-=n*e.anchor.y),i<0&&(t+=i,i*=-1),n<0&&(s+=n,n*=-1),{x:t,y:s,width:i,height:n}}var H=class{constructor(t=0,s=0,i={}){this.x=t,this.y=s,i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=s)}add(t){return new H(this.x+t.x,this.y+t.y,this)}subtract(t){return new H(this.x-t.x,this.y-t.y,this)}scale(t){return new H(this.x*t,this.y*t)}normalize(t=this.length()){return new H(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}clamp(t,s,i,n){this._c=!0,this._a=t,this._b=s,this._d=i,this._e=n}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?Kt(this._a,this._d,t):t}set y(t){this._y=this._c?Kt(this._b,this._e,t):t}};function At(){return new H(...arguments)}var Et=class{constructor(t){return this.init(t)}init(t={}){this.position=At(),this.velocity=At(),this.acceleration=At(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let s=this.acceleration;t&&(s=s.scale(t)),this.velocity=this.velocity.add(s);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}},wt=class extends Et{init({width:t=0,height:s=0,context:i=_t(),render:n=this.draw,update:h=this.advance,children:a=[],anchor:o={x:0,y:0},opacity:l=1,rotation:u=0,scaleX:g=1,scaleY:y=1,...r}={}){this._c=[],super.init({width:t,height:s,context:i,anchor:o,opacity:l,rotation:u,scaleX:g,scaleY:y,...r}),this._di=!0,this._uw(),this.addChild(a),this._rf=n,this._uf=h}update(t){this._uf(t),this.children.map(s=>s.update&&s.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let s=-this.width*this.anchor.x,i=-this.height*this.anchor.y;(s||i)&&t.translate(s,i),this.context.globalAlpha=this.opacity,this._rf(),(s||i)&&t.translate(-s,-i),this.children.map(h=>h.render&&h.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:s=0,_wo:i=1,_wr:n=0,_wsx:h=1,_wsy:a=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=i*this.opacity,this._wsx=h*this.scaleX,this._wsy=a*this.scaleY,this._wx=this._wx*h,this._wy=this._wy*a,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wr=n+this.rotation;let{x:o,y:l}=Ye({x:this._wx,y:this._wy},n);this._wx=o,this._wy=l,this._wx+=t,this._wy+=s}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(s=>{this.children.push(s),s.parent=this,s._pc=s._pc||J,s._pc()})}removeChild(...t){t.flat().map(s=>{Ee(this.children,s)&&(s.parent=null,s._pc())})}get opacity(){return this._opa}set opacity(t){this._opa=t,this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,s=t){this.scaleX=t,this.scaleY=s}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}};var W=class extends wt{init({image:t,width:s=t?t.width:void 0,height:i=t?t.height:void 0,...n}={}){super.init({image:t,width:s,height:i,...n})}get animations(){return this._a}set animations(t){let s,i;this._a={};for(s in t)this._a[s]=t[s].clone(),i=i||this._a[s];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){super.advance(t),this.currentAnimation&&this.currentAnimation.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}};function xt(){return new W(...arguments)}var He=/(\d+)(\w+)/;function Xe(e){let t=e.match(He),s=+t[1],i=t[2];return{size:s,unit:i,computed:s}}var kt=class extends wt{init({text:t="",textAlign:s="",lineHeight:i=1,font:n=_t().font,...h}={}){t=""+t,super.init({text:t,textAlign:s,lineHeight:i,font:n,...h}),this._p()}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=Xe(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context;if(t.font=this.font,!this._s.length&&this._fw){let s=this.text.split(" "),i=0,n=2;for(;n<=s.length;n++){let h=s.slice(i,n).join(" ");t.measureText(h).width>this._fw&&(this._s.push(s.slice(i,n-1).join(" ")),i=n-1)}this._s.push(s.slice(i,n).join(" "))}if(!this._s.length&&this.text.includes(`
`)){let s=0;this.text.split(`
`).map(i=>{this._s.push(i),s=Math.max(s,t.measureText(i).width)}),this._w=this._fw||s}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,s=this.textAlign,i=this.context;s=this.textAlign||(i.canvas.dir=="rtl"?"right":"left"),t=s=="right"?this.width:s=="center"?this.width/2|0:0,this._s.map((n,h)=>{i.textBaseline="top",i.textAlign=s,i.fillStyle=this.color,i.font=this.font,i.fillText(n,t,this._fs*this.lineHeight*h)})}};function ze(){return new kt(...arguments)}var lt=new WeakMap,Vt={},Bt={},he={0:"left",1:"middle",2:"right"};function Ne(e,t){let{x:s,y:i,width:n,height:h}=$e(e);do s-=e.sx||0,i-=e.sy||0;while(e=e.parent);let a=t.x-Math.max(s,Math.min(t.x,s+n)),o=t.y-Math.max(i,Math.min(t.y,i+h));return a*a+o*o<t.radius*t.radius}function Ue(e){let t=e._lf.length?e._lf:e._cf;for(let s=t.length-1;s>=0;s--){let i=t[s];if(i.collidesWithPointer?i.collidesWithPointer(e):Ne(i,e))return i}}function k(e,t){return parseFloat(e.getPropertyValue(t))||0}function We(e){let{canvas:t,_s:s}=e,i=t.getBoundingClientRect(),n=s.transform!="none"?s.transform.replace("matrix(","").split(","):[1,1,1,1],h=parseFloat(n[0]),a=parseFloat(n[3]),o=(k(s,"border-left-width")+k(s,"border-right-width"))*h,l=(k(s,"border-top-width")+k(s,"border-bottom-width"))*a,u=(k(s,"padding-left")+k(s,"padding-right"))*h,g=(k(s,"padding-top")+k(s,"padding-bottom"))*a;return{scaleX:(i.width-o-u)/t.width,scaleY:(i.height-l-g)/t.height,offsetX:i.left+(k(s,"border-left-width")+k(s,"padding-left"))*h,offsetY:i.top+(k(s,"border-top-width")+k(s,"padding-top"))*a}}function Qt(e){let t=e.button!=null?he[e.button]:"left";Bt[t]=!0,Dt(e,"onDown")}function Ct(e){let t=e.button!=null?he[e.button]:"left";Bt[t]=!1,Dt(e,"onUp")}function Jt(e){Dt(e,"onOver")}function je(e){let t=lt.get(e.target);t._oo=null,Bt={}}function Zt(e,t,s){let i=Ue(e);i&&i[t]&&i[t](s),Vt[t]&&Vt[t](s,i),t=="onOver"&&(i!=e._oo&&e._oo&&e._oo.onOut&&e._oo.onOut(s),e._oo=i)}function Dt(e,t){e.preventDefault();let s=e.target,i=lt.get(s),{scaleX:n,scaleY:h,offsetX:a,offsetY:o}=We(i);e.type.includes("touch")?(Array.from(e.touches).map(({clientX:u,clientY:g,identifier:y})=>{let r=i.touches[y];r||(r=i.touches[y]={start:{x:(u-a)/n,y:(g-o)/h}},i.touches.length++),r.changed=!1}),Array.from(e.changedTouches).map(({clientX:u,clientY:g,identifier:y})=>{let r=i.touches[y];r.changed=!0,r.x=i.x=(u-a)/n,r.y=i.y=(g-o)/h,Zt(i,t,e),U("touchChanged",e,i.touches),t=="onUp"&&(delete i.touches[y],i.touches.length--,i.touches.length||U("touchEnd"))})):(i.x=(e.clientX-a)/n,i.y=(e.clientY-o)/h,Zt(i,t,e))}function ae({radius:e=5,canvas:t=te()}={}){let s=lt.get(t);if(!s){let i=window.getComputedStyle(t);s={x:0,y:0,radius:e,touches:{length:0},canvas:t,_cf:[],_lf:[],_o:[],_oo:null,_s:i},lt.set(t,s)}return t.addEventListener("mousedown",Qt),t.addEventListener("touchstart",Qt),t.addEventListener("mouseup",Ct),t.addEventListener("touchend",Ct),t.addEventListener("touchcancel",Ct),t.addEventListener("blur",je),t.addEventListener("mousemove",Jt),t.addEventListener("touchmove",Jt),s._t||(s._t=!0,ke("tick",()=>{s._lf.length=0,s._cf.map(i=>{s._lf.push(i)}),s._cf.length=0})),s}function qe(...e){e.flat().map(t=>{let s=t.context?t.context.canvas:te(),i=lt.get(s);if(!i)throw new ReferenceError("Pointer events not initialized for the objects canvas");t._r||(t._r=t.render,t.render=function(){i._cf.push(this),this._r()},i._o.push(t))})}var Pt=class extends W{init({padX:t=0,padY:s=0,text:i,disabled:n=!1,onDown:h,onUp:a,...o}={}){super.init({padX:t,padY:s,...o}),this.textNode=ze({...i,context:this.context}),this.width||(this.width=this.textNode.width,this.height=this.textNode.height),qe(this),this.addChild(this.textNode),this._od=h||J,this._ou=a||J;let l=this._dn=document.createElement("button");l.style=Ae,l.textContent=this.text,n&&this.disable(),l.addEventListener("focus",()=>this.focus()),l.addEventListener("blur",()=>this.blur()),l.addEventListener("keydown",u=>this._kd(u)),l.addEventListener("keyup",u=>this._ku(u)),Ce(l,this.context.canvas),this._uw(),this._p()}get text(){return this.textNode.text}set text(t){this._d=!0,this.textNode.text=t}destroy(){this._dn.remove()}_p(){this.text!=this._dn.textContent&&(this._dn.textContent=this.text),this.textNode._p();let t=this.textNode.width+this.padX*2,s=this.textNode.height+this.padY*2;this.width=Math.max(t,this.width),this.height=Math.max(s,this.height),this._uw()}render(){this._d&&this._p(),super.render()}enable(){this.disabled=this._dn.disabled=!1,this.onEnable()}disable(){this.disabled=this._dn.disabled=!0,this.onDisable()}focus(){this.disabled||(this.focused=!0,document.activeElement!=this._dn&&this._dn.focus(),this.onFocus())}blur(){this.focused=!1,document.activeElement==this._dn&&this._dn.blur(),this.onBlur()}onOver(){this.disabled||(this.hovered=!0)}onOut(){this.hovered=!1}onEnable(){}onDisable(){}onFocus(){}onBlur(){}onDown(){this.disabled||(this.pressed=!0,this._od())}onUp(){this.disabled||(this.pressed=!1,this._ou())}_kd(t){(t.code=="Enter"||t.code=="Space")&&this.onDown()}_ku(t){(t.code=="Enter"||t.code=="Space")&&this.onUp()}};function Tt(){return new Pt(...arguments)}function Ke(e){let t=e.canvas;e.clearRect(0,0,t.width,t.height)}function oe({fps:e=60,clearCanvas:t=!0,update:s=J,render:i,context:n=_t(),blur:h=!1}={}){if(!i)throw Error("You must provide a render() function");let a=0,o=1e3/e,l=1/e,u=t?Ke:J,g,y,r,d,C,w=!0;h||(window.addEventListener("focus",()=>{w=!0}),window.addEventListener("blur",()=>{w=!1}));function m(){if(y=requestAnimationFrame(m),!!w&&(r=performance.now(),d=r-g,g=r,!(d>1e3))){for(U("tick"),a+=d;a>=o;)C.update(l),a-=o;u(n),C.render()}}return C={update:s,render:i,isStopped:!0,start(){g=performance.now(),this.isStopped=!1,requestAnimationFrame(m)},stop(){this.isStopped=!0,cancelAnimationFrame(y)},_frame:m,set _last(P){g=P}},C}function Ve(e){if(+e==e)return e;let t=[],s=e.split(".."),i=+s[0],n=+s[1],h=i;if(i<n)for(;h<=n;h++)t.push(h);else for(;h>=n;h--)t.push(h);return t}var Lt=class{constructor({image:t,frameWidth:s,frameHeight:i,frameMargin:n,animations:h}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:s,height:i,margin:n},this._f=t.width/s|0,this.createAnimations(h)}createAnimations(t){let s,i;for(i in t){let{frames:n,frameRate:h,loop:a}=t[i];if(s=[],n==null)throw Error("Animation "+i+" must provide a frames property");[].concat(n).map(o=>{s=s.concat(Ve(o))}),this.animations[i]=Pe({spriteSheet:this,frames:s,frameRate:h,loop:a})}}};function Gt(){return new Lt(...arguments)}var Qe=function(){let e=function(r){return Math.sin(r*6.283184)},t=function(r){return 2*(r%1)-1},s=function(r){return r%1<.5?1:-1},i=function(r){let d=r%1*4;return d<2?d-1:3-d},n=function(r){return .003959503758*2**((r-128)/12)},h=function(r,d,C){let w=a[r.i[0]],m=r.i[1],P=r.i[3]/32,x=a[r.i[4]],Y=r.i[5],M=r.i[8]/32,V=r.i[9],X=r.i[10]*r.i[10]*4,nt=r.i[11]*r.i[11]*4,ut=r.i[12]*r.i[12]*4,p=1/ut,rt=-r.i[13]/16,E=r.i[14],Nt=C*2**(2-r.i[15]),B=new Int32Array(X+nt+ut),c=0,D=0,S,$,v,pt,L,ht,z;for(S=0,$=0;S<X+nt+ut;S++,$++)$>=0&&(E=E>>8|(E&255)<<4,$-=Nt,ht=n(d+(E&15)+r.i[2]-128),z=n(d+(E&15)+r.i[6]-128)*(1+8e-4*r.i[7])),v=1,S<X?v=S/X:S>=X+nt&&(v=(S-X-nt)*p,v=(1-v)*3**(rt*v)),c+=ht*v**P,L=w(c)*m,D+=z*v**M,L+=x(D)*Y,V&&(L+=(2*Math.random()-1)*V),B[S]=80*L*v|0;return B},a=[e,s,t,i],o,l,u,g,y;this.init=function(r){o=r,l=r.endPattern,u=0,g=r.rowLen*r.patternLen*(l+1)*2,y=new Int32Array(g)},this.generate=function(){let r,d,C,w,m,P,x,Y,M,V,X,nt,ut,p,rt,E,Nt,B=new Int32Array(g),c=o.songData[u],D=o.rowLen,S=o.patternLen,$=0,v=0,pt,L,ht=!1,z=[];if(c)for(w=0;w<=l;++w)for(Y=c.p[w],m=0;m<S;++m){let vt=Y?c.c[Y-1].f[m]:0;vt&&(c.i[vt-1]=c.c[Y-1].f[m+S]||0,vt<17&&(z=[]));let me=a[c.i[16]],we=c.i[17]/512,_e=2**(c.i[18]-9)/D,ye=c.i[19],Ut=c.i[20],xe=c.i[21]*43.23529*3.141592/44100,be=1-c.i[22]/255,Mt=c.i[23]*1e-5,ve=c.i[24]/32,Me=c.i[25]/512,Se=6.283184*2**(c.i[26]-9)/D,Wt=c.i[27]/255,St=c.i[28]*D&-2;for(rt=(w*S+m)*D,P=0;P<4;++P)if(x=Y?c.c[Y-1].n[m+P*S]:0,x){z[x]||(z[x]=h(c,x,D));let jt=z[x];for(d=0,r=rt*2;d<jt.length;d++,r+=2)B[r]+=jt[d]}for(d=0;d<D;d++)M=(rt+d)*2,p=B[M],p||ht?(E=xe,ye&&(E*=me(_e*M)*we+.5),E=1.5*Math.sin(E),$+=E*v,pt=be*(p-v)-$,v+=E*pt,p=Ut==3?v:Ut==1?pt:$,Mt&&(p*=Mt,p=p<1?p>-1?e(p*.25):-1:1,p/=Mt),p*=ve,ht=p*p>1e-5,V=Math.sin(Se*M)*Me+.5,L=p*(1-V),p*=V):L=0,M>=St&&(L+=B[M-St+1]*Wt,p+=B[M-St]*Wt),B[M]=L|0,B[M+1]=p|0,y[M]+=L|0,y[M+1]+=p|0}return u++,u/o.numChannels},this.createWave=function(){let r=44,d=r+g*2-8,C=d-36,w=new Uint8Array(r+g*2);w.set([82,73,70,70,d&255,d>>8&255,d>>16&255,d>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,C&255,C>>8&255,C>>16&255,C>>24&255]);for(let m=0,P=r;m<g;++m){let x=y[m];x=x<-32767?-32767:x>32767?32767:x,w[P++]=x&255,w[P++]=x>>8&255}return w}},le=Qe;var Je={songData:[{i:[3,60,120,0,0,60,120,0,0,24,2,2,47,61,0,0,0,96,3,1,3,94,79,0,32,84,2,12,4],p:[1],c:[{n:[142,142,142,,142,142,142,,142,142,142,,144,,146,,142,142,142,,142,142,142,,142,146,146,,146,,144,,146,146,146,,146,146,146,,146,146,151,,152,,154,,146,146,146,,146,146,146,,151,154,152,,149,,146],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1},Ze={songData:[{i:[0,255,116,79,0,255,116,0,83,0,4,6,69,52,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[1],c:[{n:[147],f:[]}]}],rowLen:5513,patternLen:1,endPattern:0,numChannels:1},ti={songData:[{i:[0,60,111,64,0,60,111,0,64,60,4,40,43,51,0,0,0,231,6,1,3,183,15,0,32,232,4,74,6],p:[1],c:[{n:[147],f:[]}]}],rowLen:5513,patternLen:1,endPattern:0,numChannels:1},ei={songData:[{i:[0,75,128,0,0,75,128,12,0,0,12,0,72,0,0,0,0,0,0,0,2,255,0,0,32,83,3,130,4],p:[1],c:[{n:[142,149],f:[]}]}],rowLen:11025,patternLen:2,endPattern:0,numChannels:1},de=[Je,Ze,ti,ei];ee();ae();var ft=0,Yt=[],fe=[0,0,0,0],O=[],ce=[!1,!1,!1,!1],ue=[];for(let e=0;e<4;e++){let t=new le;Yt.push(t),t.init(de[e]);let s=document.createElement("audio");O.push(s);let i=setInterval(function(){ce[e]&&(fe[e]=Yt[e].createWave(),O[e].src=URL.createObjectURL(new Blob([fe[e]],{type:"audio/wav"})),e==0&&(O[e].loop=!0),clearInterval(ue[e])),ce[e]=Yt[e].generate()>=1});ue.push(i)}re("assets/img/");var pe,_;dt("rider.png").then(()=>{pe=Gt({image:b.rider,frameWidth:24,frameHeight:24,animations:{jump:{frames:"2..4",frameRate:4,loop:!1},run:{frames:"0..2",frameRate:6}}}),_=new W({x:50,y:450,width:96,height:96,anchor:{x:0,y:.5},animations:pe.animations})});var T,bt;dt("hurdle.png").then(()=>{b.hurdle.width=64,b.hurdle.height=64});dt("arrow.png").then(()=>{b.arrow.width=32,b.arrow.height=32});var ge;dt("bird.png").then(()=>{ge=Gt({image:b.bird,frameHeight:16,frameWidth:32,animations:{fly:{frames:"0..3",frameRate:9}}})});var Ht=class extends xt{constructor(t,s){super(t),this.lane=s}},Xt=class extends W{constructor(t,s){super(t),this.lane=s,this.isShot=30}},zt=e=>{if(!it){switch(e.code){case"Space":_.playAnimation("jump"),it=!0;break;case"ArrowUp":F=Math.max(0,F-1);break;case"ArrowDown":F=Math.min(2,F+1);break;case"ArrowRight":si(F),O[2].play();break;case"ArrowLeft":break}removeEventListener("keydown",zt)}};addEventListener("keydown",zt);addEventListener("keyup",()=>{addEventListener("keydown",zt)});var it,K,q,F,Z,f,G=[];for(let e=0;e<3;e++){G.push([]);for(let t=0;t<document.getElementById("game").width;t++)G[e].push(0)}var st=[];for(let e=0;e<3;e++){st.push([]);for(let t=0;t<document.getElementById("game").width;t++)st[e].push(0)}var j,tt,A;function ii(e){if(K==0){if(it){if(q>25&&q<65){for(let t=_.x;t<_.x+_.width;t++)if(st[e][t]==1){K=150,O[1].play(),T-=1;break}}}else for(let t=_.x;t<_.x+_.width;t++)if(G[e][t]==1){K=150,O[1].play(),T-=1;break}else if(G[e][t]==2){R=Math.floor((3+Math.floor(A/5e3))*2/3),ct=150;break}else if(G[e][t]==3){R=Math.floor((3+Math.floor(A/5e3))*4/3),ct=150;break}}}var I;function si(e){let t=new xt({x:50,y:320+70*F,anchor:{x:0,y:0},image:b.arrow});t.lane=e,I.push(t);for(let s=f.length-1;s>=0;s--)f[s].lane==e&&t.x+t.width+150>=f[s].x-10&&t.x+t.width+150<=f[s].x+f[s].width+10&&(A+=500,bt-=1,bt<=0&&(T=Math.min(10,T+1),bt=T*Math.floor(Math.random()*5+1)),f[s].isShot-=1)}var R,ct,et,$t=(e,t,s)=>{for(let i=e.length-1;i>=0;i--)if(e[i].x>0){for(let n=0;n<R;n++)t[e[i].lane][e[i].x+e[i].width+n]=0,s==1?t[e[i].lane][e[i].x-n]=1:t[e[i].lane][e[i].x-n]=e[i].spType;e[i].x-=R}else{for(let n=0;n<e[i].width+R;n++)t[e[i].lane][n]=0;e.splice(i,1)}},ni=Tt({x:Math.floor(document.getElementById("game").width/2),y:Math.floor(document.getElementById("game").height*3/4),anchor:{x:.5,y:.5},text:{text:"Start Running",color:"white",font:"20px Arial, sans-serif",anchor:{x:.5,y:.5}},padX:20,padY:10,render(){if(this.pressed){this.textNode.color="yellow",T=3,bt=T*Math.floor(Math.random()*5+1),ft=1,it=!1,K=0,q=0,F=1,Z=[],f=[];for(let e=0;e<3;e++)for(let t=0;t<document.getElementById("game").width;t++)st[e][t]=0,G[e][t]=0;j=[160,120,60],tt=[60,120,160],A=0,I=[],R=3,ct=0,et=[],document.getElementById("game").style.cursor="initial",O[0].play(),this.pressed=!1}else this.hovered?(this.textNode.color="red",document.getElementById("game").style.cursor="pointer"):(this.textNode.color="white",document.getElementById("game").style.cursor="initial")}}),ri=Tt({x:Math.floor(document.getElementById("game").width/2),y:Math.floor(document.getElementById("game").height*3/4),anchor:{x:.5,y:.5},text:{text:"Back to Menu",color:"white",font:"20px Arial, sans-serif",anchor:{x:.5,y:.5}},padX:20,padY:10,render(){this.focused&&(this.context.setLineDash([8,10]),this.context.lineWidth=3,this.context.strokeStyle="red",this.context.strokeRect(0,0,this.width,this.height)),this.pressed?(this.textNode.color="yellow",ft=0,this.pressed=!1):this.hovered?(this.textNode.color="red",document.getElementById("game").style.cursor="pointer"):(this.textNode.color="white",document.getElementById("game").style.cursor="initial")}}),hi=oe({update:function(){if(ft==1){it?q+=1:_.playAnimation("run"),f.forEach(e=>{e.playAnimation("fly"),e.update()}),q>=90&&(it=!1,q=0),_.update(),$t(Z,G,1),$t(f,st,1),$t(et,G,2);for(let e=0;e<G.length;e++){if(j[e]>=300+Math.floor(200*e/5)){let t=Math.min(.3,A/1e4)+.05*(2-e),s=Math.random();if(s<j[e]/1e3+t){let i=new Ht({x:500,y:330+70*e,anchor:{x:0,y:.5},image:b.hurdle},e);Z.push(i),j[e]=0}else if(s>.85){let i=xt({x:500,y:353+67*e,anchor:{x:0,y:.5},width:64,height:48});Math.random()>.5?(i.color="red",i.spType=2):(i.color="green",i.spType=3),i.lane=e,et.push(i),j[e]=0}else j[e]+=e+2}else j[e]+=e+1;if(tt[e]>=300+Math.floor(200*(2-e)/5)){let t=Math.min(.3,A/1e4)+.05*e,s=Math.random();if(2*(e+1)*s<tt[e]/(5e3*(2*e+1))+t){let i=new Xt({x:500,y:200+70*e,width:96,height:48,anchor:{x:0,y:0},animations:ge.animations},e);f.push(i),tt[e]=0}else tt[e]+=e+2}else tt[e]+=e+1}for(let e=f.length-1;e>=0;e--)if(f[e].isShot<30&&(f[e].isShot-=2,f[e].isShot<=0)){O[3].play();for(let t=Math.max(0,f[e].x-R);t<f[e].x+f[e].width+R;t++)st[f[e].lane][t]=0;f.splice(e,1)}for(let e=I.length-1;e>=0;e--)I[e].x+=5,I[e].y-=5,I[e].y<100&&I.splice(e,1);ii(F),A+=R,ct>0?ct-=1:R=3+Math.floor(A/5e3),K>0?(K-=1,_.color=`rgba(255,255,255,${.5*Math.sin(Math.PI*(50-K%50)/50)})`):_.color="rgba(255,255,255,0)",T<=0&&(O[0].pause(),O[0].currentTime=0,ft=2)}},render:function(){let e=document.getElementById("game"),t=e.getContext("2d");switch(t.fillStyle="#000000",t.fillRect(0,0,e.width,Math.floor(e.height/5)),ft){case 0:t.font="bold 72px Verdana",t.textAlign="center",t.fillStyle="#FFFFFF",t.fillText("MongoRun",Math.floor(e.width/2),80),ni.render();break;case 1:t.font="bold 24px Verdana",t.textAlign="right",t.fillStyle="#FFFFFF",t.fillText(`Score: ${Math.floor(A/10)}`,600,80),t.fillStyle="#FFD700";for(let s=0;s<T;s++)t.fillRect(35*s,20,26,50),t.beginPath(),t.arc(35*s+13,20,13,0,Math.PI,!0),t.fill(),t.arc(35*s+13,70,13,0,Math.PI),t.fill();Math.floor(A/5e3)%2?t.fillStyle="#111111":t.fillStyle="#87CEEB",t.fillRect(0,Math.floor(e.height/5),e.width,Math.floor(e.height*2/5)),Math.floor(A/5e3)%2?t.fillStyle="#FFFFFF":t.fillStyle="#FFD700",t.beginPath(),t.arc(580,150,20,0,Math.PI*2),t.fill(),Math.floor(A/5e3)%2?t.fillStyle="#988558":t.fillStyle="#966919",t.beginPath(),t.moveTo(Math.floor(e.width/6),Math.floor(e.height*3/5)),t.lineTo(Math.floor(e.width/2),Math.floor(e.height/3)),t.lineTo(Math.floor(e.width*5/6),Math.floor(e.height*3/5)),t.fill(),t.fillStyle="#009A17",t.fillRect(0,Math.floor(e.height*3/5),e.width,Math.floor(e.height*3/5)),t.fillStyle="#F7B66D",t.fillRect(0,Math.floor(e.height*3/5)+Math.floor(e.height/60),e.width,Math.floor(e.height/10)),t.fillRect(0,Math.floor(e.height*3/5)+Math.floor(e.height/120)*19,e.width,Math.floor(e.height/10)),t.fillRect(0,Math.floor(e.height*3/5)+Math.floor(e.height/60)*18,e.width,Math.floor(e.height/10)),_.y=325+70*F-Math.sin(q/90*Math.PI)*100;for(let s=0;s<3;s++){for(let i=0;i<Z.length;i++)Z[i].lane==s&&Z[i].render();for(let i=f.length-1;i>=0;i--)f[i].lane==s&&(f[i].height=36+s*6,f[i].width=72+s*12,f[i].render());for(let i=I.length-1;i>=0;i--)I[i].lane==s&&I[i].render();for(let i=et.length-1;i>=0;i--)et[i].lane==s&&et[i].render();F==s&&(_.height=72+s*12,_.width=72+s*12,_.render())}break;case 2:t.font="bold 48px Verdana",t.textAlign="center",t.fillStyle="#FFFFFF",t.fillText(`You score: ${Math.floor(A/10)}`,Math.floor(e.width/2),180),ri.render();break}}});hi.start();})();
