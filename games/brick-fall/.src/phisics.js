c=a.getContext("2d");var Vec2=(e,o)=>({x:e,y:o}),length=e=>dot(e,e)**.5,add=(e,o)=>Vec2(e.x+o.x,e.y+o.y),substract=(e,o)=>add(e,scale(o,-1)),scale=(e,o)=>Vec2(e.x*o,e.y*o),dot=(e,o)=>e.x*o.x+e.y*o.y,cross=(e,o)=>e.x*o.y-e.y*o.x,rotate=(e,o,t,s=e.x-o.x,n=e.y-o.y)=>Vec2(s*Math.cos(t)-n*Math.sin(t)+o.x,s*Math.sin(t)+n*Math.cos(t)+o.y),normalize=e=>scale(e,1/(length(e)||1)),distance=(e,o)=>length(substract(e,o)),mGravity=Vec2(0,1e3),objects=[],gameplay=!0,tiempoSegundos=0,yourScore=0,topScore=null==localStorage.getItem("topScore")?0:localStorage.getItem("topScore");document.getElementById("topScore").innerHTML=topScore;var positionYRoof=25,collisionInfo={},collisionInfoR1={},collisionInfoR2={},setInfo=(e,o,t,s)=>{e.D=o,e.N=t,e.S=s,e.E=add(s,scale(t,o))},RigidShape=(e,o,t,s,n,c,a,r,l,i="")=>(l={T:n,C:e,F:t,R:s,M:o?1/o:0,V:Vec2(0,0),A:o?mGravity:Vec2(0,0),G:0,v:0,a:0,B:c,W:a,H:r,I:n?(Math.hypot(a,r),o>0?1/(o*(a**2+r**2)/12):0):o>0?o*c**2/12:0,N:[],X:[Vec2(e.x-a/2,e.y-r/2),Vec2(e.x+a/2,e.y-r/2),Vec2(e.x+a/2,e.y+r/2),Vec2(e.x-a/2,e.y+r/2)],Name:i},n&&computeRectNormals(l),objects.push(l),l),moveShape=(e,o,t)=>{if(e.C=add(e.C,o),e.T)for(t=4;t--;)e.X[t]=add(e.X[t],o)},rotateShape=(e,o,t)=>{if(e.G+=o,e.T){for(t=4;t--;)e.X[t]=rotate(e.X[t],e.C,o);computeRectNormals(e)}},boundTest=(e,o)=>length(substract(o.C,e.C))<=e.B+o.B,computeRectNormals=(e,o)=>{for(o=4;o--;)e.N[o]=normalize(substract(e.X[(o+1)%4],e.X[(o+2)%4]))},findAxisLeastPenetration=(e,o,t)=>{var s,n,c,a,r,l,i=1e9,f=-1,d=1;for(n=4;d&&n--;){s=e.N[n];var u,m,b=scale(s,-1),y=e.X[n];for(l=-1e9,r=-1,c=4;c--;)u=substract(o.X[c],y),(m=dot(u,b))>0&&m>l&&(r=o.X[c],l=m);(d=-1!==r)&&l<i&&(i=l,f=n,a=r)}return d&&setInfo(t,i,e.N[f],add(a,scale(e.N[f],i))),d},testCollision=(e,o,t)=>{if(!e.T&&!o.T){var s=substract(o.C,e.C),n=e.B+o.B,c=length(s);if(c<=Math.sqrt(n*n)){var a=normalize(scale(s,-1)),r=scale(a,o.B);setInfo(collisionInfo,n-c,normalize(s),add(o.C,r))}return 1}if(e.T&&o.T){var l,i=0;return(l=findAxisLeastPenetration(e,o,collisionInfoR1))&&(i=findAxisLeastPenetration(o,e,collisionInfoR2))&&(collisionInfoR1.D<collisionInfoR2.D?setInfo(collisionInfo,collisionInfoR1.D,collisionInfoR1.N,substract(collisionInfoR1.S,scale(collisionInfoR1.N,collisionInfoR1.D))):setInfo(collisionInfo,collisionInfoR2.D,scale(collisionInfoR2.N,-1),collisionInfoR2.S)),l&&i}if(!e.T&&o.T&&([e,o]=[o,e]),e.T&&!o.T){var f,d,u,m,b,y,g=1,I=-1e9,p=0;for(f=4;f--;){if(u=o.C,d=substract(u,e.X[f]),(m=dot(d,e.N[f]))>0){I=m,p=f,g=0;break}m>I&&(I=m,p=f)}if(g)setInfo(collisionInfo,o.B-I,e.N[p],substract(u,scale(e.N[p],o.B)));else{var v=substract(u,e.X[p]),M=substract(e.X[(p+1)%4],e.X[p]),h=dot(v,M);if(h<0){if((b=length(v))>o.B)return;y=normalize(v),setInfo(collisionInfo,o.B-b,y,add(u,scale(y,-o.B)))}else if(v=substract(u,e.X[(p+1)%4]),M=scale(M,-1),(h=dot(v,M))<0){if((b=length(v))>o.B)return;y=normalize(v),setInfo(collisionInfo,o.B-b,y,add(u,scale(y,-o.B)))}else{if(!(I<o.B))return;setInfo(collisionInfo,o.B-I,e.N[p],substract(u,scale(e.N[p],o.B)))}}return 1}},resolveCollision=(e,o,t)=>{if(e.M||o.M){var s=t.D/(e.M+o.M)*.8,n=scale(t.N,s),c=t.N;moveShape(e,scale(n,-e.M)),moveShape(o,scale(n,o.M));var a=scale(t.S,o.M/(e.M+o.M)),r=scale(t.E,e.M/(e.M+o.M)),l=add(a,r),i=substract(l,e.C),f=substract(l,o.C),d=add(e.V,Vec2(-1*e.v*i.y,e.v*i.x)),u=add(o.V,Vec2(-1*o.v*f.y,o.v*f.x)),m=substract(u,d),b=dot(m,c);if(!(b>0)){var y=Math.min(e.R,o.R),g=Math.min(e.F,o.F),I=cross(i,c),p=cross(f,c),v=-(1+y)*b/(e.M+o.M+I*I*e.I+p*p*o.I),M=scale(c,v);e.V=substract(e.V,scale(M,e.M)),o.V=add(o.V,scale(M,o.M)),e.v-=I*v*e.I,o.v+=p*v*o.I;var h=scale(normalize(substract(m,scale(c,dot(m,c)))),-1),R=cross(i,h),j=cross(f,h),S=-(1+y)*dot(m,h)*g/(e.M+o.M+R*R*e.I+j*j*o.I);S>v&&(S=v),M=scale(h,S),e.V=substract(e.V,scale(M,e.M)),o.V=add(o.V,scale(M,o.M)),e.v-=R*S*e.I,o.v+=j*S*o.I}}},Circle=(e,o,t,s,n,c)=>RigidShape(e,t,s,n,0,o,null,null,null,c),Rectangle=(e,o,t,s,n,c,a)=>RigidShape(e,s,n,c,1,Math.hypot(o,t)/2,o,t,null,a),r1=Rectangle(Vec2(500,positionYRoof),675,20,0,1,.5,"ROOF"),r2=Rectangle(Vec2(293,500),300,20,0,1,.5,"FLOOR"),r3=(r2=Rectangle(Vec2(707,500),300,20,0,1,.5,"FLOOR"),Rectangle(Vec2(150,240),15,500,0,1,.5,"LEFT")),r4=Rectangle(Vec2(850,240),15,500,0,1,.5,"RIGHT");r=Circle(Vec2(200,450),25,.5,1,.5,"PLAYER");let timer=3e3;var obs=Rectangle(Vec2(getRandomArbitrary(180,830),positionYRoof+20),10,20*Math.random()+10,30*Math.random(),Math.random()/2,Math.random()/2,"ENEMY");obs.v=20*Math.random()+10,setTimeout(function(){generateEnemy(1500)},3e3);var positionY=50;function generateEnemy(e){setTimeout(function(){console.log(positionY),rand=getRandomArbitrary(180,830),(obs=Rectangle(Vec2(rand,positionY),10,20*Math.random()+10,30*Math.random(),Math.random()/2,Math.random()/2,"ENEMY")).v=20*Math.random()+10,e>100?e-=100:positionYRoof<210?(console.log(positionYRoof),positionY+=1,positionYRoof+=1,r1.V.y=10):r1.V.y=0,console.log(obs.Name),generateEnemy(e)},e)}function getRandomArbitrary(e,o){return Math.random()*(o-e)+e}var Keys={up:!1,down:!1,left:!1,right:!1};function verifMove(){Keys.up?movePlayer("up"):Keys.down&&movePlayer("down"),Keys.left?movePlayer("left"):Keys.right&&movePlayer("right")}function movePlayer(e){"left"==e&&(r.V.x=-300),"right"==e&&(r.V.x=300),"up"==e&&(r.V.y=-200),"down"==e&&(r.V.y=0)}function looser(){localStorage.setItem("topScore",topScore),alert("You loose bro..."),window.location.reload()}function testHole(e){if(e.C.y>600||e.C.x<50||e.C.x>925)return gameplay=!1,looser(),!0}function countTime(){var e=Math.trunc(tiempoSegundos/60),o=tiempoSegundos%60,t=e.toString().padStart(2,"0")+":"+o.toString().padStart(2,"0");yourScore=tiempoSegundos,document.getElementById("time").innerHTML=t,document.getElementById("yourScore").innerHTML=yourScore,yourScore>topScore&&(topScore=yourScore),document.getElementById("topScore").innerHTML=topScore}window.onkeydown=function(e){var o=e.keyCode;e.preventDefault(),65===o?Keys.left=!0:87===o?Keys.up=!0:68===o?Keys.right=!0:83===o&&(Keys.down=!0),verifMove()},window.onkeyup=function(e){var o=e.keyCode;e.preventDefault(),65===o?Keys.left=!1:87===o?Keys.up=!1:68===o?Keys.right=!1:83===o&&(Keys.down=!1)},setInterval(function(){tiempoSegundos++,countTime()},1e3),setInterval((e,o,t)=>{if(gameplay){for(a.width^=0,t=9;t--;)for(e=objects.length;e--;)for(o=objects.length;o-- >e;)if(boundTest(objects[e],objects[o])){if("PLAYER"==objects[e].Name){if(testHole(objects[e]))return}else if("PLAYER"==objects[o].Name&&testHole(objects[o]))return;if(testCollision(objects[e],objects[o],collisionInfo)){if(dot(collisionInfo.N,substract(objects[o].C,objects[e].C))<0&&(collisionInfo={D:collisionInfo.D,N:scale(collisionInfo.N,-1),S:collisionInfo.E,E:collisionInfo.S}),resolveCollision(objects[e],objects[o],collisionInfo),"ENEMY"==objects[e].Name&&"FLOOR"==objects[o].Name?objects[e].V.x=1e6:"ENEMY"==objects[o].Name&&"FLOOR"==objects[e].Name&&(objects[o].V.x=1e6),"ENEMY"==objects[e].Name&&"PLAYER"==objects[o].Name)return gameplay=!1,void looser();if("ENEMY"==objects[o].Name&&"PLAYER"==objects[e].Name)return gameplay=!1,void looser()}}for(e=objects.length;e--;)c.save(),c.translate(objects[e].C.x,objects[e].C.y),c.rotate(objects[e].G),objects[e].T?c.strokeRect(-objects[e].W/2,-objects[e].H/2,objects[e].W,objects[e].H):(c.beginPath(),c.arc(0,0,objects[e].B,0,7),c.lineTo(0,0),c.closePath(),c.stroke()),c.restore(),objects[e].V=add(objects[e].V,scale(objects[e].A,1/60)),moveShape(objects[e],scale(objects[e].V,1/60)),objects[e].v+=1*objects[e].a/60,rotateShape(objects[e],1*objects[e].v/60)}},16);