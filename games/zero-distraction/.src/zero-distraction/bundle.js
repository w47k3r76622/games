!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e():"function"==typeof define&&define.amd?define(e):e()}(0,function(){var t=function(t){Object.assign(this,{uniforms:{},geometry:{vertices:[{x:0,y:0,z:0}]},mode:0,modifiers:{},attributes:[],multiplier:1}),Object.assign(this,t),this.prepareProgram(),this.prepareUniforms(),this.prepareAttributes(),this.prepareBuffers()};t.prototype.compileShader=function(t,e){var i=this.gl.createShader(t);return this.gl.shaderSource(i,e),this.gl.compileShader(i),i},t.prototype.prepareProgram=function(){var t=this.gl,e=this.vertex,i=this.fragment,n=t.createProgram();t.attachShader(n,this.compileShader(35633,e)),t.attachShader(n,this.compileShader(35632,i)),t.linkProgram(n),t.useProgram(n),this.program=n},t.prototype.prepareUniforms=function(){for(var t=Object.keys(this.uniforms),e=0;e<t.length;e+=1){var i=this.gl.getUniformLocation(this.program,t[e]);this.uniforms[t[e]].location=i}},t.prototype.prepareAttributes=function(){var t=this.geometry,e=this.attributes,i=this.multiplier,n=t.vertices,r=t.normal,o=["x","y","z"];void 0!==n&&this.attributes.push({name:"aPosition",size:3}),void 0!==r&&this.attributes.push({name:"aNormal",size:3});for(var a=0;a<e.length;a+=1){for(var s=e[a],u=new Float32Array(i*n.length*s.size),c=0;c<i;c+=1)for(var l=s.data&&s.data(c,i),f=c*n.length*s.size,d=0;d<n.length;d+=1)for(var v=0;v<s.size;v+=1){var h=this.modifiers[s.name];u[f]=void 0!==h?h(l,d,v,this):"aPosition"===s.name?n[d][o[v]]:"aNormal"===s.name?r[d][o[v]]:l[v],f+=1}this.attributes[a].data=u}},t.prototype.prepareBuffers=function(){this.buffers=[];for(var t=0;t<this.attributes.length;t+=1){var e=this.attributes[t],i=e.data,n=e.name,r=e.size,o=this.gl.createBuffer();this.gl.bindBuffer(34962,o),this.gl.bufferData(34962,i,35044);var a=this.gl.getAttribLocation(this.program,n);this.gl.enableVertexAttribArray(a),this.gl.vertexAttribPointer(a,r,5126,!1,!1,0),this.buffers.push({buffer:o,location:a,size:r})}},t.prototype.render=function(t){var e=this,i=this.uniforms,n=this.multiplier,r=this.gl;r.useProgram(this.program);for(var o=0;o<this.buffers.length;o+=1){var a=e.buffers[o],s=a.location,u=a.buffer,c=a.size;r.enableVertexAttribArray(s),r.bindBuffer(34962,u),r.vertexAttribPointer(s,c,5126,!1,!1,0)}Object.keys(t).forEach(function(e){i[e].value=t[e].value}),Object.keys(i).forEach(function(t){var n=i[t];e.uniformMap[n.type](n.location,n.value)}),r.drawArrays(this.mode,0,n*this.geometry.vertices.length),this.onRender&&this.onRender(this)},t.prototype.destroy=function(){for(var t=0;t<this.buffers.length;t+=1)this.gl.deleteBuffer(this.buffers.buffer);this.gl.deleteProgram(this.program),this.gl=null};var e=function(t){var e=this;void 0===t&&(t={});var i=t.canvas;void 0===i&&(i=document.querySelector("canvas"));var n=t.context;void 0===n&&(n={});var r=t.contextType;void 0===r&&(r="experimental-webgl");var o=t.settings;void 0===o&&(o={});var a=i.getContext(r,Object.assign({alpha:!1,antialias:!1},n));Object.assign(this,{gl:a,canvas:i,uniforms:{},instances:new Map,shouldRender:!0}),Object.assign(this,{devicePixelRatio:1,clearColor:[1,1,1,1],position:{x:0,y:0,z:2}}),Object.assign(this,o),this.uniformMap={float:function(t,e){return a.uniform1f(t,e)},vec2:function(t,e){return a.uniform2fv(t,e)},vec3:function(t,e){return a.uniform3fv(t,e)},vec4:function(t,e){return a.uniform4fv(t,e)},mat2:function(t,e){return a.uniformMatrix2fv(t,!1,e)},mat3:function(t,e){return a.uniformMatrix3fv(t,!1,e)},mat4:function(t,e){return a.uniformMatrix4fv(t,!1,e)}},a.enable(a.DEPTH_TEST),a.depthFunc(a.LEQUAL),!1===a.getContextAttributes().alpha&&(a.clearColor.apply(a,this.clearColor),a.clearDepth(1)),this.onSetup&&this.onSetup(a),window.addEventListener("resize",function(){return e.resize()}),this.resize(),this.render()};e.prototype.resize=function(){var t=this.gl,e=this.canvas,i=this.devicePixelRatio,n=this.position;e.width=e.clientWidth*i,e.height=e.clientHeight*i;var r=t.drawingBufferWidth,o=t.drawingBufferHeight,a=r/o;t.viewport(0,0,r,o);var s=Math.tan(Math.PI/180*22.5),u=[1,0,0,0,0,1,0,0,0,0,1,0,n.x,n.y,(a<1?1:a)*-n.z,1];this.uniforms.uProjectionMatrix={type:"mat4",value:[.5/s,0,0,0,0,a/s*.5,0,0,0,0,-100.001/99.999,-1,0,0,.001/99.999*-200,0]},this.uniforms.uViewMatrix={type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},this.uniforms.uModelMatrix={type:"mat4",value:u}},e.prototype.toggle=function(t){t!==this.shouldRender&&(this.shouldRender=void 0!==t?t:!this.shouldRender,this.shouldRender&&this.render())},e.prototype.render=function(){var t=this;this.gl.clear(16640),this.instances.forEach(function(e){e.render(t.uniforms)}),this.onRender&&this.onRender(this),this.shouldRender&&requestAnimationFrame(function(){return t.render()})},e.prototype.add=function(e,i){void 0===i&&(i={}),i.uniforms=Object.assign(i.uniforms||{},JSON.parse(JSON.stringify(this.uniforms))),Object.assign(i,{gl:this.gl,uniformMap:this.uniformMap});var n=new t(i);return this.instances.set(e,n),n},e.prototype.remove=function(t){var e=this.instances.get(t);void 0!==e&&(e.destroy(),this.instances.delete(t))},e.prototype.destroy=function(){var t=this;this.instances.forEach(function(e,i){e.destroy(),t.instances.delete(i)}),this.toggle(!1)};var i=function(){for(var t=[],e=0;e<9;e+=1)t.push([e%3-1,1-Math.floor(e/3),0]);return t}();function n(t,e){for(var n=[],r=Math.floor(9*Math.random()),o=0;o<9;o+=1)o!==r&&n.push(i[o]);var a,s=[{name:"aPositionStart",data:function(t){return n[t][2]=-5,n[t]},size:3},{name:"aPositionEnd",data:function(t){return n[t][2]=2,n[t]},size:3},{name:"aColor",data:function(){return[100,100,100]},size:3}],u=Math.random();t.add(u,{attributes:s,multiplier:n.length,uniforms:{uProgress:{type:"float",value:0}},vertex:"\n    attribute vec3 aPositionStart;\n    attribute vec3 aPositionEnd;\n    attribute vec3 aPosition;\n    attribute vec3 aColor;\n\n    uniform float uProgress;\n    uniform mat4 uProjectionMatrix;\n    uniform mat4 uModelMatrix;\n    uniform mat4 uViewMatrix;\n\n    varying vec3 vColor;\n\n    vec3 bezier4(vec3 a, vec3 b, vec3 c, vec3 d, float t) {\n      return mix(mix(mix(a, b, t), mix(b, c, t), t), mix(mix(b, c, t), mix(c, d, t), t), t);\n    }\n\n    float easeInOutQuint(float t){\n      return t < 0.5 ? 16.0 * t * t * t * t * t : 1.0 + 16.0 * (--t) * t * t * t * t;\n    }\n\n    void main(){\n      float tProgress = easeInOutQuint(uProgress);\n      vec3 newPosition = mix(aPositionStart, aPositionEnd, tProgress);\n  float scale = tProgress * 2.0 - 1.0;\n          scale = 1.0 - scale * scale;\n  vec3 basePosition = aPosition;\n          basePosition *= scale;\n  vColor = aColor;\n      gl_Position = uProjectionMatrix * uModelMatrix * uViewMatrix * vec4(newPosition + basePosition, 1.0);\n    }\n  ",fragment:"\n    precision mediump float;\n\n    varying vec3 vColor;\n\n    void main(){\n      gl_FragColor = vec4(vColor, 1.0);\n    }\n  ",mode:4,geometry:{vertices:(a=.4,[{x:a,y:a,z:a},{x:a,y:-a,z:a},{x:a,y:a,z:-a},{x:a,y:-a,z:a},{x:a,y:-a,z:-a},{x:a,y:a,z:-a},{x:-a,y:a,z:-a},{x:-a,y:-a,z:-a},{x:-a,y:a,z:a},{x:-a,y:-a,z:-a},{x:-a,y:-a,z:a},{x:-a,y:a,z:a},{x:-a,y:a,z:-a},{x:-a,y:a,z:a},{x:a,y:a,z:-a},{x:-a,y:a,z:a},{x:a,y:a,z:a},{x:a,y:a,z:-a},{x:-a,y:-a,z:a},{x:-a,y:-a,z:-a},{x:a,y:-a,z:a},{x:-a,y:-a,z:-a},{x:a,y:-a,z:-a},{x:a,y:-a,z:a},{x:-a,y:a,z:a},{x:-a,y:-a,z:a},{x:a,y:a,z:a},{x:-a,y:-a,z:a},{x:a,y:-a,z:a},{x:a,y:a,z:a},{x:a,y:a,z:-a},{x:a,y:-a,z:-a},{x:-a,y:a,z:-a},{x:a,y:-a,z:-a},{x:-a,y:-a,z:-a},{x:-a,y:a,z:-a}])},modifiers:{aColor:function(t,e,i,n){return t[i]+-.1*Math.floor(e/(n.geometry.vertices.length/3))}},onRender:function(i){i.uniforms.uProgress.value+=.01,i.uniforms.uProgress.value>=1&&(i.uniforms.uProgress.value=0,t.remove(u),e(r))}})}function r(t){return-t+Math.random()*t*2}function o(t){var e=[{name:"aPositionStart",data:function(){return[r(0),r(0),r(0)]},size:3},{name:"aPositionEnd",data:function(){return[r(15),r(15),r(15)]},size:3},{name:"aColor",data:function(){return[Math.random()+.2,Math.random()+.2,Math.random()+.2,1]},size:3},{name:"aOffset",data:function(t){return[t*((1-.9)/39999)]},size:1}],i="\n    attribute vec3 aPositionStart;\n    attribute vec3 aControlPointOne;\n    attribute vec3 aControlPointTwo;\n    attribute vec3 aPositionEnd;\n    attribute vec3 aPosition;\n    attribute vec3 aColor;\n    attribute float aOffset;\n\n    uniform float uProgress;\n    uniform mat4 uProjectionMatrix;\n    uniform mat4 uModelMatrix;\n    uniform mat4 uViewMatrix;\n\n    varying vec3 vColor;\n\n    float easeInOutQuint(float t){\n      return t < 0.5 ? 16.0 * t * t * t * t * t : 1.0 + 16.0 * (--t) * t * t * t * t;\n    }\n\n    void main(){\n      float tProgress = easeInOutQuint(min(1.0, max(0.0, (uProgress - aOffset)) / 0.9));\n      vec3 newPosition = mix(aPositionStart, aPositionEnd, tProgress);\n      gl_Position = uProjectionMatrix * uModelMatrix * uViewMatrix * vec4(newPosition + aPosition, 1.0);\n      gl_PointSize = "+4..toFixed(1)+";\n      vColor = aColor;\n    }\n  ";t.add("cube",{attributes:e,multiplier:4e4,vertex:i,fragment:"\n    precision mediump float;\n\n    varying vec3 vColor;\n\n    void main(){\n      gl_FragColor = vec4(vColor, 1.0);\n    }\n  ",uniforms:{uProgress:{type:"float",value:0}},onRender:function(t){var e,i,n,r,o,a,s,u=t.uniforms,c=u.uModelMatrix;u.uProgress.value+=.01,e=c.value,i=.0025,n=Math.cos(i),r=Math.sin(i),o=e[0],a=e[4],s=e[8],e[0]=n*e[0]+r*e[2],e[4]=n*e[4]+r*e[6],e[8]=n*e[8]+r*e[10],e[2]=n*e[2]-r*o,e[6]=n*e[6]-r*a,e[10]=n*e[10]-r*s}})}var a=new e({settings:{position:{x:0,y:0,z:4},shouldRender:!0,devicePixelRatio:window.devicePixelRatio},context:{alpha:!0}}),s=[];var u=document.querySelector(".phase-1"),c=document.querySelector(".phase-2"),l=document.querySelector("button"),f=document.querySelector(".phase-3"),d=document.querySelector("input"),v=document.querySelector(".phase-4"),h=document.querySelectorAll("button")[1],m=document.querySelector(".rainbow-overlay"),g=document.querySelector(".phase-5"),y=!0;window.addEventListener("offline",function(){y=!1,u.classList.remove("visible"),c.classList.add("visible")}),setTimeout(function(){y&&(u.classList.remove("visible"),c.classList.add("visible"))},5e3),l.addEventListener("click",function(){c.style.transitionDelay="0s",c.classList.remove("visible"),setTimeout(function(){!function t(e){n(a,function(i){s.push(i+1),s.length<4?t(e):e()})}(function(){f.classList.add("visible"),d.focus()})},600)}),d.addEventListener("input",function(t){if(s.length===t.currentTarget.value.length){f.classList.remove("visible"),v.classList.add("visible");var e=document.querySelector(".phase-4 p");e.textContent=t.currentTarget.value===s.join("")?"That's right! "+e.textContent:"Almost correct! "+e.textContent}});var p=0,x=10;function b(t){var e=document.querySelectorAll(".controls td");0!==p&&e[p-1].classList.remove("active"),0!==(p=t)&&e[t-1].classList.add("active")}h.addEventListener("click",function(){v.classList.remove("visible");var t=document.querySelector(".controls");t.classList.add("visible");for(var e=document.querySelectorAll(".controls td"),i=function(t){e[t].addEventListener("click",function(){b(t+1)})},r=0;r<e.length;r+=1)i(r);window.addEventListener("keydown",function(t){var e=t.keyCode<49||t.keyCode>57?0:t.keyCode-48;0!==e&&b(e)}),function t(e){n(a,function(i){i+1===p?x-=1:x<=9&&(x+=1),m.style.transform="scaleY("+x/10+")",0===x?setTimeout(e,400):t(e),b(0)})}(function(){t.classList.remove("visible"),o(a),g.classList.add("visible")})})});
//# sourceMappingURL=bundle.umd.js.map
