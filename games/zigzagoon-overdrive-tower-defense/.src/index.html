<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><title>Zigzagoon Overdrive - RndD's game for js13k 2021</title><style>body{margin:0;text-align:center;background:#000}body,canvas{touch-action:none;user-select:none}</style><canvas id=c></canvas><script>(()=>{var e,t,o=Object.create,n=Object.defineProperty,i=Object.getPrototypeOf,s=Object.prototype.hasOwnProperty,r=Object.getOwnPropertyNames,l=Object.getOwnPropertyDescriptor,a=e=>{return((e,t,o)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let i of r(t))s.call(e,i)||"default"===i||n(e,i,{get:()=>t[i],enumerable:!(o=l(t,i))||o.enumerable});return e})((t=n(null!=e?o(i(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0}),n(t,"__esModule",{value:!0})),e);var t},d=(e=(e,t)=>{t.exports=(e,t,o)=>o>t?t>e?t:e>o?o:e:o>e?o:e>t?t:e},()=>(t||e(t={exports:{}},t),t.exports));function m(e,t,o){const n=e.length;if(t>=n||0>=o||0>t)return;const i=n-(o=t+o>n?n-t:o);for(let n=t;i>n;++n)e[n]=e[n+o];e.length=i}var y="undefined"==typeof performance?()=>Date.now():()=>performance.now();function p(e,t,o=[]){const n=e.split(",");for(const e of n){if(o.includes(e))return!1;if(e.startsWith("!")&&t[e.slice(1)])return!1;if(!e.startsWith("!")&&!t[e])return!1}return!0}function c(e){for(const t in e.stats.filterInvocationCount)e.stats.filterInvocationCount[t]=0;for(const t of e.stats.systems){t.timeElapsed=0;for(const e in t.filters)t.filters[e]=0}e.stats.currentSystem=0}function f(e,t,o){t[o]&&(e.stats.componentCount[o]-=1),delete t[o];for(const n in e.filters){const i=e.filters[n];if(p(n,t)&&!i.includes(t))i.push(t);else if(u(n,o)){const e=i.indexOf(t);0>e||m(i,e,1)}}}function u(e,t){return e===t||e.startsWith(t+",")||e.endsWith(","+t)||e.includes(`,${t},`)}var x={createWorld(){const e={entities:[],filters:{},systems:[],listeners:{added:{},removed:{}},removals:{entities:[],components:[]},stats:{entityCount:0,componentCount:{},filterInvocationCount:{},systems:[],currentSystem:0,lastSendTime:0}};return"undefined"!=typeof window&&window.__MREINSTEIN_ECS_DEVTOOLS&&window.postMessage({id:"mreinstein/ecs-source",method:"worldCreated",data:e.stats},"*"),e},createEntity(e){const t={};return e.entities.push(t),e.stats.entityCount++,t},addComponentToEntity(e,t,o,n={}){if(!t[o]){Number.isInteger(e.stats.componentCount[o])||(e.stats.componentCount[o]=0),t[o]||(e.stats.componentCount[o]+=1),t[o]=n;for(const o in e.filters){const n=p(o,t),i=e.filters[o],s=i.indexOf(t);0>s?n&&i.push(t):n||m(i,s,1)}for(const n in e.listeners.added){const i=p(n,t)&&!p(n,t,[o]),s=e.listeners.added[n];i&&!s.includes(t)&&s.push(t)}}},removeComponentFromEntity(e,t,o,n=!0){if(t[o]){for(const n in e.listeners.removed)p(n,t)&&!p(n,t,[o])&&(e.listeners.removed[n].includes(t)||e.listeners.removed[n].push(t));if(n){const n=`${e.entities.indexOf(t)}__@@ECS@@__${o}`;e.removals.components.includes(n)||e.removals.components.push(n)}else f(e,t,o)}},getEntities(e,t,o){const n=t.join(",");e.filters[n]||(e.filters[n]=e.entities.filter((e=>p(n,e)))),e.stats.filterInvocationCount[n]||(e.stats.filterInvocationCount[n]=0),e.stats.filterInvocationCount[n]+=1;const i=e.stats.currentSystem;if(e.stats.systems[i]&&(e.stats.systems[i].filters[n]||(e.stats.systems[i].filters[n]=0),e.stats.systems[i].filters[n]+=e.filters[n].length),"added"===o){if(!e.listeners.added[n]){e.listeners.added[n]=[];for(const t of e.entities)p(n,t)&&e.listeners.added[n].push(t)}return e.listeners.added[n]}return"removed"===o?(e.listeners.removed[n]||(e.listeners.removed[n]=[]),e.listeners.removed[n]):e.filters[n]},removeEntity(e,t){const o=e.entities.indexOf(t);if(o>=0){for(const o in e.listeners.removed){const n=p(o,t),i=e.listeners.removed[o];n&&!i.includes(t)&&i.push(t)}e.removals.entities.includes(o)||(((e,t)=>{for(let o=0;e.length>o;o++)if(t>=e[o])return void e.splice(o,0,t);e.push(t)})(e.removals.entities,o),e.stats.entityCount--)}},addSystem(e,t){const o=t(e);e.stats.systems.push({name:t.name||"anonymousSystem",timeElapsed:0,filters:{}}),o.onFixedUpdate||(o.onFixedUpdate=()=>{}),o.onPreUpdate||(o.onPreUpdate=()=>{}),o.onUpdate||(o.onUpdate=()=>{}),o.onPostUpdate||(o.onPostUpdate=()=>{}),e.systems.push(o)},fixedUpdate(e,t){for(let o=0;e.systems.length>o;o++){e.stats.currentSystem=o;const n=e.systems[o],i=y();n.onFixedUpdate(t),e.stats.systems[o].timeElapsed+=y()-i}},update(e,t){for(let o=0;e.systems.length>o;o++){e.stats.currentSystem=o;const n=e.systems[o],i=y();n.onUpdate(t),e.stats.systems[o].timeElapsed+=y()-i}},preUpdate(e,t){for(let o=0;e.systems.length>o;o++){e.stats.currentSystem=o;const n=e.systems[o],i=y();n.onPreUpdate(t),e.stats.systems[o].timeElapsed+=y()-i}},postUpdate(e,t){for(let o=0;e.systems.length>o;o++){e.stats.currentSystem=o;const n=e.systems[o],i=y();n.onPostUpdate(t),e.stats.systems[o].timeElapsed+=y()-i}},cleanup(e){(e=>{for(const t in e.listeners.added)e.listeners.added[t].length=0;for(const t in e.listeners.removed)e.listeners.removed[t].length=0})(e);for(let t=0;e.removals.components.length>t;t++){const[o,n]=e.removals.components[t].split("__@@ECS@@__");f(e,e.entities[o],n)}e.removals.components.length=0;for(const t of e.removals.entities){const o=e.entities[t];for(const t in o)o[t]&&(e.stats.componentCount[t]-=1);m(e.entities,t,1);for(const t in e.filters){const n=e.filters[t],i=n.indexOf(o);0>i||m(n,i,1)}}e.removals.entities.length=0,"undefined"!=typeof window&&window.__MREINSTEIN_ECS_DEVTOOLS&&performance.now()-e.stats.lastSendTime>250&&(e.stats.lastSendTime=performance.now(),window.postMessage({id:"mreinstein/ecs-source",method:"refreshData",data:e.stats},"*")),setTimeout(c,0,e)}},h=a(d()),g=896,b=504,v=32,T="#000",E="#1D2B53",w="#AB5236",S="#C2C3C7",C="#FFF1E8",k="#FF004D",z="#FFA300",P="#FFEC27",M="#29ADFF",$="#FFCCAA",O={1:450,gun:450,4:300,rocket:300,5:65,6:500,sgun:500},U={gun:1,rocket:30,sgun:500},I={gun:300,rocket:2e3,sgun:100},D={gun:5,rocket:1,sgun:10},_={sgun:{w:2,h:4},gun:{w:1,h:3},rocket:{w:4,h:5}},F={"0.0":1,"1.0":1,"6.0":1,"7.0":1,"8.0":1,"13.0":1,"14.0":1},A={"2.0":1,"3.0":1,"4.0":1,"5.0":1,"9.0":1,"10.0":1,"11.0":1,"12.0":1,2.1:1,3.1:1,4.1:1,5.1:1,9.1:1,10.1:1,11.1:1,12.1:1,2.2:1,3.2:1,4.2:1,5.2:1,9.2:1,10.2:1,11.2:1,12.2:1},W=40,j=[{name:"platform",topText:"platform",bottomText:" 30>",color:C,price:30,hp:2,bottomTextColor:M,x:25,y:30,w:W,h:W},{name:"gun",topText:"   gun",bottomText:" 20>",price:20,hp:3,color:M,bottomTextColor:M,x:90,y:30,w:W,h:W},{name:"generator",topText:"generator",bottomText:" 50>",price:50,hp:1,color:$,bottomTextColor:M,x:155,y:30,w:W,h:W},{name:"emp",topText:"    EMP",bottomText:" 99>",price:99,color:T,bottomTextColor:M,x:230,y:20,w:50,h:50},{name:"rocket",topText:"  rocket",bottomText:" 40>",price:40,hp:5,color:z,bottomTextColor:M,x:310,y:30,w:W,h:W},{name:"shield",topText:"  shield",bottomText:" 35>",price:35,hp:2,color:E,bottomTextColor:M,x:375,y:30,w:W,h:W},{name:"sgun",topText:"score gun",bottomText:" 100",price:100,hp:6,color:P,bottomTextColor:P,x:440,y:30,w:W,h:W}];function G(e,t,o,n){const i={entity1MaxX:e.x+t.w,entity1MaxY:e.y+t.h,entity2MaxX:o.x+n.w,entity2MaxY:o.y+n.h};return i.collide=i.entity2MaxX>e.x&&i.entity1MaxX>o.x&&i.entity2MaxY>e.y&&i.entity1MaxY>o.y,i}function N(e,t,o){const{entity1MaxX:n,entity1MaxY:i,entity2MaxX:s,entity2MaxY:r}=o,l=n-t.position.x,a=i-t.position.y,d=s-e.position.x,m=r-e.position.y;e.moveable.dx>0&&e.moveable.dy>0?a>l?e.position.x-=l:e.position.y-=a:e.moveable.dx>0&&0>e.moveable.dy?m>l?e.position.x-=l:e.position.y+=m:e.moveable.dx>0?e.position.x-=l:0>e.moveable.dx&&e.moveable.dy>0?a>d?e.position.x+=d:e.position.y-=a:0>e.moveable.dx&&0>e.moveable.dy?m>d?e.position.x+=d:e.position.y+=m:0>e.moveable.dx?e.position.x+=d:e.moveable.dy>0?e.position.y-=a:0>e.moveable.dy&&(e.position.y+=m)}function Y(e,{x:t,y:o,w:n,h:i}){return e.x>t&&t+n>e.x&&e.y>o&&o+i>e.y}var H=Math.random;function X(e=0,t=1){return Math.floor(((e=0,t=1)=>H()*(t+1-e)+e)(e,t))}function L(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function R(e,t){var o=parseInt(e.slice(1,3),16),n=parseInt(e.slice(3,5),16),i=parseInt(e.slice(5,7),16);return null!=t?"rgba("+o+", "+n+", "+i+", "+t+")":"rgb("+o+", "+n+", "+i+")"}function q(e,t,o){return Array(t-(e+="").length+1).join(o)+e}function B(){return Math.random().toString(36).substr(2,9)}function J(e){for(let t=e.length-1;t>0;t--){const o=Math.floor(Math.random()*(t+1));[e[t],e[o]]=[e[o],e[t]]}}function V(e,{dx:t,dy:o,x:n,y:i,size:s,color:r,lifeTime:l,circle:a}){const d=x.createEntity(e);x.addComponentToEntity(e,d,"position",{x:n,y:i}),x.addComponentToEntity(e,d,"particle",{size:s,color:r,lifeTime:l,circle:a}),x.addComponentToEntity(e,d,"moveable",{dx:t,dy:o}),x.addComponentToEntity(e,d,"renderable"),x.addComponentToEntity(e,d,"data",{creationTime:pe(e).lifeTime})}function K(e,t,o,{dx:n,dy:i,x:s,y:r}){if(n*=-.2,i*=-.2,o)return V(e,{dx:n+.1,dy:i,color:t,x:s,y:r,size:3,lifeTime:1e3}),V(e,{dx:n+.11,dy:i,color:t,x:s,y:r,size:2,lifeTime:1e3}),V(e,{dx:n-.11,dy:i,color:t,x:s,y:r,size:2,lifeTime:800}),V(e,{dx:n,dy:i-.11,color:t,x:s,y:r,size:2,lifeTime:900}),V(e,{dx:n,dy:i,color:t,x:s,y:r,size:2,lifeTime:800}),V(e,{dx:n,dy:i+.1,color:t,x:s,y:r,size:2,lifeTime:1400}),void V(e,{dx:n+.12,dy:i+.1,color:t,x:s,y:r,size:3,lifeTime:600});V(e,{dx:n+.1,dy:i+.1,color:t,x:s,y:r,size:4,lifeTime:400}),V(e,{dx:n+.12,dy:i+.11,color:t,x:s,y:r,size:5,lifeTime:600}),V(e,{dx:n+.15,dy:i+.1,color:t,x:s,y:r,size:5,lifeTime:300})}function Q(e,t,o,{x:n,y:i}){V(e,o?{dx:0,dy:0,color:t,x:n,y:i,size:8,lifeTime:1e3,circle:!0}:{dx:0,dy:0,color:t,x:n,y:i,size:300,lifeTime:3e3,circle:!0})}function Z(e,t,o){if(o>=!t.energy){t.energy-=o;for(const t of x.getEntities(e,["enemy"]))t.enemy.hp=0;Q(e,M,0,{x:252,y:466})}}function ee(e,t,o,n){const[i,s]=o.split("."),r=+i,l=+s;if(0===t){const{price:i}=j[t];i>n.energy||(n.platforms[o]=ae(e,r,l,!1),n.energy=n.energy-i)}if([1,2,4,5].includes(t)){const{price:i}=j[t];i>n.energy||(n.platforms[o]=de(e,r,l,t,!1),n.energy=n.energy-i)}if(6===t){const{price:i}=j[t];i>n.score||(n.platforms[o]=de(e,r,l,t,!1),n.score=n.score-i)}}function te(e,t){t.mode={type:"building",index:e,avaiblePoints:null}}function oe(e){e.mode=null}function ne(e){const t=O[e];if(!t)throw Error("no range for index "+e);return t}function ie(e){const t=U[e];if(!t)throw Error("no dmg for index "+e);return t}function se(e){const t=I[e];if(!t)throw Error("no reload for index "+e);return t}function re(e){const t=D[e];if(!t)throw Error("no speed for index "+e);return t}function le(e,t,o,{type:n,dmg:i,w:s,h:r,speed:l}){const{x:a,y:d}=t,m=L(t,o),y=(o.x-a)/m*l,p=(o.y-d)/m*l,c=x.createEntity(e);x.addComponentToEntity(e,c,"position",{x:a,y:d}),x.addComponentToEntity(e,c,"renderable"),x.addComponentToEntity(e,c,"data",{creationTime:pe(e).lifeTime}),x.addComponentToEntity(e,c,"moveable",{dx:y,dy:p}),x.addComponentToEntity(e,c,"bullet",{dmg:i,type:n,from:t}),x.addComponentToEntity(e,c,"body",{w:s,h:r})}function ae(e,t,o,n){const i=x.createEntity(e),s=B();return x.addComponentToEntity(e,i,"position",{x:11+32*t,y:730-32*o}),x.addComponentToEntity(e,i,"renderable"),x.addComponentToEntity(e,i,"data",{creationTime:n?0:pe(e).lifeTime}),x.addComponentToEntity(e,i,"platform",{hp:5,id:s,xy:`${t}.${o}`}),x.addComponentToEntity(e,i,"body",{w:32,h:32}),s}function de(e,t,o,n,i){const s=x.createEntity(e),r=B(),l=11+32*t,a=730-32*o;return x.addComponentToEntity(e,s,"position",{x:l,y:a}),x.addComponentToEntity(e,s,"renderable"),x.addComponentToEntity(e,s,"data",{creationTime:i?0:pe(e).lifeTime}),x.addComponentToEntity(e,s,"body",{w:32,h:32}),x.addComponentToEntity(e,s,"unit",{hp:j[n].hp,fullHp:j[n].hp,type:j[n].name,nextShot:null,xy:`${t}.${o}`}),5==n&&x.addComponentToEntity(e,s,"shield",{hp:10,x:l+16,y:a+16,fullHp:10,range:65,animations:{takeDmgUntil:null},nextTick:null}),r}function me(e){return{"0.0":ae(e,0,0,1),"1.0":ae(e,1,0,1),"6.0":ae(e,6,0,1),"7.0":ae(e,7,0,1),7.1:ae(e,7,1,1),"8.0":ae(e,8,0,1),"13.0":ae(e,13,0,1),"14.0":ae(e,14,0,1)}}function ye(e){return{7.1:de(e,7,1,1,1),"7.0":de(e,7,0,2,1)}}function pe(e){return x.getEntities(e,["gameData"])[0].gameData}a(d());var ce={A:[[,1],[1,,1],[1,,1],[1,1,1],[1,,1]],B:[[1,1],[1,,1],[1,1,1],[1,,1],[1,1]],C:[[1,1,1],[1],[1],[1],[1,1,1]],D:[[1,1],[1,,1],[1,,1],[1,,1],[1,1]],E:[[1,1,1],[1],[1,1,1],[1],[1,1,1]],F:[[1,1,1],[1],[1,1],[1],[1]],G:[[,1,1],[1],[1,,1,1],[1,,,1],[,1,1]],H:[[1,,1],[1,,1],[1,1,1],[1,,1],[1,,1]],I:[[1,1,1],[,1],[,1],[,1],[1,1,1]],J:[[1,1,1],[,,1],[,,1],[1,,1],[1,1,1]],K:[[1,,,1],[1,,1],[1,1],[1,,1],[1,,,1]],L:[[1],[1],[1],[1],[1,1,1]],M:[[1,1,1,1,1],[1,,1,,1],[1,,1,,1],[1,,,,1],[1,,,,1]],N:[[1,,,1],[1,1,,1],[1,,1,1],[1,,,1],[1,,,1]],O:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],P:[[1,1,1],[1,,1],[1,1,1],[1],[1]],Q:[[0,1,1],[1,,,1],[1,,,1],[1,,1,1],[1,1,1,1]],R:[[1,1],[1,,1],[1,,1],[1,1],[1,,1]],S:[[1,1,1],[1],[1,1,1],[,,1],[1,1,1]],T:[[1,1,1],[,1],[,1],[,1],[,1]],U:[[1,,1],[1,,1],[1,,1],[1,,1],[1,1,1]],V:[[1,,,,1],[1,,,,1],[,1,,1],[,1,,1],[,,1]],W:[[1,,,,1],[1,,,,1],[1,,,,1],[1,,1,,1],[1,1,1,1,1]],X:[[1,,,,1],[,1,,1],[,,1],[,1,,1],[1,,,,1]],Y:[[1,,1],[1,,1],[,1],[,1],[,1]],Z:[[1,1,1,1,1],[,,,1],[,,1],[,1],[1,1,1,1,1]],0:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],1:[[,1],[,1],[,1],[,1],[,1]],2:[[1,1,1],[0,0,1],[1,1,1],[1,0,0],[1,1,1]],3:[[1,1,1],[0,0,1],[1,1,1],[0,0,1],[1,1,1]],4:[[1,0,1],[1,0,1],[1,1,1],[0,0,1],[0,0,1]],5:[[1,1,1],[1,0,0],[1,1,1],[0,0,1],[1,1,1]],6:[[1,1,1],[1,0,0],[1,1,1],[1,0,1],[1,1,1]],7:[[1,1,1],[0,0,1],[0,0,1],[0,0,1],[0,0,1]],8:[[1,1,1],[1,0,1],[1,1,1],[1,0,1],[1,1,1]],9:[[1,1,1],[1,0,1],[1,1,1],[0,0,1],[1,1,1]]," ":[[,,],[,,],[,,],[,,],[,,]],"/":[[,,],[,,1],[,1],[,1],[1,,]],">":[[,1],[1,,],[,1],[,,1],[,1]]};function fe(e,t,o,n,i,s){var r=[];t=t.toUpperCase();for(var l=0;t.length>l;l++){var a=ce[t.charAt(l)];a&&r.push(a)}e.fillStyle=s;var d=o;for(l=0;r.length>l;l++){a=r[l];for(var m=n,y=0,p=0;a.length>p;p++){for(var c=a[p],f=0;c.length>f;f++)c[f]&&e.fillRect(d+f*i,m,i,i);y=Math.max(y,c.length*i),m+=i}d+=i+y}}function ue(e,t,o,n,i,{isSelectable:s,isSelected:r,topText:l,bottomText:a,bottomTextColor:d,color:m}){e.beginPath(),e.lineWidth=2,e.strokeStyle=s?r?P:C:k,e.lineJoin="round",e.rect(t,o,n,i),e.fillStyle=m,e.fill(),e.stroke(),l&&fe(e,l,t-5,o-15,1.5,s?C:S),a&&fe(e,a,t,o+i+5,3,d)}var xe=document.querySelector("canvas"),he=xe.height=window.innerHeight,ge=xe.width=he/16*9,be=xe.getContext("2d"),ve=xe.cloneNode(),Te=ve.getContext("2d"),Ee=xe.cloneNode(),we=Ee.getContext("2d");Ee.width=b,Ee.height=g;var Se=xe.cloneNode(),Ce=Se.getContext("2d"),ke=xe.cloneNode(),ze=ke.getContext("2d");function Pe(e){let t;return"gun"===e.type&&(t=M),"sgun"===e.type&&(t=P),"rocket"===e.type&&(t=w),t}function Me(e,t,o){const n=Pe(o);var i=Te.createLinearGradient(e.x,e.y,t.x,t.y);i.addColorStop(0,R(n,.05)),i.addColorStop(1,R(n,.2)),Te.strokeStyle=i,Te.beginPath(),Te.moveTo(e.x,e.y),Te.lineTo(t.x,t.y),Te.stroke()}function $e(e,t,o,n){Te.beginPath(),Te.rect(e.x,e.y,t,o),n.bullet&&("rocket"===n.bullet.type&&(Te.fillStyle=z),"gun"===n.bullet.type&&(Te.fillStyle=M),"sgun"===n.bullet.type&&(Te.fillStyle=P)),n.unit&&("shield"===n.unit.type&&(Te.fillStyle=E),"gun"===n.unit.type&&(Te.fillStyle=M),"generator"===n.unit.type&&(Te.fillStyle=$),"rocket"===n.unit.type&&(Te.fillStyle=z),"sgun"===n.unit.type&&(Te.fillStyle=P)),Te.fill(),Te.closePath()}function Oe(e,t,o,n,i){Te.beginPath();const{x:s,y:r}=t;if(Te.rect(s,r,o,n),Te.lineWidth=1,Te.strokeStyle=k,Te.stroke(),Te.closePath(),i.enemy.tookDmg?.until>e){const{dx:e,dy:t}=i.enemy.tookDmg;Te.beginPath();var l=Te.createLinearGradient(s*e*-1-n,r*t*-1-o,s*e,r*t);l.addColorStop(1,R(C,0)),l.addColorStop(0,R(C,1)),Te.rect(s,r,o,n),Te.lineWidth=1,Te.strokeStyle=l,Te.stroke(),Te.closePath()}}function Ue(e){return!(e.nextWaveTime>=e.lifeTime||(e.wave++,!De[e.wave])||(e.nextWaveTime=e.lifeTime+De[e.wave].time,0))}ke.width=b,ke.height=100,Se.width=b,Se.height=30;var Ie={tiny:{size:10,hp:1,score:1,speed:.5,movementType:"linear"},"small-slow":{size:16,hp:2,score:1,speed:.5,movementType:"linear"},small:{size:16,hp:2,score:1,speed:2,movementType:"linear"},"medium-slow":{size:24,hp:3,score:3,speed:.5,movementType:"linear"},medium:{size:24,hp:5,score:5,speed:2,movementType:"linear"},"medium-slow-zig":{size:24,hp:6,score:6,speed:1,movementType:"zigzag"},"medium-zig":{size:24,hp:3,score:7,speed:2,movementType:"zigzag"},"big-slow":{size:32,hp:10,score:5,speed:.5,movementType:"linear"},big:{size:32,hp:10,score:10,speed:2,movementType:"linear"},"big-zig":{size:32,hp:3,score:15,speed:2,movementType:"zigzag"},huge:{size:64,hp:30,score:20,speed:2,movementType:"linear"},boss:{size:120,hp:55,score:50,speed:2.5,movementType:"linear"},boss2:{size:250,hp:100,score:100,speed:3,movementType:"zigzag"}},De=[{time:1e3,enemies:[]},{time:2e4,enemies:[...Array(20).fill("tiny"),...[,,,,,,,,,,].fill("small-slow"),...[,,,,,].fill("medium-slow"),...[,,,].fill("medium-slow-zig")]},{time:3e4,enemies:[...[,,,,,,,,,,].fill("tiny"),...[,,,,,,,,,,].fill("small"),...[,,,,,].fill("medium-slow"),...[,,,,,].fill("medium"),...[,,,].fill("medium-zig")]},{time:3e4,enemies:[...Array(30).fill("small"),...Array(20).fill("medium-slow"),...[,,,,,,,,,,].fill("medium"),...[,,,,,,,,,,].fill("medium-zig")]},{time:4e4,enemies:[...[,,,,].fill("big"),...[,].fill("big-zig"),...[,].fill("huge"),...Array(20).fill("medium"),...[,,,,,,,,,,].fill("medium-zig")]},{time:4e4,enemies:[...Array(30).fill("small"),...[,,,,].fill("big-zig"),...[,,].fill("huge"),...[,].fill("boss"),...[,,,,,,,,,,].fill("medium-zig")]},{time:5e4,enemies:[...Array(100).fill("small"),...[,,,,].fill("big-zig"),...[,,,,].fill("huge"),...[,,].fill("boss"),...[,,].fill("boss2"),...[,,,,,,,,,,].fill("medium-zig")]}];function _e(e,t,o,n){const{x:i,y:s}=t;if(!Ie[n])throw Error("there is no shuch type "+n);const{size:r,hp:l,score:a,speed:d,movementType:m}=Ie[n],y=x.createEntity(e);x.addComponentToEntity(e,y,"position",{x:i,y:s}),x.addComponentToEntity(e,y,"renderable"),x.addComponentToEntity(e,y,"data",{creationTime:pe(e).lifeTime}),x.addComponentToEntity(e,y,"moveable",{dx:0,dy:0}),x.addComponentToEntity(e,y,"enemy",{hp:l,fullHp:l,level:o,movementType:m,score:a,speed:d}),x.addComponentToEntity(e,y,"body",{w:r,h:r})}function Fe(e){return{onUpdate(t){const o=pe(e),{lifeTime:n}=o;if(o.paused)return;const i=x.getEntities(e,["shield"]).filter((e=>e.shield.hp>0)),s=x.getEntities(e,["unit"]),r=x.getEntities(e,["platform"]),l=x.getEntities(e,["enemy","moveable"]).filter((t=>{let n=!1;if(t.position.y>756)return x.removeEntity(e,t),o.hp-=t.enemy.fullHp,n=!0,K(e,k,0,{dx:2*t.moveable.dx,dy:2*t.moveable.dy,x:t.position.x,y:t.position.y-30}),K(e,k,0,{dx:2*t.moveable.dx,dy:2*t.moveable.dy,x:t.position.x+5,y:t.position.y-30}),!1;if(!n)for(const o of i)if(L(o.shield,{x:t.position.x+t.body.w,y:t.position.y+t.body.h})<o.shield.range){const i=t.enemy.hp-o.shield.hp;o.shield.hp-=t.enemy.hp,t.enemy.hp=i,K(e,M,0,{dx:2*t.moveable.dx,dy:2*t.moveable.dy,x:t.position.x+t.body.w,y:t.position.y+t.body.h}),n=!0}if(!n)for(const o of s)if(G(o.position,o.body,t.position,t.body).collide){const i=t.enemy.hp-o.unit.hp;o.unit.hp-=t.enemy.hp,t.enemy.hp=i,K(e,C,0,{dx:2*t.moveable.dx,dy:2*t.moveable.dy,x:t.position.x+t.body.w,y:t.position.y+t.body.h}),n=!0}if(!n)for(const o of r)if(G(o.position,o.body,t.position,t.body).collide){const i=t.enemy.hp-o.platform.hp;o.platform.hp-=t.enemy.hp,t.enemy.hp=i,K(e,C,0,{dx:2*t.moveable.dx,dy:2*t.moveable.dy,x:t.position.x+t.body.w,y:t.position.y+t.body.h}),n=!0}return t.enemy.hp>0||(x.removeEntity(e,t),Q(e,k,1,{x:t.position.x+t.body.w,y:t.position.y+t.body.h}),o.score+=t.enemy.score,!1)}));for(const e of l){const o=20*e.enemy.speed;"linear"===e.enemy.movementType&&(e.moveable.dy=t/1e3*o),"zigzag"===e.enemy.movementType&&(e.moveable.dy=t/1e3*o,e.moveable.dx=1*Math.cos((n-e.data.creationTime)/1e3))}for(let e=0;l.length>e;e++)for(let t=e+1;l.length>t;t++){const o=G(l[e].position,l[e].body,l[t].position,l[t].body);o.collide&&N(l[e],l[t],o)}}}}var Ae=document.querySelector("canvas");function We(e){var t=e.target.getBoundingClientRect();return{x:b/Ae.width*((e.pageX||e.changedTouches[0].pageX)-t.left),y:g/Ae.height*((e.pageY||e.changedTouches[0].pageY)-t.top)}}var je={x:0,y:0},Ge=null;Ae.ontouchmove=Ae.onpointermove=e=>{e.preventDefault(),je=We(e)},Ae.ontouchend=Ae.onpointerup=e=>{Ge=We(e)};var Ne=x.createWorld(),Ye=x.createEntity(Ne);x.addComponentToEntity(Ne,Ye,"position",{x:252,y:-10}),x.addComponentToEntity(Ne,Ye,"spawn",{}),(e=>{const t=x.createEntity(e);x.addComponentToEntity(e,t,"gameData",{wave:0,lifeTime:0,score:50,hp:150,energy:40,mode:null,nextWaveTime:0,gameOver:!1,won:!1,paused:!1,platforms:me(e),units:ye(e)}),x.addComponentToEntity(e,t,"input",{pointer:{x:0,y:0},clicked:null})})(Ne),x.addSystem(Ne,(e=>({onUpdate(t){const o=x.getEntities(e,["gameData"])[0];o.gameData.lifeTime+=t;const{gameData:n}=o;if(666===n.wave&&(n.won=!0,n.paused=!0),1>n.hp&&(n.gameOver=!0,n.paused=!0),!n.paused){if(o.input.clicked){o.input.clicked=null;const{pointer:t}=o.input;if("bottom"===t.ctxTarget){oe(n);for(const[o,i]of j.entries())if(Y(t,i)){if(3==o){Z(e,n,i.price);break}te(o,n);break}}if("game"===t.ctxTarget&&"building"===n.mode?.type){for(const[o,i]of Object.entries(n.mode.avaiblePoints))if(Y(t,i)){ee(e,n.mode.index,o,n);break}oe(n)}}"building"===o.gameData.mode?.type&&((e,t)=>{const o={},{platforms:n,units:i}=t;if(0===t.mode.index){for(const[e,t]of Object.entries(n)){let[t,i]=e.split(".");t=+t,i=+i,15>t-1&&t-1>0&&!n[`${t-1}.${i}`]&&!A[`${t-1}.${i}`]&&(o[`${t-1}.${i}`]=1),15>t+1&&t+1>0&&!n[`${t+1}.${i}`]&&!A[`${t+1}.${i}`]&&(o[`${t+1}.${i}`]=1),15>i+1&&i+1>0&&!n[`${t}.${i+1}`]&&!A[`${t}.${i+1}`]&&(o[`${t}.${i+1}`]=1),15>i-1&&i-1>0&&!n[`${t}.${i-1}`]&&!A[`${t}.${i-1}`]&&(o[`${t}.${i-1}`]=1)}for(const[e]of Object.entries(F))n[e]||(o[e]=1)}else for(const[e]of Object.entries(n))i[e]||(o[e]=1);for(const[e]of Object.entries(o)){let[t,n]=e.split(".");xGrid=+t,yGrid=+n,t=13+32*xGrid,n=730-32*yGrid+2,o[e]={x:t,y:n,w:28,h:28}}t.mode.avaiblePoints=o})(0,n)}}}))),x.addSystem(Ne,(e=>({onUpdate(){let t,{x:o,y:n}=je;const i=x.getEntities(e,["input"])[0];n>30?796>n?(t="game",n-=30):(t="bottom",n=n-g+100):t="top",i.input.pointer={x:o,y:n,ctxTarget:t},Ge&&(i.input.clicked={x:o,y:n,ctxTarget:t},Ge=null)}}))),x.addSystem(Ne,(e=>({onUpdate(){const t=pe(e);if(!t.paused)for(const o of x.getEntities(e,["spawn"]))if(Ue(t)&&De[t.wave]){J(De[t.wave].enemies);for(const n of De[t.wave].enemies){let{x:i,y:s}=o.position;1==t.wave&&(s=0),i+=X(-168,168),s-=X(-100,100),_e(e,{x:i,y:s},o.spawn.level,n)}}}}))),x.addSystem(Ne,(e=>({onUpdate(){const t=pe(e),o=t.lifeTime,n=x.getEntities(e,["enemy"]);if(0!==n.length&&!t.paused)for(const i of x.getEntities(e,["unit"])){const{position:s}=i;let r,l,a=1/0;if(["gun","sgun","rocket"].includes(i.unit.type)&&(!i.unit.nextShot||o>=i.unit.nextShot))for(const e of n){const t=L(s,e.position);a>t&&(a=t,r=e.position,t>ne(i.unit.type)||(l=r))}if(r)if(l){const{w:n,h:s}=_[i.unit.type],a=ie(i.unit.type),d=se(i.unit.type),m=re(i.unit.type),y=i.unit.type;let p=!1;"sgun"==y?t.score>5&&(p=!0,t.score=t.score-5):p=!0,p&&(le(e,{x:i.position.x+i.body.w/2,y:i.position.y+i.body.h/2},r,{dmg:a,type:y,w:n,h:s,speed:m}),i.unit.nextShot=o+d,i.unit.target=l)}else i.unit.target=r}}}))),x.addSystem(Ne,(e=>({onUpdate(){const t=pe(e),o=t.lifeTime;if(!t.paused)for(const n of x.getEntities(e,["unit"]))"generator"===n.unit.type&&(n.unit.nextShot&&n.unit.nextShot>o||(n.unit.nextShot=o+500,100>t.energy&&(t.energy+=1,t.energy>100&&(t.energy=100))))}}))),x.addSystem(Ne,(e=>({onUpdate(){const t=pe(e),o=t.lifeTime;if(!t.paused)for(const n of x.getEntities(e,["shield"]))n.shield.fullHp>n.shield.hp&&(n.shield.nextTick&&n.shield.nextTick>o||t.energy>2&&(n.shield.nextTick=o+2e3,t.energy-=2,n.shield.hp++))}}))),x.addSystem(Ne,(e=>({onUpdate(){const t=pe(e);if(!t.paused){for(const o of x.getEntities(e,["platform"]))o.platform.hp>0||(delete t.platforms[o.platform.xy],x.removeEntity(e,o));for(const o of x.getEntities(e,["unit"]))o.unit.hp>0||(Q(e,S,1,{x:o.position.x+o.body.w,y:o.position.y+o.body.h}),delete t.units[o.unit.xy],x.removeEntity(e,o))}}}))),x.addSystem(Ne,Fe),x.addSystem(Ne,(e=>({onUpdate(){if(!pe(e).paused)for(const t of x.getEntities(e,["position","moveable"]))t.position.x+=t.moveable.dx,t.position.y+=t.moveable.dy}}))),x.addSystem(Ne,(e=>({onUpdate(){const t=pe(e),o=t.lifeTime;if(!t.paused)for(const t of x.getEntities(e,["bullet"]))if(t.position.x>504||0>t.position.x||t.position.y>766||0>t.position.y)x.removeEntity(e,t);else for(const n of x.getEntities(e,["enemy"]))G(n.position,n.body,t.position,t.body).collide&&(x.removeEntity(e,t),n.enemy.hp-=t.bullet.dmg,n.enemy.tookDmg={until:o+100,dx:t.moveable.dx,dy:t.moveable.dy},K(e,M,1,{dx:t.moveable.dx,dy:t.moveable.dy,x:t.position.x,y:t.position.y}),"rocket"==t.bullet.type&&Q(e,z,1,{x:t.position.x-5,y:t.position.y}),n.position.x=n.position.x+(0,h.default)(.1*t.moveable.dx,-1,1),n.position.y=n.position.y+(0,h.default)(.1*t.moveable.dy,-1,1))}}))),x.addSystem(Ne,Fe),x.addSystem(Ne,(e=>({onUpdate(){const t=pe(e).lifeTime;for(const o of x.getEntities(e,["particle"]))t>o.data.creationTime+o.particle.lifeTime&&x.removeEntity(e,o)}}))),x.addSystem(Ne,(e=>({onUpdate(){const t=pe(e),o=t.lifeTime,{pointer:n}=x.getEntities(e,["input"])[0].input;Te.fillStyle=T,Te.fillRect(0,0,ge,he),(e=>{for(const t of x.getEntities(e,["platform"]))Te.beginPath(),Te.lineWidth=2,Te.strokeStyle=C,Te.lineJoin="bevel",Te.strokeRect(t.position.x,t.position.y,t.body.w,t.body.h)})(e),((e,t)=>{if("building"===e.mode?.type&&e.mode.avaiblePoints)for(const[o,{x:n,y:i,w:s,h:r}]of Object.entries(e.mode.avaiblePoints)){Te.beginPath(),Te.lineWidth=2;let o=!1;if(Y(t,{x:n,y:i,w:s,h:r})?(Te.strokeStyle=P,[1,4,5,6].includes(e.mode.index)&&(o=!0)):Te.strokeStyle="#008751",Te.lineJoin="bevel",Te.strokeRect(n,i,s,r),o){Te.beginPath();const t=ne(e.mode.index);Te.arc(n+16,i+16,t,0,2*Math.PI,!0),Te.strokeStyle=M,Te.stroke()}}})(t,n),((e,t)=>{for(let e=-64;1500>e;e+=32)Te.beginPath(),Te.strokeStyle=R(M,.1),Te.moveTo(e+11,0),Te.lineTo(e+11,1500),Te.stroke(),Te.closePath();for(let e=-64;1500>e;e+=32)Te.beginPath(),Te.strokeStyle=R(M,.1),Te.moveTo(0,e+0),Te.lineTo(1500,e+0),Te.stroke(),Te.closePath();for(const e of t){Te.beginPath();const t=Pe(e.bullet);yline=v*Math.floor(e.position.y/v)+0,xmin=e.position.x-16,xmax=e.position.x+16;var o=Te.createLinearGradient(xmin,yline,xmax,yline),n=1-(e.position.y-(yline+0))/v;o.addColorStop(0,R(t,.1)),o.addColorStop(.5,R(t,n)),o.addColorStop(1,R(t,.1)),Te.strokeStyle=o,Te.moveTo(xmin,yline),Te.lineTo(xmax,yline),Te.stroke(),xline=v*Math.round(e.position.x/v)+11,ymin=e.position.y-32,ymax=e.position.y+32,o=Te.createLinearGradient(xline,ymin,xline,ymax),n=(1-(xline-e.position.x+11)/v)/3,o.addColorStop(0,R(t,0)),o.addColorStop(.5,R(t,n)),o.addColorStop(1,R(t,0)),Te.strokeStyle=o,Te.beginPath(),Te.moveTo(xline,ymin),Te.lineTo(xline,ymax),Te.stroke()}})(0,x.getEntities(e,["bullet"])),((e,t)=>{for(const e of t){const{size:t,color:o,circle:n}=e.particle,{x:i,y:s}=e.position,r=.3;Te.beginPath();const l=R(o,r);Te.fillStyle=l,n?(e.particle.size+=.5,Te.strokeStyle=l,Te.arc(i,s,e.particle.size,0,2*Math.PI,!0),Te.stroke()):(Te.rect(i,s,t,t),Te.fill())}})(0,x.getEntities(e,["particle"]));for(const t of x.getEntities(e,["bullet"]))Me(t.bullet.from,t.position,t.bullet);for(const t of[...x.getEntities(e,["renderable","unit"]),...x.getEntities(e,["renderable","bullet"])])$e(t.position,t.body.w,t.body.h,t);for(const t of[...x.getEntities(e,["renderable","enemy"])])Oe(o,t.position,t.body.w,t.body.h,t);((e,t)=>{for(const n of t){const{x:t,y:i,range:s,hp:r,fullHp:l}=n.shield;if(r>0){var o=Te.createLinearGradient(t-Math.round(Math.round(e)%1e3/1e3),i-s,t+s,i+s);o.addColorStop(0,R(M,r/l)),o.addColorStop(1,R(M,.5)),Te.beginPath(),Te.strokeStyle=o,Te.arc(t,i,s,0,2*Math.PI,!0),Te.stroke()}}})(o,x.getEntities(e,["shield"])),(e=>{Ce.beginPath(),Ce.rect(0,0,b,30),Ce.fillStyle=T,Ce.fill(),Ce.beginPath(),Ce.rect(0,29,b,1),Ce.fillStyle=C,Ce.fill(),fe(Ce,q(e.energy,3," "),0,5,3,M),fe(Ce,"/100>",35,10,2,M),fe(Ce,"WAVE: "+e.wave,332,10,2,C),fe(Ce,"HP: "+q(e.hp,4,"0"),212,5,3,k),fe(Ce,q(e.score,6,"0"),434,5,3,P)})(t),((e,t)=>{ze.beginPath(),ze.rect(0,0,b,g),ze.fillStyle=T,ze.fill(),ze.beginPath(),ze.rect(0,0,b,1),ze.fillStyle=C,ze.fill();for(const[o,n]of j.entries()){let i,s;t&&(i=Y(t,n)),s=6!=o?e.energy>n.price:e.score>n.price,ue(ze,n.x,n.y,n.w,n.h,{isSelectable:s,isSelected:i,color:n.color,topText:n.topText,bottomText:n.bottomText,bottomTextColor:n.bottomTextColor})}})(t,n),(e=>{let t;"game"===e.ctxTarget&&(t=Te),"top"===e.ctxTarget&&(t=Ce),"bottom"===e.ctxTarget&&(t=ze),t.beginPath(),t.arc(e.x,e.y,5,0,2*Math.PI,!0),t.strokeStyle=w,t.stroke()})(n),(e=>{e.won&&(fe(Te,"You won!",20,383,15,P),fe(Te,"Score: "+e.score,120,483,8,P)),e.gameOver&&(fe(Te,"Game Over!",20,383,12,k),fe(Te,"Score: "+e.score,120,483,8,k))})(t),we.drawImage(Se,0,0),we.drawImage(ve,0,30),we.drawImage(ke,0,796),be.drawImage(Ee,0,0,b,g,0,0,xe.width,xe.height)}})));var He=performance.now();!function e(){const t=performance.now(),o=t-He;He=t,x.update(Ne,o),x.cleanup(Ne),requestAnimationFrame(e)}()})();</script>