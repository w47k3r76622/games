<!doctype html><html><head><title>-link></title><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><style> html, body { width: 100%; height: 100%; margin: 0px; border: 0; overflow: hidden; /* Disable scrollbars */ display: block; /* No floating content on sides */ } </style><script src="https://aframe.io/releases/0.8.2/aframe.min.js"></script><script>AFRAME.registerComponent('restart',{schema:{}});var PolyLine=function(a,b=65280,c=0.5){this.geometry=new THREE.BufferGeometry,this.vertices=new Float32Array(12),this.width=a,this.geometry.addAttribute('position',new THREE.BufferAttribute(this.vertices,3).setDynamic(!0)),this.material=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,color:b,opacity:c,transparent:!0}),this.mesh=new THREE.Mesh(this.geometry,this.material),this.mesh.drawMode=THREE.TriangleStripDrawMode,this.mesh.frustumCulled=!1,this.mesh.vertices=this.vertices,this.direction=new THREE.Vector3};PolyLine.prototype={setDirection:function(a){var b=new THREE.Vector3(0,1,0);this.direction.copy(a).cross(b).normalize().multiplyScalar(this.width/2)},setWidth:function(a){this.width=a},setPoint:function(){var a=new THREE.Vector3,b=new THREE.Vector3;return function(c){a.copy(c).add(this.direction),b.copy(c).sub(this.direction);var d=6;this.vertices[d++]=a.x,this.vertices[d++]=a.y,this.vertices[d++]=a.z,this.vertices[d++]=b.x,this.vertices[d++]=b.y,this.vertices[d++]=b.z,this.geometry.attributes.position.needsUpdate=!0}}()},AFRAME.registerComponent('levelup',{schema:{level:{default:1}},init:function(){this.cycl=document.createElement('a-entity'),this.cycl.setAttribute('position','0 0.0 0'),this.cycl.setAttribute('geometry','primitive: cylinder; radius: 0.5; height: 2.0'),this.cycl.setAttribute('material','color: yellow'),this.el.appendChild(this.cycl)}}),AFRAME.registerComponent('power',{schema:{},init:function(){this.cone=document.createElement('a-entity'),this.cone.setAttribute('position','0 1.0 0'),this.cone.setAttribute('geometry','primitive: cone; radius-bottom: 0.5; radius-top: 0.0'),this.cone.setAttribute('material','color: green'),this.el.appendChild(this.cone)}}),AFRAME.registerComponent('portable',{schema:{maxCountdown:{default:1e3},colour:{default:'#fff'},portedTo:{default:!1},position:{default:-1}},init:function(){this.countdown=this.data.maxCountdown,this.inFocus=!1,this.el.setAttribute('material','color: '+this.data.colour),this.el.addEventListener('mouseenter',()=>{this.el.setAttribute('scale','1.2 1.2 1.2'),this.inFocus=!0}),this.el.addEventListener('mouseleave',()=>{this.el.setAttribute('scale','1.0 1.0 1.0'),this.el.setAttribute('material','color: '+this.data.colour),this.inFocus=!1})},update:function(a){a.portedTo!=this.data.portedTo&&!0==this.data.portedTo&&(this.torus=document.createElement('a-entity'),this.torus.setAttribute('position','0 1.0 0'),this.torus.setAttribute('geometry','primitive: torus; arc: 360; radius: 0.25; radius-tubular: 0.05'),this.torus.setAttribute('rotation','-90 0 0'),this.torus.setAttribute('material','color: #00D4FF'),this.el.appendChild(this.torus))},tick:function(a,b){if(!0==this.inFocus){this.countdown-=b;var c=new THREE.Color(this.data.colour),d=this.countdown/this.data.maxCountdown;c.r=Math.max(0,c.r*d),c.g=Math.max(0,c.g*d),c.b=Math.max(0,c.b*d),this.el.setAttribute('material','color: #'+c.getHexString())}else this.countdown=this.data.maxCountdown;if(0>=this.countdown){var e=document.querySelector('a-scene').systems['game-system'];e.el.emit('jump',{dest:this},!1),this.countdown=this.data.maxCountdown}}}),AFRAME.registerSystem('game-system',{schema:{power:{default:5},maxPower:{default:20},height:{default:0},maxHeight:{default:0}},init:function(){console.log('Game System Init'),this.levelNum=1,this.random=this.seed(this.levelNum),this.level=[],this.levelWH=20,this.levelSZ=this.levelWH*this.levelWH,this.generateFloor(this,0,1,0),this.money=0,this.chain=[],this.restartText=null,this.listener=new THREE.AudioListener,this.listenerAdded=!1;var a=document.createElement('a-entity');a.setAttribute('position','10 0 -10'),a.setAttribute('geometry','primitive: icosahedron; radius: 1'),a.setAttribute('portable','colour: #6600DD; portedTo: true; position: '+this.level.length),a.setAttribute('power',''),this.el.appendChild(a),this.chain.push(a),this.level.push(a);var b=document.querySelector('#camera-rig');b.setAttribute('position','10 1.6 -10');var c=this.data,d=this;this.el.addEventListener('jump',function(e){var f=document.querySelector('#camera-rig');if(0<c.power){var g=new THREE.Vector3;e.detail.dest.el.object3D.getWorldPosition(g),e.detail.dest.el.setAttribute('material','color: '+e.detail.dest.data.colour),g.y+=1.6;var h=f.object3D.position.clone();h.sub(g),f.setAttribute('position',g);var j=document.querySelector('#height-marker'),k=Math.floor(g.y);j.setAttribute('value',k+'m'),e.detail.dest.line=new PolyLine(1),e.detail.dest.line.setDirection(h),e.detail.dest.line.setPoint(h);var l=document.createElement('a-entity');if(l.setObject3D('mesh',e.detail.dest.line.mesh),e.detail.dest.el.appendChild(l),e.detail.dest.line=l,--c.power,void 0!=e.detail.dest.el.components.power&&!1==e.detail.dest.el.components.portable.data.portedTo&&(c.power+=5,c.power>c.maxPower&&(c.power=c.maxPower)),0>=c.power&&null==d.restartText&&(d.restartText=document.createElement('a-entity'),d.restartText.setAttribute('position','0 1 -2.5'),d.restartText.setAttribute('geometry','primitive: plane; width: 1; height: 1;'),d.restartText.setAttribute('portable','colour: #444444; position: '+d.level.length),d.restartText.setAttribute('restart',''),d.restartText.setAttribute('text','value: RESTART; width:5; align:center'),d.restartText.system=d,e.detail.dest.el.appendChild(d.restartText)),void 0!=e.detail.dest.el.components.levelup&&d.levelNum<e.detail.dest.el.components.levelup.data.level){d.levelNum=e.detail.dest.el.components.levelup.data.level;for(var m=d.chain.splice(0),n=0;n<m.length;++n)d.money+=10*(n+1);c.power+=5,c.power>c.maxPower&&(c.power=c.maxPower),d.generateFloor(d,g.x,g.y/10,g.z)}if(!1==d.chain.includes(e.detail.dest.el))d.chain.push(e.detail.dest.el);else{for(var p,o=d.chain.indexOf(e.detail.dest.el),m=d.chain.splice(o+1),n=0;n<m.length;++n)p=m[n].components.portable.data.position,-1!=p&&(d.level[p]=void 0),d.el.removeChild(m[n]),d.money+=10*(n+1);e.detail.dest.el.removeChild(e.detail.dest.line)}}else if(void 0!=e.detail.dest.el.components.restart){d.levelNum=1,d.generateFloor(d,0,1,0),d.money=0,c.power=d.data.power=5,c.height=d.data.height=0,d.chain=[],d.restartText=null;var q=document.createElement('a-entity');q.setAttribute('position','10 0 -10'),q.setAttribute('geometry','primitive: icosahedron; radius: 1'),q.setAttribute('portable','colour: #6600DD; portedTo: true; position: '+d.level.length),q.setAttribute('power',''),d.el.appendChild(q),d.chain.push(q),d.level.push(q),f.setAttribute('position','10 1.6 -10')}e.detail.dest.el.setAttribute('portable','portedTo: true')})},update:function(){},remove:function(){},tick:function(){for(var c=document.querySelector('#power-marker'),d='',e=0;e<this.data.power;++e)d+='I';c.setAttribute('value',d);var f=document.querySelector('#money-marker');f.setAttribute('value','$'+this.money)},seed:function(a){return function(){return a=1e4*Math.sin(a),a-Math.floor(a)}},generateFloor:function(a,b,c,d){for(var e=!1,f=0;f<a.level.length;++f)void 0!=a.level[f]&&a.el.removeChild(a.level[f]);a.level=[];for(var g,f=0;f<a.levelSZ;++f)if(g=25>100*a.random(),!0==g){var h=d+(10*(f%a.levelWH)+10*a.random()),j=b+(10*(f/a.levelWH)+10*a.random()),k=10*c+10*a.random(),l=25>a.random()*a.levelSZ;if(!0==e,!0==l){var m=document.createElement('a-entity');m.setAttribute('position',j-100+' '+k+' '+(h-100)),m.setAttribute('geometry','primitive: icosahedron; radius: 1'),m.setAttribute('portable','colour: #6600DD; position: '+this.level.length),m.setAttribute('power',''),m.system=a,a.el.appendChild(m),this.level.push(m)}else{var m=document.createElement('a-entity');m.setAttribute('position',j-100+' '+k+' '+(h-100)),m.setAttribute('geometry','primitive: icosahedron; radius: 1'),m.setAttribute('portable','colour: #FF1144; position: '+this.level.length),m.system=a,a.el.appendChild(m),this.level.push(m)}}var m=document.createElement('a-entity'),n=new THREE.Vector3(100*a.random()-50,10*c+30,100*a.random()-50);m.setAttribute('position',n.x+' '+n.y+' '+n.z),m.setAttribute('geometry','primitive: icosahedron; radius: 1'),m.setAttribute('portable','colour: #663C00; position: '+this.level.length),m.setAttribute('levelup','level: '+a.levelNum+1),m.system=a,a.el.appendChild(m);var o=new PolyLine(1,65520,0.25);n.y*=-1,o.setDirection(n),o.setPoint(n);var p=document.createElement('a-entity');p.setObject3D('mesh',o.mesh),m.appendChild(p),m.line=p,this.level.push(m)}});</script></head><body><a-scene fog="type: exponential; density: 0.035; color: #330022"><a-sky color="#330033"></a-sky><a-entity id="camera-rig"position="0.0 0.1 0.0"><a-entity id="camera" camera look-controls><a-cursor /><a-entity position="-0.1 0 0"><a-text id="power-marker" opacity=0.25 width=2.5 align="right" value=""></a-text></a-entity><a-entity position="0.1 0.1 0"><a-text id="height-marker" opacity=0.25 width=1.5 align="left" value="0m"></a-text></a-entity><a-entity position="0.1 -0.1 0"><a-text id="money-marker" opacity=0.25 width=1.5 align="left" value="$0"></a-text></a-entity></a-entity></a-entity></a-scene></body></html>
