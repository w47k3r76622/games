function PersistentData(){this.data={soundOn:!0,musicOn:!0,keys:[90,81,83,68,32,0]};localStorage.getItem("LineOfFireData")}PersistentData.prototype={storeData:function(){localStorage.setItem("LineOfFireData",JSON.stringify(this.data))},toggleSound:function(){this.data.soundOn=!this.data.soundOn;this.storeData()},toggleMusic:function(){this.data.musicOn=!this.data.musicOn;this.storeData()},setKey:function(a,b){this.data.keys[a]=b;-1<b&&this.storeData()}};
function Renderer(a,b,c){this.game=c;this.world=c.world;this.sceneryCanvas=a;this.overlayCanvas=b;this.overlayContext=b.getContext("2d");this.babylonScene=0;this.windowLayout={playArea:[]};this.initBabylon();this.resizeWindow();this.frameCount=0;this.weaponOffset=[0,0,0,0,0];this.mainMenuText=["Start new game","Load game","Save game"];this.weaponName=["Armor piercing","Explosive","Splitter","Delay-action"];this.messageLine1="Line of Fire;;Game over;Game over;Game over;Pause;You win;You win;You win".split(";");
this.messageLine2="A WebXR game for js13k, built with Babylon.js. Press Enter or click to start;;Tank destroyed;Another player seized control of the arena;Time's out;Press P or Enter to resume;You are the only one left in the arena;You gained control of eight beacons".split(";");this.playerColor=["#0ff","#4f4","#f0f","#f72"]}
Renderer.prototype={initBabylon:function(){this.engine=new BABYLON.Engine(this.sceneryCanvas,!0);this.scene=new BABYLON.Scene(this.engine);this.camera=new BABYLON.FreeCamera("camera",new BABYLON.Vector3(128,300,128),this.scene);this.camera.attachControl(this.sceneryCanvas,!1);this.vrHelper=this.scene.createDefaultVRExperience({createDeviceOrientationCamera:!1});this.vrHelper.onControllerMeshLoaded.add(function(a){registerControllerEvents(a)});var a=new BABYLON.DirectionalLight("sunLight",new BABYLON.Vector3(1,
-5,0),this.scene);this.expLight=new BABYLON.PointLight("pointLight",new BABYLON.Vector3(0,-5,0),this.scene);this.expLight.setEnabled(!1);for(var b=[],c=0;257>c;++c){for(var e=[],d=256;-1<d;--d)e.push(new BABYLON.Vector3(d,this.world.landscapeHeightAt(d,c),c));b.push(e)}b=BABYLON.MeshBuilder.CreateRibbon("ground",{pathArray:b},this.scene);var g=new BABYLON.StandardMaterial("groundMat",this.scene);this.groundTexture=new BABYLON.DynamicTexture("groundTex",1024,this.scene);this.groundTextureContext=this.groundTexture.getContext();
this.groundTextureContext.fillStyle="#c94";this.groundTextureContext.fillRect(0,0,1024,1024);e=this.groundTextureContext.getImageData(0,0,1024,1024);var f=e.data;for(c=0;1E6>c;++c){d=Math.floor(1022*Math.random());var h=Math.floor(1022*Math.random());d=Math.min(d,h,1023-d,1023-h,32)/32;var k=Math.floor(d*(95+60*Math.random())),l=Math.floor(d*(30+60*Math.random()));f[4096*h+4*c]=Math.floor(d*(150+60*Math.random()));f[4096*h+4*c+1]=k;f[4096*h+4*c+2]=l}this.groundTextureContext.putImageData(e,0,0);g.diffuseTexture=
this.groundTexture;g.specularColor=new BABYLON.Color3(.3,.3,.3);b.material=g;this.groundTexture.update();g=new BABYLON.TransformNode("tankRoot");e=new BABYLON.TransformNode("tankChassis");e.parent=g;d=BABYLON.MeshBuilder.CreateCylinder("wheel",{height:1.2,diameter:1.3,tesselation:16},this.scene);d.position.x=-4.5;d.position.y=2.4;d.position.z=-1;d.parent=e;for(c=1;7>c;++c)f=d.clone(),f.position.x=-4.5+1.5*c,f.position.y=2.4,f.position.z=6==c?-1:0,f.parent=e;for(c=0;7>c;++c)f=d.clone(),f.position.x=
-4.5+1.5*c,f.position.y=-2.4,f.position.z=0==c||6==c?-1:0,f.parent=e;h=[[-4.5,1.9,-3,1.9,3,1.9,4.5,1.75],[-4.5,.6,-3,-.5,3,-.5,4.5,.6]];k=[];f=[];for(d=0;d<h.length;++d){l=[];var m=[];for(c=0;c<h[0].length;c+=2)l.push(new BABYLON.Vector3(h[d][c],h[d][c+1],-2.7)),m.push(new BABYLON.Vector3(h[d][c],h[d][c+1],2.7));k.push(l);f.push(m)}c=BABYLON.MeshBuilder.CreateRibbon("leftWall",{pathArray:k,sideOrientation:BABYLON.Mesh.DOUBLESIDE},this.scene);d=BABYLON.MeshBuilder.CreateRibbon("rightWall",{pathArray:f,
sideOrientation:BABYLON.Mesh.DOUBLESIDE},this.scene);c.parent=g;d.parent=g;f=[5.2,1,5.2,1.5,5,1.7,3,2,-4.7,2,-5.2,1.5,-5.2,1,-4.7,.5,3.5,.5,5.2,1];d=[];for(c=0;c<f.length;c+=2)d.push(new BABYLON.Vector3(f[c],f[c+1],0));f=[new BABYLON.Vector3(0,0,-1.8),new BABYLON.Vector3(0,0,1.8)];BABYLON.MeshBuilder.ExtrudeShape("body",{shape:d,path:f,sideOrientation:BABYLON.Mesh.DOUBLESIDE},this.scene).parent=g;h=[[5.2,1.5,5,1.7,3,2,-4.7,2,-5.2,1.5],[5.5,1.4,5,1.9,3,2,-4.7,2,-5.3,1.4],[5.5,1.4,5,1.9,3,2,-4.7,2,
-5.3,1.4],[5.5,1.2,5,1,3,1,-4.7,1,-5.3,1.2]];k=[];f=[];for(d=0;d<h.length;++d){l=[];m=[];var n=[-1.8,-1.8,-3.1,-3.1][d],p=[1.8,1.8,3.1,3.1][d];for(c=0;c<h[0].length;c+=2)l.push(new BABYLON.Vector3(h[d][c],h[d][c+1],n)),m.push(new BABYLON.Vector3(h[d][c],h[d][c+1],p));k.push(l);f.push(m)}d=BABYLON.MeshBuilder.CreateRibbon("leftCover",{pathArray:k,sideOrientation:BABYLON.Mesh.DOUBLESIDE},this.scene);f=BABYLON.MeshBuilder.CreateRibbon("rightCover",{pathArray:f,sideOrientation:BABYLON.Mesh.DOUBLESIDE},
this.scene);d.parent=g;f.parent=g;e.rotation.x=Math.PI/2;f=[1.5,2.1,2.4,2.5,2.5,2,1.2];e=[];h=[];for(d=0;7>d;++d)h.push(new BABYLON.Vector3(-3,2.5,0));e.push(h);for(d=0;d<f.length;++d)h=[],h.push(new BABYLON.Vector3(d-3,2.1,-f[d])),h.push(new BABYLON.Vector3(d-3,3,-f[d])),h.push(new BABYLON.Vector3(d-3,3.2,-.5*f[d])),h.push(new BABYLON.Vector3(d-3,3.2,.5*f[d])),h.push(new BABYLON.Vector3(d-3,3,f[d])),h.push(new BABYLON.Vector3(d-3,2.1,f[d])),h.push(new BABYLON.Vector3(d-3,2.1,-f[d])),e.push(h);f=
[];for(d=0;7>d;++d)f.push(new BABYLON.Vector3(3,2.5,0));e.push(f);this.turret=[];this.turret.push(BABYLON.MeshBuilder.CreateRibbon("turret",{pathArray:e,sideOrientation:BABYLON.Mesh.DOUBLESIDE},this.scene));this.cannon=[];f=[];h=[.2,.2,.2,.4,.4,.3,.3,.3,.3,.3];k=[0,1,2,2,3,3,4,5,6,7];for(l=0;16>l;++l){e=[];for(d=0;10>d;++d)e.push(new BABYLON.Vector3(k[d],h[d]*Math.sin(l*Math.PI/8),h[d]*Math.cos(l*Math.PI/8)));f.push(e)}this.cannon.push(BABYLON.MeshBuilder.CreateRibbon("cannon"+c,{pathArray:f,closeArray:!0,
sideOrientation:BABYLON.Mesh.DOUBLESIDE},this.scene));this.tank=[];this.tankParent=[];this.cannonParent=[];for(c=0;4>c;++c)this.tankParent[c]=new BABYLON.TransformNode("tankNode"+c),this.tank[c]=c?g.clone():g,this.tank[c].parent=this.tankParent[c],c&&(this.turret.push(this.turret[0].clone()),this.cannon.push(this.turret[c]._children[0]._children[0])),this.turret[c].parent=this.tankParent[c],this.cannonParent[c]=new BABYLON.TransformNode("cannonNode"+c),this.cannonParent[c].parent=this.turret[c],this.cannonParent[c].position.y=
2.5,this.cannon[c].parent=this.cannonParent[c],d=new BABYLON.DynamicTexture("tankTexture"+c,256,this.scene),e=d.getContext(),this.createCamouflagePattern(e,[["#133","#277","#699","#5cc"],["#242","#472","#5b6","#3d3"],["#424","#726","#969","#d6d"],["#432","#762","#986","#e93"]][c]),e=new BABYLON.StandardMaterial("tankMaterial"+c,this.scene),e.specularColor=new BABYLON.Color3(.4,.4,.4),e.diffuseTexture=d,d.update(),this.setTreeMaterial(this.tankParent[c],e);this.beacon=[];this.beaconBeam=[];for(c=0;16>
c;++c){this.beacon[c]=BABYLON.MeshBuilder.CreateCylinder("beacon"+c,{height:2,diameter:5,tesselation:16},this.scene);this.beacon[c].position.x=32+64*(c&3);this.beacon[c].position.z=32+64*(c>>2);this.beacon[c].position.y=this.world.landscapeHeightAt(this.beacon[c].position.x,this.beacon[c].position.z);g=new BABYLON.StandardMaterial("beaconMat"+c,this.scene);g.diffuseColor=new BABYLON.Color3(.25,.25,.25);this.beacon[c].material=g;this.beacon[c].receiveShadows=!0;g=[];for(d=0;5>d;++d)e=BABYLON.MeshBuilder.CreateTorus("beacon"+
c+"beam"+d,{thickness:.1},this.scene),e.scaling=new BABYLON.Vector3(5+3*d,5+3*d,5+3*d),e.position.y=5*d,e.parent=this.beacon[c],f=new BABYLON.StandardMaterial("beamMat"+c+"."+d,this.scene),e.material=f,e.setEnabled(!1),g.push(e);this.beaconBeam.push(g)}this.shells=[];this.crates=[];this.crateMaterial=new BABYLON.StandardMaterial("crateMat",this.scene);this.crateMaterial.diffuseTexture=new BABYLON.Texture("images/crate16.png",this.scene);this.explosions=[];this.playerColors=[new BABYLON.Color3(0,1,
1),new BABYLON.Color3(.25,1,.25),new BABYLON.Color3(1,0,1),new BABYLON.Color3(1,.5,.15)];a=new BABYLON.ShadowGenerator(1024,a);for(c=0;4>c;++c)for(g=[],this.getAllMeshesInTree(this.tankParent[c],g),d=0;d<g.length;++d)a.addShadowCaster(g[d],!0);b.receiveShadows=!0},createCamouflagePattern:function(a,b){a.fillStyle="#000";a.fillRect(0,0,256,256);for(var c=a.getImageData(0,0,256,256).data,e=0,d=0,g=0,f=0;++f-4E5;g=13*g+.5+9*Math.cos(g)&-1){e+=[0,1,0,-1][g&3];d+=[0,1,0,-1][3-g&3];for(var h=0;++h-6;)for(var k=
0;++k-6;)++c[1024*(d+k&255)+4*(e+h&255)]}for(f=0;++f-4E5;g=13*g+1.5+10*Math.cos(g)&-1)for(e+=[0,1,0,-1][g&3],d+=[0,1,0,-1][3-g&3],h=0;++h-6;)for(k=0;++k-6;)++c[1024*(d+k&255)+4*(e+h&255)+1];for(k=0;256>k;++k)for(h=0;256>h;++h)a.fillStyle=b[(128<c[1024*k+4*h]?1:0)+(128<c[1024*k+4*h+1]?2:0)],a.fillRect(h,k,1,1)},setTreeMaterial:function(a,b){a.material=b;if(a.hasOwnProperty("_children"))for(var c=0;c<a._children.length;++c)this.setTreeMaterial(a._children[c],b)},getAllMeshesInTree:function(a,b){if(a.hasOwnProperty("_children"))for(var c=
0;c<a._children.length;++c)this.getAllMeshesInTree(a._children[c],b);a.hasOwnProperty("_geometry")&&b.push(a)},resetSceneGraph:function(){for(var a=0;a<this.beacon.length;++a)this.beacon[a].material.emissiveColor=new BABYLON.Color3(0,0,0);for(a=0;a<this.beaconBeam.length;++a)for(var b=0;b<this.beaconBeam[a].length;++b)this.beaconBeam[a][b].setEnabled(!1);for(a=0;a<this.shells.length;++a)this.shells[a].setEnabled(!1);for(a=0;a<this.crates.length;++a)this.crates[a].setEnabled(!1);for(a=0;a<this.explosions.length;++a)this.explosions[a].setEnabled(!1)},
resizeWindow:function(){this.overlayCanvas.width=this.sceneryCanvas.width=window.innerWidth;this.overlayCanvas.height=this.sceneryCanvas.height=window.innerHeight;this.overlayCanvas.style.width=this.sceneryCanvas.style.width=window.innerWidth+"px";this.overlayCanvas.style.height=this.sceneryCanvas.style.height=window.innerHeight+"px";this.windowLayout.playArea=[window.innerWidth,window.innerHeight];this.game.layoutChanged(this.windowLayout);this.engine.resize()},drawShadedText:function(a,b,c){this.overlayContext.shadowOffsetX=
-1;this.overlayContext.shadowOffsetY=-1;this.overlayContext.fillText(a,b,c);this.overlayContext.shadowOffsetX=2;this.overlayContext.shadowOffsetY=2;this.overlayContext.fillText(a,b,c)},outlineText:function(a,b,c,e){this.overlayContext.font=Math.ceil(e)+"px cursive";this.overlayContext.strokeText(a,b,c);this.overlayContext.fillText(a,b,c)},drawMessage:function(){this.overlayContext.save();this.overlayContext.fillStyle="hsl("+[240,240,0,0,0,240,120,120,120][1+this.world.gameCondition]+","+Math.round(50+
50*Math.cos(this.frameCount/20))+"%,50%)";this.overlayContext.strokeStyle="#aaa";this.overlayContext.lineWidth=6;this.overlayContext.textAlign="center";this.outlineText(this.messageLine1[1+this.world.gameCondition],this.overlayCanvas.width>>1,.45*this.overlayCanvas.height,.06*this.overlayCanvas.height);this.overlayContext.lineWidth=2;this.overlayContext.fillStyle="#ccc";this.overlayContext.strokeStyle="#666";var a="";4<this.world.gameCondition&&(a=" after "+Math.floor(this.world.timer/25)+" seconds");
this.outlineText(this.messageLine2[1+this.world.gameCondition]+a,this.overlayCanvas.width>>1,.55*this.overlayCanvas.height,.03*this.overlayCanvas.height);this.overlayContext.restore()},drawMain:function(){this.scene&&(this.updateSceneGraph(),this.scene.render());this.overlayContext.clearRect(0,0,this.overlayCanvas.width,this.overlayCanvas.height);this.drawStatus();++this.frameCount},drawPlayfield:function(){this.overlayContext.save();this.overlayContext.translate(-64,-64);this.overlayContext.scale(.5,
.5);this.overlayContext.fillStyle="#040";this.overlayContext.fillRect(128,128,512,512);this.overlayContext.lineWidth="1px";for(var a=0;a<this.world.beacons.length;++a){var b=a&3,c=a>>2;this.overlayContext.fillStyle=["#888","#0ff","#4f4","#f0f","#fa2"][1+this.world.beacons[a]];this.overlayContext.fillRect(192+128*b-6,576-128*c-6,12,12)}for(a=0;a<this.world.playerData.length;++a)b=this.world.playerData[a],this.overlayContext.save(),this.overlayContext.translate(128+2*b.x,640-2*b.z),this.overlayContext.rotate(-b.dir),
this.overlayContext.strokeStyle=this.playerColor[a],this.overlayContext.strokeRect(-20,-15,40,30),this.overlayContext.rotate(-b.aimY+b.dir),this.overlayContext.beginPath(),this.overlayContext.moveTo(0,0),this.overlayContext.lineTo(25,0),this.overlayContext.stroke(),this.overlayContext.restore();for(a=0;a<this.world.shells.length;++a)c=this.world.shells[a],this.overlayContext.fillStyle="#ff7",b=1+c.y/10,this.overlayContext.fillRect(128+2*c.x-b,640-2*c.z-b,2*b,2*b);for(a=0;a<this.world.crates.length;++a)c=
this.world.crates[a],this.overlayContext.fillStyle="#a52",b=2+c.y/10,this.overlayContext.fillRect(128+2*c.x-b,640-2*c.z-b,2*b,2*b);for(a=0;a<this.world.explosions.length;++a)b=this.world.explosions[a],c=this.world.timer-b.t0,this.explosions[a].material.diffuseColor=new BABYLON.Color3(1,13>c?1:2-c/13,1-c/25),this.overlayContext.fillStyle="rgb(255,"+(25>c?255:500-20*c)+","+(255-10*c)+")",this.overlayContext.beginPath(),this.overlayContext.arc(128+2*b.x,640-2*b.z,c/25*b.range,0,2*Math.PI),this.overlayContext.fill();
this.overlayContext.restore()},updateSceneGraph:function(){for(var a=0;a<this.world.playerData.length;++a){var b=this.world.playerData[a];this.tankParent[a].position.x=b.x;this.tankParent[a].position.y=b.y+.5;this.tankParent[a].position.z=b.z;this.tank[a].rotation.y=-b.dir;this.turret[a].rotation.y=-b.aimY;this.cannon[a].rotation.z=b.aimH}for(a=0;a<this.world.beacons.length;++a)if(b=this.world.beacons[a],-1<b){this.beacon[a].material.emissiveColor=this.playerColors[b];for(var c=0;5>c;++c){var e=(c+
this.world.timer%80/16)%5;this.beaconBeam[a][c].setEnabled(!0);this.beaconBeam[a][c].position.y=5*e;this.beaconBeam[a][c].scaling=new BABYLON.Vector3(5+3*e,5+3*e,5+3*e);this.beaconBeam[a][c].material.diffuseColor=this.playerColors[b];this.beaconBeam[a][c].material.alpha=1-e/5}}for(a=0;a<this.world.shells.length;++a)b=this.world.shells[a],a>=this.shells.length?(this.shells.push(BABYLON.MeshBuilder.CreateSphere("shell"+a,{diameter:1},this.scene)),c=new BABYLON.StandardMaterial("shellMat",this.scene),
this.shells[a].material=c):this.shells[a].setEnabled(!0),this.shells[a].material.diffuseColor=b.timer&16?new BABYLON.Color3(1,0,0):new BABYLON.Color3(.2,.2,.2),this.shells[a].position.x=b.x,this.shells[a].position.y=b.y,this.shells[a].position.z=b.z;for(a=this.world.shells.length;a<this.shells.length;++a)this.shells[a].setEnabled(!1);for(a=0;a<this.world.crates.length;++a)b=this.world.crates[a],a>=this.crates.length?(this.crates.push(BABYLON.MeshBuilder.CreateBox("crate"+a,{size:4},this.scene)),this.crates[a].material=
this.crateMaterial):this.crates[a].setEnabled(!0),this.crates[a].position.x=b.x,this.crates[a].position.y=b.y,this.crates[a].position.z=b.z;for(a=this.world.crates.length;a<this.crates.length;++a)this.crates[a].setEnabled(!1);c=!1;for(a=0;a<this.world.explosions.length;++a){b=this.world.explosions[a];a>=this.explosions.length?(this.explosions.push(BABYLON.MeshBuilder.CreateSphere("explosion"+a,{diameter:1},this.scene)),e=new BABYLON.StandardMaterial("explosionMat",this.scene),this.explosions[a].material=
e):this.explosions[a].setEnabled(!0);this.explosions[a].position.x=b.x;this.explosions[a].position.y=b.y;this.explosions[a].position.z=b.z;e=this.world.timer-b.t0;var d=b.range*(.15+Math.sqrt(e/25));this.explosions[a].scaling=new BABYLON.Vector3(d,d,d);this.explosions[a].material.diffuseColor=new BABYLON.Color3(1,13>e?1:2-e/13,1-e/25);this.explosions[a].material.alpha=13>e?1:2-e/13;var g=b.y-this.world.landscapeHeightAtFloat(b.x,b.z);g<d&&(c=Math.sqrt(d*d-g*g),this.groundTextureContext.fillStyle=
"rgba(0,0,0,.05)",this.groundTextureContext.beginPath(),this.groundTextureContext.arc(4*b.x,1024-4*b.z,4*c,0,2*Math.PI),this.groundTextureContext.fill(),c=!0);this.expLight.setEnabled(!0);this.expLight.position.x=b.x;this.expLight.position.y=b.y+d+10;this.expLight.position.z=b.z;this.expLight.intensity=.5*Math.sqrt(b.range)*(1-Math.sqrt(e/25))}for(a=this.world.explosions.length;a<this.explosions.length;++a)this.explosions[a].setEnabled(!1);c&&this.groundTexture.update();1>this.world.explosions.length&&
this.expLight.setEnabled(!1);b=this.world.playerData[this.world.playerId];this.world.useDroneView?(this.camera.position.x=b.droneX,this.camera.position.y=b.droneY,this.camera.position.z=b.droneZ,this.camera.setTarget(new BABYLON.Vector3(this.camera.position.x,0,this.camera.position.z)),this.vrHelper.currentVRCamera.position.x=b.droneX,this.vrHelper.currentVRCamera.position.y=b.droneY,this.vrHelper.currentVRCamera.position.z=b.droneZ,this.vrHelper.currentVRCamera.setTarget(new BABYLON.Vector3(this.camera.position.x,
0,this.camera.position.z))):(a=Math.PI/2-b.aimY,this.camera.position.x=b.x-20*Math.sin(a),this.camera.position.y=b.y+12,this.camera.position.z=b.z-20*Math.cos(a),this.camera.rotation.x=.2,this.camera.rotation.y=a,this.camera.rotation.z=0,this.vrHelper.currentVRCamera.position.x=b.x-20*Math.sin(a),this.vrHelper.currentVRCamera.position.y=b.y+12,this.vrHelper.currentVRCamera.position.z=b.z-20*Math.cos(a))},drawStatus:function(){var a=this.windowLayout.playArea[0]-220;this.overlayContext.fillStyle="rgba(0,0,0,.25)";
this.overlayContext.fillRect(a-20,0,240,240);var b=this.world.playerData[this.world.playerId];this.overlayContext.strokeStyle="#fff";this.overlayContext.strokeRect(a,20,200,16);this.overlayContext.fillStyle="#08c";this.overlayContext.fillRect(a,20,2*this.world.playerData[this.world.playerId].hp,16);this.overlayContext.fillStyle="#fff";this.overlayContext.fillText("A r m o r",a+40,32);this.overlayContext.strokeRect(a,40,200,16);b.reload&&(this.overlayContext.fillStyle="#fc0",this.overlayContext.fillRect(a,
40,4*this.world.playerData[this.world.playerId].reload,16),this.overlayContext.fillStyle="#fff",this.overlayContext.fillText("Reloading",a+40,52));this.overlayContext.fillText("Q/D : Turn left/right",a,72);this.overlayContext.fillText("Z/S : Accelerate fwd/back",a,92);-1>b.droneY?(this.overlayContext.fillStyle="#777",this.overlayContext.fillText("Space : drone expended",a,112),this.overlayContext.fillStyle="#fff"):this.overlayContext.fillText("Space : "+(0==b.droneX?"Launch drone":this.world.useDroneView?
"Main view":"Drone view"),a,112);this.overlayContext.fillText("RMB : Change ordnance : ",a,132);for(var c=152,e=0;e<b.weapons.length;++e)b.weapons[e]&&(this.overlayContext.fillText(this.weaponName[e]+" : "+b.weapons[e],a+20,c),b.currentWeapon==e&&this.overlayContext.strokeRect(a,c-12,200,16),c+=20);this.overlayContext.fillText("Beacons",a,212);this.overlayContext.strokeStyle="#fff";this.overlayContext.strokeRect(a+56,200,144,16);a+=56;for(e=0;e<this.world.playerData.length;++e)this.world.playerData[e].beacons&&
(this.overlayContext.fillStyle=this.playerColor[e],this.overlayContext.fillRect(a,200,9*this.world.playerData[e].beacons,16),this.overlayContext.fillStyle="#000",this.overlayContext.textAlign="center",this.overlayContext.fillText(this.world.playerData[e].beacons,a+4.5*this.world.playerData[e].beacons,212),a+=9*this.world.playerData[e].beacons);this.overlayContext.textAlign="left";this.overlayContext.save();this.overlayContext.fillStyle="#aaa";this.overlayContext.strokeStyle="#558";this.overlayContext.textAlign=
"center";-50>=this.world.timer?e="":0>this.world.timer?e="Get ready !":25>this.world.timer?e="Go !":(e=Math.floor((3E3-this.world.timer)/25)%60,e=Math.floor((3E3-this.world.timer)/1500)+":"+(10>e?"0":"")+e);this.outlineText(e,this.overlayCanvas.width/2,40,32);e=this.world.timer-this.world.messageTimer;50>e&&(this.overlayContext.fillStyle="rgba(205, 128, 52, "+(1-e/50)+")",this.overlayContext.strokeStyle="rgba(41, 25, 10, "+(1-e/50)+")",this.outlineText(this.world.message,this.overlayCanvas.width/
2,this.overlayCanvas.height/2-50-e,32));this.overlayContext.fillStyle="#aaa";this.overlayContext.strokeStyle="#558";this.overlayContext.restore()}};function World(a){this.controls=a;this.initialize();this.message=this.playerId=0;this.messageTimer=-500;this.ground=[];this.loadLevel();this.aiPlayers=[new AIPlayer(1),new AIPlayer(2),new AIPlayer(3)]}
World.prototype={initialize:function(){this.playerData=[{x:44,y:0,z:44,speed:0,dir:Math.PI/4,aimH:Math.PI/4,aimY:Math.PI/4,droneX:0,droneY:0,droneZ:0,droneSX:0,droneSY:0,droneSZ:0,weapons:[20,0,0,0],currentWeapon:0,beacons:0,reload:0,hp:100},{x:212,y:0,z:44,speed:0,dir:3*Math.PI/4,aimH:Math.PI/4,aimY:3*Math.PI/4,droneX:0,droneY:0,droneZ:0,droneSX:0,droneSY:0,droneSZ:0,weapons:[20,0,0,0],currentWeapon:0,beacons:0,reload:0,hp:100},{x:212,y:0,z:212,speed:0,dir:-3*Math.PI/4,aimH:Math.PI/4,aimY:-3*Math.PI/
4,droneX:0,droneY:0,droneZ:0,droneSX:0,droneSY:0,droneSZ:0,weapons:[20,0,0,0],currentWeapon:0,beacons:0,reload:0,hp:100},{x:44,y:0,z:212,speed:0,dir:-Math.PI/4,aimH:Math.PI/4,aimY:-Math.PI/4,droneX:0,droneY:0,droneZ:0,droneSX:0,droneSY:0,droneSZ:0,weapons:[20,0,0,0],currentWeapon:0,beacons:0,reload:0,hp:100}];this.timer=-50;this.shells=[];this.beacons=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];this.crates=[];this.explosions=[];this.useDroneView=!1;this.gameCondition=-1},loadLevel:function(){this.seed=
.1;this.ground=[];for(var a=0;256>a;++a)for(var b=0;256>b;++b)this.ground.push(0);this.performDiamondSquareStep(0,0,256,30);for(a=0;256>a;++a)for(b=0;256>b;++b){var c=Math.min(b,a,256-b,256-a)+2*Math.sin((b+a)/5);16>c&&this.setLandscapeHeightAt(b,a,Math.max(this.landscapeHeightAt(b,a),10-10*Math.cos((16-c)*Math.PI/10)))}for(a=0;4>a;++a)this.playerData[a].y=this.landscapeHeightAt(this.playerData[a].x,this.playerData[a].z)},landscapeHeightAtFloat:function(a,b){var c=Math.floor(a),e=Math.floor(b),d=
a-c,g=b-e;return(1-d)*((1-g)*this.landscapeHeightAt(c,e)+g*this.landscapeHeightAt(c,e+1))+d*((1-g)*this.landscapeHeightAt(c+1,e)+g*this.landscapeHeightAt(c+1,e+1))},landscapeHeightAt:function(a,b){return this.ground[((b&255)<<8)+(a&255)]},setLandscapeHeightAt:function(a,b,c){this.ground[((b&255)<<8)+(a&255)]=c},controlledRandom:function(){return this.seed=3.9*this.seed*(1-this.seed)},performDiamondSquareStep:function(a,b,c,e){var d=this.landscapeHeightAt(a,b),g=this.landscapeHeightAt(a+c,b),f=this.landscapeHeightAt(a,
b+c),h=this.landscapeHeightAt(a+c,b+c);c>>=1;(33>a+c||223<a)&&(33>b+c||223<b)&&(e=0);var k=this.landscapeHeightAt(a+c,b);0==k&&this.setLandscapeHeightAt(a+c,b,k=.5*(d+g)+e*(this.controlledRandom()-.5));var l=this.landscapeHeightAt(a,b+c);0==l&&this.setLandscapeHeightAt(a,b+c,l=.5*(d+f)+e*(this.controlledRandom()-.5));d=this.landscapeHeightAt(a+2*c,b+c);0==d&&this.setLandscapeHeightAt(a+2*c,b+c,d=.5*(g+h)+e*(this.controlledRandom()-.5));g=this.landscapeHeightAt(a+c,b+2*c);0==g&&this.setLandscapeHeightAt(a+
c,b+2*c,g=.5*(f+h)+e*(this.controlledRandom()-.5));0==this.landscapeHeightAt(a+c,b+c)&&this.setLandscapeHeightAt(a+c,b+c,.25*(k+l+d+g)+e*(this.controlledRandom()-.5));1<c&&(e*=.5,this.performDiamondSquareStep(a,b,c,e),this.performDiamondSquareStep(a+c,b,c,e),this.performDiamondSquareStep(a,b+c,c,e),this.performDiamondSquareStep(a+c,b+c,c,e))},startNewGame:function(){this.initialize();this.gameCondition=0;this.loadLevel()},initiateExplosion:function(a,b,c,e,d){this.explosions.push({x:a,y:b,z:c,range:e,
t0:this.timer});for(var g=0;g<this.playerData.length;++g){var f=this.playerData[g],h=Math.pow(f.x-a,2)+Math.pow(f.y+3-b,2)+Math.pow(f.z-c,2);h<e*e&&(f.hp=Math.max(0,f.hp-d*(1-Math.sqrt(h)/e)),0==g&&.01>f.hp&&(this.gameCondition=1))}},playerShoots:function(a){a=this.playerData[a];if(0<a.weapons[a.currentWeapon]&&(a.reload=50,this.shells.push({type:a.currentWeapon,timer:0,x:a.x+Math.cos(a.aimY)*Math.cos(a.aimH)*10,y:a.y+5+10*Math.sin(a.aimH),z:a.z+Math.sin(a.aimY)*Math.cos(a.aimH)*10,dx:Math.cos(a.aimY)*
Math.cos(a.aimH)*3,dy:3*Math.sin(a.aimH),dz:Math.sin(a.aimY)*Math.cos(a.aimH)*3}),--a.weapons[a.currentWeapon],0==a.weapons[a.currentWeapon])){for(var b=0;4>b&&!a.weapons[b];++b);a.currentWeapon=b&3}},dropCrate:function(){for(var a=0,b=0,c=0,e=0;e<this.beacons.length;++e)-1<this.beacons[e]&&(a+=32+64*(e&3),b+=32+64*(e>>2),++c);c&&(a=Math.max(8,Math.min(248,a/c+64*this.controlledRandom()-32)),b=Math.max(8,Math.min(248,b/c+64*this.controlledRandom()-32)),c=Math.floor(4*this.controlledRandom()),this.crates.push({x:a,
y:100,z:b,onGround:!1,speedY:0,shellType:c,shellCount:[20,5,5,5][c],groundY:2+Math.min(this.landscapeHeightAtFloat(a-2,b-2),this.landscapeHeightAtFloat(a+1,b-2),this.landscapeHeightAtFloat(a-2,b+2),this.landscapeHeightAtFloat(a+1,b+2))}))},detectCollisions:function(a){for(var b=this.playerData[a],c=[[2.5,3.5],[0,3.5],[-2.5,3.5],[-2.5,0],[-2.5,-3.5],[0,-3.5],[2.5,-3.5],[2.5,0]],e=["Armor piercing","Explosive","Splitter","Delay-action"],d=0;8>d;++d){var g=b.x+b.speed*Math.cos(b.dir)+c[d][0]*Math.cos(b.dir)-
c[d][1]*Math.sin(b.dir),f=b.z+b.speed*Math.sin(b.dir)+c[d][0]*Math.sin(b.dir)+c[d][1]*Math.cos(b.dir),h=b.y;if(10>g||246<g||10>f||246<f)b.speed=0;for(var k=0;k<this.crates.length;++k){var l=this.crates[k];g>l.x-2-.5&&g<l.x+2+.5&&f>l.z-2-.5&&f<l.z+2+.5&&h>l.y-6&&(b.weapons[l.shellType]+=l.shellCount,1>b.weapons[b.currentWeapon]&&(b.currentWeapon=l.shellType),a==this.playerId&&(this.message="+"+l.shellCount+" "+e[l.shellType]+" shells",this.messageTimer=this.timer),this.crates.splice(k,1),--k)}for(k=
0;4>k;++k)if(k!=a){var m=this.playerData[k];l=Math.cos(m.dir)*(g-m.x)+Math.sin(m.dir)*(f-m.z);var n=-Math.sin(m.dir)*(g-m.x)+Math.cos(m.dir)*(f-m.z);-3.5<l&&3.5>l&&-2.5<n&&2.5>n&&(b.speed=0,m.speed=0)}}for(k=0;k<this.shells.length;++k)a=this.shells[k],l=Math.cos(b.dir)*(a.x-b.x)+Math.sin(b.dir)*(a.z-b.z),n=-Math.sin(b.dir)*(a.x-b.x)+Math.cos(b.dir)*(a.z-b.z),-3.5<l&&3.5>l&&-2.5<n&&2.5>n&&h>a.y-6&&(this.initiateExplosion(a.x,a.y,a.z,[10,20,10,13][a.type],[30,60,30,40][a.type]),this.shells.splice(k,
1),--k)},animateItems:function(){++this.timer;if(!(0>this.timer)){2999<this.timer&&(this.gameCondition=3);for(var a=!1,b=1;b<this.playerData.length;++b).01<this.playerData[b].hp&&(this.aiPlayers[b-1].playOneFrame(this),a=!0);a||(this.gameCondition=5);for(b=0;b<this.playerData.length;++b)this.detectCollisions(b),this.playerData[b].x+=this.playerData[b].speed*Math.cos(this.playerData[b].dir),this.playerData[b].z+=this.playerData[b].speed*Math.sin(this.playerData[b].dir),this.playerData[b].y=this.landscapeHeightAtFloat(this.playerData[b].x,
this.playerData[b].z),0<this.playerData[b].droneY&&(this.playerData[b].droneX+=this.playerData[b].droneSX,this.playerData[b].droneY+=this.playerData[b].droneSY,this.playerData[b].droneZ+=this.playerData[b].droneSZ,this.playerData[b].droneSY-=0>this.playerData[b].droneSY?.001:.01,this.playerData[b].droneY<this.landscapeHeightAtFloat(this.playerData[b].droneX,this.playerData[b].droneZ)&&(this.playerData[b].droneY=-2,this.useDroneView=!1)),this.playerData[b].speed*=.95,.01>Math.abs(this.playerData[b].speed)&&
(this.playerData[b].speed=0),this.playerData[b].reload=Math.max(this.playerData[b].reload-1,0);for(b=0;b<this.playerData.length;++b)if(a=(this.playerData[b].z+35)%64,6>(this.playerData[b].x+35)%64&&6>a){a=Math.floor(this.playerData[b].x/64);var c=Math.floor(this.playerData[b].z/64),e=this.beacons[a+4*c];0<=e&&--this.playerData[e].beacons;this.beacons[a+4*c]=b;++this.playerData[b].beacons;7<this.playerData[b].beacons&&(this.gameCondition=0==b?6:2)}for(b=0;b<this.shells.length;++b)if(a=this.shells[b],
a.timer)--a.timer,0==a.timer&&(this.initiateExplosion(a.x,a.y,a.z,[6,12,6,8][a.type],[30,60,30,40][a.type]),this.shells.splice(b,1),--b);else{a.x+=a.dx;a.y+=a.dy;a.z+=a.dz;a.dy-=.05;if(2==a.type&&-.3>a.dy){for(c=0;6>c;++c)this.shells.push({type:0,timer:0,x:a.x,y:a.y,z:a.z,dx:a.dx+Math.cos(c*Math.PI/3),dy:a.dy,dz:a.dz+Math.sin(c*Math.PI/3)});this.shells.splice(b,1);--b}a.y<this.landscapeHeightAtFloat(a.x,a.z)&&(3==a.type?(a.dx=a.dy=a.dz=0,a.y=this.landscapeHeightAtFloat(a.x,a.z),a.timer=125):(this.initiateExplosion(a.x,
a.y,a.z,[5,10,5,5][a.type],[30,60,30,30][a.type]),this.shells.splice(b,1),--b))}for(b=0;b<this.shells.length;++b){a=this.shells[b];e=[];for(c=0;c<this.crates.length;++c){var d=this.crates[c];a.x>d.x-2.5&&a.x<d.x+2.5&&a.y>d.y-2.5&&a.y<d.y+2.5&&a.z>d.z-2.5&&a.z<d.z+2.5&&e.unshift(c)}if(e.length){for(c=0;c<e.length;++c)this.crates.splice(e[c],1);this.initiateExplosion(a.x,a.y,a.z,25,120);this.shells.splice(b,1);--b}}for(b=0;b<this.crates.length;++b)this.crates[b].hitGround||(this.crates[b].y<20+this.crates[b].groundY&&
(this.crates[b].speedY*=.95),this.crates[b].speedY-=.01,this.crates[b].y+=this.crates[b].speedY,this.crates[b].y<this.crates[b].groundY&&(this.crates[b].hitGround=!0,this.crates[b].y=this.crates[b].groundY));0==this.timer%500&&this.dropCrate();for(b=0;b<this.explosions.length;++b)25<this.timer-this.explosions[b].t0&&(this.explosions.splice(b,1),--b)}},processControls:function(){var a=this.playerData[this.playerId];a.dir+=(this.controls.customKeyStatus[1]?.1:0)+(this.controls.customKeyStatus[3]?-.1:
0);a.speed=Math.min(1,Math.max(-1,a.speed+(this.controls.customKeyStatus[0]?.1:0)-(this.controls.customKeyStatus[2]?.1:0)));a.aimY=a.dir+Math.PI*(1-2*this.controls.worldDX);a.aimH=.7*(1-this.controls.worldDY);this.controls.leftMouseButton&&!a.reload&&(this.controls.acknowledgeLeftMouseClick(),this.playerShoots(this.playerId));if(this.controls.rightMouseButton){if(1>a.weapons[0]+a.weapons[1]+a.weapons[2]+a.weapons[3])a.currentWeapon=0;else for(a.currentWeapon=a.currentWeapon+1&3;0==a.weapons[a.currentWeapon];)a.currentWeapon=
a.currentWeapon+1&3;this.controls.acknowledgeRightMouseClick()}this.controls.customKeyStatus[4]&&-1<a.droneY&&(this.controls.customKeyStatus[4]=!1,(this.useDroneView=!this.useDroneView)&&0==a.droneX&&(a.droneX=a.x,a.droneY=a.y+5,a.droneZ=a.z,a.droneSY=3));this.controls.controlEscape&&(this.gameCondition=4,this.controls.totalClear())}};function AIPlayer(a){this.playerId=a;this.moveTargetZ=this.moveTargetX=0;this.shootTarget=(a+1)%4}
AIPlayer.prototype={playOneFrame:function(a){var b=a.playerData[this.playerId],c=Math.sqrt(Math.pow(this.moveTargetZ-b.z,2)+Math.pow(this.moveTargetX-b.x,2));(!this.moveTargetX||0==a.timer%50||2>c)&&this.defineTarget(a);for(c=Math.atan2(this.moveTargetZ-b.z,this.moveTargetX-b.x)-b.dir;c<-Math.PI;)c+=2*Math.PI;for(;c>Math.PI;)c-=2*Math.PI;for(var e=Math.atan2(-this.moveTargetZ+b.z,-this.moveTargetX+b.x)-b.dir;e<-Math.PI;)e+=2*Math.PI;for(;e>Math.PI;)e-=2*Math.PI;var d=Math.abs(c)<Math.abs(e)?c:e;b.dir=
0<d?b.dir+Math.min(.1,d):b.dir+Math.max(-.1,d);c=.1<Math.abs(d)?0:Math.abs(c)<Math.abs(e)?1:-1;b.speed=c>b.speed?Math.min(1,c,b.speed+.1):Math.max(-1,c,b.speed-.1);c=a.playerData[this.shootTarget].x;e=a.playerData[this.shootTarget].z;d=Math.atan2(e-b.z,c-b.x);b.aimY=d>b.aimY?Math.min(b.aimY+.1,d):Math.max(b.aimY-.1,d);c=Math.sqrt(Math.pow(e-b.z,2)+Math.pow(c-b.x,2));if(1>b.reload&&500>c){for(c=0;4>c;++c)0<b.weapons[c]&&(b.currentWeapon=c);a.playerShoots(this.playerId)}},timeToTarget:function(a,b,
c){b-=a.playerData[this.playerId].x;a=c-a.playerData[this.playerId].z;return 10*Math.min(Math.abs(Math.atan2(a,b)),Math.abs(Math.atan2(-a,-b)))+1.1*Math.sqrt(b*b+a*a)},distanceFromNearestOpponent:function(a,b,c){for(var e=9999,d=0;4>d;++d)if(d!=this.playerId){var g=b-a.playerData[d].x,f=c-a.playerData[d].z;e=Math.min(e,Math.sqrt(g*g+f*f))}return e},defineTarget:function(a){for(var b=9999,c=0;16>c;++c){var e=32+64*(c&3),d=32+64*(c>>2);if(a.beacons[c]!=this.playerId){var g=this.timeToTarget(a,e,d),
f=this.distanceFromNearestOpponent(a,e,d);f*=1+1/f;g-=.5*f;g<b&&(this.moveTargetX=e,this.moveTargetZ=d,b=g)}}for(c=0;c<a.crates.length;++c)g=this.timeToTarget(a,a.crates[c].x,a.crates[c].z),f=this.distanceFromNearestOpponent(a,a.crates[c].x,a.crates[c].z),f*=1+1/f,g-=.5*f,g<b&&(this.moveTargetX=a.crates[c].x,this.moveTargetZ=a.crates[c].z,b=g);b=0;e=1==this.playerId;for(c=1;4>c;++c){var h=(this.playerId+c)%4;d=a.playerData[h].hp;e&&(d=120-d);d>b&&101>d&&(this.shootTarget=h,b=d)}b=Math.pow(a.playerData[h].x-
a.playerData[this.playerId].x,2)+Math.pow(a.playerData[h].z-a.playerData[this.playerId].z,2);e=this.shootTarget;d=b;for(c=1;4>c;++c)h=(this.playerId+c)%4,g=Math.pow(a.playerData[h].x-a.playerData[this.playerId].x,2)+Math.pow(a.playerData[h].z-a.playerData[this.playerId].z,2),g<d&&(d=g,e=h);4*d<b&&(this.shootTarget=e)}};function Controls(a){this.windowLayout=!1;this.persistentData=a;this.mouseY=this.mouseX=0;this.worldDX=.5;this.worldDY=0;this.totalClear()}
Controls.prototype={totalClear:function(){this.controlEscape=this.controlFire=this.controlDown=this.controlUp=this.rightMouseButton=this.leftMouseButton=!1;this.customKeyStatus=[!1,!1,!1,!1,!1]},onKeyUp:function(a){return!this.keyControl(a,!1)},onKeyDown:function(a){return!this.keyControl(a,!0)},redefineCustomKey:function(a,b){var c=this.persistentData.data.keys[a];this.persistentData.setKey(a,b);return c},keyControl:function(a,b){var c=!0;var e=window.event?window.event.keyCode:a.which;switch(e){case 38:this.controlUp=
b;break;case 40:this.controlDown=b;break;case 32:case 13:this.controlFire=b;break;case 27:case 80:this.controlEscape=b;break;case 87:this.customKeyStatus[0]=b;break;case 65:this.customKeyStatus[1]=b;break;default:c=!1}for(var d=0;6>d;++d)e==this.persistentData.data.keys[d]&&(this.customKeyStatus[d]=b,c=!0);return c},onMouseUp:function(a){this.rightMouseButton=this.leftMouseButton=!1;return!0},onMouseDown:function(a){a.buttons&1&&(this.leftMouseButton=!0);a.buttons&2&&(this.rightMouseButton=!0);return!0},
onTouchStart:function(a){this.onMouseMove(a);return this.onMouseDown(a)},onTouchEnd:function(a){a.preventDefault();return this.onMouseUp(a)},onTouchMove:function(a){a.preventDefault();return this.onMouseMove(a)},onVRTrigger:function(a){event={buttons:1};if(a.value)this.onMouseDown(event);else this.onMouseUp(event)},onVRMainButton:function(a){event={buttons:2};if(a.value)this.onMouseDown(event);else this.onMouseUp(event)},onVRSecondaryButton:function(a){this.customKeyStatus[4]=a.value?!0:!1},onVRThumbStick:function(a){this.customKeyStatus[0]=
.1<a.y;this.customKeyStatus[1]=-.1>a.x;this.customKeyStatus[2]=-.1>a.y;this.customKeyStatus[3]=.1<a.x},acknowledgeLeftMouseClick:function(){this.leftMouseButton=!1},acknowledgeRightMouseClick:function(){this.rightMouseButton=!1},onMouseMove:function(a){var b=0,c=0;"changedTouches"in a&&0<a.changedTouches.length&&(b=a.changedTouches[0].clientX,c=a.changedTouches[0].clientY);"clientX"in a&&"clientY"in a&&(b=a.clientX,c=a.clientY);this.windowLayout&&(this.mouseX=b,this.mouseY=c,this.worldDX=this.mouseX/
this.windowLayout.playArea[0],this.worldDY=this.mouseY/this.windowLayout.playArea[1]);return!0},onLayoutChange:function(a){this.windowLayout=a}};function Game(a,b){this.controls=a;this.persistentData={};this.world=new World(a);this.state=-1}
Game.prototype={launch:function(){this.changeState(0);this.intervalId=setInterval(function(){game.mainLoop()},40);requestAnimationFrame(function(){game.renderLoop()})},changeState:function(a){this.controls.totalClear();this.state=a},mainLoop:function(){0==this.state&&(this.controls.controlEscape||this.controls.controlFire||this.controls.leftMouseButton)&&(this.world.startNewGame(),this.renderer.resetSceneGraph(),this.changeState(1));1==this.state&&(this.world.processControls(),this.world.animateItems(),
0<this.world.gameCondition&&this.changeState(4==this.world.gameCondition?2:3));2==this.state&&(this.controls.controlEscape||this.controls.controlFire)&&(this.world.gameCondition=0,this.changeState(1));3==this.state&&(this.controls.controlEscape||this.controls.controlFire||this.controls.leftMouseButton)&&this.changeState(0)},renderLoop:function(){this.renderer.drawMain();this.renderer.drawMessage();requestAnimationFrame(function(){game.renderLoop()})},setRenderer:function(a){this.renderer=a},storeData:function(){localStorage.setItem("LineOfFireData",
JSON.stringify(this.persistentData))},layoutChanged:function(a){this.controls.onLayoutChange(a)}};
function main(){controls=new Controls(new PersistentData);"ontouchstart"in document.documentElement?(document.ontouchstart=function(a){return controls.onTouchStart(a)},document.ontouchenter=function(a){return controls.onTouchStart(a)},document.ontouchend=function(a){return controls.onTouchEnd(a)},document.ontouchleave=function(a){return controls.onTouchEnd(a)},document.ontouchmove=function(a){return controls.onTouchMove(a)}):(document.onmousedown=function(a){return controls.onMouseDown(a)},document.onmouseup=
function(a){return controls.onMouseUp(a)},document.onmousemove=function(a){return controls.onMouseMove(a)});document.onkeydown=function(a){return controls.onKeyDown(a)};document.onkeyup=function(a){return controls.onKeyUp(a)};document.oncontextmenu=function(a){return!1};var a=localStorage.getItem("LineOfFireData"),b={};a&&(b=JSON.parse(a));game=new Game(controls,b);renderer=new Renderer(document.getElementById("c"),document.getElementById("o"),game);window.addEventListener("resize",function(a){renderer.resizeWindow()});
game.setRenderer(renderer);game.launch()}window.addEventListener("DOMContentLoaded",main);function registerControllerEvents(a){a.onTriggerStateChangedObservable.add(function(a){controls.onVRTrigger(a)});a.onMainButtonStateChangedObservable.add(function(a){controls.onVRMainButton(a)});a.onSecondaryButtonStateChangedObservable.add(function(a){controls.onVRSecondaryButton(a)});a.onPadValuesChangedObservable.add(function(a){controls.onVRThumbStick(a)})};