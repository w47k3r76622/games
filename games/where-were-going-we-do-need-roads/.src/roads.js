"use strict";function lerp(e,n,t){return e*(1-t)+n*t}function easeInOutQuad(e){return e<.5?2*e*e:2*e*(2-e)-1}function clamp(e,n,t){return e<n?n:e>t?t:e}function shuffle(e){for(var n,t,a=e.length;a;)n=Math.floor(Math.random()*a),t=e[--a],e[a]=e[n],e[n]=t}function setSize(e,n,t){e.style[n]=t+"px"}function handleResize(){var e=window.innerWidth,n=window.innerHeight;e/n>aspect?e=n*aspect:n=e/aspect,cscale=CANVAS_WIDTH/e,setSize(container,"width",e),setSize(container,"height",n),setSize(container,"left",.5*(window.innerWidth-e)),setSize(container,"top",.5*(window.innerHeight-n));var t=.5*e/CANVAS_WIDTH,a="scale3d("+t+","+t+",1)";startScreen.style[transformProperty]=a,endScreen.style[transformProperty]=a}function makeSprite(e,n,t){var a=document.createElement("canvas");return a.width=e,a.height=n,t(a.getContext("2d")),a}function makeSprite2(e,n,t,a){return makeSprite(e,n,function(o){o.scale(3,3),e/=3,n/=3;for(var r=0;r<n;++r)for(var c=0;c<e;++c)" "!=t[r][c]&&(o.fillStyle=a[+t[r][c]],o.fillRect(c,n-r-1,1,1))})}function cancel(e){var n=e.target;"INPUT"!=n.tagName&&"LABEL"!=n.tagName&&"start"!=n.id&&"reset"!=n.id||e.stopPropagation()}function start(){container.removeChild(startScreen),aa.play("new"),(isMobile||cscale>1)&&document.body.requestFullscreen&&document.body.requestFullscreen(),init()}function gameover(){document.getElementById("dist").innerHTML=formatDistance(distance),endScreen.style.display="block",aa.play("die"),doDanger=!1,nextDanger=NO_DANGER,dangerTimer&&clearTimeout(dangerTimer),CAR_COLOR[2]=CAR_VARIANTS[Math.floor(3*Math.random())],carSprite=makeSprite2(60,39,car,CAR_COLOR),wheelSprites[0]=wheelSprites[4]=makeSprite2(24,24,wheel0,CAR_COLOR),wheelSprites[1]=makeSprite2(24,24,wheel1,CAR_COLOR),wheelSprites[2]=makeSprite2(24,24,wheel2,CAR_COLOR),wheelSprites[3]=makeSprite2(24,24,wheel3,CAR_COLOR)}function reset(){endScreen.style.display="none",aa.play("new"),pointer.dragging=!1,init()}function setPointerPosition(e){pointer.x=(e.clientX-container.offsetLeft)*cscale,pointer.y=(e.clientY-container.offsetTop)*cscale}function makeColumns(){for(var e={height:STARTING_HEIGHT,danger:NO_DANGER,next:null},n=e,t=COLUMN_COUNT-1;t;--t)n=n.next={height:STARTING_HEIGHT,danger:NO_DANGER,next:null};return n.next=e,[e,n]}function getColumn(e){for(var n=colBegin,t=-colOffset;n!=colEnd;){if((t+=COLUMN_WIDTH)>e)return n;n=n.next}return colEnd}function initializePlayer(){y=CANVAS_HEIGTH-60,vy=0,normal.set(0,1),angle=targetAngle=0,isAlive=isFlying=isJumping=!0,distance=0}function hasCollided(e){var n=e.a,t=e.b,a=e.a2,o=e.b2;return-1!=n&&y+R>=n&&y-R<n+t||-1!=a&&y+R>=a&&y-R<a+o}function updatePlayer(){if(isAlive){y+=vy,vy+=G;var e=getColumn(x+20*scrollAccel);hasCollided(e.danger)&&(isAlive=!1,gameover());var n=(colOffset+HALF_COLUMN_WIDTH)/COLUMN_WIDTH;a.set(n*COLUMN_WIDTH,yTouch=lerp(e.height,e.next.height,easeInOutQuad(n))),y-R_CONTACT<yTouch?(b.set((n+.05)*COLUMN_WIDTH,lerp(e.height,e.next.height,easeInOutQuad(n+.05))),normal.setNormal(a,b),isJumping&&aa.play("hit"),isFlying=isJumping=!1,scrollAccel=clamp(scrollAccel+normal.x,-4,2)):isFlying=!0,yTouch<0&&(yTouch=0),y-R<yTouch&&(vy+=(yTouch+R-y)*IMPACT_FRICTION,y=yTouch+R,vy>.5*MAXIMUM_Y_VELOCITY&&(isJumping=!0,aa.play("jmp")),vy>MAXIMUM_Y_VELOCITY?vy=MAXIMUM_Y_VELOCITY:vy<0&&(vy*=-IMPACT_FRICTION)),distance+=4*T*(scrollSpeed+scrollAccel)}}function formatDistance(e){return e<1e3?Math.floor(e)+" m":(.001*e).toFixed(1)+" km"}function paintPlayer(e){isAlive&&(isFlying?targetAngle-=.005*Math.PI:targetAngle=Math.atan2(normal.y,normal.x)-.5*Math.PI,angle+=clamp(targetAngle-angle,.05*-Math.PI,.05*Math.PI),canvas.save(),canvas.translate(x+20*scrollAccel,y+(vy<0?vy-G:vy)*e),canvas.rotate(angle),wn=(wn+1)%4,canvas.drawImage(carSprite,-33,isFlying?-9:-12),canvas.drawImage(wheelSprites[wn],-36,-21),canvas.drawImage(wheelSprites[wn+1],9,-21),canvas.restore(),canvas.save(),canvas.scale(1,-1),canvas.fillStyle="#FFF",canvas.fillText("Distance: "+formatDistance(distance),.4*CANVAS_WIDTH,.94*-CANVAS_HEIGTH),canvas.restore())}function initializeCanvas(){canvas.translate(0,CANVAS_HEIGTH),canvas.scale(1,-1),canvas.font="bold 24px 'Segoe UI','Helvetica Neue',sans-serif"}function paintColumn(e,n){canvas.drawImage(columnSprite,e-HALF_COLUMN_WIDTH,-n.height),-1!=n.danger.a&&canvas.fillRect(e-HALF_COLUMN_WIDTH,-n.danger.a-n.danger.b,COLUMN_WIDTH+.5,n.danger.b),-1!=n.danger.a2&&canvas.fillRect(e-HALF_COLUMN_WIDTH,-n.danger.a2-n.danger.b2,COLUMN_WIDTH+.5,n.danger.b2)}function paintEasing(e,n,t){canvas.beginPath(),canvas.moveTo(e,n);for(var a=0;a<=EASING_POINTS;++a){var o=a*EASING_STEP;canvas.lineTo(e+o*COLUMN_WIDTH,lerp(n,t,easeInOutQuad(o)))}canvas.lineWidth=1,canvas.strokeStyle="#E91E63",canvas.stroke()}function paintColumns(e){canvas.save(),canvas.scale(1,-1),canvas.fillStyle=dangerPattern;for(var n=colBegin;e-HALF_COLUMN_WIDTH<CANVAS_WIDTH;)paintColumn(e,n),n=n.next,e+=COLUMN_WIDTH;canvas.restore()}function paintImpendingDoom(e){canvas.fillStyle=dangerPattern,-1!=e.a&&(canvas.fillRect(0,e.a,HALF_COLUMN_WIDTH,e.b),canvas.fillRect(CANVAS_WIDTH-HALF_COLUMN_WIDTH,e.a,HALF_COLUMN_WIDTH,e.b)),-1!=e.a2&&(canvas.fillRect(0,e.a2,HALF_COLUMN_WIDTH,e.b2),canvas.fillRect(CANVAS_WIDTH-HALF_COLUMN_WIDTH,e.a2,HALF_COLUMN_WIDTH,e.b2))}function paint(e,n){canvas.clearRect(0,0,CANVAS_WIDTH,CANVAS_HEIGTH),paintColumns(-(colOffset+n*scrollSpeed)),paintPlayer(n),nextDanger!==NO_DANGER&&!doDanger&&(255&e)<127&&paintImpendingDoom(nextDanger)}function initializeDanger(){for(var e=colBegin,n=COLUMN_COUNT;n;--n)e.danger=NO_DANGER,e=e.next;nextDanger=NO_DANGER,doDanger=!1,dangerTimer=setTimeout(scheduleDanger,dangerPause=DANGER_PAUSE_EASY)}function scheduleDanger(){nextDanger=getDanger(),dangerTimer=setTimeout(dangerBegin,BEFORE_DANGER)}function dangerBegin(){doDanger=!0,dangerTimer=setTimeout(dangerEnd,DANGER_DURATION*(.9+.2*Math.random()))}function dangerEnd(){doDanger=!1,nextDanger=NO_DANGER,dangerTimer=setTimeout(scheduleDanger,dangerPause=Math.max(dangerPause-200,DANGER_PAUSE_HARD))}function getDanger(){return nd==DANGER_TABLE.length&&(nd=0,shuffle(DANGER_TABLE)),DANGER_TABLE[nd++]}function update(){(colOffset+=scrollSpeed+scrollAccel)>=COLUMN_WIDTH&&(colOffset-=COLUMN_WIDTH,colEnd=colBegin,colBegin=colBegin.next,colEnd.danger=doDanger?nextDanger:NO_DANGER),pointer.dragging&&(getColumn(pointer.x).height=newHeight),updatePlayer()}function mainloop(e){for(requestAnimationFrame(mainloop),pointer.dragging&&(newHeight=clamp(CANVAS_HEIGTH-pointer.y,20,CANVAS_HEIGTH-60)),-1==then&&(then=e),t+=.001*(e-then),then=e;t>0;)t-=T,update();paint(e,t/T+1)}function initMusic(){for(var e=new sonant,n=0;n<8;++n)e.generate(n);(music=e.createAudio()).loop=!0,music.volume=.9}function initMainMenu(){isMobile&&(document.body.className="mobile");var e=document.getElementById("m"),n=document.getElementById("s");e.addEventListener("change",function(n){music&&(e.checked?(music.currentTime=0,music.play()):music.pause())}),n.addEventListener("change",function(e){aa.on=n.checked}),container.removeChild(loadingScreen),music&&music.play()}function init(){scrollAccel=0,initializePlayer(),initializeDanger()}var sonant=function(){function e(e){return Math.sin(6.283184*e)}function n(n){return e(n)<0?-1:1}function t(e){return e%1-.5}function a(e){var n=e%1*4;return n<2?n-1:3-n}function o(e){return.00390625*Math.pow(1.059463094,e-128)}var r,c,s=44100*song.songLen;!function(){var e=Math.ceil(Math.sqrt(2*s/2)),n=document.createElement("canvas").getContext("2d");r=n.createImageData(e,e).data;var t,a=n.createImageData(e,e).data;for(t=e*e*4-2;t>=0;t-=2)a[t]=0,a[t+1]=128;c=a}(),this.lps=44100/song.rowLen,this.generate=function(i){var l,_,f,d,u,v,m,g,A,p,h,C,R,y,x,T,N,S,I,O,E,L,D=[e,n,t,a],w=r,H=c,M=s,b=2*s*2,G=song.songData[i],q=song.rowLen,P=D[G.lfo_waveform],U=D[G.osc1_waveform],F=D[G.osc2_waveform],W=G.env_attack,k=G.env_sustain,B=G.env_release,V=Math.pow(2,G.fx_pan_freq-8)/q,z=Math.pow(2,G.lfo_freq-8)/q;for(f=0;f<b;f+=2)w[f]=0,w[f+1]=128;for(m=0,d=0;d<song.endPattern-1;++d)for(g=G.p[d],u=0;u<32;++u){if(g&&(v=G.c[g-1].n[u]))for(A=p=0,E=o(v+12*(G.osc1_oct-8)+G.osc1_det)*(1+8e-4*G.osc1_detune),L=o(v+12*(G.osc2_oct-8)+G.osc2_det)*(1+8e-4*G.osc2_detune),h=G.fx_resonance/255,C=R=0,l=W+k+B-1;l>=0;--l){switch(_=l+m,T=P(_*z)*G.lfo_amt/512+.5,N=1,l<W?N=l/W:l>=W+k&&(N-=(l-W-k)/B),x=E,G.lfo_osc1_freq&&(x+=T),G.osc1_xenv&&(x*=N*N),A+=x,I=U(A)*G.osc1_vol,x=L,G.osc2_xenv&&(x*=N*N),p+=x,I+=F(p)*G.osc2_vol,G.noise_fader&&(I+=(2*Math.random()-1)*G.noise_fader*N),I*=N/255,O=G.fx_freq,G.lfo_fx_freq&&(O*=T),O=1.5*Math.sin(3.141592*O/44100),C+=O*R,y=h*(I-R)-C,R+=O*y,G.fx_filter){case 1:I=y;break;case 2:I=C;break;case 3:I=R;break;case 4:I=C+y}x=e(_*V)*G.fx_pan_amt/512+.5,I*=39*G.env_master,S=w[_<<=2]+(w[_+1]<<8)+I*(1-x),w[_]=255&S,w[_+1]=S>>8&255,S=w[_+2]+(w[_+3]<<8)+I*x,w[_+2]=255&S,w[_+3]=S>>8&255}m+=q}for(d=G.fx_delay_time*q>>1,x=G.fx_delay_amt/255,v=0;v<M-d;++v)f=4*v,S=w[_=4*(v+d)]+(w[_+1]<<8)+(w[f+2]+(w[f+3]<<8)-32768)*x,w[_]=255&S,w[_+1]=S>>8&255,S=w[_+2]+(w[_+3]<<8)+(w[f]+(w[f+1]<<8)-32768)*x,w[_+2]=255&S,w[_+3]=S>>8&255;for(f=0;f<b;f+=2)S=H[f]+(H[f+1]<<8)+w[f]+(w[f+1]<<8)-32768,H[f]=255&S,H[f+1]=S>>8&255},this.createAudio=function(){var e,n,t,a,o,i,l,_,f=c,d=2*s*2;for(r=null,i=(o=d-8)-36,a=String.fromCharCode(82,73,70,70,255&o,o>>8&255,o>>16&255,o>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&i,i>>8&255,i>>16&255,i>>24&255),e=0;e<d;){for(t="",n=0;n<256&&e<d;++n,e+=2)_=(_=4*(f[e]+(f[e+1]<<8)-32768))<-32768?-32768:_>32767?32767:_,t+=String.fromCharCode(255&_,_>>8&255);a+=t}return l="data:audio/wav;base64,"+btoa(a),a=null,new Audio(l)},this.getData=function(e,n){for(var t=Math.floor(44100*e),a=0,o=[],r=c;a<2*n;a+=2){var s=4*(t+a)+1;o.push(e>0&&s<r.length?(r[s]+r[s-1]/256)/256:.5)}return o}},song={songLen:37,songData:[{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:3,osc2_oct:7,osc2_det:0,osc2_detune:7,osc2_xenv:0,osc2_vol:201,osc2_waveform:3,noise_fader:0,env_attack:789,env_sustain:1234,env_release:13636,env_master:191,fx_filter:2,fx_freq:5839,fx_resonance:254,fx_delay_time:6,fx_delay_amt:121,fx_pan_freq:6,fx_pan_amt:147,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:6,lfo_amt:195,lfo_waveform:0,p:[1,2,0,0,1,2,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c:[{n:[154,0,154,0,152,0,147,0,0,0,0,0,0,0,0,0,154,0,154,0,152,0,157,0,0,0,156,0,0,0,0,0]},{n:[154,0,154,0,152,0,147,0,0,0,0,0,0,0,0,0,154,0,154,0,152,0,157,0,0,0,159,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:2,osc2_oct:8,osc2_det:0,osc2_detune:18,osc2_xenv:1,osc2_vol:191,osc2_waveform:2,noise_fader:0,env_attack:3997,env_sustain:56363,env_release:1e5,env_master:255,fx_filter:2,fx_freq:392,fx_resonance:255,fx_delay_time:8,fx_delay_amt:69,fx_pan_freq:5,fx_pan_amt:67,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:4,lfo_amt:57,lfo_waveform:3,p:[1,2,1,2,1,2,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c:[{n:[130,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[123,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:8,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:0,osc1_waveform:0,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:0,osc2_waveform:0,noise_fader:60,env_attack:50,env_sustain:419,env_release:4607,env_master:130,fx_filter:1,fx_freq:10332,fx_resonance:120,fx_delay_time:4,fx_delay_amt:16,fx_pan_freq:5,fx_pan_amt:108,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:5,lfo_amt:187,lfo_waveform:0,p:[0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c:[{n:[0,0,147,0,0,0,147,147,0,0,147,0,0,147,0,147,0,0,147,0,0,0,147,147,0,0,147,0,0,147,0,147]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:255,osc1_waveform:0,osc2_oct:7,osc2_det:0,osc2_detune:0,osc2_xenv:1,osc2_vol:255,osc2_waveform:0,noise_fader:0,env_attack:50,env_sustain:150,env_release:4800,env_master:200,fx_filter:2,fx_freq:600,fx_resonance:254,fx_delay_time:0,fx_delay_amt:0,fx_pan_freq:0,fx_pan_amt:0,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c:[{n:[147,0,0,0,0,0,0,0,147,0,0,0,0,0,0,0,147,0,0,0,0,0,0,0,147,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:2,osc2_oct:7,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:154,osc2_waveform:2,noise_fader:0,env_attack:2418,env_sustain:1075,env_release:10614,env_master:240,fx_filter:3,fx_freq:2962,fx_resonance:255,fx_delay_time:6,fx_delay_amt:117,fx_pan_freq:3,fx_pan_amt:73,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:5,lfo_amt:124,lfo_waveform:0,p:[0,0,0,0,1,2,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c:[{n:[154,0,154,0,152,0,147,0,0,0,0,0,0,0,0,0,154,0,154,0,152,0,157,0,0,0,156,0,0,0,0,0]},{n:[154,0,154,0,152,0,147,0,0,0,0,0,0,0,0,0,154,0,147,0,152,0,157,0,0,0,159,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:1,osc2_oct:6,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:192,osc2_waveform:1,noise_fader:0,env_attack:137,env_sustain:2e3,env_release:4611,env_master:192,fx_filter:1,fx_freq:982,fx_resonance:89,fx_delay_time:6,fx_delay_amt:25,fx_pan_freq:6,fx_pan_amt:77,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:3,lfo_amt:69,lfo_waveform:0,p:[1,2,1,3,1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c:[{n:[130,0,130,0,142,0,130,130,0,142,130,0,142,0,130,0,130,0,130,0,142,0,130,130,0,142,130,0,142,0,130,0]},{n:[123,0,123,0,135,0,123,123,0,135,123,0,135,0,123,0,123,0,123,0,135,0,123,123,0,135,123,0,135,0,123,0]},{n:[135,0,135,0,147,0,135,135,0,147,135,0,147,0,135,0,135,0,135,0,147,0,135,135,0,147,135,0,147,0,135,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:3,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:255,osc2_waveform:0,noise_fader:127,env_attack:22,env_sustain:88,env_release:3997,env_master:255,fx_filter:3,fx_freq:4067,fx_resonance:234,fx_delay_time:4,fx_delay_amt:33,fx_pan_freq:2,fx_pan_amt:84,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:3,lfo_amt:28,lfo_waveform:0,p:[0,0,1,2,1,2,1,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c:[{n:[0,0,142,0,154,0,0,0,142,0,0,0,154,0,0,0,0,0,142,0,154,0,0,0,142,0,0,0,154,0,0,0]},{n:[0,0,147,0,154,0,0,0,147,0,0,0,154,0,0,0,0,0,147,0,154,0,147,0,0,0,154,0,0,0,154,0]},{n:[0,0,147,0,154,0,0,0,147,0,0,0,154,0,0,0,0,0,147,0,154,0,0,0,147,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:8,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:0,osc1_waveform:0,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:0,osc2_waveform:0,noise_fader:255,env_attack:140347,env_sustain:9216,env_release:133417,env_master:208,fx_filter:2,fx_freq:2500,fx_resonance:16,fx_delay_time:2,fx_delay_amt:157,fx_pan_freq:8,fx_pan_amt:207,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:2,lfo_amt:51,lfo_waveform:0,p:[0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c:[{n:[147,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]}],rowLen:5513,endPattern:9};if(!Element.prototype.requestFullscreen)try{Element.prototype.requestFullscreen=Element.prototype.mozRequestFullScreen||Element.prototype.msRequestFullscreen||Element.prototype.webkitRequestFullscreen}catch(e){}var AAudio=function(){function e(){this.on=!0,this.sounds={}}return e.prototype.add=function(e,n,t){this.sounds[e]={tick:0,count:n,pool:[]};for(var a=0;a<n;++a){var o=new Audio;o.src=window.SOUND(t),this.sounds[e].pool.push(o)}},e.prototype.play=function(e){if(this.on){var n=this.sounds[e];n.pool[n.tick].play(),++n.tick>=n.count&&(n.tick=0)}},e}(),aa=new AAudio,isMobile=null!=navigator.userAgent.match(/Android|iPhone|iPad/i);isMobile?aa.on=!1:(aa.add("new",1,[0,,.0108,.3989,.4412,.444,,,,,,.5147,.6024,,,,,,1,,,,,.5]),aa.add("jmp",1,[0,,.2086,,.2238,.3305,,.236,,,,,,.0687,,,,,.5894,,,.0532,,.5]),aa.add("hit",1,[1,,.2548,,.1007,.7539,.0996,-.5302,,,,,,.7769,-.4436,,,,1,,,,,.5]),aa.add("die",1,[1,.0013,.3576,.0681,.8007,.5117,,-.3453,.0049,.148,-.2563,-.2717,.2608,,-.3543,-.1884,-.0106,-.0281,.9971,-.6629,-.7531,.0097,-.0086,.5]));var CANVAS_WIDTH=960,CANVAS_HEIGTH=540,COLUMN_WIDTH=48,COLUMN_COUNT=CANVAS_WIDTH/COLUMN_WIDTH+2,STARTING_HEIGHT=.25*CANVAS_HEIGTH,EASING_POINTS=10,EASING_STEP=Math.pow(EASING_POINTS,-1),T=.02,HALF_COLUMN_WIDTH=.5*COLUMN_WIDTH,container=document.getElementById("container"),hcanvas=document.getElementById("canvas"),canvas=hcanvas.getContext("2d"),aspect=16/9,cscale=1,transformProperty="transform";transformProperty in container.style||(transformProperty="webkitTransform"),window.addEventListener("resize",handleResize),window.addEventListener("orientationchange",handleResize),hcanvas.addEventListener("contextmenu",function(e){e.preventDefault()});var grass=["2211112222111222","3222223333222333","3333033333333333","0333033303330333","0302030203030203","0301020102030102","0300010001020001","020  00  0010  0","010       00    "," 0              "],car=["    0000000000      ","   000101100110     ","  00000000100010    "," 001000000000000000 ","00221000000000001110","02222122222222222220","02222220020000222220"," 000002222222210000 ","      022222210     ","       0000000      ","        0000        ","  00000000000000000 ","  00000000000000000 "],wheel0=["  0000  "," 011110 ","01111110","00000000","00000000","02111120"," 022220 ","  0000  "],wheel1=["   000  ","  01110 "," 0001110","01000110","01100010","0211000 "," 02220  ","  000   "],wheel2=["  0000  "," 010010 ","01100110","01100110","01100110","02100120"," 020020 ","  0000  "],wheel3=["  000   "," 01110  ","0111000 ","01100010","01000110"," 0001120","  02220 ","   000  "],GRASS_COLOR=["#000","#00E700","#00C700","#008200"],GROUND_COLOR=["#422021","#844121","#A56121"],BRICK_COLOR=["#000","#A40000","#CC0000","#EF2929"],CAR_VARIANTS=["#607D8B","#D500F9","#F50057"],CAR_COLOR=["#000","#FFF",CAR_VARIANTS[Math.floor(3*Math.random())]],columnSprite=makeSprite(COLUMN_WIDTH,CANVAS_HEIGTH,function(e){e.save(),e.scale(8,8),e.fillStyle=GRASS_COLOR[0],e.fillRect(0,2,6,.125*CANVAS_HEIGTH-2);for(n=2;n<.125*CANVAS_HEIGTH;++n){for(t=0;t<6;++t)e.fillStyle=GROUND_COLOR[(n+t)%3],e.fillRect(t,n,1,1);e.globalAlpha-=.0125}e.restore(),e.scale(3,3),e.fillStyle=GRASS_COLOR[0],e.fillRect(1,0,14,1),e.fillRect(0,1,1,1),e.fillRect(15,1,1,1),e.fillStyle=GRASS_COLOR[2],e.fillRect(1,1,14,1),e.fillStyle=GRASS_COLOR[1],e.fillRect(0,2,16,1);for(var n=0;n<10;++n)for(var t=0;t<16;++t)" "!=grass[n][t]&&(e.fillStyle=GRASS_COLOR[+grass[n][t]],e.fillRect(t,n+3,1,1))}),dangerPattern=canvas.createPattern(makeSprite(COLUMN_WIDTH,.5*COLUMN_WIDTH,function(e){e.scale(3,3),e.fillStyle=BRICK_COLOR[2],e.fillRect(0,0,16,8),e.fillStyle=BRICK_COLOR[0],e.fillRect(8,0,1,3),e.fillRect(0,3,16,1),e.fillRect(0,4,1,3),e.fillRect(0,7,16,1),e.fillStyle=BRICK_COLOR[1],e.fillRect(7,0,1,3),e.fillRect(15,4,1,3),e.fillStyle=BRICK_COLOR[3],e.fillRect(9,0,1,3),e.fillRect(1,4,1,3),e.fillRect(0,0,7,1),e.fillRect(9,0,7,1),e.fillRect(1,4,14,1)}),"repeat"),carSprite=makeSprite2(60,39,car,CAR_COLOR),wheelSprites=[makeSprite2(24,24,wheel0,CAR_COLOR),makeSprite2(24,24,wheel1,CAR_COLOR),makeSprite2(24,24,wheel2,CAR_COLOR),makeSprite2(24,24,wheel3,CAR_COLOR)];wheelSprites.push(wheelSprites[0]);var loadingScreen=document.getElementById("load"),startScreen=document.getElementById("home"),startButton=document.getElementById("start"),endScreen=document.getElementById("end"),resetButton=document.getElementById("reset");startScreen.addEventListener("mousedown",cancel),startScreen.addEventListener("touchstart",cancel),startButton.addEventListener("mousedown",start),startButton.addEventListener("touchstart",start),endScreen.addEventListener("mousedown",cancel),endScreen.addEventListener("touchstart",cancel),resetButton.addEventListener("mousedown",reset),resetButton.addEventListener("touchstart",reset);var Vec2=function(){function e(e,n){void 0===e&&(e=0),void 0===n&&(n=0),this.x=e,this.y=n}return e.prototype.set=function(e,n){this.x=e,this.y=n},e.prototype.setTo=function(e){this.x=e.x,this.y=e.y},e.prototype.setNormal=function(e,n){var t=e.y-n.y,a=n.x-e.x,o=Math.sqrt(t*t+a*a);if(o<Number.MIN_VALUE)return this.x=t,void(this.y=a);var r=1/o;this.x=t*r,this.y=a*r},e}(),pointer={dragging:!1,x:0,y:0};addEventListener("mousedown",function(e){e.preventDefault(),pointer.dragging=!0,setPointerPosition(e)}),addEventListener("mousemove",function(e){e.preventDefault(),setPointerPosition(e)}),addEventListener("mouseup",function(e){e.preventDefault(),pointer.dragging=!1}),document.addEventListener("touchstart",function(e){var n=e.target;"INPUT"!=n.tagName&&"LABEL"!=n.tagName&&e.preventDefault(),pointer.dragging=!0,setPointerPosition(e.targetTouches[0])}),document.addEventListener("touchmove",function(e){e.preventDefault(),setPointerPosition(e.targetTouches[0])}),document.addEventListener("touchend",function(e){pointer.dragging=!1}),document.addEventListener("touchcancel",function(e){pointer.dragging=!1});var NO_DANGER={a:-1,b:-1,a2:-1,b2:-1},_a=makeColumns(),colBegin=_a[0],colEnd=_a[1],R=20,R_CONTACT=1.25*R,MINIMUM_Y_VELOCITY=4,MAXIMUM_Y_VELOCITY=30,IMPACT_FRICTION=.5,G=-1,x=.25*CANVAS_WIDTH,y=.75*CANVAS_HEIGTH,vy=0,normal=new Vec2(0,1),a=new Vec2,b=new Vec2,yTouch=0,angle=0,targetAngle=0,isAlive=!1,isFlying=!0,isJumping=!0,distance=0,wn=0,BEFORE_DANGER=660,DANGER_DURATION=940,DANGER_PAUSE_EASY=2400,DANGER_PAUSE_HARD=250,DANGER_TABLE=[{a:0,b:100,a2:-1,b2:-1},{a:110,b:100,a2:-1,b2:-1},{a:220,b:100,a2:-1,b2:-1},{a:330,b:100,a2:-1,b2:-1},{a:440,b:100,a2:-1,b2:-1},{a:0,b:220,a2:-1,b2:-1},{a:160,b:220,a2:-1,b2:-1},{a:320,b:220,a2:-1,b2:-1},{a:0,b:100,a2:440,b2:100},{a:110,b:100,a2:330,b2:100},{a:0,b:100,a2:220,b2:100},{a:220,b:100,a2:440,b2:100},{a:0,b:144,a2:396,b2:144}];shuffle(DANGER_TABLE);var nextDanger=NO_DANGER,doDanger=!1,dangerTimer=NaN,dangerPause=DANGER_PAUSE_EASY,nd=0,colOffset=-HALF_COLUMN_WIDTH,scrollSpeed=20,scrollAccel=0,newHeight=STARTING_HEIGHT,then=-1,t=0,music=null;if(!isMobile)try{initMusic()}catch(e){}handleResize(),initMainMenu(),initializeCanvas(),requestAnimationFrame(mainloop);