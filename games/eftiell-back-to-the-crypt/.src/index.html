<!doctype html><html><head><meta charset="utf-8"><title>Eftiell</title><style></style><style type="text/css">html{-webkit-font-smoothing:subpixel-antialiased;font-smooth:never;-webkit-font-smoothing:none}body,html{background-color:#000}body{width:360px;margin:auto}#click{position:fixed;left:0;z-index:-1}a:link{color:#ddd}a:visited{color:#bbb}a:hover{color:#eee}a:active{color:#fff}#gameArea{position:absolute}#gameCanvas{image-rendering:-moz-crisp-edges;image-rendering:-webkit-crisp-edges;image-rendering:pixelated;image-rendering:crisp-edges;width:100%;height:100%;background-color:#222}</style></head><body><div id="gameArea"><canvas id="gameCanvas" width="360" height="800"></canvas><div id="i" cols="4" rows="1" style="border: none; border-style: none; border-color: transparent; overflow: auto;font-family:Verdana; font-size:50px;"></div><audio id="song1"></audio><audio id="clear"></audio></div><a href="#" onclick="requestFullScreen();" id="click">Click to enter full screen mode</a><script type="text/javascript">!function(t){var e={};function i(s){if(e[s])return e[s].exports;var h=e[s]={i:s,l:!1,exports:{}};return t[s].call(h.exports,h,h.exports,i),h.l=!0,h.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var h in t)i.d(s,h,function(e){return t[e]}.bind(null,h));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=3)}([function(t,e,i){var s,h;!function(o){var n,l=1e3/60,a=0,r=0,c=60,d=.9,u=1e3,v=0,p=0,f=0,g=0,m=!1,x=!1,y=!1,b="object"==typeof window?window:o,k=b.requestAnimationFrame||function(){var t,e,i=Date.now();return function(s){return t=Date.now(),e=Math.max(0,l-(t-i)),i=t+e,setTimeout(function(){s(t+e)},e)}}(),w=b.cancelAnimationFrame||clearTimeout,I=function(){},F=I,T=I,C=I,E=I;function R(t){if(n=k(R),!(t<r+g)){for(a+=t-r,r=t,F(t,a),t>v+u&&(c=d*p*1e3/(t-v)+(1-d)*c,v=t,p=0),p++,f=0;a>=l;)if(T(l),a-=l,++f>=240){y=!0;break}C(a/l),E(c,y),y=!1}}o.MainLoop={getSimulationTimestep:function(){return l},setSimulationTimestep:function(t){return l=t,this},getFPS:function(){return c},getMaxAllowedFPS:function(){return 1e3/g},setMaxAllowedFPS:function(t){return void 0===t&&(t=1/0),0===t?this.stop():g=1e3/t,this},resetFrameDelta:function(){var t=a;return a=0,t},setBegin:function(t){return F=t||F,this},setUpdate:function(t){return T=t||T,this},setDraw:function(t){return C=t||C,this},setEnd:function(t){return E=t||E,this},start:function(){return x||(x=!0,n=k(function(t){C(1),m=!0,r=t,v=t,p=0,n=k(R)})),this},stop:function(){return m=!1,x=!1,w(n),this},isRunning:function(){return m}},s=o.MainLoop,void 0===(h="function"==typeof s?s.call(e,i,e,t):s)||(t.exports=h)}(this)},function(t,e,i){},,function(t,e,s){"use strict";s.r(e);var h=class{constructor(t,e,i,s,h,o=0,n=[],l=null){this.render=this.render.bind(this),this.wrapText=this.wrapText.bind(this),this.context=t,this.title=e,this.text=i,this.options=s,this.resultText=h,this.state=10,this.result=null,this.special=o,this.cost=n,this.enemy=l}wrapText(t,e,i,s,h,o){for(var n=e.split(" "),l="",a=0;a<n.length;a++){var r=l+n[a]+" ";t.measureText(r).width>h&&a>0?(t.fillText(l,i,s),l=n[a]+" ",s+=o):l=r}t.fillText(l,i,s)}render(t,e,i,s,h,o){if(this.context.beginPath(),this.context.fillStyle="#000000",this.context.rect(t-5,e+10,t+298,e+226),this.context.fill(),this.context.font="12px Arial",this.context.fillStyle=i,this.context.strokeStyle=i,this.context.fillText(this.title,t-5,e),null!=this.result)2==this.special&&this.state>=100?this.wrapText(this.context,"You've already visited this place. Looks like there's no longer anyone here.",t,e+40,320,15):4==this.special&&this.state>=100?this.wrapText(this.context,"You've already visited this place. Looks like there's no longer anyone here.",t,e+40,320,15):this.state>=100&&1!=this.special?this.context.fillText("You've already visited this place.",t,e+40):this.wrapText(this.context,this.resultText[this.result],t,e+40,320,15),this.context.fillStyle=i,this.context.fillStyle="#66c",this.context.fillText("Continue",t,e+80+15*Math.floor(8/60));else{this.wrapText(this.context,this.text,t,e+40,320,15);for(let n=0;n<this.options.length;n++){let l=!0;4==this.special&&(l=this.cost[n].affordable(s,h,o)),l?(this.context.fillStyle=i,this.context.fillStyle="#66c"):(this.context.fillStyle=i,this.context.fillStyle="#338");let a=n+1+". ";1==this.options.length&&(a=""),this.context.fillText(a+this.options[n],t,e+80+40*n+15*Math.floor(this.text.length/60))}}}};var o=class{constructor(t,e,i,s,h){this.render=this.render.bind(this),this.context=t,this.colours="00c000623b00007300524f4dFA4F4DC29F66d1d1d7",this.types=h,this.type=s,this.S=16,this.x=e,this.y=i}old(){data.replace(/./g,t=>{let e=t.charCodeAt();this.px.push(7&e),this.px.push(e>>3&7)});let t="vv~vvvvvvvvvvvwvvwvvvvvvvvvwvvvvvvvvvv~vvvvvvvvv~vvvwvvvvvvvvvvvvvvvvvwvvvvwvvv~wvvvvvvvvvwvvvvvvvvvv~vvvvvvvvvvvwvv~vvwvvvvvvvv".replace(/./g,t=>{let e=t.charCodeAt();this.px[0].push(7&e),this.px[0].push(e>>3&7)});t="[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[I[[[[[[I[I[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[".replace(/./g,t=>{let e=t.charCodeAt();this.px[1].push(7&e),this.px[1].push(e>>3&7)}),t="vv~vvvvvvvvvvvwvvwvvvvvvvvvwvvvvvvvvvv~vvvvvvvvv~vvvwvvvvvvvvvvvvvvvvvwvvvvwvvv~wvvvvvvvvvwvvvvvvvvvv~vvvvvvvvvvvwvv~vvwvvvvvvvv".replace(/./g,t=>{let e=t.charCodeAt();this.px[0].push(7&e),this.px[0].push(e>>3&7)}),t="mo}".replace(/./g,t=>{let e=t.charCodeAt();this.px[2].push(7&e),this.px[2].push(e>>3&7)}),t="".replace(/./g,t=>{let e=t.charCodeAt();this.px[3].push(7&e),this.px[3].push(e>>3&7)}),t="@H@@@@@@@IA@@H@@@IA@@HA@HII@@IA@HII@@IA@IIIA@IA@IIIA@II@IIIAHII@IIIAHII@IIIAHII@III@IIIAHII@IIIA@R@@IIIA@R@@HII@@@@@@PB@@@@@@PB@".replace(/./g,t=>{let e=t.charCodeAt();this.px[4].push(7&e),this.px[4].push(e>>3&7)}),t="@@@`@@@@@@@`D@@@@@@de@@@@@`eeD@@@@`emD@@@@deld@@@`lele@@@`mdemD@`lmleme@`meleme@@lemeleD@`dmmlmd@@dmmlme@@`mmlmD@@@dmdd@@@@`dd@@".replace(/./g,t=>{let e=t.charCodeAt();this.px[5].push(7&e),this.px[5].push(e>>3&7)}),t="@@@@@@@x@@@@@@Gp@@@@@@Fp@@@@@@Fp@@@@@@F@@@@@@@@@G@@@@@@@F@@@@@@@FGG@@@@@FFFG@@@@FFFFG@@@@FFFF@@G@FFFFx@F@@FFFp@F@@@@Fp@F@@@@@p@@".replace(/./g,t=>{let e=t.charCodeAt();this.px[6].push(7&e),this.px[6].push(e>>3&7)}),t="`ddD`ddDdemddmldlemmlmleddddddddlmlmmlmedddmedded@`dd@`d@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@".replace(/./g,t=>{let e=t.charCodeAt();this.px[7].push(7&e),this.px[7].push(e>>3&7)}),t="@@@@@@hm@@@@@@}o@@@@@ho@@@@@}E@@@@ho@@@@@}E@@B@ho@@PR@}E@@@Rjo@@@@PRE@@@@@Rj@@@@@PRR@@@@@RBRB@@@RR@PR@@@RB@@B@@@PB@@@@@@".replace(/./g,t=>{let e=t.charCodeAt();this.px[8].push(7&e),this.px[8].push(e>>3&7)}),t="@`@@@D@@@`dddD@@@@Umj@@@@@umn@@@@@uvn@@@@@hmE@@@@m}}mm@xhooooo@xho}}mo@hooooo@Ghm}}mmxG@vllDV@@vddDvB@@@d`DB@@@@d`D@@@@`d`d@@@".replace(/./g,t=>{let e=t.charCodeAt();this.px[9].push(7&e),this.px[9].push(e>>3&7)}),this.S=16,this.x=x,this.y=y}render(t,e,i=this.type){for(let t=0;t<this.S;t++)for(let e=0;e<this.S;e++)this.types[i][t*this.S+e]&&(this.context.fillStyle="#"+this.colours.substr(6*(this.types[i][t*this.S+e]-1),6),this.context.fillRect(this.x+2*e,this.y+2*t,2,2))}};var n=class{constructor(t,e,i,s,h){this.render=this.render.bind(this),this.getPos=this.getPos.bind(this),this.swapStartAndGoal=this.swapStartAndGoal.bind(this),this.context=t,this.title=e,this.data=i,this.level=s,this.tiles=[],this.px=h,this.blinkValue=100,this.blinkMod=5;for(let t=0;t<10;t++)for(let e=0;e<8;e++)this.tiles.push(new o(this.context,22+32*t,40+32*e,this.level,this.px))}getPos(t){return[this.data[t].x,this.data[t].y]}getIndex(t){return[this.data[t].x,this.data[t].y]}swapStartAndGoal(){}render(t,e,i,s,h){this.blinkValue+=this.blinkMod,this.blinkValue>230&&(this.blinkMod=-this.blinkMod),this.blinkValue<100&&(this.blinkMod=-this.blinkMod),this.context.lineWidth=8;for(let t=0;t<this.tiles.length;t++)this.tiles[t].render();this.context.fillStyle=i,this.context.font="12px Arial",this.context.fillText(this.title,t,e);for(let i=0;i<this.data.length;i++)for(let h=0;h<this.data[i].n.length;h++){let o=this.data[i].n[h];if(this.context.fillStyle=this.data[i].c,this.context.strokeStyle=this.data[i].c,this.context.fillStyle="#000000",this.context.strokeStyle=s<2?"#623B00":"#524F4D",this.context.beginPath(),this.context.moveTo(-54+t+72*this.data[i].x,-27+e+56*this.data[i].y),3!=s&&Math.abs(this.data[o].x-this.data[i].x)>1){let s=42;5!=this.data[o].y&&5!=this.data[i].y||(s=-42),this.context.bezierCurveTo(-54+t+72*this.data[i].x,-27+e+56*this.data[i].y+s,-54+t+72*this.data[o].x,-27+e+56*this.data[o].y+s,-54+t+72*this.data[o].x,-27+e+56*this.data[o].y)}else this.context.lineTo(-54+t+72*this.data[o].x,-27+e+56*this.data[o].y);this.context.stroke()}if(0==s||7==s)for(let t=0;t<this.tiles.length;t++)t*t%11>1&&this.tiles[t].render(20,80,6);if(1==s||6==s)for(let t=0;t<this.tiles.length;t++)t%73<72&&t%40<39&&t%48<47&&t%59<58&&(t>25||t%22<21)&&this.tiles[t].render(20,80,4);if(2==s||5==s)for(let t=0;t<this.tiles.length;t++)t*t%11>1&&this.tiles[t].render(20,80,5);if(3==s)for(let t=0;t<this.tiles.length;t++)t%2==1&&this.tiles[t].render(20,80,7);for(let i=0;i<this.data.length;i++)this.context.beginPath(),this.context.fillStyle=this.data[i].c,this.context.strokeStyle=this.data[i].c,h.includes(i)&&(this.context.fillStyle="rgba("+this.blinkValue+", 0, 0, 1)"),this.context.arc(-54+t+72*this.data[i].x,-27+e+56*this.data[i].y,10,0,2*Math.PI),this.context.fill()}};var l=class{constructor(t,e,i,s,h,o,n,l,a,r,c,d,u,v,p,f,g,m){this.render=this.render.bind(this),this.damage=this.damage.bind(this),this.context=t,this.name=e,this.title=i,this.face=o,this.skills=n,this.health=l,this.maxhealth=a,this.weapon=r,this.items=c,this.foodcost=d,this.coincost=u,this.x=s,this.y=h,this.foodicon=p,this.coinicon=f,this.healthicon=g,this.deadhealthicon=m,this.colour=v,this.cooldown=!1}damage(t){this.health-=t}render(){this.face.x=this.x,this.face.y=this.y+25,this.foodicon.x=this.x+43,this.foodicon.y=this.y,this.coinicon.x=this.x+74,this.coinicon.y=this.y+30,this.healthicon.x=this.x+117,this.healthicon.y=this.y-10,this.deadhealthicon.x=this.x+117,this.deadhealthicon.y=this.y-10;for(let t=0;t<this.skills.length;t++)this.skills[t].icon.x=this.x+122+55*t,this.skills[t].icon.y=this.y+30;this.context.fillStyle=this.colour,this.context.fillText(this.name,this.x,this.y+8),this.context.fillText(this.title,this.x,this.y+85),this.face.render();for(let t=0;t<this.foodcost;t++)this.foodicon.render(),this.foodicon.x+=7;this.coinicon.x=this.foodicon.x+7,this.coinicon.x=this.x+43;for(let t=0;t<this.coincost;t++)this.coinicon.render(),this.coinicon.x+=7;this.foodicon.x=this.x+43,this.coinicon.x=this.x+74;for(let t=0;t<this.maxhealth;t++)this.deadhealthicon.render(),this.deadhealthicon.x+=20;this.deadhealthicon.x=this.x+116;for(let t=0;t<this.health;t++)this.healthicon.render(),this.healthicon.x+=20;this.healthicon.x=this.x+116;for(let t=0;t<this.skills.length;t++)this.skills[t].render()}};var a=class{constructor(t,e,i,s,h,o,n,l){this.render=this.render.bind(this),this.update=this.update.bind(this),this.activate=this.activate.bind(this),this.context=t,this.name=e,this.verb=i,this.icon=s,this.effect=h,this.special=o,this.countdown=n,this.colour=l,this.activatedArc=360}activate(){this.activatedArc=360,this.cooldown=!0}update(){this.cooldown&&(this.activatedArc<1&&(this.cooldown=!1),this.activatedArc-=6/this.countdown)}render(){this.context.beginPath(),this.context.fillStyle="#000000",this.context.strokeStyle="#00aa00",this.context.arc(this.icon.x+16,this.icon.y+16,24,0,2*Math.PI),this.context.fill(),this.context.strokeStyle="#666666",this.context.beginPath(),this.context.arc(this.icon.x+16,this.icon.y+16,26,0,2*Math.PI),this.context.lineWidth=2,this.context.stroke(),this.icon.render(),this.context.fillStyle=this.colour;let t=this.context.measureText(this.name);this.context.fillText(this.name,this.icon.x-t.width/2+15,this.icon.y+55),this.cooldown&&(this.activatedArc<1&&(this.cooldown=!1),this.context.beginPath(),this.context.fillStyle="rgba(255, 255, 255, 0.3)",this.context.strokeStyle="rgba(255, 255, 255, 0.3)",this.context.arc(this.icon.x+16,this.icon.y+16,24,0,2*Math.PI),this.context.fill(),this.context.beginPath(),this.context.fillStyle="rgba(255, 255, 255, 0.6)",this.context.strokeStyle="rgba(255, 255, 255, 0.6)",this.context.arc(this.icon.x+16,this.icon.y+16,24,0,this.activatedArc*(Math.PI/180)),this.context.fill(),this.activatedArc-=6/this.countdown)}};var r=class{constructor(t,e,i,s,h,o,n=null,l=null){this.affordable=this.affordable.bind(this),this.transact=this.transact.bind(this),this.coin_cost=t,this.food_cost=e,this.coin_gained=s,this.food_gained=h,this.item_gained=n,this.hero_gained=l,this.health_gained=o,this.health_cost=i,this.done=!1}affordable(t,e,i){return t>=this.coin_cost&&e>=this.food_cost&&i>this.health_cost}transact(){return this.done?null:(this.done=!0,[this.coin_gained,this.food_gained,this.health_gained,this.item_gained,this.hero_gained])}};var c=class{constructor(t,e,i,s,h,o,n,l){this.damage=this.damage.bind(this),this.context=t,this.name=e,this.introtext=i,this.deathtext=s,this.skills=h,this.health=o,this.xp=n,this.loot=l}damage(t){this.health-=t}};var d=class{constructor(t){this.update=this.update.bind(this),this.render=this.render.bind(this),this.startGame=this.startGame.bind(this),this.click=this.click.bind(this),this.randomEncounter=this.randomEncounter.bind(this),this.specialEncounters=this.specialEncounters.bind(this),this.randomInt=this.randomInt.bind(this),this.generateMap=this.generateMap.bind(this),this.getNodeIfExist=this.getNodeIfExist.bind(this),this.mulberry32=this.mulberry32.bind(this),this.createTile=this.createTile.bind(this),this.createTileDesigns=this.createTileDesigns.bind(this),this.generateName=this.generateName.bind(this),this.addToBattlelog=this.addToBattlelog.bind(this),this.randomGenerator=this.mulberry32(2),this.designs=["plains","forest","mountains","dungeon","forest-top","mountains-top","plains-top","dungeon-top","sword","warrior","chicken","coin","heart","deadheart","dagger"],this.tileDesigns=["vv~vvvvvvvvvvvwvvwvvvvvvvvvwvvvvvvvvvv~vvvvvvvvv~vvvwvvvvvvvvvvvvvvvvvwvvvvwvvv~wvvvvvvvvvwvvvvvvvvvv~vvvvvvvvvvvwvv~vvwvvvvvvvv","[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[I[[[[[[I[I[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[[","dg|","","@H@@@@@@@IA@@H@@@IA@@HA@HII@@IA@HII@@IA@IIIA@IA@IIIA@II@IIIAHII@IIIAHII@IIIAHII@III@IIIAHII@IIIA@R@@IIIA@R@@HII@@@@@@PB@@@@@@PB@","@@@D@@@@@@`g@@@@@@|gD@@@@@|gd@@@@`gd@@@@`|gdD@@@|gdd@@`ggdd@@`ggdd@@|g|ddD@`||gdD@@`||gdd@@@`|gdd@@@@`ddd@@@@@`dD@@@@@@@@@","@@@@@@@x@@@@@@Gp@@@@@@Fp@@@@@@Fp@@@@@@F@@@@@@@@@G@@@@@@@F@@@@@@@FGG@@@@@FFFG@@@@FFFFG@@@@FFFF@@G@FFFFx@F@@FFFp@F@@@@Fp@F@@@@@p@@","`dd@`dd@dgddgdgggggddgdddgddgd`g@`g@`dd@`dd@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@","@@@@@@`d@@@@@@|g@@@@@`g@@@@@|D@@@@`g@@@@@|D@PB@`g@@PR@|D@@@Rbg@@@@PRD@@@@@Rb@@@@@PRR@@@@@RBRB@@@PR@PR@@@RB@@R@@@R@@@@@@@","@`@@@D@@@`dddD@@@@Tdb@@@@@tdf@@@@@tvf@@@@@`dD@@@@d||dd@x`ggggg@x`g||dg@`ggggg@G`d||ddxG@vbbBV@@vRRBvB@@@RPBB@@@@RPB@@@@PRPR@@@","@@@@`R@@@@@@TRB@@@@`RRB@@@@`RRB@@@@TRR@@@@@TRR@@@@`RRB@@@@`RR@@@@@`RB@@@@@|G@@@@@@|@@@@@@d@@@@@`G@@@@@@@G@@@@@@@@@@@@@@@@@@@@@","@@@dd@@@@@dd@@@`D@@||g@@|g|g@`|dD`|gD`|gD`|dD@|gdg@@|g@@`D@@@dd@@@@@dd@@@@@@@@@@@@@@@@@@@","@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@hE@m@@@@mmhmE@@@mmmmE@@@hmmm@@@@@mmE@@@@@hm@@@@@@@E@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@","@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@`D@d@@@@dd`dD@@@ddddD@@@`ddd@@@@@ddD@@@@@`d@@@@@@@D@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@","@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@x@@@@x@@@@@@@@@@xG@@@@@b@@@@@PRD@@@@@RR@@@@@PRB@@@@@@R@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"],this.bosses=[["Orc Chieftain","Land Shark"],["black bear","Goblin Warlord"],["Stone Golem","Giant"],["Sir Despair"]],this.levelNames=["wild plains","forest of Rackwood","Longcrag mountains","Dungeon of Despair"],this.exits=["Eftiell Tower","the town of Leafhill","Rackwood Inn","Longcraig Tower","Crypt of Despair"],this.caves=["cave","cavern","hideout","mine"],this.canvas=document.getElementById("gameCanvas"),this.context=this.canvas.getContext("2d"),this.grid=[],this.gridTest=[],this.gridSpines=[],this.gridWidth=10,this.gridHeight=10,this.state=10,this.level=0,this.mapPos=0,this.colours=[],this.colours[0]="#000000",this.colours[1]="#666666",this.colours[2]="#00aa00",this.colours[3]="#0000aa",this.colours[4]="#aaaa00",this.colours[5]="#00aaaa",this.colours[6]="#aaaaaa",this.px=this.createTileDesigns(this.tileDesigns),this.map=[],this.map.push(this.generateMap(0,"Plains")),this.map.push(this.generateMap(1,"Forest")),this.map.push(this.generateMap(2,"Mountain")),this.map.push(this.generateMap(3,"Castle"));for(let t=0;t<this.gridWidth;t++){this.grid[t]=[];for(let e=0;e<this.gridHeight;e++)this.grid[t][e]=0,(e+t)%2==0&&(this.grid[t][e]=6)}this.context.font="12px Arial",this.context.strokeStyle=this.colours[6],this.context.strokeText("Next",80,50),this.context.imageSmoothingEnabled=!1,this.currentEncounter=this.map[this.level].data[this.mapPos].e,this.temporaryClickableFields=[];for(let t=0;t<this.currentEncounter.options.length;t++)this.temporaryClickableFields.push([20,110+40*t+15*Math.floor(this.currentEncounter.text.length/60)-20,23+5*this.currentEncounter.options[t].length,30]);this.player=new o(this.context,24,500,9,this.px),this.player.x=72*this.map[this.level].data[this.mapPos].x-50,this.player.y=56*this.map[this.level].data[this.mapPos].y-15,this.sword=new o(this.context,80,500,8,this.px),this.blinkers=[],this.heroNames=["Valfar","Hrasvalg","Polby","Batrik","Bhorgal","Wilfa","Zander","Gundar","Soth","Arne"],this.heroes=[],this.reusableChicken=this.createTile("chicken",60,380),this.reusableCoin=this.createTile("coin",20,380),this.reusableHeart=this.createTile("heart",40,380),this.reusableDeadheart=this.createTile("deadheart",1,1),this.heroes.push(new l(this.context,this.generateName(),"Warrior",20,400,this.createTile("warrior",20,390),[],10,10,"longsword",[],1,0,"#c99",this.reusableChicken,this.reusableCoin,this.reusableHeart,this.reusableDeadheart)),this.heroes[0].skills.push(new a(this.context,"Attack","slash",this.createTile("sword",1,1),2,0,5,"#c99")),this.food=this.createTile("chicken",120,310),this.coin=this.createTile("coin",200,310),this.foodTotal=20,this.coinTotal=20,this.gameover=!1,this.win=!1,this.debug=!0}generateName(){let t=this.randomInt(0,this.heroNames.length),e=this.heroNames[t];return this.heroNames.splice(t,1),e}getNodeIfExist(t,e,i){for(let s=0;s<i.length;s++)if(t==i[s].x&&e==i[s].y)return s;return-1}generateMap(t,e){let i=[],s=0,h=0,o=!0;for(let e=0;e<this.randomInt(2,3+t);e++){let n=0;h++;let l=1,a=3,r=0==this.randomInt(0,2),c=[];c.x=l,c.y=a,c.e=this.randomEncounter(1,"foo"),0==e&&(c.e=this.specialEncounters(t,"start")),c.n=[],c.c=this.colours[h],c.s="none",c.id=s;let d=this.getNodeIfExist(l,a,i);for(-1==d?(console.log("adding "+i.length+": "+l+","+a),i.push(c),s++):(console.log("re-using "+d+": "+l+","+a),c=i[d],n=d);l<6;){if(3==t){let t=a;r?(a=Math.min(Math.max(a+this.randomInt(-1,2),1),5),r=!1):(l++,r=!0),a!=t||r||(l++,r=!0)}else l++,1==this.randomInt(1,10)&&l++,a=Math.min(Math.max(a+this.randomInt(-2,3),1),5);l<6&&((c=[]).x=l,c.y=a,c.e=this.randomEncounter(1,"foo"),c.c="#111",c.s="none",c.n=[n],c.id=s,-1==(d=this.getNodeIfExist(l,a,i))?(console.log("adding "+i.length+": "+l+","+a),i.push(c),i[n].n.includes(s)||i[n].n.push(s),n=s,s++):(console.log("re-using "+d+": "+l+","+a),i[d].n.includes(n)||i[d].n.push(n),i[n].n.includes(d)||i[n].n.push(d),n=d))}o&&3==t&&(i[i.length-1].s="boss",i[i.length-1].e=this.specialEncounters(t,"boss"),o=!1)}3!=t&&(i[i.length-1].s="exit",i[i.length-1].e=this.specialEncounters(t,"exit"));for(let t=0;t<i.length;t++){let e=t+" ("+i[t].x+","+i[t].y+") goes to ";if(i[t].hasOwnProperty("n"))for(let s=0;s<i[t].n.length;s++)e+=i[t].n[s]+", ";console.log(e)}return new n(this.context,this.levelNames[t].toUpperCase(),i,t,this.px)}randomEncounter(t,e){let i=this.randomInt(1,6);if(1==i)return this.combatEncounters(t,e);if(3==i)return new h(this.context,"A CRAZY BARGAIN","You come upon a thin man sitting by himself. He is grinning from ear to ear and looking at you. His right fingers are playing with a curved dagger in his left hand. He says: 'Hello! Traveller! I have a proposition for you: Let me collect a bit of blood from you and in return I will give you 30 coin?'",["'Sounds great!' (lose 1 health)","'No way'. Leave immediately."],["The man gives you a bag of coin. 'Excellent,' he smiles as he readies the dagger... Ouch!","You immediately get on your way."],4,[new r(0,0,1,30,0,0),new r(0,0,0,0,0,0)]);if(4==i)return new h(this.context,"A WILD HUNTER","You brush past some bushes and see a man sitting down on a rock, skinning a rabbit. He looks up at you.\n'Fancy some meat, friend? Fresh as they come!'",["Buy a small piece (7 rations) for 4 coin.","Buy a small and a large piece (20 rations) for 10 coin.","'No, thanks.'"],["The man takes your coin and hands you the meat.","The man takes your coin and hands you the meat.","You continue on your way."],4,[new r(4,0,0,0,7,0),new r(10,0,0,0,20,0),new r(0,0,0,0,0,0)]);if(5==i){let t=this.caves[this.randomInt(0,this.caves.length)];return new h(this.context,"A SECRET "+t.toUpperCase(),"You come across an entrance to a hidden "+t+".",["Investigate the "+t,"Leave quietly"],["There's nothing in it.","You leave quietly, before anyone - or anything - finds you."])}return new h(this.context,"A SMALL SPRING","There's a small spring with cold water flowing through it.       It looks fresh and healthy.",["Drink","Move on"],["Ah, feels lovely!","You can never trust nature."])}combatEncounters(t,e){return"boss"==e?new h(this.context,"THE DOOM KNIGHT","The Doom Knight",["This is it. Let's dance."],["The Doom Knight does not grin. But if he could, he would."],15,[new r(0,0,0,0,0,0),new r(0,1,0,0,0,0)],new c(this.context,"Doom Knight","The Doom Knight turns towards you, slowly.","The Doom Knight disintegrates into a million tiny pieces.",[new a(this.context,"Attack","hacks",this.createTile("dagger",1,1),2,0,6,"#c99"),new a(this.context,"Attack","headbutts",this.createTile("dagger",1,1),1,0,13,"#c99")],15,1,new r(0,0,0,0,3,0))):new h(this.context,"AMBUSHED","You are ambushed by a Khroll! These creatures are small but agile, they look vaguely humanoid albeit with a mouth full of sharp teeth and with sharp claws on their hands - which this one is currently aiming at you!",["Let's have it.","Throw some meat and run away. (1 ration)"],["You ready yourself for a fight!","Hopefully this creature likes squirrel or rabbit or whatever that meat was!"],10,[new r(0,0,0,0,0,0),new r(0,1,0,0,0,0)],new c(this.context,"Khroll","The Khroll screams and spits as it prepares to attack!","The Khroll collapses, blood leaking from multiple wounds.",[new a(this.context,"Attack","rakes",this.createTile("dagger",1,1),1,0,3,"#c99")],5,1,new r(0,0,0,0,3,0)))}specialEncounters(t,e){if("exit"==e){let e=this.exits[t+1];return new h(this.context,e.toUpperCase(),"You can see "+e+" just ahead.",["Onwards!","Stay a bit longer in this area."],["You grin and pick up the pace.","You turn around.\nYou have unfinished business here!"],1)}if("start"==e){let e=this.exits[t],i=this.levelNames[t];return new h(this.context,i.toUpperCase(),"You left "+e+" a while ago. You finally reach the "+i+".",["Let's get going!"],["You wonder what dangers lie ahead..."],2)}return"boss"==e?this.combatEncounters(t,"boss"):"cashflowproblem"==e?new h(this.context,"A CASH FLOW PROBLEM","Oh no! You don't have enough coin to pay the expenses of your hired help - so they left!",["Continue"],["After a quick break to re-assess your financial situation, you get back on your way."],5):"famine"==e?new h(this.context,"STARVATION","Oh dear! The rations have run out! Your party has suffered famine and starvation!",["Continue"],["You bury the dead with their full equipment as is custom. A quick prayer and onwards you go."],5):void 0}randomInt(t,e){return Math.floor(this.randomGenerator()*(+e-+t))+ +t}addToBattlelog(t){this.battlelog.push(t),this.battlelog.length>16&&this.battlelog.shift()}update(){if(this.gameover||this.win)this.temporaryClickableFields=[];else if(50==this.state)for(let t=0;t<this.currentEncounter.enemy.skills.length;t++)if(this.currentEncounter.enemy.skills[t].update(),1==this.randomInt(1,40)&&!this.currentEncounter.enemy.skills[t].cooldown){this.currentEncounter.enemy.skills[t].activate();let e=this.randomInt(0,this.heroes.length);if("Attack"==this.currentEncounter.enemy.skills[t].name&&(this.heroes[e].health-=this.currentEncounter.enemy.skills[t].effect,this.addToBattlelog("The "+this.currentEncounter.enemy.name+" "+this.currentEncounter.enemy.skills[t].verb+" "+this.heroes[e].name+" for "+this.currentEncounter.enemy.skills[t].effect+" damage.")),this.heroes[e].health<1){if(this.addToBattlelog(this.heroes[e].name+" collapses in a heap!"),0==e)return this.gameover=!0,void this.addToBattlelog("You have died!");for(let t=e;t<this.heroes.length;t++)this.heroes[t].y-=100,this.heroes[t].render();this.heroes.splice(e,1),this.temporaryClickableFields=[];for(let t=0;t<this.heroes.length;t++)for(let e=0;e<this.heroes[t].skills.length;e++)this.temporaryClickableFields.push([this.heroes[t].skills[e].icon.x-8,this.heroes[t].skills[e].icon.y-8,48,48,t,e]),console.log("adding for combat: "+e+" "+this.temporaryClickableFields[this.temporaryClickableFields.length-1][0]+","+this.temporaryClickableFields[this.temporaryClickableFields.length-1][1]+","+this.temporaryClickableFields[this.temporaryClickableFields.length-1][2]+","+this.temporaryClickableFields[this.temporaryClickableFields.length-1][3])}}}render(){if(50==this.state||51==this.state||52==this.state){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.beginPath(),this.context.fillStyle="#000000",this.context.rect(20,40,323,256),this.context.fill(),this.context.font="12px Arial",this.context.fillStyle=this.colours[6],this.context.strokeStyle=this.colours[6],this.context.fillText("COMBAT",20,30);for(let t=0;t<this.battlelog.length;t++)this.context.fillText(this.battlelog[t],24,60+15*t);51!=this.state&&52!=this.state||(this.context.fillStyle="#66c",this.context.fillText("Continue",24,40+15*this.battlelog.length))}else{if(this.gameover||this.win)return this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.beginPath(),this.context.fillStyle="#000000",this.context.rect(20,40,323,256),this.context.fill(),this.context.font="12px Arial",this.context.fillStyle=this.colours[6],this.context.strokeStyle=this.colours[6],void(this.gameover?(this.context.fillText("GAME OVER",20,30),this.context.fillText("You have died.",20,70)):this.win&&(this.context.fillText("EPILOGUE",20,30),this.context.fillText("You have defeated the Doom Knight!",20,70)));this.state>=100&&(this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.map[this.level].render(20,30,this.colours[6],this.level,this.blinkers)),this.state>=10&&this.state<=20&&(this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.currentEncounter.render(25,30,this.colours[6],this.coinTotal,this.foodTotal,this.heroes[0].health)),this.state>99&&this.player.render()}for(let t=0;t<this.heroes.length;t++)this.context.beginPath(),this.context.fillStyle=this.colours[0],this.context.strokeStyle=this.colours[2],this.context.fillRect(this.heroes[t].face.x-3,this.heroes[t].face.y-3,40,40),this.context.fill(),this.heroes[t].y=400+100*t,this.heroes[t].render();this.food.render(),this.coin.render(),this.context.fillStyle="#66c",this.context.fillText("RESOURCES",20,320),this.context.fillText("HEROES",20,360),this.context.fillStyle="#ccc";let t=0,e=0;for(let i=0;i<this.heroes.length;i++)t+=this.heroes[i].foodcost,e+=this.heroes[i].coincost;if(t=Math.max(9,3*t),e=Math.max(9,3*e),this.foodTotal<=t&&(this.context.fillStyle="#FA4F4D"),this.context.fillText(this.foodTotal+"",160,330),this.context.fillStyle="#ccc",this.coinTotal<=e&&(this.context.fillStyle="#FA4F4D"),this.context.fillText(this.coinTotal+"",245,330),this.context.fillStyle="#ccc",this.context.fillText("Name",20,380),this.context.fillText("Cost",70,380),this.context.fillText("Health and skills",140,380),this.debug)for(let t=0;t<this.temporaryClickableFields.length;t++)this.context.fillStyle="rgba(255, 255, 255, 0.1)",this.context.fillRect(this.temporaryClickableFields[t][0],this.temporaryClickableFields[t][1],this.temporaryClickableFields[t][2],this.temporaryClickableFields[t][3],"rgba(255, 255, 255, 0.9)")}click(t){console.log("touched/clicked "+t.offsetX+","+t.offsetY);for(let e=0;e<this.temporaryClickableFields.length;e++)if(t.offsetX>=this.temporaryClickableFields[e][0]&&t.offsetX<=this.temporaryClickableFields[e][0]+this.temporaryClickableFields[e][2]&&t.offsetY>=this.temporaryClickableFields[e][1]&&t.offsetY<=this.temporaryClickableFields[e][1]+this.temporaryClickableFields[e][3])if(console.log("match:"+e),51==this.state){this.battlelog=[],this.addToBattlelog("You find the following:");let t=this.currentEncounter.enemy.loot.transact();t[0]>0&&(this.addToBattlelog("    • "+t[0]+" coin"),this.coinTotal+=t[0]),t[1]>0&&(this.addToBattlelog("    • "+t[1]+" food"),this.foodTotal+=t[1]),null!=t[3]&&this.addToBattlelog("    • "+t[3].name),this.addToBattlelog(""),this.addToBattlelog(""),this.addToBattlelog(""),this.state=52,this.temporaryClickableFields=[],this.temporaryClickableFields.push([24,20+15*this.battlelog.length,60,30])}else if(52==this.state){if(15==this.currentEncounter.special)return this.win=!0,void(this.state=103);this.currentEncounter.special=0,this.temporaryClickableFields=[],this.state=102,this.currentEncounter.state=100;let t=this.map[this.level].data[this.mapPos].n;this.blinkers=[];for(let e=0;e<t.length;e++){let i=this.map[this.level].getPos(t[e]);this.temporaryClickableFields.push([72*i[0]-44,56*i[1]-7,20,20,t[e]]),this.blinkers.push(t[e]),console.log("Add neigh "+t[e])}}else{if(50==this.state){let t=this.temporaryClickableFields[e][4],i=this.temporaryClickableFields[e][5];return console.log("hero "+t+" skill "+i),void(this.heroes[t].skills[i].cooldown||(console.log("activate"),this.heroes[t].skills[i].activate(),"Attack"==this.heroes[t].skills[i].name&&(this.currentEncounter.enemy.health-=this.heroes[t].skills[i].effect,this.addToBattlelog(this.heroes[t].name+" attacks the "+this.currentEncounter.enemy.name+" for "+this.heroes[t].skills[i].effect+" damage.")),this.currentEncounter.enemy.health<1&&(this.addToBattlelog(this.currentEncounter.enemy.deathtext),this.addToBattlelog(""),this.addToBattlelog(""),this.addToBattlelog(""),this.state=51,this.temporaryClickableFields=[],this.temporaryClickableFields.push([24,20+15*this.battlelog.length,60,30]))))}if(100==this.state||102==this.state){this.mapPos=this.temporaryClickableFields[e][4],this.temporaryClickableFields=[],this.currentEncounter=this.map[this.level].data[this.mapPos].e;let t=[];for(let e=0;e<this.heroes.length;e++)0==this.heroes[e].coincost||this.heroes[e].coincost<=this.coinTotal?this.coinTotal-=this.heroes[e].coincost:t.push(e);let i=[];for(let e=0;e<this.heroes.length;e++)t.includes(e)||i.push(this.heroes[e]);this.heroes=i;let s=[];for(let t=0;t<this.heroes.length;t++)0==this.heroes[t].foodcost||this.heroes[t].foodcost<=this.foodTotal?this.foodTotal-=this.heroes[t].foodcost:(this.heroes[t].damage(1),this.heroes[t].health<1&&(s.push(t),0==t&&(this.gameover=!0)));let h=[];for(let t=0;t<this.heroes.length;t++)s.includes(t)||h.push(this.heroes[t]);if(this.heroes=h,t.length>0&&(this.currentEncounter=this.specialEncounters(this.level,"cashflowproblem")),s.length>0&&(this.currentEncounter=this.specialEncounters(this.level,"famine")),null!=this.currentEncounter.result)this.state=12,this.temporaryClickableFields.push([20,110+15*Math.floor(8/60)-20,60,30]);else{this.state=10;for(let t=0;t<this.currentEncounter.options.length;t++){let e=!0;if(4!=this.currentEncounter.special&&10!=this.currentEncounter.special||(e=this.currentEncounter.cost[t].affordable(this.coinTotal,this.foodTotal,this.heroes[0].health)),e){let e=this.context.measureText("1. "+this.currentEncounter.options[t]);this.temporaryClickableFields.push([20,110+40*t+15*Math.floor(this.currentEncounter.text.length/60)-20,20+e.width,30]),console.log("adding for encounter: "+t+" "+this.temporaryClickableFields[this.temporaryClickableFields.length-1][0]+","+this.temporaryClickableFields[this.temporaryClickableFields.length-1][1]+","+this.temporaryClickableFields[this.temporaryClickableFields.length-1][2]+","+this.temporaryClickableFields[this.temporaryClickableFields.length-1][3])}else this.temporaryClickableFields.push([-1,-1,-1,-1,-1])}}return console.log("clicked on mapPos "+this.mapPos),this.player.x=72*this.map[this.level].data[this.mapPos].x-50,this.player.y=56*this.map[this.level].data[this.mapPos].y-16,void this.temporaryClickableFields.push(20,400,25,25,5)}if(10==this.state){if(this.currentEncounter.result=e,this.state=12,this.temporaryClickableFields=[],this.temporaryClickableFields.push([20,110+15*Math.floor(8/60)-20,60,30]),4==this.currentEncounter.special||10==this.currentEncounter.special){let t=this.currentEncounter.cost[e].transact();this.coinTotal+=t[0]-this.currentEncounter.cost[e].coin_cost,this.foodTotal+=t[1]-this.currentEncounter.cost[e].food_cost,this.heroes[0].health+=t[2]-this.currentEncounter.cost[e].health_cost}return}if(12==this.state)if(1==this.currentEncounter.special&&0==this.currentEncounter.result){this.temporaryClickableFields=[],this.mapPos=0,this.state=100,this.level++;let t=this.map[this.level].getPos(this.mapPos);this.temporaryClickableFields=[],this.temporaryClickableFields.push([72*t[0]-44,56*t[1]-7,20,20,this.mapPos]),this.player.x=72*this.map[this.level].data[this.mapPos].x-50,this.player.y=56*this.map[this.level].data[this.mapPos].y-16-15,this.blinkers=[],this.blinkers.push(this.mapPos)}else{if((10==this.currentEncounter.special||15==this.currentEncounter.special)&&0==this.currentEncounter.result){console.log("entering combat"),this.battlelog=[],this.addToBattlelog(this.currentEncounter.enemy.introtext),this.temporaryClickableFields=[],this.state=50;for(let t=0;t<this.heroes.length;t++)for(let e=0;e<this.heroes[t].skills.length;e++)this.temporaryClickableFields.push([this.heroes[t].skills[e].icon.x-8,this.heroes[t].skills[e].icon.y-8,48,48,t,e]),console.log("adding for combat: "+e+" "+this.temporaryClickableFields[this.temporaryClickableFields.length-1][0]+","+this.temporaryClickableFields[this.temporaryClickableFields.length-1][1]+","+this.temporaryClickableFields[this.temporaryClickableFields.length-1][2]+","+this.temporaryClickableFields[this.temporaryClickableFields.length-1][3]);return}if(5==this.currentEncounter.special)if(this.currentEncounter=this.map[this.level].data[this.mapPos].e,this.temporaryClickableFields=[],null!=this.currentEncounter.result)this.state=12,this.temporaryClickableFields.push([20,110+15*Math.floor(8/60)-20,60,30]);else{this.state=10;for(let t=0;t<this.currentEncounter.options.length;t++){let e=!0;if(4!=this.currentEncounter.special&&10!=this.currentEncounter.special||(e=this.currentEncounter.cost[t].affordable(this.coinTotal,this.foodTotal,this.heroes[0].health)),e){let e=this.context.measureText("1. "+this.currentEncounter.options[t]);this.temporaryClickableFields.push([20,110+40*t+15*Math.floor(this.currentEncounter.text.length/60)-20,20+e,30]),console.log("adding for encounter: "+t+" "+this.temporaryClickableFields[this.temporaryClickableFields.length-1][0]+","+this.temporaryClickableFields[this.temporaryClickableFields.length-1][1]+","+this.temporaryClickableFields[this.temporaryClickableFields.length-1][2]+","+this.temporaryClickableFields[this.temporaryClickableFields.length-1][3])}else this.temporaryClickableFields.push([-1,-1,-1,-1,-1])}}else{1==this.currentEncounter.special&&(this.currentEncounter.result=null),this.temporaryClickableFields=[],this.state=102,this.currentEncounter.state=100;let t=this.map[this.level].data[this.mapPos].n;this.blinkers=[];for(let e=0;e<t.length;e++){let i=this.map[this.level].getPos(t[e]);this.temporaryClickableFields.push([72*i[0]-44,56*i[1]-7,20,20,t[e]]),this.blinkers.push(t[e]),console.log("Add neigh "+t[e])}}}}}startGame(){this.gameStarted=!0}mulberry32(t){return function(){var e=t+=1831565813;return e=Math.imul(e^e>>>15,1|e),(((e^=e+Math.imul(e^e>>>7,61|e))^e>>>14)>>>0)/4294967296}}createTile(t,e,i){for(let s=0;s<this.designs.length;s++)if(console.log("comparing "+t+" with "+this.designs[s]),t==this.designs[s])return new o(this.context,e,i,s,this.px);return null}createTileDesigns(t){let e=[t.length];for(let i=0;i<t.length;i++)e[i]=[],t[i].replace(/./g,t=>{let s=t.charCodeAt();e[i].push(7&s),e[i].push(s>>3&7)});return e}},u=(s(1),s(0)),v=s.n(u);
/*! @source http://purl.eligrey.com/github/Blob.js/blob/master/Blob.js */
if("function"!=typeof f||void 0===p)if("function"==typeof f&&"undefined"!=typeof webkitURL)var p=webkitURL;else var f=function(t){var e=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder||function(t){var e=function(t){return Object.prototype.toString.call(t).match(/^\[object\s(.*)\]$/)[1]},i=function(){this.data=[]},s=function(t,e,i){this.data=t,this.size=t.length,this.type=e,this.encoding=i},h=i.prototype,o=s.prototype,n=t.FileReaderSync,l=function(t){this.code=this[this.name=t]},a="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),r=a.length,c=t.URL||t.webkitURL||t,d=c.createObjectURL,u=c.revokeObjectURL,v=c,p=t.btoa,f=t.atob,g=!1,m=t.ArrayBuffer,x=t.Uint8Array;for(s.fake=o.fake=!0;r--;)l.prototype[a[r]]=r+1;try{x&&function(t){g=!t}.apply(0,new x(3528e4))}catch(t){}return c.createObjectURL||(v=t.URL={}),v.createObjectURL=function(t){var e,i=t.type;return null===i&&(i="application/octet-stream"),t instanceof s?(e="data:"+i,"base64"===t.encoding?e+";base64,"+t.data:"URI"===t.encoding?e+","+decodeURIComponent(t.data):p?e+";base64,"+p(t.data):e+","+encodeURIComponent(t.data)):d?d.call(c,t):void 0},v.revokeObjectURL=function(t){"data:"!==t.substring(0,5)&&u&&u.call(c,t)},h.append=function(t){var i=this.data;if(x&&(t instanceof m||t instanceof x))if(g)i.push(String.fromCharCode.apply(String,new x(t)));else{for(var h="",o=new x(t),a=0,r=o.length;a<r;a++)h+=String.fromCharCode(o[a]);i.push(h)}else if("Blob"===e(t)||"File"===e(t)){if(!n)throw new l("NOT_READABLE_ERR");var c=new n;i.push(c.readAsBinaryString(t))}else t instanceof s?"base64"===t.encoding&&f?i.push(f(t.data)):"URI"===t.encoding?i.push(decodeURIComponent(t.data)):"raw"===t.encoding&&i.push(t.data):("string"!=typeof t&&(t+=""),i.push(unescape(encodeURIComponent(t))))},h.getBlob=function(t){return arguments.length||(t=null),new s(this.data.join(""),t,"raw")},h.toString=function(){return"[object BlobBuilder]"},o.slice=function(t,e,i){var h=arguments.length;return h<3&&(i=null),new s(this.data.slice(t,h>1?e:this.data.length),i,this.encoding)},o.toString=function(){return"[object Blob]"},i}(t);return function(t,i){var s=i&&i.type||"",h=new e;if(t)for(var o=0,n=t.length;o<n;o++)h.append(t[o]);return h.getBlob(s)}}(self);document.getElementById("song1"),document.getElementById("clear");let g=new d;gameCanvas.onmousedown=(t=>{t.preventDefault();[down_x,down_y]=update_mouse(t),i.textContent=t.offsetX+","+t.offsetY,g.click(t)}),oncontextmenu=(t=>{t.preventDefault()}),v.a.setUpdate(g.update).setDraw(g.render).setSimulationTimestep(1e3/60),v.a.start()}]);</script></body><script type="text/javascript">function resizeGame() {
}
function resizesGame() {
    var gameArea = document.getElementById('gameArea');
    var widthToHeight = 32/80;
    var newWidth = window.innerWidth;
    var newHeight = window.innerHeight;
    var newWidthToHeight = newWidth / newHeight;
    
    if (newWidthToHeight > widthToHeight) {
        newWidth = newHeight * widthToHeight;
        gameArea.style.height = newHeight + 'px';
        gameArea.style.width = newWidth + 'px';
    } else {
        newHeight = newWidth / widthToHeight;
        gameArea.style.width = newWidth + 'px';
        gameArea.style.height = newHeight + 'px';
    }
    
    gameArea.style.marginTop = (-newHeight / 2) + 'px';
    gameArea.style.marginLeft = (-newWidth / 2) + 'px';
    
    var gameCanvas = document.getElementById('gameCanvas');
    gameCanvas.width = newWidth;
    gameCanvas.height = newHeight;
}
resizeGame()
window.addEventListener('resize', resizeGame, false);
window.addEventListener('orientationchange', resizeGame, false);
function requestFullScreen() {

  var el = document.body;

  // Supports most browsers and their versions.
  var requestMethod = el.requestFullScreen || el.webkitRequestFullScreen 
  || el.mozRequestFullScreen || el.msRequestFullScreen;

  if (requestMethod) {

    // Native full screen.
    requestMethod.call(el);

  } else if (typeof window.ActiveXObject !== "undefined") {

    // Older IE.
    var wscript = new ActiveXObject("WScript.Shell");

    if (wscript !== null) {
      wscript.SendKeys("{F11}");
    }
  }
}
/* Compute mouse / touch coordinates on the canvas */
/* Customizable canvas size */
let canvas_width = 30;
let canvas_height = 30;

/* Canvas offsets (changed onresize) */
let canvas_left = 0;
let canvas_top = 0;

/* Canvas "real" size (changed onresize) */
let canvas_real_width = 0;
let canvas_real_height = 0;
let down_x = 0
let down_y = 0
update_mouse = e => {

  let pointer = {};
  if(e.changedTouches){
    pointer = e.changedTouches[0];
  }
  else {
    pointer = e;
  }
  
  return [
    ~~(((pointer.pageX) - canvas_left) * canvas_width / canvas_real_width),
    ~~(((pointer.pageY) - canvas_top) * canvas_height / canvas_real_height)
  ];
}
/* Mousedown / touchstart */
ontouchstart = e => {
  //onmousedown(e)
};</script></html>