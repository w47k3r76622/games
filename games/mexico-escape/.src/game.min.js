function SfxrParams(){this.setSettings=function(a){for(var r=0;r<24;r++)this[String.fromCharCode(97+r)]=a[r]||0;this.c<.01&&(this.c=.01);var t=this.b+this.c+this.e;if(t<.18){var e=.18/t;this.b*=e,this.c*=e,this.e*=e}}}function SfxrSynth(){this._params=new SfxrParams;var a,r,t,e,s,i,n,h,o,$,u,l;this.reset=function(){var a=this._params;e=100/(a.f*a.f+.001),s=100/(a.g*a.g+.001),i=1-a.h*a.h*a.h*.01,n=-a.i*a.i*a.i*1e-6,a.a||(u=.5-a.n/2,l=5e-5*-a.o),h=1+a.l*a.l*(a.l>0?-.9:10),o=0,$=1==a.m?0:(1-a.m)*(1-a.m)*2e4+32},this.totalReset=function(){this.reset();var e=this._params;return a=e.b*e.b*1e5,r=e.c*e.c*1e5,t=e.e*e.e*1e5+12,3*((a+r+t)/3|0)},this.synthWave=function(E,c){var q=this._params,b=1!=q.s||q.v,f=q.v*q.v*.1,d=1+3e-4*q.w,p=q.s*q.s*q.s*.1,k=1+1e-4*q.t,j=1!=q.s,m=q.x*q.x,R=q.g,S=q.q||q.r,A=q.r*q.r*q.r*.2,T=q.q*q.q*(q.q<0?-1020:1020),L=q.p?((1-q.p)*(1-q.p)*2e4|0)+32:0,O=q.d,g=q.j/2,C=q.k*q.k*.01,Y=q.a,y=a,v=1/a,P=1/r,D=1/t,I=5/(1+q.u*q.u*20)*(.01+p);I>.8&&(I=.8),I=1-I;for(var w,G,_,x,B,F,H=!1,M=0,N=0,U=0,X=0,V=0,K=0,W=0,z=0,J=0,Q=0,Z=new Array(1024),aa=new Array(32),ra=Z.length;ra--;)Z[ra]=0;for(var ra=aa.length;ra--;)aa[ra]=2*Math.random()-1;for(var ra=0;ra<c;ra++){if(H)return ra;if(L&&++J>=L&&(J=0,this.reset()),$&&++o>=$&&($=0,e*=h),i+=n,e*=i,e>s&&(e=s,R>0&&(H=!0)),G=e,g>0&&(Q+=C,G*=1+Math.sin(Q)*g),G|=0,G<8&&(G=8),Y||(u+=l,u<0?u=0:u>.5&&(u=.5)),++N>y)switch(N=0,++M){case 1:y=r;break;case 2:y=t}switch(M){case 0:U=N*v;break;case 1:U=1+2*(1-N*P)*O;break;case 2:U=1-N*D;break;case 3:U=0,H=!0}S&&(T+=A,_=0|T,_<0?_=-_:_>1023&&(_=1023)),b&&d&&(f*=d,f<1e-5?f=1e-5:f>.1&&(f=.1)),F=0;for(var ta=8;ta--;){if(W++,W>=G&&(W%=G,3==Y))for(var ea=aa.length;ea--;)aa[ea]=2*Math.random()-1;switch(Y){case 0:B=W/G<u?.5:-.5;break;case 1:B=1-W/G*2;break;case 2:x=W/G,x=6.28318531*(x>.5?x-1:x),B=1.27323954*x+.405284735*x*x*(x<0?1:-1),B=.225*((B<0?-1:1)*B*B-B)+B;break;case 3:B=aa[Math.abs(32*W/G|0)]}b&&(w=K,p*=k,p<0?p=0:p>.1&&(p=.1),j?(V+=(B-K)*p,V*=I):(K=B,V=0),K+=V,X+=K-w,X*=1-f,B=X),S&&(Z[z%1024]=B,B+=Z[(z-_+1024)%1024],z++),F+=B}F*=.125*U*m,E[ra]=F>=1?32767:F<=-1?-32768:32767*F|0}return c}}var synth=new SfxrSynth;window.jsfxr=function(a){synth._params.setSettings(a);var r=synth.totalReset(),t=new Uint8Array(4*((r+1)/2|0)+44),e=2*synth.synthWave(new Uint16Array(t.buffer,44),r),s=new Uint32Array(t.buffer,0,44);s[0]=1179011410,s[1]=e+36,s[2]=1163280727,s[3]=544501094,s[4]=16,s[5]=65537,s[6]=44100,s[7]=88200,s[8]=1048578,s[9]=1635017060,s[10]=e,e+=44;for(var i=0,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h="data:audio/wav;base64,";i<e;i+=3){var o=t[i]<<16|t[i+1]<<8|t[i+2];h+=n[o>>18]+n[o>>12&63]+n[o>>6&63]+n[63&o]}return h},$={},$.W=640,$.H=360,$.w=window,$.d=document,$.LEVELS={peyote_speed:[-250,-290,-330,-370,-410],peyote_spawn_time_multiplier:[1,.9,.7,.65,.5],sombrero_speed:[-250,-270,-290,-310,-330],sombrero_spawn_chance:[5e-4,.001,.0025,.005,.0075],glitch_spawn_chance:[.0025,.005,.0075,.1,.2]},$.LEVEL=0,$.LEVEL_MAX=5,$.DEAD=!0,$.ONE_RUN=!1,$.REVIVING=!1,$.SPEED={base:-15,value:0,max:1.5*$.W,multiplier:15,multiplierDef:15,decreaseMultiplier:3},$.SPEED.update=function(a){$.DEAD&&!$.REVIVING?$.SPEED.value+=900*a:($.SPEED.value+=$.SPEED.base*$.SPEED.multiplier*a,$.SPEED.multiplier-=a*$.SPEED.decreaseMultiplier,$.SPEED.multiplier=$.UTILS.clamp($.SPEED.multiplier,1,1e4)),$.SPEED.value=$.UTILS.clamp($.SPEED.value,-$.SPEED.max,0)},$.SOUNDS={jump:{src:[0,,.1312,,.264,.3,,.2094,.02,,,-.02,,.39,,,.02,,1,,,,,.5],volume:.1,audio:null},hit:{src:[0,,.0436,,.1363,.3791,,-.3996,,,,,,.0972,,,,,1,,,,,.5],volume:.7,audio:null},die:{src:[3,.0206,.0727,.0043,.3537,.2433,,-.6639,.0056,,,-.0232,.0432,,.0159,.0447,-.0287,-.0176,1,.0257,,.0442,.0393,.29],volume:1,audio:null}},$.SOUND_MANAGER={},$.SOUND_MANAGER.init=function(){Object.keys($.SOUNDS).forEach(function(a){$.SOUNDS[a].audio=new Audio,$.SOUNDS[a].audio.src=jsfxr($.SOUNDS[a].src),$.SOUNDS[a].audio.volume=$.SOUNDS[a].volume})},$.w.requestAnimFrame=function(){return $.w.requestAnimationFrame||$.w.webkitRequestAnimationFrame||$.w.mozRequestAnimationFrame||function(a){$.w.setTimeout(a,1e3/60)}}(),$.UTILS={},$.UTILS.clamp=function(a,r,t){return a<r?r:a>t?t:a},$.UTILS.px=function(a){return a+"px"},CanvasRenderingContext2D.prototype.roundRect=function(a,r,t,e,s){return t<2*s&&(s=t/2),e<2*s&&(s=e/2),this.beginPath(),this.moveTo(a+s,r),this.arcTo(a+t,r,a+t,r+e,s),this.arcTo(a+t,r+e,a,r+e,s),this.arcTo(a,r+e,a,r,s),this.arcTo(a,r,a+t,r,s),this.closePath(),this},$.MOBILE=function(){var a=!1;return function(r){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(r)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(r.substr(0,4)))&&(a=!0)}(navigator.userAgent||navigator.vendor||window.opera),a}(),$.RECT=function(a,r,t,e){this.x=a,this.y=r,this.w=t,this.h=e},$.RECT.prototype.collidesWith=function(a){return this.x<a.x+a.w&&this.x+this.w>a.x&&this.y<a.y+a.h&&this.h+this.y>a.y},$.KEYBOARD={},$.KEYBOARD.STATE={},$.KEYBOARD.STATE.UP=0,$.KEYBOARD.STATE.PRESSED=1,$.KEYBOARD.STATE.DOWN=2,$.KEYBOARD.KEYS={},$.KEYBOARD._keydown=function(a){var r=a.which;$.KEYBOARD.KEYS[r]||$.KEYBOARD.KEYS[r]==$.KEYBOARD.STATE.UP||($.KEYBOARD.KEYS[r]=$.KEYBOARD.STATE.UP),$.KEYBOARD.KEYS[r]==$.KEYBOARD.STATE.PRESSED&&($.KEYBOARD.KEYS[r]=$.KEYBOARD.STATE.DOWN),$.KEYBOARD.KEYS[r]==$.KEYBOARD.STATE.UP&&($.KEYBOARD.KEYS[r]=$.KEYBOARD.STATE.PRESSED)},$.KEYBOARD._keyup=function(a){var r=a.which;$.KEYBOARD.KEYS[r]=$.KEYBOARD.STATE.UP},$.KEYBOARD.init=function(){document.body.addEventListener("keydown",$.KEYBOARD._keydown),document.body.addEventListener("keyup",$.KEYBOARD._keyup)},$.GFX_COLOR_TABLE={a:"000|000|000|000",b:"047|026|027|255",c:"073|044|040|255",d:"167|113|092|255",e:"051|120|030|255",f:"032|076|019|255",g:"017|039|010|255",h:"204|083|051|255",i:"090|037|023|255",j:"156|064|040|255",k:"120|049|030|255",l:"206|195|185|255",m:"176|166|157|255",n:"176|161|147|255",o:"145|133|121|255",p:"200|184|149|255",q:"195|172|123|255",r:"153|135|097|255",s:"105|089|055|255",t:"064|050|021|255",u:"173|144|092|255",v:"155|120|068|255",w:"251|223|132|255",x:"234|197|077|255",y:"239|224|211|255",z:"250|241|233|255",A:"225|206|189|255",B:"068|090|062|255",C:"046|054|044|255",D:"118|131|114|255",E:"085|096|081|255",F:"068|091|062|255",G:"041|049|038|255",H:"032|041|029|255"},$.GFX={bg_layer_1:{w:640,h:236,canvas:null,ctx:null,pack:"a83b6a629b19a620b21a619b22a618b22a616b24a616b24a616b24a615b25a458b3a154b26a455b7a151b27a454b8a151b27a453b9a151b27a452b11a150b28a450b13a149b29a131ba316b15a148b29a131ba315b17a147b29a131ba315b18a145b30a131ba313b21a144b30a130b2a311b24a143b30a130b2a310b26a141b31a130b2a302b37a137b32a130b2a301b41a131b35a130b2a300b44a129b36a129b2a299b46a128b36a128b3a298b48a127b37a126b4a297b50a125b38a126b4a296b51a125b39a125b4a286b3ab2a4b51a124b40a125b4a283b10a2b52a123b41a125b5a280b13ab53a8b2a6b11a95b41a125b5a273b3a3b69a6b21a92b44a124b5a269b80a3b24a89b46a123b7a240b3ab2a20b82a2b26a2b3a82b48a122b7a237ba2b7a18b118a78b50a122b8a235b12a15b121a75b53a120b9a234b13a14b124a58b7a6b57a3b3ab2a109b9a233b18a9b126a52b76a2b7a108b9a200b3ab2a23b23a2ba3b129a50b87a107b10a196ba2b7a20b29ab131a48b88a106b11a131b2a62b12a17b164a45b94a102b12a129b13a44b3ab2ab13a15b168a18b5a18b97a2ba36b3ab2a56b12a127b16a40bab25a10b173a11b10a10b107a23b2a2b3ab12a53b13a72b4a50b20ab2a33b29a2ba2b181a4b14a7b113a16b24a51b15a69b16a39b26a30b234a5b116a14b26a49b20ab2a61b27a28b28a28b359a9b32a39b31a14b3ab2a15b9a14b31a25b29a26b361a3b3ab36a33b35a10b12a10b12a13b32a23b32a23b363a2b44a27b38a8b14a8b14a11b34a21b35aba18b412a23b42a5b16a6b15a10b36a4b3ab2a10b39a14b415a21b45ab19a4b20a6b49a7b42a8b419a9b3ab2a3b93abab51a4b46a5b422a4ba2b157a2b49a2b425ab117565"},bg_layer_2:{w:640,h:175,canvas:null,ctx:null,pack:"a574c12a622c24a612c32a605c38a589c54a580c62a574c68a198c12a359c73a59c12a64c12a21c12a10c24a10c12a328c82a47c24a52c24a9c80a254c12a16c12a26c90a37c32a44c32ac88a244c24a4c24a18c96a30c38a23c142a237c60a12c101a24c44a14c151a134c12a16c12a57c66a3c113a7c57a8c157a104c12a10c24a4c24a10c12a16c261a3c162a96c108a4c434a90c556a81c565a72c572a13ca23ca19c586a5c11a13c11a8c99547"},bg_layer_3:{w:640,h:122,canvas:null,ctx:null,pack:"a236d26a599d45a591d63a360d6a199d7ad76a345d20a92d9a88d106a317d32a83d24a74d120a302d41a77d43a23d10a15d134a293d60a60d236a279d69a55d239a272d83a45d246a261d112a14d263a246d399a236d413a223d426a204d441a183d462a159d486a150d495a141d530a88d572a39d4a23d65409"},player:{w:41,h:89,canvas:null,ctx:null,pack:"a14ea40fa40fea39gfa39gfea39gfea39gfea39gf2ea38gf2ea38gf2a39gf2ea37gf2ea37gf3a36g2f3ea35gfgf3a30g4fgfgf3e6a23g4fgfgf6efefe2a20g4fgfgf8efef2ea18g4fgfgf12ef2ea16g6fgf14hgfea14g6fgf5ef8h4ga14i2g3fgfgj2gefej2gf4eh5a13ik2g3fgjkjkgej4g2fefeh5a11i2k2g2fgjkj9hjg2feh5a11i2k7jkjkj7hjh9a9i2k7jkj11hjh8a9i2k8jkjkj7hjh10a8i2k7jkj11hjh9a8i2k6jkj11hjhjh8a7i2k8jkjkj9hjhj2h6a7i2k7jkj13hl2mjh6a6i2k8j14l4mjh5a6i2k7jkjkj11l2nomjh5a6i2k8j14l2nomjh5a6i2k7jkjkj11l4mjh5a6i2k6jkj15l2mjh6a6i2k7jkjkj11hjhjh7a6i2k6jkj15hjh8a6i2k7jkjkj11hjh9a6i2k6jkj13hjhjh8a7ik6jkj14hjh8a8i2k6jkjkj10hjh9a9ik5jkj14hjh2lmh4a9ik6jkjkj10hjh3lmh4a10k7j14h9a11k6jkj12hjh8a11ik6jkjkj10h8a13k5jkj12hjh6a14k6jkjkj8hjh7a14k5jkj12h8a14k6jkjkj8hjh6a15k5jkj10hjh7a15k4jkjkjkj6hjh8a15k5jkj10hjh6a16k4jkjkjkj6hjh7a16k5jkj10h8a16k4jkj10hjh6a17k3jkjkjkj6hjhjh5a17k4jkj10hjh5a18k3jkj10hjh6a18k2jkjkjkj6hjh6a18ik3jkj8hjhjh5a18k3jkj10hjh5a19k4jkjkj6hjh6a19k3jkj8hjh6a19k3jkj2kj5hjh7a19k2jkj10h7a20k3jkjkj6hjh5a20ik2jkj8hjh6a20k4jkjkj6h6a21k3jkj8hjh4a22k2jkj10h5a22k3jkjkj7h4a23k2jkj9h5a23k3jkjkj6h4a23ik2jkj9h3a24k2jkjkjkj5h3a25k3jkj8h2a26k2jkj2kj5h2a26k2jkj8h3a26k3jkjkj4h3a26ik2jkj5h4a26ik2jkj5h4a27ik3jkjkjh3a28ik3jkj3h2a29ik3jkj2kha30i2k2jkj3a32ik4jka35k3ja36"},sombrero:{w:235,h:105,canvas:null,ctx:null,pack:"a105p25a210p25a210p25a210p25a210p25a205p5q5r5q5r5q5p5a200p5q5r5q5r5q5p5a200p5q5r5q5r5q5p5a200p5q5r5q5r5q5p5a200p5q5r5q5r5q5p5a200q5r5q5r5q5r5q5a200q5r5q5r5q5r5q5a200q5r5q5r5q5r5q5a200q5r5q5r5q5r5q5a200q5r5q5r5q5r5q5a195p5r5q5r5q5r5q5r5p5a190p5r5q5r5q5r5q5r5p5a190p5r5q5r5q5r5q5r5p5a190p5r5q5r5q5r5q5r5p5a190p5r5q5r5q5r5q5r5p5a185p5r5q5r25q5r5p5a180p5r5q5r25q5r5p5a180p5r5q5r25q5r5p5a180p5r5q5r25q5r5p5a180p5r5q5r25q5r5p5a180r20q5r5q5r20a180r20q5r5q5r20a180r20q5r5q5r20a180r20q5r5q5r20a180r20q5r5q5r20a175r5q5r5q5r25q5r5q5r5a170r5q5r5q5r25q5r5q5r5a170r5q5r5q5r25q5r5q5r5a170r5q5r5q5r25q5r5q5r5a170r5q5r5q5r25q5r5q5r5a170r65a170r65a170r65a170r65a170r65a170r65a170r65a170r65a170r65a170r65a170s5r5s5r5s5r5s5r5s5r5s5r5s5a170s5r5s5r5s5r5s5r5s5r5s5r5s5a170s5r5s5r5s5r5s5r5s5r5s5r5s5a170s5r5s5r5s5r5s5r5s5r5s5r5s5a170s5r5s5r5s5r5s5r5s5r5s5r5s5a165r75a160r75a160r75a160r75a160r75a80r10a70r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5a70r20a70r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5a70r20a70r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5a70r20a70r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5a70r20a70r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5a70r30a60s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5a60r40a60s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5a60r40a60s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5a60r40a60s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5a60r40a60s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5a60r20a5r25a50s5t5s5t5s5t5s5t5s5t5s5t5s5t5s5a50r25a10r25a50s5t5s5t5s5t5s5t5s5t5s5t5s5t5s5a50r25a10r25a50s5t5s5t5s5t5s5t5s5t5s5t5s5t5s5a50r25a10r25a50s5t5s5t5s5t5s5t5s5t5s5t5s5t5s5a50r25a10r25a50s5t5s5t5s5t5s5t5s5t5s5t5s5t5s5a50r25a10r10s5r35q5r5q5r5q85r5q5r5q5r35s5r10a10r10s5r35q5r5q5r5q85r5q5r5q5r35s5r10a10r10s5r35q5r5q5r5q85r5q5r5q5r35s5r10a10r10s5r35q5r5q5r5q85r5q5r5q5r35s5r10a10r10s5r35q5r5q5r5q85r5q5r5q5r35s5r10a10r10q5r10s5r5s5r145s5r5s5r5q5r15a10r10q5r10s5r5s5r145s5r5s5r5q5r15a10r10q5r10s5r5s5r145s5r5s5r5q5r15a10r10q5r10s5r5s5r145s5r5s5r5q5r15a10r10q5r10s5r5s5r145s5r5s5r5q5r15a15q5u5q5r5q5r10q5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5q5r10q5r5q10u5r5a20q5u5q5r5q5r10q5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5q5r10q5r5q10u5r5a20q5u5q5r5q5r10q5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5q5r10q5r5q10u5r5a20q5u5q5r5q5r10q5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5q5r10q5r5q10u5r5a20q5u5q5r5q5r10q5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5r5s5q5r10q5r5q10u5r5a20u5q5u5q5u5q5u5q10r5q5r10q5r10q5r10q5r10q5r10q5r10q5r10q5r5q15u5q5u5q5u5q5s5a20u5q5u5q5u5q5u5q10r5q5r10q5r10q5r10q5r10q5r10q5r10q5r10q5r5q15u5q5u5q5u5q5s5a20u5q5u5q5u5q5u5q10r5q5r10q5r10q5r10q5r10q5r10q5r10q5r10q5r5q15u5q5u5q5u5q5s5a20u5q5u5q5u5q5u5q10r5q5r10q5r10q5r10q5r10q5r10q5r10q5r10q5r5q15u5q5u5q5u5q5s5a20u5q5u5q5u5q5u5q10r5q5r10q5r10q5r10q5r10q5r10q5r10q5r10q5r5q15u5q5u5q5u5q5s5a25v5u10q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u10v5a30v5u10q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u10v5a30v5u10q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u10v5a30v5u10q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u10v5a30v5u10q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u10v5a40v5u25q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u25v5a50v5u25q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u25v5a50v5u25q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u25v5a50v5u25q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u25v5a50v5u25q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u5q5u25v5a75v5u125v5a100v5u125v5a100v5u125v5a100v5u125v5a100v5u125v5a50"},peyote:{w:21,h:23,canvas:null,ctx:null,pack:"a9w3a17waxawa14yzax3azya11y3z5y3a9yABy7BAya8ACy2Ay3Ay2DAa7C3yACAyADAyBD2a5C3EACF2AF3AGBD2a4C3ECF2CHFDFDGD3a3C3ECF4HF4DGD3a2C3EFCFCFHF2DF2GBD2aC4ECF4HF5GD4C3ECF2CF2HF3DFDGD3C3EF6HF6GD3C3ECFCF3HF3DFDGD3C4EF5HF5GD4C3BEFCF3HF2DF2GBD3C4EF5HF4DGD4aC2BCEFCF2HF4GD4a2C3BEF4HFDF2GBD3a3C3FEF3HF3GFD3a6C2ECB2HB2DGD2a9C2ECBHBDGD2a5"}},$.unpackColorTable=function(){Object.keys($.GFX_COLOR_TABLE).forEach(function(a){$.GFX_COLOR_TABLE[a]=$.GFX_COLOR_TABLE[a].split("|").map(function(a){return parseInt(a)})})},$.unpackGFX=function(a){$.unpackColorTable(),Object.keys($.GFX).forEach(function(a){var r=$.GFX[a];if(r.ctx=(r.canvas=document.createElement("canvas")).getContext("2d"),r.canvas.webkitImageSmoothingEnabled=!1,r.canvas.mozImageSmoothingEnabled=!1,r.canvas.imageSmoothingEnabled=!1,r.canvas.width=r.w,r.canvas.height=r.h,r.pack){var t,e,s,i=[];e=r.pack.split(/(\w\d*)/g).filter(function(a){return!!a});for(s in e)for(t=parseInt(e[s].substr(1),10),t=isNaN(t)?1:t;t--;)i.push($.GFX_COLOR_TABLE[e[s][0]][0],$.GFX_COLOR_TABLE[e[s][0]][1],$.GFX_COLOR_TABLE[e[s][0]][2],$.GFX_COLOR_TABLE[e[s][0]][3]);try{r.ctx.putImageData(new ImageData(new Uint8ClampedArray(i),r.w,r.h),0,0)}catch(n){for(var h=0;h<i.length;h+=4)r.ctx.beginPath(),r.ctx.fillStyle="rgba("+i[h]+", "+i[h+1]+", "+i[h+2]+", "+i[h+3]+")",r.ctx.fillRect(Math.floor(h/4%r.w),Math.floor(h/4/r.w),1,1)}}}),a()},$.PLAYER={score:0,baseX:150,x:-$.GFX.player.w,y:0,velY:0,jumpVel:-25,jumpVelMax:-25,yOffset:0,yOffsetSpeed:10,yOffsetDir:1,yOffsetMax:10,inAir:!1,collisionBox:new $.RECT(100,0,$.GFX.player.w-7,$.GFX.player.h-10)},$.PLAYER.getScreenY=function(){return $.PLAYER.y-$.PLAYER.yOffset+$.H-$.GFX.player.h-10},$.PLAYER.hasJumped=function(){return!$.DEAD&&($.KEYBOARD.KEYS[32]>$.KEYBOARD.STATE.UP||$.POINTER_DOWN)&&$.PLAYER.jumpVel},$.PLAYER.update=function(a){$.PLAYER.hasJumped()?($.PLAYER.inAir=!0,$.PLAYER.velY+=$.PLAYER.jumpVel*a*7,$.PLAYER.jumpVel-=$.PLAYER.jumpVelMax*a*9,$.PLAYER.jumpVel>=0&&($.PLAYER.jumpVel=0),$.MOBILE||$.SOUNDS.jump.audio.play()):$.PLAYER.inAir&&($.PLAYER.velY-=$.G*a),$.PLAYER.y+=$.PLAYER.velY,$.PLAYER.inAir&&$.PLAYER.y>0&&($.PLAYER.velY=0,$.PLAYER.y=0,$.PLAYER.inAir=!1,$.PLAYER.jumpVel=$.PLAYER.jumpVelMax),$.PLAYER.collisionBox.y=$.PLAYER.getScreenY(),$.PLAYER.yOffset+=$.PLAYER.yOffsetSpeed*$.PLAYER.yOffsetDir*a,$.PLAYER.yOffset>=$.PLAYER.yOffsetMax?($.PLAYER.yOffset=$.PLAYER.yOffsetMax,$.PLAYER.yOffsetDir=-1):$.PLAYER.yOffset<=0&&($.PLAYER.yOffset=0,$.PLAYER.yOffsetDir=1),$.DEAD&&($.REVIVING?$.PLAYER.x<$.PLAYER.baseX?$.PLAYER.x+=200*a:($.PLAYER.x=$.PLAYER.baseX,$.PLAYER.onReviveComplete()):$.PLAYER.x>-$.GFX.player.w&&($.PLAYER.x+=$.SPEED.value*a),$.PLAYER.collisionBox.x=$.PLAYER.x)},$.PLAYER.render=function(a){var r=$.UTILS.clamp(1-$.PLAYER.y/-100,0,1);a.save(),a.globalAlpha=.25*r,a.fillStyle="#000",a.beginPath(),a.ellipse(this.x+10,$.H-10,25*r,7*r,0,2*Math.PI,!1),a.fill(),a.restore(),a.drawImage($.GFX.player.canvas,this.x,$.PLAYER.getScreenY(),$.GFX.player.w,$.GFX.player.h)},$.PLAYER.die=function(){$.DEAD=!0,$.ONE_RUN=!0,$.LEVEL=0,$.SPEED.multiplier=$.SPEED.multiplierDef},$.PLAYER.revive=function(){$.REVIVING=!0},$.PLAYER.onReviveComplete=function(){$.PLAYER.score=0,$.REVIVING=!1,$.DEAD=!1},$.GLITCHES={list:[]},$.GLITCH_TYPE={},$.GLITCH_TYPE.PIXEL_SHIFT=0,$.GLITCH_TYPE.INVERT=1,$.GLITCH_TYPE.BLACK_AND_WHITE=2,$.GLITCH_TYPE.COLOR_SHIFT=3,$.GLITCHES_FOR_DEVICE_TYPE={desktop:[$.GLITCH_TYPE.PIXEL_SHIFT,$.GLITCH_TYPE.INVERT,$.GLITCH_TYPE.BLACK_AND_WHITE,$.GLITCH_TYPE.COLOR_SHIFT],mobile:[$.GLITCH_TYPE.INVERT,$.GLITCH_TYPE.BLACK_AND_WHITE]},$.GLITCHES_FOR_DEVICE=$.GLITCHES_FOR_DEVICE_TYPE[$.MOBILE?"mobile":"desktop"],$.GLITCHES_TYPES=[],$.GLITCH=function(){switch(this.type=$.GLITCHES_FOR_DEVICE[Math.floor(Math.random()*$.GLITCHES_FOR_DEVICE.length)],this.x=Math.random()*$.W,this.y=Math.random()*$.H,this.type){case $.GLITCH_TYPE.INVERT:case $.GLITCH_TYPE.BLACK_AND_WHITE:this.width=Math.floor(Math.random()*($.W-this.x)/2),this.height=Math.floor(Math.random()*($.H-this.y)/2),this.lifetime=.5*Math.random();break;case $.GLITCH_TYPE.COLOR_SHIFT:this.width=Math.floor(Math.random()*($.W-this.x)/2),this.height=Math.floor(Math.random()*($.H-this.y)/2),this.lifetime=Math.random(),this.shiftR=0,this.shiftG=0,this.shiftB=0;break;case $.GLITCH_TYPE.PIXEL_SHIFT:this.width=Math.floor(Math.random()*($.W-this.x)/2),this.height=Math.floor(Math.random()*($.H-this.y)/2),this.shift=0,this.lifetime=2*Math.random()}0!=this.width&&0!=this.height||(this.lifetime=0)},$.GLITCH.prototype.update=function(){switch(this.type){case $.GLITCH_TYPE.PIXEL_SHIFT:this.shift+=4*Math.floor(10*Math.random()-5);break;case $.GLITCH_TYPE.COLOR_SHIFT:this.shiftR+=10*Math.random()-5,this.shiftG+=10*Math.random()-5,this.shiftB+=10*Math.random()-5,this.shiftR-=this.shiftR>255?255:0,this.shiftR+=this.shiftR<0?255:0,this.shiftG-=this.shiftG>255?255:0,this.shiftG+=this.shiftG<0?255:0,this.shiftB-=this.shiftB>255?255:0,this.shiftB+=this.shiftB>0?255:0}},$.GLITCH.prototype.render=function(a){var r,t=[],e=a.getImageData(this.x,this.y,this.width,this.height);switch(e.data.map(function(a){t.push(a)}),this.type){case $.GLITCH_TYPE.INVERT:for(r=0;r<t.length;r+=4)t[r]=255-t[r],t[r+1]=255-t[r+1],t[r+2]=255-t[r+2];break;case $.GLITCH_TYPE.BLACK_AND_WHITE:for(r=0;r<t.length;r+=4){var s=.21*t[r]+.72*t[r+1]+.07*t[r+2];t[r]=s,t[r+1]=s,t[r+2]=s}break;case $.GLITCH_TYPE.COLOR_SHIFT:for(r=0;r<t.length;r+=4)t[r]+=this.shiftR,t[r+1]+=this.shiftG,t[r+2]+=this.shiftB;break;case $.GLITCH_TYPE.PIXEL_SHIFT:this.shift>0?t.unshift.apply(t,t.splice(this.shift)):this.shift<0&&t.push.apply(t,t.splice(0,-this.shift))}try{a.putImageData(new ImageData(new Uint8ClampedArray(t),e.width,e.height),this.x,this.y)}catch(i){}},$.GLITCHES.add=function(){$.GLITCHES.list.length<10&&$.GLITCHES.list.push(new $.GLITCH)},$.GLITCHES.update=function(a){$.GLITCHES.list.forEach(function(r,t){r.lifetime-=a,r.lifetime<=0?$.GLITCHES.list.splice(t,1):r.update(a)})},$.GLITCHES.render=function(a){$.GLITCHES.list.forEach(function(r){r.render(a)})},$.CRT={},$.CRT.interval=3,$.CRT.init=function(){for(var a=0;a<$.H;a+=$.CRT.interval)$.CTX.crt.beginPath(),$.CTX.crt.fillStyle="rgba(255, 255, 255, 0.15)",$.CTX.crt.rect(0,a,$.W,1),$.CTX.crt.fill(),$.CTX.crt.beginPath(),$.CTX.crt.fillStyle="rgba(255, 255, 255, 0.1)",$.CTX.crt.rect(0,a+1,$.W,1),$.CTX.crt.fill();var r=$.CTX.crt.createRadialGradient($.W/2,$.H/2,250,$.W/2,$.H/2,340);r.addColorStop(0,"rgba(0, 0, 0, 0)"),r.addColorStop(1,"rgba(0, 0, 0, 1)"),$.CTX.crt.fillStyle=r,$.CTX.crt.fillRect(0,0,$.W,$.H)},$.SOMBREROS={list:[]},$.SOMBRERO=function(){var a=30;this.x=$.W,this.y=30*Math.random()+a,this.velX=Math.abs(2*Math.random()-.5),this.type=Math.floor(2*Math.random()),this.scale=(this.y-a)/30*.4+.2,this.destroyed=!1},$.SOMBRERO.prototype.update=function(a){this.x+=Math.max($.SPEED.value,-500)*this.velX*a,this.x<-$.GFX.sombrero.w*this.scale&&(this.destroyed=!0)},$.SOMBRERO.prototype.render=function(a){a.save(),a.translate(this.x,this.y),a.scale(this.scale,this.scale),a.globalAlpha=$.UTILS.clamp(2.5*this.scale,0,1),a.drawImage($.GFX.sombrero.canvas,0,0),a.restore()},$.SOMBREROS.add=function(){$.SOMBREROS.list.push(new $.SOMBRERO)},$.SOMBREROS.update=function(a){for(var r=0;r<$.SOMBREROS.list.length;r++)$.SOMBREROS.list[r].destroyed?$.SOMBREROS.list.splice(r--,1):$.SOMBREROS.list[r].update(a)},$.SOMBREROS.render=function(a){$.SOMBREROS.list.forEach(function(r){r.render(a)})},$.PEYOTES={list:[]},$.PEYOTE=function(){this.scale=1.5*Math.random()+1,this.x=$.W,this.y=$.H-10-5*(1-this.scale/2.5),this.yOffset=$.GFX.peyote.h*this.scale,this.collisionBox=new $.RECT(this.x,this.y-this.yOffset,$.GFX.peyote.w*this.scale,$.GFX.peyote.h*this.scale),this.destroyed=!1},$.PEYOTE.prototype.update=function(a){this.x+=$.SPEED.value*a,this.collisionBox.x=this.x,!$.DEAD&&this.collisionBox.collidesWith($.PLAYER.collisionBox)&&($.LEVEL<$.LEVEL_MAX-1?($.LEVEL++,$.SOUNDS.hit.audio.play()):($.SOUNDS.die.audio.play(),$.PLAYER.die()),this.destroyed=!0),this.x<-$.GFX.peyote.w*this.scale&&(this.destroyed=!0,$.PLAYER.score+=Math.round(147*this.scale)*Math.pow($.LEVEL+1,2))},$.PEYOTE.prototype.render=function(a){this.destroyed||(a.save(),a.translate(this.x,this.y-this.yOffset),a.scale(this.scale,this.scale),a.save(),a.globalAlpha=this.scale/2.5*.5,a.fillStyle="#000",a.beginPath(),a.ellipse($.GFX.peyote.w/2,23,15*this.scale/2.5,4*this.scale/2.5,0,2*Math.PI,!1),a.fill(),a.restore(),a.drawImage($.GFX.peyote.canvas,0,0),a.restore())},$.PEYOTES.add=function(){$.PEYOTES.list.push(new $.PEYOTE)},$.PEYOTES.time=1,$.PEYOTES.timer=0,$.PEYOTES["double"]=!1,$.PEYOTES.update=function(a){if(!$.DEAD)for($.PEYOTES.timer+=a;$.PEYOTES.timer>=$.PEYOTES.time;)$.PEYOTES.timer-=$.PEYOTES.time,$.PEYOTES.time=(Math.random()<.005?.75:1)*(1-.6*Math.abs($.SPEED.value/$.SPEED.max)+.2)*(1+.4*Math.random()),$.PEYOTES.add();for(var r=0;r<$.PEYOTES.list.length;r++)$.PEYOTES.list[r].destroyed?$.PEYOTES.list.splice(r--,1):$.PEYOTES.list[r].update(a)},$.PEYOTES.render=function(a){$.PEYOTES.list.forEach(function(r){r.render(a)})},$.BACKGROUND={layers:3,offset:[0,0,0],baseSpeed:-5,speed:[0,0,0],speedMultiplier:[.8,.9,1]},$.BACKGROUND.update=function(a){for(var r=0;r<$.BACKGROUND.layers;r++)$.BACKGROUND.offset[r]+=$.SPEED.value*$.BACKGROUND.speedMultiplier[r]*a,$.BACKGROUND.offset[r]+=$.BACKGROUND.offset[r]<=-$.W?$.W:0},$.BACKGROUND.render=function(a){var r=a.createLinearGradient(0,0,0,$.H/2);r.addColorStop(0,"#749dc8"),r.addColorStop(1,"#d5c3b2"),a.fillStyle=r,a.fillRect(0,0,$.W,$.H/2);for(var t=0;t<$.BACKGROUND.layers;t++)a.drawImage($.GFX["bg_layer_"+(t+1)].canvas,$.BACKGROUND.offset[t]+$.W,$.H-$.GFX["bg_layer_"+(t+1)].h),a.drawImage($.GFX["bg_layer_"+(t+1)].canvas,$.BACKGROUND.offset[t],$.H-$.GFX["bg_layer_"+(t+1)].h)},$.UI={logoY:-80,logoYMin:-80,logoYMax:60,startAlpha:0,menuShowing:!1},$.UI.update=function(a){$.DEAD&&($.REVIVING?($.UI.logoY-=200*a,$.UI.startAlpha-=a):($.UI.logoY+=200*a,$.UI.startAlpha+=a),$.UI.logoY=$.UTILS.clamp($.UI.logoY,$.UI.logoYMin,$.UI.logoYMax),$.UI.startAlpha=$.UTILS.clamp($.UI.startAlpha,0,1),$.UI.menuShowing=$.UI.logoY==$.UI.logoYMax&&1==$.UI.startAlpha)},$.UI.render=function(a){if(a.strokeStyle=a.fillStyle="#fff",$.DEAD){a.fillStyle="#143";var r=90;a.roundRect(r,$.UI.logoY,$.W-2*r,80,5).fill(),a.strokeStyle="#fff",a.roundRect(r+5,$.UI.logoY+5,$.W-2*(r+5),70,3).stroke(),a.textAlign="center",a.font="bold 50px sans-serif",a.fillStyle="#333";var t="MEXICO ESCAPE";a.fillText(t,$.W/2,$.UI.logoY+60),a.fillStyle="#fff",a.fillText(t,$.W/2,$.UI.logoY+58),a.save(),a.globalAlpha=$.UI.startAlpha,$.ONE_RUN&&(a.font="bold 24px sans-serif",a.fillText("SCORE: "+$.PLAYER.score,$.W/2,210)),a.font="bold 16px sans-serif",a.fillText(($.MOBILE?"TAP":"PRESS SPACE")+" TO START",$.W/2,300),a.restore()}else a.save(),a.translate(40,20),a.scale(2,2),a.textAlign="left",a.lineWidth=2,a.strokeRect(0,0,100,8),a.stroke(),a.clearRect(-1,-1,2,2),a.clearRect(-1,7,2,2),a.clearRect(99,-1,2,2),a.clearRect(99,7,2,2),a.beginPath(),a.fillRect(2,2,$.DEAD?0:96/$.LEVEL_MAX*($.LEVEL_MAX-$.LEVEL),4),a.fill(),a.font="bold 7px sans-serif",a.fillText("SANITY",1,16),a.restore(),a.save(),a.translate($.W-250,20),a.scale(2,2),a.lineWidth=2,a.strokeRect(0,0,100,8),a.stroke(),a.clearRect(-1,-1,2,2),a.clearRect(-1,7,2,2),a.clearRect(99,-1,2,2),a.clearRect(99,7,2,2),a.textAlign="right",a.font="bold 7px sans-serif",a.fillText("SCORE",99,16),a.font="bold 7px sans-serif",a.fillText(""+$.PLAYER.score,98,6.5),a.restore()},$.CNV={game:null,ui:null,crt:null},$.CTX={game:null,ui:null,crt:null},$.G=-78.4,$.SCALE=1,$.POINTER_DOWN=!1,$.canvases=["game","ui","crt"],$.canvasesToRedraw=["game","ui"],$.init=function(){$.canvases.forEach(function(a){$.CNV[a]=$.d.createElement("canvas"),$.CNV[a].id="cnv_"+a,$.CTX[a]=$.CNV[a].getContext("2d"),$.CNV[a].mozImageSmoothingEnabled=!1,$.CNV[a].webkitImageSmoothingEnabled=!1,$.CNV[a].imageSmoothingEnabled=!1,$.CNV[a].width=$.W,$.CNV[a].height=$.H,$.d.body.appendChild($.CNV[a])}),$.resize(),$.w.addEventListener("resize",$.resize),$.d.body.addEventListener("touchstart",function(){$.POINTER_DOWN=!0,$.MOBILE&&$.PLAYER.hasJumped()&&$.SOUNDS.jump.audio.play()}),$.d.body.addEventListener("touchend",function(){$.POINTER_DOWN=!1}),$.d.body.addEventListener("touchleave",function(){$.POINTER_DOWN=!1}),$.SOUND_MANAGER.init(),$.KEYBOARD.init(),$.CRT.init(),$.unpackGFX(function(){$.loop()})},$.resize=function(){var a=innerWidth,r=innerHeight,t=a/$.W,e=r/$.H;$.SCALE=Math.min(t,e);var s=(a-$.W*$.SCALE)/2,i=(r-$.H*$.SCALE)/2;$.canvases.forEach(function(a){$.CNV[a].style.position="absolute",$.CNV[a].style.width=$.UTILS.px($.W),$.CNV[a].style.height=$.UTILS.px($.H),$.CNV[a].style.top=$.UTILS.px(i),$.CNV[a].style.left=$.UTILS.px(s),$.CNV[a].style.transformOrigin="0 0",$.CNV[a].style.transform="scale("+$.SCALE+", "+$.SCALE+")",$.CNV[a].style.webkitTransform="scale("+$.SCALE+", "+$.SCALE+")"})},$.lsts=0,$.loop=function(){requestAnimFrame($.loop);var a=Date.now();$.lsts||($.lsts=a);var r=(a-$.lsts)/1e3;$.lsts=a,$.update(r),$.render()},$.update=function(a){$.DEAD&&$.UI.menuShowing&&($.KEYBOARD.KEYS[32]>$.KEYBOARD.STATE.UP||$.POINTER_DOWN)&&$.PLAYER.revive(),$.UI.update(a),$.PLAYER.update(a),$.SPEED.update(a),$.BACKGROUND.update(a),Math.random()<$.LEVELS.glitch_spawn_chance[$.LEVEL]&&$.GLITCHES.add(),Math.random()<$.LEVELS.sombrero_spawn_chance[$.LEVEL]&&$.SOMBREROS.add(),$.GLITCHES.update(a),$.SOMBREROS.update(a),$.PEYOTES.update(a)},$.render=function(){$.canvasesToRedraw.forEach(function(a){$.CTX[a].clearRect(0,0,innerWidth,innerHeight)}),$.BACKGROUND.render($.CTX.game),$.PEYOTES.render($.CTX.game),$.SOMBREROS.render($.CTX.game),$.PLAYER.render($.CTX.game),$.GLITCHES.render($.CTX.game),$.UI.render($.CTX.ui)},$.w.onload=$.init;