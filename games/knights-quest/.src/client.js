!function(){"use strict";var t=function(){return(t=Object.assign||function(t){for(var e,a=1,n=arguments.length;a<n;a++)for(var i in e=arguments[a])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};const e=3e4,a=3e4,n=0,i=1,o=2,s=3,r=4,l=t=>t*Math.PI/180,h=(t,e,a,n,i)=>{let o=(s=t,Math.cos(l(s)));var s;let r=(t=>Math.sin(l(t)))(t);return[o*(n-e)-r*(i-a)+e,r*(n-e)+o*(i-a)+a]},c=t=>parseInt(t%360),u=(t,e)=>{if(["string","number","boolean"].includes(typeof e))return e===t?void 0:e;if(e instanceof Array){if(t&&0==t.length&&0==e.length)return;return e}let a,n;return"object"==typeof e&&Object.keys(e).forEach(i=>{a=void 0!==t?u(t[i],e[i]):e[i],null!=a&&(n={...n,[i]:a})}),n};var d=0,g=0,f=document.getElementById("root"),y=f.offsetWidth/2,P=f.offsetHeight/2,m=!1;document.addEventListener("mousemove",(function(t){d=t.clientX,g=t.clientY})),document.addEventListener("touchmove",(function(t){d=t.targetTouches[0].clientX,g=t.targetTouches[0].clientY})),document.addEventListener("mousedown",(function(){0!=navigator.maxTouchPoints&&1!=navigator.maxTouchPoints&&256!=navigator.maxTouchPoints||(m=!0)})),document.addEventListener("mouseup",(function(){0!=navigator.maxTouchPoints&&1!=navigator.maxTouchPoints&&256!=navigator.maxTouchPoints||(m=!1)}));var v=!1;function b(){y=f.offsetWidth/2,P=f.offsetHeight/2}function p(){return((t,e)=>{const a=180*Math.atan2(t,e)/Math.PI;return c(a+360)})(g-P,d-y)}document.addEventListener("touchstart",(function(t){if(0!==navigator.maxTouchPoints&&1!==navigator.maxTouchPoints&&256!==navigator.maxTouchPoints)return v?void(m=!0):(v=!0,void setTimeout((function(){v=!1}),300))})),document.addEventListener("touchend",(function(t){0!==navigator.maxTouchPoints&&1!==navigator.maxTouchPoints&&256!==navigator.maxTouchPoints&&(m=!1)})),window.addEventListener("resize",(function(){return b}));var x={mouseAngleDegrees:0,leaderboard:[],minimap:[]};function w(t){x.items=t.items,x.players=t.players}function A(t){x.leaderboard=t.leaderboard}function F(t){x.minimap=t.minimap}function T(){return x}function E(){return null==x||null==x.players||null==x.players[x.playerId]?null:x.players[x.playerId]}function D(t,e,a,n,i,o){t.save(),t.fillStyle=o,t.rect(e,a,n,i),t.fill(),t.restore()}function I(t,e,a,n,i,o,s,r){t.save(),t.fillStyle=r,t.moveTo(e,a),t.lineTo(n,i),t.lineTo(o,s),t.fill(),t.restore()}function M(t,e,a,n,i,o,s){t.save(),t.fillStyle=o,t.strokeStyle=s,t.ellipse(e,a,n,i,0,0,2*Math.PI),t.fill(),t.stroke(),t.restore()}function S(t,e,a,n,i){var o=2*n*.6,s=o/5,r=o/5,l=o/2;t.beginPath(),M(t,e,a,n,i,"white","gray"),t.closePath(),t.beginPath(),D(t,e-o/2,a+r,o,s,"brown"),t.closePath(),t.beginPath(),D(t,e-o/2,a,o,s,"gray"),t.closePath(),t.beginPath(),t.arc(e,a,o/2,Math.PI,2*Math.PI),t.fillStyle="gray",t.fill(),t.closePath(),t.beginPath(),t.arc(e-l,a,l/2,Math.PI,2*Math.PI),t.fillStyle="gray",t.fill(),t.closePath(),t.beginPath(),t.arc(e+l,a,l/2,Math.PI,2*Math.PI),t.fillStyle="gray",t.fill(),t.closePath()}function B(t,e,a,n,i){var o=.2*i,s=o,r=2*n*.5,l=o,h=r/2;t.beginPath(),M(t,e,a,n,i,"white","gray"),t.closePath(),t.beginPath(),D(t,e-r/2,a+s,r,o,"gray"),t.closePath(),t.beginPath(),D(t,e-r/2,a,h,l,"gray"),t.closePath(),t.beginPath(),t.arc(e,a,r/2,Math.PI,2*Math.PI),t.fillStyle="gray",t.fill(),t.closePath()}function L(t,e,a,n,i){var o=.6*i*2,s=.15*n,r=.5*n,l=.4*i;t.beginPath(),M(t,e,a,n,i,"white","silver"),t.closePath(),t.beginPath(),D(t,e-s/2,a-.9*i,s,o,"silver"),t.closePath(),t.beginPath(),D(t,e-r/2,a-.9*i+o,r,s,"silver"),t.closePath(),t.beginPath(),D(t,e-s/2,a-.9*i+o+s,s,l,"brown"),t.closePath()}function R(t,e,a,n,i){var o=i.fillStyle,s=i.font,r=i.globalAlpha,l=i.textAlign;t.beginPath(),t.translate(e,a),o&&(t.fillStyle=o),s&&(t.font=s),r&&(t.globalAlpha=r),l&&(t.textAlign=l),t.fillText(n,0,0),t.setTransform(1,0,0,1,0,0),t.globalAlpha=1,t.closePath()}function q(t,e,a,n,i,o,s,r,l,h,c,u,d,g){var f=2*n,y=18,P=16,m=.6;t.beginPath(),t.translate(e,a),function(t,e,a,n,i,o){M(t,e,a,n,n,i,o)}(t,0,0,i,h,1===(null==g?void 0:g.armor)?"#D0D2D1":c),t.setTransform(1,0,0,1,0,0),t.closePath(),t.translate(e,a),t.rotate(o),function(t,e,a,n,i){var o=.95*n,s=.05*n,r=.1*n,l=.1*n,h=5;t.beginPath(),D(t,e,a-2.5,o,5,i),t.closePath(),t.beginPath(),I(t,e+o,a-2.5,o+s,a,e+o,a+2.5,i),t.closePath(),t.beginPath(),D(t,e+l,a-l/2,5,l,i),t.closePath(),t.beginPath(),D(t,e-r,a-2.5,2*r,5,"#41270E"),t.closePath(),t.beginPath(),M(t,e-r-h,a,h,h,i,i),t.closePath()}(t,0,.75*n-2.5,200,1===(null==g?void 0:g.sword)?"#D0D2D1":"#333333"),t.setTransform(1,0,0,1,0,0),t.beginPath(),t.translate(e,a),t.rotate(o),C(t,0,-n/2,i/3,n/2,h,1===(null==g?void 0:g.armor)?"#D0D2D1":c),t.setTransform(1,0,0,1,0,0),t.closePath(),t.beginPath(),t.translate(e,a),t.rotate(o),C(t,0,n/2,i/3,n/2,h,1===(null==g?void 0:g.armor)?"#D0D2D1":c),t.setTransform(1,0,0,1,0,0),t.closePath(),t.beginPath(),t.translate(e,a),function(t,e,a,n,i,o){M(t,e,a,n,n,i,o)}(t,0,0,i/2,h,1===(null==g?void 0:g.helm)?"#D0D2D1":c),t.setTransform(1,0,0,1,0,0),t.closePath();R(t,e,a+i+40,s,{globalAlpha:m,fillStyle:"#FFFFDD",font:"24px sans-serif",textAlign:"center"});R(t,e,a+i+60,"Lv."+u+" - "+Math.round(d)+"xp",{globalAlpha:m,fillStyle:"#FFFFDD",font:"16px sans-serif",textAlign:"center"});t.beginPath(),t.translate(e,a),t.globalAlpha=m,D(t,f/-2,i+70,f,y,"#EB0945"),t.setTransform(1,0,0,1,0,0),t.globalAlpha=1,t.closePath(),t.beginPath(),t.translate(e,a),t.globalAlpha=m,D(t,f/-2,i+70,f*l/100,y,"#2E9E3D"),t.setTransform(1,0,0,1,0,0),t.globalAlpha=1,t.closePath(),R(t,e+f/-2+2,a+i+70+P-2,"Health",{globalAlpha:m,fillStyle:"#FFFFFF",font:"16px sans-serif",textAlign:"left"}),R(t,e+f-52,a+i+70+P-2,Math.round(l)+"%",{globalAlpha:m,fillStyle:"#FFFFFF",font:"16px sans-serif",textAlign:"right"});t.beginPath(),t.translate(e,a),t.globalAlpha=m,D(t,f/-2,i+95,f,y,"#FFAF24"),t.setTransform(1,0,0,1,0,0),t.globalAlpha=1,t.closePath(),t.beginPath(),t.translate(e,a),t.globalAlpha=m,D(t,f/-2,i+95,f*r/100,y,"#004C9E"),t.setTransform(1,0,0,1,0,0),t.globalAlpha=1,t.closePath(),R(t,e+f/-2+2,a+i+95+P-2,"Boost",{globalAlpha:m,fillStyle:"#FFFFFF",font:"16px sans-serif",textAlign:"left"}),R(t,e+f-52,a+i+95+P-2,r+"%",{globalAlpha:m,fillStyle:"#FFFFFF",font:"16px sans-serif",textAlign:"right"});g&&1===g.armor&&(t.beginPath(),t.translate(e,a),t.globalAlpha=m,S(t,-35,i+130,12,12),t.setTransform(1,0,0,1,0,0),t.globalAlpha=1,t.closePath()),g&&1===g.helm&&(t.beginPath(),t.translate(e,a),t.globalAlpha=m,B(t,0,i+130,12,12),t.setTransform(1,0,0,1,0,0),t.globalAlpha=1,t.closePath()),g&&1===g.sword&&(t.beginPath(),t.translate(e,a),t.globalAlpha=m,L(t,35,i+130,12,12),t.setTransform(1,0,0,1,0,0),t.globalAlpha=1,t.closePath())}function C(t,e,a,n,i,o,s){M(t,e,a,n,i,o,s)}function W(t,e,a){t.clearRect(0,0,e,a)}var k,Q=64,j=0,O=0,H=4*(1===window.devicePixelRatio?1:window.devicePixelRatio/2);function N(t,e){k=function(t,e){var a=document.createElement("canvas"),n=6*t,i=6*e;a.width=n,a.height=i;var o=a.getContext("2d");o.beginPath(),D(o,0,0,n,i,"#3F4656"),o.closePath();for(var s=0;s<i;s+=72)for(var r=0;r<n;r+=72)o.beginPath(),o.save(),o.translate(r,s),I(o,0,0,Q,0,0,Q,"#99A3BA16"),I(o,Q,0,Q,Q,0,Q,"#6C748616"),o.restore(),o.closePath();return a}(t,e)}function z(t,e){var a=function(t){var e=Math.cos(t),a=Math.sin(t);return{x:isNaN(e)?0:e,y:isNaN(a)?0:a}}(t),n=a.x,i=a.y,o=e?1.5*H:H;return((j+=n)>=72||j<=-72)&&(j=0),((O+=i)>=72||O<=-72)&&(O=0),{x:j*o*-1,y:O*o*-1}}var V,X=document.getElementById("root");function Y(){X.innerHTML="";var t=document.createElement("canvas"),e=X.offsetHeight,a=X.offsetWidth;return t.setAttribute("width",a.toString()),t.setAttribute("height",e.toString()),N(a,e),X.append(t),{ctx:t.getContext("2d"),el:t,width:a,height:e}}var G=1e3;const{min:J,max:K,sqrt:U}=Math;class Point{constructor(t,e){this.x=t,this.y=e}rotateAround(t,e=new Point(0,0)){let[a,n]=h(t,e.x,e.y,this.x,this.y);return this.x=a,this.y=n,this}}class Rectangle{constructor(t,e,a,n,i,o){this.x=t||0,this.y=e||0,this.w=a||0,this.h=n||0,this.data=i,this.action=o}contains(t){return t.x>=this.x-this.w&&t.x<=this.x+this.w&&t.y>=this.y-this.h&&t.y<=this.y+this.h}intersects(t){return this.x-this.w<t.x+t.w&&this.x+this.w>t.x-t.w&&this.y-this.h<t.y+t.h&&this.y+this.h>t.y-t.h}pure(){let{x:t,y:e,w:a,h:n,action:i}=this;return{x:t,y:e,w:a,h:n,action:i}}rotateAround(t,e=new Point(0,0)){let a=new Point(this.x-this.w,this.y-this.h).rotateAround(t,e),n=new Point(this.x-this.w,this.y+this.h).rotateAround(t,e),i=new Point(this.x+this.w,this.y-this.h).rotateAround(t,e),o=new Point(this.x+this.w,this.y+this.h).rotateAround(t,e);return this.toAABB([a,n,i,o])}toAABB(t=[]){let e=t.map(t=>t.x),a=t.map(t=>t.y),n=J(...e),i=J(...a),o=(K(...e)-n)/2,s=(K(...a)-i)/2;return this.x=n+o,this.y=i+s,this.w=o,this.h=s,this}}class Quadtree{constructor(t=new Rectangle(15e3,15e3,15e3,15e3),e=5){this.boundry=t,this.capacity=e,this.points=[],this.divided=!1}subdivide(){this.divided=!0;let t=this.boundry.x,e=this.boundry.y,a=this.boundry.w,n=this.boundry.h;this.northWest=new Quadtree(new Rectangle(t-a/2,e-n/2,a/2,n/2),this.capacity),this.northEast=new Quadtree(new Rectangle(t+a/2,e-n/2,a/2,n/2),this.capacity),this.southWest=new Quadtree(new Rectangle(t-a/2,e+n/2,a/2,n/2),this.capacity),this.southEast=new Quadtree(new Rectangle(t+a/2,e+n/2,a/2,n/2),this.capacity)}insert(t){return!!this.boundry.contains(t)&&(this.points.length<this.capacity?(this.points.push(t),!0):(this.divided||this.subdivide(),this.northWest.insert(t)||this.northEast.insert(t)||this.southWest.insert(t)||this.southEast.insert(t)))}query(t){let e=[];return this.boundry.intersects(t)&&(e=this.points.slice(),this.divided&&e.push(...this.northWest.query(t),...this.northEast.query(t),...this.southWest.query(t),...this.southEast.query(t))),e}}var Z,$,_,tt,et,at=.6,nt="#FFFFFF",it="#2E9E3D",ot="16px sans-serif",st=200,rt=20;function lt(t,e,a,n,i){null==Z&&function(t,e){Z=document.createElement("canvas");var a=.4*t;$=a<st?a:st,_=e,Z.width=$,Z.height=_,tt=Z.getContext("2d")}(e,a),function(t,e){var a=tt;W(a,$,_),a.beginPath(),D(a,0,0,$,t.length*rt*3+40,"#3F4656AA"),a.closePath(),a.beginPath(),a.translate(5,rt),a.fillStyle=nt,a.font=ot,a.globalAlpha=at,a.fillText("Leaderboard:",0,0),a.setTransform(1,0,0,1,0,0),a.globalAlpha=1,a.closePath();var n=60;t.forEach((function(t,i){a.beginPath(),a.translate(5,n),a.fillStyle=t.id===e?it:nt,a.font=ot,a.globalAlpha=at,a.fillText(i+1+") "+t.username,0,0),a.fillText("Lv."+t.level+" - "+Math.round(t.xp)+"xp",20,rt),a.setTransform(1,0,0,1,0,0),a.globalAlpha=1,a.closePath(),n+=60}))}(n,i),t.drawImage(Z,e-$,0)}function ht(){var t=(null==V&&(V=Y(),window.addEventListener("resize",(function(){V.el.remove(),V=Y()}))),V),h=t.ctx,c=t.width,u=t.height;if(0!==c&&0!==u){var d=T();if(null!=d){var g=E();if(null!=g){var f=g.id,y=g.mouseAngleDegrees,P=g.x,m=g.y;W(h,c,u),function(t,e,a,n,i){void 0===n&&(n=0);var o=z(n,i),s=o.x,r=o.y;t.drawImage(k,4*e/2*-1+s,4*a/2*-1+r)}(h,c,u,l(y),g.isBoosting);var v=P-c/2,b=m-u/2,p=new Quadtree;Object.keys(d.items).forEach((function(t){return p.insert(new Rectangle(d.items[t].x,d.items[t].y,d.items[t].w,d.items[t].h,d.items[t]))})),p.query(new Rectangle(v+c/2,b+u/2,c/2,u/2)).forEach((function(t){var e=t.data.x-v,a=t.data.y-b;t.data.type!==s?t.data.type!==o?t.data.type!==n?t.data.type!==i?t.data.type!==r||function(t,e,a,n,i){t.beginPath(),M(t,e,a,n/2,i/2,"#6C021699","#6C021699"),t.closePath(),t.beginPath(),M(t,e+n/3,a+i/3,n/3,i/3,"#6C021677","#6C021677"),t.closePath()}(h,e,a,t.data.width||20,t.data.height||20):L(h,e,a,t.data.width||20,t.data.height||20):function(t,e,a,n,i){t.beginPath(),M(t,e,a,n,i,"white","red"),t.closePath(),t.beginPath(),D(t,e-.8*n,a-.2*i,.8*n*2,.2*i*2,"red"),D(t,e-.2*n,a-.8*i,.2*n*2,.8*i*2,"red"),t.closePath()}(h,e,a,t.data.width||10,t.data.height||10):B(h,e,a,t.data.width||20,t.data.height||20):S(h,e,a,t.data.width||20,t.data.height||20)}));var x=new Quadtree;Object.keys(d.players).forEach((function(t){return x.insert(new Rectangle(d.players[t].x,d.players[t].y,d.players[t].width,d.players[t].height,d.players[t]))})),x.query(new Rectangle(v+c/2,b+u/2,c/2,u/2)).forEach((function(t){var e=t.data.x-v,a=t.data.y-b;q(h,e,a,t.data.width,t.data.height,l(t.data.mouseAngleDegrees),t.data.username,Math.round(t.data.boostValue/3e3*100),t.data.health,t.data.id===f?"#0F9BF2":"#F25C05","black",t.data.level,t.data.xp,t.data.items)})),function(t,n,i,o,s){var r=n/a*.2,l=i/e*.2,h=r>l?l:r;t.save(),t.scale(h,h),t.beginPath(),D(t,0,0,a,e,"#3F4656AA"),t.closePath(),t.beginPath(),D(t,o.x-500,o.y-500,G,G,"green"),t.closePath(),s.forEach((function(e){t.beginPath(),D(t,e.x-500,e.y-500,G,G,e.item?"gold":"red"),t.closePath()})),t.restore()}(h,c,u,{x:P,y:m},d.minimap),lt(h,c,u,d.leaderboard,g.id)}}}}function ct(){return null==et&&(et=window.io({upgrade:!1,transports:["websocket"]})),et}var ut,dt=0,gt=Date.now();function ft(){gt=Date.now();var e,a,n=E();if(null!=n){if(!n.active)return void document.querySelector("#game-over").setAttribute("style","display: flex");var i=t(t({},n),{isBoosting:(!n.isBoosting&&n.boostValue/3e3>.1||n.isBoosting)&&m,mouseAngleDegrees:p()}),o=u(n,i);null!=o&&(e=ct(),a=o,e.emit("data",a))}dt=Date.now()-gt,ut=Math.max(16.666666666666668-dt,0),setTimeout(ft,ut)}function yt(){ht(),window.requestAnimationFrame(yt)}var Pt,mt=document.getElementById("username-input"),vt=document.getElementById("root"),bt=document.getElementById("start-button"),pt=document.getElementById("sign-in-form");function xt(e){e.on("sync",(function(e){var a;a=e.currentPlayer.id,x=t(t({},x),{playerId:a})})),e.on("delta",w),e.on("leaderboard",A),e.on("minimap",F)}Pt=function(t){b();var e=ct();!function(t,e){t.emit("play",e)}(e,{username:t}),xt(e),yt(),ft()},bt.addEventListener("click",(function(){var t=mt.value;null!=t&&""!==t&&"username"!==t?(pt.remove(),document.documentElement.style.cssText="overflow: hidden",document.body.style.cssText="overflow: hidden",vt.classList.add("active"),setTimeout((function(){Pt(t)}),100)):alert("Please enter a username.")}))}();