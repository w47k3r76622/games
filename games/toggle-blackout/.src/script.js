"use strict";var c=$("c"),ctx=c.getContext("2d"),bw=20,bh=20,ssL=10,ml=Math.floor(window.innerWidth<window.innerHeight?window.innerWidth/(bw*ssL):window.innerHeight/(bh*ssL));c.width=bw*ssL*ml,c.height=bh*ssL*ml;var dc="#181425",Abc={A:"O@@OOOOO@@O@@O@@@@@@O@@O@@@@@@O@@O@@@@@@O@@O@@@@@@O@@O@@@@@@OOOOOOOO",B:"O@@OOOOO@@O@@O@@@O@@O@@O@@@O@@O@@O@@@O@@O@@O@@@O@@OOOO@@@O@@@@@OOOOO",C:"OOOOOOOO@@O@@@@@@O@@O@@@@@@O@@O@@@@@@O@@O@@@@@@O@@O@@@@@@O@@O@@@@@@O",D:"O@@@@@@O@@O@@OOOOO@@O@@@@@@O@@O@@@@@@O@@O@@@@@@O@@O@@@@@@O@@OOOOOOOO",E:"O@@OOOOO@@O@@O@@@O@@O@@O@@@O@@O@@O@@@O@@O@@O@@@O@@O@@O@@@O@@O@@@@@@O",F:"O@@OOOOO@@O@@O@@@@@@O@@O@@@@@@O@@O@@@@@@O@@O@@@@@@O@@O@@@@@@O@@@@@@@",G:"OOOOOOOO@@O@@@@@@O@@O@@O@@@O@@O@@O@@@O@@O@@O@@@O@@O@@O@@@O@@O@@OOOOO",H:"OOOOOOOO@@@@@@@@@@@@@@@O@@@@@@@@@O@@@@@@@@@O@@@@@@@@@O@@@@@@OOOOOOOO",I:"@@@@@@@@@@O@@@@@@O@@O@@@@@@O@@OOOOOOOO@@O@@@@@@O@@O@@@@@@O@@@@@@@@@@",K:"OOOOOOOO@@@@@O@@@@@@@@@O@@@@@@@@@O@@@@@@@@@O@@@@@@@@@O@@@@@@OO@OOOOO",L:"OOOOOOOO@@@@@@@@@O@@@@@@@@@O@@@@@@@@@O@@@@@@@@@O@@@@@@@@@O@@@@@@@@@O",M:"O@OOOOOO@@O@@@@@@@@@O@@@@@@@@@O@OOOOOO@@O@@@@@@@@@O@@@@@@@@@OOOOOOOO",N:"O@OOOOOO@@O@@@@@@@@@O@@@@@@@@@O@@@@@@@@@O@@@@@@@@@O@@@@@@@@@OOOOOOOO",O:"O@OOOOOO@@O@@@@@@O@@O@@@@@@O@@O@@@@@@O@@O@@@@@@O@@O@@@@@@O@@OOOOOOOO",P:"O@@OOOOO@@O@@O@@@@@@O@@O@@@@@@O@@O@@@@@@O@@O@@@@@@O@@O@@@@@@OOOO@@@@",R:"O@@OOOOO@@O@@O@@@@@@O@@O@@@@@@O@@O@@@@@@O@@O@@@@@@O@@O@@@@@@OOOO@OOO",S:"@@@@@@@O@@@@@@@@@O@@@@@@@@@O@@OOOOOOOO@@O@@@@@@@@@O@@@@@@@@@O@@@@@@@",T:"O@@@@@@@@@O@@@@@@@@@O@@@@@@@@@O@OOOOOO@@O@@@@@@@@@O@@@@@@@@@O@@@@@@@",U:"OOOOOOOO@@@@@@@@@O@@@@@@@@@O@@@@@@@@@O@@@@@@@@@O@@@@@@@@@O@@OOOOOO@O",V:"OOOOOO@O@@@@@@@@@O@@@@@@@@@O@@@@@@@@@O@@OOOOOOOO@@O@@@@@@@@@O@@@@@@@",W:"OOOOOOOO@@@@@@@@@O@@@@@@@@@O@@OOOOOO@O@@@@@@@@@O@@@@@@@@@O@@OOOOOO@O",X:"OOOOOOOO@@@@@O@@@@@@@@@O@@@@@@@@@O@@@@@@@@@O@@@@@@@@@O@@@@@@OO@OOOOO",Y:"OOOO@@@O@@@@@O@@@O@@@@@O@@@O@@@@@O@@@O@@@@@O@@@O@@@@@@@@@O@@OOOOOOOO"},F_tl="@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@EEEEE@@@@EEECCCCC@@EECCCCCC@@EECCQQCC@@EECCCCCC",F_tr="@@EECCCCCC@@EECCQQCC@@EECCCCCC@@EEECCCCC@@@EEEEE@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@",B_tl="@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@EEEEE@@@@EEEEEEEC@@EEEEEEEC@@EEEEEEEC@@EEEEEEEC",B_tr="@@EEEEEEEC@@EEEEEEEC@@EEEEEEEC@@EEEEEEEC@@@EEEEE@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@",R_tl="@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@EEEEEE@@@EEEEEEEC@@EEEEEECC@@EEEECCCC@@EEECCCCC",R_tr="@@EEECCCCC@@EEECQQCC@@@EECCCCC@@@EECCCCC@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@",L_tl="@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@EECCCCC@@@EECCCCC@@EEECQQCC@@EEECCCCC",L_tr="@@EEECCCCC@@EEEECCCC@@EEEEEECC@@EEEEEEEC@@@EEEEEE@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@",V_sl="@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@FCC@@@@@@FFFFFF@@@@FFFFFFFFGCFFFFFFFFGCFFFFFF@@@",V_sr="CFFFFFF@@@CFFFFFFFFG@FFFFFFFFG@FFFFFF@@@@@FCC@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@",H_sl="@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@FFFFF@@@@CFFFFF@@@@CFCCCFFFG@",H_sr="CFCCCFFFG@CFFFFF@@@@@FFFFF@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@",V_ml="@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@FCC@@@@@@FFFFFF@@@@FFFFFFFG@CFFFFFFFG@CFFFFFF@@@",V_mr="CFFFFFF@@@CFFFFFFFG@@FFFFFFFG@@FFFFFF@@@@@FCC@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@",H_ml="@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@FFFFF@FG@CFFFFFFFG@CFCCCFF@@@",H_mr="CFCCCFF@@@CFFFFFFFG@@FFFFF@FG@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@",P_F_tl="@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@PPCCCC@@@PPCCCCC@@@PPCGGCC@@@PPCCCCC",P_F_tr="@@@PPCCCCC@@@PPCGGCC@@@PPCCCCC@@@@PPCCCC@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@",P_F_bl="@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@PC@@@@@@@PPPPPP@@@@PPPPPPPY@CPYYYYPPY@CPYPYPP@@@",P_F_br="CPYPYPP@@@CPYYYPPPY@@PPPPPPPY@@PPPPPP@@@@@PPC@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@",P_S_tl="@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@PPPCCC@@@PPPPCCC@@@PPPCCCC@@@PPPCCCC",P_S_tr="@@@PPPCCCC@@@PPCGGCC@@@PPCCCCC@@@PPCCCCC@@@@P@@@@@@@@@P@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@",P_S_bl="@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@PPPPPP@@@CPPPPPP@@@CPPPPPPPY@",P_S_br="CPPPPPPPY@CPPPPPP@@@@PPCCPP@@@@@@CC@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@",lht="lht",redFloor="GGGGHGGGGGGGGGGHGGGGGGGGHGHGGGGGGHGGGHGGGGHGGGGGHGGHGGGGGHGHHGGGGGHGGGGHGGGHGGGGGGHGHGGGGGGGGHGGGGGG",grayWall="OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO",doorRight="OYYYYYYYYYOYYYYYYYYYOYYYYYYYYYOOYYYYYYYYOOYYYYYYYYOOOYYYYYYYOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOO",doorLeft="OOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOOYYYYYYYOOYYYYYYYYOOYYYYYYYYOYYYYYYYYYOYYYYYYYYYOYYYYYYYYY",drQ,AnQ,postdrQ,loop,stopDraw;function clearEngine(){drQ=[],AnQ=[],postdrQ=[],stopDraw=!1}function ATDQ(a,b,d,e,f){for(var g=0;g<drQ.length;g++)if(drQ[g].layer<f)return void drQ.splice(g,0,{sprite:a,ID:b,x:d,y:e,layer:f});drQ.push({sprite:a,ID:b,x:d,y:e,layer:f})}function RDQ(a){for(var b=drQ.length-1;0<=b;b--)drQ[b].ID===a&&drQ.splice(b,1)}function rAQ(a){AnQ[a]=null}function getFromdrQ(a){for(var b=0;b<drQ.length;b++)if(drQ[b].ID==a)return drQ[b];return null}function MSDQ(a,b,d,e,f,g,h,k,l){AnQ.push({ID:a,verticalOrHorizontal:b,positive:d,timeToMove:e,steps:f,currentStep:0,animationcycle:g,sprites:h,currentSprite:0,timeAnim:0,timeMov:0,endSprite:k,callback:l})}function WS(a,b,d,e,f){var g=a.split("");g.forEach(function(h,k){void 0===Abc[h.toUpperCase()]||ATDQ("@@@@@@@@@@@"+Abc[h.toUpperCase()]+"@@@@@@@@@@@@@@@@@@@@@",b,d+k,e,f)})}function StD(){stopDraw=!1,main()}function SpD(){cancelAnimationFrame(loop),stopDraw=!0}var colorpallete="ffffffbe4a2fd77643ead4aae4a672733e393e2731a22633e43b44f77622feae34fee76163c74d3e8948265c42193c3e124e890099db2ce8f5ffffffc0cbdc8b9bb45a69883a4466262b44181425ff004468386cb55088f6757ae8b796c28569";function updateAnimation(a){var b=AnQ[a],d=getFromdrQ(b.ID);RDQ(b.ID),ATDQ(b.sprites[b.currentSprite],b.ID,d.x,d.y,d.layer),b.currentSprite++,b.currentSprite>=b.sprites.length&&(b.currentSprite=0)}function updateMovement(a){var b=AnQ[a],d=getFromdrQ(b.ID);RDQ(b.ID);var e=b.positive?1:-1,f=Math.round(10*(b.verticalOrHorizontal?0:1/b.steps*e))/10,g=Math.round(10*(b.verticalOrHorizontal?1/b.steps*e:0))/10;b.currentStep++,b.currentStep===b.steps?(rAQ(a),ATDQ(b.endSprite,b.ID,d.x+f,d.y+g,d.layer),null!=b.callback&&b.callback(d)):ATDQ(b.sprites[b.currentSprite],b.ID,d.x+f,d.y+g,d.layer)}var maximalUpdateDelay=500,updateTimeout,now;function animate(){var a=-now+(now=Date.now());if(!isNaN(a))for(var d,b=0;b<AnQ.length;b++)(d=AnQ[b],null!==d)&&(1e3*d.animationcycle<a+d.timeAnim?(d.timeAnim=0,updateAnimation(b)):d.timeAnim+=a,1e3*d.timeToMove/d.steps<a+d.timeMov?(d.timeMov=0,updateMovement(b)):d.timeMov+=a)}function main(){animate(),draw();stopDraw||(loop=requestAnimationFrame(main))}function draw(){ctx.fillStyle=dc,ctx.fillRect(0,0,c.width,c.height);for(var a=void 0,b=void 0,d=void 0,e=0;e<drQ.length;e++){if(a=drQ[e].sprite,b=drQ[e].x,d=drQ[e].y,-1==b&&-1==d){ctx.fillStyle=a,ctx.fillRect(0,0,c.width,c.height);continue}if("lht"===a){ctx.fillStyle="#ffffff77",ctx.fillRect(b*ssL*ml,d*ssL*ml,ssL*ml,ssL*ml);continue}for(var f=0;f<ssL;f++)for(var g=0;g<ssL;g++){var h=pad(a.substring(f*ssL+g,f*ssL+g+1).charCodeAt(0).toString(2),8),k=h.substring(2,3),l=h.substring(3,8);(l=parseInt(l,2),0!=l)&&(ctx.fillStyle="#"+colorpallete.substring(6*l,6*l+6)+"FF",ctx.fillRect(Math.round(b*ssL+f)*ml,Math.round(d*ssL+g)*ml,1*ml,1*ml))}}postDraw()}function postDraw(){for(var a=0;a<postdrQ.length;a++)postdrQ[a]()}function pad(a,b,d){return d=d||"0",a+="",a.length>=b?a:Array(b-a.length+1).join(d)+a}var running=!1;function $(a){return document.getElementById(a)}var Clvl=0,Blackout,canMove,ended,MChP,LPOS,walls,doors;function init(){Clvl=0,Blackout=!1,canMove=!1,ended=!1,MChP={x:-1,y:-1},LPOS=[],walls=[],doors=[],clearEngine(),WS("BlackOut",99,6,0,5),WS("controls",99,0,3,5),WS(" Arrow keys to move",99,0,5,5),WS(" Space bar to toggle",99,0,7,5),WS(" the electric grid",99,0,8,5),WS(" offline or online",99,0,9,5),WS("Press space bar",99,0,13,5),WS(" to start",99,0,14,5),StD(),ListRun||(startListener(),ListRun=!0),postdrQ.push(function(){ckiE()})}var ListRun=!1;function startListener(){document.addEventListener("keydown",function(a){var b=a.keyCode;if(ended&&32===b)return void init();32===b&&(0==Clvl?SLvl1():(Blackout?(RDQ(50),RDQ(99)):(WS("BlackOut",99,6,1,1),ATDQ("#181425",50,-1,-1,2)),Blackout=!Blackout));(37===b||38===b||39===b||40===b)&&canMove&&moveChar(b)})}function SLvl1(){Clvl=1,canMove=!0,RDQ(99),ATDQ(F_tl,2,10,17,5),ATDQ(F_tr,3,11,17,5),ATDQ(V_sl,4,10,18,5),ATDQ(V_sr,5,11,18,5),MChP={x:11,y:18},APL(10,6,10,!1,5),ALSQ(10,7,11,15,11),LPOS.push({x:6,y:10}),LPOS.push({x:7,y:11});for(var a=0;a<bw;a++)for(var d,b=0;b<bh;b++)d=void 0,5<a&&15>=a&&1<b&&19>b?d=redFloor:(d=grayWall,walls.push({x:a,y:b})),ATDQ(d,10,a,b,6);ATDQ(doorLeft,10,10,1,5),ATDQ(doorRight,10,11,1,5),doors.push({x:10,y:1}),doors.push({x:11,y:1})}function SLvl2(){ATDQ(F_tl,2,4,17,5),ATDQ(F_tr,3,5,17,5),ATDQ(V_sl,4,4,18,5),ATDQ(V_sr,5,5,18,5),MChP={x:5,y:18},APL(10,1,4,!1,5),ALSQ(10,2,5,18,5),LPOS.push({x:1,y:4}),LPOS.push({x:2,y:5}),APL(10,3,6,!0,5),ALSQ(10,3,7,3,18),LPOS.push({x:3,y:6}),LPOS.push({x:4,y:7});for(var a=0;a<bw;a++)for(var d,b=0;b<bh;b++)d=void 0,2<a&&8>a&&1<b&&19>b||1<b&&6>b&&0<a&&19>a?d=redFloor:(d=grayWall,walls.push({x:a,y:b})),ATDQ(d,10,a,b,6);ATDQ(doorLeft,10,16,1,5),ATDQ(doorRight,10,17,1,5),doors.push({x:16,y:1}),doors.push({x:17,y:1})}function SLvl3(){ATDQ(F_tl,2,9,17,5),ATDQ(F_tr,3,10,17,5),ATDQ(V_sl,4,9,18,5),ATDQ(V_sr,5,10,18,5),MChP={x:10,y:18},APL(10,6,2,!0,5),ALSQ(10,6,3,6,18),LPOS.push({x:6,y:2}),LPOS.push({x:7,y:3}),APL(10,12,2,!0,5),ALSQ(10,12,3,12,18),LPOS.push({x:12,y:2}),LPOS.push({x:13,y:3}),APL(10,2,7,!1,5),ALSQ(10,3,8,18,8),LPOS.push({x:2,y:7}),LPOS.push({x:3,y:8}),APL(10,2,12,!1,5),ALSQ(10,3,13,18,13),LPOS.push({x:2,y:12}),LPOS.push({x:3,y:13});for(var a=0;a<bw;a++)for(var d,b=0;b<bh;b++)d=void 0,5<a&&14>a&&1<b&&19>b||5<b&&14>b&&0<a&&19>a?d=redFloor:(d=grayWall,walls.push({x:a,y:b})),ATDQ(d,10,a,b,6);ATDQ(doorLeft,10,16,5,5),ATDQ(doorRight,10,17,5,5),doors.push({x:16,y:5}),doors.push({x:17,y:5})}function SLvl4(){ATDQ("#181425",50,-1,-1,2),WS("Congratulations",97,2,9,1)}function APL(a,b,d,e){var g,h,k,l;e?(g=P_F_tl,h=P_F_tr,k=P_F_bl,l=P_F_br):(g=P_S_tl,h=P_S_tr,k=P_S_bl,l=P_S_br),ATDQ(g,a,b,d,5),ATDQ(h,a,b+1,d,5),ATDQ(k,a,b,d+1,5),ATDQ(l,a,b+1,d+1,5)}function ALSQ(a,b,d,e,f,g){for(var h=b;h<=e;h++)for(var k=d;k<=f;k++)ATDQ(lht,a,h,k,g),LPOS.push({x:h,y:k})}function moveChar(a){canMove=!1;var positive,b,e=5,f=.5,g=.2,h,k,l,m,o,p,q,r;37===a?(b=!1,positive=!1,h=L_tl,k=L_tr,l=H_sl,m=H_sr,o=H_ml,p=H_mr,q=-2,r=0):38===a?(b=!0,positive=!1,h=B_tl,k=B_tr,l=V_sl,m=V_sr,o=V_ml,p=V_mr,q=0,r=-2):39===a?(b=!1,positive=!0,h=R_tl,k=R_tr,l=H_sl,m=H_sr,o=H_ml,p=H_mr,q=1,r=0):40===a?(b=!0,positive=!0,h=F_tl,k=F_tr,l=V_sl,m=V_sr,o=V_ml,p=V_mr,q=0,r=1):void 0;for(var s=0;s<doors.length;s++)if(doors[s].x===MChP.x+q&&doors[s].y===MChP.y+r)return MoveUpLevel(),void(canMove=!0);for(var t=0;t<walls.length;t++)if(walls[t].x===MChP.x+q&&walls[t].y===MChP.y+r)return void(canMove=!0);MSDQ(2,b,positive,f,e,g,[h],h,null),MSDQ(3,b,positive,f,e,g,[k],k,null),MSDQ(4,b,positive,f,e,g,[l,o],l,null),MSDQ(5,b,positive,f,e,g,[p,p],m,function(u){setTimeout(function(){canMove=!0,MChP={x:Math.round(u.x),y:Math.round(u.y)}},20)})}function MoveUpLevel(){Clvl++,walls=[],doors=[],LPOS=[],clearEngine(),postdrQ.push(function(){ckiE()});2==Clvl?SLvl2():3==Clvl?SLvl3():4==Clvl?SLvl4():void 0}function ckiE(){for(var a=0;a<LPOS.length;a++){var b=LPOS[a],d=MChP.x===b.x||MChP.x-1===b.x,e=MChP.y===b.y||MChP.y-1===b.y;d&&e&&!1===Blackout&&(ATDQ("#181425",50,-1,-1,2),WS("You got Caught",98,0,0,1),WS("Game over",98,0,1,1),WS("Press space bar",97,0,9,1),WS("to restart",97,0,10,1),postdrQ.push(function(){setTimeout(function(){SpD(),ended=!0},200)}))}}