(()=>{"use strict";class t{t=[];get i(){return this.t}h(t){this.t.push(t),t.Entity=this}o(t){for(const s of this.t)if(s instanceof t)return s;throw new Error("E")}u(t){let s,i;for(let e=0;e<this.t.length;e++){const h=this.t[e];if(h instanceof t){s=h,i=e;break}}s&&i&&(s.Entity=null,this.t.splice(i,1))}l(t){for(const s of this.t)if(s instanceof t)return!0;return!1}p(){for(const t of this.t)t.p()}m(t){for(const s of this.t)s.m(t)}}const s=(t,s,i)=>t*(1-i)+s*i;class i{x;y;constructor(t,s){this.x=t,this.y=s}static g(t){const s=t.replace(new RegExp(/\(|\)/,"g"),"").split(","),e=Number(s[0]),h=Number(s[1]);if(isNaN(e)||isNaN(h))throw new Error("E");return new i(e,h)}_(){return`(${this.x},${this.y})`}static S(t,e,h){return new i(s(t.x,e.x,h),s(t.y,e.y,h))}}class e{k;v;C;A;static N(t,s=!1){return!(t<0||t>(s?1:255))&&!(!s&&t%1!=0)}constructor(t,s,i,h){if(!e.N(t))throw new Error("E");if(!e.N(s))throw new Error("E");if(!e.N(i))throw new Error("E");if(!e.N(h,!0))throw new Error("E");this.k=t,this.v=s,this.C=i,this.A=h}_(){return`rgba(${this.k}, ${this.v}, ${this.C}, ${this.A})`}static g(t){const s=t.replace(new RegExp(/\(|\)|[A-Za-z]/g),"").split(","),i=Number(s[0]),h=Number(s[1]),n=Number(s[2]),r=Number(s[3]);if(isNaN(i)||isNaN(h)||isNaN(n)||isNaN(r))throw new Error("E");return new e(i,h,n,r)}}const h=Object.freeze({grid:{D:11,T:50,P:1e-5,color:{M:new e(255,255,114,1)}},I:{U:10,color:new e(55,71,79,1),R:{range:3,duration:100},O:300,B:2,F:1},G:{$:{H:{L:new e(255,235,59,.25),text:new e(38,50,56,1)},U:15,W:2,j:5,F:2},q:{H:{L:new e(46,125,50,1),text:new e(255,255,255,1)},W:10,j:50}},K:"hidden",V:5,Z:5,J:!1});class n{X;Y;tt;st={};it;et=[{filename:"explosion.png",frame:{x:0,y:16,w:23,ht:33},nt:!1,rt:!0,ot:{x:3,y:4,w:23,ht:33},ct:{w:29,ht:40}},{filename:"house.png",frame:{x:23,y:16,w:32,ht:38},nt:!1,rt:!1,ot:{x:0,y:0,w:32,ht:38},ct:{w:32,ht:38}},{filename:"mark.png",frame:{x:0,y:98,w:50,ht:50},nt:!1,rt:!1,ot:{x:0,y:0,w:50,ht:50},ct:{w:50,ht:50}},{filename:"tank.png",frame:{x:0,y:54,w:40,ht:44},nt:!1,rt:!1,ot:{x:0,y:0,w:40,ht:44},ct:{w:40,ht:44}},{filename:"tile_0048.png",frame:{x:0,y:0,w:16,ht:16},nt:!1,rt:!1,ot:{x:0,y:0,w:16,ht:16},ct:{w:16,ht:16}},{filename:"tile_0050.png",frame:{x:16,y:0,w:15,ht:15},nt:!1,rt:!1,ot:{x:0,y:0,w:16,ht:16},ct:{w:16,ht:16}},{filename:"tile_0060.png",frame:{x:32,y:0,w:16,ht:16},nt:!1,rt:!1,ot:{x:0,y:0,w:16,ht:16},ct:{w:16,ht:16}},{filename:"turret.png",frame:{x:0,y:148,w:46,ht:58},nt:!1,rt:!0,ot:{x:6,y:0,w:46,ht:58},ct:{w:58,ht:58}}];get Element(){return this.Y}get ut(){return this.tt}constructor(t){this.X=t}p(){const t=document.createElement("canvas");t.setAttribute("width",`${this.X.x}px`),t.setAttribute("height",`${this.X.y}px`),document.body.appendChild(t),this.Y=t;const s=this.Y.getContext("2d");if(!s)throw new Error("E");this.tt=s,this.it=new Image,this.it.src="pack.png"}lt(t,s,i){this.tt.beginPath(),this.tt.fillStyle=i._(),this.tt.rect(t.x,t.y,s.x,s.y),this.tt.fill()}dt(t,s,i,e=2){this.tt.beginPath(),this.tt.lineWidth=e,this.tt.strokeStyle=i._(),this.tt.rect(t.x,t.y,s.x,s.y),this.tt.stroke()}wt(t,s){this.tt.clearRect(t.x,t.y,s.x,s.y)}gt(t,s,i){this.tt.beginPath(),this.tt.arc(t.x,t.y,s,0,2*Math.PI),this.tt.fillStyle=i._(),this.tt.fill()}ft(t,s,i){this.tt.beginPath(),this.tt.arc(t.x,t.y,s,0,2*Math.PI),this.tt.strokeStyle=i._(),this.tt.stroke()}_t(t,s,i,e,h,n=!1){this.tt.beginPath(),this.tt.moveTo(t.x,t.y),this.tt.arc(t.x,t.y,s,this.Et(e),this.Et(h),n),this.tt.lineTo(t.x,t.y),this.tt.fillStyle=i._(),this.tt.fill()}xt(t,s,i){const e=this.et.find((s=>s.filename===t));e&&this.tt.drawImage(this.it,e.frame.x,e.frame.y,e.frame.w,e.frame.ht,s.x,s.y,i?i.x:e.frame.w,i?i.y:e.frame.ht)}St(t,s,e=new i(1,1),h){const n=this.et.find((s=>s.filename===t));if(!n)return;const{frame:r}=n,o=new i(r.w*e.x,r.ht*e.y),a=new i(s.x-o.x/2,s.y-o.y/2),c=new i(s.x,s.y);if(h){const t=this.Et(h);this.tt.translate(c.x,c.y),this.tt.rotate(t),this.tt.translate(-c.x,-c.y)}this.tt.drawImage(this.it,r.x,r.y,r.w,r.ht,a.x,a.y,o.x,o.y),h&&(this.tt.translate(c.x,c.y),this.tt.rotate(-this.Et(h)),this.tt.translate(-c.x,-c.y))}kt(t){for(const s in t)Object.hasOwnProperty.call(t,s)&&t[s]&&(this.Y.style[s]=t[s])}vt(t){const s=this.Y.getBoundingClientRect(),e=window.pageXOffset||document.documentElement.scrollLeft,h=window.pageYOffset||document.documentElement.scrollTop,n=s.top+h,r=s.left+e,o=t.x-r,a=t.y-n;return o<0||a<0||o>r+s.width||a>n+s.height?null:new i(o,a)}Ct(t,s,i=new e(255,255,255,1),h=10,n="Arial"){this.tt.font=`${h}px ${n}`,this.tt.fillStyle=i._(),this.tt.fillText(t,s.x,s.y)}Et(t){return t*Math.PI/180}}class r{static yt;static At;constructor(){}static get bt(){return this.yt||(this.yt=this.Nt({zIndex:"0"})),this.yt}static get Dt(){return this.At||(this.At=this.Nt({zIndex:"1"})),this.At}static Nt(t){const s=(h.grid.T+h.grid.P)*h.grid.D+h.grid.P,e=new n(new i(s,s));return e.p(),e.kt(t),e}}class o{Entity;p(){this.Tt()}m(t){this.Pt(),this.Tt(),this.Mt()}Tt(){if(this.Entity.It)r.bt.xt("tile_0050.png",this.Entity.zt,this.Entity.X),r.bt.St("mark.png",this.Entity.Ut,new i(.75,.75));else switch(r.bt.xt("tile_0050.png",this.Entity.zt,this.Entity.X),this.Entity.Rt){case u.Ot:r.bt.St("tile_0048.png",this.Entity.Ut);break;case u.Bt:r.bt.St("tile_0060.png",this.Entity.Ut)}this.Entity.Ft&&r.bt.dt(this.Entity.zt,new i(this.Entity.X.x-2,this.Entity.X.y-2),h.grid.color.M)}Pt(){r.bt.wt(this.Entity.zt,this.Entity.X)}Mt(){if(!h.J)return;const t=this.Entity;r.bt.Ct(t.Gt._(),t.zt,new e(255,0,0,1))}}var a,c,u;!function(t){t[t.$t=0]="Turret",t[t.Ht=1]="House"}(a||(a={})),function(t){t[t.Lt=0]="Idle",t[t.Wt=1]="Attacking",t[t.jt=2]="Exploding"}(c||(c={}));class l{Entity;p(){this.Tt()}m(t){this.Tt()}Tt(){if(this.Entity.qt===c.jt)return void r.bt.St("explosion.png",this.Entity.Node.Ut);let t=k.Kt;this.Entity.Vt&&(t=v.Zt(this.Entity.Node,this.Entity.Vt)),r.bt.St("turret.png",this.Entity.Node.Ut,new i(.75,.75),this.Jt(t)),r.bt.Ct(this.Entity.Qt.toString(),this.Xt(t),h.G.$.H.text,16)}Xt(t){const s=this.Entity.Node.Ut;switch(t){case k.Kt:return new i(s.x-4,s.y+12);case k.Yt:return new i(s.x-12,s.y+6);case k.ts:return new i(s.x-4,s.y);case k.ss:return new i(s.x+2,s.y+6)}}es(){r.bt.wt(this.Entity.Node.zt,this.Entity.Node.X)}Jt(t){switch(t){case k.Kt:return 0;case k.Yt:return 90;case k.ts:return 180;case k.ss:return-90}}}class d{Entity;p(){this.Tt()}m(t){this.Tt()}Tt(){r.bt.St("house.png",this.Entity.Node.Ut),r.bt.Ct(this.Entity.Qt.toString(),new i(this.Entity.Node.Ut.x-10,this.Entity.Node.Ut.y-10),h.G.q.H.text,16)}es(){r.bt.wt(this.Entity.Node.zt,this.Entity.Node.X)}}class w{Entity;hs=0;p(){}m(t){this.Entity.qt===c.jt&&(this.hs>=h.G.$.F?this.Entity.ns():this.hs+=t)}}class p extends t{rs;os;cs=0;us;ls;ds=()=>this.ws();get Qt(){return this.cs}get Node(){return this.rs}get ps(){return this.os.gs<1&&this.fs()>0}constructor(t,s){super(),this.rs=t,this.os=s,this.cs=h.G.q.j}p(){this.h(new d),this.us=document.body.querySelector("#houseTemplate"),this.ls=this.us.querySelector("#evacBtn"),super.p()}m(t){super.m(t)}_s(t,s){t>this.cs||(s.Es(t),this.cs-=t)}Es(t){this.cs+=t}ns(){this.os.xs(this.cs),this.o(d).es(),this.u(d),this.rs.Ss()}ks(){R.vs().ks(this.us,(()=>this.Cs())),this.ps?(this.ls.innerText=`Evacuate ${this.fs()} people`,this.ls.addEventListener("click",this.ds),this.ls.removeAttribute("disabled")):(this.ls.innerText="Wait for evacuation bus...",this.ls.setAttribute("disabled","disabled"))}ys(){this.Cs(),this.ls.removeAttribute("disabled"),R.vs().ys()}ws(){this.ps&&(this.ys(),this.os.ws(this.fs()),this.cs-=this.fs(),this.cs<0&&(this.cs=0))}fs(){let t=h.V;return this.cs<t&&(t=this.cs),t}Cs(){this.ls.removeEventListener("click",this.ds)}}class m extends t{rs;os;cs=0;us;As;bs=c.Lt;Ns;get qt(){return this.bs}get Qt(){return this.cs}get Node(){return this.rs}get Vt(){return this.Ns}constructor(t,s,i){super(),this.rs=t,this.os=s,i._s(h.G.$.j,this)}p(){this.h(new l),this.h(new w),this.os.xs(this.cs),this.us=document.body.querySelector("#tower"),this.As=this.us.querySelector("#defenders")}m(t){if(super.m(t),this.bs===c.jt)return;const s=this.rs.Ds.find((t=>!!t.Ts&&!t.Ts.Ps));s&&s.Ts&&(this.Ns=s,this.Ms())}Es(t){this.cs+=t}ks(){this.As.innerText=this.cs.toString(),R.vs().ks(this.us)}ns(){this.o(l).es(),this.u(l),this.rs.Ss()}Ms(){this.Ns&&this.Ns.Ts&&(this.Ns.Ts.Ms(this.rs),this.cs--,this.cs<1&&(this.bs=c.jt))}}function g(t,s){let i,e;return"number"==typeof t?(i=t,e=s):(i=t.from,e=t.to),Math.floor(Math.random()*(e-i+1))+i}!function(t){t[t.Is=0]="None",t[t.Ot=1]="Tree",t[t.Bt=2]="Forest"}(u||(u={}));class f extends t{zt;zs;Gt;Ds;Us=!1;Ft=!1;Ts=null;Rs;Os=null;Bs=!1;Fs;Gs;$s;Hs=u.Is;Ls=()=>this.Ws();get js(){return this.Os}get It(){return this.Bs}get X(){return new i(this.zs.x-this.zt.x,this.zs.y-this.zt.y)}get Ut(){return new i(this.zt.x+this.X.x/2,this.zt.y+this.X.y/2)}get qs(){return this.Gt}get Ks(){return!this.Ts&&!this.It}get Rt(){return this.Hs}get Vs(){return!(this.Os&&this.Os instanceof m)}constructor(t,s,i,e){super(),this.zt=t,this.zs=s,this.Gt=i,this.Ds=e,this.Rs=new o}p(){this.h(this.Rs),super.p(),this.Fs=document.body.querySelector("#build"),this.Gs=document.body.querySelector("#corrupted"),Math.random()>.85&&(this.Hs=g(1,2))}m(t){super.m(t),this.Os&&this.Os.m(t)}Zs(t){return!(t.x<this.zt.x)&&(!(t.x>this.zs.x)&&(!(t.y<this.zt.y)&&!(t.y>this.zs.y)))}Js(){this.Bs=!0,this.Os?.ns()}Ss(){this.Os=null}Qs(t){if(this.Os)throw new Error("E");switch(t){case a.$t:this.Xs(R.vs().Ys);break;case a.Ht:this.Os=new p(this,R.vs().Ys)}return this.Os?.p(),this.Os}ks(){this.Os?this.Os.ks():this.Bs?R.vs().ks(this.Gs):this.Ts?this.Ts.ks():(R.vs().ks(this.Fs,(()=>this.Cs())),this.$s=this.Fs.querySelector("#buildTowerBtn"),this.$s.addEventListener("click",this.Ls),R.vs().Ys.ti(h.G.$.j)?this.$s.removeAttribute("disabled"):this.$s.setAttribute("disabled","disabled"))}Xs(t){const s=t.ti(h.G.$.j);s&&(this.Os=new m(this,t,s))}Ws(){this.ys(),this.Qs(a.$t)}ys(){this.Cs(),this.$s.removeAttribute("disabled"),R.vs().ys()}Cs(){this.$s.removeEventListener("click",this.Ls)}}class _{}class E extends _{Entity;p(){}m(t){}si(t){for(const s of this.Entity.ii)if(s.Zs(t))return void s.ks()}}class x{}class S extends x{Entity;p(){}m(t){}ei(t){this.Entity.ii.forEach((s=>s.Ft=s.Zs(t)))}}var k;!function(t){t[t.Kt=0]="Up",t[t.Yt=1]="Right",t[t.ts=2]="Down",t[t.ss=3]="Left"}(k||(k={}));class v extends t{hi=[];static ni=(t,s)=>Math.abs(t.qs.x-s.qs.x)+Math.abs(t.qs.y-s.qs.y);get ii(){return this.hi}p(){this.h(new E),this.h(new S),super.p(),this.ri();for(const t of this.hi)t.p()}m(t){super.m(t);for(const s of this.hi)s.m(t)}oi(t,s){return 1}ai(t){return t.Ds}ri(){const t=h.grid.T,s=h.grid.P;for(let e=0;e<h.grid.D;e++)for(let n=0;n<h.grid.D;n++){const h=new i(n*(t+s)+s,e*(t+s)+s),r=new i(h.x+t,h.y+t),o=new i(n,e),a=this.ii.find((t=>t.Gt.x===o.x&&t.Gt.y===o.y-1)),c=this.ii.find((t=>t.Gt.x===o.x-1&&t.Gt.y===o.y)),u=[],l=new f(h,r,o,u);a&&(u.push(a),a.Ds.push(l)),c&&(u.push(c),c.Ds.push(l)),this.hi.push(l)}}static Zt(t,s){return t.Gt.x===s.Gt.x?t.Gt.y>s.Gt.y?k.Kt:k.ts:t.Gt.y===s.Gt.y?t.Gt.x>s.Gt.x?k.ss:k.Yt:k.Kt}}class C{Entity;get ci(){return!this.Entity.ui&&this.Entity.li}p(){document.body.addEventListener("click",this.di.bind(this)),document.body.addEventListener("mousemove",this.wi.bind(this))}m(t){}di(t){if(!this.ci)return;const s=r.bt.vt(new i(t.clientX,t.clientY));if(s)for(const t of this.Entity.pi)t.l(_)&&t.o(_).si(s)}wi(t){if(!this.ci)return;const s=r.bt.vt(new i(t.clientX,t.clientY));if(s)for(const t of this.Entity.pi)t.l(x)&&t.o(x).ei(s)}}class y{Entity;Y;mi;gi;fi;p(){const t=document.body.querySelector("#hud");t&&(this.Y=t);const s=document.body.querySelector("#inDanger");s&&(this.mi=s);const i=document.body.querySelector("#saved");i&&(this.gi=i);const e=document.body.querySelector("#evac");e&&(this.fi=e)}m(t){this.mi.innerText=this.Entity.Ys._i.toString(),this.gi.innerText=this.Entity.Ys.Ei.toString();const s=this.Entity.Ys.gs;this.fi.textContent=0===s?"Evacuation bus is ready! Please send people to safety!":`Time till next evacuation bus: ${s}`}}var A,b;!function(t){t[t.xi=0]="Running",t[t.jt=1]="Exploding",t[t.Si=2]="Corrupting"}(A||(A={}));class N{Entity;ki=this.Jt(k.ss);get qs(){const t=this.Entity.qs;if(!t)throw new Error("E");return t}get vi(){const t=this.Entity;return t.Ps?v.Zt(t.Node,t.Ps):t.Ci[0]?v.Zt(t.Node,t.Ci[0]):null}p(){}m(t){this.es();let s=this.ki;null!==this.vi&&(s=this.Jt(this.vi),this.ki=s),r.Dt.St("tank.png",this.qs,new i(.75,.75),s),this.Entity.qt!==A.jt||r.Dt.St("explosion.png",this.qs,new i(.75,.75))}es(){r.Dt.wt(new i(this.qs.x-h.grid.T/2,this.qs.y-h.grid.T/2),new i(h.grid.T,h.grid.T))}Jt(t){switch(t){case k.Kt:return 180;case k.Yt:return-90;case k.ts:return 0;case k.ss:return 90}}}class D extends class{Entity;rs;yi=null;get Node(){return this.rs}set Node(t){this.rs=t,this.rs.Ts=this.Entity,this.Entity.Ai()}get qs(){return this.Node.Ut}constructor(t){this.rs=t}p(){this.rs.Ts=this.Entity}m(t){}}{bi;Ni;Di;Ti=!1;get qs(){return this.bi}constructor(t){super(t),this.bi=this.rs.Ut}m(t){if(!this.rs)return;if(this.Ti&&this.Entity.Ci.length<1)return void(this.Ti=!1);const s=this.Entity.Ci[0];if(this.Ti&&s)return this.Pi(this.rs,s);this.Ti=!0,this.Ni=this.rs.Ut,this.Di=Date.now()}Pi(t,s){const e=s.Ut,n=(Date.now()-this.Di)/h.I.R.duration;t.Ts=null,this.Entity.Mi(),this.yi=this.bi,n>=1?(this.Entity.Ci.shift(),s.Us=!1,this.Ti=!1,this.yi=this.bi,this.bi=e,this.Node=s):this.bi=i.S(this.Ni,e,n)}Ii(){this.Ti=!1}}class T{Entity;hs=0;p(){}m(t){this.Entity.qt===A.jt&&(this.hs>=h.I.F?this.Entity.zi():this.hs+=t)}}class P{Ui=[];get Ri(){return 0===this.Ui.length}Oi(t,s){this.Ui.push({value:t,priority:s}),this.Ui=this.Ui.sort(((t,s)=>t.priority-s.priority))}Bi(){const t=this.Ui.shift();if(void 0===t)throw new Error("E");return t.value}}class M{Fi;Gi;constructor(t,s){this.Fi=t,this.Gi=s}$i(t){const s=[],{Hi:i,Li:e}=this.Wi(t);if(!i||!i.Ks)return s;let h=i;for(;h&&h!==t;)s.push(h),h=e[h.qs._()];return s.reverse(),s}ji(t,s){const i={[t.qs._()]:null},e={[t.qs._()]:0},h=new P;for(h.Oi(t,0);!h.Ri;){const t=h.Bi();if(t===s)break;for(const n of this.Fi.ai(t)){const r=e[t.qs._()]+this.Fi.oi(t,n),o=n.qs._();if(void 0===e[o]||r<e[o]){const a=r+this.Gi(s,n);e[o]=r,h.Oi(n,a),i[o]=t}}}return i}Wi(t){const s={[t.qs._()]:null},i={[t.qs._()]:0},e=new P;let h=null;for(e.Oi(t,0);!e.Ri&&(h=e.Bi(),!h.Ks);)for(const t of this.Fi.ai(h)){if(!t.Vs)continue;const n=i[h.qs._()]+this.Fi.oi(h,t),r=t.qs._();(void 0===i[r]||n<i[r])&&(i[r]=n,e.Oi(t,1),s[r]=h)}return{Hi:h,Li:s}}}class I extends t{qi;Ki;Vi;Zi=0;Ji;Qi;Xi=[];bs=A.xi;Yi=null;get qt(){return this.bs}get Ci(){return this.Xi}get Node(){return this.Ki.Node}get qs(){return this.Ki.qs}get Ps(){return this.Yi}constructor(t,s){super(),this.qi=s,this.Qi=new M(R.vs().te,v.ni),this.Ki=new D(t),this.Vi=new N}p(){this.h(this.Ki),this.h(this.Vi),this.h(new T),this.Ji=document.body.querySelector("#enemy"),super.p()}m(t){if(super.m(t),this.bs===A.jt)return;if(this.Node.It&&this.Xi.length<1&&this.se(this.Node),this.Node&&!this.Zi)return void(this.Zi=+new Date);+new Date-this.Zi>=h.I.O&&(this.Node.Js(),this.zi())}se(t){this.Xi.forEach((t=>t.Us=!1)),this.Xi=this.Qi.$i(t),this.Xi.forEach((t=>t.Us=!0))}Ai(){this.Zi=0}Mi(){this.Vi.es()}zi(){this.Node.Ts=null,this.Ai(),this.Mi(),this.u(N),this.u(D),this.qi.ns(this)}Ms(t){this.Yi=t,this.Node.Ts=null,this.Xi=[],this.Ki.Ii(),this.bs=A.jt}ks(){R.vs().ks(this.Ji)}}class z extends t{ie;ee=[];he=0;get te(){return this.ie}constructor(t){super(),this.ie=t}p(){super.p(),this.ne()}m(t){super.m(t),this.ee.map((s=>s.m(t))),this.he+=t,this.he>=h.I.B&&this.ne()}ns(t){this.ee=this.ee.filter((s=>s!=t))}ne(){this.he=0;const t=this.ie.ii,s=h.grid.D,i=t[s*Math.round(s/2)-1],e=new I(i,this);this.ee.push(e),e.p()}}class U extends t{ie;re=0;oe=0;ae=0;ce=0;ue=0;le=[];de=[];get _i(){return this.re}get Ei(){return this.oe}get we(){return this.ae}get gs(){return this.ce}get te(){return this.ie}constructor(t){super(),this.ie=t}p(){super.p(),this.pe(a.Ht,h.G.q.W,1,h.grid.D-2,1,h.grid.D-2),this.pe(a.$t,h.G.$.W,6,h.grid.D-3,1,h.grid.D-2),this.re=this.le.reduce(((t,s)=>t+s.Qt),0),this.ae=this.re}m(t){super.m(t),this.ce>0?(this.ue+=t,this.ce=h.Z-Math.round(this.ue)):this.ce=0}xs(t){this.re-=t}ws(t){this.oe+=t,this.xs(t),this.ue=0,this.ce=h.Z}ti(t){const s=this.le.filter((s=>s.Qt>=t));if(!(s.length<1))return s[g(0,s.length-1)]}pe(t,s,i,e,h,n){let r=0;for(;r<s;){const s=g(i,e),o=g(h,n),c=this.ie.ii.find((t=>t.Gt.x==s&&t.Gt.y===o));if(c&&!c.js){const s=c.Qs(t);switch(r++,t){case a.Ht:this.le.push(s);break;case a.$t:this.de.push(s)}}}}}!function(t){t[t.me=0]="Init",t[t.xi=1]="Running",t[t.ge=2]="Paused",t[t.fe=3]="Over"}(b||(b={}));class R extends t{static _e;Ee=0;xe=!1;Se;us;ke;ve=()=>this.ys();Ce;ye=[];bs=b.me;ie;os;get Ys(){return this.os}get te(){return this.ie}get ui(){return this.xe}get li(){return this.bs===b.xi}get pi(){return this.ye}static vs(){return this._e||(this._e=new R),this._e}constructor(){super(),this.ie=new v,this.os=new U(this.ie);const t=new z(this.ie);this.ye.push(this.ie,t,this.os)}p(){this.bs=b.xi,this.h(new C),this.h(new y),super.p();for(const t of this.ye)t.p();window.requestAnimationFrame((()=>{this.Ee=Date.now(),this.m()})),this.Se=document.body.querySelector(".modal"),this.Ae()}m(){if(this.bs!==b.xi)return;const t=this.ie.ii.some((t=>!t.It));if(this.Ys._i<=0||!t)return void this.be();const s=(Date.now()-this.Ee)/1e3;super.m(s);for(const t of this.ye)t.m(s);this.Ee=Date.now(),window.requestAnimationFrame((()=>this.m()))}ks(t,s){this.xe||(this.Ce=s,this.xe=!0,this.Ne(),this.us=t,this.ke=t.querySelector(".closeModal"),this.Se.appendChild(this.us),this.Se.classList.remove(h.K),this.us.classList.remove(h.K),this.ke&&this.ke.addEventListener("click",this.ve))}ys(){this.Ce?.(),this.Se.classList.add(h.K),this.us.classList.add(h.K),document.body.appendChild(this.us),this.ke&&this.ke.removeEventListener("click",this.ve),this.De(),setTimeout((()=>{this.xe=!1}),0)}Ae(){this.ks(document.body.querySelector("#intro"))}Ne(){this.bs===b.xi&&(this.bs=b.ge)}De(){this.bs===b.ge&&(this.bs=b.xi,this.m())}be(){this.u(C);const t=document.body.querySelector("#gameOverTemplate");document.body.querySelector("#finalScore").innerHTML=`${this.os.Ei} from ${this.os.we}`,this.bs=b.fe,setTimeout((()=>{this.ks(t)}),0)}}R.vs().p()})();