!function(t,e){"function"==typeof define&&define.amd?define(["exports"],e):e("object"==typeof exports&&"string"!=typeof exports.nodeName?exports:t.TinyMusic={})}(this,function(t){function e(t){var s=t.split(c);this.frequency=e.getFrequency(s[0])||0,this.duration=e.getDuration(s[1])||0}function s(t,e,s){this.ac=t||new AudioContext,this.createFxNodes(),this.tempo=e||120,this.loop=!0,this.smoothing=0,this.staccato=0,this.notes=[],this.push.apply(this,s||[])}var i="B#-C|C#-Db|D|D#-Eb|E-Fb|E#-F|F#-Gb|G|G#-Ab|A|A#-Bb|B-Cb",o=440*Math.pow(Math.pow(2,1/12),-9),n=/^[0-9.]+$/,r=4,c=/\s+/,h=/(\d+)/,a={};i.split("|").forEach(function(t,e){t.split("-").forEach(function(t){a[t]=e})}),e.getFrequency=function(t){var e=t.split(h),s=a[e[0]],i=(e[1]||r)-r,n=o*Math.pow(Math.pow(2,1/12),s);return n*Math.pow(2,i)},e.getDuration=function(t){return n.test(t)?parseFloat(t):t.toLowerCase().split("").reduce(function(t,e){return t+("w"===e?4:"h"===e?2:"q"===e?1:"e"===e?.5:"s"===e?.25:0)},0)},s.prototype.createFxNodes=function(){var t=[["bass",100],["mid",1e3],["treble",2500]],e=this.gain=this.ac.createGain();return t.forEach(function(t,s){s=this[t[0]]=this.ac.createBiquadFilter(),s.type="peaking",s.frequency.value=t[1],e.connect(e=s)}.bind(this)),e.connect(this.ac.destination),this},s.prototype.push=function(){return Array.prototype.forEach.call(arguments,function(t){this.notes.push(t instanceof e?t:new e(t))}.bind(this)),this},s.prototype.createCustomWave=function(t,e){e||(e=t),this.waveType="custom",this.customWave=[new Float32Array(t),new Float32Array(e)]},s.prototype.createOscillator=function(){return this.stop(),this.osc=this.ac.createOscillator(),this.customWave?this.osc.setPeriodicWave(this.ac.createPeriodicWave.apply(this.ac,this.customWave)):this.osc.type=this.waveType||"square",this.osc.connect(this.gain),this},s.prototype.scheduleNote=function(t,e){var s=60/this.tempo*this.notes[t].duration,i=s*(1-(this.staccato||0));return this.setFrequency(this.notes[t].frequency,e),this.smoothing&&this.notes[t].frequency&&this.slide(t,e,i),this.setFrequency(0,e+i),e+s},s.prototype.getNextNote=function(t){return this.notes[t<this.notes.length-1?t+1:0]},s.prototype.getSlideStartDelay=function(t){return t-Math.min(t,60/this.tempo*this.smoothing)},s.prototype.slide=function(t,e,s){var i=this.getNextNote(t),o=this.getSlideStartDelay(s);return this.setFrequency(this.notes[t].frequency,e+o),this.rampFrequency(i.frequency,e+s),this},s.prototype.setFrequency=function(t,e){return this.osc.frequency.setValueAtTime(t,e),this},s.prototype.rampFrequency=function(t,e){return this.osc.frequency.linearRampToValueAtTime(t,e),this},s.prototype.play=function(t){return t="number"==typeof t?t:this.ac.currentTime,this.createOscillator(),this.osc.start(t),this.notes.forEach(function(e,s){t=this.scheduleNote(s,t)}.bind(this)),this.osc.stop(t),this.osc.onended=this.loop?this.play.bind(this,t):null,this},s.prototype.stop=function(){return this.osc&&(this.osc.onended=null,this.osc.disconnect(),this.osc=null),this},t.Note=e,t.Sequence=s});
"use strict";function rnd(b,d){return Math.round(Math.random()*(d-b)+b)}function prob(b){return 100*Math.random()<=b}function dpd(){DEBUG&&console.log.apply(this,arguments)}var dp=console.log;function $(b){return document.getElementById(b)}var G={},DEBUG=!1;G.ui={},G.ui.fps=20,G.ui.width=150,G.ui.height=150,G.ui.scaleX=Math.floor(window.innerWidth/G.ui.width)||1,G.ui.scaleY=Math.floor(window.innerHeight/G.ui.height)||1,G.ui.scaleX>G.ui.scaleY?G.ui.scaleX=G.ui.scaleY:G.ui.scaleY=G.ui.scaleX,G.ui.width=Math.floor(window.innerWidth/G.ui.scaleX),G.state=0,G.gravity=0.3,G.minJump=2,G.maxJump=12,G.jumpPower=4,G.ui.floor=9,G.ui.horizon=18,G.ui.palette0={light:"#EEE",dark:"#333",mid:"#CCC"},G.ui.palette1={light:"#333",dark:"#EEE",mid:"#CCC"},G.ui.palette=G.ui.palette0,G.ui.camera={},G.init=function(){document.body.style.padding=document.body.style.margin="0px",document.body.style.backgroundColor="#000",document.body.style.width=window.innerWidth+"px",document.body.style.height=window.innerHeight+"px",G.ui.area=$("c"),G.ui.area.ctx=G.ui.area.getContext("2d"),G.ui.setupEvents(),window.onkeydown=G.click,window.onkeyup=G.clickEnd,G.ui.area.style.padding="0px",G.ui.area.style.margin="0px",G.ui.area.width=Math.floor(G.ui.width*G.ui.scaleX),G.ui.area.height=Math.floor(G.ui.height*G.ui.scaleY),G.ui.area.style.top=(window.innerHeight-G.ui.area.height)/3+"px",G.ui.area.ctx.imageSmoothingEnabled=!1,G.ui.pts={},G.playerDefault={id:"player",l:"4",x:4,y:G.ui.floor,dx:0,follow:!0,dy:0,ddx:0,ddy:-G.gravity,minY:G.ui.floor,score:0,jumps:0,frame:0,w:22,h:25,spriteSizes:[20,13,13,11,15,21],image:new Image},G.playerDefault.image.src="sprites.png",G.player=G.playerDefault,G.music.init(),G.ui.terrain.init(),G.playerDefault.image.complete?G.startMain():G.playerDefault.image.onload=G.startMain};function makeSprite(b,d,f){for(var m,k=[],q=0;q<f.length;q++){m=f[q];for(var r=m[1];r<=m[2];r++)k.push({x:r,y:m[0],c:m[3]})}return spriteFlip(k,d),k}function spriteQuad(b,d,f,k,m){for(var q=[],r=b;r<b+f;r++)for(var u=d;u<d+k;u++)q.push({x:r,y:u});return spriteFlip(q,m),q}function spriteCombine(b){for(var d=[],f=0;f<b.length;f++)d=d.concat(b[f]);return d}function spriteFlip(b,d){for(var f=0;f<b.length;f++)b[f].y=d-b[f].y}G.ui.sprites={none:null,cloud:makeSprite(0,7,[[0,6,10],[1,2,6],[1,11,11],[2,1,1],[2,5,5],[2,12,12],[3,0,1],[3,4,4],[3,13,13],[4,0,0],[4,13,13],[5,0,0],[5,13,13],[6,1,1],[6,13,13],[7,2,12]]),smallCloud:makeSprite(0,4,[[0,4,6],[1,1,3],[1,7,7],[2,0,0],[2,2,2],[2,8,8],[3,0,0],[3,8,8],[4,1,7]]),smallHill:makeSprite(0,5,[[0,5,5],[1,4,4],[1,6,6],[2,3,3],[2,7,7],[3,2,2],[3,8,8],[4,1,1],[4,9,9]]),stone0:[{x:0,y:0}],stone1:[{x:0,y:0},{x:1,y:0}],stone2:spriteQuad(0,0,3,1,1),cactus0:spriteCombine([spriteQuad(0,2,2,4,10),spriteQuad(6,3,2,3,10),spriteQuad(0,6,8,2,10),spriteQuad(3,0,2,10,10)]),cactus1:spriteCombine([spriteQuad(3,3,3,17,20),spriteQuad(6,7,3,2,20),spriteQuad(7,5,2,4,20),spriteQuad(0,9,3,2,20),spriteQuad(0,7,2,4,20)]),cactus2:spriteCombine([spriteQuad(3,3,3,22,25),spriteQuad(6,7,3,2,25),spriteQuad(7,5,2,4,25),spriteQuad(0,9,3,2,25),spriteQuad(0,7,2,4,25),spriteQuad(2,18,2,2,25),spriteQuad(1,16,1,4,25)]),horizon:spriteQuad(0,0,G.ui.width,1,1),char0:spriteCombine([spriteQuad(0,0,6,2,10),spriteQuad(0,2,2,6,10),spriteQuad(0,8,6,2,10),spriteQuad(4,2,2,6,10)]),char1:spriteCombine([spriteQuad(0,0,4,2,10),spriteQuad(2,2,2,6,10),spriteQuad(0,8,6,2,10)]),char2:spriteCombine([spriteQuad(0,0,6,2,10),spriteQuad(4,2,2,2,10),spriteQuad(0,4,6,2,10),spriteQuad(0,6,2,2,10),spriteQuad(0,8,6,2,10)]),char3:spriteCombine([spriteQuad(0,0,6,2,10),spriteQuad(4,2,2,2,10),spriteQuad(0,4,6,2,10),spriteQuad(4,6,2,2,10),spriteQuad(0,8,6,2,10)]),char4:spriteCombine([spriteQuad(0,0,2,6,10),spriteQuad(4,0,2,10,10),spriteQuad(0,4,6,2,10)]),char5:spriteCombine([spriteQuad(0,0,6,2,10),spriteQuad(0,2,2,2,10),spriteQuad(0,4,6,2,10),spriteQuad(4,6,2,2,10),spriteQuad(0,8,6,2,10)]),char6:spriteCombine([spriteQuad(0,0,2,10,10),spriteQuad(0,4,6,2,10),spriteQuad(4,6,2,2,10),spriteQuad(0,8,6,2,10)]),char7:spriteCombine([spriteQuad(0,0,6,2,10),spriteQuad(4,2,2,8,10)]),char8:spriteCombine([spriteQuad(0,0,2,10,10),spriteQuad(0,0,6,2,10),spriteQuad(4,2,2,2,10),spriteQuad(0,4,6,2,10),spriteQuad(4,6,2,2,10),spriteQuad(0,8,6,2,10)]),char9:spriteCombine([spriteQuad(0,0,6,2,10),spriteQuad(0,2,2,4,10),spriteQuad(2,4,2,2,10),spriteQuad(4,2,2,8,10)]),mute:spriteCombine([spriteQuad(0,4,2,2,10),spriteQuad(2,3,1,4,10),spriteQuad(3,2,1,6,10),spriteQuad(4,1,1,8,10)]),info:spriteCombine([spriteQuad(4,0,2,2,10),spriteQuad(4,3,2,7,10)])},G.ui.sprites.animate=function(){G.player.y==G.ui.floor?0==G.ticks%(G.ui.fps/8)&&(G.player.frame=5>G.player.frame?G.player.frame+1:0):G.player.frame=5},G.ui.speaker={speaking:!1,frame:0,w:22,h:25},G.ui.speaker.start=function(){this.speaking=!0,this.speak()},G.ui.speaker.stop=function(){this.speaking=!1},G.ui.speaker.speak=function(){var b=G.ui.speaker;b.speaking&&(G.ui.area.ctx.drawImage(G.player.image,22*b.frame,b.h,b.w,b.h,Math.round(G.menu.rectX-b.w*G.ui.scaleX/1.5),Math.round(G.menu.rectY-b.h*G.ui.scaleY/1.3),b.w*G.ui.scaleX,b.h*G.ui.scaleY),1>b.frame?b.frame++:b.frame=0,window.setTimeout(b.speak,300))},G.ui.terrain={},G.ui.terrain.generate=function(b,d,f,k,m,q){var r=[],u=Math.pow(2,Math.ceil(Math.log(b)/Math.log(2))),v=m.s-q,z=m.s+q;m.e=m.s,0===m.s&&(m.s=d/2+2*(Math.random()*f)-f),r[0]=m.s,0===m.e&&(m.e=d/2+2*(Math.random()*f)-f),r[u]=m.e,f*=k;for(var A=1;A<u;A*=2){for(var B=u/A/2;B<u;B+=u/A)r[B]=(r[B-u/A/2]+r[B+u/A/2])/2,r[B]+=2*(Math.random()*f)-f,r[B]<v?r[B]=v+(v-r[B]):r[B]>z&&(r[B]=z);f*=k}return r},G.ui.terrain.init=function(){this.ctx=G.ui.area.ctx,this.frames=5,this.tenth=Math.round(G.ui.area.height/10);var b=[G.ui.terrain.generate(G.ui.area.width*this.frames,G.ui.area.height,G.ui.area.height/1.2,0.63,{s:0.4*G.ui.area.height},G.ui.area.height/3),G.ui.terrain.generate(G.ui.area.width*this.frames,G.ui.area.height,G.ui.area.height/2,0.52,{s:0.6*G.ui.area.height},G.ui.area.height/4),G.ui.terrain.generate(G.ui.area.width*this.frames,G.ui.area.height,G.ui.area.height/2,0.3,{s:0.7*G.ui.area.height},G.ui.area.height/6)];G.ui.terrain.grad=[],G.ui.terrain.grad[0]=this.ctx.createLinearGradient(0,Math.max.apply(null,b[0]),0,0.75*G.ui.area.height),this.grad[0].addColorStop(0,"#DD8"),this.grad[0].addColorStop(1,"white"),this.grad[1]=this.ctx.createLinearGradient(0,0.5*G.ui.area.height,0,G.ui.area.height),this.grad[1].addColorStop(0,"#888"),this.grad[1].addColorStop(1,"#AB5"),this.grad[2]=this.ctx.createLinearGradient(0,0.75*G.ui.area.height,0,G.ui.area.height),this.grad[2].addColorStop(0,"#EEA"),this.grad[2].addColorStop(1,"#885"),this.grad[3]=this.ctx.createLinearGradient(0,(G.ui.height-G.ui.horizon)*G.ui.scaleY,0,G.ui.area.height),this.grad[3].addColorStop(0,"#AA8"),this.grad[3].addColorStop(1,"#663"),this.mnt=[{speed:0.9,frame:0,offset:0,col:this.grad[0],pts:b[0]},{speed:0.6,frame:0,offset:0,col:this.grad[1],pts:b[1]},{speed:1.5,frame:0,offset:0,col:this.grad[2],pts:b[2]}],this.frameLast=this.mnt[0].pts.length},G.ui.terrain.draw=function(){this.drawMountain(this.mnt[0]),this.drawMountain(this.mnt[1]),this.drawMountain(this.mnt[2]),this.ctx.fillStyle=this.grad[3],this.ctx.fillRect(0,(G.ui.height-G.ui.horizon)*G.ui.scaleY,G.ui.area.width,G.ui.area.height)},G.ui.terrain.drawMountain=function(b){this.ctx.fillStyle=b.col,this.ctx.beginPath(),this.ctx.moveTo(0,b[b.frame]);for(var d=b.frame;d<=b.frame+G.ui.area.width;d++)this.ctx.lineTo(d-b.frame,this.tenth*b.offset+b.pts[d%this.frameLast]);this.ctx.lineTo(G.ui.area.width,G.ui.area.height),this.ctx.lineTo(0,G.ui.area.height),this.ctx.closePath(),this.ctx.fill(),b.frameReal=b.frame+b.speed<=this.frameLast?b.frame+b.speed:0,b.frame=Math.round(b.frameReal)},G.entity={get:function get(b){for(var d=0;d<G.ent.length;d++)if(G.ent[d].id==b)return G.ent[d]},gets:function gets(b){for(var d=[],f=0;f<G.ent.length;f++)G.ent[f].tag==b&&d.push(G.ent[f]);return d},layer:function layer(b){for(var d=[],f=0;f<G.ent.length;f++)(G.ent[f].l==b||0==b&&"undefined"==typeof G.ent[f].l)&&d.push(G.ent[f]);return d},add:function add(b){return b.l="undefined"==typeof b.l?"2":b.l,G.ent.push(b),b},remove:function remove(b){G.ent.splice(b,1)},count:function count(b){for(var d=0,f=0;f<G.ent.length;f++)G.ent[f].tag&&-1<G.ent[f].tag.indexOf(b)&&d++;return d},collision:function collision(b){var d=Math.round(b.x-+G.ui.camera.x),f=b.obstacle[1],k=Math.round(d+b.obstacle[0]),m=Math.round(G.player.x),q=Math.round(m+G.player.spriteSizes[G.player.frame]);Math.floor(f/1.5);var u=1,v=G.player.y+0<=b.y+f;if(v&&d+u<q&&k-u>m)return!0}},G.draw=function(){var b=G.ui.area.ctx;b.fillStyle=G.ui.palette.dark;for(var d=0;4>=d;d++){1==d&&G.ui.terrain.draw();for(var f=G.entity.layer(d),k=0;k<f.length;k++)pte(f[k])}},G.clear=function(){var b=G.ui.area.ctx;b.fillStyle=G.ui.palette.light;b.fillRect(0,0,G.ui.width*G.ui.scaleX,G.ui.height*G.ui.scaleY)};function pte(b){if(b.pts)for(var d=0;d<b.pts.length;d++)b.follow?px(b.x+b.pts[d].x,b.y+b.pts[d].y,b.pts[d].c||b.col):px(b.x+b.pts[d].x-G.ui.camera.x,b.y+b.pts[d].y-G.ui.camera.y,b.pts[d].c||b.col);else b.image&&G.ui.area.ctx.drawImage(G.player.image,b.w*b.frame,0,b.w-1,b.h-1,b.x*G.ui.scaleX,(G.ui.height-b.y-b.h)*G.ui.scaleY,b.w*G.ui.scaleX,b.h*G.ui.scaleY)}var tt=0;function px(b,d,f){d=G.ui.height-d,b*=G.ui.scaleX,d*=G.ui.scaleY,G.ui.area.ctx.fillStyle=1==f?G.ui.palette.light:2==f?G.ui.palette.mid:G.ui.palette.dark,G.ui.area.ctx.fillRect(b,d,G.ui.scaleX,G.ui.scaleY)}G.music={},G.music.init=function(){this.enabled=!0,G.music.ac="undefined"==typeof AudioContext?new webkitAudioContext:new AudioContext,G.music.tempo=100,G.music.lead=["C3  e","C3  e","B3  e","C3  e","C3  s","C3  s","G3  s","C3  s","G3  s","C3  s","C3  s","-  s","A3  e","G3  e","A3  e","G3  e","C3  e","C3  e","C3  e","-  e"],G.music.lead1=["C3  s","C3  s","A3  s","C3  s","G3  s","C4  s","C3  s","-  s","F3  e","C3  e","A3  e","F3  e","A3  e","G3  e","C3  s","C3  s","G3  e","C3  e","D4  e","C3  e","-  e"],G.music.harmony=["-   e","D4  e","C4  e","D4  e","C3 e","C4  e","A3  e","C3 e","G3  e","A3  e","C3 e","A3  e","G3  e","A3  e","F3  q","-   e","D4  s","C4  s","D4  e","C3 e","C4  e","C3 e","A3  e","C3 e","G3  e","A3  e","C3 e","A3  e","G3  s","A3  s","G3  e","F3  q"],G.music.bass=["D3  q","-   h","D3  q","A3  q","-   h","A2  q","C2 q","-   h","C2 q","G2  h","A2  h"],G.music.jump=["C5  q","-   q"],G.music.gameover=["E3  q","D3  q","C2  h"],G.music.seq1=new TinyMusic.Sequence(G.music.ac,G.music.tempo,G.music.lead),G.music.seq1.createCustomWave([-1,-0.9,-0.6,-0.3,0,0.3,0.6,0.9,1]),G.music.seq2=new TinyMusic.Sequence(G.music.ac,G.music.tempo,G.music.harmony),G.music.seq3=new TinyMusic.Sequence(G.music.ac,G.music.tempo,G.music.bass),G.music.seq3.createCustomWave([-1,-0.9,-0.6,-0.3,0,0.3,0.6,0.9,1]),G.music.seq4=new TinyMusic.Sequence(G.music.ac,G.music.tempo,G.music.lead1),G.music.seq4.createCustomWave([-1,-0.8,-0.4,-0.2,0,0.2,0.4,0.8,1]),G.music.seq1.staccato=0.55,G.music.seq4.staccato=0.55,G.music.seq2.staccato=0.55,G.music.seq3.staccato=0.15,G.music.seq3.smoothing=0.9,G.music.seq1.gain.gain.value=1/20,G.music.seq4.gain.gain.value=1/20,G.music.seq2.gain.gain.value=0.8/20,G.music.seq3.gain.gain.value=0.65/20,G.music.seq1.mid.frequency.value=800,G.music.seq4.mid.frequency.value=800,G.music.seq1.mid.gain.value=3,G.music.seq4.mid.gain.value=3,G.music.seq2.mid.frequency.value=1200,G.music.seq3.mid.gain.value=3,G.music.seq3.bass.gain.value=16,G.music.seq3.bass.frequency.value=80,G.music.seq3.mid.gain.value=-6,G.music.seq3.mid.frequency.value=500,G.music.seq3.treble.gain.value=-2,G.music.seq3.treble.frequency.value=1400,this.sfxJump=new TinyMusic.Sequence(G.music.ac,G.music.tempo,G.music.jump),this.sfxJump.staccato=0.45,this.sfxJump.smoothing=0.2,this.sfxJump.gain.gain.value=0.65/10,this.sfxJump.bass.gain.value=-6,this.sfxJump.bass.frequency.value=1400,this.sfxJump.mid.gain.value=-6,this.sfxJump.mid.frequency.value=1400,this.sfxJump.treble.gain.value=-2,this.sfxJump.treble.frequency.value=1400,this.sfxGameOver=new TinyMusic.Sequence(G.music.ac,G.music.tempo,G.music.gameover),this.sfxGameOver.staccato=0.45,this.sfxGameOver.smoothing=0.2,this.sfxGameOver.gain.gain.value=0.65/10,this.sfxGameOver.bass.gain.value=-6,this.sfxGameOver.bass.frequency.value=1400,this.sfxGameOver.mid.gain.value=-6,this.sfxGameOver.mid.frequency.value=1400,this.sfxGameOver.treble.gain.value=-2,this.sfxGameOver.treble.frequency.value=1400},G.music.playJump=function(){this.enabled&&(this.sfxJump.play(this.ac.currentTime),this.sfxJump.loop=!1)},G.music.playGameOver=function(){this.enabled&&(this.sfxGameOver.play(this.ac.currentTime),this.sfxGameOver.loop=!1)},G.music.restart=function(){this.tempo=100,this.seq1.counter=0,this.seq4.counter=0;this.enabled&&this.play()},G.music.play=function(){G.music.seq1.play(G.music.ac.currentTime);var b=function(){++G.music.seq1.counter,0==G.music.seq1.counter%4?(G.music.seq4.play(G.music.ac.currentTime),G.music.seq4.osc.onended=d):(G.music.seq1.play(G.music.ac.currentTime),G.music.seq1.osc.onended=b)},d=function(){++G.music.seq4.counter,0==G.music.seq4.counter%4?(G.music.seq1.play(G.music.ac.currentTime),G.music.seq1.osc.onended=b):(G.music.seq4.play(G.music.ac.currentTime),G.music.seq4.osc.onended=d)};G.music.seq1.osc.onended=b,G.music.seq2.play(G.music.ac.currentTime+16*(60/G.music.tempo));var f=function(){G.music.seq2.play(G.music.ac.currentTime+16*(60/G.music.tempo)),G.music.seq2.osc.onended=f};G.music.seq2.osc.onended=f,G.music.seq3.play(G.music.ac.currentTime+8*(60/G.music.tempo));var k=function(){G.music.seq3.play(G.music.ac.currentTime+16*(60/G.music.tempo)),G.music.seq3.osc.onended=k};G.music.seq3.osc.onended=k},G.music.stop=function(){G.music.seq1.stop(),G.music.seq2.stop(),G.music.seq3.stop(),G.music.seq4.stop()},G.music.toggle=function(){this.enabled?(this.stop(),this.enabled=!1,G.entity.get("mute").col=2):(this.play(),this.enabled=!0,G.entity.get("mute").col=0)},G.clickTimer=0,G.ui.setupEvents=function(){document.body.addEventListener("mousedown",G.click),document.body.addEventListener("mouseup",G.clickEnd),document.body.addEventListener("touchstart",G.click,{passive:!1}),document.body.addEventListener("touchend",G.clickEnd,{passive:!1}),window.onerror=function(b,d,f,k,m){alert("Line "+f+"; Message: "+b+"\n"+m)}},G.click=function(b){var d=" "==b.key||"touchstart"==b.type||"mousedown"==b.type;if(d){b.stopPropagation(),b.preventDefault();var f=(b.clientX||(b.touches?b.touches[0].clientX:-999))-G.ui.area.offsetLeft,k=(b.clientY||(b.touches?b.touches[0].clientY:-999))-G.ui.area.offsetTop;2==G.state||(3==G.state?G.menu.end():G.menu.next?G.paused?G.start():f<G.menu.rectX||f>G.menu.rectX+G.menu.rectWidth||k<G.menu.rectY||k>G.menu.rectY+0.75*G.menu.rectHeight?G.menu.end():G.menu.doNext():1==G.state&&(0<f&&10>f/G.ui.scaleX&&10>k/G.ui.scaleY?G.music.toggle():20<f/G.ui.scaleX&&30>f/G.ui.scaleX&&10>k/G.ui.scaleY?(G.pause(),G.menu.info()):G.player.y>G.player.minY+5&&-4<G.player.dy?G.player.dy=-4:(G.player.y=G.player.minY)&&(G.music.playJump(),G.clickTimer=G.minJump)))}else"p"==b.key&&G.pause()},G.clickEnd=function(){0<G.clickTimer&&(G.clickTimer=0)},G.menu={next:null,font:"Courier New,Courier",textSize:Math.round((G.ui.width+G.ui.height)*G.ui.scaleX/50),lineHeight:Math.round((G.ui.width+G.ui.height)*G.ui.scaleX/40)},G.menu.intro0=function(){G.ui.speaker.start(),G.menu.popup({title:"Get LOST Hombre!",text:"Welcome... or rather not.... You are an illegal alien #BadHombre of questionable race and virtue trying to get into the Land of the Free ...",next:G.menu.intro1})},G.menu.intro1=function(){G.menu.popup({title:"Get LOST Hombre!",text:"Sooo... until we build The Wall (#NeedSponsor) and according to our new Incredible Merit System you must earn enough 1000 Freedom Points to be allowed in...",next:G.menu.intro2})},G.menu.intro2=function(){G.menu.popup({title:"Get LOST Hombre!",text:"Pass through our desert #SwampDrained to earn Freedom Points by jumping cactuseses and we will consider your application ...",next:G.menu.intro3})},G.menu.intro3=function(){G.menu.popup({title:"Get LOST Hombre!",text:"Fail and we will be forced to keep you in a prison camp wearing pink underwear until you die of humiliation #ToughLove ...",next:G.menu.end,button:"Let's go!"})},G.menu.info=function(){G.menu.popup({title:"Get LOST Hombre!",text:"Developed by: Marc Cawood ##  ## Inspired by: T-Rex Runner Chrome ##  ## Thanks to: TinyMusic, Loktar",next:function next(){G.menu.end(),G.start()},button:"Let's go!"})},G.menu.gameover0=function(){G.ui.speaker.start(),G.menu.popup({title:"Get LOST Hombre!",text:"You failed. Get Lost! ##  Get 'em outta here!! ##   #GameOver    ## Sad! ## ramble ramble ##    I love Hexicans ##     covefe...",next:G.menu.end,button:"Try again!"})},G.menu.end=function(){G.menu.next=null,G.ui.speaker.stop(),G.restart()},G.menu.popup=function(b){var d=G.ui.area.ctx;G.menu.next=b.next,this.rectWidth=G.ui.width*G.ui.scaleX/1.3,this.rectHeight=G.ui.height*G.ui.scaleX/1.5,this.rectX=G.ui.width*G.ui.scaleX/2-this.rectWidth/2,this.rectY=G.ui.height*G.ui.scaleY/2-this.rectHeight/2;var f=8*G.ui.scaleX;d.fillStyle=G.ui.palette.light,d.strokeStyle=G.ui.palette.dark,d.lineJoin="round",d.lineWidth=f,d.strokeRect(this.rectX+f/2,this.rectY+f/2,this.rectWidth-f,this.rectHeight-f),d.fillRect(this.rectX+f/2,this.rectY+f/2,this.rectWidth-f,this.rectHeight-f);var k=0;if(b.title&&(d.fillStyle=G.ui.palette.dark,d.font="bold "+Math.round(1.5*G.menu.textSize)+"px "+this.font,d.fillText(b.title,this.rectX+0.7*f,this.rectY+f+this.lineHeight),k=2*this.lineHeight,this.rectHeight+=k),G.menu.wrapText(b.text,this.rectX+0.7*f,this.rectY+f+0.5*this.lineHeight+k,this.rectWidth-f),b.button){d.fillStyle="#FB6",d.lineWidth=f,d.strokeStyle=G.ui.palette.dark,d.strokeRect(G.ui.width*G.ui.scaleX/2-4*this.textSize,this.rectY+this.rectHeight-4*this.textSize,8*this.textSize,2*this.textSize),d.fillRect(G.ui.width*G.ui.scaleX/2-4*this.textSize,this.rectY+this.rectHeight-4*this.textSize,8*this.textSize,2*this.textSize),d.fillStyle=G.ui.palette.dark,d.font=G.menu.textSize+"px "+this.font;b.button.length*this.textSize;d.lineWidth="1",d.strokeText(b.button,G.ui.width*G.ui.scaleX/2-2.5*this.textSize,this.rectY+this.rectHeight-2.8*this.textSize,10*this.textSize,2*this.textSize)}},G.menu.doNext=function(){this.next()},G.menu.wrapText=function(b,d,f,k){var m=G.ui.area.ctx;m.strokeStyle=G.ui.palette.dark,m.lineWidth="1",m.font=G.menu.textSize+"px "+this.font;for(var v,q=b.split(/\s/),r="",u=0;u<q.length;u++)v=r+q[u]+" ","##"==q[u]||m.measureText(v).width>k&&0<u?(m.strokeText(r,d,f),r="##"==q[u]?"":q[u]+" ",f+=this.lineHeight):r=v;m.strokeText(r,d,f)},G.startMain=function(){G.restart(!0),G.clear(),G.draw(),G.menu.intro0()},G.restart=function(b){G._intervalId&&G.pause(),G.ticks=0,G.state=1,G.speed=1.2,G.spacing=50,G.music.tempo=100,G.lastCactus=0,G.level=0,G.ui.palette=G.ui.palette0,G.ui.camera={x:0,y:0},G.ent=[],G.player=G.entity.add(G.playerDefault),G.addCloud(0.3*G.ui.width,1),G.addCloud(0.7*G.ui.width,1),G.addCloud(0.6*G.ui.width,0),G.addCloud(0.9*G.ui.width,0);var f=G.addCactus(40-G.ui.width,1);f.kill=!0,f=G.addCactus(120-G.ui.width,0),f.kill=!0;for(var d=0;13>d;d++)G.addStone(rnd(0,G.ui.width),d%3);G.entity.add({id:"mute",x:1,y:G.ui.height-1-10,follow:!0,pts:G.ui.sprites.mute,col:G.music.enabled?0:2}),f=G.entity.add({id:"info",x:20,y:G.ui.height-1-10,follow:!0,pts:G.ui.sprites.info}),f.col=2,G.entity.add({id:"char3",x:G.ui.width-32,y:G.ui.height-2-10,follow:!0,pts:G.ui.sprites.char0}),G.entity.add({id:"char2",x:G.ui.width-24,y:G.ui.height-2-10,follow:!0,pts:G.ui.sprites.char0}),G.entity.add({id:"char1",x:G.ui.width-16,y:G.ui.height-2-10,follow:!0,pts:G.ui.sprites.char0}),G.menu.next=null;b||G.start()},G.update=function(){G.ticks++;G.entity.get("char");if(prob(75)&&0==G.ticks%rnd(10,30)&&(prob(80)&&3>G.entity.count("smallCloud")&&G.addCloud(0,0),prob(90)&&3>G.entity.count("cloud")&&G.addCloud(0,1)),prob(75)&&0==G.ticks%rnd(10,30)&&3>G.entity.count("stone0")&&G.addStone(0,0),prob(75)&&0==G.ticks%rnd(10,30)&&7>G.entity.count("stone1")&&G.addStone(0,1),prob(75)&&0==G.ticks%rnd(10,30)&&7>G.entity.count("stone2")&&G.addStone(0,2),0==G.ticks%10&&(G.speed+=5e-3,G.spacing-=0.1),0==G.ticks%rnd(10,30)){var d=Math.random()*G.spacing+40;if(G.ticks-G.lastCactus>d){var m=Math.min(2,Math.round(G.level));G.addCactus(0,rnd(0,m)),1<G.level&&prob(50)&&G.addCactus(10,rnd(0,m)),3<G.level&&prob(25)&&G.addCactus(20,rnd(0,m)),5<G.level&&prob(25)&&G.addCactus(30,rnd(0,m)),G.lastCactus=G.ticks}}0<G.clickTimer&&G.clickTimer<G.maxJump&&(G.player.dy=G.jumpPower,G.clickTimer++),G.clickTimer>G.maxJump&&(g.clickTimer=0),G.ui.camera.x+=G.speed||0;for(var k,f=G.ent.length;f--;)k=G.ent[f],k.dx&&k.ddx&&(k.dx+=k.ddx),k.dy&&k.ddy&&(k.dy+=k.ddy),k.x+=k.dx?k.dx:0,k.y+=k.dy?k.dy:0,"undefined"!=typeof k.minY&&0<Math.abs(k.dy)&&k.y<=k.minY&&(k.dy=0,k.y=k.minY,k===G.player&&(G.player.jumps++,G.player.frame=0)),k.obstacle&&G.entity.collision(k)&&G.gameOver(),k.x+20<G.ui.camera.x&&!k.follow&&G.entity.remove(f),k.kill&&G.entity.remove(f);1<G.state||(G.ui.sprites.animate(),G.player.score=Math.round(G.ticks/10),G.level=Math.floor(G.player.score/100),G.ui.showScore(G.player.score),0==G.ticks%2e3&&(G.ui.palette=G.ui.palette==G.ui.palette0?G.ui.palette1:G.ui.palette0))},G.loop=function(){G.update();1<G.state||G.paused||(G.clear(),G.draw(),G._intervalId&&requestAnimationFrame(G.loop))},G.ui.showScore=function(b){var d=("00"+b).slice(-3),f=d[0];c2=d[1],c1=d[2],G.entity.get("char3").pts=G.ui.sprites["char"+f],G.entity.get("char2").pts=G.ui.sprites["char"+c2],G.entity.get("char1").pts=G.ui.sprites["char"+c1]},G.addStone=function(b,d){var f=b||G.ui.camera.x+G.ui.width,k=G.ui.horizon/3;Y=d*k+rnd(0,k-1),G.entity.add({tag:"stone"+d,x:f,y:G.ui.horizon-Y-1,pts:G.ui.sprites["stone"+d],dx:(G.ui.horizon-Y)/20})},G.addCloud=function(b,d){var f=b||G.ui.camera.x+G.ui.width,k=rnd(d*G.ui.height/60+G.ui.height/2,G.ui.height-15);G.entity.add({tag:0==d?"smallCloud":"cloud",x:f,y:k,pts:0==d?G.ui.sprites.smallCloud:G.ui.sprites.cloud,col:2,dx:2*G.speed/(2+d),dy:0.01,l:"0"})},G.addCactus=function(b,d){return G.entity.add({tag:"cactus",obstacle:[9,9+9*d],x:G.ui.camera.x+G.ui.width+b,y:G.ui.floor,l:3,pts:G.ui.sprites["cactus"+d]})},G.start=function(){G.menu.next=null,G.paused=!1,G._intervalId&&clearInterval(G._intervalId),G._intervalId=requestAnimationFrame(G.loop),G.music.restart()},G.gameOver=function(){G.pause(),G.state=2,setTimeout(function(){G.state=3},1e3),G.music.playGameOver(),G.menu.gameover0()},G.pause=function(){G._intervalId?(G.paused=!0,clearInterval(G._intervalId),delete G._intervalId,G.music.stop()):G.start()},G.cheat=function(b){G.ticks=1e3*b,G.score=100*b,G.speed=1.2+5e-4*G.ticks,G.spacing=50-0.01*G.ticks},G.init();