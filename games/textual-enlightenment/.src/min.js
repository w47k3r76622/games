function e(){p.push(x(c/2+c/8,y/4,!0)),p.push(x(c,y/8,!0)),p.push(x(c/2-c/4,y/4,!0))}function t(e){var t=e.y+e.width+e.dy,s=e.x+e.height+e.dx;return t>=l.height||t<=2*e.height||s>=l.width||s<=2*e.width}function s(e,t){var s=f.x+f.dx,i=f.y+f.dy;if(s<t.x-t.width/2||s>t.x+t.width/2)return(n=Math.sqrt(Math.pow(s-t.x,2)+Math.pow(i-t.y,2)))<e.radius+t.width/2;var n=Math.sqrt(Math.pow(0,2)+Math.pow(i-t.y,2));return n<e.radius+t.height/2}function i(e,t){var s=f.x+f.dx,i=f.y+f.dy;if(s<=t.x-t.width/2||s>=t.x+t.width/2)return(n=Math.sqrt(Math.pow(s-t.x,2)+Math.pow(i-t.y,2)))<e.radius+t.width/2+20;var n=Math.sqrt(Math.pow(0,2)+Math.pow(i-t.y,2));return n<e.radius+t.height/2+20}class n{constructor(e,t,s){this.radius=e,this.width=Math.round(e),this.height=Math.round(e),this.x=t,this.y=s,this.sequence=0,this.talkedTo=0,this.dx=0,this.dy=0,this.speed=2,this.playedPreviously=!1,this.canMove=!1,this.isReading=!1,this.offered=!1,this.darkside=!1,this.previouslyDark=!1,this.undead=!1}act(){this.handleInput(),this.undead=!1,k.gameStarted&&this.gameSequence(),!t(this)&&this.canMove&&(this.x+=this.dx,this.y+=this.dy),w.beginPath(),w.arc(this.x,this.y,this.radius,0,2*Math.PI),w.fillStyle="#FFF",w.fill(),w.closePath(),this.canMove=!0}gameSequence(){switch(this.sequence){case-1:(p=[]).push(f),f.talkedTo=0,f.darkside=!1,f.offered=!1,p.push(new o(new a(100,50,c/2,25,"grey"),["The fridge hums to you the song of it's people.","You hum along harmoniously."],0,100)),p.push(new o(new a(100,100,c/4,200,"grey"),["You stare at the table.","The table stares back at you.","You're not sure what it wants."],0,0)),p.push(new o(new a(10,100,0,y/6,"grey"),["As you look through the window, your mind wanders.","Will it always be like this?"],350,0)),p.push(new o(new a(10,100,0,y/6+y/2,"grey"),["You realize this window is no different than any other.","The window seems offended."],320,0)),p.push(new o(new a(175,100,c/2,y-50,"grey"),["The couch's tongue wriggles between your fingers.","It beckons for you to stay."],0,-25)),p.push(new o(new a(100,50,c/2,y/2+y/6,"grey"),["Static fills the T.V.","How calming."],0,0)),p.push(k),k.gameStarted=!1,console.log(f.playedPreviously),this.sequence++;break;case 0:if(6==this.talkedTo&&!this.isReading||f.playedPreviously){var t=new o(new a(20,100,c,y/2,"red"),[],0,0);t.specialFunction=function(){s(f,t.drawable)&&f.sequence++},p.push(t),this.sequence++}break;case 1:if(!this.isReading){var i=new r(["The door is left open.","I don't know who I am anymore."],0,0);i.boundToPlayer=!0,p.push(i),this.sequence++}break;case 3:(p=[]).push(f),f.x=1135,f.y=570,f.sequence++,f.screenPos=0,f.needsUpdate=!0;break;case 4:if(f.needsUpdate)switch(f.screenPos){case 0:if(e(),p.push(new o(new a(c,100,c/2,y-50,"grey"),[],0,0)),f.darkside||f.offered)if(f.darkside){var n=new o(new a(75,25,1135,y-105,"red"),["The taste is off.","Is this really home?"],0,0);n.specialFunction=function(){s(f,n.drawable)&&(f.sequence=40)},p.push(n)}else(n=new o(new a(75,25,1135,y-105,"blue"),["It tastes like home."],0,0)).specialFunction=function(){s(f,n.drawable)&&(f.sequence=27)},p.push(n);else p.push(new o(new a(75,25,1135,y-105,"blue"),["It tastes like home."],0,0));p.push(new d(0,y-120)),p.push(new d(0,0)),f.needsUpdate=!1;break;case 1:if(e(),p.push(new o(new a(c,100,c/2,y-50,"grey"),[],0,0)),!f.darkside)if(f.previouslyDark){var h=new o(new a(50,50,100,y/2+y/4,"red"),["So you've got the cash?","Well here's your ticket to heaven."],150,-50);h.doorDrawn=!1,h.specialFunction=function(){h.playerNoticed&&!h.doorDrawn&&(setTimeout(function(){f.sequence=127},3100),h.doorDrawn=!0)},p.push(h)}else(h=new o(new a(50,50,100,y/2+y/4,"grey"),["Hey there.","Want to buy a ticket to heaven?","What? You don't have any money?","Sell some furniture or something."],150,-50)).doorDrawn=!1,h.specialFunction=function(){if(h.playerNoticed&&!h.doorDrawn){f.offered=!0;var e=new o(new a(75,25,c/2,y-105,"red"),["Like a portal to hell."],0,0);e.specialFunction=function(){s(f,e.drawable)&&(f.screenPos=2,f.needsUpdate=!0)},h.doorDrawn=!0,setTimeout(function(){p.push(e)},6100)}},p.push(h);p.push(new d(0,y-120));var u=new d(c,0);u.left=!1,p.push(u),f.needsUpdate=!1;break;case 2:(p=[]).push(f);var l=new o(new a(75,25,c/2,15,"red"),["It smells of sin."],0,0);l.specialFunction=function(){s(f,l.drawable)&&((p=[]).push(f),f.y=y-150,f.screenPos=1,f.needsUpdate=!0)},p.push(l);var w=new o(new a(50,50,c/2,y-100,"red"),["So you're looking for some quick cash huh?","Sure I'll buy your furniture from you."],0,0);w.specialFunction=function(){w.playerNoticed&&!f.darkside&&(f.darkside=!0)},p.push(w),f.undead=!0,f.x=c/2,f.y=100,f.needsUpdate=!1}break;case 27:(p=[]).push(new r(["You decide to spend the night in with your friends.","It feels good."],c/2,y/2)),setTimeout(function(){p.push(f),f.sequence=-1,f.playedPreviously=!0,f.x=c/2,f.y=y/2},3100),f.sequence++;break;case 40:(p=[]).push(f),f.x=1150,f.y=350,f.talkedTo=0;function g(e){e.specialFunction=function(){6!=f.talkedTo||f.isReading||(b(e),f.sequence++)}}var x=new o(new a(100,50,c/2,25,"red"),["The fridge no longer hums.","You can feel its judging gaze."],0,100);g(x),p.push(x);var v=new o(new a(100,100,c/4,200,"red"),["You stare at the table.","The table stares back at you.","You know what it wants now.","Freedom."],0,0);g(v),p.push(v);var m=new o(new a(10,100,0,y/6,"red"),["As you look through the window, your mind wanders.","What am I doing?"],350,0);g(m),p.push(m);var T=new o(new a(10,100,0,y/6+y/2,"red"),["You know now.","This window isn't unique."],150,0);g(T),p.push(T);var q=new o(new a(175,100,c/2,y-50,"red"),["The couch's tongue wriggles between your fingers.","It snaps at your hand, and takes a finger in the proccess."],0,-25);g(q),p.push(q);var P=new o(new a(100,50,c/2,y/2+y/6,"red"),["The T.V. is picking up a broadcast.","It's televised evangelisim."],0,0);g(P),p.push(P),f.sequence++;break;case 69:(p=[]).push(new r(["Is this really the answer you were looking for?"],c/2,y/2)),setTimeout(function(){p.push(f),f.sequence=-1,f.playedPreviously=!0,f.x=c/2,f.y=y/2},1600),f.sequence++;break;case 99:(p=[]).push(new r(["Your friends would have it no more.","It's a dog eat dog world, and they ate you first."],c/2,y/2)),f.previouslyDark=!0,setTimeout(function(){p.push(f),f.sequence=-1,f.playedPreviously=!0,f.x=c/2,f.y=y/2},3100);break;case 127:(p=[]).push(new r(["Your ticket to heaven?","Lies."],c/2,y/2)),f.previouslyDark=!1,setTimeout(function(){p.push(f),f.sequence=-1,f.playedPreviously=!0,f.x=c/2,f.y=y/2},3100)}}handleInput(){this.dx=0,this.dy=0,k.gameStarted&&!f.isReading&&(g.up&&(this.dy=-this.speed),g.down&&(this.dy=this.speed),g.right&&(this.dx=this.speed),g.left&&(this.dx=-this.speed),g.action)}}class a{constructor(e,t,s,i,n){this.width=e,this.height=t,this.x=s,this.y=i,this.color=n}act(){w.fillStyle=this.color,w.fillRect(this.x-this.width/2,this.y-this.height/2,this.width,this.height)}}class o{constructor(e,t,s,i){this.thoughts=t,this.drawable=e,this.ox=s,this.oy=i,this.specialFunction,this.playerNoticed=!1}act(){this.drawable.act(),void 0!==this.specialFunction&&this.specialFunction(),i(f,this.drawable)&&(s(f,this.drawable)&&(f.canMove=!1),g.action&&!f.isReading&&this.thoughts.length>0&&(f.isReading=!0,this.playerNoticed||(this.playerNoticed=!0,f.talkedTo++),0!=this.ox||0!=this.oy?p.push(new r(this.thoughts,f.x+f.radius/2+this.ox,f.y+f.radius/2-this.drawable.height/2+this.oy)):f.y>this.drawable.y?p.push(new r(this.thoughts,f.x+f.radius/2,f.y+f.radius/2+this.drawable.height/2+f.radius)):p.push(new r(this.thoughts,f.x+f.radius/2,f.y+f.radius/2-this.drawable.height/2-f.radius))))}}class h{constructor(){this.gameStarted=!1}act(){g.action?(this.gameStarted=!0,p.pop()):(w.fillStyle="#FFF",w.font="50px Arial",w.fillText("Textual Enlightenment",c/2-250,y/2-200),w.font="30px Arial",w.fillText("Press E to begin",c/2-100,y/2-150))}}class r{constructor(e,t,s){this.dialogue=e,this.x=t,this.y=s,this.boundToPlayer=!1,this.arrayPosition=0,this.lastDraw=Date.now(),this.delay=1500}act(){Date.now()>this.lastDraw+this.delay&&(this.lastDraw=Date.now(),void 0===this.dialogue[++this.arrayPosition]&&(f.isReading=!1,p.pop())),w.font="30px Arial",w.fillStyle="#FFF";var e=w.measureText(this.dialogue[this.arrayPosition]).width;void 0!==this.dialogue[this.arrayPosition]&&(this.boundToPlayer?w.fillText(this.dialogue[this.arrayPosition],f.x-e/2,f.y-30):w.fillText(this.dialogue[this.arrayPosition],this.x-e/2,this.y))}}class u{constructor(){this.up=!1,this.down=!1,this.left=!1,this.right=!1,this.action=!1}}class d{constructor(e,t){this.y=t,this.x=e,this.left=!0}act(){var e=f.y+f.dy,t=f.x+f.dx;0!=this.y?e>=this.y&&(f.canMove=!1,void 0!==this.transition&&this.transition()):this.left?t<=this.x+2*f.radius&&(f.screenPos++,f.x=1135,f.needsUpdate=!0,(p=[]).push(f)):t>=this.x-2*f.radius&&(f.screenPos--,f.x=100,f.needsUpdate=!0,(p=[]).push(f))}}document.addEventListener("keydown",function(e){68==e.keyCode?g.right=!0:65==e.keyCode?g.left=!0:87==e.keyCode?g.up=!0:83==e.keyCode?g.down=!0:69==e.keyCode?g.action=!0:76==e.keyCode&&console.log(f)},!1),document.addEventListener("keyup",function(e){68==e.keyCode?g.right=!1:65==e.keyCode?g.left=!1:87==e.keyCode?g.up=!1:83==e.keyCode?g.down=!1:69==e.keyCode&&(g.action=!1)},!1);var l=document.getElementById("gameCanvas"),w=l.getContext("2d"),c=l.width,y=l.height,p=[],g=new u,f=new n(20,c/2,y/2),k=new h,x=function(e,t,i){var n=new o(new a(200,100,e,t,"grey"),["Vroom."],0,0);return n.specialFunction=function(){s(f,n.drawable)&&!f.undead&&(f.sequence=69),n.drawable.x<=0&&(n.drawable.x=c),i?n.drawable.x-=5:n.drawable.x+=5},n},b=function(e){e.specialFunction=function(){f.x>e.drawable.x?e.drawable.x+=1:e.drawable.x-=1,f.y>e.drawable.y?e.drawable.y+=1:e.drawable.y-=1,s(f,e.drawable)&&(f.sequence=99)}};p.push(f),p.push(new o(new a(100,50,c/2,25,"grey"),["The fridge hums to you the song of it's people.","You hum along harmoniously."],0,100)),p.push(new o(new a(100,100,c/4,200,"grey"),["You stare at the table.","The table stares back at you.","You're not sure what it wants."],0,0)),p.push(new o(new a(10,100,0,y/6,"grey"),["As you look through the window, your mind wanders.","Will it always be like this?"],350,0)),p.push(new o(new a(10,100,0,y/6+y/2,"grey"),["You realize this window is no different than any other.","The window seems offended."],320,0)),p.push(new o(new a(175,100,c/2,y-50,"grey"),["The couch's tongue wriggles between your fingers.","It beckons for you to stay."],0,-25)),p.push(new o(new a(100,50,c/2,y/2+y/6,"grey"),["Static fills the T.V.","How calming."],0,0)),p.push(k),setInterval(function(){w.fillStyle="#000",w.fillRect(0,0,c,y),p.forEach(function(e){e.act()})},12);