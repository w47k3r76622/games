!function(t){var e={};function i(h){if(e[h])return e[h].exports;var s=e[h]={i:h,l:!1,exports:{}};return t[h].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=t,i.c=e,i.d=function(t,e,h){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:h})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var h=Object.create(null);if(i.r(h),Object.defineProperty(h,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(h,s,function(e){return t[e]}.bind(null,s));return h},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);let h,s,o={};function n(t,...e){o[t]&&o[t].map(t=>t(...e))}function r(){return h}function a(){return s}function c(t){if(!(h=document.getElementById(t)||t||document.querySelector("canvas")))throw Error("You must provide a canvas element for the game");return(s=h.getContext("2d")).imageSmoothingEnabled=!1,n("init"),{canvas:h,context:s}}class l{constructor({spriteSheet:t,frames:e,frameRate:i,loop:h=!0}={}){this.spriteSheet=t,this.frames=e,this.frameRate=i,this.loop=h;let{width:s,height:o,margin:n=0}=t.frame;this.width=s,this.height=o,this.margin=n,this._f=0,this._a=0}clone(){return d(this)}reset(){this._f=0,this._a=0}update(t=1/60){if(this.loop||this._f!=this.frames.length-1)for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}render({x:t,y:e,width:i=this.width,height:h=this.height,context:s=a()}={}){let o=this.frames[this._f]/this.spriteSheet._f|0,n=this.frames[this._f]%this.spriteSheet._f|0;s.drawImage(this.spriteSheet.image,n*this.width+(2*n+1)*this.margin,o*this.height+(2*o+1)*this.margin,this.width,this.height,t,e,i,h)}}function d(t){return new l(t)}d.prototype=l.prototype,d.class=l;new WeakMap;const x=()=>{};function g(){let t=r();a().clearRect(0,0,t.width,t.height)}function u({fps:t=60,clearCanvas:e=!0,update:i,render:h}={}){if(!i||!h)throw Error("You must provide update() and render() functions");let s,o,r,a,c,l=0,d=1e3/t,u=1/t,w=e?g:x;function f(){if(o=requestAnimationFrame(f),r=performance.now(),a=r-s,s=r,!(a>1e3)){for(n("tick"),l+=a;l>=d;)c.update(u),l-=d;w(),c.render()}}return c={update:i,render:h,isStopped:!0,start(){s=performance.now(),this.isStopped=!1,requestAnimationFrame(f)},stop(){this.isStopped=!0,cancelAnimationFrame(o)},_frame:f,set _last(t){s=t}}}let w={},f={},y={13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"};function m(t){let e=y[t.which];f[e]=!0,w[e]&&w[e](t)}function p(t){f[y[t.which]]=!1}function v(){f={}}function S(){let t;for(t=0;t<26;t++)y[65+t]=(10+t).toString(36);for(t=0;t<10;t++)y[48+t]=""+t;window.addEventListener("keydown",m),window.addEventListener("keyup",p),window.addEventListener("blur",v)}function b(t,e){[].concat(t).map(t=>w[t]=e)}function M(t){return!!f[t]}class _{constructor({create:t,maxSize:e=1024}={}){let i;if(!t||!(i=t())||!(i.update&&i.init&&i.isAlive))throw Error("Must provide create() function which returns an object with init(), update(), and isAlive() functions");this._c=t,this._i=0,this.objects=[t()],this.size=1,this.maxSize=e}get(t={}){if(this.objects.length==this._i){if(this.size===this.maxSize)return;for(let t=0;t<this.size&&this.objects.length<this.maxSize;t++)this.objects.unshift(this._c());this.size=this.objects.length}let e=this.objects.shift();return e.init(t),this.objects.push(e),this._i++,e}getAliveObjects(){return this.objects.slice(this.objects.length-this._i)}clear(){this._i=this.objects.length=0,this.size=1,this.objects.push(this._c())}update(t){let e,i=this.size-1,h=Math.max(this.objects.length-this._i,0);for(;i>=h;)(e=this.objects[i]).update(t),e.isAlive()?i--:(this.objects=this.objects.splice(i,1).concat(this.objects),this._i--,h++)}render(){let t=Math.max(this.objects.length-this._i,0);for(let e=this.size-1;e>=t;e--)this.objects[e].render()}}function T(t){return new _(t)}function P(t,e){let i=[],h=e.x+e.width/2,s=e.y+e.height/2,o=t.y<s&&t.y+t.height>=e.y,n=t.y+t.height>=s&&t.y<e.y+e.height;return t.x<h&&t.x+t.width>=e.x&&(o&&i.push(0),n&&i.push(2)),t.x+t.width>=h&&t.x<e.x+e.width&&(o&&i.push(1),n&&i.push(3)),i}T.prototype=_.prototype,T.class=_;class k{constructor({maxDepth:t=3,maxObjects:e=25,bounds:i}={}){this.maxDepth=t,this.maxObjects=e;let h=r();this.bounds=i||{x:0,y:0,width:h.width,height:h.height},this._b=!1,this._d=0,this._o=[],this._s=[],this._p=null}clear(){this._s.map((function(t){t.clear()})),this._b=!1,this._o.length=0}get(t){let e,i,h=new Set;for(;this._s.length&&this._b;){for(e=P(t,this.bounds),i=0;i<e.length;i++)this._s[e[i]].get(t).forEach(t=>h.add(t));return Array.from(h)}return this._o.filter(e=>e!==t)}add(){let t,e,i,h;for(e=0;e<arguments.length;e++)if(i=arguments[e],Array.isArray(i))this.add.apply(this,i);else if(this._b)this._a(i);else if(this._o.push(i),this._o.length>this.maxObjects&&this._d<this.maxDepth){for(this._sp(),t=0;h=this._o[t];t++)this._a(h);this._o.length=0}}_a(t,e,i){for(e=P(t,this.bounds),i=0;i<e.length;i++)this._s[e[i]].add(t)}_sp(t,e,i){if(this._b=!0,!this._s.length)for(t=this.bounds.width/2|0,e=this.bounds.height/2|0,i=0;i<4;i++)this._s[i]=I({bounds:{x:this.bounds.x+(i%2==1?t:0),y:this.bounds.y+(i>=2?e:0),width:t,height:e},maxDepth:this.maxDepth,maxObjects:this.maxObjects}),this._s[i]._d=this._d+1,this._s[i]._p=this}}function I(t){return new k(t)}I.prototype=k.prototype,I.class=k;class C{constructor(t=0,e=0){this._x=t,this._y=e}add(t,e=1){return F(this.x+(t.x||0)*e,this.y+(t.y||0)*e,this)}clamp(t,e,i,h){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=h}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?Math.min(Math.max(this._a,t),this._d):t}set y(t){this._y=this._c?Math.min(Math.max(this._b,t),this._e):t}}function F(t,e,i={}){let h=new C(t,e);return i._c&&(h.clamp(i._a,i._b,i._d,i._e),h.x=t,h.y=e),h}F.prototype=C.prototype,F.class=C;class E{constructor(t){this.init(t)}init(t={}){let{x:e,y:i,dx:h,dy:s,ddx:o,ddy:n,width:r,height:c,image:l}=t;this.position=F(e,i),this.velocity=F(h,s),this.acceleration=F(o,n),this._fx=this._fy=1,this.width=this.height=this.rotation=0,this.ttl=1/0,this.anchor={x:0,y:0},this.context=a();for(let e in t)this[e]=t[e];l&&(this.width=void 0!==r?r:l.width,this.height=void 0!==c?c:l.height),this.sx=0,this.sy=0}get x(){return this.position.x}get y(){return this.position.y}get dx(){return this.velocity.x}get dy(){return this.velocity.y}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}get animations(){return this._a}get viewX(){return this.x-this.sx}get viewY(){return this.y-this.sy}get width(){return this._w}get height(){return this._h}set x(t){this.position.x=t}set y(t){this.position.y=t}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}set animations(t){let e,i;for(e in this._a={},t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}set viewX(t){}set viewY(t){}set width(t){let e=t<0?-1:1;this._fx=e,this._w=t*e}set height(t){let e=t<0?-1:1;this._fy=e,this._h=t*e}isAlive(){return this.ttl>0}collidesWith(t){if(this.rotation||t.rotation)return null;let e=this.x-this.width*this.anchor.x,i=this.y-this.height*this.anchor.y,h=t.x,s=t.y;return t.anchor&&(h-=t.width*t.anchor.x,s-=t.height*t.anchor.y),e<h+t.width&&e+this.width>h&&i<s+t.height&&i+this.height>s}update(t){this.advance(t)}render(){this.draw()}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){this.velocity=this.velocity.add(this.acceleration,t),this.position=this.position.add(this.velocity,t),this.ttl--,this.currentAnimation&&this.currentAnimation.update(t)}draw(){let t=-this.width*this.anchor.x,e=-this.height*this.anchor.y;if(this.context.save(),this.context.translate(this.viewX,this.viewY),this.rotation&&this.context.rotate(this.rotation),-1==this._fx||-1==this._fy){let i=this.width/2+t,h=this.height/2+e;this.context.translate(i,h),this.context.scale(this._fx,this._fy),this.context.translate(-i,-h)}this.image?this.context.drawImage(this.image,0,0,this.image.width,this.image.height,t,e,this.width,this.height):this.currentAnimation?this.currentAnimation.render({x:t,y:e,width:this.width,height:this.height,context:this.context}):(this.context.fillStyle=this.color,this.context.fillRect(t,e,this.width,this.height)),this.context.restore()}}function A(t){return new E(t)}function j(t){if(+t===t)return t;let e=[],i=t.split(".."),h=+i[0],s=+i[1],o=h;if(h<s)for(;o<=s;o++)e.push(o);else for(;o>=s;o--)e.push(o);return e}A.prototype=E.prototype,A.class=E;class B{constructor({image:t,frameWidth:e,frameHeight:i,frameMargin:h,animations:s}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:e,height:i,margin:h},this._f=t.width/e|0,this.createAnimations(s)}createAnimations(t){let e,i;for(i in t){let{frames:h,frameRate:s,loop:o}=t[i];if(e=[],void 0===h)throw Error("Animation "+i+" must provide a frames property");[].concat(h).map(t=>{e=e.concat(j(t))}),this.animations[i]=d({spriteSheet:this,frames:e,frameRate:s,loop:o})}}}function R(t){return new B(t)}R.prototype=B.prototype,R.class=B;var D=new class{constructor(){this.gameStart=!1,this.backStones=3,this.core=c(),this.canvas=this.core.canvas,this.score=0,this.backgroundSpeed=4,this.highestScore=0,this.colors=["#DCE775","#4DD0E1","#B3E5FC","#5C6BC0","#CE93D8","#ef9a9a","#F06292","#FFF59D","#FFB74D","#FFAB91"],this.stoneShadow=[5,15,25],this.spawnObstacle=!1,this.rewindMode=!1}};class W{constructor(){this.rewind_length=100,this.history_length=50,this.rewind=[],this.history=[]}back(){let t=this.rewind.pop();return this.history_length<=this.history.length&&this.history.shift(),this.history.push(t),{x:t.x,y:t.y}}add(t,e){this.history=[],this.rewind_length<=this.rewind.length&&this.rewind.shift(),this.rewind.push({x:t,y:e})}doneRewind(){return this.rewind.length<=0}}var O={movingThemes:{asteroid1:function(){this.context.save(),this.context.translate(this.viewX,this.viewY),D.gameStart&&z(this),this.context.rotate(this.rotation),this.context.beginPath(),this.context.fillStyle="darkgrey",this.context.lineTo(-24,-11),this.context.lineTo(-8,-31),this.context.lineTo(14,-25),this.context.lineTo(36,3),this.context.lineTo(14,23),this.context.lineTo(-8,17),this.context.lineTo(-30,3),this.context.fill(),this.context.beginPath(),this.context.strokeStyle="grey",this.context.lineCap="butt",this.context.lineWidth=3,this.context.arc(-2,-12,5,0,1.8*Math.PI),this.context.stroke(),this.context.beginPath(),this.context.lineCap="butt",this.context.strokeStyle="grey",this.context.lineWidth=3,this.context.arc(0,8,3,0,1.5*Math.PI),this.context.stroke(),this.context.beginPath(),this.context.lineCap="butt",this.context.strokeStyle="grey",this.context.lineWidth=3,this.context.arc(22,5,2,0,Math.PI),this.context.stroke(),this.context.restore()},asteroid2:function(){this.context.save(),this.context.translate(this.viewX,this.viewY),D.gameStart&&z(this),this.context.rotate(this.rotation),this.context.lineWidth=0,this.context.beginPath(),this.context.fillStyle="darkgrey",this.context.moveTo(-25,-10),this.context.lineTo(-13,-32),this.context.lineTo(19,-32),this.context.lineTo(41,-10),this.context.lineTo(30,20),this.context.lineTo(19,23),this.context.lineTo(-9,38),this.context.arc(-26,30,8,.5*Math.PI,.7*Math.PI),this.context.lineTo(-43,6),this.context.arc(-13,-32,4,0,Math.PI),this.context.fill(),this.context.beginPath(),this.context.lineCap="butt",this.context.strokeStyle="grey",this.context.lineWidth=3,this.context.arc(-9,5,5,0,1.8*Math.PI),this.context.stroke(),this.context.beginPath(),this.context.lineCap="butt",this.context.strokeStyle="grey",this.context.lineWidth=3,this.context.arc(-19,15,6,0,1.5*Math.PI),this.context.stroke(),this.context.beginPath(),this.context.fillStyle="grey",this.context.arc(17,15,10,0,1.5*Math.PI),this.context.fill(),this.context.beginPath(),this.context.lineCap="butt",this.context.strokeStyle="grey",this.context.lineWidth=3,this.context.arc(27,-8,2,0,Math.PI),this.context.stroke(),this.context.lineWidth=1,this.context.restore()},asteroid3:function(){this.context.save(),this.context.translate(this.viewX,this.viewY),D.gameStart&&z(this),this.context.rotate(this.rotation),this.context.beginPath(),this.context.fillStyle="darkgrey",this.context.moveTo(-40,5),this.context.lineTo(-34,-11),this.context.lineTo(-38,-13),this.context.lineTo(-8,-22),this.context.lineTo(20,-19),this.context.lineTo(34,-24),this.context.lineTo(39,-22),this.context.lineTo(42,5),this.context.lineTo(36,27),this.context.lineTo(6,21),this.context.lineTo(-16,21),this.context.arc(-16,5,14,0,.7*Math.PI),this.context.lineTo(-38,21),this.context.lineTo(-34,19),this.context.lineTo(-40,5),this.context.fill(),this.context.beginPath(),this.context.lineCap="butt",this.context.strokeStyle="grey",this.context.lineWidth=3,this.context.arc(-22,7,6,.3*Math.PI,1.4*Math.PI),this.context.stroke(),this.context.beginPath(),this.context.fillStyle="grey",this.context.arc(8,1,6,.2*Math.PI,1.7*Math.PI),this.context.fill(),this.context.beginPath(),this.context.fillStyle="grey",this.context.arc(-4,-9,6,.7*Math.PI,2*Math.PI),this.context.fill(),this.context.beginPath(),this.context.lineCap="butt",this.context.strokeStyle="grey",this.context.lineWidth=3,this.context.arc(32,15,6,Math.PI,1.75*Math.PI),this.context.stroke(),this.context.restore()}},shooting_star:function(){this.context.save(),this.context.translate(this.viewX,this.viewY),D.gameStart&&z(this),this.context.rotate(this.rotation),this.context.lineWidth=0,(t=this.context.createLinearGradient(0,0,200,0)).addColorStop(0,this.color),t.addColorStop(1,"white"),this.context.beginPath(),this.context.fillStyle=t,this.context.moveTo(-120,0),this.context.lineTo(6,18),this.context.lineTo(6,-18),this.context.fill();var t=this.context.createRadialGradient(0,0,10,0,0,40);t.addColorStop(0,this.color),t.addColorStop(1,"white"),this.context.beginPath(),this.context.strokeStyle=this.color,this.context.fillStyle=t,this.context.arc(0,0,18,0,2*Math.PI),this.context.fill(),this.context.lineWidth=1,this.context.restore()},stationaryThemes:{planet1:function(){this.context.save(),this.context.translate(this.viewX,this.viewY),D.gameStart&&z(this),this.context.rotate(this.rotation);var t=this.context.createRadialGradient(10,0,15,0,0,100);t.addColorStop(0,this.otherColor),t.addColorStop(1,this.color),this.context.beginPath(),this.context.fillStyle=t,this.context.arc(0,0,.6*this.width,0,2*Math.PI),this.context.fill(),this.context.restore()},planet2:function(){this.context.save(),this.context.translate(this.viewX,this.viewY),this.context.rotate(this.rotation),D.gameStart&&z(this);var t=this.context.createRadialGradient(10,0,15,0,0,100);t.addColorStop(0,this.otherColor),t.addColorStop(1,this.color),this.context.beginPath(),this.context.fillStyle=t,this.context.arc(0,0,.6*this.width,0,2*Math.PI),this.context.fill();let e=new Path2D;e.moveTo(-.6*this.width+5,-10),e.bezierCurveTo(-.6*this.width*3.5,25,.6*this.width*3.5,25,.6*this.width-5,-10),e.moveTo(.6*this.width-5,-10),e.bezierCurveTo(.6*this.width*2.3,15,-.6*this.width*2.3,15,-.6*this.width+5,-10),e.closePath(),this.context.fill(e),this.context.restore()}},backstone:function(){this.context.save(),this.context.translate(this.viewX,this.viewY),D.gameStart&&z(this);let t=this.context.createLinearGradient(-12,0,12,0);t.addColorStop(0,"#D1C4E9"),t.addColorStop(.5,"#7E57C2"),t.addColorStop(1,"#3949AB"),this.context.lineWidth=0,this.context.beginPath(),this.context.moveTo(-12,-3),this.context.quadraticCurveTo(-1,-7,0,-12),this.context.lineTo(12,-3),this.context.lineTo(0,12),this.context.lineTo(-12,-3),this.context.fillStyle=t,this.context.shadowColor="white",this.context.shadowBlur=D.stoneShadow[Math.floor(Math.random()*D.stoneShadow.length)],this.context.fill(),this.context.lineWidth=1,this.context.restore()},meteor_shower:function(){this.context.save(),this.context.translate(this.viewX,this.viewY),D.gameStart&&z(this),this.context.beginPath(),this.context.arc(0,0,47,.3*Math.PI,.7*Math.PI),this.context.bezierCurveTo(-45,15,-30,0,-(8*Math.random()+26),-15),this.context.lineTo(-20,5),this.context.lineTo(-(8*Math.random()+21),-35),this.context.lineTo(-10,-15),this.context.lineTo(0,-40),this.context.lineTo(10,-15),this.context.lineTo(8*Math.random()+21,-35),this.context.lineTo(20,5);var t=8*Math.random()+26;this.context.lineTo(t,-15),this.context.bezierCurveTo(t,0,45,15,25,41),this.context.fillStyle="#FFD54F",this.context.fill(),this.context.lineCap="butt",this.context.lineWidth=1,this.context.beginPath(),this.context.arc(0,25,18,0,2*Math.PI),this.context.fillStyle="#A1887F",this.context.fill(),this.context.beginPath(),this.context.arc(-10,25,3,0,1.2*Math.PI),this.context.strokeStyle="#5D4037",this.context.stroke(),this.context.beginPath(),this.context.arc(10,30,4,0,.8*Math.PI),this.context.strokeStyle="#5D4037",this.context.stroke(),this.context.beginPath(),this.context.arc(5,18,3,0,1.8*Math.PI),this.context.strokeStyle="#5D4037",this.context.stroke(),this.context.beginPath(),this.context.arc(0,21,22,1.7*Math.PI,1.3*Math.PI),this.context.quadraticCurveTo(-5,5,0,-15),this.context.quadraticCurveTo(5,3,13,3),this.context.fillStyle="rgba(255,138,101,0.5)",this.context.fill(),this.context.restore()}};function z(t){if(D.rewindMode)for(let e=0;e<t.rewind.history.length;e++){let i=e/t.rewind.history.length;t.context.fillStyle=`rgba(255,0,0,${i/5})`,t.context.beginPath(),t.context.arc(t.rewind.history[e].x-t.viewX,t.rewind.history[e].y-t.viewY,t.width/2*i,0,2*Math.PI),t.context.fill()}}var q=class{constructor(){this.meteors=[],this.alive=!1,this.spawn=!1,this.spawnStopAtScore=70,this.startShowerAtScore=75,this.stopShowerAtScore=95,this.spawnStartAtScore=99,this.meteor_score_check=0,this.showWarning=!1}addMeteor(){Math.random()<=.16&&this.meteors.push(this.getMeteor())}getMeteor(){return A({width:60,height:60,x:Math.random()*D.canvas.width,y:-60-17*D.canvas.height/4,dx:0,dy:17*D.backgroundSpeed/4,anchor:{x:.5,y:.5},render:O.meteor_shower,rewind:new W,update:function(){if(D.rewindMode){if(!this.rewind.doneRewind()){let t=this.rewind.back();this.x=t.x,this.y=t.y}}else this.rewind.add(this.x,this.y);this.advance()}})}update(t,e,i){this.spawn&&!D.rewindMode&&this.addMeteor();let h=this.meteors;h.forEach((function(s,o){s.y>2*D.canvas.height&&h.splice(o,1),s.update(),s.collidesWith(t)&&(t.destroy=!0,e.stop(),i.start())}))}render(){this.showWarning?document.getElementById("warning").style.display="block":this.alive&&this.meteors.forEach((function(t){t.render()}))}stopMeteorShower(){this.spawn=!1,setTimeout(function(){this.meteors=[],this.alive=!1}.bind(this),4500)}startMeteorShower(){this.alive=!0,this.spawn=!0}commence(t,e,i){this.meteor_score_check=D.score-100*Math.floor(D.score/100),this.meteor_score_check>=this.spawnStopAtScore&&this.meteor_score_check<=this.startShowerAtScore&&D.spawnObstacle&&(D.spawnObstacle=!1,this.showWarning=!0,setTimeout(function(){this.showWarning=!1,document.getElementById("warning").style.display="none"}.bind(this),5e3)),this.meteor_score_check>this.startShowerAtScore&&this.meteor_score_check<=this.stopShowerAtScore&&!this.alive&&this.startMeteorShower(),this.alive&&this.update(t,e,i),this.meteor_score_check>this.stopShowerAtScore&&this.alive&&this.stopMeteorShower(),this.meteor_score_check>=this.spawnStartAtScore&&!this.alive&&(D.spawnObstacle=!0)}};function Y(){this.x=new AudioContext,this.r=Date.now(),this.buffer=0,this.volume=.5,this.randomness=.1}Y.prototype.z=function(t,e){var i,h=this.Generate(t);for(i in e)h[i]=e[i];return this.Z(h.volume,h.randomness,h.frequency,h.length,h.attack,h.slide,h.noise,h.modulation,h.modulationPhase)},Y.prototype.Z=function(t,e,i,h,s,o,n,r,a){h=void 0===h?1:h,s=void 0===s?.1:s,o=void 0===o?0:o,n=void 0===n?0:n,r=void 0===r?0:r,a=void 0===a?0:a,t*=this.volume,i*=2*Math.PI/44100,i*=1+e*(2*this.R()-1),o*=1e3*Math.PI/Math.pow(44100,2),s*=0|(h=0<h?44100*(10<h?10:h)|0:1),r*=2*Math.PI/44100,a*=Math.PI,e=[];for(var c=0,l=0,d=0;d<h;++d)e[d]=t*Math.cos(c*i*Math.cos(l*r+a))*(d<s?d/s:1-(d-s)/(h-s)),c+=1+n*(2*this.R()-1),l+=1+n*(2*this.R()-1),i+=o;return this.buffer=e,t=this.x.createBuffer(1,e.length,44100),i=this.x.createBufferSource(),t.getChannelData(0).set(e),i.buffer=t,i.connect(this.x.destination),i.start(),i},Y.prototype.Generate=function(t){var e=this.r;this.r=t;for(var i=9;i--;)this.R();return(i={}).seed=t,i.volume=1,i.randomness=t?this.randomness:0,i.frequency=t?2e3*Math.pow(this.R(),2)|0:220,i.slide=t?parseFloat((10*Math.pow(this.R(),3)).toFixed(1)):0,i.length=t?parseFloat((.1+this.R()).toFixed(1)):1,i.attack=t?parseFloat(this.R().toFixed(2)):.1,i.noise=t?parseFloat((5*Math.pow(this.R(),3)).toFixed(1)):0,i.modulation=t?parseFloat((99*Math.pow(this.R(),5)).toFixed(1)):0,i.modulationPhase=t?parseFloat(this.R().toFixed(2)):0,this.r=e,i},Y.prototype.Note=function(t,e){return t*Math.pow(2,e/12)},Y.prototype.R=function(){return this.r^=this.r<<13,this.r^=this.r>>7,this.r^=this.r<<17,Math.abs(this.r)%1e9/1e9};var G=new Y;let X=D.canvas;function L(t){return{x:0,y:-X.height,dx:0,dy:D.backgroundSpeed,anchor:{x:0,y:0},width:X.width,height:X.height,color:"black",rewind:new W,update:function(){if(D.rewindMode)if(this.rewind.doneRewind())D.rewindMode=!1,D.gameStart&&setTimeout((function(){D.spawnObstacle=!0}),6e3);else{let t=this.rewind.back();this.x=t.x,this.y=t.y}else M("down")&&D.backStones>0&&(D.gameStart&&D.backStones--,D.rewindMode=!0,D.spawnObstacle=!1,G.z(32,{length:2})),this.advance(),this.rewind.add(this.x,this.y)},render:function(){this.draw();for(let e=0;e<t.length;e++)this.context.beginPath(),this.context.fillStyle="white",this.context.arc(t[e].x*X.width+this.x,t[e].y*X.width+this.y,t[e].size*X.width/500,0,2*Math.PI),this.context.fill()}}}let H=D.canvas;function J(){let t=H.width/60,e=H.width/40;return{x:H.width/2,y:4*H.height/5,speed:6,anchor:{x:.5,y:.5},fillStyle:"yellow",width:t,height:e,color:"blue",destroy:!1,circles:[[-.1*t,-.1*e,.22*t],[-.1*t,.05*e,.24*t],[.2*t,-.13*e,.11*t],[.3*t,.03*e,.17*t],[.15*t,.2*e,.14*t]],gameOver:A({width:200,height:100,x:D.canvas.width/2-100,y:D.canvas.width/2-500,dx:0,dy:D.backgroundSpeed,render:function(){this.context.lineCap="round",this.context.lineJoin="round",this.context.lineWidth=15;let t=this.context.createLinearGradient(0,0,D.canvas.width,0);t.addColorStop("0"," magenta"),t.addColorStop("0.5","blue"),t.addColorStop("1.0","red"),this.context.strokeStyle=t,this.context.fillStyle=t,this.context.font=D.canvas.width/40+"px Verdana";let e=.5*D.canvas.width,i=.15*D.canvas.height;this.context.fillText("GAME OVER!",D.canvas.width/2-e/2+50,D.canvas.height/2+5),this.context.rect(D.canvas.width/2-e/2,D.canvas.height/2-i/2,e,i),this.context.stroke()}}),rewind:new W,update:function(){if(D.rewindMode){let t=this.rewind.back();this.x=t.x,this.y=t.y}else M("left")?this.x-=this.speed:M("right")&&(this.x+=this.speed),this.rewind.add(this.x,this.y),this.advance()},draw:function(){if(this.context.save(),this.context.translate(this.x,this.y),D.rewindMode)for(let t=0;t<this.rewind.history.length;t++){let e=t/this.rewind.history.length;this.context.fillStyle=`rgba(255,0,0,${e/5})`,this.context.beginPath(),this.context.arc(this.rewind.history[t].x-this.x,this.rewind.history[t].y-this.y,this.width/2*e,0,2*Math.PI),this.context.fill()}this.context.beginPath(),this.context.lineJoin="round",this.context.moveTo(this.width/2,-.2*this.height),this.context.lineTo(-this.width/2,-.2*this.height),this.context.lineTo(0,-.5*this.height),this.context.lineTo(this.width/2,-.2*this.height),this.context.fillStyle="#455A64",this.context.fill(),this.context.beginPath(),this.context.moveTo(this.width/2,-.2*this.height),this.context.quadraticCurveTo(this.width/2+.1*this.width,0,this.width/2,.45*this.height),this.context.lineTo(-this.width/2,.45*this.height),this.context.quadraticCurveTo(-this.width/2-.1*this.width,0,-this.width/2,-.2*this.height),this.context.fillStyle="#EEEEEE",this.context.fill(),this.context.beginPath(),this.context.arc(0,-.00625*this.height,.15*this.height,0,2*Math.PI),this.context.fillStyle="#455A64",this.context.fill(),this.context.beginPath(),this.context.arc(0,-.00625*this.height,.1*this.height,0,2*Math.PI),this.context.fillStyle="#80DEEA",this.context.fill(),this.context.beginPath(),this.context.moveTo(1.15*this.width/2,.32*this.height),this.context.lineTo(-1.15*this.width/2,.32*this.height),this.context.lineWidth=.07*this.height,this.context.strokeStyle="#455A64",this.context.stroke(),this.context.beginPath(),this.context.moveTo(1.1*this.width/2,.2*this.height),this.context.lineTo(1.5*this.width/2,.42*this.height),this.context.lineTo(1.5*this.width/2,.72*this.height),this.context.lineTo(1.3*this.width/2,.47*this.height),this.context.lineTo(1.1*this.width/2,.4*this.height),this.context.fillStyle="#ef5350",this.context.fill(),this.context.beginPath(),this.context.moveTo(-1.1*this.width/2,.2*this.height),this.context.lineTo(-1.5*this.width/2,.42*this.height),this.context.lineTo(-1.5*this.width/2,.72*this.height),this.context.lineTo(-1.3*this.width/2,.47*this.height),this.context.lineTo(-1.1*this.width/2,.4*this.height),this.context.fillStyle="#ef5350",this.context.fill();var t=[.6*this.height,.7*this.height,.7*this.height,.75*this.height],e=t[Math.floor(Math.random()*t.length)];this.context.beginPath(),this.context.moveTo(-.7*this.width/2,.45*this.height),this.context.quadraticCurveTo(-.65*this.width/2,.6*this.height,0,e),this.context.quadraticCurveTo(.65*this.width/2,.6*this.height,.7*this.width/2,.45*this.height),this.context.fillStyle="#F57C00",this.context.fill(),this.context.beginPath(),this.context.moveTo(-.6*this.width/2,.45*this.height),this.context.quadraticCurveTo(-.55*this.width/2,.55*this.height,0,.9*e),this.context.quadraticCurveTo(.55*this.width/2,.55*this.height,.6*this.width/2,.45*this.height),this.context.fillStyle="#FFF176",this.context.fill(),this.context.restore()},render:function(){if(this.destroy){this.context.save(),this.context.translate(this.x,this.y);var t=this.context.createRadialGradient(0,0,1,0,0,2);t.addColorStop(0,"#FFE082"),t.addColorStop(1,"#FFF9C4"),this.context.fillStyle=t,this.context.shadowColor="#FFD54F",this.context.shadowBlur=5,this.circles.forEach(function(t){t[0]*=1.05,t[1]*=1.05,t[2]*=.95,this.context.beginPath(),this.context.arc(t[0],t[1],t[2],0,2*Math.PI),this.context.fill()}.bind(this)),this.context.restore()}else this.draw()}}}class V extends A.class{constructor(t){if(super(),this.isShootingStar=!1,this.width=10*Math.random()+5+50,this.height=10*Math.random()+5+35,this.rewind=new W,this.collidesWith=Z,this.anchor={x:.5,y:.5},t)if(this.width=15*Math.random()+50,this.height=15*Math.random()+50,this.x=Math.floor(Math.random()*D.canvas.width),this.y=-this.height-D.canvas.height,Math.random()<=.3)this.width=12,this.height=12,this.theme=O.backstone,this.collider="backstone";else{this.width=1.5*this.width,this.height=1.5*this.height;var e=Math.floor(Math.random()*D.colors.length);if(this.color=D.colors[e],Math.random()<=.3)this.otherColor="white";else{var i=D.colors.slice();i.splice(e,1),this.otherColor=i[Math.floor(Math.random()*i.length)]}h=Object.keys(O.stationaryThemes);this.theme=O.stationaryThemes[h[Math.floor(Math.random()*h.length)]],this.collider="planet"}else if(this.x=Math.floor(Math.random()*(D.canvas.width+40)-40),this.x>=-10&&this.x<0||this.x>D.canvas.width?this.y=Math.floor(Math.random()*(.9*D.canvas.height+10)-10):this.y=-this.height,this.color=D.colors[Math.floor(Math.random()*D.colors.length)],Math.random()<=.1)this.width=50,this.height=50,this.theme=O.shooting_star,this.isShootingStar=!0,this.collider="shooting_star";else{var h,s=(h=Object.keys(O.movingThemes))[Math.floor(Math.random()*h.length)];this.theme=O.movingThemes[s],this.collider="asteroid","asteroid3"==s&&(this.width+=20)}this.dx=0,this.dy=D.backgroundSpeed,this.isShootingStar||(this.rotation=4.71239*Math.random())}draw(){this.theme()}update(){if(D.rewindMode){if(!this.rewind.doneRewind()){let t=this.rewind.back();this.x=t.x,this.y=t.y}}else this.rewind.add(this.x,this.y);this.advance()}}function Z(t){let e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)<=this.width/2+t.width/2}class ${constructor(){this.xSFast=.008*D.canvas.width*D.backgroundSpeed/4,this.xFast=.007*D.canvas.width*D.backgroundSpeed/4,this.xMed=67e-5*D.canvas.width*D.backgroundSpeed/4,this.xSlow=49e-5*D.canvas.width*D.backgroundSpeed/4,this.yFast=.013*D.canvas.height*D.backgroundSpeed/4,this.yMed=.0084*D.canvas.height*D.backgroundSpeed/4,this.ySlow=.009*D.canvas.height*D.backgroundSpeed/4,this.yMin=.0065*D.canvas.height*D.backgroundSpeed/4}create_obstacle(t,e){var i=!1;Math.random()>=.801&&(i=!0);var h=new V(i),s=Math.atan((h.x-t)/(e-h.y));return h.y-=D.canvas.height,i||(s<-.785398&&s>=-1.5708?(h.x=h.x-D.canvas.width,h.dx=Math.random()*(this.xSFast-this.xFast)+this.xFast,h.dy=Math.random()*(this.ySlow-this.yMin)+this.yMin):s>=-.785398&&s<=0?(h.dx=Math.random()*(this.xMed-this.xSlow)+this.xSlow,h.dy=Math.random()*(this.yFast-this.yMed)+this.yMed):s>0&&s<=.785398?(h.dx=Math.random()*(-this.xSlow-this.xMed)-this.xMed,h.dy=Math.random()*(this.yFast-this.yMed)+this.yMed):s>.785398&&s<=1.5708&&(h.x=h.x+D.canvas.width,h.dx=-(Math.random()*(this.xSFast-this.xFast)+this.xFast),h.dy=Math.random()*(this.yMed-this.ySlow)+this.ySlow)),h.isShootingStar&&(h.dx=2*h.dx,h.dy=2*h.dy,h.y-=D.canvas.height,h.rotation=Math.atan(Math.abs(h.dy)/Math.abs(h.dx)),s>0&&(h.rotation=Math.PI-h.rotation)),h}}var N={getStarPositions:function(){let t=[];for(let e=0;e<20;e++)t.push({x:Math.random(),y:Math.random(),size:2*Math.random()});return t}};let K,Q,U,tt,et,it,ht,st=0,ot=D.canvas;function nt(t){D.gameStart||(0==st?(document.getElementById("story").style.display="none",document.getElementById("startGame").innerHTML='<p>Press "Enter/Spacebar"</p>Click To Begin',st=1):1==st?(document.getElementById("menu").style.display="none",D.spawnObstacle=!0,D.gameStart=!0,st=2):2==st&&(document.getElementById("menu").style.display="none",D.spawnObstacle=!0,D.gameStart=!0,rt.stop(),wt(),at.start()))}document.getElementById("startGame").onclick=nt,ot.width=4*window.innerWidth/5,ot.height=window.innerHeight,document.getElementById("menu").style.width=ot.width+"px",b(["left","right","up","down"],(function(t){t.preventDefault()})),b(["enter","space"],nt);let rt=u({update:function(t){K.update(),document.getElementById("menu").style.display="block",document.getElementById("story").style.display="none",D.highestScore=D.score>D.highestScore?parseInt(D.score):parseInt(D.highestScore),document.getElementById("highestScore").innerHTML=D.highestScore,D.spawnObstacle=!1,D.gameStart=!1},render:function(){K.render()}}),at=u({update:function(t){et.update(),it.update(),ht.update(),et.y<=0&&et.y>-4&&(ht.y=-ot.height),it.y<=0&&it.y>-4&&(et.y=-ot.height),ht.y<=0&&ht.y>-4&&(it.y=-ot.height),K.update(),D.gameStart&&(D.score=D.score+t),document.getElementById("score").innerHTML=parseInt(D.score),document.getElementById("backStones").innerHTML=parseInt(D.backStones),U.forEach((function(t,e){t.update(),t.collidesWith(K)&&("backstone"==t.collider?(D.backStones++,U.splice(e,1),G.z(3242,{length:.2})):(G.z(53966),K.destroy=!0,at.stop(),rt.start()))})),tt.commence(K,at,rt),D.spawnObstacle&&!tt.alive&&Math.random()<=.039&&U.push(Q.create_obstacle(K.x,K.y))},render:function(){et.render(),it.render(),ht.render(),K.render(),U.forEach((function(t,e){t.y>2*D.canvas.height&&U.splice(e,1),t.render()})),tt.render(),1==st&&(lt.render(),dt.render(),xt.render(),gt.render(),ut.render())}});let ct=D.canvas.width>480?4:D.canvas.width>240?2:1,lt=A({x:.1*D.canvas.width,y:.35*D.canvas.height,theme:O.movingThemes.asteroid1,render:function(){this.context.font="2em cursive",this.context.fillStyle="#F5DEB3",this.context.fillText("Avoid these obstacles",this.x-40,this.y-65),this.theme(),this.context.font="14px cursive",this.context.fillStyle="#F5DEB3",this.context.fillText("Asteroids",this.x-15,this.y+65)}}),dt=A({x:.4*D.canvas.width,y:1==ct?.55*D.canvas.height:.35*D.canvas.height,color:"#64B5F6",theme:O.shooting_star,render:function(){this.theme(),this.context.font="14px cursive",this.context.fillStyle="#F5DEB3",this.context.fillText("Shoooting Stars",this.x-65,this.y+65)}}),xt=A({x:.6*D.canvas.width,y:1==ct?.75*D.canvas.height:2==ct?.65*D.canvas.height:.35*D.canvas.height,color:"#EC407A",otherColor:"#E1BEE7",width:75,height:75,theme:O.stationaryThemes.planet1,render:function(){this.theme(),this.context.font="14px cursive",this.context.fillStyle="#F5DEB3",this.context.fillText("Planets",this.x-18,this.y+65)}}),gt=A({x:.8*D.canvas.width,y:1==ct?.75*D.canvas.height:2==ct?.65*D.canvas.height:.35*D.canvas.height,theme:O.meteor_shower,render:function(){this.theme(),this.context.font="14px cursive",this.context.fillStyle="#F5DEB3",this.context.fillText("Meteors",this.x-18,this.y+65)}}),ut=A({x:.1*D.canvas.width,y:.6*D.canvas.height,width:40,height:40,theme:O.backstone,render:function(){this.context.font="2em cursive",this.context.fillStyle="#F5DEB3",this.context.fillText("Try to collect as many BackStones as you can",this.x-40,this.y-40),this.theme()}});function wt(){et=A(L(N.getStarPositions())),it=A(L(N.getStarPositions())),ht=A(L(N.getStarPositions())),it.y=0,ht.y=ot.height,(K=A(new J)).position.clamp(K.width,0,ot.width-K.width,ot.height-K.height),Q=new $,U=[],tt=new q,D.score=0,D.backStones=3}at.start(),S(),wt()}]);