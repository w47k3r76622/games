'use strict';(function(){function x(a,...b){n[a]&&n[a].map(a=>a(...b))}function I(a){let b=g[a.which];h[b]=!0;if(B[b])B[b](a)}function J(a){h[g[a.which]]=!1}function K(){h={}}function L(){let a=p;w.clearRect(0,0,a.width,a.height)}function M({fps:a=60,clearCanvas:b=!0,update:c,render:d}={}){function e(){p=requestAnimationFrame(e);m=performance.now();l=m-g;g=m;if(!(1E3<l)){x("tick");for(r+=l;r>=f;)k.update(h),r-=f;n();k.render()}}if(!c||!d)throw Error("You must provide update() and render() functions");
let r=0,f=1E3/a,h=1/a,n=b?L:N,g,p,m,l,k;return k={update:c,render:d,isStopped:!0,start(){g=performance.now();this.isStopped=!1;requestAnimationFrame(e)},stop(){this.isStopped=!0;cancelAnimationFrame(p)},_frame:e,set _last(a){g=a}}}function m(a,b,c={}){let d=new y(a,b);c._c&&(d.clamp(c._a,c._b,c._d,c._e),d.x=a,d.y=b);return d}function q(a){return new z(a)}function O(a,b){void 0===a&&(a=0);void 0===b&&(b=0);return q({x:a,y:b,type:"platform",width:48,height:32,color:"rgba(17, 17, 17, 1)",exists:!0,eventEmitted:!1,
displayTime:Date.now(),update:function(){var a=Date.now()-this.displayTime;if(this.exists=2500>a)this.color="rgba(17, 17, 17, "+(100-100*a/2500)/100+")";this.exists||this.eventEmitted||f.emit("MAGIC_PLATFORM_GONE")}})}function P(a,b){var c=null,d=!0;return function(){var e=this,r=function(){a.apply(e,arguments);c=null};d&&(d=!1,r());c||(c=setTimeout(function(){d=!0},b))}}function Q(a){return q({type:"player",x:0,y:0,color:"salmon",width:32,height:32,isOnFloor:!1,isJumping:!1,isRewinding:!1,totalAmountOfMagicPlatforms:0,
canRewind:function(){return this.isJumping},rewindPosition:null,rewinder:new R(this),jumpStartTime:0,jumpKeyPressed:!1,init:function(){var b=this;f.on("MAGIC_PLATFORM_COLLECTED",function(){b.totalAmountOfMagicPlatforms++;a.game.ui.availablePlatforms=b.totalAmountOfMagicPlatforms})},moveRight:function(){this.dx=5},moveLeft:function(){this.dx=-5},jump:function(){this.isOnFloor&&!this.isJumping&&(this.jumpStartTime=Date.now(),this.isOnFloor=!1,this.isJumping=!0,this.dy=-5,this.rewinder.clear())},rewind:P(function(){this.rewinder.hasSteps&&
!this.isRewinding&&(this.isRewinding=!0,this.rewindPosition=this.rewinder.lastStep.position)},1E3),createMagicPlatform:function(){this.rewindPosition&&a.canSpawnNewMagicPlatform&&(a.addMagicPlatform(O(this.rewindPosition.x,this.rewindPosition.y+this.height)),this.rewindPosition=null)},update:function(a){if(this.isRewinding){this.rewinder.previousStep;if(a=this.rewinder.previousStep){this.x=a.position.x;this.y=a.position.y;this.advance();return}this.createMagicPlatform();this.isRewinding=!1}h.space||
h.up?(this.jumpKeyPressed=!0,this.jump()):this.jumpKeyPressed=!1;h.right&&this.moveRight();h.left&&this.moveLeft();if(!h.left&&!h.right||h.left&&h.right)this.dx=0;h.shift&&!this.isOnFloor&&this.rewind();this.isJumping&&this.jumpKeyPressed&&80>Date.now()-this.jumpStartTime&&(this.dy-=.7);this.canRewind()&&this.rewinder.add(this.x,this.y);this.advance();this.isOnFloor&&this.rewinder.clear()}})}function S(a){var b=a.player;b.isOnFloor=!1;for(var c=0,d=a.collisionElements;c<d.length;c++)if(a=d[c],a.collidesWith(b)){c=
b.y>a.y;d=(a.x+a.width===b.x||a.x+a.width-10<b.x)&&(b.y>a.y||b.y+b.height<a.y+a.y)&&0!==b.dx;if((a.x===b.x+b.width||a.x>b.x+b.width-10)&&(b.y>a.y||b.y+b.height<a.y+a.y)&&0!==b.dx){b.x=a.x-b.width;b.dx*=-1;break}if(d){b.x=a.x+a.width;b.dx*=-1;break}c?(b.y=a.y+b.height,b.dx=0,b.dy=0):(b.y=a.y-b.height,b.isOnFloor=!0,b.isJumping=!1);break}}function t(a,b){function c(){this.constructor=a}A(a,b);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)}function C(a){return{collectable:!0,wasCollected:!1,
collect:function(){this.wasCollected=!0;a()}}}function D(a){var b=a.timeToChange,c=void 0===b?400:b;return q(u({},a,{start:Date.now(),dy:.13,update:function(){this.advance();Date.now()-this.start>c&&(this.dy*=-1,this.start=Date.now())}}))}function E(a,b,c){void 0===a&&(a=0);void 0===b&&(b=0);void 0===c&&(c="purple");return D(u({x:a,y:b,color:c,width:20,height:20,type:"floaty-gem"},C(function(){f.emit("FLOATY_GEM_COLLECTED")})))}function T(a){for(var b=0,c=a.collectableElements;b<c.length;b++){var d=
c[b];a.player.collidesWith(d)&&d.collect()}}function U(a){var b=[];a.trim().split("\n").forEach(function(a,d){var c=null;a.split("").forEach(function(a,e){"1"===a?(c||(c=new F(a,e,d)),c.add()):(c&&(b.push(c.mapPieces),c=null),"0"!==a&&b.push((new F(a,e,d)).mapPieces))});c&&(b.push(c.mapPieces),c=null)});return b}function V(a){return a.filter(function(a){return 1===a.tileType}).map(function(a){var b=a.x,d=a.y,e=a.width;a=a.height;void 0===b&&(b=0);void 0===d&&(d=0);void 0===e&&(e=32);void 0===a&&(a=
32);return q({x:b,y:d,width:e,height:a,type:"platform",color:"#111"})})}function W(a,b,c){void 0===a&&(a=0);void 0===b&&(b=0);void 0===c&&(c="orange");return D(u({x:a,y:b,color:c,width:30,height:20,type:"collectable-magic-platform"},C(function(){f.emit("MAGIC_PLATFORM_COLLECTED")})))}let n={},p,w,B={},h={},g={13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"},N=()=>{};class y{constructor(a=0,b=0){this._x=a;this._y=b}add(a,b=1){return m(this.x+(a.x||0)*b,this.y+(a.y||0)*b,this)}clamp(a,
b,c,d){this._c=!0;this._a=a;this._b=b;this._d=c;this._e=d}get x(){return this._x}get y(){return this._y}set x(a){this._x=this._c?Math.min(Math.max(this._a,a),this._d):a}set y(a){this._y=this._c?Math.min(Math.max(this._b,a),this._e):a}}m.prototype=y.prototype;m.class=y;class z{constructor(a){this.init(a)}init(a={}){let {x:b,y:c,dx:d,dy:e,ddx:f,ddy:h,width:g,height:l,image:k}=a;this.position=m(b,c);this.velocity=m(d,e);this.acceleration=m(f,h);this._fx=this._fy=1;this.width=this.height=this.rotation=
0;this.ttl=Infinity;this.anchor={x:0,y:0};this.context=w;for(let b in a)this[b]=a[b];k&&(this.width=void 0!==g?g:k.width,this.height=void 0!==l?l:k.height);this.sy=this.sx=0}get x(){return this.position.x}get y(){return this.position.y}get dx(){return this.velocity.x}get dy(){return this.velocity.y}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}get animations(){return this._a}get viewX(){return this.x-this.sx}get viewY(){return this.y-this.sy}get width(){return this._w}get height(){return this._h}set x(a){this.position.x=
a}set y(a){this.position.y=a}set dx(a){this.velocity.x=a}set dy(a){this.velocity.y=a}set ddx(a){this.acceleration.x=a}set ddy(a){this.acceleration.y=a}set animations(a){let b,c;this._a={};for(b in a)this._a[b]=a[b].clone(),c=c||this._a[b];this.currentAnimation=c;this.width=this.width||c.width;this.height=this.height||c.height}set viewX(a){}set viewY(a){}set width(a){let b=0>a?-1:1;this._fx=b;this._w=a*b}set height(a){let b=0>a?-1:1;this._fy=b;this._h=a*b}isAlive(){return 0<this.ttl}collidesWith(a){if(this.rotation||
a.rotation)return null;let b=this.x-this.width*this.anchor.x,c=this.y-this.height*this.anchor.y,d=a.x,e=a.y;a.anchor&&(d-=a.width*a.anchor.x,e-=a.height*a.anchor.y);return b<d+a.width&&b+this.width>d&&c<e+a.height&&c+this.height>e}update(a){this.advance(a)}render(){this.draw()}playAnimation(a){this.currentAnimation=this.animations[a];this.currentAnimation.loop||this.currentAnimation.reset()}advance(a){this.velocity=this.velocity.add(this.acceleration,a);this.position=this.position.add(this.velocity,
a);this.ttl--;this.currentAnimation&&this.currentAnimation.update(a)}draw(){let a=-this.width*this.anchor.x,b=-this.height*this.anchor.y;this.context.save();this.context.translate(this.viewX,this.viewY);this.rotation&&this.context.rotate(this.rotation);if(-1==this._fx||-1==this._fy){let c=this.width/2+a,d=this.height/2+b;this.context.translate(c,d);this.context.scale(this._fx,this._fy);this.context.translate(-c,-d)}this.image?this.context.drawImage(this.image,0,0,this.image.width,this.image.height,
a,b,this.width,this.height):this.currentAnimation?this.currentAnimation.render({x:a,y:b,width:this.width,height:this.height,context:this.context}):(this.context.fillStyle=this.color,this.context.fillRect(a,b,this.width,this.height));this.context.restore()}}q.prototype=z.prototype;q.class=z;var R=function(){function a(a){this.steps=[];this.player=a}a.prototype.clear=function(){this.steps=[]};a.prototype.add=function(a,c){this.steps.push({position:m(a,c)})};Object.defineProperty(a.prototype,"hasSteps",
{get:function(){return 0<this.steps.length},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"firstStep",{get:function(){return this.steps[0]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"lastStep",{get:function(){return this.steps[this.steps.length-1]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"previousStep",{get:function(){if(this.hasSteps)return this.steps.pop()},enumerable:!0,configurable:!0});return a}(),f=new (function(){function a(){}
a.prototype.on=function(a,c){n[a]=n[a]||[];n[a].push(c)};a.prototype.off=function(a,c){{let b;!n[a]||0>(b=n[a].indexOf(c))||n[a].splice(b,1)}};a.prototype.emit=function(a){for(var b=[],d=1;d<arguments.length;d++)b[d-1]=arguments[d];x.apply(void 0,[a].concat(b))};return a}()),A=function(a,b){A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return A(a,b)},u=function(){u=Object.assign||function(a){for(var b,
c=1,d=arguments.length;c<d;c++){b=arguments[c];for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e])}return a};return u.apply(this,arguments)},X=function(){function a(a){var b=this;this.platforms=[];this.magicPlatforms=[];this.floatyGem=E();this.collectableMagicPlatforms=[];this.removeOldMagicPlatforms=function(){b.magicPlatforms=b.magicPlatforms.filter(function(a){return a.exists});b.game.ui.usedPlatforms=b.magicPlatforms.length};this.game=a;this.player=Q(this);this.player.init();
f.on("MAGIC_PLATFORM_GONE",this.removeOldMagicPlatforms)}a.prototype.restore=function(){this.platforms=[];this.magicPlatforms=[];this.collectableMagicPlatforms=[];this.floatyGem.wasCollected=!1};Object.defineProperty(a.prototype,"collisionElements",{get:function(){return this.platforms.concat(this.magicPlatforms)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"collectableElements",{get:function(){return[this.floatyGem].concat(this.collectableMagicPlatforms).filter(function(a){return a.collectable&&
!a.wasCollected})},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"canSpawnNewMagicPlatform",{get:function(){return this.player.totalAmountOfMagicPlatforms>this.magicPlatforms.length},enumerable:!0,configurable:!0});a.prototype.addMagicPlatform=function(a){this.magicPlatforms.push(a);this.game.ui.usedPlatforms=this.magicPlatforms.length};a.prototype.update=function(a){this.magicPlatforms.forEach(function(a){return a.update()});this.collectableElements.forEach(function(a){return a.update()});
this.player.update(a);this.player.dy=this.player.isOnFloor?0:this.player.dy+15*a;S(this);this.player.x+this.player.width>p.width&&(this.player.dx=0,this.player.x=p.width-this.player.width);0>this.player.x&&(this.player.dx=0,this.player.x=0);T(this)};a.prototype.render=function(){this.platforms.forEach(function(a){return a.render()});this.magicPlatforms.forEach(function(a){return a.render()});this.collectableElements.forEach(function(a){return a.render()});this.player.render()};return a}(),l=new (function(){function a(){this.stopTime=
this.startTime=0}a.prototype.start=function(){this.reset();this.startTime=Date.now()};a.prototype.stop=function(){this.stopTime=Date.now()};a.prototype.reset=function(){this.stopTime=this.startTime=0};Object.defineProperty(a.prototype,"ellapseTime",{get:function(){return this.startTime?((this.stopTime||Date.now())-this.startTime)/1E3:0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"isRunning",{get:function(){return!!this.startTime&&!this.stopTime},enumerable:!0,configurable:!0});
return a}()),Z=function(){function a(a){this.menuElement=document.querySelector("[data-game-menu]");this.internalState="game-instructions";this.menuComponent=new G;this.isVisible=!0;this.game=a;this.menuComponent.init(a)}Object.defineProperty(a.prototype,"state",{get:function(){return this.internalState},set:function(a){this.internalState=a;this.menuComponent.tearDown();"game-instructions"===a&&(this.menuComponent=new G);"game-score"===a&&(this.menuComponent=new Y);this.menuComponent.init(this.game)},
enumerable:!0,configurable:!0});a.prototype.hide=function(){this.menuElement.classList.add("hidden");this.isVisible=!1;this.menuComponent.tearDown()};a.prototype.render=function(){this.menuElement.classList.remove("hidden");this.isVisible=!0;this.menuComponent.init(this.game);this.menuComponent.render()};return a}(),G=function(){function a(){var a=this;this.mounted=!1;this.gameInstructionsElement=document.querySelector(".game-instructions");this.button=document.querySelector("[data-start-game-button]");
this.levelsListContainer=document.querySelector("[data-levels-container]");this.levelsList=document.querySelector("[data-levels-list]");this.highscoreContainer=document.querySelector("[data-highscore-menu]");this.onSpaceBarPressDown=function(b){if(32===b.which)a.onStartButtonClick()};this.onStartButtonClick=function(){f.emit("START_GAME")};this.onLevelClick=function(a){(a=a.target.dataset.level)&&f.emit("LOAD_LEVEL",a)}}a.prototype.init=function(a){var b=this;if(!this.mounted){var d=a.listOfLevels;
a=a.isGameOver;a||(this.button.addEventListener("click",this.onStartButtonClick),document.addEventListener("keypress",this.onSpaceBarPressDown));d.find(function(a){return a.isCompleted})&&(this.levelsList.innerHTML="",this.highscoreContainer.innerHTML="",d.filter(function(a){return a.isCompleted}).forEach(function(a){var c=document.createElement("button");c.innerHTML=a.levelNumber.toString();c.classList.add("button-small");c.dataset.level=a.levelNumber.toString();b.levelsList.appendChild(c);c=document.createElement("li");
c.innerHTML="<strong>Level "+a.levelNumber+"</strong>: "+a.highscore.toFixed(2)+" seconds";b.highscoreContainer.appendChild(c)}),this.levelsListContainer.classList.remove("none"),this.highscoreContainer.classList.remove("none"),document.querySelector("[data-highscore-label]").classList.remove("none"),this.button.innerHTML="Continue",this.levelsList.addEventListener("click",this.onLevelClick));a&&document.querySelector("[data-start-game-info]").classList.add("none");this.mounted=!0}};a.prototype.render=
function(){this.gameInstructionsElement.classList.remove("none")};a.prototype.tearDown=function(){this.button.removeEventListener("click",this.onStartButtonClick);document.removeEventListener("keypress",this.onSpaceBarPressDown);this.levelsList.removeEventListener("click",this.onLevelClick);this.gameInstructionsElement.classList.add("none");this.mounted=!1};return a}(),Y=function(){function a(){var a=this;this.gameScoreElement=document.querySelector(".game-score");this.scoreMessageElement=document.querySelector("[data-level-message]");
this.restartButton=document.querySelector("[data-restart-level-button]");this.nextLevelButton=document.querySelector("[data-next-level-button]");this.handleKeyPress=function(b){32===b.which&&a.nextLevel()};this.restart=function(){f.emit("RESTART_LEVEL")};this.nextLevel=function(){f.emit("NEXT_LEVEL")}}a.prototype.init=function(a){this.game=a;this.restartButton.addEventListener("click",this.restart);this.game.levels.isLastLevel?this.nextLevelButton.classList.add("none"):this.nextLevelButton.addEventListener("click",
this.nextLevel);document.addEventListener("keypress",this.handleKeyPress)};a.prototype.render=function(){this.gameScoreElement.classList.remove("none");var a=this.game.highscore.getHighscore(this.game.levels.current);this.scoreMessageElement.innerHTML=l.ellapseTime>a?"Not this time! Your highscore is <strong>"+a.toFixed(2)+"</strong>.":"\ud83c\udf89 Congrats on your new highscore! \u261d\ufe0f";document.querySelector("[data-level-duration]").innerHTML=l.ellapseTime.toFixed(2)};a.prototype.tearDown=
function(){this.gameScoreElement.classList.add("none");this.restartButton.removeEventListener("click",this.restart);this.nextLevelButton.removeEventListener("click",this.nextLevel);document.removeEventListener("keypress",this.handleKeyPress)};return a}(),aa=function(){function a(){this.currentTimeElement=document.querySelector("[data-current-seconds]");this.usedPlatformsElement=document.querySelector("[data-used-platforms]");this.availablePlatformsElement=document.querySelector("[data-available-platforms]")}
Object.defineProperty(a.prototype,"seconds",{set:function(a){this.currentTimeElement.innerHTML=a.toFixed(2)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"usedPlatforms",{set:function(a){this.usedPlatformsElement.innerHTML=""+a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"availablePlatforms",{set:function(a){this.availablePlatformsElement.innerHTML=""+a},enumerable:!0,configurable:!0});return a}(),F=function(){function a(a,c,d){this.quantity=0;this.type=
a;this.x=c;this.y=d}a.prototype.add=function(){this.quantity++};Object.defineProperty(a.prototype,"mapPieces",{get:function(){return{tileType:Number(this.type),x:32*this.x,y:32*this.y,width:32*this.quantity,height:32}},enumerable:!0,configurable:!0});return a}(),k=function(){function a(a){this.availableMagicPlatformsAtTheBeginning=0;this.name="BaseLevel";this.levelNumber=0;this.world=a}a.prototype.start=function(){var a=this;this.world.restore();this.world.player.totalAmountOfMagicPlatforms=this.availableMagicPlatformsAtTheBeginning;
var c=U(this.map);this.world.platforms=V(c);this.world.floatyGem=E();var d=c.find(function(a){return 8===a.tileType});this.world.player.x=d.x;this.world.player.y=d.y;d=c.find(function(a){return 7===a.tileType});this.world.floatyGem.x=d.x+6;this.world.floatyGem.y=d.y+6;c.filter(function(a){return 2===a.tileType}).forEach(function(b){a.world.collectableMagicPlatforms.push(W(b.x,b.y))})};return a}(),v=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.name="LevelOne";b.availableMagicPlatformsAtTheBeginning=
0;b.map="0000000000000000000000000000000000000000\n0000000000000000000000000000000000000000\n0000000000000000000000000000000000000000\n0000000000000000000000000000000000000000\n0000000000000000000000000000000000000000\n0000000001111111111111111111111000000000\n0000000001000000000000000000001000000000\n0000000001000000000000000000001000000000\n0000000001000000000000000000071000000000\n0000000001000000000000000011111000000000\n0000000001000000000000000000001000000000\n0000000001000000000000000000001000000000\n0000000001111000000000000000001000000000\n0000000001000000000000000000001000000000\n0000000001000000000000000000001000000000\n0000000001000000000000000000001000000000\n0000000001000000000020000000001000000000\n0000000001080000000111100000001000000000\n0000000001000000000000000000001000000000\n0000000001111111111111111111111000000000\n0000000000000000000000000000000000000000\n0000000000000000000000000000000000000000\n0000000000000000000000000000000000000000\n0000000000000000000000000000000000000000\n0000000000000000000000000000000000000000";
b.levelNumber=1;return b}t(b,a);return b}(k),ba=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.name="LevelTwo";b.availableMagicPlatformsAtTheBeginning=1;b.map="0000000000000000000000000000000000000000\n0000000000000000000000000000000000000000\n0000000000000000000000000000000000000000\n0000000000000000000000000000000000000000\n0000000000000000000000000000000000000000\n0000000001111111111111111111111000000000\n0000000001000000000000000000001000000000\n0000000001070000000000000000001000000000\n0000000001000000000000000000001000000000\n0000000001000000000000000000001000000000\n0000000001000000000000000000001000000000\n0000000001000000000000111000001000000000\n0000000001000000000000000000001000000000\n0000000001000000000000000000001000000000\n0000000001000000000000000000001000000000\n0000000001000000000000000000001000000000\n0000000001000000000000000000001000000000\n0000000001080000000000000000001000000000\n0000000001000000000000000000001000000000\n0000000001111111111111111111111000000000\n0000000000000000000000000000000000000000\n0000000000000000000000000000000000000000\n0000000000000000000000000000000000000000\n0000000000000000000000000000000000000000\n0000000000000000000000000000000000000000";
b.levelNumber=2;return b}t(b,a);return b}(k),ca=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.name="LevelThree";b.availableMagicPlatformsAtTheBeginning=2;b.map="0000000000000000000000000000000000000000\n0000000000000000111111110000000000000000\n0000000000000000100000010000000000000000\n0000000000000000107000010000000000000000\n0000000000000000100000010000000000000000\n0000000000000000100000010000000000000000\n0000000000000000100000010000000000000000\n0000000000000000100000010000000000000000\n0000000000000000100000010000000000000000\n0000000000000000100000010000000000000000\n0000000000000000100000010000000000000000\n0000000000000000100000010000000000000000\n0000000000000000100000010000000000000000\n0000000000000000100000010000000000000000\n0000000000000000101000010000000000000000\n0000000000000000100000010000000000000000\n0000000000000000100000010000000000000000\n0000000000000000100000010000000000000000\n0000000000000000100000010000000000000000\n0000000000000000100000010000000000000000\n0000000000000000108000010000000000000000\n0000000000000000100000010000000000000000\n0000000000000000111111110000000000000000\n0000000000000000000000000000000000000000\n0000000000000000000000000000000000000000";
b.levelNumber=3;return b}t(b,a);return b}(k),da=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.name="LevelFour";b.availableMagicPlatformsAtTheBeginning=2;b.map="0000000000000000000000000000000000000000\n0000000011111111111111110000000000000000\n0000000010000000000000010000000000000000\n0000000010700000000000010000000000000000\n0000000010000000000000010000000000000000\n0000000010000000000000010000000000000000\n0000000011111111111100010000000000000000\n0000000000000000100000010000000000000000\n0000000000000000100000010000000000000000\n0000000000000000100000010000000000000000\n0000000000000000100000010000000000000000\n0000000000000000100000010000000000000000\n0000000000000000100000010000000000000000\n0000000000000000100000010000000000000000\n0000000000000000100000010000000000000000\n0000000000000000101000010000000000000000\n0000000000000000100000010000000000000000\n0000000000000000100000010000000000000000\n0000000000000000100000010000000000000000\n0000000000000000100000010000000000000000\n0000000000000000108000010000000000000000\n0000000000000000100000010000000000000000\n0000000000000000111111110000000000000000\n0000000000000000000000000000000000000000\n0000000000000000000000000000000000000000";
b.levelNumber=4;return b}t(b,a);return b}(k);k=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.name="LevelFive";b.availableMagicPlatformsAtTheBeginning=2;b.map="0000000000000000000000000000000000000000\n000000000000111111111111111100000000000\n0000000000001000000000000001000000000000\n0000000000001000000010000701000000000000\n0000000000001000000000000001000000000000\n0000000000001000000000000001000000000000\n0000000000001000000010010001000000000000\n0000000000001000000000000001000000000000\n0000000000001000000000000001000000000000\n0000000000001000000000000001000000000000\n0000000000001000000000000001000000000000\n0000000000001000000000000001000000000000\n0000000000001000000000000001000000000000\n0000000000001000000000000001000000000000\n0000000000001000000000000001000000000000\n0000000000001000000000000001000000000000\n0000000000001000000000000001000000000000\n0000000000001000000000000001000000000000\n0000000000001000000000000001000000000000\n0000000000001000000000000001000000000000\n0000000000001000000000000001000000000000\n0000000000001080000000000001000000000000\n0000000000001000000000000001000000000000\n0000000000001111111111111111000000000000\n0000000000000000000000000000000000000000";
b.levelNumber=5;return b}t(b,a);return b}(k);var ea=[v,ba,ca,da,k],fa=function(){function a(a){this.currentLevelIndex=0;this.levels=ea.map(function(b){return new b(a)})}Object.defineProperty(a.prototype,"current",{get:function(){return this.levels[this.currentLevelIndex]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"isLastLevel",{get:function(){return this.levels.length-1===this.currentLevelIndex},enumerable:!0,configurable:!0});a.prototype.next=function(){this.currentLevelIndex<
this.levels.length-1&&this.currentLevelIndex++};a.prototype.setLevel=function(a){--a;this.currentLevelIndex=this.levels.length>a?a:this.levels.length-1};return a}(),H=new (function(){function a(){}a.prototype.getKey=function(a){return"Back-To-That-Platform-I-Was-On-Before-Jumping:"+a};a.prototype.setItem=function(a,c){localStorage.setItem(this.getKey(a),JSON.stringify(c))};a.prototype.getItem=function(a){return JSON.parse(localStorage.getItem(this.getKey(a)))};a.prototype.clear=function(){localStorage.removeItem(this.getKey("highscore"))};
return a}()),ha=function(){function a(){this.data={};this.data=H.getItem("highscore")||{}}a.prototype.setHighscore=function(a,c){this.data[a.levelNumber]&&this.data[a.levelNumber]<c||(this.data[a.levelNumber]=c,this.save())};a.prototype.getHighscore=function(a){return this.data[a.levelNumber]};a.prototype.save=function(){H.setItem("highscore",this.data)};Object.defineProperty(a.prototype,"completedLevels",{get:function(){return Object.keys(this.data).sort().map(Number)},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"lastSavedLevel",{get:function(){return this.completedLevels[this.completedLevels.length-1]},enumerable:!0,configurable:!0});return a}();v=function(){function a(){var a=this;this.world=new X(this);this.ui=new aa;this.levels=new fa(this.world);this.highscore=new ha;this.gameIsRunning=!1;this.handleKeyPress=function(b){13===b.which&&a.restartLevel()};this.start=function(){if(a.gameIsRunning)a.renderGame();else{a.gameIsRunning=!0;var b=a.world,d=a.ui;a.levels.current.start();
a.gameLoop||(a.gameLoop=M({update:function(a){b.update(a);l.isRunning&&(d.seconds=l.ellapseTime)},render:function(){b.render()}}));a.gameLoop.start();a.renderGame();l.start()}};this.stop=function(){a.gameIsRunning=!1;a.gameLoop&&a.gameLoop.stop()};this.restartLevel=function(){a.stop();a.levels.current.start();a.start()};this.nextLevel=function(){a.stop();a.levels.next();a.levels.current.start();a.start()};this.endLevel=function(){l.stop();a.highscore.setHighscore(a.levels.current,l.ellapseTime);a.menu.state=
"game-score";a.menu.render()};this.openGameMenu=function(){a.menu.state="game-instructions";a.menu.render()};this.menu=new Z(this);this.menu.render();this.levels.setLevel(this.highscore.lastSavedLevel+1||1);this.ui.availablePlatforms=this.world.player.totalAmountOfMagicPlatforms;f.on("START_GAME",this.start);f.on("RESTART_LEVEL",this.restartLevel);f.on("NEXT_LEVEL",this.nextLevel);f.on("FLOATY_GEM_COLLECTED",this.endLevel);f.on("OPEN_GAME_MENU",this.openGameMenu);f.on("LOAD_LEVEL",function(b){a.levels.setLevel(b);
a.start()});document.addEventListener("keypress",this.handleKeyPress)}Object.defineProperty(a.prototype,"isGameOver",{get:function(){return this.levels.levels.length===this.highscore.completedLevels.length},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"listOfLevels",{get:function(){var a=this,c=this.highscore.completedLevels;return this.levels.levels.map(function(b){return{levelNumber:b.levelNumber,isCompleted:c.includes(b.levelNumber),highscore:a.highscore.getHighscore(b)}})},
enumerable:!0,configurable:!0});a.prototype.renderGame=function(){p.classList.remove("hidden");this.updateGameUI();this.menu.hide()};a.prototype.updateGameUI=function(){this.ui.availablePlatforms=this.world.player.totalAmountOfMagicPlatforms;this.ui.usedPlatforms=0};return a}();p=document.getElementById(void 0)||document.querySelector("canvas");if(!p)throw Error("You must provide a canvas element for the game");w=p.getContext("2d");w.imageSmoothingEnabled=!1;x("init");(function(){let a;for(a=0;26>
a;a++)g[65+a]=(10+a).toString(36);for(a=0;10>a;a++)g[48+a]=""+a;window.addEventListener("keydown",I);window.addEventListener("keyup",J);window.addEventListener("blur",K)})();g[16]="shift";g[87]="up";g[68]="right";g[65]="left";v=new v;window.game=v})();
