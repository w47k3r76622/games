!function(){"use strict";const t=document.getElementById("render-area");var s={createCanvas:()=>document.createElement("canvas")};const e=["#810000","#e97171","#ffcb8e","#f5efef"];class i{static background=e[0];static obstacles=e[1];static enemies=e[2];static player=e[3]}var h=.1,n=h;class a{constructor(t,s,e,i,h){this.s=t,this.f=s,this.o=e,this.p=i,this.d=h,this.t=0,this.isStarted=!1,this.isDone=!1,this.parent=null}update(t){if(this.isStarted){if(!this.isDone){this.t+=t/this.d;let s=0;this.t>1&&(s=this.t-1,this.t=1,this.isDone=!0),this.o[this.p]=this.startValue+this.s*this.f(this.t),this.isDone&&this.next&&(this.next!==this&&this.parent.addAction(this.next),this.next.start(),this.next.update(s))}}else this.isStarted=!0,this.startValue=this.o[this.p]||0}start(){this.isStarted=!1,this.t=0,this.isDone=!1,this.update(0)}then(t){return this.next?this.next.then(t):this.next=t,this}}function o(t){return t*t}function r(t){return t*t*t}function c(t){return t*t*t*t}function d(t){return t*t*t*t*t}function l(t){return 1-(1-t)*(1-t)*(1-t)}function u(t){return 1-(1-t)*(1-t)*(1-t)*(1-t)}function y(t,s){let e=0,i=0;for(let h=0;h<t.length;++h)s(t[h])||(h>e?(t[e++]=t[h],++i):(++e,++i));t.length=i}function p(t){t.actions=[],t.updateActions=x,t.addAction=m,t.removeAction=w}function x(t){let s=!1;if(this.actions.length){for(const s of this.actions)s.update(t);s=!0}return y(this.actions,t=>t.isDone),s}function m(t){this.actions.push(t),t.parent=this}function w(t){y(this.actions,s=>s===t),t.parent=null}class g{constructor(){p(this),this.dx=0,this.dy=0,this.context=null}update(t){let s=this.updateActions(t);return(this.dx||this.dy)&&(this.x+=this.dx,this.y+=this.dy,s=!0),s}getLayer(t){return this.parent.getLayer(t)}}class f extends g{constructor(t,s,e){super(),this.text=t,this.x=s,this.y=e}setText(t){this.text!==t&&(this.text=t,this.isDirty=!0)}update(t){return super.update(t)||this.isDirty}draw(){this.context.fillText(this.text,this.x,this.y),this.isDirty=!1}}const M=2*Math.PI;class v extends g{constructor(t,s,e=1){super(),this.x=t,this.y=s+36}drawThumbStick(t,s,e){const i=this.context;i.beginPath(),i.arc(t,s,e,0,M),i.fill()}draw(){const t=this.context;t.save(),t.lineWidth=36,t.lineCap="round",t.fillStyle=i.background,t.beginPath(),t.moveTo(this.x,this.y+128/3),t.lineTo(this.x+12.8,this.y),t.moveTo(this.x+12.8,this.y+128/3/5),t.rect(this.x+12.8,this.y+128/3/5,38.4,128/3/5),t.moveTo(this.x+51.2,this.y),t.lineTo(this.x+64,this.y+128/3),t.stroke(),this.drawThumbStick(this.x+12.8,this.y+128/3*2/5,9),this.drawThumbStick(this.x+51.2,this.y+128/3*2/5,9),this.context.restore(),this.context.save(),this.context.fillStyle=this.context.strokeStyle,this.context.font="24px verdana",this.context.textAlign="left",this.context.fillText("Gamepad",this.x-30,this.y-48),this.context.restore()}}class b extends g{constructor(t,s,e=1){super(),this.x=t,this.y=s,this.width=300*e,this.keySize=this.width/20,this.keySpacing=1.1*this.keySize,this.height=6*this.keySpacing}drawKey(t,s,e,i){const h=this.keySize,n=1.1*this.keySize;this.context.strokeRect(t+i*n,s+e*n,h,h)}drawKeys(t,s){this.drawKey(t,s,0,1);for(let e=0;e<3;++e)this.drawKey(t,s,1,e)}drawMouse(){const t=this.context,s=1.5*this.keySize,e=this.x+this.width+5*this.keySize,i=this.y+s,h=i+s,n=i+2*s,a=e-s,o=e+s;t.beginPath(),t.arc(e,n,s,0,Math.PI),t.arc(e,h,s,Math.PI,2*Math.PI),t.lineTo(a,h),t.moveTo(e,h-s),t.lineTo(e,h),t.moveTo(o,h),t.lineTo(o,n),t.stroke()}draw(){this.context.strokeRect(this.x,this.y,this.width,this.height),this.drawKeys(this.x+2*this.keySpacing,this.y+this.keySpacing),this.drawKeys(this.x+this.width-5*this.keySpacing,this.y+this.height-3*this.keySpacing),this.drawMouse(),this.context.save(),this.context.fillStyle=this.context.strokeStyle,this.context.font="24px verdana",this.context.textAlign="left",this.context.fillText("Keyboard and Mouse",this.x+50,this.y-24),this.context.restore()}}class S{constructor(t){this.canvas=t,t.addEventListener("mousedown",this.onMouseDown.bind(this),!1),t.addEventListener("mousemove",this.onMouseMove.bind(this),!1),t.addEventListener("mouseout",this.onMouseOut.bind(this),!1),t.addEventListener("mouseup",this.onMouseUp.bind(this),!1),this.state="Out",this.isMouseDown=!1,this.isMouseOver=!1,this.current={},this.dragging=null,this.dragComplete=null}clientToCanvas(t,s={}){const e=this.canvas;return s.x=t.offsetX*e.width/e.clientWidth,s.y=t.offsetY*e.height/e.clientHeight,s}updateCurrent(t){this.clientToCanvas(t,this.current)}log(t){}reset(){this.isMouseOver=!1,this.isMouseDown=!1,this.current={},this.dragging=null,this.dragComplete=null}drop(){const t=this.dragComplete;return this.dragComplete=null,t}onMouseEvent(t){this.log(t),this.isMouseOver=!0,this.updateCurrent(t)}onMouseMove(t){this.onMouseEvent(t),this.state="Moving"}onMouseOut(t){this.onMouseEvent(t),this.reset(),this.state="Out"}onBeginDrag(t){this.dragging={begin:this.clientToCanvas(t),end:this.current}}onEndDrag(t){this.dragging.end=this.clientToCanvas(t),this.dragComplete=this.dragging,this.dragging=null}onMouseDown(t){this.onMouseEvent(t);const s=this.isMouseDown,e=1===t.which;!s&&e?(this.isMouseDown=!0,this.onBeginDrag(t),this.state="Dragging"):"Out"===this.state&&(this.state="Moving")}onMouseUp(t){this.onMouseEvent(t);const s=this.isMouseDown,e=1===t.which;s&&e?(this.isMouseDown=!1,this.onEndDrag(t),this.state="Moving"):"Out"===this.state&&(this.state="Moving")}}const[k,D,A,T,P,E,C,O]=[65,67,68,83,86,87,89,90];class I{constructor(t){t.addEventListener("keydown",this.onKeyDown.bind(this),!1),t.addEventListener("keyup",this.onKeyUp.bind(this),!1),this.newKeysDown={},this.keysDown={},this.newKeysUp={}}reset(){for(let t in this.newKeysDown)this.newKeysDown[t]=void 0;for(let t in this.newKeysUp)this.newKeysUp[t]=void 0}onKeyDown(t){let s=t.keyCode;t.metaKey&&(s+=400),this.newKeysDown[s]=s,this.keysDown[s]=s}onKeyUp(t){let s=t.keyCode;t.metaKey&&(s+=400),this.newKeysUp[s]=s,this.keysDown[s]=void 0}isKeyDown(t){return this.keysDown[t]===t}isKeyUp(t){return this.keysDown[t]!==t}}class L{constructor(e,i){this.z=i,this.name=e;const h=this.canvas=s.createCanvas();h.id=e,h.width=1920,h.height=1080,h.style="z-index: "+i,this.context=h.getContext("2d"),this.objects=[],this.isDirty=!0,t.appendChild(h)}getLayer(t){return this.parent.layer[t]}addObject(t){t.parent=this,t.context=this.context,"number"!=typeof t.z&&(t.z=0),this.objects.push(t),this.isObjectListDirty=!0}removeObject(t){y(this.objects,s=>s===t),t.parent=null,t.context=null}clear(){const t=this.context,s=this.canvas;let e=t.getTransform();t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,s.width,s.height),t.setTransform(e)}update(t){for(const s of this.objects){const e=s.update(t);this.isDirty=e||this.isDirty}this.isObjectListDirty&&(this.objects.sort((t,s)=>t.z-s.z),this.isObjectListDirty=!1)}draw(){if(this.isDirty){this.clear();for(const t of this.objects)t.draw();this.isDirty=!1}}dispose(){t.removeChild(this.canvas)}}const K=["avoid being hit","point to shoot","max ammo: 404"],j="Click or Press Enter to Start";class B extends L{constructor(t,s){super(t,s),p(this),this.context.strokeStyle=i.enemies,this.context.fillStyle=i.player,this.context.lineWidth=8,this.context.font="64px verdana",this.context.textAlign="center",this.titleEase=0,this.addAction(new a(1,u,this,"titleEase",.75)),this.addObject(new b(100,100)),this.addObject(new v(this.canvas.width-300,100)),this.keys=new I(window),this.mouse=new S(this.canvas)}clear(){const t=this.context,s=t.canvas;let e=s.width/2,h=s.height/2;t.save();const n=t.createRadialGradient(e,h,s.height/2,e,h,4*s.height/3);return n.addColorStop(0,i.background),n.addColorStop(1,i.obstacles),t.fillStyle=n,t.fillRect(0,0,s.width,s.height),t.restore(),this}renderTitle(){const t=this.context,s=t.canvas;let e=s.width/2,i=s.height/2,h=1*s.height/10;t.save(),t.font="128px verdana",Math.random()>.9&&(t.shadowBlur=16,t.shadowOffsetX=Math.round(16*Math.random()-8),t.shadowOffsetY=Math.round(16*Math.random()-8),t.shadowColor=t.fillStyle),t.fillText("Shooooooot!!",e,this.titleEase*i-h),t.restore()}renderInfoText(){const t=this.context,s=t.canvas;let e=s.width/2,i=s.height/2;for(let s in K){const h=K[s],n=this.titleEase*e,a=i+80*s;t.fillText(h,n,a)}}renderNext(){const t=this.context,s=t.canvas;let e=s.width/2,h=s.height/2,n=K.length+3;const a=e+(1-this.titleEase)*e*2,o=h+80*n,r=t.fillStyle,c=t.strokeStyle;t.fillStyle=i.enemies,t.strokeStyle=i.enemies,t.fillText(j,a,o);const d=1.1*t.measureText(j).width;t.strokeRect(a-d/2,o-70.4,d,88),t.fillStyle=r,t.strokeStyle=c}update(t){super.update(t),this.updateActions(t),(this.keys.isKeyDown(13)||this.mouse.isMouseDown)&&this.parent.start(),this.isDirty=!0}draw(){super.draw(),this.renderTitle(),this.renderInfoText(),this.renderNext()}}class R extends g{constructor(t,s,e,i){super(),this.x=t,this.y=s,this.width=e,this.height=i}draw(){this.context.strokeRect(this.x,this.y,this.width,this.height)}}class _ extends L{constructor(t,s){super(t,s),this.context.strokeStyle=i.obstacles,this.context.fillStyle=i.obstacles,this.context.lineWidth=6,this.addObject(new R(3,3,this.canvas.width-6,this.canvas.height-6))}update(t){return this.checkForBoundaryCollisions(),super.update(t)}checkForBoundaryCollisions(){const t=this.getLayer("simulation").enemies,s=this.getLayer("player").player;this.collidesWithBoundary(s)&&s.explode();for(const s of t)this.collidesWithBoundary(s)&&s.explode()}aabb(){return{left:3,top:3,right:this.canvas.width-6,bottom:this.canvas.height-6}}collidesWithBoundary(t){const s=this.canvas.width-6,e=this.canvas.height-6,i=[t.x-3,s-t.x,t.y-3,e-t.y];for(const s of i)if(s<t.radius)return!0;return!1}}class W extends g{constructor(t,s,e){super(),this.x=t+e.radius,this.y=s+e.radius,this.enemy=e;const i=Math.floor(11*Math.random())+15;this.particles=new Array(i);for(let t=0;t<i;++t){const s=Math.random()*Math.PI*2;this.particles[t]={length:Math.floor(300*Math.random()),angle:s}}this.duration=1,this.factor=0,this.countDown=new a(1,u,this,"factor",1),this.addAction(this.countDown)}update(t){let s=super.update(t);for(const t of this.particles)t.x=Math.cos(t.angle)*t.length*(1-this.factor)+this.x,t.y=Math.sin(t.angle)*t.length*(1-this.factor)+this.y;return this.factor>=1&&(this.parent.addEnemy(this.enemy),this.parent.removeObject(this)),s}draw(){for(const t of this.particles)this.context.fillRect(t.x,t.y,8,8)}}class U extends g{constructor(t,s,e,i){super();const h=Math.floor(11*Math.random())+15;this.particles=new Array(h);const n=e+e,a=t-e,o=s-e;for(let t=0;t<h;++t){const s=Math.random()*Math.PI*2,e=Math.floor(12*Math.random())+8;this.particles[t]={x:Math.floor(Math.random()*n)+a,y:Math.floor(Math.random()*n)+o,angle:s,dx:Math.cos(s)*e,dy:Math.sin(s)*e,ttl:Math.random()*(1-.33)+.33}}}update(t){let s=!1;for(const e of this.particles)e.x+=e.dx,e.y+=e.dy,e.ttl-=t,s=e.ttl>=0||s;return s||this.parent.removeObject(this),!0}draw(){for(const t of this.particles)t.ttl>=0&&this.context.fillRect(t.x,t.y,5,5)}}function z(){const t=new AudioContext;return(s=1,e=.05,i=220,n=0,a=0,o=.1,r=0,c=1,d=0,l=0,u=0,y=0,p=0,x=0,m=0,w=0,g=0,f=1,M=0,v=0)=>{let b,S,k=2*Math.PI,D=d*=500*k/44100**2,A=(0<m?1:-1)*k/4,T=i*=(1+2*e*Math.random()-e)*k/44100,P=[],E=0,C=0,O=0,I=1,L=0,K=0,j=0;for(l*=500*k/44100**3,m*=k/44100,u*=k/44100,y*=44100,p=44100*p|0,S=(n=99+44100*n)+(M*=44100)+(a*=44100)+(o*=44100)+(g*=44100)|0;O<S;P[O++]=j)++K%(100*w|0)||(j=r?1<r?2<r?3<r?Math.sin((E%k)**3):Math.max(Math.min(Math.tan(E),1),-1):1-(2*E/k%2+2)%2:1-4*Math.abs(Math.round(E/k)-E/k):Math.sin(E),j=(p?1-v+v*Math.sin(2*Math.PI*O/p):1)*(0<j?1:-1)*Math.abs(j)**c*s*h*(O<n?O/n:O<n+M?1-(O-n)/M*(1-f):O<n+M+a?f:O<S-g?(S-O-g)/o*f:0),j=g?j/2+(g>O?0:(O<S-g?1:(S-O)/g)*P[O-g|0]/2):j),b=(i+=d+=l)*Math.sin(C*m-A),E+=b-b*x*(1-1e9*(Math.sin(O)+1)%2),C+=b-b*x*(1-1e9*(Math.sin(O)**2+1)%2),I&&++I>y&&(i+=u,T+=u,I=0),!p||++L%p||(i=T,d=D,I=I||1);return(s=t.createBuffer(1,S,44100)).getChannelData(0).set(P),(i=t.createBufferSource()).buffer=s,i.connect(t.destination),i.start(),i}}let G;class V extends g{constructor(t,s,e){super(),this.x=t,this.y=s,this.radius=e,this._center={x:t,y:s},this.pointValue=10,G||(G=z())}center(){return this._center.x=this.x,this._center.y=this.y,this._center}explode(){this.exploded||(this.parent.addObject(new U(this.x,this.y,this.radius,5*this.radius)),this.incrementScore(),this.parent.removeEnemy(this),G(1,.05,240,0,.1,.43,2,1.29,3.2,0,0,0,0,1.7,.5,.5,.1,.55,.08,.27)),this.exploded=!0}incrementScore(){this.getPlayer().exploded||this.getHud().addScore(this.pointValue)}getPlayer(){return this.getLayer("player").player}getHud(){return this.getLayer("hud")}}const F=Math.PI/6;const Z=2*Math.PI;function X(t){for(;t>Z;)t-=Z;return t<0&&(t+=Z),t}class Y extends V{constructor(t,s){super(t,s,22.5),this.originalRadius=this.radius,this.width=45,this.height=45;const e=this.angle=2*Math.random()*Math.PI;this.dx=7*Math.cos(e),this.dy=7*Math.sin(e),this.hits=0}getBoundaryBox(){return this.parent.getLayer("background").aabb()}setDirection(t){this.angle=t,this.dx=7*Math.cos(t),this.dy=7*Math.sin(t)}update(t){let s=super.update(t),e=!1;this.context.canvas;const{left:i,right:h,top:n,bottom:a}=this.getBoundaryBox(),o=this.x,r=this.y,c=this.radius;return o-i<c?(e=!0,this.x=i+c+(i+c)-o,this.dx=-this.dx):h-o<c?(e=!0,this.x=h-c+(h-c)-o,this.dx=-this.dx):r-n<c?(e=!0,this.y=n+c+(n+c)-r,this.dy=-this.dy):a-r<c&&(e=!0,this.y=a-c+(a-c)-r,this.dy=-this.dy),e&&(this.angle=Math.atan2(this.dy,this.dx)),s}draw(){const t=this.context;t.beginPath(),t.arc(this.x,this.y,this.radius,0,2*Math.PI),t.fill()}explode(){++this.hits,this.radius=3*this.originalRadius/(3+this.hits),this.hits>=3&&super.explode()}}const H=2*Math.PI;let q;class N extends V{constructor(t,s){super(t,s,15),this.pointValue=0,this.acceleration=1,this.addAction(new a(1,c,this,"acceleration",2.5)),q||(q=z())}update(t){const s=this.getPlayer(),e=.5*this.acceleration;if(s){const t=s.center(),i=this.center(),h=t.x-i.x,n=t.y-i.y,a=Math.atan2(n,h)+Math.PI;this.dx=Math.cos(a)*e,this.dy=Math.sin(a)*e}return super.update(t)||!0}draw(){const t=this.context;t.save(),t.fillStyle=i.obstacles,t.strokeStyle=i.background,t.lineWidth=3,t.lineCap="round",t.beginPath(),t.arc(this.x,this.y,this.radius,0,2*Math.PI),t.fill(),t.beginPath(),t.moveTo(this.x-this.radius/2,this.y),t.lineTo(this.x+this.radius/2,this.y),t.moveTo(this.x,this.y-this.radius/2),t.lineTo(this.x,this.y+this.radius/2),t.stroke(),t.restore()}absorb(){this.exploded||(this.pointValue=50,this.incrementScore(),this.incrementAmmo(),this.parent.removeEnemy(this),q(1,.05,1719,0,.09,.11,1,1.14,0,0,992,.08,.02,.1,0,0,0,.7,.01,0)),this.exploded=!0}incrementAmmo(){this.getPlayer().exploded||this.getHud().addAmmo(this.pointValue)}}function $(t){return t*t}function J(t,s){return $(t.x-s.x)+$(t.y-s.y)}function Q(t,s){const e=s.x-t.x,i=s.y-t.y;return Math.atan2(i,e)}const tt={};class st extends a{constructor(t,s){super(0,s=>{1===s&&t()},tt,"property",s)}}const et=[class extends V{constructor(t,s){super(t,s,15),t-=15,s-=15,this.x=t,this.y=s,this.width=30,this.height=30,this.acceleration=1,this.addAction(new a(.75,d,this,"acceleration",2.5))}center(){return this._center.x=this.x+15,this._center.y=this.y+15,this._center}update(t){const s=this.getPlayer(),e=3*this.acceleration;if(s){const t=s.center(),i=this.center(),h=t.x-i.x,n=t.y-i.y;if(Math.abs(h)<e&&Math.abs(n)<e)this.dx=0,this.dy=0;else{const t=Math.atan2(n,h);this.dx=Math.cos(t)*e,this.dy=Math.sin(t)*e}}return super.update(t)}draw(){this.context.strokeRect(this.x,this.y,this.width,this.height)}},class extends V{constructor(t,s){super(t,s,12.5),t-=12.5,s-=12.5,this.x=t,this.y=s,this.width=25,this.height=25,this.pointValue=15}center(){return this._center.x=this.x+12.5,this._center.y=this.y+12.5,this._center}update(t){const s=this.getPlayer();if(s){const t=s.center(),e=this.center(),i=t.x-e.x,h=t.y-e.y;if(Math.abs(i)<5&&Math.abs(h)<5)this.dx=0,this.dy=0;else{let t=Math.atan2(h,i),e=0;if(this.inRepelArc(t,s)){const s=Math.random()*(Math.PI/2)-Math.PI/4;t=X(t+Math.PI+s),e=3}this.dx=Math.cos(t)*(5+e),this.dy=Math.sin(t)*(5+e)}}return super.update(t)}inRepelArc(t,s){const e=X(t+Math.PI),i=X(s.angle);let h=i-F,n=i+F;return h<0?(h+=Z,e<=n&&e>=0||e>=h&&e<=Z):n>Z?(n-=Z,e<=n&&e>=0||e>=h&&e<=Z):e<=n&&e>=h}draw(){const t=this.context.lineWidth;this.context.lineWidth=9,this.context.strokeRect(this.x,this.y,this.width,this.height),this.context.lineWidth=t}},Y,class extends V{constructor(t,s){super(t,s,13),t-=13,s-=13,this.x=t,this.y=s,this.spinX=t,this.spinY=s,this.width=26,this.height=26,this.spiralRadiusEase=0,this.spiralAngleEase=0,this.spiralAngle=2*Math.random()*Math.PI,this.spinDirection=Math.round(Math.random())?-1:1;const e=new a(1,r,this,"spiralRadiusEase",1+Math.random()),i=new a(-1,l,this,"spiralRadiusEase",1+Math.random());this.addAction(e.then(i).then(e))}center(){return this._center.x=this.x+13,this._center.y=this.y+13,this._center}update(t){this.spiralAngleEase+=this.spinDirection*t;let s=super.update(t);const e=this.getPlayer();if(e){const t=e.center(),s=t.x-this.spinX,i=t.y-this.spinY;if(Math.abs(s)<2&&Math.abs(i)<2)this.dx=0,this.dy=0;else{const t=Math.atan2(i,s);this.dx=2*Math.cos(t),this.dy=2*Math.sin(t)}}this.spinX+=this.dx,this.spinY+=this.dy;const i=this.spiralAngle+2*this.spiralAngleEase*Math.PI,h=100*(.5+this.spiralRadiusEase);let n=this.spinX+Math.cos(i)*h,a=this.spinY+Math.sin(i)*h;return this.x=n,this.y=a,s||!0}draw(){const t=this,s=this.context;s.beginPath(),s.arc(t.x,t.y,t.radius,0,H),s.stroke()}}],it=["boxSpawn","cornerSpawn","sideSpawn"];function ht(t){return Math.floor(Math.random()*t)}function nt(t){return t[ht(t.length)]}class at extends L{constructor(t,s){super(t,s),this.context.strokeStyle=i.enemies,this.context.fillStyle=i.enemies,this.context.lineWidth=4,this.enemies=[],p(this);let e=new st(this.spawn.bind(this),5);e.then(e),this.spawnTimer=e,this.addAction(this.spawnTimer),this.spawn()}update(t){const s=super.update(t);return this.checkForEnemyOnEnemyCollisions(),this.updateActions(t)||s}spawn(){const t=nt(et);this[nt(it)](t)}boxSpawn(t){const s=Math.floor(this.canvas.width/8+Math.random()*(this.canvas.width/4)),e=Math.floor(this.canvas.height/8+Math.random()*(this.canvas.height/4));let i=[s,this.canvas.width/2,this.canvas.width-s],h=[e,this.canvas.height/2,this.canvas.height-e];for(let s=0;s<3;++s)for(let e=0;e<3;++e){if(1==s&&1===e)continue;let n=new t(i[s],h[e]);this.spawnEnemy(n)}}cornerSpawn(t){const s=Math.floor(this.canvas.height/(4*Math.random()+3)),e=s,i=s,h=this.canvas.height-s,n=this.canvas.width-s,a=[];this.addCluster(a,t,i+ht(100),e+ht(100)),this.addCluster(a,t,n-ht(100),h-ht(100)),this.addCluster(a,t,n-ht(100),e+ht(100)),this.addCluster(a,t,i+ht(100),h);for(const t of a)this.spawnEnemy(t)}sideSpawn(t){let s=ht(this.canvas.width-400)+200,e=ht(this.canvas.height-400)+200;const i=Math.floor(this.canvas.width/7),h=Math.floor(this.canvas.height/7);if(Math.random()<.5)for(let e=1;e<=5;++e)this.spawnEnemy(new t(s+ht(50),e*h+ht(50))),this.spawnEnemy(new t(s-ht(50)-50,e*h+ht(50)));else for(let s=1;s<=5;++s)this.spawnEnemy(new t(s*i+ht(50),e+ht(50))),this.spawnEnemy(new t(s*i+ht(50),e-ht(50)-50))}addCluster(t,s,e,i){const h=ht(20)+60;t.push(new s(e,i)),t.push(new s(e+h,i+h)),t.push(new s(e,i+h)),t.push(new s(e+h,i))}spawnEnemy(t){Math.random()<=.15&&(t=new N(t.x,t.y)),this.addObject(new W(t.x,t.y,t))}addEnemy(t){this.enemies.push(t),this.addObject(t)}removeEnemy(t){y(this.enemies,s=>s===t),this.removeObject(t)}checkForEnemyOnEnemyCollisions(){const t=this.enemies;for(let s=0;s<t.length;++s)for(let e=s+1;e<t.length;++e){const i=t[s],h=t[e];if(this.isCollision(i,h))if(i instanceof Y){if(h instanceof Y){const t=Q(i,h);i.setDirection(t-Math.PI),h.setDirection(t)}i.explode(),h.explode()}else h instanceof Y&&(i.explode(),h.explode())}}isCollision(t,s){const e=t.radius+s.radius;return J(t.center(),s.center())<=e*e}}const ot=2*Math.PI;class rt extends g{constructor(t,s,e){super(),this.x=t,this.y=s,this.radius=e}draw(){const t=this.context;t.beginPath(),t.arc(this.x,this.y,this.radius,0,ot),t.stroke()}}class ct extends rt{constructor(t,s,e){super(t,s,e)}update(t){return this.x<0||this.y<0||this.x>this.parent.canvas.width||this.y>this.parent.canvas.height?(this.parent.removeBullet(this),!0):super.update(t)}}const dt=2*Math.PI,lt=Math.sqrt(2)/2;let ut;class yt extends g{constructor(t,s,e){super(),this.x=t,this.y=s,this.radius=e,this._center={},this.aim={dx:0,dy:0},this.lastAim={dx:0,dy:0};let i=new st(this.shoot.bind(this),.2);i.then(i),this.shootAction=i,this.ammo=404,this.shots=1,this.showCursor(),ut||(ut=z())}showCursor(){this.isUsingGamepad&&(t.classList.remove("hidecursor"),t.classList.add("showcursor"),this.isUsingGamepad=!1)}hideCursor(){this.isUsingGamepad||(t.classList.remove("showcursor"),t.classList.add("hidecursor"),this.isUsingGamepad=!0)}startShooting(){this.addAction(this.shootAction)}stopShooting(){this.removeAction(this.shootAction)}magnitude({dx:t,dy:s}){return Math.sqrt(t*t+s*s)}shoot(){switch(this.shots){case 1:this.shoot1();break;case 2:this.shoot2();break;case 3:this.shoot3()}}shoot1(){if(!this.inDeadZone(this.aim.dx,this.aim.dy)&&this.ammo){const t=this.x+this.aim.dx*this.radius,s=this.y+this.aim.dy*this.radius,e=new ct(t,s,5),i=this.magnitude(this.aim);e.dx=this.aim.dx/i*5*2,e.dy=this.aim.dy/i*5*2,this.parent.addBullet(e),this.decrementAmmo(1),ut(1,.05,31,.04,0,.08,1,.17,0,0,0,0,.03,0,0,0,0,.23,.01,0)}}shoot2(){if(!this.inDeadZone(this.aim.dx,this.aim.dy)&&this.ammo>1){const t=this.x+this.aim.dx*this.radius,s=this.y+this.aim.dy*this.radius,e=Math.atan2(this.aim.dy,this.aim.dx),i=5*Math.cos(e+Math.PI/2),h=5*Math.sin(e+Math.PI/2);let n;n=new ct(t+i,s+h,5),n.dx=5*Math.cos(e+Math.PI/90)*2,n.dy=5*Math.sin(e+Math.PI/90)*2,this.parent.addBullet(n),n=new ct(t-i,s-h,5),n.dx=5*Math.cos(e-Math.PI/90)*2,n.dy=5*Math.sin(e-Math.PI/90)*2,this.parent.addBullet(n),this.decrementAmmo(2),ut(1,.05,31,.04,0,.08,1,.17,0,0,0,0,.03,0,0,0,0,.23,.01,0),ut(1,.05,31,.04,0,.08,1,.17,0,0,0,0,.03,0,0,0,0,.23,.01,0)}}shoot3(){this.shoot2(),this.shoot1()}decrementAmmo(t){this.ammo=this.getLayer("hud").decrementAmmo(t)}updateGuns(){const t=this.getLayer("hud").addScore(0);t>1500?this.shots=3:t>500&&(this.shots=2)}updateVelocity(t){let s=0,e=0;t&&(s=t.axes[0],e=t.axes[1],this.inDeadZone(s,e)&&(s=0,e=0));let i=!1;(this.parent.keys.isKeyDown(37)||this.parent.keys.isKeyDown(k))&&(s-=1,i=!0),(this.parent.keys.isKeyDown(39)||this.parent.keys.isKeyDown(A))&&(s+=1,i=!0),(this.parent.keys.isKeyDown(38)||this.parent.keys.isKeyDown(E))&&(e-=1,i=!0),(this.parent.keys.isKeyDown(40)||this.parent.keys.isKeyDown(T))&&(e+=1,i=!0),i&&s&&e&&(s*=lt,e*=lt),this.dx=5*s,this.dy=5*e,this.angle=Math.atan2(e,s)}inDeadZone(t,s){return t*t+s*s<.2*.2}getMouse(){return this.getLayer("hud").mouse}updateAim(t){let s=0,e=0;t&&(s=t.axes[2],e=t.axes[3],this.inDeadZone(s,e)?(s=0,e=0):this.hideCursor());const i=this.getMouse();if(i.isMouseDown){const t=Math.atan2(i.current.y-this.y,i.current.x-this.x);s=Math.cos(t),e=Math.sin(t),this.showCursor()}return this.lastAim.dx=this.aim.dx,this.lastAim.dy=this.aim.dy,this.aim.dx=s,this.aim.dy=e,this.aim.angle=Math.atan2(e,s),this.inDeadZone(this.lastAim.dx,this.lastAim.dy)&&!this.inDeadZone(this.aim.dx,this.aim.dy)?(this.startShooting(),this.shoot()):!this.inDeadZone(this.lastAim.dx,this.lastAim.dy)&&this.inDeadZone(this.aim.dx,this.aim.dy)&&this.stopShooting(),this.lastAim.dx!==s||this.lastAim.dy!==e}explode(){this.exploded||(this.stopShooting(),this.parent.addObject(new U(this.x,this.y,this.radius,5*this.radius)),ut(1,.05,776,0,.21,.83,4,4.8,0,1,0,0,0,.6,.2,.6,0,.94,.09,.41)),this.exploded=!0}update(t){if(this.decrementAmmo(0),this.updateGuns(),!this.exploded){const s=navigator.getGamepads()[0];this.updateVelocity(s);let e=this.updateAim(s);return super.update(t)||e}}center(){return this._center.x=this.x,this._center.y=this.y,this._center}draw(){const t=this.context;this.exploded||(t.beginPath(),t.arc(this.x,this.y,this.radius,0,dt),t.stroke(),t.beginPath(),t.arc(this.x+this.aim.dx*this.radius,this.y+this.aim.dy*this.radius,5,0,dt),t.stroke())}}class pt extends L{constructor(t,s){super(t,s),this.context.strokeStyle=i.player,this.context.fillStyle=i.player,this.context.lineWidth=4,this.context.font="64px serif",this.player=new yt(this.canvas.width/2,this.canvas.height/2,20),this.addObject(this.player),this.keys=new I(window),this.bullets=[]}addBullet(t){this.bullets.push(t),this.addObject(t)}removeBullet(t){y(this.bullets,s=>s===t),this.removeObject(t)}update(t){const s=super.update(t);return this.player.exploded&&this.parent.gameOver(),this.checkForBulletCollisions(),this.checkForEnemyCollisions(),s}checkForBulletCollisions(){const t=this.getLayer("simulation").enemies,s=[];for(const e of this.bullets)for(const i of t){const t=e.radius+i.radius;J(e,i.center())<t*t&&(s.push(e),i.explode())}for(const t of s)this.removeBullet(t)}checkForEnemyCollisions(){const t=this.getLayer("simulation").enemies;for(const s of t){const t=this.player.radius+s.radius;J(this.player,s.center())<t*t&&(s instanceof N?s.absorb():(s.explode(),this.player.explode(),this.parent.gameOver()))}}}class xt extends L{constructor(t,s){super(t,s),this.context.strokeStyle=i.player,this.context.fillStyle=i.player,this.context.lineWidth=4,this.context.font="64px verdana",this.score=0,this.ammo=404,this.scoreSprite=new f("score: 0",50,80),this.scoreSprite.state="visible",this.addObject(this.scoreSprite),this.ammoSprite=new f("ammo: "+this.ammo,this.canvas.width-430,80),this.ammoSprite.state="visible",this.addObject(this.ammoSprite),this.mouse=new S(this.canvas)}addScore(t){return this.isDirty=!0,this.score+=t,this.score}addAmmo(t){return this.isDirty=!0,this.ammo=Math.min(404,this.ammo+t),this.ammo}decrementAmmo(t=1){return this.isDirty=!0,this.ammo=Math.max(0,this.ammo-t),this.ammo}setAmmo(t){this.ammo!=t&&(this.ammo=t,this.isDirty=!0)}getPlayer(){return this.getLayer("player").player}hideText(t){const s=new a(-120,o,t,"y",.25);t.addAction(s),t.state="hiding"}showText(t){const s=new a(120,u,t,"y",.33);t.addAction(s),t.state="unhiding"}updateState(t){"hiding"===t.state&&0===t.actions.length?t.state="hidden":"unhiding"===t.state&&0===t.actions.length&&(t.state="visible")}update(t){this.isDirty&&(this.scoreSprite.setText("score: "+this.score),this.ammoSprite.setText("ammo: "+this.ammo)),this.updateState(this.scoreSprite),this.updateState(this.ammoSprite);let s=this.getPlayer();s.exploded&&(s={x:this.canvas.width,y:this.canvas.height});const e=s.y<160;return e&&s.x<500?"visible"===this.scoreSprite.state&&this.hideText(this.scoreSprite):e&&s.x>this.canvas.width-500?"visible"===this.ammoSprite.state&&this.hideText(this.ammoSprite):"hidden"===this.scoreSprite.state?this.showText(this.scoreSprite):"hidden"===this.ammoSprite.state&&this.showText(this.ammoSprite),super.update(t)}}class mt extends L{constructor(t,s){super(t,s),p(this),this.context.strokeStyle=i.enemies,this.context.fillStyle=i.player,this.context.lineWidth=8,this.context.font="96px verdana",this.context.textAlign="center",this.addAction(new a(1,u,this,"ease",.75)),this.keys=new I(window),this.gameText=new f("GAME",this.canvas.width/2,-120),this.overText=new f("OVER",this.canvas.width/2,this.canvas.height),this.addObject(this.gameText),this.addObject(this.overText),this.addAction(new a(this.canvas.height/2,u,this.gameText,"y",.5)),this.addAction(new a(-this.canvas.height/2,u,this.overText,"y",.5))}showMessage(t){const s=new f(t,this.canvas.width/2,this.canvas.height+120);this.addObject(s),this.addAction(new a(-this.canvas.height/2+120,u,s,"y",1.5))}update(t){super.update(t),this.updateActions(t);const s=navigator.getGamepads()[0];(this.keys.isKeyDown(13)||s&&s.buttons[0].pressed)&&this.parent.start(),this.isDirty=!0}draw(){super.draw();const t=this.context;t.save(),t.font="64px verdana",t.fillStyle=i.enemies;const s=this.canvas.width/2,e=this.canvas.height-80-80;t.fillText("Press Enter or Button 0 to Restart",s,e),t.restore()}}let wt=new class{constructor(){this.gameIsStarted=!1,this.gameIsOver=!1,t.style.background=i.background,this.layer={},this.layers=[],this.highScore=0,this.intro()}addLayer(t){t.parent=this,this.layer[t.name]=t,this.layers.push(t)}resetLayers(){for(const t of this.layers)t.parent=null,t.dispose();this.layers.length=0,this.layer={}}update(t){for(const s of this.layers)s.update(t);this.gameIsStarted&&!this.gameIsOver&&this.layer.player.player.exploded&&this.gameOver()}draw(){for(const t of this.layers)t.draw()}intro(){this.resetLayers(),this.addLayer(new B("intro",0))}start(){this.resetLayers(),h=n,this.addLayer(new _("background",0)),this.addLayer(new at("simulation",1)),this.addLayer(new pt("player",2)),this.addLayer(new xt("hud",3)),this.gameIsOver=!1}gameOver(){if(!this.gameIsOver){n=h,h=0,this.addLayer(new mt("gameover",4)),this.gameIsOver=!0;const t=this.layer.hud.score;t>this.highScore?(this.highScore=t,this.layer.gameover.showMessage(`New High Score: ${t}!!`)):this.layer.gameover.showMessage("Score to Beat: "+this.highScore)}}};new class{constructor(t,s){this.update=t,this.draw=s,this.nextTick=this.tick.bind(this)}start(){const t=this.init.bind(this);window.requestAnimationFrame(t)}init(t){this.lastTimeStamp=t,this.tick(t)}tick(t){let s=(t-this.lastTimeStamp)/1e3;this.lastTimeStamp=t,s>1/15&&(s=1/15),this.update(s),this.draw(),window.requestAnimationFrame(this.nextTick)}}((function(t){wt.update(t)}),(function(){wt.draw()})).start()}();//# sourceMappingURL=script.min.js.map
