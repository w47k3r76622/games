!function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";function i(e){var t=e||{},n=t.emitter,i=t.simulationTimestep||1e3/60,r=t.frameDelta||0,a=t.lastFrameTimeMs||0,o=t.fps||60,s=t.fpsAlpha||.9,h=t.fpsUpdateInterval||1e3,c=t.lastFpsUpdate||0,u=t.framesSinceLastFpsUpdate||0,f=t.numUpdateSteps||0,l=t.minFrameDelay||0,m=t.running||!1,d=t.started||!1,v=t.panic||!1,p=null,y=function(){return m},x=function(){return 1e3/l},g=function(){var e=r;return r=0,e},w=function(){d||(d=!0,p=requestAnimationFrame(function(e){n.emit("RL:render",1),m=!0,a=e,c=e,u=0,p=requestAnimationFrame(L)}))},b=function(){m=!1,d=!1,cancelAnimationFrame(p)},L=function e(t){if(p=requestAnimationFrame(e),!(t<a+l)){for(r+=t-a,a=t,n.emit("RL:begin",t,r),t>c+h&&(o=s*u*1e3/(t-c)+(1-s)*o,c=t,u=0),u+=1,f=0;r>=i;)if(n.emit("RL:update",i),r-=i,++f>=240){v=!0;break}n.emit("RL:render",r/i),n.emit("RL:end",o,v),v=!1}};return{isRunning:y,getMaxAllowedFPS:x,resetFrameDelta:g,start:w,stop:b,animate:L}}function r(e){var t=e||{},n=t.canvas,i=t.emitter,r=t.canvas.getContext("2d"),a=n.width,o=n.height,s=t.containerWindow||window,h=t.ratio||{},c=function(){var e=Math.min(s.innerWidth/a,s.innerHeight/o);n.style.width=a*e+"px",n.style.height=o*e+"px",h.x=a/(a*e),h.y=o/(o*e)},u=function(e,t,n){r.beginPath(),r.arc(e+n,t+n,n,0,2*Math.PI),r.fill(),r.closePath()},f=function(e,t,n,i){r.beginPath(),r.fillRect(e,t,n,i),r.closePath()},l=function(){r.setTransform(1,0,0,1,0,0),r.clearRect(0,0,n.width,n.height)},m=function(e){n.classList.toggle("hide"),setTimeout(function(){n.classList.toggle("hide"),e&&e()},350)},d=function(e){n.classList.toggle("show"),setTimeout(function(){n.classList.toggle("show"),e&&e()},350)};return n.addEventListener("click",function(){this.focus()}),n.addEventListener("contextmenu",function(e){e.preventDefault()}),i.on("CR:heroTouchedEnemy",function(e){n.classList.contains("animating")||(n.classList.add("shake"),n.classList.add("animating"),setTimeout(function(){n.classList.remove("shake")},800),setTimeout(function(){n.classList.remove("animating")},1200))}),c(),s.addEventListener("resize",c),r.imageSmoothingEnabled=!1,{canvas:n,ctx:r,resize:c,ratio:h,drawCircle:u,drawRect:f,reset:l,fadeOut:m,fadeIn:d}}function a(e){var t=e.levelFactory,n=e.emitter,i=e.docWindow||window,r=[],a=1,o=!1,s=!1,h=function(){return 0===r.length&&c(a),r[0]},c=function(){r.push(t.makeLevel(a,3)),a+=1},u=function(){return a-1>3&&!s&&(y(),s=!0),a-1>3},f=function(e,t){u()||h().begin()},l=function(e){u()||h().update(e)},m=function(e){u()||h().render(e)},d=function(e,t){u()||h().end(e,t)},v=function(){o||(o=!0,h().complete(function(){r.pop(),c(a),h().start(),o=!1}))},p=function(){a=1,v(),s=!1},y=function(){var e=new Event("Game:won");e.message="You won!",i.dispatchEvent(e)};return n.on("Level:heroExited",function(){v()}),n.on("CR:heroDied",function(){var e=new Event("Game:lost");e.message="You died",i.dispatchEvent(e)}),i.addEventListener("M:replayBtnPressed",function(){p()}),{begin:f,update:l,render:m,end:d}}function o(e){var t=e||{},n=t.graphics,i=t.camera,r=t.emitter,a=t.soundController,o=t.docWindow||window,s={},h={},c=!0,u=function(e,t){h.x=e-n.canvas.offsetLeft,h.y=t-n.canvas.offsetTop,h.x*=n.ratio.x,h.y*=n.ratio.y,i.screenToWorld(h.x,h.y,h)},f=function(){return s[I.up]||!1},l=function(){return s[I.left]||!1},m=function(){return s[I.right]||!1},d=function(){return s[I.down]||!1},v=function(){return s[I.dash]||!1},p=function(){return c},y=function(e){s[e.code]=!1},x=function(e){if(s[e.code]=!0,e.code===I.dash&&e.target===n.canvas&&e.preventDefault(),e.code===I.pause){c=!c;var t=new Event("GIC:gamePauseToggled");o.dispatchEvent(t)}p()||r.emit("GIC:keydown",e),e.code===I.mute&&(a.muted=!a.muted)},g=function(){c=!c},w=function(e){u(e.clientX,e.clientY)},b=function(e){u(e.clientX,e.clientY),h.down=!0,p()||r.emit("GIC:mousedown",h)},L=function(e){u(e.clientX,e.clientY),h.down=!1},E=function(){o.removeEventListener("keyup",y),o.removeEventListener("keydown",x),o.removeEventListener("M:playBtnPressed",g),n.canvas.removeEventListener("mousemove",w),n.canvas.removeEventListener("mousedown",b),n.canvas.removeEventListener("mouseup",L)};return o.addEventListener("keyup",y),o.addEventListener("keydown",x),o.addEventListener("M:playBtnPressed",g),n.canvas.addEventListener("mousemove",w),n.canvas.addEventListener("mousedown",b),n.canvas.addEventListener("mouseup",L),{isUp:f,isLeft:l,isDown:d,isRight:m,isDash:v,isPaused:p,mouse:h,unregisterListeners:E,togglePause:g}}function s(e,t,n,i){this.x=e,this.y=t,this.width=n,this.height=i}function h(e){var t=e||{};return new s(t.x||0,t.y||0,t.width||0,t.height||0)}function c(e,t,n,i){this.type=e,this.health=t,this.totalHealth=t,this.damage=n,this.status=i}function u(e){var t=e||{};return new c(t.type||P.none,t.health||0,t.damage||0,void 0===t.status?Y.active|Y.visible:Y.none)}function f(e){var t=e||{};t.type=t.type||P.hero;var n=t.graphics,i=t.gameInputController,r=t.emitter,a=t.meta||u(t),o=t.frame||h(t),s=t.speed||.32,c=t.dashTimeout||3e3,f=t.dashLength||500,l=t.ammunition||[],m=null,d=!1,v=null,p=1,y=function(){return d&&!v?(p=.1,v=setTimeout(function(){p=v%2==0?1:.1,v=null},100)):p=1,p},x=function(e){if(0!=(a.status&Y.active)){var t=d?2*s:s;i.isUp()?o.y-=e*t:i.isDown()&&(o.y+=e*t),i.isRight()?o.x+=e*t:i.isLeft()&&(o.x-=e*t)}},g=function(){0!=(a.status&Y.visible)&&(n.ctx.save(),n.ctx.fillStyle="white",n.ctx.globalAlpha=y(),n.drawCircle(o.x,o.y,o.width/2),n.ctx.restore())},w=function(e){!m&&i.isDash()&&(a.status|=Y.invulnerable,d=!0,r.emit("Hero:isDashing"),setTimeout(function(){d=!1,a.status&=~Y.invulnerable},f),m=setTimeout(function(){m=null},c))},b=function(e){if(r.emit("Hero:onMouseDown",l),!(l.length<=0)){l.pop().fire(e.x,e.y)}},L=function(e){l.push(e)},E=function(){r.removeListener("GIC:keydown",w),r.removeListener("GIC:mousedown",b),r.removeListener("CR:heroTouchedProj",L)};return r.on("GIC:keydown",w),r.on("GIC:mousedown",b),r.on("CR:heroTouchedProj",L),{frame:o,update:x,render:g,meta:a,ammunition:l,unregisterListeners:E}}function l(e){var t=e||{},n=t.graphics,i=t.maxX||1e3,r=t.maxY||1e3,a=t.distance||1e3,o=t.fieldOfView||Math.PI/4,s=t.viewportOffset||10,h=t.lookat||{x:0,y:0},c=t.viewport||{left:0,right:0,top:0,bottom:0,width:0,height:0,scale:{x:0,y:0}},u=t.aspectRatio||1,f=function(){u=n.canvas.width/n.canvas.height,c.width=a*Math.tan(o),c.height=c.width/u,c.left=h.x-c.width/2-s,c.top=h.y-c.height/2-s,c.right=c.left+c.width,c.bottom=c.top+c.height,c.scale.x=n.canvas.width/c.width,c.scale.y=n.canvas.height/c.height},l=function(){n.ctx.save(),n.ctx.scale(c.scale.x,c.scale.y),n.ctx.translate(-c.left,-c.top)},m=function(){n.ctx.restore()},d=function(e){a=e,f()},v=function(e,t){h.x=e,h.y=t,f()},p=function(e,t,n){return n=n||{},n.x=e/c.scale.x+c.left,n.y=t/c.scale.y+c.top,n},y=function(e,t,n){return n=n||{},n.x=(e-c.left)*c.scale.x,n.y=(t-c.top)*c.scale.y,n},x=function(e){h.x=z(e.x,c.width/2,i-c.width/2),h.y=z(e.y,c.height/2,r-c.height/2),f()};return f(),{follow:x,begin:l,end:m,updateViewport:f,zoomTo:d,moveTo:v,screenToWorld:p,worldToScreen:y,viewport:c}}function m(e){var t=e||{},n=t.graphics,i=t.maze,r=i[0].length,a=i.length,o=t.tileSize||200,s=t.exit||{row:F(0,a),col:r-1};i[s.row][s.col]=B.none;var h=function(){return Math.ceil(o/8)},c=function(e,t){var n=o*t,r=o*e,a=i[e][t],s=h(),c=Math.ceil(s/2),u=[];return 0===a?u:(0==(a&B.n)&&u.push({x:n,y:r-c,width:o,height:s}),0==(a&B.s)&&u.push({x:n,y:r+o-c,width:o,height:s}),0==(a&B.e)&&u.push({x:n+o-c,y:r-c,width:s,height:o+s}),0==(a&B.w)&&u.push({x:n-c,y:r-c,width:s,height:o+s}),u)},u=function(){for(var e={},t=0;t<a;++t)for(var n=0;n<r;++n)e[t+","+n]=c(t,n);return e}(),f=function(){return Object.keys(u).reduce(function(e,t){return u[t].forEach(function(t){return e.push(d(t))}),e},[])}(),l=function(){for(var e={},t=0;t<a;++t)!function(t){for(var n=0;n<r;++n)!function(n){var i=u[t+","+n];e[t+","+n]=[],i.forEach(function(i){var r={x1:i.x,x2:i.x+i.width,y1:i.y,y2:i.y},a={x1:i.x,x2:i.x,y1:i.y,y2:i.y+i.height},o={x1:i.x+i.width,x2:i.x+i.width,y1:i.y,y2:i.y+i.height},s={x1:i.x,x2:i.x+i.width,y1:i.y+i.height,y2:i.y+i.height};e[t+","+n]=e[t+","+n].concat([r,a,o,s])})}(n)}(t);return e}(),m=function(e,t){return l[e+","+t]},v=function(e){return{minRow:Math.max(Math.floor(e.top/o),0),maxRow:Math.min(Math.floor(e.bottom/o),a-1),minCol:Math.max(Math.floor(e.left/o),0),maxCol:Math.min(Math.floor(e.right/o),r-1)}},p=function(e,t){n.ctx.save(),n.ctx.fillStyle="#0D0049",u[e+","+t].forEach(function(e){n.drawRect(e.x,e.y,e.width,e.height)}),n.ctx.restore()};return{cols:r,rows:a,tileSize:o,render:function(e){for(var t=Math.max(Math.floor(e.top/o),0),n=Math.min(Math.floor(e.bottom/o),a-1),i=Math.max(Math.floor(e.left/o),0),s=Math.min(Math.floor(e.right/o),r-1),h=t;h<=n;++h)for(var c=i;c<=s;++c)p(h,c)},wallDimension:h,walls:f,linesAt:m,rowsAndColsInViewport:v}}function d(e){var t=e||{};return t.type=t.type||P.wall,{frame:h(t),meta:u(t)}}function v(){var e=function e(t,n,i){X(B.dirs).forEach(function(r){var a=t+B.dx[r],o=n+B.dy[r];o>=0&&o<i.length&&a>=0&&a<i[o].length&&0===i[o][a]&&(i[n][t]|=B[r],i[o][a]|=B.opposite[r],e(a,o,i))})};return{generate:function(t,n,i,r,a){for(var o=i||0,s=r||0,h=a||.09,c=[],u=0;u<t;++u){for(var f=[],l=0;l<n;++l)f.push(0);c.push(f)}e(o,s,c);for(var m=1;m<t-1;++m)for(var d=1;d<n-1;++d)Math.random()<h&&(c[m][d]=B.none);return c}}}function p(e,t,n){this.maxItems=e,this.depth=t,this.bounds=n,this.items=[],this.nodes=[]}function y(e){var t=e||{};return new p(t.maxItems||30,t.depth||0,t.bounds||h(t))}function x(e){var t=e||{},n=t.emitter,i=function(e,t){return e.type===P.hero&&t.type===P.arrow||e.type===P.hero&&t.type===P.enemy&&0!=(e.status&Y.invulnerable)||e.type===P.enemy&&t.type===P.hero&&0!=(t.status&Y.invulnerable)||0==(t.status&Y.active)||0==(e.status&Y.active)||e.type===P.enemy&&t.type===P.enemyArrow||e.type===P.enemyArrow&&t.type===P.enemy||e.type===P.enemyArrow&&t.type===P.enemyArrow},r=function(e,t){e.meta.type===P.arrow&&t.meta.type===P.wall?e.meta.status&=~Y.active:e.meta.type===P.arrow&&t.meta.type===P.hero?0==(e.meta.status&Y.active)&&0!=(e.meta.status&Y.visible)&&(e.meta.status&=~Y.visible,n.emit("CR:heroTouchedProj",e)):e.meta.type===P.arrow&&t.meta.type===P.enemy?(0!=(e.meta.status&Y.active)&&(t.meta.health-=e.meta.damage),t.meta.health<=0&&0!=(t.meta.status&Y.active)&&(t.meta.status&=~Y.visible,t.meta.status&=~Y.active,n.emit("CR:enemyDied",t))):e.meta.type===P.enemy&&t.meta.type===P.hero?(0!=(e.meta.status&Y.active)&&0!=(t.meta.status&Y.active)&&0==(t.meta.status&Y.invulnerable)&&(t.meta.health-=e.meta.damage,n.emit("CR:heroTouchedEnemy",e)),t.meta.health<=0&&0!=(t.meta.status&Y.active)&&(t.meta.status&=~Y.visible,t.meta.status&=~Y.active,n.emit("CR:heroDied",e))):e.meta.type===P.enemyArrow&&t.meta.type===P.wall?(e.meta.status&=~Y.active,e.meta.status&=~Y.visible):e.meta.type===P.enemyArrow&&t.meta.type===P.hero&&(0!=(e.meta.status&Y.active)&&0!=(t.meta.status&Y.active)&&0==(t.meta.status&Y.invulnerable)&&(t.meta.health-=e.meta.damage,n.emit("CR:heroTouchedEnemy",e),e.meta.status&=~Y.active,e.meta.status&=~Y.visible),t.meta.health<=0&&0!=(t.meta.status&Y.active)&&(t.meta.status&=~Y.visible,t.meta.status&=~Y.active,n.emit("CR:heroDied",e)))};return{resolve:function(e,t){t.forEach(function(t){if(e!==t&&t.meta.type!==P.none){var n=i(e.meta,t.meta),a=e.frame.maxY()-t.frame.y,o=t.frame.maxY()-e.frame.y,s=t.frame.maxX()-e.frame.x,h=e.frame.maxX()-t.frame.x,c=!1;o<a&&o<s&&o<h?(n||(e.frame.y=t.frame.maxY()),c=!0):a<o&&a<s&&a<h?(n||(e.frame.y=t.frame.y-e.frame.maxY()+e.frame.y),c=!0):s<h&&s<o&&s<a?(n||(e.frame.x=t.frame.maxX()),c=!0):h<s&&h<o&&h<a&&(n||(e.frame.x=t.frame.x-e.frame.maxX()+e.frame.x),c=!0),c&&r(e,t)}})}}}function g(e){var t=e||{},n=t.graphics,i=t.movementBehavior,r=t.attackBehavior,a=t.frame||h(t),o=t.meta||u(t),s=t.fillStyle||"#DB2E1B";return{frame:a,update:function(e){0!=(o.status&Y.active)&&(i.update(e),r&&r.update())},render:function(e){a.intersectsViewport(e)&&0!=(o.status&Y.visible)&&(n.ctx.save(),n.ctx.fillStyle=s,n.drawCircle(a.x,a.y,a.width/2),n.ctx.restore())},meta:o}}function w(e){var t=e||{},n=t.frame,i=t.targetFrame,r=t.speed||.31,a={x:n.x,y:n.y},o={x:i.centerX(),y:i.centerY()},s=t.actionDistance||250,h=t.randomness||.04,c=t.direction||B.none,u=function(e){o.x=i.centerX()-n.centerX(),o.y=i.centerY()-n.centerY();var t=Math.hypot(o.x,o.y);t<s?(o.x/=t,o.y/=t,n.x+=o.x*r*e,n.y+=o.y*r*e):f(e),n.x===a.x&&n.y===a.y&&(c=l()),a.x=n.x,a.y=n.y},f=function(e){c===B.none&&(c=l()),0!=(c&B.n)?n.y-=e*r:0!=(c&B.s)&&(n.y+=e*r),0!=(c&B.e)?n.x+=e*r:0!=(c&B.w)&&(n.x-=e*r),Math.random()<h&&(c|=l())},l=function(){return B[B.dirs[F(0,B.dirs.length)]]};return{update:u}}function b(e){var t=e||{},n=t.sourceFrame,i=t.renderer,r=t.frame||h(t),a=t.meta||u(t),o=t.speed||1.2,s={};return{frame:r,fire:function(e,t){a.status|=Y.active|Y.visible,r.centerTo(n),s.x=e-r.centerX(),s.y=t-r.centerY(),s.angle=Math.atan2(s.y,s.x);var i=Math.hypot(s.x,s.y);s.x/=i,s.y/=i},update:function(e){0!=(a.status&Y.active)&&(r.x+=s.x*o*e,r.y+=s.y*o*e)},render:function(){0!=(a.status&Y.visible)&&i.render(s.angle)},meta:a}}function L(e){var t=e||{},n=t.graphics,i=t.frame,r=t.arrowLength||15,a=t.arrowThickness||11;return{render:function(e){n.ctx.save(),n.ctx.translate(i.centerX(),i.centerY()),n.ctx.rotate(e);var t=i.width/2,o=i.height/2;n.ctx.fillStyle="#0D0049",n.drawRect(-t-r,a/2-o,i.width+r,i.height-a),n.ctx.beginPath(),n.ctx.moveTo(0,-o),n.ctx.lineTo(0,o),n.ctx.lineTo(i.width,0),n.ctx.fill(),n.ctx.restore()}}}function E(e){var t=e||{},n=t.target,i=t.graphics,r=t.map,a=[],o=function(e,t){var i=e.x,r=e.y,a=e.x-n.frame.centerX(),o=e.y-n.frame.centerY(),s=t.x1,h=t.y1,c=t.x2-t.x1,u=t.y2-t.y1;if(a*u==o*c)return null;var f=c*o-u*a;if(0===f)return null;var l=(a*(h-r)+o*(i-s))/f,m=0===a?(h+u*l-r)/o:(s+c*l-i)/a;return m<0||l<0||l>1?null:{x:i+a*m,y:r+o*m,t1:m}};return{calculateIntersections:function(e){a.splice(0,a.length);var t=[],i=r.rowsAndColsInViewport(e);t.push({x1:e.left,x2:e.right,y1:e.top,y2:e.top}),t.push({x1:e.left,x2:e.left,y1:e.top,y2:e.bottom}),t.push({x1:e.right,x2:e.right,y1:e.top,y2:e.bottom}),t.push({x1:e.left,x2:e.right,y1:e.bottom,y2:e.bottom});for(var s=i.minRow;s<=i.maxRow;++s)for(var h=i.minCol;h<=i.maxCol;++h){var c=r.linesAt(s,h);c.forEach(function(e){t.push(e)})}(function(e){var t={},i=[];return e.forEach(function(e){var r=e.x1+","+e.y1,a=e.x2+","+e.y2;if(!t[r]){t[r]=!0;var o=Math.atan2(e.y1-n.frame.centerY(),e.x1-n.frame.centerX());i.push(o-1e-5,o,o+1e-5)}if(!t[a]){t[a]=!0;var s=Math.atan2(e.y2-n.frame.centerY(),e.x2-n.frame.centerX());i.push(s-1e-5,s,s+1e-5)}}),i})(t).forEach(function(e){var i={x:n.frame.centerX()+Math.cos(e),y:n.frame.centerY()+Math.sin(e)},r={t1:1/0};t.forEach(function(e){var t=o(i,e);t&&t.t1<r.t1&&(r=t)}),r!==1/0&&(r.angle=e,a.push(r))}),a.sort(function(e,t){return e.angle-t.angle})},render:function(){i.ctx.save(),i.ctx.fillStyle="#FCD422",i.ctx.globalCompositeOperation="destination-atop",i.ctx.globalAlpha=1,i.ctx.beginPath(),a.forEach(function(e,t){t?i.ctx.lineTo(e.x,e.y):i.ctx.moveTo(e.x,e.y)}),i.ctx.closePath(),i.ctx.fill(),i.ctx.restore()}}}function M(e){var t=e.emitter,n=e.gameInputController,i=e.hero,r=e.enemies,a=e.projectiles,o=e.enemyProjectiles,s=e.quadtree,h=e.map,c=e.collisionResolver,u=e.graphics,f=e.camera,l=e.light,m=e.hud,d={};return d.isStarted=!1,d.zoomStart=h.cols*h.tileSize+h.wallDimension(),{begin:function(e,n){i.frame.intersectsViewport(f.viewport)||t.emit("Level:heroExited")},update:function(e){if(!n.isPaused()){if(!d.isStarted)return f.zoomTo(d.zoomStart),d.zoomStart-=55,void(d.zoomStart<=1e3&&(d.isStarted=!0));i.update(e),r.forEach(function(t){t.update(e)}),a.forEach(function(t){t.update(e)}),o.forEach(function(t){t.update(e)}),m.update(e),s.insert(i),a.forEach(function(e){s.insert(e)}),o.forEach(function(e){s.insert(e)}),r.forEach(function(e){s.insert(e)}),h.walls.forEach(function(e){s.insert(e)});var t=s.query(i.frame);c.resolve(i,t),r.forEach(function(e){var t=s.query(e.frame);c.resolve(e,t)}),a.forEach(function(e){var t=s.query(e.frame);c.resolve(e,t)}),o.forEach(function(e){var t=s.query(e.frame);c.resolve(e,t)})}},render:function(e){u.reset(),f.begin(),f.follow(i.frame),d.isStarted&&(o.forEach(function(e){e.render()}),r.forEach(function(e){e.render(f.viewport)}),a.forEach(function(e){e.render()}),l.calculateIntersections(f.viewport),l.render(),i.render()),h.render(f.viewport),f.end(),m.render()},end:function(e,t){s.removeAll()},start:function(e){u.fadeIn(e),n.togglePause()},complete:function(e){u.fadeOut(e),n.unregisterListeners(),i.unregisterListeners(),m.unregisterListeners()}}}function _(e){var t=e||{},n=t.emitter,i=t.graphics,r=t.hero,a=t.level,o=t.maxLevels,s=h({x:20,y:i.canvas.height-60,width:160,height:40}),c=h({x:20,y:i.canvas.height-60,width:160,height:40}),u=h({x:200,y:i.canvas.height-60,width:160,height:40}),f=h({x:200,y:i.canvas.height-60,width:160,height:40}),l=h({x:i.canvas.width-80,y:i.canvas.height-15,width:60,height:40}),m=function(e){s.width=Math.max(r.meta.health/r.meta.totalHealth*160,0),u.width=Math.min(160,u.width+.92)},d=function(){u.width=0},v=function(e){i.ctx.save(),i.ctx.globalAlpha=.8,i.ctx.fillStyle="#00000C",i.drawRect(c.x,c.y,c.width,c.height),i.drawRect(f.x,f.y,f.width,f.height),i.ctx.fillStyle="#DB2E1B",i.drawRect(s.x,s.y,s.width,s.height),i.ctx.fillStyle="#28DB68",i.drawRect(u.x,u.y,u.width,u.height),i.ctx.fillStyle="white",i.ctx.font='28px "Helvetica Neue", Helvetica, Sans-Serif',i.ctx.textBaseline="bottom",i.ctx.fillText(a+" / "+o,l.x,l.y),i.ctx.restore()},p=function(){n.removeListener("Hero:isDashing",d)};return n.on("Hero:isDashing",d),{update:m,render:v,unregisterListeners:p}}function C(e){var t=e||{},n=t.frame,i=t.targetFrame,r=t.emitter,a=t.actionDistance||350,o=t.fireLikelihood||.02,s=t.ammunition||[],h={};h.currentAmmoIndex=0,h.fireCooldownTimerId=null;var c=function(){var e=h.currentAmmoIndex;return h.currentAmmoIndex=(e+1)%s.length,e};return{update:function(){var e=i.centerX()-n.centerX(),t=i.centerY()-n.centerY();Math.hypot(e,t)<a&&!h.fireCooldownTimerId&&Math.random()<o&&(s[c()].fire(i.centerX(),i.centerY()),r.emit("Enemy:didFire"),h.fireCooldownTimerId=setTimeout(function(){h.fireCooldownTimerId=null},1e3))}}}function S(e){var t=e.graphics,n=e.frame;return{render:function(){t.ctx.save(),t.ctx.fillStyle="#0D0049",t.drawCircle(n.x,n.y,n.width/2),t.ctx.restore()}}}function T(e){var t=e||{},n=t.emitter,i=t.graphics,r=t.soundController,a=t.enemySpawnLikelihood||.08;return{makeLevel:function(e,t){for(var s=v(),c=m({graphics:i,maze:s.generate(20,20,F(20),F(20))}),u=l({graphics:i,maxX:c.cols*c.tileSize+c.wallDimension(),maxY:c.rows*c.tileSize+c.wallDimension(),viewportOffset:c.wallDimension()/2}),d=o({graphics:i,camera:u,emitter:n,soundController:r}),p=h({x:20,y:20,width:27,height:27}),T=[],R=0;R<5;++R){var D=h({x:0,y:0,width:15,height:15}),k=L({graphics:i,frame:D}),A=b({frame:D,renderer:k,sourceFrame:p,graphics:i,type:P.arrow,status:Y.none,damage:1});T.push(A)}for(var I=f({graphics:i,frame:p,health:120,gameInputController:d,emitter:n,ammunition:[].concat(T)}),z=[],X=[],B=0;B<c.rows;++B)for(var j=0;j<c.cols;++j)if(!(B<4&&j<4)){var O=a+a*(e/t);if(!(O<Math.random())){var q=c.tileSize*j+c.tileSize/2,G=c.tileSize*B+c.tileSize/2;if(Math.random()>.4){for(var H=h({x:q,y:G,width:40,height:40}),U=w({frame:H,targetFrame:I.frame,speed:.09}),W=h({x:0,y:0,width:15,height:15}),V=S({graphics:i,frame:W}),K=[],N=0;N<3;++N){var J=b({frame:W,renderer:V,sourceFrame:H,graphics:i,type:P.enemyArrow,status:Y.none,damage:20,speed:.51});K.push(J),X.push(J)}var Q=C({frame:H,targetFrame:I.frame,ammunition:K,emitter:n}),Z=g({graphics:i,frame:H,movementBehavior:U,attackBehavior:Q,health:6,damage:1,type:P.enemy});z.push(Z)}else{var $=h({x:q,y:G,width:25,height:25}),ee=w({frame:$,targetFrame:I.frame}),te=g({graphics:i,frame:$,movementBehavior:ee,health:1,damage:1,type:P.enemy});z.push(te)}}}var ne=y({x:-c.tileSize,y:-c.tileSize,width:c.cols*c.tileSize+2*c.tileSize,height:c.rows*c.tileSize+2*c.tileSize}),ie=x({emitter:n}),re=E({x:0,y:0,width:i.canvas.width,height:i.canvas.height,target:I,graphics:i,map:c}),ae=_({emitter:n,graphics:i,hero:I,level:e,maxLevels:t});return M({emitter:n,gameInputController:d,soundController:r,hero:I,enemies:z,projectiles:T,enemyProjectiles:X,quadtree:ne,map:c,collisionResolver:ie,graphics:i,camera:u,light:re,hud:ae})}}}function R(e){this.muted=e}function D(e){var t=new R(!1),n=e.emitter,i=null;return n.on("Hero:onMouseDown",function(e){e.length?t.play(q.hero.fire[F(0,q.hero.fire.length)]):t.play(q.hero.fireEmpty[F(0,q.hero.fireEmpty.length)])}),n.on("Hero:isDashing",function(){t.play(q.hero.dash[F(0,q.hero.dash.length)])}),n.on("CR:heroTouchedProj",function(){t.play(q.hero.pickup[F(0,q.hero.pickup.length)])}),n.on("CR:heroTouchedEnemy",function(){i||(i=setTimeout(function(){t.play(q.hero.hurt[F(0,q.hero.hurt.length)]),i=null},300))}),n.on("CR:enemyDied",function(){t.play(q.enemy.died[F(0,q.enemy.died.length)])}),n.on("CR:heroDied",function(){t.play(q.hero.died)}),n.on("Enemy:didFire",function(){t.play(q.enemy.fire)}),t}Object.defineProperty(t,"__esModule",{value:!0});var k=n(1),A=n.n(k),I=Object.freeze({up:"KeyW",left:"KeyA",down:"KeyS",right:"KeyD",pause:"KeyP",mute:"KeyM",dash:"Space"});s.prototype.centerX=function(){return this.x+this.width/2},s.prototype.centerY=function(){return this.y+this.height/2},s.prototype.maxX=function(){return this.x+this.width},s.prototype.maxY=function(){return this.y+this.height},s.prototype.intersects=function(e){return this.x<=e.maxX()&&this.maxX()>=e.x&&this.y<=e.maxY()&&this.maxY()>=e.y},s.prototype.intersectsViewport=function(e){return this.x<=e.right&&this.maxX()>=e.left&&this.y<=e.bottom&&this.maxY()>=e.top},s.prototype.contains=function(e){return e.maxX()<=this.maxX()&&e.x>=this.x&&e.maxY()<=this.maxY()&&e.y>=this.y},s.prototype.containsPoint=function(e,t){return this.x<=e&&this.maxX()>=e&&this.y<=t&&this.maxY()>=t},s.prototype.centerTo=function(e){return this.x=e.x+(e.width-this.width)/2,this.y=e.y+(e.height-this.height)/2,this};var P=Object.freeze({none:0,hero:1,wall:2,arrow:3,enemy:4,enemyArrow:5}),Y=Object.freeze({none:0,active:1,visible:2,invulnerable:4}),z=function(e,t,n){return Math.min(Math.max(e,t),n)},X=function(e){for(var t=e.length;t>0;){var n=Math.floor(Math.random()*t);t-=1;var i=e[t];e[t]=e[n],e[n]=i}return e},F=function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e))+e},B=Object.freeze({none:0,n:1,s:2,e:4,w:8,dirs:["n","s","e","w"],dx:{e:1,w:-1,n:0,s:0},dy:{e:0,w:0,n:-1,s:1},opposite:{e:8,w:4,n:2,s:1}});p.prototype.removeAll=function(){this.items.splice(0,this.items.length),this.nodes.forEach(function(e){e.removeAll()}),this.nodes.splice(0,this.nodes.length)},p.prototype.subDivide=function(){var e=Math.floor(this.bounds.width/2),t=Math.floor(this.bounds.height/2),n=this.bounds.x,i=this.bounds.y,r=y({depth:this.depth+1,x:n+e,y:i,width:e,height:t});this.nodes.push(r);var a=y({depth:this.depth+1,x:n,y:i,width:e,height:t});this.nodes.push(a);var o=y({depth:this.depth+1,x:n,y:i+t,width:e,height:t});this.nodes.push(o);var s=y({depth:this.depth+1,x:n+e,y:i+t,width:e,height:t});this.nodes.push(s)},p.prototype.insert=function(e){if(!this.bounds.contains(e.frame))return!1;if(this.items.length<this.maxItems)return this.items.push(e),!0;0===this.nodes.length&&this.subDivide();var t=!1;return this.nodes.forEach(function(n){!t&&n.insert(e)&&(t=!0)}),!!t||(this.items.push(e),!0)},p.prototype.query=function(e){var t=[];return this.bounds.contains(e)?(this.items.forEach(function(n){n.frame.intersects(e)&&t.push(n)}),this.nodes.forEach(function(n){if(n.bounds.intersects(e)){n.query(e).forEach(function(e){t.push(e)})}}),t):t};var j=n(2),O=n.n(j);R.prototype.play=function(e){if(!this.muted){var t=new Audio;t.src=e,t.play()}};var q=Object.freeze({hero:{fire:[O()([2,,.138,.2833,.3363,.8296,.3507,-.3135,,,,,,.3683,.0045,,,,1,,,.1446,,.5]),O()([2,,.1096,.2833,.3363,.8697,.3609,-.2655,-.0371,,.0505,-.0091,,.3119,.0139,.0224,,-.0162,1,,.0403,.1926,.0421,.5]),O()([2,,.1251,.2802,.3448,.8455,.3976,-.3491,.0315,,.0088,,,.2863,9e-4,,-.0659,.0129,.9717,.0212,.0236,.1267,-.0284,.5])],fireEmpty:[O()([3,,.0451,,.287,.3837,,-.5973,,,,,,,,,,,1,,,.0039,,.44]),O()([3,,.0451,.0344,.2436,.3837,,-.5575,.0192,,,,,,.043,,.0443,,.9888,.0214,,.0213,.013,.31])],dash:[O()([0,,.3845,,.2544,.543,,.1433,,,,,,.3354,,,,,.6125,,,,,.35]),O()([0,,.4298,,.311,.6176,.018,.1433,.0482,,,.0041,.0496,.3003,.0458,,.04,.007,.6125,,8e-4,.0115,-.0065,.35])],pickup:[O()([0,,.0101,.5708,.2528,.5521,,,,,,.3545,.5621,,,,,,1,,,,,.5]),O()([0,.0074,.01,.6028,.2642,.5521,.038,,-.0054,,,.3896,.5173,.0287,-.0159,.0239,,-.0176,.9738,,,.036,.0484,.5])],hurt:[O()([3,,.1216,.4737,.3359,.0444,,.0488,,,,,,,,,.102,-.1476,1,,,,,.35]),O()([3,,.1114,.4446,.3265,.0391,,.0088,-.03,,,.0264,,,-.0284,.0162,.102,-.1667,1,,.0309,.0422,.0105,.35])],died:O()([3,,.2485,.5029,.4305,.2722,,-.2421,,,,,,,,.449,,,1,,,,,.5])},enemy:{died:[O()([0,.0355,.0514,,.1975,.2944,,-.2884,.0285,,,,,.3462,-.0323,,-.0342,-.0466,.9699,-.0228,,,.0472,.5]),O()([0,,.0778,,.1975,.2944,.0156,-.2884,.0285,,,,,.3293,-.0323,,-.0378,-.0848,.9699,-.0104,.0358,,.0814,.5])],fire:O()([2,,.132,.1027,.1289,.4003,.015,-.369,,,,,,.6463,-.323,,,,1,,,.1872,,.5])}});document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("canvas"),t=new A.a,n=r({canvas:e,emitter:t}),o=D({emitter:t}),s=i({emitter:t}),h=T({emitter:t,graphics:n,soundController:o}),c=a({emitter:t,levelFactory:h});t.on("RL:begin",function(e,t){c.begin(e,t)}),t.on("RL:update",function(e){c.update(e)}),t.on("RL:render",function(e){c.render(e)}),t.on("RL:end",function(e,t){c.end(e,t)}),document.addEventListener("visibilitychange",function(e){(document.hidden||"visible"!==document.visibilityState)&&s.isRunning()?s.stop():document.hidden||"visible"!==document.visibilityState||s.isRunning()||s.start()}),document.hidden||"visible"!==document.visibilityState||s.start()});n(3),n(4)},function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function r(e){return"number"==typeof e}function a(e){return"object"==typeof e&&null!==e}function o(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!r(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,r,s,h,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}if(n=this._events[e],o(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),n.apply(this,s)}else if(a(n))for(s=Array.prototype.slice.call(arguments,1),c=n.slice(),r=c.length,h=0;h<r;h++)c[h].apply(this,s);return!0},n.prototype.addListener=function(e,t){var r;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,a(this._events[e])&&!this._events[e].warned&&(r=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,r,o,s;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,r=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(a(n)){for(s=o;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){r=s;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],i(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,n){function i(){this.setSettings=function(e){for(var t=0;t<24;t++)this[String.fromCharCode(97+t)]=e[t]||0;this.c<.01&&(this.c=.01);var n=this.b+this.c+this.e;if(n<.18){var i=.18/n;this.b*=i,this.c*=i,this.e*=i}}}function r(){this._params=new i;var e,t,n,r,a,o,s,h,c,u,f,l;this.reset=function(){var e=this._params;r=100/(e.f*e.f+.001),a=100/(e.g*e.g+.001),o=1-e.h*e.h*e.h*.01,s=-e.i*e.i*e.i*1e-6,e.a||(f=.5-e.n/2,l=5e-5*-e.o),h=1+e.l*e.l*(e.l>0?-.9:10),c=0,u=1==e.m?0:(1-e.m)*(1-e.m)*2e4+32},this.totalReset=function(){this.reset();var i=this._params;return e=i.b*i.b*1e5,t=i.c*i.c*1e5,n=i.e*i.e*1e5+12,3*((e+t+n)/3|0)},this.synthWave=function(i,m){var d=this._params,v=1!=d.s||d.v,p=d.v*d.v*.1,y=1+3e-4*d.w,x=d.s*d.s*d.s*.1,g=1+1e-4*d.t,w=1!=d.s,b=d.x*d.x,L=d.g,E=d.q||d.r,M=d.r*d.r*d.r*.2,_=d.q*d.q*(d.q<0?-1020:1020),C=d.p?32+((1-d.p)*(1-d.p)*2e4|0):0,S=d.d,T=d.j/2,R=d.k*d.k*.01,D=d.a,k=e,A=1/e,I=1/t,P=1/n,Y=5/(1+d.u*d.u*20)*(.01+x);Y>.8&&(Y=.8),Y=1-Y;for(var z,X,F,B,j,O,q=!1,G=0,H=0,U=0,W=0,V=0,K=0,N=0,J=0,Q=0,Z=0,$=new Array(1024),ee=new Array(32),te=$.length;te--;)$[te]=0;for(var te=ee.length;te--;)ee[te]=2*Math.random()-1;for(var te=0;te<m;te++){if(q)return te;if(C&&++Q>=C&&(Q=0,this.reset()),u&&++c>=u&&(u=0,r*=h),o+=s,r*=o,r>a&&(r=a,L>0&&(q=!0)),X=r,T>0&&(Z+=R,X*=1+Math.sin(Z)*T),X|=0,X<8&&(X=8),D||(f+=l,f<0?f=0:f>.5&&(f=.5)),++H>k)switch(H=0,++G){case 1:k=t;break;case 2:k=n}switch(G){case 0:U=H*A;break;case 1:U=1+2*(1-H*I)*S;break;case 2:U=1-H*P;break;case 3:U=0,q=!0}E&&(_+=M,F=0|_,F<0?F=-F:F>1023&&(F=1023)),v&&y&&(p*=y,p<1e-5?p=1e-5:p>.1&&(p=.1)),O=0;for(var ne=8;ne--;){if(++N>=X&&(N%=X,3==D))for(var ie=ee.length;ie--;)ee[ie]=2*Math.random()-1;switch(D){case 0:j=N/X<f?.5:-.5;break;case 1:j=1-N/X*2;break;case 2:B=N/X,B=6.28318531*(B>.5?B-1:B),j=1.27323954*B+.405284735*B*B*(B<0?1:-1),j=.225*((j<0?-1:1)*j*j-j)+j;break;case 3:j=ee[Math.abs(32*N/X|0)]}v&&(z=K,x*=g,x<0?x=0:x>.1&&(x=.1),w?(V+=(j-K)*x,V*=Y):(K=j,V=0),K+=V,W+=K-z,W*=1-p,j=W),E&&($[J%1024]=j,j+=$[(J-F+1024)%1024],J++),O+=j}O*=.125*U*b,i[te]=O>=1?32767:O<=-1?-32768:32767*O|0}return m}}var a=new r,o=function(e){a._params.setSettings(e);var t=a.totalReset(),n=new Uint8Array(4*((t+1)/2|0)+44),i=2*a.synthWave(new Uint16Array(n.buffer,44),t),r=new Uint32Array(n.buffer,0,44);r[0]=1179011410,r[1]=i+36,r[2]=1163280727,r[3]=544501094,r[4]=16,r[5]=65537,r[6]=44100,r[7]=88200,r[8]=1048578,r[9]=1635017060,r[10]=i,i+=44;for(var o=0,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h="data:audio/wav;base64,";o<i;o+=3){var c=n[o]<<16|n[o+1]<<8|n[o+2];h+=s[c>>18]+s[c>>12&63]+s[c>>6&63]+s[63&c]}return h};e.exports=o},function(e,t){},function(e,t){document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("main-menu"),t=function(){e.classList.contains("slide-up")?(e.classList.remove("slide-up"),e.classList.add("slide-down-from-off-top")):(e.classList.remove("slide-down-from-off-top"),e.classList.add("slide-up"))},n=new Event("M:playBtnPressed"),i=document.getElementById("play");i.addEventListener("click",function(){t(),window.dispatchEvent(n),i.blur()}),window.addEventListener("GIC:gamePauseToggled",t);var r=document.getElementById("replay-popup"),a=function(){r.classList.contains("hide")?(r.classList.remove("hide"),r.classList.toggle("fade-in")):(r.classList.toggle("fade-in"),r.classList.toggle("fade-out"))},o=document.getElementById("replay-popup-message"),s=function(e){o.innerText=e.message,a()},h=new Event("M:replayBtnPressed"),c=document.getElementById("replay");c.addEventListener("click",function(){a(),window.dispatchEvent(h),c.blur()}),window.addEventListener("Game:lost",s),window.addEventListener("Game:won",s)})}]);