AFRAME.registerComponent("travel-node",{schema:{axis:{type:"string","default":null},offsetX:{type:"number","default":null},offsetY:{type:"number","default":null},offsetZ:{type:"number","default":null},transition:{type:"string","default":null},animationDur:{type:"number","default":null},animationEasing:{type:"number","default":null},travelTarget:{type:"selector"}},axises:null,clickEventRegistered:!1,travelTarget:null,update:function(){var c=document.querySelector("a-scene");c.hasLoaded?this.setupVariables():
c.addEventListener("loaded",function(){this.setupVariables()}.bind(this))},setupVariables:function(){var c=document.querySelector("a-scene"),a=c.components["travel-node-defaults"];if(void 0===a)c.setAttribute("travel-node-defaults",""),setTimeout(this.setupVariables.bind(this),10);else{for(var b in this.data)if("number"===this.schema[b].type&&isNaN(this.data[b])||null===this.data[b])this.data[b]=a.data[b];this.axises={};c=this.data.axis.toLowerCase().split(",");a=["x","y","z"];for(b in a){var d=a[b];
0<=c.indexOf(d)&&(this.axises[d]=!0)}this.travelTarget=this.data.travelTarget;null===this.travelTarget&&console.warn("Can't determine travel target.");this.clickEventRegistered||(this.el.addEventListener("click",this.onClick.bind(this)),this.clickEventRegistered=!0)}},onClick:function(){var c=new THREE.Vector3,a=new THREE.Vector3;c.setFromMatrixPosition(this.el.object3D.matrixWorld);a.setFromMatrixPosition(this.travelTarget.object3D.matrixWorld);for(var b in this.axises)a[b]=c[b];a.x+=this.data.offsetX;
a.y+=this.data.offsetY;a.z+=this.data.offsetZ;this.targetPosition=a;switch(this.data.transition){case "fade":this.fadeToTarget();break;case "move":AFRAME.components.animation?this.moveToTarget():(console.warn("To use the 'move' transition, you will need to add the aframe-animation-component component, available at https://github.com/ngokevin/aframe-animation-component"),this.jumpToTarget());break;default:console.warn("Unknown travel mode: "+this.data.mode);case "jump":this.jumpToTarget()}},fadeToTarget:function(){var c=
document.querySelector("a-scene").camera.el,a=document.createElement("a-plane");a.setAttribute("position","0 0 -0.1");a.setAttribute("material","color: black; transparent: true; opacity: 0");var b=document.createElement("a-animation");b.setAttribute("attribute","material.opacity");b.setAttribute("from","0");b.setAttribute("to","1");b.setAttribute("dur",this.data.animationDur);b.setAttribute("easing",this.data.animationEasing);var d=b.cloneNode(!0);d.setAttribute("from","1");d.setAttribute("to","0");
d.setAttribute("delay",this.data.animationDur+100);b.addEventListener("animationend",function(){this.jumpToTarget()}.bind(this));d.addEventListener("animationend",function(){a.removeChild(d);a.removeChild(b);c.removeChild(a)});a.appendChild(d);a.appendChild(b);c.appendChild(a)},moveToTarget:function(){this.travelTarget.setAttribute("animation__travel-node_movetotarget","property: position; to: "+this.targetPosition.x+" "+this.targetPosition.y+" "+this.targetPosition.z+"; dur: "+this.data.animationDur+
"; easing: "+this.data.animationEasing);this.travelTarget.addEventListener("animation__travel-node_movetotarget-complete",function(){this.travelTarget.removeAttribute("animation__travel-node_movetotarget")}.bind(this))},jumpToTarget:function(){this.travelTarget.setAttribute("position",this.targetPosition)}});
