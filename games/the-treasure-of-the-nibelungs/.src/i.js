let t,s,i;s=.3,t=(t=1,s=.05,h=220,e=0,n=0,r=.1,o=0,a=1,c=0,l=0,f=0,w=0,u=0,d=0,p=0,x=0,y=0,g=1,m=0,M=0,E=Math,k=44100,_=2*E.PI,A=(c*=500*_/k/k),T=(h*=(1-s+2*s*E.random(s=[]))*_/k),v=0,b=0,S=0,I=1,D=0,C=0,N=0,H,F)=>{for(l*=500*_/k**3,p*=_/k,f*=_/k,w*=k,u=k*u|0,F=(e=k*e+9)+(m*=k)+(n*=k)+(r*=k)+(y*=k)|0;S<F;s[S++]=N)++C%(100*x|0)||(N=o?1<o?2<o?3<o?E.sin((v%_)**3):E.max(E.min(E.tan(v),1),-1):1-(2*v/_%2+2)%2:1-4*E.abs(E.round(v/_)-v/_):E.sin(v),N=(u?1-M+M*E.sin(_*S/u):1)*(0<N?1:-1)*E.abs(N)**a*.3*t*(S<e?S/e:S<e+m?1-(S-e)/m*(1-g):S<e+m+n?g:S<F-y?(F-S-y)/r*g:0),N=y?N/2+(y>S?0:(S<F-y?1:(F-S)/y)*s[S-y|0]/2):N),v+=(H=(h+=c+=l)*E.cos(p*b++))-H*d*(1-1e9*(E.sin(S)+1)%2),I&&++I>w&&(h+=f,T+=f,I=0),!u||++D%u||(h=T,c=A,I=I||1);return(t=i.createBuffer(1,F,k)).getChannelData(0).set(s),(h=i.createBufferSource()).buffer=t,h.connect(i.destination),h.start(),h},i=new AudioContext;const h={t:"Arial, sans-serif",i:'"Times New Roman", serif',h:'"Courier New", monospace',o:60,l:96,u:48,p:1,g:2,m:3,M(t,s){let i=Math.min(t.x+t.w,s.x+s.w)-Math.max(t.x,s.x);i=i<0?0:i;let h=Math.min(t.y+t.k,s.y+s.k)-Math.max(t.y,s.y);return h=h<0?0:h,i*h},_:t=>1==t?new h.T.A:2==t?new h.T.v:3==t?new h.T.S:4==t?new h.T.I:5==t?new h.T.D:6==t?new h.T.C:void 0,init(){h.N.init(),h.H.init((()=>{h.H.level=new h.T.F,h.H.L()}))},O(){const t=localStorage.getItem("2023_sd_nibelungs.save");return t?JSON.parse(t):null},R(t,s){return this.M(t,s)>Number.EPSILON},K(t){t<2||t>5||localStorage.setItem("2023_sd_nibelungs.save",JSON.stringify({level:t}))}};window.addEventListener("load",(()=>h.init())),h.P=class{constructor(t=0,s=0){this.x=t,this.y=s}clone(){return new h.P(this.x,this.y)}length(){return this.x+this.y==0?0:Math.sqrt(this.x*this.x+this.y*this.y)}mul(t){return this.x*=t,this.y*=t,this}normalize(){const t=this.length();return t&&(this.x/=t,this.y/=t),this}set(t,s){this.x=t,this.y=s}sub(t){return this.x-=t.x,this.y-=t.y,this}},h.Audio={G:[.3,0,8,.01,.01,.01,1,2.29,86,,,,,,-82,,,.42,.01],B:[.15,0,68,.02,.01,.18,2,1.89,-.3,,,,,1.4,,.3,,.59,.06,.12],X:[.15,0,382,.1,.01,.09,,2.2,-1.2,-3.8,,,,5,,,,.48,.05],SELECT:[.2,0,883,.01,.07,,1,1.74,,,366,.1,.06,,,,,.62,.01],play(s){t(...s)}},h.N={U:{W:1,Y:2,j:3,G:4,Z:5,X:6,J:10,V:11,$:12,q:13,tt:14,st:15},it:{},ht:{},et:{gp_connect:[],gp_disconnect:[]},nt:{},rt:{},ot:{},ct:{},lt:0,ft(){this.wt={[this.U.W]:{keyboard:["Escape"],gamepad:[9]},[this.U.V]:{keyboard:["ArrowUp","KeyW","KeyZ","KeyY"],gamepad:[12]},[this.U.J]:{keyboard:["ArrowLeft","KeyA","KeyQ"],gamepad:[14]},[this.U.q]:{keyboard:["ArrowDown","KeyS"],gamepad:[13]},[this.U.$]:{keyboard:["ArrowRight","KeyD"],gamepad:[15]},[this.U.G]:{keyboard:["Space","Enter"],gamepad:[0,2]},[this.U.X]:{keyboard:["ShiftLeft","ShiftRight"],gamepad:[4,5]},[this.U.Y]:{keyboard:["Space","Enter"],gamepad:[0,2]},[this.U.Z]:{keyboard:["KeyE","CtrlLeft"],gamepad:[1,3]}}},ut(){let t=0,s=0;if(this.dt(this.U.J)?t=-1:this.dt(this.U.$)&&(t=1),this.dt(this.U.V)?s=-1:this.dt(this.U.q)&&(s=1),!t||!s){const i=.3;for(const h in this.ot){const e=this.ot[h];e.axes[0]&&Math.abs(e.axes[0])>i?t=e.axes[0]>0?1:-1:e.axes[2]&&Math.abs(e.axes[2])>i&&(t=e.axes[2]>0?1:-1),e.axes[1]&&Math.abs(e.axes[1])>i?s=e.axes[1]>0?1:-1:e.axes[3]&&Math.abs(e.axes[3])>i&&(s=e.axes[3]>0?1:-1)}}return{x:t,y:s}},xt(t){return this.wt[t]},init(){this.ft(),this.yt()},dt(t,s){const i=this.xt(t);for(const t of i.keyboard)if(this.gt(t,s))return!0;for(const t of i.gamepad)if(this.Mt(t,s))return!0;if(t==this.U.J)for(const t in this.ot){const i=this.ot[t];if(i.axes[6]&&i.axes[6]<=-.2)return!this.ht["axis6-"]&&(s&&(this.ht["axis6-"]=!0),!0)}else if(t==this.U.$)for(const t in this.ot){const i=this.ot[t];if(i.axes[6]&&i.axes[6]>=.2)return!this.ht["axis6+"]&&(s&&(this.ht["axis6+"]=!0),!0)}else if(t==this.U.V)for(const t in this.ot){const i=this.ot[t];if(i.axes[7]&&i.axes[7]<=-.2)return!this.ht["axis7-"]&&(s&&(this.ht["axis7-"]=!0),!0)}else if(t==this.U.q)for(const t in this.ot){const i=this.ot[t];if(i.axes[7]&&i.axes[7]>=.2)return!this.ht["axis7+"]&&(s&&(this.ht["axis7+"]=!0),!0)}return!1},Mt(t,s){for(const i in this.ot){const h=this.ot[i].buttons[t];if(h&&h.pressed)return!this.ht[t]&&(s&&(this.ht[t]=!0),!0)}return!1},gt(t,s){const i=this.ct[t];return!(!i||!i.time)&&(s&&(i.time=0,i.Et=!0),!0)},kt(t,s){this.et[t].push(s)},_t(t,s){const i=this.nt[t]||[];i.push(s),this.nt[t]=i},At(t,s){const i=this.rt[t]||[];i.push(s),this.rt[t]=i},yt(){document.body.onkeydown=t=>{const s=this.ct[t.code];s&&s.Et||(this.ct[t.code]={time:Date.now()},this.nt[t.code]&&this.nt[t.code].forEach((t=>t())))},document.body.onkeyup=t=>{this.ct[t.code]={time:0},this.rt[t.code]&&this.rt[t.code].forEach((t=>t()))},window.addEventListener("gamepadconnected",(t=>{this.lt++,this.ot[t.gamepad.index]=t.gamepad,this.et.gp_connect.forEach((t=>t()))})),window.addEventListener("gamepaddisconnected",(t=>{this.lt--,delete this.ot[t.gamepad.index],this.et.gp_disconnect.forEach((t=>t()))}))},update(){const t=navigator.getGamepads();for(const s of t)if(s){this.ot[s.index]=s;for(const t in this.ht)"axis6-"==t||"axis6+"==t?s.axes[6]||delete this.ht[t]:"axis7-"==t||"axis7+"==t?s.axes[7]||delete this.ht[t]:s.buttons[t]&&!s.buttons[t].pressed&&delete this.ht[t]}}},h.H={Tt:new h.P,scale:1,vt:0,bt:0,St:0,It(t,s,i,h=0){const[e,n]=this.Dt(36,36);n.drawImage(this.images,h,s,16,16,1,1,16,16),n.drawImage(this.images,h+16,s,16,16,18,1,16,16),n.fillStyle="#000",i&&i.Ct(n);let r=n.getImageData(1,1,35,16);for(let s=0;s<r.data.length;s+=4){r.data[s]+r.data[s+1]+r.data[s+2]==765&&(r.data[s]=t[0],r.data[s+1]=t[1],r.data[s+2]=t[2])}n.putImageData(r,1,1),n.putImageData(r,1,18),r=n.getImageData(1,18,34,16);for(let t=0;t<r.data.length;t+=4){0!==r.data[t+3]&&(r.data[t]=255,r.data[t+1]=255,r.data[t+2]=255)}return n.putImageData(r,1,18),e},Nt(t,s,i,h){const[e,n]=this.Dt(i+2,h+2);return n.drawImage(this.images,t,s,i,h,1,1,i,h),e},Ht(t){const s=t.Ft();if(this.bt=this.Tt.x-s.x,this.St=(this.Tt.y-s.y)*this.scale,t.level){const s=t.level.Lt;this.bt=Math.min(0,Math.max(-s.w+2*this.Tt.x,this.bt))}this.bt*=this.scale},Ot(t){this.Rt||(this.Rt=new h.Kt(this,2),this.Pt=t,h.K(t))},clear(){this.Gt.setTransform(1,0,0,1,0,0),this.Gt.clearRect(0,0,window.innerWidth,window.innerHeight),this.Bt.setTransform(1,0,0,1,0,0),this.Bt.clearRect(0,0,window.innerWidth,window.innerHeight)},createLinearGradient(t,s,i,h,e="#0003",n="#fff1"){const r=this.Gt.createLinearGradient(t,s,i,h);return r.addColorStop(0,e),r.addColorStop(1,n),r},Xt(){if(this.clear(),this.Gt.setTransform(this.scale,0,0,this.scale,this.bt,this.St),this.Bt.setTransform(this.scale,0,0,this.scale,0,0),this.level&&this.level.Xt(),this.Rt){const t=2*this.Rt.Ut(),s=this.Wt.width/this.scale*2;this.Bt.fillStyle="#0d161e",this.Bt.fillRect(s*(1-t),0,s,this.Wt.height/this.scale)}},zt(){this.Bt.setTransform(1,0,0,1,0,0),this.Bt.clearRect(0,0,window.innerWidth,window.innerHeight),this.Bt.setTransform(this.scale,0,0,this.scale,0,0),this.Bt.fillStyle="#0006",this.Bt.fillRect(0,0,this.Wt.width/this.scale,this.Wt.height/this.scale),this.Bt.fillStyle="#fff",this.Bt.font="600 56px "+h.h,this.Bt.textAlign="center",this.Bt.textBaseline="top",this.Bt.fillText("GAME OVER",this.Tt.x,this.Tt.y-77);let t=this.Tt.x+60;this.Bt.fillStyle="#fa0",this.Bt.font="600 28px "+h.h,this.Bt.fillText("Try again",t,this.Tt.y-7);let s=h.u/2,i=h.l,e=t-155,n=this.Tt.y-42,r={x:e+s/2,y:n+i/2};h.H.Yt(this.Bt,Math.PI/2,r),h.H.jt(this.Bt,Math.sin(.08*this.level.vt),1,r),this.Bt.drawImage(h.H.Zt,1,1,8,32,e,n,s,i),this.Bt.setTransform(this.scale,0,0,this.scale,0,0)},Jt(t,s){let i=9*h.l,e=2*h.l,n=this.Tt.x-i/2,r=h.u;this.Bt.fillStyle="#0004",this.Bt.fillRect(n-12,r-12,i+24,e+24),this.Bt.fillStyle="#444",this.Bt.fillRect(n,r,i,e),this.Bt.drawImage(t.images,0,0,16,16,n,r+24,168,168),this.Bt.lineWidth=12,this.Bt.strokeStyle="#847e87",this.Bt.strokeRect(n+6,r+6,2*h.l-12,2*h.l-12),this.Bt.fillStyle="#fff",this.Bt.font="600 31px "+h.h,this.Bt.textAlign="left",this.Bt.textBaseline="alphabetic";let o=n+28,a=r+48;s.forEach((t=>{this.Bt.fillText(t,o+2*h.l,a),a+=38}))},Vt(){this.Bt.setTransform(1,0,0,1,0,0),this.Bt.clearRect(0,0,window.innerWidth,window.innerHeight),this.Bt.setTransform(this.scale,0,0,this.scale,0,0),this.Bt.fillStyle="#0006",this.Bt.fillRect(0,0,this.Wt.width/this.scale,this.Wt.height/this.scale),this.Bt.fillStyle="#fff",this.Bt.font="600 56px "+h.h,this.Bt.textAlign="center",this.Bt.textBaseline="top",this.Bt.fillText("PAUSED",this.Tt.x,this.Tt.y-56)},$t(){this.Gt.fillRect(-this.bt/this.scale-h.l,-this.St/this.scale-h.l,this.qt.width/this.scale+2*h.l,this.qt.height/this.scale+2*h.l)},Dt(t,s){const i=document.createElement("canvas");i.width=t,i.height=s;const h=i.getContext("2d",{alpha:!0});return h.imageSmoothingEnabled=!1,[i,h]},init(t){this.qt=document.getElementById("c"),this.Gt=this.qt.getContext("2d",{alpha:!0}),this.Gt.imageSmoothingEnabled=!1,this.Wt=document.getElementById("ui"),this.Bt=this.Wt.getContext("2d",{alpha:!0}),this.Bt.imageSmoothingEnabled=!1,this.Qt((()=>{this.yt(),t()}))},Qt(t){const s=new Image;s.onload=()=>{this.images=s;const[i,e]=this.Dt(5,3);let n=new ImageData(5,3);n.data.set([255,255,255,196,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,196,0,0,0,0,255,255,255,196,255,255,255,255,255,255,255,196,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,196,0,0,0,0,0,0,0,0]),e.putImageData(n,0,0),this.ts=i,this.ss=this.It([255,255,0],16,h.hs),this.es=this.It([255,0,0],16,h.ns),this.rs=this.It([127,0,0],16,h.os),this.cs=this.It([0,0,0],48),this.ls=this.It([255,255,255],32),this.fs=this.It([0,0,0],48,null,32),this.ws=this.Nt(41,16,7,6),this.Zt=this.Nt(32,16,8,32),this.us=this.Nt(40,32,6,14);const[r,o]=this.Dt(h.l,h.l);o.drawImage(this.images,16,0,16,16,0,0,h.l,h.l),this.ds=o.createPattern(r,"repeat");const[a,c]=h.H.Dt(h.l,h.l),l=c.createRadialGradient(h.u,h.u,0,h.u,h.u,h.u);l.addColorStop(0,"#000a"),l.addColorStop(.9,"#0002"),l.addColorStop(1,"#0000"),c.fillStyle=l,c.fillRect(0,0,h.l,h.l),this.ps=a,t()},s.src="i.png"},L(t=0){if(h.N.update(),t&&this.xs){const s=(t-this.xs)/(1e3/h.o);if(this.Gt.imageSmoothingEnabled=!1,this.Bt.imageSmoothingEnabled=!1,this.Gt.lineWidth=1,this.Gt.textBaseline="alphabetic",this.ys)return void this.Vt();this.vt+=s,this.Rt&&(this.Pt&&this.Rt.Ut()>.5&&(this.level=h._(this.Pt),this.gs=this.Pt,this.Pt=null),this.Rt.Ms()&&(this.Rt=null)),this.level.update(s),this.Xt()}this.xs=t,requestAnimationFrame((t=>this.L(t)))},pause(){this.ys=!0},yt(){window.addEventListener("resize",(t=>this.resize())),this.resize();const t=h.N.xt(h.N.U.W);setInterval((()=>{this.ys&&h.N.update(),t.gamepad.forEach((t=>{h.N.Mt(t,!0)&&this.Es()}))}),100);const s=()=>this.Es();t.keyboard.forEach((t=>h.N.At(t,s))),h.N.kt("gp_disconnect",(()=>this.pause()))},ks(){this.Ot(this.gs)},resetTransform(){this.Gt.setTransform(this.scale,0,0,this.scale,this.bt,this.St)},resize(){const t=1920/1080;let s=window.innerHeight,i=Math.round(s*t);i>window.innerWidth&&(i=window.innerWidth,s=i/t),this.scale=s/1080,this.Tt.x=i/2/this.scale,this.Tt.y=s/2/this.scale;let h=~~((window.innerHeight-s)/2)+"px",e=~~((window.innerWidth-i)/2)+"px";this.qt.width=i,this.qt.height=s,this.qt.style.top=h,this.qt.style.left=e,this.Wt.width=i,this.Wt.height=s,this.Wt.style.top=h,this.Wt.style.left=e,this.ys&&(clearTimeout(this._s),this._s=setTimeout((()=>this.Vt()),100))},Yt(t,s,i){t.translate(i.x,i.y),t.rotate(s),t.translate(-i.x,-i.y)},jt(t,s,i,h){t.translate(h.x,h.y),t.scale(s,i),t.translate(-h.x,-h.y)},Es(){this.ys?this.unpause():this.pause()},unpause(){this.ys&&(this.ys=!1,this.L())}},h.Kt=class{constructor(t,s=0){this.level=t,this.set(s)}Ms(){return this.level.vt>this.timeEnd}Ut(){return Math.min(1,1-(this.timeEnd-this.level.vt)/this.duration)}set(t){this.duration=t*h.o,this.timeEnd=this.level.vt+this.duration}},h.T=class{constructor(){this.Lt={},this.vt=0,this.As=[],this.Ts=[],this.items=[]}vs(t,s){if(h.H.Ht(t),t.bs||t.Ss)t.update(s);else{h.N.dt(h.N.U.X,!0)?t.Is():h.N.dt(h.N.U.G,!0)&&t.attack();let i=h.N.ut();i=new h.P(i.x,i.y),t.update(s,i.normalize());const e=t.Ds();this.items.forEach((s=>{s.Cs=!1,s.Ns&&h.R(s.Ds(),e)&&(s.Cs=!0,h.N.dt(h.N.U.Z,!0)&&t.Hs(s))}))}}Fs(...t){this.Ts.push(...t),this.Ls(...t)}Os(...t){this.items.push(...t),this.Ls(...t)}Ls(...t){t.forEach((t=>t.level=this)),this.As.push(...t)}Xt(){this.Rs&&this.Rs(h.H.Gt),this.As.forEach((t=>t.Xt(h.H.Gt))),this.Ks&&this.Ks(h.H.Gt),this.Ps&&h.H.zt()}Gs(t,s){const i=h.H;if(!this.Bs){const[t,s]=i.Dt(2*i.Tt.x+3*h.l,2*i.Tt.y+2*h.l);s.fillStyle=i.ds,s.fillRect(0,0,t.width,t.height),this.Bs=t}let e=Math.ceil(-i.bt/i.scale/h.l)*h.l,n=Math.ceil(-i.St/i.scale/h.l)*h.l;t.drawImage(this.Bs,e-1.5*h.l-s,n-h.l)}Xs(){let t=0;return this.As.forEach((s=>{s instanceof h.Us&&(t+=s.Ws>0?1:0)})),t}removeItem(t){let s=this.items.indexOf(t);s>=0&&this.items.splice(s,1),s=this.As.indexOf(t),s>=0&&this.As.splice(s,1)}update(t){if(this.vt+=t,this.Ps)h.N.dt(h.N.U.Y,!0)&&h.H.ks();else if(!this.locked){const s=this.zs;if(s){if(s.Ys<=0)return void(this.Ps=!0);this.vs(s,t)}this.As.sort(((t,s)=>t.js()-s.js())),this.As.forEach((i=>{i!=s&&(i.update(t),s?.Ss&&i.Ws>0&&i.Zs()&&s.item?.Js(i)&&i.Vs(s.item),i.action||h.qs.$s(i,s))}))}}},h.Qs=class{constructor(t={}){this.ti=new h.P(t.x,t.y),this.w=t.w||0,this.k=t.k||0,this.si=0,this.ii={},this.hi=[],this.ei=t.ei||1,this.Ws=this.ni=1/0,this.speed=new h.P(4,4),this.state=h.p,this.weight=0}ri(t){for(let s=this.hi.length-1;s>=0;s--){(0,this.hi[s])(t)&&this.hi.splice(s,1)}}Zs(){return(!this.oi||this.oi.Ms())&&!this.bs}Xt(){}ai(t,s){if(!this.level||this.ci)return;this.ti.x=Math.min(this.level.Lt.w-this.w,Math.max(0,this.ti.x)),this.ti.y=Math.min(this.level.Lt.k-this.k-8,Math.max(-h.u,this.ti.y));const i=this.ti.clone().sub(t);i.set(i.x<0?-i.x:i.x,i.y<0?-i.y:i.y);const e=this.Ds();this.level.As.forEach((n=>{if(n==this||!n.li||n.Ws<=0||n instanceof h.fi&&this.bs)return;const r=n.Ds(),o=h.M(e,r);o>Number.EPSILON&&(s&&o>=8?this.ti.set(i.x>0?r.x+r.w:r.x-e.w,t.y):this.ti.set(t.x,t.y))}))}Ds(){return{x:this.ti.x,y:this.ti.y,w:this.w,k:this.k}}Ft(){return{x:this.ti.x+this.w/2,y:this.ti.y+this.k/2}}wi(t,s,i){if(this.ii.ui&&this!==this.level?.zs)return i;const e=this.ti.clone();return this.ti.x+=Math.round(s*t.x*this.speed.x),this.ti.y+=Math.round(s*t.y*this.speed.y),(t.x||t.y)&&(i=h.g,this.ei=0==t.x?this.ei:t.x>0?1:-1),this.ai(e),i}js(){return this.ti.y+this.k}di(){if(!this.oi||this.oi.Ms())return!1;const t=this.oi.Ut();return t>=0&&t<=.2||t>=.4&&t<=.6||t>=.8&&t<=1}Vs(t){if(!t||!this.Zs())return;this==this.level.zs&&h.Audio.play(h.Audio.B),this.oi=this.oi||new h.Kt(this.level),this.oi.set(.5),this.Ws=Math.max(0,this.Ws-t.pi);const s=t.xi(this);s&&this.hi.push(s),this.Ws<=0&&this.yi&&this.yi()}update(t,s){if(this.Ws<=0||this.gi)return;let i=h.p;this.si+=t,this.ri(t),s&&(i=this.wi(s,t,i)),this.state!=i&&(this.si=0),this.state=i}},h.mi=class extends h.Qs{constructor(t={}){t.w=h.l,t.k=h.l,super(t),this.images=h.H.fs,this.Ws=this.ni=55,this.li=!0,this.weight=h.l}Xt(t){this.Ws>0&&t.drawImage(this.images,1,this.di()?18:1,16,16,this.ti.x,this.ti.y,this.w,this.k)}update(t){super.update(t),this.li=this.Ws>0}},h.Mi=class extends h.Qs{constructor(t){t.w=h.l-6,t.k=h.l-12,super(t),this.li=!0,this.ci=!0,this.weight=2*h.l}Xt(t){t.drawImage(h.H.images,16,50,15,14,this.ti.x,this.ti.y,this.w,this.k)}},h.fi=class extends h.Qs{constructor(t={}){t.w=h.l,t.k=h.l,super(t),this.Ei=42/h.o,this.images=h.H.ss,this.Ws=this.ni=100,this.ki="#f00",this.Ys=1/0,this.li=!0,this.item=t.item,this._i=8*h.l,this.speed.set(12,12),this.item&&(this.item.gi=this)}Ai(t,s){h.H.jt(t,s,1,this.Ft())}Ti(t){h.H.Yt(t,.1*Math.sin(this.si*this.Ei),this.Ft())}vi(t){if(this.Ys>=this.ni||this.bs)return;let s=this.Ys/this.ni,i=this.ti.x+16,h=this.ti.y-24,e=this.w-32;t.fillStyle="#000",t.fillRect(i,h,e,8),t.fillStyle=this.ki,t.fillRect(i,h,e*s,8),t.fillStyle="#0001",t.fillRect(i,h+4,e*s,4)}bi(t){const s=this.ei<0;s&&this.Ai(t,-1),this.item?.Xt(t),s&&this.Ai(t,-1)}Si(t){t.drawImage(h.H.ps,this.ti.x,this.ti.y+this.k-12,this.w,24)}attack(){return!(this.Ss||this.bs||!this.item||this.ii?.ui)&&(h.Audio.play(h.Audio.G),this.Ii=this.Ii||new h.Kt(this.level),this.Ii.set(this.item.Di),this.Ss=!0,!0)}Is(){return!this.bs&&!this.ii?.ui&&(h.Audio.play(h.Audio.X),this.Ci=this.Ci||new h.Kt(this.level),this.Ci.set(.5),this.Ni=this.ti.clone(),this.bs=!0,!0)}Xt(t){let s=this.ei<0?18:1,i=1;if(this.state==h.m){if(this.Hi.Ms())return;const e=this.Hi.Ut(),n=this.Ft();n.y+=this.k/2,h.H.Yt(t,this.ei*e*Math.PI/2,n),t.globalAlpha=1-e,t.drawImage(this.images,s,i,16,16,this.ti.x,this.ti.y,h.l,h.l),t.globalAlpha=1}else{if(this.Si(t),this.bs){let s=6*this.Ci.Ut()*Math.PI;this.ei<0&&(s=-s),h.H.Yt(t,s,this.Ft())}else this.di()&&(i=18),this.state==h.g&&this.Ti(t);this.item&&this.bi(t,this.images),this.vi(t),t.drawImage(this.images,s,i,16,16,this.ti.x,this.ti.y,h.l,h.l)}h.H.resetTransform()}yi(){this.item?.Fi(),this.Ws>0?(this.item=new h.Li,this.item.gi=this):this.item=null}Ds(){const t={x:this.ti.x+16,y:this.ti.y+this.k,w:this.w-32,k:h.u/2};return t.y-=t.k,t}Hs(t){t.gi||(this.item?.Fi(),this.item=t,t.Cs=!1,t.gi=this,this.level.removeItem(t))}update(t,s){if(this.Ys>this.ni&&(this.Ys=this.Ws),this.Ys>this.Ws&&(this.Ys=Math.max(this.Ws,this.Ys-1.5*t)),this.Ws<=0)return this.state!=h.m&&(this.Hi=new h.Kt(this.level,.7)),void(this.state=h.m);let i=h.p;this.si+=t,this.ri(t),this.bs?this.Ci.Ms()?(this.bs=!1,this.ai(this.Ni,!0)):(s=new h.P(this.ei<0?-1:1,0),this.wi(s,t,i)):s&&(i=this.wi(s,t,i)),this.action&&(i=this.action(t)||i),this.state!=i&&(this.si=0),this.Ss&&this.Ii.Ms()&&(this.Ss=!1),this.state=i}},h.qs={Oi(t,s){if(!t.item||!t.item.Js(s))return!1;if(t.Ri&&!t.Ri.Ms())return!0;const i=new h.Kt(t.level,.3);return t.action=()=>{i.Ms()&&(t.Ss&&t.Ii&&t.Ii.Ms()?t.action=null:t.Ss||(t.attack(),s.Vs(t.item),t.Ri=t.Ri||new h.Kt(t.level),t.Ri.set(.8)))},!0},Ki(t,s){if(!(t instanceof h.ns)||Math.random()<.7||t.Pi&&!t.Pi.Ms())return!1;const i=t.Ft(),e=s.Ft(),n=new h.P(e.x-i.x,e.y-i.y);return!(Math.abs(n.y)>h.u||n.length()>2*h.l)&&(t.ei=n.x<0?-1:1,t.speed.set(11,11),t.Is(),t.Pi=t.Pi||new h.Kt(t.level),t.Pi.set(1.5),t.action=()=>{t.bs||(t.speed.set(3,3),t.action=null)},!0)},Gi(t){if(t.item&&!(t.item instanceof h.Li))return!1;let s=1/0,i=null,e=null;const n=t.Ft(),r=t.Ds(),o=new h.P,a=t.level.items;for(let c=0;c<a.length;c++){const l=a[c];if(l instanceof h.Bi){const a=l.Ds();if(h.R(a,r)){const s=new h.Kt(t.level,.5);return t.action=()=>{s.Ms()&&(t.Hs(l),t.action=null)},!0}o.set(a.x+a.w/2-n.x,a.y+a.k/2-n.y);const c=o.length();c<3*h.l&&s>c&&(s=c,i=o.clone(),e=l)}}if(!e)return!1;const c=new h.Kt(t.level,.5);return i.normalize().mul(.5),t.action=s=>{if(c.Ms())t.action=null;else if(!t.ii.ui)return t.wi(i,s,0)},!0},Xi(t,s){const i=t.Ft(),e=s.Ft(),n=new h.P(e.x-i.x,e.y-i.y);if(n.length()>t._i)return!1;const r=new h.Kt(t.level,1);return n.normalize(),t.action=s=>{if(r.Ms())t.action=null;else if(!t.ii.ui)return t.wi(n,s,0)},!0},$s(t,s){!s||t instanceof h.Ui||!(t instanceof h.fi)||t.ii.ui||t.Ss||t.bs||s.Ws<=0||this.Gi(t)||this.Ki(t,s)||this.Oi(t,s)||this.Xi(t,s)}},h.Bi=class extends h.Qs{constructor(t){super(t)}Wi(){const t=h.H,s=this.Ds(),i=t.bt/t.scale,e=t.St/t.scale,n=Math.sin(t.level.vt/25);let r=s.x+s.w/2+i-15,o=s.y-1.5*h.u+e;t.Bt.drawImage(t.ts,r,o+8*n,30,18),t.Bt.fillStyle="#fff";let a=2*n;r=s.x-6+i-a,o=s.y+s.k+e+a,t.Bt.fillRect(r,o,6,12),t.Bt.fillRect(r,o+6,12,6),r=s.x+s.w+i+a,o=s.y-6+e-a,t.Bt.fillRect(r-6,o,12,6),t.Bt.fillRect(r,o,6,12)}zi(){this.gi&&this.ti.set(this.gi.ti.x-h.u,this.gi.ti.y+this.gi.k)}Fi(){this.Ns&&(this.zi(),this.gi?.level.Os(this)),this.gi=null}xi(){}js(){return this.ti.y}},h.Us=class extends h.fi{constructor(t={}){t.item=t.item||new h.Li,super(t),this.images=h.H.es,this.Ei=32/h.o,this.speed.set(3,3)}Vs(t){this.Ws<=0||super.Vs(t)}},h.ns=class extends h.Us{static Ct(t){let s=7;t.fillRect(s,8,6,1),t.fillRect(s+2,8,3,2),s=22,t.fillRect(s,8,6,1),t.fillRect(s+1,8,3,2)}},h.os=class extends h.ns{constructor(t){super(t),this.Ws=this.ni=300,this.images=h.H.rs,this._i=14*h.l}static Ct(t){let s=8;t.fillRect(s,7,3,1),t.fillRect(s+1,7,2,2),t.fillRect(s+2,7,1,3),t.fillRect(s+4,7,1,3),t.fillRect(s+4,7,2,2),s=22,t.fillRect(s,7,2,2),t.fillRect(s+1,7,1,3),t.fillRect(s+3,7,1,3),t.fillRect(s+3,7,2,2),t.fillRect(s+3,7,3,1)}vi(){}},h.Yi=class extends h.Us{constructor(t={}){super(t),this.images=h.H.ls,this.speed.set(4,4)}},h.Ui=class extends h.Us{constructor(t){super(t),this.images=h.H.cs,this.Ws=this.ni=300}},h.hs=class extends h.fi{constructor(t={}){t.item=t.item||new h.Li,super(t),this.Ws=this.ni=200,this.ki="#fe0"}attack(){return!(this.Ri&&!this.Ri.Ms()||!super.attack())&&(this.Ri=this.Ri||new h.Kt(this.level),this.Ri.set(.65),!0)}Is(){return!(this.Pi&&!this.Pi.Ms()||!super.Is())&&(this.Pi=this.Pi||new h.Kt(this.level),this.Pi.set(.8),!0)}static Ct(t){let s=12;t.fillRect(s,7,1,4),t.fillRect(s-2,7,1,4),t.fillRect(s-4,7,1,4),s=23,t.fillRect(s,7,1,4),t.fillRect(s+2,7,1,4),t.fillRect(s+4,7,1,4)}},h.Li=class extends h.Bi{constructor(t={}){super(t),this.Di=.2,this.pi=15}Js(t){if(!this.gi)return!1;const s={x:this.gi.ti.x+this.gi.w,y:this.gi.ti.y+h.u/2,w:h.u,k:h.u};this.gi.ei<0&&(s.x-=this.gi.w+s.w);const i={x:t.ti.x,y:t.ti.y,w:t.w,k:t.k};return h.R(i,s)}Xt(t){if(!this.gi?.Ss)return;let s=this.gi.ti.x+this.gi.w-32,i=this.gi.ti.y+this.gi.k/2-16,e=this.gi.Ii.Ut();s+=Math.sin(e*Math.PI)*h.u*1.5,t.drawImage(h.H.ws,1,1,7,6,s,i,h.u,h.u)}xi(t){if(!(t instanceof h.fi))return;const s=new h.Kt(this.gi.level,.4);return t.ii.ui=!0,t.yi(),()=>!!s.Ms()&&(t.ii.ui=!1,!0)}},h.ji=class extends h.Bi{constructor(t={}){t.w=t.w||h.u,t.k=t.k||2*h.l,super(t),this.Di=.25,this.Ns=!0,this.pi=30,this.Zi=1.35*h.l}zi(){this.gi&&(this.ti.x=this.gi.ti.x-h.u,this.ti.y=this.gi.ti.y-this.gi.k+this.k/2,this.gi.ei>0&&(this.ti.x+=1.5*h.u+this.gi.w))}Js(t){if(!this.gi)return!1;const s=[{x:this.gi.ti.x+this.gi.w,y:this.gi.ti.y,w:1.7*h.l,k:h.l},{x:this.gi.ti.x+this.gi.w,y:this.gi.ti.y-.7*h.l,w:h.l,k:2.4*h.l}];this.gi.ei<0&&(s[0].x-=this.gi.w+s[0].w,s[1].x-=this.gi.w+s[1].w);const i={x:t.ti.x,y:t.ti.y,w:t.w,k:t.k};for(let t=0;t<s.length;t++)if(h.R(i,s[t]))return!0;return!1}Xt(t){let s=this.ti.x,i=this.ti.y;this.gi&&(s=this.gi.ti.x+h.u,i=this.gi.ti.y-h.l-16);let e=0,n={x:s+this.w/2,y:i+this.k/2};if(this.gi){if(this.gi?.Ss){n.x=s+this.w/2,n.y=i+this.k;let t=this.gi.Ii.Ut();const h=Math.PI;t<=.4?(t/=.4,e=t*h):e=t<=.8?h:0}}else e=80*Math.PI/180;e&&h.H.Yt(t,e,n),t.drawImage(h.H.Zt,1,1,8,32,s,i,this.w,this.k),e&&this.gi?.Ss&&h.H.Yt(t,-e,n),this.gi||(h.H.resetTransform(),this.Cs&&this.Wi(t))}xi(t){if(!t.li)return;const s=t.ti.clone(),i=this.gi.Ft(),e=t.Ft(),n=new h.P(e.x-i.x,e.y-i.y);n.normalize();const r=new h.Kt(this.gi.level,.5),o=Math.max(0,this.Zi-t.weight);return t.ii.ui=!0,()=>{if(r.Ms())return t.ii.ui=!1,!0;const i=r.Ut(),h=t.ti.clone();return t.ti.set(s.x+n.x*o*i,s.y+n.y*o*i),t.ai(h),!1}}Ds(){return{x:this.ti.x-1.5*this.w,y:this.ti.y+1.5*this.w,w:this.k,k:this.w}}},h.Ji=class extends h.ji{constructor(t={}){t.w=30,t.k=70,super(t),this.Di=.2,this.pi=25,this.Zi=.8*h.l}zi(){this.gi&&(this.ti.x=this.gi.ti.x-this.w/2,this.ti.y=this.gi.ti.y+this.gi.k-this.k/2,this.gi.ei>0&&(this.ti.x+=this.gi.w+this.w/2-16))}Js(t){if(!this.gi)return!1;const s={x:this.gi.ti.x+this.gi.w-24,y:this.gi.ti.y-16,w:.7*h.l+24,k:.7*h.l+16};this.gi.ei<0&&(s.x-=this.gi.w+s.w-48);const i={x:t.ti.x,y:t.ti.y,w:t.w,k:t.k};return h.R(i,s)}Xt(t){let s=this.ti.x,i=this.ti.y;this.gi&&(s=this.gi.ti.x+this.gi.w-26,i=this.gi.ti.y-8);let e=0,n={x:s+this.w/2,y:i+this.k/2};if(this.gi){if(this.gi?.Ss){n.x=s+this.w/2,n.y=i+this.k;let t=this.gi.Ii.Ut();const h=75*Math.PI/180;t<=.4?(t/=.4,e=t*h):e=t<=.8?h:0}}else e=55*Math.PI/180;e&&h.H.Yt(t,e,n),t.drawImage(h.H.us,1,1,6,14,s,i,this.w,this.k),e&&this.gi?.Ss&&h.H.Yt(t,-e,n),this.gi||(h.H.resetTransform(),this.Cs&&this.Wi(t))}Ds(){return{x:this.ti.x-36,y:this.ti.y,w:this.w+56,k:this.k}}},h.T.F=class extends h.T{constructor(){super(),this.Vi=0,this.$i=1,this.qi=!!h.O(),this.qi&&(this.Vi=1,this.$i=2)}Qi(t,s,i,e,n){if(n){let s=h.u/2,n=h.l,r=i-96,o=e-n/2,a={x:r+s/2,y:o+n/2};h.H.Yt(t,Math.PI/2,a),h.H.jt(t,Math.sin(.08*this.vt),1,a),t.drawImage(h.H.images,32,16,8,32,r,o,s,n),h.H.resetTransform()}t.fillStyle=n?"#fa0":"#777",t.textBaseline="middle",t.fillText(s,i,e)}Xt(){const t=h.H.Gt;let s=Math.max(2*h.l,h.H.Tt.x-500),i=Math.max(2*h.l,h.H.Tt.y-128);t.fillStyle="#0d161e",h.H.$t(),t.font="600 64px "+h.h,t.textAlign="left",t.fillStyle="#fa0",t.fillText("THE TREASURE OF THE NIBELUNGS",s,i+3),t.fillStyle="#777",t.fillText("THE TREASURE OF THE NIBELUNGS",s,i),t.font="600 42px "+h.h,s+=138,i+=96,this.Qi(t,"New Game",s,i,0==this.Vi),this.qi||(t.globalAlpha=.5),i+=72,this.Qi(t,"Continue",s,i,1==this.Vi),t.globalAlpha=1}O(){const t=h.O();t&&h.H.Ot(t.level)}update(t){this.vt+=t,h.N.dt(h.N.U.V,!0)?this.Vi--:h.N.dt(h.N.U.q,!0)?this.Vi++:h.N.dt(h.N.U.Y,!0)&&(h.Audio.play(h.Audio.SELECT),0==this.Vi?h.H.Ot(h.T.A.id):1==this.Vi&&this.O()),this.Vi<0?this.Vi=this.$i-1:this.Vi>=this.$i&&(this.Vi=0)}},h.T.A=class extends h.T{constructor(){super(),this.th=["Ez enwas niht anders","wan gestéinẹ unde golt.","unt ob man al die werlde","het dâ von versolt,","sîn wǽré niht mínner","einer marke wert."],this.sh=["Ê daz der künee rîche","wider wære komen,","die wîle hete Hagene","den schaz vil gar genomen.","","er sanctẹ in dâ ze Lôche","allen in den Rîn.","er wandẹ er soldẹ in niezen:","des enkunde niht gesîn."],this.ih=["The legendary treasure of the Nibelungs:","Gems and gold more than one could ever hope to spent.","","While the king and his men where away, Hagen stole it","all and sunk the treasure in the Rhine at Lochheim.","But he was killed before being able to retrieve the riches.","","Betting on its existance, many","set off to look for the treasure."],this.hh=new h.Kt(this,2)}Xt(){const t=h.H.Gt;t.fillStyle="#0d161e",h.H.$t();let s=2*h.l,i=s,e=500+h.l,n=49*(this.th.length+this.sh.length)+2*h.l+16,r=s-h.u,o=i-h.l;t.fillStyle="#e5c382",t.fillRect(r,o,e,n),t.fillStyle=h.H.createLinearGradient(r,o,r,o+n/2,"#0002","#0000"),t.fillRect(r,o,e,n/2),t.fillStyle=h.H.createLinearGradient(r,o+n/2,r,o+n,"#0000","#0002"),t.fillRect(r,o+n/2,e,n/2),t.fillStyle="#e5c382",t.fillRect(r-36,o-72,e+72,1.5*h.l),t.fillRect(r-36,o+n-72,e+72,1.5*h.l);let a=t.createLinearGradient(r-36,o-72,r-36,o-72+1.5*h.l);a.addColorStop(0,"#0000"),a.addColorStop(1,"#0003"),t.fillStyle=a,t.fillRect(r-36,o-72,e+72,1.5*h.l),a=t.createLinearGradient(r-36,o+n-72,r-36,o+n-72+1.5*h.l),a.addColorStop(0,"#0003"),a.addColorStop(1,"#0000"),t.fillStyle=a,t.fillRect(r-36,o+n-72,e+72,1.5*h.l),t.font="italic 38px "+h.i,t.textAlign="center",t.fillStyle="#000";s+=250,i+=36,this.th.forEach((h=>{t.fillText(h,s,i),i+=47})),i+=47,this.sh.forEach((h=>{t.fillText(h,s,i),i+=47}));const c=this.hh.Ut();if(s=e+264,i=312+(1-c)*h.l,t.font="32px "+h.t,t.textAlign="left",t.fillStyle="#ffffff"+Math.round(255*c).toString(16).padStart(2,"0"),this.ih.forEach((h=>{t.fillText(h,s,i),i+=49})),this.hh.Ms()){i+=49;let e=h.u/2,n=h.l,r=s+n/2,o=i-n/2,a={x:r+e/2,y:o+n/2};h.H.Yt(t,Math.PI/2,a),h.H.jt(t,Math.sin(.08*this.vt),1,a),t.drawImage(h.H.images,32,16,8,32,r,o,e,n),h.H.resetTransform(),t.font="32px "+h.t,t.fillStyle="#fa0",t.textBaseline="middle",t.fillText("Continue",s+n+32,i)}}update(t){this.vt+=t,h.N.dt(h.N.U.Y,!0)&&(this.hh.Ms()?(h.Audio.play(h.Audio.SELECT),h.H.Ot(h.T.v.id)):this.hh.set(0))}},h.T.A.id=1,h.T.v=class extends h.T{constructor(){super(),this.Lt={w:2*h.H.Tt.x,k:8*h.l};const t=new h.hs({x:6*h.l,y:3*h.l,item:new h.Li}),s=new h.Ui({x:13*h.l,y:3*h.l,item:new h.ji});this.Fs(t,s),this.zs=t,this.eh=s,this.locked=!0,this.nh=-1,this.rh=new h.Kt(this,5)}Xt(){super.Xt();const t=h.H.Gt;t.font="600 23px "+h.h,t.fillStyle="#fffc",t.textAlign="center";const s=this.zs,i=s.Ft(),e=this.eh.Ft();if(0==this.nh)t.fillText("Move with [W][A][S][D] or arrow keys",i.x,i.y-s.k);else if(1==this.nh)t.fillText("Attack with [ENTER] or [SPACE]",e.x,e.y-2*this.eh.k);else if(2==this.nh){const s=this.items[0];if(s){const i=s.Ds();t.fillText("Pick up with [E]",i.x+i.w/2,i.y-i.k-h.u-8)}}else 3==this.nh?t.fillText("Attack with the sword",e.x,e.y-this.eh.k):4==this.nh&&t.fillText("You can dodge roll with [SHIFT]",i.x,i.y-s.k-h.l)}Rs(t){const s=this.zs,i=this.eh,e=this.items[0];if(t.fillStyle="#222",t.fillRect(s.ti.x-h.u,s.ti.y+s.k-h.u,2*h.l,h.l),i.Ws>0&&t.fillRect(i.ti.x-h.u,i.ti.y+i.k-h.u,2*h.l,h.l),e){const s=e.Ds();t.fillRect(s.x-h.u,s.y+s.k-1.5*h.u,3*h.l,1.25*h.l)}}Ks(t){const s=h.H;if(this.nh<0&&s.Jt(this.zs,["Before heading out, let’s","think back on my training.","How did it go again?"]),5!==this.nh)return;s.Jt(this.zs,["Right, that’s how it goes!","Now I am prepared!"]);const i=Math.sin(this.vt/25);let e=this.Lt.w-h.l+8*i,n=this.Lt.k/2+9;const r={x:e,y:n};t.fillStyle="#fff",t.textAlign="right",t.fillText("Continue",e-22,n-8);let o=-Math.PI/2;s.Yt(t,o,r),t.drawImage(s.ts,e,n,30,18),s.Yt(t,-o,r)}update(t){const s=this.zs,i=h.N;if(-1==this.nh)h.H.Ht(s),i.dt(i.U.Y,!0)&&this.rh.set(0),this.rh.Ms()&&(this.locked=!1,this.nh=0);else if(0==this.nh)i.dt(i.U.G,!0),this.oh?this.oh.Ms()&&(this.nh=1):(i.dt(i.U.V)||i.dt(i.U.$)||i.dt(i.U.q)||i.dt(i.U.J))&&(this.oh=new h.Kt(this,2));else if(1==this.nh){if(!(this.eh.item instanceof h.ji)){const t=this.items[0];t.ti.x=this.eh.ti.x+2*h.l,t.ti.y+=h.u,this.nh=2}}else if(2==this.nh)s.item instanceof h.ji&&(this.nh=3);else if(3==this.nh)this.eh.Ws<this.eh.ni-s.item.pi&&(this.nh=4);else if(4==this.nh)i.dt(i.U.X)&&(this.nh=5);else if(5==this.nh){if(s.Ft().x>=this.Lt.w-h.u)return void h.H.Ot(h.T.S.id)}super.update(t)}},h.T.v.id=2,h.T.S=class extends h.T{constructor(){super(),this.ah=36,this.lh=2,this.Lt={w:h.l*this.ah,k:h.l*this.lh};const t=new h.hs({x:h.l});this.Fs(t,new h.Yi({x:11*h.l,y:h.l-8,ei:-1,item:new h.Ji}),new h.Yi({x:20*h.l,y:h.l-8,ei:-1}),new h.Yi({x:31*h.l,ei:-1,item:new h.ji}),new h.Yi({x:31*h.l,y:h.l-8,ei:-1})),this.Os(new h.mi({x:11*h.l}),new h.mi({x:22*h.l,y:h.l+8}),new h.mi({x:32*h.l}),new h.mi({x:32*h.l,y:h.l+8}),new h.mi({x:33*h.l,y:h.l/2})),this.zs=t,this.rh=new h.Kt(this,14)}fh(t,s,i,h,e){const n=t.fillStyle;t.fillRect(s,i,h,e),t.fillStyle="#0001",t.fillRect(s,i,12,e),t.fillStyle="#fff1",t.fillRect(s+h-12,i,12,e),t.fillStyle=n}Rs(t){const s=h.H,i=12*Math.sin(this.vt/50);if(this.Gs(t,i),this.wh)t.drawImage(this.wh,0,-h.u/2);else{const[t,i]=s.Dt(this.Lt.w,this.Lt.k+4*h.l),e=h.u;i.fillStyle="#0003",i.fillRect(0,e+1.25*h.l,this.Lt.w,this.Lt.k),i.fillStyle="#544";for(let t=0;t<this.ah;t+=4)this.fh(i,t*h.l,4,h.u,2*h.l);for(let t=0;t<this.ah;t++)for(let n=0;n<this.lh;n++){let r=t*h.l,o=n*h.l+e;i.drawImage(s.images,0,0,16,16,r,o,h.l,h.l)}i.fillStyle=s.createLinearGradient(0,e,0,this.Lt.k,"#0001"),i.fillRect(0,e,this.Lt.w,this.Lt.k),i.fillStyle="#544",i.fillRect(0,this.Lt.k-6+e,this.Lt.w,24),this.wh=t}}Ks(t){this.rh.Ms()||h.H.Jt(this.zs,["My crew is already waiting. I just","have to make it to the ship. But","there are pirates in the harbor."]),t.fillStyle="#544";let s=this.lh*h.l-h.u/2,i=2*h.l;for(let e=0;e<this.ah;e+=4)this.fh(t,e*h.l,s,h.u,i)}update(t){super.update(t);this.zs.Ft().x>=this.Lt.w-h.u&&h.H.Ot(h.T.I.id)}},h.T.S.id=3,h.T.I=class extends h.T{constructor(){super(),this.ah=24,this.lh=6,this.Lt={w:h.l*this.ah,k:h.l*this.lh},this.zs=new h.hs({x:this.Lt.w/2-2*h.l,y:this.Lt.k/2-h.l}),this.Fs(this.zs);const t=this.Lt.k-h.l;this.Os(this.uh(),new h.Ji({x:4*h.l,y:4.5*h.l}),new h.mi({x:this.Lt.w/2-h.u,y:this.Lt.k/2-h.l}),new h.mi({y:t}),new h.mi({x:4*h.l}),new h.mi({x:2*h.l,y:h.l}),new h.mi({x:2*h.l,y:h.l}),new h.mi({x:18*h.l}),new h.mi({x:19*h.l}),new h.mi({x:18.5*h.l,y:h.l}),new h.mi({x:8.5*h.l,y:t}),new h.mi({x:9.5*h.l,y:t}),new h.mi({x:this.Lt.w-2*h.l,y:t})),this.rh=new h.Kt(this,10),this.dh=new h.Kt(this),this.ph=new h.Kt(this,4),this.xh=0,this.yh=3}uh(){const t=new h.Qs({x:this.Lt.w/2+h.u+8,y:this.Lt.k/2-60,w:h.l-16,k:60});return t.li=!0,t.Zs=()=>!1,t.Xt=function(t){const s=this.ti.y-8*h.l,i=this.k+8*h.l,e=this.w/3;t.fillStyle="#5a3c2e",t.fillRect(this.ti.x,s,this.w,i),t.fillStyle="#0002",t.fillRect(this.ti.x,s,e,i),t.fillStyle="#fff1",t.fillRect(this.ti.x+this.w-e,s,e,i)},t}gh(){this.xh++,this.dh.set(2),this.mh=[],1==this.xh?this.mh.push(new h.Yi({x:-h.l,y:1.5*h.l,item:new h.Ji}),new h.Yi({x:-h.l,y:3*h.l}),new h.Yi({x:this.Lt.w,y:2.5*h.l,ei:-1})):2==this.xh?this.mh.push(new h.Yi({x:this.Lt.w,y:1.5*h.l,ei:-1}),new h.Yi({x:this.Lt.w,y:3*h.l,ei:-1}),new h.Yi({x:-h.l,y:2.5*h.l})):3==this.xh&&this.mh.push(new h.Yi({x:this.Lt.w+h.l,y:1.5*h.l,ei:-1}),new h.ns({x:this.Lt.w+h.l,y:3*h.l,ei:-1,item:new h.ji}),new h.ns({x:2*-h.l,y:2.5*h.l,item:new h.ji})),this.mh.forEach((t=>{t.ci=!0;const s=new h.P(t.ei/2);t.action=i=>this.dh.Ms()?(t.action=null,void delete t.ci):t.wi(s,i,h.g)})),this.Fs(...this.mh)}Rs(t){const s=h.H;if(this.Gs(t,this.Mh),this.Eh&&t.drawImage(this.Eh,-6,-h.l),this.kh)t.drawImage(this.kh,0,0);else{const t=6,[i,e]=h.H.Dt(this.Lt.w+1.5*t,this.Lt.k+.5*t+2*h.l);e.lineWidth=t;const n=3;e.strokeStyle="#8f563b",e.strokeRect(0,n,this.Lt.w+e.lineWidth+n,this.Lt.k+n);for(let i=0;i<this.ah;i++)for(let n=0;n<this.lh;n++){let r=i*h.l,o=t+n*h.l;e.drawImage(s.images,0,0,16,16,r,o,h.l,h.l)}e.fillStyle="#5a3c2e",e.fillRect(n-e.lineWidth,this.Lt.k,this.Lt.w+2*e.lineWidth,2*h.l),e.fillStyle=h.H.createLinearGradient(0,this.Lt.k,0,this.Lt.k+2*h.l,"#0003","#4b73ac30"),e.fillRect(n-e.lineWidth,this.Lt.k,this.Lt.w+2*e.lineWidth,2*h.l),e.fillStyle=h.H.createLinearGradient(0,0,0,this.Lt.k),e.fillRect(0,0,this.Lt.w+n,this.Lt.k),this.kh=i}}Ks(t){if(this.xh<=this.yh){const t=h.H.Bt;t.fillStyle="#fff",t.font="600 23px "+h.h,t.textAlign="left",t.fillText(`Wave ${this.xh}/${this.yh}`,h.u,h.u)}if(this._h)t.drawImage(this._h,-this.Mh,this.Lt.k+h.l,h.l*(this.ah+1),h.l);else{const[t,s]=h.H.Dt(h.l*(this.ah+1),h.l);for(let t=0;t<=this.ah;t++)s.drawImage(h.H.images,32,0,16,16,t*h.l,0,h.l,h.l);this._h=t}if(this.Eh)t.drawImage(this.Eh,-6,this.Lt.k-h.l);else{const t=12+this.Lt.w,s=h.l,[i,e]=h.H.Dt(t,s);e.lineWidth=6,e.fillStyle="#5a3c2e",e.fillRect(0,0,this.Lt.w+2*e.lineWidth,18),e.fillStyle="#0002",e.fillRect(0,12,this.Lt.w+2*e.lineWidth,6),e.fillStyle="#fff1",e.fillRect(0,0,this.Lt.w+2*e.lineWidth,6);const n=this.Lt.w/h.l+1;for(let t=0;t<=n;t++){let s=t*h.l,i=18,n=h.l+1;e.fillStyle="#5a3c2e",e.fillRect(s,i,18,n),e.fillStyle="#0002",e.fillRect(s,i,6,n),e.fillStyle="#fff1",e.fillRect(s+12,i,6,n)}this.Eh=i}this.rh.Ms()||h.H.Jt(this.zs,["The Rhine has become a","battlefield! I have to","to defend the ship!"]),this.Ah&&!this.Ah.Ms()&&h.H.Jt(this.zs,["A tough battle, but finally...","Wait, do I see a golden","shimmer below the water?"])}update(t){super.update(t),this.Mh=this.vt%20/20*h.l,this.xh<this.yh&&this.ph.Ms()&&(this.gh(),this.ph.set(16)),this.xh>=this.yh&&0==this.Xs()&&(this.Ah?this.Ah?.Ms()&&h.H.Ot(h.T.D.id):this.Ah=new h.Kt(this,5))}},h.T.I.id=4,h.T.D=class extends h.T{constructor(){super(),this.ah=24,this.lh=6,this.Lt={w:2*h.H.Tt.x,k:h.l*this.lh},this.zs=new h.hs({x:4*h.l,y:this.Lt.k/2-h.l,item:new h.Ji}),this.Th=new h.os({x:this.Lt.w-5*h.l,y:this.zs.ti.y,ei:-1,item:new h.ji}),this.Fs(this.zs,this.Th);let t=this.Lt.w-h.l+6;const s=[new h.mi({x:4*h.l,y:0}),new h.mi({x:5*h.l,y:0}),new h.mi({x:12*h.l,y:0}),new h.mi({x:16*h.l,y:this.Lt.k-h.l}),new h.mi({x:17*h.l,y:this.Lt.k-2*h.l}),new h.mi({x:18*h.l,y:this.Lt.k-2*h.l}),new h.Mi({x:h.l-18,y:-10}),new h.Mi({x:h.l-18,y:6*h.l-130}),new h.Mi({x:t-h.l+18,y:-10}),new h.Mi({x:t-h.l+18,y:6*h.l-130})];for(let i=0;i<8;i++){if(3==i||4==i)continue;let e=(h.l-20)*i-46;s.push(new h.Mi({y:e})),s.push(new h.Mi({x:t,y:e}))}this.Os(...s),this.rh=new h.Kt(this,8),this.locked=!0,this.bh=1,this.dh=new h.Kt(this),this.Ys=this.Th.Ws,h.H.Ht(this.zs)}Sh(){if(this.Ys<=0)return;const t=Math.max(0,this.Ys/this.Th.ni),s=h.H,i=s.Bt;let e=3*h.l,n=s.Wt.height/s.scale-2*h.l,r=s.Wt.width/s.scale-6*h.l,o=24;i.fillStyle="#000a",i.fillRect(e,n,r,o),i.fillStyle="#f00",i.fillRect(e,n,r*t,o),i.fillStyle="#fff2",i.fillRect(e,n,r*t,12),i.fillStyle="#fffa",i.fillRect(e,n,2,o),i.fillRect(e+r/3,n,2,o),i.fillRect(e+2*r/3,n,2,o),i.fillRect(e+r,n,2,o)}Ih(){this.dh.set(2),this.mh=[],2==this.bh?this.mh.push(new h.Yi({x:-h.l,y:1.5*h.l,item:new h.Ji}),new h.Yi({x:this.Lt.w,y:2.5*h.l,ei:-1})):3==this.bh&&this.mh.push(new h.Yi({x:this.Lt.w,y:1.5*h.l,ei:-1}),new h.ns({x:-h.l,y:2.5*h.l,item:new h.ji})),this.mh.forEach((t=>{t.ci=!0;const s=new h.P(t.ei/2);t.action=i=>this.dh.Ms()?(t.action=null,void delete t.ci):t.wi(s,i,h.g)})),this.Fs(...this.mh)}Rs(t){const s=h.H;if(this.Gs(t,this.Mh),this.Eh&&t.drawImage(this.Eh,-6,-h.l),this.kh)t.drawImage(this.kh,0,0);else{const t=6,[i,e]=h.H.Dt(this.Lt.w+1.5*t,this.Lt.k+.5*t+2*h.l);e.lineWidth=t;let n=t/2;e.strokeStyle="#8f563b",e.strokeRect(0,n,this.Lt.w+e.lineWidth+n,this.Lt.k+n);for(let i=0;i<this.ah;i++)for(let n=0;n<this.lh;n++){let r=i*h.l,o=t+n*h.l;e.drawImage(s.images,0,0,16,16,r,o,h.l,h.l)}e.fillStyle="#5a3c2e",e.fillRect(n-e.lineWidth,this.Lt.k,this.Lt.w+2*e.lineWidth,2*h.l),e.fillStyle=h.H.createLinearGradient(0,this.Lt.k,0,this.Lt.k+2*h.l,"#0003","#4b73ac30"),e.fillRect(n-e.lineWidth,this.Lt.k,this.Lt.w+2*e.lineWidth,2*h.l),e.fillStyle=h.H.createLinearGradient(0,0,0,this.Lt.k),e.fillRect(0,0,this.Lt.w+n,this.Lt.k),this.kh=i}}Ks(t){const s=h.H;if(this._h)t.drawImage(this._h,-this.Mh,this.Lt.k+h.l+.5,h.l*(this.ah+1),h.l);else{const[t,i]=s.Dt(h.l*(this.ah+1),h.l);for(let t=0;t<=this.ah;t++)i.drawImage(s.images,32,0,16,16,t*h.l,0,h.l,h.l);this._h=t}if(this.Eh)t.drawImage(this.Eh,-6,this.Lt.k-h.l);else{const t=12+this.Lt.w,i=h.l,[e,n]=s.Dt(t,i);n.lineWidth=6,n.fillStyle="#5a3c2e",n.fillRect(0,0,this.Lt.w+2*n.lineWidth,18),n.fillStyle="#0002",n.fillRect(0,12,this.Lt.w+2*n.lineWidth,6),n.fillStyle="#fff1",n.fillRect(0,0,this.Lt.w+2*n.lineWidth,6);const r=this.Lt.w/h.l+1;for(let t=0;t<=r;t++){let s=t*h.l,i=18,e=h.l+1;n.fillStyle="#5a3c2e",n.fillRect(s,i,18,e),n.fillStyle="#0002",n.fillRect(s,i,6,e),n.fillStyle="#fff1",n.fillRect(s+12,i,6,e)}this.Eh=e}this.Sh(),this.rh.Ms()||s.Jt(this.zs,["So much gold! What a treasure!","There is only one other group left","opposing us. Let’s finish this!"]),this.Ah&&!this.Ah.Ms()&&s.Jt(this.zs,["Cast off, crew!","Before even more arrive!"])}update(t){this.rh.Ut()>.3&&(this.locked=!1),super.update(t),this.Mh=12*Math.sin(this.vt/50),this.Ys>this.Th.Ws&&(this.Ys=Math.max(this.Th.Ws,this.Ys-t));const s=Math.max(0,this.Ys/this.Th.ni);1==this.bh?s<.67&&(this.bh=2,this.Ih()):2==this.bh?s<.34&&(this.bh=3,this.Ih()):0==s&&0==this.Xs()&&(this.Ah?this.Ah?.Ms()&&h.H.Ot(h.T.C.id):this.Ah=new h.Kt(this,5))}},h.T.D.id=5,h.T.C=class extends h.T{constructor(){super();const t=h.H.Tt.x,s=h.H.Tt.y;this.zs=new h.hs({x:t-h.u,y:s-h.u,ei:-1,item:new h.ji}),this.zs.ci=!0,this.Fs(this.zs);const i=h.l-6,e=h.l-30;this.Dh=[];let n=1;const r=i/2,o=this.zs.ti.y+e;for(let t=-1;t<8;t++){const s=this.zs.ti.x-Math.floor(n/2)*r;for(let i=0;i<n;i++)this.Dh.push(new h.Mi({x:s+i*r,y:o+t*e}));n+=2}this.Ch=0,this.Nh=new h.Kt(this,5)}Xt(){const t=h.H.Bt;this.Dh.forEach((s=>s.Xt(t)));const s=h.H.Tt.x;let i=2.5*h.l;t.fillStyle="#ff0",t.font="600 72px "+h.h,t.textAlign="center",t.fillText("YOU CLAIMED THE TREASURE!",s,i),t.fillStyle="#fffa",t.font="600 18px "+h.h,this.Ch>0&&(i+=32,t.fillText("That makes you the richest person far and wide.",s,i)),this.Ch>1&&(i+=25,t.fillText("Make sure to properly pay your crew.",s,i)),this.Ch>2&&(i+=25,t.fillText("Where will you even store all that?",s,i)),this.zs.Xt(t)}update(t){this.vt+=t,this.Nh.Ms()&&(this.Ch++,this.Nh.set(4))}},h.T.C.id=6;