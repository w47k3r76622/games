var e,n=[];function h(t,n){for(m=e.createBuffer(1,96e3,48e3),gainNode=e.createGain(),b=m.getChannelData(0),i=96e3;i--;)b[i]=getSound(t,i);s=e.createBufferSource(),s.buffer=m,s.connect(gainNode),gainNode.connect(e.destination),gainNode.gain.value=.05,s.start()}function a(t){return 2*Math.random()-1}function l(t){if(t>1e4)return null;var e=(1e4-t)/1e4;return(128&Math.pow(t,1.055)?1:-1)*Math.pow(e,2)}function r(t){if(t>5e4)return null;var e=(5e4-t)/5e4;return(200&Math.pow(t,.9)?1:-1)*Math.pow(e,3)}function o(t){var e=1e4;if(t>e)return null;var i=(e-t)/e,s=Math.pow(i,2.1);return Math.pow(t,3)&(t<3333.3333333333335?16:99)?s:-s}function f(t){if(t>2e4)return null;var e=(2e4-t)/2e4;return Math.sin(.003*-t*Math.sin(.09*t+Math.sin(t/200))+Math.sin(t/100))*e*e}function y(t){if(t>1e4)return null;var e=(1e4-t)/1e4;return Math.sin(.01*t*Math.sin(.009*t+Math.sin(t/200))+Math.sin(t/100))*e*e}function x(t,e){this.entity=new d(30,30,t,e,"view"),this.newPos=function(t,e){this.entity.x=parseInt(t.entity.x+t.entity.width/2-e.canvasHalfW),this.entity.y=parseInt(t.entity.y+t.entity.height/2-e.canvasHalfH-gt)}}function u(){this.winTime=23e4,this.maxTime=3e5,this.currentTime=this.maxTime,this.timeOver=!1,this.prevTime=this.maxTime,this.levelTimes=[],this.levelTime=0,this.tick=function(t){this.timeOver||(this.levelTime+=t,this.currentTime-=t,this.timeOver=this.currentTime<=0)},this.reset=function(){this.levelTime=0,this.currentTime=this.maxTime,this.prevTime=this.currentTime,this.timeOver=!1,this.levelTimes=[]},this.setStartTime=function(){this.calcTime(),this.levelTime=0},this.calcTime=function(){this.levelTimes.length>0?this.currentTime=this.maxTime-this.levelTimes.reduce((t,e)=>t+e):this.currentTime=this.maxTime},this.totalTime=function(){return null!=u.levelTimes[0]?u.levelTimes.reduce((t,e)=>t+e):0}}function v(t,e,i){var s=i[2],n=S,a=0;this.image=new Image,this.image.src=Ht,this.entity=new d(25,25,t,e,s),this.entity.y+=4,this.maxLeft=t-i[0]-1,this.maxRight=t+i[1]+25+4,this.jumping=!1;var l=this.entity.y;this.update=function(t){ctx=Pt.context,ctx.save(),ctx.translate(this.entity.x-t.entity.x,this.entity.y-t.entity.y),ctx.drawImage(this.image,60,60,25,25,this.entity.mhWidth,this.entity.mhHeight,this.entity.width,this.entity.height),ctx.restore()},this.tick=function(t,e){this.checkDie(t,e),s==ot?this.moveSide2Side():s==ft||(s==yt?this.follow():s==xt?(this.follow(),this.jump()):s==ut&&(this.moveSide2Side(),this.jump()))},this.follow=function(){this.entity.x>mt.entity.x&&this.entity.x>=this.maxLeft?this.entity.x-=1:this.entity.x<mt.entity.x&&this.entity.x<=this.maxRight-this.entity.width&&(this.entity.x+=1)},this.moveSide2Side=function(){n==S?(this.entity.x+=1,this.entity.x>=this.maxRight&&(n=k)):(this.entity.x-=1,this.entity.x<=this.maxLeft&&(n=S))},this.jump=function(){mt.jumping&&!this.jumping&&this.entity.y==l?(this.jumping=!0,a=10):a>0?(this.entity.y-=a,a--):this.jumping&&a<=0&&(this.entity.y+=Wt,this.entity.y>l&&(this.jumping=!1,this.entity.y=l))},this.checkDie=function(t,e){Jt(t.entity,0,this.entity,10)&&(t.reset||(t.lives--,t.died=!0,e.gitUI.setScores=!0,h(rt,1)),t.reset=!0)}}function d(t,e,i,s,n){this.type=n,this.width=t,this.height=e,this.mhWidth=t/-2,this.mhHeight=e/-2,this.hWidth=t/2,this.hHeight=e/2,this.yOffset=0,this.angle=0,this.x=i,this.y=s,this.active=!0,this.update=function(){this.active&&(ctx=Pt.context,ctx.save(),ctx.translate(this.x,this.y),ctx.rotate(this.angle),ctx.fillStyle=this.color,ctx.fillRect(this.mhWidth,this.mhHeight,this.width,this.height),ctx.restore())}}function p(t,e,i,s){this.time=0,this.image=new Image,this.image.src=Ht,this.direction=i;var n,h,a=t.gethPower();s=s;e==ct&&(this.sx=30,this.sy=60,this.sw=8,this.sh=8,this.maxDuration=1,this.float=!0,this.floatAmount=3,this.grow=!0),i==k?n=t.entity.x-t.entity.hWidth:i==S&&(n=t.entity.x+t.entity.hWidth),h=t.entity.y+2*this.sh,this.entity=new d(this.sw,this.sh,n,h,e),this.tick=function(){this.entity.active&&(this.time+=.13,this.float&&(i==k?(this.entity.y-=this.floatAmount,this.entity.x-=this.floatAmount/2):i==S&&(this.entity.y-=this.floatAmount,this.entity.x+=this.floatAmount/2),this.grow&&(this.entity.width++,this.entity.height++),s?this.entity.x-=1.2*a:this.entity.x+=1.2*a),this.time>=this.maxDuration&&(this.entity.active=!1))},this.update=function(t){this.entity.active&&(ctx=Pt.context,ctx.save(),ctx.globalAlpha=.65,ctx.translate(this.entity.x-t.entity.x,this.entity.y-t.entity.y),ctx.drawImage(this.image,this.sx,this.sy,this.sw,this.sh,this.entity.mhWidth,this.entity.mhHeight,this.entity.width,this.entity.height),ctx.restore())}}function g(){this.showLevel=!1,this.time=0,this.done=!1,this.setScores=!1,this.calculatedTime=!1,this.newRecord=!1,this.text1="",this.text2="",this.text3="",this.pressWait=0,this.maxWait=.3,this.update=function(t,e,s,n,h,a){this.calculatedTime||(null!=h.levelTimes[s.currentLevel]&&(h.currentTime=h.currentTime+h.levelTimes[s.currentLevel]),this.calculatedTime=!0),ctx=Pt.context,ctx.save(),ctx.translate(0,0),ctx.fillStyle="#1e606e",ctx.fillRect(40,60,t-90,e-90),ctx.fillStyle="#2d1b00",ctx.fillRect(50,70,t-110,e-110),ctx.restore(),ctx.save(),ctx.font="16px Monaco",ctx.fillStyle="#c4f0c2";var l="#5ab9a8";qt(ctx,[{text:"=========== ",fillStyle:l},{text:"Code & Art: @CarelessLabs"},{text:" ===========",fillStyle:l}],60,95),s.loser&&ctx.fillText(" Extra Speed ++",380,120),qt(ctx,[{text:"============== ",fillStyle:l},{text:"Music: @ModalModule"},{text:" ==============",fillStyle:l}],60,350);var r=1,c=0;if(this.showLevel){ctx.fillText("1. Back",60,100+25*r+c);var o=1,f=0,y=++r+20;for(r=0,i=0;i<a.levels.length;i++){r++;var x=null==h.levelTimes[i]?"--":zt(h.levelTimes[i],2);i<10?ctx.fillText("0"+i+". "+x,60+110*f,120+25*r+c+y):ctx.fillText(i+". "+x,60+110*f,120+25*r+c+y),6==o&&(o=0,r=0,f++),o++}ctx.fillText("Total: "+zt(h.totalTime(),2)+" Win: 230",310,320)}else{""!=this.text1?(ctx.fillText(this.text1,60,120+25*r),r++,ctx.fillText(this.text2,60,120+25*r)):c-=25,""!=this.text3&&(r++,ctx.fillText(this.text3,60,120+25*r)),r+=2;var u=a.complete?s.currentLevel+1:s.currentLevel;a.complete&&s.currentLevel==a.levels.length-1&&(u=0),qt(ctx,[{text:"::: MENU :::",fillStyle:"#5ab9a8"}],60,105+25*r+c),r++,ctx.fillText("1. Play level "+u,60,105+25*r+c),r++,ctx.fillText("2. Retry level "+s.currentLevel,60,105+25*r+c),r++,ctx.fillText("3. Level Times",60,105+25*r+c),r++,ctx.fillText("4. Short of time! (Go Back)",60,105+25*r+c)}ctx.restore()},this.tick=function(t,e,i,s){this.setScores&&(this.setScores=!1,null==s||s.died||s.fell?(this.text2="",this.text3="",s.fell?this.text1="You fell to your death.":s.died&&(this.text1="Try not to die!")):(this.newRecord=!1,this.text1="",this.text2="             TIME: "+zt(i.levelTime,3),this.text3="",!i.timeOver&&null==i.levelTimes[s.currentLevel]||i.levelTimes[s.currentLevel]>i.levelTime?(this.text1=" NEW RECORD LEVEL: "+s.currentLevel,this.newRecord=!0,null!=i.levelTimes[s.currentLevel]&&(this.text3="  PREVIOUS RECORD: "+zt(i.levelTimes[s.currentLevel],3)),i.levelTimes[s.currentLevel]=i.levelTime):i.timeOver?(this.text1="Out of time!",this.text2=""):(this.newRecord=!1,this.text1="SLOWER TIME LEVEL: "+s.currentLevel,null!=i.levelTimes[s.currentLevel]&&(this.text3="   CURRENT RECORD: "+zt(i.levelTimes[s.currentLevel],3)))),s.died=!1,s.fell=!1,i.calcTime(),i.timeOver=!1),this.done||(this.time+=t,this.pressWait-=t/1e3,Pt.keys&&!this.showLevel&&this.pressWait<=0?(Pt.keys[Y]?(e.complete&&(s.currentLevel<e.levels.length-1?s.currentLevel++:(i.totalTime()<=i.winTime?s.winner=!0:(s.loser=!0,s.maxSpeed=4),s.currentLevel=0)),this.done=!0,e.complete=!1,e.reset(s)):Pt.keys[N]?(e.complete=!1,this.done=!0,e.reset(s)):Pt.keys[B]?this.showLevel=!0:Pt.keys[J]&&(s.currentLevel=0,this.done=!0,e.reset(s)),(Pt.keys[Y]||Pt.keys[N]||Pt.keys[B])&&(this.pressWait=this.maxWait)):Pt.keys&&this.showLevel&&Pt.keys[Y]&&(this.showLevel=!1,this.pressWait=this.maxWait))},this.reset=function(){this.calculatedTime=!1,this.done=!1,this.time=0}}function w(e,s,n,a,l,r){this.entity=new d(e,s,a,l,"hero"),this.winner=!1,this.loser=!1,this.maxLives=99,this.lives=99,this.died=!1,this.fell=!1,this.speed=1,this.color=n,this.startX=a,this.startY=l,this.currentLevel=0,this.prevLevel=null,this.active=!1,this.reset=!1,this.jumping=!1,this.onLadder=!1,this.exitLadder=!1,this.onLeftA=!1,this.onRightA=!1,this.image=new Image,this.image.src=Ht,this.fx=[];var c=0;this.maxSpeed=3;var o=0;this.maxJPower=17;var f=!1,y=Wt,x=!1,u=!1,v=0,m=0;function g(){mt.hbX=mt.entity.x+mt.entity.hWidth,mt.hbY=mt.entity.y+mt.entity.hHeight/2}this.update=function(t){for(ctx=Pt.context,ctx.save(),ctx.translate(this.entity.x-t.entity.x,this.entity.y-t.entity.y),ctx.fillStyle="#196127",ctx.fillRect(this.entity.mhWidth,this.entity.mhHeight,this.entity.width,this.entity.height),ctx.restore(),i=0;i<this.fx.length;i++){var e=this.fx[i];e.tick(),e.update(t),0==e.entity.active&&this.fx.splice(i,1)}},this.newPos=function(e,s){v=0;var n=this.entity.y,a=this.falling;y=this.onLadder&&!this.exitLadder?0:Wt,this.onLadder&&!this.exitLadder&&(o=0),this.hbX1=this.entity.x,this.hbY1=this.entity.y,g();var l=this.entity.x+c*this.speed,r=this.entity.y+y-o;this.onLeftA?(l-=3,c>3&&this.fx.length<10&&this.fx.push(new p(this,ct,k,!0))):this.onRightA&&(l+=3,c<-3&&this.fx.length<10&&this.fx.push(new p(this,ct,S,!0))),m>3.5&&(this.fx.push(new p(this,ct,S,!0)),this.fx.push(new p(this,ct,k,!0))),this.onLadder&&(x&&!this.exitLadder?(r-=3,x=!1,r+=o):u&&(r+=3,u=!1)),this.exitLadder=!1,o>0?o--:this.jumping=!1;var d=!0,w=!0;for(this.onLadder=!1,this.onLeftA=!1,this.onRightA=!1,i=0;i<e.length;i++)t=e[i],t.isSolid&&t.active&&Vt(l,this.hbY1,this.entity.width,this.entity.height,t.entity.x,t.entity.y,t.entity.width,t.entity.height)&&(t.oneWay||(w=!1)),Vt(this.hbX1,r,this.entity.width,this.entity.height,t.entity.x,t.entity.y,t.entity.width,t.entity.height)&&(t.isSolid&&t.active?t.oneWay?this.entity.y+this.entity.height<=t.entity.y&&(d=!1,this.jumping||(this.entity.y=t.entity.y-this.entity.height)):(d=!1,this.jumping||this.entity.y+this.entity.height<t.entity.y&&(this.entity.y=t.entity.y-this.entity.height)):t.type!=Z&&t.type!=$||(this.onLadder=!0)),t.type==$?Vt(this.hbX1,r+28,this.entity.width,this.entity.height,t.entity.x,t.entity.y,t.entity.width,t.entity.height)&&(this.exitLadder=!0,v=t.entity.y-r):t.type==et?Vt(this.hbX1,r+10,this.entity.width,this.entity.height,t.entity.x,t.entity.y,t.entity.width,t.entity.height)&&(this.onLeftA=!0):t.type==it&&Vt(this.hbX1,r+10,this.entity.width,this.entity.height,t.entity.x,t.entity.y,t.entity.width,t.entity.height)&&(this.onRightA=!0);f=!d,w&&(this.entity.x=l),d&&(this.entity.y=r),this.entity.y>700&&(s.gitUI.setScores=!0,h(at,1),this.lives--,this.fell=!0,this.entity.y=this.startY,this.entity.x=this.startX,s.reset(),this.reset=!0),this.falling=this.entity.y!=n,this.falling!=a&&f&&0==o&&(this.fx.push(new p(this,ct,k,!1)),this.fx.push(new p(this,ct,S,!1))),this.onLadder||this.exitLadder||f?m=0:m+=.1},this.tick=function(){c>0?(c-=.3)<0&&(c=0):c<0&&(c+=.3)>0&&(c=0),Pt.keys&&!this.jumping&&(Pt.keys[R]||Pt.keys[I]||Pt.keys[X])&&this.moveUp(),Pt.keys&&(Pt.keys[W]||Pt.keys[P])&&this.onLadder&&(u=!0),Pt.keys&&(Pt.keys[k]||Pt.keys[A])&&c>-this.maxSpeed&&c--,Pt.keys&&(Pt.keys[S]||Pt.keys[D])&&c<this.maxSpeed&&c++,wt.length>0&&((wt[0].axes[0]<-.8||wt[0].axes[2]<-.8||wt[0].buttons[14].pressed)&&c>-this.maxSpeed&&c--,(wt[0].axes[0]>.8||wt[0].axes[2]>.8||wt[0].buttons[15].pressed)&&c<this.maxSpeed&&c++,(wt[0].axes[1]<-.8||wt[0].axes[3]<-.8||wt[0].buttons[12].pressed)&&this.moveUp(),(wt[0].axes[1]>.8||wt[0].axes[3]>.8||wt[0].buttons[13].pressed)&&this.onLadder&&(u=!0))},this.resetPos=function(t,e){this.startX=t,this.startY=e,this.entity.x=this.startX,this.entity.y=this.startY,g(),c=0,jumping=!1,o=0,this.active=!0,this.fx=[],m=0},this.updateHitbox=function(){g()},this.moveUp=function(){0==o&&(1==f||1==this.exitLadder&&v<=15)&&(this.jumping=!0,o=this.maxJPower,h(ht,1)),this.onLadder&&(x=!0)},this.gethPower=function(){return c},this.resetHero=function(){this.currentLevel=0,this.lives=this.maxLives}}function T(){this.update=function(t,e,i,s){ctx=Pt.context,ctx.save(),ctx.translate(0,0),ctx.fillStyle="#2d1b00",ctx.fillRect(0,0,t,40),ctx.restore(),ctx.save(),ctx.font="20px Verdana",ctx.fillStyle="#c4f0c2",c="#5ab9a8",e.winner?ctx.fillText("Thank you for playing! @CarelessLabs and @ModalModule",10,28):(qt(ctx,[{text:"Lives: "},{text:e.lives,fillStyle:c}],10,28),args=[{text:"Level: "},{text:e.currentLevel,fillStyle:c}],qt(ctx,args,130,28),e.active&&s.active?qt(ctx,[{text:"Time Left: "},{text:zt(i.currentTime,0),fillStyle:c}],240,28):qt(ctx,[{text:"Time Left: "},{text:"_._",fillStyle:c}],240,28),qt(ctx,[{text:"Level Time: "},{text:zt(i.levelTime,2),fillStyle:c}],413,28)),ctx.restore()}}function L(){this.done=!1,this.time=0,this.gitUI=new g,this.tick=function(t){ctx=Pt.context,ctx.font="30px Arial",qt(ctx,[{text:"=========== ",fillStyle:"#5ab9a8"},{text:"CarelessLabs"},{text:" =========== ",fillStyle:"#5ab9a8"}],10,50),qt(ctx,[{text:"=================================",fillStyle:"#5ab9a8"}],10,350),Pt.context.fillText("AD or Arrows to move",150,120),Pt.context.fillText("Space or W to Jump",160,160),Pt.context.fillText("1,2,3,4 to select level options",90,200),Ut?Pt.context.fillText("=== PRESS SPACE ===",120,300):Pt.context.fillText("Rewinding the cassette tape",100,300),Pt.keys&&Pt.keys[X]&&(null==e&&(e=new AudioContext),Mt=!0)},this.reset=function(){this.done=!1,this.time=0,this.gitUI.reset()},this.trans=function(t,e){if(this.time<70){var s=t/32,n=e/32;if(this.time<32)for(i=0;i<=s;i++)for(j=0;j<=n;j++)ctx=Pt.context,ctx.save(),ctx.translate(32*i,32*j),ctx.fillStyle="#1e606e",ctx.fillRect(this.time/2,this.time/2,32-this.time,32-this.time),ctx.restore();this.time+=2}else this.done=!0}}getSound=function(t,e){var i;switch(t){case st:i=a(e);break;case nt:i=o(e);break;case ht:i=l(e);break;case at:i=r(e);break;case lt:i=f(e);break;case rt:i=y(e);break;default:return 1}return i};var k=37,S=39,R=38,W=40,I=87,A=65,P=83,D=68,U=0,C=2,X=32,Y=49,N=50,B=51,J=52,V=0,_=1,z=2,q=3,K=4,Q=5,Z=6,$=7,tt=8,et=9,it=10,st=0,nt=1,ht=2,at=3,lt=4,rt=5,ct=0,ot=0,ft=1,yt=2,xt=3,ut=4;function vt(t,e,s){this.tiles=[],this.backTiles=[],this.coins=[],this.enemies=[],this.startX=0,this.startY=0,this.canvasHalfW=t/2,this.canvasHalfH=e/2,this.showPortal=!1,this.levels=[],this.active=!1,this.complete=!1,this.maxLevels;var n,a=0,l=0;this.draw=function(t,e){for(i=0;i<this.backTiles.length;i++){this.backTiles[i].update(e)}for(i=0;i<this.tiles.length;i++){this.tiles[i].update(e)}for(i=0;i<this.coins.length;i++){this.coins[i].update(e)}for(i=0;i<this.enemies.length;i++){this.enemies[i].update(e)}},this.tick=function(t,e,s){for(i=0;i<this.tiles.length;i++){this.tiles[i].tick(t)}for(i=0;i<this.enemies.length;i++){this.enemies[i].tick(t,e)}for(i=0;i<this.coins.length;i++){var n=this.coins[i];n.type==z&&Bt(n)&&this.active&&n.active?(h(nt,1),n.active=!1,a++):n.type==tt&&this.showPortal&&(n.active?n.active&&Bt(n)&&(s.prevTime=s.currentTime,e.gitUI.setScores=!0,h(lt,1),this.showPortal=!1,this.complete=!0,t.active=!1,this.active=!1,t.currentLevel==this.maxLevels&&(t.currentLevel=-1),e.reset()):n.active=!0)}a!=l||t.reset?t.reset&&(this.showPortal=!1,t.reset=!1,t.active=!1,this.active=!1,e.reset(),this.reset(t)):this.showPortal=!0},this.reset=function(t){this.showPortal=!1,this.active=!1;var e=null!=t?t.currentLevel:0;l=0,a=0,this.tiles=[],this.backTiles=[],this.coins=[],this.enemies=[],null!=t&&t.winner?(n=c,t.maxSpeed=6,t.maxJPower=26):n=this.levels[e];var i=n.length,s=n[0].length;for(row=0;row<i;row++)for(col=0;col<s;col++){var h;xx=30*col,yy=30*row;var r=n[row][col];[_,K,Q,Z,$,et,it].includes(r)?(h=new Ft(30,xx,yy,r,!0,col,row),this.tiles.push(h)):r==z||r==tt?(h=new Ft(30,xx,yy,r,!1,col,row),this.coins.push(h),r==z&&l++):r==q?(this.startX=xx,this.startY=yy):Array.isArray(r)&&this.enemies.push(new v(xx,yy,r)),Math.random()>.8&&(h=new Ft(30,xx,yy,V,!1,col,row),this.backTiles.push(h))}null!=t&&t.resetPos(this.startX,this.startY)},M=[0,0,0,0,0,0,0,0,0,0,0,0],r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],O=[1,1,1,1,1,1,1,1,1,1,1,1],this.levels.push([M,M,M,[0,1,1,1,0,1,1,1,0,1,0,0],[0,1,0,0,0,1,0,1,0,1,0,0],[0,1,0,1,0,1,0,1,0,0,0,0],[0,1,1,1,0,1,1,1,0,1,0,0],M,[3,0,2,0,0,2,0,0,2,0,0,8],[4,4,4,4,4,4,4,4,4,4,4,4]]),this.levels.push([r,r,[0,0,1,0,1,0,1,0,1,0,1,0,1,1,1,0],[0,0,1,0,1,0,1,0,1,1,1,0,1,0,1,0],[0,0,1,0,1,0,1,0,1,0,1,0,1,1,1,0],[0,1,1,0,1,1,1,0,1,0,1,0,1,0,0,0],r,[0,0,0,0,0,2,0,0,0,2,0,0,0,0,0,0],[0,3,0,0,0,1,0,0,0,1,0,0,0,8,0,0],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]]),this.levels.push([r,r,[0,1,1,0,1,0,0,1,0,1,0,1,0,1,0,0,0],[0,1,0,0,1,0,0,1,0,1,1,1,0,1,1,1,0],[0,1,0,0,1,0,0,1,0,1,0,1,0,1,0,1,0],[0,1,1,0,1,1,0,1,0,1,0,1,0,1,1,1,0],r,[0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,6,1,4,4,4,0,0,0,0,0,0,0],[0,0,0,0,0,6,1,0,0,0,0,0,0,0,0,0,0],[0,3,0,2,0,6,1,0,2,0,0,0,2,0,0,8,0],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]]),E=[180,90,ot],this.levels.push([[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,1,0,1,0,1,0,1,0,1,0,1,1,1,0,0],[0,0,0,0,1,0,1,0,1,0,1,1,1,0,1,0,1,0,0],[0,0,0,0,1,0,1,0,1,0,1,0,1,0,1,1,1,0,0],[0,0,1,1,1,0,1,1,1,0,1,0,1,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,3,0,0,2,0,0,0,0,0,E,0,0,0,2,0,8,0,0],[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]]),E=[150,150,ot],F=[210,90,ot],this.levels.push([[2,0,0,0,0,0,0,0,0,0,0,2],[0,0,0,0,0,E,7,0,8,0,0,0],[1,1,1,1,1,1,6,1,1,1,1,1],[0,0,0,0,0,0,6,0,0,0,0,0],[2,0,0,7,0,0,6,0,7,0,0,2],[4,0,0,6,4,4,4,4,6,0,0,4],[0,0,0,6,0,0,0,0,6,0,0,0],[2,0,0,0,0,0,0,F,0,7,0,2],[4,4,4,4,4,4,4,4,4,6,4,4],[0,0,0,0,0,0,0,0,0,6,0,0],[3,0,0,0,0,0,0,0,0,6,0,0],O]),E=[60,0,ot],F=[60,0,ot],G=[120,120,ot],this.levels.push([M,[2,0,E,0,0,0,0,7,0,8,F,2],[1,1,1,1,0,0,1,6,1,1,1,1],[0,0,0,0,0,0,0,6,0,0,0,0],[2,0,7,0,0,0,0,6,0,0,0,2],[4,4,6,0,4,4,4,4,4,0,4,4],[0,0,6,0,0,0,0,0,0,0,0,0],[2,0,6,0,G,0,0,0,0,7,0,2],[4,4,4,4,4,4,4,4,4,6,4,4],[0,0,0,0,0,0,0,0,0,6,0,0],[0,3,0,0,0,0,0,0,0,6,0,2],O]),this.levels.push([r,r,[0,5,0,5,5,5,0,5,5,5,0,0],[0,5,0,5,0,0,0,5,0,0,0,0],[0,5,0,5,0,0,0,5,5,0,0,0],[0,5,0,5,0,0,0,5,0,0,0,0],[0,5,0,5,5,5,0,5,5,5,0,0],M,M,[0,3,0,2,2,2,2,2,2,0,8,0],[5,5,5,5,5,5,5,5,5,5,5,5],O]),E=[60,120,ot],F=[30,0,ot],this.levels.push([M,[0,0,0,0,2,0,0,2,0,0,0,0],[0,0,0,0,0,0,5,5,0,0,2,0],[0,8,0,0,0,0,0,0,0,5,5,0],[0,0,0,0,0,F,0,0,0,0,0,0],[0,0,5,5,4,4,4,5,5,0,0,0],M,[5,5,2,0,E,0,0,0,0,2,0,7],[1,1,4,4,4,4,4,4,4,4,4,6],[0,0,0,0,0,0,0,0,0,0,0,6],[3,0,2,0,0,0,0,0,0,2,0,6],[1,1,5,5,5,5,5,5,5,5,1,1]]),this.levels.push([[7,0,0,0,2,0,0,0,0,0,0,0],[6,4,4,4,4,0,0,0,0,0,0,0],[6,0,0,0,0,0,0,0,0,0,0,0],[6,0,0,0,0,2,0,2,0,0,0,8],[6,0,0,0,0,5,0,5,0,1,4,4],[6,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,7],[0,0,4,4,5,5,4,4,5,5,4,6],[0,0,0,0,0,0,0,0,0,0,0,6],[0,0,0,0,2,0,2,0,2,0,0,6],[3,0,0,0,0,0,0,0,0,0,0,6],[1,1,1,0,5,0,5,0,5,0,1,1]]),this.levels.push([[2,0,0,0,0,0,0,0,0,0,0,0],M,[5,0,7,0,0,0,0,0,0,0,8,0],[0,5,6,5,5,0,0,0,0,4,4,4],[0,0,6,0,0,0,0,0,0,0,0,2],[0,0,6,0,0,0,5,5,5,0,0,4],[2,3,0,0,0,0,0,0,0,0,0,2],[4,4,0,0,0,0,0,0,0,0,0,4],[0,0,5,0,0,0,0,0,0,0,0,2],[0,0,0,5,0,0,0,0,0,0,0,4],[0,2,0,0,5,5,0,0,0,0,0,2],[1,1,1,0,0,0,0,1,1,1,1,1]]),this.levels.push([M,M,M,M,[0,0,0,9,0,0,0,10,0,0,0,0],[0,0,9,0,0,0,0,0,10,0,0,0],[0,9,0,0,0,0,0,0,0,10,0,0],[0,0,9,0,0,0,0,0,10,0,0,0],[0,0,0,9,0,0,0,10,0,0,0,0],M,[1,3,0,2,0,2,8,2,0,2,0,1],[10,10,10,10,10,10,10,10,10,10,10,10]]),this.levels.push([M,M,M,M,[0,0,0,0,5,1,1,1,1,1,5,0],[0,0,0,0,1,0,0,0,0,0,0,0],[0,0,0,0,1,0,0,0,0,0,0,0],[0,0,0,0,1,7,0,2,0,7,0,0],[0,3,0,1,1,6,1,1,1,6,0,0],[0,0,0,0,0,6,1,0,0,6,0,2],[1,8,0,2,0,0,1,0,2,0,0,1],[10,10,10,10,10,10,1,10,10,10,10,10]]),this.levels.push([M,[0,0,0,8,0,0,0,0,0,0,0,0],[0,0,0,0,0,1,4,4,0,0,0,2],[0,0,0,2,0,1,0,0,0,0,4,4],[0,3,0,7,0,1,2,0,0,0,0,0],[1,4,4,6,4,1,9,9,9,0,0,0],[1,0,0,6,0,1,0,0,0,0,0,2],[1,0,0,6,0,1,0,0,10,10,10,10],[1,0,0,6,0,1,2,0,0,0,0,0],[1,0,0,6,0,1,9,9,9,9,0,0],[1,2,0,6,0,0,0,0,0,0,0,2],[1,1,10,10,10,10,10,10,10,10,10,10]]),E=[90,0,ot],F=[0,90,ot],this.levels.push([M,[2,0,5,4,5,1,0,1,1,1,1,1],[5,0,2,0,0,1,0,0,0,0,0,0],[2,0,5,0,2,1,0,0,0,0,E,2],[5,0,2,0,5,1,2,4,9,9,9,4],[2,0,5,0,2,1,0,0,0,0,0,0],[5,0,2,0,5,1,0,F,0,0,0,2],[2,0,5,0,2,1,2,4,9,9,9,4],[5,0,2,0,5,1,0,0,0,7,0,0],[2,0,5,0,0,1,2,1,1,6,1,1],[5,0,0,3,0,1,0,0,0,6,0,8],O]),E=[90,30,xt],this.levels.push([M,M,M,M,M,[0,0,0,0,0,8,0,0,0,0,0,0],[0,0,7,0,0,0,0,0,0,7,0,0],[0,0,6,1,5,5,5,5,1,6,0,0],[0,0,6,0,2,0,0,2,0,6,0,0],[0,2,6,0,0,0,0,0,0,6,0,0],[3,1,6,0,0,0,E,0,0,6,2,0],O]),E=[60,30,ut],this.levels.push([[0,0,0,0,0,1,1,1,1,1,0,0],[0,0,0,0,0,0,1,1,1,0,0,0],[7,0,2,0,0,0,2,E,0,0,0,8],[6,4,4,4,4,4,4,4,4,4,4,4],[6,0,0,0,0,0,0,0,0,0,0,0],[6,0,0,0,0,0,7,0,2,0,0,2],[1,5,5,5,5,0,6,4,9,9,9,9],[0,5,2,2,5,0,6,0,0,0,0,0],[0,5,2,2,5,0,6,0,0,0,0,0],[0,5,5,5,5,0,6,0,0,0,0,0],[1,1,1,1,1,1,1,0,2,0,0,2],[0,3,0,0,0,0,0,0,1,0,0,1],[1,1,10,10,10,10,10,10,1,0,0,1]]),this.levels.push([[0,0,0,0,0,3,0,0,0,0,0,0],[0,0,0,0,5,5,5,0,0,0,0,0],M,[0,0,0,0,0,2,0,0,0,0,0,0],M,M,M,[0,0,0,0,0,2,0,0,0,0,0,0],M,M,M,[0,0,0,0,2,0,0,0,0,0,0,0],M,M,M,[0,0,0,0,0,0,2,0,0,0,0,0],M,M,[0,0,0,0,0,0,2,0,0,0,0,8],[0,0,0,0,0,0,5,0,0,5,0,5]]),this.levels.push([[2,0,0,0,0,0,0,0,0,0,0,0],[0,2,0,0,2,0,0,0,0,0,0,2],[0,5,0,0,5,0,0,2,0,0,2,0],[0,0,0,0,0,0,0,5,0,0,5,5],[2,0,0,0,0,0,0,0,0,0,0,0],[2,0,0,0,0,0,0,0,0,0,0,9],[2,0,0,0,2,0,0,0,2,0,0,0],[2,0,0,0,10,0,0,0,1,0,0,0],[0,0,2,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0,0,0],[8,2,0,0,0,3,0,0,0,0,2,0],[1,1,1,5,5,5,5,5,5,5,5,5]]),E=[150,120,yt],F=[30,90,yt],G=[150,90,yt],H=[90,30,yt],this.levels.push([[0,0,8,0,2,7,2,0,0,0,0,0],[2,0,9,9,9,6,10,10,10,0,0,2],[0,F,0,0,0,6,0,0,0,H,0,0],[4,4,4,4,5,6,5,5,4,4,4,4],[0,0,0,0,0,6,0,0,0,0,0,0],[0,2,0,0,0,6,0,0,0,0,2,0],[0,0,0,7,0,6,0,G,7,0,0,0],[0,1,1,6,1,1,1,1,6,1,1,0],[0,0,0,6,0,0,0,0,6,0,0,0],[0,3,0,6,0,0,E,0,6,0,2,0],[0,4,4,4,4,4,4,4,4,4,4,0],M]),this.levels.push([[8,0,2,0,0,0,0,0,0,0,0,0],[0,0,5,0,0,5,0,5,0,5,0,0],[0,0,0,0,0,0,0,0,0,0,0,5],[7,0,0,0,0,0,0,0,0,0,0,0],[6,10,10,10,10,10,0,0,0,5,0,5],[6,0,0,0,0,0,0,0,0,0,0,0],[6,0,0,0,0,0,0,0,0,0,0,0],[6,0,0,0,0,0,0,0,0,0,0,0],[5,0,0,9,9,9,9,9,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,5],[3,0,0,0,0,0,0,0,0,0,0,0],[10,10,10,10,10,10,10,10,10,0,0,0]]),this.levels.push([[0,0,0,0,0,2,0,0,2,0,0,8],[0,7,0,0,0,7,0,0,7,0,0,7],[1,6,1,0,0,0,0,0,0,0,0,0],[0,6,0,0,0,0,0,0,0,0,0,0],[0,6,0,0,2,0,0,2,0,0,0,0],[0,6,0,0,7,0,0,7,0,0,2,7],[0,4,0,0,0,0,0,0,0,0,5,6],[0,0,0,0,0,0,0,0,0,0,0,6],[0,0,0,0,0,0,0,0,0,0,0,6],[0,3,0,0,2,0,0,2,0,0,0,2],[0,7,0,0,7,0,0,7,0,0,7,7],M]),E=[30,0,ot],F=[60,-30,ot],G=[60,-30,ot],this.levels.push([[1,1,1,5,0,0,0,0,0,0,0,0],[0,0,0,1,0,0,0,2,0,1,5,5],[0,0,2,1,0,0,0,0,0,1,2,2],[4,4,4,1,0,0,0,0,0,1,4,4],[2,0,G,1,0,0,2,0,0,1,2,2],[4,4,4,1,0,0,0,0,0,1,5,5],[0,E,2,1,0,0,0,0,0,1,2,2],[4,4,4,1,0,0,0,2,0,1,4,4],[3,0,F,1,0,0,0,0,0,1,2,2],[4,4,4,1,0,0,0,0,0,1,5,5],[0,0,0,0,0,0,8,0,0,0,0,0],[5,5,5,5,5,0,5,0,5,5,5,5]]),this.levels.push([[2,5,2,5,2,5,2,8],[5,2,5,2,5,2,5,2],[2,5,2,5,2,5,2,5],[5,2,5,2,5,2,5,2],[2,5,2,5,2,5,2,5],[5,2,5,2,5,2,5,2],[3,5,2,5,2,5,2,5],[1,1,1,1,1,1,1,1]]);var r=[1,2,2,2,2,2,2,2,2,1],c=[[1,1,1,1,1,1,1,1,1,1],[1,2,2,1,3,1,2,2,2,1],[1,8,2,1,5,1,2,2,2,1],r,r,r,r,r,r,[1,1,1,1,1,1,1,1,1,1]];this.maxLevels=this.levels.count}var vt,mt,T,u,dt,pt=!1,gt=100,wt=[],Tt=[],Lt=600,kt=400,Mt=!1,bt=Date.now(),St=Date.now(),Et=0,Rt=0,Wt=6,It=!0,At=0;function startGame(){dt=new x(0,0),(vt=new vt(Lt,kt,1)).reset(null),mt=new w(25,25,"green",vt.startX,vt.startY),dt.newPos(mt,vt),L=new L,T=new T,u=new u,Gt(),Pt.start()}var Pt={canvas:document.createElement("canvas"),start:function(){this.canvas.width=Lt,this.canvas.height=kt,this.context=this.canvas.getContext("2d"),this.context.mozImageSmoothingEnabled=!1,this.context.webkitImageSmoothingEnabled=!1,this.context.imageSmoothingEnabled=!1,this.canvas.classList.add("screen"),document.body.insertBefore(this.canvas,document.body.childNodes[6]),this.frameNo=0,this.interval=setInterval(Ot,20),window.addEventListener("keydown",function(t){t.preventDefault(),Pt.keys=Pt.keys||[],Pt.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("keyup",function(t){Pt.keys[t.keyCode]="keydown"==t.type}),window.addEventListener("mousedown",function(t){t.preventDefault(),Pt.keys=Pt.keys||[],Pt.keys[t.button]=!0}),window.addEventListener("mouseup",function(t){t.preventDefault(),Pt.keys=Pt.keys||[],Pt.keys[t.button]=!1}),this.canvas.oncontextmenu=function(t){t.preventDefault()},window.addEventListener("gamepadconnected",function(t){navigator.getGamepads()[t.gamepad.index];wt[t.gamepad.index]=t.gamepad})},stop:function(){clearInterval(this.interval)},clear:function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height)}};function Ot(){bt=St,St=Date.now(),Et+=Rt=St-bt,navigator.getGamepads?navigator.getGamepads():!navigator.webkitGetGamepads||navigator.webkitGetGamepads,Mt?(It&&Dt?(jt.play(),It=!1):(At+=Rt)>9e4&&(jt.currentTime=0,jt.play(),At=0),Pt.clear(),vt.draw(mt,dt),L.done&&L.gitUI.done?(0==vt.active&&(vt.active=!0,u.setStartTime()),mt.tick(dt),mt.newPos(vt.tiles,L),vt.tick(mt,L,u),u.tick(Rt,u),mt.update(dt)):(L.gitUI.update(Lt,kt,mt,Rt,u,vt),L.trans(Lt,kt)),dt.newPos(mt,vt),T.update(Lt,mt,u,vt),mt.lives<0&&(Mt=!1,u.reset(),mt.resetHero(),vt.reset(mt)),u.timeOver&&(mt.reset||(u.setStartTime(),L.gitUI.setScores=!0,mt.reset=!0)),L.gitUI.tick(Rt,vt,u,mt)):(Pt.clear(),L.tick(Rt))}var jt,Ht="atlas.png",Dt=!1,Ut=!1,Ct={songData:[{i:[3,162,128,0,3,0,128,0,0,0,5,6,45,0,0,0,0,6,1,2,255,0,6,69,0,6,0,6],p:[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,27,33,27,33,27,33,27,33],c:[{n:[113,,113,113,113,,113,113,,108,113,108,115,116,111,108,,113,113,,113,,113,113,,108,113,108,115,116,111,115],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[121,,121,121,121,,121,121,,116,121,116,123,125,116,121,,120,120,,120,,120,120,,111,115,111,118,120,123,125],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[118,,118,118,118,,118,118,,113,118,113,120,121,123,115,,115,115,,115,,115,115,,113,111,113,115,116,118,120],f:[]}]},{i:[0,119,128,1,3,0,128,0,0,0,0,0,43,0,0,0,0,6,1,2,255,117,3,212,0,6,0,6],p:[,,,,2,2,2,,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],c:[{n:[],f:[]},{n:[125,,,125,,,125,125,,,125,,,,,,,,125,125,,,,125,,,125],f:[]}]},{i:[2,0,128,0,3,0,128,0,0,196,5,6,41,0,0,0,0,6,1,2,149,0,0,116,0,6,27,6],p:[,,,7,3,3,3,7,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],c:[{n:[],f:[]},{n:[],f:[]},{n:[,,,,137,,,,,,,,137,,,,,,,,137,,,,,,,,137,,137,137],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,137,,137,137],f:[]}]},{i:[2,0,128,0,3,0,128,0,0,131,5,6,29,0,0,0,0,6,1,1,135,0,0,32,147,6,92,2],p:[,,4,8,4,4,4,8,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[185,,,185,,,185,,,185,,,185,185,,,185,,,185,,,185,,,185,,,185,185],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[185,,,185,,,185,,,185,,,185,185],f:[]}]},{i:[2,100,128,0,1,201,128,0,0,0,5,6,44,0,0,0,0,6,1,2,83,0,0,5,147,6,45,6],p:[,,,,5,5,5,5,5,5,5,5,5,5,5,5,11,29,11,29,11,29,11,29],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[137,137,137,,137,137,,137,,137,137,,137,137,,137,,125,125,,137,137,,137,,137,137,,137,137,,137,140,140,140,,140,140,,140,,140,140,,140,140,,140,,128,128,,140,140,,140,,140,140,,140,140,,140,144,144,144,,144,144,,144,,144,144,,144,144,,144,,132,132,,144,144,,144,,144,144,,144,144,,144,147,147,147,,147,147,,147,,147,147,,147,147,,147,,135,135,,147,147,,147,,147,147,,147,147,,147],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[137,137,137,,137,137,,137,,137,137,,137,137,,137,,123,123,,135,135,,135,,135,135,,135,135,,135,140,140,140,,140,140,,140,,140,140,,140,140,,140,,127,127,,139,139,,139,,139,139,,139,139,,139,144,144,144,,144,144,,144,,144,144,,144,144,,144,,130,130,,142,142,,142,,142,142,,142,142,,142,147,147,147,,147,147,,147,,147,147,,147,147,,147,,132,132,,144,144,,144,,144,144,,144,144,,144],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[137,137,137,,137,137,,137,,137,137,,137,137,,137,,123,123,,135,135,,135,,135,135,,135,135,,135,140,140,140,,140,140,,140,,140,140,,140,140,,140,,127,127,,139,139,,139,,139,139,,139,139,,139,142,142,142,,142,142,,142,,142,142,,142,142,,142,,130,130,,142,142,,142,,142,142,,142,142,,142,145,145,145,,145,145,,145,,145,145,,145,145,,145,,133,133,,145,145,,145,,145,145,,145,145,,145],f:[]}]},{i:[1,100,128,0,3,201,128,0,0,0,5,6,58,0,0,0,0,6,1,2,188,53,0,32,0,6,27,6],p:[,,,,,,,,6,9,6,10,6,9,6,10,36,34,13,32,36,34,13,32],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,,,,152,,,,151,,147,,,,154,,,,152,,,,151,,,,147,,144,,142],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,,,,152,,,,151,,147,,,,154,,,,156,,,,144,,154,,152,,151,,152],f:[]},{n:[,,,,152,,,,151,,147,,,,140,,151,,152,,142,,154,,156,,144,,159,,161],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,,,,149,,,,152,,,,157,,,,159,,,,161,,159,,,,152,,163,,164],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,,166,,164,,163,,159,,,,,,164,,163,,159,,156,,,,154,156,157,159,161,156,152,151],f:[]},{n:[],f:[]},{n:[,,157,,156,,152,,149,,,,147,,149,,151,,152,,151,,147,,142,140,139,140,142,144,145,147],f:[]},{n:[],f:[]},{n:[,,,,149,,,,152,,,,157,,,,159,,,,161,,159,,,,152,,156,,157],f:[]}]}],rowLen:5088,patternLen:32,endPattern:23,numChannels:6},Xt=function(){var t,e,i,s,n,h=function(t){return Math.sin(6.283184*t)},a=function(t){return.003959503758*Math.pow(2,(t-128)/12)},l=function(t,e,i){var s,n,h,l,c,o,f,y=r[t.i[0]],x=t.i[1],u=t.i[3],v=r[t.i[4]],m=t.i[5],d=t.i[8],p=t.i[9],g=t.i[10]*t.i[10]*4,w=t.i[11]*t.i[11]*4,T=t.i[12]*t.i[12]*4,L=1/T,k=t.i[13],M=i*Math.pow(2,2-t.i[14]),b=new Int32Array(g+w+T),S=0,E=0;for(s=0,n=0;s<g+w+T;s++,n++)n>=0&&(n-=M,o=a(e+(15&(k=k>>8|(255&k)<<4))+t.i[2]-128),f=a(e+(15&k)+t.i[6]-128)*(1+8e-4*t.i[7])),h=1,s<g?h=s/g:s>=g+w&&(h-=(s-g-w)*L),l=o,u&&(l*=h*h),c=y(S+=l)*x,l=f,d&&(l*=h*h),c+=v(E+=l)*m,p&&(c+=(2*Math.random()-1)*p),b[s]=80*c*h|0;return b},r=[h,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var e=t%1*4;return e<2?e-1:3-e}];this.init=function(h){t=h,e=h.endPattern,i=0,s=h.rowLen*h.patternLen*(e+1)*2,n=new Int32Array(s)},this.generate=function(){var a,c,o,f,y,x,u,v,m,d,p,g,w,T,L=new Int32Array(s),k=t.songData[i],M=t.rowLen,b=t.patternLen,S=0,E=0,R=!1,W=[];for(o=0;o<=e;++o)for(u=k.p[o],f=0;f<b;++f){var I=u?k.c[u-1].f[f]:0;I&&(k.i[I-1]=k.c[u-1].f[f+b]||0,I<16&&(W=[]));var A=r[k.i[15]],P=k.i[16]/512,O=Math.pow(2,k.i[17]-9)/M,j=k.i[18],H=k.i[19],D=43.23529*k.i[20]*3.141592/44100,U=1-k.i[21]/255,C=1e-5*k.i[22],X=k.i[23]/32,G=k.i[24]/512,F=6.283184*Math.pow(2,k.i[25]-9)/M,Y=k.i[26]/255,N=k.i[27]*M&-2;for(p=(o*b+f)*M,y=0;y<4;++y)if(x=u?k.c[u-1].n[f+y*b]:0){W[x]||(W[x]=l(k,x,M));var B=W[x];for(c=0,a=2*p;c<B.length;c++,a+=2)L[a]+=B[c]}for(c=0;c<M;c++)(d=L[v=2*(p+c)])||R?(g=D,j&&(g*=A(O*v)*P+.5),E+=(g=1.5*Math.sin(g))*(w=U*(d-E)-(S+=g*E)),d=3==H?E:1==H?w:S,C&&(d=(d*=C)<1?d>-1?h(.25*d):-1:1,d/=C),R=(d*=X)*d>1e-5,T=d*(1-(m=Math.sin(F*v)*G+.5)),d*=m):T=0,v>=N&&(T+=L[v-N+1]*Y,d+=L[v-N]*Y),L[v]=0|T,L[v+1]=0|d,n[v]+=0|T,n[v+1]+=0|d}return++i/t.numChannels},this.createWave=function(){var t=44+2*s-8,e=t-36,i=new Uint8Array(44+2*s);i.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var h=0,a=44;h<s;++h){var l=n[h];l=l<-32767?-32767:l>32767?32767:l,i[a++]=255&l,i[a++]=l>>8&255}return i},this.getData=function(t,e){for(var i=2*Math.floor(44100*t),s=new Array(e),h=0;h<2*e;h+=1){var a=i+h;s[h]=t>0&&a<n.length?n[a]/32768:0}return s}};function Gt(){var t=new Xt;t.init(Ct),setInterval(function(){if(!Dt&&(Dt=t.generate()>=1)){var e=t.createWave();(jt=document.createElement("audio")).src=URL.createObjectURL(new Blob([e],{type:"audio/wav"})),Ut=!0}},0)}function Ft(t,e,i,s,n,h,a){this.entity=new d(t,t,e,i,"tile"),this.isSolid=n,this.column=h,this.row=a,this.image=new Image,this.collected=!1,this.type=s,this.active=!0,this.time=0,this.oneWay=!1,this.leftPush=!1,this.rightPush=!1,this.image.src=Ht,this.draw=!0,this.sx=0,this.sy=0,this.sw=30,this.sh=30;switch(this.type){case _:this.sx=60;break;case z:this.sx=90;break;case Z:this.sy=60,this.isSolid=!1;break;case $:this.draw=!1,this.isSolid=!1;break;case K:this.sx=120,this.oneWay=!0;break;case V:this.sy=30;break;case Q:this.oneWay=!0,this.time=1,this.sx=30,this.sy=30;break;case tt:this.sx=60,this.sy=30,this.active=!1;break;case et:this.sx=0,this.sy=0,this.leftPush=!0;break;case it:this.sx=60,this.sy=30,this.rightPush=!0,this.entity.angle=2*Math.PI-180*Math.PI/180}this.update=function(t){ctx=Pt.context,ctx.save(),ctx.translate(this.entity.x-t.entity.x,this.entity.y-t.entity.y),ctx.rotate(this.entity.angle),this.setTileAlphas(),this.animBelt(),null==this.image?(ctx.fillStyle=this.color,ctx.fillRect(this.mhWidth,this.mhHeight,this.entity.width,this.entity.height)):this.active&&this.draw&&(this.type==Q?ctx.drawImage(this.image,this.sx,this.entity.yOffset,this.sw,this.sh,this.entity.mhWidth,this.entity.mhHeight+this.entity.yOffset,this.entity.width,this.entity.height):ctx.drawImage(this.image,this.sx,this.sy,this.sw,this.sh-1,this.entity.mhWidth,this.entity.mhHeight,this.entity.width,this.entity.height)),ctx.restore()},this.tick=function(t){this.type==Q&&(this.entity.yOffset>-30&&Yt(t,this)&&t.entity.y<this.entity.y?(this.time-=.012,this.entity.yOffset-=.8):this.entity.yOffset<-30&&(this.active=!1))},this.animBelt=function(){this.type!=et&&this.type!=it||!this.active||(this.time+=.01,this.sx=0,this.sy=0,this.time<.2?(this.sx=120,this.sy=30):this.time<.4&&(this.sx=90,this.sy=30),this.time>.6&&(this.time=0))},this.setTileAlphas=function(){this.type==tt&&this.active?(this.time+=.001,ctx.globalAlpha=Nt(this.time)):this.type==Q&&(ctx.globalAlpha=this.time)}}function Yt(t,e){return null!=e.entity&&Vt(t.entity.x,t.entity.y+20,t.entity.width,t.entity.height,e.entity.x,e.entity.y,e.entity.width,e.entity.height)}function Nt(t){return.5*(1+Math.sin(157*t))}function Bt(t){return mt.hbX<t.entity.x+t.entity.width&&mt.hbX>t.entity.x&&mt.hbY<t.entity.y+t.entity.height&&mt.hbY>t.entity.y}function Jt(t,e,i,s){return Vt(t.x+e/2,t.y+e/2,t.width-e,t.height-e,i.x+s/2,i.y+s/2,i.width-s,i.height-s)}function Vt(t,e,i,s,n,h,a,l){return t<n+a&&t+i>n&&e<h+l&&e+s>h}function _t(t){return(t/1e3).toFixed(1)}function zt(t,e){return(t/1e3).toFixed(e)}const qt=(t,e,i,s)=>{let n=t.fillStyle,h=t.font;t.save(),e.forEach(({text:e,fillStyle:a,font:l})=>{t.fillStyle=a||n,t.font=l||h,t.fillText(e,i,s),i+=t.measureText(e).width}),t.restore()};