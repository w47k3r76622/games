(()=>{var t={944:t=>{t.exports="precision mediump float;uniform vec2 u_FogDist;uniform vec3 u_FogColor;varying vec4 v_color;varying float v_dist;varying vec4 shadowPos;uniform sampler2D depthColorTexture;float decodeFloat(vec4 color){const vec4 bitShift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1);return dot(color,bitShift);}void main(){float fogFactor=(u_FogDist.y-v_dist)/(u_FogDist.y-u_FogDist.x);vec3 color=mix(u_FogColor,vec3(v_color),clamp(fogFactor,0.0,1.0));vec3 fragmentDepth=shadowPos.xyz;float shadowAcneRemover=0.007;fragmentDepth.z-=shadowAcneRemover;float texelSize=1.0/shadowTexture.0;float amountInLight=0.0;for(int x=-1;x<=1;x++){for(int y=-1;y<=1;y++){float texelDepth=decodeFloat(texture2D(depthColorTexture,fragmentDepth.xy+vec2(x,y)*texelSize));if(fragmentDepth.z<texelDepth){amountInLight+=1.0;}}}amountInLight/=9.0;amountInLight=max(amountInLight,0.3);gl_FragColor=vec4(amountInLight*color,v_color.a);}"},9:t=>{t.exports="precision mediump float;vec4 encodeFloat (float depth) {const vec4 bitShift = vec4(256* 256*256,256*256,256,1.0);const vec4 bitMask = vec4(0,1.0/256.0,1.0/256.0,1.0/256.0);vec4 comp = fract(depth*bitShift);comp-=comp.xxyz*bitMask;return comp;}void main (void) {gl_FragColor = encodeFloat(gl_FragCoord.z);}"},625:t=>{t.exports="attribute vec4 position;uniform mat4 model;uniform mat4 lightMatrix;void main(){gl_Position=lightMatrix*model*position;}"},408:t=>{t.exports="attribute vec4 position;attribute vec4 color;attribute vec4 normal;uniform mat4 camera;uniform mat4 model;uniform mat4 nMatrix;uniform vec3 light;uniform vec3 ambientLight;uniform mat4 lightMatrix;varying vec4 shadowPos;varying vec4 v_color;varying float v_dist;void main(){const mat4 texUnitConverter=mat4(0.5,0.0,0.0,0.0,0.0,0.5,0.0,0.0,0.0,0.0,0.5,0.0,0.5,0.5,0.5,1.0);shadowPos=texUnitConverter*lightMatrix*model*position;gl_Position=camera*model*position;vec3 wNormal=normalize(mat3(nMatrix)*normal.xyz);vec3 lightDirection=normalize(light-vec3(model*position));float nDotL=dot(wNormal,lightDirection);vec3 ambient=ambientLight*color.rgb;vec3 diffuse=color.rgb*nDotL;v_color=vec4(diffuse+ambient,1.0);v_dist=gl_Position.w;}"}},e={};function n(i){var s=e[i];if(void 0!==s)return s.exports;var r=e[i]={exports:{}};return t[i](r,r.exports,n),r.exports}n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var i={};(()=>{"use strict";n.d(i,{V:()=>rt});class t{constructor(t,e,n){this.r=t,this.g=e,this.b=n}}const e=new t(1,0,0),s=new t(0,1,0),r=(new t(0,0,1),new t(1,1,1)),o=new t(1,1,0),a=new t(1,0,1),h=new t(0,1,1);class l extends DOMMatrix{transposeSelf(){let t;t=this.m12,this.m12=this.m21,this.m21=t,t=this.m13,this.m13=this.m31,this.m31=t,t=this.m14,this.m14=this.m41,this.m41=t,t=this.m23,this.m23=this.m32,this.m32=t,t=this.m24,this.m24=this.m42,this.m42=t,t=this.m34,this.m34=this.m43,this.m43=t}lookAt(t,e,n,i,s,r,o=0,a=1,h=0){var x,c,u,m,f,p,d,g;x=i-t,c=s-e,u=r-n,f=(c*=m=1/Math.hypot(x,c,u))*h-(u*=m)*a,p=u*o-(x*=m)*h,d=x*a-c*o,g=1/Math.hypot(f,p,d);var v=new l([f*=g,(p*=g)*u-(d*=g)*c,-x,0,p,d*x-f*u,-c,0,d,f*c-p*x,-u,0,0,0,0,1]);v.translateSelf(-t,-e,-n),this.multiplySelf(v)}}class x{constructor(t,e,n){this.x=t,this.y=e,this.z=n}subtract(t){return new x(this.x-t.x,this.y-t.y,this.z-t.z)}cross(t){return new x(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}}class c{constructor(t,e,n,i=r){this.vAi=t,this.vBi=e,this.vCi=n,this.color=i}}class u{constructor({vertices:t,faces:e}){this.floorIntersect=(t,e)=>{const n=this.boundingBox.flb.matrixTransform(e),i=this.boundingBox.frb.matrixTransform(e),s=n.x,r=i.x,o=n.y,a=i.y;if(t.x1<s&&t.x2>s){const e=t.y2-t.y1;if(o<(s-t.x1)/(t.x2-t.x1)*e+t.y1)return!0}if(t.x1<r&&t.x2>r){const e=t.y2-t.y1;if(a<(r-t.x1)/(t.x2-t.x1)*e+t.y1)return!0}return!1},this.pointIntersect=t=>{const e=this.boundingBox.flb,n=this.boundingBox.brt;return t.x>=e.x&&t.x<=n.x&&t.y>=e.y&&t.y<=n.y&&t.z>=e.z&&t.z<=n.z},this.vertices=t,this.faces=e;const n={x1:1/0,y1:1/0,z1:1/0,x2:-1/0,y2:-1/0,z2:-1/0};for(let t=0;t<this.vertices.length;t++){const e=this.vertices[t];e.x<n.x1&&(n.x1=e.x),e.y<n.y1&&(n.y1=e.y),e.z<n.z1&&(n.z1=e.z),e.x>n.x2&&(n.x2=e.x),e.y>n.y2&&(n.y2=e.y),e.z>n.z2&&(n.z2=e.z)}this.boundingBox={flb:new DOMPoint(n.x1,n.y1,n.z1),frb:new DOMPoint(n.x2,n.y1,n.z1),flt:new DOMPoint(n.x1,n.y2,n.z1),frt:new DOMPoint(n.x2,n.y2,n.z1),blb:new DOMPoint(n.x1,n.y1,n.z2),brb:new DOMPoint(n.x2,n.y1,n.z2),blt:new DOMPoint(n.x1,n.y2,n.z2),brt:new DOMPoint(n.x2,n.y2,n.z2)}}static fromSerialized(e){const n=[],i=[],{v:s,f:r,c:o}=e,a=[];for(let t=0;t<s.length;t+=3)n.push(new x(s[t],s[t+1],s[t+2]));for(let e=0;e<o.length;e+=3)a.push(new t(o[e],o[e+1],o[e+2]));for(let t=0;t<r.length;t+=4)i.push(new c(r[t],r[t+1],r[t+2],a[r[t+3]]));return new u({vertices:n,faces:i})}draw(t,e,n,i,s=!1,r=!1,o){if(!this.vbo){const e=[];for(let t=0;t<this.faces.length;t++){const{vAi:n,vBi:i,vCi:s,color:r}=this.faces[t],o=this.vertices[n],a=this.vertices[i],h=this.vertices[s];let l,x,c;l=x=c=o.subtract(a).cross(o.subtract(h)),e.push(o.x,o.y,o.z,r.r,r.g,r.b,l.x,l.y,l.z,a.x,a.y,a.z,r.r,r.g,r.b,x.x,x.y,x.z,h.x,h.y,h.z,r.r,r.g,r.b,c.x,c.y,c.z)}this.vbo=new Float32Array(e),this.buffer=t.createBuffer()}const a=new l(o.toString());a.invertSelf(),a.transposeSelf(),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,this.vbo,t.STATIC_DRAW);const h=this.vbo.BYTES_PER_ELEMENT,x=t.getAttribLocation(e,"position");if(t.vertexAttribPointer(x,3,t.FLOAT,!1,9*h,0),t.enableVertexAttribArray(x),!s){const s=t.getAttribLocation(e,"color");t.vertexAttribPointer(s,3,t.FLOAT,!1,9*h,3*h),t.enableVertexAttribArray(s);const r=t.getAttribLocation(e,"normal");t.vertexAttribPointer(r,3,t.FLOAT,!1,9*h,6*h),t.enableVertexAttribArray(r);const o=t.getUniformLocation(e,"nMatrix");t.uniformMatrix4fv(o,!1,a.toFloat32Array()),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,i),t.uniform1i(n,0)}const c=t.getUniformLocation(e,"model");t.uniformMatrix4fv(c,!1,o.toFloat32Array()),r?t.drawArrays(t.LINE_LOOP,0,3*this.faces.length):t.drawArrays(t.TRIANGLES,0,3*this.faces.length)}}class m{constructor(){this.up=!1,this.left=!1,this.down=!1,this.in=!1,this.out=!1,this.right=!1,this.fire=!1,this.canFire=!0,this.spinR=!1,this.spinL=!1}}const f=(t,e,n)=>{const{player:i}=n;switch(t.key.toLowerCase()){case"w":i.gameInput.up=e,t.preventDefault();break;case"a":i.gameInput.left=e,t.preventDefault();break;case"s":i.gameInput.down=e,t.preventDefault();break;case"d":i.gameInput.right=e,t.preventDefault();break;case"e":i.gameInput.spinR=e,t.preventDefault();break;case"q":i.gameInput.spinL=e,t.preventDefault();break;case" ":e||(i.gameInput.canFire=!0),i.gameInput.fire=e,t.preventDefault();break;case"p":t.preventDefault(),i.health<=0&&!e?n.restart():e||n.togglePause()}},p=.15,d=[45,60],g=.05,v=[{},{bulletDelay:1e3,bulletDamage:5,health:20},{bulletDelay:750,bulletDamage:10,health:30},{bulletDelay:500,bulletDamage:15,health:40},{bulletDelay:500,bulletDamage:20,health:50},{bulletDelay:400,bulletDamage:25,health:60},{bulletDelay:1e4,bulletDamage:0,health:1},{bulletDelay:1e4,bulletDamage:0,health:1},{bulletDelay:1e4,bulletDamage:0,health:1}],y=[6,7,8],w=["doubleGuns","powerBullet","health50"],b={width:512,height:512},T=500,E=[{waveIndices:[[1],[1,1],[1,1,1],[2],[1,2,1],[y[0]],[1,1,1,1],[1,1,1,1,2],[2,2,2],[3],[y[1]],[2,2],[2,1,2],[1,3,1],[3,3],[3,2,2,3],[y[2]],[3,3,3],[3,3,3,3],[2,2,2,2,3],[4]],speed:.1,height:.4,color:s},{waveIndices:[[y[1]],[3,3],[3,2,3],[3,2,2,3],[3,3,3],[3,3,3,3,4],[y[0]],[2,4,2],[2,2,2,2,3],[3,3,3],[3,4,3],[1,3,3,1],[3,4,4,3],[4,4],[4,4,4],[y[2]],[3,3,3,3,5],[4,5,4],[5,4,5],[3,2,2,3,5],[5,5,5]],speed:.15,height:1.2,color:h}],D=[[[0,0]],[[0,3.5]],[[0,3.5],[0,3.5]],[[0,3.5],[0,3.5],[0,3.5]],[[4.5,-1],[0,3],[0,3],[-1,4.5]],[[4.5,-1],[0,3],[0,3],[-1,4.5],[0,0]]];class M{constructor(t,e,n){this.game=t,this.mesh=e instanceof u?new u(e):t.meshes[e],this.health=n||T,this.wireframe=!1,this.pMatrix=new l,this.rMatrix=new l,this.modelMatrix=new DOMMatrix,this.position=new x(0,0,0),this.rotation=new x(0,0,0)}translate(t,e,n){this.position=this.position.subtract(new x(-t,-e,-n)),this.pMatrix.translateSelf(t,e,n)}rotate(t,e,n){this.rotation.x=(this.rotation.x+360+t)%360,this.rotation.y=(this.rotation.y+360+e)%360,this.rotation.z=(this.rotation.z+360+n)%360,this.rMatrix=new l,this.rMatrix.rotateSelf(-this.rotation.x,-this.rotation.y,this.rotation.z)}draw(t=!1){this.modelMatrix=this.pMatrix.multiply(this.rMatrix),this.mesh.draw(this.game.gl,t?this.game.s_program:this.game.program,this.game.samplerUniform,this.game.shadowDepthTexture,t,this.wireframe,this.modelMatrix)}hit(t){this.wireframe=!0,this.health-=t}update(t){this.lastHitTime?this.game.time-250>this.lastHitTime&&(this.wireframe=!1,this.lastHitTime=this.game.time):this.lastHitTime=this.game.time}}class F extends M{constructor(t,e,n,i){const s=[new x(-.05,-.05,g),new x(g,-.05,g),new x(0,g,0),new x(0,-.05,-.05)],r=[new c(0,1,2,e[0]),new c(1,3,2,e[1]),new c(3,0,2,e[2]),new c(0,3,1,e[3])];super(t,new u({vertices:s,faces:r})),this.direction=n,this.damage=i}update(){this.translate(0,0,-.5*this.direction),this.rotate(10,10,10),(this.position.z<-40||this.position.z>20)&&this.destroy()}destroy(){const t=this.game.bullets.indexOf(this);this.game.bullets.splice(t,1)}}class R extends M{constructor(t,e){super(t,e),this.atBounds=!1,this.gameInput=new m,this.powerUps=[];const n=this.mesh.boundingBox;Object.keys(n).map((t=>{n[t].x*=.9,n[t].y*=.9,n[t].z*=.9}))}translate(t,e,n){this.position.x+t>-4&&this.position.x+t<4&&this.position.y+e<3?(t>0?this.rotate(0,0,-1):t<0&&this.rotate(0,0,1),this.atBounds=!1,super.translate(t,e,n)):this.atBounds=!0}update(){if(super.update(),this.rotation.z<180&&(!this.gameInput.left&&!this.gameInput.spinL||this.atBounds&&!this.gameInput.spinL)){const t=Math.min(4,this.rotation.z);this.rotate(0,0,-t)}this.rotation.z>=180&&(!this.gameInput.right&&!this.gameInput.spinR||this.atBounds&&!this.gameInput.spinR)&&this.rotate(0,0,4);const t=new DOMMatrix(this.modelMatrix.toString());t.invertSelf();for(let e=0;e<this.game.bullets.length;e++){const n=this.game.bullets[e],{x:i,y:s,z:r}=n.position,o=new DOMPoint(i,s,r).matrixTransform(t);this.mesh.pointIntersect(o)&&(this.hit(n.damage),n.destroy())}}fire(){let t=1,n=[{x:0,y:0}],i=1,h=[e,r,e,r];if(this.powerUps.includes("doubleGuns")){const e=Math.cos(this.rotation.z*Math.PI/180),i=Math.sin(this.rotation.z*Math.PI/180);n=[{x:e,y:i},{x:-e,y:-i}],t=2,h=[o,r,o,r]}this.powerUps.includes("powerBullet")&&(i=1.75,h=[s,a,r,a]);for(let e=0;e<t;e++){const t=new F(this.game,h,i,5*i);t.translate(this.position.x+n[e].x,this.position.y+n[e].y,this.position.z+this.mesh.boundingBox.flt.z-.1),this.game.bullets.push(t)}}respondToInput(){if(this.gameInput.up&&this.translate(0,p,0),this.gameInput.down&&this.translate(0,-.15,0),this.gameInput.left&&this.translate(-.15,0,0),this.gameInput.right&&this.translate(p,0,0),this.gameInput.spinR&&this.rotate(0,0,-5),this.gameInput.spinL&&this.rotate(0,0,5),this.gameInput.fire&&this.gameInput.canFire)return this.gameInput.canFire=!1,this.fire()}hit(t){this.game.sounds[1].play(),super.hit(t),this.health<=0&&this.die()}die(){this.game.togglePause('<span id="instructions">You died! Press P to restart.</span>')}}const L=document.getElementById("playerScore");class _ extends M{constructor(t,e,n,i){super(t,e,v[e].health),this.translate(0,6,-20),this.reachedStart=!1,this.enemyType=e,this.waveSize=n,this.wavePosition=i,this.direction=i%2*2-1,this.limits=D[n][i]}fire(){let t=1,e=[0,0];5===this.enemyType&&(t=2,e=[-1,1]);for(let n=0;n<t;n++){const t=new F(this.game,[s,o,s,o],-1,v[this.enemyType].bulletDamage);t.translate(this.position.x+e[n],this.position.y,this.position.z+this.mesh.boundingBox.blt.z+.1),this.game.bullets.push(t)}}update(){if(super.update(),!this.reachedStart)return void this.moveToStart();this.lastFiredTime?this.game.time-v[this.enemyType].bulletDelay>this.lastFiredTime&&(this.fire(),this.lastFiredTime=this.game.time):this.lastFiredTime=this.game.time;const t=new DOMMatrix(this.modelMatrix.toString());t.invertSelf();for(let e=0;e<this.game.bullets.length;e++){const n=this.game.bullets[e],{x:i,y:s,z:r}=n.position,o=new DOMPoint(i,s,r).matrixTransform(t);this.mesh.pointIntersect(o)&&(this.hit(n.damage),n.destroy())}this.health<=0&&this.destroy(),this.move()}destroy(){this.game.sounds[3].play();const{enemyWaves:t,currentWave:e}=this.game.level,n=t[e].indexOf(this);t[e].splice(n,1);const i=v[this.enemyType].health;this.game.score+=i>1?i:0,L.innerHTML=`Score: ${this.game.score}`}moveToStart(){this.translate(0,-.2,0),Math.abs(this.position.y-this.initialPos[1])<=.01&&(this.reachedStart=!0)}move(){const{enemyType:t,waveSize:e,wavePosition:n}=this,i=(this.direction+1)/2;1===t&&this.rotate(0,0,2),2===this.enemyType&&this.rotate(0,0,-3),4===this.enemyType&&this.rotate(0,0,4),(e<=3||this.waveSize>=4&&[1,2].includes(n))&&(this.direction*this.position.y-this.limits[i]>=0&&(this.direction*=-1),this.translate(0,.02*this.direction,0)),e>=4&&[0,3].includes(n)&&(this.direction*this.position.x-this.limits[i]>=0&&(this.direction*=-1),this.translate(.02*this.direction,0,0))}hit(t){this.game.sounds[2].play(),super.hit(t)}}class z extends _{constructor(t,e){super(t,e,0,0),this.translate(8*Math.random()-4,0,-50),this.rotate(45,45,0),this.bonusType=w[y.indexOf(e)]}update(){this.rotate(0,2,0),this.translate(0,0,.35),this.position.z>20&&this.destroy(),super.update()}hit(){super.hit(2),"health50"===this.bonusType?this.game.player.health=Math.min(T,this.game.player.health+50):this.game.player.powerUps.includes(this.bonusType)||this.game.player.powerUps.push(this.bonusType)}}class A extends M{constructor(t,e){const n=[],i=[],{width:r,height:o}=e,a=e.fl||o*Math.random(),h=e.fr||o*Math.random(),l=e.bl||o*Math.random(),c=o*Math.random();i[0]=new x(r,c,-r),i[1]=new x(r,h,0),i[2]=new x(0,l,-r),i[3]=new x(0,a,0),n[0]={vAi:0,vBi:2,vCi:1,color:e.color?e.color:s},n[1]={vAi:3,vBi:1,vCi:2,color:e.color?e.color:s},super(t,new u({vertices:i,faces:n})),this.fl=a,this.fr=h,this.bl=l,this.br=c}update(t){const{scapeSpeed:e,scapeHeight:n,color:i,squares:s}=this.game.level.landscape;if(this.translate(0,0,e),this.position.z>20){const e=s.slice(-8);for(let t=0;t<e.length;t++){const r={width:4,height:n,color:i},o=e[t];r.fl=o.bl,r.fr=o.br,t>0&&(r.bl=s[s.length-1].br);const a=new A(this.game,r);a.translate(4*t,-2.5,o.position.z-4),a.translate(-16,0,0),s.push(a)}s.splice(t,8)}if(this.position.z>0&&this.position.z<4){const t=this.position.z/4,e={x1:this.position.x,y1:this.position.y+this.fl-(this.fl-this.bl)*t,x2:this.position.x+4,y2:this.position.y+this.fr-(this.fr-this.br)*t};this.game.player.mesh.floorIntersect(e,this.game.player.modelMatrix)&&(this.game.player.translate(0,p,0),this.game.player.hit(.1))}}}class P{constructor(t,e,n,i){this.squares=[],this.color=i,this.scapeHeight=e,this.scapeSpeed=n;for(let n=0;n<16;n++)for(let s=0;s<8;s++){const r={width:4,height:e,color:i};if(s>0){const t=this.squares[8*n+(s-1)];r.fl=t.fr,r.bl=t.br}if(n>0){const t=this.squares[8*n+s-8];r.fl=t.bl,r.fr=t.br}const o=new A(t,r);o.translate(4*s,-2.5,4*-n),o.translate(-16,0,-10),this.squares.push(o)}}}class I{constructor(t,e,n){this.currentWave=0,this.game=t,this.enemyWaves=e,this.landscape=n}static generateLevel(t,e){const{waveIndices:n,speed:i,height:s,color:r}=e,o=[];for(let e=0;e<n.length;e++){const i=[],s=n[e];for(let e=0;e<s.length;e++){const n=s[e]>=y[0]?new z(t,s[e]):new _(t,s[e],s.length,e);s.length>=4?n.initialPos=4===e?[0,1.5]:[12*(e%2+1)/3-6,3*Math.floor(e/2)]:n.initialPos=[12*(e+1)/(s.length+1)-6,.5],n.translate(n.initialPos[0],n.initialPos[1],0),i.push(n)}o.push(i)}return new I(t,o,new P(t,s,i,r))}static generateRandomLevel(){const e=[];for(let t=0;t<20;t++)if(t%5==0){const t=Math.floor(Math.random()*y.length);e.push([y[t]])}else{const t=1+Math.floor(5*Math.random()),n=[];for(let e=0;e<t;e++){const t=1+Math.floor(5*Math.random());n.push(t)}e.push(n)}return{waveIndices:e,speed:.25*Math.random()+.1,height:1.6*Math.random()+.4,color:new t(.5*Math.random()+.5,.5*Math.random()+.5,.5*Math.random()+.5)}}update(){0===this.enemyWaves[this.currentWave].length&&(this.currentWave===this.enemyWaves.length-1?this.game.nextLevel():this.currentWave++)}}const S=document.getElementById("overlay"),B=document.getElementById("playerScore");class U{constructor(t){this.canvas=t,this.currentLevel=0,this.score=0,this.gl=t.getContext("webgl"),this.bullets=[],this.paused=!1;const{gl:e}=this;e.clearDepth(1),e.clearColor(0,.2,.2,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.enable(e.DEPTH_TEST);const i=n(408),s=n(944),r=n(625),o=n(9),a=e.createShader(e.VERTEX_SHADER);e.shaderSource(a,i),e.compileShader(a);const h=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(h,s.replace("shadowTexture",b.width.toString())),e.compileShader(h),this.program=e.createProgram();const{program:x}=this;e.attachShader(x,a),e.attachShader(x,h),e.linkProgram(x);const c=e.createShader(e.VERTEX_SHADER);e.shaderSource(c,r),e.compileShader(c);const u=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(u,o),e.compileShader(u),this.s_program=e.createProgram();const{s_program:m}=this;e.attachShader(m,c),e.attachShader(m,u),e.linkProgram(m),e.useProgram(m),this.shadowFramebuffer=e.createFramebuffer();const{shadowFramebuffer:f}=this;e.bindFramebuffer(e.FRAMEBUFFER,f),this.shadowDepthTexture=e.createTexture();const{shadowDepthTexture:p}=this;e.bindTexture(e.TEXTURE_2D,p),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,b.width,b.height,0,e.RGBA,e.UNSIGNED_BYTE,null);const g=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,g),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,b.width,b.height),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,p,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,g),e.bindTexture(e.TEXTURE_2D,null),e.bindRenderbuffer(e.RENDERBUFFER,null);const v=((t,e,n,i,s,r)=>{const o=1/23;return new l([.1,0,0,0,0,2*o,0,0,0,0,-.02,0,-0,-21*o,-1,1])})();v.rotateSelf(90,0,0),v.translateSelf(0,-16,0);const y=e.getUniformLocation(m,"lightMatrix");e.uniformMatrix4fv(y,!1,v.toFloat32Array()),e.bindFramebuffer(e.FRAMEBUFFER,null),e.useProgram(x),this.samplerUniform=e.getUniformLocation(x,"depthColorTexture"),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,p),e.uniform1i(this.samplerUniform,0);const w=e.getUniformLocation(x,"lightMatrix");e.uniformMatrix4fv(w,!1,v.toFloat32Array());const T=e.getUniformLocation(x,"camera"),E=((t,e,n,i)=>{const s=1/Math.tan(10*Math.PI/180);return new l([s/e,0,0,0,0,s,0,0,0,0,101/-99,-1,0,0,200/-99,0])})(0,t.width/t.height);E.lookAt(0,5,25,0,1,0),e.uniformMatrix4fv(T,!1,E.toFloat32Array());const D=e.getUniformLocation(x,"light");e.uniform3f(D,0,4,10);const M=e.getUniformLocation(x,"ambientLight");e.uniform3f(M,.1,.1,.1);const F=new Float32Array([0,.2,.2]),R=new Float32Array(d),L=e.getUniformLocation(x,"u_FogColor"),_=e.getUniformLocation(x,"u_FogDist");e.uniform3fv(L,F),e.uniform2fv(_,R)}update(t){const{player:e,bullets:n,level:i,program:s,s_program:r,shadowFramebuffer:o,gl:a}=this,{enemyWaves:h,currentWave:l,landscape:x}=i;a.useProgram(r),a.bindFramebuffer(a.FRAMEBUFFER,o),a.viewport(0,0,b.width,b.height),a.clearColor(0,0,0,1),a.clearDepth(1),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),e.draw(!0),a.bindFramebuffer(a.FRAMEBUFFER,null),a.useProgram(s),a.viewport(0,0,640,480),a.clearColor(0,.2,.2,1),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),this.lastTime=t,this.time=t,this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),e.respondToInput(),e.update(),e.draw();for(let t=0;t<h[l].length;t++){const e=h[l][t];e.update(),e.draw()}for(let t=0;t<n.length;t++){const e=n[t];e.update(),e.draw()}for(let t=0;t<x.squares.length;t++){const e=x.squares[t];e.update(t),e.draw()}i.update()}nextLevel(){if(this.player.powerUps=[],this.player.health=T,this.currentLevel++,this.currentLevel===E.length){const t=I.generateRandomLevel();E.push(t)}this.level=I.generateLevel(this,E[this.currentLevel])}togglePause(t=""){this.paused=!this.paused,this.paused?(S.innerHTML=t,S.style.opacity="50%",this.sounds[0].pause()):(S.style.opacity="0%",this.sounds[0].play(),requestAnimationFrame(rt))}restart(){this.level=I.generateLevel(this,E[this.currentLevel]),this.currentLevel=-1,this.bullets=[],this.score=0,B.innerHTML=`Score: ${this.score}`,this.nextLevel(),this.togglePause()}}const O=function(){var t,e,n,i,s,r=function(t){return Math.sin(6.283184*t)},o=function(t){return.003959503758*2**((t-128)/12)},a=function(t,e,n){var i,s,r,a,l,x,c=h[t.i[0]],u=t.i[1],m=t.i[3]/32,f=h[t.i[4]],p=t.i[5],d=t.i[8]/32,g=t.i[9],v=t.i[10]*t.i[10]*4,y=t.i[11]*t.i[11]*4,w=t.i[12]*t.i[12]*4,b=1/w,T=-t.i[13]/16,E=t.i[14],D=n*2**(2-t.i[15]),M=new Int32Array(v+y+w),F=0,R=0;for(i=0,s=0;i<v+y+w;i++,s++)s>=0&&(s-=D,l=o(e+(15&(E=E>>8|(255&E)<<4))+t.i[2]-128),x=o(e+(15&E)+t.i[6]-128)*(1+8e-4*t.i[7])),r=1,i<v?r=i/v:i>=v+y&&(r=(1-(r=(i-v-y)*b))*3**(T*r)),a=c(F+=l*r**m)*u,a+=f(R+=x*r**d)*p,g&&(a+=(2*Math.random()-1)*g),M[i]=80*a*r|0;return M},h=[r,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var e=t%1*4;return e<2?e-1:3-e}];this.init=function(r){t=r,e=r.endPattern,n=0,i=r.rowLen*r.patternLen*(e+1)*2,s=new Int32Array(i)},this.generate=function(){var o,l,x,c,u,m,f,p,d,g,v,y,w,b,T=new Int32Array(i),E=t.songData[n],D=t.rowLen,M=t.patternLen,F=0,R=0,L=!1,_=[];for(x=0;x<=e;++x)for(f=E.p[x],c=0;c<M;++c){var z=f?E.c[f-1].f[c]:0;z&&(E.i[z-1]=E.c[f-1].f[c+M]||0,z<17&&(_=[]));var A=h[E.i[16]],P=E.i[17]/512,I=2**(E.i[18]-9)/D,S=E.i[19],B=E.i[20],U=43.23529*E.i[21]*3.141592/44100,O=1-E.i[22]/255,C=1e-5*E.i[23],H=E.i[24]/32,k=E.i[25]/512,N=6.283184*2**(E.i[26]-9)/D,X=E.i[27]/255,W=E.i[28]*D&-2;for(v=(x*M+c)*D,u=0;u<4;++u)if(m=f?E.c[f-1].n[c+u*M]:0){_[m]||(_[m]=a(E,m,D));var q=_[m];for(l=0,o=2*v;l<q.length;l++,o+=2)T[o]+=q[l]}for(l=0;l<D;l++)(g=T[p=2*(v+l)])||L?(y=U,S&&(y*=A(I*p)*P+.5),R+=(y=1.5*Math.sin(y))*(w=O*(g-R)-(F+=y*R)),g=3==B?R:1==B?w:F,C&&(g=(g*=C)<1?g>-1?r(.25*g):-1:1,g/=C),L=(g*=H)*g>1e-5,b=g*(1-(d=Math.sin(N*p)*k+.5)),g*=d):b=0,p>=W&&(b+=T[p-W+1]*X,g+=T[p-W]*X),T[p]=0|b,T[p+1]=0|g,s[p]+=0|b,s[p+1]+=0|g}return++n/t.numChannels},this.createAudioBuffer=function(t){for(var e=t.createBuffer(2,i/2,44100),n=0;n<2;n++)for(var r=e.getChannelData(n),o=n;o<i;o+=2)r[o>>1]=s[o]/65536;return e},this.createWave=function(){var t=44+2*i-8,e=t-36,n=new Uint8Array(44+2*i);n.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(var r=0,o=44;r<i;++r){var a=s[r];a=a<-32767?-32767:a>32767?32767:a,n[o++]=255&a,n[o++]=a>>8&255}return n},this.getData=function(t,e){for(var n=2*Math.floor(44100*t),i=new Array(e),r=0;r<2*e;r+=1){var o=n+r;i[r]=t>0&&o<s.length?s[o]/32768:0}return i}};const C=(t,e=!1,n)=>{return i=void 0,s=void 0,o=function*(){return new Promise((i=>{const s=new O;s.init(t);let r,o=!1;const a=setInterval((function(){const t=s.generate();if(o=t>=1,n&&(n.innerHTML=`<p>Loading Audio...${(100*t).toFixed(2)}%</p>`),o){const t=s.createWave();r=document.createElement("audio"),r.src=URL.createObjectURL(new Blob([t],{type:"audio/wav"})),r.loop=e,i(r),clearInterval(a)}}),0)}))},new((r=void 0)||(r=Promise))((function(t,e){function n(t){try{h(o.next(t))}catch(t){e(t)}}function a(t){try{h(o.throw(t))}catch(t){e(t)}}function h(e){var i;e.done?t(e.value):(i=e.value,i instanceof r?i:new r((function(t){t(i)}))).then(n,a)}h((o=o.apply(i,s||[])).next())}));var i,s,r,o},H=t=>{const e=[];for(let n=0;n<t.length&&n!==t.length-1;n+=2){const i=t[n].split("x");for(let s=0;s<t[n+1];s++)"n"===i[0]?e.length++:e.push(+i[0]),"n"===i[1]?e.length++:e.push(+i[1])}return t.length%2==1&&e.push(t[t.length-1]),e},k=({songData:t,rowLen:e,patternLen:n,endPattern:i,numChannels:s},r)=>{const o=[];for(let e=0;e<t.length;e++){const{i:n,p:i,c:s}=t[e];let a=[];for(let t=0;t<s.length;t++){const{n:e,f:n}=s[t];a[t]={n:r(e),f:r(n)}}o[e]={i:r(n),p:r(i),c:a}}return{songData:o,rowLen:e,patternLen:n,endPattern:i,numChannels:s}};class N extends u{constructor(t,e){const n=[];n[0]=new x(-t,-t,-t),n[1]=new x(-t,-t,t),n[2]=new x(-t,t,-t),n[3]=new x(-t,t,t),n[4]=new x(t,-t,-t),n[5]=new x(t,t,-t),n[6]=new x(t,-t,t),n[7]=new x(t,t,t);const i=[];i[0]=new c(0,1,2,e),i[1]=new c(3,2,1,e),i[2]=new c(5,7,4,e),i[3]=new c(6,4,7,e),i[4]=new c(2,3,5,e),i[5]=new c(7,5,3,e),i[6]=new c(4,6,0,e),i[7]=new c(1,0,6,e),i[8]=new c(3,1,7,e),i[9]=new c(6,7,1,e),i[10]=new c(5,4,2,e),i[11]=new c(0,2,4,e),super({vertices:n,faces:i})}}const X={songData:[{i:["2x138",1,"116x0",1,"2x138",1,"128x4",1,"0x0",1,"47x48",1,"162x63",1,"124x3",1,"0x139",1,"4x1",1,"3x64",1,"160x3",1,"32x147",1,"4x121",1,5],p:["nxn",1,"1x2",9,"nxn",2,"1x2",4],c:[{n:["144xn",1,"nxn",3,"132xn",1,"nxn",3,"147xn",1,"nxn",3,135],f:[]},{n:["152xn",1,"nxn",3,"140xn",1,"nxn",3,"150xn",1,"nxn",3,138],f:[]}]},{i:["2x96",1,"128x0",1,"2x99",1,"140x18",1,"0x0",1,"158x119",1,"158x0",1,"0x0",3,"2x15",1,"0x0",1,"32x0",1,"0x24",1,8],p:["1x2",1,"nxn",11,"1x2",5,1],c:[{n:["144x147",1,151],f:["2xn",1,"nxn",15,96]},{n:["147x152",1,156],f:[]}]},{i:["0x255",1,"116x79",1,"0x255",1,"116x0",1,"83x0",1,"4x6",1,"69x52",1,"0x0",3,"2x14",1,"0x0",1,"32x0",1,"0x0",1,0],p:["nxn",2,"1x1",16],c:[{n:["144xn",1,"nxn",2,"144xn",2,"nxn",3,"144xn",1,"nxn",2,"144xn",1,144],f:[]}]},{i:["0x160",1,"128x64",1,"0x160",1,"128x0",1,"64x210",1,"4x7",1,"52x85",1,"0x0",1,"0x60",1,"4x1",1,"2x255",1,"0x0",1,"32x61",1,"5x32",1,1],p:["nxn",2,"nx2",1,"1x1",6,"nxn",3,"1x1",4],c:[{n:["nxn",1,"144x144",1,"nxn",3,"144xn",1,"144x144",1,"nxn",2,"144x144",1,"nxn",3,"144xn",1,"144x144",1,"nxn",6,"152xn",1,"152x152",1,"nxn",6,"152xn",1,"152x152",1],f:[]},{n:["nxn",2,"144xn",1,"nxn",3,"152xn",1,"nxn",3,"144xn",1,"nxn",3,152],f:[]}]},{i:["0x0",1,"140x0",1,"0x0",1,"140x0",1,"0x81",1,"4x10",1,"47x55",1,"0x0",1,"0x187",1,"5x0",1,"1x239",1,"135x0",1,"32x108",1,"5x16",1,4],p:["nxn",3,"1x1",6,"nxn",3,"1x1",4],c:[{n:["nx147",1,"147x158",1,"nx147",1,"147x158",1,"nxn",1,"147x147",1,"158xn",1,"147x147",1,"158x147",1,"147x158",1,"nx147",1,"147x158",1,"nxn",1,"147x147",1,"158xn",1,"147x147",1],f:[]}]},{i:["0x0",1,"128x0",1,"0x0",1,"128x0",1,"0x125",1,"0x1",1,"59x0",1,"0x0",3,"1x193",1,"171x0",1,"29x39",1,"3x88",1,3],p:["nxn",3,"nx1",1,"1x1",12],c:[{n:["nxn",2,"123xn",1,"nxn",3,"123xn",1,"nxn",3,"123xn",1,"nxn",3,123],f:[]}]},{i:["3x100",1,"128x0",1,"3x201",1,"128x2",1,"0x0",1,"0x6",1,"49x0",1,"0x0",1,"0x139",1,"4x1",1,"3x30",1,"184x119",1,"244x147",1,"6x84",1,6],p:["nxn",4,"1x2",12],c:[{n:["nxn",1,"nx108",1,"108xn",1,"nxn",1,"nx108",2,"115x114",1,"113x111",1,"nxn",1,"nx108",1,"108xn",1,"nxn",1,"nx108",2,"115x114",1,"113x111",1,"nxn",1,"nx108",1,"108xn",1,"nxn",1,"nx108",1,"nxn",1,"115xn",1,"nxn",2,"nx108",1,"108xn",1,"nxn",1,"nx108",1,"nxn",1,"115xn",1,"nxn",2,"nx108",1,"108xn",1,"nxn",1,"nx108",1,"nxn",1,"nx114",1,"nxn",2,"nx108",1,"108xn",1,"nxn",1,"nx108",1,"nxn",1,"nx114",1,"nxn",2,"nx108",1,"108xn",1,"nxn",1,"nx108",1,"nxn",2,"113xn",1,"nxn",1,"nx108",1,"108xn",1,"nxn",1,"nx108",1,"nxn",2,113],f:[]},{n:["nxn",1,"nx108",1,"108xn",1,"nxn",1,"nx108",2,"113x114",1,"115x111",1,"nxn",1,"nx108",1,"108xn",1,"nxn",1,"nx108",2,"113x114",1,"115x111",1,"nxn",1,"nx108",1,"108xn",1,"nxn",1,"nx108",1,"nxn",1,"113xn",1,"nxn",2,"nx108",1,"108xn",1,"nxn",1,"nx108",1,"nxn",1,"113xn",1,"nxn",2,"nx108",1,"108xn",1,"nxn",1,"nx108",1,"nxn",1,"nx114",1,"nxn",2,"nx108",1,"108xn",1,"nxn",1,"nx108",1,"nxn",1,"nx114",1,"nxn",2,"nx108",1,"108xn",1,"nxn",1,"nx108",1,"nxn",2,"115xn",1,"nxn",1,"nx108",1,"108xn",1,"nxn",1,"nx108",1,"nxn",2,115],f:[]}]},{i:["2x100",1,"128x0",1,"3x0",1,"128x0",1,"0x0",1,"0x24",1,"21x0",1,"0x0",3,"2x71",1,"0x0",1,"35x147",1,"6x0",1,0],p:["nxn",5,"nx1",2,"2x3",4,"nx1",1,"2x3",4],c:[{n:["nxn",14,"152x152",1,"143x143",1],f:["13xn",1,"nxn",15,21]},{n:["156xn",1,"nx151",1,"nxn",1,"154xn",1,"nx149",1,"nxn",1,151],f:["13xn",1,"nxn",15,87]},{n:["154xn",1,"nx149",1,"nxn",1,"151xn",1,"nx147",1,"nxn",1,149],f:["13xn",1,"nxn",15,87]}]},{i:["0x160",1,"128x64",1,"0x160",1,"128x0",1,"64x210",1,"4x7",1,"52x85",1,"0x0",1,"0x60",1,"4x1",1,"2x255",1,"0x0",1,"32x61",1,"5x32",1,1],p:["nxn",3,1],c:[{n:["nxn",2,"144xn",1,"nxn",3,"152xn",1,"nxn",3,"144xn",1,"nxn",3,152],f:[]}]}],rowLen:5513,patternLen:32,endPattern:35,numChannels:9},W={songData:[{i:[1,255,128,0,1,154,128,9,0,0,7,5,8,0,0,0,0,0,0,0,2,255,0,0,32,0,3,89,1],p:[1],c:[{n:[168],f:[]}]}],rowLen:5513,patternLen:1,endPattern:0,numChannels:1},q={songData:[{i:[0,128,106,64,0,128,106,0,64,0,5,7,36,0,0,0,0,0,0,0,2,255,0,2,32,0,5,25,1],p:[1],c:[{n:[173],f:[]}]}],rowLen:5513,patternLen:1,endPattern:0,numChannels:1},G={songData:[{i:[1,131,106,64,0,121,106,0,64,200,31,8,65,0,0,0,0,0,0,0,2,52,0,2,32,0,2,25,1],p:[1],c:[{n:[149],f:[]}]}],rowLen:5513,patternLen:1,endPattern:0,numChannels:1},V={v:[1.5,0,0,.75,.55,-2,1,0,-1,0,.9,-1.5,-1,0,-1,-.75,.55,-2,-1.5,0,0,0,0,-4,0,0,0,1.15,.55,-2.5,-1.15,.55,-2.5,-.5,.53,-1.25,.5,.53,-1.25,0,.53,-.75],f:[0,1,2,0,2,1,12,0,4,5,6,0,4,2,8,0,0,9,1,0,9,7,1,0,10,6,5,0,2,9,0,0,10,4,6,0,10,7,4,0,7,10,5,0,9,2,7,0,4,7,2,0,3,5,11,0,13,3,11,0,5,4,11,0,1,3,12,0,3,13,12,0,13,8,12,1,8,13,11,1,7,5,3,2,3,1,7,2,4,8,11,2,8,2,12,2],c:[.239547,.239547,.239547,.8,0,0,.117108,.14647,.8]},Y={v:[0,-.38,-.92,0,-.71,-.71,0,-.66,-.38,0,-.46,.2,0,-.42,.37,0,-.32,.52,0,-.38,.92,.16,-.16,-.92,.23,-.23,-.62,.22,-.22,-.47,.71,-.71,0,.65,-.65,.38,.5,-.5,.71,.27,-.27,.92,.38,0,-.92,.71,0,-.71,.66,0,-.38,.46,0,.2,.42,0,.37,.32,0,.52,.38,0,.92,.16,.16,-.92,.23,.23,-.62,.22,.22,-.47,.71,.71,0,.65,.65,.38,.5,.5,.71,.27,.27,.92,0,.38,-.92,0,.71,-.71,0,.66,-.38,0,.46,.2,0,.42,.37,0,.32,.52,0,.38,.92,0,0,-.49,-.16,.16,-.92,-.23,.23,-.62,-.22,.22,-.47,-.71,.71,0,-.65,.65,.38,-.5,.5,.71,-.27,.27,.92,-.38,0,-.92,-.71,0,-.71,-.66,0,-.38,-.46,0,.2,-.42,0,.37,-.32,0,.52,-.38,0,.92,0,0,.69,-.16,-.16,-.92,-.23,-.23,-.62,-.22,-.22,-.47,-.71,-.71,0,-.65,-.65,.38,-.5,-.5,.71,-.27,-.27,.92],f:[5,13,6,0,3,11,4,0,2,8,9,0,0,35,7,0,4,12,5,0,3,9,10,0,0,8,1,0,12,18,19,0,13,19,20,0,11,17,18,0,17,23,24,0,14,22,15,0,19,27,20,0,17,25,18,0,16,22,23,0,14,35,21,0,18,26,19,0,27,33,34,0,25,31,32,0,26,32,33,0,30,37,38,0,28,35,36,0,32,41,33,0,31,38,39,0,28,37,29,0,33,42,34,0,31,40,32,0,41,47,48,0,42,48,49,0,40,46,47,0,43,52,44,0,48,57,49,0,46,55,47,0,45,52,53,0,43,35,51,0,47,56,48,0,46,53,54,0,57,5,6,0,55,3,4,0,56,4,5,0,54,2,3,0,5,12,13,0,3,10,11,0,4,11,12,0,40,39,46,0,43,51,52,0,46,54,55,0,45,44,52,0,46,45,53,0,57,56,5,0,55,54,3,0,56,55,4,0,2,1,8,0,3,2,9,0,0,7,8,0,12,11,18,0,13,12,19,0,11,10,17,0,17,16,23,0,19,26,27,0,17,24,25,0,18,25,26,0,26,25,32,0,32,40,41,0,33,41,42,0,41,40,47,0,42,41,48,0,48,56,57,0,14,21,22,0,16,15,22,0,25,24,31,0,31,39,40,0,27,26,33,0,30,29,37,0,31,30,38,0,28,36,37,0,47,55,56,0,50,6,13,1,50,13,20,1,50,20,27,1,50,27,34,1,50,34,42,1,50,42,49,1,50,49,57,1,50,57,6,1,10,16,17,2,8,14,15,2,8,16,9,2,7,35,14,2,22,30,23,2,21,35,28,2,24,30,31,2,22,28,29,2,39,45,46,2,37,43,44,2,37,45,38,2,36,35,43,2,52,2,53,2,51,35,0,2,52,0,1,2,52,1,2,2,54,53,2,2,52,51,0,2,10,9,16,2,8,7,14,2,8,15,16,2,22,29,30,2,24,23,30,2,22,21,28,2,39,38,45,2,37,36,43,2,37,44,45,2],c:[.068765,.084782,.384374,.8,.080465,.080465,.026099,.246195,.014388]},j={v:[-.32,-.32,.88,-.32,.32,.88,-.88,-.88,-.88,-.88,.88,-.88,.32,-.32,.88,.32,.32,.88,.88,-.88,-.88,.88,.88,-.88,-.94,-.4,.04,-.88,0,.88,-.39,.94,.16,-.88,0,-.88,0,-.88,-.88,0,.88,-.88,.88,0,-.88,.39,-.94,-.16,.94,.4,-.04,.88,0,.88,0,-.88,.88,0,.88,.88,.28,.67,.06,-.28,-.67,-.06,0,0,.48,.67,-.27,-.1,0,0,-.88,-.67,.27,.1,-.5,-.5,.25,-.5,.25,.5,-.5,.5,-.25,-.5,-.25,-.5,-.25,-.5,-.5,.25,.5,-.5,.5,-.25,-.5,.5,-.5,-.25,.5,.5,.25,.5,-.25,.5,.25,-.5,.5,-.25,.5,.5,-.5,-.5,-.25,-.5,-.25,.5,-.5,.5,.25,-.5,.25,-.5,.25,-.5,-.5,-.25,.5,-.5,.5,.25,-.5,.5,-.5,.25,.5,.5,-.25,.5,.25,.5,-.25,-.5,.5,.25,.5,.5,0,.5,.25,0,.5,-.25,.35,.3,.01,-.03,.46,.06,0,-.5,.25,0,-.5,-.25,-.35,-.3,-.01,.03,-.46,-.06,-.25,0,.5,.25,0,.5,0,-.25,.5,0,.25,.5,.5,0,.25,.5,0,-.25,.3,-.35,-.07,.46,.04,-.04,.25,0,-.5,-.25,0,-.5,0,-.25,-.5,0,.25,-.5,-.5,0,-.25,-.5,0,.25,-.46,-.04,.04,-.3,.35,.07,-.5,.25,.25,-.5,-.25,.25,-.5,-.25,-.25,-.25,.25,-.5,-.25,-.25,-.5,.25,-.25,-.5,.5,.25,-.25,.5,-.25,-.25,.5,-.25,.25,.25,.25,.5,.25,-.25,.5,-.25,-.25,.5,.25,-.5,-.25,-.25,-.5,-.25,-.25,-.5,.25,-.25,.5,-.25,.25,.5,-.25,.25,.5,.25,-.25,.5,.25,.25,-.5,.25,-.25,.25,.5,.5,.25,.25,.25,.25,-.5,-.5,.25,-.25,.13,0,.69,0,.13,.69,-.13,0,.69,0,-.13,.69,.13,.25,.5,.25,.13,.5,.13,-.25,.5,.25,-.13,.5,-.13,-.25,.5,-.25,-.13,.5,-.13,.25,.5,-.25,.13,.5,-.04,.21,.6,-.2,-.04,.61,.2,.04,.58,.04,-.21,.59],f:[28,41,97,0,96,31,7,0,95,34,5,0,45,36,93,0,40,37,92,0,91,50,19,0,90,51,20,0,89,28,10,0,54,48,88,0,87,21,56,0,86,33,15,0,58,9,39,0,49,61,102,0,82,62,17,0,81,63,23,0,80,46,16,0,79,66,14,0,78,67,24,0,77,43,13,0,70,29,76,0,71,72,75,0,74,40,10,0,74,25,71,0,27,71,9,0,27,40,74,0,39,26,0,0,39,71,75,0,38,29,2,0,8,72,76,0,72,70,76,0,67,77,69,0,11,41,77,0,41,43,77,0,30,78,68,0,29,30,2,0,29,67,78,0,42,79,32,0,12,68,79,0,68,24,66,0,63,80,65,0,14,44,80,0,44,7,46,0,33,81,64,0,6,32,81,0,32,14,63,0,45,35,4,0,15,64,82,0,64,23,62,0,47,103,59,0,60,36,104,0,106,85,48,0,111,58,107,0,55,86,57,0,42,55,12,0,42,33,86,0,38,56,8,0,30,38,2,0,30,55,87,0,26,48,0,0,8,56,88,0,21,88,56,0,51,89,53,0,13,43,89,0,43,28,89,0,46,90,52,0,7,31,90,0,31,13,51,0,34,91,49,0,16,52,91,0,52,20,50,0,50,92,37,0,20,53,92,0,54,93,36,0,57,54,21,0,108,109,110,0,37,94,108,0,62,47,17,0,23,65,95,0,66,96,44,0,24,69,96,0,69,13,31,0,70,41,11,0,25,97,70,0,73,28,97,0,61,110,99,0,106,107,85,0,59,103,112,0,103,102,112,0,113,60,104,0,105,104,84,0,28,3,41,0,45,4,36,0,40,1,37,0,54,18,48,0,87,55,21,0,39,85,107,0,107,58,39,0,102,83,49,0,49,19,61,0,70,11,29,0,71,25,72,0,74,73,25,0,27,74,71,0,27,1,40,0,39,75,26,0,39,9,71,0,38,76,29,0,72,25,70,0,41,3,43,0,29,78,30,0,29,11,67,0,45,82,35,0,59,17,47,0,47,83,103,0,18,36,60,0,36,84,104,0,48,18,60,0,60,106,48,0,111,100,58,0,42,86,55,0,42,6,33,0,38,87,56,0,30,87,38,0,30,12,55,0,26,88,48,0,21,54,88,0,43,3,28,0,57,93,54,0,108,94,109,0,108,61,37,0,61,19,37,0,62,95,47,0,70,97,41,0,25,73,97,0,73,10,28,0,61,108,110,0,106,111,107,0,103,83,102,0,113,101,60,0,105,113,104,0,94,1,27,1,75,8,26,1,102,99,112,1,5,83,47,1,4,84,36,1,105,35,59,1,85,0,48,1,10,92,53,1,15,93,57,1,109,94,27,1,65,16,34,1,100,109,58,1,101,106,60,1,105,98,113,1,94,37,1,1,75,72,8,1,102,61,99,1,5,49,83,1,4,35,84,1,84,35,105,1,35,17,59,1,85,39,0,1,10,40,92,1,15,45,93,1,9,58,27,1,58,109,27,1,100,110,109,1,101,111,106,1,105,59,98,1,113,22,101,2,22,110,100,2,101,100,111,2,98,99,22,2,113,98,22,2,22,99,110,2,101,22,100,2,98,112,99,2],c:[.8,.115414,.642319,.8,.8,.8,.8,.011299,.017944]},$={v:[0,-.74,0,-.53,-.45,.72,-.85,-.45,-.28,0,-.45,-.89,.85,-.45,-.28,.53,-.45,.72,-.69,.45,.28,-.96,.45,-.72,.96,.45,-.72,.69,.45,.28,0,.45,.89,0,1,0,-.26,0,.81,.26,0,.81,-1.05,-.19,.6,1.05,-.19,.6,-.43,.45,.59,.43,.45,.59,-.65,.92,.04,0,.72,.45,.65,.92,.04],f:[0,2,3,0,0,3,4,0,2,14,6,0,3,2,7,0,4,3,8,0,4,15,5,0,1,12,14,0,2,6,7,0,4,8,9,0,5,15,13,0,7,18,11,0,8,20,9,0,10,17,19,0,16,10,19,0,13,17,10,0,13,15,17,0,14,12,16,0,12,10,16,0,2,1,14,0,4,9,15,0,7,6,18,0,8,11,20,0,12,13,10,1,0,1,2,2,1,0,5,2,0,4,5,2,3,7,8,2,8,7,11,2,19,20,11,2,19,17,20,2,18,19,11,2,18,16,19,2,5,12,1,2,5,13,12,2,6,16,18,3,17,9,20,3,15,9,17,3,14,16,6,3],c:[.0524,.8,.8,.8,.146314,.114355,.288296,.288296,.288296,.77915,.8,.172336]},J={v:[1,0,-1,.5,-.87,-1,-.5,-.87,-1,-1,0,-1,-.5,.87,-1,.5,.87,-1,0,0,1,.63,-.36,-1,.31,-.16,0,.02,-.35,0,0,-.72,-1,-.29,-.19,0,-.63,-.36,-1,-.31,.16,0,-.63,.36,-1,-.02,.35,0,0,.72,-1,.29,.19,0,.63,.36,-1,.5,0,-1,-.25,-.43,-1,0,0,-1,.56,-.61,-1,.26,-.61,-.5,-.56,.61,-1,-.26,.61,-.5,-.32,.36,.55,.32,-.36,.55],f:[0,8,7,0,2,11,12,0,3,13,14,0,4,16,21,0,5,17,18,0,5,18,19,0,1,10,20,0,3,14,20,0,20,21,1,0,20,14,21,0,24,21,14,0,20,12,3,0,20,10,12,0,10,2,12,0,19,22,1,0,19,18,7,0,18,0,7,0,17,6,8,0,21,19,1,0,21,16,19,0,16,5,19,0,14,15,26,0,13,6,15,0,9,6,11,0,7,9,27,0,22,23,1,0,22,27,23,0,24,25,4,0,24,26,25,0,24,4,21,0,19,7,22,0,14,13,15,0,7,8,9,0,23,10,1,1,25,16,4,1,18,17,8,1,16,15,17,1,14,26,24,1,12,11,13,1,10,9,11,1,7,27,22,1,27,9,23,1,26,15,25,1,23,9,10,1,25,15,16,1,18,8,0,2,16,17,5,2,15,6,17,2,12,13,3,2,11,6,13,2,10,11,2,2,8,6,9,2],c:[.052218,.101185,.8,.8,.8,.8,.804723,.854388,0]},K={v:[.84,.59,0,.71,-.3,.71,1,.13,0,0,1,1,-.35,.35,.85,0,0,1.31,-.71,.84,.71,-1,.13,0,-.71,-.3,.71,-.71,.27,.71,-.84,.59,0,-.71,.13,-.71,-.71,.84,-.71,0,.13,-1,0,1,-1,.71,.13,-.71,.71,.84,-.71,.71,.84,.71,.71,.27,.71,.35,.59,.85,.35,-.08,.85,-.35,.68,.85,.35,-.65,.85,0,-.53,1,-.35,-.65,.85,-.92,-.2,-1,-1.32,.2,-1,-.92,.2,-1,-1.32,-.2,-1,-1.17,.05,1,-1.06,-.05,1,-1.06,.05,1,-1.17,-.05,1,1.33,-.2,-1,.93,.2,-1,1.33,.2,-1,.93,-.2,-1,1.08,.05,1,1.18,-.05,1,1.18,.05,1,1.08,-.05,1],f:[0,1,2,0,3,4,5,0,7,9,6,0,10,11,7,0,12,13,11,0,14,15,13,0,16,2,15,0,8,11,15,0,0,18,1,0,17,19,20,0,6,10,7,0,10,12,11,0,12,14,13,0,0,16,14,0,14,12,10,0,10,6,14,0,21,14,6,0,14,16,15,0,16,0,2,0,22,23,24,0,11,13,15,0,15,1,8,0,22,8,1,0,21,6,9,0,20,5,23,0,20,19,5,0,5,4,24,0,4,8,24,0,18,22,1,0,21,3,14,0,7,8,9,0,0,17,18,0,22,24,8,0,14,3,19,0,19,17,14,0,14,17,0,0,17,20,18,1,3,21,4,1,4,9,8,1,4,21,9,1,18,20,22,1,20,23,22,1,25,26,27,1,28,29,26,1,30,27,31,1,29,27,26,1,28,30,32,1,25,28,26,1,28,32,29,1,30,25,27,1,29,31,27,1,28,25,30,1,33,34,35,1,36,37,34,1,38,35,39,1,37,35,34,1,36,38,40,1,33,36,34,1,36,40,37,1,38,33,35,1,37,39,35,1,36,33,38,1,15,2,1,2,8,7,11,2,19,3,5,2,5,24,23,2,32,31,29,2,32,30,31,2,40,39,37,2,40,38,39,2],c:[.375749,.375749,.375749,.8,.624625,.010642,.8,0,.009041]};var Q=function(t,e,n,i){return new(n||(n=Promise))((function(s,r){function o(t){try{h(i.next(t))}catch(t){r(t)}}function a(t){try{h(i.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}h((i=i.apply(t,e||[])).next())}))};const Z=document.getElementById("canvas"),tt=document.getElementById("playerHealth"),et=document.getElementById("instructions"),nt=document.getElementById("overlay");let it,st;const rt=t=>{it.update(t),tt.style.width=(100*it.player.health/T).toString()+"%",it.paused||requestAnimationFrame(rt)};window.onload=()=>{Z.width=640,Z.height=480,document.onkeyup=t=>Q(void 0,void 0,void 0,(function*(){t.preventDefault(),"p"===t.key.toLowerCase()&&(document.onkeyup=null,yield ot(),nt.style.opacity="0%",Q(void 0,void 0,void 0,(function*(){it=new U(Z),it.sounds=st,it.sounds[0].play(),it.meshes=[u.fromSerialized(V),u.fromSerialized(Y),u.fromSerialized(j),u.fromSerialized($),u.fromSerialized(J),u.fromSerialized(K)],it.meshes.push(new N(.5,o)),it.meshes.push(new N(.5,a)),it.meshes.push(new N(.5,s)),it.level=I.generateLevel(it,E[0]),it.player=new R(it,0),document.onkeydown=t=>f(t,!0,it),document.onkeyup=t=>f(t,!1,it),requestAnimationFrame(rt)})))}))};const ot=()=>Q(void 0,void 0,void 0,(function*(){et.innerHTML="<p>Loading Audio...0%</p>",st=[yield C(k(X,H),!0,et),yield C(q),yield C(W),yield C(G)]}))})()})();