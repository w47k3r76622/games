try{window.AudioContext=window.AudioContext||window.webkitAudioContext,window.audioContext=new window.AudioContext,isWebAudioAPIEnabled=!0}catch(t){isWebAudioAPIEnabled=!1}var WebAudioAPISoundManager=function(t){this.context=t,this.bufferList={},this.playingSounds={}};WebAudioAPISoundManager.prototype={addSound:function(t){if(isWebAudioAPIEnabled){var e=new XMLHttpRequest;e.open("GET",t,!0),e.responseType="arraybuffer";var i=this;e.onload=function(){i.context.decodeAudioData(e.response,function(e){e&&(i.bufferList[t]=e,$.assetLoaded())},function(t){})},e.onerror=function(){alert("BufferLoader: XHR error")},e.send()}else{var s=new Audio;!0===s.canPlayType("audio/ogg")?audioType="ogg":audioType="mp3",s.setAttribute("type","audio/"+audioType),s.setAttribute("src",t.replace(".mp3","."+audioType)),s.addEventListener("canplaythrough",function(){Config.assetLoaded()},!1),this.bufferList[t.split("/").pop()]=s}},stopSoundWithUrl:function(t){if(this.playingSounds.hasOwnProperty(t))for(var e in this.playingSounds[t])this.playingSounds[t].hasOwnProperty(e)&&this.playingSounds[t][e].noteOff(0)}};var Sound=function(t,e){this.settings={loop:!1};for(var i in e)e.hasOwnProperty(i)&&(this.settings[i]=e[i]);this.url=t+".wav",window.webAudioAPISoundManager=window.webAudioAPISoundManager||new WebAudioAPISoundManager(window.audioContext),this.manager=window.webAudioAPISoundManager,this.manager.addSound(this.url)};Sound.prototype={play:function(){if(isWebAudioAPIEnabled){var t=this.manager.bufferList[this.url];if(void 0!==t){var e=this.makeSource(t);e.loop=this.settings.loop,e.start(0),this.manager.playingSounds.hasOwnProperty(this.url)||(this.manager.playingSounds[this.url]=[]),this.manager.playingSounds[this.url].push(e)}}else this.manager.bufferList[this.url.split("/").pop()].play()},stop:function(){isWebAudioAPIEnabled?this.manager.stopSoundWithUrl(this.url):this.manager.bufferList[this.url.split("/").pop()].stop()},getVolume:function(){return this.translateVolume(this.volume,!0)},setVolume:function(t){this.volume=this.translateVolume(t)},translateVolume:function(t,e){return e?100*t:t/100},makeSource:function(t){var e=this.manager.context.createBufferSource(),i=this.manager.context.createGain();return i.gain.value=1,e.buffer=t,e.connect(i),i.connect(this.manager.context.destination),e}},SimpleImage=function(t){t=t||{},this.x=t.x||0,this.y=t.y||0,this.image=$.imageAssets[t.image]||new Image,this.width=this.image.width,this.height=this.image.height,this.anchor={x:$.anchor.LEFT,y:$.anchor.TOP},this.draw=function(){$.offContext.drawImage(this.image,this.x-this.image.width*this.anchor.x,this.y-this.image.height*this.anchor.y)},this.update=function(){}},Sprite=function(t){t=t||{},this.x=t.x||0,this.y=t.y||0,this.spriteSheet=$.imageAssets[t.spriteSheet]||new Image,this.frameW=t.frameWidth,this.frameH=t.frameHeight,this.frame=0,this.moving=!1,this.anchor={x:$.anchor.LEFT,y:$.anchor.TOP},this.frameQX=this.spriteSheet.width/this.frameW,this.frameQY=this.spriteSheet.height/this.frameH,this.draw=function(){this.offsetX=Math.floor(this.frame%this.frameQX)*this.frameW,this.offsetY=Math.floor(this.frame/this.frameQX)*this.frameH,$.offContext.drawImage(this.spriteSheet,this.offsetX,this.offsetY,this.frameW,this.frameH,this.x-this.frameW*this.anchor.x,this.y-this.frameH*this.anchor.y,this.frameW,this.frameH)},this.update=function(){},this.kill=function(){$.currentSceneObjects.splice($.currentSceneObjects.indexOf(this),1)}},Button=function(t){t=t||{},this.x=t.x||0,this.y=t.y||0,this.image=$.imageAssets[t.image]||new Image,this.width=this.image.width,this.height=this.image.height,this.anchor={x:$.anchor.LEFT,y:$.anchor.TOP},this.draw=function(){$.offContext.drawImage(this.image,this.x-this.image.width*this.anchor.x,this.y-this.image.height*this.anchor.y)},this.update=function(){},this.on=function(t,e,i){$.currentSceneEvents.push([this,t,e,i])},this.isInside=function(t){var e=t.pageX-$.canvas.offsetLeft,i=t.pageY-$.canvas.offsetTop,s=(this.x-this.image.width*this.anchor.x)*$.canvasRatio,n=(this.y-this.image.height*this.anchor.y)*$.canvasRatio;return e>=s&&e<=s+this.width*$.canvasRatio&&i<=n+this.height*$.canvasRatio&&i>=n}},Text=function(t){t=t||{},this.text=t.text||"",this.x=t.x||0,this.y=t.y||0,this.size=t.size||1,this.color=t.color||"#000000",this.letters={A:[[,1],[1,,1],[1,,1],[1,1,1],[1,,1]],B:[[1,1],[1,,1],[1,1,1],[1,,1],[1,1]],C:[[1,1,1],[1],[1],[1],[1,1,1]],D:[[1,1],[1,,1],[1,,1],[1,,1],[1,1]],E:[[1,1,1],[1],[1,1,1],[1],[1,1,1]],F:[[1,1,1],[1],[1,1],[1],[1]],G:[[,1,1],[1],[1,,1,1],[1,,,1],[,1,1]],H:[[1,,1],[1,,1],[1,1,1],[1,,1],[1,,1]],I:[[1,1,1],[,1],[,1],[,1],[1,1,1]],J:[[1,1,1],[,,1],[,,1],[1,,1],[1,1,1]],K:[[1,,,1],[1,,1],[1,1],[1,,1],[1,,,1]],L:[[1],[1],[1],[1],[1,1,1]],M:[[1,1,1,1,1],[1,,1,,1],[1,,1,,1],[1,,,,1],[1,,,,1]],N:[[1,,,1],[1,1,,1],[1,,1,1],[1,,,1],[1,,,1]],O:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],P:[[1,1,1],[1,,1],[1,1,1],[1],[1]],Q:[[0,1,1],[1,,,1],[1,,,1],[1,,1,1],[1,1,1,1]],R:[[1,1],[1,,1],[1,,1],[1,1],[1,,1]],S:[[1,1,1],[1],[1,1,1],[,,1],[1,1,1]],T:[[1,1,1],[,1],[,1],[,1],[,1]],U:[[1,,1],[1,,1],[1,,1],[1,,1],[1,1,1]],V:[[1,,,,1],[1,,,,1],[,1,,1],[,1,,1],[,,1]],W:[[1,,,,1],[1,,,,1],[1,,,,1],[1,,1,,1],[1,1,1,1,1]],X:[[1,,,,1],[,1,,1],[,,1],[,1,,1],[1,,,,1]],Y:[[1,,1],[1,,1],[,1],[,1],[,1]],Z:[[1,1,1,1,1],[,,,1],[,,1],[,1],[1,1,1,1,1]],0:[[1,1,1],[1,,1],[1,,1],[1,,1],[1,1,1]],1:[[,1],[,1],[,1],[,1],[,1]],2:[[1,1,1],[0,0,1],[1,1,1],[1,0,0],[1,1,1]],3:[[1,1,1],[0,0,1],[1,1,1],[0,0,1],[1,1,1]],4:[[1,0,1],[1,0,1],[1,1,1],[0,0,1],[0,0,1]],5:[[1,1,1],[1,0,0],[1,1,1],[0,0,1],[1,1,1]],6:[[1,1,1],[1,0,0],[1,1,1],[1,0,1],[1,1,1]],7:[[1,1,1],[0,0,1],[0,0,1],[0,0,1],[0,0,1]],8:[[1,1,1],[1,0,1],[1,1,1],[1,0,1],[1,1,1]],9:[[1,1,1],[1,0,1],[1,1,1],[0,0,1],[1,1,1]]," ":[[,,],[,,],[,,],[,,],[,,]],"?":[[1,1,1],[0,0,1],[0,1,0],[0,0,0],[0,1,0]]},this.draw=function(){var t=[];string=this.text.toUpperCase();for(var e=0;e<string.length;e++){var i=this.letters[string.charAt(e)];i&&t.push(i)}$.offContext.fillStyle=this.color;var s=this.x;for(e=0;e<t.length;e++){i=t[e];for(var n=this.y,h=0,a=0;a<i.length;a++){for(var r=i[a],o=0;o<r.length;o++)r[o]&&$.offContext.fillRect(s+o*this.size,n,this.size,this.size);h=Math.max(h,r.length*this.size),n+=this.size}s+=this.size+h}},this.update=function(){}},Tween=function(t,e,i){e=e||{},this.target=t||null,this.newx=e.x||null,this.newy=e.y||null,this.context=i||null,this.startTime=(new Date).getTime(),this.started=!1,this.finished=!1,this.onDone=null,this.draw=function(){},this.update=function(){if(!this.finished){var t=(new Date).getTime()-this.startTime;if(null!=this.newx){var e=(i=this.newx/this.target.x)*t/1e3;this.newx>this.target.x?this.target.x+=Math.ceil(e):this.target.x==Math.ceil(this.newx)&&(this.finished=!0),this.newx<this.target.x?this.target.x-=Math.ceil(e):this.target.x==Math.ceil(this.newx)&&(this.finished=!0)}if(null!=this.newy){var i=this.newy/this.target.y,s=i*t/1e3;this.newy>this.target.y?this.target.y+=Math.ceil(s):this.target.y==Math.ceil(this.newy)&&(this.finished=!0),this.newy<this.target.y?this.target.y-=Math.ceil(s):this.target.y==Math.ceil(this.newy)&&(this.finished=!0)}this.finished&&null!=this.onDone&&this.onDone.call($.currentScene)}}},$=new function(){this.version="0.1b",this.title="",this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.offCanvas=document.createElement("canvas"),this.offContext=this.offCanvas.getContext("2d"),this.defaultHeight=0,this.defaultWidth=0,this.centerX=0,this.centerY=0,this.bgColor=null,this.orientation="portrait",this.time={now:Date.now(),delta:Date.now(),then:Date.now(),interval:1e3/60,fps:60},this.assets={files:[],sounds:[],images:[]},this.assetsToLoad=0,this.assetsLoaded=0,this.loadComplete=!1,this.fileAssets=[],this.imageAssets=[],this.soundAssets=[],this.currentScene=null,this.currentSceneObjects=[],this.currentSceneAnimations=[],this.currentSceneEvents=[],this.anchor={LEFT:0,TOP:0,CENTER:.5,RIGHT:1,BOTTOM:1},this.onReady=function(t){window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,100)},this.isFunction(t)&&(window.onload=t)},this.setup=function(t){var e=document.createElement("style");e.innerHTML="*{margin:0px; padding:0px; border:0px; overflow: hidden;} canvas{padding:0px; margin:0px; border: 0px;}",this.title=t.title||"API",this.author=t.author||"API_NAME",this.description=t.description||"API DESCRIPTION",this.canvas.width=t.width||320,this.canvas.height=t.height||480,this.offCanvas.width=this.canvas.width,this.offCanvas.height=this.canvas.height,this.defaultWidth=this.canvas.width,this.defaultHeight=this.canvas.height,this.centerX=Math.round(this.canvas.width/2),this.centerY=Math.round(this.canvas.height/2),this.orientation=t.orientation||"portrait",this.time.fps=t.fps||60,t.pixelart&&(e.innerHTML+=" canvas { image-rendering: optimizeSpeed; image-rendering: -moz-crisp-edges; image-rendering: -o-crisp-edges; image-rendering: -webkit-optimize-contrast; image-rendering: optimize-contrast; image-rendering: crisp-edges; image-rendering: pixelated; -ms-interpolation-mode: nearest-neighbor;}"),this.bgColor=t.bgColor||null,this.assets.files=t.assets.files||[],this.assets.sounds=t.assets.sounds||[],this.assets.images=t.assets.images||[],void 0==this.assets.sounds&&this.assets.images;var i=document.createElement("title");i.innerHTML=this.title;var s=document.createElement("meta");s.setAttribute("author",this.author);var n=document.createElement("meta");n.setAttribute("description",this.description);var h=document.createElement("meta");h.setAttribute("http-equiv","Cache-Control"),h.setAttribute("content","no-cache, no-store, must-revalidate");var a=document.createElement("meta");a.setAttribute("http-equiv","Pragma"),a.setAttribute("content","no-cache");var r=document.createElement("meta");r.setAttribute("http-equiv","Expires"),r.setAttribute("content","0");var o=document.createElement("meta");o.setAttribute("name","viewport"),o.setAttribute("content","width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"),document.head.appendChild(e),document.head.appendChild(i),document.head.appendChild(s),document.head.appendChild(n),document.head.appendChild(h),document.head.appendChild(a),document.head.appendChild(r),document.head.appendChild(o),document.body.appendChild(this.canvas),window.addEventListener("resize",this.resizeScreen.bind(this),!1),this.canvas.addEventListener("touchstart",function(t){for(var e=0;e<$.currentSceneEvents.length;e++)"touchstart"==$.currentSceneEvents[e][1]&&$.currentSceneEvents[e][0].isInside(t)&&$.currentSceneEvents[e][2].call($.currentSceneEvents[e][3],$.currentSceneEvents[e][0])},!1),this.canvas.addEventListener("touchend",function(t){for(var e=0;e<$.currentSceneEvents.length;e++)"touchend"==$.currentSceneEvents[e][1]&&$.currentSceneEvents[e][0].isInside(t)&&$.currentSceneEvents[e][2].call($.currentSceneEvents[e][3],$.currentSceneEvents[e][0])},!1),this.canvas.addEventListener("mousedown",function(t){for(var e=0;e<$.currentSceneEvents.length;e++)"mousedown"==$.currentSceneEvents[e][1]&&$.currentSceneEvents[e][0].isInside(t)&&$.currentSceneEvents[e][2].call($.currentSceneEvents[e][3],$.currentSceneEvents[e][0])},!1),this.canvas.addEventListener("mouseup",function(t){for(var e=0;e<$.currentSceneEvents.length;e++)"mouseup"==$.currentSceneEvents[e][1]&&$.currentSceneEvents[e][0].isInside(t)&&$.currentSceneEvents[e][2].call($.currentSceneEvents[e][3],$.currentSceneEvents[e][0])},!1),this.canvas.addEventListener("click",function(t){for(var e=0;e<$.currentSceneEvents.length;e++)"click"==$.currentSceneEvents[e][1]&&$.currentSceneEvents[e][0].isInside(t)&&$.currentSceneEvents[e][2].call($.currentSceneEvents[e][3],$.currentSceneEvents[e][0])},!1),this.resizeScreen(),this.loadAssets(),this.main()},this.main=function(){this.time.now=Date.now(),this.time.delta=this.time.now-this.time.then,this.time.delta>this.time.interval&&(this.time.then=this.time.now-this.time.delta%this.time.interval,this.update(),this.draw()),requestAnimationFrame(this.main.bind(this))},this.update=function(){if(this.currentScene){for(t=0;t<this.currentSceneObjects.length;t++);for(t=0;t<this.currentSceneAnimations.length;t++)this.currentSceneAnimations[t].finished?this.currentSceneAnimations.splice(t,1):this.currentSceneAnimations[t].update();for(var t=0;t<this.currentSceneAnimations.length;t++)this.currentSceneAnimations[t].finished&&this.currentSceneAnimations.splice(t,1);this.currentScene.update()}},this.draw=function(){this.bgColor?(this.offContext.fillStyle=this.bgColor,this.offContext.fillRect(0,0,this.offCanvas.width,this.offCanvas.height)):this.offContext.clearRect(0,0,this.offCanvas.width,this.offCanvas.height);for(var t=0;t<this.currentSceneObjects.length;t++)this.currentSceneObjects[t].draw();this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.drawImage(this.offCanvas,0,0)},this.loadAssets=function(t){for(this.assetsToLoad=(this.assets.files.length||0)+(this.assets.sounds.length||0)+(this.assets.images.length||0),e=0;e<this.assets.files.length;e++);for(e=0;e<this.assets.sounds.length;e++)this.soundAssets[this.assets.sounds[e].split("/").pop().replace(/\.[^/.]+$/,"")]=new Sound(this.assets.sounds[e]);for(var e=0;e<this.assets.images.length;e++){var i=new Image;i.addEventListener("load",this.assetLoaded.bind(this)),i.src=this.assets.images[e];var s=this.assets.images[e].split("/").pop();this.imageAssets[s.replace(/\.[^/.]+$/,"")]=i}},this.assetLoaded=function(){++this.assetsLoaded>=this.assetsToLoad&&(this.loadComplete=!0)},this.goTo=function(t,e){this.currentSceneObjects=[],this.currentSceneEvents=[],this.currentScene=null,this.currentScene=t,this.currentScene.init(e)},this.resizeScreen=function(){var t=window.innerWidth,e=window.innerHeight;if("portrait"==this.orientation){this.canvas.height=Math.ceil(e*this.defaultWidth/t);var i=this.canvas.height/this.canvas.width,s=window.innerWidth;(h=window.innerHeight)/s>i?(newheight=s*i,this.canvas.style.height=h+"px",this.canvas.style.width=s+"px"):(s=h/i,this.canvas.style.width=s+"px",this.canvas.style.height=h+"px"),this.canvas.style.height=h}else{this.canvas.width=Math.ceil(t*this.defaultHeight/e);var n=this.canvas.width/this.canvas.height,s=window.innerWidth,h=window.innerHeight;s/h>n?(s=h*n,this.canvas.style.height=h+"px",this.canvas.style.width=s+"px"):(h=s/n,this.canvas.style.width=s+"px",this.canvas.style.height=h+"px"),this.canvas.style.width=s}this.offCanvas.width=this.canvas.width,this.offCanvas.height=this.canvas.height,this.canvas.width=this.canvas.width,this.canvas.height=this.canvas.height,this.canvas.style.width=this.canvas.style.width,this.canvas.style.height=this.canvas.style.height,this.canvasRatio=parseInt(this.canvas.style.width)/this.defaultWidth,this.centerX=Math.round(this.canvas.width/2),this.centerY=Math.round(this.canvas.height/2)},this.isColliding=function(t,e,i){t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y&&i(t,e)},this.on=function(t,e,i){"string"==typeof t&&this.isFunction(i)&&e.addEventListener(t,i)},this.defaultClickEvent=function(t){t.preventDefault(),this.screenRatio=parseInt(this.canvas.style.width)/this.canvas.width,"touchstart"==t.type?(this.input.x=t.targetTouches[0].pageX-parseInt(this.canvas.offsetLeft),this.input.y=t.targetTouches[0].pageY-parseInt(this.canvas.offsetTop)):(this.input.x=t.pageX-parseInt(this.canvas.offsetLeft),this.input.y=t.pageY-parseInt(this.canvas.offsetTop))},this.rand=function(t,e){return Math.floor(Math.random()*(e-t+1)),Math.floor(Math.random()*(e-t+1)),Math.floor(Math.random()*(e-t+1))+t},this.isFunction=function(t){return"function"==typeof t},this.image=function(t,e,i){var s=this.currentSceneObjects.length;return this.currentSceneObjects.push(new SimpleImage({x:t,y:e,image:i},this)),this.currentSceneObjects[s]},this.sprite=function(t,e,i,s,n){var h=this.currentSceneObjects.length;return this.currentSceneObjects.push(new Sprite({x:t,y:e,spriteSheet:i,frameWidth:s,frameHeight:n},this)),this.currentSceneObjects[h]},this.button=function(t,e,i){var s=this.currentSceneObjects.length;return this.currentSceneObjects.push(new Button({x:t,y:e,image:i},this)),this.currentSceneObjects[s]},this.text=function(t,e,i,s,n){var h=this.currentSceneObjects.length;return this.currentSceneObjects.push(new Text({x:t,y:e,text:i,size:s,color:n},this)),this.currentSceneObjects[h]},this.tween=function(t,e){var i=this.currentSceneAnimations.length;return this.currentSceneAnimations.push(new Tween(t,e,this)),this.currentSceneAnimations[i]}},load={init:function(){$.text(8,$.canvas.height-8,"Loading...",1,"#e2d4a3")},update:function(){$.loadComplete&&$.goTo(title)}},title={init:function(){$.text(16,$.centerY-64,"Lost",3,"#603e63"),$.text(80,$.centerY-64,"in",3,"#6a816d"),$.text(64,$.centerY-48,"Jungle",3,"#e2d4a3"),$.text(32,$.centerY-8,"lost in a misty jungle",1,"#603e63"),$.sprite(32,$.centerY,"p",16,16),$.text(72,$.centerY,"how many days",1,"#603e63"),$.text(48,$.centerY+8,"can you survive?",1,"#603e63");var t=$.button($.centerX,$.centerY+32,"b");t.anchor.x=$.anchor.CENTER,t.anchor.y=$.anchor.TOP,t.on("click",this.btnPclk,this),$.text(t.x-11,t.y+12,"try",2,"#e2d4a3"),$.text(8,$.canvas.height-8,"by zendrael to js13k 2017",1,"#e2d4a3"),window.innerWidth>window.innerHeight&&$.text(8,8,"Reload the game in portrait mode",1,"#e2d4a3")},update:function(){},btnPclk:function(){$.goTo(play,{})}},over={init:function(t){$.text(40,$.centerY-64,"game",3,"#6a816d"),$.text(72,$.centerY-48,"over",3,"#e2d4a3"),$.text(32,$.centerY-8,"you lasted only",1,"#603e63"),$.text(88,$.centerY,t.days+" days",1,"#603e63");var e=$.button($.centerX,$.centerY+32,"b");e.anchor.x=$.anchor.CENTER,e.anchor.y=$.anchor.TOP,e.on("click",this.btnRclk,this),$.text(e.x-7,e.y+12,"ok",2,"#e2d4a3")},update:function(){},btnRclk:function(){$.goTo(title,{})}},play={init:function(t){this.trn=0,this.tilesize=16,this.kills=0,this.days=t.days||0,this.board=[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]],this.mkStage(),this.mkPlayer(),this.mkEnemies(),this.mkUI(),$.soundAssets.room.play()},update:function(){},mkStage:function(){this.bg={x:this.tilesize,y:Math.ceil(($.canvas.height-80)/2-64),width:8*this.tilesize,height:8*this.tilesize},this.bg.y=this.bg.y<this.tilesize?this.tilesize:this.bg.y;for(i=0;i<8;i++)for(s=0;s<8;s++)(t=$.sprite(this.bg.x+i*this.tilesize,this.bg.y+s*this.tilesize,"t",this.tilesize,this.tilesize)).frame=(i+s)%2==0?9:$.rand(10,12);$.sprite(0,this.bg.y-this.tilesize,"t",this.tilesize,this.tilesize).frame=0,$.sprite(9*this.tilesize,this.bg.y-this.tilesize,"t",this.tilesize,this.tilesize).frame=2,$.sprite(0,this.bg.y+this.bg.height,"t",this.tilesize,this.tilesize).frame=6,$.sprite(9*this.tilesize,this.bg.y+this.bg.height,"t",this.tilesize,this.tilesize).frame=8;for(i=this.tilesize;i<=8*this.tilesize;i+=this.tilesize)(t=$.sprite(i,this.bg.y-this.tilesize,"t",this.tilesize,this.tilesize)).frame=7;for(i=this.tilesize;i<=8*this.tilesize;i+=this.tilesize)(t=$.sprite(i,this.bg.y+this.bg.height,"t",this.tilesize,this.tilesize)).frame=1;for(s=this.bg.y;s<=this.bg.y+7*this.tilesize;s+=this.tilesize)(t=$.sprite(0,s,"t",this.tilesize,this.tilesize)).frame=3;for(s=this.bg.y;s<=this.bg.y+7*this.tilesize;s+=this.tilesize){var t=$.sprite(this.bg.width+this.tilesize,s,"t",this.tilesize,this.tilesize);t.frame=5}for(var e=0;e<$.rand(4,6);e++){var i=$.rand(0,7),s=$.rand(0,7);$.sprite(this.bg.x+i*this.tilesize,this.bg.y+s*this.tilesize,"t",this.tilesize,this.tilesize).frame=$.rand(13,14),this.board[i][s]="x"}},mkPlayer:function(){for(var t=$.rand(0,7),e=$.rand(0,7);0!=this.board[t][e];)t=$.rand(0,7),e=$.rand(0,7);this.p=$.sprite(this.bg.x+t*this.tilesize,this.bg.y+e*this.tilesize,"p",this.tilesize,this.tilesize),this.p.moving=0,this.p.bx=t,this.p.by=e,this.board[t][e]="p"},mvPlayer:function(t){if(1!=this.trn&&1!=this.p.moving){var e=!1;switch(t.dir){case"u":if(this.p.by-1>=0&&"x"!=this.board[this.p.bx][this.p.by-1]){s=$.tween(this.p,{y:this.p.y-this.tilesize});e=!0,this.board[this.p.bx][this.p.by]=0,this.p.by-=1}break;case"r":if(this.p.bx+1<=7&&"x"!=this.board[this.p.bx+1][this.p.by]){s=$.tween(this.p,{x:this.p.x+this.tilesize});e=!0,this.board[this.p.bx][this.p.by]=0,this.p.bx+=1}break;case"d":if(this.p.by+1<=7&&"x"!=this.board[this.p.bx][this.p.by+1]){s=$.tween(this.p,{y:this.p.y+this.tilesize});e=!0,this.board[this.p.bx][this.p.by]=0,this.p.by+=1}break;case"l":if(this.p.bx-1>=0&&"x"!=this.board[this.p.bx-1][this.p.by]){var s=$.tween(this.p,{x:this.p.x-this.tilesize});e=!0,this.board[this.p.bx][this.p.by]=0,this.p.bx-=1}}e&&(this.p.moving=1,s.onDone=function(){if("e"==this.board[this.p.bx][this.p.by]){for(this.kills++,$.soundAssets.kill.play(),i=0;i<this.eArr.length;i++)this.eArr[i].bx==this.p.bx&&this.eArr[i].by==this.p.by&&(this.eArr[i].kill(),this.eArr.splice(i,1));this.board[this.p.bx][this.p.by]="p",this.trn=1,this.incTurns(),this.txtWho.text="monsters",this.p.moving=0,this.mvEnemies(),this.kills==this.qtdEnemies&&this.win()}else this.board[this.p.bx][this.p.by]="p",this.trn=1,this.incTurns(),this.txtWho.text="monsters",this.p.moving=0,this.mvEnemies()})}},mkEnemies:function(){this.eArr=[],this.qtdEnemies=$.rand(3,5);for(var t=0;t<this.qtdEnemies;t++){for(var e=$.rand(0,7),i=$.rand(0,7);0!=this.board[e][i];)e=$.rand(0,7),i=$.rand(0,7);var s=$.sprite(this.bg.x+e*this.tilesize,this.bg.y+i*this.tilesize,"e",this.tilesize,this.tilesize);s.frame=$.rand(0,9),s.bx=e,s.by=i,this.eArr.push(s),this.board[e][i]="e"}},mvEnemies:function(){0!=this.trn&&1!=this.p.moving&&(this.enemiesMoved||(this.enemiesMoved=0),this.enemiesMoved==this.eArr.length?(this.txtWho.text="your",this.trn=0,this.incTurns(),this.enemiesMoved=0):this.mvEnemy(this.enemiesMoved))},mvEnemy:function(t){var e=this.eArr[t],i=(Math.abs(e.bx-this.p.bx),Math.abs(e.by-this.p.by),!1);if(this.board[e.bx][e.by]=0,e.bx+1<=7&&"p"==this.board[e.bx+1][e.by]){e.bx+=1,i=!0;s=$.tween(e,{x:e.x+this.tilesize})}else if(e.bx-1>=0&&"p"==this.board[e.bx-1][e.by]){e.bx-=1,i=!0;s=$.tween(e,{x:e.x-this.tilesize})}else if(e.by-1>=0&&"p"==this.board[e.bx][e.by-1]){e.by-=1,i=!0;s=$.tween(e,{y:e.y-this.tilesize})}else if(e.by+1<=7&&"p"==this.board[e.bx][e.by+1]){e.by+=1,i=!0;s=$.tween(e,{y:e.y+this.tilesize})}else if($.rand(0,100)>50){if(e.bx+1<=7&&this.p.bx>=e.bx&&"x"!=this.board[e.bx+1][e.by]&&"e"!=this.board[e.bx+1][e.by]){e.bx+=1,i=!0;s=$.tween(e,{x:e.x+this.tilesize})}else if(e.bx-1>=0&&this.p.bx<=e.bx&&"x"!=this.board[e.bx-1][e.by]&&"e"!=this.board[e.bx-1][e.by]){e.bx-=1,i=!0;s=$.tween(e,{x:e.x-this.tilesize})}}else if(e.by+1<=7&&this.p.by>=e.by&&"x"!=this.board[e.bx][e.by+1]&&"e"!=this.board[e.bx][e.by+1]){e.by+=1,i=!0;s=$.tween(e,{y:e.y+this.tilesize})}else if(e.by-1>=0&&this.p.by<=e.by&&"x"!=this.board[e.bx][e.by-1]&&"e"!=this.board[e.bx][e.by-1]){e.by-=1,i=!0;var s=$.tween(e,{y:e.y-this.tilesize})}i?s.onDone=function(){"p"==this.board[this.eArr[this.enemiesMoved].bx][this.eArr[this.enemiesMoved].by]?this.over():(this.board[this.eArr[this.enemiesMoved].bx][this.eArr[this.enemiesMoved].by]="e",this.enemiesMoved++,this.mvEnemies())}:(this.board[e.bx][e.by]="e",this.enemiesMoved++,this.mvEnemies())},incTurns:function(){this.txtQtd.text=(parseInt(this.txtQtd.text)+1).toString()},mkUI:function(){this.bU=$.button($.centerX,$.canvas.height-76,"b"),this.bU.anchor.x=$.anchor.CENTER,this.bU.dir="u",this.bU.on("click",this.mvPlayer,this),$.text(this.bU.x-4,this.bU.y+12,"N",2,"#e2d4a3"),this.bR=$.button($.centerX+17,$.canvas.height-58,"b"),this.bR.dir="r",this.bR.on("click",this.mvPlayer,this),$.text(this.bR.x+14,this.bR.y+12,"E",2,"#e2d4a3"),this.bD=$.button($.centerX,$.canvas.height-4,"b"),this.bD.anchor.x=$.anchor.CENTER,this.bD.anchor.y=$.anchor.BOTTOM,this.bD.dir="d",this.bD.on("click",this.mvPlayer,this),$.text(this.bD.x-3,this.bD.y-20,"S",2,"#e2d4a3"),this.bL=$.button($.centerX-17,$.canvas.height-58,"b"),this.bL.anchor.x=$.anchor.RIGHT,this.bL.dir="l",this.bL.on("click",this.mvPlayer,this),$.text(this.bL.x-21,this.bL.y+12,"W",2,"#e2d4a3"),this.txtWho=$.text(this.tilesize/2,this.bg.y+9*this.tilesize,"who",1,"#603e63"),$.text(this.tilesize/2,this.txtWho.y+this.tilesize/2,"turn",1,"#603e63"),$.text($.canvas.width-24,this.bg.y+9*this.tilesize,"turns",1,"#603e63"),this.txtQtd=$.text($.canvas.width-this.tilesize,this.txtWho.y+this.tilesize/2,"00",1,"#603e63")},win:function(){this.days++;var t=$.text(16,this.bg.y+5*this.tilesize,"A new day begins",2,"#603e63");$.tween(t,{y:this.tilesize}).onDone=function(){$.goTo(play,{days:this.days})}},over:function(){$.soundAssets.hit.play(),this.p.kill(),$.goTo(over,{days:this.days})}},$.onReady(function(){$.setup({title:"Lost in Jungle",author:"Zendrael",description:"Lost in Jungle game by Zendrael for js13k 2017",width:160,height:240,orientation:"portrait",fps:60,pixelart:!0,bgColor:"#000000",assets:{sounds:["snd/kill","snd/hit","snd/room"],images:["img/b.png","img/e.png","img/p.png","img/t.png"]}}),$.goTo(load)});