!function(t){var n={};function e(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:i})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"u",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.u)return t;var i=Object.create(null);if(e.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)e.d(i,o,function(n){return t[n]}.bind(null,o));return i},e.n=function(t){var n=t&&t.u?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=0)}({0:function(t,n,e){t.exports=e("tjUo")},"q+Kr":function(t,n,e){},tjUo:function(t,n,e){"use strict";function i(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}e.r(n);var o=function(){function t(){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.listeners=[]}var n,e,o;return n=t,(e=[{key:"addListener",value:function(t){this.listeners.push(t)}},{key:"trigger",value:function(t){this.listeners.forEach((function(n){return n(t)}))}}])&&i(n.prototype,e),o&&i(n,o),t}(),r={1:{hint:"more or less",puzzle:[["P1","a","s",""],["m","","b","x"],["r","j","o",""],["","u","","t"]],solution:"about",moves:8},2:{hint:"product of 4 and 10",puzzle:[["o","r","f",""],["","","","t"],["b","P1","i","k"],["w","","y",""]],solution:"forty",moves:14},3:{hint:"v",puzzle:[["e","f","l","",""],["","","","i",""],["","g","","z",""],["P1","j","v","l",""],["","","","","o"]],solution:"five",moves:15},4:{hint:"slice of pie",puzzle:[["e","g","f","p",""],["r","c","","",""],["","i","P1","b","t"],["","a","n","",""],["z","","","","o"]],solution:"percent",moves:21},5:{hint:"haphazard",puzzle:[["","","","","",""],["e","r","c","j","n",""],["","","","","",""],["P1","","d","","",""],["","k","","a","h",""],["","","","","",""]],solution:"chance",moves:22},6:{hint:"fill in ___ blank",puzzle:[["","e","t","","","P1"],["","","","r","l",""],["e","n","h","","t",""],["","","t","","t","g"],["","z","","c","",""],["","","","","",""]],solution:"the",moves:8},7:{hint:"tell it to the judge",puzzle:[["k","j","","","m",""],["","","t","n","","x"],["g","h","","","","e"],["","","j","h","f",""],["u","r","","","",""],["","","","P1","d",""]],solution:"truth",moves:15},8:{hint:"completely asleep",puzzle:[["j","","P1","","o",""],["e","","o","","e",""],["f","","k","","y","t"],["o","","p","","x",""],["h","","d","","c","e"],["u","","u","","j","t"]],solution:"out",moves:6},9:{hint:"exists",puzzle:[["t","","x","d","y","s","r"],["","m","","l","","h",""],["z","","i","c","\te\t","","\tj"],["","b","","","u","t","q"],["","","","f","","g",""],["o","n","k","","s","",""],["i","","w","","v","","P1"]],solution:"is",moves:4},10:{hint:"calming when repeated",puzzle:[["q","","","y","l","e",""],["h","a","","b","t","",""],["g","x","P1","","","o","z"],["","","p","k","f","","u"],["","w","c","","n","","v"],["h","i","j","","a","d",""],["","","s","","m","","r"]],solution:"there",moves:13}};function u(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var e=[],i=!0,o=!1,r=void 0;try{for(var u,s=t[Symbol.iterator]();!(i=(u=s.next()).done)&&(e.push(u.value),!n||e.length!==n);i=!0);}catch(t){o=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(o)throw r}}return e}(t,n)||a(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||a(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(t,n){if(t){if("string"==typeof t)return c(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?c(t,n):void 0}}function c(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}function h(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function l(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var f=function(t,n){return(t+n)%n},v=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;h(this,t),this.level=JSON.parse(localStorage.getItem("etEscapeLevel"))||n,this.onMove=new o,this.onAnswer=new o,this.onUseMove=new o,this.onLevel=new o,this.onModal=new o,this.onEnd=new o,this.resetLevel()}var n,e,i;return n=t,(e=[{key:"resetLevel",value:function(){this.height=r[this.level].puzzle.length,this.width=r[this.level].puzzle[0].length,this.levelMap=s(r[this.level].puzzle.reduce((function(t,n){return t.concat(n)}),[])),this.playerAt=this.levelMap.indexOf("P1"),this.hint=r[this.level].hint,this.moves=r[this.level].moves,this.solution=r[this.level].solution,this.answer=""}},{key:"isPass",value:function(){return this.answer===this.solution}},{key:"isFail",value:function(){return this.answer.length===this.solution.length||0===this.moves}},{key:"gameComplete",value:function(){return this.level>Object.keys(r).length}},{key:"process",value:function(){this.isPass()?(this.onModal.trigger({header:"You made it through",message:"Congratulations!!!",button:"Next level"}),this.level+=1,this.gameComplete()?(this.onEnd.trigger(),localStorage.removeItem("etEscapeLevel")):(this.resetLevel(),this.onLevel.trigger(this),localStorage.setItem("etEscapeLevel",this.level.toString()))):this.isFail()&&(this.onModal.trigger({header:"Lost in a wormhole!!",message:"That sucks...",button:"Play again"}),this.resetLevel(),this.onLevel.trigger(this))}},{key:"updateAnswer",value:function(){var t=this.levelMap[this.playerAt];/^[A-Za-z]$/.test(t)&&(this.onAnswer.trigger({letter:t,index:this.answer.length}),this.answer+=t)}},{key:"rowFromIndex",value:function(t){return(Math.floor(t/this.height)+this.width)%this.width}},{key:"columnFromIndex",value:function(t){return(t%this.width+this.height)%this.height}},{key:"shiftIndex",value:function(t){var n=u(t,2),e=n[0],i=n[1],o=this.rowFromIndex(this.playerAt),r=this.columnFromIndex(this.playerAt);return f(o+e,this.height)*this.width+f(r+i,this.width)}},{key:"validMove",value:function(t){return[this.shiftIndex([-1,0]),this.shiftIndex([1,0]),this.shiftIndex([0,-1]),this.shiftIndex([0,1])].indexOf(t)>-1}},{key:"move",value:function(t){this.validMove(t)&&(this.moves-=1,this.onUseMove.trigger(this.moves),this.onMove.trigger({from:this.playerAt,to:t}),this.playerAt=t,this.updateAnswer())}},{key:"play",value:function(t){var n=t.index,e=t.direction;this.move(null!=n?n:this.shiftIndex(e)),this.process()}}])&&l(n.prototype,e),i&&l(n,i),t}();function d(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var y=function(){function t(){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t)}var n,e,i;return n=t,(e=[{key:"open",value:function(t){var n=t.header,e=t.message,i=t.button,o=document.querySelector("#modal"),r=document.querySelector("#modal button"),u=document.querySelector(".modal-header"),s=document.querySelector(".modal-text");u.textContent=n,s.textContent=e,r.textContent=i,o.style.display="block",r.onclick=function(){o.style.display="none"},window.onclick=function(t){t.target===o&&(o.style.display="none")},window.addEventListener("keydown",(function t(n){"Enter"===n.key&&(o.style.display="none",window.removeEventListener("keydown",t))}))}}])&&d(n.prototype,e),i&&d(n,i),t}();function m(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var w=function(){function t(){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t)}var n,e,i;return n=t,(e=[{key:"showEnding",value:function(){var t=document.querySelector("#pages"),n=document.querySelector("#ending");t.style.display="block",n.style.display="block"}},{key:"showBriefing",value:function(){var t=document.querySelector("#pages"),n=document.querySelector("#briefing"),e=document.querySelector("#briefing .button");t.style.display="block",n.style.display="block",e.addEventListener("click",(function(){t.style.display="",n.style.display=""})),window.addEventListener("keydown",(function e(i){"Enter"===i.key&&(t.style.display="",n.style.display="",window.removeEventListener("keydown",e))}))}},{key:"showIntroduction",value:function(){var t=document.querySelector("#pages"),n=document.querySelector("#crash"),e=document.querySelector(".spaceship");t.style.display="block",n.style.display="block",e.addEventListener("animationend",function i(){t.style.display="",n.style.display="",this.showBriefing(),e.removeEventListener("animationend",i,!1)}.bind(this),!1)}}])&&m(n.prototype,e),i&&m(n,i),t}();e("q+Kr");function p(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var b=function(){function t(n,e,i,o){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.levelMap=n,this.playerAt=e,this.root=document.querySelector("#puzzle"),this.squareNodes=this.root.childNodes,this.setCssVariables(i,o)}var n,e,i;return n=t,(e=[{key:"setCssVariables",value:function(t,n){this.root.style.setProperty("--puzzle-columns",t),this.root.style.setProperty("--puzzle-rows",n)}},{key:"togglePlayer",value:function(t){t.classList.toggle("square-with-player")}},{key:"toggleLetter",value:function(t,n){var e=t.querySelector("span");null===e&&((e=document.createElement("span")).textContent=n,t.appendChild(e),t.classList.toggle("square-with-letter")),e.classList.toggle("show")}},{key:"toggleEmpty",value:function(t){t.classList.toggle("square-vacant")}},{key:"render",value:function(t){var n=this;this.levelMap.forEach((function(e,i){var o=document.createElement("div");o.addEventListener("click",(function(){return t.trigger({index:i})})),n.root.appendChild(o).className="puzzle-square",n.playerAt===i?n.togglePlayer(n.squareNodes[i]):/^[A-Za-z]$/g.test(e)?n.toggleLetter(n.squareNodes[i],e):n.toggleEmpty(n.squareNodes[i])}))}}])&&p(n.prototype,e),i&&p(n,i),t}();function k(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var g=function(){function t(){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.answer=document.querySelector("#answer"),this.answerNodes=this.answer.childNodes,this.onMove=new o,this.addKeyboardListeners()}var n,e,i;return n=t,(e=[{key:"addKeyboardListeners",value:function(){var t=this;document.addEventListener("keydown",(function(n){!function(t){return 37===t.keyCode||65===t.keyCode}(n)?function(t){return 39===t.keyCode||68===t.keyCode}(n)?t.onMove.trigger({direction:[0,1]}):function(t){return 38===t.keyCode||87===t.keyCode}(n)?t.onMove.trigger({direction:[-1,0]}):function(t){return 40===t.keyCode||83===t.keyCode}(n)&&t.onMove.trigger({direction:[1,0]}):t.onMove.trigger({direction:[0,-1]})}))}},{key:"createAnswer",value:function(){var t=this;Array(this.solution.length).fill("*").forEach((function(n){var e=document.createElement("div");e.textContent=n,t.answer.appendChild(e).className="answer-letter"}))}},{key:"updateAnswer",value:function(t){var n=t.letter,e=t.index;this.answerNodes[e].textContent=n}},{key:"updateMoves",value:function(t){document.querySelector(".moves").textContent="".concat(t," moves remaining")}},{key:"updateHint",value:function(t,n){document.querySelector(".hint").textContent="Level ".concat(n,": ").concat(t)}},{key:"resetLevel",value:function(){this.grid.root.hasChildNodes()&&this.grid.root.querySelectorAll("*").forEach((function(t){return t.remove()})),this.answer.hasChildNodes()&&this.answer.querySelectorAll("*").forEach((function(t){return t.remove()}))}},{key:"movePlayer",value:function(t){var n=t.from,e=t.to;this.squareNodes[n].classList.contains("square-with-letter")&&this.grid.toggleLetter(this.squareNodes[n]),this.squareNodes[e].classList.contains("square-with-letter")&&this.grid.toggleLetter(this.squareNodes[e]),this.squareNodes[n].classList.toggle("square-with-player"),this.squareNodes[e].classList.toggle("square-with-player")}},{key:"render",value:function(t){var n=t.level,e=t.playerAt,i=t.levelMap,o=t.hint,r=t.solution,u=t.moves,s=t.width,a=t.height;this.hint=o,this.solution=r,this.moves=u,this.width=s,this.height=a,this.grid=new b(i,e,s,a),this.squareNodes=this.grid.squareNodes,this.resetLevel(),this.grid.render(this.onMove),this.createAnswer(),this.updateMoves(this.moves),this.updateHint(this.hint,n)}}])&&k(n.prototype,e),i&&k(n,i),t}();function z(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}(new(function(){function t(){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.model=new v,this.configure()}var n,e,i;return n=t,(e=[{key:"configure",value:function(){var t=this;this.puzzle=new g,this.pages=new w,this.modal=new y,this.puzzle.onMove.addListener((function(n){return t.model.play(n)})),this.model.onModal.addListener((function(n){return t.modal.open(n)})),this.model.onMove.addListener((function(n){return t.puzzle.movePlayer(n)})),this.model.onAnswer.addListener((function(n){return t.puzzle.updateAnswer(n)})),this.model.onUseMove.addListener((function(n){return t.puzzle.updateMoves(n)})),this.model.onLevel.addListener((function(n){return t.puzzle.render(n)})),this.model.onEnd.addListener((function(){return t.pages.showEnding()}))}},{key:"run",value:function(){JSON.parse(localStorage.getItem("etEscapeLevel"))||this.pages.showIntroduction(),this.puzzle.render(this.model)}}])&&z(n.prototype,e),i&&z(n,i),t}())).run()}});