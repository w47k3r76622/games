var context=document.getElementById("game").getContext("2d"),GAME={STATES:{MENU:0,PLAY:1,RESTART:2},STATE:0,SCORE:0},DIRECTIONS={UP:0,DOWN:1},player={},getNextTile=function(){var t=100;return function(){return Math.round(Math.random())?t<context.canvas.height/2&&(t+=10):t>60&&(t-=10),{height:t,offset:Math.random()*(.6*t-0)+0}}}(),map={tiles:null,nextStep:function(){this.tiles.shift(),this.tiles.push(getNextTile())}};function step(){map.nextStep(),GAME.SCORE=GAME.SCORE+1,GAME.STATE===GAME.STATES.PLAY&&setTimeout(step,25)}function initGame(){map.tiles=Array.from(Array(50),function(){return{height:100,offset:0}}),player={x:Math.ceil(context.canvas.width/map.tiles.length),y:context.canvas.height/2-5,direction:null},GAME.SCORE=0,step()}function update(progress){if(GAME.STATE===GAME.STATES.PLAY){switch(player.direction){case DIRECTIONS.UP:player.y=player.y-2;break;case DIRECTIONS.DOWN:player.y=player.y+2}let startBoundary=context.canvas.height/2-map.tiles[1].height/2+map.tiles[1].offset,endBoundary=startBoundary+map.tiles[1].height;if(player.y+4<startBoundary||player.y-4>endBoundary){with(new AudioContext)with(G=createGain())for(i in D=[22,25,23,25,23])with(createOscillator())D[i]&&(connect(G),G.connect(destination),start(.1*i),frequency.setValueAtTime(440*1.06**(13-D[i]),.1*i),type="square",gain.setValueAtTime(1,.1*i),gain.setTargetAtTime(1e-4,.1*i+.08,.005),stop(.1*i+.09));GAME.STATE=GAME.STATES.RESTART}}}function draw(){if(context.clearRect(0,0,context.canvas.width,context.canvas.height),GAME.STATE===GAME.STATES.MENU)context.textBaseline="middle",context.textAlign="center",context.fillStyle="#6fea62",context.font="40px Courier New",context.fillText("Press Space to Play!",context.canvas.width/2,context.canvas.height/2);else if(GAME.STATE===GAME.STATES.PLAY){var t=Math.ceil(context.canvas.width/map.tiles.length);map.tiles.forEach(function(e,n){context.fillStyle=n%2?"#84ed78":"#6fea62",context.fillRect(t*n,context.canvas.height/2-e.height/2+e.offset,t,e.height)}),context.fillStyle="#19700f",context.fillRect(player.x,player.y,10,10),context.fillStyle="#6fea62",context.font="20px Courier New",context.fillText("Score: "+GAME.SCORE,80,40)}else GAME.STATE===GAME.STATES.RESTART&&(context.textBaseline="middle",context.textAlign="center",context.fillStyle="#6fea62",context.font="40px Courier New",context.fillText("You lost! Score: "+GAME.SCORE,context.canvas.width/2,context.canvas.height/2-30),context.fillText("Press Space to Restart!",context.canvas.width/2,context.canvas.height/2+30))}function loop(t){update(t-lastRender),draw(),GAME.STATE===GAME.STATES.PLAY&&(lastRender=t,window.requestAnimationFrame(loop))}var lastRender=0;function check(t){if(GAME.STATE===GAME.STATES.MENU)switch(t.keyCode){case 32:playConfirmationSound(),GAME.STATE=GAME.STATES.PLAY,initGame(),window.requestAnimationFrame(loop)}else if(GAME.STATE===GAME.STATES.PLAY)switch(t.keyCode){case 38:player.direction=DIRECTIONS.UP;break;case 40:player.direction=DIRECTIONS.DOWN}else if(GAME.STATE===GAME.STATES.RESTART)switch(t.keyCode){case 32:playConfirmationSound(),GAME.STATE=GAME.STATES.PLAY,initGame(),window.requestAnimationFrame(loop)}}function playConfirmationSound(){with(new AudioContext)with(G=createGain())for(i in D=[5,7])with(createOscillator())D[i]&&(connect(G),G.connect(destination),start(.1*i),frequency.setValueAtTime(440*1.06**(13-D[i]),.1*i),gain.setValueAtTime(1,.1*i),gain.setTargetAtTime(1e-4,.1*i+.08,.005),stop(.1*i+.09))}window.requestAnimationFrame(loop),window.addEventListener("keydown",this.check,!1);