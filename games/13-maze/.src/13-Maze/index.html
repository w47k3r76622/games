<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>js13kgame - 13 Maze</title><style>body{display:flex;justify-content:center;align-items:center;height:100vh;margin:0;background-color:#000}#gameCanvas{display:block;background-color:#f0f0f0}#optionContainer{display:none;flex-direction:column;align-items:center;position:absolute;background-color:#fff;padding:20px;border:1px solid #000;box-shadow:0 0 10px rgba(0,0,0,.3)}button{margin:10px}</style></head><body><canvas id="gameCanvas"></canvas><div id="optionContainer"><button onclick="move()">Move</button><button id="hintBtn" onclick="useHint()">Hint</button><button onclick="cancel()">Close</button></div><script>const canvas=document.getElementById('gameCanvas');let canvasWidth,canvasHeight;if (window.orientation===0 || window.orientation===180){canvasWidth=window.innerWidth;canvasHeight=window.innerHeight}else{const aspectRatio=9 / 16;canvasWidth=window.innerWidth;canvasHeight=window.innerWidth / aspectRatio;if (canvasHeight>window.innerHeight){canvasHeight=window.innerHeight;canvasWidth=window.innerHeight * aspectRatio}}canvas.width=canvasWidth;canvas.height=canvasHeight;const context=canvas.getContext('2d');const mazeSize=10;const tileSize=Math.min(canvas.width,canvas.height) / mazeSize;const tiles=[];const playerPosition={row:0,col:0};const endTile={row:mazeSize - 1,col:mazeSize - 1};let currentScore=0;let hintsAvailable=3;let selectedTile=null;const sprite=new Image();sprite.src='./asset/sprite.png';sprite.onerror=function(){console.error('sprite error.')};let gameState='start';function drawStartScreen(){context.fillStyle='black';context.fillRect(0,0,canvas.width,canvas.height);const mazeWidth=mazeSize * tileSize;const mazeHeight=mazeSize * tileSize;const mazeX=(canvas.width - mazeWidth) / 2;const mazeY=(canvas.height - mazeHeight) / 2;context.font='50px Arial';context.textAlign='center';context.textBaseline='middle';drawGlitchText('13-Maze \n \n Click or Tap \n to Start',mazeX+mazeWidth / 2,mazeY+mazeHeight / 2);document.getElementById('hintBtn').innerHTML=`Hint (${hintsAvailable})`;createHorrorBGM()}function drawGameOverScreen(){context.fillStyle='black';context.fillRect(0,0,canvas.width,canvas.height);const mazeWidth=mazeSize * tileSize;const mazeHeight=mazeSize * tileSize;const mazeX=(canvas.width - mazeWidth) / 2;const mazeY=(canvas.height - mazeHeight) / 2;let text=(currentScore>=13) ? "OVER 13":(currentScore <=-13) ? "-13 DOWN":""; context.font='50px Arial';context.textAlign='center';context.textBaseline='middle';drawGlitchText('Game Over \n\n'+text,mazeX+mazeWidth / 2,mazeY+mazeHeight / 2)}function drawGameClearScreen(){context.fillStyle='black';context.fillRect(0,0,canvas.width,canvas.height);const mazeWidth=mazeSize * tileSize;const mazeHeight=mazeSize * tileSize;const mazeX=(canvas.width - mazeWidth) / 2;const mazeY=(canvas.height - mazeHeight) / 2;context.fillStyle='red';context.font='50px Arial';context.textAlign='center';context.textBaseline='middle';drawGlitchText('Game Clear',mazeX+mazeWidth / 2,mazeY+mazeHeight / 2)}let glitchText=[];let glitchTextX=0;let glitchTextY=[];function drawGlitchText(text,x,y){glitchText=text.split('\n');glitchTextX=x;glitchTextY=glitchText.map((_,i)=>y+i * 50)}function update(){if (glitchText.length>0){context.font='50px Arial';context.textAlign='center';context.textBaseline='middle';for (let i=0;i < glitchText.length;i++){for (let j=0;j < 5;j++){const dx=Math.random() * 10 - 5;const dy=Math.random() * 10 - 5;context.fillStyle=`rgb(${Math.random() * 180},${Math.random() * 80},${Math.random() * 80})`;context.fillText(glitchText[i],glitchTextX+dx,glitchTextY[i]+dy)}}}requestAnimationFrame(update)}update();function drawScreen(){context.clearRect(0,0,canvas.width,canvas.height);context.fillStyle='black';context.fillRect(0,0,canvas.width,canvas.height);if (gameState==='start'){drawStartScreen()}else if (gameState==='playing'){drawMaze()}else if (gameState==='gameover'){drawGameOverScreen()}else if (gameState==='gameclear'){drawGameClearScreen()}}function playMoveSound(){const audioContext=new (window.AudioContext || window.webkitAudioContext)();const oscillator=audioContext.createOscillator();const gainNode=audioContext.createGain();oscillator.type='square';oscillator.frequency.setValueAtTime(150,audioContext.currentTime);oscillator.connect(gainNode);gainNode.connect(audioContext.destination);gainNode.gain.setValueAtTime(.2,audioContext.currentTime);gainNode.gain.exponentialRampToValueAtTime(.0001,audioContext.currentTime+0.1);oscillator.start();oscillator.stop(audioContext.currentTime+0.1)}const audioContext=new (window.AudioContext || window.webkitAudioContext)();function createHorrorBGM(){const oscillator=audioContext.createOscillator();const gainNode=audioContext.createGain();oscillator.type='sawtooth';oscillator.frequency.setValueAtTime(60,audioContext.currentTime);gainNode.gain.setValueAtTime(.01,audioContext.currentTime);gainNode.gain.exponentialRampToValueAtTime(.05,audioContext.currentTime+2);gainNode.gain.exponentialRampToValueAtTime(.01,audioContext.currentTime+4);oscillator.connect(gainNode).connect(audioContext.destination);oscillator.start();setInterval(()=>{oscillator.frequency.setValueAtTime(60,audioContext.currentTime);gainNode.gain.setValueAtTime(.01,audioContext.currentTime);gainNode.gain.exponentialRampToValueAtTime(.05,audioContext.currentTime+2);gainNode.gain.exponentialRampToValueAtTime(.01,audioContext.currentTime+4)},4000)}function getRandomScore(){const random=Math.random();if (random < .7){return Math.floor(Math.random() * 4)}else{return -Math.floor(Math.random() * 4)}}function initializeMaze(){for (let row=0;row < mazeSize;row++){tiles[row]=[];for (let col=0;col < mazeSize;col++){tiles[row][col]={x:col * tileSize,y:row * tileSize,wall:Math.random() < .2,revealed:false,moveable:false,score:getRandomScore()}}}tiles[endTile.row][endTile.col].wall=false;tiles[playerPosition.row][playerPosition.col].wall=false;createMaze();drawMaze();updateMoveableTiles()}function isTileVisible(row,col,range){const mazeWidth=mazeSize * tileSize;const mazeHeight=mazeSize * tileSize;const mazeX=(canvas.width - mazeWidth) / 2;const mazeY=(canvas.height - mazeHeight) / 2;const playerRelativeX=playerPosition.col * tileSize - mazeX;const playerRelativeY=playerPosition.row * tileSize - mazeY;const tileRelativeX=col * tileSize - mazeX;const tileRelativeY=row * tileSize - mazeY;const dx=Math.abs(playerRelativeX - tileRelativeX);const dy=Math.abs(playerRelativeY - tileRelativeY);return dx <=range * tileSize && dy <=range * tileSize}function drawMaze(){context.fillStyle='black';context.fillRect(0,0,canvas.width,canvas.height);const mazeWidth=mazeSize * tileSize;const mazeHeight=mazeSize * tileSize;const mazeX=(canvas.width - mazeWidth) / 2;const mazeY=(canvas.height - mazeHeight) / 2;for (let row=0;row < mazeSize;row++){for (let col=0;col < mazeSize;col++){const tile=tiles[row][col];const tileX=mazeX+tile.x;const tileY=mazeY+tile.y;const isVisible=isTileVisible(row,col,2);if (row===endTile.row && col===endTile.col){context.drawImage(sprite,0,0,16,16,tileX,tileY,tileSize,tileSize)}else if (tile.wall){if (isVisible){context.drawImage(sprite,16,0,16,16,tileX,tileY,tileSize,tileSize)}}else{context.drawImage(sprite,32,0,16,16,tileX,tileY,tileSize,tileSize);if (tile.revealed && tile.score !==0){context.fillStyle=tile.score>0 ? 'green':'red';context.font='20px Arial';context.textAlign='center';context.fillText(tile.score,tileX+tileSize / 2,tileY+tileSize / 2+8)}}if (tile.moveable){context.strokeStyle='yellow';context.lineWidth=2;context.strokeRect(tileX,tileY,tileSize,tileSize)}}}context.drawImage(sprite,48,0,16,16,mazeX+playerPosition.col * tileSize,mazeY+playerPosition.row * tileSize,tileSize,tileSize);context.globalCompositeOperation='destination-in';context.beginPath();context.arc(mazeX+playerPosition.col * tileSize+tileSize / 2,mazeY+playerPosition.row * tileSize+tileSize / 2,tileSize * 2,0,2 * Math.PI);context.fill();context.globalCompositeOperation='source-over';context.fillStyle='rgba(0, 0, 0, 0.5)';context.beginPath();context.rect(mazeX,mazeY,mazeWidth,mazeHeight);context.arc(mazeX+playerPosition.col * tileSize+tileSize / 2,mazeY+playerPosition.row * tileSize+tileSize / 2,tileSize * 2,0,2 * Math.PI);context.fill('evenodd')}function createMaze(){function isValid(row,col){return row>=0 && row < mazeSize && col>=0 && col < mazeSize}function hasPath(){const directions=[[-1,0],[1,0],[0,-1],[0,1]];const queue=[playerPosition];const visited=new Set([`${playerPosition.row},${playerPosition.col}`]);while (queue.length>0){const{row,col}=queue.shift();if (row===endTile.row && col===endTile.col) return true;for (const [dr,dc] of directions){const newRow=row+dr;const newCol=col+dc;if (isValid(newRow,newCol) && !tiles[newRow][newCol].wall && !visited.has(`${newRow},${newCol}`)){visited.add(`${newRow},${newCol}`);queue.push({row:newRow,col:newCol})}}}return false}let tries=0;const maxTries=1000;while (!hasPath() && tries < maxTries){for (let row=0;row < mazeSize;row++){for (let col=0;col < mazeSize;col++){if (!(row===playerPosition.row && col===playerPosition.col) && !(row===endTile.row && col===endTile.col)){tiles[row][col].wall=Math.random() < .4}}}tries++}}function updateMoveableTiles(){for (let row=0;row < mazeSize;row++){for (let col=0;col < mazeSize;col++){tiles[row][col].moveable=false}}const directions=[[-1,0],[1,0],[0,-1],[0,1]];for (const [dr,dc] of directions){const newRow=playerPosition.row+dr;const newCol=playerPosition.col+dc;if (newRow>=0 && newRow < mazeSize && newCol>=0 && newCol < mazeSize && !tiles[newRow][newCol].wall){tiles[newRow][newCol].moveable=true}}drawMaze()}function move(){if (selectedTile && tiles[selectedTile.row][selectedTile.col].moveable){tiles[playerPosition.row][playerPosition.col].revealed=false;playerPosition.row=selectedTile.row;playerPosition.col=selectedTile.col;const tileScore=tiles[selectedTile.row][selectedTile.col].score;currentScore+=tileScore;drawMaze();if (tileScore !==0 && gameState==='playing'){displayPixelatedScoreEffect(tileScore)}playMoveSound();if (playerPosition.row===endTile.row && playerPosition.col===endTile.col){document.getElementById('optionContainer').style.display='none';gameState='gameclear';drawScreen();currentScore=0;playerPosition.row=0;playerPosition.col=0}else if (currentScore>=13 || currentScore <=-13){document.getElementById('optionContainer').style.display='none';gameState='gameover';drawScreen();currentScore=0;playerPosition.row=0;playerPosition.col=0}else{updateMoveableTiles();document.getElementById('optionContainer').style.display='none'}selectedTile=null}}function displayPixelatedScoreEffect(tileScore){const text=tileScore>0 ? `+${tileScore}` :`${tileScore}`;const color=tileScore>0 ? 'gray' :'red';console.log('Displaying pixelated score:',text,'with color:',color);const tempCanvas=document.createElement('canvas');const tempContext=tempCanvas.getContext('2d');const fontSize=Math.min(canvas.width,canvas.height) / 5;tempCanvas.width=canvas.width;tempCanvas.height=canvas.height;tempContext.font=`bold ${fontSize}px Arial`;tempContext.fillStyle=color;tempContext.textAlign='center';tempContext.textBaseline='middle';tempContext.fillText(text,tempCanvas.width / 2,tempCanvas.height / 2);const imageData=tempContext.getImageData(0,0,tempCanvas.width,tempCanvas.height);for (let i=0;i < imageData.data.length;i+=4){if (imageData.data[i+3]>128){const rand=Math.random();if (rand>0.8){imageData.data[i+3]=0}}}tempContext.putImageData(imageData,0,0);context.drawImage(tempCanvas,0,0);let alpha=1.0;const fadeOut=setInterval(()=>{context.fillStyle='black';context.fillRect(0,0,canvas.width,canvas.height);context.globalAlpha=alpha;drawMaze();context.drawImage(tempCanvas,0,0);alpha -=0.1;if (alpha <=0){clearInterval(fadeOut);context.globalAlpha=1.0;drawMaze();updateMoveableTiles()}},100)}function useHint(){if (hintsAvailable>0){hintsAvailable--;revealSurroundingTiles(playerPosition.row,playerPosition.col,1);drawMaze();document.getElementById('optionContainer').style.display='none';document.getElementById('hintBtn').innerHTML=`Hint (${hintsAvailable})`}else{alert("Hints are no longer available.")}}function revealSurroundingTiles(row,col,range){for (let r=row - range;r <=row+range;r++){for (let c=col - range;c <=col+range;c++){if (r>=0 && r < mazeSize && c>=0 && c < mazeSize && !tiles[r][c].wall){tiles[r][c].revealed=true}}}}function cancel(){document.getElementById('optionContainer').style.display='none';selectedTile=null}function onClick(event){const rect=canvas.getBoundingClientRect();const x=event.clientX - rect.left;const y=event.clientY - rect.top;const mazeWidth=mazeSize * tileSize;const mazeHeight=mazeSize * tileSize;const mazeX=(canvas.width - mazeWidth) / 2;const mazeY=(canvas.height - mazeHeight) / 2;const mazeRelativeX=x - mazeX;const mazeRelativeY=y - mazeY;const col=Math.floor(mazeRelativeX / tileSize);const row=Math.floor(mazeRelativeY / tileSize);if (row>=0 && row < mazeSize && col>=0 && col < mazeSize){const tile=tiles[row][col];if (tile.moveable){selectedTile={row,col};adjustOptionContainerPosition(event.clientX - rect.left,event.clientY - rect.top);optionContainer.style.display='flex'}}}function drawTransition(alpha){context.fillStyle=`rgba(0,0,0,${alpha})`;context.fillRect(0,0,canvas.width,canvas.height)}document.getElementById('optionContainer').addEventListener('click',function(event){event.stopPropagation()});canvas.addEventListener('click',function(event){if (gameState==='start'){gameState='transition';let alpha=0.0;const transition=setInterval(()=>{drawTransition(alpha);alpha+=0.01;if (alpha>=1.0){clearInterval(transition);glitchText=[];gameState='playing';initializeMaze()}},10)}else if (gameState==='playing'){onClick(event)}else if (gameState==='gameover' || gameState==='gameclear'){gameState='start';drawScreen()}});function adjustOptionContainerPosition(x,y){const rect=canvas.getBoundingClientRect();const containerWidth=optionContainer.offsetWidth;const containerHeight=optionContainer.offsetHeight;const offsetX=Math.max(0,Math.min(x,canvas.width - containerWidth));const offsetY=Math.max(0,Math.min(y,canvas.height - containerHeight));optionContainer.style.left=`${rect.left+offsetX}px`;optionContainer.style.top=`${rect.top+offsetY}px`}canvas.addEventListener('touchstart',function(event){event.preventDefault();if (gameState==='start'){gameState='transition';let alpha=0.0;const transition=setInterval(()=>{drawTransition(alpha);alpha+=0.01;if (alpha>=1.0){clearInterval(transition);glitchText=[];gameState='playing';initializeMaze()}},10)}else if (gameState==='playing'){event.preventDefault();const rect=canvas.getBoundingClientRect();const x=event.touches[0].clientX - rect.left;const y=event.touches[0].clientY - rect.top;const mazeWidth=mazeSize * tileSize;const mazeHeight=mazeSize * tileSize;const mazeX=(canvas.width - mazeWidth) / 2;const mazeY=(canvas.height - mazeHeight) / 2;const mazeRelativeX=x - mazeX;const mazeRelativeY=y - mazeY;const col=Math.floor(mazeRelativeX / tileSize);const row=Math.floor(mazeRelativeY / tileSize);if (row>=0 && row < mazeSize && col>=0 && col < mazeSize){const tile=tiles[row][col];if (tile.moveable){selectedTile={row,col};adjustOptionContainerPosition(event.clientX - rect.left,event.clientY - rect.top);optionContainer.style.display='flex'}}}else if (gameState==='gameover' || gameState==='gameclear'){gameState='start';drawScreen()}},false);drawStartScreen();</script></body></html>