function aa(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}function g(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):{next:aa(a)}}function ba(a){if(!(a instanceof Array)){a=g(a);for(var b,c=[];!(b=a.next()).done;)c.push(b.value);a=c}return a}
var ca="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)},da="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function ea(a,b){if(b){var c=da;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&ca(c,a,{configurable:!0,writable:!0,value:b})}}
ea("Math.hypot",function(a){return a?a:function(b){if(2>arguments.length)return arguments.length?Math.abs(arguments[0]):0;var c,d,e;for(c=e=0;c<arguments.length;c++)e=Math.max(e,Math.abs(arguments[c]));if(1E100<e||1E-100>e){if(!e)return e;for(c=d=0;c<arguments.length;c++){var f=Number(arguments[c])/e;d+=f*f}return Math.sqrt(d)*e}for(c=d=0;c<arguments.length;c++)f=Number(arguments[c]),d+=f*f;return Math.sqrt(d)}});function h(a){this.b=new k(new l("boat"),a);this.h={x:0,y:0}}
h.prototype.B=function(){m.m.state.v?(n(this.b.position,100),p(),m.u+=100,this.H=!0):m.m.C()};h.prototype.update=function(a){var b=r(this.b.position,t.j).x,c={x:b-6,y:m.s.height(b-6)},d={x:b+6,y:m.s.height(b+6)};this.b.a=u(v(this.b.a,x(r(d,c),.1)));b=m.s.height(b)-this.b.position.y-3;this.h=v(this.h,x({x:0,y:b},.1));this.h=x(this.h,.8);this.b.position=v(this.b.position,x(this.h,.1*a))};h.prototype.g=function(a,b){this.b.g(a,b)};function y(a,b,c,d,e,f){var q=void 0===q?2*Math.PI:q;this.position=null;this.l=a;this.L=b;this.U=c;this.P=d;this.R=void 0===e?1:e;this.S=void 0===f?0:f;this.M=q;this.a=[];this.f=Infinity;this.c=0}y.prototype.start=function(a){this.f=a};y.prototype.stop=function(){this.f=Infinity};function n(a,b){var c=m.J;c.position=a;for(a=0;a<b;a++)z(c)}
y.prototype.update=function(a){var b=this;this.c+=a;this.c>this.f&&(z(this),this.c=0);this.a.forEach(function(c){return c.G-=a});this.a=this.a.filter(function(c){return 0<c.G});this.a.forEach(function(c){c.h=v(x(c.h,.99),b.L);c.position=v(c.position,x(c.h,.1*a))})};function z(a){var b=A(0,a.M),c=A(0,a.S);a.a.push({G:A(a.U,a.P),position:a.position,h:{x:c*Math.cos(b),y:-c*Math.sin(b)},size:A(1,a.R),color:a.l[Math.floor(A(0,a.l.length))]})}
y.prototype.g=function(a){var b=this;B(a,function(c){b.a.forEach(function(d){0>=d.G||(c.fillStyle=d.color,c.fillRect(d.position.x,d.position.y,d.size,d.size))})})};function D(){var a;this.size=a=void 0===a?E:a;this.level=90;this.a=[{w:1,A:.09},{w:.8,A:.05}]}D.prototype.g=function(a){var b=this;F(a,function(c){for(var d=0;d<b.size.x;d++){var e=Math.floor(b.height(d));c.fillStyle=G[13];c.fillRect(d,e,1,2);c.fillStyle=G[14];c.fillRect(d,e+2,1,b.size.y-e-2)}})};function fa(a,b){return a.a.map(function(c){return c.w*Math.sin(b*c.A)}).reduce(function(c,d){return c+d},0)}D.prototype.height=function(a){return this.level-fa(this,a+t.j.x)};function H(){var a=this;this.u=0;this.paused=this.o=!1;this.a=0;this.c=-Infinity;this.s=new I;this.floor=new D;this.m=new J;this.J=new y(G.slice(2,4),{x:0,y:.001},500,1E3,4,.3);this.D=new y(G.slice(11,13),{x:0,y:-.001},600,1400,2,.2);this.i=[[this.s.c,this.floor,this.D,this.J,new K(function(){return"controls:"},{x:40,y:40}),new K(function(){return"drag and click"},{x:40,y:50})],[],[this.m],[],[this.s.l,new K(function(){return a.u+" points"},{x:E.x-1,y:1},!0),{g:function(b){F(b,function(c){var d=E.y-
5,e=Math.floor(a.m.o/a.m.f*36);c.fillStyle=G[0];c.fillRect(1,d-1,38,5);c.fillStyle=G[5];c.fillRect(2,d,e,1);c.fillStyle=G[6];c.fillRect(2,d+1,e,2)})}},{g:function(b){F(b,function(c){var d=new l("heart",1,0,0,!1);c.translate(1,1);for(var e=0;e<a.m.c;e++)L(d,c),c.translate(d.a+1,0)})}}]];this.f=new K(function(){return"paused"},{x:55,y:45});setTimeout(function(){a.i[0]=a.i[0].filter(function(b){return!b.font})},5E3)}
H.prototype.update=function(){var a=this,b=Date.now(),c=this.a?b-this.a:0;this.a=b;this.paused?(F(t,function(d){return d.clearRect(0,0,E.x,E.y)}),this.f.g(t)):(ha(this),[t,this.s].concat(ba(this.i[1]),[this.J,this.D,this.m]).forEach(function(d){return d.update(c)}),F(t,function(d){d.fillStyle=G[4];d.fillRect(0,0,E.x,E.y)}),this.i.forEach(function(d,e){a.i[e]=d.filter(function(f){return!f.H});a.i[e].forEach(function(f){return f.g(t,b)})}))};
function ha(a){if(!(Math.abs(t.j.x-a.c)<E.x)){a.u+=315;a.c=t.j.x;var b=function(c){return Math.abs(c.position.x-t.j.x)<2*E.x};a.i[1]=a.i[1].filter(function(c){return b(c.b)});a.i[3]=a.i[3].filter(b);M(A(1,5),3,5).forEach(function(c){return a.i[3].push(new k(new l("cloud"),c))});M(A(2,4),E.y-10,E.y-4).forEach(function(c){return a.i[3].push(new k(new l("grass",2,800,A(0,1)),c))});M(A(0,4),E.y-25,E.y-20).forEach(function(c){return a.i[3].push(new k(new l("seaweed",4,500,A(0,4)),c))});M(A(2,4),E.y-10,
E.y-5).forEach(function(c){return a.i[3].push(new k(new l("stone"),c,{x:1,y:A(-.5,.5)}))});M(A(1,3),20,20).forEach(function(c){return a.i[1].push(new h(c))});M(A(0,2),80,85).forEach(function(c){return a.i[1].push(new N(c))});M(A(0,1),40,60).forEach(function(c){return a.i[1].push(new O(c))});A()&&(a.i[1].push(new P(A(30,50))),a.i[1].push(new P(A(55,80))))}}function M(a,b,c){for(var d=[],e=0;e<2*a;e++){var f=A()?2:-1;d.push({x:A(t.j.x+E.x*f,t.j.x+E.x*f+E.x),y:A(b,c)})}return d};function Q(){this.c=[[new K(function(){return"tap to play"},{x:58,y:48})],[new K(function(){return"the fishermen"},{x:30,y:30}),new K(function(){return"killed your wife"},{x:30,y:40})],[new K(function(){return"the fishermen"},{x:30,y:30}),new K(function(){return"killed your wife"},{x:30,y:40}),new K(function(){return"that crosses"},{x:30,y:55}),new K(function(){return"several lines"},{x:30,y:65})],[new K(function(){return"you've decided"},{x:30,y:40}),new K(function(){return"it's time for"},{x:30,
y:50})],[new K(function(){return"humpback revenge"},{x:36,y:48})]];this.a="#debug"===location.hash?this.c.length:0}Q.prototype.next=function(){this.a++;this.a===this.c.length-1&&ia();this.a>=this.c.length&&R()};Q.prototype.update=function(){this.a>=this.c.length||(F(t,function(a){return a.clearRect(0,0,E.x,E.y)}),this.c[this.a].forEach(function(a){return a.g(t)}))};function K(a,b,c){b=void 0===b?{x:0,y:0}:b;this.f=a;this.position=b;this.c=void 0===c?!1:c;this.font=document.getElementById("font");this.a=[0,7,14,21,28,35,42,49,56,60,67,74,81,90,98,105,112,120,127,134,142,149,156,165,172,180,187,191,198,207,214,224,233,237,242,247,252,256,262,269,273,280,287,294,301,308,315,322,329,333,341,346]}
K.prototype.g=function(a){var b=this;F(a,function(c){var d=b.f().toUpperCase().split("").map(function(w){return"ABCDEFGHIJKLMNOPQRSTUVWXYZ!\"#$%&'(),./0123456789:? ".indexOf(w)}).filter(function(w){return 0<=w});c.translate(b.position.x,b.position.y);b.c&&c.translate(-ja(b,d),0);var e=0;d=g(d);for(var f=d.next();!f.done;f=d.next()){var q=f.value;f=b.a[q];q=b.a[q+1]-f;c.drawImage(b.font,f,0,q,7,e,0,q,7);e+=q+1}})};
function ja(a,b){return b.map(function(c){return a.a[c+1]-a.a[c]+1}).reduce(function(c,d){return c+d},-1)};function N(a){this.b=new k(new l("mine"),a)}N.prototype.B=function(){n(this.b.position,100);m.m.C();p();this.H=!0};N.prototype.update=function(){};N.prototype.g=function(a,b){this.b.g(a,b)};function I(){var a,b=this;this.size=a=void 0===a?E:a;this.level=20;this.time=0;this.f=[{w:1,A:.09,I:.001},{w:1,A:.04,I:.0015},{w:.8,A:.3,I:.002}];this.a=[];for(a=0;a<this.size.x;a++)this.a.push({height:0,h:0});this.l={g:function(c){F(c,function(d){for(var e=0;e<b.size.x;e++){var f=Math.floor(b.height(e));d.fillStyle=G[12];d.fillRect(e,f,1,2);d.fillStyle=G[11];d.fillRect(e,f+2,1,1)}})}};this.c={g:function(c){F(c,function(d){d.fillStyle=G[10];for(var e=0;e<b.size.x;e++){var f=Math.floor(b.height(e));
d.fillRect(e,f+3,1,b.size.y-f-3)}})}}}function ka(a){var b=m.s,c=.5,d=12;c=void 0===c?1:c;d=void 0===d?12:d;for(var e=Math.floor(a-d/2);e<a+d/2;e++)0<e&&e<b.size.x&&(b.a[e].h+=c)}I.prototype.update=function(a){this.time+=a;for(a=0;a<this.a.length;a++){var b=this.a[a];b.h=.98*b.h+.005*(3*((0<a?this.a[a-1].height-b.height:0)+(a<this.a.length-1?this.a[a+1].height-b.height:0))-1*b.height);b.height+=b.h}};
function la(a,b){return a.f.map(function(c){return c.w*Math.sin(b*c.A+c.I*a.time)}).reduce(function(c,d){return c+d},0)}I.prototype.height=function(a){return this.level-(0>a||a>=this.a.length?0:this.a[Math.floor(a)].height)-la(this,a+t.j.x)};function S(){this.N=null}function p(){T([10,5,1],100,.1)}S.prototype.C=function(){T([1],20,.3)};function ia(){function a(){return T(b,230,.24,.3)}var b=[5,19,12,19,16,19,16,12,7,,11,,19,,19,19,19,19,,12,,19,,5,19,12,19,16,,12,11,12,13,16,15,16,17,,19,,14,14,14,,14,,14,,19,17,,15,,17,17,,14,,15,16,19,,5,19,12,19,14,19,15,19,16,19,17,19,,19,21,19,22,19,23,19,12,12,5,2,,19];U.N=setInterval(a,240*(b.length+1));a()}
function T(a,b,c,d){d=void 0===d?1:d;if(!(.02>=c)){var e=new AudioContext,f=e.createGain();f.connect(e.destination);a.forEach(function(q,w){if(q){var C=e.createOscillator();C.connect(f);w*=c;C.type="square";C.start(w);C.frequency.setValueAtTime(b*Math.pow(1.06,13-q),w);f.gain.setValueAtTime(ma*d,w);f.gain.setTargetAtTime(0,w+.01,c/3);C.stop(w+c-.01)}})}};function l(a,b,c,d,e){b=void 0===b?1:b;this.image=document.getElementById(a);this.c=b;this.a=Math.max(this.image.naturalWidth/b,1);this.delay=void 0===c?500:c;this.f=void 0===d?0:d;this.l=void 0===e?!0:e}
function L(a,b,c,d){d=void 0===d?1:d;c=1>=a.c?0:Math.floor((void 0===c?0:c)/a.delay+a.f)%a.c;a.l&&b.translate(-a.a/2,-a.image.naturalHeight/2);b.scale(d,1);b.strokeStyle=G[0];"#debug"===location.hash&&b.strokeRect(0,0,a.a*d,a.image.naturalHeight);b.drawImage(a.image,a.a*c,0,a.a,a.image.naturalHeight,0,0,a.a*d,a.image.naturalHeight)};function O(a){this.b=new k(new l("submarine"),a,{x:A()?1:-1,y:A(-.1,.1)})}O.prototype.B=function(){m.m.state.v?(n(this.b.position,60),p(),m.u+=125,this.H=!0):m.m.C()};O.prototype.update=function(a){this.b.position=v(this.b.position,x(this.b.a,.01*a));if(30>this.b.position.y||75<this.b.position.y)this.b.a.y*=-1};O.prototype.g=function(a,b){this.b.g(a,b)};function k(a,b,c){c=void 0===c?{x:1,y:0}:c;this.c=a;this.position=b;this.a=c}k.prototype.g=function(a,b){var c=this;B(a,function(d){d.translate(c.position.x,c.position.y);var e=c.a;d.rotate(Math.atan(e.y/e.x));L(c.c,d,b,0>c.a.x?-1:1)})};function P(a){this.height=a;this.time=0;this.c=!1;this.a=A();this.b=new k(new l("torpedo"),{x:t.j.x,y:a},{x:this.a?1:-1,y:0});this.f=new l("warning")}P.prototype.B=function(){n(this.b.position,100);m.m.C();p();this.H=!0};P.prototype.update=function(a){this.time+=a;this.c?this.b.position=v(this.b.position,x(this.b.a,.08*a)):2E3<=this.time?this.c=!0:this.b.position=v({x:this.a?0:E.x,y:this.height},t.j)};
P.prototype.g=function(a,b){var c=this;this.c?this.b.g(a,b):200<b%400&&F(t,function(d){d.translate(c.a?3:E.x-3,c.height);L(c.f,d)})};function v(a,b){return{x:a.x+b.x,y:a.y+b.y}}function r(a,b){return{x:a.x-b.x,y:a.y-b.y}}function x(a,b){return{x:a.x*b,y:a.y*b}}function u(a){var b=Math.hypot(a.x,a.y);return 0===b?a:x(a,1/b)};function V(){var a=this;this.a=document.getElementById("canvas");this.c=this.a.getContext("2d");this.f=null;this.j={x:0,y:0};this.l={x:0,y:0};this.direction={x:0,y:0};this.a.addEventListener("click",function(){return a.a.requestPointerLock()});document.addEventListener("pointerlockchange",function(){"game"===W&&(m.paused=document.pointerLockElement!==a.a)});this.a.addEventListener("mousemove",function(b){a.direction=v(a.direction,{x:b.movementX,y:b.movementY});b=a.direction;100<Math.hypot(b.x,b.y)&&
(a.direction=x(u(a.direction),100))});X(this)}function X(a){a.f=Math.floor(Math.min(Math.min(window.innerWidth/E.x,window.innerHeight/E.y),na));var b=x(E,a.f);a.a.width=b.x;a.a.height=b.y;a.a.style.left=(window.innerWidth-b.x)/2+"px";a.a.style.top=(window.innerHeight-b.y)/2+"px";a.c.imageSmoothingEnabled=!1}V.prototype.update=function(a){this.l=v(this.l,{x:m.m.b.position.x-this.j.x-E.x/2,y:0});this.l=x(this.l,.1);this.j=v(this.j,x(this.l,.01*a))};
function F(a,b){a.c.save();a.c.scale(a.f,a.f);b(a.c);a.c.restore()}function B(a,b){a.c.save();a.c.scale(a.f,a.f);a.c.translate(-a.j.x,-a.j.y);b(a.c);a.c.restore()};function J(){this.M=new l("whale",4,400);this.l=new l("whale-front",2,800);this.b=new k(this.l,{x:100,y:50});this.o=this.f=2E3;this.c=3;this.a=0;this.h={x:0,y:0};this.L={x:0,y:.1};this.state=null}J.prototype.C=function(){this.state.K||(this.a=0,this.c--,0>=this.c?oa():U.C())};
J.prototype.update=function(a){var b=null==this.state?Y(this,a):this.state;this.state=Y(this,a);this.state.F&&!b.F&&ka(r(this.b.position,t.j).x);this.state.v&&!b.v?m.D.start(5):!this.state.v&&b.v&&m.D.stop();m.D.position=this.b.position;this.state.T||!this.state.F?(this.b.c=this.M,this.b.a=x(t.direction,.01),this.h=v(this.h,pa(this))):(this.b.c=this.l,this.b.a={x:1,y:0});this.h=x(this.h,this.state.F?.75:.999);this.b.position=v(this.b.position,x(this.h,.01*a));this.B(m.i[1]).forEach(function(c){return c.B()})};
function Y(a,b){var c=t.direction;c=100<Math.pow(c.x,2)+Math.pow(c.y,2);a.a+=b;var d=1500>a.a,e=a.b.position.y>m.s.height(r(a.b.position,t.j).x),f=a.b.position.y>m.floor.level-5;0<a.o&&m.o?(a.o=Math.max(a.o-b,0),a=!0):(m.o||(a.o=Math.min(a.o+.4*b,a.f)),a=!1);return{T:c,K:d,F:e,O:f,v:a}}function pa(a){if(!a.state.F)return a.L;var b=x(a.b.a,a.state.v?2:1);a.state.O&&(b={x:1*b.x,y:b.y*(0*b.x+-1*b.y)});return b}
J.prototype.B=function(a){var b=this;return a.filter(function(c){var d=b.b.position;c=c.b.position;return 180>Math.pow(d.x-c.x,2)+Math.pow(d.y-c.y,2)})};J.prototype.g=function(a,b){(!this.state.K||this.state.K&&50<b%100)&&this.b.g(a,b)};var ma=.2,na=8,E={x:200,y:100},G="#1a1c2c #5d275d #b13e53 #ef7d57 #ffcd75 #a7f070 #38b764 #257179 #29366f #3b5dc9 #41a6f6 #73eff7 #f4f4f4 #94b0c2 #566c86 #333c57".split(" "),t=null,U=null,m=null,W=null;
window.addEventListener("load",function(){t=new V;U=new S;window.addEventListener("resize",function(){return X(t)});window.addEventListener("contextmenu",function(a){return a.preventDefault()});t.a.addEventListener("mousedown",function(){"game"===W&&(m.o=!0)});t.a.addEventListener("mouseup",function(){"game"===W?m.o=!1:"intro"===W?m.next():"gameOver"===W&&R()});W="intro";m=new Q;requestAnimationFrame(Z)});function Z(){m.update();window.requestAnimationFrame(Z)}
function R(){t.j={x:1.5*E.x,y:0};W="game";m=new H}function oa(){t.j={x:0,y:0};clearInterval(U.N);T([14,14,,16,16,,18,18,,,21,21,21,21,21],200,.05);W="gameOver";var a=m.u;m={update:function(){F(t,function(b){return b.clearRect(0,0,E.x,E.y)});(new K(function(){return"game over!"},{x:50,y:40})).g(t);(new K(function(){return a+" points"},{x:60,y:50})).g(t)}}}function A(a,b){return null==a||null==b?.5<Math.random():a+(b-a)*Math.random()};
