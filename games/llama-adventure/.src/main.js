!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){e.exports=n.p+"e3e70c9f1ec6f7f5b7c72c55ad386676.png"},function(e,t,n){"use strict";n.r(t);const o=e=>JSON.parse(JSON.stringify(e)),r=e=>{let t=null;return()=>t=t||e()},i={llama:{width:12,height:18,frames:3,position:0},corn:{width:9,height:20,frames:1,position:4},pepper:{width:9,height:20,frames:1,position:7},cactus:{width:14,height:24,frames:1,position:3},house:{width:20,height:19,frames:1,position:6},spikes:{width:10,height:10,frames:1,position:8},door:{width:16,height:20,frames:2,position:5},taco:{width:20,height:20,frames:1,position:9},maracas:{width:15,height:19,frames:1,position:10},sombrero:{width:13,height:8,frames:1,position:11},llamaSombrero:{width:13,height:8,frames:1,position:12}};let l=null;const s=(e,t,n,o,r=t.width,i=t.height,s=0)=>{e.drawImage(l,0,25*((0|s)%t.frames+t.position),t.width,t.height,n,o,r,i)},a=e=>i[e],c=r(()=>new Promise(e=>{(l=new Image).onload=()=>e(l),l.src=n(0)})),u=(e,t,n,o)=>{const r=new e(t*n),i={rows:t,cols:n,values:r};return f(i,(e,t)=>r[e*n+t]=o(e,t)),i},f=(e,t)=>{((e,t,n)=>{for(let o=0;o<e;o++)for(let e=0;e<t;e++)n(o,e)})(e.rows,e.cols,(n,o)=>t(n,o,h(e,n,o)))},h=(e,t,n)=>e.values[t*e.cols+n],d=(e,t,n,o)=>{e.values[t*e.cols+n]=o},p=(e,t,n)=>{for(let o=g(e)-1;o>=0;o--)for(let r=0;r<y(e);r++)h(e,o,r)===t&&d(e,o,r,n)},m=(e,t,n)=>t>=0&&n>=0&&t<e.rows&&n<e.cols,y=e=>e.cols,g=e=>e.rows,x=e=>({a:e,b:e,c:e,d:e}),w=e=>{e.a>>>=0,e.b>>>=0,e.c>>>=0,e.d>>>=0;let t=e.a+e.b|0;return e.a=e.b^e.b>>>9,e.b=e.c+(e.c<<3)|0,e.c=e.c<<21|e.c>>>11,e.d=e.d+1|0,t=t+e.d|0,e.c=e.c+t|0,(t>>>0)/4294967296},v=e=>({tiles:e}),T=e=>y(e.tiles),A=e=>g(e.tiles),E=e=>Math.floor(e/j),M=e=>Math.floor(e/j),b=(e,t,n,o=D,r=W)=>{for(let i=0;i<=o;i++)for(let o=0;o<=r;o++)if(I(e,t+i,n+o))return!0;return!1},L=(e,t,n)=>h(e.tiles,t,n),O=(e,t,n,o,r=null)=>{const i=E(t);for(let t=M(n);t<=M(o);t++)if(null===r&&I(e,t,i)||r===L(e,t,i))return!0;return!1},R=(e,t,n,o,r=null)=>{const i=M(t);for(let t=E(n);t<=E(o);t++)if(null===r&&I(e,i,t)||r===L(e,i,t))return!0;return!1},S=e=>{let t=u(Int8Array,100,300,()=>w(e)<.3?1:0),n=u(Int8Array,100,300,()=>0);for(let e=0;e<5;e++){f(n,(e,o)=>{let r=0;for(let n of[-1,0,1])for(let i of n?[-3,-2,-1,0,1,2]:[-3,-1,1,3]){const l=e+n,s=o+i;m(t,l,s)&&!h(t,l,s)||r++}const i=h(t,e,o)?r>=5:r>6;d(n,e,o,i?1:0)});let e=t;t=n,n=e}return t},I=(e,t,n)=>!m(e.tiles,t,n)||(e=>e>0)(L(e,t,n)),C=(e,t,n)=>d(e.tiles,t,n,-1),k=(e,t,n)=>Math.max(0,Math.min(255,t+w(e)*n)),P=(e,{r:t,g:n,b:o},r)=>({r:k(e,t,r),g:k(e,n,r),b:k(e,o,r)}),G=({r:e,g:t,b:n})=>`rgb(${e}, ${t}, ${n})`,U=(e,t)=>{const n=document.createElement("canvas");return n.width=j*y(e)*q,n.height=j*g(e)*q,((e,t,n)=>{const o=t.getContext("2d");o.scale(j*q,j*q);for(let t=0;t<y(e);t++){let r=2;for(let i=0;i<g(e);i++){const l=h(e,i,t);1===l?(o.fillStyle=G(r>0?P(n,{r:120,g:69,b:20},10):P(n,{r:51,g:137,b:49},15)),o.fillRect(t,i,1,1),r++):-1===l?(o.fillStyle="#69d",o.fillRect(t,i,1,1),s(o,a("spikes"),t,i,1,1),r=0):(o.fillStyle="#69d",o.fillRect(t,i,1,1),r=0)}}})(e,n,t),n},H=(e,t)=>U(e.tiles,t),q=12,N=1/q,j=10/12,F=16*N,$=20*N,D=M(1.5-N),W=E(1-N),Y=2*N,B="undefined"!=typeof document&&document.querySelector("canvas"),V=B&&B.getContext("2d");V&&(V.imageSmoothingEnabled=!1,V.textBaseline="top",V.font="10px/12px sans-serif");const _=(e,t,n)=>{if(n.position.x=t.position.x+t.speed.x,n.position.y=t.position.y+t.speed.y,e.ArrowLeft?(n.speed.x=Math.max(t.speed.x-1/120/120*20,-.05),n.left=!0):e.ArrowRight?(n.speed.x=Math.min(t.speed.x+1/120/120*20,.05),n.left=!1):t.speed.x<0?n.speed.x=Math.min(0,t.speed.x+1/120/120*20):n.speed.x=Math.max(0,t.speed.x-1/120/120*20),e.ArrowUp&&t.jumping>24&&(n.speed.y=-1/120*7),t.touchingFloor)e.ArrowUp&&(n.speed.y=-1/120*7);else{const e=120*t.jumping;n.speed.y=Math.min(1/120*8,t.speed.y+1/120/120*20/Math.max(1,e*e*e))}n.jumping=((e,t)=>t.touchingCeiling?0:t.touchingFloor&&e.ArrowUp?84:t.jumping&&e.ArrowUp?t.jumping-1:0)(e,t),n.frame=(t.frame+4/120)%(e=>i[e].frames)("llama")},K=(e,t)=>{const n=t.position.y,o=t.position.x,r=o+1-N,i=n+1.5-N,l=n+t.speed.y,s=o+t.speed.x,a=s+1,c=l+1.5;t.touchingFloor=R(e,c,o,r),t.touchingCeiling=R(e,l,o,r),(t.touchingFloor&&t.speed.y>0||t.touchingCeiling&&t.speed.y<0)&&(t.speed.y=0),t.speed.x>0&&O(e,a,n,i)&&(t.speed.x=0),t.speed.x<0&&O(e,s,n,i)&&(t.speed.x=0)},J=(e,t)=>R(e,t.position.y+1.5-Y,t.position.x+Y,t.position.x+1-2*Y,-1),z=()=>void 0,X=r(()=>"undefined"!=typeof AudioContext?new AudioContext:void 0!==window.webkitAudioContext?new window.webkitAudioContext:null),Z=r(()=>{const e=X();if(!e)return z;const t=()=>{const t=e.createGain();return t.connect(e.destination),t.gain.setValueAtTime(0,e.currentTime),t},n=e=>{const t=X().createOscillator();return t.connect(e),t.start(),t},o=[];for(let e=0;e<10;e++){const e=t();o.push({gain:e,oscillator:n(e)})}let r=0;return t=>{const n=o[r];r=(r+1)%10,t(n.oscillator,n.gain,e)}}),Q={jump:(e,t,n)=>{e.type="sine",e.frequency.setValueAtTime(392,n.currentTime),e.frequency.linearRampToValueAtTime(783.99,n.currentTime+.25),t.gain.setValueAtTime(0,n.currentTime),t.gain.linearRampToValueAtTime(1,n.currentTime+.01),t.gain.linearRampToValueAtTime(0,n.currentTime+.25)},collect:(e,t,n)=>{e.type="sine",ee.start(e,t,n),ee.play(523.25,.06,0,.02,.3),ee.play(2093,.05,0,.4,.5)},win:(e,t,n)=>{e.type="sawtooth",ee.start(e,t,n),ee.play(261.63,.1,0,.1,.5),ee.play(261.63,.05,0,.05,.5),ee.play(392,.1,0,.8,.5)},lose:(e,t,n)=>{e.type="sawtooth",ee.start(e,t,n),ee.play(155.56,.3,0,.2,.4),ee.play(146.83,.3,0,.2,.4),ee.play(138.59,.3,0,.2,.4),ee.play(130.81,.3,0,.8,.4)}},ee={currentTime:0,gain:null,oscillator:null,start(e,t,n){this.currentTime=n.currentTime,this.oscillator=e,this.gain=t},pause(e){this.currentTime+=e},play(e,t,n,o,r=1){const i=this.currentTime+t,l=i+n,s=l+o;this.oscillator.frequency.setValueAtTime(e,this.currentTime),this.gain.gain.linearRampToValueAtTime(r,i),this.gain.gain.linearRampToValueAtTime(r,l),this.gain.gain.linearRampToValueAtTime(0,s),this.currentTime=s}},te=e=>Z()(Q[e]),ne=e=>new Promise(t=>{let n=null;const o=r=>{n||(n=r),e.render&&e.render(r);const i=(r-n)/e.time,l=Math.min(1,e.from+(e.to-e.from)*i);V.fillStyle=`rgba(0, 0, 0, ${l})`,V.fillRect(0,0,B.width,B.height),r<n+e.time?requestAnimationFrame(o):t(r)};requestAnimationFrame(o)}),oe=(e,t,n,o,r)=>({label:e,x:t,y:n,width:o,height:r}),re=e=>{V.fillStyle="#444",V.fillRect(e.x,e.y,e.width,e.height),V.fillStyle="white",V.textAlign="center",V.fillText(e.label,e.x+e.width/2,e.y+5)},ie=e=>(t,n)=>{const o=B.getBoundingClientRect(),r=B.width/o.width,i=B.height/o.height,l=(t-o.left)*r,s=(n-o.top)*i;e(l,s)},le=(e,t)=>{const n=(n,o)=>{n>=e.x&&n<e.x+e.width&&o>=e.y&&o<e.y+e.height&&t()},o=(e=>{const t=ie(e);return e=>t(e.clientX,e.clientY)})(n),r=(e=>{const t=ie(e);return e=>t(e.changedTouches[0].clientX,e.changedTouches[0].clientY)})(n);return B.addEventListener("click",o),B.addEventListener("touchend",r),{remove:()=>{B.removeEventListener("click",o),B.removeEventListener("touchend",r)}}};var se=function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function l(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(l,s)}a((o=o.apply(e,t||[])).next())})};const ae=(e,t)=>{let n=!1;const o=ue(),r=oe("OKAY",135,205,50,20),i=le(r,()=>se(void 0,void 0,void 0,function*(){n=!0,i.remove(),yield ne({time:300,from:.5,to:0,render:e}),t()})),l=t=>{n||((t=>{e(t),V.fillStyle="rgba(0, 0, 0, 0.5)",V.fillRect(0,0,B.width,B.height),V.fillStyle="white",V.textAlign="center",V.fillText("HIGH SCORE",160,5),V.textAlign="left",V.fillText("NAME",36,30),V.fillText("WORLD #",112,30),V.fillText("TIME",182,30),V.fillText("SCORE",232,30);for(let e=0;e<10;e++){const t=o[e]||{name:"---",world:"---",time:"---",score:"---"};V.fillText(t.name,36,45+15*e),V.fillText(t.world,112,45+15*e),V.fillText(t.time,182,45+15*e),V.fillText(t.score,232,45+15*e)}re(r)})(t),requestAnimationFrame(l))};ne({time:300,from:0,to:.5,render:e}).then(l)},ce=(e,t)=>e.score>t.score?-1:e.score<t.score?1:e.time-t.time,ue=()=>{const e=localStorage.getItem("llama_adventure.highscore");return e?JSON.parse(e):[]};var fe=function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function l(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(l,s)}a((o=o.apply(e,t||[])).next())})};const he=({lastGame:e,renderGame:t})=>{let n=!1;const o=Math.floor(e.time),r=1===e.status?Math.floor(900*(Math.PI/2+Math.atan((100-o)/100))):0,i=e.score+r,l=i>0&&ue().filter(e=>ce(e,{score:i,time:o})<=0).length<9,s=[];let a=localStorage.getItem("llama_adventure.name")||"";const c="A".charCodeAt(0),u="Z".charCodeAt(0),f=e=>{a.length<10&&(a+=e)},h=()=>a=a.slice(0,-1),d=e=>{const t=e.key.toUpperCase();1===t.length&&t.charCodeAt(0)>=c&&t.charCodeAt(0)<=u?f(t):" "===t?f(" "):"BACKSPACE"===t&&h()};if(l){document.addEventListener("keydown",d);for(let e=0;e<=u-c;e++){const t=String.fromCharCode(c+e),n=oe(t,22+e%11*25,125+25*Math.floor(e/11),20,20);s.push({button:n,listener:le(n,()=>f(t))})}const e=oe("SPACE",122,175,45,20);s.push({button:e,listener:le(e,()=>f(" "))});const t=oe("←",172,175,20,20);s.push({button:t,listener:le(t,h)})}const p=oe("OKAY",135,205,50,20),m=le(p,()=>fe(void 0,void 0,void 0,function*(){n=!0,m.remove(),s.forEach(({listener:e})=>e.remove()),document.removeEventListener("keydown",d),localStorage.setItem("llama_adventure.name",a),(e=>{const t=ue().concat([e]).sort(ce).slice(0,10);localStorage.setItem("llama_adventure.highscore",JSON.stringify(t))})({score:i,name:a,world:e.level.id,time:o}),yield ne({time:300,from:.5,to:0,render:t}),ae(t,()=>lt({lastGame:e}))})),y=o=>{n||(t(),V.fillStyle="rgba(0, 0, 0, 0.5)",V.fillRect(0,0,B.width,B.height),V.fillStyle="white",V.textAlign="center",V.fillText("SCORE",160,15),V.textAlign="left",V.fillText("COLLECTED ITEMS",70,35),r&&V.fillText("TIME BONUS",70,50),V.fillText("TOTAL",70,75),V.textAlign="right",V.fillText(e.score,240,35),r&&V.fillText(r,240,50),V.fillText(i,240,75),re(p),l&&(V.textAlign="left",V.fillText(`ENTER YOUR NAME: ${a}_`,70,105),s.forEach(({button:e})=>re(e))),requestAnimationFrame(y))};ne({time:300,from:0,to:.5,render:t}).then(y)},de=e=>{const t=M(e.y),n=E(e.x);return{rowTop:t,rowHeight:M(e.y+1.5-N)-t,colLeft:n,colWidth:E(e.x+1-N)-n}},pe=(e,t)=>e.rowTop===t.rowTop&&e.rowHeight===t.rowHeight&&e.colLeft===t.colLeft&&e.colWidth===t.colWidth,me=e=>[e.rowTop,e.rowHeight,e.colLeft,e.colWidth].join(","),ye=r(()=>{const e=new Map;let t={position:{x:0,y:0},speed:{x:0,y:0},left:!1,jumping:0,touchingFloor:!1,touchingCeiling:!1,frame:0},n={position:{x:0,y:0},speed:{x:0,y:0},left:!1,jumping:0,touchingFloor:!1,touchingCeiling:!1,frame:0};const o=Math.sqrt(2*j/(1/120/120*20)),r={ArrowUp:!1,ArrowRight:!1,ArrowLeft:!1};for(let i=0;i<498;i+=18)for(let l=498;l>=i;l-=18)for(let s=l;s<498;s+=18)for(let a=s;a<498;a+=18)for(let c=0;c<=o+18;c+=18)for(let o=1;o<=168;o*=2){t.position.x=0,t.position.y=0,t.touchingFloor=!0,t.speed.x=0,t.speed.y=0;const u=[];let f=de(t.position);for(let e=0;e<480&&(e<=c+1||t.position.y<0);e++){r.ArrowUp=e>=c&&e<c+o,r.ArrowRight=e>=i&&e<l,r.ArrowLeft=e>=s&&e<a,t.touchingFloor=t.position.y>=0,_(r,t,n);const h=t;t=n,n=h;const d=de(t.position);pe(d,f)||(u.push(d),f=d)}let h=e;for(let e of u){const t=me(e);h.has(t)||h.set(t,{box:e,sequence:new Map}),h=h.get(t).sequence}}const i=[],l=(e,t)=>{for(let n of e.values()){const e=t.concat(n.box);i.push(e),i.push(e.map(e=>({rowTop:e.rowTop,rowHeight:e.rowHeight,colLeft:1-e.colLeft-e.colWidth,colWidth:e.colWidth}))),l(n.sequence,e)}};return l(e,[]),i}),ge=(e,t)=>t[Math.floor(w(e)*t.length)],xe=e=>({x:e.col*j,y:e.row*j}),we=(e,t)=>{const n=t.map(e=>e.col).sort(),o=n[Math.ceil(n.length/2)],r=t.filter(({col:e})=>e<o),i=t.filter(({col:e})=>e>=o),l=w(e)<.5,s=l?r:i,a=l?i:r;let c=null;for(let t=0;t<10;t++){const t=ge(e,s),n=ge(e,a),o=t.row-n.row,r=t.col-n.col,i=o*o+r*r;(null===c||i>c.distance2)&&(c={entrance:t,exit:n,distance2:i})}return{entrance:xe(c.entrance),exit:xe(c.exit)}},ve=(e,t,n)=>{const o=Te[e],r=a(o.sprite);return{position:{x:t,y:n},score:o.score,sprite:o.sprite,width:r.width*N,height:r.height*N}},Te=[{sprite:"corn",score:3,frequency:220},{sprite:"pepper",score:15,frequency:55},{sprite:"cactus",score:25,frequency:25},{sprite:"taco",score:50,frequency:10},{sprite:"sombrero",score:100,frequency:2},{sprite:"maracas",score:300,frequency:.5}],Ae=r(()=>Te.reduce((e,t)=>t.frequency+e,0)),Ee=e=>{let t=w(e);for(let e=Te.length-1;e>0;e--){const n=Te[e].frequency/Ae();if(t<n)return e;t-=n}return 0},Me=(e,t)=>{const n=[];for(let o=0;o<t.length;o+=5){const r=t[Math.floor(o)];n.push(ve(Ee(e),r.col*j,r.row*j))}return n.sort((e,t)=>e.position.x-t.position.x)},be=e=>{e=Math.floor(e);const t=x(e),n=v(S(t)),o=(e=>{const t=[[de({x:j,y:0})],[de({x:-j,y:0})],[de({x:0,y:-j}),de({x:j,y:-j})],[de({x:0,y:-j}),de({x:-j,y:-j})],...ye()],n=new Map,o=e=>`${e.rowTop},${e.colLeft}`;for(let e of t)for(let t of e){const r=o(t);n.has(r)||n.set(r,{row:t.rowTop,col:t.colLeft,movements:new Set}),n.get(r).movements.add(e)}let r=0;const i=u(Int16Array,A(e),T(e),(t,n)=>b(e,t,n)?-1:-2);for(let t=0;t<y(i);t++){let n=!1;for(let o=g(i)-1;o>=0;o--){const r=b(e,o,t);!r&&n&&d(i,o,t,0),n=r}}for(let t=0;t<g(i);t++)for(let o=0;o<y(i);o++){if(0!==h(i,t,o))continue;const l=++r,s=[{row:t,col:o}];for(d(i,t,o,l);s.length>0;){const t=s.pop();for(let o of n.values()){const n=t.row+o.row,r=t.col+o.col;if(!m(i,n,r))continue;const a=h(i,n,r);if(-1!==a&&(-2!==a&&a!==l))e:for(let c of o.movements.values())for(let o of c){const c=t.row+o.rowTop,u=t.col+o.colLeft;if(b(e,c,u,o.rowHeight,o.colWidth))break;if(c===n&&u===r){if(a>0){p(i,a,l);break e}d(i,n,r,l),s.push({row:n,col:r});break e}}}}}const l=new Map;return f(i,(e,t,n)=>{n<=0||(l.has(n)||l.set(n,[]),l.get(n).push({row:e,col:t}))}),[...l.values()].sort((e,t)=>t.length-e.length)})(n),r=(e=>{let t=0;const n={},o=u(Int8Array,A(e),T(e),(t,n)=>b(e,t,n)?-1:0);return f(o,(e,r)=>{if(h(o,e,r))return;const i=++t;let l=1;const s=[{row:e,col:r}];for(d(o,e,r,i);s.length>0;){const e=s.pop();for(let t of[-1,0,1])for(let n of t?[0]:[-1,1]){const r=e.row+t,a=e.col+n;m(o,r,a)&&!h(o,r,a)&&(s.push({row:r,col:a}),d(o,r,a,i),l++)}}n[i]=l}),{map:o,biggest:parseInt(Object.keys(n).sort((e,t)=>n[t]-n[e])[0])}})(n),i=o.filter(e=>e.length>=100),l=new Map;i.forEach(e=>{const{row:t,col:n}=e[0],o=h(r.map,t,n);l.has(o)||l.set(o,[]),l.get(o).push(e)});const s=[];for(let[e,n]of l)for(let e of n)s.push(we(t,e));const a=s[0].entrance,c=s[s.length-1].exit;c.y+=N;const w=i.reduce((e,t)=>e.concat(t)),E=[];for(let e=0;e<s.length-1;e++){const t=s[e],n=s[e+1],o={position:t.exit,other:null},r={position:n.entrance,other:o};o.other=r,E.push(o,r)}for(let e of o.filter(e=>e.length<100))for(let t of e){const e=t.row+D+1;for(let o=W;o>=0;o--){const r=t.col+o;I(n,e,r)&&C(n,e-1,r)}}return{id:e,map:n,items:Me(t,w),surfaces:o,regions:r,player:a,goal:c,doors:E,randomizer:t}},Le=r(()=>{const e=Math.round(8),t=Math.round(24),n=u(Int8Array,32,200,(n,o)=>((n,o)=>n<e||n>=t||o<1||o>=199)(n,o)?1:0),o=(e,t,n)=>{for(let o=e;o<=t;o++)n(o)};d(n,23,29,1),o(20,23,e=>d(n,e,48,1)),o(0,7,e=>{d(n,23,97-e,1),d(n,23,103+e,1)}),o(0,3,e=>{d(n,22,97-e,1),d(n,22,103+e,1)}),o(98,102,e=>d(n,23,e,-1)),o(8,23,e=>d(n,e,137,1));const r=v(n),i=32*j*3/4-1.5,l={position:{x:120,y:i-2*N},other:null},s={position:{x:100,y:i-2*N},other:l};return l.other=s,{id:-1,map:r,surfaces:null,regions:null,player:{x:5,y:i},goal:{x:200*j-10,y:i-N},doors:[s,l],items:[ve(0,52,i),ve(1,60,i),ve(2,68,i)],randomizer:x(0)}});var Oe=function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function l(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(l,s)}a((o=o.apply(e,t||[])).next())})};const Re=({lastGame:e,renderGame:t})=>{const n=document.querySelector("#share");let o=!1;const r=-1===e.level.id,i=oe("OKAY",70,140,48,20),l=oe("SHARE THIS LEVEL",128,140,115,20);let s=!1;const a=()=>{n.value=`${location.origin}${location.pathname}${location.search}#${e.level.id}`,n.select(),document.execCommand("copy"),setTimeout(()=>s=!1,3e3),s=!0};r||(n.classList.add("is-visible"),n.value=location.href,n.style.left=`${100*l.x/320}%`,n.style.width=`${100*l.width/320}%`,n.style.top=`${100*l.y/240}%`,n.style.height=`${100*l.height/240}%`,n.addEventListener("click",a),n.addEventListener("touchend",a));const c=le(i,()=>Oe(void 0,void 0,void 0,function*(){o=!0,c.remove(),n.classList.remove("is-visible"),n.removeEventListener("click",a),n.removeEventListener("touchend",a),r?(yield ne({time:500,from:.5,to:1,render:t}),lt()):(yield ne({time:500,from:.5,to:0,render:t}),he({lastGame:e,renderGame:t}))})),u=()=>{o||(t(),V.fillStyle="rgba(0, 0, 0, 0.5)",V.fillRect(0,0,B.width,B.height),V.fillStyle="white",V.textAlign="left",1===e.status?(V.fillText("CONGRATULATIONS!",70,60),V.fillText("YOU ARRIVED HOME SAFELY AND",70,90),V.fillText("BROUGHT YOUR ITEMS BACK.",70,110)):(V.fillText("OUCH!",70,60),V.fillText("YOU DIDN'T MANAGE",70,90),V.fillText("TO COME BACK HOME.",70,110)),s&&V.fillText("COPIED TO CLIPBOARD",70,165),re(i),r||re(l),requestAnimationFrame(u))};u()},Se=Math.floor(120),Ie=Math.floor(120),Ce=e=>{const t=e.player.current.position;let n=null;for(let o of e.level.doors)o.position.x+F<t.x+1||o.position.x>t.x||o.position.y+$<t.y+1.5||o.position.y>t.y||(n=o);if(!n||e.tunnel&&n===e.tunnel.door){if(e.tunnel&&(e.tunnel.transitionTime=Math.max(0,e.tunnel.transitionTime-1),n||3===e.tunnel.state||(e.tunnel.state=3,e.tunnel.transitionTime=Se-e.tunnel.transitionTime),0===e.tunnel.transitionTime))switch(e.tunnel.state){case 0:e.tunnel.state=1,e.playerLocked=!0,e.tunnel.transitionTime=Ie,e.player.current.speed.x=0,e.player.current.speed.y=0;break;case 1:t.x=e.tunnel.door.other.position.x+(F-1)/2,t.y=e.tunnel.door.other.position.y+$-1.5-N,e.tunnel.door=e.tunnel.door.other,e.tunnel.state=2,e.tunnel.transitionTime=Ie;break;case 2:e.tunnel.state=3,e.tunnel.transitionTime=Se,e.playerLocked=!1;break;case 3:e.tunnel=null}}else e.tunnel=(e=>({door:e,state:0,transitionTime:Se}))(n)};var ke=function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function l(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(l,s)}a((o=o.apply(e,t||[])).next())})};const Pe=({pausedGame:e,gameLoop:t,renderGame:n})=>{let o=!1;const r=oe("CONTINUE",80,140,75,20),i=oe("EXIT GAME",165,140,75,20),l=()=>(o=!0,s.remove(),a.remove(),ne({time:500,from:.5,to:0,render:n})),s=le(r,()=>l().then(t)),a=le(i,()=>ke(void 0,void 0,void 0,function*(){yield l(),yield ne({render:n,from:0,to:.5,time:2e3}),Re({lastGame:e,renderGame:n})})),c=()=>{o||(n(),V.fillStyle="rgba(0, 0, 0, 0.5)",V.fillRect(0,0,B.width,B.height),V.fillStyle="white",V.textAlign="center",V.fillText("GAME PAUSED",160,115),re(r),re(i),requestAnimationFrame(c))};c()},Ge=r(()=>{const e={ArrowUp:!1,ArrowRight:!1,ArrowLeft:!1,Escape:!1},t={arrowup:"ArrowUp",arrowleft:"ArrowLeft",arrowright:"ArrowRight",escape:"Escape",w:"ArrowUp",a:"ArrowLeft",d:"ArrowRight"},n=t=>e[t]=!0,o=t=>e[t]=!1,r=e=>n=>{const o=t[n.key.toLowerCase()];o&&e(o)};document.addEventListener("keydown",r(n)),document.addEventListener("keyup",r(o));if((()=>{try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}})()){document.body.classList.add("touch");const t=e=>t=>{t.target.classList.add("is-active"),e(t)},r=e=>t=>{t.target.classList.remove("is-active"),e(t)},i=t=>n=>{n.preventDefault();const o=n.target.getAttribute("data-touch-key");o in e&&t(o)};document.addEventListener("touchstart",t(i(n))),document.addEventListener("touchend",r(i(o)))}return e});var Ue=function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function l(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(l,s)}a((o=o.apply(e,t||[])).next())})};const He=e=>{V.save(),V.scale(1/q,1/q),V.drawImage(e.renderedMap,0,0),V.restore(),(e=>{for(let t of e.level.doors){if(!e.tunnel||e.tunnel.door!==t){s(V,a("door"),t.position.x,t.position.y,F,$);continue}V.fillStyle="black",V.fillRect(t.position.x,t.position.y,F,$);const n=e.tunnel.state;let o;1===n||2===n?o=Math.PI:(o=Math.PI*e.tunnel.transitionTime/Se,0===n&&(o=Math.PI-o)),V.fillStyle="#876543";const r=2*N*Math.sin(o),i=Math.cos(o)*F,l=i>0?0:1;V.fillRect(t.position.x+i+r*l,t.position.y,r*(1-2*l),$),V.save(),V.translate(t.position.x+r*l,t.position.y),V.scale(i,1),s(V,a("door"),0,0,1,$),V.restore()}})(e);const t=a("house");s(V,t,e.level.goal.x,e.level.goal.y,t.width*N,t.height*N);for(let t=e.collectedItems.length-1;t>=0;t--)if(!e.collectedItems[t]){const n=e.level.items[t];s(V,a(n.sprite),n.position.x,n.position.y,n.width,n.height)}((e,t)=>{if(V.save(),V.translate(e.position.x,e.position.y),e.left&&(V.translate(1,0),V.scale(-1,1)),s(V,a("llama"),0,0,1,1.5,e.frame),t){const t=a("llamaSombrero");s(V,t,2*N,(-3-Math.floor(e.frame))*N,t.width*N,t.height*N)}V.restore()})(e.player.current,e.sombrero&&(!e.tunnel||3===e.tunnel.state||0===e.tunnel.state)),(e=>{if(!e.tunnel||0===e.tunnel.state||3===e.tunnel.state)return;let t=e.tunnel.transitionTime/Ie;1===e.tunnel.state&&(t=1-t),V.fillStyle=`rgba(0, 0, 0, ${t})`,V.fillRect(e.tunnel.door.position.x,e.tunnel.door.position.y,F,$)})(e)},qe=()=>{V.translate(160,120)},Ne=()=>{V.scale(q,q)},je=e=>{V.translate(-e.player.current.position.x-.5,-e.player.current.position.y-.75)},Fe=e=>{V.fillStyle="white",V.textAlign="left",V.fillText(`SCORE: ${e.score}`,5,5),V.fillText(`TIME: ${Math.floor(e.time)}`,5,15),V.textAlign="right",V.fillText(-1===e.level.id?"TUTORIAL":`WORLD #${e.level.id}`,315,5)},$e=e=>{V.clearRect(0,0,B.width,B.height),V.save(),qe(),Ne(),je(e),He(e),V.restore(),Fe(e)},De=e=>((e,t)=>{const n=e.x-t.x,o=e.y-t.y;return n*n+o*o})(e.player.current.position,e.level.goal)<2.25,We=e=>{const t=e.level.items,n=e.player.current.position,o=n.x-2,r=n.x+2;let i=0,l=t.length-1;for(;i<l;){const e=Math.floor((i+l+1)/2);if(t[e].position.x>r)l=e-1;else if(i=e,t[e].position.x===r)break}for(let r=i;r>=0&&r<t.length&&t[r].position.x>=o;r--){const o=t[r];e.collectedItems[r]||(o.position.x+o.width<n.x||o.position.x>n.x+1||o.position.y+o.height<n.y||o.position.y>n.y+1.5||(te("collect"),e.collectedItems[r]=!0,e.score+=o.score,"sombrero"===o.sprite&&(e.sombrero=!0)))}},Ye={ArrowUp:!1,ArrowLeft:!1,ArrowRight:!1},Be=(e,t)=>{for(let n=0;n<t;n++){We(e),Ce(e),_(e.playerLocked?Ye:Ge(),e.player.current,e.player.next),K(e.level.map,e.player.next),2!==e.status&&J(e.level.map,e.player.next)&&(e.status=2,te("lose")),e.player.current.speed.y>=0&&e.player.next.speed.y<0&&te("jump");let t=e.player.next;e.player.next=e.player.current,e.player.current=t,1!==e.status&&De(e)&&(e.status=1,te("win"))}e.time+=t/120},Ve=e=>{const t={position:{x:0,y:0},speed:{x:0,y:0},left:!1,jumping:0,touchingFloor:!1,touchingCeiling:!1,frame:0};return t.position=o(e.player),{player:{current:t,next:o(t)},level:e,renderedMap:H(e.map,o(e.randomizer)),collectedItems:e.items.map(()=>!1),score:0,status:0,tunnel:null,playerLocked:!1,sombrero:!1,time:0}},_e=(e,t=Be,n=$e)=>Ue(void 0,void 0,void 0,function*(){document.body.classList.add("is-playing");const o=((e,t,n)=>{let o=0;return r=>{if(0===e.status){const n=Math.floor(r/(1e3/120));t(e,Math.min(120,n-o)),o=n}n(e)}})(e,t,n),r=((e,t,n)=>{let o=!1;const r=i=>{if(t(i),o&&!Ge().Escape){ne({render:()=>n(e),from:0,to:.5,time:500}).then(()=>Pe({pausedGame:e,gameLoop:r,renderGame:()=>n(e)}))}else if(0===e.status)window.requestAnimationFrame(r);else{document.body.classList.remove("is-playing");const t=()=>n(e);ne({render:t,from:0,to:.5,time:2e3}).then(()=>Re({lastGame:e,renderGame:t}))}o=Ge().Escape};return r})(e,o,n);yield ne({render:o,from:1,to:0,time:2e3}).then(r)});var Ke=function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function l(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(l,s)}a((o=o.apply(e,t||[])).next())})};let Je=null,ze=null,Xe=1;const Ze=e=>{ze.get(e.data.jobId).resolve(e.data.response)},Qe=(e,...t)=>Je?new Promise(n=>{const o=Xe++;ze.set(o,{resolve:n}),Je.postMessage({jobId:o,job:e,params:t})}):tt({job:e,params:t}),et=e=>Qe(1,e),tt=(()=>{const e=new Map;return e.set(0,()=>{ye()}),e.set(1,be),({job:t,params:n})=>e.get(t)(...n)})();var nt=function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function l(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(l,s)}a((o=o.apply(e,t||[])).next())})};const ot=(e,t=null)=>nt(void 0,void 0,void 0,function*(){let n=!1;const o=["",".","..","..."],r=e=>{V.clearRect(0,0,B.width,B.height),V.fillStyle="white";const t=o[Math.floor(e/500)%o.length];V.textAlign="left",V.fillText(`LOADING${t}`,135,110);const n=a("llama"),r=Math.floor(e/300)%n.frames;s(V,n,(320-n.width)/2,125,n.width,n.height,r)},i=e=>{n||(r(e),requestAnimationFrame(i))};t&&(yield ne({render:t,from:0,to:1,time:500})),yield c(),yield ne({render:r,from:1,to:0,time:500}),requestAnimationFrame(i);const l=yield e;return n=!0,yield ne({render:r,from:0,to:1,time:500}),l});var rt=function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function l(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(l,s)}a((o=o.apply(e,t||[])).next())})};var it=function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function l(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(l,s)}a((o=o.apply(e,t||[])).next())})};const lt=({lastGame:e}={lastGame:void 0})=>{let t=!1;const n=x(Math.floor(1e6*Math.random())),o=U(S(n),n);let r=-o.width/2,i=-o.height/2,l=Math.random()*Math.PI*2,s=30*Math.cos(l),a=30*Math.sin(l),c=null;const u=parseInt(location.hash.replace("#",""));history.replaceState(null,document.title,`${location.pathname}${location.search}`);const f=e=>{const t=null===c?0:(e-c)/1e3;c=e,V.clearRect(0,0,B.width,B.height),V.save(),V.translate(r,i),V.drawImage(o,0,0),V.restore(),i+=a*t,((r+=s*t)+s>0||r+s<320-o.width)&&(s=-s),(i+a>0||i+a<240-o.height)&&(a=-a)},h=e=>{f(e),V.fillStyle="rgba(0, 0, 0, 0.5)",V.fillRect(0,0,B.width,B.height),V.fillStyle="white",V.textAlign="center",V.font="16px/20px sans-serif",V.fillText("LLAMA ADVENTURE",160,50),V.font="10px/12px sans-serif",V.textAlign="right",V.fillText("CREATED BY THIAGO ROMÃO BARCALA",310,225),y.forEach(({button:e})=>re(e))},d=()=>{t=!0,y.forEach(({listener:e})=>e.remove())},p=e=>it(void 0,void 0,void 0,function*(){d();const t=yield ot(e,h);_e(t)}),m=[{label:"PLAY GAME",handler:()=>{const e=Number.isNaN(u)||u<0||u>999999?999999*Math.random():u;p(et(e).then(Ve))}},{label:"SELECT WORLD",handler:()=>{d(),(e=>{let t=!1;const n=[];let o=0;const r=e=>{const t=10*o+e;t<=999999&&(o=t)},i=()=>o=Math.floor(o/10),l=e=>{/^[0-9]$/.test(e.key)&&r(parseInt(e.key)),"Backspace"===e.key&&i()};document.addEventListener("keydown",l);for(let e=0;e<=9;e++){const t=e,o=oe(t,25+25*e,125,20,20);n.push({button:o,listener:le(o,()=>r(t))})}const s=oe("←",275,125,20,20);n.push({button:s,listener:le(s,i)});const a=t=>{e(t),V.fillStyle="rgba(0, 0, 0, 0.5)",V.fillRect(0,0,B.width,B.height),V.fillStyle="white",V.textAlign="center",V.fillText("SELECT WORLD",160,15),V.textAlign="left",V.textAlign="left",V.fillText(`ENTER THE WORLD NUMBER: ${o}_`,70,105),n.forEach(({button:e})=>re(e)),re(c)},c=oe("OKAY",135,205,50,20),u=le(c,()=>rt(void 0,void 0,void 0,function*(){t=!0,u.remove(),n.forEach(({listener:e})=>e.remove()),document.removeEventListener("keydown",l),_e(yield ot(et(o).then(Ve),a))})),f=e=>{t||(a(e),requestAnimationFrame(f))};ne({time:300,from:0,to:.5,render:e}).then(f)})(f)}},{label:"TUTORIAL",handler:()=>p(Promise.resolve((()=>{const e=Ve(Le()),t=e.renderedMap.getContext("2d");return t.font="10px/12px sans-serif",t.fillStyle="white",t.resetTransform(),t.textAlign="left",t.fillText('← OR "A" TO MOVE LEFT',20,140),t.fillText('→ OR "D" TO MOVE RIGHT',20,155),t.fillText("CONTINUE TO THE RIGHT →",20,180),t.fillText('↑ OR "W" TO JUMP',250,180),t.fillText('HOLD ↑ OR "W" TO JUMP HIGHER',400,180),t.fillText("COLLECT YOUR ITEMS",600,150),t.fillText("AND BRING THEM BACK HOME",600,170),t.fillText("AVOID SPIKES!",970,190),t.fillText("STAY IN FRONT OF THE DOOR...",1150,190),t.fillText("AND IT WILL TAKE YOU SOMEWHERE ELSE",1400,190),t.fillText("YOU CAME BACK HOME!",1720,150),e})()))},{label:"HIGH SCORE",handler:()=>it(void 0,void 0,void 0,function*(){t=!0,yield ne({render:f,from:.5,to:0,time:500}),ae(f,()=>{t=!1,w()})})}];e&&m.unshift({label:"REPLAY GAME",handler:()=>p(Promise.resolve(Ve(e.level)))});const y=m.map((e,t)=>{const n=oe(e.label,110,80+25*t,100,20);return{button:n,listener:le(n,e.handler)}}),g=e=>{t||(h(e),requestAnimationFrame(g))},w=()=>{ne({time:300,from:0,to:.5,render:f}).then(g)};w()};var st=function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function l(e){try{a(o.next(e))}catch(e){i(e)}}function s(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(l,s)}a((o=o.apply(e,t||[])).next())})};(()=>st(void 0,void 0,void 0,function*(){if("undefined"!=typeof document){c(),Je=new Worker(document.querySelector("script").src),ze=new Map,Je.addEventListener("message",Ze),(()=>Qe(0))();const e=document.getElementById("container"),t=()=>{X().resume(),e.removeEventListener("click",t),e.removeEventListener("touchend",t)};e.addEventListener("click",t),e.addEventListener("touchend",t),lt()}else self.addEventListener("message",e=>Ke(void 0,void 0,void 0,function*(){const t=e.data.jobId,n=yield tt(e.data);self.postMessage({jobId:t,response:n},[])}))}))()}]);