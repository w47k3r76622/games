<!doctype html><meta charset=utf-8><title>RANGER DOWN</title><style>body{background:#000;margin:0;overflow:hidden}#c{background:#000;display:block;margin:auto;image-rendering:-moz-crisp-edges;image-rendering:pixelated;width:100vmin;height:100vmin;filter:contrast(80%) brightness(95%)}#c.i{filter:contrast(60%) brightness(30%) sepia(60%) saturate(666%) hue-rotate(190deg)}#c.g{filter:contrast(80%) brightness(80%) sepia(60%) saturate(666%) hue-rotate(71deg)}#c.a{filter:contrast(90%) brightness(80%) sepia(60%) saturate(999%) hue-rotate(345deg)}</style><body><canvas id=c></canvas><script>let s=()=>{let e=e=>new Promise(t=>{let s=new Image;s.onload=(()=>t(s)),s.src=e}),t=e=>e[s(e.length)],s=(e,t=0)=>~~(Math.random()*e)+t,o=e=>e.slice().sort(()=>s(3)-1),n=(e,t)=>Math.max(e,t)-Math.min(e,t),r=([e,t])=>[[e-1,t],[e+1,t],[e,t-1],[e,t+1]],h=([e,t])=>[[e-1,t],[e+1,t],[e,t-1],[e,t+1],[e-1,t-1],[e+1,t-1],[e-1,t+1],[e+1,t+1]],a=(e,t,s)=>r(t).filter(t=>e[t[1]][t[0]]===s),l=([e,t],[s,o])=>Math.hypot(n(e,s),n(t,o)),u=(e,t)=>{let s,o=25600;for(let n=0;n<t.length;n++){let r=l(e,t[n]);r<o&&(o=r,s=t[n])}return s},g=(e,t)=>t.slice().sort((t,s)=>l(e,t)-l(e,s)),p=e=>{let t=[],s=[];for(let o=0;o<e.length;o++){let[n,r]=e[o];s[160*r+n]||(t.push(e[o]),s[160*r+n]=1)}return t},i=([e,t],s)=>{let o=[],n=[[e,t,0]],h=[],a=([e,t,a])=>{R([e,t])&&s([e,t])&&(h[160*t+e]||(o.push([e,t,a]),h[160*t+e]=1,n.push(...r([e,t]).map(([e,t])=>[e,t,a+1]))))};for(;n.length;)a(n.shift());return o},d=([e,t],[s,o])=>{let r=n(e,s),h=n(t,o),a=e,l=t;return r>h&&(s>e&&(a=e+1),e>s&&(a=e-1)),h>r&&(o>t&&(l=t+1),t>o&&(l=t-1)),[a,l]},f=([e,s],[o,n],h=R,a=.66)=>{let l=[],c=[],u=([e,s])=>{c[160*s+e]||(l.push([e,s]),c[160*s+e]=1),e===o&&s===n||u(Math.random()<a?t(r([e,s]).filter(h))||[e,s]:d([e,s],[o,n]))};return u([e,s]),l},m=(e,s=8448)=>{let o=e.slice(),n=[];for(let e=0;e<o.length;e++){let[t,s]=o[e];n[160*s+t]=1}for(;o.length<s;){let[e,s]=t(o),h=r([e,s]);if(h.length){let[e,s]=t(h);n[160*s+e]||(o.push([e,s]),n[160*s+e]=1)}}return o},S=e=>[3===e?20:1===e?140:s(120,20),0===e?20:2===e?140:s(120,20)],I=()=>[s(120,20),s(120,20)],E=e=>{let t=160,s=[0,0];for(let o=0;o<e.length;o++){let[n,r]=e[o];n<t&&(t=n,s=[n,r])}return s},N=(e,[t,s])=>{for(let o=0;o<e.length;o++)if(e[o][0]===t&&e[o][1]===s)return!0;return!1},R=([e,t])=>e>=0&&e<=159&&t>=0&&t<=159,O=([e,t])=>e>=8&&e<=152&&t>=8&&t<=152,w=()=>{let e=[];for(let t=0;t<160;t++){let t=[];for(let e=0;e<160;e++)t.push(1);e.push(t)}return e},T=(e,t,s)=>{for(let o=0;o<t.length;o++){let[n,r]=t[o];e[r][n]=s([n,r])}},y=e=>{let t=0;let n=o([0,3,6,9]);for(let o=0;o<160;o++)for(let r=0;r<160;r++)if(1===e[o][r]){let h=i([r,o],([t,s])=>1===e[s][t]);let a=0;h.length>5&&(a=t<4?n[t]:s(10),t++),T(e,h,a<3?()=>s(9)+2:a<6?()=>s(3)?s(4)+11:s(9)+2:a<9?()=>s(4)?s(3)+31:s(9)+2:()=>0)}},C=e=>{for(let t=0;t<160;t++)for(let o=0;o<160;o++)if(2===e[t][o]){a(e,[o,t],0).length?e[t][o]=s(3)+17:e[t][o]=s(13)+2}},k=e=>e<2||e>=11&&e<15||20===e||27===e||24===e||25===e||26===e||21===e||22===e||23===e||e>=28&&e<31||e>=31&&e<34||36===e||44===e||43===e||34===e,A=[];A[0]=[0,"s.png"],A[1]=[1,["Lost contact with","RANGER. Take boat","and investigate."]],A[2]=[1,["Sunrise"]],A[3]=[1,["Sunset"]],A[8]=[1,["I should","investigate"]],A[9]=[2,["Sleep?",""],[["Yes",11],["No",-1]],0,"g"],A[10]=[1,["I'm not tired!"]],A[11]=[4,0],A[12]=[1,["I'm hungry!"]],A[13]=[1,["You died","","GAME OVER!"]],A[14]=[1,["It's RANGER!","","RANGER is DEAD!","","Found 1 keycard","Found 5 food","Found 3 chips","Found 2 backups"]],A[15]=[1,["It's locked!"]],A[16]=[2,["It's locked!","","Use keycard?",""],[["Yes",17],["No",-1]],0,"g"],A[17]=[4,1],A[18]=[2,["Search ruins?","","1 hour",""],[["Yes",19],["No",-1]],0,"g"],A[19]=[4,2],A[21]=[4,3],A[23]=[4,4],A[26]=[4,5],A[27]=[4,6],A[28]=[4,7],A[29]=[4,8],A[30]=[4,9],A[31]=[4,10],A[33]=[2,["RSOS v3.27","--------------------","NOTES ENTRY 1","","RANGER:","Sent to investigate","ruins. Found strange","technology"],[],0,"a"],A[34]=[2,["RSOS v3.27","--------------------","NOTES ENTRY 2","","RANGER:","Was testing strange","technology. Portals","appeared!"],[],0,"a"],A[35]=[2,["RSOS v3.27","--------------------","NOTES ENTRY 3","","RANGER:","Monsters coming out","of portals! Made it","back to hut. They","only come out at","night"],[],0,"a"],A[36]=[2,["RSOS v3.27","--------------------","NOTES ENTRY 4","","RANGER:","Monsters affecting","computers. Have been","stashing items in","ruins for emergency.","Tried comms but the","satellite is offline"],[],0,"a"],A[37]=[2,["RSOS v3.27","--------------------","NOTES ENTRY 5","","RANGER:","Programmed synth to","make mod chips that","can shut down portal","but computer went","offline! There are","more of them every","night"],[],0,"a"],A[38]=[2,["RSOS v3.27","--------------------","NOTES ENTRY 6","","RANGER:","Got computer online.","Still has errors.","Comms are badly","damaged"],[],0,"a"],A[39]=[2,["RSOS v3.27","--------------------","NOTES ENTRY 7","","RANGER:","Rigged comms to send","distress signal but","satellite offline.","Synth can make chip","to fix it"],[],0,"a"],A[40]=[2,["RSOS v3.27","--------------------","NOTES ENTRY 8","","RANGER:","Must disable portals","before send distress","signal, no way to","warn rescue team","about monsters","with comms offline"],[],0,"a"],A[41]=[4,11],A[42]=[4,12],A[43]=[4,13],A[44]=[4,14],A[45]=[4,15];let F=e=>{let t=K[0]()[6],s=K[0]()[7];c.className=t,c.width=c.height=160,3===s[0]&&(L(e),$()),0===s[0]&&"s.png"===s[1]&&(D.drawImage(U,0,0),D.drawImage(B,64,0,16,16,72,72,16,16),v("Js13kGames OFFLINE",1,16),v("C2018 Nik Coughlin",1,18)),1===s[0]&&Y(s[1]),2===s[0]&&G(s),5===s[0]&&b(),requestAnimationFrame(F)},M=(e="",t=0,s=0)=>D.drawImage(P,8*(e.charCodeAt(0)-32),0,8,8,8*t,8*s,8,8),v=(e="",t=0,s=0)=>{for(let o=0;o<e.length;o++)M(e[o],t+o,s)},Y=e=>{let t=~~((20-e.length)/2);for(let s=0;s<e.length;s++){let o=~~((20-e[s].length)/2);v(e[s],o,t+s)}},G=e=>{for(let t=0;t<e[1].length;t++)v(e[1][t],0,t);v("<X>",17,0);let t=e[1].length%2?1:0;for(let s=0;s<e[2].length;s++)v(`${s+1} ${s===e[3]?"<":" "}${e[2][s][0]}${s===e[3]?">":" "}`,0,2*s+e[1].length+t)},L=e=>{let t=~~(e/500)%2?0:1,s=K[0]()[8],o=K[0]()[7],n=o[3],r=o[1],h=o[2],a=o[4],l=o[5],c=o[6],u=K[0]()[2],g=K[0]()[0],p=K[0]()[16],i=K[0]()[12],d=K[0]()[4]>=18||K[0]()[4]<6;for(let e=0;e<9;e++)for(let o=0;o<9;o++){let f=r-4+o,m=h-4+e;let S=16*t;if(R([f,m])){let e=n[m][f];e&&(S=16*e)}if(D.drawImage(H,S,0,16,16,16*(o+1),16*(e+1),16,16),36===n[m][f]&&(d?D.drawImage(H,16*(36+t),0,16,16,16*(o+1),16*(e+1),16,16):D.drawImage(H,704,0,16,16,16*(o+1),16*(e+1),16,16)),34===n[m][f]&&p&&D.drawImage(H,16*(34+t),0,16,16,16*(o+1),16*(e+1),16,16),0===a&&d)for(let n=0;n<s.length;n++){let r=s[n],h=r[0],a=r[1],l=r[2];h===f&&a===m&&r[3]>0&&(S=16*(7+t)+16*l*2,D.drawImage(B,S,0,16,16,16*(o+1),16*(e+1),16,16))}4===o&&4===e&&(S=u?16*t+16*g*2:64,D.drawImage(B,S,0,16,16,16*(o+1),16*(e+1),16,16)),0===a&&f===l-2&&m===c&&D.drawImage(B,80,0,16,16,16*(o+1),16*(e+1),16,16),0===a&&f===l-1&&m===c&&D.drawImage(B,96,0,16,16,16*(o+1),16*(e+1),16,16),0!==a||i[160*m+f]||D.drawImage(H,672,0,16,16,16*(o+1),16*(e+1),16,16)}},$=()=>{let e=K[0]()[1],t=K[0]()[2],s=K[0]()[9],o=K[0]()[10],n=K[0]()[11],r=K[0]()[17],h=K[0]()[18];v(`RANGER DOWN ${K[2]()}`,2.5,.5),D.drawImage(H,256,0,16,16,0,0,16,16),v(`${t}`,t<10?.5:0,2),D.drawImage(H,240,0,16,16,0,24,16,16),v(`${e}`,e<10?.5:0,5),D.drawImage(H,624,0,16,16,0,48,16,16),v(`${s}`,s<10?.5:0,8),D.drawImage(H,640,0,16,16,0,72,16,16),v(`${n}`,n<10?.5:0,11),D.drawImage(H,656,0,16,16,0,96,16,16),v(`${o}`,o<10?.5:0,14),r>-1&&v(`${r}`,r<10?.5:0,15),h>-1&&v(`${h}`,h<10?.5:0,16)};let b=()=>{let e=K[0]()[7],t=K[0]()[12],o=K[0]()[13],n=K[0]()[14],r=K[0]()[16],h=e[1],a=e[2],l=e[3],c=e[4];for(let e=0;e<160;e++)for(let o=0;o<160;o++){let n=~~(o/40),r=~~(e/40),h=l[e][o],a=h>=17&&h<20;c[4*r+n]?k(h)?D.drawImage(H,432,0,1,1,o,e,1,1):t[160*e+o]||a?D.drawImage(H,32,0,1,1,o,e,1,1):o%2&&!(e%2)||!(o%2)&&e%2?D.drawImage(H,32,0,1,1,o,e,1,1):D.drawImage(H,432,0,1,1,o,e,1,1):o>8&&e>8&&(s(2)?D.drawImage(H,32,0,1,1,o,e,1,1):D.drawImage(H,432,0,1,1,o,e,1,1))}for(let e=0;e<160;e++)for(let t=0;t<160;t++){let s=~~(t/40),h=~~(e/40),a=l[e][t];if(c[4*h+s]){if(20===a){o[160*e+t][0]?(D.drawImage(H,32,0,9,9,t-4,e-4,9,9),D.drawImage(x,35,0,7,7,t-3,e-3,7,7)):(D.drawImage(H,432,0,9,9,t-4,e-4,9,9),D.drawImage(x,0,0,7,7,t-3,e-3,7,7))}if(a>=28&&a<31){n[160*e+t].length?(D.drawImage(H,32,0,9,9,t-4,e-4,9,9),D.drawImage(x,7,0,7,7,t-3,e-3,7,7)):(D.drawImage(H,432,0,9,9,t-4,e-4,9,9),D.drawImage(x,42,0,7,7,t-3,e-3,7,7))}34===a&&(r?(D.drawImage(H,32,0,9,9,t-4,e-4,9,9),D.drawImage(x,49,0,7,7,t-3,e-3,7,7)):(D.drawImage(H,432,0,9,9,t-4,e-4,9,9),D.drawImage(x,14,0,7,7,t-3,e-3,7,7))),36===a&&(D.drawImage(H,32,0,9,9,t-4,e-4,9,9),D.drawImage(x,28,0,7,7,t-3,e-3,7,7)),43===a&&(D.drawImage(H,32,0,9,9,t-4,e-4,9,9),D.drawImage(x,56,0,7,7,t-3,e-3,7,7))}}D.drawImage(H,32,0,9,9,h-4,a-4,9,9),D.drawImage(x,21,0,7,7,h-3,a-3,7,7);for(let e=0;e<40;e++)D.drawImage(P,8*(16+e),0,8,8,0,40*e+20,8,8);for(let e=0;e<40;e++)D.drawImage(P,8*(33+e),0,8,8,40*e+20,0,8,8)},D=c.getContext("2d");let P,H,B,U,x,K=(()=>{let e,n,r,a,c,F,M,v,Y,G,L,$,b,D,P,H,B,U,x,K,W,Z,X,z;let q=()=>{e=[[]],n=[[]],z=[[]],r=0,a=5,c=20,F=20,M=0,v=0,Y=0,G=17,L=55,A[7]=((e,n,r)=>{let a=w(),c=s(10,40),d=[S(0),S(1),S(2),S(3)];for(;d.length<c;){let e=I(),t=u(e,d);l(e,t)>10&&d.push(e)}let N=[],R=d.slice();let k=R.pop();let A=k;for(;R.length;){let e=u(k,R),t=f(k,e,O,.33);N.push(...t),k=R.pop()}let F=f(k,A,O,.33);N.push(...F);for(let e=0;e<10;e++){let e=f(t(d),t(d),O,.33);N.push(...e)}let M=[];for(let e=0;e<d.length;e++)M.push(...h(d[e]));let v=p([...d,...M,...N]),Y=m(v),[G,L]=E(Y);T(a,Y,()=>2);let $=i([0,0],([e,t])=>1===a[t][e]);T(a,$,()=>0);let b=g([G,L],d),D=f([G,L],b[0],O,.33);N.push(...D),y(a),C(a),T(a,N,([e,t])=>a[t][e]>=17&&a[t][e]<20?a[t][e]:2),T(a,M,([e,t])=>a[t][e]>=17&&a[t][e]<20?a[t][e]:s(9)+2);let P=b.length-4,H=~~(.25*P),B=~~(.15*P),U=~~(.5*P),x=P-H-B-U,K=[];for(let e=0;e<H;e++)K.push(1);for(let e=0;e<B;e++)K.push(3);for(let e=0;e<U;e++)K.push(2);for(let e=0;e<x;e++)K.push(5);let W=[0,1,2,...o(K),4];for(let t=0;t<b.length;t++){let[o,h]=b[t],l=W[t];0===l?a[h][o]=38:1===l?(a[h][o]=20,e[160*h+o]=[0,0,0],e[0].push([o,h])):2===l?(a[h][o]=s(3)+28,n[160*h+o]=[],n[0].push([o,h])):3===l?(a[h][o]=36,r[0].push([o,h])):4===l&&(a[h][o]=34)}return[3,G,L,a,0,G,L]})(e,n,z),b=[A[7],A[1],A[0]],$="",D=[],B=0,Z=-1,X=-1,K=[33],W=[],P=[],H=0;let d=A[7],N=d[1],R=d[2];W[4*~~(R/40)+~~(N/40)]=1,j(),_(),te(d)},V=()=>{b.pop(),b.length||q()},J=([e,t])=>{let o=s(2),n=s(2)+1,r=A[7],h=r[3][t][e],a=r[1],l=r[2];k(h)||N(D,[e,t])||a===e&&l===t||D.push([e,t,o,n])},j=()=>{for(;D.length<8;){let e=s(160),t=s(160);J([e,t])}},Q=([e,t])=>{for(let s=0;s<D.length;s++){let o=D[s],n=o[0],r=o[1];if(o[3]>0&&e===n&&t===r)return 1}},_=()=>{let s=e[0].length,r=s+2,h=~~(7*s),a=~~(2*s);let l=[];for(let e=0;e<r;e++)l.push(0);for(let e=0;e<h;e++)l.push(1);for(let e=0;e<50;e++)l.push(2);for(let e=0;e<a;e++)l.push(3);for(l=o(l);l.length;){let e=l.pop(),[s,o]=t(n[0]);n[160*o+s].push(e)}},ee=(t=0)=>{if(c<1)b=[A[13]];else{if(60==++L&&(L=0,G++,t?(c<F&&c++,6===G&&($="")):(6===G&&($="",b.push(A[2])),18===G&&($="i",b.push(A[3])),a>0?(a--,c<F&&c++):(c--,b.push(A[12])))),24===G){let t=e[0];for(let s=0;s<t.length;s++){let[o,n]=t[s];e[160*n+o][2]=0}G=0;let o=A[7];for(let e=0;e<160;e++)for(let t=0;t<160;t++)if(36===o[3][e][t]){let o=h([t,e]);for(let e=0;e<o.length;e++)s(3)||J(o[e])}}(()=>{for(let e=0;e<D.length;e++){let t=D[e],o=t[0],n=t[1],r=b[b.length-1],h=A[7],a=h[1],l=h[2],u=[o,n];if((G>=18||G<6)&&Math.random()<.66){let e=d([o,n],[a,l]);u[0]=e[0],u[1]=e[1]}else s(2)?u[0]=o+(s(3)-1):u[1]=n+(s(3)-1);let g=h[3][u[1]][u[0]];k(g)||Q([u[0],u[1]])||a===u[0]&&l===u[1]||(t[0]=u[0],t[1]=u[1],u[0]<o&&(t[2]=1),u[0]>o&&(t[2]=0)),3===r[0]&&0===r[4]&&(G>=18||G<6)&&a===u[0]&&l===u[1]&&s(2)&&c>0&&t[3]>0&&c--}})()}},te=e=>{if(0===e[4]){let t=e[1],s=e[2];for(let e=-4;e<4;e++)for(let o=-4;o<4;o++){let n=t+o,r=s+e;l([t,s],[n,r])<4&&(P[160*r+n]=1)}}},se=[()=>{for(;6!==G;)ee(1)},()=>{U[0]=1,M--},()=>{let e=A[7],t=e[1],o=e[2],n=h([t,o]);let r=0;for(let e=0;e<60;e++){ee();for(let t=0;t<n.length;t++){let[s,o]=n[t];(G>=18||G<6)&&Q([s,o])&&(r=1,e=60)}}if(r)b.push([1,["Under attack!"]]);else{let e=x.pop();if(3===e){let e=s(3)+2;b.push([1,[`Found ${e} food`]]),a+=e}else 0===e?(b.push([1,["Found keycard"]]),M++):1===e?(b.push([1,["Found chip"]]),v++):2===e&&(b.push([1,["Found backup"]]),Y++)}},()=>{U[1]?b.push([2,["RSOS v3.27","--------------------",""],[["SYNTHESIZE",27],["DIAGNOSTICS",42],["NOTES",28],["COMMS",29],["MAP",31]],0,"a"]):b.push([2,["RSOS v3.27","--------------------","NETWORK OFFLINE","","EMERGENCY MODE",""],[["SYNTHESIZE",27],["DIAGNOSTICS",42]],0,"a"])},()=>{b.push([1,["Fixed 6 chips"]]),v-=6,U[1]=1},()=>{let e=s(3)+6;U[2]=1,a+=e,b.push([1,[`Synthesized ${e} food`]])},()=>{let e=[],t=[2,["RSOS v3.27","--------------------","SYNTHESIZER"],e,0,"a"];U[2]?t[1].push("  CHARGING..."):(e.push(["RATIONS",26]),Z>-1&&e.push(["MOD CHIPS",43]),X>-1&&e.push(["SATELLITE CHIP",44])),b.push(t)},()=>{let e=[2,["RSOS v3.27","--------------------","NOTES"],K.map(e=>[`ENTRY ${e}`,e]),0,"a"];b.push(e)},()=>{let e=[],t=[2,["RSOS v3.27","--------------------","COMMS"],e,0,"a"];H?e.push(["DISTRESS SIGNAL",45]):t[1].push("  SATELLITE OFFLINE"),b.push(t)},()=>{},()=>{let e=A[7],t=[5,e[1],e[2],e[3],W];b.push(t)},()=>{Y--;let e=K.length+33,o=s(8);if(K.length+33>37&&-1===Z)b.push([1,["Recovered 1 synth","database entry"]]),Z=0;else if(K.length+33>39&&-1===X)b.push([1,["Recovered 1 synth","database entry"]]),X=0;else if(o<3&&e<41)K.push(e),b.push(A[K.length+33-1]),b.push([1,["Recovered 1 note","database entry"]]);else{let s=[];for(let e=0;e<4;e++)for(let t=0;t<4;t++)W[4*e+t]||s.push([t,e]);if(s.length){let[e,o]=t(s);W[4*o+e]=1,se[10](),b.push([1,["Recovered 1 map","database entry"]])}else e<41?(K.push(e),b.push(A[K.length+33-1]),b.push([1,["Recovered 1 note","database entry"]])):b.push([1,["Backup already","restored"]])}},()=>{if(U[1]){let e=[];for(let t=0;t<4;t++)for(let s=0;s<4;s++)W[4*t+s]||e.push([s,t]);let t=["RSOS v3.27","--------------------","DIAGNOSTICS","","NETWORK ONLINE","SYNTHESIZE ONLINE"];-1===X&&t.push("  RESTORE BACKUPS"),t.push("NOTES ONLINE"),K.length<8&&t.push("  RESTORE BACKUPS"),H?(t.push("COMMS ONLINE"),t.push("  DISTRESS MODE ONLY")):t.push("COMMS OFFLINE"),t.push("MAP ONLINE"),e.length&&t.push("  RESTORE BACKUPS"),b.push([2,t,[],0,"a"])}else b.push([2,["RSOS v3.27","--------------------","DIAGNOSTICS","","NETWORK OFFLINE","  FIX 6 CHIPS","SYNTHESIZE ONLINE","  EMERGENCY MODE","NOTES OFFLINE","COMMS OFFLINE","MAP OFFLINE"],[],0,"a"])},()=>{let e=s(2)+2;U[2]=1,Z+=e,b.push([1,[`Synthesized ${e}`,"mod chips"]])},()=>{U[2]=1,X++,b.push([1,["Synthesized","satellite chip"]])},()=>{let e=z[0],t=A[7][3];let s=0;for(let o=0;o<e.length;o++){let[n,r]=e[o];43!==t[r][n]&&(s=1)}b=s?[[1,["You send the","distress signal.","","As the rescue team","arrives monsters","pour out of","remaining portals","and kill them all!","","GAME OVER!"]]]:[[1,["You send the","distress signal.","","The rescue team","arrives and you","help them kill","the remaining","monsters.","","YOU WIN!"]]]}];return q(),[()=>[r,a,c,F,G,L,(()=>0===b[b.length-1][0]?"g":1===b[b.length-1][0]?"g":5===b[b.length-1][0]?"a":2===b[b.length-1][0]?b[b.length-1][4]:$)(),b[b.length-1],D,M,v,Y,P,e,n,z,H,Z,X],q,()=>`${G<10?"0":""}${G}:${L<10?"0":""}${L}`,ee,(t,o)=>{let h=b[b.length-1];if(3!==h[0])return;let l;if(ee(),-1===t&&(r=1),1===t&&(r=0),t=h[1]+t,o=h[2]+o,(G>=18||G<6)&&0===h[4])for(let e=0;e<D.length;e++)D[e][0]===t&&D[e][1]===o&&D[e][3]>0&&(l=D[e]);if(c>0&&R([t,o])&&!k(h[3][o][t])&&!l&&(h[1]=t,h[2]=o),te(h),0===h[4]&&(20===h[3][o][t]&&((U=e[160*o+t])[0]?b.push((()=>{let e=w(),t=i([0,0],([t,s])=>1===e[s][t]);return T(e,t,()=>27),e[19][18]=21,e[19][19]=22,e[19][20]=23,e[20][18]=2,e[20][19]=2,e[20][20]=2,e[21][18]=24,e[21][19]=25,e[21][20]=26,[3,20,20,e,1,20,20]})()):M?b.push(A[16]):b.push(A[15])),o===h[6]&&t===h[5]-1&&b.push(A[8]),l&&s(2)&&l[3]--,38!==h[3][o][t]||B||(B=1,b.push(A[14]),M++,a+=5,v+=3,Y+=2),h[3][o][t]>=28&&h[3][o][t]<31&&((x=n[160*o+t]).length?b.push(A[18]):b.push([1,["Nothing here"]])),36===h[3][o][t]&&(Z>0?(b.push([1,["Portal disabled!"]]),h[3][o][t]=43,z[160*o+t]=1,Z--):Z>-1?b.push([1,["Need mod chips"]]):b.push([1,["A strange portal"]])),34===h[3][o][t]&&(X>0&&!H?(b.push([1,["Fixed satellite!"]]),H=1,X--):X>-1&&!H?b.push([1,["Need satellite chip"]]):H||b.push([1,["Satellite is offline"]]))),1===h[4]){if(26===h[3][o][t]&&b.pop(),21===h[3][o][t]){let e=[["Use",21]],t=[2,["A computer",""],e,0,"g"];!U[1]&&v>5&&e.push(["Fix Chips",23]),U[1]&&Y>0&&e.push(["Restore Backups",41]),e.length>1?b.push(t):se[3]()}23===h[3][o][t]&&(G>=17||G<6?b.push(A[9]):b.push(A[10]))}},V,e=>{2===b[b.length-1][0]&&(b[b.length-1][3]=e)},()=>{if(2===b[b.length-1][0]){let e=b[b.length-1];if(!e[2].length)return void b.pop();let t=e[3],s=e[2][t][1];-1===s?V():4===A[s][0]?(b.pop(),se[A[s][1]]()):b.push(A[s])}}]})();document.onkeyup=(e=>{let t=K[0]()[7];if(3===t[0]&&(e=>{65!==e.keyCode&&37!==e.keyCode||K[4](-1,0),68!==e.keyCode&&39!==e.keyCode||K[4](1,0),87!==e.keyCode&&38!==e.keyCode||K[4](0,-1),83!==e.keyCode&&40!==e.keyCode||K[4](0,1)})(e),0!==t[0]&&1!==t[0]&&5!==t[0]||32!==e.keyCode&&27!==e.keyCode&&13!==e.keyCode||K[5](),2===t[0]){let s=t;27===e.keyCode&&K[5](),87!==e.keyCode&&38!==e.keyCode||s[3]>0&&K[6](s[3]-1),83!==e.keyCode&&40!==e.keyCode||s[3]<s[2].length-1&&K[6](s[3]+1),32!==e.keyCode&&13!==e.keyCode||K[7]()}});let W=([e,t])=>{let s=K[0]()[7],o=c.getBoundingClientRect().width/10,r=~~((e-c.getBoundingClientRect().left)/o)-1,h=~~((t-c.getBoundingClientRect().top)/o)-1;if(3===s[0]){if(4===r&&4===h)return;if(r<0||h<0)return;let e=n(r,4),t=n(h,4);let s=0,o=0;e>t?s=r>4?1:-1:e<t&&(o=h>4?1:-1),K[4](s,o)}if(0!==s[0]&&1!==s[0]&&5!==s[0]||K[5](),2===s[0]){let e=s,t=e[1].length%2?1:0,o=(e[1].length+t)/2,n=e[2].length,r=h-o+1;h<0&&K[5](),n||K[5](),r>=0&&r<n&&(r===e[3]?K[7]():K[6](r))}};c.ontouchend=(e=>{e.preventDefault();for(let t=0;t<e.changedTouches.length;t++)W([e.changedTouches[t].clientX,e.changedTouches[t].clientY])}),c.onclick=(e=>{e.preventDefault(),W([e.clientX,e.clientY])}),((...t)=>Promise.all(t.map(e)))("f.gif","t.gif","p.gif","s.png","c.gif").then(e=>{[P,H,B,U,x]=e,requestAnimationFrame(F)})};s();</script></body>