(()=>{"use strict";var t={};function i(t,i){return t=Math.ceil(t),i=Math.floor(i),Math.floor(Math.random()*(i-t+1))+t}function e(){return[1,-1][i(0,1)]}function s(t){return("0"+t).slice(-2)}t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var i;t.g.importScripts&&(i=t.g.location+"");var e=t.g.document;if(!i&&e&&(e.currentScript&&(i=e.currentScript.src),!i)){var s=e.getElementsByTagName("script");if(s.length)for(var h=s.length-1;h>-1&&!i;)i=s[h--].src}if(!i)throw new Error("Automatic publicPath is not supported in this browser");i=i.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=i})();let h=-1;function r(t,i){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const s=e.getContext("2d");return s.fillStyle=i,s.fillRect(0,0,e.width,e.height),s.globalCompositeOperation="destination-in",s.drawImage(t,0,0),e}function o(t,i){const e={x:t.x<i.x?1:-1,y:t.y<i.y?1:-1},s=Math.abs(t.x-i.x),h=Math.abs(t.y-i.y),r={x:0,y:0};return s>h?(r.x=1,r.y=h/s):(r.y=1,r.x=s/h),{step:r,direction:e}}class n{ctx;sprite;config;constructor(t,i,e,s){this.ctx=t,this.sprite=new Image,this.sprite.src=i,this.config=e,s&&this.sprite.addEventListener("load",(()=>{this.sprite=r(this.sprite,s)}))}draw(t,i){const{width:e,height:s}=this.config.frameSize,h=this.config.frameSet*i*e+this.config.frameIndex*e;this.ctx.drawImage(this.sprite,h,0,e,s,t.x,t.y,e,s)}}class a{id;ctx;position;size;constructor(t,i,e={x:0,y:0},s={width:0,height:0}){this.ctx=t,this.id=i,this.position=e,this.size=s}getPositionCenter(){return{x:this.position.x+this.size.width/2,y:this.position.y+this.size.height/2}}isCollisionWithObject(t){return this.position.x+this.size.width>=t.position.x&&this.position.x<=t.position.x+t.size.width&&this.position.y+this.size.height>=t.position.y&&this.position.y<=t.position.y+t.size.height}}var c;!function(t){t[t.Down=0]="Down",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Up=3]="Up"}(c||(c={}));class d extends a{sprite;spriteDirection;moveTo;velocity;isCollision;constructor(t,i,e,s){super(t,e),this.sprite=i,this.spriteDirection=c.Down,this.size=this.sprite.config.frameSize,this.id=e,this.velocity=s}move(t){this.moveTo&&(this.position.x+=this.moveTo.x*this.velocity,this.position.y+=this.moveTo.y*this.velocity,this.moveTo.x?this.spriteDirection=this.moveTo.x<0?c.Left:c.Right:this.moveTo.y&&(this.spriteDirection=this.moveTo.y<0?c.Up:c.Down),this.moveTo=null,t&&(this.sprite.config.frameIndex++,this.sprite.config.frameIndex%=this.sprite.config.frameSet))}draw(){this.sprite.draw(this.position,this.spriteDirection)}}class l extends d{move(t){if(this.moveTo){const{step:i,direction:e}=o(this.position,this.moveTo),s=i.x*this.velocity*e.x,h=i.y*this.velocity*e.y;this.position.x+=s,this.position.y+=h,Math.abs(this.position.x-this.moveTo.x)>Math.abs(this.position.y-this.moveTo.y)?this.spriteDirection=e.x<0?c.Left:c.Right:this.spriteDirection=e.y<0?c.Up:c.Down,t&&(this.sprite.config.frameIndex++,this.sprite.config.frameIndex%=this.sprite.config.frameSet),Math.abs(this.position.x-this.moveTo.x)<=this.velocity&&Math.abs(this.position.y-this.moveTo.y)<=this.velocity&&(this.moveTo=null,this.sprite.config.frameIndex=0)}}}const p=t.p+"knight.avif",m=t.p+"bullet.webp";class f extends a{bulletImage;positionMovement;movementTrajectory;velocity;constructor(t,i,e,s,h){super(t,e),this.id=e,this.bulletImage=new Image,this.bulletImage.src=m,this.size={width:this.bulletImage.width,height:this.bulletImage.height},this.positionMovement=this.correctPositionMovement(i),this.position={x:i.start.x,y:i.start.y},this.movementTrajectory=o(this.positionMovement.start,this.positionMovement.end),this.velocity=s,h&&this.bulletImage.addEventListener("load",(()=>{this.bulletImage=r(this.bulletImage,h)}))}correctPositionMovement({start:t,end:i}){return{start:t,end:{x:i.x-this.size.width/2,y:i.y-this.size.height/2}}}render(){this.draw(),this.move()}draw(){this.ctx.drawImage(this.bulletImage,this.position.x,this.position.y)}move(){const{step:t,direction:i}=this.movementTrajectory;this.position.x+=t.x*this.velocity*i.x,this.position.y+=t.y*this.velocity*i.y}}class g{ctx;canvas;crusaders=[];bulletList;constructor(t){this.ctx=t,this.canvas=this.ctx.canvas,this.bulletList=[]}init(){this.setEvents(),this.spawn()}spawn(){for(let t=1;t<=100;t++){const i=new n(this.ctx,p,{frameSize:{width:40,height:36},columns:1,rows:12,frameSet:3,frameIndex:0});this.crusaders.push(new d(this.ctx,i,t,4))}for(let t=0,i=150;t<this.crusaders.length;t++)t%10==0&&(i+=this.crusaders[0].sprite.config.frameSize.width),this.crusaders[t].position={x:t%10*this.crusaders[0].sprite.config.frameSize.width+this.canvas.width/3,y:i}}killCrusader(t){this.crusaders.splice(this.crusaders.findIndex((i=>i.id===t)),1)}keyPressed;setEvents(){document.addEventListener("keydown",(t=>{this.keyPressed=t.code})),document.addEventListener("keyup",(()=>{this.keyPressed=null,this.crusaders.forEach((t=>{t.sprite.config.frameIndex=0}))})),this.canvas.addEventListener("mousedown",(t=>{!t.button&&this.crusaders.length&&this.attack(this.getRandomCrusader().getPositionCenter(),{x:t.clientX,y:t.clientY},16)}))}attack(t,i,e,s){const h=new f(this.ctx,{start:t,end:i},this.bulletList.length,e,s);this.bulletList.push(h)}destroyBullet(t){this.bulletList.splice(this.bulletList.findIndex((i=>i.id===t)),1)}getRandomCrusader(){return this.crusaders[i(0,this.crusaders.length-1)]}currentTimeFrame;setNextSpriteFrame;render(t){!this.currentTimeFrame&&t?this.currentTimeFrame=t:t-this.currentTimeFrame>16.6*3?(this.currentTimeFrame=t,this.setNextSpriteFrame=!0):this.setNextSpriteFrame=!1,this.move(),this.draw()}draw(){this.crusaders.forEach((t=>t.draw())),this.bulletList.forEach((t=>{t.render()}))}moveTo;move(){if(this.keyPressed){let t=0,i=0;switch(this.keyPressed){case"ArrowUp":case"KeyW":i--;break;case"ArrowRight":case"KeyD":t++;break;case"ArrowDown":case"KeyS":i++;break;case"ArrowLeft":case"KeyA":t--;break;default:return}this.crusaders.forEach((e=>e.moveTo={x:t,y:i}))}this.crusaders.forEach((t=>t.move(this.setNextSpriteFrame)))}}class v extends g{player;civilians=[];infecteds=[];robbers=[];constructor(t,i){super(t),this.player=i}init(){setTimeout((()=>{this.spawn()}),5e3)}spawn(){this.spawnCivilians(),this.spawnInfectedsOrRobbers(!0),this.spawnInfectedsOrRobbers(!1),setInterval((()=>{if(this.player.crusaders.length)for(let t=0;t<i(1,3);t++){const t=this.robbers[i(0,this.robbers.length)];t&&this.attack(t.getPositionCenter(),this.player.getRandomCrusader().getPositionCenter(),8,"red")}}),1e3)}spawnCivilians(){for(let t=1;t<=i(2,4);t++){const e=new n(this.ctx,p,{frameSize:{width:40,height:36},columns:1,rows:12,frameSet:3,frameIndex:0},"#FFFADD"),s=new l(this.ctx,e,t,i(1,3));s.position=this.getRandomUnitPosition(e.config.frameSize);const h={x:this.canvas.width/2*2-s.position.x,y:this.canvas.height/2*2-s.position.y};s.position.x>0&&(h.x-=2*e.config.frameSize.width),s.position.y>0&&(h.y-=2*e.config.frameSize.height),s.moveTo=h,this.civilians.push(s)}}getRandomUnitPosition(t){let s,h;const r=i(0,1e3);return e()>0?(h=e()>0?this.canvas.height+r:-t.height-r,s=i(0,this.canvas.width)):(s=e()>0?this.canvas.width+r:-t.width-r,h=i(0,this.canvas.height)),{x:s,y:h}}spawnInfectedsOrRobbers(t){const e=t?"green":"red",s=t?this.infecteds:this.robbers;for(let t=1;t<=i(2,4);t++){const t=new n(this.ctx,p,{frameSize:{width:40,height:36},columns:1,rows:12,frameSet:3,frameIndex:0},e),r=new l(this.ctx,t,++h,i(1,2));r.position=this.getRandomUnitPosition(t.config.frameSize),r.moveTo=this.getRandomPosition(r.sprite.config.frameSize),s.push(r)}}getRandomPosition(t){return{x:i(0,this.canvas.width-t.width),y:i(0,this.canvas.height-t.height)}}render(t){super.render(t),this.reSpawn()}draw(){this.civilians.forEach((t=>t.draw())),this.infecteds.forEach((t=>t.draw())),this.robbers.forEach((t=>t.draw())),this.bulletList.forEach((t=>{t.render()}))}move(){this.civilians.forEach((t=>{t.move(this.setNextSpriteFrame),t.moveTo||this.killCivilian(t.id)})),[...this.infecteds,...this.robbers].forEach((t=>{t.move(this.setNextSpriteFrame),t.moveTo||(t.moveTo=this.getRandomPosition(t.sprite.config.frameSize),t.velocity=i(1,2))}))}isNeedReSpawnCivilians=!1;isNeedReSpawnInfectedsWithRobbers=!1;reSpawn(){this.isNeedReSpawnCivilians||this.civilians.length||(this.isNeedReSpawnCivilians=!0,setTimeout((()=>{this.spawnCivilians(),this.isNeedReSpawnCivilians=!1}),5e3)),this.isNeedReSpawnInfectedsWithRobbers||(this.isNeedReSpawnInfectedsWithRobbers=!0,setTimeout((()=>{switch(i(1,3)){case 1:this.spawnInfectedsOrRobbers(!0);break;case 2:this.spawnInfectedsOrRobbers(!1);break;case 3:this.spawnInfectedsOrRobbers(!0),this.spawnInfectedsOrRobbers(!1)}this.isNeedReSpawnInfectedsWithRobbers=!1}),1e3*i(5,7)))}killCivilian(t){this.civilians.splice(this.civilians.findIndex((i=>i.id===t)),1)}killInfected(t){this.infecteds.splice(this.infecteds.findIndex((i=>i.id===t)),1)}killRobber(t){this.robbers.splice(this.robbers.findIndex((i=>i.id===t)),1)}}new class{canvas;ctx;player;enemy;killed;diffTime;hikingEndTime;start;voiceSynthesizer;voiceTexts=["Onward towards victory!","For faith and glory!","Join the holy fight!","Unite for the sacred cause!","Our blood for the holy land!","The righteous crusaders!","Death before dishonor!","In the name of God!","Fight for your beliefs!","Together we stand!","Crusaders never surrender!","Victory or death!","Honor and glory await!","A holy journey!","A quest for the eternal reward!","Knights of the cross!","Unleash the warrior in you!","A battle for freedom!"];constructor(t){this.canvas=t,this.ctx=t.getContext("2d",{willReadFrequently:!1,alpha:!1}),this.resize(),this.start=!0,this.killed={civilians:0,infecteds:0,robbers:0},window.hasOwnProperty("speechSynthesis")&&(this.voiceSynthesizer=new SpeechSynthesisUtterance,this.voiceSynthesizer.lang="en-US",this.voiceSynthesizer.voice=window.speechSynthesis.getVoices()[1]),this.player=new g(this.ctx),setTimeout((()=>{this.enemy=new v(this.ctx,this.player)})),this.init()}init(){this.setEvents(),this.resize(),setTimeout((()=>{this.render()}))}setEvents(){window.addEventListener("resize",this.resize.bind(this)),window.addEventListener("contextmenu",(t=>t.preventDefault())),document.addEventListener("keydown",(t=>{if(this.start&&("Enter"===t.code||"Space"===t.code)){this.start=!1,this.canvas.requestFullscreen(),this.player.init(),this.enemy.init();const t=new Date;this.hikingEndTime=new Date,this.hikingEndTime.setMinutes(t.getMinutes()+i(1,5)),this.startVoice()}}))}startVoice(){this.voiceSynthesizer&&!this.isFinish&&(this.voiceSynthesizer.addEventListener("end",(()=>{this.startVoice()})),setTimeout((()=>{this.voiceSynthesizer.voice=window.speechSynthesis.getVoices()[1],this.voiceSynthesizer.text=this.voiceTexts[i(0,this.voiceTexts.length-1)],window.speechSynthesis.speak(this.voiceSynthesizer)}),15e3))}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}render(t){this.isPause||(requestAnimationFrame(this.render.bind(this)),this.start?this.showPopup():(this.diffTime=new Date(this.hikingEndTime.getTime()-(new Date).getTime()),this.draw(),this.player.render(t),this.drawWaterArea(),this.enemy.render(t),this.collisionDetection(),this.drawInfo(),this.checkEndGame()))}showPopup(){this.drawBackground(),this.ctx.save(),this.ctx.font="bold 20px Courier New",this.ctx.fillStyle="#333",this.ctx.textAlign="center",this.ctx.fillText("Don't go beyond the land.",this.canvas.width/2,this.canvas.height/3),this.ctx.fillText("Don't kill civilians.",this.canvas.width/2,this.canvas.height/3+30),this.ctx.fillText("Save at least one crusader.",this.canvas.width/2,this.canvas.height/3+60),this.ctx.fillText("Finish the hike.",this.canvas.width/2,this.canvas.height/3+90),this.ctx.fillText("Good luck!",this.canvas.width/2,this.canvas.height/3+120),this.ctx.fillText("Press Enter or Space to start.",this.canvas.width/2,this.canvas.height/3+180),this.ctx.restore()}collisionDetection(){this.player.crusaders.forEach((t=>{this.isCollisionWithWater(t)&&this.player.killCrusader(t.id),this.enemy.infecteds.forEach((i=>{i.isCollisionWithObject(t)&&(this.player.killCrusader(t.id),this.enemy.moveTo=this.enemy.getRandomPosition(i.sprite.config.frameSize))})),this.enemy.robbers.forEach((i=>{i.isCollisionWithObject(t)&&(this.enemy.killRobber(i.id),this.killed.robbers++)})),this.enemy.bulletList.forEach((i=>{i.isCollisionWithObject(t)&&(this.enemy.destroyBullet(i.id),this.player.killCrusader(t.id))}))})),this.player.bulletList.forEach((t=>{this.isCollisionWithWater(t)&&this.player.destroyBullet(t.id),this.enemy.civilians.forEach((i=>{i.isCollisionWithObject(t)&&(this.player.destroyBullet(t.id),this.enemy.killCivilian(i.id),this.killed.civilians++)})),this.enemy.infecteds.forEach((i=>{i.isCollisionWithObject(t)&&(this.player.destroyBullet(t.id),this.enemy.killInfected(i.id),this.killed.infecteds++)})),this.enemy.robbers.forEach((i=>{i.isCollisionWithObject(t)&&(this.player.destroyBullet(t.id),this.enemy.killRobber(i.id),this.killed.robbers++)})),this.enemy.bulletList.forEach((i=>{i.isCollisionWithObject(t)&&(this.player.destroyBullet(t.id),this.enemy.destroyBullet(i.id))}))})),this.enemy.bulletList.forEach((t=>{this.isCollisionWithWater(t)&&this.enemy.destroyBullet(t.id)}))}isCollisionWithWater(t){return t.position.x<this.waterAreaSize/2||t.position.x+t.size.width>this.canvas.width-this.waterAreaSize||t.position.y<this.waterAreaSize||t.position.y+t.size.height>this.canvas.height-this.waterAreaSize}isFinish=!1;isPause=!1;checkEndGame(){!this.isFinish&&(!this.player.crusaders.length||this.killed.civilians>=20||"00:00"===this.getFormatTime()||this.diffTime.getMinutes()>=10)&&(this.isFinish=!0,setTimeout((()=>{this.isPause=!0,this.setResult()}),50))}setResult(){let t="You "+("00:00"===this.getFormatTime()&&this.player.crusaders.length&&this.killed.civilians<20?"win!":"lost!");t+="\nRepeat?",alert(t),document.location.reload()}draw(){this.drawBackground()}gradientBGy=0;drawBackground(){this.ctx.save();const t=this.ctx.createLinearGradient(0,this.gradientBGy++%this.canvas.height,0,this.canvas.height+this.gradientBGy);this.gradientBGy>=this.canvas.height&&(this.gradientBGy=-this.canvas.height),t.addColorStop(0,"#EADBC8"),t.addColorStop(.33,"#DAC0A3"),t.addColorStop(.66,"#DAC0A3"),t.addColorStop(1,"#EADBC8"),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.restore()}waterAreaSize=10;drawWaterArea(){this.ctx.save();const t=this.ctx.createLinearGradient(0,0,this.canvas.width,this.canvas.height);t.addColorStop(0,"#02AABD"),t.addColorStop(1,"#00CDAC"),this.ctx.strokeStyle=t,this.ctx.lineWidth=20,this.ctx.strokeRect(0,0,this.canvas.width,this.canvas.height),this.ctx.restore()}fogWidth=0;fogRevert=!1;isFogStop=!1;flag=0;drawFog(){const t=this.canvas.width;this.ctx.save(),this.ctx.beginPath(),this.ctx.lineWidth=this.fogWidth;const i=this.ctx.createLinearGradient(0,0,this.canvas.width,this.canvas.height);i.addColorStop(0,"#868F96"),i.addColorStop(1,"#596164");const e=t-this.flag++;this.ctx.strokeStyle=i,this.isFogStop||(e<=400?(this.fogRevert=!0,this.stopFog()):this.fogWidth<=0&&(this.fogRevert=!1,this.stopFog()),this.setFogWidth()),this.ctx.arc(this.canvas.width/2,this.canvas.height/2,t,0,2*Math.PI),this.ctx.stroke(),this.ctx.restore()}setFogWidth(){const t=5*(this.fogRevert?-1:1);this.fogWidth+=t}stopFog(){this.isFogStop=!0,setTimeout((()=>{this.isFogStop=!1,this.setFogWidth()}),5e3)}drawInfo(){this.ctx.save(),this.ctx.font="16px Courier New",this.ctx.fillText(`Crusaders: ${this.player.crusaders.length}`,15,25),this.ctx.fillText(`Civilians killed: ${this.killed.civilians}`,15,45),this.ctx.fillText(`Infecteds killed: ${this.killed.infecteds}`,15,65),this.ctx.fillText(`Robbers killed: ${this.killed.robbers}`,15,85),this.ctx.fillText(`Hiking time: ${this.getFormatTime()}`,15,this.canvas.height-20),this.ctx.restore()}getFormatTime(){return s(this.diffTime.getMinutes())+":"+s(this.diffTime.getSeconds())}}(document.getElementById("root"))})();