function toRadians(e){return e*(Math.PI/180)}var gameOver=!0,currentScore=0,hiScore=0;function restartGame(){currentScore=0;var e=document.getElementById("restart");document.getElementById("score").setAttribute("value","Score: 0\nHigh Score: "+hiScore),e.setAttribute("text",{color:"#339933"}),e.object3D.scale.set(1,1,1),e.object3D.rotation.y=180;for(var t=document.getElementById("swirl-center");t.firstChild;)t.removeChild(t.firstChild);gameOver=!1,document.getElementById("menu").object3D.rotation.y=180,startSound&&startSound.play()}function spawnSwirl(e,t,r,i,a,n){var o=document.getElementById("swirl-center"),s=document.createElement("a-entity");s.setAttribute("rotation",e+" "+t+" "+r),s.setAttribute("position","0 0 0");var d=document.createElement("a-entity");d.setAttribute("geometry",{primitive:"cylinder",openEnded:!0,thetaLength:0,height:.1,radius:1.5}),d.setAttribute("material",{side:"double",color:"red"}),d.setAttribute("swirl",""),o.appendChild(s),s.appendChild(d)}AFRAME.registerComponent("draw-canvas",{schema:{default:""},init:function(){this.canvas=document.getElementById(this.data),this.ctx=this.canvas.getContext("2d"),this.ctx.rect(0,0,16,16),this.ctx.fillStyle="#EFEFEF",this.ctx.fill();for(var e=0;e<16;e++)for(var t=0;t<16;t++)this.ctx.rect(16*e,16*t,16,16);this.ctx.strokeStyle="#000066",this.ctx.stroke()}}),AFRAME.registerComponent("spin",{schema:{rotX:{type:"number",default:0},rotY:{type:"number",default:360},rotZ:{type:"number",default:0}},tick:function(e,t){var r=this.data,i=this.el;gameOver||(i.object3D.rotation.x+=toRadians(r.rotX)*(t/1e3),i.object3D.rotation.y+=toRadians(r.rotY)*(t/1e3),i.object3D.rotation.z+=toRadians(r.rotZ)*(t/1e3))}}),AFRAME.registerComponent("coin-collect",{schema:{delay:{type:"number",default:.75},centerX:{type:"number",default:0},centerY:{type:"number",default:1.6},centerZ:{type:"number",default:0},radius:{type:"number",default:1.3}},init:function(){this.delayTimer=0;this.data;var e=this.el;e.inDelay=!1,e.addEventListener("mouseenter",function(){gameOver||this.inDelay||(this.inDelay=!0,coinSound&&coinSound.play(),++currentScore>hiScore&&(hiScore=currentScore),document.getElementById("score").setAttribute("value","Score: "+currentScore+"\nHigh Score: "+hiScore),e.object3D.scale.set(.4,.4,1.2))})},tick:function(e,t){var r=this.data,i=this.el;!gameOver&&i.inDelay&&(this.delayTimer+=t/1e3,this.delayTimer>r.delay&&(this.delayTimer=0,this.respawn(),i.inDelay=!1),i.object3D.rotation.y+=t/1e3*12)},respawn:function(){var e=this.data,t=this.el,r=(t.object3D.position,toRadians(180*Math.random())),i=toRadians(360*Math.random()),a=e.radius*Math.sin(r)*Math.cos(i),n=e.radius*Math.sin(r)*Math.sin(i),o=e.radius*Math.cos(r);t.object3D.position.x=e.centerX+a,t.object3D.position.y=e.centerY+n,t.object3D.position.z=e.centerZ+o,t.object3D.scale.set(1,1,1)}}),AFRAME.registerComponent("swirl",{schema:{rotSpeed:{type:"number",default:60},maxLength:{type:"number",default:60},maxAngleChange:{type:"number",default:90},delay:{type:"number",default:1.5}},init:function(){this.currentRot=0,this.phase01=!0,this.inDelay=!0,this.delayTimer=0,this.stopped=!1;var e=this.el,t=this.data,r=e.getAttribute("geometry");e.addEventListener("mouseenter",function(){this.inDelay||gameOver||(e.setAttribute("material","color","blue"),deadSound&&!gameOver&&deadSound.play(),gameOver=!0,document.getElementById("restart").object3D.rotation.y=0,document.getElementById("menu").object3D.rotation.y=0,document.getElementById("score").setAttribute("value","Game Over!\nScore: "+currentScore+"\nHigh Score: "+hiScore))});var i=document.createElement("a-entity");i.setAttribute("geometry",{primitive:"cylinder",openEnded:!0,thetaLength:4,height:.15,radius:1.49}),i.setAttribute("material",{side:"double",color:"green"}),e.parentNode.appendChild(i),this.startPoint=i;var a=document.createElement("a-entity");a.setAttribute("geometry",{primitive:"cylinder",openEnded:!0,thetaStart:r.thetaStart+t.maxLength,thetaLength:4,height:.15,radius:1.49}),a.setAttribute("material",{side:"double",color:"red"}),a.object3D.rotation.y+=toRadians(t.maxAngleChange),e.parentNode.appendChild(a),this.endPoint=a},tick:function(e,t){var r=this.data,i=this.el;if(gameOver)this.stopped||(i.setAttribute("material","color","blue"),this.stopped=!0);else if(this.inDelay)this.delayTimer+=t/1e3,this.delayTimer>r.delay&&(this.delayTimer=0,this.inDelay=!1);else{var a=i.getAttribute("geometry").thetaLength;if(this.phase01)if(a<r.maxLength){var n=r.rotSpeed*(t/1e3);i.setAttribute("geometry",{thetaLength:a+n})}else{n=toRadians(r.rotSpeed)*(t/1e3);i.object3D.rotation.y+=n,this.currentRot+=n,this.currentRot>=toRadians(r.maxAngleChange)&&(this.phase01=!1)}else if(a>1){n=r.rotSpeed*(t/1e3);var o=i.getAttribute("geometry");i.setAttribute("geometry",{thetaStart:o.thetaStart+n,thetaLength:o.thetaLength-n})}else i.parentNode.removeChild(this.startPoint),i.parentNode.removeChild(this.endPoint),i.parentNode.removeChild(i)}}}),AFRAME.registerComponent("swirl-spawner",{schema:{amount:{type:"number",default:5}},init:function(){this.spawnTimer=0},tick:function(e,t){if(!gameOver){var r=this.data;this.el;if(this.spawnTimer+=t/1e3,this.spawnTimer>2){this.spawnTimer=-3.5;for(var i=0;i<r.amount;i++){spawnSwirl(360*Math.random(),360*Math.random(),360*Math.random(),45,90,90)}}}}}),AFRAME.registerComponent("restart-game",{schema:{delay:{type:"number",default:1}},init:function(){var e=this.el;e.inDelay=!1,e.delayTimer=0,e.addEventListener("mouseenter",function(){gameOver&&!this.inDelay&&(this.inDelay=!0,e.object3D.scale.set(1.2,1.2,1.2),e.setAttribute("text",{color:"#FFFFFF"}))}),e.addEventListener("mouseleave",function(){gameOver&&(this.inDelay=!1,e.delayTimer=0,e.object3D.scale.set(1,1,1),e.setAttribute("text",{color:"#339933"}))})},tick:function(e,t){var r=this.data,i=this.el;gameOver&&i.inDelay&&(i.delayTimer+=t/1e3,i.delayTimer>r.delay&&(i.delayTimer=0,i.inDelay=!1,restartGame()))}});