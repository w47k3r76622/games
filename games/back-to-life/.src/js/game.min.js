var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,e,f){a!=Array.prototype&&a!=Object.prototype&&(a[e]=f.value)};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(e){return $jscomp.SYMBOL_PREFIX+(e||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.arrayIterator=function(a){var e=0;return $jscomp.iteratorPrototype(function(){return e<a.length?{done:!1,value:a[e++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var e=a[Symbol.iterator];return e?e.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var e,f=[];!(e=a.next()).done;)f.push(e.value);return f};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
$jscomp.checkEs6ConformanceViaProxy=function(){try{var a={},e=Object.create(new $jscomp.global.Proxy(a,{get:function(f,h,b){return f==a&&"q"==h&&b==e}}));return!0===e.q}catch(f){return!1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.owns=function(a,e){return Object.prototype.hasOwnProperty.call(a,e)};
$jscomp.polyfill=function(a,e,f,h){if(e){f=$jscomp.global;a=a.split(".");for(h=0;h<a.length-1;h++){var b=a[h];b in f||(f[b]={});f=f[b]}a=a[a.length-1];h=f[a];e=e(h);e!=h&&null!=e&&$jscomp.defineProperty(f,a,{configurable:!0,writable:!0,value:e})}};
$jscomp.polyfill("WeakMap",function(a){function e(){if(!a||!Object.seal)return!1;try{var m=Object.seal({}),d=Object.seal({}),b=new a([[m,2],[d,3]]);if(2!=b.get(m)||3!=b.get(d))return!1;b.delete(m);b.set(d,4);return!b.has(m)&&4==b.get(d)}catch(R){return!1}}function f(a){$jscomp.owns(a,b)||$jscomp.defineProperty(a,b,{value:{}})}function h(a){var d=Object[a];d&&(Object[a]=function(a){f(a);return d(a)})}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE)return a}else if(e())return a;
var b="$jscomp_hidden_"+Math.random();h("freeze");h("preventExtensions");h("seal");var p=0,d=function(a){this.id_=(p+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=$jscomp.makeIterator(a);for(var d;!(d=a.next()).done;)d=d.value,this.set(d[0],d[1])}};d.prototype.set=function(a,d){f(a);if(!$jscomp.owns(a,b))throw Error("WeakMap key fail: "+a);a[b][this.id_]=d;return this};d.prototype.get=function(a){return $jscomp.owns(a,b)?a[b][this.id_]:void 0};d.prototype.has=
function(a){return $jscomp.owns(a,b)&&$jscomp.owns(a[b],this.id_)};d.prototype.delete=function(a){return $jscomp.owns(a,b)&&$jscomp.owns(a[b],this.id_)?delete a[b][this.id_]:!1};return d},"es6","es3");$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function e(){this.batch_=null}function f(a){return a instanceof b?a:new b(function(d,b){d(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;e.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};e.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var h=$jscomp.global.setTimeout;e.prototype.asyncExecuteFunction=function(a){h(a,
0)};e.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var k=a[b];a[b]=null;try{k()}catch(M){this.asyncThrow_(M)}}}this.batch_=null};e.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var b=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var d=this.createResolveAndReject_();try{a(d.resolve,d.reject)}catch(k){d.reject(k)}};b.prototype.createResolveAndReject_=
function(){function a(a){return function(d){k||(k=!0,a.call(b,d))}}var b=this,k=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};b.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof b)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var d=null!=a;break a;case "function":d=!0;break a;default:d=!1}d?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};b.prototype.resolveToNonPromiseObj_=function(a){var b=
void 0;try{b=a.then}catch(k){this.reject_(k);return}"function"==typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};b.prototype.reject_=function(a){this.settle_(2,a)};b.prototype.fulfill_=function(a){this.settle_(1,a)};b.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};b.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
0;a<this.onSettledCallbacks_.length;++a)p.asyncExecute(this.onSettledCallbacks_[a]);this.onSettledCallbacks_=null}};var p=new e;b.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};b.prototype.settleSameAsThenable_=function(a,b){var d=this.createResolveAndReject_();try{a.call(b,d.resolve,d.reject)}catch(M){d.reject(M)}};b.prototype.then=function(a,e){function d(a,b){return"function"==typeof a?function(b){try{f(a(b))}catch(y){m(y)}}:
b}var f,m,h=new b(function(a,b){f=a;m=b});this.callWhenSettled_(d(a,f),d(e,m));return h};b.prototype.catch=function(a){return this.then(void 0,a)};b.prototype.callWhenSettled_=function(a,b){function d(){switch(e.state_){case 1:a(e.result_);break;case 2:b(e.result_);break;default:throw Error("Unexpected state: "+e.state_);}}var e=this;null==this.onSettledCallbacks_?p.asyncExecute(d):this.onSettledCallbacks_.push(d)};b.resolve=f;b.reject=function(a){return new b(function(b,d){d(a)})};b.race=function(a){return new b(function(b,
d){for(var e=$jscomp.makeIterator(a),k=e.next();!k.done;k=e.next())f(k.value).callWhenSettled_(b,d)})};b.all=function(a){var d=$jscomp.makeIterator(a),e=d.next();return e.done?f([]):new b(function(a,b){function k(b){return function(d){g[b]=d;h--;0==h&&a(g)}}var g=[],h=0;do g.push(void 0),h++,f(e.value).callWhenSettled_(k(g.length-1),b),e=d.next();while(!e.done)})};return b},"es6","es3");
(function(){var a=function(){function a(c,a){for(var r=[],b=1;b<arguments.length;++b)r[b-1]=arguments[b];S[c]&&S[c].map(function(c){return c.apply(null,$jscomp.arrayFromIterable(r))})}function b(c){return new n(c)}function d(c,a){return(new URL(c,a)).href}function e(c,a){return[c.replace(Z,""),c?a.replace(T,""):a].filter(function(c){return c}).join("/")}function f(c){c=c.replace("."+c.split(".").pop(),"");return 2==c.split("/").length?c.replace(T,""):c}function g(c){return{wav:"",mp3:c.canPlayType("audio/mpeg;"),
ogg:c.canPlayType('audio/ogg; codecs="vorbis"'),aac:c.canPlayType("audio/aac;")}}function h(){window.__k||(window.__k={dm:U,u:d,d:A,i:B})}function p(c){h();return new Promise(function(a,b){var r;var u=e(V,c);if(B[u])return a(B[u]);var q=new Image;q.onload=function(){r=d(u,window.location.href);B[f(c)]=B[u]=B[r]=this;a(this)};q.onerror=function(){b("Unable to load image "+u)};q.src=u})}function y(c){return new Promise(function(a,b){var r;var u=new Audio;var q=g(u);c=[].concat(c).reduce(function(c,
a){return c?c:q[a.split(".").pop()]?a:null},0);if(!c)return b("cannot play any of the audio formats provided"+c);var l=e(W,c);if(D[l])return a(D[l]);u.addEventListener("canplay",function(){r=d(l,window.location.href);D[f(c)]=D[l]=D[r]=this;a(this)});u.onerror=function(){b("Unable to load audio "+l)};u.src=l;u.load()})}function G(c){h();var a;var b=e(X,c);return A[b]?Promise.resolve(A[b]):fetch(b).then(function(c){if(!c.ok)throw c;return c.clone().json().catch(function(){return c.text()})}).then(function(r){a=
d(b,window.location.href);"object"===typeof r&&U.set(r,a);return A[f(c)]=A[b]=A[a]=r})}function w(){var c=E;t.clearRect(0,0,c.width,c.height)}function O(c){var a=H[c.which];J[a]=!0;if(K[a])K[a](c)}function P(c){J[H[c.which]]=!1}function q(){J={}}function l(c){return new z(c)}function x(c,a){return new F(c,a)}function C(c){return new v(c)}function aa(c){if(+c===c)return c;var a=[],b=c.split("..");c=+b[0];b=+b[1];var d=c;if(c<b)for(;d<=b;d++)a.push(d);else for(;d>=b;d--)a.push(d);return a}function Q(c){return new L(c)}
var S={},E,t,n=function(c){var a=void 0===c?{}:c;c=a.spriteSheet;var b=a.frames,d=a.frameRate;a=void 0===a.loop?!0:a.loop;this.spriteSheet=c;this.frames=b;this.frameRate=d;this.loop=a;c=c.frame;b=c.height;d=void 0===c.margin?0:c.margin;this.width=c.width;this.height=b;this.margin=d;this._a=this._f=0};n.prototype.clone=function(){return b(this)};n.prototype.reset=function(){this._a=this._f=0};n.prototype.update=function(c){if(this.loop||this._f!=this.frames.length-1)for(this._a+=void 0===c?1/60:c;1<=
this._a*this.frameRate;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate};n.prototype.render=function(c){c=void 0===c?{}:c;var a=this.frames[this._f]/this.spriteSheet._f|0,b=this.frames[this._f]%this.spriteSheet._f|0;(void 0===c.context?t:c.context).drawImage(this.spriteSheet.image,b*this.width+(2*b+1)*this.margin,a*this.height+(2*a+1)*this.margin,this.width,this.height,c.x,c.y,void 0===c.width?this.width:c.width,void 0===c.height?this.height:c.height)};b.prototype=n.prototype;b.class=
n;var ba=/(jpeg|jpg|gif|png|bmp)$/,ca=/(wav|mp3|ogg|aac)$/,T=/^\//,Z=/\/$/,U=new WeakMap,V="",W="",X="",B={},D={},A={},da=function(){},K={},J={},H={13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"},z=function(a){var c=void 0===a?{}:a;a=c.create;c=void 0===c.maxSize?1024:c.maxSize;var b;if(!(a&&(b=a())&&b.update&&b.init&&b.isAlive))throw Error("Must provide create() function which returns an object with init(), update(), and isAlive() functions");this._c=a;this._i=0;this.objects=
[a()];this.size=1;this.maxSize=c};z.prototype.get=function(a){a=void 0===a?{}:a;if(this.objects.length==this._i){if(this.size===this.maxSize)return;for(var c=0;c<this.size&&this.objects.length<this.maxSize;c++)this.objects.unshift(this._c());this.size=this.objects.length}c=this.objects.shift();c.init(a);this.objects.push(c);this._i++;return c};z.prototype.getAliveObjects=function(){return this.objects.slice(this.objects.length-this._i)};z.prototype.clear=function(){this._i=this.objects.length=0;this.size=
1;this.objects.push(this._c())};z.prototype.update=function(a){for(var c=this.size-1,b,d=Math.max(this.objects.length-this._i,0);c>=d;)b=this.objects[c],b.update(a),b.isAlive()?c--:(this.objects=this.objects.splice(c,1).concat(this.objects),this._i--,d++)};z.prototype.render=function(){for(var a=Math.max(this.objects.length-this._i,0),b=this.size-1;b>=a;b--)this.objects[b].render()};l.prototype=z.prototype;l.class=z;var F=function(a,b){this._x=a||0;this._y=b||0};F.prototype.add=function(a,b){return x(this.x+
(a.x||0)*(b||1),this.y+(a.y||0)*(b||1))};F.prototype.clamp=function(a,b,d,e){this._c=!0;this._a=a;this._b=b;this._d=d;this._e=e};$jscomp.global.Object.defineProperties(F.prototype,{x:{configurable:!0,enumerable:!0,get:function(){return this._x},set:function(a){this._x=this._c?Math.min(Math.max(this._a,a),this._d):a}},y:{configurable:!0,enumerable:!0,get:function(){return this._y},set:function(a){this._y=this._c?Math.min(Math.max(this._b,a),this._e):a}}});x.prototype=F.prototype;x.class=F;var v=function(a){this.init(a)};
v.prototype.init=function(a){var c=a=void 0===a?{}:a,b=c.dx,d=c.dy,e=c.ddx,q=c.ddy,l=c.width,f=c.height,g=c.image;this.position=x(c.x,c.y);this.velocity=x(b,d);this.acceleration=x(e,q);this.width=this.height=this.rotation=0;this.ttl=Infinity;this.anchor={x:0,y:0};this.context=t;for(var h in a)this[h]=a[h];g&&(this.width=void 0!==l?l:g.width,this.height=void 0!==f?f:g.height)};v.prototype.isAlive=function(){return 0<this.ttl};v.prototype.collidesWith=function(a){if(this.rotation||a.rotation)return null;
var c=this.x-this.width*this.anchor.x,b=this.y-this.height*this.anchor.y,d=a.x,e=a.y;a.anchor&&(d-=a.width*a.anchor.x,e-=a.height*a.anchor.y);return c<d+a.width&&c+this.width>d&&b<e+a.height&&b+this.height>e};v.prototype.update=function(a){this.advance(a)};v.prototype.render=function(){this.draw()};v.prototype.playAnimation=function(a){this.currentAnimation=this.animations[a];this.currentAnimation.loop||this.currentAnimation.reset()};v.prototype.advance=function(a){this.velocity=this.velocity.add(this.acceleration,
a);this.position=this.position.add(this.velocity,a);this.ttl--;this.currentAnimation&&this.currentAnimation.update(a)};v.prototype.draw=function(){var a=-this.width*this.anchor.x,b=-this.height*this.anchor.y;this.context.save();this.context.translate(this.x,this.y);this.rotation&&this.context.rotate(this.rotation);this.image?this.context.drawImage(this.image,0,0,this.image.width,this.image.height,a,b,this.width,this.height):this.currentAnimation?this.currentAnimation.render({x:a,y:b,width:this.width,
height:this.height,context:this.context}):(this.context.fillStyle=this.color,this.context.fillRect(a,b,this.width,this.height));this.context.restore()};$jscomp.global.Object.defineProperties(v.prototype,{x:{configurable:!0,enumerable:!0,get:function(){return this.position.x},set:function(a){this.position.x=a}},y:{configurable:!0,enumerable:!0,get:function(){return this.position.y},set:function(a){this.position.y=a}},dx:{configurable:!0,enumerable:!0,get:function(){return this.velocity.x},set:function(a){this.velocity.x=
a}},dy:{configurable:!0,enumerable:!0,get:function(){return this.velocity.y},set:function(a){this.velocity.y=a}},ddx:{configurable:!0,enumerable:!0,get:function(){return this.acceleration.x},set:function(a){this.acceleration.x=a}},ddy:{configurable:!0,enumerable:!0,get:function(){return this.acceleration.y},set:function(a){this.acceleration.y=a}},animations:{configurable:!0,enumerable:!0,get:function(){return this._a},set:function(a){var c;this._a={};for(c in a){this._a[c]=a[c].clone();var b=b||this._a[c]}this.currentAnimation=
b;this.width=this.width||b.width;this.height=this.height||b.height}}});C.prototype=v.prototype;C.class=v;var L=function(a){var c=void 0===a?{}:a;a=c.image;var b=c.frameWidth,d=c.frameHeight,e=c.frameMargin;c=c.animations;if(!a)throw Error("You must provide an Image for the SpriteSheet");this.animations={};this.image=a;this.frame={width:b,height:d,margin:e};this._f=a.width/b|0;this.createAnimations(c)};L.prototype.createAnimations=function(a){var c;for(c in a){var d=a[c],e=d.frames,q=d.frameRate;d=
d.loop;var l=[];if(void 0===e)throw Error("Animation "+c+" must provide a frames property");[].concat(e).map(function(a){l=l.concat(aa(a))});this.animations[c]=b({spriteSheet:this,frames:l,frameRate:q,loop:d})}};Q.prototype=L.prototype;Q.class=L;return{Animation:b,imageAssets:B,audioAssets:D,dataAssets:A,setImagePath:function(a){V=a},setAudioPath:function(a){W=a},setDataPath:function(a){X=a},loadImage:p,loadAudio:y,loadData:G,load:function(a){for(var c=[],b=0;b<arguments.length;++b)c[b-0]=arguments[b];
h();return Promise.all(c.map(function(a){var c=[].concat(a)[0].split(".").pop();return c.match(ba)?p(a):c.match(ca)?y(a):G(a)}))},init:function(c){E=document.getElementById(c)||c||document.querySelector("canvas");if(!E)throw Error("You must provide a canvas element for the game");t=E.getContext("2d");t.imageSmoothingEnabled=!1;a("init");return{canvas:E,context:t}},getCanvas:function(){return E},getContext:function(){return t},emit:a,GameLoop:function(c){function b(){x=requestAnimationFrame(b);C=performance.now();
m=C-k;k=C;if(!(1E3<m)){a("tick");for(l+=m;l>=f;)n.update(g),l-=f;h();n.render()}}var d=void 0===c?{}:c;c=void 0===d.fps?60:d.fps;var e=void 0===d.clearCanvas?!0:d.clearCanvas,q=d.update;d=d.render;if(!q||!d)throw Error("You must provide update() and render() functions");var l=0,f=1E3/c,g=1/c,h=e?w:da,k,x,C,m,n;return n={update:q,render:d,isStopped:!0,start:function(){k=performance.now();this.isStopped=!1;requestAnimationFrame(b)},stop:function(){this.isStopped=!0;cancelAnimationFrame(x)},_frame:b,
set _last(a){k=a}}},keyMap:H,initKeys:function(){var a;for(a=0;26>a;a++)H[65+a]=(10+a).toString(36);for(a=0;10>a;a++)H[48+a]=""+a;window.addEventListener("keydown",O);window.addEventListener("keyup",P);window.addEventListener("blur",q)},bindKeys:function(a,b){[].concat(a).map(function(a){return K[a]=b})},unbindKeys:function(a){[].concat(a).map(function(a){return K[a]=0})},keyPressed:function(a){return!!J[a]},Pool:l,Sprite:C,SpriteSheet:Q,setStoreItem:function(a,b){void 0===b?localStorage.removeItem(a):
localStorage.setItem(a,JSON.stringify(b))},getStoreItem:function(a){a=localStorage.getItem(a);try{a=JSON.parse(a)}catch(r){}return a},Vector:x}}();"use strict";var e=a.init,f=a.Sprite,h=a.GameLoop,b=e().context;a.setImagePath("gfx/");a.initKeys();var p=a.getCanvas().width,d=a.getCanvas().height;a.load("player.bmp","vignette.bmp","skeleton.bmp","cloud.bmp").then(function(e){function k(){this.context.save();this.context.translate(-g.x+p/2,-g.y+d/2);this.draw();this.context.restore()}function m(){console.log("updating score to "+
N);document.getElementById("score").innerHTML=N}e=a.SpriteSheet({image:a.imageAssets.player,frameWidth:18,frameHeight:20,animations:{walk:{frames:"0..3",frameRate:12}}});var R=a.SpriteSheet({image:a.imageAssets.skeleton,frameWidth:24,frameHeight:32,animations:{walk:{frames:"0..2",frameRate:6}}}),N=0,g=f({lives:5,x:4800,y:4800,movement_speed:64,knockback:256,kx:0,ky:0,attack_delay:3,anchor:{x:.5,y:.5},animations:e.animations,update:function(b){this.dy=this.dx=0;a.keyPressed("up")&&(this.dy=-this.movement_speed);
a.keyPressed("down")&&(this.dy=this.movement_speed);a.keyPressed("left")&&(this.dx=-this.movement_speed);a.keyPressed("right")&&(this.dx=this.movement_speed);a.keyPressed("space")&&0>=this.attack_delay&&(y.make_puff(),this.attack(),this.attack_delay=3);this.attack_delay-=b;this.dx+=this.kx;this.dy+=this.ky;this.advance(b);this.kx*=.9;this.ky*=.9},render:k,alive:function(){return 0<this.lives},hit:function(a){var b=this.x-a.x;a=this.y-a.y;var d=Math.sqrt(b*b+a*a),e=this.knockback;this.kx=b*e/d;this.ky=
a*e/d;this.lives--;0==this.lives&&(console.log("playerDead"),clearInterval(Y));document.getElementById("lives").innerHTML=g.lives},attack:function(){for(var a=I.getAliveObjects(),b=0,d=a.length;b<d;b++){var e=a[b];3.2>Math.max(Math.abs(this.x-e.x)/10|0,Math.abs(this.y-e.y)/10|0)&&(e.ttl=0,N++,m())}}});g.playAnimation("walk");var I=a.Pool({maxSize:100,create:function(){var a=f({movement_speed:32,animations:R.animations,update:function(a){if(g.alive()){var b=(g.x-this.x)/20|0,d=(g.y-this.y)/20|0;Math.abs(b)>=
Math.abs(d)?(this.dx=b/Math.abs(b)*this.movement_speed,this.dy=0):(this.dy=d/Math.abs(d)*this.movement_speed,this.dx=0);this.advance(a);this.is_in_range(g)&&g.hit(this)}else this.dy=this.dx=0,this.advance()},render:k,is_in_range:function(a){return 1>Math.max(Math.abs(g.x-this.x)/20|0,Math.abs(g.y-this.y)/20|0)}});a.playAnimation("walk");return a}}),Y=setInterval(function(){var a=2*Math.PI*Math.random();I.get({ttl:Infinity,x:4800+w.size/2*Math.cos(a),y:4800+w.size/2*Math.sin(a),width:24,height:32,
anchor:{x:.5,y:.5}})},750),y=a.Pool({maxSize:32,create:function(){return f({image:a.imageAssets.cloud,update:function(a){var b=1-(75-this.ttl)/75;this.width=32*b;this.height=32*b;this.advance(a)},render:k})}});y.make_puff=function(){for(var a=0;8>a;a++){var b=2*Math.PI/8*a;this.get({ttl:75,x:g.x,y:g.y,dx:99*Math.cos(b),dy:99*Math.sin(b),ddx:-99*Math.cos(b),ddy:-99*Math.sin(b),anchor:{x:.5,y:.5}})}};var G=f({x:0,y:0,width:640,height:480,calc_ground_tile_color:function(a,b){return{h:((a|0)%2+(b|0)%
2)%2?120:90,s:100*(1-Math.min((Math.abs(a-240)+Math.abs(b-240))/40,1)),l:50}},render:function(){for(var a=this.width/20,b=this.height/20,d=a/2,e=b/2,f=(g.x|0)/20,h=(g.y|0)/20,k=(g.x|0)%20,m=(g.y|0)%20,t=0;t<=b;t++)for(var n=0;n<=a;n++){var p=this.calc_ground_tile_color(n+f-d,t+h-e);this.context.fillStyle="hsl("+p.h+", "+p.s+"%, "+p.l+"%)";this.context.fillRect(20*n-k,20*t-m,20,20);this.context.strokeStyle="#999";this.context.lineWidth=1;this.context.strokeRect(20*n-k,20*t-m,20,20)}}}),w=f({x:4800,
y:4800,size:1.5*p,range_counter:0,anchor:{x:.5,y:.5},image:a.imageAssets.vignette,update:function(a){var b=1+5*(1+Math.sin(this.range_counter++/20));this.width=this.size+b;this.height=this.size+b;this.advance(a)},render:k}),O=(w.size-p)/2,P=(w.size-d)/2;e=h({update:function(a){G.update(a);g.alive()&&g.update(a);I.update(a);y.update(a);w.update(a)},render:function(){b.fillStyle="black";b.fillRect(0,0,p,d);b.save();b.beginPath();b.rect(4800-O-g.x,4800-P-g.y,w.size,w.size);b.clip();G.render();g.alive()&&
g.render();I.render();y.render();w.render();b.restore()}});m();document.getElementById("lives").innerHTML=g.lives;e.start()})})();
