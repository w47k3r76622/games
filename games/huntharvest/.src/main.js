(()=>{"use strict";let t=()=>{};function e(t,e){let i=e.parentNode;if(t.setAttribute("data-kontra",""),i){let h=i.querySelector("[data-kontra]:last-of-type")||e;i.insertBefore(t,h.nextSibling)}else document.body.appendChild(t)}function i(t,e){let i=t.indexOf(e);if(-1!=i)return t.splice(i,1),!0}let h,n,s={};function r(t,e){s[t]=s[t]||[],s[t].push(e)}function a(t,...e){(s[t]||[]).map((t=>t(...e)))}let o={get:(e,i)=>"_proxy"==i||t};function _(){return h}function l(){return n}function d(t,e,i){return Math.min(Math.max(t,i),e)}function E(t,e){return[t,e]=[t,e].map((t=>c(t))),t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}function c(t){let{x:e=0,y:i=0,width:h,height:n}=t.world||t;return t.mapwidth&&(h=t.mapwidth,n=t.mapheight),t.anchor&&(e-=h*t.anchor.x,i-=n*t.anchor.y),h<0&&(e+=h,h*=-1),n<0&&(i+=n,n*=-1),{x:e,y:i,width:h,height:n}}class u{constructor(t=0,e=0,i={}){this.x=t,this.y=e,i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}add(t){return new u(this.x+t.x,this.y+t.y,this)}subtract(t){return new u(this.x-t.x,this.y-t.y,this)}scale(t){return new u(this.x*t,this.y*t)}normalize(t=this.length()){return new u(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}clamp(t,e,i,h){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=h}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?d(this._a,this._d,t):t}set y(t){this._y=this._c?d(this._b,this._e,t):t}}function S(){return new u(...arguments)}class A extends class{constructor(t){return this.init(t)}init(t={}){this.position=S(),this.velocity=S(),this.acceleration=S(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}{init({width:t=0,height:e=0,context:i=l(),render:h=this.draw,update:n=this.advance,children:s=[],anchor:r={x:0,y:0},opacity:a=1,rotation:o=0,scaleX:_=1,scaleY:d=1,...E}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:r,opacity:a,rotation:o,scaleX:_,scaleY:d,...E}),this._di=!0,this._uw(),this.addChild(s),this._rf=h,this._uf=n}update(t){this._uf(t),this.children.map((e=>e.update&&e.update(t)))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),1==this.scaleX&&1==this.scaleY||t.scale(this.scaleX,this.scaleY);let e=-this.width*this.anchor.x,i=-this.height*this.anchor.y;(e||i)&&t.translate(e,i),this.context.globalAlpha=this.opacity,this._rf(),(e||i)&&t.translate(-e,-i),this.children.map((t=>t.render&&t.render())),t.restore()}draw(){}_pc(){this._uw(),this.children.map((t=>t._pc()))}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:i=1,_wr:h=0,_wsx:n=1,_wsy:s=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=i*this.opacity,this._wsx=n*this.scaleX,this._wsy=s*this.scaleY,this._wx=this._wx*n,this._wy=this._wy*s,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wr=h+this.rotation;let{x:r,y:a}=function(t,e){let i=Math.sin(e),h=Math.cos(e);return{x:t.x*h-t.y*i,y:t.x*i+t.y*h}}({x:this._wx,y:this._wy},h);this._wx=r,this._wy=a,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...e){e.flat().map((e=>{this.children.push(e),e.parent=this,e._pc=e._pc||t,e._pc()}))}removeChild(...t){t.flat().map((t=>{i(this.children,t)&&(t.parent=null,t._pc())}))}get opacity(){return this._opa}set opacity(t){this._opa=t,this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}function T(){return new A(...arguments)}class L extends A{init({image:t,width:e=(t?t.width:void 0),height:i=(t?t.height:void 0),...h}={}){super.init({image:t,width:e,height:i,...h})}get animations(){return this._a}set animations(t){let e,i;for(e in this._a={},t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){super.advance(t),this.currentAnimation&&this.currentAnimation.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}function f(){return new L(...arguments)}let y=/(\d+)(\w+)/;class x extends A{init({text:t="",textAlign:e="",lineHeight:i=1,font:h=l().font,...n}={}){t=""+t,super.init({text:t,textAlign:e,lineHeight:i,font:h,...n}),this._p()}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=function(t){let e=t.match(y),i=+e[1];return{size:i,unit:e[2],computed:i}}(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context;if(t.font=this.font,!this._s.length&&this._fw){let e=this.text.split(" "),i=0,h=2;for(;h<=e.length;h++){let n=e.slice(i,h).join(" ");t.measureText(n).width>this._fw&&(this._s.push(e.slice(i,h-1).join(" ")),i=h-1)}this._s.push(e.slice(i,h).join(" "))}if(!this._s.length&&this.text.includes("\n")){let e=0;this.text.split("\n").map((i=>{this._s.push(i),e=Math.max(e,t.measureText(i).width)})),this._w=this._fw||e}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,e=this.textAlign,i=this.context;e=this.textAlign||("rtl"==i.canvas.dir?"right":"left"),t="right"==e?this.width:"center"==e?this.width/2|0:0,this._s.map(((h,n)=>{i.textBaseline="top",i.textAlign=e,i.fillStyle=this.color,i.font=this.font,i.fillText(h,t,this._fs*this.lineHeight*n)}))}}function p(){return new x(...arguments)}let g=new WeakMap,w={},I={},H={0:"left",1:"middle",2:"right"};function R(t,e){let{x:i,y:h,width:n,height:s}=c(t);do{i-=t.sx||0,h-=t.sy||0}while(t=t.parent);let r=e.x-Math.max(i,Math.min(e.x,i+n)),a=e.y-Math.max(h,Math.min(e.y,h+s));return r*r+a*a<e.radius*e.radius}function m(t,e){return parseFloat(t.getPropertyValue(e))||0}function C(t){let e=null!=t.button?H[t.button]:"left";I[e]=!0,D(t,"onDown")}function V(t){let e=null!=t.button?H[t.button]:"left";I[e]=!1,D(t,"onUp")}function v(t){D(t,"onOver")}function Y(t){g.get(t.target)._oo=null,I={}}function O(t,e,i){let h=function(t){let e=t._lf.length?t._lf:t._cf;for(let i=e.length-1;i>=0;i--){let h=e[i];if(h.collidesWithPointer?h.collidesWithPointer(t):R(h,t))return h}}(t);h&&h[e]&&h[e](i),w[e]&&w[e](i,h),"onOver"==e&&(h!=t._oo&&t._oo&&t._oo.onOut&&t._oo.onOut(i),t._oo=h)}function D(t,e){t.preventDefault();let i=t.target,h=g.get(i),{scaleX:n,scaleY:s,offsetX:r,offsetY:o}=function(t){let{canvas:e,_s:i}=t,h=e.getBoundingClientRect(),n="none"!=i.transform?i.transform.replace("matrix(","").split(","):[1,1,1,1],s=parseFloat(n[0]),r=parseFloat(n[3]),a=(m(i,"border-left-width")+m(i,"border-right-width"))*s,o=(m(i,"border-top-width")+m(i,"border-bottom-width"))*r,_=(m(i,"padding-left")+m(i,"padding-right"))*s,l=(m(i,"padding-top")+m(i,"padding-bottom"))*r;return{scaleX:(h.width-a-_)/e.width,scaleY:(h.height-o-l)/e.height,offsetX:h.left+(m(i,"border-left-width")+m(i,"padding-left"))*s,offsetY:h.top+(m(i,"border-top-width")+m(i,"padding-top"))*r}}(h);t.type.includes("touch")?(Array.from(t.touches).map((({clientX:t,clientY:e,identifier:i})=>{let a=h.touches[i];a||(a=h.touches[i]={start:{x:(t-r)/n,y:(e-o)/s}},h.touches.length++),a.changed=!1})),Array.from(t.changedTouches).map((({clientX:i,clientY:_,identifier:l})=>{let d=h.touches[l];d.changed=!0,d.x=h.x=(i-r)/n,d.y=h.y=(_-o)/s,O(h,e,t),a("touchChanged",t,h.touches),"onUp"==e&&(delete h.touches[l],h.touches.length--,h.touches.length||a("touchEnd"))}))):(h.x=(t.clientX-r)/n,h.y=(t.clientY-o)/s,O(h,e,t))}function N(t){let e=t.canvas;t.clearRect(0,0,e.width,e.height)}let M={set:(t,e,i)=>(e.startsWith("_")||(t._d=!0),Reflect.set(t,e,i))},G={start:t=>t?1:0,center:()=>.5,end:t=>t?0:1};class P extends A{init({flow:t="column",align:e="start",justify:i="start",colGap:h=0,rowGap:n=0,numCols:s=1,dir:r="",breakpoints:a=[],...o}={}){return super.init({flow:t,align:e,justify:i,colGap:h,rowGap:n,numCols:s,dir:r,breakpoints:a,...o}),this._p(),new Proxy(this,M)}addChild(t){this._d=!0,super.addChild(t)}removeChild(t){this._d=!0,super.removeChild(t)}render(){this._d&&this._p(),super.render()}destroy(){this.children.map((t=>t.destroy&&t.destroy()))}_p(){this._d=!1,this.breakpoints.map((t=>{t.metric.call(this)&&this._b!==t&&(this._b=t,t.callback.call(this))}));let t=this._g=[],e=this._cw=[],i=this._rh=[],h=this.children,n=this._nc="column"==this.flow?1:"row"==this.flow?h.length:this.numCols,s=0,r=0;for(let a,o=0;a=h[o];o++){t[s]=t[s]||[],a._p&&a._p();let{width:h,height:o}=a.world||a;i[s]=Math.max(i[s]||0,o);let _=a.colSpan||1,l=_;do{e[r]=Math.max(e[r]||0,h/l),t[s][r]=a}while(r++<=n&&--_);r>=n&&(r=0,s++)}for(;r>0&&r<n;)t[s][r++]=!1;let a=t.length,o=[].concat(this.colGap),_=[].concat(this.rowGap);this._w=e.reduce(((t,e)=>t+e),0);for(let t=0;t<n-1;t++)this._w+=o[t%o.length];this._h=i.reduce(((t,e)=>t+e),0);for(let t=0;t<a-1;t++)this._h+=_[t%_.length];this._uw();let l="rtl"==this.context.canvas.dir&&!this.dir||"rtl"==this.dir;this._rtl=l,l&&(this._g=t.map((t=>t.reverse())),this._cw=e.reverse(),o=o.reverse());let d=-this.anchor.y*this.height,E=[],c=[].concat(this.justify),u=[].concat(this.align);this._g.map(((t,h)=>{let n=-this.anchor.x*this.width;t.map(((t,s)=>{if(t&&!E.includes(t)){E.push(t);let r=G[t.justifySelf||c[s%c.length]](this._rtl),a=G[t.alignSelf||u[h%u.length]](),_=t.colSpan||1,l=e[s];if(_>1&&s+_<=this._nc)for(let t=1;t<_;t++)l+=e[s+t]+o[(s+t)%o.length];let S=l*r,A=i[h]*a,T=0,L=0,{width:f,height:y}=t.world||t;t.anchor&&(T=t.anchor.x,L=t.anchor.y),0==r?S+=f*T:.5==r?S+=(T<.5?-1:.5==T?0:1)*f*r:S-=f*(1-T),0==a?A+=y*L:.5==a?A+=(L<.5?-1:.5==L?0:1)*y*a:A-=y*(1-L),t.x=n+S,t.y=d+A}n+=e[s]+o[s%o.length]})),d+=i[h]+_[h%_.length]}))}}function U(){return new P(...arguments)}let W={},b={},K={},X={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function B(e=t,i){e._pd&&i.preventDefault(),e(i)}function F(t){let e=X[t.code],i=W[e];K[e]=!0,B(i,t)}function k(t){let e=X[t.code],i=b[e];K[e]=!1,B(i,t)}function J(){K={}}function j(){let t;for(t=0;t<26;t++)X["Key"+String.fromCharCode(t+65)]=String.fromCharCode(t+97);for(t=0;t<10;t++)X["Digit"+t]=X["Numpad"+t]=""+t;window.addEventListener("keydown",F),window.addEventListener("keyup",k),window.addEventListener("blur",J)}function q(t,e,{handler:i="keydown",preventDefault:h=!0}={}){let n="keydown"==i?W:b;e._pd=h,[].concat(t).map((t=>n[t]=e))}function z(t){let e=[];return t._dn?e.push(t._dn):t.children&&t.children.map((t=>{e=e.concat(z(t))})),e}class Q{constructor({id:t,name:i=t,objects:h=[],context:n=l(),cullObjects:s=!0,cullFunction:r=E,sortFunction:a,...o}){this._o=[];let _=n.canvas,d=this._dn=document.createElement("section");d.tabIndex=-1,d.style="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);",d.id=t,d.setAttribute("aria-label",i),e(d,_),Object.assign(this,{id:t,name:i,context:n,cullObjects:s,cullFunction:r,sortFunction:a,...o});let{width:c,height:u}=_,S=c/2,A=u/2;this.camera=T({x:S,y:A,width:c,height:u,context:n,centerX:S,centerY:A,anchor:{x:.5,y:.5},render:this._rf.bind(this)}),this.add(h)}set objects(t){this.remove(this._o),this.add(t)}get objects(){return this._o}add(...t){t.flat().map((t=>{this._o.push(t),z(t).map((t=>{this._dn.appendChild(t)}))}))}remove(...t){t.flat().map((t=>{i(this._o,t),z(t).map((t=>{e(t,this.context)}))}))}show(){this.hidden=this._dn.hidden=!1;let t=this._o.find((t=>t.focus));t?t.focus():this._dn.focus(),this.onShow()}hide(){this.hidden=this._dn.hidden=!0,this.onHide()}destroy(){this._dn.remove(),this._o.map((t=>t.destroy&&t.destroy()))}lookAt(t){let{x:e,y:i}=t.world||t;this.camera.x=e,this.camera.y=i}update(t){this.hidden||this._o.map((e=>e.update&&e.update(t)))}_rf(){let{_o:t,context:e,_sx:i,_sy:h,camera:n,sortFunction:s,cullObjects:r,cullFunction:a}=this;e.translate(i,h);let o=t;r&&(o=o.filter((t=>a(n,t)))),s&&o.sort(s),o.map((t=>t.render&&t.render()))}render(){if(!this.hidden){let{context:t,camera:e}=this,{x:i,y:h,centerX:n,centerY:s}=e;t.save(),this._sx=n-i,this._sy=s-h,t.translate(this._sx,this._sy),e.render(),t.restore()}}onShow(){}onHide(){}}const Z={UNIT_PIXELS:100,LAND_THICKNESS:20,GRAVITY_DDY:2e3,UNIT_MOVE_ROTATION:Math.PI/12,ENEMY_SPAWN_INTERVAL:3500,SOULS_NEEDED:20,PLAYER_TYPE:"player",PLAYER_WIDTH:100,PLAYER_HEIGHT:240,PLAYER_MOVE_VELOCITY:300,PLAYER_JUMP_VELOCITY:1e3,PLAYER_HUNTER_MAX_HEALTH:100,PLAYER_DEATH_MAX_HEALTH:150,ATTACK_TYPE:"attack",BULLET_WIDTH:50,BULLET_HEIGHT:25,BULLET_VELOCITY:1600,BULLET_MAX_DISTANCE:800,BULLET_THROTTLE:600,BULLET_DAMAGE:50,SCYTH_ANIMATION_DURATION:200,SCYTH_INTERVAL:500,SCYTH_START_ANGLE:Math.PI/2,SCYTH_END_ANGLE:.1*-Math.PI,SCYTH_DAMAGE:100,ENEMY_TYPE:"enemy",WALKER_WIDTH:100,WALKER_HEIGHT:200,WALKER_MOVE_VELOCITY:100,WALKER_JUMP_VELOCITY:1200,WALKER_MAX_HEALTH:100,WALKER_DAMAGE:10,WALKER_ATTACK_THROTTLE:1e3,WALKER_GHOST_WIDTH:100,WALKER_GHOST_HEIGHT:200,WALKER_GHOST_MOVE_VELOCITY:50,WALKER_GHOST_MAX_HEALTH:100,WALKER_GHOST_ATTACK_INTERVAL:3e3,GHOST_FIRE_WIDTH:50,GHOST_FIRE_HEIGHT:50,GHOST_FIRE_VELOCITY:350,GHOST_FIRE_MAX_DISTANCE:700,GHOST_FIRE_DAMAGE:15,GHOST_FIRE_CURVE_VELOCITY:400,VESSEL_TYPE:"vessel",VESSEL_RADIUS:160,VESSEL_EYE_RADIUS:50,VESSEL_LEG_WIDTH:80,VESSEL_LEG_HEIGHT:120,VESSEL_MAX_HEALTH:1e3,VESSEL_MOVE_VELOCITY:200,VESSEL_JUMP_VELOCITY:800,VESSEL_MOVE_INTERVAL:1e3,VESSEL_ATTACK_INTERVAL:2e3,VESSEL_SOUL_MAX_HEALTH:500,VESSEL_TEAR_WIDTH:60,VESSEL_TEAR_HEIGHT:25,VESSEL_TEAR_VELOCITY:500,VESSEL_TEAR_MAX_DISTANCE:800,VESSEL_TEAR_DAMAGE:10,VESSEL_CANON_WIDTH:60,VESSEL_CANON_HEIGHT:60,VESSEL_CANON_MIN_VELOCITY:300,VESSEL_CANON_MAX_VELOCITY:800,VESSEL_CANON_Y_VELOCITY:1e3,VESSEL_CANON_DAMAGE:10,VESSEL_CANON_BLAST_RADIUS:160,VESSEL_CANON_BLAST_LIFETIME:300,VESSEL_CANON_BLAST_DAMAGE:20};function $(t,e,i){return p({text:"",color:"white",font:"bold 32px Arial",x:t.x,y:t.y,anchor:{x:.5,y:1},textAlign:"center",update:function(){var t=i(),h=t/e;this.text="".concat(t," / ").concat(e),this.color=h>.7?"green":h<.3?"red":"yellow"}})}function tt(t,e,i){void 0===i&&(i=!1);var h=t,n=null,s=f({x:t.x,y:t.y,width:Z.WALKER_WIDTH,height:Z.WALKER_HEIGHT,anchor:{x:0,y:1},color:"green",rotation:-Math.PI/12,dx:-Z.WALKER_MOVE_VELOCITY,initCoord:h,type:Z.ENEMY_TYPE,health:Z.WALKER_MAX_HEALTH,damage:Z.WALKER_DAMAGE,isJumper:i,render:function(){var t=this.context;t.fillStyle="#379139",t.fillRect(0,0,Z.WALKER_WIDTH,Z.WALKER_HEIGHT),t.fillStyle="#3FBC3D",t.fillRect(-50,.3*Z.WALKER_HEIGHT,100,30),t.fillStyle="red",t.fillRect(0,.1*Z.WALKER_HEIGHT,30,10)},update:function(t){i&&(this.y===h.y?(this.dy=-Z.WALKER_JUMP_VELOCITY,this.ddy=Z.GRAVITY_DDY):this.y>h.y&&(this.dy=0,this.ddy=0,this.y=h.y));for(var s=0,r=e.children;s<r.length;s++){var o=r[s];if(o.type===Z.PLAYER_TYPE&&E(this,o))return void(n||(n=setTimeout((function(){return n=null}),Z.WALKER_ATTACK_THROTTLE),o.health-=this.damage,console.log("hunter hp",o.health),o.health<=0&&a("gameover",!1)))}this.advance(t)}}),r=$(S(0,-Z.WALKER_HEIGHT-20),Z.WALKER_MAX_HEALTH,(function(){return s.health}));return s.addChild(r),s}function et(t,e){var i=t;return f({x:t.x,y:t.y,width:Z.VESSEL_TEAR_WIDTH,height:Z.VESSEL_TEAR_HEIGHT,anchor:{x:0,y:.5},color:"red",dx:-Z.VESSEL_TEAR_VELOCITY,type:Z.ATTACK_TYPE,damage:Z.VESSEL_TEAR_DAMAGE,update:function(t){if(this.advance(t),this.x>i.x+Z.VESSEL_TEAR_MAX_DISTANCE)e.removeChild(this);else for(var h=0,n=e.children;h<n.length;h++){var s=n[h];if(s.type===Z.PLAYER_TYPE&&E(this,s)){e.removeChild(this),s.health-=this.damage,s.health<=0&&a("gameover",!1);break}}}})}function it(t,e,i){return f({x:t.x,y:t.y,width:Z.VESSEL_CANON_WIDTH,height:Z.VESSEL_CANON_HEIGHT,anchor:{x:1,y:.5},color:"red",dx:-Math.floor(Math.random()*(Z.VESSEL_CANON_MAX_VELOCITY-Z.VESSEL_CANON_MIN_VELOCITY)+Z.VESSEL_CANON_MIN_VELOCITY),dy:Z.VESSEL_CANON_Y_VELOCITY*(i?1:-1),ddy:Z.GRAVITY_DDY*(i?-1:1),type:Z.ATTACK_TYPE,damage:Z.VESSEL_CANON_DAMAGE,update:function(t){if(this.advance(t),i&&this.y<this.context.canvas.height/2+Z.LAND_THICKNESS/2||!i&&this.y>this.context.canvas.height/2-Z.LAND_THICKNESS/2){var h=function(t,e,i){var h=0,n=!1;return f({x:t.x,y:t.y,width:2*Z.VESSEL_CANON_BLAST_RADIUS,height:Z.VESSEL_CANON_BLAST_RADIUS,anchor:{x:.5,y:i?0:1},color:"red",type:Z.ATTACK_TYPE,damage:Z.VESSEL_CANON_BLAST_DAMAGE,render:function(){var t=this.context;t.fillStyle="red",t.beginPath(),t.ellipse(0,Z.VESSEL_CANON_BLAST_RADIUS*(i?0:1),Z.VESSEL_CANON_BLAST_RADIUS,Z.VESSEL_CANON_BLAST_RADIUS,i?Math.PI:0,-Math.PI,0),t.fill()},update:function(t){if(this.advance(t),(h+=1e3*(t||0))>=Z.VESSEL_CANON_BLAST_LIFETIME)e.removeChild(this);else if(!n)for(var i=0,s=e.children;i<s.length;i++){var r=s[i];if(r.type===Z.PLAYER_TYPE&&E(this,r)){n=!0,r.health-=this.damage,r.health<=0&&a("gameover",!1);break}}}})}(S(this.x,this.y),e,i);e.addChild(h),e.removeChild(this)}else for(var n=0,s=e.children;n<s.length;n++){var r=s[n];if(r.type===Z.PLAYER_TYPE&&E(this,r)){e.removeChild(this),r.health-=this.damage,r.health<=0&&a("gameover",!1);break}}}})}function ht(t,e){var i=null,h=f({x:t.x,y:t.y,width:Z.WALKER_GHOST_WIDTH,height:Z.WALKER_GHOST_HEIGHT,anchor:{x:0,y:0},color:"gray",dx:-Z.WALKER_GHOST_MOVE_VELOCITY,type:Z.ENEMY_TYPE,health:Z.WALKER_GHOST_MAX_HEALTH,render:function(){var t=this.context;t.fillStyle="gray",t.fillRect(0,0,Z.WALKER_GHOST_WIDTH,Z.WALKER_GHOST_HEIGHT),t.fillStyle="#4d4d4d",t.fillRect(-50,.7*Z.WALKER_GHOST_HEIGHT-30,100,30),t.fillStyle="red",t.fillRect(0,.9*Z.WALKER_GHOST_HEIGHT-10,30,10)},update:function(t){if(this.advance(t),!i){i=setTimeout((function(){return i=null}),Z.WALKER_GHOST_ATTACK_INTERVAL);var h=function(t,e){var i=t;return f({x:t.x,y:t.y,width:Z.GHOST_FIRE_WIDTH,height:Z.GHOST_FIRE_HEIGHT,anchor:{x:1,y:.5},color:"red",dx:-Z.GHOST_FIRE_VELOCITY,type:Z.ATTACK_TYPE,damage:Z.GHOST_FIRE_DAMAGE,update:function(t){if(this.advance(t),this.x<i.x-Z.GHOST_FIRE_MAX_DISTANCE)e.removeChild(this);else for(var h=0,n=e.children;h<n.length;h++){var s=n[h];if(s.type===Z.PLAYER_TYPE&&E(this,s)){e.removeChild(this),s.health-=this.damage,s.health<=0&&a("gameover",!1);break}}}})}(S(this.x,this.y+this.height/2),e);e.addChild(h)}}}),n=$(S(0,Z.WALKER_GHOST_HEIGHT+60),Z.WALKER_GHOST_MAX_HEALTH,(function(){return h.health}));return h.addChild(n),h}var nt,st;function rt(t,e){var i=t,h=null,n=f({x:t.x,y:t.y,width:2*Z.VESSEL_RADIUS,height:Z.VESSEL_RADIUS,anchor:{x:0,y:0},initCoord:i,type:Z.VESSEL_TYPE,health:Z.VESSEL_SOUL_MAX_HEALTH,render:function(){var t=this.context;t.fillStyle="#aaaaaa",t.beginPath(),t.ellipse(0,Z.VESSEL_RADIUS,Z.VESSEL_RADIUS,Z.VESSEL_RADIUS,0,0,2*Math.PI),t.fill(),t.fillStyle="#b20000",t.beginPath(),t.ellipse(Z.VESSEL_EYE_RADIUS-Z.VESSEL_RADIUS,Z.VESSEL_RADIUS,Z.VESSEL_EYE_RADIUS,Z.VESSEL_EYE_RADIUS,0,0,2*Math.PI),t.fill()},update:function(t){if(this.advance(t),!h)if(h=setTimeout((function(){return h=null}),Z.VESSEL_ATTACK_INTERVAL),Math.random()<.5){var i=et(S(this.x-this.width/2,this.y+this.height),e);e.addChild(i)}else{var n=it(S(this.x-this.width/2,this.y+this.height),e,!0);e.addChild(n)}}}),s=$(S(0,2*Z.VESSEL_RADIUS+60),Z.VESSEL_SOUL_MAX_HEALTH,(function(){return n.health}));return n.addChild(s),n}!function(t){t[t.STILL=1]="STILL",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.JUMP_FORWARD=4]="JUMP_FORWARD",t[t.JUMP_BACKWARD=5]="JUMP_BACKWARD"}(nt||(nt={})),function(t){t[t.WALKER=1]="WALKER",t[t.JUMPER=2]="JUMPER",t[t.GHOST=3]="GHOST",t[t.FLYING_GHOST=4]="FLYING_GHOST",t[t.THE_VESSEL=5]="THE_VESSEL"}(st||(st={}));const at=function(t,e){var i,h,n,s,o,l,d=T(),c=function(){return new Q(...arguments)}({id:"main",objects:[d],cullObjects:!1}),u=f({x:0,y:t.height/2,width:t.width,height:Z.LAND_THICKNESS,anchor:{x:0,y:.5},color:"white"}),A=(i=S(200,t.height/2-Z.LAND_THICKNESS/2),h=i,n=null,s=f({x:0,y:.6*-Z.PLAYER_HEIGHT,anchor:{x:.5,y:.5},render:function(){var t=this.context;t.fillStyle="brown",t.fillRect(-50,0,50,40),t.fillStyle="silver",t.fillRect(0,0,150,25)}}),o=f({x:i.x,y:i.y,width:Z.PLAYER_WIDTH,height:Z.PLAYER_HEIGHT,anchor:{x:.5,y:1},color:"blue",ttl:5,type:Z.PLAYER_TYPE,health:Z.PLAYER_HUNTER_MAX_HEALTH,gun:s,update:function(t){this.advance(t),this.y>h.y&&(this.y=h.y,this.dy=0,this.ddy=0),this.gun.rotation=-this.rotation},shoot:function(t){if(!n){n=setTimeout((function(){return n=null}),Z.BULLET_THROTTLE);var e=function(t,e){var i=t;return f({x:t.x,y:t.y,width:Z.BULLET_WIDTH,height:Z.BULLET_HEIGHT,anchor:{x:0,y:.5},color:"yellow",dx:Z.BULLET_VELOCITY,type:Z.ATTACK_TYPE,damage:Z.BULLET_DAMAGE,update:function(t){if(this.advance(t),this.x>i.x+Z.BULLET_MAX_DISTANCE)e.removeChild(this);else for(var h=0,n=e.children;h<n.length;h++){var s=n[h];if([Z.ENEMY_TYPE,Z.VESSEL_TYPE].includes(s.type)&&E(this,s)){if(e.removeChild(this),s.health-=this.damage,s.health<=0)if(s.type===Z.ENEMY_TYPE){var r=ht(S(s.x,s.initCoord.y+2*Z.LAND_THICKNESS+(s.isJumper?1.3*Z.WALKER_GHOST_HEIGHT:0)),e);e.addChild(r),e.removeChild(s)}else if(s.type===Z.VESSEL_TYPE){var a=rt(S(s.x,s.initCoord.y+2*Z.LAND_THICKNESS),e);e.addChild(a),e.removeChild(s)}break}}}})}(S(this.x+this.width,this.y-.6*this.height),t);t.addChild(e)}}}),l=$(S(0,-Z.PLAYER_HEIGHT-20),Z.PLAYER_HUNTER_MAX_HEALTH,(function(){return o.health})),o.addChild(s),o.addChild(l),o),L=function(t,e){var i=t,h=null,n=function(t){var e=!1,i=!1,h=!1;return f({x:0,y:.6*Z.PLAYER_HEIGHT,width:320,height:80,anchor:{x:0,y:.5},rotation:Z.SCYTH_START_ANGLE,type:Z.ATTACK_TYPE,damage:Z.SCYTH_DAMAGE,render:function(){var t=this.context;t.fillStyle="brown",t.fillRect(-50,0,250,20),t.fillStyle="silver",t.fillRect(200,-60,20,80)},update:function(n){if(n&&(i&&this.rotation<=Z.SCYTH_START_ANGLE&&this.rotation>Z.SCYTH_END_ANGLE?(this.rotation-=n/(Z.SCYTH_ANIMATION_DURATION/1e3)*Math.PI,this.rotation<=Z.SCYTH_END_ANGLE&&(i=!1,h=!0)):h&&(this.rotation+=n/(Z.SCYTH_ANIMATION_DURATION/1e3)*Math.PI,this.rotation>=Z.SCYTH_START_ANGLE&&(h=!1,e=!1,this.rotation=Z.SCYTH_START_ANGLE)),!e&&(i||h)))for(var s=0,r=t.children;s<r.length;s++){var o=r[s];[Z.ENEMY_TYPE,Z.VESSEL_TYPE].includes(o.type)&&E(this,o)&&(e=!0,o.health-=this.damage,o.health<=0&&(a("harvest"),t.removeChild(o),o.type===Z.VESSEL_TYPE&&a("gameover",!0)))}},attack:function(){i=!0}})}(e),s=f({x:t.x,y:t.y,width:Z.PLAYER_WIDTH,height:Z.PLAYER_HEIGHT,anchor:{x:.5,y:0},color:"#0000b2",type:Z.PLAYER_TYPE,health:Z.PLAYER_DEATH_MAX_HEALTH,scyth:n,update:function(t){this.advance(t),this.y<i.y&&(this.y=i.y,this.dy=0,this.ddy=0)},harvest:function(){h||(h=setTimeout((function(){return h=null}),Z.SCYTH_INTERVAL),this.scyth.attack())}}),r=$(S(0,Z.PLAYER_HEIGHT+60),Z.PLAYER_DEATH_MAX_HEALTH,(function(){return s.health}));return s.addChild(n),s.addChild(r),s}(S(200,t.height/2+Z.LAND_THICKNESS/2),d);d.addChild(u),d.addChild(A),d.addChild(L);var y=function(t){var e=0,i=Z.ENEMY_SPAWN_INTERVAL,h=0,n=!1;r("harvest",(function(){console.log("harvest"),h<Z.SOULS_NEEDED&&(h+=1)}));var s=T({x:0,y:0,width:0,height:0,update:function(s){if(!n){if(h>=Z.SOULS_NEEDED)return n=!0,void setTimeout((function(){var e=t.context.canvas,i=t.objects[0];i.children.forEach((function(t){t.type===Z.ENEMY_TYPE&&i.removeChild(t)}));var h=function(t,e){var i=t,h=null,n=1,s=!1,r=0,a=f({x:t.x,y:t.y,width:2*Z.VESSEL_RADIUS,height:Z.VESSEL_RADIUS,anchor:{x:0,y:1},initCoord:i,type:Z.VESSEL_TYPE,health:Z.VESSEL_MAX_HEALTH,render:function(){var t=this.context;t.fillStyle="#379139",t.fillRect(-Z.VESSEL_RADIUS-10,Z.VESSEL_RADIUS-Z.VESSEL_LEG_HEIGHT,Z.VESSEL_LEG_WIDTH,Z.VESSEL_LEG_HEIGHT),t.fillRect(Z.VESSEL_RADIUS-Z.VESSEL_LEG_WIDTH-10,Z.VESSEL_RADIUS-Z.VESSEL_LEG_HEIGHT,Z.VESSEL_LEG_WIDTH,Z.VESSEL_LEG_HEIGHT),t.fillStyle="white",t.beginPath(),t.ellipse(0,-20,Z.VESSEL_RADIUS,Z.VESSEL_RADIUS,0,0,2*Math.PI),t.fill(),t.fillStyle="red",t.beginPath(),t.ellipse(Z.VESSEL_EYE_RADIUS-Z.VESSEL_RADIUS,-20,Z.VESSEL_EYE_RADIUS,Z.VESSEL_EYE_RADIUS,0,0,2*Math.PI),t.fill(),t.fillStyle="#3FBC3D",t.fillRect(10-Z.VESSEL_RADIUS,Z.VESSEL_RADIUS-Z.VESSEL_LEG_HEIGHT,Z.VESSEL_LEG_WIDTH,Z.VESSEL_LEG_HEIGHT),t.fillRect(Z.VESSEL_RADIUS-Z.VESSEL_LEG_WIDTH+10,Z.VESSEL_RADIUS-Z.VESSEL_LEG_HEIGHT,Z.VESSEL_LEG_WIDTH,Z.VESSEL_LEG_HEIGHT)},update:function(t){if(this.advance(t),s){var a=!1;switch(n){case nt.STILL:case nt.FORWARD:case nt.BACKWARD:(r+=1e3*t)>Z.VESSEL_MOVE_INTERVAL&&(a=!0);break;case nt.JUMP_FORWARD:case nt.JUMP_BACKWARD:this.y>i.y&&(this.y=i.y,this.dx=0,this.dy=0,this.ddy=0,a=!0)}if(a){r=0,s=!1;var o=[1,2,3,4,5];this.x<=this.context.canvas.width/2?o=[3,5]:this.x>=this.context.canvas.width-this.width&&(o=[2,4]),n=o[Math.floor(Math.random()*o.length)]}}else switch(s=!0,n){case nt.FORWARD:this.dx=-Z.VESSEL_MOVE_VELOCITY;break;case nt.BACKWARD:this.dx=Z.VESSEL_MOVE_VELOCITY;break;case nt.JUMP_FORWARD:this.dx=-Z.VESSEL_MOVE_VELOCITY,this.dy=-Z.VESSEL_JUMP_VELOCITY,this.ddy=Z.GRAVITY_DDY;break;case nt.JUMP_BACKWARD:this.dx=Z.VESSEL_MOVE_VELOCITY,this.dy=-Z.VESSEL_JUMP_VELOCITY,this.ddy=Z.GRAVITY_DDY}if(!h){h=setTimeout((function(){return h=null}),Z.VESSEL_ATTACK_INTERVAL);var _=Math.random();if(_<.4){var l=et(S(this.x-this.width/2,this.y-this.height),e);e.addChild(l)}else if(_>.6){var d=it(S(this.x-this.width/2,this.y-this.height),e,!1);e.addChild(d)}else{var E=ht(S(this.x,i.y+2*Z.LAND_THICKNESS+(Math.random()>.5?1.3*Z.WALKER_GHOST_HEIGHT:0)),e);e.addChild(E)}}}}),o=$(S(0,2*-Z.VESSEL_RADIUS-20-20),Z.VESSEL_MAX_HEALTH,(function(){return a.health}));return a.addChild(o),a}(S(e.width-100,e.height/2-Z.LAND_THICKNESS/2),i);i.addChild(h)}),1e3);if((e+=1e3*s)>i){var r=t.context.canvas,a=t.objects[0],o=h>Z.SOULS_NEEDED/2?.5:h/(Z.SOULS_NEEDED/2)*.5;switch(Math.random()>o?st.WALKER:st.JUMPER){case st.WALKER:var _=tt(S(r.width,r.height/2-Z.LAND_THICKNESS/2),a);a.addChild(_);break;case st.JUMPER:var l=tt(S(r.width,r.height/2-Z.LAND_THICKNESS/2),a,!0);a.addChild(l)}e=0,i=Z.ENEMY_SPAWN_INTERVAL+1e3*Math.random()-800}}}}),a=p({x:40,y:40,text:"",color:"white",font:"bold 32px Arial",update:function(){this.text="Souls Harvested: ".concat(h," / ").concat(Z.SOULS_NEEDED)}});return s.addChild(a),s}(c);return d.addChild(y),j(),q("space",(function(){0===A.ddy&&(A.dy=-Z.PLAYER_JUMP_VELOCITY,A.ddy=Z.GRAVITY_DDY),0===L.ddy&&(L.dy=Z.PLAYER_JUMP_VELOCITY,L.ddy=-Z.GRAVITY_DDY)})),q(["a","left"],(function(){0===A.dx&&(A.dx=-Z.PLAYER_MOVE_VELOCITY,A.rotation=-Z.UNIT_MOVE_ROTATION),0===L.dx&&(L.dx=-Z.PLAYER_MOVE_VELOCITY,L.rotation=Z.UNIT_MOVE_ROTATION)}),{handler:"keydown"}),q(["a","left"],(function(){A.dx<0&&(A.dx=0,A.rotation=0),L.dx<0&&(L.dx=0,L.rotation=0)}),{handler:"keyup"}),q(["d","right"],(function(){0===A.dx&&(A.dx=Z.PLAYER_MOVE_VELOCITY,A.rotation=Z.UNIT_MOVE_ROTATION),0===L.dx&&(L.dx=Z.PLAYER_MOVE_VELOCITY,L.rotation=-Z.UNIT_MOVE_ROTATION)}),{handler:"keydown"}),q(["d","right"],(function(){A.dx>0&&(A.dx=0,A.rotation=0),L.dx>0&&(L.dx=0,L.rotation=0)}),{handler:"keyup"}),function({radius:t=5,canvas:e=_()}={}){let i=g.get(e);if(!i){let h=window.getComputedStyle(e);i={x:0,y:0,radius:t,touches:{length:0},canvas:e,_cf:[],_lf:[],_o:[],_oo:null,_s:h},g.set(e,i)}e.addEventListener("mousedown",C),e.addEventListener("touchstart",C),e.addEventListener("mouseup",V),e.addEventListener("touchend",V),e.addEventListener("touchcancel",V),e.addEventListener("blur",Y),e.addEventListener("mousemove",v),e.addEventListener("touchmove",v),i._t||(i._t=!0,r("tick",(()=>{i._lf.length=0,i._cf.map((t=>{i._lf.push(t)})),i._cf.length=0})))}(),function(t,e){let i=t[0].toUpperCase()+t.substr(1);w["on"+i]=e}("up",(function(t){0===t.button?A.shoot(d):2===t.button&&L.harvest()})),c};var ot=function(t,{contextless:e=!1}={}){if(h=document.getElementById(t)||t||document.querySelector("canvas"),e&&(h=h||new Proxy({},o)),!h)throw Error("You must provide a canvas element for the game");return n=h.getContext("2d")||new Proxy({},o),n.imageSmoothingEnabled=!1,a("init"),{canvas:h,context:n}}(document.getElementById("main-canvas")),_t=ot.canvas;ot.context;j();var lt=function(){_t.width=_t.parentElement.clientWidth,_t.height=_t.parentElement.clientHeight},dt=null,Et=null;r("gameover",(function(t){Et.stop(),dt.objects.forEach((function(t){return dt.remove(t)}));var e=function(t,e){var i=p({text:e?'\n    "Well done my children\n    The souls you harvested are delicious!"\n    ':"\n    You Died\n    (Can Death die?)\n    ",font:"bold 40px serif",color:"#aaaaaa",textAlign:"center",lineHeight:1.5}),h=p({text:"\n\nRefresh the web page to restart",font:"bold 40px Arial",color:"#aaaaaa",textAlign:"center",lineHeight:1.5});return U({x:t.width/2,y:t.height/2,anchor:{x:.5,y:.5},rowGap:15,justify:"center",children:[i,h]})}(_t,t);dt.add(e)})),window.addEventListener("load",(function(){lt();var e=function(t){var e=p({text:"\n    When The Eternal Night falls\n    the twins of Life and Death\n    shall hunt down The Abominations' body\n    and harvest their souls\n    to quench The Night Mother's thirst\n    \n                              ---- Prophecy\n    ",font:"bold 40px serif",color:"#aaaaaa",textAlign:"center",lineHeight:1.5}),i=p({text:"\n\nPress [Space] to start\n    Press [Esc] at any time to learn the controls",font:"bold 40px Arial",color:"#aaaaaa",textAlign:"center",lineHeight:1.5});return U({x:t.width/2,y:t.height/2,anchor:{x:.5,y:.5},rowGap:15,justify:"center",children:[e,i]})}(_t);e.render(),q("space",(function(){(function(t,{handler:e="keydown"}={}){let i="keydown"==e?W:b;[].concat(t).map((t=>delete i[t]))})("space"),lt(),dt=at(_t),(Et=function({fps:e=60,clearCanvas:i=!0,update:h=t,render:n,context:s=l(),blur:r=!1}={}){if(!n)throw Error("You must provide a render() function");let o,_,d,E,c,u=0,S=1e3/e,A=1/e,T=i?N:t,L=!0;function f(){if(_=requestAnimationFrame(f),L&&(d=performance.now(),E=d-o,o=d,!(E>1e3))){for(a("tick"),u+=E;u>=S;)c.update(A),u-=S;T(s),c.render()}}return r||(window.addEventListener("focus",(()=>{L=!0})),window.addEventListener("blur",(()=>{L=!1}))),c={update:h,render:n,isStopped:!0,start(){o=performance.now(),this.isStopped=!1,requestAnimationFrame(f)},stop(){this.isStopped=!0,cancelAnimationFrame(_)},_frame:f,set _last(t){o=t}},c}({update:function(t){dt.update(t)},render:function(){dt.render()}})).start()})),q("esc",(function(){alert("\n    Game Controls:\n\n    [A]: Move left\n    [D]: Move right\n    [Space]: Jump\n    [Left Mouse]: Hunter shoot\n    [Right Mouse]: Death harvest\n    ")}))})),window.addEventListener("resize",lt),window.addEventListener("contextmenu",(function(t){return t.preventDefault()}))})();