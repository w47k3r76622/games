<html>
	<body>
	<canvas id=main width=1000 height=1000></canvas>
	<script>class Item{constructor(a,b,c,f,g,k,m,n){this.name=a,this.desc=b,this.sprite=c,this.dmg=g,this.hp=k,this.hunger=m,this.sanity=n,this.xm=f}use(){mainC.hp=mainC.hp+this.hp>=mainC.totalHp?mainC.totalHp:mainC.hp+this.hp,mainC.hunger=100<=mainC.hunger+this.hunger?100:mainC.hunger+this.hunger,mainC.sanity=100<=mainC.sanity+this.sanity?100:mainC.sanity+this.sanity}copy(){return Object.assign(new Item,this)}}class Sprite{constructor(a,b,c,f){this.xInSprite=a,this.yInSprite=b,this.wInSprite=c,this.hInSprite=f}draw(a,b,c,f){null==f?ctx.drawImage(spriteSheet,this.xInSprite,this.yInSprite,this.wInSprite,this.hInSprite,a,b,this.wInSprite*c,this.hInSprite*c):ctx.drawImage(spriteSheet,this.xInSprite+this.wInSprite*f.x,this.yInSprite+this.hInSprite*f.y,this.wInSprite,this.hInSprite,a,b,this.wInSprite*c,this.hInSprite*c)}}class Room{constructor(a,b,c,f){this.name=a,this.desc=b,this.roomBg=spriteArray.rooms,this.enemy=null,this.mx=c,this.cInit=f,this.chest=!1,this.pos=null}init(a,b,c){this.pos=[a,b];var f=Math.random();0.4>f&&(this.enemy=enemyArray.requestRandom()),0.4>f&&(this.chest=!0),null!=this.cInit&&this.cInit();for(var n,g=c.matrix,k=!0,m=0.6;k;)n=this.NextOpenAndAdjNum(a,b,g),null==n.nextToAsign?k=!1:g[n.nextToAsign[0]][n.nextToAsign[1]]="open",3>n.openRooms&&Math.random()<m?m-=25:k=!1;for(k=!0;k;){var n=this.NextOpenAndAdjNum(a,b,g);null==n.nextToAsign?k=!1:g[n.nextToAsign[0]][n.nextToAsign[1]]="closed"}}drawRoom(){this.roomBg.draw(0,165,6,{x:this.mx,y:0})}copy(){let a=this.name,b=this.desc,c=this.mx,f=this.customInit;return new Room(a,b,c,f)}NextOpenAndAdjNum(a,b,c){var f=0,g=null;return 0<=a-1&&(null==c[a-1][b]&&null==g&&(g=[a-1,b]),"closed"!=c[a-1][b]&&f++),0<=b-1&&(null==c[a][b-1]&&null==g&&(g=[a,b-1]),"closed"!=c[a][b-1]&&f++),5>a+1&&(null==c[a+1][b]&&null==g&&(g=[a+1,b]),"closed"!=c[a+1][b]&&f++),5>b+1&&(null==c[a][b+1]&&null==g&&(g=[a,b+1]),"open"==c[a][b+1]&&f++),{openRooms:f,nextToAsign:g}}asignStreet(a){this.street=a}}class Street{constructor(a){if(this.moveOpts={north:"open",south:"open",east:null,west:null},this.cat=!1,this.enemy=null,null!=a)this.moveOpts.east=a;else{0.5>Math.random()&&(0.5<Math.random()?this.moveOpts.east="open":this.moveOpts.west="open",0.25>Math.random()&&("open"==this.moveOpts.east?this.moveOpts.west="open":this.moveOpts.east="open"));var b=Math.random();0.5>b&&(this.enemy=enemyArray.requestRandom()),0.3>b&&(this.cat=!0)}this.name="street",this.desc="streets of rage"}drawRoom(){spriteArray.rooms.draw(0,65,6,{x:1,y:0})}}class Enemy{constructor(a,b,c,f,g,k,m,n,o,p){this.name=a,this.sprite=b,this.acc=0.85,this.hp=g,this.atk=k,this.def=m,this.spd=n,this.luck=o,this.actions=f,this.xm=c,this.itemProb=p}atacc(a){if(eventQ.insert(null,a),Math.random()>enemy.acc)eventQ.insert(null,enemy.name+" misses");else{var b=enemy.atk;b+=3*enemy.luck/100>Math.random()?Math.ceil(3*enemy.luck*enemy.atk/100):0,eventQ.insert(function(){setDmgAnim(null,"fight")},null),eventQ.insert(function(){var c=mainC.protecc(b);setDialog("you received "+c+" damage.")},null)}}performAction(){var a=Math.random();for(i=0;i<this.actions.length;i++)if(this.actions[i].prob>a)return void this.actions[i].funct()}protecc(a){return a-=Math.ceil(a*(3*this.def/100)),this.hp-=a,a}performDeath(){var a=this.name;eventQ.insert(null,a+" was defeated");var b=Math.random();if(console.log("this rng: "+b+" this item prob: "+this.itemProb),b<this.itemProb){eventQ.insert(null,a+" dropped an item");const c=itemArray.requestRandom();eventQ.insert(function(){addItem(c)},"you get "+c.name)}eventQ.insert(function(){currentRoom.enemy=null,switchState("explore","win")},null),score+=20}draw(){this.sprite.draw(350,200,7,{x:this.xm,y:0})}copy(){let a=this.hp,b=this.atk,c=this.def,f=this.spd,g=this.luck;return new Enemy(this.name,this.sprite,this.xm,this.actions,a,b,c,f,g,this.itemProb)}}class OptionBox{constructor(a,b,c,f){this.name=a,this.x=b,this.y=c,this.scale=f,this.w=6==f?5.5*a.length*f+20:6*a.length*f+15,this.h=5*f+20}in(a,b){if(a>=this.x&&a<=this.x+this.w&&b>=this.y&&b<=this.y+this.h)return!0}drawOptionBox(){ctx.fillStyle=standby?"#18381e":"black",ctx.fillRect(this.x,this.y,this.w,this.h),drawWords(this.name,this.x+10,this.y+10,this.scale,0),ctx.strokeRect(this.x,this.y,this.w,this.h)}}class OptionMenu{constructor(a,b,c,f){for(this.optionBoxes=[],this.x=a,this.initial_y=b,this.w=190,i=0;i<c.length;i++)b+=10,this.optionBoxes.push(new OptionBox(c[i],a+10,b,5)),b+=50;this.h=b-this.initial_y+10,this.itemIndex=f}drawMenu(){for(ctx.fillStyle="black",ctx.fillRect(this.x,this.initial_y,this.w,this.h),ctx.strokeRect(this.x,this.initial_y,this.w,this.h),i=0;i<this.optionBoxes.length;i++)this.optionBoxes[i].drawOptionBox()}in(a,b){return a>=this.x&&a<=this.x+this.w&&b>=this.initial_y&&b<=this.initial_y+this.h}}class ItemSlot{constructor(a,b,c){this.item=a,this.x=b,this.y=c,this.xw=b+75,this.yh=c+75}in(a,b){if(a>=this.x&&a<=this.xw&&b>=this.y&&b<=this.yh)return!0}draw(){null!=this.item&&this.item.sprite.draw(this.x+8,this.y+8,2.5,{x:this.item.xm,y:0}),ctx.strokeRect(this.x,this.y,75,75)}}class House{constructor(){this.matrix=[];for(var a=0;5>a;a++)this.matrix[a]=[,,,,,]}insert(a,b,c){this.matrix[a][b]=c,this.matrix[a][b].init(a,b,this)}init(a){var b=Math.floor(3*Math.random()),c=roomArray.entrance.copy(),f;c.asignStreet(a),f=0==b?[2,0]:1==b?[4,2]:2==b?[2,4]:[0,2],this.insert(f[0],f[1],c),this.entrance=c}}class Collection{constructor(a){this.memberArray=a,this.probDist=[]}init(){for(var a=0;a<this.memberArray.length;a++)for(var b=0;b<this.memberArray[a].p;b++)this.probDist.push(this.memberArray[a])}requestRandom(){return this.probDist[Math.floor(Math.random()*this.probDist.length)].m.copy()}requestSpecific(a){for(var b=0;b<this.memberArray.length;b++)if(this.memberArray[b].m.name==a)return this.memberArray[b].m.copy()}}spriteSheet=new Image,spriteSheet.src="ssheet_alpha-min.png",spriteArray={abc:new Sprite(5,0,5,5),nums:new Sprite(0,0,5,5),punkSp:new Sprite(140,0,2,5),scroll:new Sprite(152,0,5,5),mc:new Sprite(0,50,20,23),enemies:new Sprite(5,5,34,45),items:new Sprite(0,73,23,24),rooms:new Sprite(0,97,167,75),misc:new Sprite(0,172,53,34)},enemyArray=new Collection([{p:70,m:new Enemy("ratboy",spriteArray.enemies,1,[{prob:0.2,funct:function(){eventQ.insert(null,"rat boy hits you with his pixaxe."),eventQ.insert(null,"... but it's made out of cardboard")}},{prob:1,funct:function(){Enemy.prototype.atacc("rat boy bites you")}}],18,7,8,4,5,0.4)},{p:25,m:new Enemy("twitcher",spriteArray.enemies,0,[{prob:0.2,funct:function(){eventQ.insert(null,"twitcher starts streaming."),eventQ.insert(null,"... but there's no internet")}},{prob:1,funct:function(){Enemy.prototype.atacc("twitcher drop kicks you")}}],16,9,5,5,6,0.5)},{p:5,m:new Enemy("influncer",spriteArray.enemies,2,[{prob:0.2,funct:function(){eventQ.insert(null,"influencer took a selfie"),eventQ.insert(null,"she says she looks fat...")}},{prob:1,funct:function(){Enemy.prototype.atacc("influencer slaps you with her phone")}}],25,10,4,7,7,0.7)},{p:0,m:new Enemy("yourself",spriteArray.mc,0,[{prob:0.2,funct:function(){eventQ.insert(null,"you laugh maniacaly"),eventQ.insert(null,"... laughter echoes through the night")}},{prob:1,funct:function(){Enemy.prototype.atacc("doom falls upon you")}}],30,15,2,6,8,1)}]),enemyArray.init(),roomArray={bedroom:new Room("bedroom","just your standard bedroom",0),entrance:new Room("entrance","there's an entrance here",0)},abc={a:0,b:1,c:2,d:3,e:4,f:5,g:6,h:7,i:8,j:9,k:10,l:11,m:12,n:13,o:14,p:15,q:16,r:17,s:18,t:19,u:20,v:21,w:22,x:23,y:24,z:25,"?":26},punks=JSON.parse("{\".\":0,\",\":1,\":\":2,\"/\":3,\"'\":4,\"!\":5}"),itemArray=new Collection([{p:20,m:new Item("instant lunch","nutritious and healthy... or not. it will satiate your hunger though",spriteArray.items,0,0,8,15,0)},{p:11,m:new Item("mcdaniel's","tastes a bit like cardboard, but that mayo is damn good",spriteArray.items,1,0,6,20,0)},{p:25,m:new Item("ciggy","helps you reduce tension at the expense of your health",spriteArray.items,2,0,-2,0,17)},{p:2,m:new Item("benzos","chill you right up, but they're dangerously addictive",spriteArray.items,3,0,0,0,25)},{p:15,m:new Item("booze","will help you carry on. lowers your accuracy",spriteArray.items,4,0,0,0,20)},{p:7,m:new Item("band aid","it's all white magic",spriteArray.items,5,0,10,0,0)},{p:20,m:new Item("cheat o's","that greasy cheat o's dust gets everywhere",spriteArray.items,6,0,6,10,0)}]),itemArray.init(),ctx=main.getContext("2d"),ctx.imageSmoothingEnabled=!1,ctx.webkitImageSmoothingEnabled=!1,ctx.mozImageSmoothingEnabled=!1,ctx.msImageSmoothingEnabled=!1,ctx.oImageSmoothingEnabled=!1,ctx.strokeStyle="green",ctx.fillStyle="green",ctx.lineWidth=5,game=null,optionMenu=null,mapMenuActive=!1,anim=null,drawOpenChest=null,drawCatto=!1,globalItemIndex=null,cont=!1,window.setTimeout(function(){standby=!0,game="mainMenu",refreshGlobalDraw()},1e3),main.addEventListener("click",function(a){if(null==anim)if(standby)coords=getMouseCoords(a),null==optionMenu?(null!=globalItemIndex&&(optionMenu=new OptionMenu(coords.x,coords.y,["use","drop"],globalItemIndex),refreshGlobalDraw()),oBoxes.forEach(function(b){if(b.in(coords.x,coords.y)){if(("new game"==b.name||"try again?"==b.name)&&(initNewGame(),switchState("explore","newgame"),cont=!0,globalCounter()),"move"==b.name&&(standby=!1,mapMenuActive=!0,refreshGlobalDraw()),"attack"==b.name&&(order=mainC.spd>=enemy.spd?[mainC,enemy]:[enemy,mainC],order[0].performAction("attack"),1>order[1].hp?order[1].performDeath("you were killed"):(order[1].performAction("attack"),1>order[0].hp?order[0].performDeath("you were killed"):eventQ.insert(function(){switchState("fight","attack")},null)),0<boozedCounter&&boozedCounter--,eventQ.perform()),"defend"==b.name&&(mainC.performAction("defend"),enemy.performAction(),1>mainC.hp?mainC.performDeath("you were killed"):eventQ.insert(function(){switchState("fight","defend")},null),eventQ.perform()),"look"==b.name)if(setDialog(currentRoom.desc),outside&&currentRoom.cat)drawCatto=!0,eventQ.insert(null,"there is fine boi"),eventQ.insert(null,"you give some pattos"),eventQ.insert(null,"well, that was rewarding"),eventQ.insert(function(){mainC.sanity+=15,drawCatto=!1,currentRoom.cat=!1,switchState("explore","look")},null),score+=5;else if(currentRoom.chest){drawOpenChest=0,eventQ.insert(null,"there is an ancient treasure chest"),eventQ.insert(function(){currentRoom.chest=!1,drawOpenChest=1},"there was an item inside");const c=itemArray.requestRandom();eventQ.insert(function(){addItem(c)},"you get "+c.name),eventQ.insert(function(){drawOpenChest=null,switchState("explore","look")},null),score+=5}"items"==b.name&&switchState("items","items"),"action"==b.name&&(setDialog("you hear a voice whisper in your ear..."),eventQ.insert(null,"'this feature didn't make the cut'"),eventQ.insert(null,"whoa.. scary.."),eventQ.insert(null,"you wonder what that means.."),enemy.performAction(),1>mainC.hp?mainC.performDeath("you were killed"):eventQ.insert(function(){switchState("fight","action")},null),mainC.sanity-=5),"escape"==b.name&&(setDialog("you attempt escaping"),rng=Math.random(),escapeChance=0.4+(mainC.spd-enemy.spd)/mainC.spd,escapeChance+=escapeChance*(mainC.luck/100),console.log("escape chance: "+escapeChance),escapeChance>rng?(eventQ.insert(null,"you managed to escape"),eventQ.insert(function(){currentRoom=lastRoom,switchState("explore","escape")},null),score+=5):(eventQ.insert(null,"you failed to escape"),eventQ.insert(function(){enemy.performAction(),1>mainC.hp?mainC.performDeath("you were killed"):eventQ.insert(function(){switchState("fight","escape")},null),eventQ.perform()},null),score-=5)),"exit"==b.name&&(null==currentRoom.street?(str=new Street(currentRoom),currentRoom.asignStreet(str),score+=15):str=currentRoom.street,outside=!0,currentHouse=null,setTransAnim("you went outside","explore",str)),"back"==b.name&&switchState("explore","back")}})):null!=optionMenu&&(optionMenu.in(coords.x,coords.y)?optionMenu.optionBoxes.forEach(function(b){b.in(coords.x,coords.y)&&(it=itemSlots[optionMenu.itemIndex].item,"use"==b.name&&(setDialog("you used "+it.name),"booze"==it.name&&(boozedCounter=15),eventQ.insert(function(){refreshGlobalDraw(),standby=!0},null),it.use(),itemSlots[optionMenu.itemIndex].item=null,optionMenu=null),"drop"==b.name&&(setDialog("you dropped "+i.name),eventQ.insert(function(){refreshGlobalDraw(),standby=!0},null),itemSlots[optionMenu.itemIndex].item=null,optionMenu=null))}):(optionMenu=null,refreshGlobalDraw()));else if(!mapMenuActive)waitForScroll&&(waitForScroll=!1,ctx.clearRect(895,895,50,50),eventQ.perform());else if(coords=getMouseCoords(a),200>coords.x||800<coords.x||200>coords.y||800<coords.y)mapMenuActive=!1,roomOpt=[],dirOpt=[],switchState("explore","mapmenu");else if(outside){for(i=0;i<dirOpt.length;i++)if(dirOpt[i].in(coords.x,coords.y))return dirName=dirOpt[i].name,"south"==dirName&&"open"==currentRoom.moveOpts.south?(currentRoom.moveOpts.south=new Street,currentRoom.moveOpts.south.moveOpts.north=currentRoom,score+=15):"north"==dirName&&"open"==currentRoom.moveOpts.north?(currentRoom.moveOpts.north=new Street,currentRoom.moveOpts.north.moveOpts.south=currentRoom,score+=15):("open"==currentRoom.moveOpts[dirName]?(newHouse=new House,newHouse.init(currentRoom),currentRoom.moveOpts[dirName]=newHouse.entrance,score+=15):newHouse=currentRoom.moveOpts[dirName].house,currentHouse=newHouse,outside=!1),msg="Street"==currentRoom.moveOpts[dirName].constructor.name?"you moved to another street":"you went inside a house",setTransAnim(msg,"explore",currentRoom.moveOpts[dirName]),mapMenuActive=!1,void(roomOpt=[]);}else for(i=0;i<roomOpt.length;i++)if(roomOpt[i].in(coords.x,coords.y))return"open"==currentHouse.matrix[roomOpt[i].indI][roomOpt[i].indJ]?(currentHouse.insert(roomOpt[i].indI,roomOpt[i].indJ,roomArray.bedroom.copy()),score+=15):"entrance"==currentHouse.matrix[roomOpt[i].indI][roomOpt[i].indJ]&&currentHouse.insert(roomOpt[i].indI,roomOpt[i].indJ,roomArray.entrance),null==currentHouse.matrix[roomOpt[i].indI][roomOpt[i].indJ].enemy&&0.2>Math.random()&&(currentHouse.matrix[roomOpt[i].indI][roomOpt[i].indJ].enemy=enemyArray.requestRandom()),setTransAnim("you moved to another room","explore",currentHouse.matrix[roomOpt[i].indI][roomOpt[i].indJ]),mapMenuActive=!1,void(roomOpt=[])},!1),main.addEventListener("mousemove",function(a){if("items"==game&&standby&&null==optionMenu){for(coords=getMouseCoords(a),i=0;i<itemSlots.length;i++)if(null!=itemSlots[i].item&&itemSlots[i].in(coords.x,coords.y))return globalItemIndex=i,void refreshGlobalDraw();globalItemIndex=null,refreshGlobalDraw()}},!1);function getMouseCoords(a){return bounds=main.getBoundingClientRect(),x=1e3*(a.pageX-bounds.left)/bounds.width,y=1e3*(a.pageY-bounds.top)/bounds.height,{x:x,y:y}}function switchState(a,b){game=a,0>=mainC.hp&&"gameover"!=a&&"fight"!=b?mainC.performDeath(" you died"):"explore"==a?(setDialog("you are in "+currentRoom.name),["streets","room","escape","win"].includes(b)&&(withdrawal_prob+=withdrawal_increment,withdrawal_increment+=0.02,rng=Math.random(),rng<withdrawal_prob&&(withdrawal_prob=0,withdrawal_increment=0.05,eventQ.insert(function(){mainC.sanity-=15},"internet withdrawal kicks in..."),eventQ.insert(function(){switchState("explore","withdrawal")},null)),0<boozedCounter&&boozedCounter--,0<toughnessCounter?(toughnessCounter--,console.log("thoughness counter: "+toughnessCounter)):(25<enemyArray.memberArray[0].p&&(console.log("making it tougher"),enemyArray.memberArray[0].p-=15,enemyArray.memberArray[1].p+=8,enemyArray.memberArray[2].p+=7,enemyArray.init()),toughnessCounter=12),20>mainC.sanity&&100>enemyArray.memberArray[3].p?(enemyArray.memberArray[3].p=100,enemyArray.init()):(enemyArray.memberArray[3].p=0,enemyArray.init()),0==hungerCounter?(mainC.hunger-=10,hungerCounter=10):hungerCounter--,0>=mainC.hunger&&eventQ.insert(function(){mainC.hp-=Math.ceil(mainC.totalHp/2),setDmgAnim("you are starving!","starving")},null))):"items"==a?(dialog=null,refreshGlobalDraw()):"fight"==a?(setDialog("you are fighting "+enemy.name),0<mainC.defMod&&(mainC.defMod=0),0<mainC.atkMod&&(mainC.atkMod=0)):"gameover"==a&&(eventQ.queue=[],dialog=null,standby=!0,refreshGlobalDraw())}function refreshGlobalDraw(){if(ctx.clearRect(0,0,main.width,main.height),"mainMenu"==game&&(drawWords("b1ack0ut.",125,400,16,0),oBoxes=[new OptionBox("new game",340,550,6)]),"explore"==game||"fight"==game){if("explore"==game?(oBoxes=[new OptionBox("move",40,640,5),new OptionBox("look",235,640,5),new OptionBox("items",610,640,5)],"entrance"==currentRoom.name?oBoxes.push(new OptionBox("exit",825,640,5)):"",currentRoom.drawRoom(),drawWords("score: "+score,750,145,3,0)):(oBoxes=[new OptionBox("attack",40,640,4),new OptionBox("action",235,640,4),new OptionBox("defend",580,640,4),new OptionBox("escape",795,640,4)],currentRoom.enemy.draw()),ctx.strokeRect(25,625,950,350),ctx.strokeRect(40,705,920,255),ctx.fillStyle="black",ctx.fillRect(420,580,119,125),ctx.strokeRect(420,580,119,125),ctx.strokeRect(25,25,307,110),drawWords("hunger:",45,45,5,0),ctx.strokeRect(49,77,258,35),ctx.fillStyle="green",ctx.fillRect(55,83,247*(0<mainC.hunger?mainC.hunger/100:0),23),ctx.strokeRect(342,25,307,110),drawWords("health:",362,45,5,0),ctx.strokeRect(366,77,258,35),ctx.fillRect(372,83,247*(0<mainC.hp?mainC.hp/mainC.totalHp:0),23),ctx.strokeRect(659,25,307,110),drawWords("mood:",679,45,5,0),state="",80<=mainC.sanity&&(state="cool",face_x=0),80>mainC.sanity&&50<=mainC.sanity&&(state="anxious",color={r:255,g:255,b:0},face_x=1),50>mainC.sanity&&20<=mainC.sanity&&(state="paranoid",color={r:255,g:150,b:0},face_x=2),20>mainC.sanity&&(state="psychotic",color={r:255,g:0,b:0},face_x=3),spriteArray.mc.draw(426,585,5,{x:face_x,y:0}),drawWords(state,685,82,5,0),coloredMood=ctx.getImageData(685,82,265,35),"cool"!=state)for(d=coloredMood.data,i=0;i<d.length;i+=4)(0!=d[i]||0!=d[i+1]||0!=d[i+2])&&(d[i]=color.r,d[i+1]=color.g,d[i+2]=color.b);ctx.putImageData(coloredMood,685,82)}if("items"==game&&(oBoxes=[new OptionBox("back",450,900,5)],ctx.strokeRect(25,25,950,950),drawLine(500,25,500,705),drawWords("items",200,50,5,0),drawWords("status",675,50,5,0),ctx.strokeRect(40,705,920,255),drawWords("health: "+mainC.hp+"/"+mainC.totalHp,515,150,5,0),drawWords("hunger: "+mainC.hunger+"/100",515,200,5,0),itemSlots.forEach(function(a){a.draw()}),null!=globalItemIndex&&null!=itemSlots[globalItemIndex].item?(item=itemSlots[globalItemIndex].item,drawWords(item.name,325,725,5,0),drawLine(325,755,325+29*item.name.length-2,755),drawWords(item.desc,60,775,5,0)):ctx.clearRect(60,725,850,150)),"gameover"==game&&(drawWords("game over.",100,400,16,0),drawWords("final score: "+score,250,500,5,0),oBoxes=[new OptionBox("try again?",340,555,6)],cont=!1),oBoxes.forEach(function(a){a.drawOptionBox()}),"mainMenu"!=game&&null!=optionMenu&&optionMenu.drawMenu(),mapMenuActive){if(ctx.fillStyle="black",outside)ctx.fillRect(110,150,780,650),ctx.strokeRect(110,150,780,650),ctx.beginPath(),ctx.lineWidth=10,ctx.arc(500,500,145,0,2*Math.PI),spr=new Sprite(155,172,34,34).draw(398,398,6),dirOpt=[new OptionBox("north",415,250,5),new OptionBox("south",415,710,5)],console.log(),null!=currentRoom.moveOpts.east&&dirOpt.push(new OptionBox("east",690,475,5)),null!=currentRoom.moveOpts.west&&dirOpt.push(new OptionBox("west",170,475,5)),ctx.stroke(),ctx.lineWidth=5,dirOpt.forEach(function(a){a.drawOptionBox()});else for(ctx.fillRect(200,150,600,650),ctx.strokeRect(200,150,600,650),i=0;i<currentHouse.matrix.length;i++)for(j=0;j<currentHouse.matrix[i].length;j++)ctx.strokeStyle="white",ctx.fillStyle="white","closed"!=currentHouse.matrix[i][j]&&null!=currentHouse.matrix[i][j]&&(l=95,w=95,"open"==currentHouse.matrix[i][j]?ctx.strokeStyle="yellow":("entrance"==currentHouse.matrix[i][j]||"entrance"==currentHouse.matrix[i][j].name)&&(ctx.strokeStyle="green"),ctx.fillStyle="entrance"==currentRoom.name?"green":"white",currentRoom==currentHouse.matrix[i][j]?ctx.fillRect(115*i+220,115*j+220,w,l):ctx.strokeRect(115*i+220,115*j+220,w,l),currentHouse.matrix[i][j]!=currentRoom&&adjacentRoom(i,j)&&roomOpt.push({indI:i,indJ:j,x:115*i+220,y:115*j+220,w:w,h:l,in:function(a,b){if(a>=this.x&&a<=this.x+this.w&&b>=this.y&&b<=this.y+this.h)return!0}}));drawWords("where?",415,165,5,0),ctx.strokeStyle="green"}(null!=drawOpenChest||drawCatto)&&(ctx.fillStyle="black",ctx.fillRect(335,335,290,215),drawCatto?new Sprite(106,172,49,34).draw(350,350,5):spriteArray.misc.draw(345,350,5,{x:drawOpenChest,y:0}),ctx.strokeRect(335,335,290,215)),null!=anim&&anim.play()}function drawWords(a,b,c,f,g){for(a=a.substring(0,a.length-g),words=a.split(" "),lines=[],line="";0<words.length;)31<line.length+words[0].length?(lines.push(line),line=""):line+=words.shift()+" ";0<line.length&&lines.push(line),lines.forEach(function(k){var m=b;lets=k.split(""),lets.forEach(function(n){numb=parseInt(n),isNaN(numb)?[".",",",":","/","'"].includes(n)?spriteArray.punkSp.draw(m,c,f,{x:punks[n],y:0}):spriteArray.abc.draw(m,c,f,{x:abc[n],y:0}):spriteArray.nums.draw(m,c,f,{x:0,y:numb});var o=0;o=" "==n?3:[".","'","?","/"].includes(n)?2:6,m+=o*f}),c+=5*f+20})}function drawLine(a,b,c,f){ctx.beginPath(),ctx.moveTo(a,b),ctx.lineTo(c,f),ctx.stroke()}function globalCounter(){setTimeout(function(){999999>global_frame_counter?global_frame_counter++:global_frame_counter=0,0==global_frame_counter%2&&0<=dontDraw&&(ctx.clearRect(60,725,850,150),drawWords(dialog,60,725,5,dontDraw--)),0!=dontDraw||waitForScroll||(0<eventQ.queue.length?(waitForScroll=!0,drawScrollArrow=!0):(standby=!0,oBoxes.forEach(function(a){a.drawOptionBox()}))),waitForScroll&&0==global_frame_counter%30&&(drawScrollArrow?(spriteArray.scroll.draw(900,890,5),drawScrollArrow=!1):(ctx.clearRect(900,890,50,50),drawScrollArrow=!0)),null!=anim&&refreshGlobalDraw(),cont&&globalCounter()},17)}function setDialog(a){standby=!1,dialog=a,dontDraw=dialog.length,refreshGlobalDraw()}function initNewGame(){for(mainC={hp:25,totalHp:25,atk:8,def:6,spd:5,luck:6,hunger:100,sanity:74,defMod:0,atkMod:0,acc:0.9,protecc:function(a){return a-=Math.ceil(a*(3*(this.def+this.defMod)/100)),this.hp-=a,this.sanity-=7,a},performAction:function(a){if("attack"==a){var b=this.acc,c="";40>this.sanity?(b=0.75,c="...but panic set in"):0<boozedCounter&&(b=0.85,c="...but your inebriation got in the way"),eventQ.insert(null,"you attack");var f=Math.random();if(f>b)eventQ.insert(null,""==c?"...but you missed":c);else{var g=this.atk;g+=3*this.luck/100>Math.random()?Math.ceil(3*this.luck*this.atk/100):0,eventQ.insert(function(){mainC.hunger-=5},enemy.name+" received "+enemy.protecc(g)+" damage.")}}"defend"==a&&(this.defMod+=this.def,eventQ.insert(null,"you defend"))},performDeath:function(a){eventQ.insert(function(){switchState("gameover","fight")},null),setDialog(a)}},boozedCounter=0,hungerCounter=10,toughnessCounter=12,eventQ={queue:[],insert:function(a,b){const c=a,f=b;this.queue.push(function(){null!=c&&c(),null!=f&&setDialog(f)})},perform:function(){this.queue.shift()()}},enemy=null,currentHouse=new House,currentHouse.insert(1,1,roomArray.bedroom.copy()),itemName=null,itemSlots=[],y_pos=150,x_pos=75,i=0;5>i;i++){for(j=0;4>j;j++)itemSlots.push(new ItemSlot(null,x_pos,y_pos)),x_pos+=100;y_pos+=100,x_pos=75}roomOpt=[],dirOpt=[],currentRoom=currentHouse.matrix[1][1],currentHouse.matrix[0][0]="entrance",withdrawal_prob=0.01,withdrawal_increment=0.05,waitForScroll=drawScrollArrow=!1,global_frame_counter=dontDraw=0,globalItemIndex=null,addItem(itemArray.requestSpecific("instant lunch")),addItem(itemArray.requestSpecific("ciggy")),outside=!1,score=0}function addItem(a){for(i=0;i<itemSlots.length;i++)if(null==itemSlots[i].item)return void(itemSlots[i].item=a);eventQ.insert(null,"...but there's no space in your inventory")}function adjacentRoom(a,b){return pos=currentRoom.pos,pos[1]==b&&(a==pos[0]+1||a==pos[0]-1)||pos[0]==a&&(b==pos[1]+1||b==pos[1]-1)}function finishAnim(a,b,c){anim=null,null!=c&&ctx.translate(-c,0),null!=a&&setDialog(a),"explore"==b?null==currentRoom.enemy?eventQ.insert(function(){switchState("explore","room")},null):(enemy=currentRoom.enemy,eventQ.insert(function(){switchState("fight","encounter")},"you encounter "+currentRoom.enemy.name)):"fight"==b?eventQ.perform():"starving"==b&&eventQ.insert(function(){switchState("explore","starved")},null)}function setDmgAnim(a,b){anim={offset:0,x:25,duration:10,play:function(){this.offset+=this.x,ctx.translate(this.x,0),this.x=25<=this.offset?-50:50,-1>=this.duration--&&finishAnim(a,b,this.offset)}}}function setTransAnim(a,b,c){anim={top_y:0,bot_y:1e3,status:"coming",play:function(){ctx.fillStyle="black",ctx.fillRect(0,0,1e3,this.top_y),ctx.fillRect(0,this.bot_y,1e3,500),"coming"==this.status?(this.top_y+=50,this.bot_y-=50):(this.top_y-=50,this.bot_y+=50,0>=this.top_y&&(mainC.hunger-=7,finishAnim(a,b))),500<=this.top_y&&(lastRoom=currentRoom,currentRoom=c,this.status="going",dialog=null)}}}</script>
	</body>
	<style>
		#main {position:fixed;width:99.5vmin;top:49.9%;left:49.9%;transform:translateX(-50%)translateY(-50%);background:black}
	</style>
</html>