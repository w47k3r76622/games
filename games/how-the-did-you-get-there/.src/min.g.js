function run(){for(ctx.clearRect(0,0,canvasW,canvasH),ctx.fillStyle="#000000",ctx.fillRect(0,0,canvasW,canvasH),ctx.fillStyle="#0F0F0F",i=0;canvasW/(tileSize/5)>i;i++)for(k=0;canvasH/(tileSize/5)>k;k++)(i+k)%2==0&&ctx.fillRect(tileSize/5*i,tileSize/5*k,tileSize/5,tileSize/5);if(0==level)return r=rand(1,10),ctx.font="40px Courier",ctx.fillStyle="#FFFFFF",ctx.fillText("How the ",canvasW/2-390,150),ctx.fillStyle="#FFBBBB",r%2==0?ctx.fillText("hell",canvasW/2-205,150):r%3==0?ctx.fillText("damn",canvasW/2-205,150):r%3==0?ctx.fillText("heck",canvasW/2-205,150):ctx.fillText("fuck",canvasW/2-205,150),ctx.fillStyle="#FFFFFF",ctx.fillText("did you get there?",canvasW/2-95,150),ctx.fillRect(canvasW/2-390,160,700,1),ctx.globalAlpha=.8,ctx.fillStyle="#EEEEEE",ctx.fillRect(tileSize-11,canvasH/2-2*tileSize-1,702,232),ctx.fillStyle="#0A0A0A",ctx.fillRect(tileSize-10,canvasH/2-2*tileSize,700,230),ctx.globalAlpha=1,ctx.fillStyle="green",drawCircle(50+tileSize,canvasH/2-tileSize-10,tileSize/2-10),drawCircle(50+2*tileSize,canvasH/2-10,tileSize/2-10),ctx.beginPath(),ctx.lineWidth=tileSize/3,ctx.strokeStyle="green",ctx.moveTo(50+tileSize,canvasH/2-tileSize-10),ctx.lineTo(50+2*tileSize,canvasH/2-10,tileSize/2-10),ctx.stroke(),ctx.drawImage(smile,50-tileSize/2+5+tileSize,canvasH/2-tileSize-10-tileSize/2+5,tileSize-10,tileSize-10),ctx.drawImage(sad,50+tileSize/2+5+tileSize,canvasH/2-10-tileSize/2+5,tileSize-10,tileSize-10),ctx.font="20px Courier",ctx.fillStyle="white",ctx.fillText("This is ",30+3*tileSize,canvasH/2-tileSize-30),ctx.fillText("He likes to stuck himself.",30+3*tileSize,canvasH/2-tileSize),ctx.fillText("Help him reach freedom. ",30+3*tileSize,canvasH/2-tileSize+20),ctx.fillText("    moves on a chessboard. ",30+3*tileSize,canvasH/2-tileSize+60),ctx.fillText("Like his friends, only on white tiles. ",30+3*tileSize,canvasH/2-tileSize+80),ctx.fillText("Drag them diagonally. ",30+3*tileSize,canvasH/2-tileSize+110),ctx.fillStyle="green",ctx.fillText("Tim",125+3*tileSize,canvasH/2-tileSize-30),ctx.fillText("Tim",30+3*tileSize,canvasH/2-tileSize+60),ctx.font="40px Courier",ctx.fillStyle="#666666",ctx.fillRect(canvasW/2-60,canvasH-150,120,80),ctx.fillStyle="#0000FF",ctx.fillText("PLAY",canvasW/2-50,canvasH-100),ctx.fillRect(canvasW/2-50,canvasH-90,90,1),ctx.fillStyle="white",ctx.font="12px Arial",ctx.fillText("Made by Infernet89",canvasW-120,canvasH-10),void(dragging&&mousex>canvasW/2-60&&canvasW/2+60>mousex&&mousey>canvasH-150&&canvasH-70>mousey&&levelUp());if(7==level)return ctx.font="40px Courier",ctx.fillStyle="#FFFFFF",ctx.fillText("No more levels!",canvasW/2-150,tileSize),ctx.font="80px Courier",ctx.fillText("YOU ARE NOW FREE.",canvasW/2-320,4*tileSize),ctx.font="10px Courier",void ctx.fillText("to play something else...",canvasW/2-320,4*tileSize+10);for(fromX=(canvasW-7*tileSize)/2,fromY=(canvasH-7*tileSize)/2,ctx.fillStyle="white",i=0;7>i;i++)for(k=0;7>k;k++)(i+k)%2==0&&ctx.fillRect(fromX+tileSize*i,fromY+tileSize*k,tileSize,tileSize);for(ctx.fillStyle="black",i=0;7>i;i++)for(k=0;7>k;k++)(i+k)%2!=0&&ctx.fillRect(fromX+tileSize*i,fromY+tileSize*k,tileSize,tileSize);for(ctx.fillStyle="red",ctx.fillRect(fromX+tileSize,fromY-10,6*tileSize,10),ctx.fillRect(fromX+7*tileSize,fromY-10,10,7*tileSize+10),ctx.fillRect(fromX,fromY+7*tileSize,7*tileSize+10,10),ctx.fillRect(fromX-10,fromY+tileSize,10,6*tileSize+10),drawi=0;drawi<pieces.length;drawi++)drawPiece(pieces[drawi]);if(-1!=selected){for(ctx.globalAlpha=.5,ctx.strokeStyle="white",ctx.beginPath(),ctx.lineWidth=tileSize/10,ctx.moveTo(fromX+tileSize/2+tileSize*selectedPiece[0].x,fromY+tileSize/2+tileSize*selectedPiece[0].y),i=1;i<selectedPiece.length;i++)ctx.lineTo(fromX+tileSize/2+tileSize*selectedPiece[i].x,fromY+tileSize/2+tileSize*selectedPiece[i].y);ctx.stroke(),ctx.globalAlpha=1}if(moving){for(selectedPiece=pieces[selected],i=0;i<selectedPiece.length;i++)selectedPiece[i].x+=moveFactorX/10,selectedPiece[i].y+=moveFactorY/10;if(++progressMovimento>=10){for(i=0;i<selectedPiece.length;i++)selectedPiece[i].x=Math.round(selectedPiece[i].x),selectedPiece[i].y=Math.round(selectedPiece[i].y);progressMovimento=0,moving=!1}-1!=cursor?(document.body.style.cursor="none",ctx.drawImage(cursor,mousex-cursor.width/2,mousey-cursor.height/2,cursor.width,cursor.height)):document.body.style.cursor="default"}else if(dragging)if(-1==selected)if(mx=Math.floor((mousex-fromX)/tileSize),my=Math.floor((mousey-fromY)/tileSize),mx>=0&&7>mx&&my>=0&&7>my&&isFree[mx][my]){var e=-1,t=-2,c=-3,s=-4;for(i=0;i<pieces.length;i++)for(temp=pieces[i],k=0;k<temp.length;k++)temp[k].x==mx-1&&temp[k].y==my?e=i:temp[k].x==mx+1&&temp[k].y==my&&(t=i),temp[k].x==mx&&temp[k].y==my-1?c=i:temp[k].x==mx&&temp[k].y==my+1&&(s=i);e==t?(selected=e,selectedPiece=pieces[selected]):c==s&&(selected=s,selectedPiece=pieces[selected])}else for(i=0;i<pieces.length;i++)for(temp=pieces[i],k=0;k<temp.length;k++)temp[k].x==mx&&temp[k].y==my&&(selected=i,selectedPiece=pieces[i]);else{for(cursor=-1,minx=canvasW,maxx=0,miny=canvasH,maxy=0,selectedPiece=pieces[selected],i=0;i<selectedPiece.length;i++)minx>selectedPiece[i].x&&(minx=selectedPiece[i].x),maxx<selectedPiece[i].x&&(maxx=selectedPiece[i].x),miny>selectedPiece[i].y&&(miny=selectedPiece[i].y),maxy<selectedPiece[i].y&&(maxy=selectedPiece[i].y);minx=fromX+minx*tileSize,miny=fromY+miny*tileSize,maxx=fromX+(maxx+1)*tileSize,maxy=fromY+(maxy+1)*tileSize;var o;minx>mousex&&(miny+maxy)/2>mousey||(minx+maxx)/2>mousex&&miny>mousey?(o="top-left",tryMove(-1,-1)?(moving=!0,moveFactorX=-1,moveFactorY=-1,cursor=topleft):cursor=nope):mousex>maxx&&(miny+maxy)/2>mousey||mousex>(minx+maxx)/2&&miny>mousey?(o="top-right",tryMove(1,-1)?(moving=!0,moveFactorX=1,moveFactorY=-1,cursor=topright):cursor=nope):mousex>maxx&&mousey>(miny+maxy)/2||mousex>(minx+maxx)/2&&mousey>maxy?(o="bottom-right",tryMove(1,1)?(moving=!0,moveFactorX=1,moveFactorY=1,cursor=botright):cursor=nope):minx>mousex&&mousey>(miny+maxy)/2||(minx+maxx)/2>mousex&&mousey>maxy?(o="bottom-left",tryMove(-1,1)?(moving=!0,moveFactorX=-1,moveFactorY=1,cursor=botleft):cursor=nope):o="nowhere",-1!=cursor?(document.body.style.cursor="none",cursor==nope&&("top-left"==o?ctx.drawImage(topleft,mousex-cursor.width/2,mousey-cursor.height/2,cursor.width,cursor.height):"top-right"==o?ctx.drawImage(topright,mousex-cursor.width/2,mousey-cursor.height/2,cursor.width,cursor.height):"bottom-right"==o?ctx.drawImage(botright,mousex-cursor.width/2,mousey-cursor.height/2,cursor.width,cursor.height):"bottom-left"==o&&ctx.drawImage(botleft,mousex-cursor.width/2,mousey-cursor.height/2,cursor.width,cursor.height)),ctx.drawImage(cursor,mousex-cursor.width/2,mousey-cursor.height/2,cursor.width,cursor.height)):document.body.style.cursor="default"}else selected=-1,document.body.style.cursor="default";-1==masterPiece[0].x&&-1==masterPiece[0].y&&levelUp(),ctx.font="20px Arial",ctx.fillStyle="white",ctx.fillText(testoSopra,canvasW/2-40,50),ctx.fillText(testoSotto,canvasW/2-5*testoSotto.length,canvasH-40)}function drawPiece(e){for(ctx.fillStyle=e.color,i=0;i<e.length;i++)drawCircle(fromX+tileSize/2+tileSize*e[i].x,fromY+tileSize/2+tileSize*e[i].y,tileSize/2-10);for(ctx.beginPath(),ctx.lineWidth=tileSize/3,ctx.strokeStyle=e.color,ctx.moveTo(fromX+tileSize/2+tileSize*e[0].x,fromY+tileSize/2+tileSize*e[0].y),i=1;i<e.length;i++)ctx.lineTo(fromX+tileSize/2+tileSize*e[i].x,fromY+tileSize/2+tileSize*e[i].y);ctx.stroke(),e==masterPiece&&(ctx.drawImage(smile,fromX+tileSize/2+tileSize*e[0].x-tileSize/2+5,fromY+tileSize/2+tileSize*e[0].y-tileSize/2+5,tileSize-10,tileSize-10),ctx.drawImage(sad,fromX+tileSize/2+tileSize*e[1].x-tileSize/2+5,fromY+tileSize/2+tileSize*e[1].y-tileSize/2+5,tileSize-10,tileSize-10))}function tryMove(e,t){if(-1==selected)return!1;var c=!0;for(selectedPiece=pieces[selected],i=0;i<selectedPiece.length;i++)-1!=selectedPiece[i].x&&-1!=selectedPiece[i].y&&(isFree[selectedPiece[i].x][selectedPiece[i].y]=!0);for(i=0;i<selectedPiece.length&&c;i++)selectedPiece[i].x+e<0||selectedPiece[i].x+e>6||selectedPiece[i].y+t<0||selectedPiece[i].y+t>6?(selectedPiece[i].x+e!=-1||selectedPiece[i].y+t!=-1)&&(c=!1):isFree[selectedPiece[i].x+e][selectedPiece[i].y+t]||(c=!1);if(c)for(i=0;i<selectedPiece.length;i++)selectedPiece[i].x+e!=-1&&selectedPiece[i].y+t!=-1&&(isFree[selectedPiece[i].x+e][selectedPiece[i].y+t]=!1);else for(i=0;i<selectedPiece.length;i++)-1!=selectedPiece[i].x&&-1!=selectedPiece[i].y&&(isFree[selectedPiece[i].x][selectedPiece[i].y]=!1);return c}function levelUp(){for(i=0;7>i;i++)for(k=0;7>k;k++)isFree[i][k]=(i+k)%2==0?!0:!0;if(pieces=[],selectedPiece=-1,selected=-1,dragging=!1,level++,1==level)masterPiece[0].x=2,masterPiece[0].y=4,isFree[2][4]=!1,masterPiece[1].x=3,masterPiece[1].y=5,isFree[3][5]=!1,pieces.push(masterPiece),testoSopra="LEVEL 1",testoSotto="Drag the green object outside";else if(2==level){masterPiece[0].x=5,masterPiece[0].y=5,isFree[5][5]=!1,masterPiece[1].x=6,masterPiece[1].y=6,isFree[6][6]=!1,pieces.push(masterPiece);var e=[];e.color="blue",e[0]={},e[0].x=0,e[0].y=0,isFree[0][0]=!1,e[1]={},e[1].x=1,e[1].y=1,isFree[1][1]=!1,e[2]={},e[2].x=1,e[2].y=3,isFree[1][3]=!1,pieces.push(e),testoSopra="LEVEL 2",testoSotto="Sometimes, you need to move obstacles to reach your goal"}else if(3==level){masterPiece[0].x=2,masterPiece[0].y=4,isFree[2][4]=!1,masterPiece[1].x=3,masterPiece[1].y=5,isFree[3][5]=!1,pieces.push(masterPiece);var e=[];e.color="blue",e[0]={},e[0].x=2,e[0].y=0,isFree[2][0]=!1,e[1]={},e[1].x=1,e[1].y=1,isFree[1][1]=!1,pieces.push(e);var e=[];e.color="yellow",e[0]={},e[0].x=0,e[0].y=2,isFree[0][2]=!1,e[1]={},e[1].x=2,e[1].y=2,isFree[2][2]=!1,e[2]={},e[2].x=3,e[2].y=1,isFree[3][1]=!1,pieces.push(e),testoSopra="LEVEL 3",testoSotto="Everybody want to reach freedom"}else if(4==level){masterPiece[0].x=5,masterPiece[0].y=5,isFree[5][5]=!1,masterPiece[1].x=6,masterPiece[1].y=6,isFree[6][6]=!1,pieces.push(masterPiece);var e=[];e.color="blue",e[0]={},e[0].x=3,e[0].y=5,isFree[3][5]=!1,e[1]={},e[1].x=3,e[1].y=3,isFree[3][3]=!1,e[2]={},e[2].x=5,e[2].y=3,isFree[5][3]=!1,pieces.push(e);var e=[];e.color="yellow",e[0]={},e[0].x=6,e[0].y=0,isFree[6][0]=!1,e[1]={},e[1].x=6,e[1].y=2,isFree[6][2]=!1,e[2]={},e[2].x=6,e[2].y=4,isFree[6][4]=!1,pieces.push(e);var e=[];e.color="purple",e[0]={},e[0].x=0,e[0].y=2,isFree[0][2]=!1,e[1]={},e[1].x=2,e[1].y=2,isFree[2][2]=!1,e[2]={},e[2].x=4,e[2].y=2,isFree[4][2]=!1,pieces.push(e),testoSopra="LEVEL 4",testoSotto="Have so many close friends is not always good"}else if(5==level){masterPiece[0].x=5,masterPiece[0].y=1,isFree[5][1]=!1,masterPiece[1].x=6,masterPiece[1].y=2,isFree[6][2]=!1,pieces.push(masterPiece);var e=[];e.color="blue",e[0]={},e[0].x=0,e[0].y=2,isFree[0][2]=!1,e[1]={},e[1].x=1,e[1].y=3,isFree[1][3]=!1,e[2]={},e[2].x=1,e[2].y=5,isFree[1][5]=!1,pieces.push(e);var e=[];e.color="red",e[0]={},e[0].x=2,e[0].y=0,isFree[2][0]=!1,e[1]={},e[1].x=2,e[1].y=2,isFree[2][2]=!1,pieces.push(e);var e=[];e.color="yellow",e[0]={},e[0].x=2,e[0].y=4,isFree[2][4]=!1,e[1]={},e[1].x=3,e[1].y=3,isFree[3][3]=!1,e[2]={},e[2].x=5,e[2].y=3,isFree[5][3]=!1,pieces.push(e),testoSopra="LEVEL 5",testoSotto="Are you afraid of crowd?"}else if(6==level){masterPiece[0].x=3,masterPiece[0].y=3,isFree[3][3]=!1,masterPiece[1].x=4,masterPiece[1].y=4,isFree[4][4]=!1,pieces.push(masterPiece);var e=[];e.color="yellow",e[0]={},e[0].x=1,e[0].y=1,isFree[1][1]=!1,e[1]={},e[1].x=2,e[1].y=0,isFree[2][0]=!1,e[2]={},e[2].x=4,e[2].y=0,isFree[4][0]=!1,pieces.push(e);var e=[];e.color="purple",e[0]={},e[0].x=0,e[0].y=2,isFree[0][2]=!1,e[1]={},e[1].x=0,e[1].y=4,isFree[0][4]=!1,pieces.push(e);var e=[];e.color="red",e[0]={},e[0].x=4,e[0].y=2,isFree[4][2]=!1,e[1]={},e[1].x=5,e[1].y=1,isFree[5][1]=!1,pieces.push(e);var e=[];e.color="blue",e[0]={},e[0].x=6,e[0].y=2,isFree[6][2]=!1,e[1]={},e[1].x=6,e[1].y=4,isFree[6][4]=!1,e[2]={},e[2].x=5,e[2].y=5,isFree[5][5]=!1,pieces.push(e);var e=[];e.color="cyan",e[0]={},e[0].x=1,e[0].y=3,isFree[1][3]=!1,e[1]={},e[1].x=1,e[1].y=5,isFree[1][5]=!1,e[2]={},e[2].x=3,e[2].y=5,isFree[3][5]=!1,pieces.push(e),testoSopra="LEVEL 6",testoSotto="The next test is impossible"}}function drawCircle(e,i,t){ctx.beginPath(),ctx.arc(e,i,t,0,2*Math.PI,!1),ctx.fill(),ctx.lineWidth=t/10,ctx.strokeStyle="#003300",ctx.stroke()}function drawRect(e,i,t){var c=0,s=0;t.indexOf("CENTER")>-1&&(c=(canvasW-e)/2,s=(canvasH-i)/2),t.indexOf("TOP")>-1?s=0:t.indexOf("BOTTOM")>-1?s=canvasH-i:t.indexOf("LEFT")>-1&&(c=0),t.indexOf("RIGHT")>-1&&(X=canvasW-e),ctx.fillRect(c,s,e,i)}function rand(e,i){return e>i?rand(i,e):(i+=1,Math.floor(Math.random()*(i-e)+e))}function mossoTap(e){e.preventDefault(),dragging=!0;canvas.getBoundingClientRect();mousex=e.targetTouches[0].pageX,mousey=e.targetTouches[0].pageY,e.targetTouches.length<2||(mouse2x=e.targetTouches[1].pageX,mouse2y=e.targetTouches[1].pageY,e.targetTouches.length<3||(mouse3x=e.targetTouches[2].pageX,mouse3y=e.targetTouches[2].pageY))}function cliccatoTap(e){e.preventDefault();canvas.getBoundingClientRect();mousex=e.targetTouches[0].pageX,mousey=e.targetTouches[0].pageY,e.targetTouches.length<2||(mouse2x=e.targetTouches[1].pageX,mouse2y=e.targetTouches[1].pageY,e.targetTouches.length<3||(mouse3x=e.targetTouches[2].pageX,mouse3y=e.targetTouches[2].pageY))}function rilasciatoTap(e){e.preventDefault(),dragging=!1,mousey=-100,mousex=-100,mouse2y=-100,mouse2x=-100,mouse3y=-100,mouse3x=-100}function cliccatoMouse(e){dragging=!0;var i=canvas.getBoundingClientRect();mousex=(e.clientX-i.left)/(i.right-i.left)*canvasW,mousey=(e.clientY-i.top)/(i.bottom-i.top)*canvasH}function mossoMouse(e){var i=canvas.getBoundingClientRect();mousex=(e.clientX-i.left)/(i.right-i.left)*canvasW,mousey=(e.clientY-i.top)/(i.bottom-i.top)*canvasH}function rilasciatoMouse(){dragging=!1}var DEBUG=0,TO_RADIANS=Math.PI/180,canvas,canvasW,canvasH,ctx,activeTask,level=0,mousex=-100,mousey=-100,mouse2x=-100,mouse2y=-100,mouse3x=-100,mouse3y=-100,dragging=!1;canvas=document.getElementById("g"),ctx=canvas.getContext("2d"),canvasW=canvas.width=window.innerWidth,canvasH=canvas.height=window.innerHeight,window.navigator.pointerEnabled?(canvas.addEventListener("pointermove",mossoMouse,!1),canvas.addEventListener("pointerup",rilasciatoTap,!1)):(canvas.addEventListener("touchmove",mossoTap),canvas.addEventListener("touchstart",cliccatoTap),canvas.addEventListener("touchend",rilasciatoTap)),canvas.addEventListener("mousemove",mossoMouse),canvas.addEventListener("mousedown",cliccatoMouse),canvas.addEventListener("mouseup",rilasciatoMouse),activeTask=setInterval(run,33);var tileSize=Math.min(canvasW/10,canvasH/10),isFree=[[!0,!1,!0,!1,!0,!1,!0],[!1,!0,!1,!0,!1,!0,!1],[!0,!1,!0,!1,!0,!1,!0],[!1,!0,!1,!0,!1,!0,!1],[!0,!1,!0,!1,!0,!1,!0],[!1,!0,!1,!0,!1,!0,!1],[!0,!1,!0,!1,!0,!1,!0]],masterPiece=[];masterPiece.color="green",masterPiece[0]={},masterPiece[1]={};var pieces=[];pieces[0]=masterPiece;var selectedPiece=-1,selected=-1,moving=!1,moveFactorX=0,moveFactorY=0,progressMovimento=0,cursor,testoSopra="LEVEL N",testoSotto="Random fun fact",nope=new Image;nope.src="pics/nope.png",nope.onload=function(){this.height=tileSize/2,this.width=tileSize/2};var topleft=new Image;topleft.src="pics/topleft.png",topleft.onload=function(){this.height=tileSize/2,this.width=tileSize/2};var topright=new Image;topright.src="pics/topright.png",topright.onload=function(){this.height=tileSize/2,this.width=tileSize/2};var botright=new Image;botright.src="pics/botright.png",botright.onload=function(){this.height=tileSize/2,this.width=tileSize/2};var botleft=new Image;botleft.src="pics/botleft.png",botleft.onload=function(){this.height=tileSize/2,this.width=tileSize/2};var smile=new Image;smile.src="pics/smile.png",smile.onload=function(){this.height=tileSize,this.width=tileSize};var sad=new Image;sad.src="pics/sad.png",sad.onload=function(){this.height=tileSize,this.width=tileSize};