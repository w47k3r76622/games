<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width,initial-scale=1"></head><body><script type="module">var t=t=>{document.head.innerHTML+=`<style>${t}</style>`},e=(t={},e=[])=>{let o={};t.on=(t,e)=>{o[t]||(o[t]=[]),o[t].push(e)},t.off=(t,e)=>{if(!t&&!e){o={};return}if(t&&!e){o[t]=[];return}if(!t&&e){for(let t in o)o[t]=o[t].filter(t=>t!==e);return}o[t]&&(o[t]=o[t].filter(t=>t!==e))},t.once=(e,o)=>{let a=r=>{o(r),t.off(e,a)};t.on(e,a)};let a={};return t.emit=(t,e={})=>{a[t]&&"object"==typeof a[t]?Object.assign(a[t],e):a[t]=e,o[t]&&o[t].forEach(t=>t(e))},t.last=t=>a[t]?a[t]:{},e.forEach(e=>{t[e]=o=>{t.emit(e,o)}}),t.syncOn=o=>{e.forEach(e=>o.on(e,t[e]))},t.syncOff=o=>e.forEach(e=>o.off(e,t[e])),t};t`body{margin:0;padding:0;overflow:hidden;}canvas{display:block;touch-action:none;user-select:none;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;}`;let o=e({},["color"]),{on:a,emit:r,last:l}=o,n=document.createElement("canvas"),i=n.getContext("2d");document.body.appendChild(n),n.addEventListener("touchstart",t=>t.preventDefault()),a("resize",t=>{let{vw:e,vh:o,vc:a}=t;n.width=e*a,n.height=o*a,n.style.width=e+"px",n.style.height=o+"px"});let s=()=>r("resize",{vw:window.innerWidth,vh:window.innerHeight,vc:window.devicePixelRatio||1});window.addEventListener("resize",s),s(),a("color",t=>{let{fill:e,stroke:o}=t;i.fillStyle=e,i.strokeStyle=o}),r("color",{bg:"black",fill:"white",stroke:"white"}),a("clear",()=>{i.restore(),i.save();let{vw:t=320,vh:e=320,vc:o=1}=l("resize");i.scale(o,o);let{bg:a="black",fill:r="white",stroke:n="white"}=l("color");i.fillStyle=a,i.fillRect(0,0,t,e),i.fillStyle=r,i.strokeStyle=n}),window.addEventListener("pointerup",t=>{let{clientX:e,clientY:o}=t;r("tap",{x:e,y:o})});let c=0,f=17,y=t=>{f=t-c,r("step",{t:c=t,dt:f}),r("clear"),r("draw",{ctx:i}),requestAnimationFrame(y)};requestAnimationFrame(y);var h=()=>{let t=!1,o={get active(){return t},set active(value){(t=value)?o.start():o.stop()}};return e(o,["start","stop","tap","resize","step","draw"]),o};let d={},x=t=>{if(!t||!d[t])return;Object.values(d).forEach(t=>{t.active&&(t.active=!1,t.syncOff(o),o.syncOff(t))});let e=d[t];e.syncOn(o),o.syncOn(e),e.resize(o.last("resize")),e.active=!0};var p=(t,e)=>{if(t)return e||(e=h()),d[t]=e,1===Object.keys(d).length&&x(t),e.on("stop",x),d[t]},g=(t={})=>{let e={text:"",x:16,y:16,font:"16px sans-serif",lineHeight:1.5,w:0,h:24};return Object.assign(e,t),Object.assign(t,e),t.draw=e=>{let{ctx:o}=e,{text:a,x:r,y:l,font:n,lineHeight:i}=t;o.font=n,o.textBaseline="top";let s=n.match(/\d+/g);s=Number(s=s?s[0]:16);let c=a.split("\n");t.h=c.length*s*i,t.w=0,c.forEach((e,a)=>{let n=o.measureText(e).width;o.fillText(e,r,l+a*s*i+s*(i-1)/2),t.w=Math.max(t.w,n)})},t},w=(t={})=>{let e=0,o=0,a={paths:[],fills:[],x:0,y:0,w:40,h:40,a:0};return Object.assign(a,t),Object.assign(t,a),e=t.w,o=t.h,t.draw=a=>{let{ctx:r}=a,{paths:l,fills:n,x:i,y:s,w:c,h:f,a:y}=t,h=y*Math.PI/180,d=c/e,x=f/o,p=new DOMMatrix([Math.cos(h)*d,Math.sin(h)*d,-Math.sin(h)*x,Math.cos(h)*x,i+c/2,s+f/2]),g=new DOMMatrix([1,0,0,1,-e/2,-o/2]);l.forEach((t,e)=>{let o=new Path2D,a=new Path2D;a.addPath(new Path2D(t),g),o.addPath(a,p),n[e]&&(r.fillStyle=n[e]),r.fill(o)})},t},u=(t={})=>{let e={paths:["M28,10C23.46,7.85,11.54,4.43,8,8c-4.22,4.26-4.85,20.46,0,24c4.06,2.96,15.7,0.6,20-2c3.03-1.83,10-7.99,10-10 S31.19,11.51,28,10z M14,29.04V10.74c1.13-0.23,2.54-0.19,4,0.01v18.39C16.55,29.29,15.16,29.27,14,29.04z M25.94,26.9 c-0.51,0.31-1.18,0.61-1.94,0.89V12.26c0.75,0.27,1.42,0.54,1.94,0.79c0.56,0.27,1.29,0.76,2.06,1.36V25.4 C27.22,26.04,26.49,26.57,25.94,26.9z"],x:0,y:0,w:40,h:40,a:0,fills:["Coral"],gx:0,gy:0};Object.assign(e,t),Object.assign(t,e);let o=w(t);return o.move=(t,e=!0)=>{let a=t.length,r=t[0].length,{gx:l,gy:n,a:i}=o,s=Math.round(Math.cos(i*Math.PI/180)),c=Math.round(Math.sin(i*Math.PI/180)),f=l+s,y=n+c;if(f<0&&(f=(f+r)%r),f>=r&&(f-=r),y<0&&(y=(y+a)%a),y>=a&&(y-=a),0===t[y][f]||13===t[y][f])o.x=40*f,o.y=40*y,o.gx=f,o.gy=y,t[y][f]+=1,t[n][l]=14===t[n][l]?13:0;else{if(e)return o.a+=180,o.move(t,!1);s=0,c=0}return o.fills=14===t[o.gy][o.gx]?["Coral"]:["Seashell"],{dx:s,dy:c}},o};t`body.p canvas{cursor:pointer;}`;let m=h(),v=u();((t={})=>{let o={x:0,y:0,w:40,h:40};Object.assign(o,t),Object.assign(t,o);let{on:a,off:r,once:l,emit:n,last:i}=e();return t.pointer={on:a,off:r,once:l,emit:n,last:i,down:!1,pointing:!1},window.addEventListener("pointerdown",e=>{let{clientX:o,clientY:a}=e;o>t.x&&o<t.x+t.w&&a>t.y&&a<t.y+t.h&&(n("down",{x:o,y:a}),t.pointer.down=!0)}),window.addEventListener("pointerup",e=>{let{clientX:o,clientY:a}=e;o>t.x&&o<t.x+t.w&&a>t.y&&a<t.y+t.h&&(n("tap",{x:o,y:a}),n("up",{x:o,y:a})),t.pointer.down=!1}),window.addEventListener("pointermove",e=>{let{clientX:o,clientY:a}=e;o>t.x&&o<t.x+t.w&&a>t.y&&a<t.y+t.h?(t.pointer.pointing||(n("startpointing",{x:o,y:a}),document.body.classList.add("p")),n("move",{x:o,y:a}),t.pointer.pointing=!0):(t.pointer.pointing&&(n("stoppointing",{x:o,y:a}),document.body.classList.remove("p")),t.pointer.pointing=!1)})})(v),m.on("start",()=>{m.emit("color",{stroke:"Coral",fill:"Coral",bg:"Aqua"}),v.pointer.once("tap",()=>{m.stop("level")})});let b=g({text:`The Tridecomino Coral Reef.
This mysterious reef is constantly
changing, but somehow the shape is
always a polyomino of 13 squares.

The many tourist boats are damaging
the reef. It is your job to chase
them away by gently tapping on them.

Boats can only move back and forth.
Red boats are above the reef.
White boats are not above the reef.

If there are no red boats left,
the reef is safe.

Good luck!

Tap on the boat to start...`});m.on("draw",t=>{b.draw(t),v.x=b.x,v.y=b.h+40,v.draw(t)});let M=h(),O=0;try{O=localStorage.getItem("number_of_tridecomino_coral_reefs_saved_in_2024")||"0",O=Number(O)}catch(t){O=0,console.warn(t)}let E=14,S=14,A=Array(14).fill(0).map(()=>Array(S).fill(0)),z=A.map((t,e)=>t.map((t,o)=>g({text:String(t),x:40*o,y:40*e,lineHeight:2.5}))),j=((t={})=>{let e={x:0,y:0,offset:{x:0,y:0},target:{x:0,y:0},cx:0,cy:0};return Object.assign(e,t),Object.assign(t,e),t.resize=e=>{let{vw:o,vh:a}=e;t.offset.x=Math.floor(o/2),t.offset.y=Math.floor(a/2)},t.start=e=>{t.resize(e),t.x=t.offset.x,t.y=t.offset.y,t.target.x=t.x,t.target.y=t.y,t.cx=Math.floor(t.x-t.offset.x),t.cy=Math.floor(t.y-t.offset.y)},t.step=e=>{let{dt:o}=e,{x:a,y:r,target:l}=t,n=l.x-a,i=l.y-r,s=.005*o;t.x+=n*s,t.y+=i*s,t.cx=Math.floor(t.x-t.offset.x),t.cy=Math.floor(t.y-t.offset.y)},t})(),k=[];M.on("start",()=>{let{vw:t,vh:e}=M.last("resize");j.start({vw:t,vh:e}),S=14,A=Array(E=14).fill(0).map(()=>Array(S).fill(0));let o={x:Math.floor(Math.random()*S),y:Math.floor(Math.random()*E)};A[o.y][o.x]=13;let a=[{dx:1,dy:0},{dx:0,dy:1},{dx:-1,dy:0},{dx:0,dy:-1}],r=1,l=a[Math.floor(Math.random()*a.length)];for(;r<13;){let t={x:o.x+l.dx,y:o.y+l.dy};t.x<0&&(t.x+=S),t.x>=S&&(t.x-=S),t.y<0&&(t.y+=E),t.y>=E&&(t.y-=E),0===A[t.y][t.x]&&(A[t.y][t.x]=13,l=a[Math.floor(Math.random()*a.length)],r++),o=t}A=A.filter((t,e)=>t.some(t=>0!==t||A[(e+1)%E].some(t=>0!==t)));let n=Array(S).fill(0);n=n.map((t,e)=>A.every(t=>0===t[e])),E=(A=A.map(t=>t.filter((t,e)=>0!==t||!n[e]||!n[(e+1)%S]))).length,S=A[0].length;let i=A.findIndex(t=>t.every(t=>0===t)),s={x:A[0].findIndex((t,e)=>A.every(t=>0===t[e])),y:i};for(;s.y>0;)A.push(A.shift()),s.y--;for(;s.x>0;)A.forEach(t=>t.push(t.shift())),s.x--;A[s.y][s.x]=1,A.push(Array(S).fill(0)),E=A.length;let c={x:(S=(A=A.map(t=>t.concat(0)))[0].length)-1,y:E-1};for(A[c.y][c.x]=3,l=(a=[{dx:1,dy:0},{dx:0,dy:1}])[0],A[s.y][s.x]=0;13!==A[s.y+l.dy][s.x+l.dx];)s.x+=l.dx,s.y+=l.dy,l=a[1-a.indexOf(l)];for(A[s.y][s.x]=1,l=(a=[{dx:-1,dy:0},{dx:0,dy:-1}])[0],A[c.y][c.x]=0;13!==A[c.y+l.dy][c.x+l.dx];)c.x+=l.dx,c.y+=l.dy,l=a[1-a.indexOf(l)];A[c.y][c.x]=3;for(let t=0;t<E;t++)for(let e=0;e<S;e++)if(0===A[t][e]){let o=!0;for(let a=-1;a<=1;a++)for(let r=-1;r<=1;r++){let l=A[(t+a+E)%E][(e+r+S)%S];0!==l&&2!==l&&(o=!1)}o&&(A[t][e]=2)}A[s.y][s.x]=0,A[c.y][c.x]=0,z=A.map((t,e)=>t.map((t,o)=>g({text:String(t),x:40*o,y:40*e}))),M.emit("color",{c0:"Aqua",c1:"Aqua",c2:"SandyBrown",c3:"Aqua",c13:"Aqua",c14:"Aqua"});let f=[0,90,180,270];k=[];for(let t=0;t<E;t++)for(let e=0;e<S;e++)if(0===A[t][e]){let o=u({x:40*e,y:40*t,a:f[Math.floor(Math.random()*f.length)],gx:e,gy:t});k.push(o),A[t][e]=1}k.forEach(t=>t.move(A)),M.on("tap",t=>{let{x:e,y:o}=t,a=e+j.cx,r=o+j.cy;for(;a<0;)a+=40*S;for(;r<0;)r+=40*E;let l=Math.floor(a/40)%S,n=Math.floor(r/40)%E;if(l<0||l>=S||n<0||n>=E)return;let i=A[n][l];if(1===i||14===i){let t=k.find(t=>t.gx===l&&t.gy===n);if(t){let{dx:e,dy:o}=t.move(A);j.target.x+=40*e,j.target.y+=40*o}}if(14===i){if(A.flat().includes(14))return;M.off("tap"),M.emit("color",{c0:"Aqua",c1:"Aqua",c2:"SandyBrown",c3:"Aqua",c13:"Coral",c14:"Coral"}),O++;try{localStorage.setItem("number_of_tridecomino_coral_reefs_saved_in_2024",O)}catch(t){console.warn(t)}z.forEach(t=>t.forEach(t=>t.text="13"===t.text?"#"+O:"")),q=!0,M.once("tap",()=>{M.stop("level"),q=!1})}})}),M.on("resize",j.resize),M.on("step",j.step);let C=new OffscreenCanvas(40,40),_=C.getContext("2d"),q=!1;M.on("draw",t=>{let{ctx:e}=t,{vw:o,vh:a}=M.last("resize");C.width=40*S,C.height=40*E;for(let t=0;t<E;t++)for(let e=0;e<S;e++)_.fillStyle=M.last("color")[`c${A[t][e]}`],_.fillRect(40*e,40*t,40,40);k.forEach(t=>t.draw({ctx:_})),q&&(_.fillStyle="Seashell",z.forEach(t=>t.forEach(t=>{t.draw({ctx:_})})));let r=e.createPattern(C,"repeat");e.fillStyle=r,e.translate(-j.cx,-j.cy),e.fillRect(j.cx,j.cy,o,a)}),p("menu",m),p("level",M);</script></body></html>