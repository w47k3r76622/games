!function(){function t(t,e,s){this.titleScreen=e,this.doodets=Util.ImgTxtArr(["@RR@@QQ@@RR@`ddD`ddD`ddD@D`@@AH@","@RR@@QQ@@RR@hmmEhmmEhmmE@Eh@@AH@","@RR@@QQ@@RR@X[[CX[[CX[[C@CX@@AH@","@vv@p@@FF@ppF@FpFp@pFF@pp@@F@vv@","@@@@@@@@x@xGGGx@@@@xG@"]),Fac.push(Util.Build(Sources.tree1())),Fac.push(Util.Build(Sources.tree2())),Fac.push(Util.Build(Sources.rock())),Fac.push(Util.Build(Sources.rock1())),Fac.push(Util.Build(Sources.Log()));var i=[Factory.Tile("#69EA5D",32),Factory.Tile("#61D856",32),Factory.Tile("#F6C996",32),Factory.Tile("#F3B36E",32),Factory.Tile("#C0C0C0",32),Factory.Tile("#00FFFF",32),Factory.Tile("#00DBDB",32),Factory.Tile("#69EA5D",32),Factory.Tile("#61D856",32),Factory.Tile("#C0C0C0",32),Factory.Tile("#54311D",32),Factory.Hole(["#54311D","#744B31"],32),Factory.Tile("#744B31",32),Factory.Tile("#328DC1",32),Factory.Hole(["#328DC1","#4294C4"],32),Factory.Tile("#4294C4",32),Factory.Tile("#4294C4",32)];this.helpCt=500,this.wincnt=0,this.win,this.level=s,this.isomode=!0;var r=t.levels[this.level];this.scene=new MapManager(t.size,r,this.isomode?i:t2d,this.isomode),this.assets=new ObjectPool,this.carSpawn=[],this.player,this.screen={w:t.size.screen.width*t.size.tile.width,h:t.size.screen.height*t.size.tile.height};var a=r.features.plyrspawn,o=t.size.tile.width,n=t.size.tile.height;this.player=new Player(a.x*o,a.y*n),this.assets.Add(this.player),this.tosave=r.features.doodspawn.length;for(var l=0;l<this.tosave;l++){a=r.features.doodspawn[l],(h=new Dood(a.x*o,a.y*n,a.t)).target=this.player,this.assets.Add(h)}for(l=0;l<r.features.hard.length;l++){a=r.features.hard[l];var h=new Feature(a.x*o,a.y*n,Const.actors.stump,0,0,0);this.assets.Add(h)}for(l=0;l<r.st;l++){do{a={x:Util.RndI(0,r.dim.width),y:Util.RndI(0,r.dim.height)};var c=this.scene.Content(a.x*o,a.y*n),y=this.scene.Content((a.x-1)*o,a.y*n),p=this.scene.Content((a.x+1)*o,a.y*n),d=(h=this.assets.Get([Const.actors.dood,Const.actors.stump])).filter(t=>t.x==a.x*o&&t.y==a.y*n)}while(c>1||y>12||p>12||0!=d.length);h=new Feature(a.x*o,a.y*n,Const.actors.stump,32,0,0);this.assets.Add(h)}AssetUtil.CarSpawn(this.carSpawn,r.features.carhl,Const.actors.carhl,o,n),AssetUtil.CarSpawn(this.carSpawn,r.features.carhr,Const.actors.carhr,o,n),AssetUtil.CarSpawn(this.carSpawn,r.features.carvu,Const.actors.carvu,o,n),AssetUtil.CarSpawn(this.carSpawn,r.features.carvd,Const.actors.carvd,o,n),AssetUtil.CarSpawn(this.carSpawn,r.features.boat,Const.actors.log,o,n)}t.prototype={Update:function(t){for(var e=0;e<this.carSpawn.length;e++)if(0==this.carSpawn[e].ready)if(this.carSpawn[e].type==Const.actors.log){for(var s=this.carSpawn[e].x,i=this.carSpawn[e].y,r=0;r<Util.RndI(2,4);r++){var a=new Feature(s,i,Const.actors.log,12,2,1);this.assets.Add(a),i-=32}this.carSpawn[e].ready=parseInt(150*(5-a.max))}else{a=new Car(this.carSpawn[e].x,this.carSpawn[e].y,Util.Rnd(2.5)+1.5,this.carSpawn[e].type);this.assets.Add(a);var o=new Drone(a);this.assets.Add(o),this.carSpawn[e].ready=parseInt(150*(5-a.max))}else this.carSpawn[e].ready--;for(var n=this.assets.Get(),l=0;l<n.length;l++)n[l].Logic(t),n[l].Collider(n),n[l].Update(t);this.scene.ScrollTo(this.player.x,this.player.y);var h=this.assets.Get([Const.actors.dood]);for(l=0;l<h.length;l++)for(var c=0;c<h.length;c++)h[l]!=h[c]&&0==h[l].hold&&0==h[c].hold&&h[l].x==h[c].x&&h[l].y==h[c].y&&(h[l].hold=120);var y=h.filter(t=>t.status==Const.game.status.home);if(this.wincnt>0)this.wincnt--,0==this.wincnt&&this.titleScreen(this.win,this.tosave-h.length);else if(h.length==y.length&&h.length>0&&!this.player.death&&this.player.status==Const.game.status.home?(this.wincnt=128,this.win=!0):(this.player.death>0||0==h.length)&&(this.wincnt=128,this.win=!1),this.helpCt>0){if(this.helpCt--,0==this.helpCt){var p=h.filter(t=>t.status==Const.game.status.lost);if(h.length==y.length)this.player.help={d:AssetUtil.Dir(this.player.home,this.player),t:0,c:new N(30,5)};else for(o=1e4,e=0;e<p.length;e++){var d=Math.abs(Util.Dist(this.player.x,p[e].x,this.player.y,p[e].y));d<o&&(o=d)>400&&(this.player.help={d:AssetUtil.Dir(p[e],this.player),t:1,c:new N(30,5)})}}}else null==this.player.help&&(this.helpCt=500);input.Clr()},Render:function(){var t=this.scene.ScrollOffset(),e=this.assets.Get();e.sort(function(t,e){var s=Util.IsoPoint(t.x,t.y),i=Util.IsoPoint(e.x,e.y);return s.y-i.y}),this.scene.Render();for(var s=0;s<e.length;s++)e[s].Render(t);Renderer.DrawBox(0,0,this.screen.w,32,"rgba(0,0,0,0.6)"),Renderer.Text("score:"+plyrScore,32,24,Const.game.h2,"#fff");var i=this.assets.Get([Const.actors.dood,Const.actors.null]);for(s=0;s<i.length;s++)Renderer.IconText(8,this.doodets[i[s].id],760-32*s,4,3),i[s].status!=Const.game.status.home&&i[s].type!=Const.actors.null||Renderer.IconText(8,i[s].status==Const.game.status.home?this.doodets[4]:this.doodets[3],760-32*s,4,3)}},window.Game=t}(),function(){function t(t,e,s,i,r){this.screen={w:t.screen.width*t.tile.width,h:t.screen.height*t.tile.height},this.startGame=e;var a=["bold 48px Arial","24px Arial","16px Arial"];this.fnt=a,this.max=2,this.gover=i,this.lost="",this.time=400,this.intro=0,this.level=s,this.aseq=0==s;var o,n,l=dCols,h=["#b5af00","#f00","#c10000","#999"];if(this.fc=h,r>0){var c=["Graham","Trevor","Colin","Martin","Geoff"],y="";if(1==r)y=Util.OneOf(c)+" ";else for(var p=0;p<r;p++)p==r-1&&(y+="and "),y+=c[p]+" ";this.lost=y+Util.OneOf(["didn't make it","was lost"])}function d(t){for(var e=f(),s=308,i=116,r=0;r<t.length;r++)e.r.PolySprite(s+32*r,i-16*r,t[r]);return e.c}function f(t){var e=document.createElement("canvas");e.width=600,e.height=200,this.ctx=e.getContext("2d");var s=new Rendering(this.ctx);return x(s,-364,0,16,16,[Factory.Tile("#69EA5D",32),Factory.Tile("#61D856",32)],1,0),t&&x(s,114,144,3,3,[Factory.Tile("#00FFFF",32)],0,1),{r:s,c:e}}function x(t,e,s,i,r,a,o,n){for(var l=0,h=0;h<i;h++){for(var c=s,y=e,p=0;p<r;p++)t.PolyTile(y,c,a[l]),y+=32,c+=16;e+=64,l=o-l,n&&(e-=32,s-=16)}}this.txt=[[{font:a[0],txt:"Kitaku",col:this.fc[0]},{txt:null},{font:a[2],txt:"Tony, your friends have become lost, again."},{font:a[2],txt:"You must save them and bring them back home"},{txt:null},{font:a[2],txt:"    [W]",col:this.fc[3]},{font:a[2],txt:"[A] [S] [D] / [arrow keys] Movement",col:this.fc[3]}],[{font:a[1],txt:"find your friends"},{img:(o=f(),n={x:308,y:116},o.r.PolySprite(n.x,n.y,Factory.Man2()),o.r.PolySprite(n.x,n.y-60,Factory.Hat()),o.r.PolySprite(n.x+192,n.y-16,Util.FlipX(Factory.Boy1(0))),o.c)}],[{font:a[1],txt:"bring them back"},{img:function(){var t=f(1),e={x:244,y:116};return t.r.PolySprite(e.x,e.y,Util.FlipX(Factory.Man1(0))),t.r.PolySprite(e.x,e.y-60,Factory.Hat()),t.r.PolySprite(e.x+96,e.y-16,Util.Scale(Util.FlipX(Factory.Man1(0)),.7)),t.c}()}],[{font:a[1],txt:"one at a time"},{img:function(){var t=f(1),e={x:116,y:148};return t.r.PolySprite(e.x,e.y,Util.FlipX(Factory.Man1(0))),t.r.PolySprite(e.x,e.y-60,Factory.Hat()),t.r.PolySprite(e.x+96,e.y-16,Util.Scale(Util.FlipX(Factory.Man1(0)),.7)),t.r.ImgText(22,scrs[0],e.x+80,e.y-112,2,h[1]),t.c}()}],[{font:a[1],txt:"or altogether"},{img:function(){var t=f(1),e={x:116,y:148};return t.r.PolySprite(e.x,e.y,Util.FlipX(Factory.Man1(0))),t.r.PolySprite(e.x,e.y-60,Factory.Hat()),t.r.PolySprite(e.x+64,e.y-16,Util.Scale(Util.FlipX(Factory.Man1(0)),.7)),t.r.PolySprite(e.x+128,e.y,Util.Scale(Util.FlipX(Factory.Man1(0)),.7)),t.r.ImgText(22,scrs[0],e.x+48,e.y-112,2,h[1]),t.r.ImgText(22,scrs[1],e.x+112,e.y-96,2,h[1]),t.c}()}]],this.lvlInfo=[[{font:a[0],txt:"level 1"},{img:d([Factory.Boy1(0,l[0]),Factory.Boy1(0,l[1])])}],[{font:a[0],txt:"Level 2"},{img:d([Factory.Boy1(0,l[0]),Factory.Boy1(0,l[0]),Factory.Boy1(0,l[1]),Factory.Boy1(0,l[2])])}],[{font:a[0],txt:"Congratulations"},{txt:null},{font:a[1],txt:"Your a real hero now"},{txt:null},{font:a[1],txt:"Score: [score]"},{txt:null},{font:a[1],txt:"[lost]"}],[{font:a[0],txt:"Game Over"},{txt:null},{font:a[1],txt:"Everyone is disappointed in you Tony"},{txt:null},{font:a[1],txt:"Score: [score]"},{txt:null},{font:a[1],txt:"[lost]"}]],this.chars=Util.ImgTxtArr(["@@@@@@@@@@AIIII@@@A@@@H@H@AHIII@H@A@@@H@H@AIIII@H@A@@@@@H@IIIIIAH@I@@@@AHHH@H@@A@H@IIII@@H@AH@H@@A@AH@H@HA@AH@I@@@@@@@@@@@@@@@@@","@@@@@@@@@@@h@@@@@@@H@@@@@mmmmmm@@A@@@@H@@A@@@IH@@@@II@@@@HIH@@@@@@@H@HIA@@HIIA@@HIAH@@@@@@@H@@@@@@@H@@hE@@@H@@H@@@@Hmmm@@@@@@@@@"])}t.prototype={Update:function(t){this.time>0?this.time--:(this.intro++,this.time=240,this.intro>1&&(firstTime=!1),this.intro==this.txt.length&&(this.intro=0,this.time=400)),this.level<=this.max&&0==firstTime&&input.isUp("SPACE")&&(this.level==this.max?(this.gover=!1,this.time=400,this.intro=0,this.level=0,this.aseq=!0):this.gover?(this.gover=!1,this.time=400,this.intro=0,this.level=0,this.aseq=!0):this.aseq?this.aseq=!1:this.startGame(this.level)),input.Clr()},Render:function(){Renderer.Clear(this.screen.w,this.screen.h);for(var t=0;t<this.chars.length;t++)Renderer.ImgText(16,this.chars[t],12*(16+16*t),0,12,this.fc[2]);if(this.gover){var e=this.lvlInfo[3];this.Screen(e)}else if(this.aseq){e=this.txt[this.intro];this.Screen(e)}else{e=this.lvlInfo[this.level];this.Screen(e)}firstTime||Renderer.Text("Press [SPACE]",20,this.screen.h-32,this.fnt[1],this.fc[3])},Screen:function(t){for(var e=260,s=0;s<t.length;s++){if(t[s].txt){var i=t[s].txt;i=(i=i.replace("[score]",plyrScore)).replace("[lost]",this.lost),Renderer.Text(i,200,e,t[s].font,t[s].col||this.fc[0])}t[s].img&&Renderer.Image(t[s].img,100,300),e+=18}}},window.Title=t}();