var MapManager=function(t,e,i,h){var n=t,r=function(t){for(var e,i,h=[],n=t.split("|"),r=0;r<n.length;r++)if(i=n[r].split(","),e=parseInt(i[0]),h.push(e),i.length>1)for(var o=1;o<i[1];o++)h.push(e);for(var r=0;r<h.length;r++)h[r]+",";return h}(e.data),o=e.dim.width,f=e.dim.height,l=h?{x:16,y:-384}:{x:0,y:0},s={x:0,y:0,xoffset:0,yoffset:0},u=i;function d(t,e){return Math.floor(t/e)}function a(t,e){return Math.floor(t/e)}function g(t,e){return r[function(t,e){return d(t,n.tile.width)+a(e,n.tile.height)*o}(t,e)]}return{Cell:function(t,e,i){return{x:d(t,i)*i,y:a(e,i)*i}},Content:function(t,e){return g(t,e)},SetMap:function(t){r=t},IsVisible:function(t){},ScrollOffset:function(){return{x:s.xoffset*n.tile.width-s.x-l.x,y:s.yoffset*n.tile.height-s.y-l.y}},ScrollTo:function(t,e){var i=n.iso.width*n.tile.width/2,h=n.iso.height*n.tile.height/2,r=o*n.tile.width-n.iso.width*n.tile.width,l=f*n.tile.height-n.iso.height*n.tile.height,u=s.xoffset*n.tile.width-s.x,d=s.yoffset*n.tile.height-s.y,a=Util.Lerp(u,t-i,.04),g=Util.Lerp(d,e-h,.04);a>0&&a<r&&(s.x=-a%n.tile.width,s.xoffset=parseInt(a/n.tile.width)),g>0&&g<l&&(s.y=-g%n.tile.height,s.yoffset=parseInt(g/n.tile.height))},Render:function(){!function(t){n.screen.width,n.tile.width,n.screen.height,n.tile.height;for(var e,i=0,h=o,f=n.iso.width,d=n.iso.height,a=0;a<d;a++)for(var g=0;g<f;g++){i=(a+s.yoffset)*h+(g+s.xoffset),e=r[i];var y=Util.IsoPoint(g*n.tile.width+s.x+l.x,a*n.tile.height+s.y+l.y);u[e].length?Renderer.PolySprite(y.x,y.y,u[e]):Renderer.PolyTile(y.x,y.y,u[e])}}()}}};