!function(){"use strict";const e=(...e)=>{const t=e.filter((e=>e));return e=>(t.forEach((t=>t(e))),e)},t=(e,t)=>(t.forEach((t=>t&&t(e))),e),s=(...e)=>t=>e.forEach((e=>null!=e&&t.appendChild("number"==typeof e||"string"==typeof e?document.createTextNode(String(e)):e))),o=e=>t=>s=>s.setAttribute(e,String(t)),n=e=>t=>t.classList.add(...e.split(/\s+/)),a=e=>(...s)=>t(document.createElement(e),s),l=e=>t=>s=>s.addEventListener(e,(e=>t(s,e))),r=(e,t)=>(e.parentNode&&e.parentNode.replaceChild(t,e),t),i=e=>(...t)=>s=>(s.style[e]=t.join(" "),s),c=e=>t=>t.textContent=String(e),p=n("absolute"),g=n("flex"),d=n("flex-center"),h=n("flex-col"),u=n("fl"),f=n("ml-8"),m=n("mt-8"),x=n("pe-all"),y=n("pe-none"),v=n("pin"),M=n("ta-center"),b=n("to-nw"),w=(e,t)=>({x:e,y:t}),S=w(0,0),I=e=>Math.atan2(e.y,e.x),G=(e,t)=>w(e.x/t,e.y/t),C=(e,t)=>(e.x/=t,e.y/=t,e),P=e=>(e.x=Math.floor(e.x),e.y=Math.floor(e.y),e),R=e=>Math.sqrt(E(e)),E=e=>{return s=e,(t=e).x*s.x+t.y*s.y;var t,s},T=(e,t)=>w(e.x-t.x,e.y-t.y),k=(e,t)=>(e.x-=t.x,e.y-=t.y,e),$=(e,t)=>null==e?t:null==t?e:w(e.x+t.x,e.y+t.y),A=(e,t)=>(e.x+=t.x,e.y+=t.y,e),D=e=>(e.x=Math.round(e.x),e.y=Math.round(e.y),e),F=(e,t)=>w(e.x*t,e.y*t),H=(e,t)=>(e.x*=t,e.y*=t,e),q=e=>{const t=I(e);return w(Math.cos(t),Math.sin(t))},B=e=>w(Math.cos(e),Math.sin(e)),O=()=>{const e={children:[],offs:[],parent:N[0],free:()=>(e.children.forEach((e=>e.free())),e.children=[],e.offs.forEach((e=>e())),e.offs=[],e),orphan:()=>(null!=e.parent&&(e.parent.children=e.parent.children.filter((t=>t!==e))),e),start:()=>(N.unshift(e),e),stop:()=>(N.shift(),e)};return e.parent?(e.parent.children.push(e),e):e},L=e=>{N.length&&N[0].offs.push(e)},N=[],W=(e,t,s=U)=>e.length===t.length&&e.every(((e,o)=>s(e,t[o]))),U=(e,t)=>e===t,V=(e,t=U)=>{const s=[],o={$:e=>t=>{o.listenAndCall((s=>(e(s)||J)(t)))},get:()=>e,listen:e=>(((e,t,s)=>{e.push(t),N.length&&N[0].offs.push(s)})(s,e,(()=>{const t=s.indexOf(e);-1!==t&&s.splice(t,1)})),o),listenAndCall:t=>(t(e),o.listen(t)),set:o=>!t(e,o)&&(e=o,s.forEach((e=>e(o))),!0)};return o},j=e=>{const t={$:t=>t(e)||J,get:()=>e,listen:()=>t,listenAndCall:s=>(s(e),t)};return t},z=(e,t)=>{const s=localStorage.getItem(e);return V(null==s?t:JSON.parse(s)).listen((t=>localStorage.setItem(e,JSON.stringify(t))))},J=()=>{},X=w(0,20),Y=w(0,-1600),K=w(0,-475),Q=V([516315628,2508340506,3723352775,2034031582,90992610,1240836893,2355514056,2350829688,2330696698,320666852,2878050570,3059498660,1477747266,2932153038,2405737307,3779378240,3416934813,639096320]),Z=e=>e.disabled=!0,_=e=>e?Z:ee,ee=e=>e.disabled=!1,te=o("height"),se=o("src"),oe=o("type"),ne=e=>t=>t.value=null!=e?String(e):"",ae=o("width"),le=(t,s=t)=>e(te(s),ae(t)),re=l("change"),ie=l("click"),ce=l("mousedown"),pe=l("mousemove"),ge=l("mouseup"),de=l("resize"),he=l("touchend"),ue=l("touchmove"),fe=l("touchstart"),me=l("visibilitychange"),xe=(...e)=>Ie(Ce,...e),ye=a("canvas"),ve=a("div"),Me=a("h1"),be=a("img"),we=a("pre"),Se=a("span"),Ie=a("button"),Ge=a("input"),Ce=oe("button"),Pe=(e,t,s,o)=>n=>{for(let a=o;a-- >0;){const o=(o,l)=>{const r=4*(n.canvas.width*o+l);return a[r]===e&&a[r+1]===t&&a[r+2]===s&&255===a[r+3]},{data:a}=n.getImageData(0,0,n.canvas.width,n.canvas.height);for(let l=0;l<a.length;l+=4){if(a[l]!==e||a[l+1]!==t||a[l+2]!==s||255!==a[l+3])continue;const r=l/4%n.canvas.width,i=Math.floor(l/4/n.canvas.width);o(i+1,r+1)||n.fillRect(r,i,1,1)}}},Re=(Ae="fillStyle",e=>t=>t[Ae]=e),Ee=(e=1)=>t=>{const s=(e,s,n)=>!!o[4*(t.canvas.width*e+s)+n],{data:o}=t.getImageData(0,0,t.canvas.width,t.canvas.height);for(let n=0;n<o.length;n+=4){if(0!==o[n+3])continue;const a=n/4%t.canvas.width,l=Math.floor(n/4/t.canvas.width);+(a>0&&s(l,a-1,3))+ +(a<t.canvas.width-1&&s(l,a+1,3))+ +(l>0&&s(l-1,a,3))+ +(l<t.canvas.height-1&&s(l+1,a,3))<e||t.fillRect(a,l,1,1)}},Te=(e,t,s,o=s)=>n=>{for(let a=.5-o;a<o;++a){const l=Math.round(Math.sqrt(s*s*(1-a*a/(o*o))));n.fillRect(e-l,t+a-.5,2*l,1)}},ke=(e,t,s,o)=>n=>n.fillRect(e,t,s,o),$e=(...e)=>s=>{const o=s.getContext("2d");null!=o&&t(o,e)};var Ae;const De=20,Fe=ye(le(46),$e(Re("#000"),Te(23,23,De),Re("hsl(60, 90%, 70%)"),Ee(1),Re("hsla(60, 90%, 70%, .7)"),Ee(1),Re("hsla(60, 90%, 70%, .4)"),Ee(1),Ee(2))),He=e=>({img:Fe,pos:e,r:23}),qe=()=>{},Be=(e,t,s=0)=>e.reduce(((e,s)=>e+t(s)),s),Oe=(e,t)=>{const s=new Array(e);for(let o=0;o<e;++o)s[o]=t(o);return s},Le=Oe(4,(e=>ye(le(2*(e+1)+4),$e(Re("#f00"),Te(e+3,e+3,e+1,e+1),Re("rgba(255,255,255,.5)"),Pe(255,0,0,1),Re("#666"),Ee(1),Ee(2),Re("#fff"),Ee(1))))),Ne=["hsl(0, 90%, 60%)","hsl(30, 90%, 60%)","hsl(60, 90%, 60%)","#555"],We=Oe(4*Ne.length,(e=>{const t=(1+Math.floor(e/Ne.length))/2;return ye(le(2*t),$e(Re(Ne[e%Ne.length]),Te(t,t,t)))})),Ue="hsl(120, 80%, 70%)",Ve=ye(le(4,8),$e(Re(Ue),ke(1,2,1,4),ke(2,3,1,2),Re("#fff"),Ee(1),ke(0,0,1,8))),je=Oe(10,(e=>{const t=e+2;return{r:t,img:ye(le(2*t),$e(Re(Ue),Te(t,t,t-1),Re("#fff"),Ee(1)))}})),ze=(e,t)=>e+et()*(t-e),Je=(e,t)=>e+Math.floor(et()*(t+1-e)),Xe=(e=Ye())=>{const t=()=>(e=(Qe*e+Ze)%_e)/_e;return{f:(e,s)=>e+t()*(s-e),m:(e,s)=>e+Math.floor(t()*(s+1-e)),seedCreate:()=>Math.floor(t()*_e),seedGet:()=>e}},Ye=()=>Math.floor(Math.random()*_e),Ke=e=>tt=e,Qe=1103515245,Ze=12345,_e=Math.pow(2,32),et=()=>(tt=(Qe*tt+Ze)%_e)/_e;let tt=Math.floor(Math.random()*_e);const st=[],ot=(e,...t)=>be(se(e),(e=>st.push(e)),...t),nt=ot("art/ship.png"),at=()=>({acc:w(0,0),ang:0,grounded:!1,pos:w(0,0),vel:w(0,0)}),lt=256,rt=(e,t,s)=>{const o=at(),n=(a=5,l=(e,t)=>(e=>{const t=Xe(e),s=[];for(let e=t.m(25,50);e-- >0;)s.push((o=w(t.m(0,255),t.m(0,255)),n=t.m(1,2),{pos:o,r:n}));var o,n;return{seed:e,stars:s}})(+`${s}${t}${e}`),Oe(5,(e=>Oe(a,(t=>l(e,t))))));var a,l;return{blackHole:e,explosions:Oe(48,(()=>({img:We[Je(0,We.length-1)],life:0,pos:S,vel:S}))),planets:t,seed:s,ship:o,spaceman:void 0,stars:n}},it=(e,t)=>{const s=Je(0,255),o=Je(0,255),n=Je(0,255),a=`rgb(${s}, ${o}, ${n})`;return{img:ye(le(2*t),$e(Re(a),Te(t,t,t-2),Re("rgba(0,0,0,.125)"),Pe(s,o,n,Math.round(t/5)),(e=>{e.globalCompositeOperation="source-atop",e.fillStyle=`rgb(${Math.round(.875*s)},${Math.round(.875*o)},${Math.round(.875*n)})`;for(let s=Je(Math.round(t*t/20),Math.round(t*t/10));s-- >0;){const s=w(Je(0,2*t-1),Je(0,2*t-1));Te(s.x,s.y,Je(1,6))(e)}e.fillStyle=`hsl(240, ${Je(70,80)}%, ${Je(30,40)}%)`;let a=Je(0,Math.floor(2*t/25));for(;a-- >0;){const s=ze(-Math.PI,Math.PI),o=s-Math.PI/2,n=s+Math.PI/2;let a=D(A(H(B(ze(-Math.PI,Math.PI)),Je(0,t)),w(t,t))),l=Je(3,t/10),r=Je(5,t/2);for(;r-- >0;)Te(a.x,a.y,l)(e),a=D(A(H(B(ze(o,n)),l),a)),l=Je(3,t/5)}e.fillStyle="#fff";for(let s=Je(0,Math.floor(2*t/25));s-- >0;){const s=ze(-Math.PI,Math.PI),o=s-Math.PI/2,n=s+Math.PI/2;let a=w(Je(0,2*t-1),Je(0,2*t-1)),l=Je(3,t/10);for(let s=Je(1,t/2);s-- >0;)Te(a.x,a.y,l)(e),a=A(H(B(ze(o,n)),l),a),l=Je(3,t/5)}e.globalCompositeOperation="source-over"}),Re("#fff"),Ee(1),Ee(1),Ee(2))),pos:e,r:t}},ct=ot("art/pro-shop.png"),pt=e=>{const t=Xe(e);return Oe(18,(()=>t.seedCreate()))},gt=(e,t,s=!1)=>({ang:e,img:s?dt:ht,pos:t}),dt=ot("art/spacegirl.png"),ht=ot("art/spaceman.png"),ut=()=>{const e=V(!document.hidden).listen((e=>{if(e){const e=Date.now();t.forEach((t=>{t.id=window.setTimeout(t.cb,Math.max(0,t.time-e))}))}else t.forEach((e=>{window.clearTimeout(e.id),e.id=void 0}))}));let t=new Set;return me((()=>e.set(!document.hidden)))(document),{visible:e,interval(s,o){const n=()=>{try{s()}finally{a.time=Date.now()-o,a.id=window.setTimeout(n,o)}},a={cb:n,id:e.get()?window.setTimeout(n,o):void 0,time:Date.now()+o};return t.add(a),l=()=>{null!=a.id&&window.clearTimeout(a.id),t.delete(a)},()=>{L(l)};var l}}};let ft=[],mt=!1;const xt=e=>{if(mt)return e();mt=!0,e(),ft.forEach((({f:e,el:t})=>e(t))),ft=[],mt=!1},yt=(e,t)=>{const s=O().start(),o=document.createComment("");let n=t(e.get())||o;return s.stop(),e.listen((e=>{s.free().start(),xt((()=>{r(n,n=t(e)||o)})),s.stop()})),n},vt=(e,t)=>yt(e,(e=>e?t(e):void 0)),Mt=(e,t)=>s=>{e.listenAndCall((e=>(t(e)||qe)(s)))};function bt(...e){const t=V(e.map((e=>e.get())),W);return e.forEach(((e,s)=>{e.listen((e=>t.set(t.get().map(((t,o)=>s===o?e:t)))))})),t}const wt=(e,t,s=U)=>{const o=e.get(),n=O().start(),a=V(t(o),s);return n.stop(),e.listen((e=>{n.free().start(),a.set(t(e)),n.stop()})),a},St=i("background-color"),It=i("bottom"),Gt=i("font-size"),Ct=i("gap"),Pt=i("height"),Rt=i("left"),Et=i("margin-top"),Tt=i("opacity"),kt=i("padding"),$t=i("right"),At=i("text-align"),Dt=i("transform"),Ft=i("visibility"),Ht=i("white-space"),qt=i("width"),Bt=Ft("hidden"),Ot=Ft(""),Lt=e=>e?Ot:Bt,Nt=["G#","A","A#","B","C","C#","D","D#","E","F","F#","G"],Wt=(e,t)=>{const s=12*(t-1)+Nt.indexOf(e);return 440*Math.pow(2,(s-49)/12)},Ut=(e,t)=>({t:"note",freq:e,length:t}),Vt=e=>({t:"rest",length:e}),jt=(e,t)=>{const s=Be(t,(e=>e.length));return{beats:t,bpm:e,lengthBeats:s,lengthS:s/e*60}},zt=jt(120,[Ut(Wt("C",3),1),Ut(Wt("C#",3),1),Ut(Wt("D",3),1),Ut(Wt("D#",3),1),Ut(Wt("E",3),1),Ut(Wt("F",3),1)]),Jt=jt(600,[Ut(Wt("G",4),1),Vt(2),Ut(Wt("F",4),16),Vt(1),Ut(Wt("F",4),1),Vt(2),Ut(Wt("E",4),8),Vt(1),Ut(Wt("E",4),1),Vt(2),Ut(Wt("D",4),8),Vt(1),Ut(Wt("C",4),2),Vt(1),Ut(Wt("C",4),2),Ut(Wt("D",4),1),Vt(6),Ut(Wt("C",4),2),Vt(1),Ut(Wt("C",4),2),Ut(Wt("D",4),1),Vt(2)]),Xt=(e,t,s)=>{const o=Math.round(.05*e.sampleRate),n=Math.round(60*e.sampleRate/t.bpm),a=Be(t.beats,(e=>e.length))*n,l=e.createBuffer(1,a,e.sampleRate),r=l.getChannelData(0);let i=0,c=0;return t.beats.forEach((t=>{if("rest"===t.t)i+=t.length*n,c=0;else{const a=1/t.freq*e.sampleRate,l=Math.round(a),p=t.length*n;c=0;for(let e=0;e<p;++e){const t=s(c/l),n=e<o?t*e/o:p-e<o?t*(p-e)/o:t,a=Math.floor(128*(n+1));r[i++]=(a>255?255:a)/127.5-1,c=(c+1)%l}}})),l},Yt=e=>e,Kt=e=>Math.sin(e*Qt),Qt=2*Math.PI,Zt=Wt("C",3),_t=(e,t,s=72,o=0,n=0)=>({t:"game",bombTime:V(0),bombs:V(s),index:V(o),seed:e,seeds:t,speed:V(1),state:V(ts(2)),timeSec:V(n)}),es=()=>({t:"title",leaveSec:V(void 0),savedGame:null}),ts=e=>({t:"preHole",sec:e}),ss=(e,t,s=!1)=>({margin:s,sec:e,text:t}),os=[ss(4,"What is this place?"),ss(4,"\nHankler's Mini Golf."),ss(4,"Wanna play? It's 12 bucks."),ss(4,"\nI think I'm good.")],ns=[ss(4,"We..."),ss(4,"might be here for a while...")],as=[ss(4,"USSF Recon Ship 412 Captain's Log, Day 4"),ss(4,"\nDue to poor planning, we are totally boned."),ss(2,"\nSupplies Report:"),ss(2,"Food: Gone"),ss(2,"Water: Almost Gone"),ss(2,"Oxygen: Running Low"),ss(18,"Variable-Power Explosive Devices: 72"),ss(4,"\nGuess we better use 'em")],ls=[ss(4,"Welp."),ss(4,"\nGuess this'll have to do.")],rs=e=>{const o=(...e)=>xe(ie((()=>i.button())),...e),n=z("astro-Beaten",!1),a=z("astro-SavedGame",null),l=V(es()),{visible:r}=ut(),i=((e,t,s)=>{const o=(t=0,s=.125,o=0,n=0,a=e.currentTime)=>{const l=e.createGain();return l.gain.setValueAtTime(s*(1+2*o),a).linearRampToValueAtTime(s,a+n).linearRampToValueAtTime(0,a+n+t),l},n=()=>{"none"!==d.t&&(d.destroy(),d={t:"none"})},a=t=>1e5*Math.pow(t,2)/e.sampleRate,l=V(!0),r=wt(bt(l,s),(([e,t])=>e||!t)),i=Xt(e,zt,Kt),c=Xt(e,Jt,Yt),p=(()=>{const t=a(.20067061483860016),s=a(.21661974489688873),o=Math.round(.011904761904761904*e.sampleRate),n=e.createBuffer(1,Math.round(e.sampleRate*(t+s)),e.sampleRate),l=n.getChannelData(0);let r=0,i=Oe(32,(()=>Je(-127,127)/127));for(let e=0;e<l.length;++e)l[e]=i[Math.floor(r/o*32)],++r>=o&&(r%=o,i=Oe(32,(()=>Je(-127,127)/127)));return n})(),g=(()=>{const t=a(.20067061483860016),s=a(.21661974489688873),o=Math.round(.023809523809523808*e.sampleRate),n=e.createBuffer(1,Math.round(e.sampleRate*(t+s)),e.sampleRate),l=n.getChannelData(0);let r=0,i=Oe(32,(()=>Je(-127,127)/127));for(let e=0;e<l.length;++e)l[e]=i[Math.floor(r/o*32)],++r>=o&&(r%=o,i=Oe(32,(()=>Je(-127,127)/127)));return n})();let d={t:"none"};return bt(r,t).listenAndCall((([t,s])=>{if(t)n();else if("prologue"===s.t){if("prologue"!==d.t){n();const t=e.createBufferSource(),s=e.createGain();t.buffer=i,t.loop=!0,s.gain.value=.125,t.connect(s).connect(e.destination),t.start(),d={t:"prologue",destroy(){t.stop()},source:t}}}else if("postGame"===s.t){if("postGame"!==d.t){n();const t=t=>{if("postGame"===d.t)if("falling"===t.t){if("osc"!==d.source.t){"buffer"===d.source.t&&d.source.node.stop();const t=e.createOscillator(),s=e.createGain();t.type="sine",t.frequency.value=Wt("C",3),s.gain.value=.125,t.connect(s).connect(e.destination),t.start(),d.source={t:"osc",node:t}}}else if("end"===t.t){if("buffer"!==d.source.t){"osc"===d.source.t&&d.source.node.stop();const t=e.createBufferSource(),s=e.createGain();t.buffer=c,t.loop=!0,s.gain.value=.125,t.connect(s).connect(e.destination),t.start(),d.source={t:"buffer",node:t}}}else"none"!==d.source.t&&(d.source.node.stop(),d.source={t:"none"})};d={t:"postGame",destroy(){o.free(),"postGame"===d.t&&"none"!==d.source.t&&d.source.node.stop()},source:{t:"none"}};const o=O().start();s.state.listenAndCall(t),o.stop()}}else if("stranded"===s.t){if("stranded"!==d.t){n();const t=t=>{if("stranded"===d.t)if("end"===t.t){if("buffer"!==d.source.t){const t=e.createBufferSource(),s=e.createGain();t.buffer=c,t.loop=!0,s.gain.value=.125,t.connect(s).connect(e.destination),t.start(),d.source={t:"buffer",node:t}}}else"none"!==d.source.t&&(d.source.node.stop(),d.source={t:"none"})};d={t:"stranded",destroy(){o.free(),"stranded"===d.t&&"none"!==d.source.t&&d.source.node.stop()},source:{t:"none"}};const o=O().start();s.state.listenAndCall(t),o.stop()}}else if("title"!==d.t){n();const t=e.createOscillator(),s=e.createGain();t.type="sine",t.frequency.value=Wt("C",3),s.gain.value=.125,t.connect(s).connect(e.destination),t.start(),d={t:"title",destroy(){t.stop()},osc:t}}})),{mute:l,blip(){if(l.get())return;const t=a(.0615811229196333),s=a(.27152915874311134),n=e.createOscillator();n.type="sawtooth",n.frequency.value=2011,n.connect(o(s,.125,0,t)).connect(e.destination),n.start(e.currentTime),n.stop(e.currentTime+t+s)},button(){if(l.get())return;const t=a(.10698604535153988),s=a(.079),n=e.createOscillator();n.type="sawtooth",n.frequency.value=270,n.connect(o(s,.125,0,t)).connect(e.destination),n.start(e.currentTime),n.stop(e.currentTime+t+s)},explosion(t){if(l.get())return;const s=a(.20067061483860016),n=a(.21661974489688873),r=e.createBufferSource();r.buffer=p,r.connect(o(n,.125+.375*t,.754,s)).connect(e.destination),r.start()},hum(e){"prologue"===d.t?d.source.playbackRate.value=e:"title"===d.t&&(d.osc.frequency.value=e*Zt)},land(){if(l.get())return;const t=a(.20067061483860016),s=a(.21661974489688873),n=e.createBufferSource();n.buffer=g,n.connect(o(s,.125,.25,t)).connect(e.destination),n.start()}}})(new AudioContext,l,r),b=wt(e,(e=>P(G(e,2)))),E=((e,t)=>{const s=O().start();let o=t(e.get());const n=V(o.get());return o.listen(n.set),s.stop(),e.listen((e=>{s.free().start(),o=t(e).listenAndCall(n.set),s.stop()})),n})(l,(e=>{if("help"===e.t)return j(rt(void 0,[],Ye()));if("game"===e.t)return wt(bt(e.seeds,e.index),(([e,t])=>{const s=e[t];Ke(s);const o=ze(-Math.PI,Math.PI),n=Je(100,1200),a=He(H(B(o),n)),l=Math.floor(n/250),r=[];for(;r.length<l;){const e=H(B(ze(o-Math.PI/8,o+Math.PI/8)),Je(125,n)),t=Je(25,100);R(T(e,a.pos))>=t+a.r+24&&r.every((s=>R(T(e,s.pos))>=t+s.r+24))&&r.push(it(e,t))}return rt(a,r,s)}));if("postGame"===e.t){const e=rt(void 0,[],Ye());return e.ship.pos=Y,j(e)}if("prologue"===e.t)return j(rt(He(K),[],Ye()));if("lostInSpace"===e.t||"stranded"===e.t)return j(e.level);{const e=rt(void 0,[],Ye());return e.ship.vel=H(B(ze(0,2*Math.PI)),25),j(e)}}));return ve(s(ye(Mt(e,(e=>le(e.x,e.y))),(s=>{const o=s.getContext("2d");if(!o)return;const r=e=>{const t=k(G(d,2),b.get()),s=D(A(H(q(t),12),b.get())),o=k(A(s,e.pos),b.get());e.vel=T(e.vel,t),e.grounded=!1,i.explosion(Math.max(0,Math.min((R(e.vel)-50)/150,1)));const n=Math.min(R(t),200),a=E.get().explosions.length-12,l=12+Math.min(Math.floor(a*n/200),a);for(let e=0;e<l;++e){const t=E.get().explosions[e];t.life=ze(.5,1),t.pos=o,t.vel=H(B(ze(0,2*Math.PI)),ze(2,10))}},c=(e,t,s)=>{const{blackHole:o,explosions:n,planets:r,ship:c}=t;if(!c.grounded){const n=w(0,0);if(r.forEach((e=>{const t=T(e.pos,c.pos),s=R(t);A(n,H(t,150*e.r*e.r/(s*s*s)))})),null!=o){const t=T(o.pos,c.pos),l=R(t);A(n,H(t,24e4/(l*l*l)));const r=Math.max(.1,Math.min((l-De)/40,1));if(p(c,n,r*e),i.hum(r),R(T(c.pos,o.pos))<28)return void("prologue"===s.t?(s.leaveSec.set(4),s.messages.set(as.map((e=>e.text)))):"game"===s.t&&(s.state.set({t:"postHole",sec:2}),s.index.get()+1>=s.seeds.get().length?a.set(null):a.set(((e,t,s,o)=>({bombs:e,complete:t,seed:o,timeSec:s}))(s.bombs.get(),s.index.get()+1,s.timeSec.get(),s.seed))))}else p(c,n,e);"game"===s.t&&s.bombs.get()<=0&&!c.grounded&&R(n)<1&&l.set((e=>({t:"lostInSpace",level:e,messages:V([]),state:V({t:"initial",sec:2})}))(t)),r.forEach((e=>{const o=T(c.pos,e.pos);if(R(o)<e.r+8){const n=I(o);c.pos=A(H(B(n),e.r+8),e.pos),c.vel=S,c.ang=n+Math.PI/2,c.grounded=!0,"game"===s.t&&s.bombs.get()<=0&&l.set(((e,t,s)=>({t:"stranded",angle:s,level:e,planet:t,messages:V([]),state:V({t:"initial",sec:2})}))(t,e,n)),i.land()}}))}n.forEach((t=>{t.life>0&&(t.life-=e,t.life<.75&&(t.pos=A(F(t.vel,e),t.pos)))}))},p=(e,t,s)=>{e.acc=t,e.vel=$(e.vel,F(e.acc,s)),e.pos=$(e.pos,F(e.vel,s)),e.ang=I(e.vel)+Math.PI/2},g=e=>{const t=l.get();if("help"===t.t)!d.down&&h&&r(E.get().ship),c(e,E.get(),t);else if("lostInSpace"===t.t){c(e,E.get(),t);const s=t.state.get();if("initial"===s.t)s.sec-=e,s.sec<=0&&t.state.set({t:"talking",sec:2});else if("talking"===s.t&&(s.sec-=e,s.sec<=0)){const e=ns[t.messages.get().length];null==e?t.state.set({t:"end"}):(s.sec+=e.sec,t.messages.set(t.messages.get().concat(e.text)))}}else if("game"===t.t){const a=t.state.get();if("idle"===a.t){t.timeSec.set(t.timeSec.get()+e);const{ship:s}=E.get(),{bombTime:o,bombs:n,speed:a}=t;o.get()>0&&n.get()>0&&o.set(Math.max(0,o.get()-e*a.get()*(s.grounded?2:1))),!d.down&&h&&n.get()>0&&o.get()<=0&&(n.set(n.get()-1),o.set(5),r(s));for(let s=t.speed.get();s-- >0;)c(e,E.get(),t)}else"postHole"===a.t?(a.sec-=e*t.speed.get(),a.sec<=0&&(t.index.get()+1>=t.seeds.get().length?(n.set(!0),l.set((s=72-t.bombs.get(),o=t.timeSec.get(),{t:"postGame",bombsUsed:s,messages:V([]),state:V({t:"initial",sec:2}),timeSec:o}))):(t.index.set(t.index.get()+1),t.state.set(ts(2)),i.hum(0)))):"preHole"===a.t&&(a.sec-=e*t.speed.get(),a.sec<=0&&(t.state.set({t:"idle"}),i.blip()))}else if("postGame"===t.t){const s=t.state.get();if("initial"===s.t)s.sec-=e,s.sec<=0&&(t.state.set({t:"falling"}),i.blip());else if("falling"===s.t){const{ship:s}=E.get();if(p(s,X,e),s.pos.y<=-8)return;s.ang=Math.PI,s.pos=w(s.pos.x,-8),t.state.set({t:"waiting",sec:2}),i.land()}else if("waiting"===s.t){if(s.sec-=e,s.sec<=0){const e=gt(0,w(0,0),t.bombsUsed<60&&t.timeSec<360);E.get().spaceman=e,t.state.set({t:"walking",spaceman:e})}}else if("walking"===s.t){const e=$(s.spaceman.pos,w(.5,0));e.x<72?s.spaceman.pos=e:(s.spaceman.pos=w(72,0),t.state.set({t:"talking",sec:1}))}else if("talking"===s.t&&(s.sec-=e,s.sec<=0)){const e=os[t.messages.get().length];null==e?t.state.set({t:"end"}):(s.sec+=e.sec,t.messages.set(t.messages.get().concat(e.text)))}}else if("prologue"===t.t){if(t.sec>0&&(t.sec-=e,t.sec<=0)){const e=as[t.messages.get().length];null!=e?(t.sec+=e.sec,t.messages.set(t.messages.get().concat(e.text))):t.sec=0}const s=t.leaveSec.get();if(null!=s){const o=s-e;o>0?t.leaveSec.set(o):(l.set(_t(void 0,Q)),i.hum(0))}else c(e,E.get(),t)}else if("stranded"===t.t){c(e,E.get(),t);const s=t.state.get();if("initial"===s.t){if(s.sec-=e,s.sec<=0){const e=gt(t.angle+Math.PI/2,A(H(B(t.angle),t.planet.r),t.planet.pos));E.get().spaceman=e,t.state.set({t:"walking",spaceman:e,steps:20})}}else if("walking"===s.t){const{spaceman:e}=s;e.ang+=4/(2*Math.PI*t.planet.r),e.pos=A(H(B(e.ang-Math.PI/2),t.planet.r),t.planet.pos),--s.steps<=0&&t.state.set({t:"talking",sec:2})}else if("talking"===s.t&&(s.sec-=e,s.sec<=0)){const e=ls[t.messages.get().length];null==e?t.state.set({t:"end"}):(s.sec+=e.sec,t.messages.set(t.messages.get().concat(e.text)))}}else if("title"===t.t){const s=t.leaveSec.get();if(null!=s){const o=s-e;if(o>0)t.leaveSec.set(o),c(e,E.get(),t);else if(null!=t.savedGame){const{seed:e}=t.savedGame;null!=e?l.set(_t(e,V(pt(e)),t.savedGame.bombs,t.savedGame.complete)):l.set(_t(void 0,Q,t.savedGame.bombs,t.savedGame.complete)),i.hum(0)}else l.set({t:"prologue",sec:2,messages:V([]),leaveSec:V(void 0)})}else c(e,E.get(),t)}var s,o},d=(e=>{const s=e=>{l.down=!0,o(e)},o=t=>{const s=e.getBoundingClientRect();var o,n;o=l,n=w(Math.round(t.clientX-s.left),Math.round(t.clientY-s.top)),o.x=n.x,o.y=n.y},n=()=>{l.down=!1},a=e=>(t,s)=>(s.preventDefault(),e(s.changedTouches[0])),l={down:!1,x:0,y:0};return t(e,[ce(((e,t)=>s(t))),fe(a(s)),pe(((e,t)=>o(t))),ue(a(o)),ge(n),he(a(n))]),l})(s);let h=d.down;const u=(e=>{const t=()=>{document.hidden||n?a&&(cancelAnimationFrame(a),a=0):a=requestAnimationFrame(s)},s=()=>{e(),o||(a=requestAnimationFrame(s))};let o=!1,n=!0,a=0;const l={destroy(){o=!0,cancelAnimationFrame(a),document.removeEventListener("visibilitychange",t,!1)},paused:()=>n,start:()=>(n=!1,document.hidden||(a=requestAnimationFrame(s)),l),stop:()=>(n=!0,a&&(cancelAnimationFrame(a),a=0),l)};return document.addEventListener("visibilitychange",t,!1),l})((()=>{g(1/60),h=d.down,(()=>{const{blackHole:t,explosions:n,planets:a,ship:r,spaceman:i,stars:c}=E.get(),p=l.get();o.clearRect(0,0,s.width,s.height),o.save(),o.translate(-r.pos.x+b.get().x,-r.pos.y+b.get().y),((e,t,s)=>{const o={x:e.x,y:e.y};for(;o.y<=t.y;++o.y)for(o.x=e.x;o.x<=t.x;++o.x)s(o)})(P(C(T(r.pos,b.get()),lt)),P(C($(r.pos,b.get()),lt)),(e=>{const t=F(e,lt),s=c[(e.y%5+5)%5][(e.x%5+5)%5];o.fillStyle="#fff",s.stars.forEach((e=>{const s=$(t,e.pos);o.fillRect(s.x,s.y,e.r,e.r)}))}));const g=((e,t)=>{const s=[];for(let o=0;o<e.length;++o){const n=t(e[o]);null!=n&&s.push(n)}return s})(null!=t?a.concat(t):a,(e=>{const t=T(e.pos,r.pos),s=R(t),n=I(t),a=R(H(t,150*e.r*e.r/(s*s*s))),l=je[Math.max(0,Math.min(Math.floor(2*Math.sqrt(a)),je.length-1))];let i;if(e.pos.x-e.r>r.pos.x+b.get().x){const t=r.pos.x+b.get().x-22;i={pos:w(t,r.pos.y+(e.pos.y-r.pos.y)*(t-r.pos.x)/(e.pos.x-r.pos.x)),angle:n,icon:l}}if(e.pos.x+e.r<r.pos.x-b.get().x){const t=r.pos.x-b.get().x+22;i={pos:w(t,r.pos.y+(e.pos.y-r.pos.y)*(t-r.pos.x)/(e.pos.x-r.pos.x)),angle:n,icon:l}}if(e.pos.y-e.r>r.pos.y+b.get().y){const t=r.pos.y+b.get().y-22-32,s=w(r.pos.x+(e.pos.x-r.pos.x)*(t-r.pos.y)/(e.pos.y-r.pos.y),t);(null==i||R(T(s,r.pos))<R(T(i.pos,r.pos)))&&(i={pos:s,angle:n,icon:l})}if(e.pos.y+e.r<r.pos.y-b.get().y){const t=r.pos.y-b.get().y+22,s=w(r.pos.x+(e.pos.x-r.pos.x)*(t-r.pos.y)/(e.pos.y-r.pos.y),t);(null==i||R(T(s,r.pos))<R(T(i.pos,r.pos)))&&(i={pos:s,angle:n,icon:l})}if(null!=i)return i;o.drawImage(e.img,e.pos.x-e.r,e.pos.y-e.r)}));if("postGame"===p.t&&"initial"!==p.state.get().t&&(o.fillStyle=`hsla(240, 70%, 70%, ${Math.max(0,2*(Y.y/2-r.pos.y)/Y.y)})`,o.fillRect(r.pos.x-b.get().x,r.pos.y-b.get().y,e.get().x,e.get().y),o.drawImage(ct,r.pos.x+80,-ct.height),o.fillStyle="#fff",o.fillRect(r.pos.x-b.get().x,-1,e.get().x,1),o.fillStyle="hsl(120, 80%, 40%)",o.fillRect(r.pos.x-b.get().x,0,e.get().x,e.get().y-b.get().y)),("game"===p.t&&"preHole"!==p.state.get().t||"postGame"===p.t&&"initial"!==p.state.get().t||"help"===p.t||"lostInSpace"===p.t||"prologue"===p.t||"stranded"===p.t)&&(o.save(),o.translate(r.pos.x,r.pos.y),o.rotate(r.grounded?r.ang:Math.round(8*r.ang/Math.PI)*Math.PI/8),o.drawImage(nt,-8,-8),o.restore()),null!=i&&(o.save(),o.translate(i.pos.x,i.pos.y),o.rotate(i.ang),o.drawImage(i.img,-3,-10),o.restore()),n.forEach((e=>{e.life>0&&o.drawImage(e.img,e.pos.x-1,e.pos.y-1)})),o.restore(),"game"===p.t&&"preHole"!==p.state.get().t){if(o.fillStyle="#f00",o.fillRect(cs,e.get().y-(is+cs),Math.floor((5-p.bombTime.get())/5*(e.get().x-2*cs)),is),"postHole"!==p.state.get().t&&d.down&&p.bombs.get()>0&&p.bombTime.get()<=0){const e=k(G(d,2),b.get()),t=D(A(H(q(e),12),b.get())),s=R(e),n=Le[Math.max(0,Math.min(Math.floor(s/50),Le.length-1))];o.drawImage(n,t.x-n.width/2,t.y-n.height/2)}g.forEach((e=>{o.save();const t=D(A(T(e.pos,r.pos),b.get()));o.translate(t.x,t.y),o.drawImage(e.icon.img,-e.icon.r,-e.icon.r),o.rotate(e.angle),o.drawImage(Ve,12,-e.icon.img.height/2),o.restore()}))}else if("help"===p.t&&d.down){const e=k(G(d,2),b.get()),t=D(A(H(q(e),12),b.get())),s=R(e),n=Le[Math.max(0,Math.min(Math.floor(s/50),Le.length-1))];o.drawImage(n,t.x-n.width/2,t.y-n.height/2)}})()})).start();L(u.destroy)})),yt(l,(e=>"game"===e.t?ve(Mt(e.state,(e=>Lt("preHole"!==e.t))),u,v,y,s(void 0,void 0,void 0,ve(p,It(`${is+cs}px`),Rt(`${cs}px`),s(Se(Gt("1.5em"),Mt(e.bombs,c))," Bombs Left")),vt(wt(e.bombTime,(e=>e<=0)),(()=>ve(p,It(`${is+cs}px`),$t(`${cs}px`),s("Ready")))))):"help"===e.t||"lostInSpace"===e.t||"postGame"===e.t||"stranded"===e.t?ve(y,v,s(vt(e.state,(t=>"end"===t.t?ve(kt("8px"),s(Me(s("help"===e.t?"How to Play":"lostInSpace"===e.t?"Lost in Space.":"stranded"===e.t?"Stranded.":"The End.")),"postGame"===e.t?we(m,s(`Bombs Used: ${e.bombsUsed}\nTime Taken: ${gs(e.timeSec)}`)):null,ve(m,s(o(s("Menu"),x,ie((()=>{l.set(es())}))))))):void 0)),we(p,It(0),kt("8px"),Ht("pre-wrap"),Mt(e.messages,(e=>c(e.join("\n"))))))):"prologue"===e.t?ve(v,s(ve(kt("8px"),At("right"),s(o(s("Skip"),ie((()=>{l.set(_t(void 0,Q)),i.hum(0)}))))),we(p,It(0),kt("8px"),Mt(e.messages,(e=>c(e.join("\n"))))))):"seed"===e.t?ve(d,h,v,Ct("8px"),s(Me(s("Enter a Seed")),((e,...t)=>Ge(oe(e),...t))("number",Mt(e.seed,ne),re((t=>{const s=parseInt(t.value,10);isNaN(s)?t.value=""+e.seed.get():e.seed.set(s)}))),ve(s(o(s("Random Seed"),ie((()=>{e.seed.set(Ye())}))),o(s("Play"),f,ie((()=>{l.set(_t(e.seed.get(),V(pt(e.seed.get())))),i.hum(0)}))))),o(s("Exit"),ie((()=>{l.set(es())}))))):"title"===e.t?ve(d,h,v,M,s(ve(u,s(ps)),vt(n,(()=>Me(u,m,s("(GOLF)")))),ve(u,g,h,Ct("8px"),Mt(n,(e=>Et(e?"8px":"40px"))),qt("128px"),s(o(s("New Game"),ie((()=>{e.leaveSec.set(2)}))),o(s("Continue"),Mt(a,(e=>_(!e))),ie((()=>{e.leaveSec.set(2),e.savedGame=a.get()}))),vt(n,(()=>o(s("Pick a Seed"),ie((()=>{l.set(((e=Ye())=>({t:"seed",seed:V(e)}))())}))))),xe(Mt(i.mute,(e=>c(e?"Sound is OFF":"Sound is ON"))),ie((()=>{i.mute.set(!i.mute.get()),i.button()}))),o(s("Help"),ie((()=>{l.set({t:"help",messages:j(["Click/Touch to use a bomb to launch your ship.","\nThe further you click from the ship, the stronger the blast."]),state:j({t:"end"})})}))))),yt(e.leaveSec,(e=>null!=e?ve(v,St("#111"),Tt(Math.min((2-e)/1,1))):null)))):void 0))))},is=8,cs=8,ps=ot("art/logo.png",le(216,48)),gs=e=>{const t=e%60;return`${Math.floor(e/60)}:${t<10?"0":""}${t.toFixed(3)}`};window.onload=()=>{Promise.all(st.map((e=>new Promise(((t,s)=>{e.complete&&t(),e.onload=()=>t(),e.onerror=()=>s(e)}))))).then((()=>{const t=(()=>{const e=V(w(window.innerWidth,window.innerHeight));return de((()=>{e.set(w(window.innerWidth,window.innerHeight))}))(window),e})(),o=V(2),n=wt(bt(t,o),(([e,t])=>P(G(e,t))));xt((()=>{r(document.querySelector("h1"),ve(b,Mt(n,(t=>((t,s=t)=>e(Pt(s),qt(t)))(t.x+"px",t.y+"px"))),Mt(o,(e=>Dt(`scale(${e})`))),s(rs(n))))}))}),(e=>{console.error("Failed to load images:",e)}))}}();
