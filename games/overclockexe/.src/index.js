"use strict";function _classCallCheck(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}function getDirection(i,t){var e=Math.atan2(t,i);return e}function getDistance(i,t){return Math.sqrt(i*i+t*t)||0}function getVector(i,t){var e=t.x-i.x,s=t.y-i.y;return{direction:getDirection(e,s),distance:getDistance(e,s)}}function Loop(i){!function t(e){i(Math.min(window.performance.now()-e,1e3)),window.requestAnimationFrame(t.bind(this,window.performance.now()))}(window.performance.now())}var _createClass=function(){function i(i,t){for(var e=0;e<t.length;e++){var s=t[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}return function(t,e,s){return e&&i(t.prototype,e),s&&i(t,s),t}}(),EXE=function(){function i(t){_classCallCheck(this,i),this.position={x:.5*WIDTH,y:HEIGHT*-.25},this.anchor={x:.5,y:.5},this.width=20,this.height=20,this.game=t.game}return _createClass(i,[{key:"update",value:function(i){var t=this;this.position.y+=.5*i.glitchtime.inFrames,this.position.y>.5*HEIGHT&&(this.position.y=.5*HEIGHT),this.game.player.position.x<=this.position.x+this.width*this.anchor.x&&this.game.player.position.x>=this.position.x-this.width*this.anchor.x&&this.game.player.position.y<=this.position.y+this.height*this.anchor.y&&this.game.player.position.y>=this.position.y-this.height*this.anchor.y&&(delete this.game.exe,hasOverclocked=!0,window.localStorage.hasOverclocked=!0,this.game.string="OVERCLOCKED",window.setTimeout(function(){delete t.game.string},1e3))}},{key:"color",get:function(){return Math.random()<.5?ORANGE:WHITE}}]),i}(),Explosion=function(){function i(t){if(_classCallCheck(this,i),this.position=t.position||{x:0,y:0},this.size=t.size||10,this.maxsize=this.size,this.color="#FFF",this.speed=.2,this.key=KEY++,t.game&&(this.game=t.game,this.game.explosions[this.key]=this),1!=t.doNotPropagate)for(var e=0;e<(t.billows||3);e+=1)new i({game:this.game,size:this.size,doNotPropagate:!0,position:{x:this.position.x+Math.random()*this.size-.5*this.size,y:this.position.y+Math.random()*this.size-.5*this.size}})}return _createClass(i,[{key:"update",value:function(i){this.size-=this.speed*i.glitchtime.inFrames,this.color="rgba(255, 255, 255, "+this.size/this.maxsize+")",this.size<=0&&this.remove()}},{key:"remove",value:function(){delete this.game.explosions[this.key]}}]),i}(),AMOUNT_OF_STARS=50,AMOUNT_OF_THUGS=5,hasOverclocked="true"==window.localStorage.hasOverclocked||!1,timesDied=0,TIMES_TO_DIE=3,Game=function(){function i(){_classCallCheck(this,i),this.thugs={},this.projectiles={},this.explosions={},this.player=new Player({game:this}),this.stars=new Array;for(var t=0;t<AMOUNT_OF_STARS;t+=1)this.stars.push(new Star);this.time=0,this.key=0}return _createClass(i,[{key:"update",value:function(i){if(i={realtime:{inMilliseconds:i,inSeconds:i/1e3,inFrames:i/(1e3/60)},glitchtime:{}},this.time+=i.realtime.inSeconds,1==hasOverclocked&&void 0!=this.player){var t=2.5,e=0,s=Math.sin(t*this.time+e);s=Math.sin(Math.PI/2*s),s=(s+1)/2,i.glitchtime.inFrames=s*i.realtime.inFrames,i.glitchtime.inSeconds=s*i.realtime.inSeconds,i.glitchtime.inMilliseconds=s*i.realtime.inMilliseconds,i.glitchtime.inNormals=s}else i.glitchtime=i.realtime,i.glitchtime.inNormals=1;void 0==this.player&&0==Object.keys(this.explosions).length&&0==Object.keys(this.projectiles).length&&0==Object.keys(this.thugs).length&&(this.time=0,this.player=new Player({game:this}));for(var o in this.stars)this.stars[o].update(i);for(var o in this.explosions)this.explosions[o].update(i);void 0!=this.player&&this.player.update(i);for(var o in this.projectiles)this.projectiles[o].update(i);for(var o in this.thugs)this.thugs[o].update(i);if(void 0!=this.exe&&this.exe.update(i),void 0!=this.player)if(0==hasOverclocked&&timesDied>=TIMES_TO_DIE)void 0==this.exe&&(this.exe=new EXE({game:this}));else if(Object.keys(this.thugs).length<AMOUNT_OF_THUGS*(hasOverclocked?1.5:2)){new Thug({game:this,position:{x:Math.random()*WIDTH*.8+.1*WIDTH,y:Math.random()*HEIGHT*-.5}})}render.canvas.context.fillStyle="rgba(42, 43, 42, "+i.glitchtime.inNormals+")",render.canvas.context.fillRect(0,0,WIDTH,HEIGHT),(void 0==this.player||i.glitchtime.inNormals>.9)&&render.clear();for(var o in this.stars)render.render(this.stars[o]);for(var o in this.thugs)render.render(this.thugs[o]);for(var o in this.projectiles)render.render(this.projectiles[o]);void 0!=this.exe&&render.render(this.exe),void 0!=this.player&&(render.render(this.player),render.renderText(this.player.killcount+" out of 20",{x:4,y:HEIGHT-10}));for(var o in this.explosions)render.renderCircle(this.explosions[o]);void 0!=this.string&&render.renderText(this.string,{x:10,y:HEIGHT/2})}}]),i}(),MINIMUM_VELOCITY=.001,MAXIMUM_VELOCITY=1,Player=function(){function i(t){_classCallCheck(this,i),this.width=12,this.height=16,this.color="#FFF",this.position={x:.5*WIDTH,y:.75*HEIGHT},this.anchor={x:.5,y:.5},this.acceleration=.5,this.deceleration=1.3,this.velocity={x:0,y:0},this.game=t.game,this.counter=0,this.weapon={rate:.2,speed:4,angle:Math.PI/-2},this.killcount=20}return _createClass(i,[{key:"update",value:function(i){if((Input.isDown("W")||Input.isDown("UP"))&&(this.velocity.y-=this.acceleration*i.realtime.inFrames),(Input.isDown("S")||Input.isDown("DOWN"))&&(this.velocity.y+=this.acceleration*i.realtime.inFrames),(Input.isDown("A")||Input.isDown("LEFT"))&&(this.velocity.x-=this.acceleration*i.realtime.inFrames),(Input.isDown("D")||Input.isDown("RIGHT"))&&(this.velocity.x+=this.acceleration*i.realtime.inFrames),this.counter+=i.realtime.inSeconds,this.counter>=this.weapon.rate){this.counter-=this.weapon.rate;new Projectile({speed:this.weapon.speed,angle:this.weapon.angle,game:this.game,position:{x:this.position.x,y:this.position.y}})}this.velocity.x<-1*MAXIMUM_VELOCITY&&(this.velocity.x=-1*MAXIMUM_VELOCITY),this.velocity.x>1*MAXIMUM_VELOCITY&&(this.velocity.x=1*MAXIMUM_VELOCITY),this.velocity.y<-1*MAXIMUM_VELOCITY&&(this.velocity.y=-1*MAXIMUM_VELOCITY),this.velocity.y>1*MAXIMUM_VELOCITY&&(this.velocity.y=1*MAXIMUM_VELOCITY),(this.position.x+this.velocity.x<0||this.position.x+this.velocity.x>WIDTH)&&(this.velocity.x=0),(this.position.y+this.velocity.y<0||this.position.y+this.velocity.y>HEIGHT)&&(this.velocity.y=0),this.position.x+=this.velocity.x*i.realtime.inFrames,this.position.y+=this.velocity.y*i.realtime.inFrames,this.velocity.x*=1/this.deceleration,this.velocity.y*=1/this.deceleration,Math.abs(this.velocity.x)<MINIMUM_VELOCITY&&(this.velocity.x=0),Math.abs(this.velocity.y)<MINIMUM_VELOCITY&&(this.velocity.y=0)}},{key:"beDamaged",value:function(){this.remove(),timesDied+=1;new Explosion({game:this.game,billows:10,position:{x:this.position.x,y:this.position.y},size:50+10*Math.random()})}},{key:"remove",value:function(){this.game&&this.game.player&&delete this.game.player}},{key:"countkill",value:function(){this.killcount-=1,this.killcount<=0&&(this.game.string=" YOU WIN!!")}}]),i}(),ORANGE="#EF8A17",GREEN="#008148",YELLOW="#C6C013",RED="#EF2917",WHITE="#FFF",Projectile=function(){function i(t){_classCallCheck(this,i),this.affiliation=t.affiliation||"GOOD",this.width=9,this.height=6,this.color="GOOD"==this.affiliation?ORANGE:RED,this.anchor={x:.5,y:.5},this.collision={radius:"GOOD"==this.affiliation?6:1},this.position=t.position||{x:0,y:0},this.rotation=t.angle||0,this.speed=t.speed||1,this.angle=t.angle||0,this.key=KEY++,t.game&&(this.game=t.game,this.game.projectiles[this.key]=this)}return _createClass(i,[{key:"update",value:function(i){if(this.position.x+=Math.cos(this.angle)*this.speed*i.glitchtime.inFrames,this.position.y+=Math.sin(this.angle)*this.speed*i.glitchtime.inFrames,this.rotation+=Math.PI/32*this.speed*i.glitchtime.inFrames,(this.position.x<-1*this.width||this.position.y<-1*this.height||this.position.x>WIDTH+this.width||this.position.y>HEIGHT+this.height)&&this.remove(),"GOOD"==this.affiliation)for(var t in this.game.thugs){var e=this.game.thugs[t];if(this.position.x<=e.position.x+e.width*e.anchor.x+this.collision.radius&&this.position.x>=e.position.x-e.width*e.anchor.x-this.collision.radius&&this.position.y<=e.position.y+e.height*e.anchor.y+this.collision.radius&&this.position.y>=e.position.y-e.height*e.anchor.y-this.collision.radius){e.beDamaged(),this.remove();break}}else"BAD"==this.affiliation&&void 0!=this.game.player&&this.position.x<=this.game.player.position.x+this.game.player.width*this.game.player.anchor.x+this.collision.radius&&this.position.x>=this.game.player.position.x-this.game.player.width*this.game.player.anchor.x-this.collision.radius&&this.position.y<=this.game.player.position.y+this.game.player.height*this.game.player.anchor.y+this.collision.radius&&this.position.y>=this.game.player.position.y-this.game.player.height*this.game.player.anchor.y-this.collision.radius&&(this.game.player.beDamaged(),this.remove())}},{key:"remove",value:function(){delete this.game.projectiles[this.key]}}]),i}(),Star=function(){function i(){_classCallCheck(this,i),this.position={x:Math.random()*WIDTH,y:Math.random()*HEIGHT},this.parallax=3*Math.random(),this.speed=.5,this.width=Math.round(this.parallax),this.height=Math.round(this.parallax),this.anchor={x:.5,y:.5},this.color=Math.random()<.5?RED:WHITE}return _createClass(i,[{key:"update",value:function(i){this.position.y+=this.parallax*this.speed*i.glitchtime.inFrames,this.position.y>HEIGHT+this.height&&(this.position.y-=HEIGHT+this.height,this.position.y*=-1,this.position.x=Math.random()*WIDTH)}}]),i}(),Thug=function(){function i(t){_classCallCheck(this,i),this.width=16,this.height=12,this.color="#888",this.position=t.position||{x:0,y:0},this.anchor={x:.5,y:.5},this.speed=.8,this.rotation=0,this.key=KEY++,t.game&&(this.game=t.game,this.game.thugs[this.key]=this),this.hull=t.hull||5,this.weapon={rate:4,speed:1.2,angle:Math.PI/2},this.counter=Math.random()*this.weapon.rate}return _createClass(i,[{key:"update",value:function(i){if(void 0==this.game.player&&(this.speed=2),this.position.y+=this.speed*i.glitchtime.inFrames,this.position.y>HEIGHT+this.height&&this.remove(),this.isOnScreen&&void 0!=this.game.player&&this.game.player.killcount>0){if(this.counter+=i.glitchtime.inSeconds,this.counter>=this.weapon.rate){this.counter-=this.weapon.rate;for(var t=0;t<2*Math.PI;t+=Math.PI/8){new Projectile({affiliation:"BAD",angle:t,speed:this.weapon.speed,game:this.game,position:{x:this.position.x,y:this.position.y}})}}this.game.player.position.x<=this.position.x+this.width*this.anchor.x&&this.game.player.position.x>=this.position.x-this.width*this.anchor.x&&this.game.player.position.y<=this.position.y+this.height*this.anchor.y&&this.game.player.position.y>=this.position.y-this.height*this.anchor.y&&this.game.player.beDamaged()}}},{key:"beDamaged",value:function(i){if(this.hull-=i||1,this.hull<=0){this.remove();new Explosion({game:this.game,position:{x:this.position.x,y:this.position.y},size:10+10*Math.random()});this.game.player&&this.game.player.countkill()}}},{key:"remove",value:function(){delete this.game.thugs[this.key]}},{key:"isOnScreen",get:function(){return this.position.y>0}}]),i}(),Input={state:{},keycodes:{W:87,S:83,A:65,D:68,UP:38,DOWN:40,LEFT:37,RIGHT:39},isDown:function(i){return i=this.keycodes[i]||i,!!this.state[i]}};document.addEventListener("keydown",function(i){Input.state[i.keyCode]=window.performance.now()}),document.addEventListener("keyup",function(i){delete Input.state[i.keyCode]});var Render=function(){function i(t){_classCallCheck(this,i),this.canvas=document.createElement("canvas"),this.canvas.context=this.canvas.getContext("2d"),this.canvas.width=t.width||640,this.canvas.height=t.height||360,document.getElementById("frame").appendChild(this.canvas)}return _createClass(i,[{key:"clear",value:function(){this.canvas.context.clearRect(0,0,this.canvas.width,this.canvas.height)}},{key:"render",value:function(i){this.canvas.context.save(),this.canvas.context.translate(Math.floor(i.position.x),Math.floor(i.position.y)),this.canvas.context.rotate(i.rotation||0),this.canvas.context.fillStyle=i.color||"hotpink",this.canvas.context.fillRect(i.width*i.anchor.x*-1,i.height*i.anchor.y*-1,i.width,i.height),this.canvas.context.restore()}},{key:"renderCircle",value:function(i){this.canvas.context.fillStyle=i.color||"#FFF",this.canvas.context.beginPath(),this.canvas.context.arc(i.position.x,i.position.y,i.size,0,2*Math.PI,!1),this.canvas.context.fill()}},{key:"renderText",value:function(i,t){this.canvas.context.fillStyle="#FFF",this.canvas.context.font="24px monospace",this.canvas.context.fillText(i,t.x,t.y)}}]),i}(),KEY=0,WIDTH=180,HEIGHT=320,game=new Game,render=new Render({width:WIDTH,height:HEIGHT}),loop=new Loop(function(i){game.update(i)});