!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);class s{constructor(t,e){if(this.index=t,CHARACTER_DATA[t]||(this.index="player"),this.img=JSON.parse(JSON.stringify(CHARACTER_DATA[this.index][e])),this.posY=1,this.posX=1,this.prePosY=null,this.prePosX=null,this.hit=!1,this.equipment=[],this.digAction=!1,this.attackAction=!1,this.newDirection=null,this.currentDirection=e,this.directionConst={top:{top:0,right:1,down:2,left:3},right:{top:3,right:0,down:1,left:2},down:{top:2,right:3,down:0,left:1},left:{top:1,right:2,down:3,left:0}},"top"!=e){const t=this.directionConst.top[e];if(t>0)for(let e=0;e<t;e++)this.turn()}}turn(){this.img=JSON.parse(JSON.stringify(CHARACTER_DATA[this.index][this.currentDirection]))}_getFrontPosition(){let t,e;switch(this.currentDirection){case"top":t=this.posY-HOLE_IMG.length,e=this.posX+1;break;case"right":t=this.posY+1,e=this.posX+CHARACTER_SIZE;break;case"down":t=this.posY+CHARACTER_SIZE,e=this.posX+1;break;case"left":t=this.posY+1,e=this.posX-HOLE_IMG.length}return[t,e]}dig(){let t=this._getFrontPosition();return{posY:t[0],posX:t[1],img:HOLE_IMG,put:!1,clear:!1,thing:null,count:50}}attack(){let t=this._getFrontPosition();return{posY:t[0],posX:t[1],img:HOLE_IMG,put:!1,clear:!1,thing:null,count:50}}}class n{constructor(t){this.height=250,this.width=400,getRandomInt(1,1)%2!=0?this.createMazeAsTorneko(this.width,this.height):this.createMaze(this.width,this.height),this.canvasEl=t,this.canvasEl.height=this.height*PIXEL_SIZE+MESSAGE_WINDOW_HEIGHT,this.canvasEl.width=this.width*PIXEL_SIZE,document.getElementById("wrapper").style.width=this.canvasEl.width,this.canvas=this.canvasEl.getContext("2d",{alpha:!1})}draw(){this.img.forEach((t,e)=>{t.forEach((t,i)=>{this.canvas.fillStyle=COLORS[t],this.canvas.fillRect(i*PIXEL_SIZE,e*PIXEL_SIZE,PIXEL_SIZE,PIXEL_SIZE)})})}setImageData(t,e,i){this.img[t]&&this.img[t][e]&&(this.img[t][e]=i)}addRect(t,e,i,s){let n={minX:t,minY:e,maxX:i,maxY:s,room:null};return this.rectList.push(n),n}addRoom(t,e,i,s){let n={minX:t,minY:e,maxX:i,maxY:s};return this.roomList.push(n),n}addPath(t,e,i){let s={direction:t,rect0:e,rect1:i};this.pathList.push(s)}splitRect(t){let e=MINIMUM_ROOM_SIZE+2*ROOM_MARGIN;if(t.maxY-t.minY<=e||t.maxX-t.minX<=e||t.minX+e>=t.maxX-e||t.minY+e>=t.maxY-e)return;let i=this.addRect(t.minX,t.minY,t.maxX,t.maxY);if(0===getRandomInt(0,2)){let s=getRandomInt(t.minX+e,t.maxX-e);s=t.minX+e,t.maxX=s,i.minX=s,this.addPath("vertical",t,i)}else{let s=getRandomInt(t.minY+e,t.maxY-e);s=t.minY+e,t.maxY=s,i.minY=s,this.addPath("horizontal",t,i)}this.splitRect(t),this.splitRect(i)}makeRoom(){this.rectList.map(t=>{let e=getRandomInt(MINIMUM_ROOM_SIZE,t.maxX-t.minX-2*ROOM_MARGIN+1),i=getRandomInt(MINIMUM_ROOM_SIZE,t.maxY-t.minY-2*ROOM_MARGIN+1),s=getRandomInt(t.minX+ROOM_MARGIN,t.maxX-ROOM_MARGIN-e+1),n=getRandomInt(t.minY+ROOM_MARGIN,t.maxY-ROOM_MARGIN-i+1);t.room=this.addRoom(s,n,s+e,n+i)})}line(t,e,i,s,n){let a=Math.min(t,i),h=Math.max(t,i),o=Math.min(e,s),r=Math.max(e,s);if(a!=h)for(let l=a;l<=h;l++){let a,h;t<=i&&e>=s?(a=l,h=r):t>i&&e>s||t>i&&e<=s?(a=l,h=o):t<=i&&e<s&&(a=l,h=r);for(let t=0;t<CHARACTER_SIZE+4-1;t++)n?this.setImageData(h+t,a,"0"):this.setImageData(h-t,a,"0");DEBUG&&this.setImageData(h,a,"6")}if(o!=r)for(let l=o;l<=r;l++){let o,r;t<=i&&e>=s||t>i&&e>s?(o=h,r=l):(t>i&&e<=s||t<=i&&e<s)&&(o=a,r=l);for(let t=0;t<CHARACTER_SIZE-1;t++)n?this.setImageData(r,o+t,"0"):this.setImageData(r,o-t,"0");DEBUG&&this.setImageData(r,o,"6")}}createMazeAsTorneko(t,e){this.rectList=[],this.roomList=[],this.pathList=[],this.splitRect(this.addRect(0,0,t,e)),this.makeRoom(),this.img=[];for(let i=0;i<e+1;i++){let e=[];for(let i=0;i<t+1;i++)e.push("A");this.img.push(e)}if(DEBUG)for(let t=0;t<this.rectList.length;t++){const e=this.rectList[t];for(let t=e.minX,i=e.minY;t<=e.maxX;t++)this.setImageData(i,t,"9");for(let t=e.minX,i=e.maxY;t<=e.maxX;t++)this.setImageData(i,t,"9");for(let t=e.minX,i=e.minY;i<=e.maxY;i++)this.setImageData(i,t,"9");for(let t=e.maxX,i=e.minY;i<=e.maxY;i++)this.setImageData(i,t,"9")}for(let t=0;t<this.roomList.length;t++){const e=this.roomList[t];for(let t=e.minX;t<=e.maxX;t++)for(let i=e.minY;i<=e.maxY;i++)this.setImageData(i,t,"0");if(DEBUG){for(let t=e.minX,i=e.minY;t<=e.maxX;t++)this.setImageData(i,t,"3");for(let t=e.minX,i=e.maxY;t<=e.maxX;t++)this.setImageData(i,t,"3");for(let t=e.minX,i=e.minY;i<=e.maxY;i++)this.setImageData(i,t,"3");for(let t=e.maxX,i=e.minY;i<=e.maxY;i++)this.setImageData(i,t,"3")}}for(let t=0;t<this.pathList.length;t++){const e=this.pathList[t];let i,s,n,a,h=!0;switch(e.direction){case"vertical":i=e.rect0.maxX,s=getRandomInt(e.rect0.room.minY+1,e.rect0.room.maxY),n=e.rect1.minX,a=getRandomInt(e.rect1.room.minY+1,e.rect1.room.maxY),s>a&&(h=!1),h?(s>e.rect0.room.maxY-CHARACTER_SIZE&&(s-=CHARACTER_SIZE),a>e.rect1.room.maxY-CHARACTER_SIZE&&(a-=CHARACTER_SIZE)):(s<e.rect0.room.minY+CHARACTER_SIZE&&(s+=CHARACTER_SIZE),a<e.rect1.room.minY+CHARACTER_SIZE&&(a+=CHARACTER_SIZE)),this.line(i,s,n,a,!0),this.line(e.rect0.room.maxX,s,i,s,h),this.line(e.rect1.room.minX,a,n,a,h);break;case"horizontal":i=getRandomInt(e.rect0.room.minX+1,e.rect0.room.maxX),s=e.rect0.maxY,n=getRandomInt(e.rect1.room.minX+1,e.rect1.room.maxX),a=e.rect1.minY,i>n&&(h=!1),h?(i>e.rect0.room.maxX-CHARACTER_SIZE-4&&(i-=CHARACTER_SIZE),n>e.rect1.room.maxX-CHARACTER_SIZE-4&&(n-=CHARACTER_SIZE)):(i<e.rect0.room.minX+CHARACTER_SIZE+4&&(i+=CHARACTER_SIZE),n<e.rect1.room.minX+CHARACTER_SIZE+4&&(n+=CHARACTER_SIZE)),this.line(i,s,n,a,!0),this.line(i,e.rect0.room.maxY,i,s,h),this.line(n,e.rect1.room.minY,n,a,h)}}}createMaze(t,e){0!=t%CHARACTER_SIZE&&(t+=CHARACTER_SIZE-t%CHARACTER_SIZE),0!=e%CHARACTER_SIZE&&(e+=CHARACTER_SIZE-e%CHARACTER_SIZE),this.img=[],this.img=[];for(let i=0;i<e+1;i++){let s=[];for(let n=0;n<t+1;n++)0===n||0===i||n===t||i===e?s.push("A"):s.push("0");this.img.push(s)}for(let i=CHARACTER_SIZE;i<t;i+=CHARACTER_SIZE)for(let t=CHARACTER_SIZE;t<e;t+=CHARACTER_SIZE){let e;this.setImageData(t,i,"A");let s=3;CHARACTER_SIZE===t&&(s=2),e=getRandomInt(0,s);let n=i,a=t;switch(e){case 0:n++;break;case 1:a++;break;case 2:n--;break;case 3:a--}this.setImageData(a,n,"A");for(let t=0;t<CHARACTER_SIZE-1;t++){switch(e){case 0:n++;break;case 1:a++;break;case 2:n--;break;case 3:a--}this.setImageData(a,n,"A")}}}}class a{constructor(t,e){this.mCanvas=t,this.prevTimestamp=0,this.initialize=!0,this.stage=new n(e),this.player=new s("player","top"),this.message=JSON.parse(JSON.stringify(messages.initial_message)),this.eventKeys={},this.attackCount=0,this.killCount=0,this.hitEnemyKey=!1,this.maxHitPoint=100,this.hitCount=0,this.swordHitPoint=0,this.title=!0,this.start()}start(){this.initialize&&(this.gameover=!1,this.gameclear=!1,this.notFoundCount=0,this.coinCount=0,this.floor=1,this.answer=null,this.player.equipment=[],this.message=JSON.parse(JSON.stringify(messages.initial_message)),this.maxHitPoint=100,this.hitPoint=this.maxHitPoint,this.killCount=0,this.setEventListener("normal",this),this.initialize=!1),this.hitEnemyKey=!1,this.zombieCount=0,this.stop&&(this.mCanvas.clearRect(0,0,this.stage.canvasEl.width,this.stage.canvasEl.height),this.stage.createMazeAsTorneko(this.stage.width,this.stage.height),this.mCanvas.beginPath()),this.stage.draw(),this.holeList={},this.thingList={},this.baseStage=JSON.parse(JSON.stringify(this.stage.img)),this.currentStage=JSON.parse(JSON.stringify(this.baseStage)),this.putCharacter(this.player),this.enemies={},this.enemyMove=5,this.stop=!1,this.putExit(),this.player.equipment.includes("shovel")||this.putShovel(),this.player.equipment=this.player.equipment.filter(t=>"key"!==t),this.player.newDirection=null;let t=document.getElementById("message");t.style.display="flex",t.style.width=this.stage.canvasEl.width,t.style.height=this.stage.canvasEl.height;let e=this;this.title?(t.innerHTML="",t.innerHTML+='<h1 style="margin:15px">Lost<br>Treasures</h1>',t.innerHTML+="One day... There was a treasures hunter.<br>",t.innerHTML+="He heard a rumor that there was some treasures in the cave.<br>",t.innerHTML+="So he went to the cave but... He was lost!<br>",t.innerHTML+="You need to navigate to the exit for him.<br>",t.innerHTML+="<br>",t.innerHTML+="ArrowKeys: move<br>",t.innerHTML+="SpaceKeys: dig *if you have a shovel<br>",t.innerHTML+="EnterKeys: attack *if you have a sword<br>",t.innerHTML+="<br>",t.innerHTML+="Press any key to start a new game.",t.classList.remove("fadeout"),this.title=!1,setTimeout((function(){e.setEventListener("continue",e)}),1e3)):this.gameover?(t.innerHTML="",this.title=!0,this.floor>404?(t.innerHTML+="It been days since i was looking for an exit.<br>",t.innerHTML+="I have reached the last floor 404. But i'm still not successful.<br>",t.innerHTML+="I starved to death in this cave, and now i turned in to a zombie.<br>"):this.zombieCount>=50?(t.innerHTML+="I couldn't move because of this zombies around me.<br>",t.innerHTML+="One of them has bitten me and turned me into one.<br>"):this.hitPoint<=0&&(t.innerHTML+="Zombies have attacked me. I can't see anything.<br>",t.innerHTML+="One of them has bitten me and turned me into one.<br>"),t.innerHTML+="Next time a treasure hunter gets lost in this cave.<br>",t.innerHTML+="I will prepare welcome party...<br>",t.innerHTML+="<br>",t.innerHTML+="Press any key to start a new game.",t.classList.remove("fadeout"),setTimeout((function(){e.setEventListener("continue",e)}),1e3)):this.gameclear?(this.title=!0,t.innerHTML="",t.innerHTML+="I finally found the exit. I think this cave is very dangerous...<br>",t.innerHTML+="But I was able to get a lot of money and I'm still alive!!<br>",t.innerHTML+="I think it's okay to come back for more.<br>",t.innerHTML+="<br>",t.innerHTML+="Press any key to start a new game.",t.classList.remove("fadeout"),setTimeout((function(){e.setEventListener("continue",e)}),1e3)):(t.classList.add("fadeout"),t.innerText="Stage "+this.floor,setTimeout((function(){t.style.display="none"}),5e3),window.requestAnimationFrame(e.playing.bind(e)))}playing(t){if(this.stop)return;this.currentStage=JSON.parse(JSON.stringify(this.baseStage));let e="normal";if(!0===this.player.attackAction&&this.player.equipment.includes("sword")?(2===this.attackCount?e="attack1":1===this.attackCount?e="attack2":(this.player.attackAction=!1,e="normal"),this.attackCount--):!0===this.player.digAction&&this.player.equipment.includes("shovel")?(e="dig",this.player.digAction=!1):this.player.hit&&(e="hit",this.checkHitWall(this.player)&&(this.player.newDirection=null,this.putCharacter(this.player)),this.player.hit=!1),this.moveCharacter({character:this.player,actionType:e}),this.player.hit)window.requestAnimationFrame(this.playing.bind(this));else{for(const[t,i]of Object.entries(this.enemies))if(void 0!==i)if(i.count>=0)i.count--;else if(this.hitEnemyKey!==t){if(this.holeList[i.holeKey]){if(this.zombieCount++,50===this.zombieCount)return this.gameover=!0,void this.start();this.holeList[i.holeKey].clear=!0}if("attack2"!==e){if(i.img.newDirection=null,0===this.enemyMove){let t=["top","down","left","right",null][getRandomInt(0,4)];t===i.img.newDirection&&(t=null),i.img.newDirection=t}"attack1"===e&&(i.img.newDirection=null),this.moveCharacter({character:i.img,actionType:"normal"})}}else i.clear=!0,this.hitEnemyKey=!1;if(0===this.enemyMove?this.enemyMove=5:this.enemyMove--,"dig"===e||"attack1"===e){let t;t="dig"===e?this.player.dig():this.player.attack();let i=!1;if("dig"===e&&(i=this.checkHitWall(t)),!i)for(let s=0;s<t.img.length;s++){for(let n=0;n<t.img[0].length;n++){if("dig"===e&&(this.checkHitThing(s,n,t)||this.checkHitExit(s,n,t))){i=!0;break}if("attack1"===e&&(this.hitEnemyKey=this.checkHitEnemies(s,n,t),!1!==this.hitEnemyKey)){this.killCount++,this.message=JSON.parse(JSON.stringify(messages.kill_zombie)),this.killCount%10==0&&(this.message.push(messages.lvup[0]),this.maxHitPoint+=10),this.swordHitPoint--,0===this.swordHitPoint&&(this.message.push(messages.broken_sword[0]),this.player.equipment=this.player.equipment.filter(t=>"sword"!==t));break}}if("dig"===e&&i)break;if("attack1"===e&&!1!==this.hitEnemyKey)break}"dig"!==e||i||(this.holeList[getRandomInt(0,999)]=t)}else"hit"!==e&&this.checkHit();this.drawMain(),window.requestAnimationFrame(this.playing.bind(this))}}putCharacter(t,e,i){if(!e){let t=0,i=this.stage.img[0].length;e=getRandomInt(t,i)}if(!i){let t=0,e=this.stage.img.length;i=getRandomInt(t,e)}t.posY=i,t.posX=e,this.checkHitWall(t)&&this.putCharacter(t)}moveCharacter({character:t,actionType:e}){t.prePosX=t.posX,t.prePosY=t.posY;let i=1,s=t.currentDirection;if(null===t.newDirection)switch(i=0,e){case"attack1":i=2;break;case"attack2":i=-2;break;case"hit":i=-10}else s=t.newDirection,t.currentDirection!==t.newDirection&&(t.currentDirection=t.newDirection,t.turn());switch(s){case"top":t.posY-=i;break;case"down":t.posY+=i;break;case"right":t.posX+=i;break;case"left":t.posX-=i}this.checkHitWall(t)&&(t.posY=t.prePosY,t.posX=t.prePosX);for(let e=0;e<t.img.length;e++){const i=t.posY+e;if(void 0!==this.currentStage[i])for(let s=0;s<t.img[e].length;s++){const n=t.posX+s;if(void 0===this.currentStage[i][n])continue;let a=t.img[e][s];"F"!==a&&(this.currentStage[i][n]=a)}}}checkHitWall(t){for(let e=0;e<t.img.length;e++){const i=t.posY+e;if(void 0===this.baseStage[i])return!0;for(let s=0;s<t.img[e].length;s++){const n=t.posX+s;if(void 0===this.baseStage[i][n])return!0;if("F"!==t.img[e][s]){if("A"===this.baseStage[i][n])return!0;if("player"!==t.index)continue;if("2"===this.baseStage[i][n]||"C"===this.baseStage[i][n])return!0}}}return!1}checkHitEnemies(t,e,i){for(const[s,n]of Object.entries(this.enemies))if(void 0!==n)for(let a=0;a<n.img.img.length;a++)for(let h=0;h<n.img.img[a].length;h++)if("F"!==i.img[t][e]&&"F"!==n.img.img[a][h]&&i.posY+t===n.img.posY+a&&i.posX+e===n.img.posX+h)return"player"===i.index&&(i.hit=!0,this.hitCount=2,this.message=JSON.parse(JSON.stringify(messages.zombie_attack)),this.hitPoint-=10,this.hitPoint<=0&&(this.gameover=!0,this.start())),s;return!1}checkHitThing(t,e,i){for(const[s,n]of Object.entries(this.thingList))if(void 0!==n)for(let s=0;s<n.img.length;s++)for(let a=0;a<n.img[s].length;a++)if("F"!==i.img[t][e]&&"F"!==n.img[s][a]&&i.posY+t===n.posY+s&&i.posX+e===n.posX+a)return"player"===i.index&&(n.clear=!0),!0}checkHitExit(t,e,i){for(let s=0;s<this.exit.img.length;s++)for(let n=0;n<this.exit.img[s].length;n++)if("F"!==i.img[t][e]&&i.posY+t===this.exit.posY+s&&i.posX+e===this.exit.posX+n)return!0}checkHit(){for(let t=0;t<this.player.img.length;t++)for(let e=0;e<this.player.img[t].length;e++){if(!1!==this.checkHitEnemies(t,e,this.player))return!0;if(this.checkHitThing(t,e,this.player))return!0;if(this.checkHitExit(t,e,this.player))return this.message=JSON.parse(JSON.stringify(messages.up_or_stay)),this.stop=!0,this.answer="Yes",this.setEventListener("question",this),!0}return!1}drawMain(){for(let[t,e]of Object.entries(this.holeList))void 0!==e&&e.clear&&(this.clearObject(e.img,e.posY,e.posX),delete this.holeList[t]);for(let[t,e]of Object.entries(this.thingList))void 0!==e&&(e.put?e.clear&&(this.clearObject(e.img,e.posY,e.posX),e.clearFunc(),delete this.thingList[t]):e.count>=0?(e.count--,0===e.count&&this.holeList[e.holeKey]&&(this.holeList[e.holeKey].clear=!0)):(this.drawObject(e.img,e.posY,e.posX),e.put=!0));this.exit.put||(this.drawObject(this.exit.img,this.exit.posY,this.exit.posX),this.exit.put=!0);for(let[t,e]of Object.entries(this.enemies))void 0!==e&&(!0!==e.clear?this.drawCharacter(e.img):(this.clearObject(e.img.img,e.img.posY,e.img.posX),delete this.enemies[t]));this.drawCharacter(this.player);for(let[t,e]of Object.entries(this.holeList))if(void 0!==e)if(e.put)e.count--,0===e.count&&(this.notFoundCount++,this.message=JSON.parse(JSON.stringify(messages.not_found)),e.clear=!0);else{if(this.drawObject(e.img,e.posY,e.posX),this.player.equipment.includes("key")||0!==getRandomInt(0,10))if(0===getRandomInt(0,10)){let i=new s("enemy","down");this.checkHitWall(e)||(this.putCharacter(i,e.posX,e.posY),this.enemies[getRandomInt(0,999)]={count:30,img:i,holeKey:t})}else if(this.player.equipment.includes("sword")||0!==getRandomInt(0,10)){if(this.hitPoint<this.maxHitPoint&&0===getRandomInt(0,10))this.thingList[getRandomInt(0,999)]={count:30,img:ONIGIRI_IMG,holeKey:t,put:!1,clear:!1,posY:e.posY,posX:e.posX,clearFunc:()=>{this.message=JSON.parse(JSON.stringify(messages.found_onigiri)),this.hitPoint<this.maxHitPoint&&(this.hitPoint+=10)}};else if(1===getRandomInt(0,10))this.thingList[getRandomInt(0,999)]={count:30,img:COIN_IMG,holeKey:t,put:!1,clear:!1,posY:e.posY,posX:e.posX,clearFunc:()=>{this.message=JSON.parse(JSON.stringify(messages.found_coin)),this.coinCount++}};else if(0===getRandomInt(0,100))return this.stop=!0,this.floor++,this.start(),void(this.message=JSON.parse(JSON.stringify(messages.fall_down)))}else this.thingList[getRandomInt(0,999)]={count:30,img:SWORD_IMG,holeKey:t,put:!1,clear:!1,posY:e.posY,posX:e.posX,clearFunc:()=>{this.player.equipment.includes("sword")||this.player.equipment.push("sword"),this.message=JSON.parse(JSON.stringify(messages.found_sword))}},this.swordHitPoint=getRandomInt(1,10);else this.thingList[getRandomInt(0,999)]={count:30,img:KEY_IMG,holeKey:t,put:!1,clear:!1,posY:e.posY,posX:e.posX,clearFunc:()=>{this.message=JSON.parse(JSON.stringify(messages.found_key)),this.player.equipment.push("key")}};e.put=!0}this.mCanvas.fillStyle=WALL_COLOR,this.mCanvas.fillRect(0,this.stage.height*PIXEL_SIZE,this.stage.width*PIXEL_SIZE,MESSAGE_WINDOW_HEIGHT),this.mCanvas.font="10pt monospace",this.mCanvas.textAlign="left",this.mCanvas.textBaseline="top",this.writeCountWindow(),this.writeInformationWindow(),this.writeMessageWindow()}drawObject(t,e,i){for(let s=0;s<t.length;s++)for(let n=0;n<t[s].length;n++){let a=t[s][n],h=a;"F"===a&&(a=this.baseStage[e+s][i+n],h=this.currentStage[e+s][i+n]),this.baseStage[e+s][i+n]=a,this.mCanvas.fillStyle=COLORS[h],this.mCanvas.fillRect((i+n)*PIXEL_SIZE,(e+s)*PIXEL_SIZE,PIXEL_SIZE,PIXEL_SIZE)}}clearObject(t,e,i){for(let s=0;s<t.length;s++)for(let n=0;n<t[s].length;n++){let t=this.stage.img[e+s][i+n];this.baseStage[e+s][i+n]=t,this.mCanvas.fillStyle=COLORS[t],this.mCanvas.fillRect((i+n)*PIXEL_SIZE,(e+s)*PIXEL_SIZE,PIXEL_SIZE,PIXEL_SIZE)}}drawCharacter(t){for(let e=0;e<t.img.length;e++){const i=t.prePosY+e;if(void 0!==this.currentStage[i])for(let s=0;s<t.img[e].length;s++){const e=t.prePosX+s;void 0!==this.currentStage[i][e]&&(this.mCanvas.fillStyle=COLORS[this.currentStage[i][e]],this.mCanvas.fillRect(e*PIXEL_SIZE,i*PIXEL_SIZE,PIXEL_SIZE,PIXEL_SIZE))}}for(let e=0;e<t.img.length;e++){const i=t.posY+e;if(void 0!==this.currentStage[i])for(let s=0;s<t.img[e].length;s++){const e=t.posX+s;void 0!==this.currentStage[i][e]&&(this.mCanvas.fillStyle=COLORS[this.currentStage[i][e]],this.mCanvas.fillRect(e*PIXEL_SIZE,i*PIXEL_SIZE,PIXEL_SIZE,PIXEL_SIZE))}}}writeCountWindow(t){this.mCanvas.strokeStyle="white",this.mCanvas.strokeRect(5,this.stage.height*PIXEL_SIZE+5,150,MESSAGE_WINDOW_HEIGHT-10),this.mCanvas.fillStyle="white",this.mCanvas.fillText("Not Found : "+this.notFoundCount,10,this.stage.height*PIXEL_SIZE+10,this.stage.width*PIXEL_SIZE),this.mCanvas.fillText("Coin      : "+this.coinCount,10,this.stage.height*PIXEL_SIZE+20+10,this.stage.width*PIXEL_SIZE),this.mCanvas.fillText(`HP        : ${this.hitPoint}/${this.maxHitPoint}`,10,this.stage.height*PIXEL_SIZE+40+10,this.stage.width*PIXEL_SIZE),this.mCanvas.fillText("Stage     : "+this.floor,10,this.stage.height*PIXEL_SIZE+60+10,this.stage.width*PIXEL_SIZE),this.mCanvas.beginPath()}writeInformationWindow(){this.mCanvas.strokeStyle="white",this.mCanvas.strokeRect(160,this.stage.height*PIXEL_SIZE+5,150,MESSAGE_WINDOW_HEIGHT-10),this.mCanvas.fillStyle="white",this.mCanvas.fillText("Equipment: ",165,this.stage.height*PIXEL_SIZE+10,this.stage.width*PIXEL_SIZE);for(let t=0;t<this.player.equipment.length;t++){const e=this.player.equipment[t];this.mCanvas.fillText(" "+e,165,this.stage.height*PIXEL_SIZE+20*(t+1)+10,this.stage.width*PIXEL_SIZE)}this.mCanvas.beginPath()}writeMessageWindow(){this.mCanvas.strokeStyle="white",this.mCanvas.strokeRect(315,this.stage.height*PIXEL_SIZE+5,this.stage.width*PIXEL_SIZE-310-10,MESSAGE_WINDOW_HEIGHT-10),this.mCanvas.fillStyle="white",this.mCanvas.beginPath();let t=this.stage.height*PIXEL_SIZE+10;for(let e=0;e<this.message.length;e++){const i=this.message[e];t=0===e?t:t+20,this.mCanvas.fillText(i,320,t,this.stage.width*PIXEL_SIZE)}}putExit(){let t=getRandomInt(0,this.stage.roomList.length-1),e=this.stage.roomList[t],i=getRandomInt(e.minY+CHARACTER_SIZE,e.maxY-2*CHARACTER_SIZE),s=getRandomInt(e.minX+CHARACTER_SIZE,e.maxX-2*CHARACTER_SIZE),n={img:STAIRS_IMG,posY:i,posX:s,put:!1,clear:!1};if(this.checkHitWall(n))this.putExit();else{this.exit=n;for(let t=0;t<this.player.img.length;t++)for(let e=0;e<this.player.img[t].length;e++)if(this.checkHitExit(t,e,this.player))return void this.putExit()}}putShovel(){let t=getRandomInt(0,this.stage.roomList.length-1),e=this.stage.roomList[t],i=getRandomInt(e.minY,e.maxY-CHARACTER_SIZE),s=getRandomInt(e.minX,e.maxX-CHARACTER_SIZE),n={img:SHOVEL_IMG,posY:i,posX:s,put:!1,clear:!1,clearFunc:()=>{this.player.equipment.push("shovel"),this.message=JSON.parse(JSON.stringify(messages.found_shovel))}};this.checkHitWall(n)?this.putShovel():this.thingList[getRandomInt(0,999)]=n}keyDown(t){switch(t.keyCode){case 37:case 65:this.move("left");break;case 39:case 68:this.move("right");break;case 38:case 87:this.move("top");break;case 40:case 83:this.move("down");break;case 13:this.actionEvent("attack");break;case 32:this.actionEvent("dig")}}keyUp(t){switch(t.keyCode){case 37:case 65:case 39:case 68:case 38:case 87:case 40:case 83:this.move(null)}}chooseAnswer(){"Yes"===this.answer?(this.message[1]="  Yes",this.message[2]="> No",this.answer="No"):(this.message[1]="> Yes",this.message[2]="  No",this.answer="Yes"),this.mCanvas.fillStyle=WALL_COLOR,this.mCanvas.fillRect(0,this.stage.height*PIXEL_SIZE,this.stage.width*PIXEL_SIZE,MESSAGE_WINDOW_HEIGHT),this.mCanvas.font="10pt monospace",this.mCanvas.textAlign="left",this.mCanvas.textBaseline="top",this.writeCountWindow(),this.writeInformationWindow(),this.writeMessageWindow()}selectAnswer(){this.setEventListener("normal",this),"Yes"===this.answer?this.player.equipment.includes("key")?(this.message=JSON.parse(JSON.stringify(messages.up_stairs)),this.floor++,this.answer=null,this.floor>404&&(this.gameover=!0),0===getRandomInt(0,30)&&(this.gameclear=!0),this.start()):(this.stop=!1,this.player.posY=this.player.prePosY,this.player.posX=this.player.prePosX,this.player.newDirection=null,window.requestAnimationFrame(this.playing.bind(this)),this.message=JSON.parse(JSON.stringify(messages.not_found_key))):(this.stop=!1,this.player.posY=this.player.prePosY,this.player.posX=this.player.prePosX,this.player.newDirection=null,window.requestAnimationFrame(this.playing.bind(this)),this.message=JSON.parse(JSON.stringify(messages.stay_floor)))}keyUpQuestion(t){switch(t.keyCode){case 38:case 87:case 40:case 83:this.chooseAnswer();break;case 32:this.selectAnswer()}}newGame(t){this.initialize=!0,this.start()}move(t){this.player.newDirection=t}actionEvent(t){switch(t){case"dig":this.player.digAction=!0;break;case"attack":this.player.attackAction=!0,this.attackCount=2}}setEventListener(t,e){for(const[t,i]of Object.entries(e.eventKeys))handler.removeListener(i),delete e.eventKeys[t];"normal"===t?(e.eventKeys.keyup=handler.addListener(window,"keyup",e.keyUp.bind(e),!1),e.eventKeys.keydown=handler.addListener(window,"keydown",e.keyDown.bind(e),!1)):"question"===t?e.eventKeys.keyup=handler.addListener(window,"keyup",e.keyUpQuestion.bind(e),!1):"continue"===t&&(e.eventKeys.keyup=handler.addListener(window,"keyup",e.newGame.bind(e),!1))}}window.addEventListener("DOMContentLoaded",(function(){let t=document.getElementById("canvas"),e=t.getContext("2d");new a(e,t)}))}]);