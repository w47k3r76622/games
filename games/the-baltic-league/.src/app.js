/**
 * My entry to js13kgames 2023 - 13th Century.
 * Copyright (C) 2023	Andr√© Jaenisch
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as published
 * by the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 *
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */

!function(){"use strict";const e="A",t="B",a="C",n="D",o="E",i="The Flying Dutchman",r="F",s="G",c="H",u="THE_BALTIC_LEAGUE",p="Could not find city",l="J",d="K",m="L",h="M",y="N",w="O",f="P",g="R",v="S",b="T",k="U",T="V",x="W",S="X";function N(e){return e.cloneNode(!0)}function $(e,t=[],a={},n="",o=[]){let i;return i=["circle","g","polygon","svg","text","tspan"].includes(e)?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e),t.forEach((function(e){i.classList.add(e)})),Object.entries(a).forEach((function(e){const t=e[0],a=e[1];i.setAttribute(t,a)})),i.textContent=n,o.forEach((function(e){i.appendChild($(...e))})),i}function C(e,t){const a=N(e),n=t.cities.find((e=>e.name===t.activeCity));return n?(a.appendChild($("div",[],{},"",[["div",[],{"data-component":"tutorial"}],...M(t,n),L(t,n),["button",[],{type:"button","data-view":"warehouse"},"To the warehouse"]])),a):(console.warn(p),a)}function M(e,t){const{activeCity:a,activeMonth:n,cities:o,ships:i}=e,{warehouse:r}=t,s=o.filter((e=>e.isFounded)).filter((e=>e.name!==a)).filter((e=>10-Number(n)-t.distances[e.name]>=0)),c=i.filter((e=>e.position===a)).filter((e=>e.moored));return 0===i.length?[["p",[],{},"No ships here. Perhaps they are sailing?"]]:["1","2","11","12"].includes(n)?[["p",[],{},"No ships can depart as long as the sea is frozen."]]:c.map((a=>["div",[],{},`Cargo for ${a.name} (up to ${e.shipTypes[a.type].maxFreightWeight})`,[["fieldset",[],{},"",[["legend",[],{},"Load"],["ul",[],{},"",Object.entries(r).filter((e=>e[1]>0)).map((n=>["li",[],{},"",[["label",[],{for:`${a.name}-load-${n[0]}`},n[0]],["span",[],{},"",[["span",[],{},"0"],["input",[],{id:`${a.name}-load-${n[0]}`,name:`${a.name}-load-${n[0]}`,type:"range",min:0,max:Math.min(n[1],e.shipTypes[a.type].maxFreightWeight-Object.values(a.cargo).reduce(((e,t)=>e+t),0)),step:1,value:0,"data-city":t.name,"data-load":"load","data-ship":a.name,"data-ware":n[0]}],["span",[],{},n[1]]]]]]))]]],["fieldset",[],{},"",[["legend",[],{},"Unload"],["ul",[],{},"",Object.entries(a.cargo).filter((e=>e[1]>0)).map((e=>["li",[],{},"",[["label",[],{for:`${a.name}-unload-${e[0]}`},e[0]],["span",[],{},"",[["span",[],{},"0"],["input",[],{id:`${a.name}-unload-${e[0]}`,name:`${a.name}-unload-${e[0]}`,type:"range",min:0,max:e[1],step:1,value:0,"data-city":t.name,"data-load":"unload","data-ship":a.name,"data-ware":e[0]}],["span",[],{},e[1]]]]]]))]]],["fieldset",[],{},"",[["legend",[],{},`Send ${a.type} ‚Äû${a.name}‚Äù`],["label",[],{for:"destination"}],["select",[],{id:"destination","data-ship":a.name},"",[["option",[],{selected:"selected",value:"","data-ship":a.name},"Please select"],...s.map((n=>["option",[],{value:n.name},`to  ${n.name} (for ${e.shipTypes[a.type].upkeep*t.distances[n.name]} üí∞)`]))]]]]]]))}function L(e,t){return e.showTutorial.docks?["div"]:["fieldset",[],{},"",[["legend",[],{},"Buy"],["div",[],{},"",[["label",[],{for:"shipName"},"Name of your new ship?"],["input",[],{id:"shipName",name:"shipName",type:"text","data-city":t.name}]]],["div",[],{},"",[["label",[],{for:"shipType"},"What type of ship do you want?"],["select",[],{id:"shipType","data-city":t.name},"",[["option",[],{value:""},"Please choose"],...Object.entries(e.shipTypes).filter((e=>e[1].isKnown)).map((e=>{const[t]=e;return["option",[],{value:t},t]}))]],["button",[],{type:"button","data-acquire":"ship"},e.newShipType?`Buy for ${e.shipTypes[e.newShipType].price} üí∞`:"Decide on your ship type first."]]]]]}function R(e,t){const a=N(e),n=t.cities.find((e=>e.name===t.activeCity));return n?(a.appendChild($("div",[],{},"",[["div",[],{"data-component":"tutorial"}],I(t,n),j(t,n),["button",[],{type:"button","data-view":"warehouse"},"To the warehouse"]])),a):(console.warn(p),a)}function I(e,t){if(e.playermoney<=1)return["p",[],{},"You cannot buy without üí∞"];const a=Object.entries(t.supply).filter((e=>e[1]>0));return a.every((e=>0===e[1]))?["p",[],{},"I'm afraid there is nothing to buy right now."]:["fieldset",[],{},"",[["legend",[],{},"Buy"],["ul",[],{},"",a.map((a=>["li",[],{},"",[["label",[],{for:`market-${a[0]}`},a[0]],["span",[],{},"",[["span",[],{},"0"],["input",[],{id:`market-${a[0]}`,name:a[0],type:"range",min:0,max:a[1],step:1,value:0,"data-buy":a[0],"data-city":t.name}],["span",[],{},a[1]],["span",[],{},` (${e.wares[a[0]]} üí∞ each)`]]]]]))]]]}function j(e,t){const a=Object.entries(t.warehouse).filter((e=>e[1]>0));return 0===a.length?["p",[],{},"It appears your warehouse empty. Buy something first."]:["fieldset",[],{},"",[["legend",[],{},"Sell"],["ul",[],{},"",a.map((a=>["li",[],{},"",[["label",[],{for:`warehouse-${a[0]}`},a[0]],["span",[],{},"",[["span",[],{},"0"],["input",[],{id:`warehouse-${a[0]}`,name:a[0],type:"range",min:0,max:a[1],step:1,value:0,"data-sell":a[0],"data-city":t.name}],["span",[],{},a[1]],["span",[],{},` (${e.wares[a[0]]} üí∞ each)`]]]]]))]]]}function F(e,t){return e.getAttribute(`data-${t}`)||""}function O(e,t){const a=N(e),n=F(a,"month"),o=F(a,"active-month");return a.appendChild($("div",["f","g"],{},"",[["meter",[],{min:0,max:11,value:o}],["div",[],{},n,[["button",[],{type:"button","data-action":"next-month"},"Next month"]]]])),a}function W(e,t){const a=N(e),n=t.cities.find((e=>e.name===t.activeCity));if(!n)return console.warn(p),a;const o=t.cities.filter((e=>e.isFounded)).filter((e=>e.name!==t.activeCity)),i=t.ships.filter((e=>e.moored)),r=t.ships.filter((e=>!e.moored));return a.appendChild($("div",[],{},"",[["div",[],{"data-component":"tutorial"}],["div",[],{},"",[["div",["f"],{},"",[["div",[],{"data-component":"sea-map"}],["div",[],{},"",[["div",[],{},"Plan your moves carefully"],["ul",["c"],{},"",o.map((e=>["li",[],{},`${e.name} (${D("month","months",n.distances[e.name])} away, ${H(e)})`]))]]]]],["div",[],{},"Ships moored in a port",[["ul",[],{},"",i.map((e=>["li",[],{},`${e.name} in ${e.position}`]))]]],["div",[],{},"Sailing ships:",[["ul",[],{},"",[...G(r)]]]],["button",[],{type:"button","data-view":"warehouse"},"To the warehouse"]]]])),a}function G(e){return e.map((e=>null===e.itinerary?(console.warn(`${e.name} is sailing but has invalid data structure`),[]):["li",[],{},`${e.name} from ${e.itinerary.from} to ${e.itinerary.to}`]))}function D(e,t,a){return 1===a?`${a} ${e}`:`${a} ${t}`}function H(e){return`demands ${Object.entries(e.demand).filter((e=>e[1]>0)).map((e=>e[0])).join(", ")}`}function A(e,t){const a=N(e);return a.appendChild($("svg",[],{"aria-role":"presentation",viewBox:"0 0 341 353",xmlns:"http://www.w3.org/2000/svg"},"",[["polygon",["kingdom","norway"],{points:E("norway")}],["polygon",["kingdom","sweden"],{points:E("sweden")}],["polygon",["kingdom","sweden"],{points:E("finnland")}],["polygon",["republic","nowgorod"],{points:E("nowgorod")}],["polygon",["republic","pskow"],{points:E("pskow")}],["polygon",["teutonic","order"],{points:E("order")}],["polygon",["grand","duchy","lithuania"],{points:E("lithuania")}],["polygon",["roman","empire"],{points:E("roman")}],["polygon",["kingdom","denmark"],{points:E("denmark")}],["text",[],{x:35,y:91},"",[["tspan",[],{x:35,dy:"1em"},"Kingdom"],["tspan",[],{x:35,dy:"1em"},"of Norway"]]],["text",[],{x:80,y:151},"",[["tspan",[],{x:80,dy:"1em"},"Kingdom"],["tspan",[],{x:80,dy:"1em"},"of Sweden"]]],["text",[],{x:262,y:26},"",[["tspan",[],{x:262,dy:"1em"},"Republic of"],["tspan",[],{x:262,dy:"1em"},"Nowgorod"]]],["text",[],{x:262,y:166},"",[["tspan",[],{x:262,dy:"1em"},"Republic"],["tspan",[],{x:262,dy:"1em"},"of Pskow"]]],["text",[],{x:200,y:293},"",[["tspan",[],{x:200,dy:"1em"},"Teutonic"],["tspan",[],{x:200,dy:"1em"},"Order"]]],["text",[],{x:255,y:298},"",[["tspan",[],{x:255,dy:"1em"},"Grand Duchy"],["tspan",[],{x:255,dy:"1em"},"of Lithuania"]]],["text",[],{x:25,y:298},"",[["tspan",[],{x:25,dy:"1em"},"Holy Roman Empire"]]]])),a}function E(e){return"denmark"===e?[[31,322],[32,314],[23,313],[27,310],[28,312],[24,308],[29,302],[25,295],[31,292],[26,290],[32,286],[36,286],[41,274],[42,277],[44,276],[45,278],[49,269],[39,266],[36,269],[39,263],[30,265],[39,263],[34,254],[26,256],[20,260],[22,268],[17,267],[17,260],[15,263],[10,269],[4,267],[4,262],[1,274],[6,284],[2,289],[1,294],[4,296],[4,293],[10,313],[16,321],[9,325],[10,328],[15,327],[15,335],[13,334],[22,339],[25,346],[11,339],[6,352]].join(" "):"finnland"===e?[[213,0],[233,23],[199,73],[192,99],[203,120],[202,132],[224,148],[253,152],[269,141],[279,138],[280,134],[291,130],[295,132],[299,130],[299,128],[312,121],[313,128],[309,126],[309,99],[253,33]].join(" "):"lithuania"===e?[[240,338],[260,300],[260,280],[245,275],[245,255],[321,245],[321,190],[341,205],[341,350],[240,350]].join(" "):"norway"===e?[[3,225],[16,212],[22,205],[26,198],[33,200],[39,194],[37,187],[43,179],[50,198],[54,218],[64,218],[62,235],[68,242],[77,259],[77,159],[170,42],[180,1],[80,1],[3,125]].join(" "):"nowgorod"===e?[[309,126],[341,135],[323,139],[315,143],[309,147],[341,205],[341,3],[301,3],[284,50],[309,99]].join(" "):"order"===e?[[306,158],[272,159],[262,164],[251,170],[244,184],[258,200],[266,198],[265,232],[238,217],[219,256],[225,282],[217,297],[210,298],[190,316],[182,306],[180,338],[240,338],[260,300],[260,280],[245,275],[245,255],[321,245],[321,190],[306,180]].join(" "):"pskow"===e?[[309,147],[306,158],[306,180],[311,185],[321,190],[341,205]].join(" "):"roman"===e?[[182,306],[117,337],[103,336],[102,331],[87,322],[76,326],[57,336],[49,335],[52,325],[31,322],[31,350],[182,350]].join(" "):"sweden"===e?[[77,259],[82,274],[76,273],[84,296],[96,297],[108,294],[115,279],[114,275],[134,275],[142,247],[139,226],[144,218],[132,207],[152,199],[154,191],[157,200],[173,172],[142,150],[137,123],[138,101],[141,86],[162,70],[187,42],[179,33],[181,19],[190,3],[203,1],[213,0],[180,1],[170,42],[77,159]].join(" "):""}function V(e,t){const a=N(e);return a.appendChild($("div",[],{},"",function(e){const{playername:t,showTutorial:a}=e,n=e.activeView;if(!a[n])return[["span"]];const o={docks:["See this ship over there? It's yours now. The Marie. A beautiful ","nef. You know, your father bought it. Next to another one, the ","Joseph. That one got caught by pirates. We weren't able to rescue ","him. As you know, we have winter now. No ships are sailing. The sea ","is frozen so we can't pass. But once the ice thaws, you can load and ","unload your cargo here. Carriers will bring it to your warehouse. ","Once you are done, set sail to a destination of your choice here. ","Speaking of, let's go to your warehouse next."].join(""),market:["Quite noisy and loud here, huh? Yeah, people from all around the city ","convene here to buy and sell their wares. I recommend you to spend ","some time learning what each city is known for. For example, here in ","the Northern part of the Holy Roman Empire of the German Nation we ","are famous for our crop and beer. And the sprats! You know that during ","the fasting period, meat is forbidden. Fish is not. I have to leave ","you now to attend my own businesses. I wish you always a hand's ","breadth of water under the keel! See you in a year and a month!"].join(""),sea:["Did your father taught you how to read a map? See, we are here. You ","can buy goods like crop from the surroundings of the city and the ","region. Seaman have made notes on how long they travel to other cities.","Since most people here can't read or write you will need to plan ","carefully where do you want to go. After all you are going to travel ","with them to do your business. Noone of us can be at different places ","at the same time, right? Why don't you meet me at the market?"].join(""),story:[`${t} was it, right? `,"It's with great sadness I have to inform you that your father did not ","make it home. Now you have to inherit his work. I have trust in you ","you will accomplish it and make him proud. Here allow me to show you ","around. Meet me at the docks."].join(""),warehouse:["Did you make it through? I know, all those pigs on the street are ","annoying, aren't they? And don't get me started on the smell. But ","let's talk about business here. I'm going to pay the upkeep for a year ","and a month. I am curious whether you are as talented as your farther ","was. In this building you can store your wares in the upper floors. If ","you can afford it I would suggest to add more levels to it. It might ","be prudent to stock certain goods. Let's take a look at the map next."].join("")},i={docks:["button",[],{type:"button","data-view":"warehouse"},"To the warehouse"],market:["span"],sea:["button",[],{type:"button","data-view":"market"},"To the market"],story:["button",[],{type:"button","data-view":"docks"},"To the docks"],warehouse:["button",[],{type:"button","data-view":"sea"},"To the sea map"]},r=o[n],s=i[n];return[["p",["story"],{},r],s]}(t))),a}function B(e,t){const a=N(e),n=t.cities.find((e=>e.name===t.activeCity));return n?(a.appendChild($("div",[],{},"",[["div",[],{"data-component":"tutorial"}],K(t),q(n.warehouse),["button",[],{type:"button","data-view":"docks"},"To the docks"],["button",[],{type:"button","data-view":"market"},"To the market"],["button",[],{type:"button","data-view":"sea"},"To the sea map"]])),a):(console.warn(p),a)}function K(e){const{activeMonth:t,activeYear:a,history:n}=e,o=n.find((e=>{const{month:n,year:o}=e;return o===a&&n===t}));if(o){if(o.city){return["p",[],{},`${o.city} was founded!`]}if(o.shipType){return["p",[],{},`You can now buy ${o.shipType}s!`]}}return["p",[],{},"This is your warehouse. Organise your activities here."]}function q(e){const t=Object.entries(e).filter((e=>e[1]>0));return 0===t.length?["p",[],{},"It appears you have nothing in stock here. Go visit the market."]:["ul",[],{},"",t.map((e=>["li",[],{},`${e[0]} (${e[1]})`]))]}function Y(e,t){const a=N(e);return a.innerHTML="","title-section"===t.activeScene&&a.appendChild($("div",[],{},"",[["h1",[],{},"thE BALtiC LEAGuE"],["div",["f","fc","g"],{},"",[["button",[],{"data-scene":"new-game-section"},"New Game"],["button",[],{"data-scene":"load-game-section"},"Load Game"],["button",[],{"data-scene":"settings-section"},"Settings"],["button",[],{"data-scene":"about-section"},"About"]]]])),a}function _(e,t){const a=N(e);return a.innerHTML="","settings-section"===t.activeScene&&a.appendChild($("div",[],{},"",[["h1",[],{},"Settings"],["fieldset",[],{},"",[["legend",[],{},"Visual Interface"],["div",[],{},"",[["label",[],{for:"color-preference"},"Choose your theme"]]],["div",[],{},"",[["select",[],{id:"color-preference"},"",[["option",[],{value:"system",checked:"checked"},"System"],["option",[],{value:"light"},"Light"],["option",[],{value:"dark"},"Dark"]]]]]]],["div",[],{},"",[["button",[],{"data-scene":"title-section"},"Back to Title"]]]])),a}function z(e,t){const a=N(e);return a.innerHTML="","about-section"===t.activeScene&&a.appendChild($("div",[],{},"",[["h1",[],{},"About"],["p",[],{},"This game was developed entirely by me, ",[["a",[],{href:"https://jaenis.ch/"},"Andr√© Jaenisch"]]],["p",[],{},"It is licensed under ",[["a",[],{href:"https://code.jaenis.ch/js13kgames/js13kgames-2023/src/branch/main/LICENSE.txt"},"AGPL version 3 or newer"]]],["p",[],{},"Find the source code on ",[["a",[],{href:"https://code.jaenis.ch/js13kgames/js13kgames-2023/"},"my Forgejo instance"]]],["p",[],{},"Boeticher font is developed by ",[["a",[],{href:"https://velvetyne.fr/fonts/boeticher/"},"Velvetyne Type Foundry"]]],["p",[],{},"Research was done using ",[["a",[],{href:"https://www.geo.de/magazine/geo-epoche/15023-rtkl-geoepoche-nr-82-vorschau-die-hanse"},"GEO Epoche Nr. 82"]]],["p",[],{},"Map of the baltic sea is derived from ",[["a",[],{href:"https://nrv.de/reviere"},"North German regatta club"]]],["p",[],{},"If you want to support the further development of this game, consider a donation via PayPal: ",[["a",[],{href:"https://www.paypal.com/donate/?hosted_button_id=UHBGQXAL4VQUN"},"Donate for js13kgames ‚ÄûThe Baltic League‚Äù"]]],["div",[],{},"",[["button",[],{"data-scene":"title-section"},"Back to Title"]]]])),a}function P(e,t){const a=N(e);return a.innerHTML="","new-game-section"===t.activeScene&&a.appendChild($("div",[],{},"",[["h1",[],{},"New game"],["fieldset",[],{},"",[["legend",[],{},"Player name"],["div",[],{},"",[["label",[],{for:"playername"},"How do you want to be known?"]]],["div",[],{},"",[["input",[],{id:"playername",type:"text",max:"64"}]]]]],["p",[],{},J(t)],["div",[],{},"",U(t)]])),a}function J(e){const{playername:t}=e;return t?`I greet you, ${t}.`:""}function U(e){const{playername:t}=e;return t.trim()?[["button",["action"],{"data-scene":"world-section"},"Next to World"],["button",["action"],{"data-scene":"title-section"},"Back to Title"]]:[["button",["action"],{"data-scene":"title-section"},"Back to Title"]]}function Q(e,t){const a=N(e);if(a.innerHTML="","load-game-section"===t.activeScene){const e=function(){const e=window.localStorage.getItem(u)||"[]";return JSON.parse(e)}();a.appendChild($("div",[],{},"",[["h1",[],{},"Load game"],["ul",[],{},"",e.map((e=>["li",[],{},e.playername,[["button",[],{type:"button","data-state":JSON.stringify(e)},"Load game"],["button",[],{type:"button","data-playername":e.playername},"Delete game"]]]))],["div",[],{},"",[["button",[],{"data-scene":"title-section"},"Back to Title"]]]]))}return a}function X(e,t){const a=N(e);if(a.innerHTML="","level-section"===t.activeScene){const e=function(e){return{docks:["div",[],{"data-component":"docks"}],market:["div",[],{"data-component":"market"}],sea:["div",[],{"data-component":"sea"}],story:["div",[],{"data-component":"tutorial"}],warehouse:["div",[],{"data-component":"warehouse"}]}[e.activeView]||["div"]}(t),n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Okt","Nov","Dec"],o=Number(t.activeMonth)-1,i=`${n[o]} ${t.activeYear}`;a.appendChild($("div",[],{},"",[["h1",[],{},Z(t.activeView,t.activeCity)],e,["div",["f"],{},"",[["div",[],{},`${t.playermoney} üí∞`],["div",[],{"data-component":"month-meter","data-month":i,"data-active-month":o}]]]]))}return a}function Z(e,t){return{docks:`Docks of ${t}`,market:`Market of ${t}`,sea:"Baltic Sea",story:"Tutorial",warehouse:`Warehouse of ${t}`}[e]}function ee(e,t){const a=N(e);return a.innerHTML="","world-section"===t.activeScene&&a.appendChild($("div",[],{},"",[["h1",[],{},"World"],["fieldset",[],{},"",[["legend",[],{},"Scenarios"],["div",[],{},"",[["label",[],{for:"level-scenario"},"Choose your scenario"]]],["div",[],{},"",[["select",[],{id:"level-scenario"},"",[["option",[],{value:"",checked:"checked"},"Please choose"],["option",[],{value:"tutorial"},"Learn the ropes"],["option",[],{value:"free-play"},"Sail away"]]]]]]],ae(t),["div",[],{},"",te(t)]])),a}function te(e){return e.activeScenario?[["button",[],{"data-scene":"level-section"},"Level"]]:[["span"]]}function ae(e){return"tutorial"===e.activeScenario?["p",[],{},"Content Warning: Death mention."]:["span"]}function ne(e,t){const a=N(e);return a.innerHTML="","win-section"===t.activeScene&&a.appendChild($("div",[],{},"",[["h1",[],{},"Win"],["div",[],{},"",[["button",[],{"data-scene":"title-section"},"Title"]]]])),a}function oe(e,t){const a=N(e);return a.innerHTML="","game-over-section"===t.activeScene&&a.appendChild($("div",[],{},"",[["h1",[],{},"Game Over"],["div",[],{},"",[["button",[],{"data-scene":"title-section"},"Title"]]]])),a}const ie={activeCity:"L√ºbeck",activeColor:"system",activeScene:"title-section",activeScenario:null,activeView:"story",activeMonth:"2",activeYear:1200,cities:[{name:"Danzig",distances:{Danzig:0,Greifswald:2,Hamburg:-1,Kiel:2,"L√ºbeck":2,"Malm√∂":2,Nowgorod:6,Reval:4,Riga:4,Rostock:2,Turku:4,Visby:3,Wismar:2},isFounded:!0,demand:{beer:200,crop:0,salt:20,sprats:100,wax:5,wood:1e3},supply:{beer:0,crop:150,salt:0,sprats:0,wax:0,wood:0},warehouse:{beer:0,crop:0,salt:0,sprats:0,wax:0,wood:0}},{name:"Greifswald",distances:{Danzig:4,Greifswald:0,Hamburg:-1,Kiel:1,"L√ºbeck":1,"Malm√∂":1,Nowgorod:8,Reval:8,Riga:6,Rostock:1,Turku:6,Visby:6,Wismar:1},isFounded:!1,demand:{beer:0,crop:0,salt:15,sprats:25,wax:10,wood:0},supply:{beer:100,crop:250,salt:0,sprats:0,wax:0,wood:350},warehouse:{beer:0,crop:0,salt:0,sprats:0,wax:0,wood:0}},{name:"Hamburg",distances:{Danzig:-1,Greifswald:-1,Hamburg:0,Kiel:-1,"L√ºbeck":1,"Malm√∂":-1,Nowgorod:-1,Reval:-1,Riga:-1,Rostock:-1,Turku:-1,Visby:-1,Wismar:-1},isFounded:!0,demand:{beer:0,crop:0,salt:0,sprats:100,wax:40,wood:0},supply:{beer:100,crop:150,salt:70,sprats:0,wax:0,wood:350},warehouse:{beer:0,crop:0,salt:0,sprats:0,wax:0,wood:0}},{name:"Kiel",distances:{Danzig:4,Greifswald:2,Hamburg:-1,Kiel:0,"L√ºbeck":1,"Malm√∂":1,Nowgorod:8,Reval:8,Riga:6,Rostock:1,Turku:8,Visby:6,Wismar:1},isFounded:!1,demand:{beer:0,crop:0,salt:50,sprats:0,wax:10,wood:0},supply:{beer:100,crop:50,salt:0,sprats:15,wax:0,wood:350},warehouse:{beer:0,crop:0,salt:0,sprats:0,wax:0,wood:0}},{name:"L√ºbeck",distances:{Danzig:4,Greifswald:2,Hamburg:1,Kiel:1,"L√ºbeck":0,"Malm√∂":1,Nowgorod:8,Reval:8,Riga:6,Rostock:2,Turku:8,Visby:6,Wismar:2},isFounded:!0,demand:{beer:0,crop:0,salt:0,sprats:100,wax:38,wood:1e3},supply:{beer:100,crop:150,salt:70,sprats:0,wax:0,wood:0},warehouse:{beer:0,crop:0,salt:0,sprats:0,wax:0,wood:0}},{name:"Malm√∂",distances:{Danzig:4,Greifswald:2,Hamburg:-1,Kiel:2,"L√ºbeck":2,"Malm√∂":0,Nowgorod:8,Reval:8,Riga:6,Rostock:2,Turku:8,Visby:6,Wismar:2},isFounded:!0,demand:{beer:100,crop:100,salt:10,sprats:0,wax:5,wood:0},supply:{beer:0,crop:0,salt:0,sprats:100,wax:0,wood:250},warehouse:{beer:0,crop:0,salt:0,sprats:0,wax:0,wood:0}},{name:"Nowgorod",distances:{Danzig:3,Greifswald:4,Hamburg:-1,Kiel:4,"L√ºbeck":4,"Malm√∂":4,Nowgorod:0,Reval:1,Riga:2,Rostock:4,Turku:1,Visby:2,Wismar:4},isFounded:!0,demand:{beer:50,crop:500,salt:12,sprats:0,wax:0,wood:0},supply:{beer:0,crop:0,salt:0,sprats:10,wax:50,wood:250},warehouse:{beer:0,crop:0,salt:0,sprats:0,wax:0,wood:0}},{name:"Reval",distances:{Danzig:2,Greifswald:4,Hamburg:-1,Kiel:4,"L√ºbeck":4,"Malm√∂":4,Nowgorod:1,Reval:0,Riga:1,Rostock:4,Turku:1,Visby:1,Wismar:4},isFounded:!1,demand:{beer:100,crop:150,salt:10,sprats:0,wax:0,wood:0},supply:{beer:0,crop:0,salt:0,sprats:20,wax:50,wood:250},warehouse:{beer:0,crop:0,salt:0,sprats:0,wax:0,wood:0}},{name:"Riga",distances:{Danzig:2,Greifswald:3,Hamburg:-1,Kiel:3,"L√ºbeck":3,"Malm√∂":3,Nowgorod:4,Reval:2,Riga:0,Rostock:3,Turku:2,Visby:1,Wismar:3},isFounded:!1,demand:{beer:100,crop:200,salt:10,sprats:0,wax:0,wood:200},supply:{beer:0,crop:0,salt:0,sprats:50,wax:15,wood:0},warehouse:{beer:0,crop:0,salt:0,sprats:0,wax:0,wood:0}},{name:"Rostock",distances:{Danzig:4,Greifswald:1,Hamburg:-1,Kiel:1,"L√ºbeck":1,"Malm√∂":1,Nowgorod:8,Reval:8,Riga:6,Rostock:0,Turku:8,Visby:6,Wismar:2},isFounded:!0,demand:{beer:0,crop:0,salt:0,sprats:25,wax:12,wood:100},supply:{beer:100,crop:200,salt:47,sprats:0,wax:0,wood:0},warehouse:{beer:0,crop:0,salt:0,sprats:0,wax:0,wood:0}},{name:"Turku",distances:{Danzig:2,Greifswald:3,Hamburg:-1,Kiel:4,"L√ºbeck":4,"Malm√∂":4,Nowgorod:2,Reval:2,Riga:1,Rostock:4,Turku:0,Visby:1,Wismar:3},isFounded:!1,demand:{beer:50,crop:200,salt:20,sprats:0,wax:0,wood:300},supply:{beer:0,crop:0,salt:0,sprats:60,wax:15,wood:0},warehouse:{beer:0,crop:0,salt:0,sprats:0,wax:0,wood:0}},{name:"Visby",distances:{Danzig:6,Greifswald:3,Hamburg:-1,Kiel:3,"L√ºbeck":3,"Malm√∂":3,Nowgorod:4,Reval:2,Riga:2,Rostock:3,Turku:2,Visby:0,Wismar:3},isFounded:!0,demand:{beer:50,crop:150,salt:30,sprats:0,wax:0,wood:0},supply:{beer:0,crop:0,salt:0,sprats:120,wax:0,wood:500},warehouse:{beer:0,crop:0,salt:0,sprats:0,wax:0,wood:0}},{name:"Wismar",distances:{Danzig:4,Greifswald:1,Hamburg:-1,Kiel:1,"L√ºbeck":1,"Malm√∂":1,Nowgorod:8,Reval:8,Riga:6,Rostock:1,Turku:6,Visby:6,Wismar:0},isFounded:!0,demand:{beer:0,crop:0,salt:10,sprats:25,wax:10,wood:0},supply:{beer:150,crop:350,salt:0,sprats:0,wax:0,wood:300},warehouse:{beer:0,crop:0,salt:0,sprats:0,wax:0,wood:0}}],wares:{beer:20,crop:10,salt:80,sprats:40,wax:100,wood:5},ships:[{name:"Marie",type:"nef",position:"L√ºbeck",moored:!0,itinerary:null,cargo:{beer:0,crop:0,salt:0,sprats:0,wax:0,wood:0}}],shipTypes:{nef:{isKnown:!0,maxFreightWeight:100,price:5e3,upkeep:30},cog:{isKnown:!1,maxFreightWeight:200,price:1e4,upkeep:50}},newShipName:"",newShipType:null,history:[{year:1201,month:"6",city:"Riga"},{year:1229,month:"7",city:"Turku"},{year:1230,month:"8",city:"Reval"},{year:1233,month:"4",city:"Kiel"},{year:1241,month:"6",city:"Greifswald"},{year:1251,month:"8",shipType:"cog"}],showTutorial:{docks:!1,market:!1,sea:!1,story:!1,warehouse:!1},playername:"",playermoney:1e3};function re(e,t,a){return Object.assign({},e,t,a||{})}function se(e){return e.replace(/</g,"").replace(/>/g,"").replace(/{/g,"").replace(/}/g,"").replace(/\(/g,"").replace(/\)/g,"").replace(/"/g,"").replace(/'/g,"").replace(/%/g,"").replace(/&/g,"").replace(/=/g,"").replace(/\$/g,"").replace(/\//g,"").replace(/\\/g,"").replace(/\s+/," ")}const ce=new class{constructor(e){this.reducer=e,this.state=e(void 0,{type:"I",payload:{}})}async dispatch(e){this.state=this.reducer(this.state,e),this._applySideEffects(e)}getState(){return this.state}_applySideEffects(e){e.type===o&&this._deleteSnapshot(e.payload.playername),e.type===d&&this._saveSnapshot(),e.type===y&&this._applyColorTheme(e.payload.color),e.type===b&&this._setDocumentTitle(),e.type===k&&this._setDocumentTitle()}_applyColorTheme(e){["system","light","dark"].forEach((e=>{document.body.classList.remove(`theme-${e}`)})),document.body.classList.add(`theme-${e}`)}_deleteSnapshot(e){const t=window.localStorage.getItem(u)||"[]",a=JSON.parse(t).filter((t=>t.playername!==e));window.localStorage.setItem(u,JSON.stringify(a))}_saveSnapshot(){const e=this.getState(),t=e.playername,a=window.localStorage.getItem(u)||"[]",n=JSON.parse(a);let o=[];o=n.length>0?n.find((e=>e.playername===t))?n.map((a=>a.playername!==t?a:e)):n.concat([e]):[e],window.localStorage.setItem(u,JSON.stringify(o))}_setDocumentTitle(){const{activeCity:e,activeScene:t,activeView:a}=this.getState();let n="";"level-section"===t&&(n={city:e||"City",docks:`Docks of ${e}`,market:`Market of ${e}`,sea:"Baltic Sea",story:"Tutorial",warehouse:`Warehouse of ${e}`}[a]);const o=[n,{"about-section":"About","game-over-section":"Game Over","level-section":"","load-game-section":"Load Game","new-game-section":"New Game","settings-section":"Settings","title-section":"","win-section":"You Win","world-section":"World"}[t],"The Baltic League","js13kgames-2023"];document.title=o.filter(Boolean).join(" | ")}}((function(o,i){if(void 0===o)return ie;const{payload:u,type:N}=i;return N===e?function(e,t){const{activeCity:a,newShipName:n,newShipType:o}=e,{city:i}=t;if(a!==i)return re(e,{});if(!n)return re(e,{});if(!o)return re(e,{});if(e.ships.find((e=>e.name===n)))return re(e,{});const{price:r}=e.shipTypes[o];let{playermoney:s,ships:c}=e;return r<=s&&(s-=r,c=e.ships.concat({name:n,type:o,position:i,moored:!0,itinerary:null,cargo:{beer:0,crop:0,salt:0,sprats:0,wax:0,wood:0}})),re(e,{newShipName:"",newShipType:null,playermoney:s,ships:c})}(o,u):N===t?function(e,t){const{city:a,quantity:n,ware:o}=t;let i=e.cities,r=e.playermoney;const s=n*e.wares[o];return s>=0&&s<=r&&(r-=s,i=e.cities.map((e=>{if(e.name!==a)return e;const t={...e.supply};t[o]=t[o]-n;const i={...e.warehouse};return i[o]=i[o]+n,{...e,supply:t,warehouse:i}}))),re(e,{cities:i,playermoney:r})}(o,u):N===a?function(e,t){let{activeScene:a}=e;const{activeMonth:n,activeScenario:o,activeYear:i,playermoney:r}=e,s=ie.activeYear+1,c=Number(ie.activeMonth)+1,u=ie.playermoney;return"tutorial"===o&&i>=s&&Number(n)>=c&&r<=u&&(a="game-over-section"),"free-play"===o&&i>=1300&&(a="game-over-section"),r<1&&(a="game-over-section"),re(e,{activeScene:a})}(o):N===n?function(e,t){let{activeScene:a}=e;const{activeMonth:n,activeScenario:o,activeYear:i,playermoney:r}=e,s=ie.activeYear+1,c=Number(ie.activeMonth)+1,u=ie.playermoney;return"tutorial"===o&&i>=s&&Number(n)>=c&&r>u&&(a="win-section"),"free-play"===o&&i>=1300&&(a="win-section"),re(e,{activeScene:a})}(o):N===r?function(e,t){let a=Number(e.activeMonth)+1,n=e.activeYear;if(a>12&&(a-=12,n+=1),e.ships.some((e=>null!==e.itinerary))){const t=e.ships.map((e=>e.itinerary)).map((t=>{if(null===t)return Number.POSITIVE_INFINITY;const a=e.cities.find((e=>e.name===t.from));if(!a)return Number.POSITIVE_INFINITY;const n=a.distances[t.to];return Number(t.month)+n}));a=Math.min(...t)}return re(e,{activeMonth:String(a),activeYear:n})}(o):N===s?function(e,t){const a=t.state,{activeColor:n,playername:o}=e;return re(e,a,{activeColor:n,playername:o})}(o,u):N===c?function(e,t){const{city:a,quantity:n,ship:o,ware:i}=t;let r=e.cities,s=e.ships;return e.ships.filter((e=>e.moored)).filter((t=>t.position===e.activeCity)).find((e=>e.name===o))&&(s=e.ships.map((e=>{if(e.name!==o)return e;const t={...e.cargo};return t[i]=t[i]+n,{...e,cargo:t}})),r=e.cities.map((e=>{if(e.name!==a)return e;const t={...e.warehouse};return t[i]=t[i]-n,{...e,warehouse:t}}))),re(e,{cities:r,ships:s})}(o,u):"I"===N?re(ie,{}):N===l?function(e,t){const a=e.cities.map(((e,t)=>({...e,demand:ie.cities[t].demand,supply:ie.cities[t].supply})));return re(e,{cities:a})}(o):N===d?o:N===m?function(e,t){const{city:a,quantity:n,ware:o}=t;let i=e.cities;const r=n*e.wares[o],s=e.playermoney+r;return i=e.cities.map((e=>{if(e.name!==a)return e;const t={...e.supply};t[o]=t[o]+n;const i={...e.warehouse};return i[o]=i[o]-n,{...e,supply:t,warehouse:i}})),re(e,{cities:i,playermoney:s})}(o,u):N===h?function(e,t){let a=e.ships;return e.ships.filter((e=>e.moored)).filter((e=>e.position===t.from)).find((e=>e.name===t.ship))&&(a=e.ships.map((a=>a.name!==t.ship?a:{...a,itinerary:{from:t.from,to:t.to,month:e.activeMonth},moored:!1,position:null}))),re(e,{ships:a})}(o,u):N===y?function(e,t){return re(e,{activeColor:t.color})}(o,u):N===w?function(e,t){return re(e,{activeScenario:t.scenario||null})}(o,u):N===f?function(e,t){return re(e,{playername:se(t.playername)})}(o,u):"Q"===N?function(e,t){return re(e,{newShipName:se(t.shipName)})}(o,u):N===g?function(e,t){return re(e,{newShipType:t.shipType||null})}(o,u):N===v?function(e,t){const{scene:a}=t;if("level-section"!==a)return re(e,{});const{activeScenario:n,showTutorial:o}=e,i="tutorial"===n?"story":"warehouse",r="tutorial"===n;return Object.keys(o).forEach((e=>{o[e]=r})),re(e,{activeView:i,showTutorial:o})}(o,u):N===b?function(e,t){return re(e,{activeScene:t.scene})}(o,u):N===k?function(e,t){const a=t.view,n={...e.showTutorial};return n[e.activeView]=!1,re(e,{activeView:a,showTutorial:n})}(o,u):N===T?function(e,t){const{city:a,quantity:n,ship:o,ware:i}=t;let r=e.cities,s=e.ships;return e.ships.filter((e=>e.moored)).filter((t=>t.position===e.activeCity)).find((e=>e.name===o))&&(s=e.ships.map((e=>{if(e.name!==o)return e;const t={...e.cargo};return t[i]=Math.max(t[i]-n,0),{...e,cargo:t}})),r=e.cities.map((e=>{if(e.name!==a)return e;const t={...e.warehouse};return t[i]=t[i]+n,{...e,warehouse:t}}))),re(e,{cities:r,ships:s})}(o,u):N===x?function(e,t){const{activeMonth:a,activeYear:n,history:o}=e,i=o.filter((e=>{const{month:t,year:o}=e;return o<=n&&Number(t)<=Number(a)})),r=i.filter((e=>Boolean(e.city))),s=i.filter((e=>Boolean(e.shipType))),c=e.cities.map((e=>e.isFounded?e:{...e,isFounded:Boolean(r.find((t=>t.city===e.name)))})),u={...e.shipTypes};return s.forEach((t=>{const a=t.shipType;u[a]={...e.shipTypes[a],isKnown:!0}})),re(e,{cities:c,shipTypes:u})}(o):N===S?function(e,t){let{activeCity:a,playermoney:n}=e;const o=e.ships.map((t=>{const{itinerary:o,moored:i}=t;if(i)return t;if(!o)return console.warn(`${t.name} is not moored but also not in transit.`),t;const r=e.cities.find((e=>e.name===o.from));if(!r)return console.warn(p),re(e,{});const s=r.distances[o.to];return Number(o.month)+s>Number(e.activeMonth)?t:(n=Math.max(n-e.shipTypes[t.type].upkeep*s,0),a=o.to,{...t,itinerary:null,moored:!0,position:o.to})}));return re(e,{activeCity:a,playermoney:n,ships:o})}(o):o}));async function ue(e){const t=e.target;if(t){if("color-preference"===t.id){const e=t.value;return ce.dispatch(function(e){return{type:y,payload:{color:e}}}(e))}if("destination"===t.id){const e=F(t,"ship")||i,a=ce.getState().activeCity,n=t.value;return ce.dispatch(function({ship:e,from:t,to:a}){return{type:h,payload:{ship:e,from:t,to:a}}}({ship:e,from:a,to:n}))}if("level-scenario"===t.id){const e=t.value;return ce.dispatch(function(e){return{type:w,payload:{scenario:e}}}(e))}if("shipType"===t.id){const e=t.value;return ce.dispatch(function(e){return{type:g,payload:{shipType:e}}}(e))}}}async function pe(t){const i=t.target;if(i)if(F(i,"action"))await Promise.all([{type:r,payload:{}},{type:l,payload:{}},{type:S,payload:{}},{type:x,payload:{}},{type:d,payload:{}},{type:n,payload:{}},{type:a,payload:{}}].map((e=>ce.dispatch(e))));else{if("ship"===F(i,"acquire")){const t=F(i,"city");return ce.dispatch(function(t){return{type:e,payload:{city:t}}}(t))}if(F(i,"playername")){const e=F(i,"playername");return ce.dispatch(function(e){return{type:o,payload:{playername:e}}}(e))}if(F(i,"scene")){const e=F(i,"scene");return await ce.dispatch(function(e){return{type:b,payload:{scene:e}}}(e)),void await ce.dispatch(function(e){return{type:v,payload:{scene:e}}}(e))}if(F(i,"state")){const e=F(i,"state")||"{}",t=JSON.parse(e);return ce.dispatch(function(e){return{type:s,payload:{state:e}}}(t))}if(F(i,"view")){const e=F(i,"view");return ce.dispatch(function(e){return{type:k,payload:{view:e}}}(e))}}}async function le(e){const a=e.target;if(a){if("playername"===a.id)return ce.dispatch((n=a.value,{type:f,payload:{playername:n}}));var n;if(F(a,"buy")){const e=F(a,"city"),n=F(a,"buy"),o=Number(a.value);return ce.dispatch(function({city:e,ware:a,quantity:n}){return{type:t,payload:{city:e,ware:a,quantity:n}}}({city:e,ware:n,quantity:o}))}if(F(a,"sell")){const e=F(a,"city"),t=F(a,"sell"),n=Number(a.value);return ce.dispatch(function({city:e,ware:t,quantity:a}){return{type:m,payload:{city:e,ware:t,quantity:a}}}({city:e,ware:t,quantity:n}))}if("load"===F(a,"load")){const e=F(a,"city"),t=F(a,"ship")||i,n=F(a,"ware"),o=Number(a.value);return ce.dispatch(function({city:e,ship:t,ware:a,quantity:n}){return{type:c,payload:{city:e,ship:t,ware:a,quantity:n}}}({city:e,ship:t,ware:n,quantity:o}))}if("unload"===F(a,"load")){const e=F(a,"city"),t=F(a,"ship")||i,n=F(a,"ware"),o=Number(a.value);return ce.dispatch(function({city:e,ship:t,ware:a,quantity:n}){return{type:T,payload:{city:e,ship:t,ware:a,quantity:n}}}({city:e,ship:t,ware:n,quantity:o}))}}}function de(e){document.body.appendChild(document.createTextNode(e.message))}function me(e,t,a){e.addEventListener(t,a)}function he(e,t,a){if(t&&!a)return function(e){e.remove()}(t);if(!t&&a)return function(e,t){e.appendChild(t)}(e,a);if(function(e,t){if(e.tagName!==t.tagName)return!0;const a=e.attributes,n=t.attributes;return a.length!==n.length||(!!Array.from(a).find((function(a){const n=a.name;return e.getAttribute(n)!==t.getAttribute(n)}))||0===e.children.length&&0===t.children.length&&e.textContent!==t.textContent)}(t,a))return function(e,t){e.replaceWith(t)}(t,a);const n=Array.from(t.children),o=Array.from(a.children),i=Math.max(n.length,o.length);for(let e=0;e<i;e++)he(t,n[e],o[e])}const ye=new Map;function we(e){return function(t,a){const n=e(t,a);return Array.from(n.querySelectorAll("[data-component]")).forEach((function(e){const t=e.dataset.component,n=ye.get(t);n&&e.replaceWith(n(e,a))})),n}}function fe(e,t){ye.set(e,we(t))}const ge="app";function ve(){const e=document.getElementById(ge);if(!e)return console.error('Could not find element with id "app"');const t=(a=e,n=ce.getState(),we((function(e){return e.cloneNode(!0)}))(a,n));var a,n;he(document.body,e,t),window.requestAnimationFrame(ve)}async function be(){return be._runOnlyOnce?(ve(),-1):window.requestAnimationFrame(ve)}async function ke(){fe("docks",C),fe("market",R),fe("month-meter",O),fe("sea",W),fe("sea-map",A),fe("tutorial",V),fe("warehouse",B),fe("title-section",Y),fe("settings-section",_),fe("about-section",z),fe("new-game-section",P),fe("load-game-section",Q),fe("level-section",X),fe("world-section",ee),fe("win-section",ne),fe("game-over-section",oe),me(document.body,"change",ue),me(document.body,"click",pe),me(document.body,"input",le),me(window,"error",de),await be()}be._runOnlyOnce=!1,window.addEventListener("load",ke,!1)}();
