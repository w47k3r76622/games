!function(){let e,t;function n(n,i,o,a){i=i||1e4;const s=function(n,i,o){i=i||0,o=o||n-1,function(n){t=[],e=[];const i=buffer?buffer.numberOfChannels:1;let o;for(o=0;o<i;o++)t[o]=[],t[o][2*(n-1)]=0,t[o][2*(n-1)+1]=0;e[2*(n-1)]=0,e[2*(n-1)+1]=0}(n);const a=buffer.length/n,s=~~(a/10)||1,r=buffer.numberOfChannels;let c;for(c=0;c<r;c++){const n=t[c],r=buffer.getChannelData(c);let l;for(l=i;l<=o;l++){const t=~~(l*a),i=~~(t+a);let o,h=0,f=0;for(o=t;o<i;o+=s){const e=r[o];e>f&&(f=e),e<h&&(h=e)}n[2*l]=f,n[2*l+1]=h,(0==c||f>e[2*l])&&(e[2*l]=f),(0==c||h<e[2*l+1])&&(e[2*l+1]=h)}}return e}(n=n||1024,a=a||0);let r=0,c=[].map.call(s,e=>(e>r&&(r=e),e)),l=1-r;return c=c.map(e=>Math.round((e+l)*i)/i)}kontra={init(e){var t=this.canvas=document.getElementById(e)||e||document.querySelector("canvas");this.context=t.getContext("2d")},_noop:new Function,_tick:new Function},kontra.gameLoop=function(e){let t,n,i,o,a=(e=e||{}).fps||60,s=0,r=1e3/a,c=1/a,l=!1===e.clearCanvas?kontra._noop:function(){kontra.context.clearRect(0,0,kontra.canvas.width,kontra.canvas.height)};function h(){if(n=requestAnimationFrame(h),i=performance.now(),o=i-t,t=i,!(o>1e3)){for(kontra._tick(),s+=o;s>=r;)f.update(c),s-=r;l(),f.render()}}let f={update:e.update,render:e.render,isStopped:!0,start(){t=performance.now(),this.isStopped=!1,requestAnimationFrame(h)},stop(){this.isStopped=!0,cancelAnimationFrame(n)}};return f},function(){let e={},t={},n={13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"};for(let e=0;e<26;e++)n[65+e]=(10+e).toString(36);for(i=0;i<10;i++)n[48+i]=""+i;addEventListener("keydown",function(i){let o=n[i.which];t[o]=!0,e[o]&&e[o](i)}),addEventListener("keyup",function(e){t[n[e.which]]=!1}),addEventListener("blur",function(e){t={}}),kontra.keys={bind(t,n){[].concat(t).map(function(t){e[t]=n})},unbind(t,n){[].concat(t).map(function(t){e[t]=n})},pressed:e=>!!t[e]}}(),function(){class e{constructor(e,t){this._x=e||0,this._y=t||0}add(e,t){this.x+=(e.x||0)*(t||1),this.y+=(e.y||0)*(t||1)}clamp(e,t,n,i){this._c=!0,this._a=e,this._b=t,this._d=n,this._e=i}get x(){return this._x}get y(){return this._y}set x(e){this._x=this._c?Math.min(Math.max(this._a,e),this._d):e}set y(e){this._y=this._c?Math.min(Math.max(this._b,e),this._e):e}}kontra.vector=((t,n)=>new e(t,n)),kontra.vector.prototype=e.prototype;class t{init(e,t,n,i){for(t in e=e||{},this.position=kontra.vector(e.x,e.y),this.velocity=kontra.vector(e.dx,e.dy),this.acceleration=kontra.vector(e.ddx,e.ddy),this.width=this.height=0,this.context=kontra.context,e)this[t]=e[t];if(n=e.image)this.image=n,this.width=n.width,this.height=n.height;else if(n=e.animations){for(t in n)this.animations[t]=n[t].clone(),i=i||n[t];this._ca=i,this.width=i.width,this.height=i.height}return this}get x(){return this.position.x}get y(){return this.position.y}get dx(){return this.velocity.x}get dy(){return this.velocity.y}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set x(e){this.position.x=e}set y(e){this.position.y=e}set dx(e){this.velocity.x=e}set dy(e){this.velocity.y=e}set ddx(e){this.acceleration.x=e}set ddy(e){this.acceleration.y=e}isAlive(){return this.ttl>0}collidesWith(e){return this.x<e.x+e.width&&this.x+this.width>e.x&&this.y<e.y+e.height&&this.y+this.height>e.y}update(e){this.advance(e)}render(){this.draw()}playAnimation(e){this._ca=this.animations[e],this._ca.loop||this._ca.reset()}advance(e){this.velocity.add(this.acceleration,e),this.position.add(this.velocity,e),this.ttl--,this._ca&&this._ca.update(e)}draw(){this.image?this.context.drawImage(this.image,this.x,this.y):this._ca?this._ca.render(this):(this.context.fillStyle=this.color,this.context.fillRect(this.x,this.y,this.width,this.height))}}kontra.sprite=(e=>(new t).init(e)),kontra.sprite.prototype=t.prototype}(),kontra.store={set(e,t){void 0===t?localStorage.removeItem(e):localStorage.setItem(e,JSON.stringify(t))},get(e){let t=localStorage.getItem(e);try{t=JSON.parse(t)}catch(e){}return t}},kontra.init();const o=kontra.context,a=kontra.canvas.height/2,s=2,r=215,c=kontra.canvas.width/s+2|0;let l,h,f,u,d,_,v,p,x,m,g,y,w="AudioDashDefault.mp3",k=[],S=Object.assign({},{volume:1,uiScale:1,gameSpeed:1},JSON.parse(localStorage.getItem("js13k-2018:options"))),b=450;function T(e,t,n){return Math.min(Math.max(t,e),n)}function A(e,t){return Oe.y<e+t&&Oe.y+Oe.height>e}function E(){ve=-kontra.canvas.width/2|0,pe=0,l.currentTime=0,l.volume=S.volume,l.playbackRate=S.gameSpeed,Oe.points=[],Oe.y=a,ye=!0,xe=!0,we.show()}let q=5;function D(e){let t="function"==typeof e.text?e.text():e.text;e.width=t.length*x+2*x,e.height=3*x,(e.center||"button"===e.type)&&(e.x=e.orgX-e.width/2),e.prev?e.y=e.prev.y+1.5*e.prev.height+q/S.uiScale:e.y=e.orgY-e.height/2,e.y+=e.margin||0}function L(e){e.orgX=e.x,e.orgY=e.y,e.type="button",D(e),e.render=function(){D(this),o.save(),V(25),o.fillStyle="#222",t.disabled&&(o.globalAlpha=T(this.parent.alpha-.65,0,1));let e=[this.x,this.y,this.width,this.height];o.fillRect.apply(o,e),this.focused?e.push(255,0,0):this.disabled?e.push(100,100,100):e.push(0,163,220),C.apply(null,e),o.fillStyle="#fff",o.fillText(this.text,this.x+x,this.y+2*x),o.restore()},e.focus=function(){p&&p.blur&&p.blur(),p=this,this.focused=!0,this.domEl.focus()},e.blur=function(){this.focused=!1,p=null};let t=kontra.sprite(e),n=document.createElement("button");return n.textContent=t.label||t.text,n.addEventListener("focus",t.focus.bind(t)),t.domEl=n,Object.defineProperty(t,"disabled",{get(){return this.domEl.disabled},set(e){this.domEl.disabled=e}}),t}function M(e){e.orgX=e.x,e.orgY=e.y,D(e),e.render=function(){D(this);let e="function"==typeof this.text?this.text():this.text;this.lastText!==e&&(this.lastText=e,this.domEl.textContent=e),o.save(),o.fillStyle="#fff",V(25),o.fillText(e,this.x+x,this.y+2*x),o.restore()};let t=kontra.sprite(e),n=document.createElement("div");return"function"==typeof e.text&&(n.setAttribute("role","alert"),n.setAttribute("aria-live","assertive"),n.setAttribute("aria-atomic",!0)),t.domEl=n,t}let O,G=new(window.AudioContext||window.webkitAudioContext);function P(){let e=l.duration/8|0;h=n(1024*e),u=new Array(c/2|0).fill(0);let t=h.map((e,t)=>e>=0?e:h[t-1]),i=a,o=0,d=c,_=0,v=0,p=(270-r+10)/(u.length+t.length),x=0,m=0,g=c,y=0,k=0,S=0,b="AudioDashDefault.mp3"===w;Q.setValues(h),f=u.concat(t).map((e,t,n)=>{let l=(190-p*t)/2;if(t>=c*(b?4:1)){v+=_,k+=Math.abs(_)>1?y/(1.25*Math.abs(_)):y,(m<0&&k<m||m>0&&k>m)&&(k=m);let e=t-u.length;Q.seed(e),++x>=d&&(x=0,o=i,i=a+Q.getNext(200),d=300+Q.getNext(100),_=(i-o)/d),++S>=g&&(S=0,lastYPos=m,g=110+Q.getNext(23),m=Q.getNext(l),y=(m-lastYPos)/g)}let h=1;for(let e=t-5;e<t;e++)n[e]<h&&(h=n[e]);let f=0;for(let e=t-20;e<t+20;e++)n[e]>f&&(f=n[e]);let w=c*(b?15:3),T=t>w&&e-h>=.38&&Math.abs(_)<1.35,A=T?kontra.canvas.height/2-Math.max(65,1/e*35):160+e*r+p*t;return{x:t*s,y:0,width:s,height:A,offset:v,yOffset:T&&t>w?k:0,yPos:m}})}function C(e,t,n,i,a,s,r){o.save(),o.strokeStyle="rgba("+a+","+s+","+r+",0.2)",o.lineWidth=10.5,o.strokeRect(e,t,n,i),o.lineWidth=8,o.strokeRect(e,t,n,i),o.lineWidth=5.5,o.strokeRect(e,t,n,i),o.lineWidth=3,o.strokeRect(e,t,n,i),o.strokeStyle="#fff",o.lineWidth=1.5,o.strokeRect(e,t,n,i),o.restore()}function R(e,t){o.beginPath(),o.moveTo(e[0].x-t,e[0].y),e.forEach(e=>{o.lineTo(e.x-t,e.y)}),o.stroke()}function N(e,t,n,i,a){e.length&&(o.save(),o.strokeStyle="rgba("+n+","+i+","+a+",0.2)",o.lineWidth=10.5,R(e,t),o.lineWidth=8,R(e,t),o.lineWidth=5.5,R(e,t),o.lineWidth=3,R(e,t),o.strokeStyle="#fff",o.lineWidth=1.5,R(e,t),o.restore())}function W(e,t,n,i,a,s,r){o.save(),o.globalAlpha=.2,o.strokeStyle="rgb("+i+","+a+","+s+")",o.lineWidth=10.5,o.strokeText(e,t,n),o.lineWidth=8,o.strokeText(e,t,n),o.lineWidth=5.5,o.strokeText(e,t,n),o.lineWidth=3,o.strokeText(e,t,n),o.globalAlpha=1,o.strokeStyle="#fff",o.lineWidth=1.5,o.strokeText(e,t,n),o.restore()}function I(e,t){o.save(),o.fillStyle="green",o.beginPath(),o.arc(e,t,x,0,2*Math.PI),o.fill(),o.fillStyle="black",V(27),o.fillText("A",e-x/2,t+x/2),o.fillStyle="white",V(25),o.fillText("A",e-x/2,t+x/2),o.restore()}function V(e){o.font=e*S.uiScale+"px 'Lucida Console', Monaco, monospace"}function B(){x=15*S.uiScale}uploadFile.addEventListener("change",async function(e){ne.hide(),se.show(),URL.revokeObjectURL(y);let t=e.currentTarget.files[0];y=URL.createObjectURL(t),w=uploadFile.value.replace(/^.*fakepath/,"").substr(1),await async function(e){return buffer=await function(e){return new Promise((t,n)=>{let i=new XMLHttpRequest;i.responseType="arraybuffer",i.onload=function(){G.decodeAudioData(i.response,e=>{t(e)})},i.open("GET",e,!0),i.send()})}(e),l=await function(e){return new Promise((t,n)=>{let i=document.createElement("audio");i.addEventListener("canplay",function(){t(this)}),i.onerror=function(e){console.error("e:",e),n(e)},i.src=e,i.load()})}(e),P(),Promise.resolve()}(y),Re(),se.hide(),ie.onDown()});let F=0;function U(e){let t,n;if(O=!0,oe.disabled=!1,-1!==e.type.indexOf("mouse")){if("touch"===g&&performance.now()-F<1e3)return;g="mouse",t=e.pageX,n=e.pageY}else g="touch",t=(e.touches[0]||e.changedTouches[0]).pageX,n=(e.touches[0]||e.changedTouches[0]).pageY;let i=t-kontra.canvas.offsetLeft,o=n-kontra.canvas.offsetTop,a=kontra.canvas;for(;a=a.offsetParent;)i-=a.offsetLeft,o-=a.offsetTop;let s=kontra.canvas.offsetHeight/kontra.canvas.height;i/=s,o/=s;for(let e,t=k.length-1;e=k[t];t--)e.children&&e.children.forEach(e=>{if(!e.disabled&&e.parent.active&&e.onDown&&e.collidesWith({x:i-5,y:o-5,width:10,height:10}))return e.onDown(),void e.blur()});F=performance.now()}function j(){O=!1}function z(e){let t=k[k.length-1],n=t.children.indexOf(p);for(;;){if((n+=e)<0||n>t.children.length-1)return;let i=t.children[n];if(i&&i.focus&&!i.disabled){i.focus();break}}}window.addEventListener("mousedown",U),window.addEventListener("touchstart",U),window.addEventListener("mouseup",j),window.addEventListener("touchend",j),window.addEventListener("blur",j),window.addEventListener("beforeunload",()=>{URL.revokeObjectURL(y)}),window.addEventListener("contextmenu",e=>(e.preventDefault(),e.stopPropagation(),!1)),kontra.keys.bind("space",()=>{g="keyboard",oe.disabled=!1,p&&p.onDown&&p.onDown()}),kontra.keys.bind("up",e=>{g="keyboard",oe.disabled=!1,e.preventDefault(),z(-1)}),kontra.keys.bind("down",e=>{g="keyboard",oe.disabled=!1,e.preventDefault(),z(1)});let H=1,Y=0,X=1,J=0;function Z(){if(!navigator.getGamepads)return;if(!(m=navigator.getGamepads()[0]))return;m.buttons[0].pressed?(g="gamepad",Y+=1/60,H+=1/60,oe.disabled=!0):(Y=0,H=1),(H>.3||Y>.3&&H>.1)&&m.buttons[0].pressed&&p&&p.onDown&&(H=0,p.onDown());let e=(t=m.axes[1],n=.5,percentage=(Math.abs(t)-n)/(1-n),percentage<0&&(percentage=0),percentage*(t>0?1:-1));var t,n;let i=e<0||m.buttons[12].pressed,o=e>0||m.buttons[13].pressed;i||o?(g="gamepad",J+=1/60,X+=1/60,oe.disabled=!0):(J=0,X=1),(X>.3||J>.3&&X>.1)&&(i?(X=0,z(-1)):o&&(X=0,z(1)))}let $=0,K=0;(d=kontra.gameLoop({update(){if(Z(),k.forEach(e=>e.update()),(we.active||be.active)&&!Te.active&&!De.active)for(K=0,$+=l.playbackRate;$>=1;)K++,$--,Oe.update();!we.active||xe||we.isHidding||we.hide(()=>{for(let e,t=0,n=Oe.points.length-1;e=Oe.points[n];n--)e.x=0-ge*t++;be.show()})},render(){ye&&(o.fillStyle="#00a3dc",o.fillRect(0,0,kontra.canvas.width,160),o.fillRect(0,kontra.canvas.height-160,kontra.canvas.width,160)),k.forEach(e=>e.render()),(ne.active||fe.active)&&(o.save(),"keyboard"===g?(V(18),o.fillStyle="white",o.fillText("[Spacebar] Select",50-x,kontra.canvas.height-50+x/2.5)):"gamepad"===g&&(I(50,kontra.canvas.height-50),V(18),o.fillStyle="white",o.fillText("Select",50+1.75*x,kontra.canvas.height-50+x/2.5)),o.restore()),we.active&&(me+=ge,Oe.render(me),Oe.points.length>c/2&&Oe.points.shift())}})).start();let Q={values:[],value:null,index:null,numNegatives:0,numPositives:0,setValues:function(e){this.values=e,this.numNegatives=0,this.numPositives=0},seed:function(e){this.index=e,this.value=this.values[e]},getNext:function(e){let t=function(e){return e<0?-1:e>0?1:0}(this.value);(-1===t&&this.numNegatives-this.numPositives>100||1===t&&this.numPositives-this.numNegatives>100)&&(t=-t),-1===t?this.numNegatives++:this.numPositives++;let n=t*(e-e*Math.abs(this.value)),i=1e4*this.value%100*5|0,o=this.index-i;return(o<0||o>this.values.length-1)&&(o=this.index+i),this.seed(o),n}},ee=[];function te(e){let t=document.createElement("div");t.hidden=!0,uiScenes.appendChild(t);let n={name:e,alpha:0,active:!1,children:[],inc:.05,isHidding:!1,hide(e){p&&p.blur(),this.isHidding=!0,t.hidden=!0,this.alpha=1,this.inc=-.05,setTimeout(()=>{this.isHidding=!1,this.active=!1,k.splice(k.indexOf(this),1),e&&e()},b)},show(e){this.active=!0,t.hidden=!1,k.push(this),this.alpha=0,this.inc=.05,setTimeout(()=>{this.onShow&&this.onShow(),e&&e()},b)},add(){Array.from(arguments).forEach(e=>{e.parent=this,this.children.push(e),e.domEl&&t.appendChild(e.domEl)})},update(){this.children.forEach(e=>{e.update&&e.update()})},render(){this.alpha=T(this.alpha+this.inc,0,1),o.save(),o.globalAlpha=this.alpha,this.children.forEach(e=>e.render()),o.restore()}};return ee.push(n),n}let ne=te("menu");ne.add({render(){o.save();return N([{x:50,y:262},{x:80,y:262},{x:88,y:270},{x:96,y:278},{x:104,y:281},{x:112,y:279},{x:120,y:272},{x:128,y:264},{x:136,y:256},{x:144,y:249},{x:152,y:247},{x:160,y:250},{x:168,y:258},{x:176,y:266},{x:206,y:266}],0,0,163,220),o.font="150px 'Lucida Console', Monaco, monospace",W("AUDIO",50,200,0,163,220),W("DASH",231,315,255,0,0),o.restore(),o.fillStyle="#fff",o.font="30px 'Lucida Console', Monaco, monospace",o.fillText("Play the Wave",202,360),""}});let ie=L({x:kontra.canvas.width/2,y:kontra.canvas.height/2,text:"START",onDown(){l.play(),l.pause(),ne.hide(()=>{E()})}}),oe=L({x:kontra.canvas.width/2,prev:ie,text:"UPLOAD SONG",onDown(){uploadFile.click()}}),ae=L({x:kontra.canvas.width/2,prev:oe,text:"OPTIONS",onDown(){ne.hide(()=>{fe.show()})}});ne.add(ie,oe,ae);let se=te("upload"),re=0,ce=M({x:245,y:kontra.canvas.height/2,text(){let e="LOADING";return++re>=60&&(e+="."),re>=120&&(e+="."),re>=180&&(e+="."),re>=240&&(re=0),e}});se.add(ce);let le,he,fe=te("options");fe.onShow=(()=>{le=Object.assign({},S),he.domEl.focus()});let ue=[];[{name:"volume",minValue:0,maxValue:1,inc:.05},{name:"uiScale",minValue:1,maxValue:1.5,inc:.05},{name:"gameSpeed",minValue:.1,maxValue:2,inc:.05}].forEach((e,t)=>{let n=e.name.replace(/([A-Z])/g," $1").toUpperCase(),i=M({x:50,y:0===t?200:null,prev:t>0?ue[t-1]:null,text:n}),o=M({x:475,y:0===t?200:null,center:!0,prev:t>0?ue[t-1]:null,text:()=>(""+Math.round(100*S[e.name])).padStart(3," ")+"%"}),a=L({x:375,y:0===t?200:null,prev:t>0?ue[t-1]:null,text:"-",label:"Decrease "+n,update(){this.disabled=S[e.name]===e.minValue},onDown(){r(-e.inc)}});0===t&&(he=a);let s=L({x:575,y:0===t?200:null,prev:t>0?ue[t-1]:null,text:"+",label:"Increase "+n,update(){this.disabled=S[e.name]===e.maxValue},onDown(){r(e.inc)}});function r(t){let n=T(S[e.name]+t,e.minValue,e.maxValue);S[e.name]=n,B()}fe.add(i,o,a,s),ue.push(i)});let de=L({x:kontra.canvas.width/2,prev:ue[ue.length-1],margin:45,text:"SAVE",onDown(){localStorage.setItem("js13k-2018:options",JSON.stringify(S)),fe.hide(()=>{ne.show(()=>ie.domEl.focus())})}}),_e=L({x:kontra.canvas.width/2,prev:de,text:"CANCEL",onDown(){fe.hide(()=>{S=le,B(),ne.show(()=>ie.domEl.focus())})}});fe.add(de,_e);let ve,pe,xe=!0,me=0,ge=5,ye=!1,we=te("tutorial"),ke=M({x:kontra.canvas.width/2,y:kontra.canvas.height/2-200,center:!0,text(){let e="Tap or Hold";return"gamepad"===g?I(this.x-x,this.y+1.5*x):"keyboard"!==g&&"mouse"!==g||(e="[Spacebar] "+e),e}});we.add(ke);let Se,be=te("game");be.add({render(){let e,t,n=0;l.currentTime?n=(e=Math.round(l.currentTime/l.duration*(h.length*s)))/s|0:(e=ve+ge*pe,Te.active||(pe++,e>=0&&(ye=!1,l.play()))),Se=n+c/2;for(let i=n;i<n+c&&f[i];i++){let n=f[i],a=n.x-e,r=n.y,h=kontra.canvas.height-n.height-n.offset+n.yOffset,u=n.height-n.offset+n.yOffset,d=n.height+n.offset-n.yOffset;if(a>s*(c/2-1)&&a<s*(c/2+1)){if(t=n,!Te.active&&(A(r,u)||A(h,d)||Oe.y<-50||Oe.y>kontra.canvas.height+50))return l.pause(),Ne(),void Te.show(()=>Ee.focus())}else o.fillStyle="#00a3dc",o.fillRect(a,r,n.width,u),o.fillRect(a,h,n.width,d)}if(t){let n=t.x-e-s,i=t.width+2*s,o=t.y,a=kontra.canvas.height-t.height-t.offset+t.yOffset,r=t.height-t.offset+t.yOffset,c=t.height+t.offset-t.yOffset;C(n,o,i,r,255,0,0),C(n,a,i,c,255,0,0)}for(Oe.render(e);Oe.points.length&&Oe.points[0].x-e<0-Oe.width;)Oe.points.shift();!function(){o.save(),o.fillStyle="#222",o.beginPath(),o.moveTo(0,43*S.uiScale),o.lineTo(80*S.uiScale,43*S.uiScale);for(let e=1;e<=10*S.uiScale|0;e++)o.lineTo(80*S.uiScale+2*e,43*S.uiScale-2*e),o.lineTo(80*S.uiScale+2*e+2,43*S.uiScale-2*e);o.lineTo(170*S.uiScale,23*S.uiScale);for(let e=1;e<=10*S.uiScale|0;e++)o.lineTo(170*S.uiScale+2*e,23*S.uiScale-2*e),o.lineTo(170*S.uiScale+2*e+2,23*S.uiScale-2*e);o.lineTo(192*S.uiScale,0),o.lineTo(0,0),o.closePath(),o.fill(),o.beginPath();let e=kontra.canvas.height-25*S.uiScale;o.moveTo(0,e),o.lineTo(125*S.uiScale,e);for(let t=1;t<=10*S.uiScale|0;t++)o.lineTo(125*S.uiScale+2*t,e+2*t),o.lineTo(125*S.uiScale+2*t+2,e+2*t);o.lineTo(147*S.uiScale,kontra.canvas.height),o.lineTo(0,kontra.canvas.height),o.closePath(),o.fill(),o.fillStyle="#fdfdfd";let t=Ce(l.currentTime);V(40),o.fillText(function(e){return-1!==e.indexOf(":")?e.substr(0,e.indexOf(":")):"0"}(t).padStart(3," "),5*S.uiScale,35*S.uiScale),V(18),o.fillText(":"+function(e){return-1!==e.indexOf(":")?e.substr(e.indexOf(":")+1):"0"}(t).padStart(2,"0")+"\nTIME",80*S.uiScale,17*S.uiScale),o.fillText(v.padStart(6," ")+"\nBEST",5*S.uiScale,kontra.canvas.height-5*S.uiScale),o.restore()}(),!De.active&&f[f.length-1].x-e<=kontra.canvas.width/2&&(l.pause(),Ne(),De.show(()=>Me.focus()))}});let Te=te("gameOver"),Ae=M({x:kontra.canvas.width/2,y:kontra.canvas.height/2,center:!0,text:"GAME OVER"}),Ee=L({x:kontra.canvas.width/2,prev:Ae,text:"RESTART",onDown(){ye=!0,Te.hide(),be.hide(()=>E())}}),qe=L({x:kontra.canvas.width/2,prev:Ee,text:"MAIN MENU",onDown(){be.hide(()=>{ye=!1}),Te.hide(()=>{ne.show(()=>ie.domEl.focus())})}});Te.add(Ae,Ee,qe);let De=te("win"),Le=M({x:kontra.canvas.width/2,y:kontra.canvas.height/2,center:!0,text:"SONG COMPLETED!"}),Me=L({x:kontra.canvas.width/2,prev:Le,text:"MAIN MENU",onDown(){be.hide(),De.hide(()=>{ne.show(()=>ie.domEl.focus())})}});De.add(Le,Me);let Oe=kontra.sprite({x:kontra.canvas.width/2-s/2,y:kontra.canvas.height/2-s/2,width:s,height:s,gravity:5,points:[],maxAcc:8,update(){if(kontra.keys.pressed("space")||O||m&&m.buttons[0].pressed?(this.ddy=-this.gravity,xe=!1):this.ddy=this.gravity,xe)return;this.y+=this.dy,this.dy+=this.ddy;let e=this.maxAcc;Math.sqrt(this.dy*this.dy)>e&&(this.dy=this.dy<0?-e:e)},render(e){K>=1&&!Te.active&&!De.active&&this.points.push({x:this.x+e,y:this.y+1}),C(this.x,this.y,this.width,this.height,0,163,220),N(this.points,e,0,163,220)}});var Ge;!function(){"use strict";var e=2,t=33,n=null;function i(e){return Math.sin(6.283184*e)}var o=[i,function(e){return i(e)<0?-1:1},function(e){return e%1-.5},function(e){var t=e%1*4;return t<2?t-1:3-t}];function a(e){return.00390625*Math.pow(1.059463094,e-128)}function s(n,i){setTimeout(function(){var o=new Uint8Array(n*e*2),a=o.length-2,s=function(){for(var e=new Date,n=0;a>=0;)if(o[a]=0,o[a+1]=128,a-=2,(n+=1)%1e3==0&&new Date-e>t)return void setTimeout(s,0);setTimeout(function(){i(o)},0)};setTimeout(s,0)},0)}function r(e,n,i,o,a){var s=i.fx_delay_time*o>>1,r=i.fx_delay_amt/255,c=0,l=function(){for(var i=new Date,o=0;c<n-s;){var h=4*c,f=4*(c+s),u=e[f]+(e[f+1]<<8)+(e[h+2]+(e[h+3]<<8)-32768)*r;if(e[f]=255&u,e[f+1]=u>>8&255,u=e[f+2]+(e[f+3]<<8)+(e[h]+(e[h+1]<<8)-32768)*r,e[f+2]=255&u,e[f+3]=u>>8&255,++c,(o+=1)%1e3==0&&new Date-i>t)return void setTimeout(l,0)}setTimeout(a,0)};setTimeout(l,0)}(Ge={}).AudioGenerator=function(t){this.mixBuf=t,this.waveSize=t.length/e/2},Ge.AudioGenerator.prototype.getWave=function(){var t,n,i,o,a,s,r,c=this.mixBuf,l=this.waveSize*e*2;for(s=(a=l-8)-36,o=String.fromCharCode(82,73,70,70,255&a,a>>8&255,a>>16&255,a>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&s,s>>8&255,s>>16&255,s>>24&255),t=0;t<l;){for(i="",n=0;n<256&&t<l;++n,t+=2)r=(r=4*(c[t]+(c[t+1]<<8)-32768))<-32768?-32768:r>32767?32767:r,i+=String.fromCharCode(255&r,r>>8&255);o+=i}return o},Ge.AudioGenerator.prototype.getAudio=function(){var e=this.getWave(),t=new Audio("data:audio/wav;base64,"+btoa(e));return t.preload="none",t.load(),t},Ge.AudioGenerator.prototype.getAudioBuffer=function(i){null===n&&(n=new AudioContext);var o=this.mixBuf,a=this.waveSize,s=n.createBuffer(e,this.waveSize,44100),r=s.getChannelData(0),c=s.getChannelData(1),l=0,h=function(){for(var e=new Date,n=0;l<a;){var f=4*(o[4*l]+(o[4*l+1]<<8)-32768);if(f=f<-32768?-32768:f>32767?32767:f,r[l]=f/32768,f=(f=4*(o[4*l+2]+(o[4*l+3]<<8)-32768))<-32768?-32768:f>32767?32767:f,c[l]=f/32768,l+=1,(n+=1)%1e3==0&&new Date-e>t)return void setTimeout(h,0)}setTimeout(function(){i(s)},0)};setTimeout(h,0)},Ge.SoundGenerator=function(e,t){this.instr=e,this.rowLen=t||5605,this.osc_lfo=o[e.lfo_waveform],this.osc1=o[e.osc1_waveform],this.osc2=o[e.osc2_waveform],this.attack=e.env_attack,this.sustain=e.env_sustain,this.release=e.env_release,this.panFreq=Math.pow(2,e.fx_pan_freq-8)/this.rowLen,this.lfoFreq=Math.pow(2,e.lfo_freq-8)/this.rowLen},Ge.SoundGenerator.prototype.genSound=function(e,t,n){new Date;for(var o=0,s=0,r=a(e+12*(this.instr.osc1_oct-8)+this.instr.osc1_det)*(1+8e-4*this.instr.osc1_detune),c=a(e+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),l=this.instr.fx_resonance/255,h=0,f=0,u=this.attack+this.sustain+this.release-1;u>=0;--u){var d=u+n,_=this.osc_lfo(d*this.lfoFreq)*this.instr.lfo_amt/512+.5,v=1;u<this.attack?v=u/this.attack:u>=this.attack+this.sustain&&(v-=(u-this.attack-this.sustain)/this.release);var p=r;this.instr.lfo_osc1_freq&&(p+=_),this.instr.osc1_xenv&&(p*=v*v),o+=p;var x=this.osc1(o)*this.instr.osc1_vol;p=c,this.instr.osc2_xenv&&(p*=v*v),s+=p,x+=this.osc2(s)*this.instr.osc2_vol,this.instr.noise_fader&&(x+=(2*Math.random()-1)*this.instr.noise_fader*v),x*=v/255;var m=this.instr.fx_freq;this.instr.lfo_fx_freq&&(m*=_);var g=l*(x-f)-(h+=(m=1.5*Math.sin(3.141592*m/44100))*f);switch(f+=m*g,this.instr.fx_filter){case 1:x=g;break;case 2:x=h;break;case 3:x=f;break;case 4:x=h+g}if(p=i(d*this.panFreq)*this.instr.fx_pan_amt/512+.5,x*=39*this.instr.env_master,(d*=4)+3<t.length){var y=t[d]+(t[d+1]<<8)+x*(1-p);t[d]=255&y,t[d+1]=y>>8&255,y=t[d+2]+(t[d+3]<<8)+x*p,t[d+2]=255&y,t[d+3]=y>>8&255}}},Ge.SoundGenerator.prototype.getAudioGenerator=function(e,t){var n=this.attack+this.sustain+this.release-1+32*this.rowLen,i=this;s(n,function(o){i.genSound(e,o,0),r(o,n,i.instr,i.rowLen,function(){t(new Ge.AudioGenerator(o))})})},Ge.SoundGenerator.prototype.createAudio=function(e,t){this.getAudioGenerator(e,function(e){t(e.getAudio())})},Ge.SoundGenerator.prototype.createAudioBuffer=function(e,t){this.getAudioGenerator(e,function(e){e.getAudioBuffer(t)})},Ge.MusicGenerator=function(e){this.song=e,this.waveSize=44100*e.songLen},Ge.MusicGenerator.prototype.generateTrack=function(n,i,o){var a=this;s(this.waveSize,function(s){var c=a.waveSize,l=a.waveSize*e*2,h=a.song.rowLen,f=a.song.endPattern,u=new Ge.SoundGenerator(n,h),d=0,_=0,v=0,p=function(){for(var e=new Date;;)if(32!==v){if(_===f-1)return void setTimeout(x,0);var i=n.p[_];if(i){var o=n.c[i-1].n[v];o&&u.genSound(o,s,d)}if(d+=h,v+=1,new Date-e>t)return void setTimeout(p,0)}else v=0,_+=1},x=function(){r(s,c,n,h,g)},m=0,g=function(){for(var e=new Date,n=0;m<l;){var a=i[m]+(i[m+1]<<8)+s[m]+(s[m+1]<<8)-32768;if(i[m]=255&a,i[m+1]=a>>8&255,m+=2,(n+=1)%1e3==0&&new Date-e>t)return void setTimeout(g,0)}setTimeout(o,0)};setTimeout(p,0)})},Ge.MusicGenerator.prototype.getAudioGenerator=function(e){var t=this;s(this.waveSize,function(n){var i=0,o=function(){i<t.song.songData.length?(i+=1,t.generateTrack(t.song.songData[i-1],n,o)):e(new Ge.AudioGenerator(n))};o()})},Ge.MusicGenerator.prototype.createAudio=function(e){this.getAudioGenerator(function(t){e(t.getAudio())})},Ge.MusicGenerator.prototype.createAudioBuffer=function(e){this.getAudioGenerator(function(t){t.getAudioBuffer(e)})}}();var Pe={rowLen:2242,endPattern:49,songData:[{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:255,osc1_waveform:0,osc2_oct:7,osc2_det:0,osc2_detune:0,osc2_xenv:1,osc2_vol:255,osc2_waveform:0,noise_fader:0,env_attack:50,env_sustain:150,env_release:4800,env_master:200,fx_filter:2,fx_freq:600,fx_resonance:254,fx_delay_time:0,fx_delay_amt:0,fx_pan_freq:0,fx_pan_amt:0,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[1,1,1,2,1,1,1,1,1,1,1,3,1,1,1,1,1,1,1,3,1,1,1,1,1,1,1,3,4,4,4,4,4,4,4,3,1,1,1,1,1,1,1,3,1,1,1,2],c:[{n:[128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[128,0,0,0,0,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,0,0,0,0,128,0,0,0]},{n:[128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,0,0,0,0,128,0,0,0,0,0,0,0,0,0]},{n:[128,0,0,0,0,0,128,0,0,0,0,0,128,0,0,0,0,0,0,0,128,0,128,0,0,0,0,0,0,0,0,0]}]},{osc1_oct:8,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:160,osc1_waveform:0,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:1,osc2_vol:160,osc2_waveform:0,noise_fader:210,env_attack:50,env_sustain:200,env_release:6800,env_master:160,fx_filter:4,fx_freq:11025,fx_resonance:254,fx_delay_time:6,fx_delay_amt:0,fx_pan_freq:5,fx_pan_amt:61,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:4,lfo_amt:0,lfo_waveform:0,p:[1,1,1,2,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,2,4,4,4,4,4,4,4,2,1,1,1,1,1,1,1,1,1,1,1,1],c:[{n:[0,0,0,0,0,0,0,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,128,0,0,0,0,0,0,0,0,0,0,0,128,0,0,0,128,0,0,0,128,0,128,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,0,0,0,0,0,0,128,0,0,0,0,0,0,0]}]},{osc1_oct:6,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:255,osc1_waveform:1,osc2_oct:7,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:154,osc2_waveform:1,noise_fader:0,env_attack:197,env_sustain:88,env_release:10614,env_master:45,fx_filter:2,fx_freq:4425,fx_resonance:163,fx_delay_time:8,fx_delay_amt:119,fx_pan_freq:3,fx_pan_amt:158,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:0,lfo_amt:0,lfo_waveform:0,p:[2,3,2,3,2,3,2,3,2,3,4,5,2,3,2,3,2,3,4,5,2,3,2,3,2,3,4,5,0,0,0,0,0,0,0,0,2,3,2,3,2,3,4,5,2,3,2,2],c:[{n:[0,0,0,0,0,0,0,0,128,0,0,0,0,0,0,0,0,0,0,0,133,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,135,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,135,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,143,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,142,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,133,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,133,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,0,0,0,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:144,osc1_waveform:3,osc2_oct:6,osc2_det:0,osc2_detune:9,osc2_xenv:1,osc2_vol:162,osc2_waveform:0,noise_fader:255,env_attack:663,env_sustain:0,env_release:1584,env_master:37,fx_filter:1,fx_freq:6531,fx_resonance:132,fx_delay_time:12,fx_delay_amt:9,fx_pan_freq:0,fx_pan_amt:0,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:5,lfo_amt:0,lfo_waveform:0,p:[0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,0,0],c:[{n:[0,0,0,0,0,0,0,140,0,0,0,0,0,0,0,0,0,0,0,145,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,147,0,0,0,0,0,0,0,0,0,0,0,152,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[152,0,0,0,152,0,0,0,152,0,0,0,152,0,0,0,152,0,0,0,152,0,0,0,152,0,0,0,152,0,0,0]},{n:[152,0,152,0,152,0,0,0,152,0,152,0,152,0,0,0,152,0,152,0,152,0,0,0,152,0,152,0,152,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:63,osc1_waveform:2,osc2_oct:7,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:125,osc2_waveform:0,noise_fader:0,env_attack:444,env_sustain:3706,env_release:10614,env_master:124,fx_filter:0,fx_freq:2727,fx_resonance:199,fx_delay_time:0,fx_delay_amt:125,fx_pan_freq:3,fx_pan_amt:47,lfo_osc1_freq:1,lfo_fx_freq:0,lfo_freq:14,lfo_amt:0,lfo_waveform:1,p:[0,0,0,0,2,2,2,2,2,2,3,4,2,2,2,2,2,2,3,4,2,2,2,2,2,2,3,4,2,2,2,2,2,2,3,4,2,2,2,2,2,2,3,4],c:[{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,159,0,0,0,157,0,157,0,0,0,157,0,0,0,152,0,0]},{n:[123,0,0,0,126,0,0,0,128,0,0,0,130,0,0,0,131,0,0,0,130,0,0,0,128,0,0,0,0,0,0,0]},{n:[130,0,0,0,131,0,0,0,128,0,0,0,126,0,0,0,125,0,0,0,123,0,0,0,121,0,0,0,0,0,0,0]},{n:[123,0,0,0,121,0,0,0,123,0,0,0,125,0,0,0,126,0,0,0,125,0,0,0,121,0,0,0,123,0,0,0]}]},{osc1_oct:9,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:64,osc1_waveform:1,osc2_oct:5,osc2_det:0,osc2_detune:0,osc2_xenv:0,osc2_vol:128,osc2_waveform:3,noise_fader:0,env_attack:1776,env_sustain:7105,env_release:19736,env_master:119,fx_filter:1,fx_freq:1523,fx_resonance:128,fx_delay_time:10,fx_delay_amt:39,fx_pan_freq:3,fx_pan_amt:92,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:2,lfo_amt:0,lfo_waveform:3,p:[0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,3,2,2,2,7,2,2,2,3,2,2,2,7,8,8,8,8,8,8,9,10,2,2,2,2,2,2,3,7],c:[{n:[140,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,147,0,0,0,145,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,133,0,0,0,135,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,130,0,0,0,133,0,0,0,135,0,0,0]},{n:[145,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,145,0,0,0,147,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[135,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,145,0,0,0,147,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,137,0,0,0,138,0,0,0,137,0,0,0,133,0,0,0,135,0,0,0]},{n:[135,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,145,0,0,0,147,0,0,0]},{n:[137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,142,0,0,0,145,0,0,0,147,0,0,0]},{n:[140,0,0,0,0,0,0,0,152,0,0,0,149,0,0,0,150,0,0,0,149,0,0,0,145,0,0,0,147,0,0,0]}]},{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:123,osc1_waveform:1,osc2_oct:8,osc2_det:0,osc2_detune:25,osc2_xenv:1,osc2_vol:166,osc2_waveform:0,noise_fader:0,env_attack:37768,env_sustain:19084,env_release:24610,env_master:43,fx_filter:4,fx_freq:4798,fx_resonance:167,fx_delay_time:8,fx_delay_amt:93,fx_pan_freq:6,fx_pan_amt:61,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:3,lfo_amt:67,lfo_waveform:0,p:[0,0,0,0,0,0,0,0,0,0,0,0,2,2,2,2,2,2,3,2,2,2,2,2,2,2,3,5,5,5,5,5,5,5,6,2,2,2,2,2,2,2,3],c:[{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,135,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,147,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},{n:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,149,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]}],songLen:80};function Ce(e){return(""+(100*e|0)/100).replace(".",":")}function Re(){_=kontra.store.get("js13k-2018:best")||{},v=_[w]||"0:00"}function Ne(){l.currentTime>parseInt(v.replace(":","."))&&(v=Ce(l.currentTime),_[w]=v,kontra.store.set("js13k-2018:best",_))}!async function(){B(),Re(),se.show();let e=new Ge.MusicGenerator(Pe),t=[];t.push(new Promise(t=>{e.createAudio(function(e){l=e,console.log("audio"),t()})}),new Promise(t=>{e.createAudioBuffer(function(e){buffer=e,console.log("buffer"),t()})})),Promise.all(t).then(()=>{P(),se.hide(()=>{ne.show(()=>ie.focus())})})}()}();