(()=>{var tt=()=>{},Ge="position:absolute;width:1px;height:1px;overflow:hidden;clip:rect(0,0,0,0);";function Xe(e,t){let i=t.parentNode;if(e.setAttribute("data-kontra",""),i){let s=i.querySelector("[data-kontra]:last-of-type")||t;i.insertBefore(e,s.nextSibling)}else document.body.appendChild(e)}function De(e,t){let i=e.indexOf(t);if(i!=-1)return e.splice(i,1),!0}var dt={};function Te(e,t){dt[e]=dt[e]||[],dt[e].push(t)}function Q(e,...t){(dt[e]||[]).map(i=>i(...t))}var K,ft,Zt={get(e,t){return t=="_proxy"?!0:tt}};function It(){return K}function ut(){return ft}function ne(e,{contextless:t=!1}={}){if(K=document.getElementById(e)||e||document.querySelector("canvas"),t&&(K=K||new Proxy({},Zt)),!K)throw Error("You must provide a canvas element for the game");return ft=K.getContext("2d")||new Proxy({},Zt),ft.imageSmoothingEnabled=!1,Q("init"),{canvas:K,context:ft}}var rt=class{constructor({spriteSheet:t,frames:i,frameRate:s,loop:n=!0}){this.spriteSheet=t,this.frames=i,this.frameRate=s,this.loop=n;let{width:r,height:h,margin:a=0}=t.frame;this.width=r,this.height=h,this.margin=a,this._f=0,this._a=0}clone(){return new rt(this)}reset(){this._f=0,this._a=0}update(t=1/60){if(!(!this.loop&&this._f==this.frames.length-1))for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}render({x:t,y:i,width:s=this.width,height:n=this.height,context:r=ut()}){let h=this.frames[this._f]/this.spriteSheet._f|0,a=this.frames[this._f]%this.spriteSheet._f|0;r.drawImage(this.spriteSheet.image,a*this.width+(a*2+1)*this.margin,h*this.height+(h*2+1)*this.margin,this.width,this.height,t,i,s,n)}};function Be(){return new rt(...arguments)}var He=/(jpeg|jpg|gif|png|webp)$/,$e=/(wav|mp3|ogg|aac)$/,re=/^\//,ze=/\/$/,he=new WeakMap,le="",Fe="",We="";function gt(e,t){return new URL(e,t).href}function Yt(e,t){return[e.replace(ze,""),e?t.replace(re,""):t].filter(i=>i).join("/")}function Ot(e){return e.split(".").pop()}function Rt(e){let t=e.replace("."+Ot(e),"");return t.split("/").length==2?t.replace(re,""):t}function Ue(e){return{wav:e.canPlayType('audio/wav; codecs="1"'),mp3:e.canPlayType("audio/mpeg;"),ogg:e.canPlayType('audio/ogg; codecs="vorbis"'),aac:e.canPlayType("audio/aac;")}}var v={},nt={},Z={};function Gt(){window.__k||(window.__k={dm:he,u:gt,d:Z,i:v})}function ae(e){le=e}function Ne(e){return Gt(),new Promise((t,i)=>{let s,n,r;if(s=Yt(le,e),v[s])return t(v[s]);n=new Image,n.onload=function(){r=gt(s,window.location.href),v[Rt(e)]=v[s]=v[r]=this,Q("assetLoaded",this,e),t(this)},n.onerror=function(){i("Unable to load image "+s)},n.src=s})}function qe(e){return new Promise((t,i)=>{let s=e,n,r,h,a;if(n=new Audio,r=Ue(n),e=[].concat(e).reduce((d,f)=>d||(r[Ot(f)]?f:null),0),!e)return i("cannot play any of the audio formats provided "+s);if(h=Yt(Fe,e),nt[h])return t(nt[h]);n.addEventListener("canplay",function(){a=gt(h,window.location.href),nt[Rt(e)]=nt[h]=nt[a]=this,Q("assetLoaded",this,e),t(this)}),n.onerror=function(){i("Unable to load audio "+h)},n.src=h,n.load()})}function Ke(e){Gt();let t,i;return t=Yt(We,e),Z[t]?Promise.resolve(Z[t]):fetch(t).then(s=>{if(!s.ok)throw s;return s.clone().json().catch(()=>s.text())}).then(s=>(i=gt(t,window.location.href),typeof s=="object"&&he.set(s,i),Z[Rt(e)]=Z[t]=Z[i]=s,Q("assetLoaded",s,e),s))}function j(...e){return Gt(),Promise.all(e.map(t=>{let i=Ot([].concat(t)[0]);return i.match(He)?Ne(t):i.match($e)?qe(t):Ke(t)}))}function Qe(e,t){let i=Math.sin(t),s=Math.cos(t);return{x:e.x*s-e.y*i,y:e.x*i+e.y*s}}function te(e,t,i){return Math.min(Math.max(e,i),t)}function y(e,t){return[e,t]=[e,t].map(i=>oe(i)),e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}function oe(e){let{x:t=0,y:i=0,width:s,height:n}=e.world||e;return e.mapwidth&&(s=e.mapwidth,n=e.mapheight),e.anchor&&(t-=s*e.anchor.x,i-=n*e.anchor.y),s<0&&(t+=s,s*=-1),n<0&&(i+=n,n*=-1),{x:t,y:i,width:s,height:n}}var z=class{constructor(t=0,i=0,s={}){this.x=t,this.y=i,s._c&&(this.clamp(s._a,s._b,s._d,s._e),this.x=t,this.y=i)}add(t){return new z(this.x+t.x,this.y+t.y,this)}subtract(t){return new z(this.x-t.x,this.y-t.y,this)}scale(t){return new z(this.x*t,this.y*t)}normalize(t=this.length()){return new z(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}clamp(t,i,s,n){this._c=!0,this._a=t,this._b=i,this._d=s,this._e=n}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?te(this._a,this._d,t):t}set y(t){this._y=this._c?te(this._b,this._e,t):t}};function kt(){return new z(...arguments)}var At=class{constructor(t){return this.init(t)}init(t={}){this.position=kt(),this.velocity=kt(),this.acceleration=kt(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let i=this.acceleration;t&&(i=i.scale(t)),this.velocity=this.velocity.add(i);let s=this.velocity;t&&(s=s.scale(t)),this.position=this.position.add(s),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}},ct=class extends At{init({width:t=0,height:i=0,context:s=ut(),render:n=this.draw,update:r=this.advance,children:h=[],anchor:a={x:0,y:0},opacity:d=1,rotation:f=0,scaleX:g=1,scaleY:p=1,...l}={}){this._c=[],super.init({width:t,height:i,context:s,anchor:a,opacity:d,rotation:f,scaleX:g,scaleY:p,...l}),this._di=!0,this._uw(),this.addChild(h),this._rf=n,this._uf=r}update(t){this._uf(t),this.children.map(i=>i.update&&i.update(t))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),(this.scaleX!=1||this.scaleY!=1)&&t.scale(this.scaleX,this.scaleY);let i=-this.width*this.anchor.x,s=-this.height*this.anchor.y;(i||s)&&t.translate(i,s),this.context.globalAlpha=this.opacity,this._rf(),(i||s)&&t.translate(-i,-s),this.children.map(r=>r.render&&r.render()),t.restore()}draw(){}_pc(){this._uw(),this.children.map(t=>t._pc())}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:i=0,_wo:s=1,_wr:n=0,_wsx:r=1,_wsy:h=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=s*this.opacity,this._wsx=r*this.scaleX,this._wsy=h*this.scaleY,this._wx=this._wx*r,this._wy=this._wy*h,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wr=n+this.rotation;let{x:a,y:d}=Qe({x:this._wx,y:this._wy},n);this._wx=a,this._wy=d,this._wx+=t,this._wy+=i}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map(i=>{this.children.push(i),i.parent=this,i._pc=i._pc||tt,i._pc()})}removeChild(...t){t.flat().map(i=>{De(this.children,i)&&(i.parent=null,i._pc())})}get opacity(){return this._opa}set opacity(t){this._opa=t,this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,i=t){this.scaleX=t,this.scaleY=i}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}};var T=class extends ct{init({image:t,width:i=t?t.width:void 0,height:s=t?t.height:void 0,...n}={}){super.init({image:t,width:i,height:s,...n})}get animations(){return this._a}set animations(t){let i,s;this._a={};for(i in t)this._a[i]=t[i].clone(),s=s||this._a[i];this.currentAnimation=s,this.width=this.width||s.width,this.height=this.height||s.height}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){super.advance(t),this.currentAnimation&&this.currentAnimation.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}};var je=/(\d+)(\w+)/;function Je(e){let t=e.match(je),i=+t[1],s=t[2];return{size:i,unit:s,computed:i}}var Pt=class extends ct{init({text:t="",textAlign:i="",lineHeight:s=1,font:n=ut().font,...r}={}){t=""+t,super.init({text:t,textAlign:i,lineHeight:s,font:n,...r}),this._p()}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=Je(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context;if(t.font=this.font,!this._s.length&&this._fw){let i=this.text.split(" "),s=0,n=2;for(;n<=i.length;n++){let r=i.slice(s,n).join(" ");t.measureText(r).width>this._fw&&(this._s.push(i.slice(s,n-1).join(" ")),s=n-1)}this._s.push(i.slice(s,n).join(" "))}if(!this._s.length&&this.text.includes(`
`)){let i=0;this.text.split(`
`).map(s=>{this._s.push(s),i=Math.max(i,t.measureText(s).width)}),this._w=this._fw||i}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,i=this.textAlign,s=this.context;i=this.textAlign||(s.canvas.dir=="rtl"?"right":"left"),t=i=="right"?this.width:i=="center"?this.width/2|0:0,this._s.map((n,r)=>{s.textBaseline="top",s.textAlign=i,s.fillStyle=this.color,s.font=this.font,s.fillText(n,t,this._fs*this.lineHeight*r)})}};function ht(){return new Pt(...arguments)}var et=new WeakMap,Mt={},Xt={},de={0:"left",1:"middle",2:"right"};function fe(e=It()){return et.get(e)}function Ve(e,t){let{x:i,y:s,width:n,height:r}=oe(e);do i-=e.sx||0,s-=e.sy||0;while(e=e.parent);let h=t.x-Math.max(i,Math.min(t.x,i+n)),a=t.y-Math.max(s,Math.min(t.y,s+r));return h*h+a*a<t.radius*t.radius}function Ze(e){let t=e._lf.length?e._lf:e._cf;for(let i=t.length-1;i>=0;i--){let s=t[i];if(s.collidesWithPointer?s.collidesWithPointer(e):Ve(s,e))return s}}function Y(e,t){return parseFloat(e.getPropertyValue(t))||0}function ti(e){let{canvas:t,_s:i}=e,s=t.getBoundingClientRect(),n=i.transform!="none"?i.transform.replace("matrix(","").split(","):[1,1,1,1],r=parseFloat(n[0]),h=parseFloat(n[3]),a=(Y(i,"border-left-width")+Y(i,"border-right-width"))*r,d=(Y(i,"border-top-width")+Y(i,"border-bottom-width"))*h,f=(Y(i,"padding-left")+Y(i,"padding-right"))*r,g=(Y(i,"padding-top")+Y(i,"padding-bottom"))*h;return{scaleX:(s.width-a-f)/t.width,scaleY:(s.height-d-g)/t.height,offsetX:s.left+(Y(i,"border-left-width")+Y(i,"padding-left"))*r,offsetY:s.top+(Y(i,"border-top-width")+Y(i,"padding-top"))*h}}function ee(e){let t=e.button!=null?de[e.button]:"left";Xt[t]=!0,Dt(e,"onDown")}function St(e){let t=e.button!=null?de[e.button]:"left";Xt[t]=!1,Dt(e,"onUp")}function ie(e){Dt(e,"onOver")}function ei(e){let t=et.get(e.target);t._oo=null,Xt={}}function se(e,t,i){let s=Ze(e);s&&s[t]&&s[t](i),Mt[t]&&Mt[t](i,s),t=="onOver"&&(s!=e._oo&&e._oo&&e._oo.onOut&&e._oo.onOut(i),e._oo=s)}function Dt(e,t){e.preventDefault();let i=e.target,s=et.get(i),{scaleX:n,scaleY:r,offsetX:h,offsetY:a}=ti(s);e.type.includes("touch")?(Array.from(e.touches).map(({clientX:f,clientY:g,identifier:p})=>{let l=s.touches[p];l||(l=s.touches[p]={start:{x:(f-h)/n,y:(g-a)/r}},s.touches.length++),l.changed=!1}),Array.from(e.changedTouches).map(({clientX:f,clientY:g,identifier:p})=>{let l=s.touches[p];l.changed=!0,l.x=s.x=(f-h)/n,l.y=s.y=(g-a)/r,se(s,t,e),Q("touchChanged",e,s.touches),t=="onUp"&&(delete s.touches[p],s.touches.length--,s.touches.length||Q("touchEnd"))})):(s.x=(e.clientX-h)/n,s.y=(e.clientY-a)/r,se(s,t,e))}function ce({radius:e=5,canvas:t=It()}={}){let i=et.get(t);if(!i){let s=window.getComputedStyle(t);i={x:0,y:0,radius:e,touches:{length:0},canvas:t,_cf:[],_lf:[],_o:[],_oo:null,_s:s},et.set(t,i)}return t.addEventListener("mousedown",ee),t.addEventListener("touchstart",ee),t.addEventListener("mouseup",St),t.addEventListener("touchend",St),t.addEventListener("touchcancel",St),t.addEventListener("blur",ei),t.addEventListener("mousemove",ie),t.addEventListener("touchmove",ie),i._t||(i._t=!0,Te("tick",()=>{i._lf.length=0,i._cf.map(s=>{i._lf.push(s)}),i._cf.length=0})),i}function ii(...e){e.flat().map(t=>{let i=t.context?t.context.canvas:It(),s=et.get(i);if(!s)throw new ReferenceError("Pointer events not initialized for the objects canvas");t._r||(t._r=t.render,t.render=function(){s._cf.push(this),this._r()},s._o.push(t))})}function ue(e,t){let i=e[0].toUpperCase()+e.substr(1);Mt["on"+i]=t}var Et=class extends T{init({padX:t=0,padY:i=0,text:s,disabled:n=!1,onDown:r,onUp:h,...a}={}){super.init({padX:t,padY:i,...a}),this.textNode=ht({...s,context:this.context}),this.width||(this.width=this.textNode.width,this.height=this.textNode.height),ii(this),this.addChild(this.textNode),this._od=r||tt,this._ou=h||tt;let d=this._dn=document.createElement("button");d.style=Ge,d.textContent=this.text,n&&this.disable(),d.addEventListener("focus",()=>this.focus()),d.addEventListener("blur",()=>this.blur()),d.addEventListener("keydown",f=>this._kd(f)),d.addEventListener("keyup",f=>this._ku(f)),Xe(d,this.context.canvas),this._uw(),this._p()}get text(){return this.textNode.text}set text(t){this._d=!0,this.textNode.text=t}destroy(){this._dn.remove()}_p(){this.text!=this._dn.textContent&&(this._dn.textContent=this.text),this.textNode._p();let t=this.textNode.width+this.padX*2,i=this.textNode.height+this.padY*2;this.width=Math.max(t,this.width),this.height=Math.max(i,this.height),this._uw()}render(){this._d&&this._p(),super.render()}enable(){this.disabled=this._dn.disabled=!1,this.onEnable()}disable(){this.disabled=this._dn.disabled=!0,this.onDisable()}focus(){this.disabled||(this.focused=!0,document.activeElement!=this._dn&&this._dn.focus(),this.onFocus())}blur(){this.focused=!1,document.activeElement==this._dn&&this._dn.blur(),this.onBlur()}onOver(){this.disabled||(this.hovered=!0)}onOut(){this.hovered=!1}onEnable(){}onDisable(){}onFocus(){}onBlur(){}onDown(){this.disabled||(this.pressed=!0,this._od())}onUp(){this.disabled||(this.pressed=!1,this._ou())}_kd(t){(t.code=="Enter"||t.code=="Space")&&this.onDown()}_ku(t){(t.code=="Enter"||t.code=="Space")&&this.onUp()}};function L(){return new Et(...arguments)}function si(e){let t=e.canvas;e.clearRect(0,0,t.width,t.height)}function ge({fps:e=60,clearCanvas:t=!0,update:i=tt,render:s,context:n=ut(),blur:r=!1}={}){if(!s)throw Error("You must provide a render() function");let h=0,a=1e3/e,d=1/e,f=t?si:tt,g,p,l,c,k,b=!0;r||(window.addEventListener("focus",()=>{b=!0}),window.addEventListener("blur",()=>{b=!1}));function _(){if(p=requestAnimationFrame(_),!!b&&(l=performance.now(),c=l-g,g=l,!(c>1e3))){for(Q("tick"),h+=c;h>=a;)k.update(d),h-=a;f(n),k.render()}}return k={update:i,render:s,isStopped:!0,start(){g=performance.now(),this.isStopped=!1,requestAnimationFrame(_)},stop(){this.isStopped=!0,cancelAnimationFrame(p)},_frame:_,set _last(M){g=M}},k}function ni(e){if(+e==e)return e;let t=[],i=e.split(".."),s=+i[0],n=+i[1],r=s;if(s<n)for(;r<=n;r++)t.push(r);else for(;r>=n;r--)t.push(r);return t}var Lt=class{constructor({image:t,frameWidth:i,frameHeight:s,frameMargin:n,animations:r}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:i,height:s,margin:n},this._f=t.width/i|0,this.createAnimations(r)}createAnimations(t){let i,s;for(s in t){let{frames:n,frameRate:r,loop:h}=t[s];if(i=[],n==null)throw Error("Animation "+s+" must provide a frames property");[].concat(n).map(a=>{i=i.concat(ni(a))}),this.animations[s]=Be({spriteSheet:this,frames:i,frameRate:r,loop:h})}}};function Tt(){return new Lt(...arguments)}var ri=function(){let e=function(l){return Math.sin(l*6.283184)},t=function(l){return 2*(l%1)-1},i=function(l){return l%1<.5?1:-1},s=function(l){let c=l%1*4;return c<2?c-1:3-c},n=function(l){return .003959503758*2**((l-128)/12)},r=function(l,c,k){let b=h[l.i[0]],_=l.i[1],M=l.i[3]/32,S=h[l.i[4]],O=l.i[5],m=l.i[8]/32,w=l.i[9],A=l.i[10]*l.i[10]*4,N=l.i[11]*l.i[11]*4,V=l.i[12]*l.i[12]*4,u=1/V,G=-l.i[13]/16,I=l.i[14],Qt=k*2**(2-l.i[15]),X=new Int32Array(A+N+V),x=0,D=0,E,$,P,ot,R,st,q;for(E=0,$=0;E<A+N+V;E++,$++)$>=0&&(I=I>>8|(I&255)<<4,$-=Qt,st=n(c+(I&15)+l.i[2]-128),q=n(c+(I&15)+l.i[6]-128)*(1+8e-4*l.i[7])),P=1,E<A?P=E/A:E>=A+N&&(P=(E-A-N)*u,P=(1-P)*3**(G*P)),x+=st*P**M,R=b(x)*_,D+=q*P**m,R+=S(D)*O,w&&(R+=(2*Math.random()-1)*w),X[E]=80*R*P|0;return X},h=[e,i,t,s],a,d,f,g,p;this.init=function(l){a=l,d=l.endPattern,f=0,g=l.rowLen*l.patternLen*(d+1)*2,p=new Int32Array(g)},this.generate=function(){let l,c,k,b,_,M,S,O,m,w,A,N,V,u,G,I,Qt,X=new Int32Array(g),x=a.songData[f],D=a.rowLen,E=a.patternLen,$=0,P=0,ot,R,st=!1,q=[];if(x)for(b=0;b<=d;++b)for(O=x.p[b],_=0;_<E;++_){let bt=O?x.c[O-1].f[_]:0;bt&&(x.i[bt-1]=x.c[O-1].f[_+E]||0,bt<17&&(q=[]));let Ae=h[x.i[16]],Pe=x.i[17]/512,Me=2**(x.i[18]-9)/D,Ee=x.i[19],jt=x.i[20],Le=x.i[21]*43.23529*3.141592/44100,Ie=1-x.i[22]/255,vt=x.i[23]*1e-5,Ye=x.i[24]/32,Oe=x.i[25]/512,Re=6.283184*2**(x.i[26]-9)/D,Jt=x.i[27]/255,Ct=x.i[28]*D&-2;for(G=(b*E+_)*D,M=0;M<4;++M)if(S=O?x.c[O-1].n[_+M*E]:0,S){q[S]||(q[S]=r(x,S,D));let Vt=q[S];for(c=0,l=G*2;c<Vt.length;c++,l+=2)X[l]+=Vt[c]}for(c=0;c<D;c++)m=(G+c)*2,u=X[m],u||st?(I=Le,Ee&&(I*=Ae(Me*m)*Pe+.5),I=1.5*Math.sin(I),$+=I*P,ot=Ie*(u-P)-$,P+=I*ot,u=jt==3?P:jt==1?ot:$,vt&&(u*=vt,u=u<1?u>-1?e(u*.25):-1:1,u/=vt),u*=Ye,st=u*u>1e-5,w=Math.sin(Re*m)*Oe+.5,R=u*(1-w),u*=w):R=0,m>=Ct&&(R+=X[m-Ct+1]*Jt,u+=X[m-Ct]*Jt),X[m]=R|0,X[m+1]=u|0,p[m]+=R|0,p[m+1]+=u|0}return f++,f/a.numChannels},this.createWave=function(){let l=44,c=l+g*2-8,k=c-36,b=new Uint8Array(l+g*2);b.set([82,73,70,70,c&255,c>>8&255,c>>16&255,c>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,k&255,k>>8&255,k>>16&255,k>>24&255]);for(let _=0,M=l;_<g;++_){let S=p[_];S=S<-32767?-32767:S>32767?32767:S,b[M++]=S&255,b[M++]=S>>8&255}return b}},we=ri;var hi={songData:[{i:[1,75,140,0,1,105,128,3,0,0,92,0,95,0,0,0,3,31,5,1,2,124,135,11,32,150,3,157,6],p:[1],c:[{n:[135,137,139,144,144,135,137,139,142,142,135,137,139,140,140,135,137,139,135],f:[]}]}],rowLen:11025,patternLen:21,endPattern:0,numChannels:1},li={songData:[{i:[3,255,128,0,0,255,140,0,0,127,2,2,47,61,0,0,0,96,3,1,3,94,79,0,32,84,2,12,4],p:[1],c:[{n:[147],f:[]}]}],rowLen:11025,patternLen:1,endPattern:0,numChannels:1},ai={songData:[{i:[0,255,116,79,0,255,116,0,83,0,4,6,69,52,0,0,0,0,0,0,2,14,0,0,32,0,0,0,0],p:[1],c:[{n:[147],f:[]}]}],rowLen:11025,patternLen:1,endPattern:0,numChannels:1},pe=[hi,li,ai];function H(e){return Math.floor(Math.random()*e)}function wt(e){let t,i=0,s=Math.random();for(t in e)if(i+=e[t],s<=i)return t}ne();ce();ae("assets/img/");var xt=!1,lt=0,Bt=[],xe=[0,0,0],W=[],ye=[!1,!1,!1],me=[];for(let e=0;e<3;e++){let t=new we;Bt.push(t),t.init(pe[e]);let i=document.createElement("audio");W.push(i);let s=setInterval(function(){ye[e]&&(xe[e]=Bt[e].createWave(),W[e].src=URL.createObjectURL(new Blob([xe[e]],{type:"audio/wav"})),e==0&&(W[e].loop=!0),clearInterval(me[e])),ye[e]=Bt[e].generate()>=1});me.push(s)}var B=parseInt(localStorage.getItem("dsSh"))?parseInt(localStorage.getItem("dsSh")):0,Ht=parseInt(localStorage.getItem("dsHS"))?parseInt(localStorage.getItem("dsHS")):0,oi=ht({text:"Death RIPper",font:"52px Aerial",color:"white",x:320,y:100,anchor:{x:.5,y:.5},textAlign:"center"}),di=L({x:320,y:500,anchor:{x:.5,y:.5},text:{text:"Start Game",color:"white",font:"24px sans-serif",anchor:{x:.5,y:.5}},padX:20,padY:10,render(){this.pressed?(W[0].play(),Se(),lt=1,this.pressed=!1):this.hovered?this.textNode.color="red":this.textNode.color="white"}}),fi=L({x:300,y:150,anchor:{x:.5,y:.5},text:{text:"You are sent back to hell",color:"red",font:"30px sans-serif",anchor:{x:.5,y:.5}},padX:20,padY:10}),$t=ht({font:"18px Aerial",color:"white",x:300,y:250,anchor:{x:.5,y:.5},textAlign:"center"}),ve=L({x:300,y:350,anchor:{x:.5,y:.5},padX:10,padY:10,onDown(){lt=0,W[0].pause(),W[0].currentTime=0}});j("re.png").then(()=>{ve.image=v.re});var F=L({x:5,y:5,height:20,width:300,color:"Aqua"}),pt=0,Ce=[];j("sh.png").then(()=>{for(let e=0;e<6;e++){let t=L({x:5+e*20,y:30,height:15,width:15,image:v.sh});Ce.push(t)}});var ci=L({x:0,y:50,height:480,width:640,color:"#008000"});j("tr.png").then(()=>{});var _e;j("de.png").then(()=>{_e=Tt({image:v.de,frameWidth:20,frameHeight:20,animations:{strike:{frames:"0..2",frameRate:9}}}),o=new mt({x:400,y:320,width:20,height:20,anchor:{x:.5,y:.5},shield:Math.floor(B/20)+1,point:0,animations:_e.animations})});var ke;j("hu.png").then(()=>{ke=Tt({image:v.hu,frameWidth:20,frameHeight:20,animations:{die:{frames:"0..2",frameRate:60}}})});var Ft=class extends T{constructor(t){t.color="#CD853F",super(t)}draw(){this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height)}},it=[],ui=[[0,50,10,295],[0,50,215,10],[0,520,10,295],[0,315,215,10],[345,50,10,295],[630,50,215,10],[345,520,10,295],[630,315,215,10]];ui.forEach(e=>{it.push(new Ft({x:e[0],y:e[1],height:e[2],width:e[3]}))});var Wt=class extends T{constructor(t){super(t)}},at=[],gi=[[295,50,10,50,320,490],[0,265,50,10,600,290],[295,520,10,50,320,90],[630,265,50,10,40,290]];gi.forEach(e=>{at.push(new Wt({x:e[0],y:e[1],height:e[2],width:e[3],sx:e[4],sy:e[5]}))});var mt=class extends T{constructor(t){super(t)}draw(){super.draw()}},o,_t;j("po.png").then(()=>{_t=new mt({x:400,y:320,width:10,height:10,anchor:{x:.5,y:.5},image:v.po})});var Ut=class extends T{constructor(t){switch(super(t),H(2)){case 0:let s={x:-t.width/2,y:-t.height/2},n={x:t.width/2-25,y:-t.height/2},r={x:-t.width/2,y:t.height/2-25},h=null,a=null,d=H(4);switch(d){case 0:h=s,a=r;break;case 1:h=n,a=r;break;case 2:h=n,a=s;break;case 3:h=s,a=s;break;default:}for(let w=0;w<5;w++){let A=L({x:h.x,y:h.y+w*25,width:25,height:25,image:v.tr});this.addChild(A)}for(let w=0;w<5;w++){let A=L({x:a.x+w*25,y:a.y,width:25,height:25,image:v.tr});this.addChild(A)}let f={x:t.x-t.width/2,y:t.y-t.height/2},g={x:t.x+t.width/2,y:t.y-t.height/2},p={x:t.x-t.width/2,y:t.y+t.height/2},l={x:t.x+t.width/2,y:t.y+t.height/2};switch(d){case 0:this.lines=[{pt1:f,pt2:p},{pt1:p,pt2:l}];break;case 1:this.lines=[{pt1:g,pt2:l},{pt1:p,pt2:l}];break;case 2:this.lines=[{pt1:f,pt2:g},{pt1:g,pt2:l}];break;case 3:this.lines=[{pt1:f,pt2:p},{pt1:f,pt2:g}];break;default:}break;case 1:let c={x:-t.width/2,y:-25/2},k={x:-25/2,y:-t.width/2};for(let w=0;w<5;w++){let A=L({x:c.x+w*25,y:c.y,width:25,height:25,image:v.tr});this.addChild(A)}for(let w=0;w<5;w++){let A=L({x:k.x,y:k.y+w*25,width:25,height:25,image:v.tr});this.addChild(A)}let b={x:t.x,y:t.y-t.height/2},_={x:t.x,y:t.y+t.height/2},M={x:t.x-t.width/2,y:t.y},S={x:t.x+t.width/2,y:t.y};this.lines=[{pt1:b,pt2:_},{pt1:M,pt2:S}];break;case 2:let O=H(2),m=H(5);switch(O){case 0:for(let u=0;u<5;u++){let G=L({x:-t.width/2+u*25,y:(m-2)*25-12.5,width:25,height:25,image:v.tr});this.addChild(G)}let w={x:t.x-t.width/2,y:t.y+(m-2)*25},A={x:t.x+t.width/2,y:t.y+(m-2)*25};this.lines=[{pt1:w,pt2:A}];break;case 1:for(let u=0;u<5;u++){let G=L({x:(m-2)*25-12.5,y:-t.height/2+u*25,width:25,height:25,image:v.tr});this.addChild(G)}let N={x:t.x+(m-2)*25,y:t.y-t.height/2},V={x:t.x+(m-2)*25,y:t.y+t.height/2};this.lines=[{pt1:N,pt2:V}];break;default:}break;default:}}cast(t,i){for(let s of this.lines){let n=s.pt1.x,r=s.pt1.y,h=s.pt2.x,a=s.pt2.y,d=t.x,f=t.y,g=i.x,p=i.y,l=(n-h)*(f-p)-(r-a)*(d-g);if(l==0)continue;let c=((n-d)*(f-p)-(r-f)*(d-g))/l,k=-((n-h)*(r-f)-(r-a)*(n-d))/l;if(c>0&&c<1&&k>0)return!0}return!1}},Nt=class extends T{constructor(t){super(t),this.lifeCount=(10+H(5))*60,this.state=3,this.repelX=0,this.repelY=0,this.lCounter=ht({font:"18px Aerial",color:"white",x:0,y:0,anchor:{x:.5,y:.5},textAlign:"center"})}check(){let t=!1;for(let i of U)if(i.cast(this,o)&&i.cast(o,this)){t=!0;break}if(!t){let[i,s]=yt(this,o,1),n=!1;for(let h of U)if(this.x-=i,y(this,h)){for(let a of h.children)if(y(this,a)){this.x+=i,n=!0;break}}else this.x+=i;let r=!1;for(let h of U)if(this.y-=s,y(this,h)){for(let a of h.children)if(y(this,a)){this.y+=s,r=!0;break}}else this.y+=s;for(let h of it)if(this.x-=i,y(this,h)){this.x+=i,n=!0;break}else this.x+=i;for(let h of it)if(this.y-=s,y(this,h)){this.y+=s,r=!0;break}else this.y+=s;for(let h of at)if(this.x-=i,y(this,h)){this.x+=i,n=!0;break}else this.x+=i;for(let h of at)if(this.y-=s,y(this,h)){this.y+=s,r=!0;break}else this.y+=s;for(let h of C)if(h.indx!=this.indx)if(this.x-=i,y(this,h)&&h.state!=0){this.x+=i,n=!0;break}else this.x+=i;for(let h of C)if(h.indx!=this.indx)if(this.y-=s,y(this,h)&&h.state!=0){this.y+=s,r=!0;break}else this.y+=s;n||(this.x-=i),r||(this.y-=s)}}stateChange(){if(Math.floor(this.lifeCount/60)<11)return Math.floor(this.lifeCount/60)<1?(this.state==1&&this.update(),this.state=0):this.state==3&&(this.update(),this.state=1),!0}chase(){if(this.repelX||this.repelY){let t={x:this.repelX,y:this.repelY},[i,s]=yt(this,t,2);this.x!=this.repelX||this.y!=this.repelY?(this.x+=i,this.y+=s):(this.repelX=0,this.repelY=0)}else{let t={x:o.x,y:o.y},[i,s]=yt(this,t,2);(this.x!=t.x||this.y!=t.y)&&(this.x+=i,this.y+=s),y(this,o)&&(o.shield?(W[1].play(),this.repelX=this.x-i*40,this.repelY=this.y-s*40,o.shield-=1,o.shield==0&&(o.opacity=.4)):xt=!0)}}draw(){super.draw()}},wi=[[100,150],[115,440],[335,165],[320,390],[540,140],[515,350]],U=[],C=[];function Se(){U.length=0,C.length=0,wi.forEach(i=>{U.push(new Ut({x:i[0],y:i[1],width:125,height:125,anchor:{x:.5,y:.5}}))});let e={x:0,y:0},t=0;for(;t<5;){let i={x:0,y:0},s=!0;if(e.x<=320){let r=Math.floor((620-e.x)/4);i.x=e.x+wt({4:.4,3:.3,2:.2,1:.1})*r-H(r)}else{let r=Math.floor((e.x-20)/4);i.x=e.x-wt({4:.4,3:.3,2:.2,1:.1})*r+H(r)}if(e.y<=265){let r=Math.floor((460-e.y)/4);i.y=e.y+wt({4:.4,3:.3,2:.2,1:.1})*r-H(r)}else{let r=Math.floor((e.y-20)/4);i.y=e.y-wt({4:.4,3:.3,2:.2,1:.1})*r+H(r)}e.x*=t,e.y*=t,e.x+=i.x,e.y+=i.y,e.x/=t+1,e.y/=t+1;let n=new Nt({x:i.x,y:i.y+50,width:20,height:20,anchor:{x:.5,y:.5},indx:t,animations:ke.animations});if(y(n,o)&&(s=!1),s){for(let r of U)if(y(n,r)){for(let h of r.children)if(y(n,h)){s=!1;break}}}if(s){for(let r of it)if(y(n,r)){s=!1;break}}if(s){for(let r of at)if(y(n,r)){s=!1;break}}s&&(C.push(n),t+=1)}}function yt(e,t,i){let s=t.y-e.y;s>0?s=s>=i?i:s:s<0&&(s=s<=i?-i:s);let n=t.x-e.x;return n>0?n=n>=i?i:n:n<0&&(n=n<=i?-i:n),[Math.floor(n),Math.floor(s)]}var qt=0,Kt=0,J=!1;ue("down",function(e,t){lt==1&&(J=!0,qt=be.x,Kt=be.y,_t.x=qt,_t.y=Kt)});var zt=0,be=fe(),pi=ge({update:function(){if(J){let e={x:qt,y:Kt},[t,i]=yt(o,e,3),s=!1;o.x!=e.x||o.y!=e.y?(o.x+=t,o.y+=i):J=!1;for(let n of U)if(y(o,n)){for(let r of n.children)if(y(o,r)){s=!0;break}}for(let n of it)if(y(o,n)){s=!0;break}for(let n=C.length-1;n>=0;n--)y(o,C[n])&&(C[n].stateChange()?C[n].state&&(W[2].play(),o.point+=1,o.point%5==0&&(F.width+=200,F.width=F.width>600?600:F.width),C.splice(n,1),zt=20):s=!0);xt&&(lt=2,C.length=0,o.x=400,o.y=320,(B<100||!B)&&(B+o.point<100?B=B+o.point:B=100,localStorage.setItem("dsSh",B)),o.shield=Math.floor(B/20)+1,o.opacity=1,$t.text="Score: "+String(o.point),(o.point>Ht||!Ht)&&($t.text+="   New High Score!",Ht=o.point,localStorage.setItem("dsHS",o.point)),o.point=0,F.width=300,pt=0,xt=!1,J=!1);for(let n of at)if(y(o,n)){o.x=n.sx,o.y=n.sy,J=!1,Se();break}s&&(J=!1,o.x-=t,o.y-=i)}zt&&(o.update(),zt-=1);for(let e=C.length-1;e>=0;e--)C[e].stateChange()&&(C[e].state?C[e].check():C[e].chase()),C[e].lifeCount>0&&(C[e].lifeCount-=1)},render:function(){switch(lt){case 0:oi.render(),di.render();break;case 1:ci.render(),pt<=2?pt++:(pt=0,F.width>0?F.width-=1:xt=!0),F.render();for(let e=1;e<=o.shield;e++)Ce[e-1].render();for(let e of it)e.render();for(let e of U)e.render();for(let e of C)e.render(),e.state<3&&(e.lCounter.x=e.x+15,e.lCounter.y=e.y-15,e.lCounter.text=Math.floor(e.lifeCount/60),e.lCounter.render());J&&_t.render(),o.render();break;case 2:fi.render(),ve.render(),$t.render();break;default:}}});pi.start();})();
