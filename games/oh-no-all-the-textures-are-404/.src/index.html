<!DOCTYPE html><meta charset=utf8><meta name=viewport content="width=912, user-scalable=no"><title>Oh No!</title><style>body,html{overflow:hidden;margin:0;background-color:#444;width:100vw;height:100vh;display:grid;place-items:center;perspective:1000px}main{position:absolute;top:0;left:200px}canvas,main{width:512px;height:788px}#ui{position:absolute;top:0;bottom:0;display:flex;flex-flow:column nowrap;justify-content:space-between;filter:blur(1px);color:#eee;text-shadow:#222 -2px -2px 2px,#222 2px -2px 2px,#222 2px 2px 2px,#222 -2px 2px 2px;font:36px Arial,sans-serif;font-weight:700}.screen{position:relative;overflow:hidden}.screen,.view{width:512px;height:384px}.view{box-sizing:border-box;top:0;display:grid;place-items:center}.toast,.view{position:absolute}.toast{animation:slide-from-bottom 1s ease-in-out both,fade-out 1s ease-in-out both}.alert{background:#fc6;border:10px solid #c60;display:grid;place-items:center;width:384px;min-height:192px;border-radius:20px;padding:20px;text-align:center}p{margin:0 0 20px}.button{background:#393;border:5px solid #060;border-radius:10px;padding:10px}.button:hover{background:#6c0}#overlay{top:0;bottom:0;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAABmJLR0QA/wD/AP+gvaeTAAAAGUlEQVQI12NgQAWKTGgCDBgCjAwMDIrIAgAJYABIO2lURgAAAABJRU5ErkJggg==);pointer-events:none}#hinge,#overlay{position:absolute;width:512px}#hinge{top:384px;height:20px;background:linear-gradient(0deg,#000,#888 60%,#999 70%,#999 72%,#000)}div[onclick]{cursor:pointer}img{display:none}@keyframes slide-from-left{0%{left:-1000px}25%{left:50px}90%{left:-50px}to{left:-1000px}}@keyframes slide-from-right{0%{right:-1000px}25%{right:30px}90%{right:-30px}to{right:-1000px}}@keyframes slide-from-bottom{0%{top:1000px}75%{top:-30px}to{top:0}}@keyframes fade-out{0%{background:transparent}75%{background:transparent}to{background:rgba(0,0,0,.2)}}@keyframes title{0%{transform:scale(0)}to{transform:scale(1)}}@keyframes gone{0%{transform:rotate(5turn) scale(0)}to{transform:rotate(0deg) scale(1)}}</style><img src=data:image/gif;base64,R0lGODdhCAAIAKIAAAAAAFMLBZRSAP///wAAAAAAAAAAAAAAACH5BAkAAAQALAAAAAAIAAgAAAMQGLos7kqEJ6d8EUKrM2ZgAgA7 id=krates><img src="data:image/gif;base64,R0lGODdhCAAIAKIAAAAAAABmAACZMwDMM////wAAAAAAAAAAACH5BAkAAAUALAAAAAAIAAgAAAMSKCEjHs0puaa8tkVcW6jPtUQJADs=" id=grass><img src="data:image/gif;base64,R0lGODdhCAAIAJEAAAAAAP8A/////wAAACH5BAkAAAMALAAAAAAIAAgAAAIMTIBgl8gNo5wvrWYKADs=" id=shadow><img src="data:image/gif;base64,R0lGODdhEAAQALMAAAAAAP8A/3NIAI1cAJ9zALmMAAClAM+5du7iwf///wAAAAAAAAAAAAAAAAAAAAAAACH5BAkAAAoALAAAAAAQABAAAAQ/MMgZBCE056t7xZ5GHOFGBkYZgCiVbpLxxpoQzyjO5ZkOzq8ZASFAyCbH46UwEARTsmhSiou2jh5pDtvjUgMRADs=" id=palm><img src="data:image/gif;base64,R0lGODdhCAAIAMQAAAAAAABxvQB2wwB5xQCF1ACGzwCJ1wCL2AC2/AC6/V/U+2PW/WzX/13Y/mfY/2ra/v///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAkAABEALAAAAAAIAAgAAAUtYJMIDGEYQSAIg9GuhkAMwrk+gYE8Tm2Yg8MhsBCMHgrEamFIuAyFE2ElWIQAADs=" id=water><img src="data:image/gif;base64,R0lGODdhCAAIAMQAAAAAAAwBARUCAhsCAjAGAjsKA0UNBGcXCXMbCnoeDIYiD4sjD48kEJwpE6IrFK0uFsk3G9U7Hts9H+xCIvJEI/RlJvV0KfmbLvyzMv28M/7BNP/JNv/mO//rPP///wAAACH5BAkAAB8ALAAAAAAIAAgAAAU1oKJMFBY4GeVcDXZRmaJFTfFQFpBuSQFgHAoEoBEQEgcMYLAAdAyIhyKQyEgYDIymYnFgJCEAOw==" id=lava><img src="data:image/gif;base64,R0lGODdhBAAEAJEAAAAAAGdnZ////wAAACH5BAkAAAMALAAAAAAEAAQAAAIFjHxnuAUAOw==" id=404><img src="data:image/gif;base64,R0lGODdhCAAIAKIAAAAAAEpaWlppdm59j////wAAAAAAAAAAACH5BAkAAAUALAAAAAAIAAgAAAMRODrSws/J2cK6LlRdqeATlwAAOw==" id=stone><img src="data:image/gif;base64,R0lGODdhCAAIAMQAAAAAAAwBARUCAhsCAjAGAjsKA0UNBGcXCXMbCnoeDIYiD4sjD48kEJwpE6IrFK0uFsk3G9U7Hts9H+xCIvJEI/RlJvV0KfmbLvyzMv28M/7BNP/JNv/mO//rPP///wAAACH5BAkAAB8ALAAAAAAIAAgAAAU1oKJMFBY4GeVcDXZRmaJFTfFQFpBuSQFgHAoEoBEQEgcMYLAAdAyIhyKQyEgYDIymYnFgJCEAOw==" id=lava><img src=data:image/gif;base64,R0lGODdhEAAQAOYAAAAAAP8A/1AWBlEZBkceDkgeDkMkDSlQCjRnEMltKTNvEslwKjh3FM53ME57Hjt9FrN9RdN+Nj2AGNSCOj+DF9uEPUSHGFiJHp2JN6OLS0ONGdORR0eTG0iTG9KTX8OUW8qVPcaYX9aZU0+bJ1GbLcebYcicY/meM9ufVu2fLU2gHtugV+KgWveiMu6jLlGlIO+mMO+qMfCqMc+rMVqwIvKyNvO2OvO4Plu6JfS7QP29Vf2/Wf3BXP7FYWbHKf7KZ/7KaMXPvtjPrsDauM/b0bnipOPl5fT3+v///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAkAAEkALAAAAAAQABAAAAe+gAEWCiQYHUE4Fg8nDyAODxIqQiNFFy9EMzIPND4bFAwUAkdGAxAZHC4wCBonQywGBxM6QBMQHhUuLhMnLSIoBRMBswEQHwEpLgG8Ab8BATtAxMYyNsotzAXOPD/SATE51swE2tzFATc34SjjAT3lxjXpyyvs7sQh3tXLzQnuCRAlEsSwsYDXghUFGkRwV8vEBBc2drWYgDCYPQgmAsiooS5bu2gAA9jguM9jD5D4XJC8ts5ZAJDckilzhsJZIAA7 id=fence><img src="data:image/gif;base64,R0lGODdhEAAQAMQAAAAAAP8A/3s/IX1BI5JVM612QUmXHkmYHlClIFWrIVyuIlexI1m1JFu6JGS8Jmu/J27AJ3bBKH/DKYHEKY3HK5PKLJrMLI/eMP///wAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAkAABkALAAAAAAQABAAAAV1YCCOAzGcw6iKQmCusGuZVLpaEjI0jdkUE4lltCguDgbC5MAsSkQJo3Q6EUkmjKx2mw1cFbxw4/FoZBVBhWO95pHJDclV4i7XyRG5nM1+PyAKFVUSFX6GQRUiFISCh1cXKhMVFRIUi0FPMItXQRMUMSuWnyohADs=" id=bush><img src="data:image/gif;base64,R0lGODdhCAAIAKIAAAAAAP/Uef/7AP/8ef///wAAAAAAAAAAACH5BAkAAAUALAAAAAAIAAgAAAMSKCEjHs0puaa8tkVcW6jPtUQJADs=" id=sand><img src="data:image/gif;base64,R0lGODdhAQABAJEAAAAAAP///wAAAAAAACH5BAkAAAIALAAAAAABAAEAAAICTAEAOw==" id=plain><div style=position:relative;width:912px;height:788px;background:#222;border-radius:5px;transform:rotateX(5deg)> <div style=position:absolute;top:600px;left:25px;width:150px;height:30px;background:#000></div> <div style=position:absolute;top:600px;left:25px;width:150px;height:30px;background:#000;transform:rotate(90deg)></div> <main> <canvas width=512 height=788></canvas> <div id=ui></div> <div id=overlay></div> <div id=hinge></div> </main> <div style="position:absolute;top:525px;right:75px;width:50px;height:50px;border-radius:40px;background:#000;color:#fff;font:24px Arial"> <span style=position:relative;top:11px;left:17px>Y</span> </div> <div style="position:absolute;top:575px;right:125px;width:50px;height:50px;border-radius:40px;background:#000;color:#fff;font:24px Arial"> <span style=position:relative;top:11px;left:17px>X</span> </div> <div style="position:absolute;top:625px;right:75px;width:50px;height:50px;border-radius:40px;background:#000;color:#fff;font:24px Arial"> <span style=position:relative;top:11px;left:17px>B</span> </div> <div style="position:absolute;top:575px;right:25px;width:50px;height:50px;border-radius:40px;background:#000;color:#fff;font:24px Arial"> <span style=position:relative;top:11px;left:17px>A</span> </div>
</div><script>!function(){function t(t,n){let e=t.createTexture();return t.bindTexture(3553,e),t.texImage2D(3553,0,6408,6408,5121,n),t.texParameteri(3553,10240,9728),t.texParameteri(3553,10241,9728),e}function n(t,n,e){let i=t.createTexture();return t.bindTexture(3553,i),t.texImage2D(3553,0,6408,n,e,0,6408,5121,null),t.texParameteri(3553,10241,9729),i}function e(t,n,e){let i=t.createRenderbuffer();return t.bindRenderbuffer(t.RENDERBUFFER,i),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,n,e),i}function i(t,n,e){let i=n[0],a=n[1],r=n[2],o=n[3],s=n[4],l=n[5],f=n[6],c=n[7],u=n[8],d=n[9],h=n[10],m=n[11],v=n[12],T=n[13],g=n[14],p=n[15],y=e[0],b=e[1],x=e[2],M=e[3];return t[0]=y*i+b*s+x*u+M*v,t[1]=y*a+b*l+x*d+M*T,t[2]=y*r+b*f+x*h+M*g,t[3]=y*o+b*c+x*m+M*p,y=e[4],b=e[5],x=e[6],M=e[7],t[4]=y*i+b*s+x*u+M*v,t[5]=y*a+b*l+x*d+M*T,t[6]=y*r+b*f+x*h+M*g,t[7]=y*o+b*c+x*m+M*p,y=e[8],b=e[9],x=e[10],M=e[11],t[8]=y*i+b*s+x*u+M*v,t[9]=y*a+b*l+x*d+M*T,t[10]=y*r+b*f+x*h+M*g,t[11]=y*o+b*c+x*m+M*p,y=e[12],b=e[13],x=e[14],M=e[15],t[12]=y*i+b*s+x*u+M*v,t[13]=y*a+b*l+x*d+M*T,t[14]=y*r+b*f+x*h+M*g,t[15]=y*o+b*c+x*m+M*p,t}function a(t,n){return t[0]=n[12],t[1]=n[13],t[2]=n[14],t}function r(t,n){let e=function(t,n){let e=n[4],i=n[5],a=n[6],r=n[8],o=n[9],s=n[10];return t[0]=Math.hypot(n[0],n[1],n[2]),t[1]=Math.hypot(e,i,a),t[2]=Math.hypot(r,o,s),t}([0,0,0],n),i=1/e[0],a=1/e[1],r=1/e[2],o=n[0]*i,s=n[1]*a,l=n[2]*r,f=n[4]*i,c=n[5]*a,u=n[6]*r,d=n[8]*i,h=n[9]*a,m=n[10]*r,v=o+c+m,T=0;return v>0?(T=2*Math.sqrt(v+1),t[3]=.25*T,t[0]=(u-h)/T,t[1]=(d-l)/T,t[2]=(s-f)/T):o>c&&o>m?(T=2*Math.sqrt(1+o-c-m),t[3]=(u-h)/T,t[0]=.25*T,t[1]=(s+f)/T,t[2]=(d+l)/T):c>m?(T=2*Math.sqrt(1+c-o-m),t[3]=(d-l)/T,t[0]=(s+f)/T,t[1]=.25*T,t[2]=(u+h)/T):(T=2*Math.sqrt(1+m-o-c),t[3]=(s-f)/T,t[0]=(d+l)/T,t[1]=(u+h)/T,t[2]=.25*T),t}function o(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t}function s(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2],t}function l(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t}function f(t,n){return t[0]=-n[0],t[1]=-n[1],t[2]=-n[2],t}function c(t,n){let e=n[0],i=n[1],a=n[2],r=e*e+i*i+a*a;return r>0&&(r=1/Math.sqrt(r)),t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t}function u(t){return Math.hypot(t[0],t[1],t[2])}function d(t,n,e,i){let a=n[0],r=n[1],o=n[2];return t[0]=a+i*(e[0]-a),t[1]=r+i*(e[1]-r),t[2]=o+i*(e[2]-o),t}function h(t,n,e,i,a){return t[0]=n,t[1]=e,t[2]=i,t[3]=a,t}function m(t,n,e){let i=n[0],a=n[1],r=n[2],o=n[3],s=e[0],l=e[1],f=e[2],c=e[3];return t[0]=i*c+o*s+a*f-r*l,t[1]=a*c+o*l+r*s-i*f,t[2]=r*c+o*f+i*l-a*s,t[3]=o*c-i*s-a*l-r*f,t}function v(t,n,e,i){let a=.5*Math.PI/180;e*=a,i*=a;let r=Math.sin(n*=a),o=Math.cos(n),s=Math.sin(e),l=Math.cos(e),f=Math.sin(i),c=Math.cos(i);return t[0]=r*l*c-o*s*f,t[1]=o*s*c+r*l*f,t[2]=o*l*f-r*s*c,t[3]=o*l*c+r*s*f,t}function T(t,n,e,i){let a,r,o,s,l,f=n[0],c=n[1],u=n[2],d=n[3],h=e[0],m=e[1],v=e[2],T=e[3];return r=f*h+c*m+u*v+d*T,r<0&&(r=-r,h=-h,m=-m,v=-v,T=-T),1-r>1e-6?(a=Math.acos(r),o=Math.sin(a),s=Math.sin((1-i)*a)/o,l=Math.sin(i*a)/o):(s=1-i,l=i),t[0]=s*f+l*h,t[1]=s*c+l*m,t[2]=s*u+l*v,t[3]=s*d+l*T,t}function g(t){return(n,e)=>{n.i.t[e]|=256,n.i.o[e]={s:t}}}function p(t,n){for(let e=0;e<t.t.length;e++)if(256&t.t[e]&&t.o[e].s===n)return e;return-2}function*y(t,n,e){t.t[n]&e&&(yield n);for(let i of t.u[n].l)yield*y(t,i,e)}function b(t){let n=performance.now(),e=i=>{t.h((i-n)/1e3),t.m(),n=i,Ft=requestAnimationFrame(e)};x(),e(n)}function x(){cancelAnimationFrame(Ft)}function M(t,{v:n,T:e,g:i,p:a=[],l:r=[]}){let o=function(t,n=0){for(let e=0;e<1e4;e++)if(!t.t[e])return t.t[e]=n,e;return-1}(t.i);!function(t=[0,0,0],n=[0,0,0,1],e=[1,1,1]){return(i,a)=>{i.i.t[a]|=2048,i.i.u[a]={i:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],M:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],v:t,T:n,g:e,l:[],R:!0}}}(n,e,i)(t,o);for(let n of a)n(t,o);let s=t.i.u[o];for(let n of r){let e=M(t,n);t.i.u[e].U=o,s.l.push(e)}return o}function R(t,n){if(2048&t.t[n])for(let e of t.u[n].l)R(t,e);t.t[n]=0}function U(t){return t<.5?2*t*t:1-(-2*t+2)**2/2}function w(t){return(n,e)=>{let i={};for(let n in t){let{S:e,k:a=7}=t[n],r=e[e.length-1].C;i[n]={S:e.map(t=>({...t})),k:a,F:r,A:0}}n.i.t[e]|=1,n.i.D[e]={N:i,K:i.idle}}}function S(t,n,e,i=[1,1,1]){return(a,r)=>{a.i.t[r]|=8,a.i.P[r]={Entity:r,$:!0,B:t,I:n,t:e,V:i,O:[0,0,0],L:[0,0,0],Y:[0,0,0],_:[0,0,0],W:[]}}}function k(t,n,e,i=[1,1,1,1],a=1,r,o){return(s,l)=>{if(!At.has(n)){let e=s.j.createVertexArrayOES();s.j.bindVertexArrayOES(e),s.q.bindBuffer(34962,n.H),s.q.enableVertexAttribArray(t.Z.X),s.q.vertexAttribPointer(t.Z.X,3,5126,!1,0,0),s.q.bindBuffer(34962,n.G),s.q.enableVertexAttribArray(t.Z.J),s.q.vertexAttribPointer(t.Z.J,2,5126,!1,0,0),s.q.bindBuffer(34962,n.tt),s.q.enableVertexAttribArray(t.Z.nt),s.q.vertexAttribPointer(t.Z.nt,3,5126,!1,0,0),s.q.bindBuffer(34963,n.et),s.j.bindVertexArrayOES(null),At.set(n,e)}s.i.t[l]|=512,s.i.it[l]={at:t,rt:n,ot:2304,st:At.get(n),lt:e,ft:i,ct:a,ut:o,dt:r}}}function C(t=!0){return(n,e)=>{n.i.t[e]|=1024,n.i.ht[e]={B:t,vt:0,Tt:0}}}function F(t,n=!1){return n=!!t.gt.has("krates")||n,{p:[S(!0,4,7),C(!0)],l:[{p:[k(t.pt,t.yt,t.bt[n?"krates":"404"],[1,1,1,1],1,"krates"),w({idle:{S:[{C:0,T:[0,0,0,1]}]},float:{S:[{C:0,v:[0,0,0],xt:U},{C:1,v:[0,-.2,0],xt:U}]}})]},{p:[S(!0,2,0,[.1,1,.1]),C(!1)]}]}}function A(t,n=!1){return n=!!t.gt.has("bush")||n,{p:[S(!1,2,0,[1,1,1]),C(!1)],l:[{g:[.5,.5,.5],T:v([0,0,0,0],-15,0,0),p:[k(t.pt,t.Mt,t.bt[n?"bush":"404"],[1,1,1,1],1,"bush")]},{T:v([0,0,0,0],-90,0,0),g:[.3,.1,1],v:[0,-.49,.2],p:[k(t.pt,t.Mt,t.bt.shadow)]}]}}function D(t){return(n,e)=>{n.i.t[e]|=4096,n.i.Rt[e]={Ut:t}}}function N(t,n=!1){return n=!!t.gt.has("fence")||n,{p:[S(!1,2,0,[1,1,1]),C(!1)],l:[{g:[.5,.5,.5],T:v([0,0,0,0],-15,0,0),p:[k(t.pt,t.Mt,t.bt[n?"fence":"404"],[1,1,1,1],1,"fence")]},{T:v([0,0,0,0],-90,0,0),g:[.3,.1,1],v:[0,-.49,.2],p:[k(t.pt,t.Mt,t.bt.shadow)]}]}}function K(t,n=!1){return n=!!t.gt.has("grass")||n,{p:[S(!1,2,0,[.6,1,.6]),C(!1),k(t.pt,t.yt,t.bt[n?"grass":"404"],[1,1,1,1],1,"grass")]}}function P(t,n=!1){return n=!!t.gt.has("lava")||n,{p:[k(t.pt,t.yt,t.bt[n?"lava":"404"],[1,1,1,1],1,"lava",()=>Math.sin(Date.now()/200)/10)],l:[]}}function $(t,n=!1){return n=!!t.gt.has("palm")||n,{p:[S(!1,2,0),C(!1)],l:[{v:[0,.5,0],g:[.5,1,.5],T:v([0,0,0,0],-15,0,0),p:[k(t.pt,t.Mt,t.bt[n?"palm":"404"],[1,1,1,1],1,"palm")]},{T:v([0,0,0,0],-90,0,0),g:[.3,.1,1],v:[0,-.49,.2],p:[k(t.pt,t.Mt,t.bt.shadow)]}]}}function B(t){return(n,e)=>{n.i.t[e]|=2,n.i.wt[e]={St:t,A:0}}}function I(t,n,e){return{p:[(t,n)=>{t.i.t[n]|=16},(i=n,a=e,(t,n)=>{t.i.t[n]|=8192,t.i.kt[n]={Ct:i,Ft:a,At:i,Dt:a,Nt:0}}),(t,n)=>{t.i.t[n]|=128,t.i.Kt[n]={Pt:10,$t:3,Bt:[],It:[],Vt:[]}},S(!0,1,2),C(!0),g("camera anchor"),B()],l:[{l:[{v:[.7,.6,0],g:[.2,.6,.5],p:[k(t.pt,t.yt,t.bt.plain,Dt),w({idle:{S:[{C:0,T:v([0,0,0,0],0,0,0)},{C:1,T:v([0,0,0,0],0,0,45)}]},walk:{S:[{C:0,T:v([0,0,0,0],45,0,0)},{C:.2,T:v([0,0,0,0],-45,0,0)}]},float:{S:[{C:0,v:[.7,.8,0],T:v([0,0,0,0],0,0,180)},{C:.2,v:[.7,.8,0],T:v([0,0,0,0],0,0,45)}],k:2}})]},{v:[-.7,.6,0],g:[.2,.6,.5],p:[k(t.pt,t.yt,t.bt.plain,Dt),w({idle:{S:[{C:0,T:v([0,0,0,0],0,0,-45)},{C:1,T:v([0,0,0,0],0,0,0)}]},walk:{S:[{C:0,T:v([0,0,0,0],-45,0,0)},{C:.2,T:v([0,0,0,0],45,0,0)}]},float:{k:2,S:[{C:0,v:[-.7,.8,0],T:v([0,0,0,0],0,0,-180)},{C:.2,v:[-.7,.7,0],T:v([0,0,0,0],0,0,-45)}]}})]},{v:[0,.6,0],l:[{v:[0,.3,0],l:[{v:[0,.3,-.3],g:[.4,.8,.25],p:[k(t.pt,t.yt,t.bt.plain,Dt)]},{v:[0,.2,-.05],g:[.4,.8,.25],p:[k(t.pt,t.yt,t.bt.plain,Dt)]},{v:[0,.1,.2],g:[.4,.8,.25],p:[k(t.pt,t.yt,t.bt.plain,Dt)]},{v:[0,0,.44],g:[.4,.8,.25],p:[k(t.pt,t.yt,t.bt.plain,Dt)]}]},{v:[-.175,.3,-.2],g:[.25,.3,1],p:[k(t.pt,t.yt,t.bt.plain,Kt)]},{v:[.175,.3,-.2],g:[.25,.3,1],p:[k(t.pt,t.yt,t.bt.plain,Kt)]},{v:[0,-.2,-.5],g:[.25,.5,.8],T:v([0,0,0,0],45,0,0),p:[k(t.pt,t.yt,t.bt.plain,Pt)]},{p:[k(t.pt,t.yt,t.bt.plain,Nt)]}],p:[w({idle:{S:[{C:0,T:v([0,0,0,0],0,0,-10),xt:U},{C:1,T:v([0,0,0,0],0,0,10),xt:U}]},walk:{S:[{C:0,T:v([0,0,0,0],0,-15,0)},{C:.2,T:v([0,0,0,0],0,15,0)}]},float:{k:2,S:[{C:0,T:v([0,0,0,0],-15,0,0)},{C:.2,T:v([0,0,0,0],15,0,0)}]}})]}]},{T:v([0,0,0,0],-90,0,0),g:[.6,.6,1],v:[0,-.49,0],p:[k(t.pt,t.Mt,t.bt.shadow),w({idle:{S:[{C:0,v:[0,0,0]}]},walk:{S:[{C:0,T:v([0,0,0,0],-90,-15,0)},{C:.2,T:v([0,0,0,0],-90,15,0)}]}})]}]};var i,a}function V(t,n=!1){return n=!!t.gt.has("sand")||n,{p:[S(!1,2,0,[.6,1,.6]),C(!1),k(t.pt,t.yt,t.bt[n?"sand":"404"],[1,1,1,1],1,"sand")]}}function E(t,n=!1){return n=!!t.gt.has("shell")||n,{p:[S(!1,2,0,[1,1,1]),C(!1)],l:[{g:[.5,.5,.5],T:v([0,0,0,0],-15,0,0),p:[k(t.pt,t.Mt,t.bt[n?"shell":"404"],[1,1,1,1],1,"shell")]},{T:v([0,0,0,0],-90,0,0),g:[.3,.1,1],v:[0,-.49,.2],p:[k(t.pt,t.Mt,t.bt.shadow)]}]}}function O(t){$t=198706*t}function z(){return $t=16807*$t%2147483647,($t-1)/2147483646}function L(t=0,n=1){return~~(z()*(n-t+1)+t)}function Y(t=0,n=1){return z()*(n-t)+t}function _(t){return t[L(0,t.length-1)]}function W(t,n=!1){n=!!t.gt.has("stone")||n;let e=L(4,10),i=[];for(let a=0;a<e;a++)i.push({g:[.5,.5+Y(),.5],v:[.5-Y(),-.5,.5-Y()],p:[k(t.pt,t.yt,t.bt[n?"stone":"404"],[1,1,1,1],1,"stone")]});return{p:[S(!1,2,0,[.6,1,.6]),C(!1)],l:i}}function j(t,n=!1){return n=!!t.gt.has("stone")||n,{p:[S(!1,2,0,[.6,1,.6]),C(!1),k(t.pt,t.yt,t.bt[n?"stone":"404"],[1,1,1,1],1,"stone")],l:[]}}function q(t,n){return{g:[.5,.5,.5],p:[S(!0,8,1,[.2,.2,.2]),D(2),w({idle:{S:[{C:0,T:[0,0,0,1]},{C:1,T:[0,1,0,0]},{C:2,T:[0,0,0,-1]}],k:2}})],l:[{v:[0,1,0],T:v([0,0,0,0],45,45,0),p:[k(t.pt,t.yt,t.bt[n])]},{T:v([0,0,0,0],-90,45,0),g:[.7,.7,1],v:[0,-.4,0],p:[k(t.pt,t.Mt,t.bt.shadow)]}]}}function H(t,n,e,i,a){let r=0===t.Et;switch(n){case 12:e[1]-=.3,M(t,{...P(t,r),v:e});case 1:M(t,{p:[S(!1,0,5,[.1,99,.1]),D(7)],v:e});break;case 2:M(t,{...K(t,r),v:e});break;case 3:M(t,{...F(t,r),v:e});break;case 6:M(t,1===e[1]?{...W(t,r),v:e}:{...j(t,r),v:e});break;case 4:M(t,{...I(t,i,a),v:e,T:[0,1,0,0]});break;case 5:let n=Bt[t.Et].texture,o=M(t,{...q(t,n),v:e});t.Ot[o]=n;break;case 8:M(t,{...A(t,r),v:e});break;case 7:M(t,{...V(t,r),v:e});break;case 11:M(t,{...$(t,r),v:e});break;case 9:M(t,{...N(t,r),v:e});break;case 10:M(t,{...E(t,r),v:e})}}function Q(t,n=.1){return(e,i)=>{e.i.t[i]|=64,e.i.zt[i]={Lt:t,Yt:n}}}function X(t,n){return{p:[Q(p(t.i,"camera anchor"),.03)],l:[{T:v([0,0,0,0],-45,180,0),l:[{v:[0,n,8],p:[(1,.1,1e3,e=t.bt._t,i=t.Wt._t,a=[.2,.5,.9,1],(t,n)=>{let r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];!function(t,n,e,i,a){let r,o=1/Math.tan(.5);t[0]=o/1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,r=1/-999.9,t[10]=1/-999.9*1000.1,t[14]=1/-999.9*200}(r);let o=t.q.createFramebuffer();t.q.bindFramebuffer(36160,o),t.q.framebufferTexture2D(36160,36064,3553,e,0),t.q.framebufferRenderbuffer(36160,36096,36161,i),t.i.t[n]|=4,t.i.jt[n]={Lt:o,qt:e,Ht:i,Qt:1,Xt:.1,Zt:1e3,Gt:r,Jt:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],tn:a}})]}]}]};var e,i,a}function Z(){let t=_(It);return{nn:[{en:[5,"bandpass",6,0,!1,!1,0,0,[["sine",5,4,5,8,8,!1,!1,8,8,8]]],in:[_([48,50,52,53,55,57,59,60])]},{en:[3,"bandpass",12,0,!1,!1,8,8,[["triangle",7,1,4,6,8,!1,!1,8,8,8]]],in:_(It)}],an:120,rn:60*(t.length+L(4,8))/120/4,on:Z}}function G(t){return{v:[0,10,0],T:v([0,0,0,0],-90,0,0),p:[B(Z()),(n=t.sn/1.333,e=t.bt.ln,i=t.Wt.ln,a=[255,255,255,1],(t,r)=>{let o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];!function(t,n,e,i,a,r,o){let s=1/(a-e),l=1/(i-n);t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1/-999.9*2,t[11]=0,t[12]=(a+e)*s,t[13]=(n+i)*l,t[14]=1/-999.9*1000.1,t[15]=1}(o,n,n,-n,-n);let s=t.q.createFramebuffer();t.q.bindFramebuffer(36160,s),t.q.framebufferTexture2D(36160,36064,3553,e,0),t.q.framebufferRenderbuffer(36160,36096,36161,i),t.i.t[r]|=4,t.i.jt[r]={Lt:s,qt:e,Ht:i,Qt:n,Xt:.1,Zt:1e3,Gt:o,Jt:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],tn:a}})]};var n,e,i,a}function J(t,n=t.gt.has("water")){return{T:[-.707,0,0,.707],l:[{v:[0,0,-1.2],p:[S(!1,2,5,[100*t.sn,1,100*t.sn]),C(!1),D(8)]},{g:[t.sn/2+1,t.sn/2+1,1],v:[0,0,.03],p:[k(t.pt,t.Mt,t.bt[n?"water":"404"],[1,1,1,1],t.sn/2+1,"water",()=>Math.sin(Date.now()/200)/10)]},{g:[t.sn/2+2,t.sn/2+2,1],v:[0,0,.02],p:[k(t.pt,t.Mt,t.bt[n?"water":"404"],[1,1,1,1],t.sn/2+2,"water",()=>Math.sin(Date.now()/400)/10)]},{g:[10*t.sn,10*t.sn,1],v:[0,0,.01],p:[k(t.pt,t.Mt,t.bt[n?"water":"404"],[1,1,1,1],10*t.sn,"water",()=>Math.sin(Date.now()/500)/20)]}]}}function tt(t,n){t.fn=tt,t.Et=n,t.cn=!1,t.un=!1,t.i=new Vt,t.dn=[],O(Date.now());let e=Bt[t.Et];t.sn=Math.sqrt(e.terrain.length),M(t,J(t));for(let n=0;n<t.sn;n++)for(let i=0;i<t.sn;i++){let a=n*t.sn+i,r=i-t.sn/2+.5,o=n-t.sn/2+.5;H(t,e.terrain[a],[r,0,o],i,n),H(t,e.props[a],[r,1,o],i,n)}M(t,{...X(t,0),v:[Y(-20,20),Y(10,20),Y(10,20)],T:v([0,0,0,0],0,Y(-135,-225),0)}),M(t,{T:[0,1,0,0],...G(t)})}function nt(){return{nn:[{en:[5,"bandpass",6,0,!1,!1,0,0,[["sine",5,4,5,8,8,!1,!1,8,8,8]]],in:[_([48,50,52,53,55,57,59,60]),,,,,,,,,,,,,,,,_([48,50,52,53,55,57,59,60]),,,,,,,,,,,,]},{en:[3,"bandpass",12,0,!1,!1,8,8,[["triangle",7,1,4,6,8,!1,!1,8,8,8]]],in:[64,,64,,,,64,,,,60,,64,,,,67,,,,,,,,55,,,,]}],an:120,rn:10,on:nt}}function et(t){t.fn=et,t.i=new Vt,t.dn=[],t.sn=11,O(Date.now());let n=Bt[0];t.sn=Math.sqrt(n.terrain.length),M(t,J(t,!0));for(let e=0;e<t.sn;e++)for(let i=0;i<t.sn;i++){let a=e*t.sn+i,r=i-t.sn/2+.5,o=e-t.sn/2+.5;H(t,n.terrain[a],[r,0,o]),H(t,n.props[a],[r,1,o])}M(t,{v:[0,2,0],p:[B(nt()),g("camera anchor"),w({idle:{S:[{C:0,T:[0,-1,0,0]},{C:30,T:[0,0,0,1]},{C:60,T:[0,1,0,0]}],k:2}})]}),M(t,{...X(t,-2),v:[Y(-20,20),Y(10,20),Y(10,20)],T:v([0,0,0,0],0,Y(-135,-225),0)})}function it(t,n,e){switch(n){case 1:for(let n=0;n<t.i.t.length;n++)512&t.i.t[n]&&(t.i.it[n].lt=t.bt[404]);break;case 2:{let[n]=e,i=t.Ot[n];for(let n=0;n<t.i.t.length;n++)if(512&t.i.t[n]){let e=t.i.it[n];e.dt===i&&setTimeout(()=>{e.lt=t.bt[i],t.gt.add(i)},~~(Math.random()*n*10))}R(t.i,n),t.cn=!0;break}case 3:requestAnimationFrame(()=>et(t));break;case 4:{let n=e;n<Bt.length&&requestAnimationFrame(()=>tt(t,n));break}case 5:{let[n]=e;const i=512;for(let n=0;n<t.i.t.length;n++)if((t.i.t[n]&i)===i){let e=t.i.u[n];"door"===t.i.it[n].dt&&(e.T=v([0,0,0,1],0,90,0),e.v[0]-=.5,e.R=!0,t.i.t[n]&=-9,t.i.t[n]&=-1025)}R(t.i,n);break}case 6:{let n=p(t.i,"destination"),[i,a]=e,r=t.i.kt[a],o=t.i.kt[n],s=t.i.u[a],l=t.i.u[n];if(n&&(s.v=l.v.slice(),s.R=!0,r)){let{Ct:t,Ft:n}=o;r.Ct=r.At=t,r.Ft=r.Dt=n}break}case 7:{let[n,i]=e;t.i.t[i]&=-17,setTimeout(()=>R(t.i,n));break}case 8:{let[n,i]=e;if(4&t.i.P[i].I){let n=t.i.u[i];n.v[1]=-.05,n.R=!0,t.i.ht[i].B=!1}else t.cn||(t.un=!0);for(let n of y(t.i,i,1))t.i.D[n].Rt="float";break}}}function at(t,n,e){let i=t.createProgram();return t.attachShader(i,rt(t,35633,n)),t.attachShader(i,rt(t,35632,e)),t.linkProgram(i),i}function rt(t,n,e){let i=t.createShader(n);return t.shaderSource(i,e),t.compileShader(i),i}function ot(t,n,e){let i=t.i.u[n],a=t.i.D[n];if(a.Rt){let t=a.N[a.Rt];t&&t!==a.K&&(0===a.K.A?a.K=t:1&a.K.k&&(a.K.A=0,a.K=t)),a.Rt=void 0}let r=null,o=null;for(let t of a.K.S){if(a.K.A<t.C){o=t;break}r=t}if(r&&o){let t=(a.K.A-r.C)/(o.C-r.C);o.xt&&(t=o.xt(t)),r.v&&o.v&&(d(i.v,r.v,o.v,t),i.R=!0),r.T&&o.T&&(T(i.T,r.T,o.T,t),i.R=!0),r.g&&o.g&&(d(i.g,r.g,o.g,t),i.R=!0)}let s=a.K.A+e;if(s<a.K.F)a.K.A=s;else{if(a.K.A=0,4&a.K.k)for(let t of a.K.S.reverse())t.C=a.K.F-t.C;2&a.K.k||(a.K=a.N.idle)}}function st(t,n,e,i){let a,r,o=t.currentTime+i,s=0,l=t.createGain();if(l.gain.value=(n[0]/9)**3,n[5]&&(r=t.createOscillator(),r.type=n[5],r.frequency.value=(n[7]/3)**3,a=t.createGain(),a.gain.value=(n[6]+3)**3,r.connect(a)),n[1]){let e=t.createBiquadFilter();e.type=n[1],e.frequency.value=2**n[2],e.Q.value=n[3]**1.5,a&&n[4]&&a.connect(e.detune),l.connect(e),e.connect(t.destination)}else l.connect(t.destination);for(let i of n[8]){let n=t.createGain();n.connect(l);let r=(i[1]/9)**3,f=(i[2]/9)**3,c=(i[3]/9)**3,u=f+c+(i[4]/6)**3;if(n.gain.setValueAtTime(0,o),n.gain.linearRampToValueAtTime(r,o+f),n.gain.setValueAtTime(r,o+f+c),n.gain.exponentialRampToValueAtTime(1e-5,o+u),i[0]){let r=t.createOscillator();r.type=i[0],r.connect(n),r.detune.value=3*(i[5]-7.5)**3,a&&i[6]&&a.connect(r.detune);let s=440*2**((e-69)/12);if(i[7]){let t=(i[8]/9)**3,n=(i[9]/9)**3,e=(i[10]/6)**3;r.frequency.linearRampToValueAtTime(0,o),r.frequency.linearRampToValueAtTime(s,o+t),r.frequency.setValueAtTime(s,o+t+n),r.frequency.exponentialRampToValueAtTime(1e-5,o+t+n+e)}else r.frequency.setValueAtTime(s,o);r.start(o),r.stop(o+u)}else{let e=t.createBufferSource();e.buffer=lt(t),e.loop=!0,e.connect(n),e.start(o),e.stop(o+u)}u>s&&(s=u)}r&&(r.start(o),r.stop(o+s))}function lt(t){if(!Et){Et=t.createBuffer(1,2*t.sampleRate,t.sampleRate);let n=Et.getChannelData(0);for(let t=0;t<n.length;t++)n[t]=2*Math.random()-1}return Et}function ft(t,n,e){var i;let a=t.i.wt[n];if(a.Rt&&(!a.K||a.A>a.K.rn)){let n=60/(a.Rt.an||120)/4;for(let e of a.Rt.nn)for(let i=0;i<e.in.length;i++){let a=e.in[i];a&&st(t.Audio,e.en,a,i*n)}a.K=a.Rt,a.A=0}else a.A+=e;a.Rt=(null===(i=a.St)||void 0===i?void 0:i.on)?a.St.on():a.St}function ct(t,n,e){i(e.Jt,e.Gt,t.i.u[n].M)}function ut(t,n){a(n.Y,t),l(n._,n.V,.5),s(n.O,n.Y,n._),o(n.L,n.Y,n._)}function dt(t,n){let e=t.Y[0]-n.Y[0],i=t._[0]+n._[0]-Math.abs(e),a=t.Y[1]-n.Y[1],r=t._[1]+n._[1]-Math.abs(a),o=t.Y[2]-n.Y[2],s=t._[2]+n._[2]-Math.abs(o);return i<r&&i<s?[i*Math.sign(e),0,0]:r<s?[0,r*Math.sign(a),0]:[0,0,s*Math.sign(o)]}function ht(t,n,e){for(let r=0;r<e;r++){let e=n[r],o=t.t&e.I,s=e.t&t.I;if((o||s)&&(i=t).O[0]<(a=e).L[0]&&i.L[0]>a.O[0]&&i.O[1]<a.L[1]&&i.L[1]>a.O[1]&&i.O[2]<a.L[2]&&i.L[2]>a.O[2]){let n=dt(t,e);o&&t.W.push({hn:e.Entity,mn:n}),s&&e.W.push({hn:t.Entity,mn:f([0,0,0],n)})}}var i,a}function mt(t,n){if(t.cn&&-1===t.vn.Enter&&it(t,4,t.Et+1),!(8192&t.i.t[n])){let e=t.i.kt[n],i=t.i.wt[n];t.Tn.ArrowUp?(e.Dt-=1,t.i.t[n]|=8192,i.Rt=Ht):t.Tn.ArrowLeft?(e.At-=1,t.i.t[n]|=8192,i.Rt=Ht):t.Tn.ArrowDown?(e.Dt+=1,t.i.t[n]|=8192,i.Rt=Ht):t.Tn.ArrowRight&&(e.At+=1,t.i.t[n]|=8192,i.Rt=Ht)}}function vt(t,n,e){let i=t.i.u[n],r=t.i.Kt[n];for(let e of y(t.i,n,1)){let n=t.i.D[e];n.Rt||(n.Rt=r.Bt.length?"walk":"idle")}if(r.Bt.length){let t=r.Bt.reduce(Tt),n=Math.min(1,u(t));!function(t,n,e){let i=function(t,n,e){let i=n[0],a=n[1],r=n[2],o=e[3]*i+e[7]*a+e[11]*r+e[15];return o=o||1,t[0]=(e[0]*i+e[4]*a+e[8]*r+e[12])/o,t[1]=(e[1]*i+e[5]*a+e[9]*r+e[13])/o,t[2]=(e[2]*i+e[6]*a+e[10]*r+e[14])/o,t}([0,0,0],n,e);s(t,i,a([0,0,0],e))}(t,t,i.i),c(t,t),l(t,t,n*r.Pt*e),o(i.v,i.v,t),i.R=!0,r.Bt=[]}if(r.It.length){let t=r.It.reduce(gt);T(t,Qt,t,Math.min(1,r.$t/Math.PI*e)),m(i.T,t,i.T),i.R=!0,r.It=[]}if(r.Vt.length){let t=r.Vt.reduce(gt);T(t,Qt,t,Math.min(1,r.$t/Math.PI*e)),m(i.T,i.T,t),i.R=!0,r.Vt=[]}}function Tt(t,n){return o(t,t,n)}function gt(t,n){return m(t,t,n)}function pt(t,n,e){let i=t.i.u[n],a=t.i.P[n],r=t.i.ht[n];if(r.B){i.R=!0,i.v[1]+=r.vt*e,r.vt+=-9*e,r.vt+=r.Tt*e,r.Tt=0;for(let n=0;n<a.W.length;n++){let e=a.W[n];1024&t.i.t[e.hn]&&(o(i.v,i.v,e.mn),(e.mn[1]>0&&r.vt<0||e.mn[1]<0&&r.vt>0)&&(r.vt=0))}}}function yt(t,n){t.q.bindFramebuffer(36160,n.Lt),t.q.viewport(0,0,128,128),t.q.clearColor(...n.tn),t.q.clear(16640),function(t,n,e){let i=null,a=null;for(let r=0;r<t.i.t.length;r++)if(2560==(2560&t.i.t[r])){let o=t.i.u[r],s=t.i.it[r];if(s.lt===e)continue;s.at!==i&&(i=s.at,bt(t,s.at,n)),s.ot!==a&&(a=s.ot,t.q.frontFace(s.ot)),xt(t,o,s)}}(t,n.Jt,n.qt)}function bt(t,n,e){t.q.useProgram(n.gn),t.q.uniformMatrix4fv(n.Z.Jt,!1,e)}function xt(t,n,e){t.q.uniform1f(e.at.Z.ct,"function"==typeof e.ct?e.ct():e.ct),t.q.uniform1f(e.at.Z.ut,e.ut?e.ut():0),t.q.uniformMatrix4fv(e.at.Z.i,!1,n.i),t.q.uniformMatrix4fv(e.at.Z.M,!1,n.M),t.q.activeTexture(33984),t.q.bindTexture(3553,e.lt),t.q.uniform1i(e.at.Z.pn,0),t.q.uniform4fv(e.at.Z.ft,e.ft),t.j.bindVertexArrayOES(e.st),t.q.drawElements(e.at.yn,e.rt.bn,5123,0),t.j.bindVertexArrayOES(null)}function Mt(t,n,e){let i=t.i.u[n];if(t.i.ht[n].B){a(Zt,i.i);let t=Math.round(Zt[0]),n=Math.round(Zt[2]);Math.abs(Zt[0]-t)<.01&&Math.abs(Zt[2]-n)<.01&&(i.v[0]=t,i.v[2]=n,i.R=!0)}}function Rt(t,n){for(let n=0;n<t.i.t.length;n++)2048==(2048&t.i.t[n])&&Ut(t,n)}function Ut(t,n){let e=t.i.u[n];e.R&&(e.R=!1,function t(n,e){for(let i of e.l){let e=n.u[i];e.R=!0,t(n,e)}}(t.i,e),function(t,n,e,i){let a=n[0],r=n[1],o=n[2],s=n[3],l=a+a,f=r+r,c=o+o,u=a*l,d=a*f,h=a*c,m=r*f,v=r*c,T=o*c,g=s*l,p=s*f,y=s*c,b=i[0],x=i[1],M=i[2];t[0]=(1-(m+T))*b,t[1]=(d+y)*b,t[2]=(h-p)*b,t[3]=0,t[4]=(d-y)*x,t[5]=(1-(u+T))*x,t[6]=(v+g)*x,t[7]=0,t[8]=(h+p)*M,t[9]=(v-g)*M,t[10]=(1-(u+m))*M,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1}(e.i,e.T,e.v,e.g),void 0!==e.U&&i(e.i,t.i.u[e.U].i,e.i),function(t,n){let e=n[0],i=n[1],a=n[2],r=n[3],o=n[4],s=n[5],l=n[6],f=n[7],c=n[8],u=n[9],d=n[10],h=n[11],m=n[12],v=n[13],T=n[14],g=n[15],p=e*s-i*o,y=e*l-a*o,b=e*f-r*o,x=i*l-a*s,M=i*f-r*s,R=a*f-r*l,U=c*v-u*m,w=c*T-d*m,S=c*g-h*m,k=u*T-d*v,C=u*g-h*v,F=d*g-h*T,A=p*F-y*C+b*k+x*S-M*w+R*U;A&&(A=1/A,t[0]=(s*F-l*C+f*k)*A,t[1]=(a*C-i*F-r*k)*A,t[2]=(v*R-T*M+g*x)*A,t[3]=(d*M-u*R-h*x)*A,t[4]=(l*S-o*F-f*w)*A,t[5]=(e*F-a*S+r*w)*A,t[6]=(T*b-m*R-g*y)*A,t[7]=(c*R-d*b+h*y)*A,t[8]=(o*C-s*S+f*U)*A,t[9]=(i*S-e*C-r*U)*A,t[10]=(m*M-v*b+g*p)*A,t[11]=(u*b-c*M-h*p)*A,t[12]=(s*w-o*k-l*U)*A,t[13]=(e*k-i*w+a*U)*A,t[14]=(v*y-m*x-T*p)*A,t[15]=(c*x-u*y+d*p)*A)}(e.M,e.i))}function wt(t,n){let e=t.i.P[n],i=t.i.Rt[n];for(let a of e.W)it(t,i.Ut,[n,a.hn])}function St(t,...n){return t.reduce((t,e)=>t+function(t){let n=t.shift();return"boolean"==typeof n||null==n?"":Array.isArray(n)?n.join(""):n}(n)+e)}function kt(t,n,e){return Math.max(t,Math.min(n,e))}function Ct(t,n,e){let i=t.i.u[n],r=t.i.kt[n],o=t.i.Kt[n],l=t.sn-1;r.At=kt(0,l,r.At),r.Dt=kt(0,l,r.Dt);let f=r.At-t.sn/2+.5,d=r.Dt-t.sn/2+.5;if(a(Gt,i.i),s(Jt,Gt,[f,Gt[1],d]),u(Jt)<.1)t.i.t[n]&=-8193,r.Nt=0,r.Ct=r.At,r.Ft=r.Dt,i.v[0]=f,i.v[2]=d,o.Bt.push([0,0,0]);else if(r.Nt>1/o.Pt){t.i.t[n]&=-8193,r.Nt=0,r.At=r.Ct,r.Dt=r.Ft;let e=r.Ft-t.sn/2+.5;i.v[0]=r.Ct-t.sn/2+.5,i.v[2]=e,o.Bt.push([0,0,0])}else{r.Nt+=e,c(Jt,Jt),o.Bt.push(Jt);let n=t.i.u[i.l[0]];1===Jt[2]?h(n.T,0,1,0,0):1===Jt[0]?h(n.T,0,-.707,0,.707):-1===Jt[2]?h(n.T,0,0,0,1):-1===Jt[0]&&h(n.T,0,.707,0,.707)}i.R=!0}let Ft=0,At=new WeakMap,Dt=[1,0,1,1],Nt=[1,1,0,1],Kt=[.1,.1,.1,1],Pt=[1,.56,0,1],$t=1,Bt=[{terrain:[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],props:[0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0]},{texture:"water",terrain:[1,2,2,2,2,2,1,1,2,2,2,2,2,1,1,2,2,2,2,2,1,1,2,2,2,2,2,1,1,2,2,2,2,2,1,1,2,2,2,2,2,1,1,2,2,2,2,2,1],props:[0,11,0,5,0,6,0,0,11,0,0,0,6,0,0,6,0,0,0,6,0,0,6,0,0,0,11,0,0,6,0,0,0,6,0,0,11,0,0,0,6,0,0,11,0,4,0,6,0]},{texture:"grass",terrain:[2,2,2,2,2,2,6,2,2,6,2,2,6,6,2,6,2,2,6,6,2,2,2,2,1,1,6,1,2,2,2,1,1,1,6,2,2,2,1,1,1,1,2,2,2,1,1,1,1],props:[11,11,11,0,0,0,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,11,0,0,0,0,4,0,11,0,0,0,0]},{texture:"stone",terrain:[2,2,2,7,7,2,2,2,2,2,7,7,2,2,2,2,7,7,7,7,2,2,7,7,7,2,2,2,2,2,2,2,7,2,2,2,2,2,2,2,7,2,2,2,2,2,2,2,2],props:[5,0,0,0,0,11,11,0,0,0,0,0,0,0,6,6,6,6,6,6,0,11,0,0,0,0,0,0,0,0,6,6,6,6,6,11,0,0,0,0,0,0,11,0,0,0,0,0,4]},{texture:"palm",terrain:[7,7,7,7,1,1,1,2,7,7,7,7,1,1,2,2,7,7,7,7,1,2,2,2,7,7,7,7,2,2,2,2,2,2,7,2,2,2,2,2,2,2,2,2,2,2,2,2,2],props:[0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,0,11,11,11,0,0,0,11,11,0,0,0,0,0,0,11,0,11,11,0,11,0,11,0,11,0,0,0,0,0,0,11,0,4]},{texture:"krates",terrain:[2,2,7,7,7,1,1,1,1,2,2,2,7,7,7,1,1,1,2,2,2,2,7,7,7,1,1,2,2,2,2,2,2,7,7,1,7,2,2,2,2,2,7,7,7,7,7,2,2,2,2,2,2,7,1,7,7,2,2,2,2,2,2,1,1,7,7,2,2,2,2,2,1,1,1,7,7,2,2,2,2],props:[3,11,0,0,0,0,0,3,0,0,11,0,0,0,0,0,0,0,0,11,6,6,6,0,0,0,3,0,0,0,0,6,6,0,0,0,4,0,0,0,0,6,0,0,0,0,0,0,0,0,6,0,0,0,3,0,0,0,0,0,3,0,0,0,0,0,0,0,0,6,5,0,0,3,0,0,0,6,0,0,0]},{texture:"sand",terrain:[2,2,2,2,2,1,1,1,2,2,2,2,2,7,7,1,2,2,2,2,7,7,7,1,2,2,2,7,7,7,7,1,1,1,1,7,7,7,7,1,1,7,1,7,7,7,7,1,1,7,1,1,1,1,1,1,1,7,7,1,1,1,1,1],props:[11,0,0,11,0,0,0,0,0,0,4,6,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,6,0,0,6,0,0,0,0,6,0,0,10,0,0,0,0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,0,10,0,0,0,0,0]},{texture:"bush",terrain:[2,2,2,2,7,7,1,2,2,2,2,7,7,7,2,2,2,2,2,2,2,7,2,2,2,2,2,2,7,7,2,2,2,2,2,7,7,7,1,1,1,2,7,7,7,7,7,7,7],props:[0,0,0,6,11,6,0,0,3,0,8,0,0,0,0,0,0,6,3,8,0,11,6,3,0,0,0,0,6,0,0,0,11,11,6,8,0,4,0,0,0,5,0,0,8,10,8,10,8]},{texture:"fence",terrain:[2,2,7,7,7,7,1,1,2,2,2,7,7,7,1,2,2,2,2,2,7,7,1,7,2,2,2,2,7,7,1,7,2,2,2,2,2,7,1,7,2,2,2,2,2,7,1,1,2,2,2,2,2,2,7,7,0,0,0,0,0,0,0,0],props:[0,0,0,10,0,0,0,0,0,11,0,6,0,0,0,10,0,0,0,0,3,0,0,0,0,6,0,11,0,0,0,0,0,0,0,6,0,0,0,5,8,9,9,9,4,0,0,0,0,0,0,9,9,9,9,9,0,0,0,0,0,0,0,0]},{texture:"lava",terrain:[1,2,2,2,2,2,2,7,7,1,1,2,2,2,2,1,2,2,2,7,7,1,2,2,2,2,2,2,2,2,2,7,7,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1,1,1,2,2,2,2,2,2,2,1,1],props:[0,11,11,6,0,0,10,11,10,0,0,11,0,0,6,0,0,0,0,0,0,0,0,0,0,6,5,6,0,0,0,0,10,0,0,0,6,6,6,6,6,0,0,0,0,0,0,6,12,12,12,6,0,0,0,0,4,0,6,12,12,12,6,0,0,0,0,0,0,6,12,12,12,6,0,0,0,0,0,0,6,6,6,12,6,0,0,0,0,0,0,3,0,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,6,0,0,0,0,0,0]},{texture:"shell",terrain:[1,2,2,2,2,7,2,2,2,1,1,7,2,2,2,2,6,2,7,7,2,2,6,2,7,7,7,2,2,2,1,7,7,2,2,2],props:[0,10,11,10,9,9,10,8,4,0,0,5,6,0,3,3,11,11,6,0,0,0,0,6,11,11,0,0,0,6,0,8,11,10,9,9]}];const It=[[60,,,,67,,,,72,,,,],[64,,,,69,,67,,],[71,,69,,67,,62,,],[64,,64,,64,,60,,64,,65,,],[64,,64,,64,,60,,62,,60,,],[72,,71,,,,67,,65,,,,]];class Vt{constructor(){this.t=[],this.D=[],this.wt=[],this.jt=[],this.P=[],this.zt=[],this.Kt=[],this.o=[],this.it=[],this.ht=[],this.u=[],this.Rt=[],this.kt=[]}}let Et,Ot=Float32Array.from([-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5,-.5,-.5,.5,.5,.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,.5,.5]),zt=Float32Array.from([-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0]),Lt=Float32Array.from([1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0]),Yt=Uint16Array.from([23,22,20,22,21,20,19,18,16,18,17,16,15,14,12,14,13,12,11,10,8,10,9,8,7,6,4,6,5,4,3,2,0,2,1,0]),_t=Float32Array.from([-1,-1,0,1,-1,0,1,1,0,-1,1,0]),Wt=Float32Array.from([0,0,1,0,0,1,0,0,1,0,0,1]),jt=Float32Array.from([0,0,1,0,1,1,0,1]),qt=Uint16Array.from([3,2,0,2,1,0]),Ht={nn:[{en:[8,"lowpass",11,0,!1,!1,8,8,[[!1,3,3,1,4]]],in:[72]}],rn:.1};const Qt=[0,0,0,1];let Xt,Zt=[0,0,0],Gt=[0,0,0],Jt=[0,0,0],tn=new class{constructor(){this.i=new Vt,this.Tn={},this.vn={},this.xn=document.querySelector("#ui"),this.Mn=document.querySelector("canvas"),this.q=this.Mn.getContext("webgl"),this.j=this.q.getExtension("OES_vertex_array_object"),this.Audio=new(window.AudioContext||window.webkitAudioContext),this.pt=function(t){let n=at(t,"\nuniform mat4 K,L,M;\nuniform vec4 N;\n\nattribute vec3 P,R;\nattribute vec2 Q;\nvarying vec2 a;\nvarying vec3 b;\n\nvoid main(){\nvec3 n=normalize((vec4(R, 1.0)*M).xyz);\ngl_Position=K*L*vec4(P,1.);\n\na=Q;\n\n\nb=N.rgb*.3;\n\n{\n\nfloat f=dot(n,normalize(vec3(1.,1.,-1.)));\nif(f>0.)b+=N.rgb*f*.8;\n}\n\n{\n\nfloat f=dot(n,normalize(vec3(1.,1.,1.)));\nif(f > 0.0)b += N.rgb*f*.5;\n}\n}\n","\nprecision mediump float;\n\nuniform sampler2D O;\nuniform float S,T;\nvarying vec2 a;\nvarying vec3 b;\n\nvoid main() {\nvec4 c;\nif (T==0.) {\nc=texture2D(O,a*S);\n} else {\nc=texture2D(O,a*S+vec2(T,0.));\n}\n\nif(c==vec4(1.,0.,1.,1.))discard;\n\ngl_FragColor=vec4(b,1.)*c;\n}\n");return{yn:4,gn:n,Z:{Jt:t.getUniformLocation(n,"K"),i:t.getUniformLocation(n,"L"),M:t.getUniformLocation(n,"M"),ft:t.getUniformLocation(n,"N"),pn:t.getUniformLocation(n,"O"),X:t.getAttribLocation(n,"P"),J:t.getAttribLocation(n,"Q"),nt:t.getAttribLocation(n,"R"),ct:t.getUniformLocation(n,"S"),ut:t.getUniformLocation(n,"T")}}}(this.q),this.Rn=function(t){let n=at(t,"\nattribute vec3 B;\nattribute vec2 C;\nvarying vec2 D;\n\nvoid main(){\ngl_Position=vec4(B,1.);\nD=C;\n}\n","\nprecision mediump float;\n\nuniform sampler2D A;\n\nvarying vec2 D;\n\nvoid main(){\n\ngl_FragColor=texture2D(A,vec2(D.x,D.y*.75+.125));\n}\n");return{yn:4,gn:n,Z:{pn:t.getUniformLocation(n,"A"),X:t.getAttribLocation(n,"B"),J:t.getAttribLocation(n,"C")}}}(this.q),this.yt=function(t){let n=t.createBuffer();t.bindBuffer(34962,n),t.bufferData(34962,Ot,35044);let e=t.createBuffer();t.bindBuffer(34962,e),t.bufferData(34962,zt,35044);let i=t.createBuffer();t.bindBuffer(34962,i),t.bufferData(34962,Lt,35044);let a=t.createBuffer();return t.bindBuffer(34963,a),t.bufferData(34963,Yt,35044),{H:n,Un:Ot,tt:e,G:i,et:a,wn:Yt,bn:Yt.length}}(this.q),this.Mt=function(t){let n=t.createBuffer();t.bindBuffer(34962,n),t.bufferData(34962,_t,35044);let e=t.createBuffer();t.bindBuffer(34962,e),t.bufferData(34962,Wt,35044);let i=t.createBuffer();t.bindBuffer(34962,i),t.bufferData(34962,jt,35044);let a=t.createBuffer();return t.bindBuffer(34963,a),t.bufferData(34963,qt,35044),{H:n,Un:_t,tt:e,G:i,et:a,wn:qt,bn:qt.length}}(this.q),this.dn=[],this.bt={ln:n(this.q,128,128),_t:n(this.q,128,128)},this.Ot={},this.Wt={ln:e(this.q,128,128),_t:e(this.q,128,128)},this.Et=0,this.sn=11,this.gt=new Set,this.Sn=!1,this.cn=!1,this.un=!1,document.addEventListener("visibilitychange",()=>document.hidden?x():b(this)),window.addEventListener("keydown",t=>{t.repeat||(this.Tn[t.code]=1,this.vn[t.code]=1)}),window.addEventListener("keyup",t=>{this.Tn[t.code]=0,this.vn[t.code]=-1}),this.q.enable(2929),this.q.enable(2884)}m(){for(let t in this.vn)this.vn[t]=0}h(t){!function(t,n){for(let n=0;n<t.i.t.length;n++)16==(16&t.i.t[n])&&mt(t,n)}(this),function(t,n){for(let e=0;e<t.i.t.length;e++)2049==(2049&t.i.t[e])&&ot(t,e,n)}(this,t),function(t,n){for(let e=0;e<t.i.t.length;e++)10368==(10368&t.i.t[e])&&Ct(t,e,n)}(this,t),function(t,n){for(let e=0;e<t.i.t.length;e++)2176==(2176&t.i.t[e])&&vt(t,e,n)}(this,t),function(t,n){for(let n=0;n<t.i.t.length;n++)if(2112==(2112&t.i.t[n])){let e=t.i.u[n],i=t.i.zt[n],o=t.i.u[i.Lt],s=a([0,0,0],o.i),l=r([0,0,0,0],o.i);d(e.v,e.v,s,i.Yt),T(e.T,e.T,l,i.Yt),e.R=!0}}(this),Rt(this),function(t,n){let e=[],i=[];for(let n=0;n<t.i.t.length;n++)if(2056==(2056&t.i.t[n])){let a=t.i.u[n],r=t.i.P[n];r.W=[],r.$?(r.$=!1,ut(a.i,r)):r.B?(ut(a.i,r),i.push(r)):e.push(r)}for(let t=0;t<i.length;t++)ht(i[t],e,e.length),ht(i[t],i,t)}(this),function(t,n){for(let e=0;e<t.i.t.length;e++)3080==(3080&t.i.t[e])&&pt(t,e,n)}(this,t),function(t,n){for(let n=0;n<t.i.t.length;n++)6152==(6152&t.i.t[n])&&wt(t,n)}(this),Rt(this),function(t,n){for(let n=0;n<t.i.t.length;n++)3072==(3072&t.i.t[n])&&Mt(t,n)}(this),Rt(this),function(t,n){t.dn=[];for(let n=0;n<t.i.t.length;n++)if(2052==(2052&t.i.t[n])){let e=t.i.jt[n];ct(t,n,e),t.dn.push(e)}}(this),function(t,n){for(let n of t.dn)yt(t,n)}(this),function(t,n){t.q.bindFramebuffer(36160,null),t.q.clearColor(1,.8,.4,1),t.q.clear(16640);let e=t.Rn,i=t.Mt;t.q.useProgram(e.gn),t.q.activeTexture(33984),t.q.uniform1i(e.Z.pn,0),t.q.bindBuffer(34962,i.H),t.q.enableVertexAttribArray(e.Z.X),t.q.vertexAttribPointer(e.Z.X,3,5126,!1,0,0),t.q.bindBuffer(34962,i.G),t.q.enableVertexAttribArray(e.Z.J),t.q.vertexAttribPointer(e.Z.J,2,5126,!1,0,0),t.q.bindBuffer(34963,i.et),t.q.bindTexture(3553,t.bt._t),t.q.viewport(0,404,512,384),t.q.drawElements(e.yn,i.bn,5123,0),t.q.bindTexture(3553,t.bt.ln),t.q.viewport(128,48,256,192),t.q.drawElements(e.yn,i.bn,5123,0)}(this),function(t,n){let e=function(t){switch(t.fn){case void 0:return St`
<div
class="screen"
style="
background-color: #eee;
color: #222;
text-shadow: none;
font-style: italic;
"
>
<div
class="view"
style="
animation: 3s ease-in-out both slide-from-left;
"
>
Piesku presents
</div>
</div>
<div
class="screen"
style="
background-color: #eee;
color: #222;
text-shadow: none;
font-style: italic;
"
>
<div
class="view"
style="
animation: 3s ease-in-out both slide-from-right;
"
onanimationend="$(${3})"
>
A js13kGames game
</div>
</div>
`;case et:return St`
<div class="screen">
<div
class="view"
style="
grid-template-columns: repeat(5, 1fr);
grid-template-rows: repeat(6, 1fr);
font-style: italic;
"
>
<div
style="grid-area: 1/1/3/3; font-size: 3em; animation: 0.3s ease-in both title;"
>
Oh
</div>
<div
style="grid-area: 1/3/3/5; font-size: 4em; animation: 0.3s ease-in 0.5s both title;"
>
No!
</div>
<div style="grid-area: 3/1/4/2; animation: 0.2s ease-in 1s both title;">All</div>
<div style="grid-area: 4/1/5/2; animation: 0.2s ease-in 1.2s both title;">The</div>
<div
style="font-size: 2em; grid-area: 3/2/5/5; animation: 0.3s ease-in 1.4s both title;"
>
Textures
</div>
<div style="grid-area: 5/2/6/3; animation: 0.2s ease-in 1.9s both title;">Are</div>
<div
style="font-size: 4em; grid-area: 5/3/7/6; animation: 1s ease-in 2s both gone;"
onanimationend="$(${1})"
>
404!
</div>
</div>
</div>
<div class="screen">
<div class="view" style="background: #fc6; border: 10px solid #c60;"></div>
<div class="view" style="animation: 1s ease-in-out 3s both slide-from-bottom;">
<div class="button" onclick="$(${4}, 1)">
Start a New Game
</div>
</div>
</div>
`;default:return function(t){return St`
<div class="screen"></div>
<div class="screen">
<div class="view" style="border: 10px solid #c60;">
<div
style="
position: absolute;
top: 30px;
left: 15px;
"
>
World 1 - ${t.Et}
</div>
<div
class="button"
onclick="$(${4}, ${t.Et})"
style="
position: absolute;
top: 15px;
right: 15px;
height: 45px;
text-align: center;
"
>
Restart
</div>
<div
style="
width: 256px;
height: 192px;
margin: 96px 0 0;
border: 10px solid #c60;
"
></div>
</div>
${t.un&&(e=t.Et,St`
<div class="view toast">
<div class="alert fill">
<p>You drowned!</p>
<div class="button" onclick="$(${4}, ${e})">
Try again
</div>
</div>
</div>
`)}
${t.cn&&(t.Et<Bt.length-1?(n=t.Et+1,St`
<div class="view toast">
<div class="alert fill">
<p>You found a missing texture!</p>
<div class="button" onclick="$(${4}, ${n})">
Continue
</div>
</div>
</div>
`):St`
<div class="view toast">
<div class="alert fill">
You Won!
<div class="button" onclick="$(${3})">
Play Again
</div>
</div>
</div>
`)}
</div>
`;var n,e}(t)}}(t);e!==Xt&&(t.xn.innerHTML=Xt=e)}(this),function(t,n){for(let e=0;e<t.i.t.length;e++)2==(2&t.i.t[e])&&ft(t,e,n)}(this,t)}};window.$=(...t)=>it(tn,...t);for(let n of document.querySelectorAll("img"))tn.bt[n.id]=t(tn.q,n);b(tn)}();
</script>
