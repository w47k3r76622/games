let e,t,i={};function s(e,...t){(i[e]||[]).map((e=>e(...t)))}function n(){return e}function r(){return t}let o=/(jpeg|jpg|gif|png)$/,l=/(wav|mp3|ogg|aac)$/,a=/^\//,h=/\/$/,c=new WeakMap;function d(e,t){return new URL(e,t).href}function u(e,t){return[e.replace(h,""),e?t.replace(a,""):t].filter((e=>e)).join("/")}function g(e){return e.split(".").pop()}function f(e){let t=e.replace("."+g(e),"");return 2==t.split("/").length?t.replace(a,""):t}let x={},y={},m={};function w(){window.__k||(window.__k={dm:c,u:d,d:m,i:x})}function p(e,t,i){return Math.min(Math.max(e,i),t)}function R(e,t){return e.rotation||t.rotation?null:([e,t]=[e,t].map((e=>v(e))),e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y)}function v(e){let{x:t=0,y:i=0,width:s,height:n}=e.world||e;return e.mapwidth&&(s=e.mapwidth,n=e.mapheight),e.anchor&&(t-=s*e.anchor.x,i-=n*e.anchor.y),s<0&&(t+=s,s*=-1),n<0&&(i+=n,n*=-1),{x:t,y:i,width:s,height:n}}const b=()=>{};function S(e){let t=e.canvas;e.clearRect(0,0,t.width,t.height)}function T({fps:e=60,clearCanvas:t=!0,update:i=b,render:n,context:o=r()}={}){if(!n)throw Error("You must provide a render() function");let l,a,h,c,d,u=0,g=1e3/e,f=1/e,x=t?S:b;function y(){if(a=requestAnimationFrame(y),h=performance.now(),c=h-l,l=h,!(c>1e3)){for(s("tick"),u+=c;u>=g;)d.update(f),u-=g;x(o),d.render()}}return d={update:i,render:n,isStopped:!0,start(){l=performance.now(),this.isStopped=!1,requestAnimationFrame(y)},stop(){this.isStopped=!0,cancelAnimationFrame(a)},_frame:y,set _last(e){l=e}},d}class _{constructor(){this.x=0,this.y=0,this.dx=0,this.width=32,this.height=32,this.ttl=Number.POSITIVE_INFINITY}update(){this.x+=this.dx,this.ttl-=1}isAlive(){return this.ttl>0}renderImage(e,t){e.drawImage(t,0,0)}renderImageFrame(e,t,i){e.drawImage(t,32*i,0,32,32,0,0,32,32)}}const k={blue_flower:{cost:4,glucosis:1,radius:0,interval:6e3},vine:{cost:12,radius:1,glucosis:0}},O=e=>k[e].cost,E=e=>k[e].radius;class q extends _{constructor(e){super(),this.state={type:"idle"},this.lastPhotosynthesisTime=0,this.species=e}update(){super.update(),"grabbing"===this.state.type&&performance.now()-this.state.startTime>3e3&&(this.state={type:"idle"})}render(){const e=r();e.save(),e.translate(this.x,this.y),this.renderImage(e,x[this.species]),null!=k[this.species].interval&&this.renderGlucose(e),e.restore()}renderGlucose(e){if(0===this.lastPhotosynthesisTime)return;const t=performance.now()-this.lastPhotosynthesisTime;if(t<1e3){e.save(),e.fillStyle="rgb(30, 255, 30)",e.font="bold 12px Sans-serif";const i=10,s=10-10*function(e){return 1-Math.pow(1-e,3)}(t/1e3);e.fillText("+"+k[this.species].glucosis,i,s),e.restore()}}getGlucose(){if(!this.isAlive())return 0;const e=k[this.species].interval;if(null==e)return 0;const t=performance.now();return t-this.lastPhotosynthesisTime>e?(this.lastPhotosynthesisTime=t,1):0}canGrab(){return this.isAlive()&&"vine"===this.species&&"grabbing"!==this.state.type}startGrabbing(){"grabbing"!==this.state.type&&(this.state={type:"grabbing",startTime:performance.now()})}}class j extends _{constructor(){super(...arguments),this.state="idle",this.dropTime=performance.now()+200*Math.random()}render(){const e=performance.now()-this.dropTime,t=e<1e3?10*function(e){const t=7.5625,i=2.75;return e<1/i?t*e*e:e<2/i?t*(e-=1.5/i)*e+.75:e<2.5/i?t*(e-=2.25/i)*e+.9375:t*(e-=2.625/i)*e+.984375}(e/1e3)-10:0,i=r();i.save(),i.translate(this.x,this.y),i.translate(0,t);let s=0;if(this.grabTime){const e=performance.now()-this.grabTime;s=Math.min(2,1+Math.floor(e/1e3))}this.renderImageFrame(i,x.cone,s),i.restore()}grab(){"grabbed"!==this.state&&(this.state="grabbed",this.ttl=120,this.grabTime=performance.now())}}class A extends _{render(){const e=r();e.save(),e.translate(this.x,this.y);let t=0;null!=this.moveStartTime&&(t=Math.floor((performance.now()-this.moveStartTime)/500)%4),this.renderImageFrame(e,x.roller,t),e.restore()}move(){this.dx=.01*Math.random()-.1,this.moveStartTime=performance.now()}stop(){this.x>64&&(this.dx=0,this.moveStartTime=void 0)}}zzfxX=new(window.AudioContext||webkitAudioContext);const G=[,,33,.1,.02,.2,4,2.02,-36,5.9,,,.12,,,,,,.09],C=[2.47,,1626,,.01,0,1,2.21,-19,,,,.04,,,.3,.11,.68,.04,.09],M=[1.05,,1629,.03,.23,.01,1,2.79,23,6,,,.23,,-2.6,,,.25,.01],L=[2.01,,179,.14,.25,.01,1,1.48,,,,,,.3,,,.16,.11,.21,.1],P=e=>{((e=1,t=.05,i=220,s=0,n=0,r=.1,o=0,l=1,a=0,h=0,c=0,d=0,u=0,g=0,f=0,x=0,y=0,m=1,w=0,p=0)=>{let R,v,b=Math,S=44100,T=2*b.PI,_=a*=500*T/S/S,k=i*=(1-t+2*t*b.random(t=[]))*T/S,O=0,E=0,q=0,j=1,A=0,G=0,C=0;for(s=S*s+9,w*=S,n*=S,r*=S,y*=S,h*=500*T/Math.pow(S,3),f*=T/S,c*=T/S,d*=S,u=S*u|0,v=s+w+n+r+y|0;q<v;t[q++]=C)++G%(100*x|0)||(C=o?1<o?2<o?3<o?b.sin(Math.pow(O%T,3)):b.max(b.min(b.tan(O),1),-1):1-(2*O/T%2+2)%2:1-4*b.abs(b.round(O/T)-O/T):b.sin(O),C=(u?1-p+p*b.sin(T*q/u):1)*(0<C?1:-1)*Math.pow(b.abs(C),l)*e*zzfxV*(q<s?q/s:q<s+w?1-(q-s)/w*(1-m):q<s+w+n?m:q<v-y?(v-q-y)/r*m:0),C=y?C/2+(y>q?0:(q<v-y?1:(v-q)/y)*t[q-y|0]/2):C),R=(i+=a+=h)*b.cos(f*E++),O+=R-R*g*(1-1e9*(b.sin(q)+1)%2),j&&++j>d&&(i+=c,k+=c,j=0),!u||++A%u||(i=k,a=_,j=j||1);(e=zzfxX.createBuffer(1,v,S)).getChannelData(0).set(t),(i=zzfxX.createBufferSource()).buffer=e,i.connect(zzfxX.destination),i.start()})(...e)},I=[2,2,2,2,3,2,2,3,2,3,3,3,2,3,3,2,2,2,2,3,2,2,2,2,2,3,4,2,2,3,2,3,3,2,2,2,2,4,3,2,3,3,3,3,4,2,2,3,3,2,3,2,4,3,3,2,2,2,3,3,2,2,2,2,3,3,2,3,3,2,2,2,3,2,3,3,3,3,3,3,3,2,2,3,2,2,3,2,2,2,3,3,3,2,3,2,3,3,3,2,2,2,2,2,3,2,2,3,2,3,2,3,3,2,2,2,2,2,3,3,3,2,3,2,3,3,2,2,3,3,4,2,2,2,4,3,2,3,3,2,2,2,2,2,3,2,2,2,2,3,2,3,2,3,2,3,3,2,2,2,4,3,2,3,3,3,2,3];const z=()=>!0,F=e=>!(e instanceof A);var B;!function(e){e[e.Running=0]="Running",e[e.GameOver=1]="GameOver"}(B||(B={}));const Y={1:[{xRel:0,yRel:0}],2:[{xRel:0,yRel:0},{xRel:0,yRel:1}],3:[{xRel:-2,yRel:0},{xRel:0,yRel:0},{xRel:2,yRel:0}],4:[{xRel:0,yRel:-2},{xRel:-1,yRel:-1},{xRel:0,yRel:0},{xRel:-1,yRel:1},{xRel:0,yRel:2}],5:[{xRel:-4,yRel:0},{xRel:-2,yRel:0},{xRel:-2,yRel:1},{xRel:-1,yRel:0},{xRel:-1,yRel:1},{xRel:1,yRel:0},{xRel:1,yRel:1},{xRel:2,yRel:0},{xRel:2,yRel:1},{xRel:4,yRel:0},{xRel:4,yRel:1}],6:[{xRel:-4,yRel:-2},{xRel:-2,yRel:-2},{xRel:0,yRel:-2},{xRel:2,yRel:-2},{xRel:4,yRel:-2},{xRel:-3,yRel:-1},{xRel:-1,yRel:-1},{xRel:1,yRel:-1},{xRel:3,yRel:-1},{xRel:-4,yRel:0},{xRel:-2,yRel:0},{xRel:0,yRel:0},{xRel:2,yRel:0},{xRel:4,yRel:0},{xRel:-3,yRel:1},{xRel:-1,yRel:1},{xRel:1,yRel:1},{xRel:3,yRel:1},{xRel:-4,yRel:2},{xRel:-2,yRel:2},{xRel:0,yRel:2},{xRel:2,yRel:2},{xRel:4,yRel:2}],7:[{xRel:-3,yRel:0},{xRel:-3,yRel:1},{xRel:-2,yRel:-1},{xRel:-2,yRel:0},{xRel:-2,yRel:1},{xRel:-2,yRel:2},{xRel:-1,yRel:-2},{xRel:-1,yRel:-1},{xRel:-1,yRel:1},{xRel:-1,yRel:2},{xRel:-1,yRel:3},{xRel:0,yRel:-2},{xRel:0,yRel:-1},{xRel:0,yRel:0},{xRel:0,yRel:2},{xRel:0,yRel:3},{xRel:1,yRel:-1},{xRel:1,yRel:0},{xRel:1,yRel:1},{xRel:1,yRel:2},{xRel:2,yRel:0},{xRel:2,yRel:1}],maxLevel:7};class N{constructor(){this.gameObjects=[],this.attackCount=0,this.attackStartTime=performance.now(),this.lastRollerCheckTime=performance.now(),this.lastEndingConditionCheck=performance.now(),this.state=B.Running,this.glucoseLevel=4,this.score=0,this.tileEngine=function(e){let{width:t,height:i,tilewidth:s,tileheight:o,context:l=r(),tilesets:a,layers:h}=e,c=t*s,d=i*o,u=document.createElement("canvas"),g=u.getContext("2d");u.width=c,u.height=d;let f={},x={},y=[],m=Object.assign({context:l,mapwidth:c,mapheight:d,_sx:0,_sy:0,_d:!1,get sx(){return this._sx},get sy(){return this._sy},set sx(e){this._sx=p(0,c-n().width,e),y.forEach((e=>e.sx=this._sx))},set sy(e){this._sy=p(0,d-n().height,e),y.forEach((e=>e.sy=this._sy))},render(){this._d&&(this._d=!1,this._p()),S(u)},renderLayer(e){let t=x[e],i=f[e];t||(t=document.createElement("canvas"),t.width=c,t.height=d,x[e]=t,m._r(i,t.getContext("2d"))),i._d&&(i._d=!1,t.getContext("2d").clearRect(0,0,t.width,t.height),m._r(i,t.getContext("2d"))),S(t)},layerCollidesWith(e,t){let{x:i,y:s,width:n,height:r}=v(t),o=w(s),l=R(i),a=w(s+r),h=R(i+n),c=f[e];for(let e=o;e<=a;e++)for(let t=l;t<=h;t++)if(c.data[t+e*this.width])return!0;return!1},tileAtLayer(e,t){let i=t.row||w(t.y),s=t.col||R(t.x);return f[e]?f[e].data[s+i*m.width]:-1},setTileAtLayer(e,t,i){let s=t.row||w(t.y),n=t.col||R(t.x);f[e]&&(this._d=!0,f[e]._d=!0,f[e].data[n+s*m.width]=i)},setLayer(e,t){f[e]&&(this._d=!0,f[e]._d=!0,f[e].data=t)},addObject(e){y.push(e),e.sx=this._sx,e.sy=this._sy},removeObject(e){let t=y.indexOf(e);-1!==t&&(y.splice(t,1),e.sx=e.sy=0)},_r:function(e,t){t.save(),t.globalAlpha=e.opacity,(e.data||[]).map(((e,i)=>{if(!e)return;let s;for(let t=m.tilesets.length-1;t>=0&&(s=m.tilesets[t],!(e/s.firstgid>=1));t--);let n=s.tilewidth||m.tilewidth,r=s.tileheight||m.tileheight,o=s.margin||0,l=s.image,a=e-s.firstgid,h=s.columns||l.width/(n+o)|0,c=i%m.width*n,d=(i/m.width|0)*r,u=a%h*(n+o),g=(a/h|0)*(r+o);t.drawImage(l,u,g,n,r,c,d,n,r)})),t.restore()},_p:b,layerCanvases:x,layerMap:f},e);function w(e){return e/m.tileheight|0}function R(e){return e/m.tilewidth|0}function b(){m.layers&&m.layers.map((e=>{e._d=!1,f[e.name]=e,e.data&&!1!==e.visible&&m._r(e,g)}))}function S(e){const{width:t,height:i}=n(),s=Math.min(e.width,t),r=Math.min(e.height,i);m.context.drawImage(e,m.sx,m.sy,s,r,0,0,s,r)}return m.tilesets.map((t=>{let i=(window.__k?window.__k.dm.get(e):"")||window.location.href;if(t.source){if(!window.__k)throw Error('You must use "load" or "loadData" to resolve tileset.source');let e=window.__k.d[window.__k.u(t.source,i)];if(!e)throw Error(`You must load the tileset source "${t.source}" before loading the tileset`);Object.keys(e).map((i=>{t[i]=e[i]}))}if(""+t.image===t.image){if(!window.__k)throw Error('You must use "load" or "loadImage" to resolve tileset.image');let e=window.__k.i[window.__k.u(t.image,i)];if(!e)throw Error(`You must load the image "${t.image}" before loading the tileset`);t.image=e}})),b(),m}({tilewidth:32,tileheight:16,width:14,height:12,tilesets:[{firstgid:1,image:x["tiles.png"]}],layers:[{name:"ground",data:I}]}),this.rollers=new Array(this.tileEngine.height),this.addObject(new q("blue_flower"),{xSquare:2,ySquare:2}),this.addObject(new q("blue_flower"),{xSquare:3,ySquare:8}),this.addObject(new q("blue_flower"),{xSquare:7,ySquare:5})}getWidth(){return this.tileEngine.mapwidth}getHeight(){return this.tileEngine.mapheight}isGameOver(){return this.state===B.GameOver}insertPlant(e,t,i){if(this.state===B.GameOver)return;const s=O(i);if(this.isInside(e,t)&&s<=this.glucoseLevel){const n=this.toGridPosition(e,t);!(1===this.getTile(n))&&this.isFreeOf(n,z)&&(this.addObject(new q(i),n),this.glucoseLevel-=s,P("blue_flower"==i?M:L))}}onMouseMove(e,t,i){if(!this.isGameOver())if(this.isInside(e,t)){const s=this.toGridPosition(e,t),n=this.getTile(s);this.highlight=0===n||1===n?{position:s,radius:E(i),available:!1}:{position:s,radius:E(i),available:!0}}else this.highlight=void 0}update(){const e=performance.now();this.state!==B.GameOver&&e-this.lastEndingConditionCheck>1e3&&(this.lastEndingConditionCheck=e,this.checkIsGameOver()&&(this.state=B.GameOver)),this.state!==B.GameOver&&e-this.attackStartTime>15e3&&(this.attackStartTime=e,this.attackCount+=1,this.attack()),e-this.lastRollerCheckTime>200&&(this.lastRollerCheckTime=e,this.checkRollersMovement());for(const e of this.gameObjects)if(e.update(),e instanceof A&&e.dx<0&&this.pave(e),e instanceof q){const t=e.getGlucose();if(t>0&&(this.glucoseLevel+=t),e.canGrab()){const t=this.findAdjascentObject(e,(e=>e instanceof j&&"grabbed"!==e.state));if(t){const i=t;e.startGrabbing(),i.grab(),P(G),this.score+=1}}}this.gameObjects=this.gameObjects.filter((e=>e.isAlive()))}checkRollersMovement(){const e=this.tileEngine.height,t=this.tileEngine.tileheight,i=new Array(e).fill(!1);for(const e of this.gameObjects)if(e instanceof j){const s=this.getSquareBounds(e);i[Math.floor(s.y/t)]=!0}for(let t=0;t<e;t++){const e=this.rollers[t];e&&(i[t]&&0===e.dx&&e.move(),i[t]||0===e.dx||e.stop())}}checkIsGameOver(){const e=this.tileEngine.width,t=this.tileEngine.height,i=e*t;let s=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++){1===this.tileEngine.tileAtLayer("ground",{row:i,col:t})&&s++}return s>=i-2}pave(e){const t=this.toGridPosition(e.x+e.width,e.y+(e.height-16)),i=this.getTile(t);if(null!=i&&1!==i){this.setTile(t,1);const e=this.findObject(t,F);e&&(e.ttl=0,P(C))}}getAttackLevel(){const e=this.attackCount;return e<=3?1:e<=5?2:e<=8?3:e<=11?4:e<=14?5:e<=17?6:7}attack(){const e=this.getAvailableTilesInFrontOfRollers();if(0===e.length)return;const t=e.map((e=>({pos:e,obj:this.findObject(e,z)}))).filter((({obj:e})=>null==e||e instanceof q)),i=Math.min(t.length,this.getAttackLevel());if(0===i)return;const s=Y[Math.min(i,Y.maxLevel)];let n=[],r=0;for(let e=0;e<10;e++){const e=(o=t,o[Math.floor(Math.random()*o.length)]).pos,i=this.getAttackSquares(s,e,t),l=this.evaluateAttackSquares(i);l>r&&(n=i,r=l)}var o;for(const e of n)e.obj instanceof q&&(e.obj.ttl=0),this.insertCone(e.pos);P(C)}evaluateAttackSquares(e){return e.reduce(((e,t)=>e+(t.obj?3:1)),0)}getAttackSquares(e,t,i){const s=[];for(const n of e){const e=i.find((e=>e.pos.xSquare===t.xSquare+n.xRel&&e.pos.ySquare===t.ySquare+n.yRel));e&&s.push(e)}return s}insertCone(e){const t=new j;if(this.addObject(t,e),!this.rollers[e.ySquare]){const t=new A;this.addObject(t,{xSquare:this.tileEngine.width,ySquare:e.ySquare}),this.rollers[e.ySquare]=t}}getAvailableTilesInFrontOfRollers(){const e=this.tileEngine.width,t=this.tileEngine.height,i=[];for(let s=0;s<t;s++){let t=e-1;const n=this.rollers[s];if(n){const e=this.getSquareBounds(n),i=this.toGridPosition(e.x,e.y);t=Math.max(0,i.xSquare)}for(let e=0;e<t;e++)i.push({xSquare:e,ySquare:s})}return i}render(){const e=r();this.gameObjects.sort(((e,t)=>{const i=e.y-t.y;return 0===i?e instanceof A?1:-1:i})),this.tileEngine.render(),this.renderHighlight(e);for(const e of this.gameObjects)e.render()}renderHighlight(e){if(!this.highlight)return;const t=this.findObject(this.highlight.position,z),i=this.highlight.radius,s=32*this.highlight.position.xSquare-32*i,n=16*this.highlight.position.ySquare-16*i,r=32+2*i*32,o=16+2*i*16,l=t instanceof j||t instanceof A||t instanceof q,a=0===i?this.glucoseLevel>=O("blue_flower"):this.glucoseLevel>=O("vine"),h=this.highlight.available&&a&&!l?"rgb(0, 255, 0)":"rgb(255, 0, 0)";e.save(),e.globalAlpha=.5,this.highlight.available&&a&&!l&&(e.strokeStyle=h,e.strokeRect(s,n,r,o));const c=i>0?32:0,d=i>0?16:0;e.fillStyle=h,e.fillRect(s+c,n+d,32,16),e.globalAlpha=.2,e.fillRect(s,n,r,o),e.restore()}findObject(e,t){const i={x:32*e.xSquare,y:16*e.ySquare,width:32,height:16};for(const e of this.gameObjects)if(t(e)&&R(this.getSquareBounds(e),i))return e}findAdjascentObject(e,t){const i={x:e.x-32,y:e.y+(e.height-16)-16,width:96,height:48};for(const e of this.gameObjects)if(t(e)&&R(this.getSquareBounds(e),i))return e}getTile(e){return 0<=e.xSquare&&e.xSquare<this.tileEngine.width&&0<=e.ySquare&&e.ySquare<this.tileEngine.height?this.tileEngine.tileAtLayer("ground",{row:e.ySquare,col:e.xSquare}):null}setTile(e,t){this.tileEngine.setTileAtLayer("ground",{row:e.ySquare,col:e.xSquare},t)}getSquareBounds(e){return{x:e.x,y:e.y+(e.height-16),width:32,height:16}}isFreeOf(e,t){const i={x:32*e.xSquare,y:16*e.ySquare,width:32,height:16};for(const e of this.gameObjects)if(t(e)&&R(this.getSquareBounds(e),i))return!1;return!0}toGridPosition(e,t){return{xSquare:Math.floor(e/32),ySquare:Math.floor(t/16)}}addObject(e,t){e.x=32*t.xSquare,e.y=16*t.ySquare-(e.height-16),this.gameObjects.push(e)}isInside(e,t){return 0<=e&&e<this.tileEngine.mapwidth&&0<=t&&t<this.tileEngine.mapheight}}class W{constructor(){this.zoomFactor=2,this.horizontalTranslate=0,this.selectedSpecies="blue_flower",this.buttons=[{text:"Flower",species:"blue_flower",bounds:{x:0,y:0,width:100,height:50}},{text:"Vine",species:"vine",bounds:{x:105,y:0,width:100,height:50}}],this.context=r(),this.loop=T({update:()=>{this.level.update()},render:()=>{this.context.save(),this.context.translate(this.horizontalTranslate,120),this.context.scale(this.zoomFactor,this.zoomFactor),this.level.render(),this.context.restore(),this.renderUi(this.context)}}),this.level=new N,addEventListener("mousemove",(e=>{this.level.onMouseMove((e.x-this.horizontalTranslate)/this.zoomFactor,(e.y-120)/this.zoomFactor,this.selectedSpecies)}))}onClick(e){if(this.level.isGameOver())return this.loop.stop(),void location.reload();for(const s of this.buttons)if(t=e,(i=s.bounds).x<=t.x&&i.y<=t.y&&t.x<i.x+i.width&&t.y<i.y+i.height)return void(this.selectedSpecies=s.species);var t,i;this.level.insertPlant((e.x-this.horizontalTranslate)/this.zoomFactor,(e.y-120)/this.zoomFactor,this.selectedSpecies)}fitToScreen(e){const t=this.level.getWidth(),i=this.level.getHeight();let s=e.width/t;i*s+120>e.height&&(s=(e.height-120)/i);const n=t*s;let r=0;e.width>n&&(r=(e.width-n)/2),s>5&&(s=5),this.zoomFactor=s,this.horizontalTranslate=r}start(){this.loop.start()}renderUi(e){e.save();for(const t of this.buttons)this.renderButton(e,t);this.renderGlucoseLevel(e),this.renderScore(e),this.level.isGameOver()&&this.renderGameOver(e),e.restore()}renderButton(e,t){const i=t.bounds,s=O(t.species);s>this.level.glucoseLevel?e.fillStyle=t.species===this.selectedSpecies?"red":"rgb(80, 0, 0)":e.fillStyle=t.species===this.selectedSpecies?"green":"rgb(0, 80, 0)",e.fillRect(i.x,i.y,i.width,i.height),e.fillStyle="white",e.font="14px Sans-serif",e.fillText(t.text,i.x+17,i.y+30),e.fillStyle="white",e.font="bold 14px Sans-serif",e.fillText(s.toString(),i.x+i.width-25,i.y+i.height-5)}renderGlucoseLevel(e){const t=this.buttons[this.buttons.length-1].bounds,i=t.x+t.width+20;e.fillStyle="rgb(0, 200, 0)",e.font="14px Sans-serif",e.fillText("Glucose: "+this.level.glucoseLevel,i,20)}renderScore(e){const t=this.buttons[this.buttons.length-1].bounds,i=t.x+t.width+20;e.fillStyle="orange",e.font="14px Sans-serif",e.fillText("Score: "+this.level.score,i,40)}renderGameOver(e){const t=e.canvas.width/2,i=e.canvas.height/3;e.fillStyle="darkgray",e.strokeStyle="black",e.lineWidth=2,e.font="bold 60px Sans-serif",e.fillText("GAME OVER",t-180,i),e.strokeText("GAME OVER",t-180,i),e.fillStyle="white",e.font="bold 30px Sans-serif",e.fillText("CLICK TO TRY AGAIN",t-150,i+50)}}const H=[[[.75,0,196,,.08,.18,3],[.75,0,25,.002,.02,.08,3,,,,,,,,,.1,.01],[.8,0,2100,,,,3,3,,,-400,,,2],[,0,192,,.04,.2,2,2,-.03,-.04,-60,.02],[,0,84,,,,,.7,,,,.5,,6.7,1,.05],[,0,23,,,.2,3,5],[,0,23,,,.2,3,5],[2,0,800,,,.075,2,2,,,1e3,-.01,.02,4.8,-.3,,.065],[.75,0,386,,,.25,2],[,0,,,,.2,,.34,-2,,,,,,,.08],[1.5,0,155,.01,,.2,2,.5,,,-270,.2,2,,.1,,.15],[3,0,238,.01,,.4,2,2,,,-.5,,.1,,,,.01,,,.2]],[[[11,-1,20,,,,20,,20,,32,,20,,20,,,,22,,,,,,24,,,,,,27,,,,25,,,,25,,24,,25,,,,27,,,,29,,,,27,,,,25,,,,29,,15,,],[10,-1,8,.02,.04,.06,.08,.1,.12,.14,8.5,,,,12,,,,13,,,,,,15,,13,,12,,,,,,8,,.02,,.04,,.06,,.08,,.1,,.12,,.14,,5.5,.52,.54,.56,.58,.6,.62,.64,8,,,,12,,,,],[4,1,24,,,,,,,,,,,,,,,,24,,24,,,,,,,,,,,,,,24,,,,,,,,,,,,,,,,24,,24,,,,,,,,,,,,,,],[7,,,,25,,,,,,,,25,,25,,25,,,,,,25,,,,,,,,25,,25,,,,25,,,,,,,,25,,25,,25,,,,,,25,,,,,,,,25,,25,,],[3,,,,,,8.5,.92,8.5,.92,.99,,,,8.5,.92,8.5,.92,.99,,,,,,,,10.5,.92,10.5,.92,.99,,,,,,,,13.5,.92,.99,,,,,,,.92,13.5,.92,.99,,,,13.5,.92,.99,,,,13.5,.92,,,,,],[8,1,,,,,27,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,27,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[5,1,,,,,,,32,,,,,,,,,,,,,,,,32,,,,,,,,,,,,,,,,32,,,,,,,,,,,,,,,,32,,,,,,,,,,],[6,,,,,,,,,,22,,,,,,,,,,,,,,,,22,,22.75,,,,,,,,,,,,,,22,,,,,,,,,,,,,,,,22,,22.75,,,,,,],[9,1,,,,,,,,,,,20.59,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[11,-1,20,,,,20,,20,,32,,20,,20,,,,22,,,,,,24,,,,,,27,,,,20,,,,20,,19,,20,,,,22,,,,24,,,,22,,,,20,,,,24,,10,,],[10,-1,8,,.02,,.04,,.06,,.08,,.1,,.12,,.14,,.16,,.18,,.2,,.22,,.24,,.26,,.28,,.3,,.32,,.34,,.36,,.38,,.4,,.42,,.44,,.46,,.48,,.5,,.52,,.54,,.56,,.58,,.6,,.62,,],[4,1,24,,,,,,,,,,,,,,,,24,,24,,,,,,,,,,,,,,24,,,,,,,,,,,,,,,,24,,24,,,,,,,,,,,,,,],[7,,,,25,,,,,,,,25,,25,,25,,,,,,25,,,,,,,,25,,25,,,,25,,,,,,,,25,,25,,25,,,,,,25,,,,,,,,25,,25,,],[3,,,,,,8.5,.92,8.5,.92,.99,,,,8.5,.92,8.5,.92,.99,,,,,,,,10.5,.92,10.5,.92,.99,,,,,,,,8.5,.92,.99,,,,,,,.92,8.5,.92,.99,,,,8.5,.92,.99,,,,8.5,.92,,,,,],[8,1,,,,,27,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,27,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[5,1,,,,,,,32,,,,,,,,,,,,,,,,32,,,,,,,,,,,,,,,,32,,,,,,,,,,,,,,,,32,,,,,,,,,,],[6,,,,,,,,,,22,,,,,,,,,,,,,,,,22,,22.75,,,,,,,,,,,,,,22,,,,,,,,,,,,,,,,22,,22.75,,,,,,],[9,1,,,,,,,,,,,20.59,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[11,-1,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,3,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,,,13,,3,,],[4,1,24,,,,,,,,,,,,,,,,24,,24,,,,,,,,,,,,,,24,,,,,,,,,,,,,,,,24,,24,,,,,,,,,,,,,,],[7,1,,,25,,,,,,,,25,,25,,25,,,,,,25,,,,,,,,25,,25,,,,25,,,,,,,,25,,25,,25,,,,,,25,,,,,,,,25,,25,,],[3,1,,,,,13.5,.92,.99,,,,,,,.92,13.5,.92,.99,,,,13.5,.92,.99,,,,13.5,.92,,,,,,,,,13.5,.92,.99,,,,,,,.92,13.5,.92,.99,,,,13.5,.92,.99,,,,13.5,.92,,,,,],[8,1,,,,,27,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,27,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[5,1,,,,,,,32,,,,,,,,,,,,,,,,32,,,,,,,,,,,,,,,,32,,,,,,,,,,,,,,,,32,,,,,,,,,,],[6,1,,,,,,,,,22,,,,,,,,,,,,,,,,22,,22.75,,,,,,,,,,,,,,22,,,,,,,,,,,,,,,,22,,22.75,,,,,,]],[[2,-1,18,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[5,,18,,30,,,,18,,18,,30,,18,.92,,,18,,30,,,,18,,18,,,,18,,18,,30,,18,,,,18,,18,,30,,18,.92,,,30,,18,,,,18,,18,,,,18,,30,,],[,-1,18.5,,18.38,,30.5,,18.38,,18.5,,25.38,,30.5,,30.38,,25.5,,27.38,,18.5,,30.38,,18.5,,30.38,,25.5,,27.38,,18.5,,18.38,,30.5,,18.38,,18.5,,25.38,,30.5,,30.38,,25.5,,27.38,,18.5,,30.38,,18.5,,30.38,,25.5,,27.38,,],[4,,24,,,,,,,,,,,,,,,,24,,24,,,,,,,,,,,,,,24,,,,,,,,,,,,,,,,24,,24,,,,,,,,,,,,,,],[7,,,,25,,,,,,,,25,,25,,25,,,,,,25,,,,,,,,25,,25,,,,25,,,,,,,,25,,25,,25,,,,,,25,,,,,,,,25,,25,,],[3,1,,,,,18.5,.92,,,,,,,,,18.5,.92,,,,,18.5,.92,,,,,18.5,.92,,,,,,,,,18.5,.92,,,,,,,,,18.5,.92,,,,,18.5,.92,,,,,18.5,.92,,,,,],[8,1,,,,,27,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,27,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[5,1,,,,,,,32,,,,,,,,,,,,,,,,32,,,,,,,,,,,,,,,,32,,,,,,,,,,,,,,,,32,,,,,,,,,,],[6,,,,,,,,,,22,,,,,,,,,,,,,,,,22,,22.75,,,,,,,,,,,,,,22,,,,,,,,,,,,,,,,22,,22.75,,,,,,],[3,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,18,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[2,-1,13,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[5,,13,,25,,,,13,,13,,25,,13,.92,,,13,,25,,,,13,,13,,,,13,,13,,27,,15,,,,15,,15,,27,,15,.92,,,27,,15,,,,15,,15,,,,15,,27,,],[,-1,13.5,,13.38,,25.5,,13.38,,13.5,,20.38,,25.5,,25.38,,20.5,,22.38,,13.5,,25.38,,13.5,,25.38,,20.5,,22.38,,15.5,,15.38,,27.5,,15.38,,15.5,,22.38,,27.5,,27.38,,22.5,,24.38,,15.5,,27.38,,15.5,,27.38,,22.5,,24.38,,],[4,,24,,,,,,,,,,,,,,,,24,,24,,,,,,,,,,,,,,24,,,,,,,,,,,,,,,,24,,24,,,,,,,,,,,,,,],[7,,,,25,,,,,,,,25,,25,,25,,,,,,25,,,,,,,,25,,25,,,,25,,,,,,,,25,,25,,25,,,,,,25,,,,,,,,25,,25,,],[3,1,,,,,13.5,.92,,,,,,,,,13.5,.92,,,,,13.5,.92,,,,,13.5,.92,,,,,,,,,15.5,.92,,,,,,,,,15.5,.92,,,,,15.5,.92,,,,,15.5,.92,,,,,],[8,1,,,,,27,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,27,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[5,1,,,,,,,32,,,,,,,,,,,,,,,,32,,,,,,,,,,,,,,,,32,,,,,,,,,,,,,,,,32,,,,,,,,,,],[6,1,,,,,,,,,22,,,,,,,,,,,,,,,,22,,22.75,,,,,,,,,,,,,,22,,,,,,,,,,,,,,,,22,,22.75,,,,,,],[3,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,15,,,,,,,,,,,,,,,,,,,,,,,,27,,,,,,,,]],[[10,-1,6,,,,10,,,,13,,.02,,.04,,.06,,.08,,.1,,.12,,.14,,.16,,.18,,8,,,,10,,.02,,.04,,.06,,.08,,.1,,.12,,.14,,.16,,.18,,.2,,.22,,.24,,.26,,.28,,.3,,],[5,,18,,30,,,,18,,18,,30,,18,.92,,,18,,30,,,,18,,18,,,,18,,18,,30,,18,,,,18,,18,,30,,18,.92,,,30,,18,,,,18,,18,,,,18,,30,,],[,-1,18.5,,18.38,,30.5,,18.38,,18.5,,25.38,,30.5,,30.38,,25.5,,27.38,,18.5,,30.38,,18.5,,30.38,,25.5,,27.38,,18.5,,18.38,,30.5,,18.38,,18.5,,25.38,,30.5,,30.38,,25.5,,27.38,,18.5,,30.38,,18.5,,30.38,,25.5,,27.38,,],[4,,24,,,,,,,,,,,,,,,,24,,24,,,,,,,,,,,,,,24,,,,,,,,,,,,,,,,24,,24,,,,,,,,,,,,,,],[7,,,,25,,,,,,,,25,,25,,25,,,,,,25,,,,,,,,25,,25,,,,25,,,,,,,,25,,25,,25,,,,,,25,,,,,,,,25,,25,,],[3,,,,,,18.5,.92,,,,,,,,,18.5,.92,,,,,18.5,.92,,,,,18.5,.92,,,,,,,,,18.5,.92,,,,,,,,,18.5,.92,,,,,18.5,.92,,,,,18.5,.92,,,,,],[8,1,,,,,27,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,27,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[5,1,,,,,,,32,,,,,,,,,,,,,,,,32,,,,,,,,,,,,,,,,32,,,,,,,,,,,,,,,,32,,,,,,,,,,],[6,1,,,,,,,,,22,,,,,,,,,,,,,,,,22,,22.75,,,,,,,,,,,,,,22,,,,,,,,,,,,,,,,22,,22.75,,,,,,]],[[10,-1,1,,.02,,.04,,.06,,.08,,.1,,.12,,.14,,.16,,.18,,.2,,.22,,.24,,.26,,.28,,.3,,5,,.02,,.04,,.06,,3,,.02,,.04,,.06,,.08,,.1,,.12,,.14,,.16,,.18,,.2,,.22,,],[5,,13,,25,,,,13,,13,,25,,13,.92,,,13,,25,,,,13,,13,,,,13,,13,,27,,15,,,,15,,15,,27,,15,.92,,,27,,15,,,,15,,15,,,,15,,27,,],[,-1,13.5,,13.38,,25.5,,13.38,,13.5,,20.38,,25.5,,25.38,,20.5,,22.38,,13.5,,25.38,,13.5,,25.38,,20.5,,22.38,,15.5,,15.38,,27.5,,15.38,,15.5,,22.38,,27.5,,27.38,,22.5,,24.38,,15.5,,27.38,,15.5,,27.38,,22.5,,24.38,,],[4,,24,,,,,,,,,,,,,,,,24,,24,,,,,,,,,,,,,,24,,,,,,,,,,,,,,,,24,,24,,,,,,,,,,,,,,],[7,,,,25,,,,,,,,25,,25,,25,,,,,,25,,,,,,,,25,,25,,,,25,,,,,,,,25,,25,,25,,,,,,25,,,,,,,,25,,25,,],[3,,,,,,13.5,.92,,,,,,,,,13.5,.92,,,,,13.5,.92,,,,,13.5,.92,,,,,,,,,15.5,.92,,,,,,,,,15.5,.92,,,,,15.5,.92,,,,,15.5,.92,,,,,],[8,1,,,,,27,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,27,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[5,1,,,,,,,32,,,,,,,,,,,,,,,,32,,,,,,,,,,,,,,,,32,,,,,,,,,,,,,,,,32,,,,,,,,,,],[6,1,,,,,,,,,22,,,,,,,,,,,,,,,,22,,22.75,,,,,,,,,,,,,,22,,,,,,,,,,,,,,,,22,,22.75,,,,,,]]],[0,1,0,1,0,1,3,4,5,6,5,6],187.5,{title:"mourning off v - 2021",instruments:["sz1 2021","1","2","3","4","5","6","7","8","9","10","11"],patterns:["Pattern 17","Pattern 18","Pattern 22","Pattern 24","Pattern 25","Pattern 26","Pattern 27"]}],{canvas:U,context:V}=function(i){if(e=document.getElementById(i)||i||document.querySelector("canvas"),!e)throw Error("You must provide a canvas element for the game");return t=e.getContext("2d"),t.imageSmoothingEnabled=!1,s("init"),{canvas:e,context:t}}();let $;V.webkitImageSmoothingEnabled=!1,V.mozImageSmoothingEnabled=!1,V.imageSmoothingEnabled=!1;const X=()=>{U.width=window.innerWidth,U.height=window.innerHeight,$&&$.fitToScreen(U)};window.addEventListener("resize",X,!1),X();const D=e=>T({update:()=>{},render:()=>{const t=V.canvas.width/2,i=V.canvas.height/3;V.save(),V.lineWidth=2,V.fillStyle="rgb(00,120,00)",V.font="bold 60px impact ",V.fillText("GREEN SPACE",t-170,i-40),V.strokeStyle="rgb(00,255,00)",V.strokeText("GREEN SPACE",t-170,i-40),V.fillStyle="rgb(10,10,10)",V.fillText("vs parking",t-160,i),V.strokeStyle="darkgrey",V.strokeText("vs parking",t-160,i),V.fillStyle="white",V.font="bold 30px Sans-serif",V.fillText(e,t-135,i+50),V.restore()}});let K=D("LOADING...");K.start(),function(...e){return w(),Promise.all(e.map((e=>{let t=g([].concat(e)[0]);return t.match(o)?(i=e,w(),new Promise(((e,t)=>{let n,r,o;if(n=u("",i),x[n])return e(x[n]);r=new Image,r.onload=function(){o=d(n,window.location.href),x[f(i)]=x[n]=x[o]=this,s("assetLoaded",this,i),e(this)},r.onerror=function(){t("Unable to load image "+n)},r.src=n}))):t.match(l)?function(e){return new Promise(((t,i)=>{let n,r,o,l,a=e;var h;return n=new Audio,r={wav:(h=n).canPlayType('audio/wav; codecs="1"'),mp3:h.canPlayType("audio/mpeg;"),ogg:h.canPlayType('audio/ogg; codecs="vorbis"'),aac:h.canPlayType("audio/aac;")},(e=[].concat(e).reduce(((e,t)=>e||(r[g(t)]?t:null)),0))?(o=u("",e),y[o]?t(y[o]):(n.addEventListener("canplay",(function(){l=d(o,window.location.href),y[f(e)]=y[o]=y[l]=this,s("assetLoaded",this,e),t(this)})),n.onerror=function(){i("Unable to load audio "+o)},n.src=o,void n.load())):i("cannot play any of the audio formats provided "+a)}))}(e):function(e){let t,i;return w(),t=u("",e),m[t]?Promise.resolve(m[t]):fetch(t).then((e=>{if(!e.ok)throw e;return e.clone().json().catch((()=>e.text()))})).then((n=>(i=d(t,window.location.href),"object"==typeof n&&c.set(n,i),m[f(e)]=m[t]=m[i]=n,s("assetLoaded",n,e),n)))}(e);var i})))}("tiles.png","blue_flower.png","vine.png","cone.png","roller.png").then((()=>{$=new W;const e=zzfxM(...H);null==K||K.stop(),K=D("CLICK TO START"),K.start(),X(),addEventListener("click",(t=>{var i;K?(K.stop(),K=null,i=e,zzfxP(...i).loop=!0,$.start()):$.onClick(t)}))})).catch((e=>{console.warn("Error loading assets:",e)}));
