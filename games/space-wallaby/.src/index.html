<!DOCTYPE html><meta charset=utf-8><meta content="width=device-width,initial-scale=1"name=viewport><title>Space Wallaby</title><link href=f.png rel="shortcut icon"type=image/png><style>body{color:#fff;background-color:#111;margin:0}canvas{position:absolute;border-radius:2vmin;box-shadow:1vmin 1vmin 4vmin rgba(0,0,0,.4);animation:1s ease-out 1 fadeIn}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@media (prefers-color-scheme:light){body{color:#000;background:#fff}}</style><div style=display:none><img id=a src=a.png> <img id=b src=b.png> <img id=c src=c.png> <img id=d src=d.png> <img id=e src=e.png> <img id=f src=f.png> <img id=g src=g.png> <img id=h src=h.png> <img id=i src=i.png></div><canvas id=canvas></canvas><script>let t,e,a;e=.1,t=(t=1,e=.05,o=220,i=0,n=0,l=.1,s=0,r=1,c=0,d=0,p=0,h=0,y=0,u=0,f=0,g=0,m=0,b=1,v=0,x=0)=>{let w,M,I=Math,S=44100,k=2*I.PI,z=c*=500*k/S/S,C=o*=(1-e+2*e*I.random(e=[]))*k/S,T=0,P=0,R=0,V=1,E=0,D=0,j=0;for(d*=500*k/S**3,f*=k/S,p*=k/S,h*=S,y=S*y|0,M=(i=S*i+9)+(v*=S)+(n*=S)+(l*=S)+(m*=S)|0;R<M;e[R++]=j)++D%(100*g|0)||(j=s?1<s?2<s?3<s?I.sin((T%k)**3):I.max(I.min(I.tan(T),1),-1):1-(2*T/k%2+2)%2:1-4*I.abs(I.round(T/k)-T/k):I.sin(T),j=(y?1-x+x*I.sin(k*R/y):1)*(0<j?1:-1)*I.abs(j)**r*t*.1*(R<i?R/i:R<i+v?1-(R-i)/v*(1-b):R<i+v+n?b:R<M-m?(M-R-m)/l*b:0),j=m?j/2+(m>R?0:(R<M-m?1:(M-R)/m)*e[R-m|0]/2):j),w=(o+=c+=d)*I.cos(f*P++),T+=w-w*u*(1-1e9*(I.sin(R)+1)%2),V&&++V>h&&(o+=p,C+=p,V=0),!y||++E%y||(o=C,c=z,V=V||1);return(t=a.createBuffer(1,M,S)).getChannelData(0).set(e),(o=a.createBufferSource()).buffer=t,o.connect(a.destination),o.start(),o},a=new(window.AudioContext||webkitAudioContext);const o={add:(t,e)=>({x:t.x+e.x,y:t.y+e.y}),subtract:(t,e)=>({x:t.x-e.x,y:t.y-e.y}),multiply:(t,e)=>({x:t.x*e.x,y:t.y*e.y}),dot:(t,e)=>t.x*e.x+t.y*e.y,scale:(t,e)=>({x:t.x*e,y:t.y*e}),rotate:(t,e)=>{const a=Math.sin(e),o=Math.cos(e);return{x:o*t.x-a*t.y,y:a*t.x+o*t.y}},angle:t=>Math.atan2(t.y,t.x),length:t=>Math.hypot(t.x,t.y),length2:t=>t.x**2+t.y**2,normalize:t=>{const e=o.length(t);return 0===e?t:o.scale(t,1/e)},floor:t=>({x:Math.floor(t.x),y:Math.floor(t.y)}),flip:t=>({x:t.y,y:t.x}),distance:(t,e)=>o.length(o.subtract(e,t))},i={action:!1,pause:!1,gameOver:!1},n=["#cbd1be","#8f9389","#52534c","#26201d","#e0a46e","#91a47a","#5d7643","#4d533a","#a93130","#7a1338","#834664","#917692","#160712","#593084","#3870be","#579fb4"],l=document.getElementById("d"),s=t=>{let e=0;const a=l.naturalHeight;t.toLowerCase().split("").forEach(t=>{const o="naobpcdresftguhvijkxlyz0123456789: ".indexOf(t);-1===o?e--:(w.drawImage(l,3*o,0,3,a,e,0,3,a),e+=4)})},r=Date.now(),c=t=>()=>(2**31-1&(t=Math.imul(48271,t+r)))/2**31,d={baseJoeyDistance:200,randomJoeyDistance:100,cageChance:0,baseButtonDistance:50,randomButtonDistance:10,planetChance:.4,basePlanetRadius:3,randomPlanetRadius:6,basePlanetRotationalVelocity:1,randomPlanetRotationalVelocity:3,spaceshipChance:.001,baseSpaceshipSpeed:6,randomSpaceshipSpeed:4,baseSpaceshipRotationSpeed:.1,randomSpaceshipRotationSpeed:1,spaceshipIdleTime:5e3},p=t=>{const e=o.floor(o.scale(t,1/42));return e.id=1e9*e.y+e.x,e};let h=[];const y={0:{planet:!1,spaceship:!1}},u={view:{size:100,minSize:100,maxSize:200,playerDistanceSizeFactor:4,speed:2},keep:!0,position:{x:0,y:0},velocity:{x:0,y:0}},f={sprite:{imageId:"i",scale:.5},wallaby:{charge:0,jumpSpeed:40,boostSpeed:120,attachedChargeFactor:.4,floatingChargeFactor:.1,boostingChargeFactor:-1,score:0,lives:2},keep:!0,position:{x:0,y:0},velocity:{x:0,y:0},damping:.1,rotation:0,rotationalVelocity:0,gravity:2,collision:{radius:6,attach:!0}};let g=[u,f];const m=(t,e)=>{const a=t-e;return a>Math.PI?a-2*Math.PI:a<=-Math.PI?a+2*Math.PI:a};let b=performance.now();const v=()=>{(()=>{const e=performance.now(),a=e-b,l=a/1e3;if(b=e,i.pause||i.gameOver)return;if(!g.some(t=>null!=t.sprite&&"f"===t.sprite.imageId)){const t=0===f.wallaby.score?84:Math.random()*d.randomJoeyDistance+d.baseJoeyDistance,e=p(o.add(f.position,o.rotate({x:t,y:0},2*Math.random()*Math.PI)));if(y[e.id]={joey:!0,planet:!0},g.push({sprite:{imageId:"f",scale:.5},keep:!0,chunkId:e.id,position:o.scale(e,42),velocity:{x:0,y:0},rotation:0,rotationalVelocity:0,collision:{radius:4,attach:!0}}),Math.random()<d.cageChance){const t=p(o.add(o.scale(o.add(e,{x:.5,y:.5}),42),o.rotate({x:Math.random()*d.randomButtonDistance+d.baseButtonDistance,y:0},2*Math.random()*Math.PI)));y[e.id].cage=!0,y[t.id]={button:e.id,planet:!0}}}const s=h;h=[];const r=o.scale({x:1,y:1},u.view.size/2),v=o.subtract(u.position,r),x=o.add(u.position,r);for(let t=v.x-42;t<=x.x+42;t+=42)for(let e=v.y-42;e<=x.y+42;e+=42)h.push(p({x:t,y:e}));const w=h.filter(t=>!s.some(e=>e.id===t.id));for(let t of w){const e=c(t.id),a=o.scale(t,42),i=y[t.id];if(null==i||null==i.stars||i.stars){const i=Math.ceil(3*e());for(let l=0;l<i;l++)g.push({star:{size:e()+.5,color:n[Math.floor(2*e()+1)]},chunkId:t.id,position:o.add(a,o.scale({x:e(),y:e()},42))})}if(null==i||null==i.planet?e()<d.planetChance:i.planet){const l=o.floor(o.add(a,o.scale({x:.4*e(),y:.4*e()},42))),s=[1,2,5,6,8,9,10,13,14],r=s[Math.floor(e()*s.length)],c=e()<.5,p={planet:{radius:Math.ceil(e()*d.randomPlanetRadius+d.basePlanetRadius),stripeSpacing:Math.ceil(3*e()),firstColor:n[c?r+1:r],secondColor:n[c?r:r+1]},spring:{origin:l,stiffness:.1},chunkId:t.id,position:l,velocity:{x:0,y:0},damping:.8,rotation:2*e()*Math.PI,rotationalVelocity:(e()*d.randomPlanetRotationalVelocity+d.basePlanetRotationalVelocity)*(e()<.5?1:-1)};if(g.push(p),null!=i&&i.joey){const e=g.find(e=>null!=e.sprite&&"f"===e.sprite.imageId&&e.chunkId===t.id);e.rotation=0,e.position=o.add(p.position,{x:0,y:-1}),null!=i&&i.cage&&g.push({sprite:{imageId:"c",scale:.5},chunkId:t.id,position:e.position,velocity:{x:0,y:0},rotation:e.rotation,rotationalVelocity:0,collision:{radius:4,attach:!0}})}null!=i&&i.button&&g.push({button:{cageChunkId:i.button},sprite:{imageId:"b",scale:.8},chunkId:t.id,position:o.add(p.position,{x:0,y:-1}),velocity:{x:0,y:0},rotation:0,rotationalVelocity:0,collision:{radius:2,attach:!0}})}(null==i||null==i.spaceship?Math.random()<d.spaceshipChance:i.spaceship)&&g.push({spaceship:{speed:Math.random()*d.randomSpaceshipSpeed+d.baseSpaceshipSpeed,rotationSpeed:Math.random()*d.randomSpaceshipRotationSpeed+d.baseSpaceshipRotationSpeed,state:"boost",since:0},sprite:{imageId:"h",scale:.75},position:a,velocity:{x:0,y:0},damping:.4,rotation:2*Math.random()*Math.PI,rotationalVelocity:0,rotationalDamping:.4,collision:{radius:6,attach:!1}})}if(u.velocity=o.scale(o.add(o.scale(f.velocity,.2),o.subtract(f.position,u.position)),u.view.speed),u.view.size=Math.min(u.view.maxSize,o.distance(f.position,u.position)*u.view.playerDistanceSizeFactor+u.view.minSize),!f.attachedTo){let t={x:0,y:0};for(let e of g.filter(t=>t.planet)){const a=o.subtract(e.position,f.position);t=o.add(t,o.scale(a,1/o.length(a)**4))}f.rotation=o.angle(t)-.5*Math.PI}if(i.action)if(f.attachedTo){t(.2,0,200,.05,.01,.18,2,1.03,8.9,0,0,0,0,.3,0,.1,0,.79,.04);const e=o.normalize(o.scale(o.subtract(f.attachedTo.position,f.position),-1));f.position=o.add(f.position,e),f.velocity=o.rotate(o.scale(e,f.wallaby.jumpSpeed),f.attachedTo.rotationalVelocity*l),f.attachedTo=null}else if(f.wallaby.charge>0){t(.05,0,1e3,0,0,.01,0,0,0,0,0,0,0,1e3,0,.3),f.wallaby.charge+=f.wallaby.boostingChargeFactor*l;const e=o.rotate({x:0,y:-1},f.rotation);f.velocity=o.add(f.velocity,o.scale(e,f.wallaby.boostSpeed*l));for(let t=0;t<a/6;t++)g.push({particle:{color:n[0],size:Math.random()+.5},age:0,lifetime:500*Math.random()+400,position:f.position,velocity:o.scale(o.rotate(e,2*(Math.random()-.5)),-(10*Math.random()+10)),collision:{radius:1,attach:!1}})}else i.action=!1;f.attachedTo?f.wallaby.charge+=f.wallaby.attachedChargeFactor*l:f.wallaby.charge+=f.wallaby.floatingChargeFactor*l,f.wallaby.charge=Math.max(0,Math.min(1,f.wallaby.charge));for(let e of g.filter(t=>t.spaceship)){e.spaceship.since+=a;const i=o.rotate({x:1,y:0},e.rotation),s=Math.min(1,10/o.distance(f.position,e.position));let r;switch(e.spaceship.state){case"idle":e.spaceship.since>d.spaceshipIdleTime&&(r=Math.random()<.4?"boost":"rotate");break;case"rotate":let c=m(o.angle(o.subtract(f.position,e.position)),e.rotation);e.rotationalVelocity+=c*e.spaceship.rotationSpeed*l,e.spaceship.since>1e3&&(r=Math.random()<.3?"boost":"shoot");break;case"boost":t(.05*s,0,1e6,0,0,.01,0,0,0,0,0,0,0,1e3,0,.3),e.velocity=o.add(e.velocity,o.scale(i,e.spaceship.speed*l));const p={x:-3,y:7},h=Math.round(Math.random()),y=o.rotate(p,e.rotation),u=o.rotate(o.multiply(p,{x:1,y:-1}),e.rotation);for(let t=0;t<a/8;t++)g.push({particle:{color:n[0],size:Math.random()+.5},age:0,lifetime:200*Math.random()+100,position:o.add(e.position,t%2===h?y:u),velocity:o.scale(o.rotate(i,Math.random()-.5),-(10*Math.random()+20)),collision:{radius:1}});e.spaceship.since>2e3&&(r=Math.random()<.7?"idle":"shoot");break;case"shoot":t(s,0,465,0,.06,.03,3,1.37,-7.8,0,0,0,.09,0,0,.1,.06,.92,.01,.43),g.push({sprite:{imageId:"g",scale:.75},position:o.add(e.position,o.scale(i,6)),velocity:o.scale(i,10),rotation:e.rotation,rotationalVelocity:0,collision:{radius:1,destroy:!0}}),r="idle"}r&&(e.spaceship.since=0,e.spaceship.state=r)}for(let t of g.filter(t=>t.gravity&&!t.attachedTo)){let e={x:0,y:0};for(let a of g.filter(t=>t.planet)){const i=o.subtract(a.position,t.position),n=o.length(i);e=o.add(e,o.scale(o.normalize(i),a.planet.radius**3/n))}t.velocity=o.add(t.velocity,o.scale(e,t.gravity*l))}for(let t of g.filter(t=>t.collision&&!t.attachedTo))for(let e of g.filter(t=>t.planet)){const a=o.subtract(e.position,t.position),n=e.planet.radius+t.collision.radius;if(!(o.length(a)>n)){if(t.collision.attach){t===f&&(i.action=!1,t.rotation=o.angle(a)-.5*Math.PI);const l=o.subtract(t.velocity,e.velocity),s=o.normalize(o.multiply(o.flip(o.subtract(e.position,t.position)),{x:1,y:-1})),r=o.dot(l,s),c=o.scale(s,r),d=o.scale(o.subtract(l,c),1);e.velocity=o.scale(d,1/4),t.velocity={x:0,y:0},t.rotationalVelocity=0,t.position=o.add(e.position,o.scale(o.normalize(a),-n)),t.attachedTo=e}else if(t.collision.destroy)t.destroy=!0;else{const i=o.normalize(a),n=o.subtract(t.velocity,e.velocity);if(o.dot(n,i)<0)continue;const l=o.normalize(o.multiply(o.flip(a),{x:1,y:-1})),s=o.dot(n,l),r=o.scale(l,s),c=o.scale(o.subtract(n,r),1);t.velocity=o.scale(c,-3/4)}break}}for(let e of g.filter(t=>t.collision)){if(!(o.distance(e.position,f.position)>e.collision.radius+f.collision.radius))if(null!=e.sprite&&"f"===e.sprite.imageId){if(null!=y[e.chunkId]&&y[e.chunkId].cage)continue;t(1.93,0,342,0,.01,.23,0,1.28,0,0,98,.09,0,.1,0,0,.08,.72,.04),f.wallaby.score++,d.baseJoeyDistance+=20,d.cageChance=Math.min(.9,d.cageChance+.05),d.basePlanetRotationalVelocity+=.5,d.spaceshipChance*=1.5,d.spaceshipIdleTime*=.8,e.destroy=!0,delete y[e.chunkId].joey}else if(e.button){t(2.1,0,1928,.01,.03,.04,2,2.54,6.1,-65,0,0,.01,0,0,0,.11,.09,.05,.61);const a=g.find(t=>null!=t.sprite&&"c"===t.sprite.imageId&&t.chunkId===e.button.cageChunkId);a&&(a.destroy=!0),delete y[e.button.cageChunkId].cage,e.sprite.imageId="a",delete e.button,delete y[e.chunkId].button}else null!=e.sprite&&"g"===e.sprite.imageId&&(t(1.55,0,309,0,.08,.18,3,1.6,-6.7,0,0,0,0,.3,0,.1,.05,.69,.03),f.wallaby.lives--,e.destroy=!0)}for(let t of g.filter(t=>t.velocity))t.attachedTo?t.position=o.add(t.position,o.scale(t.attachedTo.velocity,l)):t.position=o.add(t.position,o.scale(t.velocity,l));for(let t of g.filter(t=>t.spring))t.velocity=o.add(t.velocity,o.scale(o.subtract(t.spring.origin,t.position),t.spring.stiffness));for(let t of g.filter(t=>null!==t.rotationalVelocity)){if(t.attachedTo){const e=t.attachedTo.rotationalVelocity*l,a=o.rotate(o.subtract(t.position,t.attachedTo.position),e);t.position=o.add(t.attachedTo.position,a),t.rotation+=e}else t.rotation+=t.rotationalVelocity*l;t.rotation%=2*Math.PI}for(let t of g.filter(t=>t.damping))t.velocity=o.scale(t.velocity,1-t.damping*l);for(let t of g.filter(t=>t.rotationalDamping))t.rotationalVelocity*=1-t.rotationalDamping*l;for(let t of g.filter(t=>null!=t.age))t.age+=a;if(f.wallaby.lives<=0){i.gameOver=!0;for(let t of g.filter(t=>!t.star&&t!==u))t.destroy=!0}g.filter(t=>!t.keep).filter(t=>t.chunkId&&!h.some(e=>e.id===t.chunkId)||o.distance(t.position,u.position)>2*u.view.size||t.lifetime&&t.age>t.lifetime).forEach(t=>t.destroy=!0),g=g.filter(t=>!t.destroy);for(let t of g.filter(t=>null!=t.attachedTo&&t.attachedTo.destroy))t.attachedTo=null})(),w.fillStyle=n[12],w.fillRect(0,0,x.width,x.height),w.save();const e=x.width/u.view.size;w.scale(e,e);const a=o.add(u.position,o.scale({x:1,y:1},-u.view.size/2));w.translate(-a.x,-a.y);for(let t of g.filter(t=>t.star))w.fillStyle=t.star.color,w.fillRect(t.position.x,t.position.y,t.star.size,t.star.size);for(let t of g.filter(t=>t.planet)){w.save(),w.translate(t.position.x,t.position.y),w.rotate(t.rotation),w.translate(-.5,-.5);const e={},a=(t,a)=>e[a]=a in e?Math.max(e[a],t):t,o=t.planet.radius;let i=o,n=0;a(+i,+n);let l=1-o;for(;i>n&&(n++,l<=0?l+=2*n+1:(i--,l+=2*n-2*i+1),!(i<n));)a(+i,+n),a(+i,-n),i!==n&&(a(+n,+i),a(+n,-i));const s=c(t.chunkId);for(let a=-o;a<=o;a++){const o=e[a];w.fillStyle=t.planet.firstColor,w.fillRect(-o,a,2*o+1,1.1),a%t.planet.stripeSpacing==0&&(w.fillStyle=t.planet.secondColor,w.fillRect(-o,a,Math.ceil(2*s()*o),1.1))}w.restore()}for(let t of g.filter(t=>t.particle)){w.save(),w.globalAlpha=1-t.age/t.lifetime,w.fillStyle=t.particle.color;const e=t.particle.size;w.fillRect(t.position.x-e/2,t.position.y-e/2,e,e),w.restore()}for(let t of g.filter(t=>t.sprite)){w.save(),w.translate(t.position.x,t.position.y),w.rotate(t.rotation);const e=document.getElementById(t.sprite.imageId),a=o.scale({x:e.naturalWidth,y:e.naturalHeight},t.sprite.scale);w.translate(-a.x/2,-a.y/2),w.drawImage(e,0,0,e.naturalWidth,e.naturalHeight,0,0,a.x,a.y),w.restore()}w.restore(),w.fillStyle=n[0];const l=x.width/48;if(i.gameOver)w.save(),w.scale(l,l),w.translate(0,5),s("  ...gan..ne over"),w.translate(0,15),s("     ."+"000".concat(f.wallaby.score).substring(f.wallaby.score.toString().length)),w.translate(0,8),w.scale(.5,.5),s("      joeys rescued"),w.translate(0,25),w.globalAlpha=.5,s("    tap to try again"),w.restore(),i.action&&location.reload();else{for(let t of g.filter(t=>null!=t.sprite&&"f"===t.sprite.imageId)){const e=o.subtract(t.position,u.position),a=o.length(e),i=40/a+1;w.save(),w.globalAlpha=Math.max(0,Math.min(1,(a-60)/10)),w.translate(x.width/2,x.height/2),w.rotate(o.angle(e)),w.translate(10*l,0),w.scale(i,i),w.beginPath(),w.moveTo(0,-l),w.lineTo(l,0),w.lineTo(0,l),w.fill(),w.restore()}w.fillRect(0,0,x.width*f.wallaby.charge,l/2);const t=document.getElementById("e");w.save(),w.translate(x.width,x.height),w.scale(l/4,l/4),w.translate(-2,-8);for(let e=1;e<=f.wallaby.lives;e++)w.drawImage(t,-e*(t.naturalWidth+1),0);w.restore(),w.save(),w.translate(0,x.height),w.scale(l/4,l/4),w.translate(2,-8),s("000".concat(f.wallaby.score).substring(f.wallaby.score.toString().length)),w.restore()}requestAnimationFrame(v)},x=document.getElementById("canvas"),w=x.getContext("2d",{alpha:!1,desynchronized:!0});window.addEventListener("blur",()=>i.pause=!0),window.addEventListener("focus",()=>i.pause=!1),x.addEventListener("mousedown",()=>i.action=!0),x.addEventListener("mouseup",()=>i.action=!1),x.addEventListener("touchstart",()=>i.action=!0),x.addEventListener("touchend",()=>i.action=!1),document.addEventListener("keydown",t=>{t.repeat||(" "===t.key&&(i.action=!0),"Escape"===t.key?i.pause=!i.pause:i.pause=!1)}),document.addEventListener("keyup",t=>{t.repeat||" "===t.key&&(i.action=!1)});const M=()=>{const t=Math.min(Math.floor(Math.min(window.innerWidth,window.innerHeight)/32),24);x.width=x.height=32*t,x.style.left=(window.innerWidth-x.width)/2+"px",x.style.top=(window.innerHeight-x.height)/2+"px",w.imageSmoothingEnabled=!1};window.addEventListener("resize",M),M(),v()</script>