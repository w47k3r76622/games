<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />
<title>js13k</title>
<style>
body {background: black;}
canvas {background-image: url("brickthing.png");background-repeat: repeat;width: 100%;max-width: 80vw;display: block;margin: auto;}
</style>
</head>
<body>
<canvas id="canvas" height="480" width="854"></canvas>
<script>!function(){"use strict";if("function"!=typeof e||void 0===t)if("function"==typeof e&&"undefined"!=typeof webkitURL)var t=webkitURL;else var e=function(t){var e=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder||function(t){var e=function(t){return Object.prototype.toString.call(t).match(/^\[object\s(.*)\]$/)[1]},n=function(){this.data=[]},o=function(t,e,n){this.data=t,this.size=t.length,this.type=e,this.encoding=n},i=n.prototype,a=o.prototype,r=t.FileReaderSync,c=function(t){this.code=this[this.name=t]},u="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),l=u.length,s=t.URL||t.webkitURL||t,d=s.createObjectURL,f=s.revokeObjectURL,R=s,p=t.btoa,h=t.atob,b=!1,g=function(t){b=!t},B=t.ArrayBuffer,U=t.Uint8Array;for(o.fake=a.fake=!0;l--;)c.prototype[u[l]]=l+1;try{U&&g.apply(0,new U(3528e4))}catch(t){}return s.createObjectURL||(R=t.URL={}),R.createObjectURL=function(t){var e,n=t.type;return null===n&&(n="application/octet-stream"),t instanceof o?(e="data:"+n,"base64"===t.encoding?e+";base64,"+t.data:"URI"===t.encoding?e+","+decodeURIComponent(t.data):p?e+";base64,"+p(t.data):e+","+encodeURIComponent(t.data)):d?d.call(s,t):void 0},R.revokeObjectURL=function(t){"data:"!==t.substring(0,5)&&f&&f.call(s,t)},i.append=function(t){var n=this.data;if(U&&(t instanceof B||t instanceof U))if(b)n.push(String.fromCharCode.apply(String,new U(t)));else{for(var i="",a=new U(t),u=0,l=a.length;u<l;u++)i+=String.fromCharCode(a[u]);n.push(i)}else if("Blob"===e(t)||"File"===e(t)){if(!r)throw new c("NOT_READABLE_ERR");var s=new r;n.push(s.readAsBinaryString(t))}else t instanceof o?"base64"===t.encoding&&h?n.push(h(t.data)):"URI"===t.encoding?n.push(decodeURIComponent(t.data)):"raw"===t.encoding&&n.push(t.data):("string"!=typeof t&&(t+=""),n.push(unescape(encodeURIComponent(t))))},i.getBlob=function(t){return arguments.length||(t=null),new o(this.data.join(""),t,"raw")},i.toString=function(){return"[object BlobBuilder]"},a.slice=function(t,e,n){var i=arguments.length;return i<3&&(n=null),new o(this.data.slice(t,i>1?e:this.data.length),n,this.encoding)},a.toString=function(){return"[object Blob]"},n}(t);return function(t,n){var o=n?n.type||"":"",i=new e;if(t)for(var a=0,r=t.length;a<r;a++)i.append(t[a]);return i.getBlob(o)}}(self)}();</script>
<script>
!function(){"use strict";function t(t,n){H[t]=H[t]||[],H[t].push(n)}function n(t,...n){H[t]&&H[t].map(t=>t(...n))}function i(){return G}function e(){return U}function o(t){if(!(G=document.getElementById(t)||t||document.querySelector("canvas")))throw Error("You must provide a canvas element for the game");return U=G.getContext("2d"),U.imageSmoothingEnabled=!1,n("init"),{canvas:G,context:U}}function f(t){return new Y(t)}function a(t,n){return new URL(t,n).href}function r(t,n){return[t.replace($,""),t?n.replace(X,""):n].filter(t=>t).join("/")}function h(t){return t.split(".").pop()}function s(t){let n=t.replace("."+h(t),"");return 2==n.split("/").length?n.replace(X,""):n}function c(t){return{wav:"",mp3:t.canPlayType("audio/mpeg;"),ogg:t.canPlayType('audio/ogg; codecs="vorbis"'),aac:t.canPlayType("audio/aac;")}}function u(){window.__k||(window.__k={dm:J,u:a,d:Q,i:Z})}function l(t){N=t}function d(t){return u(),new Promise((i,e)=>{let o,f,h;o=r(N,t);if(Z[o])return i(Z[o]);f=new Image;f.onload=function(){h=a(o,window.location.href),Z[s(t)]=Z[o]=Z[h]=this,n("assetLoaded",this,t),i(this)};f.onerror=function(){e("Unable to load image "+o)};f.src=o})}function p(t){return new Promise((i,e)=>{let o,f,u,l;o=new Audio;f=c(o);t=[].concat(t).reduce((t,n)=>t||(f[h(n)]?n:null),0);if(!t)return e("cannot play any of the audio formats provided"+t);u=r(V,t);if(z[u])return i(z[u]);o.addEventListener("canplay",function(){l=a(u,window.location.href),z[s(t)]=z[u]=z[l]=this,n("assetLoaded",this,t),i(this)});o.onerror=function(){e("Unable to load audio "+u)};o.src=u;o.load()})}function m(t){u();let i,e;return i=r(K,t),Q[i]?Promise.resolve(Q[i]):fetch(i).then(t=>{if(!t.ok)throw t;return t.clone().json().catch(()=>t.text())}).then(o=>{e=a(i,window.location.href);"object"==typeof o&&J.set(o,e);Q[s(t)]=Q[i]=Q[e]=o;n("assetLoaded",o,t);return o})}function x(...t){return u(),Promise.all(t.map(t=>{let n=h([].concat(t)[0]);return n.match(q)?d(t):n.match(F)?p(t):m(t)}))}function g(){let t=i();e().clearRect(0,0,t.width,t.height)}function y({fps:fps=60,clearCanvas:clearCanvas=!0,update:update,render:render}={}){function t(){if(e=requestAnimationFrame(t),o=performance.now(),f=o-i,i=o,!(f>1e3)){for(n("tick"),r+=f;r>=h;)a.update(s),r-=h;c(),a.render()}}if(!update||!render)throw Error("You must provide update() and render() functions");let i,e,o,f,a,r=0,h=1e3/fps,s=1/fps,c=clearCanvas?g:tt;return a={update:update,render:render,isStopped:!0,start(){i=performance.now(),this.isStopped=!1,requestAnimationFrame(t)},stop(){this.isStopped=!0,cancelAnimationFrame(e)},_frame:t,set _last(t){i=t}}}function w(t){let n=et[t.which];it[n]=!0,nt[n]&&nt[n](t)}function v(t){it[et[t.which]]=!1}function _(){it={}}function M(t,n){[].concat(t).map(t=>nt[t]=n)}function S(t){return!!it[t]}function b(t){let n=t.x,i=t.y;t.anchor&&(n-=t.width*t.anchor.x,i-=t.height*t.anchor.y);let e=st.x-Math.max(n,Math.min(st.x,n+t.width)),o=st.y-Math.max(i,Math.min(st.y,i+t.height));return e*e+o*o<st.radius*st.radius}function T(){let t,n=ft.length?ft:ot;for(let i=n.length-1;i>=0;i--)if(t=n[i],t.collidesWithPointer?t.collidesWithPointer(st):b(t))return t}function L(t){let n=void 0!==t.button?ht[t.button]:"left";rt[n]=!0,P(t,"onDown")}function k(t){let n=void 0!==t.button?ht[t.button]:"left";rt[n]=!1,P(t,"onUp")}function R(t){P(t,"onOver")}function A(){rt={}}function P(t,n){let e=i();if(e){let i,o;-1!==["touchstart","touchmove","touchend"].indexOf(t.type)?(i=(t.touches[0]||t.changedTouches[0]).clientX,o=(t.touches[0]||t.changedTouches[0]).clientY):(i=t.clientX,o=t.clientY);let f=e.height/e.offsetHeight,a=e.getBoundingClientRect(),r=(i-a.left)*f,h=(o-a.top)*f;st.x=r,st.y=h,t.preventDefault();let s=T();s&&s[n]&&s[n](t),at[n]&&at[n](t,s)}}function E(t,n,i={}){let e=new ct(t,n);return i._c&&(e.clamp(i._a,i._b,i._d,i._e),e.x=t,e.y=n),e}function W(t){return new ut(t)}function C(t){if(+t===t)return t;let n=[],i=t.split(".."),e=+i[0],o=+i[1],f=e;if(e<o)for(;f<=o;f++)n.push(f);else for(;f>=o;f--)n.push(f);return n}function I(t){return new lt(t)}function D(t){var n=!1,i=new dt;i.init(t),setInterval(function(){if(!n&&(n=i.generate()>=1)){var e=i.createWave();vt[t.name]=URL.createObjectURL(new Blob([e],{type:"audio/wav"})),_t[t.name]=!0}},0)}function j(){if(At){var t=Mt.play();void 0!==t&&t.then(function(t){}).catch(function(t){At=!1})}else Mt.pause()}function O(){var t=[],n=[430,340,244,148,52],i=1,e=0,o=!1,f=0,a=0,r=!1;l("."),x("platform.png","walkcycle.png","ghost.png").then(function(){function h(t){var n=t.y+t.height;return!(n>=d.y||n>=p[0].y&&n<_&&t.x+t.width>=p[0].x+10||n>=p[1].y&&n<M&&t.x<=p[1].x+p[1].width-10||n>=p[2].y&&n<b&&t.x+t.width>=p[2].x+10||n>=p[3].y&&n<T&&t.x<=p[3].x+p[3].width-10)}function s(t){return t.y<=_&&t.y>_-5&&t.x+t.width>=p[0].x+10||t.y<=M&&t.y>M-5&&t.x<=p[1].x+p[1].width-10||t.y<=b&&t.y>b-5&&t.x+t.width>=p[2].x+10||t.y<=T&&t.y>T-5&&t.x<=p[3].x+p[3].width-10}function c(t){return t.collidesWith(m[0])||t.collidesWith(m[1])||t.collidesWith(m[2])||t.collidesWith(m[3])}function u(){var e=0;n.map(function(n){e++;for(var o=1;o<=Math.floor(Math.random()*i)+1;o++){var f=10;switch(e){case 1:f=Math.floor(500*Math.random());break;case 2:f=Math.floor(772*Math.random())+80;break;case 3:f=Math.floor(Math.random()*(p[1].x+p[1].width));break;case 4:f=Math.floor(706*Math.random())+144;break;case 5:f=Math.floor(Math.random()*(p[3].x+p[3].width))}var a=W({type:"ghost",x:f,y:n,height:32,width:21,score:10,dx:5*Math.random()+1,image:Z.ghost});t.push(a)}})}var l,d=W({image:Z.platform,y:464,type:"platform"}),p=[W({image:Z.platform,y:374,x:80,type:"platform"}),W({image:Z.platform,y:278,x:-128,type:"platform"}),W({image:Z.platform,y:182,x:144,type:"platform"}),W({image:Z.platform,y:86,x:-80,type:"platform"})],m=[W({height:11,width:1,y:378,x:80,type:"platform"}),W({height:11,width:1,y:282,x:-128+p[1].width,type:"platform"}),W({height:11,width:1,y:184,x:144,type:"platform"}),W({height:11,width:1,y:89,x:-80+p[3].width,type:"platform"})],x=W({x:10,y:46,width:30,height:40,color:"blue",render:function(){this.draw(),xt.strokeStyle="black",xt.strokeRect(this.x,this.y,this.width,this.height)}}),g=W({x:814,y:424,width:30,height:40,color:"orange",render:function(){this.draw(),xt.strokeStyle="black",xt.strokeRect(this.x,this.y,this.width,this.height)}}),w=I({image:Z.walkcycle,frameWidth:32,frameHeight:31,animations:{walkRight:{frames:"0..2",frameRate:14},walkLeft:{frames:"3..5",frameRate:14},shootL:{frames:"7..7",frameRate:1},shootR:{frames:"6..6",frameRate:1}}}),v=W({x:g.x,y:400,animations:w.animations,onGround:!1,type:"player"});(l=t).push.apply(l,[d].concat(p,[x,g,v]));var _=p[0].y+p[0].height,M=p[1].y+p[1].height,b=p[2].y+p[2].height,T=p[3].y+p[3].height;u();var L=y({update:function(){if(f+=1/60,a+=1/60,S("space")&&f>.75){f=0,Rt&&(bt.load(),bt.play()),o?v.playAnimation("shootL"):v.playAnimation("shootR");var n=W({type:"bullet",x:o?v.x:v.x+v.width,y:v.y+10,dx:o?-6:6,width:4,height:2,ttl:30,color:"white"});t.push(n),n.update()}S("d")||S("right")?(v.x<809&&(c(v)||(S("shift")?v.x+=4:v.x+=2.5),v.playAnimation("walkRight"),o=!1),v.onGround&&v.update()):(S("a")||S("left"))&&(v.x>0&&(c(v)||(S("shift")?v.x-=4:v.x-=2.5),v.playAnimation("walkLeft"),o=!0),v.onGround&&v.update()),(S("w")||S("up"))&&v.onGround&&a>.25&&(a=0,Rt&&(St.load(),St.play()),v.dy-=4.5,v.update()),v.y<=0&&(v.dy=.1,v.update()),h(v)?(v.dy+=.1,v.onGround=!1,v.update()):(v.onGround=!0,v.dy=0),s(v)&&(v.onGround=!1,v.dy=.1,v.update()),v.collidesWith(x)&&(v.x=g.x,v.y=g.y,Rt&&(Tt.load(),Tt.play()),i++,u()),t.map(function(n){"ghost"==n.type&&(430==n.y?n.x<2?n.dx=Math.abs(n.dx):n.x>500&&(n.dx=-Math.abs(n.dx)):340==n.y?n.x<82?n.dx=Math.abs(n.dx):n.x>833&&(n.dx=-Math.abs(n.dx)):244==n.y?n.x<2?n.dx=Math.abs(n.dx):n.x>p[1].x+p[1].width-n.width&&(n.dx=-Math.abs(n.dx)):148==n.y?n.x<144?n.dx=Math.abs(n.dx):n.x>833&&(n.dx=-Math.abs(n.dx)):52==n.y&&(n.x<2?n.dx=Math.abs(n.dx):n.x>p[3].x+p[3].width-n.width&&(n.dx=-Math.abs(n.dx))),t.map(function(t){"bullet"==t.type&&n.collidesWith(t)&&(e+=n.score*i,n.ttl=0,t.ttl=0),"player"==t.type&&n.collidesWith(t)&&(v.ttl=0,r=!0)}))}),t.map(function(t){"bullet"!=t.type&&"ghost"!=t.type||t.update()}),t=t.filter(function(t){return t.isAlive()})},render:function(){t.map(function(t){return t.render()}),xt.font="20px "+wt,xt.fillStyle="#fff",xt.textAlign="left",xt.fillText("Level: "+i,10,25),xt.textAlign="center",xt.fillText("HighScore: "+Et,gt/2,25),xt.textAlign="right",xt.fillText("Score: "+e,gt-10,25),r&&(jt.display(),Et=e,B(),L.stop())}});L.start()})}function B(){var t={hScore:Et,musicOn:At,sfxOn:Rt};localStorage.setItem("BackToThePortal",JSON.stringify(t))}let G,U,H={};class Y{constructor({spriteSheet:spriteSheet,frames:frames,frameRate:frameRate,loop:loop=!0}={}){this.spriteSheet=spriteSheet,this.frames=frames,this.frameRate=frameRate,this.loop=loop;let{width:width,height:height,margin:margin=0}=spriteSheet.frame;this.width=width,this.height=height,this.margin=margin,this._f=0,this._a=0}clone(){return f(this)}reset(){this._f=0,this._a=0}update(t=1/60){if(this.loop||this._f!=this.frames.length-1)for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}render({x:x,y:y,width:width=this.width,height:height=this.height,context:context=e()}={}){let t=this.frames[this._f]/this.spriteSheet._f|0,n=this.frames[this._f]%this.spriteSheet._f|0;context.drawImage(this.spriteSheet.image,n*this.width+(2*n+1)*this.margin,t*this.height+(2*t+1)*this.margin,this.width,this.height,x,y,width,height)}}f.prototype=Y.prototype,f.class=Y;let q=/(jpeg|jpg|gif|png)$/,F=/(wav|mp3|ogg|aac)$/,X=/^\//,$=/\/$/,J=new WeakMap,N="",V="",K="",Z={},z={},Q={};const tt=()=>{};let nt={},it={},et={13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"},ot=[],ft=[],at={},rt={},ht={0:"left",1:"middle",2:"right"},st={x:0,y:0,radius:5};class ct{constructor(t=0,n=0){this._x=t,this._y=n}add(t,n=1){return E(this.x+(t.x||0)*n,this.y+(t.y||0)*n,this)}clamp(t,n,i,e){this._c=!0,this._a=t,this._b=n,this._d=i,this._e=e}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?Math.min(Math.max(this._a,t),this._d):t}set y(t){this._y=this._c?Math.min(Math.max(this._b,t),this._e):t}}E.prototype=ct.prototype,E.class=ct;class ut{constructor(t){this.init(t)}init(t={}){let{x:x,y:y,dx:dx,dy:dy,ddx:ddx,ddy:ddy,width:width,height:height,image:image}=t;this.position=E(x,y),this.velocity=E(dx,dy),this.acceleration=E(ddx,ddy),this._fx=this._fy=1,this.width=this.height=this.rotation=0,this.ttl=1/0,this.anchor={x:0,y:0},this.context=e();for(let n in t)this[n]=t[n];image&&(this.width=void 0!==width?width:image.width,this.height=void 0!==height?height:image.height),this.sx=0,this.sy=0}get x(){return this.position.x}get y(){return this.position.y}get dx(){return this.velocity.x}get dy(){return this.velocity.y}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}get animations(){return this._a}get viewX(){return this.x-this.sx}get viewY(){return this.y-this.sy}get width(){return this._w}get height(){return this._h}set x(t){this.position.x=t}set y(t){this.position.y=t}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}set animations(t){let n,i;this._a={};for(n in t)this._a[n]=t[n].clone(),i=i||this._a[n];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}set viewX(t){}set viewY(t){}set width(t){let n=t<0?-1:1;this._fx=n,this._w=t*n}set height(t){let n=t<0?-1:1;this._fy=n,this._h=t*n}isAlive(){return this.ttl>0}collidesWith(t){if(this.rotation||t.rotation)return null;let n=this.x-this.width*this.anchor.x,i=this.y-this.height*this.anchor.y,e=t.x,o=t.y;return t.anchor&&(e-=t.width*t.anchor.x,o-=t.height*t.anchor.y),n<e+t.width&&n+this.width>e&&i<o+t.height&&i+this.height>o}update(t){this.advance(t)}render(){this.draw()}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){this.velocity=this.velocity.add(this.acceleration,t),this.position=this.position.add(this.velocity,t),this.ttl--,this.currentAnimation&&this.currentAnimation.update(t)}draw(){let t=-this.width*this.anchor.x,n=-this.height*this.anchor.y;if(this.context.save(),this.context.translate(this.viewX,this.viewY),this.rotation&&this.context.rotate(this.rotation),-1==this._fx||-1==this._fy){let i=this.width/2+t,e=this.height/2+n;this.context.translate(i,e),this.context.scale(this._fx,this._fy),this.context.translate(-i,-e)}this.image?this.context.drawImage(this.image,0,0,this.image.width,this.image.height,t,n,this.width,this.height):this.currentAnimation?this.currentAnimation.render({x:t,y:n,width:this.width,height:this.height,context:this.context}):(this.context.fillStyle=this.color,this.context.fillRect(t,n,this.width,this.height)),this.context.restore()}}W.prototype=ut.prototype,W.class=ut;class lt{constructor({image:image,frameWidth:frameWidth,frameHeight:frameHeight,frameMargin:frameMargin,animations:animations}={}){if(!image)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=image,this.frame={width:frameWidth,height:frameHeight,margin:frameMargin},this._f=image.width/frameWidth|0,this.createAnimations(animations)}createAnimations(t){let n,i;for(i in t){let{frames:frames,frameRate:frameRate,loop:loop}=t[i];if(n=[],void 0===frames)throw Error("Animation "+i+" must provide a frames property");[].concat(frames).map(t=>{n=n.concat(C(t))}),this.animations[i]=f({spriteSheet:this,frames:n,frameRate:frameRate,loop:loop})}}}I.prototype=lt.prototype,I.class=lt;var dt=function(){var t,n,i,e,o,f=function(t){return Math.sin(6.283184*t)},a=function(t){return.003959503758*Math.pow(2,(t-128)/12)},r=function(t,n,i){var e,o,f,r,s,c,u,l=h[t.i[0]],d=t.i[1],p=t.i[3],m=h[t.i[4]],x=t.i[5],g=t.i[8],y=t.i[9],w=t.i[10]*t.i[10]*4,v=t.i[11]*t.i[11]*4,_=t.i[12]*t.i[12]*4,M=1/_,S=t.i[13],b=i*Math.pow(2,2-t.i[14]),T=new Int32Array(w+v+_),L=0,k=0;for(e=0,o=0;e<w+v+_;e++,o++)o>=0&&(o-=b,c=a(n+(15&(S=S>>8|(255&S)<<4))+t.i[2]-128),u=a(n+(15&S)+t.i[6]-128)*(1+8e-4*t.i[7])),f=1,e<w?f=e/w:e>=w+v&&(f-=(e-w-v)*M),r=c,p&&(r*=f*f),s=l(L+=r)*d,r=u,g&&(r*=f*f),s+=m(k+=r)*x,y&&(s+=(2*Math.random()-1)*y),T[e]=80*s*f|0;return T},h=[f,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var n=t%1*4;return n<2?n-1:3-n}];this.init=function(f){t=f,n=f.endPattern,i=0,e=f.rowLen*f.patternLen*(n+1)*2,o=new Int32Array(e)},this.generate=function(){var a,s,c,u,l,d,p,m,x,g,y,w,v,_,M=new Int32Array(e),S=t.songData[i],b=t.rowLen,T=t.patternLen,L=0,k=0,R=!1,A=[];for(c=0;c<=n;++c)for(p=S.p[c],u=0;u<T;++u){var P=p?S.c[p-1].f[u]:0;P&&(S.i[P-1]=S.c[p-1].f[u+T]||0,P<16&&(A=[]));var E=h[S.i[15]],W=S.i[16]/512,C=Math.pow(2,S.i[17]-9)/b,I=S.i[18],D=S.i[19],j=43.23529*S.i[20]*3.141592/44100,O=1-S.i[21]/255,B=1e-5*S.i[22],G=S.i[23]/32,U=S.i[24]/512,H=6.283184*Math.pow(2,S.i[25]-9)/b,Y=S.i[26]/255,q=S.i[27]*b&-2;for(y=(c*T+u)*b,l=0;l<4;++l)if(d=p?S.c[p-1].n[u+l*T]:0){A[d]||(A[d]=r(S,d,b));var F=A[d];for(s=0,a=2*y;s<F.length;s++,a+=2)M[a]+=F[s]}for(s=0;s<b;s++)(g=M[m=2*(y+s)])||R?(w=j,I&&(w*=E(C*m)*W+.5),k+=(w=1.5*Math.sin(w))*(v=O*(g-k)-(L+=w*k)),g=3==D?k:1==D?v:L,B&&(g=(g*=B)<1?g>-1?f(.25*g):-1:1,g/=B),R=(g*=G)*g>1e-5,_=g*(1-(x=Math.sin(H*m)*U+.5)),g*=x):_=0,m>=q&&(_+=M[m-q+1]*Y,g+=M[m-q]*Y),M[m]=0|_,M[m+1]=0|g,o[m]+=0|_,o[m+1]+=0|g}return++i/t.numChannels},this.createWave=function(){var t=44+2*e-8,n=t-36,i=new Uint8Array(44+2*e);i.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&n,n>>8&255,n>>16&255,n>>24&255]);for(var f=0,a=44;f<e;++f){var r=o[f];r=r<-32767?-32767:r>32767?32767:r,i[a++]=255&r,i[a++]=r>>8&255}return i}};o(),function(){let t;for(t=0;t<26;t++)et[65+t]=(10+t).toString(36);for(t=0;t<10;t++)et[48+t]=""+t;window.addEventListener("keydown",w),window.addEventListener("keyup",v),window.addEventListener("blur",_)}(),function(){let n=i();n.addEventListener("mousedown",L),n.addEventListener("touchstart",L),n.addEventListener("mouseup",k),n.addEventListener("touchend",k),n.addEventListener("blur",A),n.addEventListener("mousemove",R),n.addEventListener("touchmove",R),t("tick",()=>{ft.length=0;ot.map(t=>{ft.push(t)});ot.length=0})}();var pt=o(),mt=pt.canvas,xt=pt.ct;mt=i(),xt=e();var gt=mt.width,yt=mt.height;et[16]="shift";var wt="Arial, Verdana, san-serif",vt={music:"",jump:"",gs:"",portal:""},_t={music:!1,jump:!1,gs:!1,portal:!1};[{name:"music",songData:[{i:[0,255,107,1,0,255,92,0,1,32,4,6,35,0,0,0,0,0,0,2,36,0,9,21,0,5,0,0],p:[27,27],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[147,,,,,,,147,,,147,147,,,147,147,147,,,,,147,,147,,,147,147,,,147,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,139],f:[,,,,,,,24,,,24,24,,,24,24,,,,,,24,,24,,,24,24,,,24,24,,,,,,,,47,,,49,51,,,49,49,,,,,,47,,49,,,47,41,,,37,36]}]},{i:[3,0,128,0,3,68,128,0,1,218,4,4,40,0,0,1,0,0,1,2,67,115,124,190,0,6,39,1],p:[27,27],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,,,,147,,,,,,,,147,,,,,,,,147,,,,,,,,147],f:[]}]},{i:[0,91,128,0,0,95,128,12,0,0,12,0,72,0,0,0,0,0,0,1,34,0,17,32,83,3,130,6],p:[27,27],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[147,151,154,,,,,,,,,,,,,,146,149,153],f:[,,,,,21,21,21,21,23,,,28,,,,,,,,,,,,,,,,,,,,,,,,,67,46,44,34,17,,,6]}]},{i:[0,255,92,1,0,255,92,0,1,0,0,7,101,0,0,0,0,0,0,2,255,0,1,8,83,5,25,1],p:[12,12],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[147,,,,,,,147,,,151,154,,,,,146,,,,,146,,149,,,146,153],f:[13,,,,,,,13,,,13,13,24,24,24,24,24,,,,,13,,13,,,13,13,,,,,154,,,,,,,92,,,92,89,12,12,12,9,8,,,,,96,,99,,,101,101]}]},{i:[0,0,128,0,0,0,128,0,0,72,0,1,56,0,0,0,0,0,0,1,193,171,0,4,39,3,0,3],p:[27,27],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,,147,,,,,,,,147,,,,,,,,147,,,,,,,,147],f:[]}]},{i:[1,192,128,0,1,191,116,9,0,0,6,22,34,0,0,0,0,0,1,1,0,167,0,28,77,6,17,6],p:[23,24],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[147,,,151,,,154,,,149,,,156,,158,,146,,,153,,,149,,,,148,,142,,144],f:[21,,,,,,,,,,,,,,,27,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,17]},{n:[147,,,151,,,154,,,,149,,156,157,158,,146,149,151,152,153,,,,151,153,154,156,158],f:[]}]},{i:[0,31,131,1,0,83,128,0,1,210,4,7,41,0,0,0,0,0,1,2,255,0,12,17,61,5,0,0],p:[,27],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,146,139,135],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,147,,,147,,,147,,,147,,147,154,144,139,135],f:[]}]}],rowLen:5513,patternLen:32,endPattern:1,numChannels:7},{name:"portal",songData:[{i:[0,146,128,0,0,224,128,3,0,0,37,0,81,0,0,3,0,0,1,2,124,135,0,32,0,3,0,6],p:[27],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[147,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,151,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,154],f:[]}]},{i:[0,232,142,1,0,0,164,0,1,0,29,0,57,0,0,0,0,0,0,3,85,0,1,39,76,5,0,0],p:[15],c:[{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[],f:[]},{n:[135],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:2},{name:"jump",songData:[{i:[3,255,128,0,0,255,147,0,0,127,2,2,23,0,0,0,0,0,1,3,94,79,0,32,0,2,0,4],p:[1],c:[{n:[147],f:[]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1},{name:"gs",songData:[{i:[3,148,157,1,1,125,128,0,1,85,4,7,43,0,0,0,0,0,1,2,177,0,2,32,0,5,0,6],p:[1],c:[{n:[147],f:[10,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,85]}]}],rowLen:5513,patternLen:32,endPattern:0,numChannels:1}].map(function(t){return D(t)});var Mt=document.createElement("audio"),St=document.createElement("audio"),bt=document.createElement("audio"),Tt=document.createElement("audio"),Lt=setInterval(function(){""!=vt.music&&""!=vt.jump&&""!=vt.gs&&""!=vt.portal&&(Mt.src=vt.music,St.src=vt.jump,bt.src=vt.gs,Tt.src=vt.portal,clearInterval(Lt))},0);Mt.volume=.1,Mt.loop=!0;var kt=!1,Rt=!0,At=!0,Pt=!1,Et=0;if(localStorage.getItem("BackToThePortal")){var Wt=JSON.parse(localStorage.getItem("BackToThePortal")),Ct=Wt.hScore,It=Wt.musicOn,Dt=Wt.sfxOn;Et=Ct,At=It,Rt=Dt}else B();j();var jt=W({display:function(){xt.font="40px "+wt,xt.fillStyle="#fff",xt.textAlign="center",xt.fillText("GAME OVER",gt/2,yt/2),xt.font="20px "+wt,xt.fillText("Press [R] to replay.",gt/2,yt/2+30),xt.fillText("Press [B] to go back to main menu.",gt/2,yt/2+60),Pt=!0}}),Ot=!0,Bt=W({mainMenu:function(){xt.font="50px "+wt,xt.strokeStyle="#fff",xt.textAlign="center",xt.strokeText("Press [Enter] to play.",gt/2,yt/2),xt.font="30px "+wt,xt.fillStyle="#fff",xt.fillText("Controls",gt/2,yt-100),xt.fillText("HighScore: "+Et,gt/2,yt/2+50),xt.font="20px "+wt,xt.fillText("Press [Space] to fire.",gt/2,yt-70),xt.fillText("Press [W] or [↑] to jump.",gt/2,yt-40),xt.fillText("Press [A] [D] or [←] [→] to move Left and Right. Use [Shift] to sprint.",gt/2,yt-10),xt.font="italic 35px Comic Sans Ms",xt.fillText("i",22,yt-10),xt.beginPath(),xt.arc(25,yt-22,20,0,2*Math.PI),xt.font="20px Comic Sans Ms",xt.fillText("[M] Music",gt-60,yt-30),xt.fillText("[S] sfx",gt-60,yt-10),xt.fillText("[C]",60,yt-15),Rt||(xt.moveTo(797,465),xt.lineTo(829,465),xt.strokeStyle="#fff"),At||(xt.moveTo(785,445),xt.lineTo(839,445),xt.strokeStyle="#fff"),xt.stroke()}}),Gt=W({credits:function(){xt.font="50px "+wt,xt.fillStyle="#fff",xt.textAlign="center",xt.fillText("Credits",gt/2,100),xt.font="35px "+wt,xt.fillText("Sfx & Music",gt/2,175),xt.fillText("Sprites & Tiles",gt/2,250),xt.font="25px "+wt,xt.fillText("Ash Blue",gt/2,205),xt.fillText("Kimmo Rundelin",gt/2,280),xt.fillText("thekingphoenix",gt/2,310),xt.fillText("Lanea Zimmerman",gt/2,340),xt.textAlign="left",xt.fillText("Press [B] to go back.",10,yt-10)}});Bt.mainMenu(),M("enter",function(t){t.preventDefault(),!kt&&Ot&&(xt.clearRect(0,0,gt,yt),kt=!0,O())}),M("c",function(t){t.preventDefault(),!kt&&Ot&&(xt.clearRect(0,0,gt,yt),Ot=!1,Gt.credits())}),M("m",function(t){t.preventDefault(),!kt&&Ot&&(At=!At,xt.clearRect(0,0,gt,yt),Bt.mainMenu(),j(),B())}),M("s",function(t){t.preventDefault(),!kt&&Ot&&(Rt=!Rt,xt.clearRect(0,0,gt,yt),Bt.mainMenu(),B())}),M("b",function(t){t.preventDefault(),kt||Ot||(xt.clearRect(0,0,gt,yt),Ot=!0,Bt.mainMenu()),Pt&&(Ot=!0,kt=!1,xt.clearRect(0,0,gt,yt),Bt.mainMenu(),Pt=!1)}),M("r",function(t){t.preventDefault(),Pt&&(xt.clearRect(0,0,gt,yt),kt=!0,O())})}();
</script>
</body>
</html>
