"use strict";let t=new function(){let t,e,s,i,o,h=function(t){return Math.sin(6.283184*t)},r=function(t){return.003959503758*2**((t-128)/12)},l=function(t,e,s){let i,o,h,l,n,d,f=a[t.i[0]],c=t.i[1],u=t.i[3]/32,p=a[t.i[4]],y=t.i[5],m=t.i[8]/32,g=t.i[9],x=t.i[10]*t.i[10]*4,k=t.i[11]*t.i[11]*4,w=t.i[12]*t.i[12]*4,j=1/w,b=-t.i[13]/16,v=t.i[14],P=s*2**(2-t.i[15]),z=new Int32Array(x+k+w),T=0,C=0;for(i=0,o=0;i<x+k+w;i++,o++)o>=0&&(v=v>>8|(255&v)<<4,o-=P,n=r(e+(15&v)+t.i[2]-128),d=r(e+(15&v)+t.i[6]-128)*(1+8e-4*t.i[7])),h=1,i<x?h=i/x:i>=x+k&&(h=(i-x-k)*j,h=(1-h)*3**(b*h)),T+=n*h**u,l=f(T)*c,C+=d*h**m,l+=p(C)*y,g&&(l+=(2*Math.random()-1)*g),z[i]=80*l*h|0;return z},a=[h,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){let e=t%1*4;return e<2?e-1:3-e}];this.init=function(h){t=h,e=h.endPattern,s=0,i=h.rowLen*h.patternLen*(e+1)*2,o=new Int32Array(i)},this.generate=function(){let r,n,d,f,c,u,p,y,m,g,x,k,w,j,b=new Int32Array(i),v=t.songData[s],P=t.rowLen,z=t.patternLen,T=0,C=0,S=!1,D=[];for(d=0;d<=e;++d)for(p=v.p[d],f=0;f<z;++f){let t=p?v.c[p-1].f[f]:0;t&&(v.i[t-1]=v.c[p-1].f[f+z]||0,t<17&&(D=[]));let e=a[v.i[16]],s=v.i[17]/512,i=2**(v.i[18]-9)/P,M=v.i[19],O=v.i[20],R=43.23529*v.i[21]*3.141592/44100,F=1-v.i[22]/255,L=1e-5*v.i[23],A=v.i[24]/32,U=v.i[25]/512,W=6.283184*2**(v.i[26]-9)/P,E=v.i[27]/255,I=v.i[28]*P&-2;for(x=(d*z+f)*P,c=0;c<4;++c)if(u=p?v.c[p-1].n[f+c*z]:0,u){D[u]||(D[u]=l(v,u,P));let t=D[u];for(n=0,r=2*x;n<t.length;n++,r+=2)b[r]+=t[n]}for(n=0;n<P;n++)y=2*(x+n),g=b[y],g||S?(k=R,M&&(k*=e(i*y)*s+.5),k=1.5*Math.sin(k),T+=k*C,w=F*(g-C)-T,C+=k*w,g=3==O?C:1==O?w:T,L&&(g*=L,g=g<1?g>-1?h(.25*g):-1:1,g/=L),g*=A,S=g*g>1e-5,m=Math.sin(W*y)*U+.5,j=g*(1-m),g*=m):j=0,y>=I&&(j+=b[y-I+1]*E,g+=b[y-I]*E),b[y]=0|j,b[y+1]=0|g,o[y]+=0|j,o[y+1]+=0|g}return s++,s/t.numChannels},this.createAudioBuffer=function(t){let e=t.createBuffer(2,i/2,44100);for(let t=0;t<2;t++){let s=e.getChannelData(t);for(let e=t;e<i;e+=2)s[e>>1]=o[e]/65536}return e},this.createWave=function(){let t=44+2*i-8,e=t-36,s=new Uint8Array(44+2*i);s.set([82,73,70,70,255&t,t>>8&255,t>>16&255,t>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&e,e>>8&255,e>>16&255,e>>24&255]);for(let t=0,e=44;t<i;++t){let i=o[t];i=i<-32767?-32767:i>32767?32767:i,s[e++]=255&i,s[e++]=i>>8&255}return s},this.getData=function(t,e){let s=2*Math.floor(44100*t),i=new Array(e);for(let h=0;h<2*e;h+=1){let e=s+h;i[h]=t>0&&e<o.length?o[e]/32768:0}return i}};for(t.init({songData:[{i:[2,192,128,0,2,192,140,18,0,0,158,119,158,0,0,0,0,0,0,0,2,5,0,0,32,0,0,24,8],p:[1,2,1,2,3,4,1,2],c:[{n:[99],f:[]},{n:[103],f:[]},{n:[101],f:[]},{n:[106],f:[]}]},{i:[0,0,140,0,0,0,140,0,0,20,4,10,47,59,0,0,0,91,5,0,1,239,135,0,32,108,5,16,4],p:[1,1,1,1,1,1,1,1],c:[{n:[99,,99,,99,,99,,99,,99,,99,,99,,99,,99,,99,,99,,99,,99,,99,,99,99],f:[]}]},{i:[0,255,106,64,0,255,106,0,64,0,5,7,164,0,0,0,0,0,0,0,2,255,0,2,32,83,5,25,1],p:[1,1,1,1,1,1,1,1],c:[{n:[123],f:[]}]},{i:[0,192,104,64,0,80,99,0,0,0,4,0,66,0,0,0,3,0,0,0,1,0,1,2,32,37,4,0,0],p:[1,1,1,1,2,3,1,1],c:[{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,147,,147],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,151,,151],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,152,,152],f:[]}]},{i:[0,91,128,0,0,95,128,12,0,0,12,0,72,0,0,0,0,0,0,0,2,255,0,0,32,83,3,130,4],p:[,,1,2,3,4,5],c:[{n:[135,,,,,,,,,,,,,,,,,,,,,,,,,,,,135],f:[]},{n:[139],f:[]},{n:[137,,,,,,,,,,,,,,,,,,,,,,,,,,,,137],f:[]},{n:[142,,,,,,,,,,,,,,,,,,,,,,,,,,,,142],f:[]},{n:[135],f:[]}]}],rowLen:7350,patternLen:32,endPattern:7,numChannels:5});t.generate()<1;);let e=t.createWave(),s=document.createElement("audio");s.src=URL.createObjectURL(new Blob([e],{type:"audio/wav"})),s.loop=!0;const i="#110033",o="#aa00ff",h="#eeffee",r="#110033",l="#9944ff66",a="#332255",n="#9944ff66",d="#772200",f="#aa5500",c="#552233",u="#ff77ff66",p="DeathsApprenticeJS13k2022BestTime";class y{constructor(t,e){this.x=t,this.y=e}clone(){return new y(this.x,this.y)}multi(t){return new y(this.x*t,this.y*t)}plus(t){return new y(this.x+t.x,this.y+t.y)}add(t,e){return this.x+=t||0,this.y+=e||0,this}}class m{constructor({pos:t,size:e,origin:s,ttl:i}){this.pos=t||new y(0,0),this.size=e||new y(0,0),this.origin=s||new y(.5,.5),this.type="obj",this.collGroup="",this.fillColor=r,this.strokeColor=l,this.game=null,this.ttl=i||1/0}render(t){this.renderStart(t),t.fillStyle=this.fillColor,t.strokeStyle=this.strokeColor,this.fillColor&&t.fillRect(-this.size.x*this.origin.x,-this.size.y*this.origin.y,this.size.x,this.size.y),this.strokeColor&&(t.beginPath(),t.rect(-this.size.x*this.origin.x,-this.size.y*this.origin.y,this.size.x,this.size.y),t.stroke()),this.renderPostProcess(t),t.restore()}renderStart(t){t.save(),t.translate(this.pos.x,this.pos.y)}renderPostProcess(t){}update(t){this.ttl-=t}}class g extends m{constructor(t){let e=t.ttl||.5,s=t.size/e,i=t.dx||80,o=t.dy||80,h=t.dxd||i/2,r=t.dyd||o/2;t.size=new y(t.size,t.size),super(t),this.dPos=new y(Math.random()*i-h,Math.random()*o-r),this.fillColor="#aaaaaa",this.strokeColor=null,this.ttl=e,this.shrinkrate=s}update(t){super.update(t),this.size.x-=this.shrinkrate*t,this.size.y-=this.shrinkrate*t,this.pos.add(this.dPos.x*t,this.dPos.y*t)}}class x extends m{constructor({game:t,rate:e,radius:s,target:i,finishedCallback:o}){super({}),this.game=t,this.target=i||this.game.player,this.rate=e||t.canvas.width/2,this.radius=s||t.canvas.width,this.finishedCallback=o||null}update(t){this.radius-=this.rate*t,this.radius<.1&&(this.radius=.1,this.finishedCallback&&this.finishedCallback(this),this.ttl=-1),this.radius>this.game.canvas.width&&(this.radius=this.game.canvas.width,this.finishedCallback&&this.finishedCallback(this),this.ttl=-1)}render(t){t.beginPath(),t.fillStyle="#000000",t.rect(this.game.canvas.width,0,-this.game.canvas.width,this.game.canvas.height),t.arc(this.target.pos.x,this.target.pos.y,this.radius,0,2*Math.PI),t.fill()}}class k extends m{constructor(t){t.origin=new y(0,0),super(t),this.type="floor",this.collGroup="level",this.fillColor=r,this.strokeColor=l,this.brickFillColor=a,this.brickStrokeColor=n,this.bricks=[];let e=0;for(;e<this.size.x;){let t=Math.ceil(15*Math.random())+5;e+t>this.size.x&&(t=this.size.x-e);let s=Math.ceil(5*Math.random())+3,i=Math.floor(2*Math.random());this.bricks.push({x:e,y:i,w:t,h:s}),e+=t}let s=0;for(;s<this.size.y;){let t=Math.ceil(15*Math.random())+5;s+t>this.size.y&&(t=this.size.y-s);let e=Math.ceil(5*Math.random())+3,i=Math.floor(2*Math.random());this.bricks.push({x:i,y:s,w:e,h:t}),s+=t}for(s=0;s<this.size.y;){let t=Math.ceil(15*Math.random())+5;s+t>this.size.y&&(t=this.size.y-s);let e=Math.ceil(5*Math.random())+3,i=Math.floor(2*Math.random());this.bricks.push({x:this.size.x-i-e,y:s,w:e,h:t}),s+=t}}renderPostProcess(t){this.bricks.forEach((e=>{t.fillStyle=this.brickFillColor,t.strokeStyle=this.brickStrokeColor,t.fillRect(e.x,e.y,e.w,e.h),t.beginPath(),t.rect(e.x,e.y,e.w,e.h),t.stroke()}))}}class w extends m{constructor(t){t.origin=new y(0,0),super(t),this.directionUp=!1!==t.directionUp,this.type="spikes",this.collGroup="level",this.fillColor="#aaaaaa",this.strokeColor="#dddddd"}render(t){this.renderStart(t);let e=this.size.y,s=0;this.directionUp&&(e=0,s=this.size.y),t.strokeStyle=this.strokeColor,t.fillStyle=this.fillColor,t.beginPath(),t.moveTo(0,s);let i=Math.ceil(this.size.x/10),o=this.size.x/i;for(let i=0;i<=this.size.x-o+.1;i+=o)t.lineTo(i+o/2,e),t.lineTo(i+o,s);t.fill(),t.stroke(),t.restore()}}class j extends m{constructor(t){t.origin=new y(0,0),super(t),this.type="door",this.collGroup="level",this.fillColor=d,this.strokeColor=f,this.lock=t.lock||"allLocks",this.unlocked=!1}update(t){this.unlocked&&this.size.y>0&&(this.size.y-=40*t,this.pos.y+=40*t)}}class b extends m{constructor(t){t.origin=new y(0,0),super(t),this.jumpforce=t.jumpforce||3,this.type="jumppad",this.collGroup="level",this.fillColor=c,this.strokeColor=u}}class v extends m{constructor(t){t.origin=new y(.5,.5),t.size=new y(20,20),super(t),this.unlocking=t.unlocking||"allLocks",this.type="key",this.collGroup="keys";this.currentPath=T([["#ffff88",null,-5,0,-8,3,-8,6,-11,6,-11,3,-14,-1,-14,-3,-11,-5,-8,-5,-5,-3,8,-3,8,-2,7,-2,7,1,5,1,5,-1,-5,-1,"c"],[null,"#000000",-13,-2,-11,-2,-11,1],[null,"#000000",-6,-2,-8,-2,-8,1]])}render(t){t.save(),t.translate(this.pos.x,this.pos.y),C(t,this.currentPath),t.restore()}}class P extends m{constructor(t){t.origin=new y(.5,.5),t.size=new y(20,20),super(t),this.type="hourglass",this.collGroup="collect",this.fillColor="#ffffdd",this.textFillColor="#ffffdd",this.strokeColor="#ffff00",this.startTime=t.startTime||1/0,this.time=this.startTime;let e=[[i,o,-5,-10,0,0,-5,10,5,10,0,0,5,-10,"c"],[h,null,-3,-5,0,0,3,-5,"c"],[h,null,-4,9,0,7,4,9,"c"],[null,"#aa8822",-7,-10,7,-10],[null,"#aa8822",-7,10,7,10],[null,"#aa8822",-5,-9,-5,9],[null,"#aa8822",5,-9,5,9]];this.currentPath=T(e)}update(t){this.time<-.9?(this.game.player.stopUpdates=!0,this.game.addObj(new x({target:this,game:M,radius:M.canvas.width,rate:M.canvas.width/2,finishedCallback:t=>{M.removeObj(t),this.game.loadCurrentLevel()}}))):this.time-=t}render(t){t.save(),t.translate(this.pos.x,this.pos.y),C(t,this.currentPath),this.time<1/0&&(t.textAlign="center",this.time<=0?(t.font="24px serif",t.fillStyle="red"):(t.font="12px serif",t.fillStyle=this.textFillColor),t.fillText(Math.ceil(this.time),0,-15)),t.restore()}}class z extends m{constructor(t){super(t),this.type="text",this.collGroup="text",this.textFillColor="#ffffdd",this.text=t.text||"",this.textsize=t.textsize||"12",this.startTime=t.startTime||1/0,this.time=this.startTime}update(t){this.time-=t,this.time<-.5&&this.game.removeObj(this)}render(t){this.renderStart(t),t.textAlign="center",t.font=this.textsize+"px serif",t.fillStyle=this.textFillColor,t.fillText(this.text,0,0),t.restore()}}let T=(t,e)=>{let s=e?-1:1;return t.map((t=>{let e={fill:t[0],stroke:t[1],path:new Path2D};e.path.moveTo(t[2]*s,t[3]);for(let i=4;i<=t.length-2;i+=2)e.path.lineTo(t[i]*s,t[i+1]);return"c"==t[t.length-1]&&e.path.closePath(),e}))},C=(t,e)=>{e.forEach((e=>{e.fill&&(t.fillStyle=e.fill,t.fill(e.path)),e.stroke&&(t.strokeStyle=e.stroke,t.stroke(e.path))}))};class S extends m{constructor(t){t.size=new y(10,30),t.origin=new y(.5,1),super(t),this.respawnPos=this.pos.clone(),this.type="player",this.collGroup="player",this.dPos=new y(0,0),this.speed=100,this.dashFactor=3,this.dashDuration=.25,this.dashtimer=this.dashDuration,this.jumpForce=200,this.jumpReleased=!0,this.gravity=500,this.maxFallSpeed=300,this.grounded=!1,this.groundedTo=null,this.stopUpdates=!1,this.stopRendering=!1,this.walkDustTimout=.1,this.lastWalkDust=0;let e=[[i,o,-8,0,-3,-15,-2,-27,5,-20,5,0,"c"],[h,null,-2,-30,0,-32,3,-32,6,-30,6,-20,2,-21,-2,-24],["#000000",null,3,-28,5,-28,5,-26,3,-26],[null,"#aa8822",-3,-2,12,-35],[null,"#ccccdd",11,-34,16,-31,19,-27],[h,null,-1,-7,-1,-9,1,-9,1,-7]];this.paths={r:T(e),l:T(e,!0)},e.push([null,h,-8,-7,-20,-7]),e.push([null,h,-8,-14,-25,-14]),e.push([null,h,-6,-20,-22,-20]),this.paths.dr=T(e),this.paths.dl=T(e,!0),this.currentPath=this.paths.r}update(t){if(this.stopUpdates)return;let e=this.grounded;M.actions.l?(this.dPos.x=-this.speed,this.currentPath=this.paths.l):M.actions.r?(this.dPos.x=this.speed,this.currentPath=this.paths.r):(this.dPos.x*=.2,e=!1,this.lastWalkDust=0),e&&(this.lastWalkDust-=t,this.lastWalkDust<0&&(this.createWalkDust(),this.lastWalkDust=this.walkDustTimout)),this.grounded?this.groundedTo&&"jumppad"==this.groundedTo.type?this.dPos.y=-this.jumpForce*this.groundedTo.jumpforce:M.actions.j&&this.jumpReleased?(this.jumpReleased=!1,this.dPos.y=-this.jumpForce,this.dashtimer=this.dashDuration,this.createJumpDust()):this.dPos.y=0:(M.actions.j&&this.dPos.y<0?this.dPos.y+=.5*this.gravity*t:this.dPos.y+=this.gravity*t,M.actions.d&&this.dashtimer>0&&(this.dashtimer-=t,M.actions.l&&(this.dPos.x=-this.speed*this.dashFactor,this.currentPath=this.paths.dl),M.actions.r&&(this.dPos.x=this.speed*this.dashFactor,this.currentPath=this.paths.dr))),this.dPos.y>this.maxFallSpeed&&(this.dPos.y=this.maxFallSpeed),this.pos=this.pos.plus(this.dPos.multi(t)),this.grounded=!1;let s=this.pos.clone().add(6,0),i=this.pos.clone().add(-6,0),o=i.clone().add(0,-29),h=s.clone().add(0,-29),r=this.pos.clone().add(0,-29),l=this.pos.clone().add(7,-15),a=this.pos.clone().add(-7,-15),n=!1;if(M.getColliderObjs("level").forEach((t=>{let e=["spikes"].indexOf(t.type)>=0,o=t.pos.clone().add(-t.size.x*t.origin.x,-t.size.y*t.origin.y),h=t.pos.clone().add(t.size.x*(1-t.origin.x),t.size.y*(1-t.origin.y));this.dPos.y<0&&r.y>=o.y&&r.y<=h.y&&r.x>=o.x&&r.x<=h.x&&(this.dPos.y=0,this.pos.y=h.y+28,n|=e),this.dPos.x>0&&l.y>=o.y&&l.y<=h.y&&l.x>=o.x&&l.x<=h.x&&(this.dPos.x=0,this.pos.x=o.x-8,s=this.pos.clone().add(6,0),i=this.pos.clone().add(-6,0),n|=e),this.dPos.x<0&&a.y>=o.y&&a.y<=h.y&&a.x>=o.x&&a.x<=h.x&&(this.dPos.x=0,this.pos.x=h.x+8,s=this.pos.clone().add(6,0),i=this.pos.clone().add(-6,0),n|=e),(s.y>=o.y&&s.y<=h.y&&s.x>=o.x&&s.x<=h.x||i.y>=o.y&&i.y<=h.y&&i.x>=o.x&&i.x<=h.x)&&(this.grounded=!0,this.groundedTo&&"jumppad"==this.groundedTo.type||(this.groundedTo=t),this.pos.y=o.y,n|=e)})),this.grounded||(this.groundedTo=null),M.getColliderObjs("collect").forEach((t=>{o.x<t.pos.x+t.size.x*(1-t.origin.x)&&h.x>t.pos.x-t.size.x*(1-t.origin.x)&&o.y<t.pos.y+t.size.y*t.origin.y&&i.y>t.pos.y-t.size.y*t.origin.y&&this.game.removeObj(t)})),M.getColliderObjs("keys").forEach((t=>{o.x<t.pos.x+t.size.x*(1-t.origin.x)&&h.x>t.pos.x-t.size.x*(1-t.origin.x)&&o.y<t.pos.y+t.size.y*t.origin.y&&i.y>t.pos.y-t.size.y*t.origin.y&&(M.getColliderObjs("level").forEach((e=>{e.lock==t.unlocking&&(e.unlocked=!0)})),console.log(t.unlocking),this.game.removeObj(t))})),0==M.getColliderObjs("collect").length&&M.finishedCurrentLevel(),this.pos.y>this.game.canvas.height||n){this.dPos.x=0,this.dPos.y=0,this.createDeathDust(10),this.stopUpdates=!0,this.stopRendering=!0;let t=this;setTimeout((()=>t.respawn()),1e3)}}respawn(){this.stopUpdates=!1,this.stopRendering=!1,this.pos=this.respawnPos.clone(),this.createDeathDust(15)}createDeathDust(t){for(let e=0;e<(t||10);e++){let t=new y(this.pos.x+20*Math.random()-10,this.pos.y-14+30*Math.random()-15);this.game.addObj(new g({pos:t,size:8*Math.random()+5,ttl:.8*Math.random()+.5}))}}createWalkDust(){this.game.addObj(new g({pos:this.pos.clone(),size:2,ttl:.4*Math.random()+.2,dx:80,dy:40,dyd:40}))}createJumpDust(){for(let t=0;t<5;t++)this.game.addObj(new g({pos:this.pos.clone(),size:4,ttl:.4*Math.random()+.2,dx:80,dy:20,dxd:40,dyd:20}))}render(t){this.stopRendering||(t.save(),t.translate(this.pos.x,this.pos.y),C(t,this.currentPath),t.restore())}}const D="\np~197~380§t~173~304~Use WASD to move~0~12§t~643~322~Collect these hourglasses~0~12§t~406~134~DEATH'S APPRENTICE~0~66§t~404~166~Welcome to the first day of your apprenticeship in Deaths's realm.~0~24§t~203~321~(or arrow keys)~0~12§h~621~422~0§t~581~537~By the way: Use the [M] key to toggle the music on and off... ~0~12§f~127~348~33~103§f~661~347~31~104§f~125~333~567~15§f~126~450~567~51§t~403~235~Your tasks are simple: collect the hourglasses for your master.~0~18§t~727~49~starts with your first move~0~12§t~626~23~Speedrun Clock:~0~18\n#\np~236~194§f~717~219~84~281§f~505~389~212~111§f~182~494~80~6§f~196~487~80~7§f~209~481~78~6§f~222~475~77~6§f~235~469~78~6§f~246~463~78~6§f~318~429~187~81§t~231~374~Stairs can be walked~0~12§f~445~351~60~78§h~679~359~0§t~127~152~Press Up (or W) to jump~0~12§t~460~258~Hold Up (or W) to jump higher~0~12§h~475~330~0§h~350~404~0§h~98~468~0§f~-36~135~66~366§f~2~115~307~21§f~288~136~21~105§f~103~240~204~16§f~103~209~41~33§f~258~457~54~6§f~269~452~42~5§f~283~446~28~6§f~309~434~10~7§f~295~440~25~7§f~1~500~397~30\n#\nh~738~364~0§p~76~463§f~407~498~71~30§f~519~454~61~18§f~614~421~60~22§f~710~391~60~23§f~-1~335~53~264§f~251~522~30~81§f~434~520~20~82§f~541~467~20~137§f~635~437~22~168§f~731~407~23~198§f~49~503~279~34§t~390~194~So? Too easy, you say? Ok, here are more hourglasses for you to collect...~0~24§t~584~224~Dont fall down! Or....~0~18§t~639~248~You'll respawn ;-)~0~12\n#\nf~42~93~97~36§f~227~1~24~468§f~67~562~98~37§f~226~560~23~26§f~339~557~100~33§f~502~494~100~25§f~345~419~87~28§f~506~350~75~33§f~387~292~41~33§f~511~236~52~28§f~389~165~42~29§f~511~109~104~24§f~646~95~27~530§f~552~105~95~5§f~573~100~75~5§f~599~95~50~5§f~620~89~86~7§f~723~552~28~64§f~705~543~63~9§p~92~33§h~734~510~0§h~295~502~0§h~522~89~0§t~409~29~Some more todos, young apprentice...~0~18§t~354~48~Go, get 'em all! Quick!~0~12\n#\nf~687~271~33~115§f~93~271~32~114§f~92~383~628~29§f~92~264~628~7§p~154~301§h~640~354~15§t~253~207~I recently mentioned the word \"quick\"...~0~18§t~373~225~...some hourglasses have only a few seconds left...~0~14§t~512~240~... so you got to hurry up!~0~12§t~551~440~As soon as one hourglass reaches zero, your lesson will restart.~0~12§t~621~462~An apprenticeship is no piece of cake, after all.~0~12\n#\nf~289~298~210~131§f~321~494~145~60§f~465~536~211~18§f~102~537~219~17§f~675~104~19~450§f~84~99~610~5§f~82~100~21~456§f~578~246~47~23§f~103~305~42~20§f~120~354~61~20§f~198~467~47~19§f~150~410~64~20§f~184~257~47~20§f~637~307~39~20§f~605~366~45~20§f~570~425~42~23§f~537~475~40~17§p~388~256§h~602~219~22§h~198~228~17§h~129~506~32§h~639~504~6§t~384~57~It's time for a little test, my apprentice!~0~18§t~385~80~You'll have to choose the order in which you should collect the hourglasses.~0~12\n#\nf~166~329~28~275§f~488~329~30~270§f~90~310~167~19§f~437~308~168~21§p~115~281§h~586~286~0§t~204~77~Sometimes, when it looks too far...~0~18§t~462~90~... a little well timed SHIFT helps.~0~18§t~232~152~Jump while walking, aaaand...~0~12§t~417~166~.. press [SHIFT] for a little extra push.~0~12§f~76~229~14~99\n#\nh~595~398~0§f~123~429~585~20§p~284~392§j~389~424~44~5~1.7§j~677~424~30~5~2§f~538~301~117~14§h~178~399~0§t~261~83~An obstacle is to big for you to jump over it? ~0~18§t~377~116~When you are lucky, Death left a handy jumppad for you nearby.~0~14§t~467~145~Just walk onto it, and let the thing do its magic... weeee!eh!~0~12§t~310~473~Always remember: when you are stuck, just jump off a cliff. You'll respawn. ;-)~0~12§f~443~300~36~129§f~233~298~41~131\n#\nd~411~267~5~97~d1§k~471~535~d1§f~71~434~210~15§f~222~427~59~8§f~243~420~60~8§f~261~413~57~8§f~279~408~54~7§f~294~400~56~9§f~313~395~60~9§f~325~387~65~10§f~345~379~63~10§f~363~372~67~9§f~387~362~347~10§f~382~131~42~134§f~377~258~370~11§f~289~122~146~13§f~725~253~29~120§h~690~336~0§f~7~564~522~15§j~15~559~32~5~2§t~164~77~When your path is locked...~0~20§t~462~461~... the indirect way may turns out to be the \"KEY\" to success.~0~14§p~329~287\n#\nf~13~18~765~18§f~752~34~26~547§f~228~202~22~172§f~246~359~190~15§f~416~217~20~157§f~523~421~114~17§f~481~375~28~15§f~568~259~25~13§f~608~201~148~17§j~680~569~43~5~1.8§f~13~35~27~541§f~40~208~143~18§f~162~226~18~274§j~40~569~101~5~2.2§f~226~182~124~21§f~334~35~20~147§f~107~112~172~18§f~179~34~18~80§p~148~76§k~230~78~1§d~571~472~5~102~1§f~564~438~21~34§f~242~372~17~70§d~373~373~5~71~2§f~244~440~211~17§k~284~265~3§f~327~203~21~92§j~257~356~152~5~2§h~301~408~0§f~510~35~23~101§f~533~117~144~19§d~661~36~5~81~3§h~563~79~0§k~638~241~2§f~624~314~128~18§h~96~373~0§f~14~573~300~20§f~404~573~374~20§t~83~53~Jump around~0~14§f~538~318~86~14\n#\ns~224~453~124~45~1§s~410~454~262~81~1§f~212~495~153~30§f~403~528~279~20§f~348~449~62~101§f~673~450~91~104§f~38~447~185~86§f~466~390~36~16§f~555~357~38~19§h~733~426~0§p~64~412§t~234~119~Spikes in Death's domain ?!?!??~0~20§t~325~157~Well, yes. Why not?~0~16§t~394~187~Dont touch them.~0~12\n#\ns~155~552~244~49~1§s~160~381~250~45~0§f~29~548~127~53§f~510~394~54~55§f~152~361~263~30§f~397~548~94~56§f~248~519~59~17§j~445~543~37~5~2§s~431~176~45~21~1§s~521~176~38~19~1§s~605~173~38~22~1§h~726~165~0§d~364~92~5~104~allLocks§k~588~343~allLocks§j~200~357~31~5~1.7§p~55~517§s~289~209~410~60~0§f~283~193~482~26§f~34~15~342~83§t~186~50~Roses are red, Violets are blue.~0~18§t~221~70~A spike on the head, will also hurt you.~0~15\n#\ns~-11~566~822~37~1§f~286~469~215~23§j~472~464~28~5~1.7§j~286~464~29~5~1.7§f~628~412~32~22§f~128~412~28~17§j~629~407~29~5~1.7§j~127~407~30~5~1.7§f~356~207~55~43§f~331~159~112~50§f~329~111~18~53§f~382~116~13~46§f~431~110~12~49§f~339~95~97~21§f~361~135~10~11§f~409~139~11~8§t~386~53~That's the end, my apprentice!~0~32§t~387~74~The deadline of js13k 2022 is here, and the game-dev is too tired to add more levels ;-)~0~12§t~384~295~You took {speedRunTime} to complete your training~0~18§t~385~325~(Your best time ever was {bestTime})~0~12§t~390~514~THX for playing! Hope you had fun~0~12§p~386~357§t~385~340~Press F5, if you want to try again...~0~12\n",M=new class{constructor(t,e){this.canvas=t,this.levels=[],this.levelPointer=-1,this.player=null,this.initLevels(e),this.musicPlaying=!1,this.ctx=t.getContext("2d"),this.width=this.canvas.width,this.height=this.canvas.height,this.objs=[],this.keys={KeyA:"l",KeyD:"r",KeyW:"j",ArrowLeft:"l",ArrowRight:"r",ArrowUp:"j",ShiftLeft:"d",ShiftRight:"d"},this.actions={l:!1,r:!1,j:!1};let s=this;document.addEventListener("keydown",(t=>s.keydown(t))),document.addEventListener("keyup",(t=>s.keyup(t))),this.lastUpdate=Date.now(),this.startTime=null,this.speedRunTime=null}initLevels(t){this.levels=t.split("\n#\n"),this.levelPointer=-1}finishedCurrentLevel(){if(this.levelPointer==this.levels.length-2){this.speedRunTime=(Date.now()-this.startTime)/1e3;let t=localStorage.getItem(p);(!t||t>this.speedRunTime)&&localStorage.setItem(p,this.speedRunTime)}if(this.levelPointer>=this.levels.length-1)return;this.player.stopUpdates=!0;let t=this;this.addObj(new x({target:this.player,game:t,finishedCallback:e=>{t.loadNextLevel()}}))}loadNextLevel(){this.levelPointer>=this.levels.length-1||(this.levelPointer++,this.loadCurrentLevel())}loadCurrentLevel(){this.objs=[],this.player=null,this.levels[this.levelPointer].split("§").forEach((t=>{let e=t.split("~");if(e.length<2)return;let s={};e.length>=3&&(s.pos=new y(1*e[1],1*e[2])),["f","d","j","s"].indexOf(e[0])>-1&&(s.size=new y(1*e[3],1*e[4])),"f"==e[0]?M.addObj(new k(s)):"s"==e[0]?(s.directionUp="1"==e[5],M.addObj(new w(s))):"d"==e[0]?(s.lock=e[5],M.addObj(new j(s))):"k"==e[0]?(s.unlocking=e[3],M.addObj(new v(s))):"j"==e[0]?(s.jumpforce=1*(e[5]||1.5),M.addObj(new b(s))):"p"==e[0]?M.player=M.addObj(new S(s)):"h"==e[0]?(s.startTime=1*e[3],M.addObj(new P(s))):"t"==e[0]&&(s.text=e[3],M.speedRunTime&&(s.text=s.text.replace("{speedRunTime}",this.getTimeFormated(M.speedRunTime)),localStorage.getItem(p),s.text=s.text.replace("{bestTime}",this.getTimeFormated(localStorage.getItem(p)))),s.startTime=1*e[4],s.textsize=e[5],M.addObj(new z(s)))})),this.player.stopUpdates=!0,this.player.stopRendering=!0,this.addObj(new x({target:this.player,game:M,radius:1,rate:-M.canvas.width,finishedCallback:t=>{M.removeObj(t),M.player.respawn()}}))}keydown(t){this.keys[t.code]&&(this.actions[this.keys[t.code]]=!0),"KeyM"==t.code&&(this.musicPlaying?(s.pause(),this.musicPlaying=!1):(s.play(),this.musicPlaying=!0)),0!=this.levelPointer||this.startTime||(this.startTime=Date.now(),s.play(),this.musicPlaying=!0)}keyup(t){this.keys[t.code]&&(this.actions[this.keys[t.code]]=!1,"j"==this.keys[t.code]&&this.player&&(this.player.jumpReleased=!0))}run(){this.lastUpdate=Date.now(),this.requestFrame(),this.musicPlaying=!0}requestFrame(){requestAnimationFrame((()=>{this.updateAndRender()}))}updateAndRender(){let t=Date.now(),e=(t-this.lastUpdate)/1e3;if(this.lastUpdate=t,this.objs.forEach((t=>t.update(e))),this.objs=this.objs.filter((t=>t.ttl>0)),this.ctx.fillStyle="#00001188",this.ctx.fillRect(0,0,this.width,this.height),this.objs.forEach((t=>t.render(this.ctx))),!this.speedRunTime){let e=(t-(this.startTime?this.startTime:t))/1e3,s=this.getTimeFormated(e);this.ctx.textAlign="center",this.ctx.font="24px serif",this.ctx.fillStyle="#ffffff",this.ctx.fillText(s,750,24)}this.requestFrame()}getTimeFormated(t){t=t||0;let e=Math.floor(t/60),s=Math.floor(t-60*e),i=Math.floor(10*(t-60*e-s));return("0"+e).substr(-2)+":"+("0"+s).substr(-2)+"."+i}getColliderObjs(t){return this.objs.filter((e=>e.collGroup==t))}addObj(t){return this.objs.push(t),t.game=this,t}removeObj(t){this.objs=this.objs.filter((e=>e!==t))}}(document.getElementById("canvas"),D.trim());M.run(),M.loadNextLevel();