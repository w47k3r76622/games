var t2=document.createElement("template");let showingNotification=!1,notifications=[];setNotification=(e,t,n,i)=>{if(showingNotification)e!==notifications?.[0]?.text&&notifications.push({text:e,subtext:t,timeout:n,color:i});else try{showingNotification=!0;var o=dcr("a");o.id="not",o.innerHTML=`<div>${e}</div><div sub>${t}</div>`,o.style.color=i,dba(o),setTimeout(()=>{o.remove(),showingNotification=!1,0<notifications.length&&(setNotification(notifications[0].text,notifications[0].subtext,notifications[0].timeout,notifications[0].color),notifications.shift())},n)}catch(e){}},t2.innerHTML=html`
  <link href="components/sd-game-scene.css" rel="stylesheet" />
  <t-a><span>PLANET HEALTH</span>
</t-b>
</t-a>
  <t-b
    ><div legend>
      <div
        blaster
        title="Single target turret. Standard space defense engineer issue."
      >
        Blaster 1<span one></span> 2<span two></span> 3<span three></span>
      </div>
      <div
        thermal
        title="Hot. Hot. Hot. High area of effect damage that literally incinerates enemies."
      >
        Thermal Detonator 1<span one></span> 2<span two></span> 3<span
          three
        ></span>
      </div>
      <div
        phaser
        title="Lazer turret that blasts enemies in a line and disintegrates them."
      >
        Phaser 1<span one></span> 2<span two></span> 3<span three></span>
      </div>
      <div
        quantum
        title="Quantum drive that provides a damage boost and well as AI programming for rotation of attached turrets."
      >
        Quantum Drive 1<span one></span> 2<span two></span> 3<span three></span>
      </div>
    </div>
    <div>
    <div main-title>Space Defense Engineer</div>
    <div money></div>
</div>
    </t-b
  ><s-c
    ><l-g></l-g><m-g><r-w></r-w><s-p></s-p></m-g><r-g></r-g
  ></s-c>
`;class GameScene extends HTMLElement{buildTable(e,t,n){setNotification(`Attack ${G.wave+1}`,"Build towers to defend this planet from invasion",6e3,"rgba(238, 153, 18, 1)");const i=n.shadowRoot.querySelector(e);var e=document.createElement("table"),o=document.createElement("tbody");e.appendChild(o);for(var s=i.clientWidth,l=i.clientHeight,r=0;s%100!=0;)--s,r+=1;for(var a=0;l%100!=0;)--l,a+=1;"left"===t?e.style.left=r+"px":e.style.right=r+"px",e.style.top=a/2+"px",e.style.bottom=a/2+"px";for(var d=0;d<l/100;d++){for(var c=dcr("tr",document),h=0;h<s/100;h++){var u=dcr("td",document);u.setAttribute("cost","left"===t?100*(h+1):100*(s/100-h)),c.appendChild(u)}o.appendChild(c)}return i.appendChild(e),n.buildTable}closeMenu(){var e=this.shadowRoot.querySelector("div[menu]");const t=e?.parentElement;e&&t&&t.removeChild(e)}buildMenu(){this.shadowRoot.querySelectorAll("td").forEach(d=>{d.addEventListener("click",e=>{this.closeMenu();const t=e.srcElement,i=dcr("div");i.setAttribute("menu",!0);let n=G.towers.split(""),o=!1;const s=d.querySelector("span");let l=""===s?.getAttribute("one")?"two":""===s?.getAttribute("two")?"three":""===s?.getAttribute("three")?"four":null;if(l=l||"one",Boolean(d.towers)&&(n=n.filter(e=>d.towers.includes(e)),o=!0),"four"===l&&(n=[]),n.forEach(o=>{const e=dcr("div");var t=tower_decode(o),n=parseInt(t[5]+""+t[6]+t[7],2)%G.tower_types.length,t=G.tower_types[n];e.setAttribute(t,""),e.setAttribute("legend","");n=Number(d.getAttribute("cost"));const s="blaster"===t?n:"thermal"===t?1.5*n:"phaser"===t?2*n:2.5*n;e.innerHTML=`<span ${l}></span> ${s}`,e.setAttribute("menu-item",!0),e.addEventListener("click",e=>{if(e.stopPropagation(),s>this.money)return setNotification("Insufficient Funds","Defeating waves will earn you money",4e3,"red"),void this.closeMenu();e=this.money-s;if(this.setMoney(e),null==d.towers&&(d.towers=""),d.towers.includes(o)){for(var t=0;t<d.childNodes.length;t++){var n=d.childNodes[t];if(n.towerId===o){n.childNodes[0].removeAttribute("one"),n.childNodes[0].removeAttribute("two"),void 0===n.level&&(n.level=1),n.level+=1;n.childNodes[0].setAttribute(["zero","one","two","three"][n.level],"");var i=[-999,{x:1,y:1},{x:1,y:-1},{x:2,y:0}][(parseInt(n.level)+1)%3+1];create_bullet(n,i.x,i.y);break}}for(t=0;t<G.bullets.length;t++)G.bullets[t].damage+=1.3;this.closeMenu()}else{d.towers+=o;e=create_tower(tower_decode(o),d.towers);e.towerId=o,e.classList.add("tower"),d.appendChild(e),d.style.position="relative",this.closeMenu()}}),i.appendChild(e)}),o){const r=Number(d.getAttribute("cost")),a=dcr("div");a.setAttribute("blaster",""),a.setAttribute("legend",""),a.style.color="red",a.innerHTML=`<span sell></span> sell ${r}`,a.setAttribute("menu-item",!0),a.addEventListener("click",e=>{e.stopPropagation();e=this.money+r;this.setMoney(e),d.towers="",d.children[0].remove(),removeOrphanBullets(),this.closeMenu()}),i.appendChild(a)}t.appendChild(i)})})}setMoney(e){this.money=e;const t=this.shadowRoot.querySelector("div[money]");t.style.color=e<1e3?"red":e<3e3?"yellow":"green",t.innerText=`$${e.toFixed(2)}`}connectedCallback(){this.shadowRoot||(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(t2.content.cloneNode(!0)),this.setMoney(this.clientWidth*(1200<this.clientWidth?8:4)),setTimeout(()=>{this.buildTable("l-g","left",this)("r-g","right",this),this.buildMenu(),setTimeout(()=>{var e=dcr("div");e.id="sst";var d=dcr("div");d.id="ssm";var t=dcr("div");t.id="ssb",window.ene=dcr("div"),ene.velocity=1,ene.velocityTrack=1,ene.health=100,ene.id="ene",ene.width=30,ene.height=30,d.style.backgroundColor="white",e.appendChild(d),d.appendChild(t),ene.appendChild(e);e=document.body.getBoundingClientRect();ene.style.left=e.width/2-15+"px",ene.style.top="40px",ene.y=40,ene.x=e.width/2-15,ene.recentHits=[],dba(ene);let c=3,h=0;var u=setInterval(()=>{if(!G.gameOver){if(this.shadowRoot.querySelector("[main-title]").innerText=`Space Defense Engineer (level ${Math.floor(c/3)}/${G.waves?.[0].length/3})`,ene.y>document.body.getBoundingClientRect().height){h+=1;const a=this.shadowRoot.querySelector("t-a");a.style.width=`${100-5*h}%`,20<=h&&r(!1)}(ene.y>document.body.getBoundingClientRect().height||ene.health<=0)&&(G.ei+=1,ene.y=40,ene.recentHits=[],ene.health=100+c/3*15,console.log(ene.health),c<G.waves[0].length?(c++,c%3==0&&(setNotification(`Level ${c/3}`,`Contract Paid + $${this.clientWidth*(1200<this.clientWidth?2:1.5)}`,3e3,"rgba(238, 153, 18, 1)"),this.setMoney(this.money+this.clientWidth*(1200<this.clientWidth?2:1.5)))):r(!0)),function(){function e(){var e=dcr("div");e.classList.add("hen");var t=dcr("img");return t.src="assets/images/rocket.png",t.classList.add("hei"),e.appendChild(t),e.width=12,e.height=12,dba(e),e.deg=0,e}for(null==window.stcHench&&(window.stcHench=[]),null==window.orbHench&&(window.orbHench=[]);stcHench.length<4;)stcHench.push(e());for(;orbHench.length<4;)orbHench.push(e());for(var t=0;t<8;t++)!function(e,t,n){ene.y<=50&&(e.dead=null),n&&null==e.dead?e.style.visibility="visible":(e.style.visibility="hidden",e.dead=!0);var i=[[-15,0],[-15,-15],[0,-15],[15,-15],[15,0],[15,15],[0,15],[-15,15]],o=0<=i[t][0]?1:-1,s=0<=i[t][1]?1:-1,l=o*(ene.width/2)+o*(e.width/2),n=s*(ene.height/2)+s*(e.height/2),o=ene.x+l+o*i[t][0],t=ene.y+n+s*i[t][1];e.x=o,e.y=t,e.style.left=o+"px",e.style.top=t+"px"}(t<4?stcHench[t]:orbHench[t%4],t,t<4?t+1<=3:t%4+1<=3)}(),ene.health<50?ene.style.color="red":ene.style.color="green",80<ene.health?d.style.backgroundColor="green":50<ene.health?d.style.backgroundColor="yellow":d.style.backgroundColor="red",d.style.width=ene.health/4,ene.y+=Math.min(Math.floor(ene.velocityTrack),1),ene.velocityTrack+=ene.velocityTrack,ene.velocityTrack=Math.min(ene.velocityTrack,1),ene.style.top=ene.y+"px";for(var e=-1,t=0;t<G.bullets.length;t++){for(var n=G.bullets[t],i=n.getBoundingClientRect(),o=ene.getBoundingClientRect(),s=0;s<8;s++){var l=s<4?stcHench[s]:orbHench[s%4];if(!l.dead&&rects_collide({left:l.x,top:l.y+l.height,width:l.width,height:l.height},i)){e=t,l.dead=!0;break}}if(-1<e){n.reset=!0,n.x=n.ox,n.y=n.oy,n.style.left=n.x+"px",n.style.top=n.y+"px";break}if(rects_collide(i,o)&&!ene.recentHits.includes(t)){n.phase&&(ene.y-=8),ene.health-=n.damage,e=t,null!=n.slow&&(ene.velocityTrack=n.slow);break}}-1<e&&!ene.recentHits.includes(e)&&ene.recentHits.push(e),ene.health<0&&(ene.health=0)}function r(e){clearInterval(u),G.gameOver=!0,setNotification(e?"Success!":"Fired!",e?"You have fulfilled your contract by successfully defending this planet.":"You have failed to defend this planet.",25e4,e?"green":"red")}},14)},6e3)},1e3))}}customElements.define("sd-game-scene",GameScene);