function SfxrParams(){this.setSettings=function(e){for(var t=0;t<24;t++){this[String.fromCharCode(97+t)]=e[t]||0}if(this["c"]<.01){this["c"]=.01}var i=this["b"]+this["c"]+this["e"];if(i<.18){var n=.18/i;this["b"]*=n;this["c"]*=n;this["e"]*=n}}}function SfxrSynth(){this._params=new SfxrParams;var e,t,i,n,r,a,s,o,l,h,u,f;this.reset=function(){var e=this._params;n=100/(e["f"]*e["f"]+.001);r=100/(e["g"]*e["g"]+.001);a=1-e["h"]*e["h"]*e["h"]*.01;s=-e["i"]*e["i"]*e["i"]*1e-6;if(!e["a"]){u=.5-e["n"]/2;f=-e["o"]*5e-5}o=1+e["l"]*e["l"]*(e["l"]>0?-.9:10);l=0;h=e["m"]==1?0:(1-e["m"])*(1-e["m"])*2e4+32};this.totalReset=function(){this.reset();var n=this._params;e=n["b"]*n["b"]*1e5;t=n["c"]*n["c"]*1e5;i=n["e"]*n["e"]*1e5+12;return((e+t+i)/3|0)*3};this.synthWave=function(c,d){var p=this._params;var v=p["s"]!=1||p["v"],y=p["v"]*p["v"]*.1,g=1+p["w"]*3e-4,x=p["s"]*p["s"]*p["s"]*.1,b=1+p["t"]*1e-4,m=p["s"]!=1,w=p["x"]*p["x"],P=p["g"],S=p["q"]||p["r"],M=p["r"]*p["r"]*p["r"]*.2,k=p["q"]*p["q"]*(p["q"]<0?-1020:1020),T=p["p"]?((1-p["p"])*(1-p["p"])*2e4|0)+32:0,O=p["d"],U=p["j"]/2,j=p["k"]*p["k"]*.01,_=p["a"];var C=e,E=1/e,I=1/t,z=1/i;var A=5/(1+p["u"]*p["u"]*20)*(.01+x);if(A>.8){A=.8}A=1-A;var B=false,q=0,G=0,F=0,L=0,R=0,D,W=0,Y,X=0,N,V=0,K,H=0,J,Q,Z=0;var $=new Array(1024),ee=new Array(32);for(var te=$.length;te--;){$[te]=0}for(var te=ee.length;te--;){ee[te]=Math.random()*2-1}for(var te=0;te<d;te++){if(B){return te}if(T){if(++H>=T){H=0;this.reset()}}if(h){if(++l>=h){h=0;n*=o}}a+=s;n*=a;if(n>r){n=r;if(P>0){B=true}}Y=n;if(U>0){Z+=j;Y*=1+Math.sin(Z)*U}Y|=0;if(Y<8){Y=8}if(!_){u+=f;if(u<0){u=0}else if(u>.5){u=.5}}if(++G>C){G=0;switch(++q){case 1:C=t;break;case 2:C=i}}switch(q){case 0:F=G*E;break;case 1:F=1+(1-G*I)*2*O;break;case 2:F=1-G*z;break;case 3:F=0;B=true}if(S){k+=M;N=k|0;if(N<0){N=-N}else if(N>1023){N=1023}}if(v&&g){y*=g;if(y<1e-5){y=1e-5}else if(y>.1){y=.1}}Q=0;for(var ie=8;ie--;){X++;if(X>=Y){X%=Y;if(_==3){for(var ne=ee.length;ne--;){ee[ne]=Math.random()*2-1}}}switch(_){case 0:J=X/Y<u?.5:-.5;break;case 1:J=1-X/Y*2;break;case 2:K=X/Y;K=(K>.5?K-1:K)*6.28318531;J=1.27323954*K+.405284735*K*K*(K<0?1:-1);J=.225*((J<0?-1:1)*J*J-J)+J;break;case 3:J=ee[Math.abs(X*32/Y|0)]}if(v){D=W;x*=b;if(x<0){x=0}else if(x>.1){x=.1}if(m){R+=(J-W)*x;R*=A}else{W=J;R=0}W+=R;L+=W-D;L*=1-y;J=L}if(S){$[V%1024]=J;J+=$[(V-N+1024)%1024];V++}Q+=J}Q*=.125*F*w;c[te]=Q>=1?32767:Q<=-1?-32768:Q*32767|0}return d}}var synth=new SfxrSynth;window["jsfxr"]=function(e){synth._params.setSettings(e);var t=synth.totalReset();var i=new Uint8Array(((t+1)/2|0)*4+44);var n=synth.synthWave(new Uint16Array(i.buffer,44),t)*2;var r=new Uint32Array(i.buffer,0,44);r[0]=1179011410;r[1]=n+36;r[2]=1163280727;r[3]=544501094;r[4]=16;r[5]=65537;r[6]=44100;r[7]=88200;r[8]=1048578;r[9]=1635017060;r[10]=n;n+=44;var a=0,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o="data:audio/wav;base64,";for(;a<n;a+=3){var l=i[a]<<16|i[a+1]<<8|i[a+2];o+=s[l>>18]+s[l>>12&63]+s[l>>6&63]+s[l&63]}return o};(function e(t,i,n){function r(s,o){if(!i[s]){if(!t[s]){var l=typeof require=="function"&&require;if(!o&&l)return l(s,!0);if(a)return a(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var u=i[s]={exports:{}};t[s][0].call(u.exports,function(e){var i=t[s][1][e];return r(i?i:e)},u,u.exports,e,t,i,n)}return i[s].exports}var a=typeof require=="function"&&require;for(var s=0;s<n.length;s++)r(n[s]);return r})({1:[function(e,t,i){"use strict";if(!e("./is-implemented")()){Object.defineProperty(e("es5-ext/global"),"Symbol",{value:e("./polyfill"),configurable:true,enumerable:false,writable:true})}},{"./is-implemented":2,"./polyfill":18,"es5-ext/global":5}],2:[function(e,t,i){"use strict";t.exports=function(){var e;if(typeof Symbol!=="function")return false;e=Symbol("test symbol");try{String(e)}catch(t){return false}if(typeof Symbol.iterator==="symbol")return true;if(typeof Symbol.isConcatSpreadable!=="object")return false;if(typeof Symbol.iterator!=="object")return false;if(typeof Symbol.toPrimitive!=="object")return false;if(typeof Symbol.toStringTag!=="object")return false;if(typeof Symbol.unscopables!=="object")return false;return true}},{}],3:[function(e,t,i){"use strict";t.exports=function(e){return e&&(typeof e==="symbol"||e["@@toStringTag"]==="Symbol")||false}},{}],4:[function(e,t,i){"use strict";var n=e("es5-ext/object/assign"),r=e("es5-ext/object/normalize-options"),a=e("es5-ext/object/is-callable"),s=e("es5-ext/string/#/contains"),o;o=t.exports=function(e,t){var i,a,o,l,h;if(arguments.length<2||typeof e!=="string"){l=t;t=e;e=null}else{l=arguments[2]}if(e==null){i=o=true;a=false}else{i=s.call(e,"c");a=s.call(e,"e");o=s.call(e,"w")}h={value:t,configurable:i,enumerable:a,writable:o};return!l?h:n(r(l),h)};o.gs=function(e,t,i){var o,l,h,u;if(typeof e!=="string"){h=i;i=t;t=e;e=null}else{h=arguments[3]}if(t==null){t=undefined}else if(!a(t)){h=t;t=i=undefined}else if(i==null){i=undefined}else if(!a(i)){h=i;i=undefined}if(e==null){o=true;l=false}else{o=s.call(e,"c");l=s.call(e,"e")}u={get:t,set:i,configurable:o,enumerable:l};return!h?u:n(r(h),u)}},{"es5-ext/object/assign":6,"es5-ext/object/is-callable":9,"es5-ext/object/normalize-options":13,"es5-ext/string/#/contains":15}],5:[function(e,t,i){"use strict";t.exports=new Function("return this")()},{}],6:[function(e,t,i){"use strict";t.exports=e("./is-implemented")()?Object.assign:e("./shim")},{"./is-implemented":7,"./shim":8}],7:[function(e,t,i){"use strict";t.exports=function(){var e=Object.assign,t;if(typeof e!=="function")return false;t={foo:"raz"};e(t,{bar:"dwa"},{trzy:"trzy"});return t.foo+t.bar+t.trzy==="razdwatrzy"}},{}],8:[function(e,t,i){"use strict";var n=e("../keys"),r=e("../valid-value"),a=Math.max;t.exports=function(e,t){var i,s,o=a(arguments.length,2),l;e=Object(r(e));l=function(n){try{e[n]=t[n]}catch(r){if(!i)i=r}};for(s=1;s<o;++s){t=arguments[s];n(t).forEach(l)}if(i!==undefined)throw i;return e}},{"../keys":10,"../valid-value":14}],9:[function(e,t,i){"use strict";t.exports=function(e){return typeof e==="function"}},{}],10:[function(e,t,i){"use strict";t.exports=e("./is-implemented")()?Object.keys:e("./shim")},{"./is-implemented":11,"./shim":12}],11:[function(e,t,i){"use strict";t.exports=function(){try{Object.keys("primitive");return true}catch(e){return false}}},{}],12:[function(e,t,i){"use strict";var n=Object.keys;t.exports=function(e){return n(e==null?e:Object(e))}},{}],13:[function(e,t,i){"use strict";var n=Array.prototype.forEach,r=Object.create;var a=function(e,t){var i;for(i in e)t[i]=e[i]};t.exports=function(e){var t=r(null);n.call(arguments,function(e){if(e==null)return;a(Object(e),t)});return t}},{}],14:[function(e,t,i){"use strict";t.exports=function(e){if(e==null)throw new TypeError("Cannot use null or undefined");return e}},{}],15:[function(e,t,i){"use strict";t.exports=e("./is-implemented")()?String.prototype.contains:e("./shim")},{"./is-implemented":16,"./shim":17}],16:[function(e,t,i){"use strict";var n="razdwatrzy";t.exports=function(){if(typeof n.contains!=="function")return false;return n.contains("dwa")===true&&n.contains("foo")===false}},{}],17:[function(e,t,i){"use strict";var n=String.prototype.indexOf;t.exports=function(e){return n.call(this,e,arguments[1])>-1}},{}],18:[function(e,t,i){"use strict";var n=e("d"),r=e("./validate-symbol"),a=Object.create,s=Object.defineProperties,o=Object.defineProperty,l=Object.prototype,h,u,f=a(null);var c=function(){var e=a(null);return function(t){var i=0,r;while(e[t+(i||"")])++i;t+=i||"";e[t]=true;r="@@"+t;o(l,r,n.gs(null,function(e){o(this,r,n(e))}));return r}}();u=function d(e){if(this instanceof u)throw new TypeError("TypeError: Symbol is not a constructor");return d(e)};t.exports=h=function p(e){var t;if(this instanceof p)throw new TypeError("TypeError: Symbol is not a constructor");t=a(u.prototype);e=e===undefined?"":String(e);return s(t,{__description__:n("",e),__name__:n("",c(e))})};s(h,{"for":n(function(e){if(f[e])return f[e];return f[e]=h(String(e))}),keyFor:n(function(e){var t;r(e);for(t in f)if(f[t]===e)return t}),hasInstance:n("",h("hasInstance")),isConcatSpreadable:n("",h("isConcatSpreadable")),iterator:n("",h("iterator")),match:n("",h("match")),replace:n("",h("replace")),search:n("",h("search")),species:n("",h("species")),split:n("",h("split")),toPrimitive:n("",h("toPrimitive")),toStringTag:n("",h("toStringTag")),unscopables:n("",h("unscopables"))});s(u.prototype,{constructor:n(h),toString:n("",function(){return this.__name__})});s(h.prototype,{toString:n(function(){return"Symbol ("+r(this).__description__+")"}),valueOf:n(function(){return r(this)})});o(h.prototype,h.toPrimitive,n("",function(){return r(this)}));o(h.prototype,h.toStringTag,n("c","Symbol"));o(u.prototype,h.toPrimitive,n("c",h.prototype[h.toPrimitive]));o(u.prototype,h.toStringTag,n("c",h.prototype[h.toStringTag]))},{"./validate-symbol":19,d:4}],19:[function(e,t,i){"use strict";var n=e("./is-symbol");t.exports=function(e){if(!n(e))throw new TypeError(e+" is not a symbol");return e}},{"./is-symbol":3}],20:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,i,n){if(i)e(t.prototype,i);if(n)e(t,n);return t}}();var r=function f(e,t,i){var n=true;e:while(n){var r=e,a=t,s=i;o=l=h=undefined;n=false;if(r===null)r=Function.prototype;var o=Object.getOwnPropertyDescriptor(r,a);if(o===undefined){var l=Object.getPrototypeOf(r);if(l===null){return undefined}else{e=l;t=a;i=s;n=true;continue e}}else if("value"in o){return o.value}else{var h=o.get;if(h===undefined){return undefined}return h.call(s)}}};function a(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function o(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var l=e("./GameState");var h=a(l);var u=function(e){o(t,e);function t(e){s(this,t);r(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e)}n(t,[{key:"init",value:function i(){this.uiTime=this.engine.timestamp;this.engine.gamepad.fire=false}},{key:"update",value:function a(e){if((this.engine.gamepad.fire||this.engine.gamepad.esc)&&e-this.uiTime>200){this.engine.setState("titleState");this.engine.gamepad.fire=false}var t=this.engine.ctx;t.fillStyle="#030";t.fillRect(0,0,this.engine.width,this.engine.height);t.strokeStyle="#140";t.save();t.translate(.5*this.engine.width-Math.cos(6e-4*e)*100,.5*this.engine.height+-Math.sin(.001*e)*100);t.rotate(2*Math.cos(1e-4*e));var i=e*.2;t.beginPath();for(var n=-700;n<700;n+=50){t.moveTo(n,-700);t.lineTo(n,700)}t.stroke();t.beginPath();for(var r=-700;r<700;r+=50){t.moveTo(-700,r);t.lineTo(700,r)}t.stroke();t.restore();t.font="112px sans-serif";t.fillStyle="#fff";this.engine.centerText("About",150);t.font="24px sans-serif";this.engine.centerText("Galactic Backfire is a classic space shooter ...",250);this.engine.centerText("... but it is running in reverse!",280);this.engine.centerText("You must get behind the enemy",340);this.engine.centerText("and pull bullets into them.",370);this.engine.centerText("Written by Rene Hangstrup Møller",430);this.engine.centerText("For the JS13K Competition 2015.",460);this.engine.centerText("Press ESC to exit to menu",520)}}]);return t}(h["default"]);i["default"]=u;t.exports=i["default"]},{"./GameState":31}],21:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,i,n){if(i)e(t.prototype,i);if(n)e(t,n);return t}}();function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function e(t){r(this,e);this.controlPoints=t}n(e,[{key:"getPoint",value:function t(e){var t=e|0;var i=t*2;var n=Math.min(i+1,this.controlPoints.length);var r=Math.min(i+2,this.controlPoints.length);var a=e-t;var s=a*a;var o=1-a;var l=o*o;var h=this.controlPoints[i].x;var u=this.controlPoints[i].y;var f=this.controlPoints[n].x;var c=this.controlPoints[n].y;var d=this.controlPoints[r].x;var p=this.controlPoints[r].y;var v=l*h+2*o*a*f+s*d;var y=l*u+2*o*a*c+s*p;return{x:v,y:y}}}]);return e}();i["default"]=a;t.exports=i["default"]},{}],22:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,i,n){if(i)e(t.prototype,i);if(n)e(t,n);return t}}();function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var s=e("./Bezier");var o=r(s);var l=function(){function e(t){a(this,e);this.bezier=t;this.segments=(t.controlPoints.length-1)/2}n(e,[{key:"init",value:function t(e,i){e.bezierTime=0}},{key:"update",value:function i(e,t){e.bezierTime+=.008;if(e.bezierTime>this.segments){e.bezierTime=0}var i=this.bezier.getPoint(e.bezierTime);e.setPosition(i.x,i.y)}}]);return e}();i["default"]=l;t.exports=i["default"]},{"./Bezier":21}],23:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,i,n){if(i)e(t.prototype,i);if(n)e(t,n);return t}}();function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function e(t,i){r(this,e);this.x=0;this.y=0;this.w=t;this.h=i;this.vx=0;this.vy=0}n(e,[{key:"setPosition",value:function t(e,i){this.x=e;this.y=i}},{key:"setVelocity",value:function i(e,t){this.vx=e;this.vy=t}},{key:"update",value:function a(){this.x+=this.vx;this.y+=this.vy}}]);return e}();i["default"]=a;t.exports=i["default"]},{}],24:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,i,n){if(i)e(t.prototype,i);if(n)e(t,n);return t}}();var r=function f(e,t,i){var n=true;e:while(n){var r=e,a=t,s=i;o=l=h=undefined;n=false;if(r===null)r=Function.prototype;var o=Object.getOwnPropertyDescriptor(r,a);if(o===undefined){var l=Object.getPrototypeOf(r);if(l===null){return undefined}else{e=l;t=a;i=s;n=true;continue e}}else if("value"in o){return o.value}else{var h=o.get;if(h===undefined){return undefined}return h.call(s)}}};function a(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function o(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var l=e("./GameState");var h=a(l);var u=function(e){o(t,e);function t(e){s(this,t);r(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e)}n(t,[{key:"init",value:function i(){this.uiTime=this.engine.timestamp;this.engine.gamepad.fire=false}},{key:"update",value:function a(e){if((this.engine.gamepad.fire||this.engine.gamepad.esc)&&e-this.uiTime>200){this.engine.setState("titleState");this.engine.gamepad.fire=false}var t=this.engine.ctx;t.fillStyle="#303 ";t.fillRect(0,0,this.engine.width,this.engine.height);t.strokeStyle="#414";t.save();t.translate(.5*this.engine.width-Math.cos(6e-4*e)*100,.5*this.engine.height+-Math.sin(.001*e)*100);t.rotate(2*Math.cos(1e-4*e));var i=e*.2;t.beginPath();for(var n=-700;n<700;n+=50){t.moveTo(n,-700);t.lineTo(n,700)}t.stroke();t.beginPath();for(var r=-700;r<700;r+=50){t.moveTo(-700,r);t.lineTo(700,r)}t.stroke();t.restore();t.font="112px sans-serif";t.fillStyle="#fff";this.engine.centerText("Controls",150);t.font="24px sans-serif";this.engine.centerText("Move your space ship with",250);this.engine.centerText("WASD or arrow keys",280);this.engine.centerText("Shoot with",340);this.engine.centerText("Space or enter",370);this.engine.centerText("Press ESC to exit to menu",430)}}]);return t}(h["default"]);i["default"]=u;t.exports=i["default"]},{"./GameState":31}],25:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,i,n){if(i)e(t.prototype,i);if(n)e(t,n);return t}}();function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function e(t){r(this,e);this.x1=t.x1;this.y1=t.y1;this.x2=t.x2;this.y2=t.y2;this.xm1=t.xm1;this.ym1=t.ym1;this.xm2=t.xm2;this.ym2=t.ym2;this.xs1=t.xs1;this.ys1=t.ys1;this.xs2=t.xs2;this.ys2=t.ys2;this.t=0;this.tm=t.tm}n(e,[{key:"init",value:function t(e,i){}},{key:"update",value:function i(e,t){this.t+=.002;var i=Math.min(this.t,1);var n=i*this.x2+(1-i)*this.x1;var r=i*this.y2+(1-i)*this.y1;var a=this.t+this.tm;n+=Math.cos(.01*this.tm+a*this.xs1)*this.xm1-150;r+=Math.sin(.02*this.tm+a*this.ys2)*this.ym1*.4;n+=Math.cos(.03*this.tm+a*this.xs1)*this.xm2;r+=Math.sin(.04*this.tm+a*this.ys2)*this.ym2;e.setPosition(n,r)}}]);return e}();i["default"]=a;t.exports=i["default"]},{}],26:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,i,n){if(i)e(t.prototype,i);if(n)e(t,n);return t}}();function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var s=e("./GamePad");var o=r(s);var l=function(){function e(t,i,n){a(this,e);this.width=t;this.height=i;this.timestamp=n;this.lastTime=n;var r=document.createElement("canvas");r.width=t;r.height=i;this.gamepad=new o["default"](r);var s=r.getContext("2d");s.fillStyle="#000";s.fillRect(0,0,t,i);var l=document.getElementById("game");l.appendChild(r);document.body.style.backgroundColor="#000";document.body.style.align="center";r.style.marginLeft="auto";r.style.marginRight="auto";r.style.display="block";var h=function u(){var e=window.innerWidth/t;var n=window.innerHeight/i;var a=Math.min(e,n);if(a<1){r.style.width=t*a+"px";r.style.height=i*a+"px"}else{r.style.width=t+"px";r.style.height=i+"px"}document.body.scrollLeft=0;document.body.scrollTop=0};h();window.addEventListener("resize",h,false);window.addEventListener("orientationChange",h,false);this.canvas=r;this.ctx=s;this.updater=this.update.bind(this)}n(e,[{key:"update",value:function t(e){requestAnimationFrame(this.updater);this.timestamp=e;this.state.update(e);this.lastTime=e}},{key:"start",value:function i(){requestAnimationFrame(this.updater)}},{key:"setState",value:function r(e){this.state=this.gameStates[e];this.state.init()}},{key:"centerText",value:function s(e,t){var i=this.ctx.measureText(e);this.ctx.fillText(e,.5*(this.width-i.width),t)}}]);return e}();i["default"]=l;t.exports=i["default"]},{"./GamePad":30}],27:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,i,n){if(i)e(t.prototype,i);if(n)e(t,n);return t}}();function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function e(t,i,n){r(this,e);this.seq=t;this.controller=i;this.x=0;this.y=0;this.vx=0;this.vy=0;this.lastX=0;this.lastY=0;this.sprite=n}n(e,[{key:"setPosition",value:function t(e,i){this.x=e;this.y=i}},{key:"setVelocity",value:function i(e,t){this.vx=e;this.vy=t}},{key:"update",value:function a(e){this.controller.update(this,e);this.a=Math.PI+Math.atan2(this.y-this.lastY,this.x-this.lastX);this.lastX=this.x;this.lastY=this.y}}]);return e}();i["default"]=a;t.exports=i["default"]},{}],28:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,i,n){if(i)e(t.prototype,i);if(n)e(t,n);return t}}();function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var s=e("./Foe");var o=r(s);var l=e("./SineWaveController");var h=r(l);var u=e("./BezierCurveController");var f=r(u);var c=e("./Bezier");var d=r(c);var p=e("./CurvyController");var v=r(p);var y=0;var g=1;var x=function(){function e(t){a(this,e);this.level=t;this.engine=t.engine;this.foeSeq=0;this.foeTime=t.engine.timestamp;this.hardness=1;this.wave=0;this.bezier=new d["default"](this.buildBezierPoints());this.curve=this.makeCurve();this.sprite=0;this.spawnUntil=t.engine.timestamp+2500;this.waitUntil=t.engine.timestamp+2e3;this.spawnType=0;this.prepareNextWave()}n(e,[{key:"spawn",value:function t(e,i,n){var r=new o["default"](this.foeSeq++,i,n);i.init(r,e);return r}},{key:"spawnTo",value:function i(e,t){if(t<this.waitUntil){return}if(t-this.foeTime>this.spawnRate){var i=null;switch(this.spawnType){case 0:i=new f["default"](this.bezier);break;case 1:i=new v["default"](this.curve);break;default:i=new h["default"](this.engine)}var n=this.spawn(t,i,this.sprite);e.add(n);this.foeTime=t}if(t>this.spawnUntil){this.prepareNextWave()}}},{key:"prepareNextWave",value:function r(){this.waitUntil=this.spawnUntil+2500+500*Math.random();if(this.hardness%10==0){this.waitUntil+=5e3}this.spawnUntil=this.waitUntil+1e3+500*this.hardness+100*Math.random();this.spawnRate=500+100*Math.random();this.sprite++;if(this.sprite>=50){this.sprite=1}this.spawnType=(this.spawnType+1)%3;if(this.spawnType==0){this.bezier=new d["default"](this.buildBezierPoints())}else if(this.spawnType==1){this.curve=this.makeCurve()}this.hardness+=.2;this.wave++}},{key:"makeCurve",value:function s(){var e={};e.x1=-150;e.x2=this.engine.width+150;e.y1=100+(this.engine.height-200)*Math.random();e.y2=100+(this.engine.height-200)*Math.random();e.xm1=10+50*Math.min(.1*this.hardness,5)*Math.random();e.ym1=200+100*Math.min(10,.2*this.hardness)*Math.random();e.xm2=10+10*Math.random();e.ym2=50+20*Math.random();e.xs1=20+Math.random()*10;e.ys1=5+Math.random()*2;e.xs2=25+Math.random()*10;e.ys2=2+Math.random()*5;e.tm=Math.random();return e}},{key:"buildBezierPoints",value:function l(){var e=[];var t=Math.random()>.5;var i={x:Math.random()*this.engine.width*.5,y:t?-50:this.engine.height+50};e.push({x:i.x,y:i.y});var n=50;for(var r=0;r<3;r++){i.x+=n;i.y=t?0:this.engine.height;e.push({x:i.x,y:i.y});var a=Math.min(100,Math.max(50,(this.engine.width-i.x)*Math.random()));var s=Math.min(50,Math.max(25,i.x*Math.random()));n=Math.random()>.5&&i.x>100?-s:a;i.x+=n;i.y=.5*this.engine.height;e.push({x:i.x,y:i.y});t=!t;i.x+=n;i.y=t?0:this.engine.height;e.push({x:i.x,y:i.y});i.x+=n;i.y=t?0:this.engine.height;e.push({x:i.x,y:i.y})}i.x+=n;i.y=t?0:this.engine.height;e.push({x:i.x,y:i.y});e.push({x:this.engine.width+100,y:Math.random()*this.engine.height});return e}}]);return e}();i["default"]=x;t.exports=i["default"]},{"./Bezier":21,"./BezierCurveController":22,"./CurvyController":25,"./Foe":27,"./SineWaveController":35}],29:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,i,n){if(i)e(t.prototype,i);if(n)e(t,n);return t}}();var r=function f(e,t,i){var n=true;e:while(n){var r=e,a=t,s=i;o=l=h=undefined;n=false;if(r===null)r=Function.prototype;var o=Object.getOwnPropertyDescriptor(r,a);if(o===undefined){var l=Object.getPrototypeOf(r);if(l===null){return undefined}else{e=l;t=a;i=s;n=true;continue e}}else if("value"in o){return o.value}else{var h=o.get;if(h===undefined){return undefined}return h.call(s)}}};function a(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function o(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var l=e("./GameState");var h=a(l);var u=function(e){o(t,e);function t(e){s(this,t);r(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e)}n(t,[{key:"init",value:function i(){this.uiTime=this.engine.timestamp;this.engine.gamepad.fire=false}},{key:"update",value:function a(e){if((this.engine.gamepad.fire||this.engine.gamepad.esc)&&e-this.uiTime>200){this.engine.setState("titleState");this.engine.gamepad.fire=false}var t=this.engine.ctx;t.fillStyle="#300";t.fillRect(0,0,this.engine.width,this.engine.height);t.strokeStyle="#512";t.save();t.translate(.5*this.engine.width-Math.cos(6e-4*e)*100,.5*this.engine.height+-Math.sin(.001*e)*100);t.rotate(2e-4*e);var i=e*.2;t.beginPath();for(var n=-700;n<700;n+=50){t.moveTo(n,-700);t.lineTo(n,700)}t.stroke();t.beginPath();for(var r=-700;r<700;r+=50){t.moveTo(-700,r);t.lineTo(700,r)}t.stroke();t.restore();t.font="112px sans-serif";t.fillStyle="#fff";this.engine.centerText("Game Over",200);t.font="32px sans-serif";this.engine.centerText("Sector: "+this.engine.gameStates.levelState.sector,350);this.engine.centerText("Score: "+this.engine.gameStates.levelState.score,400)}}]);return t}(h["default"]);i["default"]=u;t.exports=i["default"]},{"./GameState":31}],30:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var r=function a(e){var t=this;n(this,a);this.left=false;this.up=false;this.right=false;this.down=false;this.fire=false;this.esc=false;this.touchId=null;this.touchStartX=0;this.touchStartY=0;this.touchDx=0;this.touchDy=0;this.canvas=e;window.addEventListener("keydown",function(e){var i=e.ctrlKey||e.metaKey;switch(e.keyCode){case 37:t.left=true;break;case 38:t.up=true;break;case 39:t.right=true;break;case 40:t.down=true;break;case 32:t.fire=true;break;case 13:t.fire=true;break;case 27:t.esc=true;break;case 65:t.left=true;break;case 87:t.up=true;break;case 68:t.right=true;break;case 83:t.down=true;break;default:i=true}if(!i){e.preventDefault()}},false);window.addEventListener("keyup",function(e){switch(e.keyCode){case 37:t.left=false;break;case 38:t.up=false;break;case 39:t.right=false;break;case 40:t.down=false;break;case 32:t.fire=false;break;case 13:t.fire=false;break;case 27:t.esc=false;break;case 65:t.left=false;break;case 87:t.up=false;break;case 68:t.right=false;break;case 83:t.down=false;break}e.preventDefault()},false);e.addEventListener("touchstart",function(e){t.fire=true;if(!t.touchId){var i=e.changedTouches;t.touchId=i[0].identifier;t.touchStartX=i[0].pageX-t.canvas.offsetLeft;t.touchStartY=i[0].pageY-t.canvas.offsetTop}},false);e.addEventListener("touchend",function(e){t.fire=false;t.touchId=null;t.left=false;t.right=false;t.up=false;t.down=false},false);e.addEventListener("touchcancel",function(e){t.fire=false;t.touchId=null;t.left=false;t.right=false;t.up=false;t.down=false},false);e.addEventListener("touchmove",function(e){var i=e.changedTouches;for(var n=0;n<i.length;n++){if(i[n].identifier==t.touchId){var r=i[n].pageX-t.touchStartX-t.canvas.offsetLeft;var a=i[n].pageY-t.touchStartY-t.canvas.offsetTop;t.touchDx=r;t.touchDy=a;if(Math.abs(r)>20){t.left=r<0;t.right=r>0}else{t.left=false;t.right=false}if(Math.abs(a)>20){t.up=a<0;t.down=a>0}else{t.up=false;t.down=false}}}e.preventDefault()},false)};i["default"]=r;t.exports=i["default"]},{}],31:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,i,n){if(i)e(t.prototype,i);if(n)e(t,n);return t}}();function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function e(t){r(this,e);this.engine=t;this.lastTime=this.engine.timestamp}n(e,[{key:"init",value:function t(){}},{key:"update",value:function i(e){}}]);return e}();i["default"]=a;t.exports=i["default"]},{}],32:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,i,n){if(i)e(t.prototype,i);if(n)e(t,n);return t}}();var r=function M(e,t,i){var n=true;e:while(n){var r=e,a=t,s=i;o=l=h=undefined;n=false;if(r===null)r=Function.prototype;var o=Object.getOwnPropertyDescriptor(r,a);if(o===undefined){var l=Object.getPrototypeOf(r);if(l===null){return undefined}else{e=l;t=a;i=s;n=true;continue e}}else if("value"in o){return o.value}else{var h=o.get;if(h===undefined){return undefined}return h.call(s)}}};function a(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function o(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var l=e("./GameState");var h=a(l);var u=e("./Body");var f=a(u);var c=e("./ShipGenerator");var d=a(c);var p=e("./FoeFactory");var v=a(p);var y=e("./Scratch");var g=a(y);var x=10;var b=1e4;var m=15e3;var w=2e4;var P=10;var S=function(e){o(t,e);function t(e){s(this,t);r(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e);var i=new f["default"](16,16);i.x=.5*this.engine.width;i.y=.5*this.engine.height;i.setVelocity(0,0);i.a=0;this.block=i;this.block.shield=1;this.bullets=new Set;this.bulletTime=0;this.foes=new Set;this.foeBullets=new Set;this.foeTime=0;this.foeSeq=0;this.explosions=new Set;this.lastTime=0;this.smoke=new Set;this.lastSmoke=0;this.soundURL=jsfxr([0,,.1142,,.206,.7893,.2,-.3076,,,,,,.197,.1255,,.1282,-.0075,1,,,,,.5]);this.soundPool=[];this.soundIdx=0;this.explodeUrl=jsfxr([3,,.3503,.4872,.2499,.0754,,.2127,,,,,,,,.6977,,,1,,,,,.5]);this.explodePool=[];this.explodeIdx=0;this.explode2Url=jsfxr([3,,.3569,.3891,.63,.0483,,,,,,,,,,,.5952,-.1039,1,,,,,.5]);this.explode2Pool=[];this.explode2Idx=0;this.powerUpUrl=jsfxr([0,,.1414,,.497,.3508,,.4704,,,,,,.1086,,.4007,,,1,,,,,.5]);this.powerUpSndPool=[];this.powerUpSndIdx=0;this.nextShieldPowerUp=0;this.nextBulletPowerUp=0;this.nextLifePowerUp=0;
this.firePower=1;this.flash=0;this.sector=1;this.sectorAnnounce=1;for(var n=0;n<10;n++){var a=new Audio;a.src=this.soundURL;this.soundPool.push(a);var o=new Audio;o.src=this.explodeUrl;this.explodePool.push(o);var l=new Audio;l.src=this.explode2Url;this.explode2Pool.push(l);var h=new Audio;h.src=this.powerUpUrl;this.powerUpSndPool.push(h)}var u=new d["default"];var c=document.createElement("canvas");c.width=40;c.height=40;var p=c.getContext("2d");p.translate(20,20);p.rotate(-.5*Math.PI);p.scale(.2,.2);u.paintShip(p);this.subCanvas=c;var y=[];for(var n=0;n<50;n++){var g=document.createElement("canvas");g.width=40;g.height=40;var x=g.getContext("2d");x.translate(20,20);x.rotate(-.5*Math.PI);x.scale(.2,.2);u.paintShip(x);y.push(g)}this.foeSprites=y;this.foeFactory=new v["default"](this);this.init();this.shieldPowerUp=null;this.bulletPowerUp=null;this.lifePowerUp=null}n(t,[{key:"init",value:function i(){this.score=0;this.lives=3;this.foes.clear();this.foeBullets.clear();this.bullets.clear();this.explosions.clear();this.smoke.clear();this.block.shield=1;this.block.x=.5*this.engine.width;this.block.y=.5*this.engine.height;this.block.setVelocity(0,0);this.block.a=0;this.scratch=new g["default"];this.foeFactory.hardness=1;this.foeFactory.wave=0;this.nextShieldPowerUp=this.engine.timestamp+m;this.nextBulletPowerUp=this.engine.timestamp+b;this.nextLifePowerUp=this.engine.timestamp+w;this.firePower=2;this.flash=0;this.sector=1;this.sectorAnnounce=1;this.dead=false;this.deathTime=0;this.deathPos=null}},{key:"update",value:function a(e){var t=this;var i=e-this.lastTime;var n=this.engine.ctx;var r=this.block;var a=this.engine.gamepad;if(a.esc){this.engine.setState("titleState")}if(!this.dead){if(a.touchId){var s=Math.atan2(a.touchDy,a.touchDx);r.vx=Math.cos(s)*4;r.vy=Math.cos(s)*4}else{if(a.left){r.vx=-4}else if(a.right){r.vx=4}else{r.vx=0}if(a.up){r.vy=-4}else if(a.down){r.vy=4}else{r.vy=0}}}else{this.block.vx=1;this.block.vy=2}if(!this.dead){var o=Math.atan2(r.vy,12);var l=o-r.a;r.a+=.2*l}else{r.a+=.1;if(this.lastSmoke+100<e){this.smoke.add({x:this.block.x,y:this.block.y,vx:Math.random()*.5-1,vy:-1,t:e,a:1});this.smoke.add({x:this.block.x,y:this.block.y,vx:Math.random()*.5-1,vy:-1.5,t:e,a:1});this.lastSmoke=e}}r.update();if(r.y<20){r.y=20}else if(r.y>this.engine.height-20&&!r.dead){r.y=this.engine.height-20}if(r.x<20){r.x=20}else if(r.x>this.engine.width-20){r.x=this.engine.width-20}this.foeFactory.spawnTo(this.foes,e);if(!this.dead&&a.fire&&e-this.bulletTime>150){switch(this.firePower){case 1:this.bullets.add({x:this.engine.width,y:r.y,vx:-6,vy:0});break;case 2:this.bullets.add({x:this.engine.width,y:r.y-10,vx:-6,vy:0});this.bullets.add({x:this.engine.width,y:r.y+10,vx:-6,vy:0});break;case 3:this.bullets.add({x:this.engine.width,y:r.y+20,vx:-6,vy:0});this.bullets.add({x:this.engine.width+5,y:r.y,vx:-6,vy:0});this.bullets.add({x:this.engine.width,y:r.y-20,vx:-6,vy:0});break;case 4:this.bullets.add({x:this.engine.width,y:r.y-10,vx:-6,vy:0});this.bullets.add({x:this.engine.width+5,y:r.y+10,vx:-6,vy:0});this.bullets.add({x:this.engine.width+5,y:r.y-30,vx:-6,vy:0});this.bullets.add({x:this.engine.width,y:r.y+30,vx:-6,vy:0});break;case 5:this.bullets.add({x:this.engine.width,y:r.y+40,vx:-6,vy:0});this.bullets.add({x:this.engine.width+5,y:r.y+20,vx:-6,vy:0});this.bullets.add({x:this.engine.width+10,y:r.y,vx:-6,vy:0});this.bullets.add({x:this.engine.width+5,y:r.y-20,vx:-6,vy:0});this.bullets.add({x:this.engine.width,y:r.y-40,vx:-6,vy:0});break}this.bulletTime=e;this.soundIdx=(this.soundIdx+1)%10;var h=this.soundPool[this.soundIdx];h.play()}if(this.shieldPowerUp==null&&this.nextShieldPowerUp<e){this.shieldPowerUp={x:this.engine.width+10,y:Math.cos(e*1e-4)*this.engine.height*.4+.5*this.engine.height}}if(this.shieldPowerUp){this.shieldPowerUp.x-=1;this.shieldPowerUp.y=Math.cos(e*1e-4)*this.engine.height*.4+.5*this.engine.height;var u=this.shieldPowerUp.x-r.x;var f=this.shieldPowerUp.y-r.y;var c=Math.sqrt(u*u+f*f);if(c<30){this.shieldPowerUp=null;this.nextShieldPowerUp=e+m;this.block.shield=1;this.powerUpSndIdx=(this.powerUpSndIdx+1)%10;var h=this.powerUpSndPool[this.powerUpSndIdx];h.play()}else if(this.shieldPowerUp.x<0){this.shieldPowerUp=null;this.nextShieldPowerUp=e+m}}if(this.bulletPowerUp==null&&this.nextBulletPowerUp<e&&this.firePower<5){this.bulletPowerUp={x:this.engine.width+10,y:Math.cos(e*1e-4)*this.engine.height*.4+.5*this.engine.height}}if(this.bulletPowerUp){this.bulletPowerUp.x-=1;this.bulletPowerUp.y=Math.cos(e*2e-4)*this.engine.height*.4+.5*this.engine.height;var u=this.bulletPowerUp.x-r.x;var f=this.bulletPowerUp.y-r.y;var c=Math.sqrt(u*u+f*f);if(c<30){this.bulletPowerUp=null;this.nextBulletPowerUp=e+b;this.firePower++;this.powerUpSndIdx=(this.powerUpSndIdx+1)%10;var h=this.powerUpSndPool[this.powerUpSndIdx];h.play()}else if(this.bulletPowerUp.x<0){this.bulletPowerUp=null;this.nextBulletPowerUp=e+b}}if(this.lifePowerUp==null&&this.nextLifePowerUp<e&&this.lives<5){this.lifePowerUp={x:this.engine.width+10,y:Math.cos(e*1e-4)*this.engine.height*.4+.5*this.engine.height}}if(this.lifePowerUp){this.lifePowerUp.x-=1;this.lifePowerUp.y=Math.cos(e*3e-4)*this.engine.height*.4+.5*this.engine.height;var u=this.lifePowerUp.x-r.x;var f=this.lifePowerUp.y-r.y;var c=Math.sqrt(u*u+f*f);if(c<30){this.lifePowerUp=null;this.nextLifePowerUp=e+w;this.lives++;this.powerUpSndIdx=(this.powerUpSndIdx+1)%10;var h=this.powerUpSndPool[this.powerUpSndIdx];h.play()}else if(this.lifePowerUp.x<0){this.lifePowerUp=null;this.nextLifePowerUp=e+w}}this.smoke.forEach(function(e){e.x+=e.vx;e.y+=e.vy;e.a-=.01;if(e.a<0)e.a=0;if(e.t<t.timestamp-2e3){t.smoke["delete"](e)}});this.foes.forEach(function(i){i.update(e);if(i.x>.01*t.engine.width&&Math.random()<.005){t.foeBullets.add({x:0,y:i.y,vx:4,vy:0,owner:i})}var n=r.x-i.x;var a=r.y-i.y;var s=Math.sqrt(n*n+a*a);if(i.x>t.engine.width+32){t.foes["delete"](i)}else if(s<32&&r.shield<=0){t.foes["delete"](i);for(var o=0;o<5;o++){t.explosions.add({x:r.x+5*Math.random()-10,y:r.y+5*Math.random()-10,energy:10,vx:Math.random()-.5,vy:Math.random()-.5})}t.lives--;t.block.shield=1;t.firePower=Math.max(1,t.firePower-1);t.flash=1;t.explode2Idx=(t.explode2Idx+1)%10;t.explode2Pool[t.explode2Idx].play();t.explodeIdx=(t.explodeIdx+1)%10;t.explodePool[t.explodeIdx].play()}});this.bullets.forEach(function(e){var i=r.x-e.x;var n=r.y-e.y;var a=Math.sqrt(i*i+n*n);var s=Math.atan2(n,i);var o=Math.cos(s);var l=Math.sin(s);e.vx=o*8;e.vy=l*8;e.x+=e.vx;e.y+=e.vy;if(e.x<r.x-70||e.x<0||e.y>t.engine.height+100||e.y<-100||a<20){t.bullets["delete"](e)}});this.foeBullets.forEach(function(e){var i=e.owner.x-e.x;var n=e.owner.y-e.y;var a=Math.sqrt(i*i+n*n);var s=Math.atan2(n,i);var o=Math.cos(s);var l=Math.sin(s);e.vx=o*8;e.vy=l*8;e.x+=e.vx;e.y+=e.vy;if(a<20||e.x>t.engine.width){t.foeBullets["delete"](e)}var h=r.x-e.x;var u=r.y-e.y;var f=Math.sqrt(h*h+u*u);if(f<20&&r.shield<=0){t.foeBullets["delete"](e);for(var c=0;c<5;c++){t.explosions.add({x:r.x+5*Math.random()-10,y:r.y+5*Math.random()-10,energy:10,vx:Math.random()-.5,vy:Math.random()-.5})}t.block.shield=1;t.lives--;t.firePower=Math.max(1,t.firePower-1);t.flash=1;t.explode2Idx=(t.explode2Idx+1)%10;t.explode2Pool[t.explode2Idx].play()}});this.block.shield-=.005;this.bullets.forEach(function(e){t.foes.forEach(function(i){var n=i.x-e.x;var r=i.y-e.y;var a=Math.sqrt(n*n+r*r);if(a<20){for(var s=0;s<5;s++){t.explosions.add({x:i.x+5*Math.random()-10,y:i.y+5*Math.random()-10,energy:10,vx:Math.random()-.5,vy:Math.random()-.5})}t.foes["delete"](i);t.bullets["delete"](e);t.score+=100;t.explodeIdx=(t.explodeIdx+1)%10;t.explodePool[t.explodeIdx].play()}})});this.explosions.forEach(function(e){e.energy-=.2;if(e.energy<0){t.explosions["delete"](e)}});if(this.lives<1&&!this.dead){this.dead=true;this.deathTime=e;this.deathPos={x:r.x,y:r.y}}if(this.dead&&e-this.deathTime>3e3){this.engine.setState("gameOverState")}this.flash-=.05;if(this.flash>0){var d=255*this.flash|0;n.fillStyle="rgb("+d+", 0, 16)";n.strokeStyle="rgb("+d+", 16, 33)"}else{n.fillStyle="#001";n.strokeStyle="#012"}n.fillRect(0,0,this.engine.width,this.engine.height);var p=e*.2%50;for(var v=0;v<this.engine.width;v+=50){n.beginPath();n.moveTo(this.engine.width-(v+50-p)%this.engine.width,0);n.lineTo(this.engine.width-(v+50-p)%this.engine.width,this.engine.height);n.stroke()}for(var y=0;y<this.engine.height;y+=50){n.beginPath();n.moveTo(0,y);n.lineTo(this.engine.width,y);n.stroke()}if(this.foeFactory.wave/P>this.sector){this.sector++;this.sectorAnnounce=1}this.sectorAnnounce-=.005;if(this.sectorAnnounce>0){n.font="30px sans-serif";n.fillStyle="rgba(255,255,255,"+this.sectorAnnounce+")";this.engine.centerText("Approaching sector "+this.sector,this.engine.height-50)}n.save();n.translate(r.x,r.y);if(r.shield>0){n.lineWidth=2;var g=.5*r.shield*(.75+.25*Math.sin(e*.02));n.strokeStyle="rgba(100,255,255,"+g+")";n.beginPath();n.arc(0,0,30,0,Math.PI*2,false);n.stroke();n.fillStyle="rgba(0,100,255,"+.25*g+")";n.fill()}n.rotate(r.a);n.globalCompositeOperation="lighter";n.fillStyle="rgba(255,150,10,"+(.75+.25*Math.cos(e*.05))+")";n.beginPath();for(var x=0;x<5;x++){n.moveTo(0,7*Math.random()-2);n.lineTo(0,-7*Math.random()+2);n.lineTo(-2*r.vx+10*Math.random()-20,5*Math.random()-2.5)}n.fill();n.globalCompositeOperation="source-over";n.drawImage(this.subCanvas,-20,-20);n.restore();if(this.shieldPowerUp){var g=.5+.3*Math.cos(.01*e);n.fillStyle="rgba(255,255,0,"+g*.1+")";n.beginPath();n.arc(this.shieldPowerUp.x,this.shieldPowerUp.y,16,0,Math.PI*2,false);n.fill();n.fillStyle="rgba(255,255,0,"+g+")";n.beginPath();n.arc(this.shieldPowerUp.x,this.shieldPowerUp.y,8,0,Math.PI*2,false);n.fill()}if(this.bulletPowerUp){var g=.5+.3*Math.cos(.01*e);n.fillStyle="rgba(0,255,255,"+g*.1+")";n.beginPath();n.arc(this.bulletPowerUp.x,this.bulletPowerUp.y,16,0,Math.PI*2,false);n.fill();n.fillStyle="rgba(0,255,255,"+g+")";n.beginPath();n.arc(this.bulletPowerUp.x,this.bulletPowerUp.y,8,0,Math.PI*2,false);n.fill()}if(this.lifePowerUp){var g=.5+.3*Math.cos(.01*e);n.fillStyle="rgba(255,0,0,"+g*.1+")";n.beginPath();n.arc(this.lifePowerUp.x,this.lifePowerUp.y,16,0,Math.PI*2,false);n.fill();n.fillStyle="rgba(255,0,0,"+g+")";n.beginPath();n.arc(this.lifePowerUp.x,this.lifePowerUp.y,8,0,Math.PI*2,false);n.fill()}n.fillStyle="#0ff";this.bullets.forEach(function(e){n.fillRect(e.x-6,e.y-2,12,4)});n.fillStyle="#f0f";this.foeBullets.forEach(function(e){n.fillRect(e.x-6,e.y-2,12,4)});this.smoke.forEach(function(t){var i=t.a*100|0;n.fillStyle="rgba("+i+","+i+","+i+","+t.a+")";n.beginPath();var r=4+(e-t.t)/50;n.arc(t.x,t.y,r,0,2*Math.PI,false);n.fill()});n.fillStyle="#00f";n.strokeStyle="#0ff";this.foes.forEach(function(i){n.save();n.translate(i.x,i.y);n.rotate(i.a);n.globalCompositeOperation="lighter";n.fillStyle="rgba(255,150,10,"+(.75+.25*Math.cos(e*.05))+")";n.beginPath();for(var r=0;r<5;r++){n.moveTo(0,7*Math.random()-2);n.lineTo(0,-7*Math.random()+2);n.lineTo(10*Math.random()-20,5*Math.random()-2.5)}n.fill();n.globalCompositeOperation="source-over";n.drawImage(t.foeSprites[i.sprite],-20,-20);n.restore()});n.globalCompositeOperation="lighter";n.lineWidth=1;this.explosions.forEach(function(e){var t=100-100*e.energy*e.energy*.01;var i=1-t/100;var r=255;var a=255-200*(1-i)|0;var s=0;var o="rgba("+r+", "+a+", "+s+", "+i+")";n.strokeStyle="rgba(255, 0, 0, "+i+")";n.fillStyle=o;if(e.vx){e.x+=e.vx;e.y+=e.vy}n.beginPath();n.arc(e.x,e.y,.5*t,0,2*Math.PI,false);n.fill();n.stroke()});n.globalCompositeOperation="source-over";n.fillStyle="#fff";n.font="20px sans-serif";var S=this.lives+" lives";n.fillText(S,this.engine.width-(20+n.measureText(S).width),20);n.fillText("Score: "+this.score,20,20);this.scratch.update(n,e);this.lastTime=e}}]);return t}(h["default"]);i["default"]=S;t.exports=i["default"]},{"./Body":23,"./FoeFactory":28,"./GameState":31,"./Scratch":33,"./ShipGenerator":34}],33:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,i,n){if(i)e(t.prototype,i);if(n)e(t,n);return t}}();function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function e(){r(this,e)}n(e,[{key:"update",value:function t(e,i){}}]);return e}();i["default"]=a;t.exports=i["default"]},{}],34:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,i,n){if(i)e(t.prototype,i);if(n)e(t,n);return t}}();function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function e(){r(this,e);var t=document.createElement("canvas");t.width=800;t.height=500;this.canvas=t;this.ctx=t.getContext("2d");document.body.appendChild(t);this.ctx.fillStyle="#000";this.ctx.fillRect(0,0,800,500);this.shipx=-50;this.shipy=0}n(e,[{key:"paintShips",value:function t(){var e=this.ctx;this.shipx+=50;if(this.shipx>=800){this.shipx=0;this.shipy+=50;if(this.shipy>=500){this.shipy=0}}e.save();e.translate(this.shipx,this.shipy);e.scale(.25,.25);var t=document.createElement("canvas");t.width=200;t.height=200;var i=t.getContext("2d");i.fillStyle="#000";i.fillRect(0,0,100,100);i.translate(100,100);this.paintShip(i);e.drawImage(t,0,0);e.restore()}},{key:"paintShip",value:function i(e){e.beginPath();var t=Math.random()*320|0;var i=Math.random()*50|0+50;var n=Math.random()*50|0+50;e.fillStyle="hsl("+t+","+i+"%,"+n+"%)";e.strokeStyle="hsl("+t+","+90+"%,"+90+"%)";var r=0;var a=0;e.moveTo(r,a);var s=[];var o=1+Math.random()*3;for(var l=0;l<o;l++){r+=80/o;a+=20-Math.random()*40;e.lineTo(r,a);s.push({x:r,y:a})}o=1+Math.random()*3;for(var l=0;l<o;l++){r+=Math.random()*5-12;a+=10+Math.random()*5;e.lineTo(r,a);s.push({x:r,y:a})}o=1+Math.random()*2;var h=50-a;for(var l=0;l<o;l++){r-=10;a+=h/o;e.lineTo(r,a);s.push({x:r,y:a})}e.lineTo(0,100);e.fill();e.beginPath();e.moveTo(0,0);s.forEach(function(t){e.lineTo(-t.x,t.y)});e.lineTo(0,100);e.fill();e.fillStyle="#000";e.beginPath();e.scale(1,1+Math.random());e.arc(0,5+Math.random()*10,20,0,Math.PI);e.fill()}},{key:"run",value:function a(){var e=this.paintShips.bind(this);setInterval(e,100)}}]);return e}();i["default"]=a;t.exports=i["default"]},{}],35:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,i,n){if(i)e(t.prototype,i);if(n)e(t,n);return t}}();function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function e(t){r(this,e);this.vx=2+Math.random();this.p=.001+Math.random()*.001;this.engine=t}n(e,[{key:"init",value:function t(e,i){e.setPosition(-50,Math.sin(i*2e-4*Math.random)*this.engine.height*.5+.5*this.engine.height);e.setVelocity(2,0);e.lastX=e.x-e.vx;e.lastY=e.y-e.vy}},{key:"update",value:function i(e,t){e.x+=e.vx*1.5;e.y=Math.sin(-.6*e.seq+t*this.p)*this.engine.height*.4+.5*this.engine.height}}]);return e}();i["default"]=a;t.exports=i["default"]},{}],36:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(t,i,n){if(i)e(t.prototype,i);if(n)e(t,n);return t}}();var r=function d(e,t,i){var n=true;e:while(n){var r=e,a=t,s=i;o=l=h=undefined;n=false;if(r===null)r=Function.prototype;var o=Object.getOwnPropertyDescriptor(r,a);if(o===undefined){var l=Object.getPrototypeOf(r);if(l===null){return undefined}else{e=l;t=a;i=s;n=true;continue e}}else if("value"in o){return o.value}else{var h=o.get;if(h===undefined){return undefined}return h.call(s)}}};function a(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function o(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var l=e("./GameState");var h=a(l);var u=e("./ShipGenerator");var f=a(u);var c=function(e){o(t,e);function t(e){s(this,t);r(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e);this.selected=0;this.uiTime=this.engine.timestamp;var i=new f["default"];var n=[];for(var a=0;a<50;a++){var o=document.createElement("canvas");o.width=40;o.height=40;var l=o.getContext("2d");l.translate(20,20);l.rotate(-.5*Math.PI);l.scale(.2,.2);i.paintShip(l);n.push(o)}this.foeSprites=n}n(t,[{key:"update",value:function i(e){if(this.engine.gamepad.fire&&e-this.uiTime>200){switch(this.selected){case 0:this.engine.setState("levelState");break;case 1:this.engine.setState("controlsState");break;case 2:this.engine.setState("aboutState");break}}if(this.engine.gamepad.up&&e-this.uiTime>200){this.selected=(this.selected+2)%3;this.uiTime=e}if(this.engine.gamepad.down&&e-this.uiTime>200){this.selected=(this.selected+1)%3;this.uiTime=e}var t=this.engine.ctx;t.fillStyle="#002";t.fillRect(0,0,this.engine.width,this.engine.height);t.strokeStyle="#013";t.save();t.translate(.5*this.engine.width-Math.cos(6e-4*e)*100,.5*this.engine.height+-Math.sin(.001*e)*100);t.rotate(2*Math.cos(1e-4*e));var i=e*.2;t.beginPath();for(var n=-700;n<700;n+=50){t.moveTo(n,-700);t.lineTo(n,700)}t.stroke();t.beginPath();for(var r=-700;r<700;r+=50){t.moveTo(-700,r);t.lineTo(700,r)}t.stroke();t.restore();t.globalAlpha=.2;var a=this.engine.timestamp*5e-4;for(var s=0;s<50;s++){var o=Math.PI/25;var n=.5*this.engine.width+Math.cos(o*s+a)*(this.engine.width-50)*.5;var r=.5*this.engine.height+Math.sin(o*s+a)*(this.engine.height-50)*.5;t.save();t.translate(n,r);t.rotate(o*s+a+Math.PI*.5);t.drawImage(this.foeSprites[s],0,0);t.restore()}t.globalAlpha=1;t.fillStyle="rgba(128,255,255,"+(.15+.05*Math.cos(e*.005))+")";t.fillRect(0,340+this.selected*40,this.engine.width,40);t.fillStyle="#fff";t.font="100px sans-serif";this.engine.centerText("Galactic Backfire",250);t.font="20px sans-serif";this.engine.centerText("A space shooter in reverse",280);t.font="32px sans-serif";this.engine.centerText("New Game",370);this.engine.centerText("Controls",410);this.engine.centerText("About",450)}}]);return t}(h["default"]);i["default"]=c;t.exports=i["default"]},{"./GameState":31,"./ShipGenerator":34}],37:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var r=e("./GameState");var a=n(r);var s=e("./TitleState");var o=n(s);var l=e("./LevelState");var h=n(l);var u=e("./GameOverState");var f=n(u);var c=e("./ControlsState");var d=n(c);var p=e("./AboutState");var v=n(p);var y=e("./Engine");var g=n(y);e("es6-symbol/implement");requestAnimationFrame(function(e){window.scrollTo(0,1);var t=new g["default"](960,640,e);var i={};i.titleState=new o["default"](t);i.levelState=new h["default"](t);i.gameOverState=new f["default"](t);i.controlsState=new d["default"](t);i.aboutState=new v["default"](t);t.gameStates=i;t.setState("titleState");t.start()})},{"./AboutState":20,"./ControlsState":24,"./Engine":26,"./GameOverState":29,"./GameState":31,"./LevelState":32,"./TitleState":36,"es6-symbol/implement":1}]},{},[37]);