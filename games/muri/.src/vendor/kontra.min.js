this.kontra={init:function(t){var i=this.canvas=document.getElementById(t)||t||document.querySelector("canvas");if(!this._isCanvas(i))throw Error("You must provide a canvas element for the game");this.context=i.getContext("2d")},_noop:new Function,_isString:function(t){return""+t===t},_isNumber:function(t){return+t===t},_isFunc:function(t){return"function"==typeof t},_isImage:function(t){return!!t&&"IMG"===t.nodeName||this._isCanvas(t)},_isCanvas:function(t){return!!t&&"CANVAS"===t.nodeName}},function(t){function i(){for(var t=[],i=0;i<arguments.length;i++)arguments[i]&&t.push(arguments[i].trim().replace(new RegExp("(^[/]{"+(t[0]?1:2)+",}|[/]*$)","g"),""));return t.join("/")}function e(t){return t.split(".").pop()}function n(t){var i=t.replace("."+e(t),"");return 0==i.indexOf("/")&&0==i.lastIndexOf("/")?i.substr(1):i}function s(e){var s=n(e),a=new Image,r=kontra.assets,o=r.images;return e=i(r.imagePath,e),new t(function(t,i){a.onload=function(){o[s]=o[e]=this,t(this)},a.onerror=function(){i("Unable to load image "+e)},a.src=e})}function a(s){var a,r,o,h,c,u=kontra.assets,f=u.audio,m=u.audioPath;return Array.isArray(s)||(s=[s]),new t(function(t,u){for(c=0;a=s[c];c++)if(d[e(a)]){o=a;break}o?(r=n(o),h=new Audio,a=i(m,o),h.addEventListener("canplay",function(){f[r]=f[a]=this,t(this)}),h.onerror=function(){u("Unable to load audio "+a)},h.src=a,h.load()):u("cannot play any of the audio formats provided")})}function r(e){var s=n(e),a=new XMLHttpRequest,r=kontra.assets,o=r.data;return e=i(r.dataPath,e),new t(function(t,i){a.addEventListener("load",function(){var n=a.responseText;if(200!==a.status)return i(n);try{n=JSON.parse(n)}catch(t){}o[s]=o[e]=n,t(n)}),a.open("GET",e,!0),a.send()})}var o=/(jpeg|jpg|gif|png)$/,h=/(wav|mp3|ogg|aac)$/,c=/^no$/,u=new Audio,d={wav:"",mp3:u.canPlayType("audio/mpeg;").replace(c,""),ogg:u.canPlayType('audio/ogg; codecs="vorbis"').replace(c,""),aac:u.canPlayType("audio/aac;").replace(c,"")};kontra.assets={images:{},audio:{},data:{},imagePath:"",audioPath:"",dataPath:"",load:function(){var i,n,c,u,d=[];for(c=0;n=arguments[c];c++)u=(i=e(Array.isArray(n)?n[0]:n)).match(o)?s(n):i.match(h)?a(n):r(n),d.push(u);return t.all(d)},_canUse:d}}(Promise),function(t,i,e){t.gameLoop=function(n){function s(){if(r=i(s),o=e.now(),h=o-a,a=o,!(h>1e3)){for(u+=h;u>=d;)p.update(f),u-=d;m(),p.render()}}if(n=n||{},!t._isFunc(n.update)||!t._isFunc(n.render))throw Error("You must provide update() and render() functions");var a,r,o,h,c=n.fps||60,u=0,d=1e3/c,f=1/c,m=!1===n.clearCanvas?t._noop:function(){t.context.clearRect(0,0,t.canvas.width,t.canvas.height)},p={update:n.update,render:n.render,isStopped:!0,start:function(){a=e.now(),this.isStopped=!1,i(s)},stop:function(){this.isStopped=!0,cancelAnimationFrame(r)},_frame:s,set _last(t){a=t}};return p}}(kontra,requestAnimationFrame,performance),function(t){t.pool=function(i){i=i||{};var e,n=0,s=0;if(!t._isFunc(i.create)||!(e=i.create())||!(t._isFunc(e.update)&&t._isFunc(e.init)&&t._isFunc(e.isAlive)))throw Error("Must provide create() function which returns an object with init(), update(), and isAlive() functions");return{create:i.create,objects:[e],size:1,maxSize:i.maxSize||1/0,get:function(t){if(t=t||{},this.objects[0].isAlive()){if(this.size===this.maxSize)return;for(var i=0;i<this.size&&this.objects.length<this.maxSize;i++)this.objects.unshift(this.create());this.size=this.objects.length,n=this.size-1}var e=this.objects[0];e.init(t);for(var a=1;a<this.size;a++)this.objects[a-1]=this.objects[a];this.objects[n]=e,s++},getAliveObjects:function(){return this.objects.slice(this.objects.length-s)},clear:function(){s=n=this.objects.length=0,this.size=1,this.objects.push(this.create())},update:function(t){for(var i,e=n,a=Math.max(this.objects.length-s,0);e>=a;)if((i=this.objects[e]).update(t),i.isAlive())e--;else{for(var r=e;r>0;r--)this.objects[r]=this.objects[r-1];this.objects[0]=i,s--,a++}},render:function(){for(var t=Math.max(this.objects.length-s,0),i=n;i>=t;i--)this.objects[i].render&&this.objects[i].render()}}}}(kontra),function(t){t.quadtree=function(i){var e=Object.create(t.quadtree.prototype);return e._init(i),e},t.quadtree.prototype={_init:function(i){i=i||{},this.maxDepth=i.maxDepth||3,this.maxObjects=i.maxObjects||25,this._branch=!1,this._depth=i.depth||0,this._parent=i.parent,this.bounds=i.bounds||{x:0,y:0,width:t.canvas.width,height:t.canvas.height},this.objects=[],this.subnodes=[]},clear:function(){if(this._branch)for(var t=0;t<4;t++)this.subnodes[t].clear();this._branch=!1,this.objects.length=0},get:function(t){for(var i,e,n=[];this.subnodes.length&&this._branch;){for(i=this._getIndex(t),e=0;e<i.length;e++)n.push.apply(n,this.subnodes[i[e]].get(t));return n}return this.objects},add:function(){var t,i,e,n;for(i=0;i<arguments.length;i++)if(e=arguments[i],Array.isArray(e))this.add.apply(this,e);else if(this.subnodes.length&&this._branch)this._add2Sub(e);else if(this.objects.push(e),this.objects.length>this.maxObjects&&this._depth<this.maxDepth){for(this._split(),t=0;n=this.objects[t];t++)this._add2Sub(n);this.objects.length=0}},_add2Sub:function(t){var i,e=this._getIndex(t);for(i=0;i<e.length;i++)this.subnodes[e[i]].add(t)},_getIndex:function(t){var i=[],e=this.bounds.x+this.bounds.width/2,n=this.bounds.y+this.bounds.height/2,s=t.y<n&&t.y+t.height>=this.bounds.y,a=t.y+t.height>=n&&t.y<this.bounds.y+this.bounds.height;return t.x<e&&t.x+t.width>=this.bounds.x&&(s&&i.push(0),a&&i.push(2)),t.x+t.width>=e&&t.x<this.bounds.x+this.bounds.width&&(s&&i.push(1),a&&i.push(3)),i},_split:function(){if(this._branch=!0,!this.subnodes.length)for(var i=this.bounds.width/2|0,e=this.bounds.height/2|0,n=0;n<4;n++)this.subnodes[n]=t.quadtree({bounds:{x:this.bounds.x+(n%2==1?i:0),y:this.bounds.y+(n>=2?e:0),width:i,height:e},depth:this._depth+1,maxDepth:this.maxDepth,maxObjects:this.maxObjects,parent:this})}}}(kontra),function(t,i,e){t.vector=function(i,e){var n=Object.create(t.vector.prototype);return n._init(i,e),n},t.vector.prototype={_init:function(t,i){this._x=t||0,this._y=i||0},add:function(t,i){this._x+=(t.x||0)*(i||1),this._y+=(t.y||0)*(i||1)},clamp:function(t,i,n,s){this._clamp=!0,this._xMin=void 0!==t?t:-e,this._yMin=void 0!==i?i:-e,this._xMax=void 0!==n?n:e,this._yMax=void 0!==s?s:e},get x(){return this._x},get y(){return this._y},set x(t){this._x=this._clamp?i.min(i.max(this._xMin,t),this._xMax):t},set y(t){this._y=this._clamp?i.min(i.max(this._yMin,t),this._yMax):t}},t.sprite=function(i){var e=Object.create(t.sprite.prototype);return e.init(i),e},t.sprite.prototype={init:function(i){var e,n,s,a=this;i=i||{},a.position=a.position||t.vector(),a.velocity=a.velocity||t.vector(),a.acceleration=a.acceleration||t.vector(),a.position._init(i.x,i.y),a.velocity._init(i.dx,i.dy),a.acceleration._init(i.ddx,i.ddy),a.width=a.height=0;for(var r in i)a[r]=i[r];if(a.ttl=i.ttl||0,a.context=i.context||t.context,a.advance=a._advance,a.draw=a._draw,t._isImage(e=i.image))a.image=e,a.width=e.width,a.height=e.height,a.draw=a._drawImg;else if(e=i.animations){a.animations={};for(var o in e)n=e[o],a.animations[o]=n.clone?n.clone():n,s||(s=a.animations[o]);a.currentAnimation=s,a.width=s.width,a.height=s.height,a.advance=a._advanceAnim,a.draw=a._drawAnim}},get x(){return this.position.x},get y(){return this.position.y},get dx(){return this.velocity.x},get dy(){return this.velocity.y},get ddx(){return this.acceleration.x},get ddy(){return this.acceleration.y},set x(t){this.position.x=t},set y(t){this.position.y=t},set dx(t){this.velocity.x=t},set dy(t){this.velocity.y=t},set ddx(t){this.acceleration.x=t},set ddy(t){this.acceleration.y=t},isAlive:function(){return this.ttl>0},collidesWith:function(t){return this.x<t.x+t.width&&this.x+this.width>t.x&&this.y<t.y+t.height&&this.y+this.height>t.y},update:function(t){this.advance(t)},render:function(){this.draw()},playAnimation:function(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop=!1,this.currentAnimation._frame=0},loopAnimation:function(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop=!0,this.currentAnimation._frame=0},_advance:function(t){this.velocity.add(this.acceleration,t),this.position.add(this.velocity,t),this.ttl--},_advanceAnim:function(t){this._advance(t),this.currentAnimation.update(t)},_draw:function(){this.context.fillStyle=this.color,this.context.fillRect(this.x,this.y,this.width,this.height)},_drawImg:function(){this.context.drawImage(this.image,this.x,this.y)},_drawAnim:function(){this.currentAnimation.render({context:this.context,x:this.x,y:this.y})}}}(kontra,Math,1/0),function(t){t.animation=function(i){var e=Object.create(t.animation.prototype);return e._init(i),e},t.animation.prototype={_init:function(t){t=t||{},this.spriteSheet=t.spriteSheet,this.frames=t.frames,this.frameRate=t.frameRate,this.loop=t.loop||!0;var i=t.spriteSheet.frame;this.width=i.width,this.height=i.height,this.margin=i.margin||0,this._frame=0,this._accum=0},clone:function(){return t.animation(this)},update:function(t){if(this.loop||this._frame!==this.frames.length-1)for(t=t||1/60,this._accum+=t;this._accum*this.frameRate>=1;)this._frame=++this._frame%this.frames.length,this._accum-=1/this.frameRate},render:function(i){var e=(i=i||{}).context||t.context,n=this.frames[this._frame]/this.spriteSheet.framesPerRow|0,s=this.frames[this._frame]%this.spriteSheet.framesPerRow|0;e.drawImage(this.spriteSheet.image,s*this.width+(2*s+1)*this.margin,n*this.height+(2*n+1)*this.margin,this.width,this.height,i.x,i.y,this.width,this.height)}},t.spriteSheet=function(i){var e=Object.create(t.spriteSheet.prototype);return e._init(i),e},t.spriteSheet.prototype={_init:function(i){if(i=i||{},!t._isImage(i.image))throw Erorr("You must provide an Image for the SpriteSheet");this.animations={},this.image=i.image,this.frame={width:i.frameWidth,height:i.frameHeight,margin:i.frameMargin},this.framesPerRow=i.image.width/i.frameWidth|0,this.createAnimations(i.animations)},createAnimations:function(i){var e,n,s,a;for(var r in i){if(e=i[r],n=e.frames,s=e.frameRate,a=[],void 0===n)throw Error("Animation "+r+" must provide a frames property");Array.isArray(n)||(n=[n]);for(var o,h=0;o=n[h];h++)a.push.apply(a,this._parse(o));this.animations[r]=t.animation({spriteSheet:this,frames:a,frameRate:s})}},_parse:function(e){if(t._isNumber(e))return[e];var n=[],s=e.split(".."),a=i=+s[0],r=+s[1];if(a<r)for(;i<=r;i++)n.push(i);else for(;i>=r;i--)n.push(i);return n}}}(kontra);