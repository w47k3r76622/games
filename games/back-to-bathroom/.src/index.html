<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><style type="text/css">body,html{width:100%;height:100%;margin:0;padding:0;overflow:hidden}body{background-color:#2f2323}canvas{background-color:#796868;image-rendering:-moz-crisp-edges;image-rendering:-webkit-crisp-edges;image-rendering:pixelated;image-rendering:crisp-edges;border:1px solid #000}#game-div,canvas{width:100%;height:100%}#game-div{align-content:center;text-align:center}</style></head><body><div id="game-div"><canvas id="canvas"></canvas></div><script type="text/javascript">!function(t){var i={};function e(s){if(i[s])return i[s].exports;var h=i[s]={i:s,l:!1,exports:{}};return t[s].call(h.exports,h,h.exports,e),h.l=!0,h.exports}e.m=t,e.c=i,e.d=function(t,i,s){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:s})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(e.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var h in t)e.d(s,h,function(i){return t[i]}.bind(null,h));return s},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=6)}([function(t,i){t.exports="assets/player.png"},function(t,i){t.exports="assets/toilet.png"},function(t,i){t.exports="assets/shit.png"},function(t,i){t.exports="assets/bread.png"},function(t,i,e){},,function(t,i,e){"use strict";e.r(i);let s,h,n={};function r(t,i){n[t]=n[t]||[],n[t].push(i)}function o(t,...i){n[t]&&n[t].map(t=>t(...i))}function a(){return s}function c(){return h}function l(t){if(!(s=document.getElementById(t)||t||document.querySelector("canvas")))throw Error("You must provide a canvas element for the game");return(h=s.getContext("2d")).imageSmoothingEnabled=!1,o("init"),{canvas:s,context:h}}class d{constructor({spriteSheet:t,frames:i,frameRate:e,loop:s=!0}={}){this.spriteSheet=t,this.frames=i,this.frameRate=e,this.loop=s;let{width:h,height:n,margin:r=0}=t.frame;this.width=h,this.height=n,this.margin=r,this._f=0,this._a=0}clone(){return p(this)}reset(){this._f=0,this._a=0}update(t=1/60){if(this.loop||this._f!=this.frames.length-1)for(this._a+=t;this._a*this.frameRate>=1;)this._f=++this._f%this.frames.length,this._a-=1/this.frameRate}render({x:t,y:i,width:e=this.width,height:s=this.height,context:h=c()}={}){let n=this.frames[this._f]/this.spriteSheet._f|0,r=this.frames[this._f]%this.spriteSheet._f|0;h.drawImage(this.spriteSheet.image,r*this.width+(2*r+1)*this.margin,n*this.height+(2*n+1)*this.margin,this.width,this.height,t,i,e,s)}}function p(t){return new d(t)}p.prototype=d.prototype,p.class=d;let u=/(jpeg|jpg|gif|png)$/,f=/(wav|mp3|ogg|aac)$/,m=/^\//,x=/\/$/,g=new WeakMap,y="",w="",S="";function v(t,i){return new URL(t,i).href}function _(t,i){return[t.replace(x,""),t?i.replace(m,""):i].filter(t=>t).join("/")}function b(t){return t.split(".").pop()}function T(t){let i=t.replace("."+b(t),"");return 2==i.split("/").length?i.replace(m,""):i}let j={},A={},E={};function O(){window.__k||(window.__k={dm:g,u:v,d:E,i:j})}function M(t){return O(),new Promise((i,e)=>{let s,h,n;if(s=_(y,t),j[s])return i(j[s]);(h=new Image).onload=function(){n=v(s,window.location.href),j[T(t)]=j[s]=j[n]=this,o("assetLoaded",this,t),i(this)},h.onerror=function(){e("Unable to load image "+s)},h.src=s})}function P(t){return new Promise((i,e)=>{let s,h,n,r;return s=new Audio,h=function(t){return{wav:"",mp3:t.canPlayType("audio/mpeg;"),ogg:t.canPlayType('audio/ogg; codecs="vorbis"'),aac:t.canPlayType("audio/aac;")}}(s),(t=[].concat(t).reduce((t,i)=>t||(h[b(i)]?i:null),0))?(n=_(w,t),A[n]?i(A[n]):(s.addEventListener("canplay",function(){r=v(n,window.location.href),A[T(t)]=A[n]=A[r]=this,o("assetLoaded",this,t),i(this)}),s.onerror=function(){e("Unable to load audio "+n)},s.src=n,void s.load())):e("cannot play any of the audio formats provided"+t)})}function R(t){let i,e;return O(),i=_(S,t),E[i]?Promise.resolve(E[i]):fetch(i).then(t=>{if(!t.ok)throw t;return t.clone().json().catch(()=>t.text())}).then(s=>(e=v(i,window.location.href),"object"==typeof s&&g.set(s,e),E[T(t)]=E[i]=E[e]=s,o("assetLoaded",s,t),s))}function X(...t){return O(),Promise.all(t.map(t=>{let i=b([].concat(t)[0]);return i.match(u)?M(t):i.match(f)?P(t):R(t)}))}const k=()=>{};function W(){let t=a();c().clearRect(0,0,t.width,t.height)}function L({fps:t=60,clearCanvas:i=!0,update:e,render:s}={}){if(!e||!s)throw Error("You must provide update() and render() functions");let h,n,r,a,c,l=0,d=1e3/t,p=1/t,u=i?W:k;function f(){if(n=requestAnimationFrame(f),r=performance.now(),a=r-h,h=r,!(a>1e3)){for(o("tick"),l+=a;l>=d;)c.update(p),l-=d;u(),c.render()}}return c={update:e,render:s,isStopped:!0,start(){h=performance.now(),this.isStopped=!1,requestAnimationFrame(f)},stop(){this.isStopped=!0,cancelAnimationFrame(n)},_frame:f,set _last(t){h=t}}}let q={},I={},C={13:"enter",27:"esc",32:"space",37:"left",38:"up",39:"right",40:"down"};function F(t){let i=C[t.which];I[i]=!0,q[i]&&q[i](t)}function z(t){I[C[t.which]]=!1}function B(){I={}}function H(){let t;for(t=0;t<26;t++)C[65+t]=(10+t).toString(36);for(t=0;t<10;t++)C[48+t]=""+t;window.addEventListener("keydown",F),window.addEventListener("keyup",z),window.addEventListener("blur",B)}function Y(t,i){[].concat(t).map(t=>q[t]=i)}function D(t){[].concat(t).map(t=>q[t]=0)}function N(t){return!!I[t]}class G{constructor({create:t,maxSize:i=1024}={}){let e;if(!t||!(e=t())||!(e.update&&e.init&&e.isAlive))throw Error("Must provide create() function which returns an object with init(), update(), and isAlive() functions");this._c=t,this._i=0,this.objects=[t()],this.size=1,this.maxSize=i}get(t={}){if(this.objects.length==this._i){if(this.size===this.maxSize)return;for(let t=0;t<this.size&&this.objects.length<this.maxSize;t++)this.objects.unshift(this._c());this.size=this.objects.length}let i=this.objects.shift();return i.init(t),this.objects.push(i),this._i++,i}getAliveObjects(){return this.objects.slice(this.objects.length-this._i)}clear(){this._i=this.objects.length=0,this.size=1,this.objects.push(this._c())}update(t){let i,e=this.size-1,s=Math.max(this.objects.length-this._i,0);for(;e>=s;)(i=this.objects[e]).update(t),i.isAlive()?e--:(this.objects=this.objects.splice(e,1).concat(this.objects),this._i--,s++)}render(){let t=Math.max(this.objects.length-this._i,0);for(let i=this.size-1;i>=t;i--)this.objects[i].render()}}function U(t){return new G(t)}function $(t,i){let e=[],s=i.x+i.width/2,h=i.y+i.height/2,n=t.y<h&&t.y+t.height>=i.y,r=t.y+t.height>=h&&t.y<i.y+i.height;return t.x<s&&t.x+t.width>=i.x&&(n&&e.push(0),r&&e.push(2)),t.x+t.width>=s&&t.x<i.x+i.width&&(n&&e.push(1),r&&e.push(3)),e}U.prototype=G.prototype,U.class=G;class J{constructor({maxDepth:t=3,maxObjects:i=25,bounds:e}={}){this.maxDepth=t,this.maxObjects=i;let s=a();this.bounds=e||{x:0,y:0,width:s.width,height:s.height},this._b=!1,this._d=0,this._o=[],this._s=[],this._p=null}clear(){this._s.map(function(t){t.clear()}),this._b=!1,this._o.length=0}get(t){let i,e,s=new Set;for(;this._s.length&&this._b;){for(i=$(t,this.bounds),e=0;e<i.length;e++)this._s[i[e]].get(t).forEach(t=>s.add(t));return Array.from(s)}return this._o.filter(i=>i!==t)}add(){let t,i,e,s;for(i=0;i<arguments.length;i++)if(e=arguments[i],Array.isArray(e))this.add.apply(this,e);else if(this._b)this._a(e);else if(this._o.push(e),this._o.length>this.maxObjects&&this._d<this.maxDepth){for(this._sp(),t=0;s=this._o[t];t++)this._a(s);this._o.length=0}}_a(t,i,e){for(i=$(t,this.bounds),e=0;e<i.length;e++)this._s[i[e]].add(t)}_sp(t,i,e){if(this._b=!0,!this._s.length)for(t=this.bounds.width/2|0,i=this.bounds.height/2|0,e=0;e<4;e++)this._s[e]=V({bounds:{x:this.bounds.x+(e%2==1?t:0),y:this.bounds.y+(e>=2?i:0),width:t,height:i},maxDepth:this.maxDepth,maxObjects:this.maxObjects}),this._s[e]._d=this._d+1,this._s[e]._p=this}}function V(t){return new J(t)}V.prototype=J.prototype,V.class=J;class K{constructor(t=0,i=0){this._x=t,this._y=i}add(t,i=1){return Q(this.x+(t.x||0)*i,this.y+(t.y||0)*i,this)}clamp(t,i,e,s){this._c=!0,this._a=t,this._b=i,this._d=e,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?Math.min(Math.max(this._a,t),this._d):t}set y(t){this._y=this._c?Math.min(Math.max(this._b,t),this._e):t}}function Q(t,i,e={}){let s=new K(t,i);return e._c&&(s.clamp(e._a,e._b,e._d,e._e),s.x=t,s.y=i),s}Q.prototype=K.prototype,Q.class=K;class Z{constructor(t){this.init(t)}init(t={}){let{x:i,y:e,dx:s,dy:h,ddx:n,ddy:r,width:o,height:a,image:l}=t;this.position=Q(i,e),this.velocity=Q(s,h),this.acceleration=Q(n,r),this._fx=this._fy=1,this.width=this.height=this.rotation=0,this.ttl=1/0,this.anchor={x:0,y:0},this.context=c();for(let i in t)this[i]=t[i];l&&(this.width=void 0!==o?o:l.width,this.height=void 0!==a?a:l.height),this.sx=0,this.sy=0}get x(){return this.position.x}get y(){return this.position.y}get dx(){return this.velocity.x}get dy(){return this.velocity.y}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}get animations(){return this._a}get viewX(){return this.x-this.sx}get viewY(){return this.y-this.sy}get width(){return this._w}get height(){return this._h}set x(t){this.position.x=t}set y(t){this.position.y=t}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}set animations(t){let i,e;for(i in this._a={},t)this._a[i]=t[i].clone(),e=e||this._a[i];this.currentAnimation=e,this.width=this.width||e.width,this.height=this.height||e.height}set viewX(t){}set viewY(t){}set width(t){let i=t<0?-1:1;this._fx=i,this._w=t*i}set height(t){let i=t<0?-1:1;this._fy=i,this._h=t*i}isAlive(){return this.ttl>0}collidesWith(t){if(this.rotation||t.rotation)return null;let i=this.x-this.width*this.anchor.x,e=this.y-this.height*this.anchor.y,s=t.x,h=t.y;return t.anchor&&(s-=t.width*t.anchor.x,h-=t.height*t.anchor.y),i<s+t.width&&i+this.width>s&&e<h+t.height&&e+this.height>h}update(t){this.advance(t)}render(){this.draw()}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){this.velocity=this.velocity.add(this.acceleration,t),this.position=this.position.add(this.velocity,t),this.ttl--,this.currentAnimation&&this.currentAnimation.update(t)}draw(){let t=-this.width*this.anchor.x,i=-this.height*this.anchor.y;if(this.context.save(),this.context.translate(this.viewX,this.viewY),this.rotation&&this.context.rotate(this.rotation),-1==this._fx||-1==this._fy){let e=this.width/2+t,s=this.height/2+i;this.context.translate(e,s),this.context.scale(this._fx,this._fy),this.context.translate(-e,-s)}this.image?this.context.drawImage(this.image,0,0,this.image.width,this.image.height,t,i,this.width,this.height):this.currentAnimation?this.currentAnimation.render({x:t,y:i,width:this.width,height:this.height,context:this.context}):(this.context.fillStyle=this.color,this.context.fillRect(t,i,this.width,this.height)),this.context.restore()}}function tt(t){return new Z(t)}function it(t){if(+t===t)return t;let i=[],e=t.split(".."),s=+e[0],h=+e[1],n=s;if(s<h)for(;n<=h;n++)i.push(n);else for(;n>=h;n--)i.push(n);return i}tt.prototype=Z.prototype,tt.class=Z;class et{constructor({image:t,frameWidth:i,frameHeight:e,frameMargin:s,animations:h}={}){if(!t)throw Error("You must provide an Image for the SpriteSheet");this.animations={},this.image=t,this.frame={width:i,height:e,margin:s},this._f=t.width/i|0,this.createAnimations(h)}createAnimations(t){let i,e;for(e in t){let{frames:s,frameRate:h,loop:n}=t[e];if(i=[],void 0===s)throw Error("Animation "+e+" must provide a frames property");[].concat(s).map(t=>{i=i.concat(it(t))}),this.animations[e]=p({spriteSheet:this,frames:i,frameRate:h,loop:n})}}}function st(t){return new et(t)}function ht(t,i){void 0===i?localStorage.removeItem(t):localStorage.setItem(t,JSON.stringify(i))}function nt(t){let i=localStorage.getItem(t);try{i=JSON.parse(i)}catch(t){}return i}st.prototype=et.prototype,st.class=et;const rt=X,ot=l,at=L,ct=tt,lt=st,dt=H,pt=N,ut=(t,i)=>ht("backtobathroom_"+t,i),ft=t=>nt("backtobathroom_"+t),mt=Y,xt=D,gt=a,yt=c,wt=r,St=o;var vt=class{constructor(){this.scenes=[],this.currentScene=null,wt("changeScene",(t,i={})=>{this.change(t,i)})}add(t,i,e=!1){i.sceneController=this,this.scenes.push({name:t,scene:i,autoStarted:e}),e&&(this.currentScene=i,this.currentScene.start())}update(t){this.currentScene&&this.currentScene.update(t)}render(){this.currentScene&&this.currentScene.render()}remove(t){const i=this.scenes.findIndex(i=>i.name===t);i>-1&&this.scenes.splice(i,1)}change(t,i={}){xt(["enter"]);const e=this.scenes.find(i=>i.name===t).scene;this.currentScene=e;const s=gt();yt().clearRect(0,0,s.width,s.height),this.currentScene.start(i)}};function _t(t={}){const i=yt();this.text=t.text||"",this.font=t.font||"12px Arial",this.textAlign=t.textAlign||"right",this.position=t.position||{x:0,y:0},this.fillStyle=t.fillStyle||"black",this.draw=function(){i.fillStyle=this.fillStyle,i.font=this.font,i.textAlign=this.textAlign,i.fillText(this.text,this.position.x,this.position.y)}}function bt(t,i){const e=gt(),s=new ct({x:e.width/2-32,y:e.height/2-24,width:64,height:64}),h=lt({image:t,frameWidth:32,frameHeight:32,animations:{shitting:{frames:2,loop:!1},idleShit:{frames:0,loop:!1},discharge:{frames:[0,1],frameRate:1,loop:!1}}});return s.animations=h.animations,s.playAnimation(i),s}var Tt=class{constructor(t){this.theremin=null,this.initTheremin=!0,this.toiletImage=new bt(t[1],"idleShit"),this.enterText=new _t({text:"[PRESS ENTER]",font:"12px Arial",textAlign:"center",position:{x:canvas.width/2,y:canvas.height/2-32},fillStyle:"black"})}start(){mt("enter",t=>{this.initTheremin&&(this.theremin=new function(){const t=gt();let i=new AudioContext,e=i.createGain(),s=null;e.connect(i.destination);let h=function(i){return i/t.width*2e3+20},n=function(i){return 1-i/t.height*1+0};this.createOscillator=function(t,r){let o=t,a=r;(s=i.createOscillator()).frequency.setTargetAtTime(h(o),i.currentTime,.001),e.gain.setTargetAtTime(n(a),i.currentTime,.001),s.connect(e),s.start(i.currentTime)},this.stopOscillator=function(){s&&(s.stop(i.currentTime),s.disconnect())},this.changeFrequency=function(t,r){let o=t,a=r;s&&(s.frequency.setTargetAtTime(h(o),i.currentTime,.001),e.gain.setTargetAtTime(n(a),i.currentTime,.001))}},this.toiletImage.playAnimation("discharge"),setTimeout(()=>St("changeScene","introduction"),3e3),this.initTheremin=!1)}),wt("createThereminOscillator",(t,i)=>{this.theremin.createOscillator(t,i)}),wt("changeThereminFrequency",(t,i)=>{this.theremin.changeFrequency(t,i)}),wt("stopThereminOscillator",()=>{this.theremin.stopOscillator()})}update(){this.toiletImage.update()}render(){this.toiletImage.render(),this.enterText.draw()}};function jt(t={}){const i=gt(),e=yt();this.color1=t.color1||["0","brown"],this.color2=t.color2||["0.5","yellow"],this.color3=t.color3||["1.0","red"],this.text=t.text||"",this.font=t.font||"11px Georgia",this.textAlign=t.textAlign||"left",this.position=t.position||{x:0,y:0},this.draw=function(){const t=e.createLinearGradient(0,0,i.width,0);t.addColorStop(this.color1[0],this.color1[1]),t.addColorStop(this.color2[0],this.color2[1]),t.addColorStop(this.color3[0],this.color3[1]),e.fillStyle=t,e.font=this.font,e.textAlign=this.textAlign,e.fillText(this.text,this.position.x,this.position.y)}}function At(){const t=gt();return new jt({color1:["0","SaddleBrown"],color2:["0.5","Black"],color3:["1.0","Chocolate"],text:"Back to Bathroom",font:"bold 26px system-ui",textAlign:"center",position:{x:t.width/2,y:t.height/2-40}})}var Et=class{constructor(t){this.imgShitting=bt(t[1],"shitting"),this.titleText=new At,this.introductionText=new function(){const t=gt(),i=[],e=["You are in bathroom and see that all ","you do over there go back for you. ","But you are hungry, if not eat then you die. ","Yet you can eat bread that falls, ","but the more you eat the more shit ","comes back to you. [PRESS ENTER]"];for(let s=0;s<e.length;s++)i.push(new _t({text:e[s],font:"12px Arial",textAlign:"left",position:{x:t.width/6,y:t.height/2-16+12*s},fillStyle:"black"}));this.draw=function(){i.forEach(t=>t.draw())}},this.copyrightText=new function(){const t=gt();return new _t({text:"©2019 Perdugames",font:"11px Verdana",textAlign:"right",position:{x:t.width-8,y:t.height-8},fillStyle:"#eaffef"})},this.renderImg=!0}start(){setTimeout(()=>this.renderImg=!1,3e3),mt("enter",function(t){St("changeScene","game")})}update(){}render(){this.titleText.draw(),this.renderImg?this.imgShitting.render():this.introductionText.draw(),this.copyrightText.draw()}};var Ot=class{constructor(t){this.show=!0,this.inactive=!1,this.sprite=new ct(t)}render(){this.show&&this.sprite.draw()}};var Mt=class extends Ot{constructor(){super({x:0,y:126,width:300,height:32,color:"#7b6045",shape2d:{x:0,y:126,width:300,height:32}})}};var Pt=class extends Ot{constructor(t){super({x:200,y:72,width:64,height:64,animations:lt({image:t,frameWidth:32,frameHeight:32,animations:{idleLeft:{frames:0,loop:!1},walkLeft:{frames:"0..3",frameRate:4},pushingRight:{frames:4,loop:!1},idleRight:{frames:5,loop:!1},walkRight:{frames:"5..8",frameRate:4},pushingLeft:{frames:9,loop:!1}}}).animations,shape2d:{x:0,y:0,width:32,height:64}}),this.sprite.playAnimation("idleRight"),this.direction="left",this.show=!0,this.inactive=!1,this.speed={x:2,y:0},this.life=100,this.toShit=!1,setTimeout(()=>{this.toShit=!0},5e3),this.canvas=gt(),this.joints=new function(t){this.rootObj=t,this.joints=[],this.isEmpty=(()=>this.joints.length<=0),this.add=((t,i)=>{this.joints.push({name:t,obj:i})}),this.remove=(t=>{const i=this.joints.findIndex(i=>i.name=t);i>-1&&this.joints.splice(i,1)}),this.walk=(t=>{for(let i=0;i<this.joints.length;i++)t(this.joints[i])})}(this),this.limit={minX:1,maxX:this.canvas.width-40}}addLife(t){this.life+t<=100?this.life+=t:this.life=100}removeLife(t){this.life-t>=0?this.life-=t:this.life=0}update(){if(this.inactive)return!1;this.sprite.update(),!pt("left")&&!pt("a")||this.joints.isEmpty()||"right"!==this.direction?!pt("right")&&!pt("a")||this.joints.isEmpty()||"left"!==this.direction?pt("left")||pt("a")&&this.joints.isEmpty()?(this.speed.x=2,this.sprite.x-=1*this.speed.x,this.sprite.playAnimation("walkLeft"),this.direction="left",St("changeThereminFrequency",40*this.speed.x,10*this.speed.x)):pt("right")||pt("d")&&this.joints.isEmpty()?(this.speed.x=2,this.sprite.x+=1*this.speed.x,this.sprite.playAnimation("walkRight"),this.direction="right",St("changeThereminFrequency",60*this.speed.x,10*this.speed.x)):(this.speed.x=0,St("changeThereminFrequency",100,100)):(this.speed.x=2,this.sprite.x+=1*this.speed.x,this.sprite.playAnimation("pushingLeft"),St("changeThereminFrequency",20*this.speed.x,10*this.speed.x)):(this.speed.x=2,this.sprite.x-=1*this.speed.x,this.sprite.playAnimation("pushingRight"),St("changeThereminFrequency",10*this.speed.x,10*this.speed.x)),0===this.speed.x&&("left"===this.direction?this.sprite.playAnimation("idleLeft"):"right"===this.direction&&this.sprite.playAnimation("idleRight")),this.sprite.x>=this.limit.maxX?(this.sprite.x=this.limit.maxX,this.speed.x=0,St("changeThereminFrequency",130,35)):this.sprite.x<=this.limit.minX&&(this.sprite.x=this.limit.minX,this.speed.x=0,St("changeThereminFrequency",105,63))}};var Rt=class extends Ot{constructor(t){super({x:100,y:80,width:64,height:64,animations:lt({image:t,frameWidth:32,frameHeight:32,animations:{idle:{frames:1,loop:!1},idleShit:{frames:0,loop:!1},discharge:{frames:[0,1],frameRate:1,loop:!1},shitting:{frames:2,loop:!1}}}).animations}),this.sprite.playAnimation("idle"),this.withShit=!1,this.canvas=gt(),this.speed={x:1,y:0},this.limit={minX:-16,maxX:this.canvas.width-32}}update(){this.sprite.update(),this.sprite.x>=this.limit.maxX?(this.sprite.x=this.limit.maxX,this.speed.x=0):this.sprite.x<=this.limit.minX&&(this.sprite.x=this.limit.minX,this.speed.x=0)}};var Xt=class extends Ot{constructor(t){super({x:Math.floor(210*Math.random())+12,y:-128,width:32,height:32,image:t,shape2d:{x:0,y:0,width:4,height:4}}),this.active=!0,this.speed={x:0,y:0},this.canvas=gt(),this.limit={minX:0,maxX:this.canvas.width}}reset(){this.active=!1,this.sprite.y=-48,this.sprite.x=Math.floor(210*Math.random())+12,this.speed.x=(Math.floor(3*Math.random())+1)*(Math.random()>=.5?-1:1),setTimeout(()=>this.active=!0,23e3)}update(){this.sprite.update(),this.active&&(this.sprite.y+=.1*(Math.floor(3*Math.random())+1),this.sprite.x+=.05*this.speed.x),this.sprite.x>=this.limit.maxX?(this.sprite.x=this.limit.maxX,this.speed.x=0):this.sprite.x<=this.limit.minX&&(this.sprite.x=this.limit.minX,this.speed.x=0)}};var kt=class extends Ot{constructor(t){super({x:0,y:0,width:64,height:64,shape2d:{x:0,y:0,width:32,height:32},image:t}),this.speed={x:0,y:0},this.canvas=gt(),this.limit={minX:-12,maxX:this.canvas.width-68}}update(){this.sprite.update(),this.sprite.x>=this.limit.maxX?(this.sprite.x=this.limit.maxX,this.speed.x=0):this.sprite.x<=this.limit.minX&&(this.sprite.x=this.limit.minX,this.speed.x=0)}};function Wt(t){let i=this.x-t.x,e=this.y-t.y;return Math.sqrt(i*i+e*e)<this.radius+t.radius}let Lt=!1;function qt(t){return this.x<t.x+t.width&&this.x+this.shape2d.width>t.x&&this.y<t.y+t.height&&this.y+this.shape2d.height>t.y}var It=class{constructor(t,i){this.assets=t,this.loop=i,this.canvas=gt(),this.count=0,this.delay=30,this.gameState="new",this.floor=null,this.player=null,this.toilet=null,this.bread=null,this.shitPool=null,this.titleText=null,this.startText=null,this.commandsText=null,this.xShitText=null,this.scoreText=null,this.lifeBar=null,this.gameOverText=null,this.HighScoreText=new function(){const t=gt();return new jt({text:"High Score: 0",font:"12px Arial",textAlign:"center",position:{x:t.width/2,y:t.height/2+8}})},ut("highScore",0)}start(){this.gameState="new",this.floor=new Mt,this.player=new Pt(this.assets[0]),this.toilet=new Rt(this.assets[1]),this.bread=new Xt(this.assets[3]),this.shitPool=new function(t,i){this.objectsPool=[],this.maxSpeed=3,this.minSpeed=1;for(let e=0;e<i;e++){const i=new kt(t);i.active=!1,i.show=!0,i.stopped=!1,this.objectsPool.push(i)}this.new=function(){const t=this.objectsPool.find(t=>!1===t.active);t.sprite.y=-64,t.sprite.x=Math.floor(210*Math.random())+12,t.active=!0,t.speed.x=(Math.floor(3*Math.random())+1)*(Math.random()>=.5?-1:1),ut("xShit",ft("xShit")+1)},this.reset=function(t){t.show=!1,t.sprite.y=-64,t.sprite.x=Math.floor(210*Math.random())+12,t.speed.x=(Math.floor(3*Math.random())+1)*(Math.random()>=.5?-1:1),setTimeout(()=>t.show=!0,500+Math.round(22e3/ft("xShit")))},this.update=function(){this.notStoppedObjects().forEach(t=>{t.update(),t.sprite.y+=.1*(Math.floor(Math.random()*this.maxSpeed+Math.round(ft("xShit")/3))+this.minSpeed),t.sprite.x+=.05*t.speed.x})},this.render=function(){this.activeObjects().forEach(t=>t.sprite.render())},this.stoppedObjects=function(){return this.objectsPool.filter(t=>!0===t.active&&!0===t.stopped&&!0===t.show)},this.notStoppedObjects=function(){return this.objectsPool.filter(t=>!0===t.active&&!1===t.stopped&&!0===t.show)},this.activeObjects=function(){return this.objectsPool.filter(t=>!0===t.active&&!0===t.show)}}(this.assets[2],99),ut("shitScore",0),ut("xShit",0),this.titleText=new At,this.startText=new function(){const t=gt();return new _t({text:"Press ENTER to Start",font:"12px Arial",textAlign:"center",position:{x:t.width/2,y:t.height/2-8},fillStyle:"green"})},this.commandsText=new function(){const t=gt();return new _t({text:"AWSD=move, SPACE=pull toilet, E=discharge, ENTER=pause",font:"9px Arial",textAlign:"center",position:{x:t.width/2,y:t.height/2+32},fillStyle:"blue"})},this.xShitText=new function(){return new _t({position:{x:292,y:12}})},this.scoreText=new function(){return new jt({position:{x:10,y:30}})},this.gameOverText=new function(){const t=gt();return new _t({text:"",font:"16px Arial",textAlign:"center",position:{x:t.width/2,y:t.height/2-16},fillStyle:"red"})},this.lifeBar=new function(t={}){const i=yt();this.width=t.width||100,this.value=t.value||100,this.barColor=t.barColor||"#623c3c",this.fillColor=t.fillColor||"#b52828",this.draw=function(){i.fillStyle="#623c3c",i.fillRect(8,8,this.width,8),i.fillStyle="#b52828",i.fillRect(8,8,this.value,8)}},this.player.inactive=!0,this.shitPool.new();let t=!0;mt("enter",i=>{"new"===this.gameState&&t?(setTimeout(()=>{St("createThereminOscillator",100,100),this.gameState="running",this.startText.text="",this.player.inactive=!1,this.loop.start()},1500),t=!1):"paused"===this.gameState&&this.loop.isStopped?(St("createThereminOscillator",100,100),this.gameState="running",this.startText.text="",this.player.inactive=!1,this.loop.start()):"running"===this.gameState&&(St("stopThereminOscillator"),this.gameState="paused",this.startText.text="PAUSED: Press ENTER to Continue",this.player.inactive=!0,this.loop.stop())})}update(){"running"===this.gameState&&(ft("xShit")<=0?(this.xShitText.fillStyle="red",this.delay<=0&&(this.xShitText.text?this.xShitText.text="":this.xShitText.text=ft("xShit")+" x")):(this.xShitText.fillStyle="black",this.xShitText.text=ft("xShit")+" x"),this.count>=6&&(ft("xShit")<=0?this.player.removeLife(29):this.player.removeLife(1+Math.round(this.shitPool.stoppedObjects().length/2)),this.count=0),this.delay<=0&&(this.count++,this.delay=30),this.delay--,this.toilet.update(),this.player.update(),this.shitPool.update(),this.bread.update(),function(t,i,e){t.sprite.collidesWith=Wt,t.sprite.radius=9,i.sprite.collidesWith=Wt,i.sprite.radius=9,0===i.speed.x&&(i.sprite.x=i.limit.minX+1,i.speed.x=1),pt("left")||pt("a")?t.joints.walk(i=>i.obj.sprite.x-=1*t.speed.x):(pt("right")||pt("d"))&&t.joints.walk(i=>i.obj.sprite.x+=1*t.speed.x),t.sprite.collidesWith(i.sprite)&&(pt("space")&&!Lt&&(t.joints.isEmpty()&&t.joints.add("toilet",i),setTimeout(()=>{t.joints.remove("toilet"),Lt=!1},1e3),Lt=!0),pt("left")||pt("a")&&t.joints.isEmpty()?i.sprite.x-=1*t.speed.x:(pt("right")||pt("d")&&t.joints.isEmpty())&&(i.sprite.x+=1*t.speed.x),t.toShit&&!i.withShit?(i.sprite.playAnimation("shitting"),t.show=!1,t.speed.x=0,t.toShit=!1,t.inactive=!0,setTimeout(()=>{i.sprite.playAnimation("idleShit"),t.show=!0,t.speed.x=2,t.inactive=!1,i.withShit=!0},1500)):pt("e")&&i.withShit&&(i.sprite.playAnimation("discharge"),setTimeout(()=>e.new(),2e3),i.withShit=!1))}(this.player,this.toilet,this.shitPool),function(t,i){i.sprite.collidesWith=Wt,i.sprite.radius=6,t.notStoppedObjects().forEach(e=>{e.sprite.collidesWith=Wt,e.sprite.radius=4,e.sprite.collidesWith(i.sprite)&&(ut("shitScore",ft("shitScore")+1*ft("xShit")),t.reset(e),i.sprite.playAnimation("idleShit"),i.withShit=!0)})}(this.shitPool,this.toilet),function(t,i){i.sprite.collidesWith=qt,t.notStoppedObjects().forEach(t=>{t.sprite.collidesWith=qt,t.sprite.collidesWith(i.sprite)&&(ut("xShit",ft("xShit")-1),t.stopped=!0)})}(this.shitPool,this.floor),function(t,i){t.sprite.collidesWith=qt,i.sprite.collidesWith=qt,t.sprite.collidesWith(i.sprite)&&(i.addLife(10),t.reset(),setTimeout(()=>i.toShit=!0,7e3))}(this.bread,this.player),function(t,i){t.sprite.collidesWith=qt,i.sprite.collidesWith=qt,t.sprite.collidesWith(i.sprite)&&t.reset()}(this.bread,this.floor),this.lifeBar.value=this.player.life,this.scoreText.text="Shit Score: "+ft("shitScore"),this.HighScoreText.text="High Score: "+ft("highScore"),this.lifeBar.value<=0&&(this.player.inactive=!0,St("changeThereminFrequency",80,110),this.gameOverText.text="GAME OVER",ut("highScore",ft("shitScore")),setTimeout(()=>{St("stopThereminOscillator"),this.start()},3e3)))}render(){this.floor.render(),this.toilet.render(),"running"===this.gameState?(this.bread.render(),this.player.render(),this.lifeBar.draw(),this.scoreText.draw(),this.xShitText.draw(),this.shitPool.render(),this.gameOverText.draw()):"new"!==this.gameState&&"paused"!==this.gameState||(this.titleText.draw(),this.startText.draw(),this.commandsText.draw(),this.HighScoreText.draw())}},Ct=e(0),Ft=e.n(Ct),zt=e(1),Bt=e.n(zt),Ht=e(2),Yt=e.n(Ht),Dt=e(3),Nt=e.n(Dt);const{canvas:Gt,context:Ut}=ot();let $t;dt();const Jt=new at({update:function(t){$t.update(t)},render:function(){$t.render()}});rt(Ft.a,Bt.a,Yt.a,Nt.a).then(function(t){($t=new vt).add("activeAudio",new Tt(t),!0),$t.add("introduction",new Et(t)),$t.add("game",new It(t,Jt)),Jt.start()}).catch(function(t){console.log(t)});e(4)}]);</script></body></html>