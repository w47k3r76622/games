<!DOCTYPE html><title>js13k2020</title><script>let t=Math.PI,e=t/2,o=2*t,n=Math.SQRT1_2,c=t/4,r=Math.atan2,i=Math.floor,s=Math.ceil,a=Math.sin,l=Math.cos,u=Math.exp,f=Math.sqrt,v=(Math,(t,e)=>e<t?e:t),y=(t,e)=>e>t?e:t,R=(t,e,o)=>y(e,v(o,t)),d=t=>t<0?-t:t,p=(t,e,o)=>(1-o)*t+o*e,m=(t,e,o)=>((o=o||t)[0]=t[0]-e[0],o[1]=t[1]-e[1],o),w=(t,e,o)=>((o=o||t)[0]=t[0]+e[0],o[1]=t[1]+e[1],o),_=(t,e,o)=>((o=o||t)[0]=t[0]*e,o[1]=t[1]*e,o),x=(t,e,o)=>((o=o||t)[0]=t[0]/e,o[1]=t[1]/e,o),h=t=>{let e=t[0];return t[0]=-t[1],t[1]=e,t},b=t=>f(t[0]*t[0]+t[1]*t[1]),B=(t,e)=>{if(e=e||t,0==t[0]&&0==t[1])e[0]=e[1]=0;else{let o=b(t);e[0]=t[0]/o,e[1]=t[1]/o}return e},C=(t,e)=>t[0]*e[0]+t[1]*e[1],M=(t,e)=>((e=e||t)[0]=i(t[0]),e[1]=i(t[1]),e),g=(t,e,o)=>((t,e,o)=>{o=o||t;let[n,c]=t;return o[0]=n*e[0]+c*e[1]+e[2],o[1]=n*e[3]+c*e[4]+e[5],o})(t,[l(e),-a(e),0,a(e),l(e),0],o),$=t=>new Promise((e,o)=>{setTimeout(()=>e(t()),1)}),P=(t,e)=>{for(let o=0;o<t;o++)e(o)},D=(...t)=>new Float32Array(...t),F=t=>t.replace(/(\d)(?![\d.,-])/g,"$1,").replace(/([^\d.,-])/g,"$1,").replace(/,$/,"").split(","),T=[600,337.5],z=(t,e,o)=>[t,e,o],A=(t,e,o)=>((o=o||t)[0]=t[0]-e[0],o[1]=t[1]-e[1],o[2]=t[2]-e[2],o),k=(t,e,o)=>((o=o||t)[0]=t[0]+e[0],o[1]=t[1]+e[1],o[2]=t[2]+e[2],o),U=(t,e)=>{t[0]=e[0],t[1]=e[1],t[2]=e[2]},O=(t,e,o)=>((o=o||t)[0]=t[0]*e,o[1]=t[1]*e,o[2]=t[2]*e,o),E=t=>f(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),I=(t,e)=>{if(e=e||t,0==t[0]&&0==t[1]&&0==t[2])e[0]=e[1]=e[2]=0;else{let o=E(t);e[0]=t[0]/o,e[1]=t[1]/o,e[2]=t[2]/o}return e},L=(t,e)=>t[0]*e[0]+t[1]*e[1]+t[2]*e[2],S=(t,e,o)=>((t,e,o)=>{o=o||[...e];for(let n=0;n<4;n++){o[n]=0;for(let c=0;c<4;c++)o[n]+=t[4*c+n]*e[c]}return o})(t,[...e,1],o),V=(t,e,o)=>{o=o||[...t];for(let n=0;n<4;n++)for(let c=0;c<4;c++){let r=4*c+n;o[r]=0;for(let i=0;i<4;i++)o[r]+=t[4*i+n]*e[4*c+i]}return o},K=(t,e,o)=>((t,e,o,n)=>{let c=1-e;return n[3]=n[7]=n[11]=n[12]=n[13]=n[14]=0,n[15]=1,n[0]=e+t[0]*t[0]*c,n[1]=t[0]*t[1]*c+t[2]*o,n[2]=t[0]*t[2]*c-t[1]*o,n[4]=t[0]*t[1]*c-t[2]*o,n[5]=e+t[1]*t[1]*c,n[6]=t[1]*t[2]*c+t[0]*o,n[8]=t[0]*t[2]*c+t[1]*o,n[9]=t[1]*t[2]*c-t[0]*o,n[10]=e+t[2]*t[2]*c,n})(t,l(e),a(e),o),H=(t,e,o,n)=>{let c=m(t,o,[]),r=b(c)-e-n;if(r<=0)return _(B(c),-r)},N=(t,e,o)=>t.map(t=>[e[0]+o[0]*t[0],e[1]+o[1]*t[1],e[2]]),W=(t,e,o)=>{let n=m(t.v,t._,[]),c=b(n),r=x(n,c,[]),i=B(e,[]);if(C(r,i)<=0)return;c>.05&&(v(1,(c-.05)/.95),Math.random());let s=_((u=[],m(_(l=i,2*C(a=r,l),u),a)),b(n)*(o||.45));var a,l,u;w(t._,e,t.v),w(t.v,s,t._)},Y=(t,e,o)=>{let n=t.length,c=x(t.reduce((t,e)=>w(t,e),[0,0]),n),r=[];for(let e=0;e<n;e++)r.push(B(h(m(t[(e+1)%n],t[e],[]))));r.push(B(m(e,c,[])));let i=[0,9999];for(let c=0;c<n+1;c++){let n=C(e,r[c]),s=t.reduce((t,e)=>{let o=C(e,r[c]);return t[0]=null==t[0]?o:v(t[0],o),t[1]=null==t[1]?o:y(t[1],o),t},[]),a=s[1]-n+o,l=s[0]-n-o;if(a<0||l>0)return;let u=d(a)<d(l)?a:l;d(u)<d(i[1])&&(i[0]=c,i[1]=u)}return _(r[i[0]],i[1])},X=(t,e,o,n)=>(t._=z(e,o,n),t.v=z(e,o,n),t.a=z(0,0,0),t),q=[,[0,1],[-1,0],[0,-1],[1,0]],Q=(t,e)=>q[t],Z=(t,e)=>t*u(1-t*e),G=[[-1,2,-1,0],[3,-5,0,2],[-3,4,1,0],[1,-1,0,0]],J=(t,e)=>{let o;let n=t.length;for(o=0;o<n-1&&t[o][0]<e;o++);o=o||1;let c=(e-t[o-1][0])/(t[o][0]-t[o-1][0]),r=[0,0,0];for(let e=0;e<4;e++){let i=R(o+e-2,0,n-1),s=G[e],a=.5*(((s[0]*c+s[1])*c+s[2])*c+s[3]);for(let e=0;e<3;e++)r[e]+=a*t[i][e+1]}return r},j=(t,e,o)=>v(1,J([[0,0,0,0],[t,t,e,0],[1,1,1,0]],o)[1]),tt=(t,e,o,n,c,r,i)=>{let s=t.createTexture();return t.bindTexture(3553,s),t.texImage2D(3553,0,n,e,o,0,c,r,i),t.texParameteri(3553,10241,9728),t.texParameteri(3553,10240,9729),t.texParameteri(3553,10242,33071),t.texParameteri(3553,10243,33071),s},et=(t,e,o,n,c,r,i=!1)=>{let s=t.createFramebuffer();t.bindFramebuffer(36160,s);let a=tt(t,e,o,n,c,r);if(t.framebufferTexture2D(36160,36064,3553,a,0),i){let n=tt(t,e,o,33189,6402,5125);t.framebufferTexture2D(36160,36096,3553,n,0)}return{h:s,M:a,w:e,g:o}};let ot;let nt=(t,e,o)=>{let n=o?"innerHTML":"innerText";t[n]!=e&&(t[n]=e)},ct=(t,e,o,n)=>{let c=document.createElement("div");return c.style.position="absolute",c.style.font=`700 ${o}em sans-serif`,n?(c.style.transform="scaleY(0.9) translate(-50%,-50%)",c.style.textAlign="center"):c.style.transform="scaleY(0.9)",c.style.top=e+"%",c.style.left=t+"%",c.style.color="#FFF",c.style.textShadow="#000 0 2px 5px",ot.appendChild(c),c},rt=(t,e,o)=>$(()=>{o="#version 300 es\nprecision highp float;\n"+o;let n=t.createShader(e);return t.shaderSource(n,o),t.compileShader(n),n}),it=(t,e,o)=>{t.bindFramebuffer(36160,o),t.viewport(0,0,e[0],e[1])},st=async(t,e,o)=>((t,e)=>$(()=>{let o=t.createProgram();return e.forEach(e=>t.attachShader(o,e)),t.linkProgram(o),t.validateProgram(o),e.forEach(e=>t.deleteShader(e)),o}))(t,[await rt(t,35633,e),await rt(t,35632,o)]),at=[[0,-.22],[1.8,-.11],[1.8,.11],[0,.22]],lt=[[[0,0],[-4,-4],[-4,2],[0,2]]],ut={12:(t,e,o,n)=>{t.$?(t.D+=9e-4*o,t.t=t.D%.95,t._[2]=t.F+v(2.5,.5*t.D)):H(t._,1,n.A._,.45)&&(t.$=1,k(t._,[0,0,15],n.k),n.I=7,n.L=0)},11:(t,e,o,n)=>{let{A:c}=n,{_:r}=t,i=N([[-1,-2],[-1,2],[1,2],[1,-2]],r,[1,1]);Y(i,c._,.45)&&(t.state<2&&(c._[2]=r[2]+1),0==t.state&&c._[0]>r[0]&&(t.state=1,((t,e)=>{let o=(t=>m(t._,t.v,[]))(t);m(t._,_(B(o),0),t.v)})(c),c.V=1,n.I=9,n.L=0)),1==t.state&&(t.D+=5e-4*o,t.t=y(0,v(1,J([[0,0,0,0],[.2,.5,1,0],[.4,.4,.7,0],[.6,.6,.94,0],[.9,.9,.88,0],[1,1,1,0]],t.D%1)[1])-.25),t.D>=1&&(t.t=.7,t.state=2,c.a[0]=.8*o,U(n.K,n.H.p),c.N=1))},10:(t,e,n,c)=>{let{W:r,_:i}=t;r.forEach((e,s)=>{if(e){let u=s/(r.length-1);if(t.Y>=0)k(i,O([t.X,t.Y,t.Z],u),e._);else if(t.X){let n=t.X*a(o*u),c=t.X*l(o*u);k(i,[c,n,0],e._)}else U(e._,i);e.G>=0?(e.G+=.0018*n,e._[2]+=3*j(.1,.7,e.G),e.G>=1&&(r[s]=0)):H(c.A._,.45,e._,.3)&&(c.J+=100,e.G=0)}})},9:(t,n,c,r)=>{let{A:i}=r,{j:s}=t;s&&s.forEach((n,c)=>{if(n){let r=o*(t.D+c/8);n[0]=-(r>0?l(r-e):r),n[1]=r>0?a(r+e):1,w(_(n,1.75),t._);let u=H(i._,.45,n,.25);u&&(W(i,u,.65),s[c]=0)}}),t.tt&&(s&&!s.every(t=>!t)||(t.j=new Array(8).fill(0).map(t=>[0,0]),t.D=-1.5)),t.D+=.001*c/4},8:(t,e,o,n)=>{let{A:c}=n,{state:r,_:i,D:s}=t,a=H(c._,.45,i,.4);[()=>{t.angle=1,t.D=0},()=>{t.angle<=0?t.state=2:t.angle=1-j(.7,.35,s+.5)},()=>{t.angle=0,s>=3&&(t.D=0,t.state=3)},()=>{t.angle>=1?t.state=0:t.angle=s}][r](),t.D+=.001*o/.7,c._[1]-c.v[1]<0&&a&&(n.J+=400,0==t.state&&W(c,a,.65),t.state=1)},7:(t,e,o,n)=>{let{et:c,state:r}=t;t.D+=25e-5*o,0==c[0].ot&&0==c[1].ot&&(t.nt=1),0==r?c[0].state=c[1].state=c[2].state=0:t.D>=1&&(t.D=0,3==r?c[0].state=c[1].state=4:(c[0].state=1+2*t.ct,t.ct=1-t.ct,c[1].state=1+2*t.ct),t.rt=(t.rt+1)%5,2==r&&(0==t.rt&&(c[2].state=1),2==t.rt&&(c[2].state=3)))},6:(t,e,o,n)=>{let{A:c}=n,{state:r,_:i}=t,s=H(c._,.45,i,1);[()=>{t.g=0,t.D=0},()=>{t.g>=.5?t.state=2:t.g=.5*j(.75,.9,t.D)},()=>{t.g=.5,t.D=0},()=>{t.g<=0?t.state=0:t.g=.5*(1-j(.75,.9,t.D))},()=>{t.g=t.ot/10,t.j&&(t.j.tt=t.g)}][r](),t.D+=.001*o/.25,s&&r>=1&&t.ot>0&&(W(c,s,.65),t.D>.5&&4==r&&(t.D=0,t.ot--))},5:(t,e,o,n)=>{let{A:c}=n,{_:r,it:i}=t,s=N([[-2,-.1],[-2,.2],[2,.2],[2,-.1]],r,[1,1]),a=Y(s,c._,.45);let l=0;t.st>0&&(t.st=y(0,t.st-.001*o/.2),l=1),a&&(W(c,a,.8),0==t.st&&(t.at<=6?(t.st=1,t.at++,1==t.at&&(t.lt.state=1),2==t.at&&(t.lt.state=3)):t.lt.nt&&(nt(Ct,"You Won!",1),n.ut.remove(),n.ft.remove(),Mt.vt=2))),t.lt.nt&&(l=10),r[2]=i[2]+l},4:(t,e,o,n)=>{let{map:r,H:i}=n,{yt:s,Rt:a}=r,l=.021*10;if(t.N?(t._[2]-t.v[2]>=-.1&&(t.a[1]=.035*10),U(n.K,i.p)):U(n.K,t._),t.a[2]=-.5,w(t.v,_(m(t._,t.v,[]),.028)),!t.V&&Bt.buttons[0]){let e=B(g([Bt._[0],1.4*Bt._[1]],-c,[]));w(t.a,_(e,l))}t.V||(e[wt]&&(t.a[0]+=l),e[xt]&&(t.a[0]-=l),e[mt]&&(t.a[1]-=l),e[_t]&&(t.a[1]+=l));let u=s(t._);if(u){u.dt&&w(t.a,_(u.dt,.147,[]));let e=a(t._,.45,!0);e&&W(t,e);let o=u.height-t._[2];o>0&&o<.25&&(t._[2]+=o,t.v[2]-t._[2]>.02&&Math.random(),t.v[2]=t._[2])}},0:(t,e,o,n)=>{let c=t.pt?-1:1;switch(t.state){case 0:H(n.A._,.4,k(t._,[0,c,0],[]),.4)&&(t.state=1);break;case 1:t.wt+=.01*o,t.wt>=1&&(t.wt=1,t.state=2,k(n.A.a,[0,2*o*c,0])),t.frame=i(7.99*Z(t.wt,1));break;case 2:t.wt-=.003*o,t.wt<=0&&(t.wt=0,t.state=0),t.frame=i(7.99*t.wt)}},1:(t,e,n,c)=>{let{state:i,_:s}=t,a=A(c.A._,s,[]),l=E(a);switch(n/=1e3,i){case 0:l<4.5&&(t._t=0,t.state=1,t.z=s[2]);break;case 1:t._t+=n,t._t>=1&&(t._t=0,t.state=2,t._[2]=t.z,I(a,t.xt),U(t.v,t._)),t._[2]=t.z+Z((u=3*t._t/1%1)<.5?2*u:2-2*u,1);break;case 2:if(t._t+=n,H(c.A._,.45,t._,.55)&&(t.state=0,k(c.A.a,O(t.xt,12,[]))),t._t>=2){t.state=0;break}k(t.v,O(t.xt,5.5*j(.2,.9,t._t/2),[]),t._)}var u;let f=2===i?t.xt:a,v=c.map.yt(t._);v&&(t._[2]=t.v[2]=v.height),t.angle=((t,e,n)=>{let c=o-0;return 0+(c+(t-0)%c)%c})(r(f[1],f[0]))/o},2:(t,o,n,r)=>{let{A:i}=r,{ht:s}=t,a=s?-1:1;let l=-.1;t._[0]=R(t._[0],0,1),t._[0]-t.v[0]>0&&!t.bt&&(t.bt=1),t._[0]-t.v[0]<0&&t.bt&&(t.bt=0),(o[s?bt:ht]||o[s?wt:xt]||Bt.buttons[0])&&(l=6,i.N&&(i.a[0]=.02)),t.a[0]=l;let u=at.map(o=>{let n=g(o,-t._[0]*e+c,[]);return[n[0]*a+t.anchor[0],n[1]+t.anchor[1],t.anchor[2]]});t.Bt=u;let f=Y(u,i._,.45);f&&(f[1]=-d(f[1]),w(i._,f))},3:(t,e,o,n)=>{let{A:c}=n,r=N(lt[t.id],t._,t.Ct),i=Y(r,c._,.45);i&&W(c,i,.85)}},ft={12:(t,e,o,n)=>X({type:12,t:0,F:n,D:0,$:0},e,o,n),11:(t,e,o,n)=>{let c=X({type:11,D:0,t:0,state:0},e,o,n);return t.Mt.push(()=>{c.D=c.t=c.state=0}),c},10:(t,e,n,c,r,s,a)=>{let l;return l=s>=0?i(1.6*E([r,s,a])):r?i(1.2*o*r):1,X({type:10,W:new Array(l).fill(0).map(t=>({G:-1,_:[0,0]})),X:r,Y:s,Z:a},e,n,c+1)},9:(t,e,o,n)=>X({type:9,D:-1.5,tt:0},e,o,n),8:(t,e,o,n)=>X({type:8,state:0,angle:1,D:0},e,o,n),7:(t,e,o,n)=>{let c=X({type:7,et:[],D:0,ct:0,state:0,rt:0,nt:0},e,o,n);return P(3,r=>c.et[r]=t.gt(6,...[[e-2.5,o,n,0],[e+2.5,o,n,2],[e,o+3.2,n,0]][r])),c},6:(t,e,o,n,c)=>X({type:6,g:0,D:0,ot:10,j:2==c?t.gt(9,e,o,n):0,state:c},e,o,n),5:(t,e,o,n)=>X({type:5,it:[e,o,n],lt:t.gt(7,e,o+4,n),st:0,at:0},e,o,n),4:(t,e,o,n)=>{let c=X({type:4,N:0,V:0},e,o,n);return t.$t.addElement(c),c},0:(t,e,o,n,c)=>({type:0,_:[e,o,n],wt:0,state:0,frame:0,pt:c||0}),1:(t,e,o,n)=>X({type:1,xt:[0,0,0],state:0,angle:0,_t:0,z:0},e,o,n),2:(t,e,o,n,c)=>{let r=X({anchor:[e,o,n],type:2,Bt:[],bt:0,ht:c},0,0,0);return t.$t.addElement(r),r},3:(t,e,o,n,c,r,i)=>X({type:3,id:c,Ct:[r||1,i||1]},e,o,n)},vt=[0,"They took my sisters and brothers… My family…","… Mercilessly seized to be shoved into war foundries…","… to be melted to form his army and weapons","I will save my people...<br>They want the metal from my body but…","They will<br><big>NOT FOUND</big><br>me!",0,"CHECKPOINT!",0,"Time to storm his castle!",0],yt=(t,e,o)=>{let{A:n}=e;if(n._[2]<-15){if(n._[0]=n.v[0]=e.k[0],n._[1]=n.v[1]=e.k[1],n._[2]=n.v[2]=e.k[2],n.N=0,n.V=0,e.Pt--,e.Pt<=0)return nt(Ct,"YOU<br>ARE<br>DEAD",1),e.ut.remove(),e.ft.remove(),void(Mt.vt=2);e.Mt.map(t=>t())}for(let n of e.entities)ut[n.type](n,o,t,e);e.D+=t,e.L+=175e-6*t};let Rt,dt,pt;let mt=1,wt=2,_t=3,xt=4,ht=5,bt=6,Bt={buttons:[0,0,0],_:[0,0]};let Ct,Mt={vt:0};let gt="layout(location=1)in vec2 _M;layout(location=2)in vec3 _N;layout(location=3)in float _O;layout(location=4)in vec3 _P;struct _K{vec4 _U;vec4 _V;vec2 _W;vec2 _X;};layout(std140) uniform _J{_K _L[300];};layout(std140) uniform _Q{mat4 _G;vec4 _H;vec4 _I;};out vec2 oVT;out vec3 oW;out float oD,oC;void main(){_K v=_L[int(_O)];float n=.97,l=_I.w,o=_H.w;vec3 M=_I.xyz;vec4 u=l!=0.?v._V:v._U,s=_G*n*vec4(_N,1);s+=vec4(0.,0.,_P.z,0.);oD=s.z;oVT=(vec2(1)-(vec2(-_M.x,_M.y)+vec2(1))/2.)*u.zw+u.xy;gl_Position=vec4(s.xy+v._W*M.xy/2.+(_M.xy*(u.zw*M.xy/o)+(l!=0.?(u.xy-u.xy+(u.zw-u.zw)/2.)/u.zw*(u.zw*M.xy/o)*vec2(2,-2):vec2(0.)))/n,-oD/(50.*M.z),1);}",$t=(t,e)=>{let o=A((n=t,(c=(c=[])||n)[0]=d(n[0]),c[1]=d(n[1]),c[2]=d(n[2]),c),e);var n,c;return E(((t,e,o)=>((o=o||t)[0]=y(t[0],0),o[1]=y(t[1],0),o[2]=y(t[2],0),o))(o,0,[]))+v(y(o[0],y(o[1],o[2])),0)},Pt=(t,e,o,n)=>{let c=b([t[0],t[2]]);return y(C([e,o],[c,t[1]]),-n-t[1])},Dt=(t,e,o)=>{let n=m((c=[b([t[0],t[2]]),t[1]],(r=r||c)[0]=d(c[0]),r[1]=d(c[1]),r),[o,e]);var c,r;return v(y(n[0],n[1]),0)+b(((t,e,o)=>((o=o||t)[0]=y(t[0],e[0]),o[1]=y(t[1],e[1]),o))(n,[0,0]))},Ft=(t,e)=>{let o=[b([t[0],t[2]])-e[0],t[1]];return b(o)-e[1]},Tt=(t,e,o,n,c)=>e([o?d(t[0]):t[0],n?d(t[1]):t[1],c?d(t[2]):t[2]]),zt=(t,e)=>{return e[3]((o=e,(c=(c=[])||o)[0]=o[0]*(n=t)[0],c[1]=o[1]*n[1],c[2]=o[2]*n[2],c));var o,n,c},At=(t,e)=>{return e[1]((o=t,(c=(c=[])||o)[0]=o[0]/(n=e[0]),c[1]=o[1]/n,c[2]=o[2]/n,c))*e[0];var o,n,c},kt=(t,e)=>{let o=A(t,e,[]);return e[3](o)},Ut=(t,e,o)=>o(S(e,t,[])),Ot=(t,e)=>{let o=A(t,(n=t,c=O(e,-1,[]),(i=(i=[])||n)[0]=R(n[0],c[0],(r=e)[0]),i[1]=R(n[1],c[1],r[1]),i[2]=R(n[2],c[2],r[2]),i),[]);var n,c,r,i;return e[3](o)},Et=(t,e)=>{return e[4](A((o=k(O(e,.5,[]),t),(c=c||o)[0]=o[0]%(n=e)[0],c[1]=o[1]%n[1],c[2]=o[2]%n[2],c),O(e,.5,[])));var o,n,c},It=(t,e,o,n)=>(n/(t-1)*2-1)*e+o,Lt=(e,o,c,r,i,a,l)=>{let u=s(a[2]*(i=i||128)*2),f=s(a[3]*i*2),R=F(e).map(t=>{let e=parseFloat(t);return e!=e?t:e}),p=[0],m=(()=>{let e=0;let o=[],n=t=>o.push(t),c=(t,e)=>{let c=o.splice(-e).reverse();n(e=>t(e,c))};for(;e<R.length;){let r=R[e],i="$#".indexOf(r);if(i>=0)n((null==l?void 0:l[i])||0);else{let e={a:()=>c((t,e)=>{let o=e[1](t);return!p[0]&&o<.001&&(p[0]=e[0]),o},2),i:()=>c((t,e)=>y(e[1](t),e[0](t)),2),b:()=>c((t,e)=>y(e[1](t),-e[0](t)),2),u:()=>c((t,e)=>v(e[1](t),e[0](t)),2),o:()=>c((t,e)=>d(e[1](t))-e[0],2),m:()=>c((t,e)=>e[1](t)-e[0],2),q:()=>c((t,e)=>Tt(t,e[0],!0,!1,!0),1),r:()=>c((t,e)=>Tt(t,e[0],!0,!1,!1),1),l:()=>c((t,e)=>zt(t,e),4),y:()=>c((t,e)=>Ut(t,K([0,1,0],e[0],[]),e[1]),2),x:()=>c((t,e)=>Ut(t,K([1,0,0],e[0],[]),e[1]),2),t:()=>c((t,e)=>kt(t,e),4),s:()=>c((t,e)=>At(t,e),2),e:()=>c((t,e)=>Ot(t,e),4),f:()=>c((t,e)=>Et(t,e),5),P:()=>c((t,e)=>{return o=t,n=I(e),L(o,n);var o,n},3),B:()=>c((t,e)=>$t(t,e),3),S:()=>c((t,e)=>{return o=e[0],E(t)-o;var o},1),C:()=>c((t,e)=>Dt(t,...e),2),O:()=>c((t,e)=>Pt(t,...e),3),U:()=>c((t,e)=>Ft(t,e),2),p:()=>n(o.pop()*t)};e[r]?e[r]():n(r)}e++}return o[0]})(),w=(t,e,o)=>{let n=.1;for(let c=0;c<100&&n<30;c++){let c=k(O(e,n,[]),t);let r=S(o,c),i=m(r);if(i<.001)return r;n+=i}},_=t=>{let e=[.5773,-.5773],o=[0,0,0];for(let n=0;n<4;n++){let c=[0,1,1,0],r=[e[c[n]],e[c[(n+1)%4]],e[[1,0,1,0][n]]];k(o,O(r,m(k(t,O(r,1e-4,[]),[]))))}return I(o)},x=D(4*u*f),h=new Uint8Array(3*u*f),b=(Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random()),I([-n,.5,-.5])),B=(C=[0,0,1],M=b,(g=g||[...C])[0]=C[1]*M[2]-C[2]*M[1],g[1]=C[2]*M[0]-C[0]*M[2],g[2]=C[0]*M[1]-C[1]*M[0],g);var C,M,g;E(B),L([0,0,1],b);for(let t=0;t<f;t++)for(let e=0;e<u;e++){let n=[It(u,a[2],a[0],e),It(f,a[3],a[1],f-1-t)];p[0]=0;let i=w([...n,15],I([0,0,-1]),o);if(i){let o=p[0],n=S(c,i,[]);let s=[0,0,0];r||(s=_(i)),x[4*(t*u+e)+0]=(s[0]+1)/2,x[4*(t*u+e)+1]=(s[1]+1)/2,x[4*(t*u+e)+2]=(s[2]+1)/2,x[4*(t*u+e)+3]=(n[2]/15+1)/2,h[3*(t*u+e)+0]=o,h[3*(t*u+e)+1]=0,h[3*(t*u+e)+2]=0}else x[4*(t*u+e)+3]=0}return{w:u,g:f,data:x,Dt:h}},St=async(t,e,o,n,c,r)=>{let s=[],a=l=>{P(c[l.length],u=>{let f=[...l,u];if(l.length===c.length-1){let a=f.map((t,e)=>t/(c[e]-1)),l=new Promise(c=>{setTimeout(()=>{let s=((t,e,o,n,c)=>(()=>{let r=((t,e,o,n)=>{let c=[0,0,25,25];return[6,15].forEach(r=>{c=((c,r)=>{let i=1+1/(2*y(r[2],r[3])),{w:s,g:a,data:l}=Lt(t,e,o,1,i,r,n),u=[[50,-50],[50,-50]];let f=1;for(let t=0;t<a;t++)for(let e=0;e<s;e++)l[4*(t*s+e)+3]&&(u[0][0]=v(u[0][0],It(s,r[2],r[0],e-1)),u[0][1]=y(u[0][1],It(s,r[2],r[0],e+1)),u[1][0]=v(u[1][0],It(a,r[3],r[1],a-1-t-1)),u[1][1]=y(u[1][1],It(a,r[3],r[1],a-1-t+1)),f=0);return f?r:[(u[0][0]+u[0][1])/2,(u[1][0]+u[1][1])/2,(u[0][1]-u[0][0])/2,(u[1][1]-u[1][0])/2]})(0,[...c])}),c})(t,e,o,c),s=Lt(t,e,o,n,63/4,r,c);return{Ft:s,Tt:r,zt:(t=>{let e=[i(t.w/2),i(t.g/2),i(t.w/2),i(t.g/2)];let o=[0,0,0,0],n=e=>{if(e[0]<0||e[1]<0||e[2]>t.w||e[3]>t.g)return 1;for(let o=e[1];o<e[3];o++)for(let n=e[0];n<e[2];n++)if(!t.data[4*(o*t.w+n)])return 1;return 0};let c=1;for(;c;){c=0;for(let t=0;t<4;t++)if(!o[t]){c=1;let r=[...e];r[t]+=t<2?-1:1,n(r)?o[t]=1:e=r}}return e})(s)}})())(t,e,o,n,f.map((t,e)=>r[e]&&r[e](a,f)||0));c(s)},0)});s.push(l)}else a(f)})};return a([]),[await Promise.all(s),c]},Vt=[1],Kt=[1],Ht=[1],Nt=[1],Wt=[1],Yt=[1],Xt=[1],qt=[1],Qt=[1],Zt=[1],Gt=[1],Jt=[1],jt=[1],te=[1],ee=[1],oe=[2,8],ne=[18],ce=[2,8],re=[2,1],ie=[1,6],se=[1,5],ae=[2],le=[8],ue=[16];window.addEventListener("DOMContentLoaded",async n=>{(async t=>{let e=[];let o;let n={},c=(t,o)=>{t.repeat||(n[t.code]=o,e[{ArrowDown:_t,ArrowUp:mt,ArrowLeft:xt,ArrowRight:wt,KeyZ:ht,KeyX:bt}[t.code]||0]=o),t.preventDefault()};let r,i;window.addEventListener("keydown",t=>{c(t,!0)},!0),window.addEventListener("keyup",t=>{c(t,!1)},!0),window.addEventListener("mousedown",t=>{Bt.buttons[t.button]=1}),window.addEventListener("mouseup",t=>{Bt.buttons[t.button]=0}),window.addEventListener("mousemove",t=>{let e=ot.getBoundingClientRect();Bt._[0]=t.clientX-(e.x+e.width/2),Bt._[1]=t.clientY-(e.y+e.height/2)}),Rt=await void 0,dt=await void 0,pt=await void 0,Ct=ct(50,50,4,1),nt(Ct,vt[5],1);let s=0;let a=n=>{void 0===o&&(o=n);let c=n-o;o=n;let l=!Bt.buttons[0]&&i;i=Bt.buttons[0],s-=c,l&&s<0&&(0==Mt.vt&&(r=((t,e)=>{let o=(()=>{let t=[];return{addElement:e=>{t.push(e)},update:e=>{e/=100;for(let o of t){let t=o.v;o.v=[...o._],k(A(O(o._,2),t),O(o.a,e*e)),o.a[0]=o.a[1]=o.a[2]=0}}}})();let n=0;let[c]=e,r=[],i={update(t,e){for(n+=e;n>=10;)yt(10,i,t),o.update(10),n-=10;i.At++;let r=(""+Math.floor(i.D/6e4)).padStart(2,"0"),s=(""+Math.floor(i.D/1e3)%60).padStart(2,"0"),a=(""+Math.floor(i.D)%1e3).padStart(3,"0");i.At%5==0&&(nt(i.ut,`${"🔴".repeat(i.Pt)}\nScore: ${(""+i.J).padStart(8,"0")}\nTime: ${r}:${s}:${a}`),vt[i.I]?i.L<1?nt(i.ft,vt[i.I],1):(i.L=0,i.I++):nt(i.ft,"")),c(e,i,n/10)},gt(t,...e){let o=ft[t](i,...e);return r.push(o),o},A:null,map:t,entities:r,$t:o,J:0,K:[0,0,0],H:{},Mt:[],k:[],ut:ct(3,3,1.2,0),ft:ct(50,34,1,1),D:0,I:1,L:0,Pt:5,At:0};for(let e of t.entities)e[0]<0?i.H[e[1][3]]=[...e[1]]:i.gt(e[0],...e[1]);return i.k=i.H.b,i.A=i.gt(4,...i.H.b),i})((t=>{let e="161;67;b20,8.5,2.5,4,-1,e0,4,8,1,1,3,R0,0,8,3,1,0,R2,0,10,4,0,0,R3,c-9,1,12,i0,4,8,1,1,3,R0,0,8,3,1,0,R2,0,10,4,0,0,R3,c-6,1,8,i0,4,8,1,1,3,R0,0,8,3,1,0,R2,0,10,4,0,0,R3,c-3,1,4,i0,4,8,1,1,3,R0,0,8,3,1,0,R2,0,10,4,0,0,R3,c0,1,0,i4,c-11,3,54,i0,4,8,1,1,3,R0,0,8,3,1,0,R2,0,10,4,0,0,R3,c-9,1,12,i0,4,8,1,1,3,R0,0,8,3,1,0,R2,0,10,4,0,0,R3,c-6,1,8,i0,4,8,1,1,3,R0,0,8,3,1,0,R2,0,10,4,0,0,R3,c-3,1,4,i0,4,8,1,1,3,R0,0,8,3,1,0,R2,0,10,4,0,0,R3,c0,1,0,i4,c0,3,38,i1,7,6.5,3,12,e1,2,6,3,12,e0,2,14.5,3,11,e0,0,4,14,0,0,R1,10,6,15,-1,-1,R1,4,0.35,8,4,2,e0,4,0.35,4,4,2,e-1,0,4,0,8,5,3,e0,4,0,4,4,3,e4,c0,12,2,i4,-2.2,2.1,3,8,e4,-1.1,1.05,3,8,e4,0,0,3,8,e3,c0,4.2,2.2,ip4,6.5,8,4,-1,e4,1,8,3,5,e7,10,1,16,0,0,R4,10,16,1,0,15,R5,10,16,1,0,0,R3,0,16,15,0,0,R8,c-15,-4,13,i5,c4,8,21,i5,4,4,1,8,20,R1,6,3,4,4,0,e6,0.5,0,3,0,e2,c0,8,12,i1,6,3,4,4,0,e6,0.5,0,3,0,e2,c0,8,4,i0,0,13,4,13,4,6,10,e0,0,13,4,5,4,6,10,e5,0,4,20,8,0,R4,4,12,1,4,1,R5,4,12,1,4,0,R6,0,18,1,3,19,R3,0,12,20,4,0,R6,0,15,20,3,0,R12,c-5,-3,28,i0,0,3,1,7,18.5,6,10,e6,1,7.5,18.5,4,10,e3,1,7.5,18.5,4,10,e1,5,10,25,4,1,e1,5,4,25,4,1,e1,5,7.5,18.5,4,1,e0,0,15,28,0,0,R9,c-9,0,17,i0,8,0,3,2,2.5,6,10,e5,1,1,2,2,0,R5,0,3,2,0,0,R2,c-2,6,0,i5,1,1,2,2,0,R5,0,3,2,0,0,R2,c-1,3,0,i5,1,1,2,2,0,R5,0,3,2,0,0,R2,c0,0,0,i2,0,12,3,0,0,R5,c-9,0,14,i0,8,0,3,2,2.5,6,10,e5,1,1,2,2,0,R5,0,3,2,0,0,R2,c-2,6,0,i5,1,1,2,2,0,R5,0,3,2,0,0,R2,c-1,3,0,i5,1,1,2,2,0,R5,0,3,2,0,0,R2,c0,0,0,i2,0,12,3,0,0,R5,c-6,0,11,i0,8,0,3,2,2.5,6,10,e5,1,1,2,2,0,R5,0,3,2,0,0,R2,c-2,6,0,i5,1,1,2,2,0,R5,0,3,2,0,0,R2,c-1,3,0,i5,1,1,2,2,0,R5,0,3,2,0,0,R2,c0,0,0,i2,0,12,3,0,0,R5,c-3,0,8,i0,8,0,3,2,2.5,6,10,e5,1,1,2,2,0,R5,0,3,2,0,0,R2,c-2,6,0,i5,1,1,2,2,0,R5,0,3,2,0,0,R2,c-1,3,0,i5,1,1,2,2,0,R5,0,3,2,0,0,R2,c0,0,0,i2,0,12,3,0,0,R5,c0,0,5,i5,0,12,5,0,0,R6,c0,10,0,i6,5,3,3,10,e0,6,0,6,2,0.5,6,10,e6,0,9,1,1,5,R6,9,8,1,2,1,R5,3,1,5,0,0,R5,0,10,5,0,0,R7,c-2,10,-10,i0,4,8,1,1,3,R0,0,8,3,1,0,R2,0,10,4,0,0,R3,c2,0,-6,i0,4,8,1,1,3,R0,0,8,3,1,0,R2,0,10,4,0,0,R3,c1,0,-3,i0,4,8,1,1,3,R0,0,8,3,1,0,R2,0,10,4,0,0,R3,c0,0,0,i2,0,10,8,0,-10,R5,c1,23,-3,i1,1,12.5,12.5,4,10,e4,1,12.5,12.5,4,10,e8,1,12.5,12.5,4,10,e0,0,38,28,0,0,R3,0,40,30,-1,-1,R6,c-22,-4,69,i0,8,0,0,2,2.5,6,10,e1,0,11,1,0,0,R2,c0,1,28,i0,8,0,0,2,2.5,6,10,e1,0,11,1,0,0,R2,c0,8,23,i0,8,0,0,2,2.5,6,10,e1,0,11,1,0,0,R2,c0,1,18,i0,8,0,0,2,2.5,6,10,e1,0,11,1,0,0,R2,c0,4,13,i2,1,1,4,6,0,R2,3,1,4,2,0,R2,0,5,4,2,0,R1,4,7,1,1,6,R1,3,1,6,0,0,R1,1,1,6,8,0,R1,0,8,6,1,0,R7,c0,4,1,i0,0,18,38,1,1,R2,0,20,39,0,1,R4,0,20,40,0,0,R12,c30,10,10,i1,c".split(";"),o=parseFloat(e[0]),n=parseFloat(e[1]),c=D(o*n*2).fill(-1),[r,i]=((t,e,o,n)=>{let c=[],r=[],i=()=>c.pop(),s=t=>{let e=[];return P(t,()=>e.push(i())),e},a=([t,o,c,i])=>{let[s,l]=i;({e:()=>{l[1][0]+=t,l[1][1]+=o,l[1][2]+=c,r.push(l)},i:()=>{a([t+l[0],o+l[1],c+l[2],l[3]])},c:()=>{l.forEach(e=>a([t,o,c,e]))},T:()=>{for(let c=0;c<l[1];c++)for(let r=0;r<l[0];r++)"_"!==l[2][c*l[0]+r]&&(n[2*((c+o)*e+(r+t))]=l[2][c*l[0]+r])},R:()=>{t+=l[0],o+=l[1];for(let r=0;r<l[3];r++)for(let i=0;i<l[2];i++){let s=i+t,a=r+o;n[2*(a*e+s)]=l[4],n[2*(a*e+s)+1]=l[5]+c}}})[s]()};for(let e of F(t).map(t=>{let e=parseFloat(t);return e!=e?t:e})){let t={e:()=>c.push([e,[i(),s(i())]]),i:()=>c.push([e,s(4)]),c:()=>c.push([e,s(i())]),R:()=>c.push([e,s(6)]),T:()=>{let t=i(),o=i();c.push([e,[t,o,s(t*o)]])}}[e];t?t():c.push(e)}return a([0,0,30,c[0]]),[n,r]})(e[2],o,0,c),s=[o,n],a=(t,e)=>r[2*(t[1]*s[0]+t[0])+e],l=(t,e)=>{return a(e,1)+(o=a(e,0),n=t[0]-e[0],c=t[1]-e[1],o>0&&o<5?[1-c,n,c,1-n][o-1]:5==o&&c>n?1-c+n:6==o&&1-c>n?c+n:7==o&&1-c>1-n?c+1-n:8==o&&c>1-n?1-c+1-n:1);var o,n,c},u=t=>{let e=M(t,[]),[c,r]=e;if(c>=0&&r>=0&&c<o&&r<n&&a(e,1)>=0){let o=a([c,r],0);return{dt:Q(o),height:l(t,e),kt:o,Ut:e}}};return{Rt:(t,e,o)=>{let n=[[0,0,0],[0,0,0],[0,0,0]];for(let c=-1;c<2;c++)for(let r=-1;r<2;r++){let i=_(B([r,c]),e),s=w(i,t),a=u(s);if(a){let[i,l]=a.Ut;let u=0;o&&(u=v(b(m(s,t)),e)),a.height-t[2]-u>.25&&(n[c+1][r+1]=1)}}let c=[],[r,i]=M(t,[]),s=(t,e,o,n)=>{c.push([[t,e],[t,e+n],[t+o,e+n],[t+o,e]])};for(let t=0;t<3;t++)for(let e=0;e<3;e++)if(n[t][e]){let o=1;for(;n[t][e+o++];);s(r+e-1,i+t-1,o-1,1)}for(let t=0;t<3;t++)for(let e=0;e<3;e++)if(n[e][t]){let o=1;for(;e+o<3&&n[e+o++][t];);s(r+t-1,i+e-1,1,o-1)}let a;let l=[...t];for(let t of c){let o=Y(t,l,e);o&&(a=w(a||[0,0],o),w(l,a))}return a},yt:u,Ot:a,Et:l,size:s,It:r,entities:i}})(),t),Mt.vt=1,nt(Ct,"",1)),2==Mt.vt&&(nt(Ct,vt[5],1),Mt.vt=0,s=1)),1==Mt.vt?r.update(e,c):t[0](),window.requestAnimationFrame(a)};window.requestAnimationFrame(a)})(await(async()=>{let n=(()=>{let t=document;ot=t.createElement("div");let e=ot.style;e.position="absolute",e.top="50%",e.left="50%",e.transform="translate(-50%,-50%)";let o=t.createElement("canvas");o.width=T[0],o.height=T[1];let n=document.body.style;n.padding=n.margin="0",n.width="100%",n.backgroundColor="#000",n.Lt="none";let c=o.style,r=.75*document.documentElement.clientWidth,i=.75*document.documentElement.clientHeight;r/i>T[0]/T[1]?c.height=i+"px":c.width=r+"px",e.fontSize="1.8vw";let s=o.getContext("webgl2",{alpha:!1,St:"high-performance",Vt:!0});return s.getExtension("OES_texture_float_linear"),s.getExtension("EXT_color_buffer_float"),s.clearColor(0,0,0,0),s.blendFunc(770,771),ot.appendChild(o),t.body.appendChild(ot),s})(),r=async(c,r,i)=>{let s=(await Promise.all(((n,c,r)=>[St("1,1,1,B1.05,0.2,1.05,B20,S0,-20,0,ti0,1.2,0,t3,au4,a",n,c,r,Vt,[(t,e)=>0]),St("1,1,0P1,1,1Bi$y3,a",n,c,r,Kt,[(t,e)=>0]),St("1,1,0P1,1,1Bi$y3,a",n,c,r,Ht,[(t,o)=>e]),St("1,1,0P1,1,1Bi$y3,a",n,c,r,Nt,[(e,o)=>t]),St("1,1,0P1,1,1Bi$y3,a",n,c,r,Wt,[(t,o)=>-e]),St("1,1,1,B1,1,1,P1,0,0,ti$y3,a",n,c,r,Yt,[(t,e)=>0]),St("1,1,1,B1,1,1,P1,0,0,ti$y3,a",n,c,r,Xt,[(t,o)=>e]),St("1,1,1,B1,1,1,P1,0,0,ti$y3,a",n,c,r,qt,[(e,o)=>t]),St("1,1,1,B1,1,1,P1,0,0,ti$y3,a",n,c,r,Qt,[(t,o)=>-e]),St("1,0.5,1B0,-0.5,0t",n,c,r,Zt,[(t,e)=>0]),St("1,0.98,1,B0.5,0.5,2,B0,0.7,0,t2,0.5,0.5,B0,0.7,0,tub0.1,m0.9,s6,a",n,c,r,Gt,[(t,e)=>0]),St("1,1,1,B0.05,0.12,0.25,B1,3,0.8,0.6,f1,-2,-2,t0.05,0.12,0.25,B1,3,0.8,0.6,f1,-2.35,-3,tui1,1,1,B0.95,su6,a",n,c,r,Jt,[(t,e)=>0]),St("$S0$0t7a",n,c,r,jt,[(t,e)=>.45*1.1]),St("0.25,0.14,C0.25,0,0,e0.05,o0.5,px1,0,0,Pi0.07,0,0,t0.05,0.2,0.05,B2,au1.2,s1,a",n,c,r,te,[(t,e)=>0]),St("2,0.2,2,B8,0.2,C6,0,-2,ti2,1,5,B2.5,0.95,0.1,B0,1,0,t3,10,10,0.75,fi0,0,-1.3,tb5,a0.05,0.25,U0.9,0.25,-1.3,t0.16,0.05,2,B0,0.23,0,t0.16,0.05,2,B1.7,0.23,0,tuu7,au-2,0,0,t-0.5,px0,0,-2,t$y0,0,4,tr",n,c,r,ee,[(t,e)=>0]),St("2,1,1,B0.18,o1,0,0,Pi0.2,1.25,C0,-0.07,0,t1,0.1,1,B0.15,o0,1,0,tu-0.5,px-0.75,0,0,t#0,0,tu0.5,0.5,0,t$y7a",n,c,r,oe,[(e,o)=>o[0]?t:0,(t,e)=>2*t[1]]),St("0.5,0.5,1,B1,0.8,0.1,B0,0,1,tu0.1,0.4,0.1,B0.3,-0.7,0.85,tqu$y",n,c,r,ne,[(t,e)=>t[0]*o]),St("0.4,0.4,1.8,B0,0,1.8,t$y7a",n,c,r,ce,[(o,n)=>n[0]*t+-(n[0]?1-o[1]:o[1])*e+e/2]),St("6,1,4,B1,0,0,t-1,0,1,Pi0.2,o0,1,0,P0,-0.3,0,ti-3.5,0.7,-4,t1,1,$l",n,c,r,re,[(t,e)=>e[0]?-1:1]),St("0,-1,0,P2,0.5,C0.5,0.5,3,B3,0.5,0.5,Bu0,0.52,0,tb0,0,0,t1.5,2,C0.4,0.65,3,B3,0.65,0.4,Bu0,0,0,tb0,-1.98,0,tu1.3,4,Cb0,$0,ti$y6,a",n,c,r,ie,[(t,e)=>4*t[1]]),St("0.8,0.2,1,B0.7,0.2,C1.3,0,0,tu0.8,0,0,t0.15,m0.8,s$x-0.25,py7a",n,c,r,se,[(o,n)=>t-o[1]*e]),St("0.8,0.2,0.4,O0,0.8,0,t0.1,0.1,0.4,B0,0,0.2,tu$y",n,c,r,ae,[(t,e)=>t[0]*o]),St("0.3,2,2,B0,0,-2,t0.7,0.8,C1.2,0.5,C0.3,obu$y0.2,m0.95,s0,0,4,tr0.5,px0.5,py-1,-0.3,0,t7a",n,c,r,le,[(t,o)=>t[0]*e*1.4]),St("0.3,2,U0.09,o0.4,1.8,Ub0.8,S0,0,2,tb1,1,C7a0.1,o2,0.7,0.8,Bi$y0.5,px0,0,-2,tu$y1a",n,c,r,ue,[(t,e)=>t[0]*o])])(c,r,i))).reduce((t,e)=>[...t,...e[0].map(t=>({...t,dimensions:e[1]}))],[]),a=(t=>{let e=[],o=t.map((t,e)=>({Kt:t,Ht:e})).sort(({Kt:t},{Kt:e})=>e.w*e.g-t.w*t.g),n=()=>{e.push({data:{w:1024,g:1024,data:D(4194304),Dt:new Uint8Array(3145728)},Nt:[]})};return n(),o.map(t=>(({Kt:t,Ht:o})=>{let c=0,r=!1,i=0,s=0;for(;!r&&c<e.length;){for(s=3;!r;){i=3;let o=s+t.g+3;let n=1024;if(o>=1021)break;for(let r of e[c].Nt){let e=i+t.w+3,c=r.x+r.Ft.w+3,a=r.y+r.Ft.g+3;n=v(n,a+1),s<=a&&r.y<=o&&i<=c&&r.x<=e&&(i=c+1)}i+t.w+3<1024&&o<1024&&(r=!0),r||(s+=n)}r||(c++,c>=e.length&&n())}let a=e[c],l=a.data.data,u=a.data.Dt;for(let e=0;e<t.g;e++){let o=4*t.w,n=e*o;l.set(t.data.subarray(n,n+o),4*(1024*(s+e)+i));let c=3*t.w,r=e*c;u.set(t.Dt.subarray(r,r+c),3*(1024*(s+e)+i))}a.Nt.push({x:i,y:s,Ft:t,Ht:o}),a.Nt=a.Nt.sort((t,e)=>t.x-e.x)})(t)),e})(s.map(t=>t.Ft)),l=((t,e)=>({Wt:tt(t,e.w,e.g,34836,6408,5126,e.data),Yt:tt(t,e.w,e.g,6407,6407,5121,e.Dt)}))(n,a[0].data);return a.forEach(t=>t.Nt.forEach(t=>{s[t.Ht].x=t.x,s[t.Ht].y=t.y})),[s,l]},s=(t,e)=>{let o=[K(t[0],e*t[0][3],[]),K(t[1],e*t[1][3],[])];return V(...e>0?o:o.reverse())},l=[[0,1,0,.6*e],[1,0,0,.4*-e]],u=s(l,1),f=s(l,-1),m=[[0,1,0,c],[1,0,0,-c]],w=s(m,1),_=s(m,-1),[x,h]=await r(w,_,0),[b,B]=await r(u,f,1),C=[.5625*T[0],.5625*T[1]],M=et(n,C[0],C[1],34836,6408,5126,!0),g=et(n,T[0],T[1],34836,6408,5126,!0),$=((t,e,o,n,c,r)=>{t.bindFramebuffer(36160,e.h);let i=tt(t,e.w,e.g,6407,6407,5121);return t.framebufferTexture2D(36160,36065,3553,i,0),i})(n,g);n.drawBuffers([36064,36065]);let F=await st(n,gt,"uniform sampler2D uTex;in vec2 oVT;in float oD;layout(location=0)out vec4 fc;void main(){vec4 o=texelFetch(uTex,ivec2(oVT),0);float v=oD+(o.x*2.-1.)/2.;if(o.w<=0.){discard;}fc=vec4(vec3(v),1.);}"),z=await st(n,gt,"uniform sampler2D uTex,uMat;in vec2 oVT;in float oD;layout(location=0)out vec4 fc;layout(location=1)out vec4 m;void main(){ivec2 v=ivec2(oVT);vec4 o=texelFetch(uTex,v,0),u=texelFetch(uMat,v,0);float l=o.w;if(l==0.){discard;}float f=(oD+(l*2.-1.)+1.)/2.;fc=vec4(o.xyz,f);m=vec4(u.xyz,f);}"),U=await st(n,"layout(location=0)in vec2 v;out vec2 vp;void main(){vp=v,gl_Position=vec4(v.xy,0.,1.);}","uniform sampler2D _A,_B,_C;uniform mat4 _D,_E;uniform vec2 _F;layout(location=0)out vec4 fC;in vec2 vp;void main(){vec4 v=texelFetch(_B,ivec2(gl_FragCoord.xy),0);float g=v.w*2.-1.;vec4 m=inverse(_D)*vec4(vp,g,1.),d=_E*m;float i,f,t=0.;for(f=-1.5;f<=1.5;f+=1.){for(i=-1.5;i<=1.5;i+=1.){vec4 n=texture(_A,(d.xy+vec2(1.))/vec2(2.)+vec2(i,f)/_F);float C=n.w*2.-1.;t+=d.z+.05>C?1.:.4;}}t/=16.;vec3 n=normalize(v.xyz*2.-vec3(1.)),C=vec3(.99,.97,.95);float c=texelFetch(_C,ivec2(gl_FragCoord.xy),0).x*255.;vec3 w=vec3(.95,.95,.85),B=vec3(.54,.69,.9),x=vec3(.6,.66,.72),F=vec3(0.,.7,0.),p=vec3(1.,1.,0.);float z=dot(n,vec3(0.,1.,0.));if(c>.5)C=p;if(c>1.5)C=p;if(c>2.5)C=F;if(c>3.5)C=vec3(.7,.45,.2);if(c>4.5)C=vec3(.7,.45,.2);if(c>5.5)C=.8*vec3(.9961,.9765,.9529);if(c>6.5)C=(z+sin(z*3.14+15.*gl_FragCoord.y/_F.y)*.5+1.)/2.*x*1.1+(-z+1.)/2.*F;vec3 A=t*w*max(0.,dot(normalize(vec3(.75,1.,.4)),n))+B*.3,o=C*clamp(A,0.,1.);if(g==-1.)o=mix(vec3(.2039,.3961,.6431),B,(gl_FragCoord.xy/_F).y);fC=vec4(clamp(o,0.,1.),1.);}"),E=(t,e)=>n.getUniformLocation(t,e),I=t=>({Xt:E(t,"uTex"),qt:E(t,"uMat")}),L=I(z),S=(I(F),E(U,"_A")),H=E(U,"_B"),N=E(U,"_C"),W=E(U,"_D"),Y=E(U,"_E"),X=E(U,"_F"),q=D(27e5),Q=((t,e,o,n,c)=>{let r=t.createBuffer();t.bindBuffer(34962,r),t.bufferData(34962,o,35040);let i=0;return"f2,f3,f1,f3".split(",").forEach((e,o)=>{let c={f:[5126,4]}[e[0]],r=parseInt(e.substr(1),10);t.vertexAttribPointer(n[o],r,c[0],!1,36,i),t.enableVertexAttribArray(n[o]),i+=r*c[1]}),r})(n,0,q,[1,2,3,4]),Z=n.createBuffer();n.bindBuffer(35345,Z);let G=D(24);n.bufferData(35345,G,35040),n.bindBufferBase(35345,1,Z),n.uniformBlockBinding(z,n.getUniformBlockIndex(z,"_Q"),1);let J=(t,e)=>{let o=n.createBuffer();n.bindBuffer(35345,o);let c=D(3600);return t.forEach((t,e)=>{c.set([t.x,t.y,t.Ft.w,t.Ft.g,t.x+t.zt[0],t.y+t.zt[1],t.zt[2]-t.zt[0],t.zt[3]-t.zt[1],t.Tt[0],t.Tt[1],0,0],12*e)}),n.bufferData(35345,c,35044),n.bindBufferBase(35345,2,o),n.uniformBlockBinding(e,n.getUniformBlockIndex(e,"_J"),2),o},j=J(x,z),nt=J(b,z),ct=(new Uint16Array(5e4),new Uint16Array(3e5)),rt=(new Uint16Array(3e5),new Float32Array(3e5),n.createBuffer());n.bindBuffer(34963,rt),n.bufferData(34963,ct,35040);let at=((t,e)=>{let o=t.createBuffer();t.bindBuffer(34962,o);let n=D(4e5);return P(5e4,t=>{n.set([-1,1,-1,-1,1,1,1,-1],8*t)}),t.bufferData(34962,n,35044),o})(n);n.bindBuffer(34962,at),n.vertexAttribPointer(0,2,5126,!1,0,0),n.enableVertexAttribArray(0);let lt=[0,0,0],ut=[0,0,0],ft=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],vt=[[-1,1],[-1,-1],[1,-1],[-1,1],[1,-1],[1,1]];return[(t,e,o)=>{if(!e)return void n.clear(16384);let{A:c,map:r,entities:s,K:l}=e,{size:u,It:m}=r,[w,b]=u,D=A(c._,c.v,[]),F=k(O(D,o,[]),c._);var E,I,K,J;E=lt,I=l,K=v(1,.005*t),(J=J||E)[0]=p(E[0],I[0],K),J[1]=p(E[1],I[1],K),J[2]=p(E[2],I[2],K);let tt=0;let et=(t,e,o,n)=>{let c=54*tt;let r=e;if(o)for(let t=0;t<o.length;t++)r+=o[t]*(t==o.length-1?1:x[e].dimensions[t+1]);for(let e=0;e<6;e++){let o=c+9*e;q[o++]=vt[e][0],q[o++]=vt[e][1],q[o++]=t[0],q[o++]=t[1],q[o++]=t[2],q[o++]=r,q[o++]=0,q[o++]=0,q[o++]=n||0}tt++};et(F,12);for(let t=0;t<b;t++)for(let e=0;e<w;e++){let o=2*(t*w+e),n=m[o],c=m[o+1];if(!(d(lt[0]-e)>20||d(lt[1]-t)>20)&&c>=0){let r=0;e>0&&t>0&&e<w-1&&t<b-1&&(r=y(0,v(m[o-1],v(m[o+3],v(m[o+2*w+1],m[o-2*w+1])))-1)),r=y(r,c-20);for(let o=r;o<c+1;o++){let r=o===c?n:10==n?n+1:0;ft[2][0]=e+.5,ft[2][1]=t+.5,ft[2][2]=o+.5,et(ft[2],r,0,-.05)}}}let ot=(t,e,o,n,c,r)=>{k(t._,c=c||ut,ft[3]),et(ft[3],e,n&&n.map((t,e)=>R(i(t),0,o[e]-1)),r)};for(let t of s){let e=[()=>et(t._,15,[t.pt,t.frame]),()=>et(t._,31,[i((t.angle+.5/ne[0])%1*ne[0])],.2),()=>et(t.anchor,49,[t.ht,R(i(t._[0]*ce[1]),0,ce[1]-1)],.07),()=>et(t._,65,[(1-t.Ct[0])/2%re[0]],.09),,()=>et(t._,14,0,1),()=>ot(t,67,ie,[0,t.g*ie[1]]),,()=>ot(t,73,se,[0,t.angle*ie[1]]),()=>t.j&&t.j.forEach(e=>e&&et([e[0],e[1],t._[2]+.4*a(9*t.D)],78,0,.5)),()=>t.W.forEach(t=>{t&&et(t._,13)}),()=>P(4,e=>ot(t,80,le,[(1.1*t.t-.05*e)*le[0]],[2.25*e,0,0],.5)),()=>ot(t,88,ue,[t.t*ue[0]],0,.5)][t.type];e&&e()}let ct=(t,e)=>V([e[0],0,0,0,0,e[1],0,0,0,0,e[2],0,0,0,0,1],V(t,[1,0,0,0,0,0,1,0,0,1,0,0,-lt[0],-lt[2],-lt[1],1]));n.bindBuffer(34962,Q),n.bufferSubData(34962,0,q);let rt=(t,e,o,c,r)=>{n.uniform1i(c.Xt,0),n.uniform1i(c.qt,1),n.activeTexture(33985),n.bindTexture(3553,r.Yt),n.activeTexture(33984),n.bindTexture(3553,r.Wt),n.clear(16640);for(let e=0;e<16;e++)G[e]=t[e];for(let t=0;t<3;t++)G[16+t]=lt[t],G[20+t]=e[t];G[19]=63,G[23]=0,n.bindBuffer(35345,o),n.bindBufferBase(35345,2,o),n.bindBuffer(35345,Z),n.bufferSubData(35345,0,G),n.enable(2929),n.drawArrays(4,0,6*tt),n.disable(2929)},st=[1/9,T[0]/(9*T[1]),1/9],at=ct(f,[st[0]/1.5,st[1]/1.5,st[2]]),yt=ct(_,st);n.depthFunc(513),it(n,C,M.h),n.useProgram(z),rt(at,[st[0]/1.5,st[1]/1.5,st[2]],nt,L,B),it(n,T,g.h),n.clear(16640),n.useProgram(z),rt(yt,st,j,L,h),it(n,T,null),n.clear(16384),n.useProgram(U),n.uniform1i(S,0),n.uniform1i(H,1),n.uniform1i(N,2),n.uniform2fv(X,T),n.uniformMatrix4fv(W,!1,yt),n.uniformMatrix4fv(Y,!1,at),n.activeTexture(n.TEXTURE2),n.bindTexture(3553,$),n.activeTexture(n.TEXTURE1),n.bindTexture(3553,g.M),n.activeTexture(n.TEXTURE0),n.bindTexture(3553,M.M),n.drawArrays(5,0,4)}]})())});</script>
