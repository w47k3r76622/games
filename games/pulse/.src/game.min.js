"use strict";function GO(t){t.ctx=null,t.listeners=[]}function Boid(t,e){this.x=10*Math.random()+(0==parseInt(2*Math.random())?t.width-10:0),this.y=10*Math.random()+(0==parseInt(2*Math.random())?t.height-10:0),this.type=e||"normal",this.radius=6,this.speed="normal"==this.type?1.5*Math.random()+.5:2.2,this.radialSpeed=Math.PI/60,this.vision=50,this.heading=2*Math.random()*Math.PI-Math.PI}function Swarm(t){this.width=t&&t.width||400,this.height=t&&t.height||400,this.boids=[],this.padding=18}function Particle(){this.scale=1,this.x=0,this.y=0,this.radius=20,this.color="#000",this.velocityX=0,this.velocityY=0,this.scaleSpeed=.5,this.update=function(t){t=1e3*t,this.scale-=this.scaleSpeed*t/1e3,this.scale<=0&&(this.scale=0),this.x+=this.velocityX*t/1e3,this.y+=this.velocityY*t/1e3},this.render=function(t){t.save(),t.translate(this.x,this.y),t.scale(this.scale,this.scale),t.beginPath(),t.arc(0,0,this.radius,0,2*Math.PI,!0),t.closePath(),t.fillStyle=this.color,t.fill(),t.restore()}}function randomFloat(t,e){return t+Math.random()*(e-t)}function Explosion(t){this.particles=[],this.x=t&&t.x||0,this.y=t&&t.y||0,this.color=t&&t.color||"#ffffff";for(var e=10,i=30,n=10,s=60,a=200,o=1,r=4,h=0;h<360;h+=Math.round(360/n)){var l=new Particle;l.x=this.x,l.y=this.y,l.radius=randomFloat(e,i),l.color=this.color,l.scaleSpeed=randomFloat(o,r);var d=2*randomFloat(s,a);l.velocityX=d*Math.cos(h*Math.PI/180),l.velocityY=d*Math.sin(h*Math.PI/180),this.particles.push(l),this.update=function(t){for(var e=0;e<this.particles.length;e++){var i=this.particles[e];i.update(t)}},this.render=function(t){t=this.ctx;for(var e=0;e<this.particles.length;e++){var i=this.particles[e];i.render(t)}}}}function T(t){GO(this),this.x=t.x||0,this.y=t.y||0,this.text=t.text||"No text",this.align=t.align||"center",this.font=t.font||'bold 24px "pulse"',this.fillStyle=t.fillStyle||"rgba("+$palette[7]+",1)",this.bounds={};var e=this;this.addListener("render",function(){var t=e.ctx;t.fillStyle=e.fillStyle,t.font=e.font,t.textAlign=e.align,e.bounds=t.measureText(e.text),t.fillText(e.text,e.x,e.y)})}function Player(t){this.position={x:t&&t.x||0,y:t&&t.y||0},this.dimension={w:32,h:32},this.velocity=5,this.timer=0,this.moveTo={x:0,y:0},this.angle=0,this.lives=3,this.kills=0,this.hitGlitch=!1,this.idle=!1,this.empState=0,this.empTimer=-1,this.explosionTimer=0,this.spawning=!1,this.moving=!1,this.colliding=!1,this.dying=!1,this.diePreCallback=function(){},this.diePostCallback=function(){},this.canMove=!1,this.isMouseDown=!1,this.explosionCallback=null,this.emp={x:this.x,y:this.y,radius:0,pX:this.x,pY:this.y,pRadius:0},this.collisions=[];var e=this;this.checkCollisions=function(){if(e.colliding=!1,0===e.empState||1===e.empState||3===e.empState)for(var t=0;t<e.collisions.length;t++){var i=e.collisions[t];if("player"===i.type){var n={radius:i.obj.radius,x:i.obj.x,y:i.obj.y},s={radius:e.emp.radius>e.dimension.w?e.emp.radius:e.dimension.w,x:e.position.x,y:e.position.y},a=n.x-s.x,o=n.y-s.y,r=Math.sqrt(a*a+o*o);r<n.radius+s.radius&&(e.colliding=!0,i.callback(i.obj,e))}}};"ontouchstart"in document;t.demo||($.addEventListener("touchstart",function(t){0===e.empState&&e.armEMP(),e.canMove=!0,e.move(t.clientX,t.clientY)}),$.addEventListener("touchend",function(t){e.canMove=!1,1===e.empState&&e.empTimer>.5?e.releaseEMP():1===e.empState&&e.empTimer<=.5&&(e.empState=0)}),$.addEventListener("touchmove",function(t){0==e.empState&&e.armEMP(),e.canMove=!0,e.move(t.clientX,t.clientY)}),$.addEventListener("mousedown",function(t){e.isMouseDown=!0,0==e.empState&&e.armEMP(),e.canMove=!0,e.move(t.offsetX,t.offsetY)}),$.addEventListener("mouseup",function(t){e.isMouseDown=!1,e.canMove=!1,1==e.empState&&e.releaseEMP()}),$.addEventListener("mousemove",function(t){e.isMouseDown=!0,e.isMouseDown&&(e.canMove=!0),e.move(t.offsetX,t.offsetY)}))}function Scene(){GO(this),this.entities=[],this.parent=null;var t=this;this.addListener("update",function(e){t.entities.forEach(function(t){t.update(e)})}),this.addListener("render",function(){t.entities.forEach(function(t){t.render()})})}function Game(t){function e(t,e){i.eventListeners.forEach(function(i){i.type===t&&i.callback(e)})}this.width=t.canvas.width=t.width||640,this.height=t.canvas.height=t.height||480,this.ctx=t.canvas.getContext("2d")||null,this.scenes=[],this.dt=0,this.t=0,this.lastDelta=Date.now(),this.activeScene=-1,this.interval=null,this.stopped=!0,this.mobile="ontouchstart"in document,this.requestedFullScreen=!1,this.eventListeners=[];var i=this;this.mobile?(t.canvas.addEventListener("touchstart",function(t){if(MOBILE){var i=document.documentElement;this.requestedFullScreen||(i.requestFullscreen?i.requestFullscreen():i.mozRequestFullScreen?i.mozRequestFullScreen():i.webkitRequestFullscreen?i.webkitRequestFullscreen():i.msRequestFullscreen&&i.msRequestFullscreen())}e("touchstart",t.touches[0]),t.preventDefault()},!1),t.canvas.addEventListener("touchend",function(t){e("touchend",t.touches[0]),t.preventDefault()},!1),t.canvas.addEventListener("touchmove",function(t){e("touchmove",t.touches[0]),t.preventDefault()},!1)):(t.canvas.addEventListener("mousedown",function(t){e("mousedown",t),console.log(t),t.preventDefault()},!1),t.canvas.addEventListener("mouseup",function(t){e("mouseup",t),t.preventDefault()},!1),t.canvas.addEventListener("mousemove",function(t){e("mousemove",t),t.preventDefault()},!1))}GO.prototype.render=function(t){this.listeners&&this.listeners.forEach(function(e){"render"==e.type&&e.callback(t)})},GO.prototype.update=function(t){this.listeners&&this.listeners.forEach(function(e){"update"==e.type&&e.callback(t)})},GO.prototype.addListener=function(t,e){this.listeners||(this.listeners=[]),this.listeners.push({type:t,callback:e})},GO.prototype.triggerListeners=function(t,e){this.listeners||(this.listeners=[]),this.listeners.forEach(function(i){i.type==t&&i.callback(e)})},Boid.prototype.draw=function(t){var e=2.5*this.radius;t.fillStyle="rgba("+$palette[4]+",1)","alt"==this.type&&(t.fillStyle="rgba("+$palette[9]+",1)"),t.beginPath(),t.arc(this.x,this.y,this.radius,0,2*Math.PI),t.fill(),t.beginPath(),t.moveTo(this.x+Math.cos(this.heading+Math.PI/2)*this.radius,this.y+Math.sin(this.heading+Math.PI/2)*this.radius),t.lineTo(this.x+Math.cos(this.heading+Math.PI)*e,this.y+Math.sin(this.heading+Math.PI)*e),t.lineTo(this.x+Math.cos(this.heading-Math.PI/2)*this.radius,this.y+Math.sin(this.heading-Math.PI/2)*this.radius),t.fill()},Boid.prototype.distance=function(t,e,i){var n=Math.min(this.x,t.x),s=Math.max(this.x,t.x),a=Math.min(this.y,t.y),o=Math.max(this.y,t.y),r=Math.min(s-n,n+e-s),h=Math.min(o-a,a+i-o);return Math.sqrt(r*r+h*h)},Boid.prototype.getNeighbors=function(t){for(var e=t.width,i=t.height,n=[],s=0;s<t.boids.length;s++){var a=t.boids[s];this!==a&&this.distance(a,e,i)<this.vision&&n.push(a)}return n},Boid.wrap=function(t){var e,i;if(2===arguments.length)e=0,i=arguments[1];else{if(3!==arguments.length)throw new Error("wrong number of arguments");e=arguments[1],i=arguments[2]}for(;t>=i;)t-=i-e;for(;t<e;)t+=i-e;return t},Boid.clamp=function(t,e){return Math.min(e,Math.max(-e,t))},Boid.meanAngle=function(){for(var t=0,e=0,i=arguments.length,n=0;n<i;n++)t+=Math.cos(arguments[n]),e+=Math.sin(arguments[n]);return Math.atan2(e/i,t/i)},Boid.prototype.step=function(t){var e=t.width,i=t.height,n=this.getNeighbors(t);if(n.length>0){for(var s=0,a=0,o=0,r=0,h=2*this.radius,l=null,d=0;d<n.length;d++){var m=n[d];s+=Math.cos(m.heading),a+=Math.sin(m.heading),o+=m.x,r+=m.y;var p=this.distance(m,e,i);p<h&&(h=p,l=m)}s/=n.length,a/=n.length,o/=n.length,r/=n.length;var c;if(l)c=Math.atan2(this.y-l.y,this.x-l.x);else{var u=Math.atan2(a,s),g=Math.atan2(r-this.y,o-this.x);c=Boid.meanAngle(u,u,u,g)}var f=Boid.wrap(c-this.heading,-Math.PI,Math.PI);f=Boid.clamp(f,this.radialSpeed),this.heading=Boid.wrap(this.heading+f,-Math.PI,Math.PI)}this.move(t)},Boid.prototype.move=function(t){var e=t.padding,i=t.width,n=t.height;this.x=Boid.wrap(this.x+Math.cos(this.heading)*this.speed,-e,i+2*e),this.y=Boid.wrap(this.y+Math.sin(this.heading)*this.speed,-e,n+2*e)},Swarm.prototype.createBoid=function(t,e){for(var i=[],n=0;n<(t||1);n++){var s=new Boid(this,e);s.parent=this,this.boids.push(s),i.push(s)}return i},Swarm.prototype.clear=function(){this.boids=[]},Swarm.prototype.update=function(t){for(var e=0;e<this.boids.length;e++)this.boids[e].step(this)},Swarm.prototype.render=function(){for(var t=0;t<this.boids.length;t++)this.boids[t].draw(this.ctx)},T.prototype=Object.create(GO.prototype),T.prototype.constructor=T,Player.prototype.update=function(t){if(this.spawning||this.checkCollisions(),this.moving){var e=this.moveTo.x-this.position.x,i=this.moveTo.y-this.position.y,n=Math.sqrt(e*e+i*i);n>1?(this.position.x+=e*(t*this.velocity),this.position.y+=i*(t*this.velocity)):this.moving=!1,this.angle=Math.atan2(i,e)*(180/Math.PI)}this.spawning&&this.timer>2&&(this.spawning=!1),this.dying&&this.timer>1&&(this.dying=!1,this.timer=0,this.diePostCallback(this),this.spawn()),1===this.empState&&(this.empTimer+=t,this.emp.radius=32+50*this.empTimer),2===this.empState&&(this.empTimer+=t,this.empTimer>1&&this.explodeEMP()),3===this.empState&&(this.explosionTimer=0,this.empState=0,this.empTimer=0),this.explosionTimer>=0&&(this.explosionTimer+=t,this.explosionTimer>=1&&(this.explosionTimer=-1)),this.timer+=t},Player.prototype.render=function(){var t=this.ctx;if(this.idle)return!1;if(DEBUG&&(t.textAlign="left",t.fillStyle="white",t.font='bold 12px "pulse"',t.fillText("STATE "+this.empState,1,t.canvas.height-20),t.fillText("TIMER "+this.empTimer,100,t.canvas.height-20)),1==this.empState){t.beginPath(),t.arc(this.position.x,this.position.y,this.emp.radius,0,2*Math.PI),t.fillStyle="rgba("+$palette[2]+",0.8)",t.fill(),t.globalCompositeOperation="overlay";for(var e=0;e<10;e++){t.beginPath(),t.strokeStyle="rgba("+$palette[3]+",0.8)",t.lineWidth=10;var i=this.emp.radius-Math.random()*this.emp.radius;t.arc(this.position.x,this.position.y,i,i/2,i/2+Math.PI),t.stroke()}t.globalCompositeOperation="source-over"}2==this.empState&&(t.beginPath(),t.arc(this.position.x,this.position.y,this.emp.radius,0,2*Math.PI),t.fillStyle=parseInt(10*this.empTimer)%2==0?"rgba("+$palette[1]+",0.8)":"rgba("+$palette[1]+",0.4)",t.fill()),this.explosionTimer>=0&&(t.beginPath(),t.arc(this.emp.pX,this.emp.pY,this.emp.pRadius,0,2*Math.PI),t.fillStyle="rgba(255,255,255,"+(1-this.explosionTimer)+")",t.fill(),t.beginPath(),t.arc(this.emp.pX,this.emp.pY,this.emp.pRadius+60*this.explosionTimer,0,2*Math.PI),t.lineWidth=5,t.strokeStyle="rgba(255,255,255,"+(1-this.explosionTimer)+")",t.stroke()),this.dying||(this.spawning&&(t.globalAlpha=parseInt(10*this.timer)%2==0?1:.5),t.beginPath(),t.arc(this.position.x,this.position.y,this.dimension.w,0,2*Math.PI),t.fillStyle="rgba("+$palette[1]+",1)",t.fill(),t.save(),t.translate(this.position.x,this.position.y),t.rotate(this.angle*Math.PI/180),t.rotate(this.timer*(1==this.empState?400:200)*Math.PI/180),t.translate(-this.dimension.w/2,-this.dimension.h/2),t.fillStyle="rgba(255,255,255,0.5)",t.beginPath(),t.rect(0,0,this.dimension.w,this.dimension.h),t.fill(),t.restore(),t.globalAlpha=1)},Player.prototype.move=function(t,e){this.canMove&&(this.moveTo.x=t,this.moveTo.y=e,this.moving=!0)},Player.prototype.setIdle=function(){this.idle=!0},Player.prototype.spawn=function(){this.timer=0,this.spawning=!0,this.empState=0},Player.prototype.die=function(t,e){var i=new Explosion({x:this.position.x,y:this.position.y,color:"rgba("+$palette[5]+",1)"}),n=new Explosion({x:this.position.x,y:this.position.y,color:"rgba("+$palette[6]+",1)"});this.parent.addEntity(i),this.parent.addEntity(n),this.emp.radius=0,this.lives--,this.timer=0,this.dying=!0,this.diePostCallback=e,this.empState=-1,t(this)},Player.prototype.armEMP=function(){this.emp.radius=0,this.empTimer=0,this.empState=1},Player.prototype.releaseEMP=function(){this.empState=2,this.empTimer=0},Player.prototype.explodeEMP=function(){var t=this;this.collisions.forEach(function(e){if("explosion"===e.type){var i=e.obj.radius,n=t.emp.radius,s=e.obj.x,a=e.obj.y,o=t.position.x,r=t.position.y,h=i+n,l=s-o,d=a-r;h>Math.sqrt(l*l+d*d)&&e.callback(e.obj,t)}}),this.explosionCallback&&this.explosionCallback(this),this.emp.pX=this.position.x,this.emp.pY=this.position.y,this.emp.pRadius=this.emp.radius,this.emp.radius=0,this.empState=3,this.empTimer=0,this.kills=0},Player.prototype.addCollisionTest=function(t,e,i){this.collisions.push({obj:t,type:e,callback:i})},Scene.prototype=Object.create(GO.prototype),Scene.prototype.constructor=Scene,Scene.prototype.addEntity=function(t,e){t.ctx=this.ctx,t.parent=this,this.entities.push(t)},Scene.prototype.init=function(){this.triggerListeners("init")},Scene.prototype.clear=function(){this.entities=[]},Game.prototype.update=function(t){this.t+=t,this.activeScene>=0&&this.scenes[this.activeScene].update(t)},Game.prototype.render=function(t){this.activeScene>=0&&this.scenes[this.activeScene].render(this.ctx)},Game.prototype.run=function(){function t(){var i=Date.now();e.dt=(i-e.lastDelta)/1e3,e.ctx.clearRect(0,0,e.width,e.height),e.update(e.dt),e.render(),DEBUG&&(e.ctx.textAlign="left",e.ctx.fillStyle="white",e.ctx.font='bold 12px "pulse"',e.ctx.fillText("TIME "+Math.round(100*e.t)/100,1,e.height-1),e.ctx.fillText("DELTA "+e.dt,100,e.height-1)),e.lastDelta=i,e.stopped||window.requestAnimFrame(t)}var e=this;this.stopped=!1,t()},Game.prototype.stop=function(){this.stopped=!0,window.clearInterval(this.interval)},Game.prototype.resume=function(){this.stopped=!1,this.lastDelta=Date.now()},Game.prototype.addScene=function(t){t.parent=this,t.ctx=this.ctx,this.scenes.push(t)},Game.prototype.setActiveScene=function(t,e){this.scenes[t].clear(),this.scenes[t].init(),this.activeScene=t},Game.prototype.addEventListener=function(t,e){var i={type:t,callback:e};return this.eventListeners.push(i),i},Game.prototype.removeEventListener=function(t){this.ctx.canvas.removeEventListener(t.type,t.callback),this.eventListeners.splice(this.eventListeners.indexOf(t),1)},window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}();var menu=new Scene;menu.addListener("init",function(){function t(){var t=menu.entities[0];t.spawn(),$.setActiveScene(1),$.removeEventListener(e),$.removeEventListener(i)}menu.timer=0;var e=$.addEventListener("touchstart",t),i=$.addEventListener("mousedown",t),n=new Player({x:game.parent.width/2,y:game.parent.height/2,demo:!0});menu.addEntity(n),menu.swarm=new Swarm({width:menu.parent.width,height:menu.parent.height}),menu.swarm.createBoid(1,"alt"),menu.addEntity(menu.swarm),menu.introTexts=[{queue:[1,3],text:"HOW TO PLAY..."},{queue:[4,6],text:"TOUCH TO MOVE"},{queue:[6,8],text:"AND TO ARM THE PULSE"},{queue:[9,13],text:"RELEASE TO TRIGGER IT!"},{queue:[14,18],text:"AFTER RELEASING THE PULSE"},{queue:[18,22],text:"PLACE YOURSELF ABOVE"},{queue:[22,26],text:"THE ENEMIES TO DESTROY THEM"},{queue:[28,34],text:"GOOD LUCK!"}]}),menu.addListener("render",function(t){var e=Math.abs(Math.cos(menu.timer))/2/3+.7;t.fillStyle="rgba("+$palette[7]+",1)",t.font='bold 16px "pulse"',t.textAlign="center",t.fillText("A GAME BY MARCO FERNANDES",$.width/2,30),t.fillText("twitter.com/marcoffernandes",$.width/2,45),t.save(),t.translate($.width/2,100),t.scale(e,e),t.shadowBlur=100,t.shadowColor="rgba("+$palette[3]+", 0.4)",t.fillStyle="rgba(255, 255, 255, 1)",t.textAlign="center",t.font='bold 120px "pulse"',t.fillText("PULSE",-2,38),t.fillText("PULSE",2,38),t.fillText("PULSE",-2,42),t.fillText("PULSE",2,42),t.fillStyle="rgb("+$palette[0]+")",t.font='bold 120px "pulse"',t.textAlign="center",t.fillText("PULSE",0,40),t.restore(),menu.introTexts.forEach(function(e){menu.timer>e.queue[0]&&menu.timer<e.queue[1]&&(t.fillStyle="rgba("+$palette[8]+",1)",t.font='bold 24px "pulse"',t.textAlign="center",t.fillText(e.text,menu.parent.width/2,menu.parent.height/2+80))}),t.fillStyle="rgba("+$palette[7]+",1)",t.font='bold 16px "pulse"',t.textAlign="center",t.fillText("WATCH OUT FOR THE GLITCH",$.width/2,$.height/2+120),t.fillText("IT IS FRIENDLY",$.width/2,$.height/2+135),t.fillText("BUT MESSES WITH YOUR PULSE SCORE",$.width/2,$.height/2+150),t.fillText("WHEN HITTING IT",$.width/2,$.height/2+165),t.fillStyle="rgba("+$palette[8]+",1)",t.font='bold 24px "pulse"',t.textAlign="center",t.fillText("TOUCH TO START",$.width/2,$.height-20)}),menu.addListener("update",function(t){menu.timer+=2*t,menu.swarm.boids[0].x=menu.parent.width/2+130,menu.swarm.boids[0].y=menu.parent.height/2+115;var e=menu.entities[0];e.canMove=!0,menu.timer>4&&menu.timer<5&&e.move(game.parent.width/2-50,game.parent.height/2-20),menu.timer>5&&menu.timer<6&&e.move(game.parent.width/2+50,game.parent.height/2-20),menu.timer>6&&menu.timer<7&&e.move(game.parent.width/2,game.parent.height/2),menu.timer>5&&menu.timer<6&&0===e.empState&&e.armEMP(),menu.timer>9&&menu.timer<10&&1===e.empState&&e.releaseEMP(),menu.timer>35&&(menu.timer=0)});var game=new Scene;game.addStats=function(){game.stats={date:Date.now(),score:game.score,pulses:game.pulsesCount,kills:game.kills,maxKills:game.maxKills,maxScore:game.maxScore,startTime:game.startTime,endTime:game.endTime};var t=window.localStorage.getItem("stats"),e=[];t&&(e=JSON.parse(t)),e.push(game.stats),window.localStorage.setItem("stats",JSON.stringify(e))},game.getHiScore=function(){var t=window.localStorage.getItem("stats"),e=0;if(t){var i=JSON.parse(t);i.forEach(function(t){t.score>e&&(e=t.score)})}return e},game.addListener("init",function(){function t(t){"alt"!=t.type&&i.die(function(t){if(t.lives<=0){game.gameOver=!0,game.timer=0;var e=game.getHiScore(),i=game.score>e,n=new T({x:game.parent.width/2,y:game.parent.height/2-140,font:'48px "pulse"',text:"GAME OVER!"});game.addEntity(n),game.endTime=Date.now(),game.addStats();var s=new T({x:game.parent.width/2,y:game.parent.height/2-90,font:'36px "pulse"',text:"SCORE: "+game.score});game.addEntity(s);var a=new T({x:game.parent.width/2,y:game.parent.height/2-70,font:'14px "pulse"',fillStyle:"rgba("+$palette[8]+",1)",text:"★ NEW HI-SCORE ★"});i||(a.text="HI-SCORE: "+e),game.addEntity(a);var o=new T({x:game.parent.width/2,y:game.parent.height/2-30,font:'24px "pulse"',text:"Pulses: "+game.stats.pulses});game.addEntity(o);var r=new T({x:game.parent.width/2,y:game.parent.height/2,font:'24px "pulse"',text:"Kills: "+game.stats.kills});game.addEntity(r);var h=new T({x:game.parent.width/2,y:game.parent.height/2+40,font:'18px "pulse"',text:"In one pulse"});game.addEntity(h);var l=new T({x:game.parent.width/2,y:game.parent.height/2+60,font:'18px "pulse"',text:"Max Kills: "+game.stats.maxKills});game.addEntity(l);var d=new T({x:game.parent.width/2,y:game.parent.height/2+80,font:'18px "pulse"',text:"Max Score: "+game.stats.maxScore});game.addEntity(d)}},function(t){if(t.lives<=0){game.entities.splice(game.entities.indexOf(t),1);var e=function(){$.setActiveScene(0),$.removeEventListener(i),$.removeEventListener(n)},i=$.addEventListener("touchstart",e),n=$.addEventListener("mousedown",e);window.clearInterval(game.boidsCreationInterval)}})}game.timer=0,game.score=0,game.kills=0,game.maxKills=0,game.maxScore=0,game.addBoids=!1,game.boidsCounter=0,game.pulsesCount=0,game.startTime=Date.now(),game.endTime=null,game.stats=null,game.gameOver=!1,game.boidsCreationInterval=window.setInterval(function(){var e=10,n="normal";20==game.boidsCounter&&(e=1,n="alt");var s=game.entities[0].createBoid(e,n);s.forEach(function(e){i.addCollisionTest(e,"explosion",function(t,e){t.x=0,t.y=0,e.kills++,"alt"==t.type&&(e.hitGlitch=!0)}),i.addCollisionTest(e,"player",t)}),game.boidsCounter+=e,game.boidsCounter>(MOBILE?100:200)&&window.clearInterval(game.boidsCreationInterval)},5e3);var e=new Swarm({width:game.parent.width,height:game.parent.height});e.createBoid(20),game.addEntity(e);var i=new Player({x:game.parent.width/2,y:game.parent.height/2});i.explosionCallback=function(t){if(game.pulsesCount++,0!==t.kills){if(t.hitGlitch)return console.log("NO SCORE!"),void(t.hitGlitch=!1);var e=t.kills+Math.floor(Math.pow(t.kills/2,2));e=e<t.kills?t.kills:e,game.score+=e,game.kills+=t.kills,e>game.maxScore&&(game.maxScore=e),t.kills>game.maxKills&&(game.maxKills=t.kills),a.text="+"+e,a.fillStyle="rgba("+$palette[7]+",1)",t.kills>20&&(a.fillStyle="rgba("+$palette[8]+",1)"),t.kills>40&&(a.fillStyle="red"),a.start()}},e.boids.forEach(function(e){i.addCollisionTest(e,"explosion",function(t,e){t.x=0,t.y=0,e.kills++,"alt"==t.type&&(e.hitGlitch=!0,console.log("HIT!"))}),i.addCollisionTest(e,"player",t)}),game.addListener("update",function(t){game.timer+=t}),game.addEntity(i);var n=new T({x:game.parent.width/2,y:60,font:'36px "pulse"',text:game.score});n.addListener("update",function(t){n.text=game.score,game.gameOver&&n.y>-20&&(n.y-=200*t)}),game.addEntity(n);var s=new T({x:game.parent.width/2,y:30,font:'24px "pulse"',fillStyle:"red",text:"♥♥♥"});s.addListener("update",function(t){s.text="♥♥♥".substring(0,i.lives)}),game.addEntity(s);var a=new T({x:game.parent.width/2,y:80,font:'36px "pulse"',text:""});a.timer=0,a.listeners=[],a.addListener("update",function(t){if(a.show){a.timer+=t/2;var e=$.width/2-a.x,i=40-a.y,n=Math.sqrt(e*e+i*i);n>1&&(a.x+=e*(2*t),a.y+=i*(2*t)),a.timer>1&&(a.show=!1)}}),a.addListener("render",function(t){if(a.show){var t=a.ctx;t.globalAlpha=1-a.timer,t.fillStyle=a.fillStyle,t.font=a.font,t.textAlign=a.align,a.bounds=t.measureText(a.text),t.fillText(a.text,a.x,a.y),t.globalAlpha=1}}),a.start=function(){a.show=!0,a.timer=0,a.x=i.position.x,a.y=i.position.y},game.addEntity(a)});var MOBILE="ontouchstart"in document,WIDTH=window.innerWidth<window.innerHeight&&window.innerWidth>420?420:window.innerWidth>window.innerHeight&&window.innerWidth>767?768:window.innerWidth,HEIGHT=window.innerHeight<window.innerWidth&&window.innerHeight>420?420:window.innerHeight>window.innerWidth&&window.innerHeight>767?768:window.innerHeight;window.innerHeight>768&&(WIDTH=420,HEIGHT=768);var $,DEBUG=!1,$palette=["78,57,93","142,190,148","142,190,148","204,252,142","220,91,62","130,112,133","204,252,142","130,112,133","193,184,194","142,190,148"];window.addEventListener("load",function(){$=new Game({canvas:document.getElementById("canvas"),width:WIDTH,height:HEIGHT}),document.getElementById("canvas").style.display="block",document.getElementById("loading").style.display="none",$.addScene(menu),$.addScene(game),$.setActiveScene(0),$.run()}),window.addEventListener("resize",function(){WIDTH=window.innerWidth<window.innerHeight&&window.innerWidth>420?420:window.innerWidth>window.innerHeight&&window.innerWidth>767?768:window.innerWidth,HEIGHT=window.innerHeight<window.innerWidth&&window.innerHeight>420?420:window.innerHeight>window.innerWidth&&window.innerHeight>767?768:window.innerHeight,$.width=WIDTH,$.height=HEIGHT,$.ctx.canvas.width=WIDTH,$.ctx.canvas.height=HEIGHT});