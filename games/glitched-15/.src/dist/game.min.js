function Tile(t,e,o,n,r,i){"use strict";this.ctx=t,this.n=e,this.x=o,this.y=n,this.s=r,this.r=i,this.c="#193441";var a=Math.round(r/2);this.font="700 "+a+"px fantasy",this.moves={right:["x",1],left:["x",-1],up:["y",-1],down:["y",1]}}function Game(){function t(){var t=Object.keys(n);return t.every(function(t){if("0"===t)return!0;var o=e(+t-1);return o.col===n[t].col&&o.row===n[t].row})}function e(t){return{col:t%4,row:Math.floor(t/4)}}function o(t,e,o){function n(){return Math.random()-.5}function r(t,e,o,n,r,i){for(r=0,e=1,n=t.length-1;e<n;e++)for(o=e-1;o>=0;o--)t[o]>t[e]&&r++;return i=r%2,!i}return t=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],e=t.sort(n).concat(0),r(e)||(o=e[0],e[0]=e[1],e[1]=o),e}var n;this.init=function(){this.numbers=o(),n={},this.numbers.forEach(function(t,o){n[t]=e(o)}),this.tiles=n},this.move=function(e,o){var r,i,a=n[0],c=Object.keys(n),s=[],l=0,u=0;if("up"===e){if(3===a.row)return;for(;l<16;l++)if(r=n[c[l]],r.col===a.col&&r.row>a.row)if(o)r.row-=1,u+=1,s.push(c[l]);else if(r.row===a.row+1){r.row-=1,u+=1,s.push(c[l]);break}a.row+=u}else if("down"===e){if(0===a.row)return;for(;l<16;l++)if(r=n[c[l]],r.col===a.col&&r.row<a.row)if(o)r.row+=1,u-=1,s.push(c[l]);else if(r.row===a.row-1){r.row+=1,u-=1,s.push(c[l]);break}a.row+=u}else if("left"===e){if(3===a.col)return;for(;l<16;l++)if(r=n[c[l]],r.row===a.row&&r.col>a.col)if(o)r.col-=1,u+=1,s.push(c[l]);else if(r.col===a.col+1){r.col-=1,u+=1,s.push(c[l]);break}a.col+=u}else if("right"===e){if(0===a.col)return;for(;l<16;l++)if(r=n[c[l]],r.row===a.row&&r.col<a.col)if(o)r.col+=1,u-=1,s.push(c[l]);else if(r.col===a.col-1){r.col+=1,u-=1,s.push(c[l]);break}a.col+=u}return i=t(),{move:e,arr:s,completed:i}},this.checkLine=function(t){return n[t].col===n[0].col||n[t].row===n[0].row},this.checkState=function(e){var o,r,i=n[0],a=[],c=Object.keys(n);if(n[e].col===i.col)r=i.row-n[e].row,o=r>0?"down":"up",c.forEach(function(t){+t&&n[t].col===i.col&&("down"===o?n[t].row>=n[e].row&&n[t].row<i.row&&(n[t].row+=1,a.push(t)):n[t].row<=n[e].row&&n[t].row>i.row&&(n[t].row-=1,a.push(t)))}),i.row-=r;else{if(n[e].row!==i.row)return;r=i.col-n[e].col,o=r>0?"right":"left",c.forEach(function(t){+t&&n[t].row===i.row&&("right"===o?n[t].col>=n[e].col&&n[t].col<i.col&&(n[t].col+=1,a.push(t)):n[t].col<=n[e].col&&n[t].col>i.col&&(n[t].col-=1,a.push(t)))}),i.col-=r}var s=t();return{move:o,arr:a,completed:s}}}function Glitch(t,e){function o(e){t.clearRect(0,0,r,r),t.save(),t.translate(i,i),t.rotate(e),t.drawImage(a,-i,-i),t.restore()}function n(t,e){function n(){i+=t,Math.abs(i)>=r?(cancelAnimationFrame(a),o(0),e()):(o(i),a=requestAnimationFrame(n))}var r=2*Math.PI,i=0,a=requestAnimationFrame(n)}var r=e.size,i=r/2,a=document.createElement("canvas"),c=a.getContext("2d");a.width=a.height=r,this.draw=function(e){var o=t.getImageData(0,0,r,r),i=Math.random()>.5?1:-1,a=i*(.2+.3*Math.random());c.putImageData(o,0,0),n(a,e)}}function Props(){var t=.85*Math.min(window.innerWidth,window.innerHeight),e=450*window.devicePixelRatio;t=t<=e?t:e,this.gap=Math.round(t/45),this.size=45*this.gap,this.marginLeft=Math.round((window.innerWidth-this.size)/2),this.marginTop=Math.round((window.innerHeight-this.size)/2),this.tile=10*this.gap}function Timer(t,e){function o(t){var e=parseInt(t/1e3%60),o=parseInt(t/6e4%60),n=parseInt(t/36e5%24);return n=n<10?"0"+n:n,o=o<10?"0"+o:o,e=e<10?"0"+e:e,n+":"+o+":"+e}var n,r,i=e.size/2;this.stopped=!1,this.start=function(){this.stopped=!1,n=Date.now()},this.stop=function(){this.stopped=!0;var t=Date.now();r=o(t-n)},this.draw=function(){var o=e.size/6;t.save(),t.globalAlpha=.8,t.fillStyle="#193441",t.fillRect(0,0,e.size,e.size),t.restore(),t.lineWidth=1,t.strokeStyle="#193441",t.font="700 "+o+"px fantasy",t.save(),t.globalCompositeOperation="destination-out",t.fillText(r,i,i),t.restore(),t.strokeText(r,i,i)}}Tile.prototype.draw=function(){var t=this;t.ctx.roundRect(t.x,t.y,t.s,t.s,t.r),t.ctx.fillStyle=t.c,t.ctx.fill(),t.ctx.font=t.font,t.ctx.strokeStyle="#91AA9D",t.ctx.lineWidth=1,t.ctx.strokeText(t.n,t.x+t.s/2,t.y+t.s/2)},Tile.prototype.update=function(t,e){var o=this.moves[t],n=o[0]+"_init";0===e?this[n]=this[o[0]]:this[o[0]]=this[n]+o[1]*(this.s+this.r)*e},function(){"use strict";function t(t,e){var o,n,r=[];return t.forEach(function(t,i){t&&(o=e.gap+i%4*(e.tile+e.gap),n=e.gap+Math.floor(i/4)*(e.tile+e.gap),r[i]=new Tile(b,t.toString(),o,n,e.tile,e.gap))}),r}function e(){b.clearRect(0,0,E.size,E.size),k.forEach(function(t){t.draw()}),L.stopped&&L.draw()}function o(){y.addEventListener("mouseleave",u,!1),y.addEventListener("click",f,!1),y.addEventListener("mousemove",d,!1),window.addEventListener("keyup",l,!1)}function n(){y.removeEventListener("mouseleave",u),y.removeEventListener("click",f),y.removeEventListener("mousemove",d),window.removeEventListener("keyup",l)}function r(){T.init(),L.start(),k=t(T.numbers,E),o(),e()}function i(){var t="none"===x.style.display;x.style.display=t?"table":"none"}function a(t,e){var o=T.move(t,e);o&&h(o)}function c(){E=new Props,y.width=y.height=E.size,b.textAlign="center",b.textBaseline="middle",y.style.marginLeft=E.marginLeft+"px",y.style.marginTop=E.marginTop+"px",T.numbers.forEach(function(t,e){var o,n,r=T.tiles[t];t&&(o=E.gap+r.col*(E.tile+E.gap),n=E.gap+r.row*(E.tile+E.gap),k[e]=new Tile(b,t.toString(),o,n,E.tile,E.gap))}),e()}function s(t){switch(t.keyCode){case 32:r();break;case 27:i()}}function l(t){switch(t.keyCode){case 87:a("up",!0);break;case 38:a("up");break;case 83:a("down",!0);break;case 40:a("down");break;case 68:a("right",!0);break;case 39:a("right");break;case 65:a("left",!0);break;case 37:a("left")}}function u(){for(var t=0;t<15;t++)k[t].c="#193441";y.style.cursor="auto",e()}function f(t){for(var e=m(y,t),o=0;o<15;o++)if(v(e,k[o])){var n=T.checkState(k[o].n);n&&h(n);break}}function h(t){function o(c){r=r||c;var s=(c-r)/i;s>=1?(n.forEach(function(e){e.update(t.move,1)}),cancelAnimationFrame(a),t.completed&&p(),e(),w()):(n.forEach(function(e){e.update(t.move,s),e.c="#193441"}),e(),a=requestAnimationFrame(o))}var n=[];k.forEach(function(e){t.arr.indexOf(e.n)!==-1&&n.push(e)});var r,i=160,a=requestAnimationFrame(o)}function w(){Math.random()>.9&&(n(),M.draw(o))}function p(){n();for(var t=0;t<15;t++)k[t].c="#FCFFF5";y.style.cursor="auto",L.stop()}function d(t){for(var o=m(y,t),n="auto",r=0;r<15;r++)v(o,k[r])&&T.checkLine(k[r].n)?(k[r].c="#3E606F",n="pointer"):k[r].c="#193441";y.style.cursor=n,e()}function m(t,e){var o=t.getBoundingClientRect();return{x:e.pageX-o.left,y:e.pageY-o.top}}function v(t,e){return g(t.x,e.x,e.x+e.s)&&g(t.y,e.y,e.y+e.s)}function g(t,e,o){return t>=Math.min(e,o)&&t<=Math.max(e,o)}CanvasRenderingContext2D.prototype.roundRect=function(t,e,o,n,r){return o<2*r&&(r=o/2),n<2*r&&(r=n/2),this.beginPath(),this.moveTo(t+r,e),this.arcTo(t+o,e,t+o,e+n,r),this.arcTo(t+o,e+n,t,e+n,r),this.arcTo(t,e+n,t,e,r),this.arcTo(t,e,t+o,e,r),this.closePath(),this};var y=document.querySelector("canvas"),x=document.querySelector(".help-outer");x.style.display="none";var k,b=y.getContext("2d"),E=new Props,T=new Game,L=new Timer(b,E),M=new Glitch(b,E);y.width=y.height=E.size,y.style.marginLeft=E.marginLeft+"px",y.style.marginTop=E.marginTop+"px",b.textAlign="center",b.textBaseline="middle",window.addEventListener("keyup",s,!1),window.addEventListener("resize",c,!1),r()}();
//# sourceMappingURL=game.min.js.map
