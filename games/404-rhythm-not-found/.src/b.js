!function(){var e,t=192,a=144,r="v00",s=e=>0,o=!0,i=(e=1,t=0)=>Math.random()*e+t,n=(e,t)=>~~i(t-e+1,e),c=(e,t)=>(e+t)%t,l=(e,t,a)=>Array.from({length:1+t-e},(t,r)=>a||e+r),d=e=>e[n(0,e.length-1)];zzfx=(...e)=>zzfxP(zzfxG(...e)),zzfxP=(...e)=>{let t=zzfxX.createBufferSource(),a=zzfxX.createBuffer(e.length,e[0].length,zzfxR);return e.map((e,t)=>a.getChannelData(t).set(e)),t.buffer=a,t.connect(zzfxX.destination),t.start(),t},zzfxG=(e=1,t=.05,a=220,r=0,s=0,o=.1,i=0,n=1,c=0,l=0,d=0,f=0,m=0,p=0,v=0,$=0,u=0,h=1,b=0,I=0)=>{let x,H,y=2*Math.PI,g=c*=500*y/zzfxR**2,z=(0<v?1:-1)*y/4,E=a*=(1+2*t*Math.random()-t)*y/zzfxR,k=[],M=0,P=0,w=0,U=1,C=0,S=0,T=0;for(r=99+zzfxR*r,b*=zzfxR,s*=zzfxR,o*=zzfxR,u*=zzfxR,l*=500*y/zzfxR**3,v*=y/zzfxR,d*=y/zzfxR,f*=zzfxR,m=zzfxR*m|0,H=r+b+s+o+u|0;w<H;k[w++]=T)++S%(100*$|0)||(T=i?1<i?2<i?3<i?Math.sin((M%y)**3):Math.max(Math.min(Math.tan(M),1),-1):1-(2*M/y%2+2)%2:1-4*Math.abs(Math.round(M/y)-M/y):Math.sin(M),T=(m?1-I+I*Math.sin(2*Math.PI*w/m):1)*(0<T?1:-1)*Math.abs(T)**n*e*zzfxV*(w<r?w/r:w<r+b?1-(w-r)/b*(1-h):w<r+b+s?h:w<H-u?(H-w-u)/o*h:0),T=u?T/2+(u>w?0:(w<H-u?1:(H-w)/u)*k[w-u|0]/2):T),x=(a+=c+=l)*Math.sin(P*v-z),M+=x-x*p*(1-1e9*(Math.sin(w)+1)%2),P+=x-x*p*(1-1e9*(Math.sin(w)**2+1)%2),U&&++U>f&&(a+=d,E+=d,U=0),!m||++C%m||(a=E,c=g,U=U||1);return k},zzfxV=.3,zzfxR=44100,zzfxX=new AudioContext,zzfxM=(e,t,a,r=125)=>{let s,o,i,n,c,l,d,f,m,p,v,$,u,h,b,I=0,x=[],H=[],y=[],g=0,z=0,E=1,k={},M=zzfxR/r*60>>2;for(;E;g++)x=[E=f=v=u=0],a.map((r,v)=>{for(d=t[r][g]||[0,0,0],E|=!!t[r][g],b=u+(t[r][0].length-2-!f)*M,h=v==a.length-1,o=2,n=u;o<d.length+h;f=++o){for(c=d[o],m=o==d.length+h-1&&h||p!=(d[0]||0)|c|0,i=0;i<M&&f;i++>M-99&&m?$+=($<1)/99:0)l=(1-$)*x[I++]/2||0,H[n]=(H[n]||0)-l*z+l,y[n]=(y[n++]||0)+l*z+l;c&&($=c%1,z=d[1]||0,(c|=0)&&(x=k[[p=d[I=0]||0,c]]=k[[p,c]]||(s=[...e[p]],s[2]*=2**((c-12)/12),c>0?zzfxG(...s):[])))}u=b});return[H,y]};for(var f={},m=(f={F:70,D:68,S:83,J:74,K:75,L:76,SPACE:32,ENTER:13,ESC:27},{}),p=Object.keys(f),v=0;v<p.length;v++){var $=p[v];m[f[$]]=1<<v}var u={b:-1,p:0,r:-1};document.onkeydown=document.onkeyup=e=>{var t=e.keyCode||e.which;m[t]&&!o&&(e.preventDefault(),!e.type[5]||0&m[t]||(2!=rt&&t==f.ENTER?pt():(Ie.checkInput(t),1==st&&Ie.tryBeat(t),2==st&&t==f.ENTER&&pt())),f[t]=!!e.type[5])};var h=[];for(v of')Ë¸\0\0\0\0\0\0\0\0\t\0\0\0\0\0\0\0\0\0I\0\0\t\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0Ûm\0\0\0\0I¤I\0\0\\\0\0\0\0\0\t\0\0\0?ÿÿ$I\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0¶í¶\0\0\0¥þ)­\0I\0\0\0\0\0\0H»m¶+~\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0·hÜ\0\0\0ý¶+-­\0i\0\0\t \0WmIºÛm:¥\0\0\0\0#I$I$H\0\0\0§BI\0\0\x006í¶9mm\0I\0z \0m>×9$6M\0$\0#-¶Ûm¶Ûm¶É\0\0\0\'2y\0\0\x006ïÉ+m\\\0\0\\\0õ u<Ó©ÖH¤6e\0%\0#/m¶Ûm¶Ûlé\0\vm\'CÏ\0\0\0*æ[;ì\\\0I\0´m*©ÆH¤M\0#\0#:I$I$I¶ÖÝ\'B\0\0\0>ââ+lb\0i\0µ$ì<Ó©ÆH¤\0]\0#\0#:\0\0éÍ½±\'2\0\0\0:âÔ$Û\\\0\0I\0Iµ>©ÖI$\0\0I\t#\t#;\0\0I;ki\'3Ï\0\0\0:âäm\\\0\0\t\0\0\0\0ý­8Ó©ÖH¤\0\0\tGcGc;\0\0é6ÒI\'2y\0\0\x006ê[mm\0\0\0\0\0­:©ÆI\0\0GSGS¶;\0\0I$\0\'BI\0\0\0&ìI\'l\0\0\0@:Ó±8ÓÇ9$\0\0FÓFÒI:\0\0é\0\0\0\'hÜ\0\0\0&ím4v\0\0I\0$mmIÚI\0\0IFÓFÒi:I$I$I\0\0\0$í¶\0\0\0ïî7mv\0\0q\0\t.Râ\0HÛm¶\0©FÓFÓM;m¶Ûm¶Ûlé\0\0\0I\0\0\06Úm\0\0u\0@ä\0\0\0;km\0nFÓ¶FÒi6ÛkvÛkvÛI\0\0\0\0I\0\0\0\0I¤I\0\0I\0@\0\0I\0\0\0$I\0\0IDÒIDÒII$I$H\0\0\0\0\0\0\0I\0\0\t\0\0\t\0H\0\0I\0H$I\0\0\0\0\0\0\0\0\0\0\0\0¶Ûm¶Ûm¶Ûm¶Ûm¶Ûm\0á\0\0Q\0\0yë\0ië¶Ûm$I$I\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0±\0\0i\0IÛi|IÛi6Û¶Ûm¶Ûm$I \0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0±\0H\0kl@k¶ÛmI)$¶Ú¶Ûi¤\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0q\0È\0H[I@[I¶Ûm¶Ûm¶ÛmII)¶\0\0\0\0\0\0\0\0\0\0\0\0\0\0H\0\0I\0©\0HÒij@Òi¶Ûm¶Ûm¶Ûm¶Û)²ZH\0\0\0\0\0\0\0\0\0\0\0\0ÈÀ\0H\0ir@Ó©\0@Ó©¶Ûm¶Ûm¶Ûm¶Û)²ÉI\0\0\0\0\0\0\0\0\0\0H\0ÈÀ|H\0ýiê@\0H\0\0\0\0H¶Ûm¶Ûm¶Ûm¶ÙMÛ)\0\0\0\0\0\0\0\0\0ÈÀÈÀm¹\0íqj@\0@@\0@¶I$Ûm¶Ûm¶×MvÛY\0\0\0\0\0\0\0H\0ÈÀÈÀm±\0«éÒ\0\0@@\0@$ÉRm¶Ûm¶×MvÛY\0\0\0\0\0\0ÈÀÈÀÈÀ$i\0q\0@\0@@\0@mI$ÆÍ¶Ûm¶×MvÛY\0\0\0\0H\0ÈÀÈÀ¨À*ÒIé@\0@@\0@$I$Y6Ûm¶×MVÛQ\0\0\0ÈÀÈÀÈÀ¨À?m±I\0\0@\0\0@$I$JFÛm¶×MVÛQ\0H\0ÈÀÈÀ¨À¨À;m±\0úi\0\0\0Ù\0\0\0@$I$I(Ûm¶ÕMVÛQÈÀÈÀÈÀ¨À¨À?í±\0\t\0\0\0\0Úi\0\0\0@$Ûm´I&m¶ÕMÛaÈÀ¨À¨À¨À¨ÀH\0\0\0\0\0\0\0\b\0\0\0\0\x006I&ÒI&m¶ÕMÛa¨À¨À¨À¨À¨À\0I$I\0\0I\0\0\t\t\0\0\0¤m¤I$Ãm¶ÕMÛa$I\0\0\0\0\0\0\0\0\0\0\0\0¯d)Ñ\0i\0I$~\0\0\0&Ö£VÉ$m¶Êk¶ÛY$I\0\0I$J(¢$\0ív?mi\0qýþ+¾\0\0\x005KoñÒy$m¶Êk¶ÛY$I\0\0I$I$Q$\0ívÛi\0I\'Ýµ;Rv\0\0\0®ÛnÛªM$m¶Êk¶ÛY$I\0\0(¢(¢$\0é­Ûä\0\0n6­Rm\0\0\0ÛnÛyM$¶Êj¶ÛQ$I\0\0I$I$I$\0í¬$K\0\0\t6Ûm\0I\0\0\0VÛvÛWI¤¶Êj¶ÛQ$I\0\0(¢$I$\0é«)É\0\0í\0k\0\0\0¶Ö¦ÚÚ©¤¶Êj¶ÛQ$I\0\0I$IDI$\0Û­?}I\0yZ\0\0\0¶ËkÖÛ)¤\r¶ºl¶Ûa$I\0\0(¢(¢(\0Úi+ìWSñ\0\0u+ï\\\0\0\0µ_µVÚé¤\r¶ºl¶Ûa$I\0\0i6Ûm¶Ûi5\0\0\0I?l~\0Õ©\0\nM?mK\0\0\0µÝõÚ©¤\r¶ºl¶Ûa$I\0\0­»m¶Ûmµ´\0\0M+ìI\0ýµ\0ñ;lM\0\0\0¶]½vÛ)¤Í¶ºk¶ÛY$I\0\0n¹-²[,µÕ\0\0\0I?}©\0Ív\01\0\0\0·+j¶Úé¤ÍµÓ]¶ÛY$I\0\0¹eË,µ¤\0\0m6Ûi\0×­\0ñ\0\0\0\0\0»g¶ÕI¤ÍµS]¶ÛY$I\0\0n¹e[,µÕ\0\0\0¶$I\0\0H\0\0\0\0\0Û[m¶ÙM$mµSU¶ÛQ$I\0\0®¹-Û$µÔ\0\0#3£\0I\0\0H\0\0\0\0\0Û[m¶ºM$mµSU¶ÛQ$I\0\0m»m¶Ûmµµ\0\0\0II\0\0\0\0\0\0\0\0\0\0\0ÚÛmµRi$mµSU¶ÛQI$\0\0»ÿÿÿµ¤\0\0\0\0\0\0\0\0\0\0\0\0\0\0I$\0\0\0\0$\0\0\0I$\0\0\0\0\t$H\0\0n»Ý¶ÛkõÕ\0\0\0I$\0\0\0$I\0-Æ@\0I$@\0\0~\\\0\0ëíù\0\0®»ëÿÿÝõÔ\0\0ò_ò\0\0I_I[m$H²:å\0m¸\0\0õ$Ý\0\0m»ïÿÿýõµ\0\0ëmÛb\0¾ÛiÛm¦Hn:H\0¯´\0ìJ_ã\0\0»ïÿÿýõ¤\0kmÛj@%}¶ÛiI$Hm6ëH\0ýM·\0b~úä\0\0n»ëm¶ÝõÕ\0\0?Z½»@&í¶Ûbá\0âË-¸À\0m6@\0íI·.@\'RWØÔ\0\0®ºÿÿÿÿuÔ\0;Sñº$MÛbáI$Hm6ëH\0ÚIÖíÈ8â~ØÔ\0\0m»m¶Ûmµµ\0\0;S±¸¸%ji7bù+m¦HRI6H\0M6Ý7RwØÔ\0\0©6Ûm¶Ûi4\0;S±¸¹\b$m¤I\0I$@\0I&@I:Ý8ÒnØä\0\0QEQEQE\0\0;Sñ¸¹\bjI\'%\0m´@\0m¤@ÛN$Ý¹6ÒnØÒ\0\0I$J$I$\0&Û©º\b&ÚQFÝ\0\0I$\0\0\0\0\t$\0\0Nÿ©8ÒmÚâ\0\0I$IEQE\0\0Óñº@$nÄÛH\0\0\t$\0\0\0\0$\0\0+ÚH&ÒM´ã\0\0I$I$I$\0ÚMºÚ@&Ý¶ØI\0\0I$\0\0\0I$\0:I$¶$ÛI$Û\0\0IEQEQE\0\0\0ëmÛ^@µ´±\0±Ë\0\0±Ë\0:L\bm¶ÚI\0\0I$I$I$\0\0¶ÚÜ@\0I$i\0I¶\0\0I¶\0$\r¤@\0I$H\0\0IEQDI$\0\0\0I$\0\0\0\0I\0\0\t$\0\0\0\t$\0\0\0\t$\0\0\0\0\t$\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0H\0H\0@$HII\0H$H\0@\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0$$$)$))$$)$$\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0)$$)$)$))$)$)$)$\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0)$))$))$)@)$)\0@@\0H@HH@)¤)$))I)\0$)¤H$H¤$H$$$@)\0¤¤\0))"@)H\0)HHH@)\0¤\0¤\0¤H)%$H)$\0$\0@@)"\0¤$@\0¤@)$)$$$H\0$@$@)\0¤"\0\0)$\0)$)$HH@)\0¤)"\0$$)$)$¤$H$\0$)$¤)"H)$\0)$))HH\0H@H\0H)$)$)$)$\0)$)$\0)$\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0$)$)$)$\0)$$\0$\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0H$I$I$H\0I$@\0@\0H\0@\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0HHHH\0HH\0@H\0@@\0HHHHH$$"\0¤H$$$H¤$¤HHH"\0$""H$$\0¤@\0@"@"\0$$$H¤H$\0¤@\0@"@"H$$$H$¤\0¤@$¤H@H$HH\0¤@¤H$$"@$¤H\0$P$H\0¤@$\0¤@$HH\0HHHH\0@\0\0HH@\0@H\0@H\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0ºë®ºë®ªªªªªª)Ë¸$I\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0I\0@\0@\0\0\0×]u×]uUUUUUU)Ë¸$I¤Ü\0\0\0\0\0\0\0\0\0\0\0\0\0\0Q\0¤H\0\0\0ºë®¾ë®ªªªªªª)Ë¸I$%&ä\0\0\0\0\0\0\0\0\0\0\0\0\0¤HQ"$\0\0\0×]u×]uUUUUUU)Ë¸I$)7%\0\0\0HHH\0QQH\0\0\0ºã¾úë®ª¢ªªÊª)Ë¸m¶ÛI¹-\0\0\0$\0\0HQQ\0\0\0×]qß]uUUQUU)Ë¸m¶ÛMÉn\0\0\0\0\0\0)QQ\0\0\0ºëÏÆû®ªª0ªª)Ë¸I$nKv\0\0\0\0¤@$\0H\0@)QQ¤H\0\0\0×]¹\'ÝuUTQEUU)Ë¸I$r[·\0\0\0\0¤@¤H¢@$)$(¤H\0\0\0ºëÉ<û®ªª¡**ª)Ë¸¶ÛmÝ¿\0\0\0\0¤@"H\0@)$("\0\0\0×]qÇÝuUU\f0ÕU)Ë¸¶Ûmíù\0\0\0\0¤@$\0\0\0$(\0\0\0ºã¾úû®ª¢¢ª)Ë¸Ûm¶·oÉ\0\0\0H\0@H\0\0\0(H\0\0\0×]u×]uUUUUUU)Ë¸Ûm¶»~J\0\0\0\0\0\0\0\0\0\0\0\0¤@\0)$\0\0\0ºë®ºë®ªªª²ªª)Ë¸ÿÿÿÛòR\0\0\0\0\0\0\0\0\0\0\0\0)\0\0$@H\0\0\0×]u×]uUUUUUU)Ë¸ÿÿÿß\0\0\0\0\0\0\0\0\0\0\0\0\0\0H\0\0\0@\0\0\0»k®ºë®ªªªªªª)Ë¸\0\0\0ü\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0×]u×]uUUUUUU)Ë¸\0\0\0ä¤Ü\0\0\0'){var b=6e4<(b=v.charCodeAt())?0:255<b?"€ ‚ƒ„…†‡ˆ‰Š‹Œ Ž  ‘’“”•–—˜™š›œ žŸ".indexOf(v)+128:b;h.push(b)}var I=[];for(v=0;v<h.length;v+=3)for(var x=(h[v]<<16)+(h[v+1]<<8)+h[v+2],H=0;H<8;H++)I.push(x>>21-3*H&7);var y=[];for(v=0;v<56;v++)y.push([]);for(v=0;v<I.length/16;v+=1){var g=v%8+8*~~(v/128);y[g]=y[g].concat(I.slice(16*v,16*(v+1)))}const z=[{sequence:[0,1],bpm:80,score:2e3,robot:[1,3,5,1],palette:2},{sequence:[1,2,0],bpm:100,score:3e3,robot:[2,1,2,2],palette:18},{sequence:[3,1,3,2],bpm:120,score:4500,robot:[5,0,3,5],palette:19},{sequence:[0,2,3,2],bpm:144,score:6e3,robot:[3,4,4,3],palette:20},{sequence:[3,0,1,3,2],bpm:160,score:1e4,robot:[4,2,1,4],palette:21}];let E=[];const k=e=>e,M=Math.random,P=(e,t,a,r,o,i=k,n=!1)=>{if(a==r)return e[t]=r;let c=0,l=r-a,d=s;var f={onEnd:e=>d=e,update:s=>(c+=s/o,e[t]=a+l*i(c),c>=1&&(e[t]=r,d()),c>=1)};return n&&f.onEnd(s=>P(e,t,r,a,o,i,!0)),E.push(f),f},w=(e,t,a)=>{let r=e.x,s=e.y;P(e,"x",r-t,r+t,a,M).onEnd(t=>e.x=r),P(e,"y",s-t,s+t,a,M).onEnd(t=>e.y=s)};var U=e=>{var t={x:e[0],y:e[1],visible:!0,frame:0,frameRate:e[3],frames:e[2],paletteIndex:e[4],paletteOverrides:{},small:!1,offsetX:0,offsetY:0,update:e=>t.frame=(t.frame+t.frameRate*e)%t.frames.length,draw:(e,a=0,r=0)=>W.draw(t.frames[~~t.frame],~~(t.x+a),~~(t.y+r),t.paletteIndex,t.flipped,t.vFlip,t.small,t.paletteOverrides,e),overridePalette:(e,a)=>t.paletteOverrides[e]=a};return t._update=t.update,t},C=(e,t,a,r,o=1,i=s,n=!1)=>{const c=U([e,t]);return c.dfltX=e,c.dfltY=t,c.width=0,c.height=16*a.length,c.parts=[],a.forEach((e,a)=>{c.width=16*e.length/2;var s=[...e];n&&s.reverse(),s.forEach((e,o)=>c.parts.push(((e,t,a,r,s)=>{const o=U([e,t,a,0,s]);return o.small=!0,o.frame=r,o})(8*o,t+16*a,s,o,r)))}),c.width,c.update=s,c.b=o,c.flipped=n,c.drawBehind=i,c.draw=()=>{c.visible&&(c.drawBehind(),c.parts.forEach(e=>{e.flipped=c.flipped,e.draw(c.b,c.x,c.y)}))},Me.add(c),c},S=100,T=6e4/(4*S),R=-1,F=[[],[]];let Q=null;getBeatFor=e=>(e-Q+T/2)/T,updateMetronome=()=>{if(2!=rt||2==st)return;let e=Date.now();Q||(Q=e,level.sequence.forEach(e=>{F[0]=F[0].concat(D[1][e][1].slice(2)),F[1]=F[1].concat(D[1][e][2].slice(2))}));var t=~~((e-Q)/T);R!=t&&(R%4==0&&u.b!=R&&Ie.addFocus(-1),!((R=t)%4)&&ze(),Ee(R)),setTimeout(()=>{updateMetronome()},1)};var q=(e,t,a,r,s,o)=>{var i=U([e,t,[s],0,o]);return i.height=r,i.width=a,i.setSprite=e=>{i.offsetX=e%2,i.sprite=y[~~(e/2)]},i.b=1,i.palette=o,i.setSprite(s),i.draw=e=>{for(let e=~~i.y;e<i.y+i.height;e++)for(let t=~~i.x;t<i.x+i.width;t++){let{r:a,g:r,b:s}=W.palettes[i.palette][i.sprite[t%8+8*i.offsetX+e%16*16]];X(t,e,a,r,s,255*i.b)}},i},O=[[[1],[2],[3],[8],[2],[3]],[[32],[33],[34],[35],[36]],[[16],[17],[18],[19],[20],[21]],[[24],[25],[26],[27],[28],[29]]],j=[4,5],Y=(t,a)=>{var r=U(t);r.combo=0,r.score=0,r.focus=0,r.maxCombo=0,r.stats={},r.scene=a,r.v={x:0,y:0},r.isPC=!1,r.sequence=[],r.update=e=>{r.gc&&!r.gc.inErr&&(r.gc.x=r.x+8-r.gc.width/2,r.gc.y=r.y+32),r.c.forEach(e=>{e.x=r.x+e.dx,e.y=r.y+e.dy}),r.frame=(r.frame+r.frameRate*e)%6;var t=~~r.frame;t=(t+r.bounceOffset)%6,headOffset=[0,1,2,3,2,1][t],torsoOffset=[0,1,2,2,1,0][t],[r.c[0],r.c[1],r.c[6]].forEach(e=>e.y+=headOffset),[r.c[2],r.c[3],r.c[4],r.c[5]].forEach(e=>e.y+=torsoOffset)},r.setSprites=e=>{var t=e.map((e,t)=>O[t][e]);r.c.forEach((e,a)=>e.frames=t[~~(a/2)]),-1!=j.indexOf(e[0])&&(r.c[0].dx=-8,[r.c[0],r.c[1]].forEach(e=>e.small=!1))},r.arms=[!1,!1],r.flipArm=e=>{r.arms[e?0:1]=!r.arms[e?0:1],r.arms.forEach((e,t)=>r.c[4+t].vFlip=e)},r.headPosition=1;var o=W.palettes[r.paletteIndex];r.turnHead=e=>{r.headPosition=c(r.headPosition+e,4),r.c[6].visible=r.headPosition%2==0,r.c[6].flipped=0===r.headPosition,[r.c[0],r.c[1]].forEach(e=>{e.visible=!r.c[6].visible,3===r.headPosition?[2,3,4,5,6,7].forEach(t=>e.paletteOverrides[t]=o[t<6?1:5]):e.paletteOverrides={}})},r.dash=t=>{P(r,"x",r.x,r.x+10*t,100),r.isPC&&zzfx(.7,.5,50,.12,.06,0,3,e,e,50,500,.6,e,.8,15,e,.02,.65,.06,.01)},r.draw=s,r.c=[...new Array(7)].map(e=>U([0,0,[1],v+3,r.paletteIndex]));var i=r.c;return i.forEach((e,t)=>{e.small=!0,e.dx=t<4?t%2*8:t%2*24-8,e.dy=t<4?16*~~(t/2):16,e.flipped=t%2!=0,r.scene.add(i[6-t]),6==t&&(e.dy=0,e.dx=0,e.small=!1,e.visible=!1)}),r.setPalette=e=>i.forEach(t=>t.paletteIndex=e),r._update=r.update,r.tryBeat=t=>{var a=getBeatFor(Date.now());if(~~a!=u.b){u.r=a,u.b=~~a;var s=u.r-u.b-.5,o=[.2,.5],i=u.b%4==0;!i&&r.combo<4||u%2==1&&r.combo<16?r.badKey():(i||(o=[.1,.45]),(s=Math.abs(s))<o[0]?(r.isPC&&(zzfx(e,50,15,e,e,.21,e,1.84,.5,450,e,.7,e,.4,e,.1,.02,e,.01,.01),Ye(Le,-16),r.addCombo(),r.addFocus(r.combo%2==0?1:0)),r.addKey(t)):s<o[1]?(r.isPC&&(zzfx(e,6,50,e,.3,.8,e,9,5,90,e,e,e,.7,50,.2,.02,e,.6,.01),Ye(Ae,-10),r.addCombo(),r.addFocus(r.combo%3==0?1:0)),r.addKey(t)):r.badKey())}},r.overridePalette=function(e,t){r.c.forEach(a=>a.overridePalette(e,t))},r.addKey=function(e){r.sequence.push(e),r.gc.setText(r.sequence.reduce((e,t)=>e+String.fromCharCode(t).toLowerCase(),""),r.gc.dfltStroke,r.gc.dfltFill),r.gc.b=1,r.gc.inErr=!1,4==r.sequence.length&&(Ye(r.gc,null,300,{y:16}),r.score+=function(e){const t={};for(v in e)t[e[v]]||(t[e[v]]=0),t[e[v]]++;var a=Object.keys(t).length;return a>2&&a++,2==a&&2!=t[e[0]]&&(a+=1),111*a}(r.sequence),r.score>=level.score&&lt(),r.sequence=[],setTimeout(()=>r.gc.setText(""),650))},r.badKey=function(){r.isPC&&Me.feedback(404),zzfx(r.isPC?.7:.2,e,r.isPC?220:80,e,.1,e,1,.3,1,15,400,.05,.03,1.1,e,.4,e,.5),r.gc.setText(r.gc.rawText+"*","s2l","401"),r.gc.x=r.x+8-r.gc.width/2,r.gc.b=1,r.gc.inErr=!0,Ye(r.gc,null,500,{y:r.gc.y+16}),w(r.gc,.1,500),setTimeout(()=>r.gc.inErr=!1,800),r.sequence=[],r.addFocus(-1)},r.addCombo=function(){r.combo+=1,r.combo>r.maxCombo&&(r.maxCombo=r.combo)},r.addFocus=function(t){var a=r.focus;r.focus+=t,r.focus=r.focus>4?4:r.focus,r.focus<0&&(r.focus=0,r.combo=0),a!=r.focus&&r.isPC&&(4==r.focus&&ie(...le[n(0,4)]),0===r.focus&&(ne(),zzfx(1.4,e,338,e,.15,.06,1,.4,.4,.1,-250,.03,.02,.6,-13,e,.11,.74,e,.17)))},r},B=(e,r,s,o,i)=>{for(var n=e<0?0:e;n<e+s&&n<t;n++)for(var c=r<0?0:r;c<r+o&&c<a;c++)X(n,c,...i)};const D=[[[,0,76,,,.7,3,1.5,,,,,,,,.06,,.2,,.5],[.8,0,43,.01,.06,.21,1,1.5,.05,,40,.12,,2.4,.8,,.3,.07,.12],[,0,170,.003,,.008,,.97,-35,53,,,,,,.1],[.8,0,270,,,.12,3,1.65,-2,,,,,4.5,,.02],[,0,86,,,,,.7,,,,.5,,6.7,1,.05],[.6,0,42,,.05,.4,,0,,,15,.5,,,,,.6,0,.4],[,0,2200,,,.04,,2,,,800,.02,,4.8,,.01,.1],[.5,0,16,,,.3,3,.2,,,,,,,,,.3],[.6,0,85,,,.05,1,,,,,,,,,.4,,.92,.1],[.5,0,170,,,.05,1,,,,24,5,,,1,.4,.33,0,.07]],[[[1,-1,20,,,,23,,,,22,,,,20,,,,30,,,,20,,,,23,,,,22,,27,,32,,,,20,,,,23,,,,22,,,,23,,,,27,,,,32,,,,35,,32,,],[4,1,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,],[7,-1,25,,28,,27,,20,,25,,28,,27,,20,32,25,,28,,27,,24,,25,,20,,25,-1,20,-1,25,,20,,25,,28,,32,,33,,32,,28,,32,,30,,28,,27,,25,-1,,,20,-1,,,],[2,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,-1,,5,,,,,,,,,,,,,23,,,,],[6,1,,,,,,,,,,,1,,,,,,,,,,,,,,,,9,,,,,,,,,,,,,,8,,4,,,,,,,,,,4,,29,,3,,25,,2,,,,],[,1,25,-1,25,-1,,,22,,,,25,,22,29,30,29,25,-1,22,-1,22,-1,25,,,,22,,,,13,,17,,22,,,,17,,13,,12,,22,-1,25,-1,25,22,-1,25,-1,22,-1,29,-1,25,-1,22,-1,22,-1,,],[5,,35,-1,35,-1,32,-1,32,-1,,,35,-1,32,-1,32,-1,35,-1,35,-1,-1,,-1,,35,-1,35,-1,32,-1,32,-1,27,-1,27,-1,28,-1,28,-1,27,-1,27,-1,27,28,32,35,32,-1,32,-1,27,-1,27,-1,28,-1,28,-1,27,28,32,35]],[[1,-1,20,,,,23,,,,22,,,,20,,,,30,,,,20,,,,23,,,,22,,27,,32,,,,20,,,,23,,,,22,,,,23,,,,27,,,,32,,,,35,,32,,],[4,1,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,1,,,,],[7,-1,25,,28,,27,,20,,25,,28,,27,,20,32,25,,28,,27,,24,,25,,20,,25,-1,20,-1,25,,20,,25,,28,,32,,33,,32,,28,,32,,30,,28,,27,,25,-1,,,20,-1,,,],[2,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,-1,,5,,,,,,,,,,,,,23,,,,],[6,1,,,,,,,,,,,1,,,,,,,,,,,,,,,,9,,,,,,,,,,,,,,8,,4,,,,,,,,,,4,,29,,3,,25,,2,,,,],[,1,25,-1,25,-1,,,22,,,,25,,22,29,30,29,25,-1,22,-1,22,-1,25,,,,22,,,,13,,17,,22,,,,17,,13,,12,,22,-1,25,-1,25,22,-1,25,-1,22,-1,29,-1,25,-1,22,-1,22,-1,,]],[[1,-1,20,,,,23,,,,22,,,,20,,,,30,,,,20,,,,23,,,,22,,27,,32,,,,20,,,,23,,,,22,,,,23,,,,27,,,,32,,,,35,,32,,],[4,1,1,,25,,1,,,,1,,25,,1,,,,1,,25,,1,,,,1,,25,,1,,25,,1,,25,,1,,,,1,,25,,1,,,,1,,25,,1,25,,,1,,25,,1,,25,,],[7,-1,25,,28,,27,,20,,25,,28,,27,,20,32,25,,28,,27,,24,,25,,20,,25,-1,20,-1,25,,20,,25,,28,,32,,33,,32,,28,,32,,30,,28,,27,,25,-1,,,20,-1,,,],[2,1,34,,30,,34,,34,,32,,34,,30,,34,,34,,30,,32,,29,,34,,30,,32,,34,30,,,32,,29,,34,,30,,32,29,,,34,30,32,,29,,34,,30,,32,,29,,34,,30,29],[6,1,,,,,,,,,,,1,,,,,,,,,,,,,,,,9,,,,,,,,,,,,,,8,,4,,,,,,,,,,4,,29,,3,,25,,2,,,,],[,1,22,-1,,22,25,-1,-1,25,29,-1,-1,29,28,22,20,25,22,-1,20,-1,22,-1,25,,,29,,22,,28,,25,34,-1,,34,29,-1,,28,34,-1,,,34,36,34,30,32,30,29,30,29,34,-1,-1,30,-1,29,,22,-1,,,]],[[1,-1,20,,,,23,,,,22,,,,20,,,,30,,,,,,20,,,,,,,,,,,-1,28,,27,,25,,23,,,,,,22,-1,27,,22,,20,,27,,22,,20,,22,,27,,],[3,1,,,22,,,,,18,,,,,,,,,,,5,,,18,,,,,,23,,,,22,,,,,,,,,,,,22,23,,,,,,18,,,,,22,,,,,,,,,],[8,1,32,,35,,32,20,20,,32,,32,,32,,20,,32,,32,,32,,12,,32,,32,,32,,10,,32,12,32,,32,,20,,32,30,32,,32,32,20,,32,,32,,32,,20,,32,,27,,32,,34,,],[,1,22,-1,,22,25,-1,-1,25,29,-1,-1,29,28,30,20,25,22,-1,20,-1,22,-1,25,,,29,,22,,34,,25,34,-1,,34,29,-1,,28,34,-1,,,34,34,34,30,32,30,29,30,29,34,-1,-1,30,-1,29,,22,34,32,,],[9,-1,35,32,-1,32,-1,32,35,32,-1,32,-1,32,27,32,-1,27,-1,32,-1,32,-1,32,-1,35,-1,32,-1,32,20,32,23,32,-1,35,-1,32,-1,32,32,32,-1,32,-1,32,-1,32,35,32,-1,32,-1,32,-1,32,-1,32,27,32,-1,32,23,32,-1,32]]]];var K=document.getElementById("c").getContext("2d"),A=K.createImageData(t,a),L=A.data;function X(e,t,a,r,s,o=255){var i=4*(e+t*A.width);o/=255;var[n,c]=[o,1-o];L[i]=n*a+c*L[i],L[i+1]=n*r+c*L[i+1],L[i+2]=n*s+c*L[i+2],L[i+3]=255}var N={sprite:43,palette:9,small:!0,mirror:!0},V={a:{sprite:52,palette:7},b:{sprite:53,palette:7},f:{...N,vFlip:!0},g:{...N}},G=(e,t=[1,2,3],a=!0)=>{var r=[[0,0],[8,0],[0,26],[8,26]];return t.map(t=>{var s=U([e.x+r[t][0],e.y+r[t][1],e.frames,e.frameRate,e.paletteIndex]);return s.offsetX=r[t][0],s.offsetY=r[t][1],s.small=a,s.flipped=3!=t,s.vFlip=e.vFlip||1!=t,s.paletteOverrides=e.paletteOverrides,s})},J=(e,t,a={x:0,y:0})=>{for(var r=[],s=0;s<e.length;s++)for(var o=0;o<e[s].length;o++){var i=e[s].charAt(o),n=V[i];(n=n.parts?[{...n.parts,sprite:n.parts.sprites[n.parts.partIdx++]}]:n.sprites?n.sprites:[n]).forEach(e=>{var i=U([16*(o+a.x),16*(s+a.y),[e.sprite],v+3,e.palette]);i.small=e.small||!1,i.vFlip=e.vFlip||!1,i.vFlip&&(i.y+=10),t.add(i),r.push(i),e.mirror&&G(i,[1]).forEach(e=>{r.push(e),t.add(e)})})}return r},_=(e,t)=>{for(var a=[],r=t?0:8,s=0;s<16;s++)for(var o=0;o<8;o++)a[8*s+o]=e[16*s+o+r];return a},W={sprites:[],sprites8:[],beatPalettes:[],tickPalettes:[],setSprites:function(e){this.sprites=e,e.forEach((e,t)=>{this.sprites8[2*t]=_(e,!0),this.sprites8[2*t+1]=_(e)})},shiftPalette:function(e,t=0,a=7){for(var r=this.palettes[e],s=r[a],o=0;o<a-t;o++)r[a-o]=r[a-1-o];r[t]=s},cyclePaletteIndex:function(e,t,a){var r=0,s=1;return a=a.map(e=>ee(e)),setInterval(()=>{(r+=s)==a.length-1?s=-1:0==r&&(s=1),this.palettes[e][t]=a[r]},200)},rmp:function(e,t,a,r){e.push({paletteId:t,index:a,colorCycle:r.map(e=>ee(e)),cycleIndex:0,dir:1})},tickPalette:function(){this.rmp(this.tickPalettes,...arguments)},beatPalette:function(){this.rmp(this.beatPalettes,...arguments)},metronomeCycle:function(e){e.forEach(e=>{e.cycleIndex+=e.dir,e.cycleIndex==e.colorCycle.length-1?e.dir=-1:0==e.cycleIndex&&(e.dir=1),this.palettes[e.paletteId][e.index]=e.colorCycle[e.cycleIndex]})},onMetronomeTick:function(){this.metronomeCycle(this.tickPalettes)},onMetronomeBeat:function(){this.metronomeCycle(this.beatPalettes)},draw:function(e,t,a,r,s,o,i,n,c){this.drawRaw(i?this.sprites8[e]:this.sprites[e],t,a,r,s,o,i,n,c)},drawRaw:function(e,t,a,r,s,o,i,n,c){for(var l=i?8:16,d=0;d<16;d++)for(var f=0;f<l;f++){var m=o?15-d:d,p=o?-10:0,v=e[m*l+f];if(s&&(v=e[(m+1)*l-1-f]),0!=v||!this.palettesWithTransparecy.includes(r)){var $=this.palettes[r][v];n[v]&&($=n[v]),1!=c&&($=te($,c)),X(f+t,d+a+p,$.r,$.g,$.b,255*c)}}}};W.setSprites(y),W.palettes=[[r,"003","vvv","0j5","4v3","04o","0hu","auu"],[r,"004","vvv","t77","vd3","36k","5ir","btt"],[r,"300","vvc","v11","vf0","i26","v80","vj1"],["08e","emo","fpv","3kr","ruu","ruu","3kr","08e"],["0k0","0k0","0d0","080","0e0","0d0","080","0e0"],["555","t57","p13","l00","h00","l00","p13","t57"],[e,e,e,e,e,e,e,e],[r,"vuu","r5t","pet","olv","scm","uko","vrr"],[e,e,e,e,e,e,e,e],[r,"433","vuu","vq8","vv8","876","fca","sql"],[r,"433","vvv","1m7","8u8","8u8"],[e,e,"222",e,"222",e,"222",e,e],[r,e,"401","s2l","574","ou5","2b6","2ok"],[r,"101","8u8","6d0","580","66b","him","opr"],[r,"101","jr8","bo6","2k5","3f7","4a7","244"],["gko","vsc","ujv","mt1","3rv","veb","uvt","r5t"],["222","555","888","aaa","888","555","222","111"],["000","111","222","333","444","555","666","777"],[r,"032","ovp","0ks","3rv","1cd","7i1","mt1"],[r,"217","vsv","vbe","vjk","eav","nfv","ujv"],["0k0","211","uvt","8gk","esk","nc3","vm5","vsc"],["555","013","rtt","9hd","gqj","68b","adi","gko"]],W.palettesWithTransparecy=[0,1,2,9,10,11,12,13,18,19,20,21];var Z=e=>8*parseInt(e,32),ee=e=>e?{r:Z(e[0]),g:Z(e[1]),b:Z(e[2])}:{r:0,g:0,b:0};W.palettes=W.palettes.map(e=>e.map(ee)),setInterval(e=>{W.shiftPalette(3,1,7,1),W.shiftPalette(15,0,7,-1),W.shiftPalette(16,0,7,-1)},150);var te=({r:e,g:t,b:a},r=.3)=>(({r:e,g:t,b:a})=>(e<0&&(e=0),t<0&&(t=0),a<0&&(a=0),{r:e,g:t,b:a}))({r:e*r,g:t*r,b:a*r}),ae={scenes:[],add:e=>ae.scenes.push(e),remove:e=>{var t=ae.scenes.indexOf(e);ae.scenes.splice(t,1)},update:(e,t)=>ae.scenes.map(a=>a.update(e,t)),draw:e=>ae.scenes.map(e=>e.draw())},re=()=>{var e={x:0,dx:0,b:1,active:!0,children:[],add:t=>e.children.push(t),remove:t=>{var a=e.children.indexOf(t);-1!=a&&e.children.splice(a,1)},applyToChildren:t=>e.children.map(t),update:(t,a)=>e.active&&e.applyToChildren(e=>e.update(a,t)),draw:t=>e.active&&e.applyToChildren(t=>t.visible&&t.draw(e.b)),fadeIn:t=>P(e,"b",0,1,1e3),fadeOut:t=>P(e,"b",1,0,1e3),onMetronomeTick:s,onMetronomeBeat:s};return e},se=re(),oe=[p1=q(0,0,0,0,108,15),p2=q(0,0,0,0,108,15)];oe.forEach(se.add);const ie=(e,t,a,r,s,o,i,c,l,d,f,m,p,v,$,u,h,b)=>{p1.b=1,p2.b=1;var I=isNaN(h)?[108,109,110][n(0,2)]:h;p1.setSprite(I),p2.setSprite(I);var x=isNaN(b)?[3,15,16][n(0,2)]:b;p1.palette=x,p2.palette=x,P(p1,"x",e,s,600),P(p1,"y",t,o,600),P(p1,"width",a,i,600),P(p1,"height",r,c,600),P(p2,"x",l,p,600),P(p2,"y",d,v,600),P(p2,"width",f,$,600),P(p2,"height",m,u,600)},ne=e=>{P(p1,"b",1,0,200),P(p2,"b",1,0,200)};ae.add(se);var ce=[0,0,t,-20,0,0,t,45,0,a,t,0,0,90,t,54,0,3],le=[[0,0,0,a,0,0,96,a,t,0,0,a,96,0,96,a],[96,0,0,a,0,0,96,a,96,0,0,a,96,0,96,a],[0,0,t,0,0,0,t,72,0,a,t,0,0,72,t,72],[0,72,t,0,0,0,t,72,0,72,t,0,0,72,t,72],[96,72,0,0,0,0,t,a,0,0,0,0,0,0,0,0]],de=re(),fe=re();J(["abababababab","babababababa","abababababab","babababababa","abababababab","babababababa","abababababab","babababababa","abababababab"],de);var me=[];for(v=0;v<30;v++)me.push(n(-16,130));me.sort((e,t)=>e-t);var pe=[];for(v=0;v<12;v++){var ve=n(-30,30),$e=me[v];if(Math.abs($e-60)+Math.abs(ve-100)<90)v--;else if(Math.abs($e-60)+Math.abs(ve-200)<90)v--;else{var ue=Y([ve,$e,[],8,n(18,21)],de);ue.setSprites([dancerHead=n(0,4),n(0,4),n(0,5),dancerHead]),ue.bounceOffset=n(0,4),ue.flipArm(n(0,10)>4),pe.push(ue),de.add(ue)}}oe.forEach(fe.add);var he,be,Ie=(he=Y([56,32,[3,4],8,0],fe),be=-1,he.checkInput=e=>{switch(e){case f.SPACE:he.dash(be*=-1);break;case f.S:he.flipArm(1);break;case f.L:he.flipArm(0);break;case f.D:he.turnHead(-1);break;case f.K:he.turnHead(1)}he.stats[e]=he.stats[e]?he.stats[e]+1:1},he.update=e=>{he._update(e)},he);Ie.setSprites([pcHead=0,0,0,pcHead]),Ie.bounceOffset=0,Ie.isPC=!0,fe.add(Ie),fe.following=Ie;var xe=[f.F,f.D,f.S,f.J,f.K,f.L],He=Y([120,32,[3,4],8,2],fe);He.setSprites([enemyHead=n(0,4),n(0,4),n(0,5),enemyHead]),He.bounceOffset=3,fe.add(He),ae.add(de),ae.add(fe),W.cyclePaletteIndex(1,3,["t57","r35","p13","n01"]),W.cyclePaletteIndex(1,4,["vd3","tb1","r90","p70"]),W.cyclePaletteIndex(0,3,["1m7","3o9","5qb","7sd"]),W.cyclePaletteIndex(0,4,["8u8","6t6","4r4","2p2"]),W.beatPalette(7,2,["pet","r5t"]),W.tickPalette(7,3,["olv","pet"]),W.beatPalette(7,4,["tqv","olv","pet","r5t"]),W.beatPalette(7,5,["scm","uko"]),W.tickPalette(7,6,["uko","vrr"]),W.tickPalette(7,7,["vuu","vrr","uko","scm"]),W.beatPalette(7,1,["vuu","vvv","tqv"]);var ye=0,ge=-1,ze=t=>{if(0==st){var a=~~(R/4);return ge!=a&&(zzfx(e,30,18,.06,.04,.15,1,1.8,9,-.6,750,.07,e,.2,e,e,.04,0,.05),Je.setText(["3","2","1","dance",""][a]),ge=a),void(16==R&&P(Je,"b",1,0,100)&&ct())}He.gc.inErr||(++ye>9&&(ye=0),He.flipArm(ye%4==0),ye%3==0&&He.dash(ye%2==0?1:-1),ye%4==0&&He.turnHead(ye%3==0?1:-1),i()<.9?He.addKey(d(xe)):He.badKey(d(xe))),W.onMetronomeBeat(),Me.onMetronomeBeat()},Ee=e=>{Me.onMetronomeTick(e),W.onMetronomeTick()};const ke=e=>{de.active=!1,fe.active=!1,fe.fadeOut(),de.fadeOut()};ke();var Me=re(),Pe=(e=>{var a=0,r=[128,1,4,[0,160,100]],s=l(27,31),o=[];[...s,...s.reverse()].forEach((t,a)=>{var r=U([-8,16*e.y,[t],1,10]);r.flipped=a>5,r.small=!0,r.visible=!1;var s=G(r,[2]).pop();s.flipped=a<=5,s.visible=!1,o.push([r,s])});var i=parseInt(24,10);return{visible:!0,x:e.x,scene:e.scene,currentLine:0,prevLine:0,update:e=>{if(2==rt&&2!=st){var t=4*T;a=(Date.now()-Q)%t/t}},draw:e=>{if(o.forEach(e=>e.forEach(e=>e.visible=!1)),2==rt&&2!=st)for(var s=0;s<2;s++){var n=~~(48*(s+a))-1,c=~~(~~(n*i*10/t)/i);o[c].forEach(e=>{e.visible=1===st,e.x=n-4+e.offsetX}),o[o.length-1-c].forEach(e=>{e.visible=1===st,e.x=t-n-2+e.offsetX});var l=~~(n+24),d=~~(t-n-2-24);l<96&&(Ie.combo>=4&&(B(l,...r),B(d,...r)),Ie.combo>=16&&(B(l-12,...r),B(l-36,...r),B(d+12,...r),B(d+36,...r)))}},addBeatLinesToScene:function(){o.forEach(e=>e.forEach(e=>this.scene.add(e)))},updateLines:function(e){this.currentLine=c(e,o.length/2)}}})({x:0,y:7,instrument:0,scene:Me}),we=[l(0,11,"f").join(""),l(0,11,"g").join("")],Ue=[...l(64,102),70],Ce=(e,t,a,r,o,i=1)=>{let n=U([e,t]);return n.setText=(t,a,r)=>{var s=t.split("");"#"===s[0]&&s.push("#"),n.x=e-4*s.length,n.parts=s.map((e,s)=>{let o="012345678abcdefghijklmnopqrstuvwxyz#$=*9".indexOf(e);return-1!=o&&((e,t,a,r,s=!1)=>{var o=U([a,0,Ue,0,0]);return o.small=!0,o.frame=r,o.flipped=s,e&&(o.paletteOverrides={1:ee(e),2:ee(t)}),o})(r,a,8*s,o,s===t.length)}),n.width=8*n.parts.length,n.rawText=s.join("")},n.setText(a,r,o),n.dfltStroke=o,n.dfltFill=r,n.update=s,n.b=i,n.draw=e=>n.visible&&n.parts.forEach(e=>e&&e.draw(n.b,n.x,n.y)),Me.add(n),n};let Se=[[l(22,26),l(38,42)],13],Te=C(0,40,...Se),Re=C(0,40,...Se,1,s,!0);Re.x=t-Re.width,Te.y+=2*Te.height,Re.y+=2*Re.height;let Fe=[[[11,12,12,12,13,14,15]],9,1,function(){const e=this.x+(this.flipped?20:4),t=this.y+6;if(B(e,t,33,7,[255,255,255]),this.flipped){const a=33*Math.min(He.score,level.score)/level.score;B(e,t,a,7,[251,107,29])}else{const a=33*Math.min(Ie.score,level.score)/level.score;B(e,t,a,7,[15,146,240])}}],Qe=C(40,0,...Fe);Qe.y-=100;let qe=C(40,0,...Fe,!0);qe.x+=qe.width,qe.y-=100;const Oe=J(we,Me,{x:0,y:7});Oe.forEach(e=>{e.y+=32,e.yy=e.y}),Pe.addBeatLinesToScene(),Me.add(Pe);let je=C(80,56,[l(44,47),l(60,63)],9);const Ye=(e,t,a,r)=>{e.b=1,r||(e.y=96),setTimeout(a=>{if(P(e,"b",1,0,300),!r)return P(e,"y",96,96+t,300);r.y&&P(e,"y",e.y,r.y,r.time||300),r.x&&P(e,"x",e.x,r.x,r.time||300)},a||60)};let Be=Ce(128,20,"","004","0hu",0);Be.inErr=!1,Ie.gc=Be;let De=Ce(128,50,"","300","vd3",0);De.inErr=!1,He.gc=De;let Ke=Ce(96,96,"#$=$","401","s2l",0),Ae=Ce(96,96,"100",e,e,0),Le=Ce(96,96,"#200","ou5","574",0);Me.onMetronomeTick=t=>{Pe.updateLines(t),1==st&&(zzfx(.6,e,50,.01,.05),Te.y+=Te.dfltY!==Te.y?-2:2,Re.y+=Re.dfltY!==Re.y?-2:2)},je.y=288;var Xe,Ne=e=>{je.y=88,je.x=80,Oe.forEach(e=>e.y=e.yy),Te.y=Te.dfltY+2*Te.height,Re.y=Re.dfltY+2*Re.height,Qe.y=-24,qe.y=-24};Me.showLevelElements=t=>{zzfx(.7,0,10,.01,.7,.4,e,.7,.7,e,15,.7,e,.3,e,e,e,e,.08),Oe.forEach(e=>P(e,"y",e.yy,e.yy-32,1e3)),P(je,"y",je.y,je.y-je.height,1e3),P(Te,"y",Te.y,Te.dfltY,1300),P(Re,"y",Re.y,Re.dfltY,1300),P(Qe,"y",-24,Qe.dfltY,1150),P(qe,"y",-24,qe.dfltY,1150)},Me.feedback=(Xe={404:function(){Ye(Ke,5),w(je,1,500)},default:s},e=>Xe[e]());let Ve=Ce(96,20,"rythm not found","v0v","000",0),Ge=Ce(96,95,"press enter","vvv","332",0);Ge.visible=!1;let Je=Ce(96,64,"3",e,e,0),_e=e=>{o=e,Ge.visible=!e};setTimeout(e=>{P(Ve,"b",0,1,500),P(Ve,"y",20,30,500).onEnd(e=>_e(!1)),P(Ge,"b",.2,1,500,k,!0),ie(...le[n(0,4)])},1e3),ae.add(Me),W.beatPalette(9,2,["vuu","9st","i0d","8u8","v9d"]),W.beatPalette(10,5,["1m7","3o9","5qb","7sd"]),setInterval(e=>{W.shiftPalette(13,2,4,1)},100),W.cyclePaletteIndex(13,7,["him","opr"]);var We=re();We.add(q(0,0,t,a,103,15)),oe.forEach(We.add);var Ze=[];for(v=0;v<z.length;v++){var et=Y([36*v+16,60,[],8,11],We);et.setSprites(z[v].robot),et.basePalette=z[v].palette,et.bounceOffset=0,We.add(et),Ze.push(et)}We.add(Ge);ae.add(We),We.active=!1;var tt,at,rt=0,st=0,ot=-1;level=z[0];var it=!1;const nt=e=>{We.active=!1,de.active=!0,rt=2,st=0,Q=null,R=-1,He.score=0,He.combo=0,He.focus=0,Ie.combo=0,Ie.addFocus(-4),Ie.score=0,Ge.visible=!1,Ne(),Me.showLevelElements(),updateMetronome()},ct=e=>{st=1,(at=zzfxP(...tt)).loop=!0,R=-1,updateMetronome()},lt=t=>{ne(),at.stop(),st=2,(it=Ie.score>=level.score)?zzfx(e,e,196,e,.3,.9,e,1.84,e,50,500,.05,.08,.3,e,e,.16,.91):zzfx(e,e,196,e,.8,.9,e,.3,8,e,-6,e,.03,.3,e,e,.32,0,1),P(Je,"b",0,1,350),Je.setText(it?"you win":"you lose"),setTimeout(e=>_e(!1),1e3)},dt=t=>{rt=1,st=0,level=z[++ot],He.setPalette(level.palette),He.setSprites(level.robot),D[2]=level.sequence,D[3]=level.bpm,S=level.bpm,T=6e4/(4*level.bpm),tt=zzfxM(...D),_e(!0),Ze.forEach((e,t)=>{e.x=36*t+16,e.y=60}),We.active=!0,We.brightness=0,Ze[ot].setPalette(Ze[ot].basePalette),We.fadeIn(),setTimeout(t=>{Ze.forEach((t,a)=>{P(t,"x",t.x,a==ot?88:t.x,800),P(t,"y",t.y,a==ot?50:148,800),zzfx(.7,10,30,e,.5,1.1,e,.4,2,-2,10,50,.7,.3,e,e,.04,.3,1),ie(...ce)})},1200),setTimeout(e=>_e(!1),2400)},ft=[.5,e,e,.2,1,e,1,.5,20,10,10,.7,.7,e,.9,.4,e,e,.7],mt=[.7,e,e,e,.3,e,1,e,2.2,1.5,750,.15,.14,e,e,.4],pt=e=>{switch(rt){case 0:zzfx(...ft),setTimeout(()=>{ae.remove(se),oe.forEach(se.remove)},100),dt(),ne(),Me.remove(Ve);break;case 1:zzfx(...mt),We.fadeOut(),ne(),We.active=!1,Ge.visible=!1,Ne(),de.active=!0,fe.active=!0,fe.fadeIn(),de.fadeIn(),P(Je,"b",0,1,100),o=!0,setTimeout(e=>{o=!1,nt()},1e3);break;case 2:if(2==st)if(it){if(Ge.visible=!1,4==ot)return rt=5,P(He,"y",He.y,a,600),P(Ie,"x",Ie.x,88,600),Me.add(Ce(96,20,"thanks for playing","v0v","000",1)),ie(...le[n(0,4)]),!0;ke(),dt()}else nt()}};var vt=0,$t=e=>{var r=e-vt,s=r/1e3;vt=e,ae.update(e,s),(e=>{E.forEach((t,a)=>t.update(e)&&E.splice(a,1))})(r),A=K.createImageData(t,a),L=A.data,ae.draw(),K.save(),K.putImageData(A,0,0),K.restore(),requestAnimationFrame($t)};$t(1)}();