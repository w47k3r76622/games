var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,c,d){var b=this.length||0;0>c&&(c=Math.max(0,b+c));if(null==d||d>b)d=b;d=Number(d);0>d&&(d=Math.max(0,b+d));for(c=Number(c||0);c<d;c++)this[c]=a;return this}},"es6","es3");
$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");$jscomp.polyfill("Math.log2",function(a){return a?a:function(a){return Math.log(a)/Math.LN2}},"es6","es3");$jscomp.polyfill("Math.log10",function(a){return a?a:function(a){return Math.log(a)/Math.LN10}},"es6","es3");var rnd=Math.random.bind(Math),cos=Math.cos.bind(Math),sin=Math.sin.bind(Math),sqrt=Math.sqrt.bind(Math),winlisten=window.addEventListener.bind(window);
winlisten("load",initialize);var LEFT=37,RIGHT=39,SPACE=32,UP=38,MAX_SPEED=3,MAX_THROTTLE=.6,MAX_HEALTH=100,W=800,H=600,PI=Math.PI;function prot(a){return a.prototype}function chain(a,b){a.prototype=Object.create(b.prototype);a.prototype.constructor=a;return prot(a)}function V2(a,b){this.x="undefined"!=typeof a?a:0;this.y="undefined"!=typeof b?b:0}var _=null;_=prot(V2);_.fromAngle=function(a,b){this.x=cos(a)*b;this.y=sin(a)*b;return this};_.angle=function(){return Math.atan2(this.y,this.x)};
_.angleTo=function(a){return this.clone().add(a.clone().mul(-1)).angle()};_.copyFrom=function(a){this.x=a.x;this.y=a.y;return this};_.clone=function(){return new V2(this.x,this.y)};_.mul=function(a){this.x*=a;this.y*=a;return this};_.distSqure=function(a){a=a||new V2;var b=this.x-a.x;a=this.y-a.y;return b*b+a*a};_.dist=function(a){return sqrt(this.distSqure(a))};_.add=function(a,b){a instanceof V2?(this.x+=a.x,this.y+=a.y):(this.x+=a,this.y+=b);return this};var V2Zero=new V2;
function isundef(a){return"undefined"==typeof a}function GO(a){this.pos=isundef(a.pos)?new V2:a.pos.clone();this.vel=isundef(a.vel)?new V2:a.vel.clone();this.size=a.size||0;this.angle=a.angle||0;this.alphaV=this.alpha=1}_=prot(GO);_.update=function(a){this.pos.add(this.vel);this.pos.x=clamp(this.pos.x,0-this.size,W+this.size);this.pos.y=clamp(this.pos.y,0-this.size,H+this.size)};
function Asteroid(a){a=a||{};a.pos=a.pos||new V2(rnd()*W,rnd()*H);a.vel=a.vel||(new V2).fromAngle(rnd()*PI*2,2*rnd()+1);a.size=a.size||40;GO.call(this,a);this.points=[];this.angleV=-.1+.2*rnd();this.scaleV=1.3;this.scale=.01;a=1/129*PI*2;for(var b=0,c=10*rnd()+5,d=0,e=-.3+.6*rnd(),f=0;129>f;f++)this.points[f]=new V2,this.points[f].fromAngle(b,this.size+cos(d)*(this.size/10)),b+=a,d+=e,--c,0>=c&&(e=-.3+.6*rnd(),c=10*rnd()+5)}_=chain(Asteroid,GO);
_.update=function(a){GO.prototype.update.call(this,a);this.angle+=this.angleV;this.scale*=this.scaleV;if(1!=this.scaleV)if(1<this.scaleV&&1<=this.scale)this.scaleV=1;else{if(1>this.scaleV&&.1>=this.scale){if(!this.isRemoved){if(15<this.size)for(var b=3*rnd()+1<<1;0<=b;--b)a.asteroids.add(new Asteroid({pos:this.pos.clone(),size:this.size/3,vel:V2Zero.clone()})).vel.fromAngle(2*rnd()*PI,1+2*rnd());a.spawnCollectibles(this.pos)}a.asteroids.remove(this)}}else a.ship.pos.dist(this.pos)<10+this.scale*this.size&&
a.ship.damage(.45)};_.startShrink=function(){this.scaleV=.95;this.vel.mul(0)};_.markAsRemoved=function(){this.startShrink();this.isRemoved=!0};
_.draw=function(a,b){b.save();b.globalAlpha=1;b.translate(this.pos.x,this.pos.y);b.rotate(this.angle);b.scale(this.scale,this.scale);b.beginPath();b.fillStyle="#888";b.strokeStyle="#999";b.lineWidth=4;b.moveTo(this.points[0].x,this.points[0].y);a=0;for(var c=this.points.length;a<c;++a)b.lineTo(this.points[a].x,this.points[a].y);b.closePath();b.stroke();b.fill();b.restore()};function Ship(a){a=a||{};GO.call(this,a);this.hullColor=a.hullColor||"blue";this.init()}_=chain(Ship,GO);
_.init=function(){this.pos.x=.5*W;this.pos.y=.5*H;this.health=MAX_HEALTH;this.lastShot=this.throttle=0};_.reset=function(){this.init()};_.damage=function(a){this.health=Math.min(MAX_HEALTH,Math.max(this.health-a,0))};_.repair=function(a){this.damage(-a)};_.update=function(a){GO.prototype.update.call(this,a);0<this.throttle&&(a=a.particles.add(new Particle({pos:(new V2).copyFrom(this.pos)})),a.vel.fromAngle(this.angle+PI,3),a.size=1+3*rnd())};
_.draw=function(a,b){b.save();b.fillStyle=this.hullColor;b.translate(this.pos.x,this.pos.y);b.rotate(this.angle-.5*PI);b.lineWidth=2;b.beginPath();b.strokeStyle="white";b.moveTo(-5,-5);b.lineTo(0,5);b.lineTo(5,-5);b.lineTo(0,-2.5);b.lineTo(-5,-5);b.lineTo(0,5);b.stroke();b.globalAlpha=.6;b.fill();b.restore()};function EnemyShip(){Ship.call(this,{hullColor:"red"});this.pos.copyFrom(new V2(rnd()*W,rnd()*H));this.lastThrottle=0}_=chain(EnemyShip,Ship);
_.update=function(a){Ship.prototype.update.call(this,a);if(0>=this.health)a.enemies.remove(this),a.spawnCollectibles(this.pos);else{var b=a.ship.pos.angleTo(this.pos);this.angle+=.9*(b-this.angle);50<this.pos.dist(a.ship.pos)?1E3<a.time-this.lastThrottle?(this.throttle=Math.min(this.throttle+.2,MAX_THROTTLE),this.lastThrottle=a.time):(this.throttle*=.99,this.vel.mul(.99)):(this.throttle*=0,this.vel.mul(.5));300<a.time-this.lastShot&&180>this.pos.dist(a.ship.pos)&&(a.bullets.add(new EnemyBullet({pos:this.pos.clone(),
vel:(new V2).fromAngle(this.angle,5)})),this.lastShot=a.time);a=(new V2).fromAngle(this.angle,this.throttle);(new V2).copyFrom(this.vel).add(a).dist(V2Zero)<MAX_SPEED&&this.vel.add(a)}};function PlayerShip(){Ship.call(this)}_=chain(PlayerShip,Ship);
_.update=function(a){Ship.prototype.update.call(this,a);var b=globals.keys;b[LEFT]?this.angle-=.05:b[RIGHT]&&(this.angle+=.05);b[UP]?this.throttle=Math.min(this.throttle+.01,MAX_THROTTLE):(this.throttle=0,this.vel.mul(.99));b[SPACE]&&100<a.time-this.lastShot&&(a.bullets.add(new Bullet({pos:this.pos.clone(),vel:(new V2).fromAngle(this.angle,5)})),this.lastShot=a.time);b=(new V2).fromAngle(this.angle,this.throttle);(new V2).copyFrom(this.vel).add(b).dist(V2Zero)<MAX_SPEED&&this.vel.add(b);0<a.upgrades.regen&&
this.health<MAX_HEALTH&&this.damage(-(.04*a.upgrades.regen))};_.draw=function(a,b){Ship.prototype.draw.call(this,a,b);b.save();b.translate(30,40);b.fillStyle="#888";b.fillRect(0,0,204,8);b.fillStyle="green";b.fillRect(2,2,this.health/MAX_HEALTH*200,4);b.restore()};function Dot(a){GO.call(this,a);this.color=a.color||"#fff";this.alphaV=1}_=chain(Dot,GO);
_.update=function(a){GO.prototype.update.call(this,a);1!=this.alphaV&&(1>this.alphaV?.01<this.alpha?this.alpha*=this.alphaV:this.alphaV=1.1:1<this.alphaV&&(1>this.alpha?this.alpha*=this.alphaV:this.alphaV=1))};_.draw=function(a,b){b.save();b.fillStyle=this.color;b.globalAlpha=this.alpha;b.beginPath();b.arc(this.pos.x,this.pos.y,this.size,0,2*PI);b.stroke();b.fill();b.restore()};
function Collectible(a){Dot.call(this,a);this.size=a.size||6;this.color=a.color||"#0f0";this.vel.fromAngle(2*PI*rnd(),2);this.scaleV=.95}_=chain(Collectible,Dot);
_.update=function(a){Dot.prototype.update.call(this,a);if(this.pos.dist(a.ship.pos)<20+5*a.upgrades.magnet){var b=V2Zero.clone();b.add(this.pos);b.mul(-1);b.add(a.ship.pos);b.fromAngle(b.angle(),Math.min(1+.25*a.upgrades.magnet,3));this.vel.copyFrom(b)}else this.vel.mul(.96);this.alpha*=.99;this.size*=this.scaleV;1>this.scaleV&&3>this.size?this.scaleV=1.05:1<this.scaleV&&6<this.size&&(this.scaleV=.95);.1>this.alpha?a.collectibles.remove(this):10>this.pos.dist(a.ship.pos)&&(a.addScore(5),a.collectibles.remove(this))};
function Bullet(a){Dot.call(this,a);this.size=5;this.color=a.color||"#f00"}_=chain(Bullet,Dot);_.beforeRemoval=function(a){if(0<a.upgrades.explosiv&&!this.exploded)for(var b=a.upgrades.explosiv+rnd()*a.upgrades.explosiv<<0,c=0;c<b;++c)a.bullets.add(new Bullet({pos:this.pos.clone(),vel:(new V2).fromAngle(rnd()*PI*2,5)})).exploded=!0};
_.update=function(a){Dot.prototype.update.call(this,a);var b=this;b.alpha*=.96;if(.1>b.alpha)a.bullets.remove(this);else{var c=a.asteroids;if(!(0< !c.length)){for(var d=c.list[0].pos.dist(b.pos),e=0,f=c.length-1;0<=f;f--){var g=c.list[f];if(1==g.scaleV){if(g.pos.dist(b.pos)<g.size+b.size){b.beforeRemoval(a);a.bullets.remove(this);g.startShrink();return}g.pos.dist(b.pos)<d&&(d=g.pos.dist(b.pos),e=f)}}0>=a.enemies.length&&0<a.upgrades.autoaim&&d<30+25*a.upgrades.autoaim&&(d=V2Zero.clone(),d.add(b.pos),
d.mul(-1),d.add(c.list[e].pos),d.fromAngle(d.angle(),Math.min(1+.25*a.upgrades.autoaim,3)),b.vel.add(d));c=a.enemies.list;if(!(0>=c.length)){var h=!1;c.forEach(function(c){!h&&15>c.pos.dist(b.pos)&&(c.damage(20),b.beforeRemoval(a),a.bullets.remove(b),h=!0)})}}}};function EnemyBullet(a){Bullet.call(this,a);this.color="#f92";this.size=3}_=chain(EnemyBullet,Bullet);
_.update=function(a){Dot.prototype.update.call(this,a);this.alpha*=.96;.1>this.alpha?a.bullets.remove(this):15>this.pos.dist(a.ship.pos)&&(a.ship.damage(2),a.bullets.remove(this))};function Particle(a){Dot.call(this,a);this.color="#00f"}_=chain(Particle,Dot);_.update=function(a){Dot.prototype.update.call(this,a);this.size*=1.1;this.alpha*=.9;.01>this.alpha&&a.particles.remove(this)};
function TextLabel(a){GO.call(this,{});this.txt=a;this.pos.y=.5*H+25*globals.game.texts.length;this.pos.x=.5*W-7*this.txt.length;this.alphaV=.97}_=chain(TextLabel,GO);_.draw=function(a,b){b.save();b.strokeStyle="gold";b.font="30px Courier New";b.globalAlpha=this.alpha;b.strokeText(this.txt,this.pos.x,this.pos.y);b.restore()};_.update=function(a){GO.prototype.update.call(this,a);this.alpha*=this.alphaV;.01>this.alpha&&a.texts.remove(this)};function Star(a){Dot.call(this,a);this.color="#fff"}
_=chain(Star,Dot);_.update=function(a){this.vel.copyFrom(a.ship.vel).mul(-1).mul(this.size/6);Dot.prototype.update.call(this,a)};function clamp(a,b,c){a<=b?a=c:a>=c&&(a=b);return a}function GOList(a){a=a||{};GO.call(this,a);this.list=[]}_=chain(GOList,GO);Object.defineProperty(_,"length",{get:function(){return this.list.length}});_.update=function(a){GO.prototype.update.call(this,a);this.list.forEach(function(b){b.update(a)})};_.clear=function(){this.list=[]};
_.draw=function(a,b){this.list.forEach(function(c){c.draw(a,b)})};_.add=function(a){this.list.push(a);a.parent=this;return a};_.random=function(){return this.list[this.length*rnd()>>0]};_.remove=function(a){for(var b=this.length-1;0<=b;--b)if(this.list[b]===a){this.list[b]=this.list[this.list.length-1];this.list.length--;break}};
function reset(a){a.score=0;a.stage=1;a.ship.reset();a.collectibles.clear();a.asteroids.list.forEach(function(a){a.markAsRemoved()});a.particles.clear();a.bullets.clear();a.texts.clear();a.enemies.clear()}function update(a){a.time=Date.now();a.paused||(a.lists.update(a),a.ship.update(a),0>=a.ship.health&&reset(a),0>=a.asteroids.length&&spawnAsteroids(a),.05>rnd()&&(a.dots.random().alphaV=.95))}
function spawnAsteroids(a){for(var b=Math.round(1+Math.log2(a.stage+1));0<=b;--b)a.asteroids.add(new Asteroid);for(b=Math.round(Math.log2(a.stage+1));0<b;--b)a.enemies.add(new EnemyShip);a.texts.add(new TextLabel("Stage "+a.stage));a.stage++}
function draw(a){var b=globals.ctx;b.clearRect(0,0,W,H);b.fillStyle="#000";b.fillRect(0,0,W,H);b.fillStyle="#fff";a.lists.draw(a,b);a.ship.draw(a,b);b.font="26px Courier New";b.fillText("Score: "+a.score,30,25);if(a.paused){b.save();b.fillStyle="#bbb";b.globalAlpha=.3;b.fillRect(0,0,W,H);b.globalAlpha=.6;b.fillRect(.25*W,.25*H,.5*W,.5*H);b.font="70px Courier New";b.globalAlpha=1;var c="PAUSED";b.lineWidth=1;b.strokeStyle="#fff";b.strokeRect(.25*W,.25*H,.5*W,.5*H);b.strokeText(c,.5*W-20*c.length,.25*
H+60);c="Press P to continue";b.font="30px Courier New";b.strokeText(c,.5*W-9*c.length,.25*H+.5*H-30);b.font="22px Courier New";c="Upgrades: (press 1 - 4 to buy)";b.strokeText(c,.5*W-6.5*c.length,.25*H+110);b.font="25px Courier New";for(var d=[{p:"magnet"},{p:"autoaim"},{p:"regen"},{p:"explosiv"}],e=0;e<d.length;++e)c=e+1+"."+d[e].p+" lvl "+(a.upgrades[d[e].p]+1)+" *: "+calculateUpgradeCost(a.upgrades[d[e].p]),a.score>=calculateUpgradeCost(a.upgrades[d[e].p])?b.strokeStyle="#0f0":b.strokeStyle="#f00",
b.strokeText(c,.5*W-7.5*c.length,.25*H+150+28*e);b.restore()}}function calculateUpgradeCost(a){a=Math.min(Math.max(a,0),99);return parseInt(25*(a+1)+Math.log10(a+1))}function mainloop(){update(globals.game);draw(globals.game)}var globals={keys:[],ctx:null,game:{score:0,stage:1,paused:!1,ship:null,dots:null,particles:null,asteroids:null,enemies:null,bullets:null,collectibles:null,texts:null,upgrades:{magnet:0,autoaim:0,regen:0,explosiv:0}}};
function onkey(a,b){var c=b&&!globals.keys[a.keyCode];globals.keys[a.keyCode]=b;var d=globals.game;b&&"P"==String.fromCharCode(a.keyCode)&&(d.paused=!globals.game.paused);b="";if(d.paused&&c){switch(String.fromCharCode(a.keyCode)){case "1":b="magnet";break;case "2":b="autoaim";break;case "3":b="regen";break;case "4":b="explosiv"}b.length&&(a=calculateUpgradeCost(d.upgrades[b]),d.score>=a&&(d.score-=a,d.upgrades[b]++))}}function onclick(a){globals.game.paused=!globals.game.paused}
function onresize(){var a=document.getElementById("canvas"),b=window.innerWidth;a.style.marginTop=.5*(window.innerHeight-H)+"px";a.style.marginLeft=.5*(b-W)+"px"}
function initialize(){var a=document.getElementById("canvas");if(globals.ctx=a.getContext("2d")){var b=globals.game;b.spawnCollectibles=function(a){for(var c=0,e=3+3*rnd()<<0;c<e;++c)b.collectibles.add(new Collectible({pos:a}))};b.addScore=function(a){b.score+=a};b.score=0;b.ship=new PlayerShip;b.lists=new GOList;b.lists.add(b.dots=new GOList);b.lists.add(b.particles=new GOList);b.lists.add(b.asteroids=new GOList);b.lists.add(b.bullets=new GOList);b.lists.add(b.enemies=new GOList);b.lists.add(b.collectibles=
new GOList);b.lists.add(b.texts=new GOList);for(a=0;256>a;++a)globals.keys[a]=!1,b.dots.add(new Star({pos:new V2(rnd()*W,rnd()*H),size:.5+2*rnd()}));b.dots.list=b.dots.list.sort(function(a,b){return a.size-b.size});reset(b);winlisten("keyup",function(a){onkey(a,!1)});winlisten("keydown",function(a){onkey(a,!0)});winlisten("click",onclick);winlisten("resize",onresize);onresize();onclick();window.setInterval(mainloop,20)}};
