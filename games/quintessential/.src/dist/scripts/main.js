"use strict";var Quintessential=function(){this.init()};Quintessential.prototype={width:400,height:400,currentState:"",currentLevel:"",level:{fire:{axis:"x",color:"#b15050",completed:!1},water:{axis:"y",color:"#5177cd",completed:!1},air:{axis:"x",color:"#f0e292",completed:!1},earth:{axis:"y",color:"#3a7956",completed:!1}},canvas:"",canvasElement:document.querySelector("#maingame"),canvasWidth:320,canvasHeight:320,rAFid:0,player:{x:0,y:0,width:32,height:32,speed:16,spacePressed:!1,image:{},radius:0},enemyStats:{width:16,height:16,possiblePos:[1,3,5,7,9]},enemies:[],radius:0,score:{element:document.querySelector("#score"),current:0,max:5},sounds:{select:{},noHit:{},hit:{}},init:function(){console.log("play"),this.actions(),this.canvasElement.width=this.canvasWidth,this.canvasElement.height=this.canvasHeight,this.canvas=this.canvasElement.getContext("2d"),this.canvas.fillCircle=function(e,t,s,i){this.fillStyle=i,this.beginPath(),this.moveTo(e,t),this.arc(e,t,s,0,2*Math.PI,!1),this.fill()},this.radius=this.getBoundingCircleRadius(),this.player.radius=this.getBoundingCircleRadiusPlayer(),this.player.image=new Image,this.player.image.src="../images/alchemist.png",this.sounds.select=new Audio("../sounds/select.wav"),this.sounds.noHit=new Audio("../sounds/bep.wav"),this.sounds.hit=new Audio("../sounds/beeeep.wav"),this.startGame()},startGame:function(){""===this.currentState&&(this.currentState="start",window.location.hash="start"),this.gameLoop()},gameLoop:function(){var e=this;this.rAFid=window.requestAnimationFrame(function(){e.gameLoop()}),this.updatePanel(),this.draw(),this.winLevel()},updatePanel:function(){for(var e=5,t=0;t<this.score.current;t++)e-=1;this.score.element.innerHTML=e+" to go"},draw:function(){this.clear(),this.drawElement(),this.drawPlayer()},winLevel:function(){var e=this,t=e.currentLevel,s=!0;this.score.current===this.score.max&&(this.level[t].completed=!0,this.score.current=0,document.querySelector("#what-you-won").innerHTML=this.currentLevel,window.location.hash="win");for(var i in this.level)this.level[i].completed===!1?s=!1:document.querySelector(".level--"+this.currentLevel).classList.add("is-done");s===!0&&(window.location.hash="winwin",document.querySelector("body").classList.add("is-won"))},clear:function(){this.canvas.clearRect(0,0,this.canvasWidth,this.canvasHeight)},drawPlayer:function(){this.player.image.complete?this.canvas.drawImage(this.player.image,this.player.x,this.player.y):(this.canvas.strokeStyle="#000000",this.canvas.fillStyle="#000000",this.canvas.fillRect(this.player.x,this.player.y,this.player.width,this.player.height))},drawElement:function(){var e,t,s=this.currentLevel;""!==s&&(this.canvas.strokeStyle=this.level[s].color,this.canvas.fillStyle=this.level[s].color);for(var i=0;i<this.enemies.length;i++)e=10*this.pickRandom(this.enemyStats.possiblePos),this.enemies[i][0]===!1?(this.enemies[i].push(this.pickRandom([e-100,e+this.canvasWidth])),this.enemies[i].push(this.enemies[i][2]<=100?"pos":"neg"),"x"===this.level[s].axis?this.canvas.fillCircle(this.enemies[i][2],32*this.enemies[i][1],this.enemyStats.width,this.canvas.fillStyle):"y"===this.level[s].axis&&this.canvas.fillCircle(32*this.enemies[i][1],this.enemies[i][2],this.enemyStats.width,this.canvas.fillStyle),this.enemies[i][0]=!0):(this.enemies[i][2]="pos"===this.enemies[i][3]?this.enemies[i][2]+1:this.enemies[i][2]-1,"x"===this.level[s].axis?(this.canvas.fillCircle(this.enemies[i][2],32*this.enemies[i][1],this.enemyStats.width,this.canvas.fillStyle),this.enemies[i][2]>this.canvasHeight+this.enemyStats.height?(this.enemies[i][0]=!1,this.enemies[i].length=2):this.enemies[i][2]<-64&&(this.enemies[i][0]=!1,this.enemies[i].length=2),t=this.circlesIntersect(this.enemies[i][2],32*this.enemies[i][1],this.radius,this.player.x,this.player.y,this.radius),this.player.spacePressed===!0&&t===!0&&(this.score.current=this.score.current+1,this.enemies[i][0]=!1,this.enemies[i].length=2,this.sounds.hit.play())):"y"===this.level[s].axis&&(this.canvas.fillCircle(32*this.enemies[i][1],this.enemies[i][2],this.enemyStats.width,this.canvas.fillStyle),this.enemies[i][2]>this.canvasWidth+this.enemyStats.width?(this.enemies[i][0]=!1,this.enemies[i].length=2):this.enemies[i][2]<-64&&(this.enemies[i][0]=!1,this.enemies[i].length=2),t=this.circlesIntersect(32*this.enemies[i][1],this.enemies[i][2],this.radius,this.player.x,this.player.y,this.radius),this.player.spacePressed===!0&&t===!0&&(this.score.current=this.score.current+1,this.enemies[i][0]=!1,this.enemies[i].length=2,this.sounds.hit.play())))},changeState:function(){var e=window.location.hash;e!==this.currentState&&(this.currentState=e.substr(1))},chooseLevel:function(e){this.currentLevel=e.originalTarget.dataset.level;var t=e.originalTarget.dataset.arrows,s=e.originalTarget.dataset.action,i=document.createElement("p");console.log(e.originalTarget),i.innerHTML="Use the <strong>"+t+"</strong> arrow keys to navigate<br> Press <strong>"+s+"</strong> to tame the element.",i.classList.add("how-to"),document.querySelector("body").appendChild(i),this.populateEnemies(),this.player.x=this.canvasWidth/2-this.player.width/2,this.player.y=this.canvasHeight/2-this.player.height/2},populateEnemies:function(){for(var e=0;e<this.enemyStats.possiblePos.length;e++)this.enemies[e]=[],this.enemies[e].push(!1),this.enemies[e].push(this.enemyStats.possiblePos[e])},actions:function(){for(var e=this,t=document.querySelectorAll(".level"),s=0;s<t.length;s++)t[s].addEventListener("click",function(t){e.chooseLevel(t)});window.addEventListener("hashchange",this.changeState),window.addEventListener("keydown",function(t){var s=t.keyCode;"fire"===e.currentLevel||"air"===e.currentLevel?38===s?e.player.y>0&&(e.player.y=e.player.y-1*e.player.speed):40===s&&e.player.y+e.player.height<e.canvasHeight&&(e.player.y=e.player.y+1*e.player.speed):("water"===e.currentLevel||"earth"===e.currentLevel)&&(39===s?e.player.x+e.player.width<e.canvasWidth&&(e.player.x=e.player.x+1*e.player.speed):37===s&&e.player.x>0&&(e.player.x=e.player.x-1*e.player.speed)),77===s?("air"===e.currentLevel||"earth"===e.currentLevel)&&(e.sounds.noHit.play(),e.player.spacePressed=!0):78===s&&("fire"===e.currentLevel||"water"===e.currentLevel)&&(e.sounds.noHit.play(),e.player.spacePressed=!0)}),window.addEventListener("keyup",function(){e.player.spacePressed=!1}),document.querySelector(".quinta").addEventListener("animationend",function(){document.querySelector("body").classList.toggle("is-won"),document.querySelector("body").classList.add("is-end")})},getBoundingCircleRadius:function(){return Math.sqrt(this.enemyStats.width/2*this.enemyStats.width/2+this.enemyStats.height/2*this.enemyStats.height/2)},getBoundingCircleRadiusPlayer:function(){return Math.sqrt(this.player.width/2*this.player.width/2+this.player.height/2*this.player.height/2)},circlesIntersect:function(e,t,s,i,n,a){var h=i-e+13,r=n-t+13,l=Math.sqrt(h*h+r*r);return s+a>l},pickRandom:function(e){return e[Math.floor(Math.random()*e.length)]}};