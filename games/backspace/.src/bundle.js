!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var n=function(){function t(){this.observers=[]}return t.prototype.subscribe=function(t){return this.observe({onNext:function(e){return t(e)}})},t.prototype.observe=function(t){return this.observers.push(t),{disposed:!1,observers:this.observers,dispose:function(){if(!this.disposed){var e=this.observers.indexOf(t);this.observers.splice(e,1),this.disposed=!0}}}},t.prototype.onNext=function(t){this.observers.forEach(function(e){e.onNext(t)})},t}(),o=function(){function t(t){this._subject=new n,null!=t&&(this._value=t)}return Object.defineProperty(t.prototype,"value",{get:function(){return this._value},set:function(t){this._oldValue=this._value,this._value=t,this._subject.onNext(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"oldValue",{get:function(){return this._oldValue},enumerable:!0,configurable:!0}),t.prototype.subscribe=function(t){return this._subject.subscribe(t)},t.prototype.observe=function(t){return this._subject.observe(t)},t}(),s=function(){function t(t,e){this.x=Math.floor(t),this.y=Math.floor(e)}return t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t}(),r=function(){function t(t){this.observableText=new o(""),this.size=t}return Object.defineProperty(t.prototype,"text",{get:function(){return this.observableText.value},set:function(t){this.observableText.value=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"text2D",{get:function(){for(var t=[],e=0;e<this.size.y;e+=this.size.x){var i=this.text.slice(e,e+this.size.x-1);t.push(i)}return t},enumerable:!0,configurable:!0}),t.prototype.isOutOfDocument=function(t){return t<0||this.size.x*this.size.y<=t},t.prototype.isOutOfDocument2D=function(t){return t.x<0||t.y<0||this.size.x<=t.x||this.size.y<=t.y},t.prototype.getPosition2D=function(t){return new s(t%this.size.x,t/this.size.x)},t.prototype.getPosition=function(t){return t.x+t.y*this.size.x},t}(),c=function(){function t(t){this.observablePosition=new o(0),this.document=t,this._position=0}return Object.defineProperty(t.prototype,"_position",{set:function(t){this.observablePosition.value=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this.observablePosition.value},set:function(t){-1!=t&&this.document.isOutOfDocument(t)||t>=this.document.text.length||(this._position=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"character",{get:function(){return this.document.text[this.position]},set:function(t){this.document.text=this.document.text.slice(0,this.position)+t+this.document.text.slice(this.position+1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"position2D",{get:function(){return-1==this.position?new s(-1,0):this.document.getPosition2D(this.position)},set:function(t){this.position=this.document.getPosition(t)},enumerable:!0,configurable:!0}),t.prototype.move=function(t){var e=this.position2D.add(t);this.position2D=e},Object.defineProperty(t.prototype,"isOut",{get:function(){return this.document.isOutOfDocument(this.position)},enumerable:!0,configurable:!0}),t.prototype.forceMove=function(t){var e=this.position2D.add(t);this._position=this.document.getPosition(e)},t.prototype.forceSet=function(t){this._position=t},t.prototype.backspace=function(){this.position<0||(this.document.text=this.document.text.slice(0,this.position)+this.document.text.slice(this.position+1),this.position--)},t.prototype.delete=function(){this.document.text=this.document.text.slice(0,this.position+1)+this.document.text.slice(this.position+2)},t}(),u=function(t,e){this.position=t,this.direction=e},a=function(){function t(t){this._score=new o(0),this.score=this._score,this._addScoreSubject=new n,this.addScoreAsObservable=this._addScoreSubject,this._cursorMoveSubject=new n,this.cursorMoveAsObservable=this._cursorMoveSubject,this._deleteAndBackspaceSubject=new n,this.deleteAndBackspaceAsObservable=this._deleteAndBackspaceSubject,this._backSubject=new n,this.backAsObservable=this._backSubject,this._gameOverSubject=new n,this.gameOverAsObservable=this._gameOverSubject,this._endNextSubject=new n,this.endNextAsObservable=this._endNextSubject,this.busy=new o(!1),this.backs=new o([]),this.document=t,this.cursor=new c(this.document)}return t.prototype.addScore=function(t){this._score.value+=t,this._addScoreSubject.onNext(t)},t.prototype.up=function(){this.cursor.move(new s(0,-1)),this._cursorMoveSubject.onNext(this.cursor.position)},t.prototype.down=function(){this.cursor.move(new s(0,1)),this._cursorMoveSubject.onNext(this.cursor.position)},t.prototype.left=function(){this.cursor.position--,this._cursorMoveSubject.onNext(this.cursor.position)},t.prototype.right=function(){this.cursor.position++,this._cursorMoveSubject.onNext(this.cursor.position)},t.prototype.backspace=function(){this.busy.value||(this.cursor.backspace(),this._deleteAndBackspaceSubject.onNext(),this.document.text+=this.randomCharacter(),this.next())},t.prototype.delete=function(){this.busy.value||(this.cursor.delete(),this._deleteAndBackspaceSubject.onNext(),this.document.text+=this.randomCharacter(),this.next())},t.prototype.next=function(t){var e=this;if(void 0===t&&(t=0),this.busy.value=!0,this.backs.value=this.findAllBacks(),this.backs.value.length<=0)return this.backs.value=[],this.busy.value=!1,void this._endNextSubject.onNext(t);this.addScore(this.backs.value.length*(t+10)),this._backSubject.onNext({count:this.backs.value.length,combo:t});var i=this.randomText(4*this.backs.value.length);this.document.text+=i,setTimeout(function(){e.replaceBacks(),e.removeSpaces(),e.next(t+1)},300)},t.prototype.findBacks=function(t){var e=this;if(0==t.x&&0==t.y)return[];for(var i=0,n=new c(this.document),o=[];!n.isOut;){this.characters.every(function(i,o){var s=!n.isOut&&i==n.character;return!(e.document.isOutOfDocument2D(n.position2D.add(t))&&o<e.characters.length-1)&&(n.move(t),s)})&&o.push(i),i++,n.forceSet(i)}return o},t.prototype.findAllBacks=function(){for(var t=[],e=-1;e<=1;e++)for(var i=function(i){var o=new s(e,i);n.findBacks(o).map(function(t){return new u(t,o)}).forEach(function(e){return t.push(e)})},n=this,o=-1;o<=1;o++)i(o);return t},t.prototype.replaceBacks=function(t){var e=this;null==t&&(t=this.backs.value);var i=new c(this.document);t.forEach(function(t){i.position=t.position,e.characters.forEach(function(e){i.character=" ",i.move(t.direction)})})},t.prototype.removeSpaces=function(){this.document.text=this.document.text.replace(/ /g,"")},t.prototype.randomCharacter=function(){return this.characters[(t=this.characters.length,Math.floor(Math.random()*t))];var t},t.prototype.randomText=function(t){for(var e=[],i=0;i<t;i++)e.push(this.randomCharacter());return e.join("")},t}(),h=function(){function t(t,e){this.scale=1,this.name=t,this.data=e}return t.prototype.getView=function(t,e){return'<path class="'+this.name+'" transform="translate('+t+","+e+')scale(0.006,0.006)" d="'+this.data+'"></path>'},t}(),d=new h(" ",""),l={B:new h("B","M 2 ,8  c 36 ,0  29 ,108  18 ,219 M 20 ,24  c 26 ,-23  75 ,-32  85 ,-4  7 ,21  5 ,45  -57 ,72  86 ,-25  98 ,36  76 ,81  -16 ,32  -52 ,51  -88 ,47"),A:new h("A","M 1 ,212  86 ,12  156 ,223 M 38 ,121  h 85"),C:new h("C","M 146 ,71  C 147 ,18  18 ,-23  5 ,111  -6 ,237  135 ,220  144 ,171 "),K:new h("K","M 3 ,0  9 ,230 M 123 ,12  10 ,112  133 ,219")},p=function(){function t(t){var e=this;this.game=t,this.gameOver=new v(this.game.editor),this.gameOver.left.subscribe(function(t){return e.renderLeft()}),this.top=document.getElementById("top"),this.left=document.createElement("div"),this.time=document.createElement("div"),this.gameOver.gameOverAsObservable.subscribe(function(t){return e.onGameOver()}),null!=this.top&&(this.top.appendChild(this.left),this.top.appendChild(this.time)),this.gameOver.timer.time.subscribe(function(t){return e.renderTime()}),this.renderLeft()}return t.prototype.renderLeft=function(){this.left.innerHTML="left:"+this.gameOver.left.value},t.prototype.renderTime=function(){var t="green",e=this.gameOver.timer.time.value/this.gameOver.timer.limit.value;e>.7&&(t="red"),this.time.innerHTML='<svg width="100" height="20"><rect fill="'+t+'" width="'+(100-100*e)+'" height="20"></svg>'},t.prototype.onGameOver=function(){this.top.removeChild(this.left),this.top.removeChild(this.time),this.game.onGameOver()},t}(),v=function(){function t(t){var e=this;this.left=new o(12),this.timer=new b(3e4),this._gameOverSubject=new n,this.gameOverAsObservable=this._gameOverSubject,this.editor=t,this.editor.deleteAndBackspaceAsObservable.subscribe(function(t){e.decrement(),e.timer.restart()}),this.editor.backAsObservable.subscribe(function(t){(0==t.combo||t.combo>5||t.count>5)&&e.increment()}),this.editor.endNextAsObservable.subscribe(function(t){e.left.value<0&&e._gameOverSubject.onNext()}),this.left.subscribe(function(t){t<0&&e._gameOverSubject.onNext()}),this.editor.busy.subscribe(function(t){t?e.timer.stop():e.timer.start()}),this.timer.OnLimitAsObservable.subscribe(function(t){e.decrement(),e.timer.restart()}),this.timer.start(),this.gameOverAsObservable.subscribe(function(t){return e.timer.dispose()})}return t.prototype.decrement=function(){this.left.value--},t.prototype.increment=function(){this.left.value++},t}(),b=function(){function t(t){var e=this;this.time=new o(0),this.limit=new o(1e4),this.stopped=new o(!0),this.alerted=!1,this._OnLimitSubject=new n,this.OnLimitAsObservable=this._OnLimitSubject,this.limit.value=t,this.interval=setInterval(function(){e.stopped.value||(e.time.value+=100,!e.alerted&&e.time.value>=e.limit.value&&(e.alerted=!0,e._OnLimitSubject.onNext()))},100)}return t.prototype.stop=function(){this.stopped.value=!0,this.time.value=0,this.alerted=!1},t.prototype.pause=function(){this.stopped.value=!0},t.prototype.restart=function(){this.time.value=0,this.alerted=!1},t.prototype.start=function(){this.stopped.value=!1},t.prototype.dispose=function(){clearInterval(this.interval)},t}(),f=function(t){var e=this;this.createGame=function(t){var e=document.getElementById("svg");if(e instanceof SVGSVGElement)return new m(e,t)},this.play=function(){e.closeResult();var t=new r(new s(16,12)),i=new a(t),n=e.createGame(i);n instanceof m&&new p(n)},this.menu=function(){e.closeResult(),new y},this.closeResult=function(){document.getElementById("replay-button").removeEventListener("click",e.play),document.getElementById("menu-button").removeEventListener("click",e.menu),e.view.style.visibility="hidden"},this.score=t,this.view=document.getElementById("result"),null!=this.view&&(this.view.style.visibility="visible",document.getElementById("replay-button").addEventListener("click",this.play),document.getElementById("menu-button").addEventListener("click",this.menu))},m=function(){function t(t,e){var i=this;this.removeEventListeners=function(){removeEventListener("keydown",i.onKeyDown)},this.onKeyDown=function(t){switch(t.keyCode){case 38:t.preventDefault(),i.editor.up();break;case 40:t.preventDefault(),i.editor.down();break;case 37:t.preventDefault(),i.editor.left();break;case 39:t.preventDefault(),i.editor.right();break;case 8:t.preventDefault(),i.editor.backspace();break;case 46:i.editor.delete()}},this.editor=e,this.editorSvg=t,this.editor.characters=Object.keys(l),this.editorSvg.setAttribute("width",""+30*this.editor.document.size.x),this.editorSvg.setAttribute("height",""+30*this.editor.document.size.y*1.5),this.editorSvg.setAttribute("viewBox","-0.2 0 "+(this.editor.document.size.x+.3)+" "+1.5*this.editor.document.size.y),this.charG=document.createElementNS("http://www.w3.org/2000/svg","g"),this.charG.setAttribute("class","character"),this.cursorG=document.createElementNS("http://www.w3.org/2000/svg","g"),this.backsG=document.createElementNS("http://www.w3.org/2000/svg","g"),this.editorSvg.innerHTML='<rect class="rect" x="-0.05" width="'+(this.editor.document.size.x+.05)+'" height="'+1.5*this.editor.document.size.y+'"></rect>',this.editorSvg.appendChild(this.charG),this.editorSvg.appendChild(this.cursorG),this.editorSvg.appendChild(this.backsG),this.editor.document.observableText.subscribe(function(t){return i.updateChars()}),this.editor.cursor.observablePosition.subscribe(function(t){return i.updateCursor()}),this.editor.backs.subscribe(function(t){return i.updateBacks()}),this.editor.score.subscribe(function(t){return i.updateScore()}),this.editor.document.text=this.editor.randomText(this.editor.document.size.x*this.editor.document.size.y),this.updateCursor(),this.updateScore(),this.initializeSound(),this.addEventListeners(),this.editor.gameOverAsObservable.subscribe(function(){i.onGameOver()})}return t.prototype.onGameOver=function(){this.removeEventListeners(),new f(this.editor.score.value)},t.prototype.addEventListeners=function(){addEventListener("keydown",this.onKeyDown)},t.prototype.initializeSound=function(){var t=new AudioContext,e=function(e,i,n,o){void 0===e&&(e=1),void 0===i&&(i=1),void 0===n&&(n=440),void 0===o&&(o="sine");var s=t.currentTime,r=new OscillatorNode(t),c=new GainNode(t);c.gain.value=i*g.volume,r.frequency.value=n,r.type=o,r.connect(c).connect(t.destination),r.start(s),r.stop(s+e),r};this.editor.cursorMoveAsObservable.subscribe(function(t){e(.05,.5,440,"triangle")}),this.editor.deleteAndBackspaceAsObservable.subscribe(function(t){e(.05,.1,770,"square")}),this.editor.backAsObservable.subscribe(function(t){e(.3,1,440*Math.pow(1.06,t.combo),"sine")})},t.prototype.updateChars=function(){var t=[],e=new c(this.editor.document);for(e.position=0;!e.isOut;){try{t.push(l[e.character].getView(e.position2D.x,1.5*e.position2D.y))}catch(i){t.push(d.getView(e.position2D.x,1.5*e.position2D.y))}e.forceSet(e.position+1)}this.charG.innerHTML=t.join("")},t.prototype.updateCursor=function(){this.cursorG.innerHTML='<path class="cursor" d="m'+(this.editor.cursor.position2D.x+.9)+","+1.5*this.editor.cursor.position2D.y+'v1.5"></path>'},t.prototype.updateScore=function(){var t=document.getElementById("score");null!=t&&(t.innerText=this.editor.score.value.toString())},t.prototype.updateBacks=function(){var t=this,e=this.editor.backs.value,i=['<g class="back-line" transform="scale(1,1)">'];e.forEach(function(e){return i.push('<path d="m'+(t.editor.document.getPosition2D(e.position).x+.5)+","+1.5*(t.editor.document.getPosition2D(e.position).y+.5)+"l"+e.direction.x*(t.editor.characters.length-1)+","+e.direction.y*(t.editor.characters.length-1)*1.5+'"></path>')}),i.push("</g>"),this.backsG.innerHTML=i.join("")},t}(),y=function(){var t=this;this.createGame=function(t){var e=document.getElementById("svg");if(e instanceof SVGSVGElement)return new m(e,t)},this.play=function(){t.closeMenu();var e=new r(new s(16,12)),i=new a(e),n=t.createGame(i);n instanceof m&&new p(n)},this.endless=function(){t.closeMenu();var e=new r(new s(16,12)),i=new a(e);t.createGame(i)},this.closeMenu=function(){document.getElementById("play-button").removeEventListener("click",t.play),document.getElementById("endless-button").removeEventListener("click",t.endless),t.menu.style.visibility="hidden"};var e=document.getElementById("menu");null!=e&&(this.menu=e,e.style.visibility="visible",document.getElementById("play-button").addEventListener("click",this.play),document.getElementById("endless-button").addEventListener("click",this.endless))};i.d(e,"volume",function(){return g}),new y;var g={volume:.1};document.getElementById("volume").addEventListener("input",function(t){var e=t.currentTarget;e instanceof HTMLInputElement&&(Number(e.value)<-99&&(g.volume=0),g.volume=.1*Math.pow(1.03,Number(e.value)))})}]);