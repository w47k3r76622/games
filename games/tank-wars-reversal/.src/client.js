"use strict";function connect(){connected=!0,socket.connected||(socket=io(document.location.href)),socket.on("level",on_level),socket.on("disconnect",on_disconnect),socket.on("games",show_games),socket.on("finish",on_game_end)}function update(){context.level=last_received_level}function on_level(e){last_received_level=e.level,last_received_level.bullet_sound&&play_sound(shoot_sound),playing||(document.getElementById("message").style.display="none",document.getElementById("duration_div").style.display="inline",document.getElementById("myCanvas").style.display="inline",playing=!0,init(e.level),MainLoop.start())}function on_disconnect(e){connected=playing=!1}function on_game_end(e){MainLoop.stop(),stop_song(),setTimeout(function(){play_sound(finish_sound)},1),document.getElementById("duration_div").innerHTML="Time remaining: 0s";var t="<h3>Positions</h3>";for(var n=0;n<e.positions.length;n++)t+="<b>"+e.positions[n][0]+".</b> "+"<span style='background-color:"+e.positions[n][1]+";width:1rem;height:1rem;display: inline-block;'></span> ("+e.positions[n][2]+" bases) <br>";t+="<br><a href='' class='play_again_button'>Play again</a><br><br>",document.getElementById("message").innerHTML=t,document.getElementById("message").style.display="inline"}function show_games(e){var t=document.getElementById("lobby"),n="<table align='center'><tr> <th>Players</th> <th>Missing players</th> <th>width</th> <th>height</th> <th>bases</th> <th>duration</th> <th>color</th> <th>join</th> </tr>";for(var r=0;r<e.games.length;r++){var i=available_colors.filter(function(t){return e.games[r].used_colors.indexOf(t)<0});n+="<tr> <td>"+e.games[r].players_amount+"</td> <td>"+e.games[r].missing_players+"</td> <td>"+e.games[r].width+"</td> <td>"+e.games[r].height+"</td> <td>"+e.games[r].bases+"</td> <td>"+e.games[r].duration+"</td> <td>",n+=color_selection_html(e.games[r].id+"_color",i),n+="</td> <td><button onclick=",n+="\"join_game('"+e.games[r].id+"',document.getElementById('"+e.games[r].id+"_color').value)\">Join</button></td> </tr>"}n+="</table>",t.innerHTML=n}function create_game(e,t,n,r,i,s){document.getElementById("welcome").style.display="none",document.getElementById("message").style.display="inline",document.getElementById("message").innerHTML="Waiting...",socket.emit("create_game",{players_amount:e,width:t,height:n,castles_amount:r,duration:1e3*i,color:s})}function join_game(e,t){document.getElementById("welcome").style.display="none",document.getElementById("message").style.display="inline",document.getElementById("message").innerHTML="Waiting...",socket.emit("join_game",{game_id:e,color:t})}function refresh_games(){socket.emit("get_open_games")}function color_selection_html(e,t){var n="";for(var r=0;r<t.length;r++)n+="<option style='background-color:"+t[r]+";' value='"+t[r]+"'></option>";return"<select style='width:2em;' id='"+e+"'>"+n+"</select>"}var available_colors=["#008cff","#F200FF","#ff0004","#FFFD00","#ff7300","#FFF","#0dff00","#6900FF","#ACACAC","#95F7FF"],socket={},connected=!1,playing=!1,last_action={direction:0,moving:!1,shoot:!1},current_action={direction:0,moving:!1,shoot:!1},current_level=null,last_received_level=null;MainLoop.setUpdate(update).setDraw(draw),setInterval(function(){if(!connected||!playing)return;if(last_action.direction!==current_action.direction||last_action.moving!==current_action.moving||last_action.shoot!==current_action.shoot)last_action.direction=current_action.direction,last_action.moving=current_action.moving,last_action.shoot=current_action.shoot,socket.emit("action",current_action)},33),document.onkeydown=function(e){e=e||window.event,e.keyCode==37?(current_action.direction=2,current_action.moving=!0):e.keyCode==38?(current_action.direction=0,current_action.moving=!0):e.keyCode==39?(current_action.direction=1,current_action.moving=!0):e.keyCode==40?(current_action.direction=3,current_action.moving=!0):e.keyCode==32&&(current_action.shoot=!0)},document.onkeyup=function(e){e=e||window.event;if(e.keyCode===37&&current_action.direction===2||e.keyCode===38&&current_action.direction===0||e.keyCode===39&&current_action.direction===1||e.keyCode===40&&current_action.direction===3)current_action.moving=!1;e.keyCode==32&&(current_action.shoot=!1)},connect(),document.getElementById("create_colors").innerHTML=color_selection_html("c6",available_colors),draw_example();