// -------- Song definition and generation -------- //
// Music notes frequencies
function get_song(){return song==null&&(song=new Audio("data:audio/wav;base64,"+btoa(softSynth(get_wav_value,76008,0,""))),song.volume=.5),song}function generate_shoot_sound(e){return time+=125e-6,v=(1+((v<<1)+((v>>2)+1)*time*13*e)|0)&127,128+(.4-time)*v&127}function toggle_music(){sound_on=!sound_on;var e=document.getElementById("sound_button");e.innerHTML="Turn sound ",sound_on?(playing&&loop_song(),e.innerHTML+="off"):(stop_song(),e.innerHTML+="on")}function loop_song(){if(!sound_on)return;song[current_song].play(),current_song=1-current_song,next_loop=setTimeout(loop_song,9.501)}function play_sound(e){sound_on&&e.play()}function stop_song(){song[0].pause(),song[1].pause(),song[0].currentTime=song[1].currentTime=0,next_loop!==null&&clearTimeout(next_loop)}var a3=2*Math.PI*220,b3=2*Math.PI*246.94,a4=2*Math.PI*440,b4=2*Math.PI*493.88,c4=2*Math.PI*261.63,e4=2*Math.PI*329.63,f4=2*Math.PI*349.23,g4b=2*Math.PI*369.99,g4=2*Math.PI*392,d5=2*Math.PI*587.33,e5=2*Math.PI*659.25,x=[a3,e4,a4,e5],y=[a3,e4,g4],z=[e4],u=[a3,a4,c4],v=[e4,g4,b4,e5];notes=[0,x,0,x,0,x,y,0,z,u,0,y,0,x,0,x,0,x,0,z,u,0,[d5],0,x,0,x,0,x,y,z,x,0,v,0,v,0,v,0,v,0,[c4,e4,g4,b4],0,[b3,e4,g4b,b4],0],sections=[.001,.21,.6,.81,1.2,1.35,1.54,1.64,1.8,2,2.1,2.27,2.4,2.64,3,3.21,3.6,3.81,4.05,4.2,4.41,4.5,4.69,4.8,5.01,5.4,5.61,6,6.15,6.45,6.6,6.81,6.9,7.07,7.2,7.65,7.8,8.01,8.1,8.27,8.4,8.9,9,9.5,9.501],previous_section_start=0,current_section=0,current_section_time=0,time=0,sampleFrequency=8e3,middle=128;var get_wav_value=function(e){time+=125e-6,current_section_time+=125e-6,linear_soften=Math.max(.9-current_section_time/(sections[current_section]-previous_section_start),.05),time>sections[current_section]&&(previous_section_start=sections[current_section],current_section_time=0,current_section+=1);if(notes[current_section]===0)return middle;if(notes[current_section].length==1)return middle+linear_soften*127*Math.sin(notes[current_section][0]*current_section_time);if(notes[current_section].length==2)return middle+linear_soften*63*(Math.sin(notes[current_section][0]*current_section_time)+Math.sin(notes[current_section][1]*current_section_time));if(notes[current_section].length==3)return middle+linear_soften*42*(Math.sin(notes[current_section][0]*current_section_time)+Math.sin(notes[current_section][1]*current_section_time)+Math.sin(notes[current_section][2]*current_section_time));if(notes[current_section].length==4)return middle+linear_soften*31*(Math.sin(notes[current_section][0]*current_section_time)+Math.sin(notes[current_section][1]*current_section_time)+Math.sin(notes[current_section][2]*current_section_time)+Math.sin(notes[current_section][3]*current_section_time))},softSynth=function(e,t,n,r){for(n|=r="RIFF_oO_WAVEfmt "+atob("EAAAAAEAAQBAHwAAQB8AAAEACAA")+"data";++n<t;)r+=String.fromCharCode(e(n));return r},song=null,song=[get_song(),get_song()];time=0;var v=1,shoot_sound=new Audio("data:audio/wav;base64,"+btoa(softSynth(generate_shoot_sound,3200,0,"")));shoot_sound.volume=.5,time=previous_section_start=current_section=current_section_time=0,notes=[[a4],0,[a4],0,[a4],0,[d5],0],sections=[.3,.5,.6,.7,.8,1,1.3,1.5];var finish_sound=new Audio("data:audio/wav;base64,"+btoa(softSynth(get_wav_value,12e3,0,"")));finish_sound.volume=.5;var sound_on=!1,current_song=0,next_loop=null;